{"version":3,"file":"main.7f88e0b4cdfd4a62.js","mappings":"+LAYO,IAAMA,EAAY,MAAnB,MAAOA,EAISC,SAHZC,QACAC,SAERC,YAAoBH,GAAAI,KAAAJ,WAClB,MAAMK,EAASD,KAAKJ,SAASM,IAAmBC,MAChDH,KAAKH,QAAUI,EAAOG,UAAU,QAChCJ,KAAKF,SAAWE,KAAKH,SAASC,QAChC,CAEAO,IAAIC,GACFC,aAAaC,QAAQR,KAAKF,SAAUQ,EACtC,CAEAG,SACEF,aAAaG,WAAWV,KAAKF,SAC/B,CAEAI,MACE,OAAOK,aAAaI,QAAQX,KAAKF,SACnC,CAEAc,SACE,MAAMN,EAAQN,KAAKE,MACnB,GAAKI,EAGL,SAAOO,KAAUP,EACnB,CAEAQ,YACE,MAAMC,EAAMf,KAAKY,SACXI,OAAkBC,MAAOC,UAAY,IAC3C,QAAIH,GAAOC,EAAcD,EAAII,IAI/B,4CArCWxB,GAAYyB,aAAA,iCAAZzB,EAAY0B,QAAZ1B,EAAY2B,UAAAC,WAFX,gBAED5B,CAAY,0GCQlB,IAAM6B,EAAW,MAAlB,MAAOA,EAkBDC,KACAC,aACAzB,OACA0B,gBACAC,eACYC,OAtBfC,cAAgB,IAAIC,SAAyBC,GAC7CC,QAAU,IAAIF,SAAyBC,GACvCE,YACAC,eAAgB,EACfC,WAAY,EACZC,YAER,kBAAIC,GACF,YAAiCN,IAA1BhC,KAAKqC,aAAaE,GAC3B,CAEA,QAAIC,GACF,MAAMC,EAAezC,KAAK0C,cAC1B,OAAOD,GAAcD,KAAOC,EAAaD,KAAO,IAClD,CAEAzC,YACU0B,EACAC,EACAzB,EACA0B,EACAC,EACYC,GALZ7B,KAAAyB,OACAzB,KAAA0B,eACA1B,KAAAC,SACAD,KAAA2B,kBACA3B,KAAA4B,iBACY5B,KAAA6B,SAEpB7B,KAAKqC,YAAcrC,KAAKC,OAAOG,UAAU,QACzCJ,KAAK8B,cAAca,KAAK3C,KAAK4C,eAC7B5C,KAAK8B,cAAce,UAAWD,IAC5B5C,KAAKiC,QAAQU,KAAKC,GAClBE,IAA0BH,MAAI,EAElC,CAEAI,MAAMC,EAAkBC,GACtB,MAAMC,EAAW,IAAIC,KAAY,CAAE,eAAgB,qBAE7CC,EAAO,CACXJ,WACAC,SAAUjD,KAAKqD,eAAeJ,IAGhC,OAAOjD,KAAKsD,UAAUF,EAAMF,EAC9B,CAEAK,eACEjD,EACAkD,EACAC,GAEA,MAAMP,EAAW,IAAIC,KAAY,CAAE,eAAgB,qBAQnD,OAAOnD,KAAKsD,UANC,CACXhD,QACAoD,eAAgBF,EAChBC,aAG0BP,EAC9B,CAEAS,iBACE,OAAA3D,KAAKoC,WAAY,EACjBpC,KAAKiC,QAAQU,MAAK,IAAI,EACfiB,OAAG,EACZ,CAEAC,UACE,OAAO7D,KAAKyB,KAAKqC,KAAK,GAAG9D,KAAKqC,aAAaE,cAAe,IAAIwB,QAC5DC,KAAKC,IACHjE,KAAK0B,aAAarB,IAAI4D,EAAK3D,MAAK,IACjC,EACD4D,KAAYC,IACVA,QAAIC,MAAMC,QAAS,EACbF,IAGZ,CAEAG,SACE,OAAAtE,KAAKoC,WAAY,EACjBpC,KAAK0B,aAAajB,SAClBT,KAAK8B,cAAca,MAAK,IAAK,EACtBiB,OAAG,EACZ,CAEAW,kBACE,OAAQvE,KAAK0B,aAAaZ,WAC5B,CAEA0D,WACE,OAAOxE,KAAK0B,aAAaxB,KAC3B,CAEAwC,cACE,GAAI1C,KAAKuE,kBACP,OAAOvE,KAAK0B,aAAad,QAG7B,CAEA6D,kBACE,IAAKzE,KAAK6B,OACR,OAEF,MAAMK,EAAclC,KAAKkC,aAAelC,KAAK6B,OAAOU,IAEhDL,IAAgBlC,KAAKqC,YAAYqC,WAEnC1E,KAAK6B,OAAO8C,cADM3E,KAAKqC,YAAYuC,WAAa,KAEvC1C,GACTlC,KAAK6B,OAAO8C,cAAczC,EAE9B,CAEA2C,cAEE,OAAO7E,KAAKyB,KAAKvB,IADLF,KAAKqC,aAAaE,IAAM,QAEtC,CAEAuC,aACE,OAAO9E,KAAKyB,KAAKvB,IACf,GAAGF,KAAKqC,aAAaE,cAEzB,CAEAwC,WAAWvC,GACT,OAAOxC,KAAKyB,KAAKuD,MAAYhF,KAAKqC,aAAaE,IAAKC,EACtD,CAEQa,eAAeJ,GACrB,OAAOgC,KAAOC,OAAOjC,EACvB,CAGA,UAAIkC,GACF,OAAOnF,KAAK4C,eAAiB5C,KAAKoF,WACpC,CAEA,eAAIA,GACF,OAAOpF,KAAKoC,SACd,CAEA,iBAAIQ,GACF,OAAO5C,KAAKuE,iBACd,CAEA,WAAIc,GAEF,QADcrF,KAAK0C,eACRF,MAAM6C,OAInB,CAEQ/B,UAAUF,EAAMkC,GACtB,OAAOtF,KAAKyB,KACTqC,KAAK,GAAG9D,KAAKqC,aAAaE,YAAaa,EAAM,CAAEkC,YAC/CvB,QACCC,KAAKC,IACHjE,KAAK0B,aAAarB,IAAI4D,EAAK3D,OAC3B,MAAMiF,EAAevF,KAAK0C,cACtB6C,GAAc/C,OACZ+C,EAAa/C,KAAKgD,SAAWxF,KAAKmC,eACpCnC,KAAK2B,gBAAgB8D,YAAYF,EAAa/C,KAAKgD,QAEjDD,EAAa/C,KAAK1B,WACpBd,KAAK4B,eAAe8D,MAAM,oCAG9B1F,KAAK8B,cAAca,MAAK,EAAI,IAC7B,EACDuB,KAAYC,IACVA,QAAIC,MAAMC,QAAS,EACbF,IAGd,4CAhLW3C,GAAWJ,MAAAuE,MAAAvE,MAAAwE,GAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,KAAA,oCAAXxE,EAAWH,QAAXG,EAAWF,UAAAC,WAFV,gBAEDC,CAAW,KCPXyE,EAAmB,MAA1B,MAAOA,UAA2BC,KAG5BzE,KACA0E,YACAzE,aAJV3B,YACEE,EACQwB,EACA0E,EACAzE,GAER0E,MAAMnG,GAJED,KAAAyB,OACAzB,KAAAmG,cACAnG,KAAA0B,eAIR1B,KAAKmG,YAAYrE,cAAce,UAAW0B,IACpCA,GAAmBvE,KAAKH,QAAQ0C,KAClCvC,KAAKyB,KACFvB,IAAIF,KAAKH,QAAQ0C,KACjBM,UAAWwD,IACV,GAAIA,GAAWA,EAAQC,WACrB,UAAWC,KAAOC,OAAOC,KAAKJ,EAAQC,YAEpCF,MAAM/F,IAAIkG,EADIF,EAAQC,WAAWC,GAEnC,EAEH,EAGT,CAEAlG,IACEkG,EACAG,EACAC,EAAsBC,KAAaC,OAEnC,GACEF,IAAUC,KAAaC,OACvB7G,KAAKmG,YAAYvD,eACjB5C,KAAKH,QAAQ0C,IACb,CACA,MAAM+D,EAAa,GACnBA,EAAWC,GAAOG,EAClB1G,KAAKyB,KAAKuD,MAAMhF,KAAKH,QAAQ0C,IAAK,CAAE+D,eAAczD,WACpD,CACAuD,MAAM/F,IAAIkG,EAAKG,EAAOC,EACxB,CAEAlG,OAAO8F,EAAaI,EAAsBC,KAAaC,OACrD,GACEF,IAAUC,KAAaC,OACvB7G,KAAKmG,YAAYvD,eACjB5C,KAAKH,QAAQ0C,IACb,CACA,MAAM+D,EAAa,GACnBA,EAAWC,QAAOvE,EAClBhC,KAAKyB,KAAKuD,MAAMhF,KAAKH,QAAQ0C,IAAK,CAAE+D,eAAczD,WACpD,CACAuD,MAAM3F,OAAO8F,EAAKI,EACpB,CAEAG,MAAMH,EAAsBC,KAAaC,OAmBvC,IAAIvG,EAjBFqG,IAAUC,KAAaC,OACvB7G,KAAKmG,YAAYvD,eACjB5C,KAAKH,QAAQ0C,KAEbvC,KAAKyB,KACFuD,MACChF,KAAKH,QAAQ0C,IACb,CAAE+D,WAAY,IACd,CACES,OAAQ,CACNC,gBAAiB,WAItBnE,YAID8D,IAAUC,KAAaC,QACzBvG,EAAQN,KAAK0B,aAAaxB,OAG5BkG,MAAMU,MAAMH,GAERrG,GACFN,KAAK0B,aAAarB,IAAIC,GAItBqG,IAAUC,KAAaC,OACvB7G,KAAKmG,YAAYvD,eACjB5C,KAAKH,QAAQ0C,KAEbvC,KAAKyB,KACFvB,IAAIF,KAAKH,QAAQ0C,KACjBM,UAAWwD,IACV,GAAIA,GAAWA,EAAQC,WACrB,UAAWC,KAAOC,OAAOC,KAAKJ,EAAQC,YAEpCF,MAAM/F,IAAIkG,EADIF,EAAQC,WAAWC,GAEnC,EAIV,4CArGWN,GAAkB7E,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,GAAAzE,MAAA0E,GAAA,iCAAlBG,EAAkB5E,QAAlB4E,EAAkB3E,UAAAC,WAFjB,gBAED0E,CAAmB,KCqCzB,eC1BA,IAAMgB,GAAe,MAAtB,MAAOA,EAQDhH,OACAyB,aACAD,KATFY,YACA6E,mBAAoB,EACpBC,WACAC,qBACAC,mBAERtH,YACUE,EACAyB,EACAD,GAFAzB,KAAAC,SACAD,KAAA0B,eACA1B,KAAAyB,OAERzB,KAAKqC,YAAcrC,KAAKC,OAAOG,UAAU,QAEzCJ,KAAKmH,WAAanH,KAAKqC,aAAa8E,YAAc,GAClDnH,KAAKmH,WAAWG,KAAKC,OAAOC,SAASC,UAErCzH,KAAKoH,qBAAuBpH,KAAKqC,aAAa+E,sBAAwB,GACtEpH,KAAKqH,mBAAqBrH,KAAKqC,aAAaqF,YAAc,EAC5D,CAEAC,UACEC,EACAjF,GAEA,MAAMkF,EAAkB7H,KAAK8H,2BAA2BF,EAAYrF,KACpE,IAAIwF,EAAMH,EAAYI,QACtB,MAAMC,EAAcjI,KAAKkI,qBAAqBN,EAAYrF,KAM1D,GALI0F,IACFF,EAAMA,EAAIC,MAAM,CACdjB,OAAQgB,EAAIhB,OAAO1G,IAAI4H,EAAY1B,IAAK0B,EAAYvB,UAGpDmB,EACFE,SAAMH,EAAYI,MAAM,CACtBH,oBAEKlF,EAAKwF,OAAOJ,GAErB/H,KAAKoI,eACL,MAAM9H,EAAQN,KAAK0B,aAAaxB,MAC1BmI,EAAUC,SAASC,cAAc,KAMvC,GALAF,EAAQG,KAAOT,EAAIxF,IACE,KAAjB8F,EAAQI,OACVJ,EAAQG,KAAOH,EAAQG,OAGpBlI,IAAuD,IAA9CN,KAAKmH,WAAWuB,QAAQL,EAAQZ,UAC5C,OAAO9E,EAAKwF,OAAOJ,GAIrB,IAAIY,EAAUZ,EAAIC,MAAM,CACtB1C,QAASyC,EAAIzC,QAAQjF,IAAI,gBAFR,UAAUC,OAK7B,MAAMiF,EAAevF,KAAK0B,aAAad,SACvC,GAAiC,SAA7B+H,EAAQ5B,OAAO7G,IAAI,OAAoBqF,GAAc/C,MAAMoG,SAAU,CACvE,MAAMC,EAAWC,KAAIC,QAAQxD,EAAa/C,KAAKoG,UAC/CD,EAAUA,EAAQX,MAAM,CACtBjB,OAAQ4B,EAAQ5B,OAAO1G,IAAI,KAAMwI,IAErC,KAAwC,SAA7BF,EAAQ5B,OAAO7G,IAAI,QAC5ByI,EAAUA,EAAQX,MAAM,CACtBjB,OAAQ4B,EAAQ5B,OAAOiC,OAAO,SAIlC,OAAOrG,EAAKwF,OAAOQ,EACrB,CAEAM,aAAaC,EAAK3G,GAChB,MAAMsF,EAAkB7H,KAAK8H,2BAA2BvF,GACxD,GAAIsF,EACFqB,SAAIrB,gBAAkBA,GACf,EAGT7H,KAAKoI,eACL,MAAMC,EAAUC,SAASC,cAAc,KACvCF,EAAQG,KAAOjG,EAEf,MAAMjC,EAAQN,KAAK0B,aAAaxB,MAChC,SAAKI,IAAuD,IAA9CN,KAAKmH,WAAWuB,QAAQL,EAAQZ,YAG9CyB,EAAIC,iBAAiB,gBAAiB,UAAY7I,GAC3C,GACT,CAEA8I,oBAAoB7G,GAClB,MAAM0F,EAAcjI,KAAKkI,qBAAqB3F,GAE9C,GAAI0F,EAAa,CACf,MAAMoB,EAFa9G,EAEkB+G,MAAM,QAC3C,IAAIC,EAAkBF,EAAcG,QACpC,MAAMC,EAAeJ,EAAcK,OAAQC,GAAmB,IAAbA,EAAEC,QACnDH,SAAanC,KAAK,GAAGW,EAAY1B,OAAO0B,EAAYvB,SAChD+C,EAAaG,SACfL,GAAmB,IAAME,EAAaI,KAAK,MAEtCN,CACT,CAEF,CAEQzB,2BAA2BgC,GACjC,IAAIjC,GAAkB,EACtB,UAAWkC,KAAuB/J,KAAKoH,qBAErC,GADoB,IAAI4C,OAAOD,EAAoBE,kBACnCC,KAAKJ,GAAS,CAC5BjC,OAC0C7F,IAAxC+H,EAAoBlC,gBAChBkC,EAAoBlC,qBACpB7F,EACN,KACF,CAEF,OAAO6F,CACT,CAEQK,qBAAqB4B,GAC3B,IAAI7B,EACJ,UAAWkC,KAAqBnK,KAAKqH,mBAEnC,GADoB,IAAI2C,OAAOG,EAAkBF,kBACjCC,KAAKJ,KAEJ,IAAIE,OADL,GAAGG,EAAkBC,eAAeD,EAAkBE,WACjC,MACrBH,KAAKJ,GAAS,CAC1B7B,EAAc,CACZ1B,IAAK4D,EAAkBC,YACvB1D,MAAOyD,EAAkBE,UAE3B,KACF,CAGJ,OAAOpC,CACT,CAEAG,eACE,MAAMrH,EAAMf,KAAK0B,aAAad,SACxBI,OAAkBC,MAAOC,UAAY,IAE3C,IACGlB,KAAKkH,mBACNnG,GACAC,EAAcD,EAAII,KAClBH,EAAcD,EAAII,IAAM,KACxB,CACAnB,KAAKkH,mBAAoB,EAEzB,MAAM3E,EAAMvC,KAAKqC,aAAaE,IAC9B,OAAOvC,KAAKyB,KAAKqC,KAAK,GAAGvB,YAAe,IAAIM,UACzCoB,IACCjE,KAAK0B,aAAarB,IAAI4D,EAAK3D,OAC3BN,KAAKkH,mBAAoB,GAE1B/C,IACCA,EAAIC,MAAMC,QAAS,EACZF,GAGb,CACF,4CApKW8C,GAAe7F,MAAAuE,MAAAvE,MAAAwE,GAAAxE,MAAAyE,MAAA,iCAAfoB,EAAe5F,QAAf4F,EAAe3F,UAAAC,WAFd,gBAED0F,CAAe,KCRtB,SAAUqD,KACXC,GAEH,MAAMC,EAAwB,CAC5B,CACEC,QAASC,KACTC,SAAU1D,GACV2D,OAAO,GAET,CACEH,QAASI,KACTF,SAAU1E,IAId,UAAW6E,KAAWP,EACpBC,EAAUlD,QAAQwD,EAAQN,WAG5B,SAAOO,OAAyBP,EAClC,uECpCO,IAAKQ,EAAZ,SAAYA,IACVA,UAAAC,KAAA,OACAD,GAAAE,QAAA,UACAF,GAAAG,QAAA,UAHUH,EAIZ,CAJA,CAAYA,GAAa,eCQnB,MAAOI,UAAoBC,2MCC/BjK,MAAA,+BAQEA,MAAA,iCAGFA,iCALEA,MAFA,QAAAkK,GAAAC,MAEAnK,CAFe,WAAAA,MAAA,IAAAkK,GAAAE,WAEfpK,CAD8B,oBAI5BA,MAAA,GAAAA,MAAA,OAAAkK,GAAAG,aAAAH,GAAAI,OAAAC,MAAAvK,MAAA,IAAAkK,GAAAI,OAAAC,MAAAL,GAAAI,OAAAC,oCAGJvK,MAAA,YAAgCA,MAAA,wBAAuBA,iCAAvBA,oBAAA,IAAAkK,GAAAM,qDArBlCxK,MAAA,4EAOEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAQ,UAAS,GAclB1K,MAZA,EAAA2K,EAAA,eAYA3K,CALC,EAAA4K,GAAA,cAMH5K,kCAhBEA,MADA,aAAAkK,GAAAW,YAAA7K,MAAA,IAAAA,MAAA,IAAAkK,GAAAY,WAAAZ,GAAAM,OAAA,GACAxK,CAD2E,UAAAA,MAAA,IAAAkK,GAAAa,WAKxE/K,MAAA,GAAAA,MAAA,OAAAkK,GAAAc,UAWIhL,cAAA,OAAAkK,GAAAe,wDAWPjL,MAAA,sCAEEA,MAAA,oBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,MAAA,UAAAA,MAAUkK,GAAAI,OAAAa,UAAgB,GAG1BnL,MAAA,wBACFA,mCAHEA,MAAA,UAAAA,MAAA,IAAAkK,GAAAkB,kBAEApL,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAAkK,GAAAM,OAAA,kCAbJxK,MAAA,4EAQEA,MAAA,EAAAqL,EAAA,sBAOFrL,gCATEA,MADA,aAAAkK,GAAAW,YAAA7K,MAAA,IAAAA,MAAA,IAAAkK,GAAAY,WAAAZ,GAAAM,OAAA,GACAxK,CAD2E,UAAAA,MAAA,IAAAkK,GAAAa,WAIxE/K,MAAA,GAAAA,MAAA,OAAAkK,GAAAe,YCYE,IAAMK,EAAsB,MAA7B,MAAOA,GACFlB,UAAsC,IAAIzJ,KAAgB,GAE1DyK,gBAA4C,IAAIzK,SACvDC,GAGOkK,SAAoC,IAAInK,SAAgBC,GAExD2K,WAAuC,IAAI5K,KAAgB,GAE3DoK,SACP,IAAIpK,IAAgB,IAEd6K,UAEAC,WAEAC,eAEAC,iBAEAC,UAEAC,YAEAC,UAERzB,aAAeA,IAKNC,OAKAH,MAAQ,UAKRc,WAAY,EAKZD,UAAW,EAKXH,aAAc,EAKvB,YACIkB,CAASzG,IACX1G,KAAKwL,UAAU7I,KAAK+D,GACtB,CACA,YAAIyG,GACF,OAAOnN,KAAKwL,UAAU9E,KACxB,CAKA,aACI0G,CAAU1G,IACZ1G,KAAK2M,WAAWhK,KAAK+D,GACvB,CACA,aAAI0G,GACF,OAAOpN,KAAK2M,WAAWjG,KACzB,CAKU2G,QAAgC,IAAIC,MAK9C,SAAI1B,GACF,OAAO5L,KAAK0L,OAAOE,KACrB,CAEA2B,WACE,MAAMC,GAAOxN,KAAK0L,OAAO8B,MAAQ,QAELxL,IAAxBhC,KAAK0L,OAAO+B,UACdzN,KAAK4M,UAAY5M,KAAK0L,OACnB+B,WAAWD,IACX3K,UAAW4K,IACVzN,KAAK0N,cAAcD,OAAQ,EAI7BhC,KAAazL,KAAK0L,OAAOiC,gBAC3B3N,KAAK+M,iBAAmB/M,KAAK0L,OAAOiC,eAAe9K,UAChD8K,IAA4B3N,KAAK4N,qBAAqBD,KAGzD3N,KAAK4N,qBAAqB5N,KAAK0L,OAAOiC,iBAAc,EAGlDlC,KAAazL,KAAK0L,OAAOmC,SAC3B7N,KAAKgN,UAAYhN,KAAK0L,OAAOmC,QAAQhL,UAAWgL,IAC9C7N,KAAK8N,cAAcD,KAGrB7N,KAAK8N,cAAc9N,KAAK0L,OAAOmC,cAGA7L,IAA7BhC,KAAK0L,OAAOqC,eACd/N,KAAK8M,eAAiB9M,KAAK0L,OACxBqC,gBAAgBP,IAChB3K,UAAWmL,IAAwBhO,KAAKmN,UAAYa,KAGzDhO,KAAK6M,WAAa7M,KAAKwL,UAAU3I,UAAWsK,IAC1CnN,KAAK0N,cAAc,CAAE,8BAA+BP,WAG1BnL,IAAxBhC,KAAK0L,OAAOuC,UACdjO,KAAKkN,UAAYlN,KAAK0L,OACnBuC,WAAWT,IACX3K,UAAWoL,IAAsBjO,KAAKoN,WAAaa,KAGxDjO,KAAKiN,YAAcjN,KAAK2M,WAAW9J,UAAWuK,IAC5CpN,KAAK0N,cAAc,CAAE,gCAAiCN,KAE1D,CAEAc,mBACyBlM,IAAnBhC,KAAK4M,YACP5M,KAAK4M,UAAUuB,cACfnO,KAAK4M,eAAY5K,QAGSA,IAAxBhC,KAAK8M,iBACP9M,KAAK8M,eAAeqB,cACpBnO,KAAK8M,oBAAiB9K,QAGDA,IAAnBhC,KAAKkN,YACPlN,KAAKkN,UAAUiB,cACfnO,KAAKkN,eAAYlL,QAGWA,IAA1BhC,KAAK+M,mBACP/M,KAAK+M,iBAAiBoB,cACtBnO,KAAK+M,sBAAmB/K,QAGHA,IAAnBhC,KAAKgN,YACPhN,KAAKgN,UAAUmB,cACfnO,KAAKgN,eAAYhL,GAGnBhC,KAAK6M,WAAWsB,cAChBnO,KAAKiN,YAAYkB,aACnB,CAOArC,WACwB,IAAlB9L,KAAKmN,UAGTnN,KAAKqN,QAAQe,KAAKpO,KAAK0L,OACzB,CAEQgC,cAAcD,IACpBzN,KAAKmM,SAASxJ,KAAK6D,OAAO6H,OAAO,GAAIrO,KAAKmM,SAASzF,MAAO+G,IAC5D,CAEQK,cAAcD,IACpB7N,KAAKkM,SAASvJ,KAAKkL,GACrB,CAEQD,qBAAqBD,IAC3B3N,KAAKwM,gBAAgB7J,KAAKgL,GAC5B,8CA7LWjB,GAAsB,+BAAtBA,GAAsB4B,UAAA,yBAAAC,OAAA,CAAA7C,OAAA,SAAAH,MAAA,QAAAc,UAAA,YAAAD,SAAA,WAAAH,YAAA,cAAAkB,SAAA,WAAAC,UAAA,aAAAoB,QAAA,CAAAnB,QAAA,WAAAoB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kxBAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,IDrBnC1N,MAxBA,EAAA4N,EAAA,uBAwBA5N,CAhBC,EAAA6N,EAAA,8BAPE7N,MAAA,QAAA2N,GAAArD,OAAAwD,UAyBA9N,cAAA,OAAA2N,GAAArD,OAAAwD,0BCOCC,KACAC,KAAazJ,UACb0J,KAAgBzJ,KAChB0J,KACAC,KAAe1J,KACf2J,KACAC,KAAiB3J,KACjB4J,KACAC,KAAiB5J,KACjB6J,MAAgBC,OAAA,yqBAAAC,gBAAA,WAGPpD,EAAsB,+DCzCjCtL,MAJF,UAIEA,CADD,mCAMGA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAyE,WAAU,GAEnB3O,MAAA,cAAUA,MAAA,iBAEdA,mBALIA,cAAA,aAAAA,MAAA,mFAOFA,MAAA,2BAQEA,MAAA,qBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,MAAA,UAAAA,MAAWkK,GAAA0E,gBAAA1E,GAAA2E,sBAAqC,GAElD7O,mCAHEA,MAJA,eAIAA,CAJmB,cAInBA,CAHiB,QAAAkK,GAAAC,MAGjBnK,CAFe,WAAAkK,GAAA4E,MAAAC,KAAAC,MAEfhP,CAD6B,SAAAkK,GAAA2E,mEAa7B7O,MAAA,2BAQEA,MAAA,2BAAAiP,GAAAjP,MAAAkP,IAAAC,UAAAjF,GAAAlK,MAAA,UAAAA,MAAWkK,GAAA0E,gBAAAK,IAAuB,GAEpCjP,mDAHEA,MALA,YAAAkK,GAAAe,UAKAjL,CALuB,WAAAkK,GAAAc,SAKvBhL,CAJqB,cAAAkK,GAAAW,YAIrB7K,CAH2B,QAAAkK,GAAAC,MAG3BnK,CAFe,WAAAkK,GAAA4E,MAAAM,MAAAtQ,IAAAmQ,IAAAlD,SAEf/L,CAD6C,SAAAiP,iCAbjDjP,MAAA,EAAAqP,EAAA,uBAAArP,iDAKEA,MAAA,UAAAA,MAAA,IAAAkK,GAAA4E,MAAAC,KAAAO,sCAlBJtP,MAAA,gBAaEA,MAZA,EAAAuP,EAAA,4BAYAvP,CAHC,EAAAwP,EAAA,YAsBHxP,gCA9BKA,cAAA,OAAAkK,GAAAuF,kBAaAzP,cAAA,QAAAkK,GAAAwF,wDAuBH1P,MAJF,WAIEA,CADD,mCAMGA,MAAA,mBAAAA,MAAA2P,IAAA,MAAAzF,GAAAlK,QAAA,OAAAA,MAASkK,GAAA0F,aAAY,GAErB5P,MAAA,cAAUA,MAAA,iBAEdA,mBALIA,cAAA,aAAAA,MAAA,qFA+BIA,MAAA,2BAMEA,MAAA,2BAAA6P,GAAA7P,MAAA8P,IAAAX,UAAAjF,GAAAlK,MAAA,UAAAA,MAAWkK,GAAA0E,gBAAAiB,IAAuB,GAEpC7P,mDAHEA,MAHA,YAAAkK,GAAAe,UAGAjL,CAHuB,WAAAkK,GAAAc,SAGvBhL,CAFqB,QAAAkK,GAAAC,MAErBnK,CADe,SAAA6P,iCA3BvB7P,MADF,QACEA,CAD0C,oCAWxCA,MAAA,cAAUA,MAAA,GACZA,UAUEA,MARF,kBAQEA,CADD,cAEGA,MAAA,EAAA+P,EAAA,uCAaN/P,gDA9BIA,QAGAA,MAHA,aAAAA,MAAA,kCAGAA,CAHsD,oBAAAgQ,GAGtDhQ,CAFmC,WAAAkK,GAAA4E,MAAAC,KAAAC,MAEnChP,CAD6B,QAAAkK,GAAA+F,WAGnBjQ,MAAA,GAAAA,MAAAkK,GAAAK,MASVvK,cAAAkK,GAAAgG,cADAlQ,MADA,YAAAkK,GAAAiG,UACAnQ,CADuB,YAAAkK,GAAAkG,WAKSpQ,MAAA,GAAAA,MAAA,UAAAA,MAAA,KAAAkK,GAAA4E,MAAAC,KAAAO,sDAoB9BtP,MAAA,2BAMEA,MAAA,2BAAAqQ,GAAArQ,MAAAsQ,IAAAnB,UAAAjF,GAAAlK,MAAA,UAAAA,MAAWkK,GAAA0E,gBAAAyB,IAAuB,GAEpCrQ,QACAA,MAAA,mDAJEA,MAHA,YAAAkK,GAAAe,UAGAjL,CAHuB,WAAAkK,GAAAc,SAGvBhL,CAFqB,QAAAkK,GAAAC,MAErBnK,CADe,SAAAqQ,iCANrBrQ,MAJF,gBAIEA,CADD,cAEGA,MAAA,EAAAuQ,EAAA,uCAaJvQ,kCAbkCA,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAAkK,GAAA4E,MAAAC,KAAAO,UC9C3B,IAAMkB,EAAkB,MAAzB,MAAOA,GAuLFC,QACCC,MACAC,MACDC,aArLTC,cAAgBjH,EAMhB8F,WAAY,EAMZb,qBAAuB,CACrBiC,GAAI,mBACJvG,KAAM,YACNY,QAASA,KACPvM,KAAK8Q,WAAa9Q,KAAK8Q,YAQnBqB,QAKRC,iBAA6C,IAAIrQ,KAC/C,GAMFsQ,sBACE,IAAItQ,KAAyB,GAK/BuQ,sBACE,IAAIvQ,KAAyB,GAKtBmO,MAKAqC,KAAsBvH,EAAcC,KAKpC4F,kBAAmB,EAKnB2B,YAAa,EAKbjH,MAAQ,UAKR8F,UAAY,UAKZhF,WAAY,EAKZJ,aAAc,EAKdwG,cAAe,EAKfrG,UAAW,EAKXT,KAAO,aAKP4F,UAA2B,SAK3BC,UAA2B,QAKpC,gBACIF,CAAa5K,IACf1G,KAAK0S,cAAgBhM,EACvB,CACA,gBAAI4K,GACF,MAAO,CAACtR,KAAK0S,cAAe,yBAAyB7I,KAAK,IAC5D,CACQ6I,cAAgB,GAEWC,YAAc3S,KAAK8Q,UAKtD,kBACI8B,GACF,OAAO5S,KAAKqM,SACd,CAKA,iBACIwG,GACF,OAAO7S,KAAKoM,QACd,CAKA,mBACI0G,GACF,OAAO9S,KAAKwS,UACd,CAEA,mBAAIO,GACF,MAAMC,GAAKhT,KAAK8R,MAAMmB,cACtB,OAA0B,IAAtBjT,KAAKyS,cACHO,GAAGE,aAAeF,GAAGG,YAK7B,CAEA,wBAAIC,GACF,OAA2C,IAAvCpT,KAAK8R,MAAMmB,cAAcI,SAI/B,CAEA,wBAAIC,GACF,MAAMN,GAAKhT,KAAK8R,MAAMmB,cACtB,QAAID,GAAGK,WAAaL,GAAGG,aAAeH,GAAGE,aAI3C,CAEA,aAAIK,GACF,OAAOvT,KAAKgS,aAAawB,aAAeC,KAAMC,OAChD,CAEA3T,YACS8R,GACCC,GACAC,GACDC,IAHAhS,KAAA6R,WACC7R,KAAA8R,SACA9R,KAAA+R,SACD/R,KAAAgS,eACN,CAKH2B,YAAYC,IACV,MAAM1D,GAAQ0D,GAAQ1D,MAClBA,IAASA,GAAM2D,eAAiB3D,GAAM4D,qBACnB9R,IAAjBhC,KAAKmS,SACPnS,KAAKmS,QAAQ4B,UAEf/T,KAAKmS,QAAU,IAAI6B,KAAmBhU,KAAKkQ,MAAOlQ,KAAK+R,OAE3D,CAKA7D,cACElO,KAAKmS,QAAQ4B,SACf,CAMA/D,gBAAgBtE,IAEdA,GAAOa,WADMb,GAAO8B,MAAQ,GAE9B,CAEAwD,aACEhR,KAAK8R,MAAMmB,cAAcgB,SAAS,EAAG,GACvC,CAEAlE,WACE/P,KAAK8R,MAAMmB,cAAcgB,SAAS,GAAG,GACvC,8CAhOWrC,IAAkBxQ,MAAAuE,MAAAvE,gCAAAwE,MAAA,+BAAlBgM,GAAkBtD,UAAA,oBAAA4F,SAAA,EAAAC,aAAA,SAAArF,GAAAC,IAAA,EAAAD,IAAlB1N,MAAA,eAAA2N,GAAA4D,YAAAvR,CAAkB,aAAA2N,GAAA6D,eAAlBxR,CAAkB,YAAA2N,GAAA8D,cAAlBzR,CAAkB,aAAA2N,GAAA+D,s6CDyC/B1R,MApGA,EAAAgT,EAAA,YAoGAhT,CAjGC,EAAAiT,EAAA,iBAiGDjT,CAtF8D,EAAAkT,EAAA,YAsF9DlT,CAjDC,EAAAmT,EAAA,cAiDDnT,CArC4C,EAAAoT,EAAA,yBA9DzCpT,MAAA,OAAA2N,GAAAgE,iBAAAhE,GAAAqE,sBAAArE,GAAAwE,WAaQnS,cAAA,OAAA2N,GAAAwD,OAAAxD,GAAAkD,cAAAhH,MAmCR7J,cAAA,OAAA2N,GAAAgE,iBAAAhE,GAAAuE,sBAAAvE,GAAAwE,WAcGnS,cAAA,OAAA2N,GAAAwD,OAAAxD,GAAAkD,cAAA/G,SAsCH9J,cAAA,OAAA2N,GAAAwD,OAAAxD,GAAAkD,cAAA9G,yBCvDCgE,KACAI,KAAe1J,KACfwJ,KAAgBvJ,KAChB0J,KAAazJ,KACbqJ,KAAapJ,UACb0G,EACA+H,KACAC,KAAaC,UACbC,KAAaC,KACbnF,KACAC,KAAiBmF,MAAAjF,OAAA,gmDAAAC,gBAAA,WAGR8B,EAAkB,iFC9CxB,IAAMmD,EAAqB,MAA5B,MAAOA,EA0DS/B,GAzDpB,mBACIgC,CAAgBtO,GAClB1G,KAAKiV,KAAO,oHACiGvO,qBAE7G1G,KAAKkV,YACP,CACQD,KAER,kBACIE,CAAezO,GACjB1G,KAAKoV,OAAS1O,EACd1G,KAAKqV,cACP,CACQD,QAAS,EAEjB,oBACIE,CAAiB5O,GACnB1G,KAAKmN,SAAWzG,EAChB1G,KAAKuV,gBACP,CACQpI,UAAW,EAEnB,2BACIqI,CAAwB9O,GAC1B1G,KAAKyV,aAAe/O,EACpB1G,KAAK0V,aACP,CACQD,cAAe,EAEvB,2BACIE,CAAwBjP,GAC1B1G,KAAK4V,aAAelP,EACpB1G,KAAK0V,aACP,CACQE,cAAe,EAEvB,oBACIC,CAAiBnP,GACnB1G,KAAKuL,MAAQ7E,EACb1G,KAAK0V,aACP,CACQnK,MAER,8BACIuK,CAA2BpP,GAC7B1G,KAAK+V,gBAAkBrP,EACvB1G,KAAK0V,aACP,CACQK,gBAER,SAAIC,GACF,OAAOhW,KAAKgT,GAAGC,cAAcgD,cAAc,qBAC7C,CAEQC,cAERnW,YAAoBiT,GAAAhT,KAAAgT,IAAiB,CAErCzF,WACEvN,KAAKgW,MAAMG,MAAMC,WAAa,SAC9BpW,KAAKgW,MAAMG,MAAME,eAAiB,SAElCrW,KAAKqV,eACLrV,KAAK0V,cACL1V,KAAKkV,YACP,CAEQA,aACDlV,KAAKgW,QAGVhW,KAAKgW,MAAMM,UAAY,GACnBtW,KAAKiV,OACPjV,KAAKgW,MAAMM,UAAYtW,KAAKiV,MAEhC,CACQS,cACD1V,KAAKgW,QAINhW,KAAKuL,OAASvL,KAAK+V,iBACrB/V,KAAKgW,MAAMG,MAAM5K,MAAQvL,KAAKuL,MAAQvL,KAAKuL,MAAQ,GACnDvL,KAAKgW,MAAMG,MAAMI,WAAavW,KAAK+V,gBAC/B/V,KAAK+V,gBACL,IACK/V,KAAK4V,aACV5V,KAAKyV,cACPzV,KAAKgW,MAAMG,MAAM5K,MAAQ,eACzBvL,KAAKgW,MAAMG,MAAMI,WAAa,SAE9BvW,KAAKgW,MAAMG,MAAM5K,MAAQ,GACzBvL,KAAKgW,MAAMG,MAAMI,WAAa,gBAEtBvW,KAAK4V,eACX5V,KAAKyV,cACPzV,KAAKgW,MAAMG,MAAM5K,MAAQhE,OACtBiP,iBAAiBxW,KAAKgW,MAAO,MAC7BS,iBAAiB,oBACpBzW,KAAKgW,MAAMG,MAAMI,WAAa,SAE9BvW,KAAKgW,MAAMG,MAAM5K,MAAQ,GACzBvL,KAAKgW,MAAMG,MAAMI,WAAa,KAGlCvW,KAAKkW,cAAgBlW,KAAKgW,MAAMG,MAAM5K,MACtCvL,KAAKuV,iBACP,CAEQF,eACDrV,KAAKgW,QAGVhW,KAAKgW,MAAMG,MAAMlI,QAAUjO,KAAKoV,OAAS,OAAS,OACpD,CAEQG,kBACDvV,KAAKgW,QAAUhW,KAAKyV,eAGrBzV,KAAKmN,UACPnN,KAAKkW,cAAgBlW,KAAKgW,MAAMG,MAAM5K,MACtCvL,KAAKgW,MAAMG,MAAM5K,MAAQ,WAEzBvL,KAAKgW,MAAMG,MAAM5K,MAAQvL,KAAKkW,cAElC,4CAhIWnB,GAAqB3T,aAAA,+BAArB2T,EAAqBzG,UAAA,4BAAAC,OAAA,CAAAyG,gBAAA,kBAAAG,eAAA,iBAAAG,iBAAA,mBAAAE,wBAAA,0BAAAG,wBAAA,0BAAAE,iBAAA,mBAAAC,2BAAA,8BAAArH,YAAA,EAAAlE,SAAA,CAAAnJ,MAFrB,CAACoO,iBAEDuF,CAAqB,gFCC3B,IAAM2B,EAAiB,MAAxB,MAAOA,EA6BDC,SACA3D,GA7BV,UACI4D,GACF,OAAO5W,KAAK6W,OACd,CACA,UAAID,CAAOlQ,GACT1G,KAAK6W,QAAUnQ,CACjB,CACQmQ,QAER,aACI/F,GACF,OAAO9Q,KAAK8W,UACd,CACA,aAAIhG,CAAUA,GACZA,EAAY9Q,KAAK+W,iBAAmB/W,KAAKgX,eACzChX,KAAK8W,WAAahG,EAClB9Q,KAAKiX,OAAO7I,KAAK0C,EACnB,CACQgG,YAAa,EAEXG,OAAgC,IAAI3J,MAG9C4J,QACElX,KAAK8Q,WAAa9Q,KAAK8Q,SACzB,CAEA/Q,YACU4W,EACA3D,GADAhT,KAAA2W,WACA3W,KAAAgT,IACP,CAEK+D,iBACN/W,KAAK2W,SAASQ,SAASnX,KAAK4W,OAAQ,iBACpC5W,KAAK2W,SAASQ,SAASnX,KAAKgT,GAAGC,cAAe,YAChD,CAEQ+D,eACNhX,KAAK2W,SAASS,YAAYpX,KAAK4W,OAAQ,iBACvC5W,KAAK2W,SAASS,YAAYpX,KAAKgT,GAAGC,cAAe,YACnD,4CAzCWyD,GAAiBtV,0BAAA,+BAAjBsV,EAAiBpI,UAAA,wBAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAjB1N,MAAA,0BAAA2N,EAAAmI,OAAO,oGAAPR,CAAiB,6CCDvB,IAAMW,EAAoB,MAA3B,MAAOA,EACX,SACIzL,GACF,OAAO5L,KAAKsX,MACd,CACA,SAAI1L,CAAMlF,GACR1G,KAAKsX,OAAS5Q,CAChB,CACQ4Q,OAAS,GAEjB,aACIxG,GACF,OAAO9Q,KAAK8W,UACd,CACA,aAAIhG,CAAUpK,GACZ1G,KAAK8W,WAAapQ,EAClB1G,KAAKiX,OAAO7I,KAAK1H,EACnB,CACQoQ,YAAa,EAEXG,OAAgC,IAAI3J,iDApBnC+J,EAAoB,+BAApBA,EAAoB/I,UAAA,sBAAAC,OAAA,CAAA3C,MAAA,QAAAkF,UAAA,aAAAtC,QAAA,CAAAyI,OAAA,UAAAxI,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAAC,EAAA9I,MAAA,EAAAC,KAAA,EAAAC,OAAA,iIAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,yBCZ/B1N,MADF,kBACEA,CADa,gBAOXA,MAAA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAA+B,UAAA2G,EAAA,GAEArW,MAAA,mBACFA,QACAA,MAAA,YAAuBA,MAAA,GACzBA,UAEAA,MAAA,gBACEA,MAAA,GACFA,iCAXIA,QACAA,MADA,SAAAsW,EACAtW,CADkB,YAAA2N,EAAA+B,WAMG1P,MAAA,GAAAA,MAAA2N,EAAAnD,uBDAbwD,KAAazJ,eAAE6J,KAAa5J,KAAE8Q,GAAiB7G,OAAA,+KAE9CwH,CAAoB,4HEW1B,IAAMM,EAAsB,MAA7B,MAAOA,EAMQC,UALZC,eACAC,SAAmB,iCACnBC,YAAsB,sCACtBC,UAAoB,qCAE3BjY,YAAmB6X,GAAA5X,KAAA4X,WAAkD,4CAN1DD,GAAsBvW,MAAAuE,MAAA,+BAAtBgS,EAAsBrJ,UAAA,yBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0MAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICxBnC1N,MAAA,UACEA,MAAA,wBACFA,QACAA,MAAA,WACEA,MAAA,wBACFA,QAEEA,MADF,UACEA,CADsB,cACoBA,MAAA,0BAAS2N,EAAA6I,UAAAK,OAAgB,EAAK,GACtE7W,MAAA,wBACFA,QACAA,MAAA,eAAwBA,MAAA,0BAAS2N,EAAA6I,UAAAK,OAAgB,EAAM,GACrD7W,MAAA,0BAEJA,iBAZEA,cAAA,IAAAA,MAAA,IAAA2N,EAAA+I,UAAA,MAGA1W,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAA2N,EAAA8I,gBAAA,MAIEzW,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAA2N,EAAAgJ,aAAA,KAGA3W,MAAA,GAAAA,MAAA,IAAAA,MAAA,MAAA2N,EAAAiJ,WAAA,qBDMAE,KACAC,KACAC,KACA7I,KAAe3J,KACf+J,KAAiB9J,MAAAgK,OAAA,4KAGR8H,CAAsB,KEftBU,EAAoB,MAA3B,MAAOA,EACSC,OAApBvY,YAAoBuY,GAAAtY,KAAAsY,QAAoB,CAEjCC,KACLC,EACA3Y,GAEA,MAAM4Y,EAAiC,CACrC7M,MAAO,iCACP8M,WAAW,KACR7Y,GAEC+X,EAAY5X,KAAKsY,OAAOC,KAAKZ,EAAwB,CACzDgB,cAAc,IAEhBf,SAAUgB,kBAAkBf,eAAiBW,EAC7CZ,EAAUgB,kBAAkBd,SAAWW,EAAS7M,MAC5C6M,EAASC,YACXd,EAAUgB,kBAAkBb,YAAc,+BAC1CH,EAAUgB,kBAAkBZ,UAAY,+BAEnCJ,EAAUiB,aACnB,4CAtBWR,GAAoBjX,MAAAuE,MAAA,iCAApB0S,EAAoBhX,QAApBgX,EAAoB/W,UAAAC,WADP,gBACb8W,CAAoB,KCCpBS,EAAsB,MAA7B,MAAOA,EAIX,cAAOC,GACL,MAAO,CACLC,SAAUF,EACVtO,UAAW,GAEf,4CATWsO,EAAsB,8BAAtBA,sCAFA,CAACT,GAAqBY,QAAA,CAFvBtB,YAICmB,CAAsB,2FCH5B,IAAMI,EAAgB,MAAvB,MAAOA,EACSC,WAApBpZ,YAAoBoZ,GAAAnZ,KAAAmZ,YAA2B,CAC/CC,UAAUC,GACR,OAAOrZ,KAAKmZ,WAAWG,wBAAwBD,EACjD,4CAJWH,GAAgB9X,MAAAuE,KAAA,wDAAhBuT,EAAgBK,MAAA,EAAA9K,YAAA,WAAhByK,CAAgB,KCIhBM,EAAmB,MAA1B,MAAOA,EACX,QACIvE,GACF,OAAOjV,KAAKyZ,KACd,CACA,QAAIxE,CAAKvO,GACP1G,KAAKyZ,MAAQ/S,CACf,CACQ+S,MAAQ,GAEhB1Z,cAAe,4CAVJyZ,EAAmB,+BAAnBA,EAAmBlL,UAAA,sBAAAC,OAAA,CAAA0G,KAAA,QAAAxG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICXhC1N,MAAA,yCAAyBA,MAAA,YAAAA,MAAA,IAAA2N,EAAAkG,MAAA7T,sBDSb8X,GAAgBrJ,OAAA,8EAEf2J,CAAmB,gFEG1B,MAAOE,EAgCSC,iBA5BZC,aAMAC,cAAgC,GAKhCjD,OAKArI,OAAiC,GAKjCuL,SAA4C,GAK5CC,YAAuD,GAE/Dha,YAAoB4Z,GAAA3Z,KAAA2Z,kBAAwC,CAO5DK,UAAUpD,GACR5W,KAAK4W,OAASA,EACd5W,KAAK4Z,aAAehD,EAAOqD,gBAAgBja,KAAK2Z,kBAChD3Z,KAAKka,aAAala,KAAKuO,QACvBvO,KAAKma,kBAAkBna,KAAK+Z,YAC9B,CAMAhG,eACsB/R,IAAhBhC,KAAK4W,QACP5W,KAAK4W,OAAO9P,aAEY9E,IAAtBhC,KAAK4Z,eACP5Z,KAAK4Z,aAAa7F,UAClB/T,KAAK4Z,kBAAe5X,GAEtBhC,KAAKoa,qBACLpa,KAAKqa,gBACP,CAMAH,aAAa3L,GAEX,GADAvO,KAAKuO,OAASA,OACYvM,IAAtBhC,KAAK4Z,aACP,OAGF,MAAMU,EAAWta,KAAK4Z,aAAaU,SACbta,KAAK2Z,iBAAiBpL,OAC9BgM,QACX7T,IACC,MAAMH,EAAMG,EAAM8T,SAElBxa,KAAKya,eAAelU,GAEpB,MAAMmU,EAAanM,EAAOhI,GACtBgI,EAAOoM,eAAepU,KACpBmU,aAAsBE,IACxB5a,KAAK6a,aAAatU,EAAKmU,GAEvB1a,KAAK8a,cAAcR,EAAU/T,EAAKmU,GAAU,GAMJ,mBAApCJ,EAAiBS,gBAC1BT,EAAiBS,gBAEtB,CAQQD,cAAcR,EAAa/T,EAAaG,GAE9C,GAAIA,IADiB4T,EAAS/T,GAE5B,OAGF,MAAMyU,EAAYxU,OAAOyU,eAAeX,GAClCY,EAAa1U,OAAO2U,yBAAyBH,EAAWzU,QAC3CvE,IAAfkZ,QAA+ClZ,IAAnBkZ,EAAW7a,IACzC6a,EAAW7a,IAAI+a,KAAKd,EAAU5T,GAE9B4T,EAAS/T,GAAOG,CAEpB,CAMAyT,kBAAkBJ,GAEhB,GADA/Z,KAAK+Z,YAAcA,OACO/X,IAAtBhC,KAAK4Z,aACP,OAGF,MAAMU,EAAWta,KAAK4Z,aAAaU,SACRta,KAAK2Z,iBAAiBnL,QAC9B+L,QAChB7T,IACC,MAAMH,EAAMG,EAAM8T,SAClB,GAAIT,EAAYY,eAAepU,GAAM,CACnC,MAAM8U,EAAUf,EAAS/T,GACnB+U,EAAavB,EAAYxT,GAC3BgV,MAAMC,QAAQF,GAChBA,EAAWf,QAASkB,IAClBzb,KAAK6Z,cAAcvS,KAAK+T,EAAQxY,UAAU4Y,GAAY,GAGxDzb,KAAK6Z,cAAcvS,KAAK+T,EAAQxY,UAAUyY,GAE9C,GAGN,CAQQT,aAAatU,EAAamV,GAChC1b,KAAK8Z,SAASvT,GAAOmV,EAAW7Y,UAAW6D,IACzC,MAAM4T,EAAWta,KAAK4Z,aAAaU,SACnCta,KAAK8a,cAAcR,EAAU/T,EAAKG,GAEc,mBAApC4T,EAAiBS,gBAC1BT,EAAiBS,gBAAc,EAGtC,CAMQN,eAAelU,QACMvE,IAAvBhC,KAAK8Z,SAASvT,KAChBvG,KAAK8Z,SAASvT,GAAK4H,cACnBnO,KAAK8Z,SAASvT,QAAOvE,EAEzB,CAKQoY,qBACN5T,OAAOmV,OAAO3b,KAAK8Z,UAAUS,QAASqB,SAC1B5Z,IAAN4Z,GACFA,EAAEzN,aAAW,GAGjBnO,KAAK8Z,SAAW,EAClB,CAKQO,iBACNra,KAAK6Z,cAAcU,QAASqB,GAAoBA,EAAEzN,eAClDnO,KAAK6Z,cAAgB,EACvB,iBCrMK,IAAMgC,EAAuB,MAA9B,MAAOA,EACSC,SAApB/b,YAAoB+b,GAAA9b,KAAA8b,UAAqC,CAOzDC,OAAOC,GACL,MAAM3a,EAAUrB,KAAK8b,SAASG,wBAAwBD,GACtD,OAAO,IAAItC,EAAsCrY,EACnD,4CAXWwa,GAAuBza,aAAA,iCAAvBya,EAAuBxa,QAAvBwa,EAAuBva,UAAAC,WAFtB,gBAEDsa,CAAuB,wDCc7B,IAAMK,EAAsB,MAA7B,MAAOA,EA6BDC,wBACApK,MA1BDqK,UAKA7N,OAAiC,GAKjCwL,YAAuD,GAKxDsC,iBAOAzF,OAER7W,YACUoc,EACApK,GADA/R,KAAAmc,0BACAnc,KAAA+R,OACP,CAQH4B,YAAYC,GACV,MAAMwI,EAAYxI,EAAQwI,UACpB7N,EAASqF,EAAQrF,OACjBwL,EAAcnG,EAAQmG,YACtBuC,EAAKC,KAAYC,qBAEvB,GAAKJ,GAAcA,EAAUvI,aAI7B,IAAIuI,EAAUvI,eAAiBuI,EAAUtI,cACvC9T,KAAKia,gBAAgBmC,EAAUvI,kBAC1B,CACL,MAAM4I,EACJlO,GAAU+N,EAAG/N,EAAOsF,cAAgB,GAAItF,EAAOuF,eAAiB,IAC5D4I,EACJ3C,GACAuC,EAAGvC,EAAYlG,cAAgB,GAAIkG,EAAYjG,eAAiB,KAErC,IAAzB2I,GACFzc,KAAKka,gBAG2B,IAA9BwC,GACF1c,KAAKma,mBAET,CACAna,KAAK+R,MAAM4K,eAAa,CAC1B,CAMAzO,cACMlO,KAAKqc,kBACPrc,KAAKqc,iBAAiBtI,SAE1B,CAMQkG,gBAAgBmC,QACQpa,IAA1BhC,KAAKqc,kBACPrc,KAAKqc,iBAAiBtI,UAExB/T,KAAKqc,iBACHD,aAAqB1C,EACjB0C,EACApc,KAAKmc,wBAAwBJ,OAAOK,GAC1Cpc,KAAK4c,iBACP,CAMQA,kBACN5c,KAAKka,eACLla,KAAKma,oBACLna,KAAKqc,iBAAiBrC,UAAUha,KAAK4W,OACvC,CAOQsD,eACNla,KAAKqc,iBAAiBnC,aAAala,KAAKuO,OAC1C,CAOQ4L,oBACNna,KAAKqc,iBAAiBlC,kBAAkBna,KAAK+Z,YAC/C,4CAxHWmC,GAAsB9a,MAAAuE,GAAAvE,aAAA,+BAAtB8a,EAAsB5N,UAAA,yBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,aAyBJgO,yOCjD/B1b,MAAA,EAAA2b,EAAA,yBAAA3b,qGDwBa8a,CAAsB,iMExB5B,IAMKc,EAAZ,SAAYA,IACVA,UAAAC,QAAA,UACAD,GAAAE,KAAA,OACAF,GAAAG,gBAAA,kBACAH,GAAAI,SAAA,WACAJ,GAAAK,KAAA,OACAL,GAAAM,YAAA,cANUN,EAOZ,CAPA,CAAYA,GAAyB,IASzBO,EAAZ,SAAYA,IACVA,UAAAC,KAAA,OACAD,GAAAE,QAAA,UACAF,GAAAG,OAAA,SAHUH,EAIZ,CAJA,CAAYA,GAAyB,IAMzBI,EAAZ,SAAYA,IACVA,UAAAC,KAAA,OACAD,GAAAE,IAAA,MACAF,GAAAG,KAAA,OAHUH,EAIZ,CAJA,CAAYA,GAAyB,eCN/B,SAAUI,EAAkBC,GAAgBC,IAChD,SAAOC,KAAEF,GAAQC,IAAUE,UAC7B,CAUM,SAAUC,EAAYJ,IAC1B,MAAMK,GAAQL,GAAeK,MAAQ,GACrC,OAAOA,GAAKnM,GAAKmM,GAAKnM,GAAK6L,EAAkBC,GAAQK,GAAKC,YAAc,KAC1E,CAQM,SAAUC,EAAeP,IAC7B,MAAMK,GAAQL,GAAeK,MAAQ,GACrC,OAAOA,GAAKzS,MACRyS,GAAKzS,MACLmS,EAAkBC,GAAQK,GAAKG,eAAiB,QACtD,CAQM,SAAUC,EAAmBT,IACjC,MAAMK,GAAQL,GAAeK,MAAQ,GACrC,OAAOA,GAAKK,UACRL,GAAKK,UACLX,EAAkBC,GAAQK,GAAKM,mBAAqB,YAC1D,CAQM,SAAUC,EAAcZ,IAC5B,MAAMK,GAAQL,GAAeK,MAAQ,GACrC,OAAOA,GAAK1S,KACR0S,GAAK1S,KACLoS,EAAkBC,GAAQK,GAAKQ,cAAgB,OACrD,CAOM,SAAUC,EAAkBd,IAEhC,OADcA,GAAeK,MAAQ,IACzBU,UAAY,CAC1B,2BClEM,MAAOC,EAmBSnf,QAZXof,MAAQ,IAAIC,IAKZC,QAAU,IAAIC,IAAoB,GAKlCC,OAETtf,YAAoBF,GAAwC,IAAxCG,KAAAH,WAClBG,KAAKqf,OAASxf,GAAQwf,OAASxf,GAAQwf,OAASjB,EAEhDpe,KAAK2C,MACP,CAKAmE,QACM9G,KAAKif,MAAMK,KAAO,IACpBtf,KAAKif,MAAMnY,QACX9G,KAAK2C,OAET,CAOAzC,IAAI8d,IACF,OAAQhe,KAAKif,MAAM/e,IAAIF,KAAKqf,OAAOrB,MAAY,EACjD,CAOA3d,IAAI2d,GAAWxN,IACbxQ,KAAKuf,QAAQ,CAACvB,IAASxN,GACzB,CAOA+O,QAAQC,GAAehP,IACrBgP,GAASjF,QAASyD,KAChBhe,KAAKif,MAAM5e,IAAIL,KAAKqf,OAAOrB,IAASxX,OAAO6H,OAAO,GAAImC,IAAM,GAE9DxQ,KAAK2C,MACP,CAOA8c,OAAOjP,IACL+K,MAAMmE,KAAK1f,KAAKif,MAAMxY,QAAQ8T,QAAShU,KACrCvG,KAAKif,MAAM5e,IAAIkG,GAAKC,OAAO6H,OAAO,GAAImC,IAAM,GAE9CxQ,KAAK2C,MACP,CAOAgd,OAAO3B,GAAWpK,GAAqBgM,IAAY,GACjD5f,KAAK6f,WAAW,CAAC7B,IAASpK,GAASgM,GACrC,CAOAC,WAAWL,GAAe5L,GAAqBgM,IAAY,GACzD,IAAkB,IAAdA,GACF,OAAO5f,KAAK8f,oBAAoBN,GAAU5L,IAG5C4L,GAASjF,QAASyD,KAChB,MAAMxN,GAAQhK,OAAO6H,OAAO,GAAIrO,KAAKE,IAAI8d,IAASpK,IAClD5T,KAAKif,MAAM5e,IAAIL,KAAKqf,OAAOrB,IAASxN,GAAK,GAE3CxQ,KAAK2C,MACP,CAOAod,QAAQ/B,GAAWvX,IACjBzG,KAAKggB,YAAY,CAAChC,IAASvX,GAC7B,CAOAuZ,YAAYR,GAAe/Y,IACzB+Y,GAASjF,QAASyD,KAChB,MAAMiC,GAAejgB,KAAKE,IAAI8d,IACxBpK,GAAUnN,GAAKyZ,OACnB,CAACC,GAAiC5Z,MAChC4Z,GAAI5Z,IAAO0Z,GAAa1Z,MAAQ,EACzB4Z,IAET,IAEIC,GAAkBpgB,KAAKqgB,eAAezM,IACtCpD,GAAQhK,OAAO6H,OAAO,GAAI4R,GAAcG,IAC9CpgB,KAAKif,MAAM5e,IAAIL,KAAKqf,OAAOrB,IAASxN,GAAK,GAE3CxQ,KAAK2C,MACP,CAOA2d,UAAU1M,IACR,MAAM2M,GAAUvgB,KAAKwgB,aACrBjF,MAAMmE,KAAKa,IAAShG,QAAShU,KAC3B,MAAMiK,GAAQhK,OAAO6H,OAAO,GAAIrO,KAAKif,MAAM/e,IAAIqG,IAAMqN,IACrD5T,KAAKif,MAAM5e,IAAIkG,GAAKiK,GAAK,GAE3BxQ,KAAK2C,MACP,CASQmd,oBAAoBN,GAAe5L,IACzC,MAAMyM,GAAiBrgB,KAAKqgB,eAAezM,IAErCnN,GAAO+Y,GAASiB,IAAKzC,IAAche,KAAKqf,OAAOrB,KACrC,IAAI0C,IAAIja,GAAKka,OAAOpF,MAAMmE,KAAK1f,KAAKwgB,gBAC5CjG,QAAShU,KACf,MAAMiK,GAAQxQ,KAAKif,MAAM/e,IAAIqG,KAAS,GAElCE,GAAKiC,QAAQnC,KAAQ,EACvBvG,KAAKif,MAAM5e,IAAIkG,GAAKC,OAAO6H,OAAO,GAAImC,GAAOoD,MAYxB,IARApN,OAAOC,KAAK4Z,IAAgBO,KAC9CC,SAEwB7e,IAArBwO,GAAMqQ,KACNrQ,GAAMqQ,MAAeR,GAAeQ,MAKxC7gB,KAAKif,MAAM5e,IAAIkG,GAAKC,OAAO6H,OAAO,GAAImC,GAAO6P,IAAe,GAKlErgB,KAAK2C,MACP,CAQQ0d,eAAezM,IACrB,OAAOpN,OAAOsa,QAAQlN,IAASsM,OAC7B,CAACG,GAA4BU,MAC3B,MAAOF,GAAWna,IAASqa,GAC3B,MAAqB,kBAAVra,KACR2Z,GAA0BQ,KAAcna,IAEpC2Z,IAET,GAEJ,CAMQG,aACN,MAAMQ,GAAYzF,MAAMmE,KAAK1f,KAAKH,SAASof,OAAOxY,QAAU,IAC5D,OAAO,IAAIia,IAAInF,MAAMmE,KAAK1f,KAAKif,MAAMxY,QAAQka,OAAOK,IACtD,CAKQre,OACN3C,KAAKmf,QAAQxc,MACf,6DCtNI,MAAOse,GA6ESC,QAzEXC,QAAU,IAAIpf,IAAqB,IAKpCqf,SAKAC,QAAS,EAKTC,MAA4B,GAK5BC,QAAU,IAAIxf,SAAgBC,GAK9Bwf,SAAkD,IAAIzf,IAC5D,IAMM0f,YAA+C,IAAIvC,IAKnDwC,MAAQ,IAAI3f,SAAgBC,GAKpC,UAAIqd,GACF,OAAOrf,KAAK2hB,QAAQjb,KACtB,CACQib,QAA6C,IAAI5f,SACvDC,GAMO4f,OAAS,IAAI7f,IAAwB,GAC9C,SAAI8f,GACF,OAAO7hB,KAAK4hB,OAAOlb,KACrB,CAKSob,OAAS,IAAI/f,KAAyB,GAC/C,SAAIqO,GACF,OAAOpQ,KAAK8hB,OAAOpb,KACrB,CAKA,SAAIuY,GACF,OAAOjf,KAAK+hB,MACd,CACQA,OAERhiB,YAAoBmhB,IAAAlhB,KAAAkhB,UAAgC,CAOpDhhB,IAAIqG,IACF,QAAoBvE,IAAhBhC,KAAK+hB,OACP,MAAM,IAAIC,MACR,kEAGJ,OAAOhiB,KAAKif,MAAM/e,IAAIqG,GACxB,CAMA0b,MACE,OAAOjiB,KAAKmhB,QAAQza,KACtB,CAMAgK,OACE,OAAO1Q,KAAKmhB,OACd,CAMAe,QAAQC,IACN,OAAOniB,KAAKmhB,QAAQza,MAAM0b,KAAKD,GACjC,CAMAE,SAASF,IACP,OAAOniB,KAAKmhB,QAAQpd,QAAK0c,KAAK9E,IAAgBA,GAAOyG,KAAKD,KAC5D,CAMAG,OAAOH,IACL,OAAOniB,KAAKmhB,QAAQza,MAAMgD,OAAOyY,GACnC,CAMAI,QAAQJ,IACN,OAAOniB,KAAKmhB,QAAQpd,QAAK0c,KAAK9E,IAAgBA,GAAOjS,OAAOyY,KAC9D,CAKArb,QACE9G,KAAK0J,YAAO1H,GACZhC,KAAKwiB,UAAKxgB,EACZ,CAEA+R,eACwB/R,IAAlBhC,KAAKohB,UACPphB,KAAKohB,SAASjT,cAEhBnO,KAAK8G,OACP,CAOA2b,YAAYpD,IACV,OAAArf,KAAK+hB,OAAS,IAAI7C,IAClBlf,KAAK2hB,QAAQhf,KAAK0c,IACXrf,IACT,CAOA6J,KAAKsY,IACH,IAAoB,IAAhBniB,KAAKqhB,OACP,MAAM,IAAIW,MACR,qEAGJ,OAAAhiB,KAAKshB,MAAMha,KAAK6a,IACTniB,IACT,CAOA0J,OAAOyY,IACL,OAAAniB,KAAKuhB,QAAQ5e,KAAKwf,IACXniB,IACT,CAMA0iB,UAAUP,IACR,MAAMjQ,MAAKyQ,QACX,OAAA3iB,KAAKyhB,YAAYphB,IAAI6R,GAAIiQ,IACzBniB,KAAKwhB,SAAS7e,KAAK4Y,MAAMmE,KAAK1f,KAAKyhB,YAAY9F,WACxCzJ,EACT,CAMA0Q,aAAa1Q,IACXlS,KAAKyhB,YAAYzY,OAAOkJ,IACxBlS,KAAKwhB,SAAS7e,KAAK4Y,MAAMmE,KAAK1f,KAAKyhB,YAAY9F,UACjD,CAOA6G,KAAKL,IACH,OAAAniB,KAAK0hB,MAAM/e,KAAKwf,IACTniB,IACT,CAMA6iB,OACE7iB,KAAKqhB,QAAS,EAGd,MAAMyB,GAAe,CADnB9iB,KAAKshB,MAAM1X,OAAS,EAAI5J,KAAK+iB,mBAAqB/iB,KAAKgjB,aAGvDhjB,KAAKwhB,SACLxhB,KAAKuhB,QACLvhB,KAAK0hB,MACL1hB,KAAK2hB,SAGP3hB,KAAKohB,YAAW6B,KAAcH,IAC3B/e,QAAKmf,KAAK,IAAC,EAAGC,KAAa,IAC3BtgB,UAAWke,KACV,MAAOqC,GAASC,GAAS3Z,GAAQ8Y,GAAMnD,IAAU0B,GAC3CpF,GAAS3b,KAAKsjB,cAAcF,GAASC,GAAS3Z,GAAQ8Y,IAE5DxiB,KAAKujB,UAAU5H,QADkB3Z,IAAXqd,GACc,EAE1C,CAMQ2D,aACN,OAAOhjB,KAAKkhB,OACd,CAMQ6B,mBACN,MAAMS,GAAW,CACfxjB,KAAKkhB,WACL+B,KAAcjjB,KAAKshB,MAAMb,IAAK5W,IAA2BA,GAAK4Z,UAGhE,SAAOR,KAAcO,IAAUzf,QAC7B0c,KAAKM,KACH,MAAOvB,GAAUkE,IAAY3C,GAC7B,OAAOvB,GAASU,OAAO,CAACvE,GAAaqC,MACnC,MAAMtX,GAAQ1G,KAAK2jB,mBAAmB3F,GAAQ0F,IAC9C,YAAc1hB,IAAV0E,IACFiV,GAAOrU,KAAKZ,IAEPiV,IACN,GAAE,GAGX,CAMQgI,mBAAmB3F,GAAW0F,IACpC,IAAIhd,GAAQsX,GACR4F,GAAY,EAChB,UAAiB5hB,IAAV0E,IAAuBkd,GAAY5jB,KAAKshB,MAAM1X,QACnDlD,GAAQ1G,KAAKshB,MAAMsC,IAAW1D,OAAOxZ,GAAOgd,GAASE,KACrDA,IAAa,EAEf,OAAOld,EACT,CAUQ4c,cACN3H,GACA0H,GACA3Z,GACA8Y,IAEA7G,UAASA,GAAOkI,MAAM,GACtBlI,GAAS3b,KAAK8jB,aAAanI,GAAQ0H,GAAQ1C,OAAO,CAACjX,MAC1C1J,KAAK+jB,WAAWpI,GAAQ6G,GAEnC,CAQQsB,aAAanI,GAAaqI,IAChC,OAAuB,IAAnBA,GAAQpa,OACH+R,GAGFA,GAAOjS,OAAQhD,IACbsd,GACJta,OAAQyY,SAA0CngB,IAAXmgB,IACvC8B,MAAO9B,IAA+BA,GAAOzb,KAEpD,CAQQqd,WAAWpI,GAAawG,IAC9B,YAAengB,IAAXmgB,GACKxG,GAEFA,GAAO6G,KAAK,CAAC0B,GAAOC,KAClB5H,KAAY6H,eACjBjC,GAAOkC,cAAcH,IACrB/B,GAAOkC,cAAcF,IACrBhC,GAAOmC,UACPnC,GAAOoC,YAGb,CAOQhB,UAAU5H,GAAa6I,KACP,IAAlBA,KACFxkB,KAAK+hB,OAAS/hB,KAAKwkB,cAAc7I,KAGnC3b,KAAKmhB,QAAQxe,KAAKgZ,IAElB,MAAMkG,GAAQlG,GAAO/R,OACfwG,GAAkB,IAAVyR,GACd7hB,KAAK4hB,OAAOjf,KAAKkf,IACjB7hB,KAAK8hB,OAAOnf,KAAKyN,GACnB,CAOQoU,cAAc7I,IACpB,MAAMmF,GAAUnF,GAAO8E,IAAK/Z,IAAa,CAAC1G,KAAKqf,OAAO3Y,IAAQA,KAC9D,OAAO,IAAIwY,IAAI4B,GACjB,ECzXI,MAAOzV,EAOFoZ,UAAY,IAAI1iB,IAAqB,IAKrC6f,OAAS,IAAI7f,IAAwB,GAC9C,SAAI8f,GACF,OAAO7hB,KAAK4hB,OAAOlb,KACrB,CAKSob,OAAS,IAAI/f,KAAyB,GAC/C,SAAIqO,GACF,OAAOpQ,KAAK8hB,OAAOpb,KACrB,CAKS8J,MAKAL,KAKAuU,UAKArF,OAKAsF,YAKT,SAAI1F,GACF,OAAOjf,KAAK+hB,MACd,CACQA,OAKR,YAAI6C,GACF,OAAO5kB,KAAK6kB,SACd,CACQA,WAAqB,EAKrBC,WAAoC,GAE5C/kB,YAAYyf,GAAe3f,GAA8B,IACvDG,KAAKqf,OAASxf,GAAQwf,OAASxf,GAAQwf,OAASjB,EAChDpe,KAAK2kB,YAAc9kB,GAAQ8kB,YACvB9kB,GAAQ8kB,YACR5G,EAEJ/d,KAAKwQ,MAAQxQ,KAAK+kB,qBAClB/kB,KAAKmQ,KAAOnQ,KAAKglB,iBACjBhlB,KAAK0kB,UAAY1kB,KAAKilB,kBAEtBjlB,KAAKmQ,KAAK0S,OACV7iB,KAAK0kB,UAAU7B,OAEXrD,GAAS5V,OAAS,EACpB5J,KAAKklB,KAAK1F,IAEVxf,KAAK+hB,OAAS/hB,KAAKwkB,cAAchF,GAErC,CAOAtf,IAAIqG,IACF,OAAOvG,KAAKif,MAAM/e,IAAIqG,GACxB,CAMA0b,MACE,OAAOjiB,KAAKykB,UAAU/d,KACxB,CAMAwe,KAAK1F,GAAeoF,IAAoB,GACtC5kB,KAAK+hB,OAAS/hB,KAAKwkB,cAAchF,IACjCxf,KAAK6kB,UAAYD,GACjB5kB,KAAK2C,MACP,CAOAwiB,YACMnlB,KAAKif,OAASjf,KAAKif,MAAMK,KAAO,GAClCtf,KAAKif,MAAMnY,QACX9G,KAAK6kB,WAAY,EACjB7kB,KAAK2C,QACI3C,KAAKif,OACdjf,KAAKolB,aAET,CAKAte,QACE9G,KAAK0kB,UAAU5d,QACf9G,KAAKmQ,KAAKrJ,QACV9G,KAAKwQ,MAAM1J,QACX9G,KAAKmlB,WACP,CAEApR,UACE/T,KAAK0kB,UAAU3Q,UACf/T,KAAKmQ,KAAK4D,UACV/T,KAAK8G,OACP,CAMAue,OAAOrH,IACLhe,KAAKslB,WAAW,CAACtH,IACnB,CAMAsH,WAAW9F,IACTA,GAASjF,QAASyD,IAChBhe,KAAKif,MAAM5e,IAAIL,KAAKqf,OAAOrB,IAASA,KAEtChe,KAAK6kB,WAAY,EACjB7kB,KAAK2C,MACP,CAMAgd,OAAO3B,IACLhe,KAAK6f,WAAW,CAAC7B,IACnB,CAMA6B,WAAWL,IACTA,GAASjF,QAASyD,IAChBhe,KAAKif,MAAM5e,IAAIL,KAAKqf,OAAOrB,IAASA,KAEtChe,KAAK6kB,WAAY,EACjB7kB,KAAK2C,MACP,CAOA4iB,YACEC,GACAC,IAAoB,GAOpB,QAAyBzjB,IALAhC,KAAK8kB,WAAW1C,KACtCsD,IACQF,GAASzlB,cAAgB2lB,GAAU3lB,aAI5C,MAAM,IAAIiiB,MACR,+DAIJ,OAAAhiB,KAAK8kB,WAAWxd,KAAKke,IACrBA,GAASG,UAAU3lB,OAEF,IAAbylB,IACFD,GAASC,WAGJzlB,IACT,CAOA4lB,eAAeJ,IACb,MAAMvG,GAAQjf,KAAK8kB,WAAWpc,QAAQ8c,IACtC,OAAIvG,IAAS,IACXjf,KAAK8kB,WAAWe,OAAO5G,GAAO,GAC9BuG,GAASM,YAAY9lB,OAEhBA,IACT,CAOA+lB,kBAAkBviB,IAChB,OAAOxD,KAAK8kB,WAAW1C,KAAMoD,IACpBA,cAAoBhiB,GAE/B,CAMAwiB,uBAAuBxiB,IACrB,MAAMgiB,GAAWxlB,KAAK+lB,kBAAkBviB,SACvBxB,IAAbwjB,IACFA,GAASC,UAEb,CAMAQ,yBAAyBziB,IACvB,MAAMgiB,GAAWxlB,KAAK+lB,kBAAkBviB,SACvBxB,IAAbwjB,IACFA,GAASU,YAEb,CAMAld,OAAOgV,IACLhe,KAAKmmB,WAAW,CAACnI,IACnB,CAMAmI,WAAW3G,IACTA,GAASjF,QAASyD,IAAche,KAAKif,MAAMjW,OAAOhJ,KAAKqf,OAAOrB,MAC9Dhe,KAAK6kB,WAAY,EACjB7kB,KAAK2C,MACP,CAOQ6hB,cAAchF,IACpB,MAAMsB,GAAUtB,GAASiB,IAAKzC,IAAc,CAAChe,KAAKqf,OAAOrB,IAASA,KAClE,OAAO,IAAIkB,IAAI4B,GACjB,CAKQne,OACN3C,KAAKykB,UAAU9hB,KAAK4Y,MAAMmE,KAAK1f,KAAKif,MAAMtD,WAC1C3b,KAAKolB,aACP,CAKQA,cACN,MAAMvD,GAAQ7hB,KAAKif,MAAMK,KACnBlP,GAAkB,IAAVyR,GACd7hB,KAAK4hB,OAAOjf,KAAKkf,IACjB7hB,KAAK8hB,OAAOnf,KAAKyN,GACnB,CAMQ2U,qBACN,OAAO,IAAI/F,EAAyB,CAClCK,OAAQrf,KAAKqf,OACbJ,MAAOjf,KAAKif,OAEhB,CAMQ+F,iBACN,OAAO,IAAI/D,GAAcjhB,KAAKykB,UAChC,CAMQQ,kBACN,OAAO,IAAIhE,GAAkCjhB,KAAKmQ,KAAKO,QACpD7G,KAAK,CACJ4Z,OAAQzjB,KAAKwQ,MAAM2O,QACnBe,OAASlC,KACP,MAAMzX,GAAMvG,KAAKqf,OAAOrB,IAClBxN,GAAQxQ,KAAKwQ,MAAMtQ,IAAI8d,IACvBoI,GAAgBpmB,KAAK0kB,UAAUxkB,IAAIqG,IAEzC,QACoBvE,IAAlBokB,IACAA,GAAcpI,SAAWA,IACzBhe,KAAKqmB,iBAAiBD,GAAc5V,MAAOA,IAE3C,OAAO4V,GAGT,MAAMrH,GAAWqH,GAAgBA,GAAcrH,SAAW,EAAI,EAE9D,MAAO,CAAEf,UAAQxN,SAAOuO,YAAUuH,IADtB,GAAG/f,MAAOwY,KACe,IAGxC0D,YAAa8D,IAA+BvmB,KAAKqf,OAAOkH,GAAOvI,QACpE,CAEQqI,iBAAiBpG,GAAiBuG,IACxC,GAAIvG,KAAiBuG,GACnB,OAAO,EAGT,MAAMC,GAA2D,IAArCjgB,OAAOC,KAAKwZ,IAAcrW,OAChD8c,GAAmD,IAAjClgB,OAAOC,KAAK+f,IAAU5c,OAC9C,OAAO6c,IAAuBC,EAChC,EC3WI,MAAO1S,EAIHjC,MAKA7B,MAKAyW,gBAAkB,IAAIzH,IAKtB0H,WAKAC,QAER9mB,YAAYmQ,GAAwB6B,IAClC/R,KAAK8mB,kBAAkB/U,IACvB/R,KAAK+mB,SAAS7W,GAChB,CAEA6D,UACE/T,KAAK8mB,uBAAkB9kB,GACvBhC,KAAK+mB,cAAS/kB,EAChB,CAMA+kB,SAAS7W,IACP,QAAclO,IAAVkO,GAIF,OAHAlQ,KAAKgnB,oBACLhnB,KAAK2mB,gBAAgB7f,aACrB9G,KAAKkQ,WAAQlO,GAIfhC,KAAK+mB,cAAS/kB,GACdhC,KAAKkQ,MAAQA,GACblQ,KAAKinB,iBACLjnB,KAAK2c,eACP,CAMAmK,kBAAkB/U,IAChB/R,KAAK+R,MAAQA,EACf,CAMQkV,iBACNjnB,KAAKgnB,oBAELhnB,KAAK4mB,WAAa5mB,KAAKkQ,MAAMuU,UAAU5hB,UAAW2c,IAChDxf,KAAKknB,iBAAiB1H,KAGxBxf,KAAK6mB,QAAU7mB,KAAKkQ,MAAMM,MAAM2O,QAC7Bpb,QAAKmf,KAAK,IACVrgB,UAAU,IAAM7C,KAAKmnB,gBAC1B,CAKQH,yBACkBhlB,IAApBhC,KAAK4mB,YACP5mB,KAAK4mB,WAAWzY,mBAEGnM,IAAjBhC,KAAK6mB,SACP7mB,KAAK6mB,QAAQ1Y,cAEfnO,KAAK4mB,gBAAa5kB,EAClBhC,KAAK6mB,aAAU7kB,CACjB,CAKQklB,iBAAiB1H,IACvBxf,KAAK2c,eACP,CAOQwK,gBACN,IAAIC,IAAkB,EACtB,MAAMC,GAAarnB,KAAKkQ,MAAMM,MAAMyO,MAC9BqI,GAAatnB,KAAK2mB,gBAEpBU,GAAW/H,OAASgI,GAAWhI,OACjC8H,GAAkBpnB,KAAK2c,iBAGzB,MAAMqE,GAAYzF,MAAMmE,KAAK2H,GAAW5gB,QACxC,UAAWF,MAAOya,GAAW,CAC3B,MAAMuG,GAAaF,GAAWnnB,IAAIqG,IAC5BihB,GAAaF,GAAWpnB,IAAIqG,KACV,IAApB6gB,UACiBplB,IAAfwlB,GACFJ,GAAkBpnB,KAAK2c,gBACbJ,KAAYC,qBAAqB+K,GAAYC,MACvDJ,GAAkBpnB,KAAK2c,kBAI3B3c,KAAK2mB,gBAAgBtmB,IAAIkG,GAAKC,OAAO6H,OAAO,GAAIkZ,IAClD,CACF,CAKQ5K,gBACN,YAAmB3a,IAAfhC,KAAK+R,OACP/R,KAAK+R,MAAM4K,iBAEN,CACT,ECnJI,MAAO8K,EAgBW5nB,QAXZ6nB,OAAwB,GAMlC,UAAIC,GACF,OAAO3nB,KAAK4nB,QAAQlhB,KACtB,CACSkhB,QAAoC,IAAI7lB,KAAgB,GAEjEhC,YAAsBF,GAAsC,IAAtCG,KAAAH,WACpBG,KAAKH,QAAUA,EACjB,CAMA4lB,YACsB,IAAhBzlB,KAAK2nB,QACP3nB,KAAK6nB,eAEP7nB,KAAK4nB,QAAQjlB,MAAK,GAClB3C,KAAK8nB,YACP,CAMA5B,aACElmB,KAAK4nB,QAAQjlB,MAAK,GAClB3C,KAAK6nB,cACP,CAMAlC,UAAUzV,IACJlQ,KAAK0nB,OAAOhf,QAAQwH,IAAS,GAC/BlQ,KAAK0nB,OAAOpgB,KAAK4I,GAErB,CAMA4V,YAAY5V,IACV,MAAM+O,GAAQjf,KAAK0nB,OAAOhf,QAAQwH,IAC9B+O,IAAS,GACXjf,KAAK0nB,OAAO7B,OAAO5G,GAAO,EAE9B,CAMU6I,aAAc,CAMdD,eAAgB,EC7EtB,MAAOE,UAA4CN,EACjC5nB,QAAtBE,YAAsBF,IACpBuG,MAAMvG,IADcG,KAAAH,UAEtB,CAKQwjB,QAAoC,IAAInE,IAMhDyG,UAAUzV,IACR9J,MAAMuf,UAAUzV,KACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAKgoB,YAAY9X,GAErB,CAMA4V,YAAY5V,IACV9J,MAAM0f,YAAY5V,KACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAKioB,cAAc/X,GAEvB,CAMU4X,aACR9nB,KAAKkoB,WACP,CAMUL,eACR7nB,KAAKmoB,aACP,CAKQD,YACNloB,KAAK0nB,OAAOnN,QAASrK,IAAuBlQ,KAAKgoB,YAAY9X,IAC/D,CAKQiY,cACNnoB,KAAK0nB,OAAOnN,QAASrK,IAAuBlQ,KAAKioB,cAAc/X,IACjE,CAKQ8X,YAAY9X,IAClBlQ,KAAKqjB,QAAQhjB,IACX6P,GACAA,GAAMwU,UAAUhC,UAAU1iB,KAAKH,QAAQuoB,kBAE3C,CAKQH,cAAc/X,IACpB,MAAMmY,GAAWroB,KAAKqjB,QAAQnjB,IAAIgQ,SACjBlO,IAAbqmB,KAIJnY,GAAMwU,UAAU9B,aAAayF,IAC7BroB,KAAKqjB,QAAQra,OAAOkH,IACtB,ECnFI,MAAOoY,UAA2Cb,EAI9CpE,QAAoC,IAAInE,IAMhDyG,UAAUzV,IACR9J,MAAMuf,UAAUzV,KACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAKgoB,YAAY9X,GAErB,CAMA4V,YAAY5V,IACV9J,MAAM0f,YAAY5V,KACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAKioB,cAAc/X,GAEvB,CAMU4X,aACR9nB,KAAKkoB,WACP,CAMUL,eACR7nB,KAAKmoB,aACP,CAKQD,YACNloB,KAAK0nB,OAAOnN,QAASrK,IAAuBlQ,KAAKgoB,YAAY9X,IAC/D,CAKQiY,cACNnoB,KAAK0nB,OAAOnN,QAASrK,IAAuBlQ,KAAKioB,cAAc/X,IACjE,CAKQ8X,YAAY9X,IACdlQ,KAAKqjB,QAAQkF,IAAIrY,KAOrBlQ,KAAKqjB,QAAQhjB,IAAI6P,GAAOA,GAAMwU,UAAUhC,UAHxB6D,KACmB,IAA1BA,GAAO/V,MAAMgY,UAGxB,CAKQP,cAAc/X,IACpB,MAAMmY,GAAWroB,KAAKqjB,QAAQnjB,IAAIgQ,SACjBlO,IAAbqmB,KAIJnY,GAAMwU,UAAU9B,aAAayF,IAC7BroB,KAAKqjB,QAAQra,OAAOkH,IACtB,yFCnFE9O,MAAA,kBAGGA,MAAA,GAAeA,gCADhBA,MAAA,QAAAqnB,GAAAC,YACCtnB,cAAAqnB,GAAAE,wCAEHvnB,MAAA,kBAA8DA,MAAA,oBAE5DA,gCAFiCA,MAAA,QAAAqnB,GAAAG,kBAA2BxnB,oBAAA,IAAAqnB,GAAAI,0CAI5DznB,MAAA,kBACEA,MAAA,GACFA,gDAFYA,MAAA,QAAA0nB,GAAA9K,QACV5c,cAAA,IAAAqnB,GAAAM,cAAAD,GAAA9K,QAAA,MCuBD,IAAMgL,EAAuB,MAA9B,MAAOA,GAwESjX,MAnEXkX,UAAY,IAAIlnB,SAAwBC,GAMxC6mB,WAAa,IAAI9mB,SAAwBC,GAEzC4mB,iBAAmB,CAAE1W,GAAI,oBAEzBwW,WAAa,CAAExW,GAAI,oBAKpBgX,WAKA/W,QAKCjC,MAKA6Y,cAAoCxK,EAKpCoK,eAAoB3mB,EAKpB4I,OAAiB,EAKjBue,aAAuB,MAKvBC,cAAwB,OAKxBC,YAKAlc,UAAoB,EAKnBmc,eAAiB,IAAIhc,MAE/BvN,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAM/CxE,WACEvN,KAAKmS,QAAU,IAAI6B,EAAmBhU,KAAKkQ,MAAOlQ,KAAK+R,OAEvD/R,KAAKkpB,WAAalpB,KAAKkQ,MAAMwU,UAC1BnC,QAASgE,KAA2D,IAA1BA,GAAO/V,MAAMgY,UACvD3lB,UAAW0mB,KACV,MAAM/J,GAAW+J,GAAQ9I,IACtB8F,IAAiCA,GAAOvI,QAE3Che,KAAKwpB,kBAAkBhK,GAAQ,EAErC,CAMAtR,cACElO,KAAKmS,QAAQ4B,UACb/T,KAAKkpB,WAAW/a,aAClB,CAMAsb,kBAAkBC,IAChB,MAAM/N,GAAS+N,GAAMhjB,iBAAiB6U,MAAQmO,GAAMhjB,MAAQ,CAACgjB,GAAMhjB,OAE7DijB,GAAchO,GAAOyG,KACxBwH,IAAmBA,KAAW5pB,KAAK4oB,kBAEtC,IAAIpJ,GAAW7D,GAAOjS,OACnBkgB,IAAmBA,KAAW5pB,KAAK4oB,uBAElB5mB,IAAhB2nB,KACEnK,GAAS5V,SAAW5J,KAAKkQ,MAAM2R,MACjCrC,GAAW,GACFA,GAAS5V,OAAS5J,KAAKkQ,MAAM2R,QACtCrC,GAAWxf,KAAKkQ,MAAM+R,QAI1BzC,GAAWA,GAAS9V,OAAQsU,IAAmBA,KAAWhe,KAAK0oB,YACvC,IAApBlJ,GAAS5V,OACX5J,KAAKkQ,MAAMM,MAAM8P,UAAU,CAAEkI,UAAU,IAEvCxoB,KAAKkQ,MAAMM,MAAMqP,WAAWL,GAAU,CAAEgJ,UAAU,IAAQ,GAI5DxoB,KAAKspB,eAAelb,KAAK,CAAEoa,UAAU,EAAM9hB,MAD7B1G,KAAK4K,MAAQ4U,GAAWkK,GAAMhjB,OAE9C,CAEQ8iB,kBAAkBhK,IAEtBxf,KAAKipB,UAAUtmB,MADE,IAAf3C,KAAK4K,MACa4U,GAELA,GAAS5V,OAAS,EAAI4V,GAAS,QAAKxd,GAIrDhC,KAAK6pB,8BAA8BrK,GACrC,CAEQqK,8BAA8BrK,IAElCA,GAAS5V,SAAW5J,KAAKkQ,MAAM2R,OAC/B7hB,KAAK6oB,WAAWniB,QAAU1G,KAAKopB,cAE/BppB,KAAK6oB,WAAWlmB,KAAK3C,KAAKopB,eAE1B5J,GAAS5V,OAAS5J,KAAKkQ,MAAM2R,OAC7B7hB,KAAK6oB,WAAWniB,QAAU1G,KAAKmpB,cAE/BnpB,KAAK6oB,WAAWlmB,KAAK3C,KAAKmpB,aAE9B,8CA3JWH,IAAuB5nB,aAAA,+BAAvB4nB,GAAuB1a,UAAA,0BAAAC,OAAA,CAAA2B,MAAA,QAAA6Y,cAAA,gBAAAJ,UAAA,YAAA/d,MAAA,QAAAue,aAAA,eAAAC,cAAA,gBAAAC,YAAA,cAAAlc,SAAA,YAAAqB,QAAA,CAAA8a,eAAA,kBAAA7a,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,oLAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KDxClC1N,MADF,qBACEA,CADoE,mCAMlEA,MAAA,2BAAAqW,IAAA,OAAmB1I,GAAA0a,kBAAAhS,GAAyB,GAU5CrW,MARA,EAAA0oB,EAAA,mBAQA1oB,CALG,EAAA2oB,EAAA,mBAKH3oB,CAH8D,EAAA4oB,EAAA,sCASlE5oB,kBApBIA,QAGAA,MAHA,WAAA2N,GAAA5B,SAGA/L,CAHqB,QAAAA,MAAA,IAAA2N,GAAAka,WAGrB7nB,CAF2B,WAAA2N,GAAAnE,MAE3BxJ,CADkB,cAAA2N,GAAAsa,aAKfjoB,MAAA,GAAAA,MAAA,YAAAY,IAAA+M,GAAA4Z,YAAA,IAAA5Z,GAAAnE,OAIUxJ,cAAA,YAAA2N,GAAAnE,OAGiBxJ,cAAA,UAAAA,MAAA,IAAA2N,GAAAmB,MAAAwU,UAAAhU,yBCiB9BuZ,KAAkBtkB,KAClBukB,KAAetkB,KAAAC,KACfsJ,KACAgb,KACA1V,KACA/E,MAASG,OAAA,kDAAAC,gBAAA,WAGAkZ,EAAuB,sPCT7B,IAAMoB,GAA6B,MAApC,MAAOA,GAuCDzoB,gBACAqQ,aAvCH7E,UAAoB,EACpBkd,cAAwB,EACxBC,UAAoB,EACpBC,SAAmB,GACnBC,gBAA4B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACjDC,sBAAgC,EAC/BC,QACAC,mBACAC,6BAA+C,GAE9CC,kBAA8C,IAAI9oB,KACzD,GAKOmO,MAMT4a,iBAKUC,KAEHnhB,OAAiB,EAKdohB,gBACR,IAAI1d,MAENvN,YACU4B,GACAqQ,IADAhS,KAAA2B,mBACA3B,KAAAgS,eACP,CAEwCiZ,UAE3CtX,cACE3T,KAAKqa,iBACLra,KAAK0qB,QAAU1qB,KAAKkQ,MAAMwU,UAAU9C,OAAO/e,UAAWgf,KACpD7hB,KAAK4J,OAASiY,GACd7hB,KAAKkrB,eAAa,GAEpBlrB,KAAK2qB,mBAAqB3qB,KAAK6qB,kBAAkBhoB,UAAU,KACrD7C,KAAKirB,WACPjrB,KAAKirB,UAAUE,WAAS,GAG5BnrB,KAAKorB,uBACLprB,KAAKqrB,iBACP,CAEAD,uBACEprB,KAAKmN,SAAWnN,KAAK8qB,kBAAkB3d,UAAYnN,KAAKmN,SACxDnN,KAAKsqB,UAAYtqB,KAAK8qB,kBAAkBR,WAAatqB,KAAKsqB,UAC1DtqB,KAAKuqB,SAAWvqB,KAAK8qB,kBAAkBP,UAAYvqB,KAAKuqB,SACxDvqB,KAAKwqB,gBACHxqB,KAAK8qB,kBAAkBN,iBAAmBxqB,KAAKwqB,gBAC7CxqB,KAAKgS,aAAasZ,YACpBtrB,KAAKyqB,sBAAuB,EAC5BzqB,KAAKqqB,cAAe,IAEpBrqB,KAAKyqB,qBACHzqB,KAAK8qB,kBAAkBL,sBACvBzqB,KAAKyqB,qBACPzqB,KAAKqqB,aACHrqB,KAAK8qB,kBAAkBT,cAAgBrqB,KAAKqqB,aAElD,CAEAgB,kBACErrB,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,uCACJ2C,UAAW2oB,KACVxrB,KAAKirB,UAAUQ,MAAMC,eAAiBF,MAI5CxrB,KAAKirB,UAAUQ,MAAME,cAAgB3rB,KAAK4rB,WAE1C5rB,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,0CACJ2C,UAAW2oB,KACVxrB,KAAKirB,UAAUQ,MAAMI,kBAAoBL,MAG/CxrB,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,sCACJ2C,UAAW2oB,KACVxrB,KAAKirB,UAAUQ,MAAMK,cAAgBN,MAG3CxrB,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,sCACJ2C,UAAW2oB,KACVxrB,KAAKirB,UAAUQ,MAAMM,cAAgBP,MAG3CxrB,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,0CACJ2C,UAAW2oB,KACVxrB,KAAKirB,UAAUQ,MAAMO,kBAAoBR,KAGjD,CAEAI,WAAaA,CAACb,GAAcR,GAAkB3gB,MAC5C,MAAMhG,GAA8B,IAAI7B,IAAgB,IASxD,GAPA/B,KAAK4qB,6BAA6BtjB,KAChCtH,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,2BACJ2C,UAAW2oB,KACV5nB,GAAGjB,KAAK6oB,GAAK,IAGJ,IAAX5hB,IAA6B,IAAb2gB,GAClB,MAAO,KAAK3mB,GAAG8C,SAASkD,KAG1B,MAAMqiB,GAAalB,GAAOR,GAK1B,MAAO,GAAG0B,GAAa,OAHrBA,IAHFriB,GAASsiB,KAAKC,IAAIviB,GAAQ,IAIpBsiB,KAAKE,IAAIH,GAAa1B,GAAU3gB,IAChCqiB,GAAa1B,MACuB3mB,GAAG8C,SAASkD,IAAM,EAGtDyQ,iBACNra,KAAK4qB,6BAA6BnK,IAAK4L,IAAQA,GAAIle,eAC/CnO,KAAK0qB,SACP1qB,KAAK0qB,QAAQvc,cAEXnO,KAAK2qB,oBACP3qB,KAAK2qB,mBAAmBxc,aAE5B,CAEAD,cACElO,KAAKqa,gBACP,CAEA6Q,gBACElrB,KAAKgrB,gBAAgB5c,KAAKpO,KAAKirB,UACjC,8CA7JWb,IAA6BhpB,MAAAuE,OAAAvE,MAAAwE,OAAA,+BAA7BwkB,GAA6B9b,UAAA,iCAAAuO,UAAA,SAAA/N,GAAAC,OAAA,EAAAD,UA2C7Bwd,MAAY,iaC3EzBlrB,MAAA,qBAQEA,MAAA,yBAAQ2N,GAAAmc,eAAe,GAEzB9pB,eAHEA,MANA,WAAA2N,GAAA5B,SAMA/L,CANqB,eAAA2N,GAAAsb,aAMrBjpB,CAL6B,SAAA2N,GAAAnF,OAK7BxI,CAJiB,YAAA2N,GAAAub,UAIjBlpB,CAHuB,WAAA2N,GAAAwb,SAGvBnpB,CAFqB,kBAAA2N,GAAAyb,gBAErBppB,CADmC,uBAAA2N,GAAA0b,qCDwBzB8B,MAAkB1mB,OAAAgK,OAAA,wEAAAC,gBAAA,WAEjBsa,EAA6B,oBEXnC,IAAMoC,GAAuB,MAA9B,MAAOA,GAwED7V,SACA3D,GArEVyZ,mBAAqB,gCAKrBA,sBAAwB,mCAKfC,WAAY,EAKZC,eAAyB,EAKzBC,oBAA8B,EAKvC,YACIpE,CAAS9hB,KACY,IAAnB1G,KAAK0sB,WAGLhmB,KAAU1G,KAAK6sB,YAInB7sB,KAAK8sB,eAAepmB,IACpB1G,KAAK+sB,SACP,CACA,YAAIvE,GACF,OAAOxoB,KAAK6sB,SACd,CACQA,WAAY,EAMpBG,eAA4CzP,EAA0BC,KAK5DyP,OAAS,IAAI3f,MAOvBxB,WACyB,IAAnB9L,KAAK0sB,YAA8C,IAAvB1sB,KAAK2sB,gBAIrC3sB,KAAK8sB,gBAAe,GACpB9sB,KAAKitB,OAAO7e,KAAKpO,MACnB,CAEAD,YACU4W,GACA3D,IADAhT,KAAA2W,YACA3W,KAAAgT,KACP,CAMK8Z,eAAetE,IACrBxoB,KAAK6sB,UAAYrE,IACA,IAAbA,IACFxoB,KAAKktB,OAAOV,GAAwBW,cACJ,IAA5BntB,KAAK4sB,oBACP5sB,KAAKktB,OAAOV,GAAwBY,kBAGtCptB,KAAKqtB,UAAUb,GAAwBW,aACvCntB,KAAKqtB,UAAUb,GAAwBY,gBAE3C,CAKQL,UACiB,IAAnB/sB,KAAK6sB,YAAc,EACrBS,MAAettB,KAAKgT,GAAGC,cAAe,CACpCsa,WAAY,YACZC,SAAU,SACVC,MAAO,MACPC,OAAQ,WAGd,CAKQR,OAAOS,IACb3tB,KAAK2W,SAASQ,SAASnX,KAAKgT,GAAGC,cAAe0a,GAChD,CAKQN,UAAUM,IAChB3tB,KAAK2W,SAASS,YAAYpX,KAAKgT,GAAGC,cAAe0a,GACnD,8CAvHWnB,IAAuBprB,0BAAA,+BAAvBorB,GAAuBle,UAAA,8BAAA6F,aAAA,SAAArF,GAAAC,IAAA,EAAAD,IAAvB1N,MAAA,0BAAA2N,GAAAjD,SAAS,8MAAT0gB,EAAuB,yGCR1BprB,MAAA,GACEA,MAAA,qBACEA,MAAA,kBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,MAAA,UAAAA,MAAUkK,GAAAsiB,aAAAnW,GAAAoW,SAA4B,GAMxCzsB,sDALEA,QACAA,MADA,UAAA0sB,KAAAxiB,GAAAyiB,0BAAAlQ,IACAzc,CAD4D,gBAAA0sB,KAAAxiB,GAAAyiB,0BAAAjQ,oCAJlE1c,MAAA,GACEA,MAAA,EAAA4sB,GAAA,yEAAe5sB,cAAA,OAAAA,MAAA,IAAAkK,GAAA2iB,gDAFnB7sB,MAAA,WACEA,MAAA,EAAA8sB,GAAA,uBAYF9sB,gCAZiBA,cAAA,OAAAkK,GAAA6iB,0DAcf/sB,MADF,UACEA,CADiC,qBAQ/BA,MANA,qBAAAqW,IAAArW,aAAAkP,IAAAlP,MAAAqW,GAAA2W,SAA+B3W,GAAA4W,iBAA0B,KAAI,EAM7DjtB,CAN8D,iBAAAqW,IAAA,MAAA6W,GAAAltB,MAAAkP,IAAAC,UAAAjF,GAAAlK,QAAA,OAAAA,MAAAqW,GAAA2W,SAG3C9iB,GAAAijB,kBAAkBjjB,GAAAkjB,cAAAF,GAAA/H,QAAyB+H,GAAA/H,OAAA9O,IAC3CA,GAAAgX,kBAE7B,EAAUrtB,CADC,kBAAAqW,IAAA,MAAA6W,GAAAltB,MAAAkP,IAAAC,UAAAjF,GAAAlK,QAAA,OAAAA,MACSkK,GAAAojB,YAAAjX,GAAAoW,QAAAS,GAAA/H,QAAuC,GAIrDnlB,oDAHIA,cAAA,UAAAkK,GAAAkjB,cAAAF,GAAA/H,uCAWFnlB,MAAA,WAMEA,MAAA,GACFA,2CAHEA,MAAA,aAAAutB,GAAA9gB,QAAA8gB,GAAA9gB,aAAA7L,GAEAZ,cAAA,IAAAutB,GAAA/iB,MAAA,gCAPJxK,MAAA,GACEA,MAAA,EAAAwtB,GAAA,mDAWAxtB,MAAA,WAKEA,MAAA,GACFA,2CAHEA,MAAA,aAAAutB,GAAA9gB,QAAA8gB,GAAA9gB,aAAA7L,GAEAZ,cAAA,IAAAutB,GAAA/iB,MAAA,gCANJxK,MAAA,GACEA,MAAA,EAAAytB,GAAA,mDAcIztB,MAAA,WAMEA,MAAA,GACFA,gEAHEA,MAAA,UAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAC,OAEA7tB,cAAA,IAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAtoB,MAAA,mCAcItF,MAAA,6GAGEA,MAAA,MAAAA,MAAA,IAAAA,MAAA,IAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAtoB,QAAAtF,kCAOCA,MAAA,UACEA,MAAA,wBACHA,gBADGA,cAAA,GAAAA,MAAA,gGAjBPA,MALF,UAKEA,CADD,UAKGA,MAAA,iBAAAqW,IAAArW,aAAA8tB,IAAA9tB,MAASqW,GAAAgX,kBAAwB,GAWjCrtB,MATA,EAAA+tB,GAAA,aASA/tB,CADE,EAAAguB,GAAA,yBAAAhuB,OAONA,gFAvBEA,MAAA,UAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAC,OAGE7tB,cAAA,OAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAtoB,MAAAtF,OAOGA,QAAuCA,MAAvC,OAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAK,MAAuCjuB,CAAA,WAAAkuB,kCAvBlDluB,MAAA,GASEA,MARA,EAAAmuB,GAAA,YAQAnuB,CAHC,EAAAouB,GAAA,yBAAApuB,8EAFEA,QAAwCA,MAAxC,QAAA0tB,GAAAC,SAAAJ,GAAAK,MAAAS,MAAwCruB,CAAA,WAAAsuB,+BAP/CtuB,MAAA,GAGEA,MAAA,EAAAuuB,GAAA,4DA0CEvuB,MAAA,kEAKEA,MADA,UAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAC,MACA7tB,CAD2C,YAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAtoB,MAAAtF,qCAevCA,MAAA,6GAGEA,MAAA,MAAAA,MAAA,IAAAA,MAAA,IAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAtoB,QAAAtF,kCAOCA,MAAA,UACEA,MAAA,wBACHA,gBADGA,cAAA,GAAAA,MAAA,gFAjBPA,MALF,UAKEA,CADD,UAKGA,MAAA,iBAAAqW,IAAArW,aAAAyuB,IAAAzuB,MAASqW,GAAAgX,kBAAwB,GAWjCrtB,MATA,EAAA0uB,GAAA,aASA1uB,CADE,EAAA2uB,GAAA,yBAAA3uB,OAONA,gFAvBEA,MAAA,UAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAC,OAGE7tB,cAAA,OAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAtoB,MAAAtF,OAOGA,QAAuCA,MAAvC,OAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAK,MAAuCjuB,CAAA,WAAA4uB,kCAtBlD5uB,MAAA,GAQEA,MAPA,EAAA6uB,GAAA,YAOA7uB,CADC,EAAA8uB,GAAA,yBAAA9uB,8EAHEA,QAAwCA,MAAxC,QAAAwuB,GAAAb,SAAAJ,GAAAK,MAAAS,MAAwCruB,CAAA,WAAA+uB,+BAL/C/uB,MAAA,GACEA,MAAA,EAAAgvB,GAAA,6EAkDIhvB,MAAA,YACEA,MAAA,8BAIAA,MAAA,cAKEA,MAAA,sBAAAqW,IAAArW,MAAAivB,IAAA,MAAAC,GAAAlvB,MAAA,GAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MAAckK,GAAAilB,aAAA5B,GAAAK,KAAAsB,GAAA/J,OAAA9O,IAA6C,GAL7DrW,QAOAA,MAAA,2BACFA,+EAVIA,cAAA,MAAAovB,IAMApvB,cAAA,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OADAtF,MADA,gBAAAovB,GACApvB,CADwB,kBAAAutB,GAAAK,oDAO5B5tB,MAAA,cAQEA,MAFA,iBAAAqW,IAAArW,MAAAqvB,IAAA,MAAA9B,GAAAvtB,MAAA,GAAAmP,UAAA,OAAAnP,MAASutB,GAAA+B,QAAAjZ,IAAsB,EAE/BrW,CAFgC,oBAAAqW,IAAArW,MAAAqvB,IAAA,MAAA9B,GAAAvtB,MAAA,GAAAmP,UAAA,OAAAnP,MACpButB,GAAAgC,SAAAlZ,IAAuB,EACnCrW,CADoC,gBAAAqW,IAAArW,MAAAqvB,IAAA,MAAA9B,GAAAvtB,MAAA,GAAAmP,UAAA,OAAAnP,MAC5ButB,GAAAiC,OAAAnZ,IAAqB,GAR/BrW,6CAIEA,MAAA,kBAAAutB,GAAAK,oDAMF5tB,MAAA,cAQEA,MAAA,iBAAAqW,IAAArW,MAAAyvB,IAAA,MAAAP,GAAAlvB,MAAA,GAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MAASkK,GAAAwlB,cAAAnC,GAAAK,KAAAsB,GAAA/J,OAAA9O,IAA8C,GARzDrW,8EAMEA,MAAA,OAAAutB,GAAAoC,MACA3vB,MAAA,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OAEAtF,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,aACAvtB,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,cAGAvtB,MAAA,MAAAkK,GAAA0lB,4BAAArC,GAAA,aACAvtB,MAAA,MAAAkK,GAAA0lB,4BAAArC,GAAA,aATAvtB,MAAA,kBAAAutB,GAAAK,oDAWF5tB,MAAA,cAMEA,MAAA,iBAAAqW,IAAArW,MAAA6vB,IAAA,MAAAX,GAAAlvB,MAAA,GAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MAASkK,GAAAwlB,cAAAnC,GAAAK,KAAAsB,GAAA/J,OAAA9O,IAA8C,GANzDrW,8EAKEA,MAAA,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OAEAtF,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,aACAvtB,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,cAJAvtB,MAAA,kBAAAutB,GAAAK,oDAQF5tB,MAAA,qBAIEA,MAAA,kBAAAqW,IAAArW,MAAA8vB,IAAA,MAAAZ,GAAAlvB,MAAA,GAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MAAUkK,GAAA6lB,qBAAAxC,GAAAK,KAAAsB,GAAA/J,OAAA9O,IAAqD,GAChErW,mEAFCA,MADA,kBAAAutB,GAAAK,KACA5tB,CAD+B,UAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,qCAgB/BtF,MAAA,mBAKEA,MAAA,GACFA,qCAHEA,MADA,QAAAgwB,GAAAlf,GACA9Q,CADmB,WAAAgwB,GAAAjkB,UAGnB/L,cAAA,IAAAgwB,GAAA1qB,MAAA,mDAjBJtF,MAAA,mBAOEA,MAAA,2BAAAqW,IAAArW,MAAAiwB,IAAA,MAAAf,GAAAlvB,MAAA,GAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MACqBkK,GAAAgmB,oBAAA3C,GAAAK,KAAAsB,GAAA/J,OAAA9O,IAErC,GAEgBrW,MAAA,EAAAmwB,GAAA,qBAOFnwB,8EAjBEA,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,cAQAvtB,MALA,kBAAAutB,GAAAK,KAKA5tB,CAL+B,WAAAutB,GAAA6C,SAK/BpwB,CAJ4B,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OAOPtF,cAAA,UAAAutB,GAAA8C,2CAOvBrwB,MAAA,oGAMEA,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,cAGAvtB,MAAA,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OACAtF,MAAA,WAAAkK,GAAA0lB,4BAAArC,GAAA,aALAvtB,MAFA,kBAAAutB,GAAAK,KAEA5tB,CAF+B,kBAAAswB,kCAgB/BtwB,MAAA,mBAIEA,MAAA,GACFA,qCAHEA,MAAA,QAAAuwB,GAAAzf,IAEA9Q,cAAA,IAAAuwB,GAAAjrB,MAAA,mDA5GNtF,MAAA,WAqFEA,MA9EA,EAAAwwB,GAAA,aA8EAxwB,CA9EwD,EAAAywB,GAAA,eA8ExDzwB,CAvDE,EAAA0wB,GAAA,eAuDF1wB,CAvCE,EAAA2wB,GAAA,eAuCF3wB,CA3BE,EAAA4wB,GAAA,sBA2BF5wB,CArBC,EAAA6wB,GAAA,oBAqBD7wB,CATC,EAAA8wB,GAAA,gBAqBD9wB,MAAA,2BAEEA,MAAA,0BAAAqW,IAAArW,MAAA+wB,IAAA,MAAA7B,GAAAlvB,QAAAmP,UAAAoe,GAAAvtB,MAAA,GAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MACqBkK,GAAA8mB,0BAAAzD,GAAA2B,GAAA/J,OAAA9O,IAErC,GAEgBrW,MAAA,GAAAixB,GAAA,uCAOJjxB,+EA1GEA,MAFA,YAAAkK,GAAAgnB,UAEAlxB,CAFuB,UAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAC,OAIG7tB,cAAA,gBAAAutB,GAAAnrB,MAiBvBpC,cAAA,gBAAAutB,GAAAnrB,MAWApC,cAAA,kBAAAutB,GAAAnrB,MAeApC,cAAA,QAAAutB,GAAAnrB,MAAA,WAAAmrB,GAAAnrB,MAUApC,cAAA,mBAAAutB,GAAAnrB,MAMApC,cAAA,gBAAAutB,GAAAnrB,MAuBApC,cAAA,wBAAAutB,GAAAnrB,MAgBoBpC,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAAkK,GAAAinB,gBAAA5D,GAAAK,sCAQvB5tB,MAAA,4FAQEA,MADA,UAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAC,MACA7tB,CAD2C,YAAAA,MAAA,IAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,OAAAtF,qCAevCA,MAAA,6GAGEA,MAAA,MAAAA,MAAA,IAAAA,MAAA,IAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,QAAAtF,kCAOCA,MAAA,UACEA,MAAA,wBACHA,gBADGA,cAAA,GAAAA,MAAA,gFAjBPA,MALF,UAKEA,CADD,UAKGA,MAAA,iBAAAqW,IAAArW,aAAAoxB,IAAApxB,MAASqW,GAAAgX,kBAAwB,GAWjCrtB,MATA,EAAAqxB,GAAA,aASArxB,CADE,EAAAsxB,GAAA,yBAAAtxB,OAONA,iFAvBEA,MAAA,UAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAC,OAGE7tB,cAAA,OAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAtoB,MAAAtF,OAOGA,QAAuCA,MAAvC,OAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAK,MAAuCjuB,CAAA,WAAAuxB,iCAdhDvxB,MAVA,EAAAwxB,GAAA,YAUAxxB,CADC,EAAAyxB,GAAA,yBAAAzxB,0EAJsBA,MAFpB,QAAAkvB,GAAAvB,SAAAJ,GAAAK,MAAAS,MAEoBruB,CAAA,WAAA0xB,kCAvH3B1xB,MAAA,GAiHEA,MAhHA,EAAA2xB,GAAA,cAgHA3xB,CA1GC,EAAA4xB,GAAA,yBAAA5xB,oEAFEA,QAA6BA,MAA7B,OAAAkK,GAAA2nB,UAAA3C,GAAA/J,QAA6BnlB,CAAA,WAAA8xB,+BARpC9xB,MAAA,GAGEA,MAAA,EAAA+xB,GAAA,6EAmKE/xB,MAAA,iBAAiCA,MAAA,iBAAAqW,IAAArW,MAAAgyB,IAAA,MAAAzE,GAAAvtB,MAAA,GAAAmP,UAAA,OAAAnP,MAASutB,GAAA7iB,QAAA2L,IAAsB,GAAErW,MAAA,GAEhEA,kEAFgEA,cAAAiyB,GAAAtE,SAAAJ,GAAAK,MAAAtoB,OAAAioB,GAAAhjB,oCAGlEvK,MAAA,cAAkCA,MAAA,GAEhCA,gEAFgCA,cAAAiyB,GAAAtE,SAAAJ,GAAAK,MAAAtoB,OAAAioB,GAAAhjB,oCATpCvK,MAAA,WASEA,MAHA,EAAAkyB,GAAA,kBAGAlyB,CAHkE,EAAAmyB,GAAA,mBAMpEnyB,2DAREA,MAAA,UAAAiyB,GAAAtE,SAAAJ,GAAAK,MAAAC,OAEW7tB,cAAA,OAAAutB,GAAA7iB,SAGA1K,cAAA,QAAAutB,GAAA7iB,oCAVf1K,MAAA,GACEA,MAAA,EAAAoyB,GAAA,mEA8BQpyB,MAAA,eAKEA,MAAA,uBAAAA,MAAAqyB,IAAA,MAAAC,GAAAtyB,MAAA,GAAAmP,UAAAojB,GAAAvyB,QAAAmP,UAAAjF,GAAAlK,MAAA,UAAAA,MAAakK,GAAAsoB,cAAAF,GAAAxc,MAAAyc,GAAApN,QAAuC,GAGpDnlB,MAAA,cAAUA,MAAA,GACZA,+CAHEA,MAFA,QAAAsyB,GAAAnoB,MAEAnK,CAFsB,WAAAsyB,GAAAvmB,UAIZ/L,MAAA,GAAAA,MAAAsyB,GAAA/nB,oDAEZvK,MAAA,eAKEA,MAAA,uBAAAA,MAAAyyB,IAAA,MAAAH,GAAAtyB,MAAA,GAAAmP,UAAAojB,GAAAvyB,QAAAmP,UAAAjF,GAAAlK,MAAA,UAAAA,MAAakK,GAAAsoB,cAAAF,GAAAxc,MAAAyc,GAAApN,QAAuC,GAGpDnlB,MAAA,cAAUA,MAAA,GACZA,+CAHEA,MAFA,QAAAsyB,GAAAnoB,MAEAnK,CAFsB,WAAAsyB,GAAAvmB,UAIZ/L,MAAA,GAAAA,MAAAsyB,GAAA/nB,oCAxBdvK,MAAA,GAgBEA,MAVA,EAAA0yB,GAAA,gBAUA1yB,CAHC,EAAA2yB,GAAA,2DANE3yB,cAAA,2BAAAsyB,GAAAvd,OAUA/U,cAAA,2BAAAsyB,GAAAvd,qCAlBP/U,MAAA,UACEA,MAAA,EAAA4yB,GAAA,uBA2BF5yB,sEA1BKA,cAAA,OAAAkK,GAAA2nB,UAAAU,GAAApN,UAAAmN,GAAAO,eAAAjyB,IAAA0xB,GAAAO,wCART7yB,MAAA,GACEA,MAAA,WAKEA,MAAA,EAAA8yB,GAAA,eA6BF9yB,mEA/BEA,cAAA,UAAAuyB,GAAA5E,SAAAJ,GAAAK,MAAAC,OAEyB7tB,cAAA,UAAAuyB,GAAA5E,SAAAJ,GAAAK,MAAAtoB,kCAT/BtF,MAAA,GAGEA,MAAA,EAAA+yB,GAAA,6DArQJ/yB,MAAA,GAkQEA,MAjQA,EAAAgzB,GAAA,sBAiQAhzB,CA/PC,EAAAizB,GAAA,sBA+PDjzB,CAtNwE,EAAAkzB,GAAA,sBAsNxElzB,CA5KC,EAAAmzB,GAAA,sBA4KDnzB,CAfwE,EAAAozB,GAAA,mEAjPrEpzB,cAAA,OAAAqzB,KAAAnpB,GAAAopB,0BAAAzX,SA0CY7b,cAAA,OAAAqzB,KAAAnpB,GAAAopB,0BAAAxX,MAyCZ9b,cAAA,OAAAqzB,KAAAnpB,GAAAopB,0BAAAvX,iBA8JY/b,cAAA,OAAAqzB,KAAAnpB,GAAAopB,0BAAArX,MAgBZjc,cAAA,OAAAqzB,KAAAnpB,GAAAopB,0BAAApX,2CA5RPlc,MAAA,MAyBEA,MArBA,EAAAuzB,GAAA,sBAqBAvzB,CArB+C,EAAAwzB,GAAA,sBAqB/CxzB,CAVgD,EAAAyzB,GAAA,uEAdhDzzB,MAAA,eAAAutB,GAAAK,MAGe5tB,cAAA,OAAAkK,GAAAwpB,iBAAAnG,KAWAvtB,cAAA,QAAAkK,GAAAwpB,iBAAAnG,KAUAvtB,cAAA,OAAAkK,GAAAypB,kBAAApG,kCA8SjBvtB,MAAA,kCAGEA,MAAA,UAAAkK,GAAA0pB,gEAEF5zB,MAAA,WASEA,MADA,0BAAA6zB,GAAA7zB,MAAA8zB,IAAA3kB,UAAAjF,GAAAlK,QAAA,OAAAA,MAAUkK,GAAA6pB,YAAAF,GAAA1O,QAAuB,EACjCnlB,CADkC,yBAAA6zB,GAAA7zB,MAAA8zB,IAAA3kB,UAAAjF,GAAAlK,QAAA,OAAAA,MACzBkK,GAAA8pB,WAAAH,GAAA1O,QAAsB,GAChCnlB,kDAHCA,MAHA,iBAAAkK,GAAA0hB,eAGA5rB,CAHiC,UAAAkK,GAAA+pB,YAAAJ,GAAA1O,QAGjCnlB,CAFmC,YAAAkK,GAAAohB,UAEnCtrB,CADuB,WAAAkK,GAAAkjB,cAAAyG,GAAA1O,uDAM3BnlB,MAAA,mCAKEA,MAAA,2BAAAqW,IAAArW,MAAAk0B,IAAA,MAAAhqB,GAAAlK,QAAA,OAAAA,MAAmBkK,GAAA0f,gBAAAvT,IAAuB,GAE5CrW,kCAHEA,MAFA,QAAAkK,GAAA4E,MAEA9O,CAFe,mBAAAkK,GAAAwf,iBAEf1pB,CADqC,oBAAAkK,GAAAuf,oBClQlC,IAAM0K,GAAoB,MAA3B,MAAOA,GA2KDxjB,MACAyjB,YACEC,cACAC,YACiBC,UACLC,YACAC,aACZC,0BACFC,YAlLVlL,kBAA8C,IAAI9oB,KAAgB,GAE3DuwB,UAA8B,IAAI0D,KAAiB,IAEnDzD,gBAAkB,GAMzBmC,0BAA4B1X,EAM5B+Q,0BAA4BpQ,EAMnBsQ,gBACP,IAAIlsB,SAAgBC,GAKdi0B,YAKAC,aAOAC,qBAKCjmB,MAKT,aAAa+a,CAAUvkB,IACrB1G,KAAKo2B,WAAa1vB,GAClB1G,KAAKq2B,WAAWpL,UAAYvkB,EAC9B,CAEA,aAAIukB,GACF,OAAOjrB,KAAKo2B,UACd,CACQA,WAKCvnB,SAMTme,eAA4CzP,EAA0BC,KAMtE8Y,gBAA0B,EAM1BC,eAAyB,EAMzBzL,iBAKU0L,YAAc,IAAIlpB,MAKlBmpB,mBAAqB,IAAInpB,MAOzBopB,iBAGL,IAAIppB,WAAatL,GAMtB,WAAIsD,GACF,IAAIqxB,GAAU32B,KAAK6O,SAAS8nB,QACzBjtB,OAAQktB,KAAiD,IAAnBA,GAAOC,SAC7CpW,IAAKmW,IAA8BA,GAAO5H,MAE7C,OAA+B,IAA3BhvB,KAAK82B,oBACPH,GAAU,CAAC,qBAAqBhW,OAAOgW,KAGlCA,EACT,CAMAN,WAAa,IAAIU,MAMjB,aAAIrK,GACF,OAAO1sB,KAAK6O,SAAS6d,YAAa,CACpC,CAMA,qBAAIoK,GACF,OAAO92B,KAAK6O,SAASioB,oBAAqB,CAC5C,CAMA,cAAI3I,GACF,OAAOnuB,KAAK6O,SAASsf,aAAc,CACrC,CAMA,eAAI6I,GACF,YAAqCh1B,IAA9BhC,KAAK6O,SAASmoB,aAEjBh3B,KAAK6O,SAASmoB,WACpB,CAEA,eAAIC,GACF,OAAOj3B,KAAK6O,SAASooB,YAAcj3B,KAAK6O,SAASooB,YAAc,MACjE,CAEAl3B,YACUgS,GACAyjB,GACEC,GACAC,GACiBC,GACLC,GACAC,GACZC,GACFC,IARA/1B,KAAA+R,SACA/R,KAAAw1B,eACEx1B,KAAAy1B,iBACAz1B,KAAA01B,eACiB11B,KAAA21B,aACL31B,KAAA41B,eACA51B,KAAA61B,gBACZ71B,KAAA81B,6BACF91B,KAAA+1B,eAER/1B,KAAK+1B,YAAYmB,UAAU,QAC7B,CAMA3pB,WACEvN,KAAKm3B,mBACLn3B,KAAKq2B,WAAWpL,UAAYjrB,KAAKirB,UACjCjrB,KAAKkQ,MAAMM,MAAM2O,QAAQpb,QAAKof,KAAa,MAAMtgB,UAAU,KACzD7C,KAAKm3B,mBACLn3B,KAAK6D,SAAO,EAEhB,CAKA8P,YAAYC,IACV,MAAM1D,GAAQ0D,GAAQ1D,MAClBA,IAASA,GAAM2D,eAAiB3D,GAAM4D,eACxC9T,KAAKm3B,kBAET,CAKArG,cAAc8F,GAAgBrQ,GAA2BmD,IACvD,MAAMnjB,GAAMvG,KAAKo3B,iCAAiCR,IAClDrQ,GAAOvI,OAAOqZ,WAAW9wB,IAAOmjB,GAAM9S,OAAOlQ,KAC/C,CAKAyqB,qBAAqByF,GAAgBrQ,GAA2BmD,IAC9D,MAAMnjB,GAAMvG,KAAKo3B,iCAAiCR,IAClDrQ,GAAOvI,OAAOqZ,WAAW9wB,IAAOmjB,GAAMmE,OACxC,CAKAyD,oBAAoBsF,GAAgBrQ,GAA2BmD,IAC7D,MAAMnjB,GAAMvG,KAAKo3B,iCAAiCR,IAClDrQ,GAAOvI,OAAOqZ,WAAW9wB,IAAOmjB,GAAMhjB,KACxC,CAKA0rB,0BACEwE,GACArQ,GACAmD,IAEA1pB,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMuI,SAAS7N,GAAM8N,OAAOC,WAC3D,MAAMlxB,GAAMvG,KAAKo3B,iCAAiCR,GAAO5H,MACzDzI,GAAOvI,OAAOqZ,WAAW9wB,IAAOmjB,GAAM8N,OAAO9wB,KAC/C,CAKA6pB,aAAaqG,GAAgBrQ,GAA2BmD,IAEtD,MAAMhjB,GAAQgxB,KAAOhO,GAAMhjB,OAAOixB,OADnB,cAETpxB,GAAMvG,KAAKo3B,iCAAiCR,IAClDrQ,GAAOvI,OAAOqZ,WAAW9wB,IAAOG,EAClC,CAMQkxB,WAAWrR,IACjB,MAAMsR,GAAOtR,GAAOvI,OAAOqZ,YAAc9Q,GAAOvI,OAChDhe,KAAK6O,SAAS8nB,QAAQpc,QAASqc,KAC7BA,GAAOhrB,MACLgrB,GAAOkB,YAAYC,YAAcnB,GAAOhrB,MAAMosB,SAAS,KACnDpB,GAAOhrB,MAAQ,KACfgrB,GAAOhrB,MAEb,MAAMrF,GAAMvG,KAAKo3B,iCAAiCR,GAAO5H,MACzD,GAAoB,YAAhB4H,GAAOpzB,KACJq0B,GAAKtxB,KAAsB,OAAdsxB,GAAKtxB,IAES,iBAAdsxB,GAAKtxB,MACrBsxB,GAAKtxB,IAAO0xB,KAAKC,MAAML,GAAKtxB,IAAK4xB,gBAFjCN,GAAKtxB,KAAO,EAIdvG,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQR,GAAKtxB,WAAK,GAEZ,SAAhBqwB,GAAOpzB,KACZozB,GAAOpF,SACTxxB,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQ,CAACR,GAAKtxB,QAGjCvG,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQR,GAAKtxB,MAI5BvG,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMuI,SADpB,iBAAdM,GAAKtxB,IACsC+xB,SAAST,GAAKtxB,KACdsxB,GAAKtxB,WAAI,GAEpC,iBAAhBqwB,GAAOpzB,KAAyB,CACzCxD,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQR,GAAKtxB,MAGhCvG,KAAKuyB,gBAAgBqE,GAAO5H,MAAQ,IAAIpU,KACxC5a,KAAKuyB,gBAAgBqE,GAAO5H,MAAQhvB,KAAKsyB,UAAUgF,SACjDV,GAAO5H,MACPuJ,aAAax0B,QACb0c,KAAK/Z,KACH,GAAIA,IAAOkD,OACT,OAAOgtB,GAAOnF,cAAc/nB,OAAQ8tB,KAClC,MAAMgB,GAAmB9xB,GACrBA,GACGyxB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAC/B,GAKJ,OAJ8BlB,GAAO9wB,MAClCyxB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACFV,SAASQ,GAAgB,EACvD,IAKP,IAAIG,GAAmBd,GAAKtxB,IAkB5B,GAjBAqwB,GAAOnF,aAAalX,QAASid,KAEG,iBAArBmB,IACPC,KAAYC,cAAcF,MACzBC,KAAYE,cAAcH,MAE3BA,GAAmBL,SAASK,MAG5BnB,GAAO9wB,QAAUiyB,IACjBnB,GAAOtlB,KAAOymB,MAEdA,GAAmBnB,GAAO9wB,SAI9B1G,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMuI,SAASoB,IAC1C34B,KAAKizB,UAAU1M,KAAWqQ,GAAOmC,gBAAiB,CACpD,MAAM/a,GAASuI,GAAOvI,OACtBhe,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMuI,SACnCvZ,IAAQqZ,WACNr3B,KAAKo3B,iCAAiCR,GAAOmC,kBAGnD,CACF,SAA2B,SAAhBnC,GAAOpzB,MAChB,IAAuB,IAAnBozB,GAAOC,QACT,GAAIgB,GAAKtxB,IAAM,CACb,IAAIyyB,GAAOtB,KAAOG,GAAKtxB,KACvBsxB,GAAKtxB,IAAOyyB,GAAKC,MAAMtB,OAAO,cAC9B33B,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQR,GAAKtxB,KAElC,KAAO,CACL,MAAM2yB,GAASl5B,KAAKo3B,iCAAiCR,GAAO5H,MAC5DzI,GAAOvI,OAAOqZ,WAAW6B,IAAU,KACnCl5B,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQ,MAE7B,OAGFr4B,KAAKsyB,UAAU8F,WACbxB,GAAO5H,KACPhvB,KAAKw1B,YAAY6C,QAAQR,GAAKtxB,MAKhCvG,KAAKsyB,UAAUgF,SAASV,GAAO5H,OAC/BhvB,KAAKgxB,4BAA4B4F,GAAQ,aAEzC52B,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMmK,SAAO,EAGlD,CAEQhC,mBACNn3B,KAAKo5B,mBACLp5B,KAAKi2B,YAAcj2B,KAAKkQ,MAAMwU,UAC3BnC,QAASgE,KAA2D,IAA1BA,GAAO/V,MAAMgY,UACvD3lB,UAAW0mB,KACV,MAAM8P,GAAgB9P,GAAQ,GACxB+P,GAAiCt5B,KAAKkQ,MAAMwU,UAC/CzC,MACAvZ,QAAQ2wB,IACLE,GAAUv5B,KAAKirB,UACjBjrB,KAAKirB,UAAUV,UAAYvqB,KAAKirB,UAAUX,UAAY,GACtD,EAGJ,GACEtqB,KAAKirB,YACJqO,IAJat5B,KAAKirB,UAAYsO,GAAUv5B,KAAKirB,UAAUV,SAAW,IAKjE+O,IAAkCC,IACpC,CACA,MAAMC,GAActN,KAAKuN,MACvBH,GAAiCt5B,KAAKirB,UAAUV,UAElDvqB,KAAKq2B,WAAWpL,UAAUX,UAAYkP,EACxC,CACAx5B,KAAKiuB,gBAAgBtrB,KAAK3C,KAAK05B,sBAAsBnQ,IAAQ,GAEjEvpB,KAAKk2B,aAAel2B,KAAKkQ,MAAMwU,UAAUhU,OAAO7N,UAAWof,KACrDA,GAAI,IACNjiB,KAAK43B,WAAW3V,GAAI,IAEtBjiB,KAAKq2B,WAAWpyB,KAAOge,GAAIxB,IAAK8F,MAE5BA,UACAwI,SAAU/uB,KAAK6O,SAAS8nB,QAAQzW,OAC9B,CAAC6O,GAAoB6H,MACnB,MAAMlwB,GAAQ1G,KAAK25B,SAASpT,GAAQqQ,IACpC7H,UAAS6H,GAAO5H,MAAQ,CACtBC,MAAOjvB,KAAK45B,aAAarT,GAAQqQ,IACjClwB,SACA+oB,MAAOzvB,KAAKyvB,MAAM/oB,IAClB2oB,MAAOrvB,KAAKqvB,MAAM3oB,KAEbqoB,IAET,MAGL,EAEL,CAMA7gB,cACElO,KAAKo5B,kBACP,CAEQA,mBACFp5B,KAAKi2B,aACPj2B,KAAKi2B,YAAY9nB,cAEfnO,KAAKk2B,cACPl2B,KAAKk2B,aAAa/nB,aAEtB,CAQA0rB,qBACE,MAAO,CAAC9X,GAAQ+X,KAAQA,GAAIvT,OAAOD,GACrC,CAOAziB,UACE7D,KAAK+R,MAAM4K,eACb,CAEAqO,gBAAgBtB,IACd1pB,KAAKirB,UAAYvB,EACnB,CAOAqQ,OAAOrQ,IACL,MAAMpF,GAAYoF,GAAMpF,UAClBsS,GAAS52B,KAAK6O,SAAS8nB,QAAQvU,KAClC4X,IAAyBA,GAAEhL,OAAStF,GAAM/B,QAG3B,QAAdrD,IAAqC,SAAdA,IACzBtkB,KAAKkQ,MAAMwU,UAAUlC,KAAK,CACxB6B,cAAgBkC,IACdvmB,KAAK25B,SAASpT,GAAQqQ,IACxBtS,aACAC,WAAYvkB,KAAKs2B,iBAEnBt2B,KAAK02B,iBAAiBtoB,KAAK,CAAEwoB,UAAQtS,eACrCtkB,KAAK6qB,kBAAkBloB,MAAK,IAE5B3C,KAAKkQ,MAAMwU,UAAUlC,UAAKxgB,EAE9B,CAOAozB,WAAW7O,IACTvmB,KAAKm2B,qBAAuBn2B,KAAKkQ,MAAMwU,UAAUrF,OAAOkH,IACxDvmB,KAAKw2B,YAAYpoB,KAAKmY,GAAOvI,OAC/B,CASAmX,YAAY5O,IACV,IAAuB,IAAnBvmB,KAAK0sB,UACP,OAGF,MAAM1O,GAASuI,GAAOvI,OACtBhe,KAAKkQ,MAAMM,MAAMmP,OAAO3B,GAAQ,CAAEwK,UAAU,IAAQ,GACpDxoB,KAAKy2B,mBAAmBroB,KAAK,CAAE6rB,MAAO,CAACjc,KACzC,CAOA4P,aAAa3W,IACX,IAAuB,IAAnBjX,KAAK0sB,UACP,OAGF,MAAMlN,GAAWxf,KAAKkQ,MAAMC,KAAK8R,MACjCjiB,KAAKy2B,mBAAmBroB,KAAK,CAAE6rB,MAAO,CAACza,MACvCxf,KAAKkQ,MAAMM,MAAMqP,WAAWL,GAAU,CAAEgJ,SAAUvR,IACpD,CASAyX,YAAYzX,GAAiBsP,IAC3B,IAAuB,IAAnBvmB,KAAK0sB,UACP,OAGF,MAAM1O,GAASuI,GAAOvI,OAEtBhe,KAAKkQ,MAAMM,MAAMmP,OAAO3B,GAAQ,CAAEwK,SAAUvR,KADf,IAAXA,KAAoBjX,KAAKmuB,aAE5B,IAAXlX,IACFjX,KAAKy2B,mBAAmBroB,KAAK,CAAE6rB,MAAO,CAACjc,MAEzChe,KAAKm2B,qBAAuBn2B,KAAKkQ,MAAMwU,UAAUrF,OAAOkH,GAC1D,CASAgI,iBACEtX,GACAsP,GACAmD,IAEA,IAAuB,IAAnB1pB,KAAK0sB,UACP,OAGF,IAAwB,IAApB1sB,KAAKmuB,iBAAsDnsB,IAA9BhC,KAAKm2B,qBAEpC,YADAn2B,KAAK0uB,YAAYzX,GAAQsP,IAO3B,MAAM2T,GAAQ3yB,OAAOe,SAAS6xB,cAC9BD,GAAME,WAAW1Q,GAAM9S,QACvBrP,OAAO8yB,eAAeC,kBACtB/yB,OAAO8yB,eAAeE,SAASL,IAC/BxQ,GAAM8Q,2BAEN,MAAMjR,GAAUvpB,KAAKkQ,MAAMwU,UAAUzC,MAC/BwY,GAAclR,GAAQ7gB,QAAQ6d,IAC9BmU,GAAoB16B,KAAKkQ,MAAMwU,UAAUxkB,IAC7CF,KAAKm2B,sBAGDwE,GAAU,CAACF,GADOlR,GAAQ7gB,QAAQgyB,KAOlClb,GALgB+J,GAAQ1F,MAC5BqI,KAAKE,OAAOuO,IACZzO,KAAKC,OAAOwO,IAAW,GAGMla,IAC5Bma,IAAkCA,GAAQ5c,QAE7Che,KAAKkQ,MAAMM,MAAMqP,WAAWL,GAAU,CAAEgJ,SAAUvR,MACnC,IAAXA,IACFjX,KAAKy2B,mBAAmBroB,KAAK,CAAE6rB,MAAOza,KAExCxf,KAAKm2B,qBAAuBn2B,KAAKkQ,MAAMwU,UAAUrF,OAAOkH,GAC1D,CAOQmT,sBACNmB,IAEA,MACMC,GAAiBD,GAAgBjxB,OACvC,OAA0B,IAAnBkxB,GAFQnd,EAGJC,KACPkd,KAAmB96B,KAAKkQ,MAAMwU,UAAU7C,MAJ7BlE,EAKFE,IALEF,EAMFG,IACf,CAQAgX,iBAAiB8B,IACf,IAAImE,GAAWnE,GAAOpU,KACtB,YAAiBxgB,IAAb+4B,KACFA,QAAkC/4B,IAAvBhC,KAAK6O,SAAS2T,MAA6BxiB,KAAK6O,SAAS2T,MAE/DuY,EACT,CAQAvM,cAAcjI,IACZ,MAAM/V,GAAQ+V,GAAO/V,MACrB,QAAOA,GAAMgY,UAAWhY,GAAMgY,QAChC,CAEA6G,MAAM3oB,IACJ,QAAI1G,KAAKyvB,MAAM/oB,MAGX,IADA,CAAC,MAAO,MAAO,OAAOgC,QAAQhC,GAAM4C,MAAM,KAAK0xB,MAAM7C,cAM3D,CAEA1I,MAAM/oB,IACJ,MAAqB,iBAAVA,KAEe,aAAtBA,GAAMmd,MAAM,EAAG,IAA2C,YAAtBnd,GAAMmd,MAAM,EAAG,GAKzD,CASA8V,SAASpT,GAA8BqQ,IACrC,MAAM5Y,GAASuI,GAAOvI,OACtB,IAAItX,GACJ,QAA6B1E,IAAzB40B,GAAOvS,cACT,OAAOuS,GAAOvS,cAAcrG,GAAQuI,IAEtC,QAAoCvkB,IAAhChC,KAAK6O,SAASwV,cAChB,OAAOrkB,KAAK6O,SAASwV,cAAcrG,GAAQ4Y,GAAO5H,KAAMzI,IAI1D,GAFA7f,GAAQ1G,KAAKkQ,MAAMyU,YAAY3G,GAAQ4Y,GAAO5H,MAE1B,YAAhB4H,GAAOpzB,KAC4B,MAAVkD,IAA4B,KAAVA,GAC3CA,IAAQ,EACkB,kBAAVA,SAAiC1E,IAAV0E,KAErCA,GADmB,iBAAVA,KACOA,GAERuxB,KAAKC,MAAMxxB,GAAMyxB,gBAGxBn4B,KAAKizB,UAAU1M,MAClB7f,GAAQA,GAAQ,WAAa,YAEN,SAAhBkwB,GAAOpzB,MAAmBkD,IAASkwB,GAAOnF,aAAc,CACjE,MAAMzT,GAASuI,GAAOvI,OACtB,GAAI4Y,GAAOpF,SAAU,CACnB,IAAIyJ,GAECA,GADY,iBAAVv0B,GACQA,GAAMw0B,MAAM,YAAYza,IAAI0a,QAC5Bz0B,GACf,IAAI00B,GAAc,GAElBxE,GAAOnF,aAAalX,QAASid,KACvByD,GAAQjD,SAASR,GAAOtlB,KAExBkpB,GAAY9zB,KADVif,GAAO8U,QACQ7D,GAAOtlB,GAEPslB,GAAO9wB,MAAK,GAKTA,GAA1B1G,KAAKizB,UAAU1M,IAAmB0U,GAAoBG,EACxD,MACOp7B,KAAKizB,UAAU1M,KAAWqQ,GAAOmC,gBACpCryB,GACEsX,IAAQqZ,WACNr3B,KAAKo3B,iCAAiCR,GAAOmC,kBAGjDnC,GAAOnF,aAAalX,QAASid,KAER,iBAAV9wB,IACPkyB,KAAYC,cAAcnyB,MACzBkyB,KAAYE,cAAcpyB,MAE3BA,GAAQ4xB,SAAS5xB,MAEf8wB,GAAO9wB,QAAUA,IAAS8wB,GAAOtlB,KAAOxL,MAErCA,GADL1G,KAAKizB,UAAU1M,IACFiR,GAAOtlB,GACPslB,GAAO9wB,QAK9B,SAA2B,iBAAhBkwB,GAAOpzB,MAA2BkD,IAASkwB,GAAOnF,aAAc,CACzE,MAAMzT,GAASuI,GAAOvI,QACjBhe,KAAKizB,UAAU1M,KAAWqQ,GAAOmC,gBACpCryB,GACEsX,IAAQqZ,WACNr3B,KAAKo3B,iCAAiCR,GAAOmC,kBAGjDnC,GAAOnF,aAAalX,QAASid,KAER,iBAAV9wB,IACPkyB,KAAYC,cAAcnyB,MACzBkyB,KAAYE,cAAcpyB,MAE3BA,GAAQ4xB,SAAS5xB,MAEf8wB,GAAO9wB,QAAUA,IAAS8wB,GAAOtlB,KAAOxL,MAC1CA,GAAQ8wB,GAAO9wB,QAIvB,KAA2B,SAAhBkwB,GAAOpzB,OACZxD,KAAKizB,UAAU1M,IACb7f,KAEFA,GADWgxB,KAAOhxB,IACLixB,SACb33B,KAAKsyB,UAAUgF,SAASV,GAAO5H,MAAMuI,SAAS7wB,MAEtC1G,KAAKizB,UAAU1M,KAAqB,OAAV7f,KACpCA,GAAQ,KAIZ,YAAc1E,IAAV0E,KACFA,GAAQ,IAGHA,EACT,CASAsqB,4BACE4F,GACA0E,IAEA,YACwBt5B,IAAtB40B,GAAOkB,iBAC+B91B,IAAtC40B,GAAOkB,WAAWwD,KAEX1E,GAAOkB,WAAWwD,GAI7B,CAEOrI,UAAU1M,IACf,QAAOA,GAAOvI,OAAOqd,OACvB,CAQAtG,kBAAkB6B,IAChB,YAAwB50B,IAApB40B,GAAOjgB,SACFigB,GAAOjgB,SAETqG,EAA0BC,OACnC,CAOAse,gBACE,MAAO,CACL,kCAAmCv7B,KAAK0sB,UAE5C,CAOAsI,iBACE,MAAMwG,GAAOx7B,KAAK6O,SAAS4sB,gBAC3B,OAAID,cAAgBE,SACXF,KAEF,EACT,CAQAnG,YAAY9O,IACV,MACMiV,GAAOx7B,KAAK6O,SAAS8sB,aAC3B,OAAIH,cAAgBE,SACXF,GAHMjV,GAAOvI,OAGAuI,IAEf,EACT,CASAqT,aACErT,GACAqQ,IAEA,MAAM5Y,GAASuI,GAAOvI,OAChB2P,GAAM,GAENiO,GAAY57B,KAAK6O,SAASgtB,cAC5BD,cAAqBF,UACvBl1B,OAAO6H,OAAOsf,GAAKiO,GAAU5d,GAAQ4Y,GAAQrQ,KAG/C,MAAMuV,GAAalF,GAAOiF,cAC1B,OAAIC,cAAsBJ,UACxBl1B,OAAO6H,OAAOsf,GAAKmO,GAAW9d,GAAQuI,KAGjCoH,EACT,CAQAiG,cACEmI,GACAxV,IAEAvmB,KAAK43B,WAAWrR,IACS,mBAAdwV,IACTA,GAAUxV,GAAOvI,OAAQuI,GAE7B,CAKO6Q,iCAAiCR,IACtC,OAAIA,GAAOoB,SAAS,eACXpB,GAAOttB,MAAM,KAAK,GAEpBstB,EACT,8CAt5BWrB,IAAoBn0B,mBAAAuE,MAAAvE,MAAAwE,OAAAxE,mBAAAuE,KAAA,IAAAvE,MAAAuE,KAAA,GAAAvE,MAAAuE,KAAA,GAAAvE,MAAAyE,MAAAzE,MAAAyE,MAAA,+BAApB0vB,GAAoBjnB,UAAA,uBAAAC,OAAA,CAAA2B,MAAA,QAAA+a,UAAA,YAAApc,SAAA,WAAAme,eAAA,iBAAAsJ,eAAA,iBAAAC,cAAA,gBAAAzL,iBAAA,oBAAAtc,QAAA,CAAAgoB,YAAA,cAAAC,mBAAA,qBAAAC,iBAAA,oBAAAjoB,YAAA,EAAAlE,SAAA,CAAAnJ,MAnCpB,CACT,CAAEqJ,QAASuxB,KAAqBC,YAAa1G,KAAoB,EACjE2G,UACD96B,aAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,gxHAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KDhGD1N,MADF,UACEA,CAD+D,aAQ7DA,MAAA,yBAAAqW,IAAA,OAAiB1I,GAAAgrB,OAAAtiB,GAAc,GAE/BrW,MAAA,KAeEA,MAdA,EAAA+6B,GAAA,YAcA/6B,CAdsC,EAAAg7B,GAAA,qBAyWxCh7B,MA5UA,EAAAi7B,GAAA,sBA4UAj7B,CAzUC,EAAAk7B,GAAA,YAyUDl7B,CADC,EAAAm7B,GAAA,aAYHn7B,QACAA,MAAA,EAAAo7B,GAAA,qCAQFp7B,gBAxY6BA,MAAA,UAAAA,MAAA,EAAAoW,GAAAzI,GAAAkoB,cAKzB71B,QAEAA,MAFA,UAAA2N,GAAAwsB,gBAEAn6B,CAF2B,aAAA2N,GAAAsnB,WAE3Bj1B,CADyB,UAAA2N,GAAA8qB,sBAoCJz4B,MAAA,GAAAA,MAAA,UAAA2N,GAAAF,SAAA8nB,SAuUlBv1B,QAA0BA,MAA1B,kBAAA2N,GAAAzJ,QAA0BlE,CAAA,wBAAA2N,GAAAioB,aAMN51B,cAAA,mBAAA2N,GAAAzJ,SAUtBlE,cAAA,OAAA2N,GAAAwnB,+BC7RD7mB,KACA0a,GACAoC,GACAiQ,KAAW92B,mCACX+2B,MACAC,MAAqB72B,MAAAD,KAAAC,MACrByJ,MAAexJ,YACf0J,MAAiBzJ,MACjB42B,MAAmBjoB,kBACnBsV,KAAkBpV,KAClBrF,MAAasF,MACb+nB,MAAcC,MACdC,KACA5S,KACAD,KAAe8S,KACfC,MAAaC,YACbC,MAAcC,4DACd/tB,MAAgBguB,MAChB/tB,KACAmF,KACAtF,KACAmuB,KACAC,KAAmB53B,UACnBuT,MACAskB,MACAC,MACA9tB,MAAiB+tB,OAAA7tB,OAAA,ogDAAAC,gBAAA,WAGRylB,EAAoB,0KC5G1B,IAAMoI,EAAiB,MAAxB,MAAOA,EAoGD3qB,GACAhB,aApGVya,sBAAwB,IAEqBmR,KAE7C,WACIC,GACF,OAAO79B,KAAK89B,QACd,CACA,WAAID,CAAQn3B,GACV1G,KAAK89B,SAAWp3B,CAClB,CACQo3B,SAAW,IAEnB,aACIhtB,GACF,OAAO9Q,KAAK8W,UACd,CACA,aAAIhG,CAAUpK,GACZ1G,KAAK8W,WAAapQ,CACpB,CACQoQ,WAAa,IAErB,YACIinB,GACF,OAAO/9B,KAAKg+B,SACd,CACA,YAAID,CAASr3B,GACX1G,KAAKg+B,UAAYt3B,CACnB,CACQs3B,UAAY,OAEpB,iBACIC,GACF,OAAOj+B,KAAKk+B,cACd,CACA,iBAAID,CAAcv3B,GAChB1G,KAAKk+B,eAAiBx3B,CACxB,CACQw3B,eAAyBl+B,KAAK+9B,SAEtC,mBACII,GACF,OAAOn+B,KAAKo+B,gBACd,CACA,mBAAID,CAAgBz3B,GAClB1G,KAAKo+B,iBAAmB13B,CAC1B,CACQ03B,iBAA2Bp+B,KAAK8Q,UAExC,kBACIutB,GACF,OAAOr+B,KAAKs+B,eACd,CACA,kBAAID,CAAe33B,GACjB1G,KAAKs+B,gBAAkB53B,CACzB,CACQ43B,gBAA0Bt+B,KAAK+9B,SAEvC,aACIzZ,GACF,OAAOtkB,KAAKu+B,UACd,CACA,aAAIja,CAAU5d,GACZ1G,KAAKu+B,WAAa73B,CACpB,CACQ63B,WAAgC,SAExC,SACI/tB,GACF,OAAOxQ,KAAKw+B,MACd,CACA,SAAIhuB,CAAM9J,GACR,MAAM+3B,EAAQ,CACZZ,QAAS79B,KAAK69B,QACd/sB,UAAW9Q,KAAK8Q,UAChBitB,SAAU/9B,KAAK+9B,UAGb/9B,KAAKgS,aAAasZ,YACpB9kB,OAAO6H,OAAOowB,EAAO,CACnBZ,QAAS79B,KAAKi+B,cACdntB,UAAW9Q,KAAKm+B,gBAChBJ,SAAU/9B,KAAKq+B,iBAInB,MAAM/e,EAAOmf,EAAM/3B,QACN1E,IAATsd,IACFtf,KAAK0+B,QAAQpf,GACbqf,WAAW,KACT3+B,KAAKw+B,OAAS93B,GACbi3B,EAAkBiB,gBAEzB,CACQJ,OAAwB,UAExBK,eAER9+B,YACUiT,EACAhB,GADAhS,KAAAgT,KACAhT,KAAAgS,cACP,CAEHzE,WACEvN,KAAKgT,GAAGC,cAAc6rB,WAAa9+B,KAAKskB,UAIxCtkB,KAAK6+B,eAAiB7+B,KAAKgS,aAAa+sB,OAAOl8B,UAC5Cm8B,GAAkBh/B,KAAKwQ,MAAQxQ,KAAKwQ,MAEzC,CAEAtC,cACMlO,KAAK6+B,gBACP7+B,KAAK6+B,eAAe1wB,aAExB,CAEQuwB,QAAQpf,GACdtf,KAAKw+B,OAAS,aAES,WAAnBx+B,KAAKskB,UACPtkB,KAAK49B,KAAK3qB,cAAckD,MAAM8oB,OAAS3f,EACX,QAAnBtf,KAAKskB,YACdtkB,KAAK49B,KAAK3qB,cAAckD,MAAM+oB,MAAQ5f,EAE1C,4CAhIWqe,GAAiBv8B,mBAAAuE,MAAA,+BAAjBg4B,EAAiBrvB,UAAA,mBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,ybCpB5B1N,MADF,eACEA,CADuE,WAErEA,MAAA,GAEJA,UAGIA,MAFJ,UAEIA,CAF2B,QAE3BA,CADG,WAEDA,MAAA,KAGNA,kBAXmBA,MAAA,qBAAA2N,EAAAyB,MAAA,IAAAzB,EAAAuV,UAAA,+0BDqBNqZ,CAAiB,0IErB9Bv8B,MAAA,GACEA,MAAA,wDACEA,QAEAA,MAFA,YAAAqnB,EAAA0W,oBAEA/9B,CAFiC,SAAAqnB,EAAA2W,iBAEjCh+B,CAD2B,cAAAqnB,EAAA4W,wBCuBxB,IAAMC,EAAkB,MAAzB,MAAOA,EAoBSC,iBAhBXC,MAKDC,iBAA+Bz9B,EAK/B09B,sBAAyC19B,EAEjD,gBAAI29B,GACF,OAAO3/B,KAAKw/B,MAAM3/B,SAAW,EAC/B,CAEAE,YAAoBw/B,GAAAv/B,KAAAu/B,kBAAqC,CAEzDJ,oBACE,OAAOn/B,KAAKu/B,iBAAiBK,eAAe5/B,KAAKw/B,MAAMh8B,MAAQ,OACjE,CAEA47B,iBACE,QAAyBp9B,IAArBhC,KAAKy/B,YACP,OAAOz/B,KAAKy/B,YAGd,MAAMI,EAAS7/B,KAAK2/B,aAAaE,QAAU,GAC3C,OAAA7/B,KAAKy/B,YAAcj5B,OAAO6H,OACxB,CACEgb,YAAarpB,KAAKw/B,MAAM5zB,MACxBk0B,cAAe9/B,KAAK2/B,aAAaG,gBAAiB,GAEpDt5B,OAAO6H,OAAO,GAAIrO,KAAKw/B,MAAMjxB,QAAU,IACvC,CACEwxB,YAAa//B,KAAKw/B,MAAMnH,QACxBwH,OAAQr5B,OAAO6H,OAAO,MAAI2xB,QAA2BH,KAGlD7/B,KAAKy/B,WACd,CAEAJ,sBACE,YAA8Br9B,IAA1BhC,KAAK0/B,mBAIT1/B,KAAK0/B,iBAAmBl5B,OAAO6H,OAAO,GAAIrO,KAAKw/B,MAAMzlB,aAAe,KAH3D/Z,KAAK0/B,gBAKhB,4CArDWJ,GAAkBl+B,MAAAuE,KAAA,+BAAlB25B,EAAkBhxB,UAAA,qBAAAC,OAAA,CAAAixB,MAAA,SAAA/wB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,oDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD1B/B1N,MAAA,EAAA6+B,EAAA,2BAAe7+B,MAAA,YAAAY,IAAA+M,EAAAywB,sBCwBHrwB,KAAM+M,MAAsBrM,OAAA,2EAAAC,gBAAA,WAE3BwvB,CAAkB,sOCIxB,IAAMY,EAAa,MAApB,MAAOA,EAIFC,KAKAC,SAKAC,aAAuB,MAKtBC,WAAa,IAAIhzB,MAEaizB,QAExC,cAAIC,GACF,OAAsD,IAA/CxgC,KAAKugC,QAAQttB,cAAcwtB,SAAS72B,MAC7C,CAEA7J,cAAe,CAMf4T,YAAYC,GACV,MAAMwsB,EAAWxsB,EAAQwsB,SACrBA,GAAYA,EAASvsB,eAAiBusB,EAAStsB,qBACnB9R,IAA1Bo+B,EAASvsB,aACX7T,KAAK8G,QAEL9G,KAAK0gC,QAAQN,EAASvsB,cAG5B,CAOA8sB,WACE3gC,KAAKsgC,WAAWlyB,KAAKpO,KAAK4gC,UAC5B,CAEAA,UACE,MAAM38B,EAAO,GACb48B,eAAiB7gC,KAAKmgC,MAAM5lB,QAASilB,IACnCx/B,KAAK8gC,wBAAwB78B,EAAMu7B,EAAK,GAEnCv7B,CACT,CAEQy8B,QAAQz8B,GACdjE,KAAKmgC,KAAKY,OAAOxmB,QAASilB,IACxBA,EAAMnH,QAAQd,YAASrZ,KAAEja,EAAMu7B,EAAMxQ,MAAM7Q,WAAU,GAGvDne,KAAKmgC,KAAKa,OAAOzmB,QAAS0mB,IACxBA,EAAMF,OAAOxmB,QAASilB,IACpBA,EAAMnH,QAAQd,YAASrZ,KAAEja,EAAMu7B,EAAMxQ,MAAM7Q,WAAU,EACtD,EAEL,CAEQ2iB,wBACN78B,EACAu7B,GAEA,MAAMnH,EAAUmH,EAAMnH,QACjBA,EAAQlrB,WACXlJ,EAAKu7B,EAAMxQ,MAAQqJ,EAAQ3xB,MAE/B,CAKQI,QACN9G,KAAKmgC,KAAK9H,QAAQ6I,OACpB,4CAxFWhB,EAAa,+BAAbA,EAAa5xB,UAAA,eAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,ybC9B1B1N,MAAA,YAGEA,MAAA,sBAAAA,aAAAyK,GAAAzK,MAAY2N,EAAA4xB,WAAU,GAMpBv/B,MAJF,UAIEA,CADD,WAEGA,MAAA,GACFA,QACAA,MAAA,aACEA,MAAA,KAGNA,kBAdEA,MADA,eAAA2N,EAAAsxB,aACAj/B,CAD6B,YAAA2N,EAAAoxB,KAAA9H,SAM3Bj3B,cAAA,UAAAA,MAAA,EAAA+/B,EAAApyB,EAAAyxB,6BDqBQ/D,KAAW92B,UAAE43B,KAAmB53B,KAAE2J,MAAOO,OAAA,wUAAAC,gBAAA,WAExCowB,CAAa,iPE5BpB,SAAUkB,EAAsB59B,IACpC,OAAQ69B,KACNC,IAAiBC,SAAS/9B,GAAM69B,GAAQ,CAE5C,kECCIjgC,MAAA,kBACEA,MAAA,GACFA,qCAFoDA,MAAA,QAAAogC,GAAA96B,OAClDtF,cAAA,IAAAogC,GAAA51B,MAAA,kDAGJxK,MAAA,gBAGEA,MAAA,mBAAAA,MAAAqgC,IAAA,MAAAC,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAC,uBAAsB,GAE9BvgC,MAAA,oBAGHA,kCAHGA,cAAA,QAAAA,MAAA,IAAAsgC,GAAAl2B,WAAA,yEAIHpK,MAAA,eAAsCA,MAAA,wBAEpCA,gCAFoCA,oBAAA,IAAAsgC,GAAAE,qBC2BjC,IAAMC,EAAN,MAAMA,GACFr2B,UAAsC,IAAIzJ,KAAgB,GAKnE,WACI+/B,CAAQp7B,IACV1G,KAAK+hC,SAASp/B,KAAK+D,GACrB,CACA,WAAIo7B,GACF,OAAO9hC,KAAK+hC,SAASr7B,KACvB,CACSq7B,SACP,IAAIhgC,IAAgB,IAKbyvB,UAAoB,EAKpBuO,YAKA1W,YAKAwW,OAKAC,eAAyB,EAKlC,YAAIkC,GACF,SAAOC,MAAsBjiC,KAAK+/B,YACpC,CAEAxyB,WACEvN,KAAKwL,UAAU7I,KAAK3C,KAAK+/B,YAAY5yB,SACvC,CAKAy0B,kBACE,SAAOM,MAAuBliC,KAAK+/B,YAAa//B,KAAK6/B,OACvD,CAEA8B,uBACE3hC,KAAKmiC,gBACP,CAEQA,iBACN,MAAMh1B,IAAYnN,KAAKwL,UAAU9E,OAChB,IAAbyG,GACFnN,KAAK+/B,YAAY5G,UAEjBn5B,KAAK+/B,YAAYqC,SAEnBpiC,KAAKwL,UAAU7I,KAAKwK,GACtB,8CAvEW00B,GAAwB,+BAAxBA,GAAwBvzB,UAAA,4BAAAC,OAAA,CAAAuzB,QAAA,UAAAtQ,SAAA,WAAAuO,YAAA,cAAA1W,YAAA,cAAAwW,OAAA,SAAAC,cAAA,iBAAArxB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4OAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD9CnC1N,MADF,mBACEA,CADc,kBAOZA,MAAA,EAAAihC,EAAA,qCAGFjhC,QAUAA,MATA,EAAAkhC,EAAA,iBASAlhC,CAJG,EAAAmhC,GAAA,mBAOLnhC,gBArBIA,QAGAA,MAHA,WAAA2N,GAAAyiB,SAGApwB,CAHqB,WAAA2N,GAAAizB,SAGrB5gC,CAFqB,cAAA2N,GAAAsa,YAErBjoB,CAD2B,cAAA2N,GAAAgxB,aAGI3+B,cAAA,UAAAA,MAAA,IAAA2N,GAAAgzB,WAK9B3gC,MAAA,GAAAA,MAAA,YAAA2N,GAAA+wB,eAQS1+B,cAAA,OAAA2N,GAAAgxB,YAAAF,wBCeV5V,KAAkBtkB,eAClBukB,KAAetkB,KAAAC,KACf42B,KAAW32B,UACXy3B,KAAmBz3B,KACnB2O,KACA0V,KACAhb,KACAK,KAAazJ,KACb2J,KACAC,KAAiB3J,MAAAw8B,cAAA,EAAA1yB,gBAAA,KAGR+xB,KAAwBY,MAAA,CAnBpCrB,EAAsB,WAmBVS,yECrCXzgC,MAAA,gBAGEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAq2B,uBAAsB,GAE9BvgC,MAAA,oBAGHA,kCAHGA,cAAA,QAAAA,MAAA,IAAAkK,GAAAE,WAAA,wFAKHpK,MAAA,cAKEA,MAAA,mBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAASkK,GAAAo3B,iBAAgB,GAEzBthC,MAAA,gBAA0BA,MAAA,GAG5BA,oCAH4BA,MAAA,GAAAA,MAAAkK,GAAAq3B,KAAA,4DAK5BvhC,MAAA,eAAsCA,MAAA,wBAEpCA,gCAFoCA,oBAAA,IAAAkK,GAAAs2B,qBCcjC,IAAMgB,EAAN,MAAMA,GAqCS7wB,MApCpBvG,UAAsC,IAAIzJ,KAAgB,GAC1D4gC,MAAgB,EACRE,mBAKC9C,YAKA1W,YAKAyZ,WAKAjD,OAKAC,eAAyB,EAKlC,YAAIkC,GACF,SAAOC,MAAsBjiC,KAAK+/B,YACpC,CAEAhgC,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAE/CxE,WACEvN,KAAKwL,UAAU7I,KAAK3C,KAAK+/B,YAAY5yB,SACvC,CAKAy0B,kBACE,SAAOM,MAAuBliC,KAAK+/B,YAAa//B,KAAK6/B,OACvD,CAEA8B,uBACE3hC,KAAKmiC,gBACP,CAEQA,iBACN,MAAMh1B,IAAYnN,KAAKwL,UAAU9E,OAChB,IAAbyG,GACFnN,KAAK+/B,YAAY5G,UAEjBn5B,KAAK+/B,YAAYqC,SAEnBpiC,KAAKwL,UAAU7I,KAAKwK,GACtB,CAEAu1B,iBACE1iC,KAAK2iC,MAAQ3iC,KAAK2iC,KAClB3iC,KAAK+iC,aACP,CACAA,YAAYC,GAAkB,KACxBhjC,KAAK8iC,aAAe9iC,KAAK2iC,OACvB3iC,KAAK6iC,oBACPI,aAAajjC,KAAK6iC,oBAEpB7iC,KAAK6iC,mBAAqBlE,WAAW,KACnC3+B,KAAK2iC,MAAO,EACZ3iC,KAAK+R,MAAM4K,eAAa,EACvBqmB,IAEP,8CA9EWJ,IAAsBxhC,aAAA,+BAAtBwhC,GAAsBt0B,UAAA,0BAAAC,OAAA,CAAAwxB,YAAA,cAAA1W,YAAA,cAAAyZ,WAAA,aAAAjD,OAAA,SAAAC,cAAA,iBAAArxB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,uXAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD7CjC1N,MADF,mBACEA,CADc,aAQZA,MALA,yBAAQ2N,GAAAg0B,YAAY,EAAE,EAKtB3hC,CALuB,2BAKb2N,GAAAg0B,aAAa,GAPzB3hC,QA+BAA,MAtBA,EAAA8hC,EAAA,iBAsBA9hC,CAjBG,EAAA+hC,EAAA,eAiBH/hC,CANC,EAAAgiC,EAAA,mBASHhiC,gBA/BIA,QAGAA,MAHA,OAAA2N,GAAA+zB,YAAA/zB,GAAA4zB,KAAA,kBAGAvhC,CAH2D,WAAA2N,GAAA+zB,WAAA,OAAA/zB,GAAAizB,SAG3D5gC,CAF2C,cAAA2N,GAAAsa,YAE3CjoB,CAD2B,cAAA2N,GAAAgxB,aAK1B3+B,cAAA,YAAA2N,GAAA+wB,eAWA1+B,cAAA,OAAA2N,GAAA+zB,YAUS1hC,cAAA,OAAA2N,GAAAgxB,YAAAF,wBCGV5V,KAAkBtkB,oBAClBk3B,KAAcj3B,KACd62B,KAAW52B,eACX03B,KAAmB13B,KACnBsJ,KACAK,KAAa1J,KACbyJ,KAAexJ,KACf2J,KACAC,KAAiB3J,MAAAw8B,cAAA,EAAA1yB,gBAAA,iDCnCnB1O,MAAA,gBAGEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAq2B,uBAAsB,GAE9BvgC,MAAA,oBAGHA,kCAHGA,cAAA,QAAAA,MAAA,IAAAkK,GAAAE,WAAA,wEAIHpK,MAAA,eAAsCA,MAAA,wBAEpCA,gCAFoCA,oBAAA,IAAAkK,GAAAs2B,qBD6B3BgB,KAAsBH,MAAA,CAlBlCrB,EAAsB,SAAM,EAACiC,EAAAC,IAAA,qBAuDDC,SArChBX,GEHN,IAAMY,EAAN,MAAMA,GACXh4B,UAAsC,IAAIzJ,KAAgB,GAKjDg+B,YAKA1W,YAKAwW,OAKAC,eAAyB,EAKlC,YAAIkC,GACF,SAAOC,MAAsBjiC,KAAK+/B,YACpC,CAEAxyB,WACEvN,KAAKwL,UAAU7I,KAAK3C,KAAK+/B,YAAY5yB,SACvC,CAKAy0B,kBACE,SAAOM,MAAuBliC,KAAK+/B,YAAa//B,KAAK6/B,OACvD,CAEA8B,uBACE3hC,KAAKmiC,gBACP,CAEQA,iBACN,MAAMh1B,IAAYnN,KAAKwL,UAAU9E,OAChB,IAAbyG,GACFnN,KAAK+/B,YAAY5G,UAEjBn5B,KAAK+/B,YAAYqC,SAEnBpiC,KAAKwL,UAAU7I,KAAKwK,GACtB,8CArDWq2B,GAA0B,+BAA1BA,GAA0Bl1B,UAAA,8BAAAC,OAAA,CAAAwxB,YAAA,cAAA1W,YAAA,cAAAwW,OAAA,SAAAC,cAAA,iBAAArxB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mMAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD1CrC1N,MADF,mBACEA,CADc,gBAOdA,MAAA,QAAAA,QAUAA,MATA,EAAAqiC,EAAA,iBASAriC,CAJG,EAAAsiC,EAAA,mBAOLtiC,gBAjBIA,QAEAA,MAFA,WAAA2N,GAAAizB,SAEA5gC,CAFqB,cAAA2N,GAAAsa,YAErBjoB,CAD2B,cAAA2N,GAAAgxB,aAK1B3+B,MAAA,GAAAA,MAAA,YAAA2N,GAAA+wB,eAQS1+B,cAAA,OAAA2N,GAAAgxB,YAAAF,wBCgBV5V,KAAkBtkB,eAClBk3B,KAAcj3B,KACd62B,KAAW52B,eACX03B,KAAmB13B,KACnBsJ,KACAK,KAAa1J,KACb4J,KACAC,KAAiB5J,MAAAy8B,cAAA,EAAA1yB,gBAAA,KAGR0zB,KAA0Bf,MAAA,CAjBtCrB,EAAsB,aAiBVoC,GCtCN,0CCJLpiC,MAAA,WAKEA,MAAA,sBACFA,iDAHEA,MAAA,UAAAkK,GAAAq4B,gBAAAC,KAEgBxiC,cAAA,QAAAwiC,iCANpBxiC,MAAA,WACEA,MAAA,EAAAyiC,EAAA,aAOFziC,gCANsBA,cAAA,UAAAkK,GAAA21B,MAAAF,qCAYtB3/B,MAAA,eAAsCA,MAAA,wBAEpCA,gCAFoCA,oBAAA,IAAAkK,GAAAs2B,qBCiB/B,IAAMkC,EAAkB,MAAzB,MAAOA,GAIF7C,MAKApB,OAKT,eAAIE,GACF,OAAO//B,KAAKihC,MAAM5I,OACpB,CAEAt4B,cAAe,CASfgkC,gBAAgBvE,IACd,IAAIwE,GAAU,EACd,MAAMnkC,GAAU2/B,GAAM3/B,SAAW,GACjC,OAAIA,GAAQokC,MAAQpkC,GAAQokC,KAAO,IACjCD,GAAU9X,KAAKE,IAAIvsB,GAAQokC,KAAM,IAG5BD,EACT,CASAL,gBAAgBnE,IAEd,MAAO,CAAE,CAAC,0BADMx/B,KAAK+jC,gBAAgBvE,QACW,EAClD,CAKAoC,kBAEE,SAAOM,MAAuBliC,KAAK+/B,aADnB//B,KAAKihC,MAAMphC,SAAW,IACkBggC,QAAU,GACpE,8CAvDWiE,GAAkB,+BAAlBA,GAAkBx1B,UAAA,qBAAAC,OAAA,CAAA0yB,MAAA,QAAApB,OAAA,UAAApxB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAAC,EAAA9I,MAAA,EAAAC,KAAA,EAAAC,OAAA,+OAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,aD/B/B1N,MAAA,EAAA8iC,EAAA,aAUA9iC,MAAA,WACEA,MAAA,GACFA,QAEAA,MAAA,EAAA+iC,EAAA,2BAdM/iC,MAAA,OAAA2N,GAAAkyB,OAAAlyB,GAAAkyB,MAAAF,OAAAn3B,OAAA,GAcMxI,MAAA,GAAAA,MAAA,OAAA2N,GAAAgxB,YAAAF,wBCSR1wB,KACAsF,KACAnF,KACAgwB,IACArV,KAAkBtkB,KAClBgK,KAAiB/J,MAAAiK,OAAA,qQAAAC,gBAAA,WAGRg0B,EAAkB,KCjBlBM,GAAW,MAAlB,MAAOA,GACS5O,YAApBz1B,YAAoBy1B,IAAAx1B,KAAAw1B,cAAkC,CAEtD2K,KAAKY,GAAqBC,IACxB,MAAM3I,GAAUr4B,KAAKw1B,YAAYyL,MAAM,IACvCF,UAAOxmB,QAASilB,KACdnH,GAAQgM,WAAW7E,GAAMxQ,KAAMwQ,GAAMnH,QAAO,GAE9C2I,GAAOzmB,QAAS0mB,KACd5I,GAAQgM,WAAWpD,GAAMjS,KAAMiS,GAAM5I,QAAO,GAGvC,CAAE0I,UAAQC,UAAQ3I,WAC3B,CAEA4I,MAAMhhC,GAA8B8gC,IAClC,MAAMlhC,GAAUI,GAAOJ,SAAW,GAC5Bw4B,GAAUr4B,KAAKw1B,YAAYyL,MAAM,IAKvC,GAJAF,GAAOxmB,QAASilB,KACdnH,GAAQgM,WAAW7E,GAAMxQ,KAAMwQ,GAAMnH,QAAO,GAG1Cx4B,GAAQykC,UAAW,CACrB,MAAMC,GAAavkC,KAAKwkC,cAAc3kC,GAAQykC,WAC9CjM,GAAQoM,cAAcF,GACxB,CAEA,OAAO/9B,OAAO6H,OAAO,GAAIpO,GAAQ,CAAE8gC,UAAQ1I,YAC7C,CAEAmH,MAAMv/B,IACJ,MAAMJ,GAAUI,GAAOJ,SAAW,GAK5Bw4B,GAAUr4B,KAAKw1B,YAAY6C,QAJnB,CACZ3xB,MAAO,GACPyG,SAAUtN,GAAQsN,WAIpB,GAAItN,GAAQykC,UAAW,CACrB,MAAMC,GAAavkC,KAAKwkC,cAAc3kC,GAAQykC,WAC9CjM,GAAQoM,cAAcF,GACxB,CAEA,OAAO/9B,OAAO6H,OAAO,CAAE7K,KAAM,QAAUvD,GAAQ,CAAEo4B,YACnD,CAEAqM,kBACEzkC,GACA0kC,IAEA,MAAM9kC,GAAU2G,OAAO6H,OACrB,GACApO,GAAOJ,SAAW,GAClB8kC,GAAQ9kC,SAAW,IAEf0O,GAAS/H,OAAO6H,OAAO,GAAIpO,GAAOsO,QAAU,GAAIo2B,GAAQp2B,QAAU,IAClEwL,GAAcvT,OAAO6H,OACzB,GACApO,GAAO8Z,aAAe,GACtB4qB,GAAQ5qB,aAAe,IAEzB,OAAOvT,OAAO6H,OAAO,GAAIpO,GAAQ,CAAEJ,WAAS0O,UAAQwL,gBACtD,CAEQyqB,cACNI,IAEA,OAAIrpB,MAAMC,QAAQopB,IACTA,GAAgBnkB,IAAKokB,IACnB7kC,KAAK8kC,aAAaD,KAItB7kC,KAAK8kC,aAAaF,GAC3B,CAEQE,aAAaD,IACnB,GAA4B,iBAAjBA,GACT,OAAOA,GAIT,MACM3J,GAAQ2J,GAAa3J,MADhB,mCAGX,OAAKA,GAME6J,KAFM7J,GAAM,IACNA,GAAM,IAJV6J,KAAWF,GAMtB,8CA5FWT,IAAWhjC,MAAAuE,MAAA,iCAAXy+B,GAAW/iC,QAAX+iC,GAAW9iC,UAAAC,WAFV,gBAED6iC,EAAW,0DCLpBhjC,MAAA,6BAEEA,MAAA,+CAEFA,MAAA,6BAEEA,MAAA,mDAPJA,MAAA,WAKEA,MAJA,EAAA4jC,GAAA,uBAIA5jC,CADC,EAAA6jC,GAAA,yBAKH7jC,qCAPsBA,cAAA,UAAA8jC,GAAAnE,QAIA3/B,cAAA,UAAA8jC,GAAAlE,sDAZxB5/B,MAAA,iCAIEA,MAAA,sBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAq1B,SAAAlpB,IAAgB,GAE9BrW,MAAA,EAAA+jC,GAAA,aAYE/jC,MADF,UACEA,CADkC,cACuBA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAA85B,SAAQ,GACxEhkC,MAAA,wBACFA,QACAA,MAAA,cACEA,MAAA,wBAGNA,iDAtBEA,MADA,OAAA8jC,GACA9jC,CADa,WAAAA,MAAA,IAAAkK,GAAA+5B,QAIPjkC,MAAA,GAAAA,MAAA,OAAA8jC,GAAAnE,OAAAn3B,QAaFxI,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAAkK,GAAArH,KAAAqhC,kBAAA,KAGAlkC,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAAkK,GAAArH,KAAAshC,mBAAA,kCAKJnkC,MAAA,+CAEEA,MAAA,OAAAkK,GAAArH,KAAAuhC,SCgBG,IAAMC,GAAmB,MAA1B,MAAOA,GAIF9jC,gBACAiW,UACC8tB,YAEDzhC,KAPT0hC,MAAQ,IAAI5jC,SAAsBC,GAClCqjC,MAAQ,IAAItjC,SAAwCC,GACpDjC,YACS4B,GACAiW,GACC8tB,GAEDzhC,IAJAjE,KAAA2B,mBACA3B,KAAA4X,aACC5X,KAAA0lC,eAED1lC,KAAAiE,QAEPjE,KAAKiE,KAAKshC,kBACRvlC,KAAKiE,KAAKshC,mBAAqB,0CACjCvlC,KAAKiE,KAAKqhC,iBACRtlC,KAAKiE,KAAKqhC,kBAAoB,yCAChCtlC,KAAKiE,KAAK2H,MAAQ5L,KAAKiE,KAAK2H,OAAS,8BACrC5L,KAAKqlC,MAAQrlC,KAAKiE,KAAKohC,MAEvB,IAAItE,GAAuC,GACvCC,GAA2B,GAC/BhhC,KAAKiE,KAAK2hC,kBAAkBnlB,IAAKxgB,IAC/B8gC,GAAOz5B,KAAKtH,KAAK0lC,YAAYlG,MAAMv/B,MAGrCD,KAAKiE,KAAK4hC,mBAAmBplB,IAAKqlB,KAChC,MAAM/E,GAAS+E,GAAiBF,kBAAkBnlB,IAAKxgB,IACrDD,KAAK0lC,YAAYlG,MAAMv/B,KAEzB+gC,GAAO15B,KACLtH,KAAK0lC,YAAYzE,MAAM,CAAEjS,KAAM8W,GAAiB9W,MAAQ+R,IAAO,GAGnE,MAAMZ,GAAOngC,KAAK0lC,YAAYvF,KAAKY,GAAQC,IAE3ChhC,KAAK2lC,MAAMhjC,KAAKw9B,GAClB,CAEAQ,SAAS18B,IACP,MAAMk8B,GAAOngC,KAAK2lC,MAAMhM,WACpBwG,GAAK9H,QAAQ0N,MACf/lC,KAAK4X,UAAUK,MAAMhU,IAEjBk8B,GAAKa,QAAQp3B,OACfu2B,GAAKa,OAAOvgB,IAAKwgB,KACfz6B,OAAOC,KAAKw6B,GAAM5I,QAAQf,UAAU7W,IAAKulB,KACvC/E,GAAM5I,QAAQf,SAAS0O,IAAGC,gBAC1BhF,GAAM5I,QAAQf,SAAS0O,IAAGE,wBAAsB,EACjD,GAGH/F,GAAKY,OAAOtgB,IAAK0lB,KACfA,GAAE9N,QAAQ4N,gBACVE,GAAE9N,QAAQ6N,wBAAsB,EAIxC,CACAd,SACEplC,KAAK4X,UAAUK,OACjB,8CA1DWwtB,IAAmBrkC,MAAAuE,MAAAvE,MAAAwE,OAAAxE,MAAAyE,IAAAzE,MAOpBglC,OAAe,+BAPdX,GAAmBn3B,UAAA,sBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,idAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD/ChC1N,MAAA,UAAqBA,MAAA,wBAA4BA,QAEjDA,MAAA,EAAAilC,GAAA,qCA0BAjlC,MAAA,SACEA,MAAA,EAAAklC,GAAA,yBAKFllC,gBAlCqBA,oBAAA,IAAA2N,GAAA9K,KAAA2H,QAGlBxK,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,GAAA42B,QA2BEvkC,MAAA,GAAAA,MAAA,OAAA2N,GAAA9K,KAAAuhC,QAAA,KAAAz2B,GAAA9K,KAAAuhC,wBCIDttB,MACA/I,KACA+wB,IACAzrB,KACA6qB,IACAwE,EACA1rB,MACA7I,KAAezJ,KACf0T,MACA9J,KACAC,KAAiB5J,MAAA8J,OAAA,8YAGR41B,EAAmB,KClCnBc,GAAiB,MAAxB,MAAOA,GACSjuB,OAApBvY,YAAoBuY,IAAAtY,KAAAsY,SAAoB,CAEjCC,KACLiuB,GACA3mC,IAEA,MAAMoE,GAAuB,CAC3B2hC,iBAAkBY,GAAiBZ,iBACnCC,kBAAmBW,GAAiBX,qBACjChmC,IAOL,OALkBG,KAAKsY,OAAOC,KAAKktB,GAAqB,CACtD9sB,cAAc,EACd1U,WACGpE,KAEYgZ,aACnB,8CAlBW0tB,IAAiBnlC,MAAAuE,OAAA,iCAAjB4gC,GAAiBllC,QAAjBklC,GAAiBjlC,mBAAjBilC,EAAiB,KCCjBE,GAAmB,MAA1B,MAAOA,GAIX,cAAO1tB,GACL,MAAO,CACLC,SAAUytB,GACVj8B,UAAW,GAEf,8CATWi8B,GAAmB,8BAAnBA,uCAFA,CAACF,IAAkBttB,QAAA,CAFpBytB,MAAiBjB,aAIhBgB,EAAmB,sECNzB,IAAMnF,EAAgB,MAAvB,MAAOA,EACX7U,cAAwC,GAExC,eAAO8U,CAAS/9B,EAAc4Y,GAC5BklB,EAAiBP,OAAOv9B,GAAQ4Y,CAClC,CAEArc,cAAe,CAOf6/B,eAAep8B,GACb,OAAO89B,EAAiBP,OAAOv9B,EACjC,4CAhBW89B,EAAgB,iCAAhBA,EAAgBjgC,QAAhBigC,EAAgBhgC,UAAAC,WAFf,gBAED+/B,CAAgB,qCCJvB,SAAUW,EAAsB5J,GACpC,GAAIA,EAAQiM,UAAW,CACrB,MAAMA,EAAYjM,EAAQiM,UAAU,IACpC,GAAIA,GAAaA,EAAUtC,SACzB,OAAO,CAEX,CAEA,QAAK3J,EAAgBf,eAMQt1B,IALHwE,OAAOC,KAAM4xB,EAAgBf,UAAUlV,KAC5D7b,GACQ07B,EAAuB5J,EAAgBf,SAAS/wB,IAO/D,CAEM,SAAUy5B,IACd,MAAO,CACLgC,SAAU,kCACV2E,MAAO,+BAEX,CAEM,SAAUzE,EACd7J,EACAuO,GAEA,MAEMC,EADYrgC,OAAOC,KADV4xB,EAAQwH,QAAU,IAG9Bpf,IAAKla,GAAgBqgC,EAASrgC,IAC9BmD,OAAQ8O,QAAgCxW,IAAZwW,GAC/B,OAAOquB,EAAcj9B,OAAS,EAAIi9B,EAAc,GAAK,EACvD,CAEM,SAAUhG,EAAiBV,GAC/B,OAAOA,EAAKa,OAAO9gB,OAAO,CAACC,EAAkB8gB,IACpC9gB,EAAIQ,OAAOsgB,EAAMF,QACvB,GAAGpgB,OAAOwf,EAAKY,QACpB,gKCzCO,MAAM+F,EAA0B,CACrC9X,KAAM,YACN+X,IAAK,qLAKMC,EAA6B,CACxChY,KAAM,eACN+X,IAAK,4YAKME,EAAuB,CAClCjY,KAAM,SACN+X,IAAK,wMAKMG,EAAiC,CAC5ClY,KAAM,mBACN+X,IAAK,qjBAKMI,EAAkC,CAC7CnY,KAAM,oBACN+X,IAAK,4dC3BA,IAAMK,EAAW,MAAlB,MAAOA,EAEDC,aACAC,UAFVvnC,YACUsnC,EACAC,GADAtnC,KAAAqnC,eACArnC,KAAAsnC,WACP,CAEHC,YAAY57B,GACV3L,KAAKqnC,aAAaG,kBAChB77B,EAAKqjB,KACLhvB,KAAKsnC,UAAUhuB,wBAAwB3N,EAAKo7B,KAEhD,4CAXWK,GAAWhmC,MAAAuE,MAAAvE,MAAAwE,MAAA,iCAAXwhC,EAAW/lC,QAAX+lC,EAAW9lC,UAAAC,WAFV,gBAED6lC,CAAW,KCAlB,SAAUK,EACdtxB,EAA6B,YAE7B,SAAOpL,OAAyB,CAC9ByE,KACA,CACE/E,QAASi9B,MACTC,WAAaN,GAAkC,IAC7CA,EAAaO,uBAAuB,oBAAoBzxB,KAC1D0xB,KAAM,CAACC,MACPl9B,OAAO,IAGb,yBCrBExJ,MAAA,qCAAUA,MAAA,UAAAqnB,EAAA9c,KAAAqjB,gCAEV5tB,MAAA,cAAUA,MAAA,GAAUA,8BAAVA,cAAAqnB,EAAA9c,OCSL,IAAMiE,EAAgB,MAAvB,MAAOA,EAcSm4B,YAbpB,QACIp8B,CAAKA,GACH3L,KAAKgoC,MAAMr8B,IACb3L,KAAKunC,YAAY57B,GAGnB3L,KAAKioC,MAAQt8B,CACf,CACA,QAAIA,GACF,OAAO3L,KAAKioC,KACd,CACQA,MAERloC,YAAoBgoC,GAAA/nC,KAAA+nC,aAA2B,CAE/CR,YAAY57B,GACV3L,KAAK+nC,YAAYR,YAAY57B,EAC/B,CAEAq8B,MAAMr8B,GACJ,MAAsB,iBAARA,CAChB,4CAtBWiE,GAAgBxO,MAAAuE,GAAA,+BAAhBiK,EAAgBtB,UAAA,eAAAC,OAAA,CAAA5C,KAAA,QAAA8C,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,gBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDV3B1N,MAFF,EAAA8mC,EAAA,iBAEE9mC,CAFiB,EAAA+mC,EAAA,UAAnB/mC,MAAA,EAAA2N,EAAAi5B,MAAAj5B,EAAApD,MAAA,oBCSY6D,KAAa5J,MAAA48B,cAAA,WAGZ5yB,CAAgB,gFCNtB,IAAM8sB,EAAmB,MAA1B,MAAOA,EAIS1pB,GAHXo1B,cAAwB,qCACxBC,WAAqB,EAE9BtoC,YAAoBiT,GAAAhT,KAAAgT,IAAiB,CAG9Bs1B,QAAQ5e,GACT1pB,KAAKqoC,UACProC,KAAKgT,GAAGC,cAAckD,MAAMlI,QAAU,OAEtCyb,EAAM9S,OAAO2xB,IAAMvoC,KAAKooC,aAE5B,4CAbW1L,GAAmBt7B,aAAA,+BAAnBs7B,EAAmBpuB,UAAA,0BAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAnB1N,MAAA,iBAAAqW,GAAA,OAAA1I,EAAAu5B,QAAA7wB,EAAe,wFAAfilB,CAAmB,qFCO1B,MAAOc,EAED/7B,KACA+mC,cAFVzoC,YACU0B,EACA+mC,GADAxoC,KAAAyB,OACAzB,KAAAwoC,eACP,CAKHpvB,UAAU7W,GACR,MAAM+C,EAAU,IAAInC,KAAY,CAC9B,eAAgB,aAChBslC,oBAAqB,QACrBC,eAAgB,UAGZC,EAAa,IAAI3+B,OACrBhK,KAAKwoC,eAAepoC,UAAU,aAAe,cAE/C,OAAIuoC,EAAWz+B,KAAK3H,KAClBA,EAAMA,EAAI24B,MAAMyN,GAAY,IAGvB3oC,KAAKyB,KACTvB,IAAIqC,EAAK,CACR+C,UACAsjC,aAAc,SAEf7kC,QACCG,KAAYC,IACVA,QAAIC,MAAMC,QAAS,EACnBF,EAAIC,MAAMykC,WAAY,EAChB1kC,KACP,EACD2kC,KAAWC,GACF,IAAInuB,IAAYouB,IACrB,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,cAAcJ,GACrBE,EAAOG,UAAY,KACjBJ,EAASrmC,KAAKsmC,EAAOI,QACrBL,EAASM,UAAQ,CACnB,IAIV,4CA7CW9L,GAAep8B,MAAAuE,KAAA,IAAAvE,MAAAwE,KAAA,uDAAf43B,EAAejkB,MAAA,EAAA9K,YAAA,KAS1Bg0B,QAAA,IAHC8G,KAAU,CACTC,cAAe,MAChB,EAACnG,EAAAC,IAAA,cAAA5H,WAAA,EAAA2H,EAAAC,IAAA,qBAAAmG,UAAA,EAAApG,EAAAC,IAAA,oBACsB1oB,MAAU4iB,EAAAxiB,UAAA,yOCrBlC5Z,MAAA,wDAEEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,GAAAlK,MAAA,UAAAA,MAASkK,GAAAo+B,uBAAsB,GAc/BtoC,MAAA,gBACFA,iCAHEA,MAXA,UAAAkK,EAAAq+B,WAWAvoC,CAXsB,aAAAkK,EAAAs+B,mBAAAxoC,MAAA,+DAAAA,MAAA,wDAWtBA,CADC,WAAAkK,EAAAs+B,oBAGSxoC,MAAA,GAAAA,MAAA,OAAAkK,EAAAu+B,2DAIVzoC,MAAA,cACEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,GAAAlK,MAAA,UAAAA,MAASkK,GAAAo+B,uBAAsB,GAQ/BtoC,MAAA,8DAEAA,MAAA,0DAWFA,iCAfEA,MALA,UAAAkK,EAAAq+B,WAKAvoC,CALsB,WAAAkK,EAAAs+B,oBAOtBxoC,cAAA,IAAAA,MAAA,kDAAAA,MAAA,KAAAA,MAAA,IAAAkK,EAAAw+B,yBAAA,KAGE1oC,MAAA,GAEAA,MAFA,UAAAkK,EAAAu+B,iBAAA7a,KAEA5tB,CAFiC,aAAAkK,EAAAs+B,mBAAAxoC,MAAA,gEAAAA,MAAA,oFAjCzCA,MAAA,GAoBEA,MAnBA,EAAA2oC,EAAA,eAmBA3oC,CAJC,EAAA4oC,EAAA,0BAAA5oC,gDAdEA,QAA8BA,MAA9B,gBAAAkK,EAAA2+B,YAA8B7oC,CAAA,WAAA8oC,ICiC5B,IAAMC,EAAwB,MAA/B,MAAOA,EAqFDC,uBACAC,YACAtC,YAtFV8B,iBAAmB1C,KAKVmD,YAAsB,GACtBL,YACAH,0BAA6ClmC,MAAG,OAEzD+lC,WACE,MAAO,CACL,wBAA8C,SAArB3pC,KAAKiqC,YAC9B,mBAAyC,WAArBjqC,KAAKiqC,YAE7B,CAEA,WAAIM,GACF,OAAOvqC,KAAKqqC,YAAYE,OAC1B,CAEAC,iBACE,OAAIxqC,KAAKsqC,YACAtqC,KAAKsqC,YAELtqC,KAAKyqC,cAEhB,CAEA,kBAAIA,GACF,GAAIzqC,KAAKuqC,QACP,OAAIvqC,KAAK0qC,aACA1qC,KAAKuqC,QAAQI,YAAYhR,WAAW3K,KAEpC,QAKb,CAEA,gBAAI0b,GACF,GAAI1qC,KAAKuqC,QACP,YAA+CvoC,IAAxChC,KAAKuqC,QAAQI,YAAYhR,UAIpC,CAEA,kBAAIiR,GACF,QAA4B,UAAxB5qC,KAAKyqC,iBAA+BzqC,KAAKsqC,cAGtCtqC,KAAKoqC,uBAAuBS,qBACjC7qC,KAAKwqC,iBAET,CAEA,kBAAIM,GAEF,IAAIC,EAMAC,EAJJ,OADAD,EAAW/qC,KAAK4qC,gBACC,IAAbG,KAKA/qC,KAAKoqC,uBAAuB9e,aAC9B0f,EAAkBhrC,KAAKirC,uBACC,IAApBD,GAKR,CAEA,yBAAIC,GACF,OAAOjrC,KAAKoqC,uBAAuBa,uBACrC,CAEA,sBAAIrB,GACF,OAAO5pC,KAAKoqC,uBAAuBR,mBAAmB5pC,KAAKyqC,eAC7D,CAEA1qC,YACUqqC,EACAC,EACAtC,IAFA/nC,KAAAoqC,yBACApqC,KAAAqqC,cACArqC,KAAA+nC,eAER/nC,KAAK+nC,YAAYR,YAAYvnC,KAAK6pC,iBACpC,CAEAH,uBACE,MAAMwB,EAAOlrC,KAAKwqC,iBACdU,GACFlrC,KAAKoqC,uBAAuBe,UAAUD,EAI1C,4CAnGWf,GAAwB/oC,MAAAuE,KAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,+BAAxBskC,EAAwB77B,UAAA,2BAAAC,OAAA,CAAA+7B,YAAA,cAAAL,YAAA,cAAAH,uBAAA,0BAAAr7B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,8hBAAAC,SAAA,SAAAC,EAAAC,IAAA,EAAAD,GDnCrC1N,MAAA,EAAAgqC,EAAA,2BAAehqC,MAAA,OAAA2N,GAAA+7B,+BCyBX37B,KACAI,KAAezJ,UACfwJ,KACAD,KAAgBtJ,KAChByJ,KAAaxJ,KACb0J,KACAC,KAAiBgF,KACjB/E,MAAgBC,OAAA,yZAAA2yB,cAAA,WAGP2H,CAAwB,uGCxB9B,IAAMkB,EAAqB,MAA5B,MAAOA,EAKD5pC,KACA+mC,cALF8C,QACAC,gBAERxrC,YACU0B,EACA+mC,GADAxoC,KAAAyB,OACAzB,KAAAwoC,gBAERxoC,KAAKsrC,QAAUtrC,KAAKwrC,qBACtB,CAEOC,iBACLzrC,KAAK0rC,UAAU7oC,UACZoB,IACCjE,KAAKurC,gBAAkBtnC,GAExBE,IACC,MAAM,IAAI6d,MACR,mIAAkI,EAI1I,CAEOwpB,sBACL,OACExrC,KAAKwoC,cAAcpoC,UAAU,qCAC7B,+BAEJ,CAEOsrC,UACL,OAAO1rC,KAAKyB,KAAKvB,IAAIF,KAAKsrC,SAASvnC,QACjCG,KAAYynC,IACVA,QAAEvnC,MAAMC,QAAS,EACXsnC,IAGZ,CAEOC,kBAAkBC,GACvB,QAA6B7pC,IAAzBhC,KAAKurC,gBACP,OAEF,IAAIO,EAAmBD,EACvBC,SAAmBA,EAAiBpT,QAAQ,MAAO,IAC5C14B,KAAKurC,gBAAgBO,EAC9B,4CA/CWT,GAAqBjqC,MAAAuE,MAAAvE,MAAAwE,MAAA,iCAArBylC,EAAqBhqC,QAArBgqC,EAAqB/pC,mBAArB+pC,CAAqB,uICS3B,IAAMU,EAAsB,MAA7B,MAAOA,EAKDvD,cACAx2B,aACArQ,gBACAqqC,sBACAC,gBARFC,aACAC,UAAY,EAEpBpsC,YACUyoC,EACAx2B,EACArQ,EACAqqC,EACAC,GAJAjsC,KAAAwoC,gBACAxoC,KAAAgS,eACAhS,KAAA2B,kBACA3B,KAAAgsC,wBACAhsC,KAAAisC,kBAEJjsC,KAAKosC,iBACPpsC,KAAKgsC,sBAAsBP,gBAE/B,CAEOW,gBACL,MAAMrB,EAAW/qC,KAAKwoC,cAAcpoC,UAClC,2CAEF,YAAiB4B,IAAb+oC,GAGKA,CAEX,CAEOF,qBAAqBgB,GAG1B,YAA+B7pC,IAD7BhC,KAAKgsC,sBAAsBJ,kBAAkBC,EAMjD,CAEOjC,mBAAmBiC,GACxB,MAAMQ,EACJrsC,KAAKgsC,sBAAsBJ,kBAAkBC,GAE/C,GAAIQ,GAAYC,WACd,UAAWC,KAAaF,GAAYC,WAClC,GAA0C,OAAtChkC,SAAS2N,cAAcs2B,GACzB,OAAO,EAIb,OAAO,CACT,CAEOjhB,WACL,OAAOtrB,KAAKgS,aAAasZ,UAC3B,CAEO2f,wBACL,MAAMuB,EAAexsC,KAAKwoC,cAAcpoC,UACtC,gCAGF,YAAwB4B,IAAjBwqC,GAAoCA,CAC7C,CAEQC,WAAWC,GACjB,MAAmB,iBAAfA,EACK,CACL,CACEC,QAAS,0BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,SAIO,UAAfkpC,EACK,CACL,CACEC,QAAS,4BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,UAER,CACEmpC,QAAS,0BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,SAKO,SAAfkpC,EACK,CACL,CACEC,QAAS,4BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,QAER,CACEmpC,QAAS,0BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,WAKL,CACL,CACEmpC,QAAS,4BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,QAER,CACEmpC,QAAS,0BACTC,KAAM5sC,KAAK2B,gBAAgB4pB,UAAUshB,QACnC,yCAEFrpC,KAAM,QAGZ,CAEQspC,UAAUC,GAIhB,MAHe,CACb71B,MAAO,SAEK61B,EAAW5U,cAC3B,CAEQ6U,cACN,MAAMC,EAAOjtC,KACb,IAAIktC,EAAQ,EACZ,MACMC,EAAaC,YAAY,KAC7B,GAAIH,EAAKI,iBACP,IACEJ,EAAKI,iBAAiBxtC,QAAQytC,SAASjlC,UACtCC,SAAS2N,cACRg3B,EAAKI,iBAAiBxtC,QAAQytC,SAASjlC,SAKzC,OAFA4kC,EAAK7H,cACLmI,cAAcJ,GAET,CACL,MAAMK,EAAqBP,EAAKI,iBAAiBI,aAC7CD,GACmBA,EAAmBE,iBACtC,qCAEWnzB,QAASlS,IACpBA,EAAQslC,UAAUC,IAAI,iBAAgB,GAG1C,MAAMC,EAASL,EACXA,EAAmBv3B,cAAc,yBACjCjU,EAOJ,GALAkrC,KACIW,GAAUX,EA3BL,KA4BPK,cAAcJ,GAGZU,EAAQ,CACV,MAAMC,EAAab,EAAKc,MAClBC,EAAW1lC,SAASC,cAAc,QACxCylC,EAASlP,UAAY,oBACrBkP,EAASC,UAAY,GACnBH,EAAWplC,QAAQukC,EAAKI,kBAAoB,KAC1CS,EAAWlkC,SACfikC,EAAOK,aACLF,EACAR,EAAmBv3B,cAAc,yBAErC,CACF,IAED,IACL,CAEQk4B,UAAUlvB,EAAOisB,EAAMkD,GAC7B,GAAIlD,EAAKmC,iBAAkB,CACzB,GACEnC,EAAKmC,iBAAiBxtC,QAAQytC,SAASjlC,SACvCC,SAAS2N,cAAci1B,EAAKmC,iBAAiBxtC,QAAQytC,SAASjlC,SAG9D,YADA6iC,EAAK5B,WAIP,GAAIrqB,EAAMA,QAAUisB,EAAK6C,MAAMnkC,OAAS,EAEtC,YADAshC,EAAK5B,WAIP4B,EAAK6C,MAAMloB,OAAO5G,EAAMA,MAAO,GAC/B,MAAMovB,EAAWnD,EAAK6C,MAAM9uB,EAAMA,OAEhCovB,EAASxuC,QAAQytC,SAASjlC,UACzBC,SAAS2N,cAAco4B,EAASxuC,QAAQytC,SAASjlC,SAElD+lC,EAAQD,UAAUlvB,EAAOisB,EAAMkD,IAE/BlD,EAAKoD,cACLpD,EAAKqD,KAAKF,EAASn8B,IAEvB,CACF,CAEQs8B,cACNzd,EACA0d,GAMA,IAJKA,GAKHA,EAAalC,YAC0B,MAArCkC,EAAalC,UAAUmC,OAAO,IAC9BpmC,SAAS2N,cAAcw4B,EAAalC,UAAU1oB,MAAM,KACd,MAArC4qB,EAAalC,UAAUmC,OAAO,KAC5BpmC,SAAS2N,cAAcw4B,EAAalC,YAEzC,OAGF,MAAMlkC,EAAuBC,SAAS2N,cACpCw4B,EAAapmC,SAAW0oB,EAAK1oB,SAEzBqD,EAAS1L,KAAK8sC,UAAU2B,EAAa/iC,QACvCrD,GAAWqD,GACbrD,EAAQqD,IAEZ,CAEQijC,qBACN5d,EACA0d,GAEA,OAAO,IAAIG,QAAeC,IAExB,GADA7uC,KAAKwuC,cAAczd,EAAM0d,IACpBA,IAAiBA,EAAaK,QAEjC,YADAD,IAGF,IAAI3B,EAAQ,EACZ,MAAM6B,EAASN,EAAaO,QAAUP,EAAaO,QAAU,IAAM,GAC7D7B,EAAaC,YAAY,KAC7BF,KACIA,EAAQ6B,GAAUzmC,SAAS2N,cAAcw4B,EAAaK,YACxDvB,cAAcJ,GACd0B,IAAO,EAER,IAAG,EAEV,CAEQI,iBAAiBC,GACvB,MAAMC,EAA6C,GAEnD,IAAIC,EAAI,EACR,UAAWre,KAAQme,EAAWnB,MAAO,CACnC,MAAMsB,EAAWte,EAAKse,UAAYH,EAAWG,SAC7CF,EAAc7nC,KAAK,CACjBgmC,SAAU,CACRjlC,QAAS0oB,EAAK1oB,QACdinC,GAAID,GAENE,kBAAmB,CACjBC,WAAY,CACG,SAAbH,IAAa,EAAUI,SAAa,EACpCC,MAAO,CAAEC,SAAU,MACnBjmC,OAAOkmC,UAEXC,kBAAmBA,IACVjB,QAAQ3sB,IAAI,CACjBjiB,KAAK2uC,qBACH3uC,KAAKksC,aACLlsC,KAAKksC,aAAelsC,KAAKksC,aAAa4D,kBAAe9tC,GAEvDhC,KAAK2uC,qBAAqB5d,EAAMA,EAAKgf,cAGzCxP,QAASvgC,KAAKysC,WACN,IAAN2C,EACI,QACAA,EAAI,IAAMF,EAAWnB,MAAMnkC,OACzB,OACAslC,EAAWnB,MAAMqB,GAAGY,aAClB,oBACAhuC,GAEV2qC,QAAS5b,EAAK9B,MACdghB,eAAgBlf,EAAKkf,eACrBC,SAAUnf,EAAKof,iBAAmBjB,EAAWiB,kBAAmB,EAChEC,eAAgBrf,EAAKsf,oBAChBtf,EAAKsf,wBACNruC,EACJ4J,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC9b,EAAKnlB,OAASsjC,EAAWtjC,OAE3BghC,KAAM,CAAC5sC,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ9b,EAAK6b,OACnD0D,KAAM,CACJ/B,KAAMA,KACJvuC,KAAKwuC,cAAczd,EAAMA,EAAKwf,OAAM,EAEtC5N,KAAMA,KACJ3iC,KAAKksC,aAAenb,EACpB/wB,KAAKwuC,cAAczd,EAAMA,EAAKyf,OAAM,KAI1CpB,GACF,CAEA,OAAOD,CACT,CAEOhE,UAAUU,GACf,MAAMQ,EACJrsC,KAAKgsC,sBAAsBJ,kBAAkBC,GAE/C7rC,KAAKisC,gBAAgBwE,mBAAqB,CACxC9D,QAASN,EAAWpd,MACpBghB,eAAgB5D,EAAW4D,eAC3BG,gBAAgB/D,EAAWgE,qBACtBhE,EAAWgE,mBAEhBK,WAAY,CACVC,SAAS,IAIb,MAAMxB,EAAgBnvC,KAAKivC,iBAAiB5C,GAE5CrsC,KAAKisC,gBAAgB2E,OAAQ,EAC7B5wC,KAAKisC,gBAAgB4E,eAAgB,EACrC7wC,KAAKisC,gBAAgB6E,SAAS3B,GAE9BnvC,KAAKisC,gBAAgB8E,WAAWzB,GAAG,OAAQtvC,KAAKgtC,aAChDhtC,KAAKisC,gBAAgB8E,WAAWzB,GAAG,SAAWrwB,IAC5Cjf,KAAKmuC,UAAUlvB,EAAOjf,KAAKisC,gBAAgB8E,WAAY/wC,KAAI,GAG7DA,KAAKisC,gBAAgB+E,OACvB,4CAnWWjF,GAAsB3qC,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,KAAA1E,MAAA2E,KAAA,iCAAtBgmC,EAAsB1qC,QAAtB0qC,EAAsBzqC,UAAAC,WAFrB,gBAEDwqC,CAAsB,4HCT5B,IAAMkF,EAAwB,MAA/B,MAAOA,+CAAwB,8BAAxBA,sCAFA,CAAClF,IAAwBV,KAAsBpyB,QAAA,CAFhDkxB,cAIC8G,CAAwB,gFCG9B,IAAMC,EAAiB,MAAxB,MAAOA,EAoGFv6B,SACA3D,GApGTyZ,kBAAoB,wBACpBA,mBAAqB,yBACrBA,mBAAqB,yBAErB,SACIlhB,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,GACR1G,KAAKmxC,OAASzqC,CAChB,CACQyqC,OAAS,UAEjB,WACIC,GACF,OAAOpxC,KAAKqxC,QACd,CACA,WAAID,CAAQ1qC,GACNA,IAAU1G,KAAKqxC,WAGfrxC,KAAKmN,WAITzG,EAAQ1G,KAAKsxC,YAAYljC,KAAKpO,MAAQA,KAAKuxC,cAAcnjC,KAAKpO,MAE9DA,KAAKqxC,SAAW3qC,GACM,IAAlB1G,KAAKwoB,UACPxoB,KAAKwxC,qBAGP9qC,EAAQ1G,KAAKyxC,MAAMrjC,KAAKpO,MAAQA,KAAK0xC,QAAQtjC,KAAKpO,OACpD,CACQqxC,UAAW,EAEnB,YACI7oB,GACF,OAAOxoB,KAAK6sB,SACd,CACA,YAAIrE,CAAS9hB,GACPA,IAAU1G,KAAK6sB,YAGf7sB,KAAKmN,WAITzG,EAAQ1G,KAAK2xC,aAAavjC,KAAKpO,MAAQA,KAAK4xC,eAAexjC,KAAKpO,MAEhEA,KAAK6sB,UAAYnmB,EACjB1G,KAAKqxC,SAAW3qC,EAChB1G,KAAK6xC,sBAELnrC,EAAQ1G,KAAKitB,OAAO7e,KAAKpO,MAAQA,KAAK8xC,SAAS1jC,KAAKpO,OACtD,CACQ6sB,WAAY,EAEpB,YACI1f,GACF,OAAOnN,KAAK+xC,SACd,CACA,YAAI5kC,CAASzG,GACPA,IAAU1G,KAAK+xC,aAIL,IAAVrrC,IACF1G,KAAKwoB,UAAW,GAGlB9hB,EAAQ1G,KAAKgyC,cAAc5jC,KAAKpO,MAAQA,KAAKiyC,aAAa7jC,KAAKpO,MAE/DA,KAAK+xC,UAAYrrC,EACjB1G,KAAKkyC,sBAELxrC,EAAQ1G,KAAKm5B,QAAQ/qB,KAAKpO,MAAQA,KAAKoiC,OAAOh0B,KAAKpO,MACrD,CACQ+xC,WAAY,EAEVJ,aAAe,IAAIrkC,MACnBgkC,YAAc,IAAIhkC,MAClBskC,eAAiB,IAAItkC,MACrBikC,cAAgB,IAAIjkC,MACpB0kC,cAAgB,IAAI1kC,MACpB2kC,aAAe,IAAI3kC,MACnBmkC,MAAQ,IAAInkC,MACZokC,QAAU,IAAIpkC,MACd2f,OAAS,IAAI3f,MACbwkC,SAAW,IAAIxkC,MACf6rB,QAAU,IAAI7rB,MACd80B,OAAS,IAAI90B,MAGvBxB,UACE9L,KAAKwoB,UAAW,CAClB,CAEAzoB,YACS4W,EACA3D,GADAhT,KAAA2W,WACA3W,KAAAgT,IACN,CAEHm/B,eAGE,OAAOnyC,KAAKgT,GAAGC,cAAcm/B,UAAYC,CAC3C,CAEQb,qBACFxxC,KAAKoxC,QACPpxC,KAAKktB,OAAOgkB,EAAkBoB,YAE9BtyC,KAAKqtB,UAAU6jB,EAAkBoB,WAErC,CAEQT,sBACF7xC,KAAKwoB,UACPxoB,KAAKktB,OAAOgkB,EAAkB/jB,aAC9BntB,KAAKqtB,UAAU6jB,EAAkBoB,aAEjCtyC,KAAKqtB,UAAU6jB,EAAkB/jB,YAErC,CAEQ+kB,sBACFlyC,KAAKmN,SACPnN,KAAKktB,OAAOgkB,EAAkBqB,aAE9BvyC,KAAKqtB,UAAU6jB,EAAkBqB,YAErC,CAEQrlB,OAAOS,GACb3tB,KAAK2W,SAASQ,SAASnX,KAAKgT,GAAGC,cAAe0a,EAChD,CAEQN,UAAUM,GAChB3tB,KAAK2W,SAASS,YAAYpX,KAAKgT,GAAGC,cAAe0a,EACnD,4CA7IWujB,GAAiB9vC,0BAAA,+BAAjB8vC,EAAiB5iC,UAAA,wBAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAjB1N,MAAA,0BAAA2N,EAAAjD,SAAS,0YAATolC,CAAiB,+BCFvB,IAAMsB,EAAiB,MAAxB,MAAOA,EAcSx/B,GAbVy/B,SAAW,IAAInlC,MAGzBolC,iBAAiBhpB,EAAmB9S,GAC7BA,IAIA5W,KAAKgT,GAAGC,cAAc0/B,SAAS/7B,IAClC5W,KAAKyyC,SAASrkC,KAAKsb,GAEvB,CAEA3pB,YAAoBiT,GAAAhT,KAAAgT,IAAiB,4CAd1Bw/B,GAAiBpxC,aAAA,+BAAjBoxC,EAAiBlkC,UAAA,wBAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAjB1N,MAAA,iBAAAqW,GAAA,OAAA1I,EAAA2jC,iBAAAj7B,IAAAb,OACK,KAAAxV,6DADLoxC,CAAiB,yCCevB,IAAMI,EAAa,MAApB,MAAOA,EA2DS5/B,GA1DpB,cACI6/B,GACF,OAAO7yC,KAAK8yC,WACd,CACA,cAAID,CAAWnsC,GACb1G,KAAK8yC,YAAcpsC,CACrB,CACQosC,aAAc,EAEtB,aACIpmB,GACF,OAAO1sB,KAAK+yC,UACd,CACA,aAAIrmB,CAAUhmB,GACZ1G,KAAK+yC,WAAarsC,CACpB,CACQqsC,YAAa,EAErB,gBAAIC,GACF,OAAOhzC,KAAKizC,aACd,CACA,gBAAID,CAAatsC,GACf1G,KAAKkzC,YAAcxsC,EACnB1G,KAAKizC,cAAgBvsC,CACvB,CACQusC,cAER,eAAIC,GACF,OAAOlzC,KAAKmzC,YACd,CACA,eAAID,CAAYxsC,GACd1G,KAAKmzC,aAAezsC,CACtB,CACQysC,aAEAC,kBACAC,YACAx5B,cAAgC,GAGxCy5B,UAIAC,oBAAoB7pB,GAId1pB,KAAKozC,oBACW,YAAd1pB,EAAMnjB,KAAmC,cAAdmjB,EAAMnjB,KACnCmjB,EAAM2E,iBACNruB,KAAKwzC,SAAS9pB,EAAMnjB,MACG,UAAdmjB,EAAMnjB,KACfvG,KAAKitB,OAAOjtB,KAAKkzC,aAGvB,CAEAnzC,YAAoBiT,GAAAhT,KAAAgT,IAAiB,CAErCzF,WACEvN,KAAKyzC,kBACP,CAEAC,kBACM1zC,KAAKszC,UAAU1pC,QACjB5J,KAAK2zC,OAGP3zC,KAAKqzC,YAAcrzC,KAAKszC,UAAU1/B,QAAQ/Q,UACvC+wC,GAA+B5zC,KAAK2zC,OAEzC,CAEAzlC,cACElO,KAAKqzC,YAAYllC,aACnB,CAEAsjC,MAAM5Z,GACC73B,KAAK0sB,YAIV1sB,KAAK0xC,eAIQ1vC,IAAT61B,IACFA,EAAKuZ,SAAU,GAEnB,CAEAM,eAC2B1vC,IAArBhC,KAAKkzC,cACPlzC,KAAKkzC,YAAY9B,SAAU,GAG7BpxC,KAAKkzC,iBAAclxC,CACrB,CAEA6xC,YACE,MAAMD,EAAQ5zC,KAAKszC,UAAUQ,UAC7B,IAAIjc,EACJ,MAAMkc,EAAU/zC,KAAKgT,GAAGC,cACxB,IAAI9F,GAAW,EACX8R,EAAQjf,KAAKg0C,kBAKjB,SAJchyC,IAAVid,IACFA,GAAQ,GAGH9R,GAAY8R,EAAQ20B,EAAMhqC,OAAS,GACxCqV,GAAS,EACT4Y,EAAO+b,EAAM30B,GACb9R,EAAW0qB,EAAK1qB,cAGLnL,IAAT61B,GACF73B,KAAKyxC,MAAM5Z,GAGR+b,EAAM30B,EAAQ,QAKNjd,IAAT61B,IAAuB73B,KAAKi0C,mBAAmBpc,EAAK7kB,GAAGC,iBACzD8gC,EAAQ1gC,UACNwkB,EAAK7kB,GAAGC,cAAcm/B,UACtBva,EAAK7kB,GAAGC,cAAcwtB,SAAS,GAAGyT,aAClCH,EAAQ7gC,cARV6gC,EAAQ1gC,UAAY0gC,EAAQ5gC,aAAe4gC,EAAQ7gC,YAUvD,CAEAihC,gBACE,MAAMP,EAAQ5zC,KAAKszC,UAAUQ,UAC7B,IAAIjc,EACJ,MAAMkc,EAAU/zC,KAAKgT,GAAGC,cACxB,IAAI9F,GAAW,EACX8R,EAAQjf,KAAKg0C,kBAEjB,KAAO7mC,GAAY8R,EAAQ,GACzBA,GAAS,EACT4Y,EAAO+b,EAAM30B,GACb9R,EAAW0qB,EAAK1qB,cAGLnL,IAAT61B,GACF73B,KAAKyxC,MAAM5Z,GAGR+b,EAAM30B,EAAQ,QAKNjd,IAAT61B,IAAuB73B,KAAKi0C,mBAAmBpc,EAAK7kB,GAAGC,iBAEzD8gC,EAAQ1gC,UAAYwkB,EAAK7kB,GAAGC,cAAcm/B,UAAYC,GANtD0B,EAAQ1gC,UAAY,CAQxB,CAEA4Z,OAAO4K,GACA73B,KAAK0sB,YAIV1sB,KAAK8xC,gBAEQ9vC,IAAT61B,IACFA,EAAKrP,UAAW,GAEpB,CAEAspB,WACE9xC,KAAK0xC,eAEqB1vC,IAAtBhC,KAAKgzC,eACPhzC,KAAKgzC,aAAaxqB,UAAW,GAG/BxoB,KAAKgzC,kBAAehxC,CACtB,CAEAyxC,mBACMzzC,KAAK6yC,aACP7yC,KAAKozC,mBAAoB,EAE7B,CAEAgB,oBACEp0C,KAAKozC,mBAAoB,CAC3B,CAEAiB,aAAaxc,GACX73B,KAAKgT,GAAGC,cAAcI,UAAYwkB,EAAKsa,cACzC,CAEA8B,mBAAmBK,GACjB,MAAMC,EACJv0C,KAAKgT,GAAGC,cAAcI,UAAYrT,KAAKgT,GAAGC,cAAcm/B,UAGpDoC,EAAUF,EAAKlC,UAErB,OADmBoC,EAAUF,EAAK7T,SAAS,GAAGyT,cAHxBK,EAAav0C,KAAKgT,GAAGC,cAAcC,cAInBshC,GAAWD,CACnD,CAEQZ,OACN3zC,KAAK6C,YAEL7C,KAAKgzC,aAAehzC,KAAKy0C,mBACzBz0C,KAAKkzC,YAAclzC,KAAK00C,kBAExB10C,KAAKyzC,kBACP,CAEQ5wC,YACN7C,KAAKmO,cAELnO,KAAKszC,UAAUQ,UAAUv5B,QAASsd,IAChC73B,KAAK6Z,cAAcvS,KACjBuwB,EAAK8Z,aAAa9uC,UAAW8xC,GAC3B30C,KAAK40C,uBAAuBD,KAIhC30C,KAAK6Z,cAAcvS,KACjBuwB,EAAK5K,OAAOpqB,UAAW8xC,GACrB30C,KAAK60C,iBAAiBF,KAI1B30C,KAAK6Z,cAAcvS,KACjBuwB,EAAKyZ,YAAYzuC,UAAW8xC,GAC1B30C,KAAK80C,sBAAsBH,KAI/B30C,KAAK6Z,cAAcvS,KACjBuwB,EAAK4Z,MAAM5uC,UAAW8xC,GACpB30C,KAAK+0C,gBAAgBJ,IACtB,EAEF30C,KACL,CAEQmO,cACNnO,KAAK6Z,cAAcU,QAAS8R,GAAsBA,EAAIle,eACtDnO,KAAK6Z,cAAgB,EACvB,CAEQi7B,sBAAsBjd,GACxBA,IAAS73B,KAAKkzC,aAChBlzC,KAAK0xC,SAET,CAEQqD,gBAAgBld,GACtB73B,KAAKkzC,YAAcrb,CACrB,CAEQ+c,uBAAuB/c,GACzBA,IAAS73B,KAAKkzC,aAChBlzC,KAAK8xC,UAET,CAEQ+C,iBAAiBhd,GACvB73B,KAAKgzC,aAAenb,CACtB,CAEQ4c,mBACN,OAAOz0C,KAAKszC,UAAUQ,UAAU1xB,KAAMyV,GAASA,EAAKrP,SACtD,CAEQksB,kBACN,OAAO10C,KAAKszC,UAAUQ,UAAU1xB,KAAMyV,GAASA,EAAKuZ,QACtD,CAEQ4C,kBACN,OAAOh0C,KAAKszC,UACTQ,UACAkB,UAAWnd,GAASA,IAAS73B,KAAKkzC,YACvC,CAEQM,SAASjtC,GACf,OAAQA,GACN,IAAK,UACHvG,KAAKm0C,gBACL,MACF,IAAK,YACHn0C,KAAK6zC,YAKX,4CAzSWjB,GAAaxxC,aAAA,+BAAbwxC,EAAatkC,UAAA,eAAA2mC,eAAA,SAAAnmC,EAAAC,EAAAmmC,MAAA,EAAApmC,WAwCPoiC,EAAiB,kFAxCvB9vC,MAAA,mBAAAqW,GAAA,OAAA1I,EAAAwkC,oBAAA97B,EAA2B,KAAArW,MAA3BA,CAAa,iBAAAqW,GAAA,OAAb1I,EAAAwkC,oBAAA97B,EAA2B,KAAArW,kOC3BxCA,MAAA,gBAIEA,MADA,6BAAY2N,EAAAqlC,mBAAmB,EAC/BhzC,CADgC,0BACvB2N,EAAA0kC,kBAAkB,GAE3BryC,MAAA,GACFA,cALEA,MAAA,UAAAA,MAAA,EAAA+zC,EAAApmC,EAAA2d,2BDuBUtd,KAAazJ,KAAE6sC,EAAmBljC,MAAOO,OAAA,i0BAExC+iC,CAAa,0SErBxBxxC,MANF,UAMEA,CADD,WAEGA,MAAA,KACFA,QACAA,MAAA,UACEA,MAAA,GACAA,MAAA,KACFA,QACAA,MAAA,WACEA,MAAA,KAEJA,gCAZEA,MAAA,UAAAA,MAAA,EAAAg0C,GAAA,IAAA3sB,EAAA4sB,gBAMEj0C,MAAA,GAAAA,MAAA,IAAAqnB,EAAA7c,MAAA,MCMG,IAAM0pC,EAAc,MAArB,MAAOA,EACF1pC,MAET,cAEI2pC,GACF,OAAOv1C,KAAKw1C,WACd,CACA,cAAID,CAAW7uC,GACb1G,KAAKw1C,YAAc9uC,CACrB,CACQ8uC,aAAc,EAEbH,eAAyB,6CAbvBC,EAAc,+BAAdA,EAAchnC,UAAA,gBAAA4F,SAAA,EAAAC,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAd1N,MAAA,wBAAA2N,EAAAwmC,mZDhBbn0C,MAAA,EAAAq0C,EAAA,aAiBAr0C,MAAA,WACEA,MAAA,GACFA,cAlBGA,MAAA,OAAA2N,EAAAwmC,2BCaSpmC,KAAMG,MAAOO,OAAA,mzBAAAC,gBAAA,WAEZwlC,CAAc,0LCHpB,IAAMI,EAAgB,MAAvB,MAAOA,EACJC,OAAmC,IAAI5zC,KAAgB,GAE9D,SACI6zC,CAAMlvC,GACR1G,KAAK21C,OAAOhzC,KAAK+D,EACnB,CACA,SAAIkvC,GACF,OAAO51C,KAAK21C,OAAOjvC,KACrB,CAEA3G,cAAe,CAEfwuC,OACEvuC,KAAK41C,OAAQ,CACf,CAEAjT,OACE3iC,KAAK41C,OAAQ,CACf,4CAnBWF,EAAgB,+BAAhBA,EAAgBpnC,UAAA,kBAAAC,OAAA,CAAAqnC,MAAA,SAAAnnC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,sFAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICb7B1N,MAAA,4BAOEA,MADA,UACAA,CAD0C,4BAK5CA,cAVEA,MAAA,UAAAA,MAAA,EAAAoW,EAAApW,MAAA,IAAA2N,EAAA4mC,yBDUUrmC,KAASumC,KAAoBnmC,MAASG,OAAA,keAErC6lC,CAAgB,uEEPtB,ICAMjY,EAAwB,MAA/B,MAAOA,EAEJ3xB,QAAQ4d,GACbA,EAAM+E,iBACR,4CAJWgP,EAAwB,+BAAxBA,EAAwBnvB,UAAA,+BAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAxB1N,MAAA,iBAAAqW,GAAA,OAAA1I,EAAAjD,QAAA2L,EAAe,2BAAfgmB,CAAwB,6GCG/B,MAAOqY,EAkCSj2C,QA9BpB8qC,YAAqC,IAAI5oC,SAAgBC,GAKzD+zC,SAAsC,IAAIh0C,IAAgB,IAKlDi0C,aAKAC,kBAA8B,GAC9BC,iBACAC,gBAKAjmC,MAAQ,IAAI7E,KAAkB,GAAI,CACxCgU,OAAS+2B,IAAeA,GAAKpnB,OAG/B,UAAIqnB,GACF,OAAOr2C,KAAKkQ,MAAMuU,SACpB,CAEA1kB,YAAoBF,GAA0B,IAA1BG,KAAAH,WAClBG,KAAKs2C,WAAWz2C,GAAQ02C,SACxBv2C,KAAKw2C,WACP,CAKAziC,UACE/T,KAAKg2C,aAAa7nC,cAClBnO,KAAKkQ,MAAM6D,SACb,CAOA0iC,QAAQznB,IACN,OAAOhvB,KAAKkQ,MAAMhQ,IAAI8uB,GACxB,CAMA0nB,WACE,OAAO12C,KAAKkQ,MAAM+R,KACpB,CAMA00B,SAASC,IACP52C,KAAKkQ,MAAMgV,KAAK0xB,GAClB,CAMAC,aACE,OAAO72C,KAAK+1C,SAASpc,UACvB,CAMA2c,WAAWC,IACTv2C,KAAK+1C,SAASpzC,KAAK4zC,IAAW,GAChC,CAOAO,aAAa9nB,GAAcnvB,EAAkC,IAC3D,MAAMu2C,EAAOp2C,KAAKy2C,QAAQznB,SACbhtB,IAATo0C,GAIJp2C,KAAKkQ,MAAMM,MAAMmP,OAAOy2B,EAAM,CAAEzuB,QAAQ,EAAM9nB,YAAW,EAC3D,CAKAk3C,uBACE,GAAI/2C,KAAKi2C,kBAAkBrsC,QAAU,EAEnC,YADA5J,KAAKg3C,iBAGP,MAAOC,GAAUC,GAAWl3C,KAAKi2C,kBAAkBpwB,QAAO,EAAI,GAC9D7lB,KAAK82C,aAAaG,GACpB,CAEAE,6BACE,MAAO,CAACn3C,KAAKk2C,iBAAkBl2C,KAAKm2C,gBACtC,CAuCAa,iBACEh3C,KAAKo3C,yBACLp3C,KAAKkQ,MAAMM,MAAM8P,UAAU,CAAEqH,QAAQ,GACvC,CAKQ6uB,YACNx2C,KAAKkQ,MAAQ,IAAI7E,KAAkB,GAAI,CACrCgU,OAASrB,IAAiBA,GAAOgR,OAGnChvB,KAAKg2C,aAAeh2C,KAAKkQ,MAAMwU,UAC5BrC,SAAUkE,KAAuD,IAAxBA,GAAO/V,MAAMmX,QACtD9kB,UAAW0jB,KACV,QAAevkB,IAAXukB,GAEF,YADAvmB,KAAKq3C,mBAAcr1C,GAIrB,MAAMo0C,EAAO7vB,GAAOvI,OACdne,EAAU2G,OAAO6H,OACrB,GACA+nC,EAAKv2C,SAAW,GAChB0mB,GAAO/V,MAAM3Q,SAAW,IAE1BG,KAAKq3C,cAAc7wC,OAAO6H,OAAO,GAAI+nC,EAAM,CAAEv2C,YAAU,EAE7D,CAMQw3C,cAAcjB,IACpBp2C,KAAK2qC,YAAYhoC,KAAKyzC,SACTp0C,IAATo0C,GACFp2C,KAAKo3C,0BAELp3C,KAAKi2C,kBAAoBj2C,KAAKi2C,kBAC3BvsC,OAAQslB,GAAiBA,IAASonB,GAAKpnB,MACvCrO,OAAO,CAACy1B,GAAKpnB,OAEhBhvB,KAAKk2C,iBAAmBl2C,KAAKm2C,gBAC7Bn2C,KAAKm2C,gBACHn2C,KAAKi2C,kBAAkBj2C,KAAKi2C,kBAAkBrsC,OAAS,GAE7D,CAKQwtC,yBACNp3C,KAAKi2C,kBAAoB,EAC3B,iBChNK,IAAMqB,EAAW,MAAlB,MAAOA,EACX7qB,aAAwC,GAKjC8d,QAAmB,IAAIuL,EAE9B,eAAOvU,CAAS6U,GACdkB,EAAYV,MAAMR,EAAKpnB,MAAQonB,CACjC,CAEAr2C,cACEC,KAAKuqC,QAAQoM,SAAS32C,KAAK02C,WAC7B,CAOAD,QAAQznB,GACN,OAAOsoB,EAAYV,MAAM5nB,EAC3B,CAMA0nB,WACE,OAAOlwC,OAAOmV,OAAO27B,EAAYV,MACnC,4CA/BWU,EAAW,iCAAXA,EAAWj2C,QAAXi2C,EAAWh2C,UAAAC,WAFV,gBAED+1C,CAAW,KCRlB,SAAUC,EAAcnB,GAC5B,OAAQ/U,KACNiW,EAAY/V,SACV/6B,OAAO6H,OAAO,GAAI+nC,EAAM,CACtBh6B,UAAWilB,KACH,CAGhB,4DCFM,SAAUmW,EACdC,EAAQ,QACRj0C,GAAO,eAEP,SAAO6J,MAAQ,iBAAkB,IAC/BmD,MACE,WACA2F,MAAM,CACJiD,UAAW,2BACX,EAEJs+B,MAAW,mBAAiBC,MAAQF,EAAQ,IAAMj0C,MAEtD,0HCtBApC,MAAA,8FAOEA,MALA,QAAAqnB,EAAAmvB,YAKAx2C,CALqB,cAKrBA,CAJiB,YAAAA,MAAA,IAAAqnB,EAAAovB,mBAIjBz2C,CAHuC,mBAAAA,MAAA,IAAAqnB,EAAAovB,mBAGvCz2C,CAFqD,eAAAA,MAAA,KAAAqnB,EAAAovB,mBAErDz2C,CAD0C,2DAK5CA,MAAA,4BASEA,MADA,mCAAAA,MAAAqgC,GAAA,MAAAhZ,EAAArnB,QAAA,OAAAA,MAAyBqnB,EAAAqvB,mBAAkB,EAC3C12C,CAD4C,kCAAAA,MAAAqgC,GAAA,MAAAhZ,EAAArnB,QAAA,OAAAA,MACpBqnB,EAAAsvB,sBAAqB,GAE7C32C,MAAA,0BAKFA,0CATEA,MAJA,UAAAA,MAAA,EAAAoW,GAAAiR,EAAAmvB,YAAAxnC,MAAAqY,EAAAkvB,SAIAv2C,CADE,kBAAAA,MAAA,IAAAqnB,EAAAuvB,aAMA52C,MAAA,GACAA,MADA,YAAA62C,EAAA77B,UACAhb,CAD4B,SAAAqnB,EAAAyvB,cAAAD,KCazB,IAAME,EAAgB,MAAvB,MAAOA,EAIXxN,YAAqC,IAAI5oC,SAAgBC,GAEzD,YAAIo2C,GACF,QAASp4C,KAAK2qC,YAAYjkC,KAC5B,CAKAkxC,YAA2B,IAAIxsC,KAAY,IAK3C4sC,WAAsC,IAAIj2C,IAAgB,QAK1Dg0C,SAAsC,IAAIh0C,IAAgB,IAK1D81C,kBAAyC73C,KAAK2qC,YAAY5mC,QACxD0c,KAAK21B,QAAoCp0C,IAATo0C,IAM1BJ,aAKAqC,UAOAC,WAAa,IAAIv2C,KAAyB,GAK1Cw2C,YAKChO,QAKAoN,SAAmB,EAKnBpsC,MAAsB,QAK/B,kBACIitC,GACF,MAAsB,SAAfx4C,KAAKuL,KACd,CAKA,qBACIktC,GACF,MAAsB,YAAfz4C,KAAKuL,KACd,CAMAgC,WACEvN,KAAKq4C,UAAYr4C,KAAKuqC,QAAQwL,SAASlzC,UAAW0zC,GAChDv2C,KAAK04C,gBAAgBnC,IAEvBv2C,KAAKg2C,aAAeh2C,KAAKuqC,QAAQI,YAAY9nC,UAAWuzC,GACtDp2C,KAAK24C,mBAAmBvC,GAE5B,CAMAloC,cACElO,KAAKq4C,UAAUlqC,cACfnO,KAAKg2C,aAAa7nC,cAClBnO,KAAK43C,YAAY7jC,SACnB,CAMA+jC,mBACE93C,KAAKs4C,WAAW31C,MAAK,EACvB,CAMAo1C,sBACE/3C,KAAKs4C,WAAW31C,MAAK,EACvB,CAQAu1C,cAAc9B,GACZ,OAAOA,EAAKv2C,SAAW,EACzB,CAMQ64C,gBAAgBnC,GACtBv2C,KAAKs2C,WAAWC,EAClB,CAMQoC,mBAAmBvC,GACpBp2C,KAAK23C,QAIV33C,KAAK44C,UAAU,IAAM54C,KAAKq3C,cAAcjB,IAHtCp2C,KAAKq3C,cAAcjB,EAIvB,CAMQiB,cAAcjB,GACpB,QAAap0C,IAATo0C,EACFp2C,KAAK43C,YAAYpnC,MAAM8P,UAAU,CAAEqH,QAAQ,QACtC,CACL,MAAMjc,EAAS1L,KAAK43C,YAAY13C,IAAIk2C,EAAKpnB,WAC1BhtB,IAAX0J,GACF1L,KAAK43C,YAAYpnC,MAAMmP,OAAOjU,EAAQ,CAAEic,QAAQ,IAAQ,EAE5D,CAEA3nB,KAAK2qC,YAAYhoC,KAAKyzC,GAClBp2C,KAAK23C,SACP33C,KAAKg4C,WAAWr1C,KAAK,QAEzB,CAKQ2zC,WAAWC,GACjB,MAAMsC,EAAUtC,EAAQr2B,OAAO,CAACC,EAAe0rB,KAC7C,MAAMuK,EAAOp2C,KAAKuqC,QAAQkM,QAAQ5K,GAClC,YAAa7pC,IAATo0C,GAIJj2B,EAAI7Y,KAAK,CACP4K,GAAIkkC,EAAKpnB,KACTpjB,MAAOwqC,EAAKxqC,MACZD,KAAMyqC,EAAKzqC,KACXkC,QAASuoC,EAAKvoC,QACdL,KAAM,CAAC4oC,EAAMp2C,KAAKuqC,SAClBh+B,QAASA,CAACusC,EAAaC,KACrBA,EAASjC,aAAagC,EAAM9pB,KAAI,EAElCvhB,QAASA,CAACqrC,EAAaC,IACd/4C,KAAKuqC,QAAQI,YAAY5mC,QAC9B0c,KAAKu4B,IACH,IAAIC,GAAgB,OACDj3C,IAAfg3C,GAA4BF,EAAM9pB,OAASgqB,EAAWhqB,OACxDiqB,GAAgB,GAGlB,IAAIC,GAAwB,EAC5B,YACiBl3C,IAAfg3C,GACAF,EAAM9pB,OAASgqB,EAAWG,SAE1BD,GAAwB,GAGnB,CACL,iBAAkBD,EAClB,0BAA2BC,QAM9B/4B,GACN,IACHngB,KAAK43C,YAAY1yB,KAAK2zB,GACtB74C,KAAK+1C,SAASpzC,KAAK4zC,EACrB,CAOQqC,UAAUQ,GAChBp5C,KAAKq5C,YACLr5C,KAAKu4C,YAAcv4C,KAAKs4C,WAAWz1C,UAAWy2C,IACvCA,IACHF,EAASh+B,KAAKpb,MACdA,KAAKq5C,YAAS,EAGpB,CAKQA,YACFr5C,KAAKu4C,aACPv4C,KAAKu4C,YAAYpqC,aAErB,4CArPWgqC,EAAgB,+BAAhBA,EAAgB7pC,UAAA,kBAAA4F,SAAA,EAAAC,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAhB1N,MAAA,aAAA2N,EAAAypC,eAAAp3C,CAAgB,gBAAA2N,EAAA0pC,gdDpC7Br3C,MAAA,EAAAm4C,EAAA,yCAWAn4C,MAAA,EAAAo4C,EAAA,qCAVGp4C,MAAA,OAAAA,MAAA,IAAA2N,EAAAgnC,UAAAnsC,OAAA,GAWAxI,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,EAAA47B,8BCiBCx7B,KACAyC,KACAtC,KACA4M,KACAxM,MAASG,OAAA,0iCAAA5L,KAAA,CAAAq1C,UARC,CAAC9B,MAAiB1nC,gBAAA,WAWnBqoC,CAAgB,+GC1BtB,IAAMsB,EAAa,MAApB,MAAOA,EACSt9B,wBAApBpc,YAAoBoc,GAAAnc,KAAAmc,yBAAmD,CAEvEJ,OAAO29B,GACL,OAAO15C,KAAKmc,wBAAwBJ,OAAO29B,EAC7C,4CALWD,GAAar4C,MAAAuE,MAAA,iCAAb8zC,EAAap4C,QAAbo4C,EAAan4C,UAAAC,WAFZ,gBAEDk4C,CAAa,KCCbE,EAAqB,MAA5B,MAAOA,+CAAqB,8BAArBA,uCAAqB,oBCG3B,IAAMC,EAAe,MAAtB,MAAOA,+CAAe,8BAAfA,sCAFA,CAACH,GAAcxgC,QAAA,CAHhB0gC,EACAA,YAICC,CAAe,oHCd5Bx4C,MAAA,+CAIEA,MAFA,YAAAqnB,EAAAoxB,OAEAz4C,CAFoB,SAAAqnB,EAAAla,OAEpBnN,CADiB,cAAAqnB,EAAAqxB,4BC2BZ,IAAMC,EAAqB,MAA5B,MAAOA,EAKHC,gBAAkB,CACxB5U,OAAS1b,GAAe1pB,KAAKi6C,SAASvwB,GACtC4f,SAAW5f,GAAe1pB,KAAKk6C,WAAWxwB,IAMnCmwB,OAKAtrC,OAKAwL,YAAuD,GAKtDuvB,SAAW,IAAIh8B,MAKf83B,OAAS,IAAI93B,MAEvBvN,cAAe,CAMfmO,cACElO,KAAKm6C,eACP,CAQAL,0BACE,MAAM//B,EAAcvT,OAAO6H,OAAO,GAAIrO,KAAK+Z,aAG3CvT,cAAOC,KAAKzG,KAAKg6C,iBAAiBz/B,QAAShU,IACzC,MAAM+U,EAAavB,EAAYxT,GACzB6zC,EAAiBp6C,KAAKg6C,gBAAgBzzC,GAE1CwT,EAAYxT,QADKvE,IAAfsZ,EACkBoO,IAClBpO,EAAWoO,GACX0wB,EAAe1wB,EAAK,EAGH0wB,IAIhBrgC,CACT,CAMQkgC,SAASvwB,GACf1pB,KAAKolC,OAAOh3B,KAAKsb,GACjB1pB,KAAKm6C,eACP,CAMQD,WAAWxwB,GACjB1pB,KAAKspC,SAASl7B,KAAKsb,GACnB1pB,KAAKm6C,eACP,CAKQA,qBACcn4C,IAAhBhC,KAAK65C,QACP75C,KAAK65C,OAAO9lC,UAEd/T,KAAK65C,YAAS73C,CAChB,4CAjGW+3C,EAAqB,+BAArBA,EAAqBzrC,UAAA,wBAAAC,OAAA,CAAAsrC,OAAA,SAAAtrC,OAAA,SAAAwL,YAAA,eAAAvL,QAAA,CAAA86B,SAAA,WAAAlE,OAAA,UAAA32B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,yFAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD9BlC1N,MAAA,EAAAi5C,EAAA,iCACGj5C,MAAA,OAAA2N,EAAA8qC,uBC2BS1qC,KAAM+M,MAAsBrM,OAAA,0EAAAC,gBAAA,WAE3BiqC,CAAqB,6GCpB5B,MAAOO,UAAuBjvC,KAClCkvC,iBAA+C,IAAIx4C,SAAgBC,GAMnEw4C,kBAAkBC,GAChB,MAAM9yB,EAAS3nB,KAAKu6C,iBAAiB7zC,WACtB1E,IAAX2lB,GACFA,EAAOzB,aAGTlmB,KAAK06C,2BACa14C,IAAdy4C,IACFz6C,KAAKwQ,MAAMmP,OAAO86B,EAAW,CAAE9yB,QAAQ,EAAMa,UAAU,IAAQ,GAC/DxoB,KAAKu6C,iBAAiB53C,KAAK83C,GAC3BA,EAAUh1B,WAEd,CAMAi1B,sBACE,MAAM/yB,EAAS3nB,KAAKu6C,iBAAiB7zC,WACtB1E,IAAX2lB,IACFA,EAAOzB,aACPlmB,KAAKu6C,iBAAiB53C,UAAKX,GAE/B,iBC5BI,MAAO24C,EAkFW96C,QA9Eb+6C,QAAU,IAAI74C,SAAwBC,GAKtC64C,cAAgB,IAAI94C,IAAwC,IAK5D+4C,mBAAqB,IAAI/4C,IAE/B,IAKK6kB,WAKAm0B,OAAwB,IAAIC,IAK5B77B,QAKR,MAAIjN,GACF,OAAOlS,KAAKH,QAAQqS,EACtB,CAKA,SAAItG,GACF,OAAO5L,KAAKH,QAAQ+L,KACtB,CAKA,QAAIyS,GACF,OAAOre,KAAKH,QAAQwe,MAAQ,EAC9B,CAKA,eAAI48B,GACF,OAAOj7C,KAAKH,QAAQo7C,WACtB,CAKA,eAAIrD,GACF,OAAO53C,KAAKH,QAAQ+3C,WACtB,CAKA,UAAIiC,GACF,OAAO75C,KAAK46C,QAAQl0C,KACtB,CAKA,aAAIw0C,GACF,YAAuBl5C,IAAhBhC,KAAK65C,MACd,CAEA95C,YAAsBF,GAAAG,KAAAH,SAA4B,CAMlD,UAAI8nB,GACF,OAAO3nB,KAAK4nB,QAAQlhB,KACtB,CACSkhB,QAAoC,IAAI7lB,KAAgB,GAOjE0jB,YACsB,IAAhBzlB,KAAK2nB,QACP3nB,KAAKkmB,aAEPlmB,KAAK4nB,QAAQjlB,MAAK,QAEOX,IAArBhC,KAAKi7C,cACPj7C,KAAK4mB,WAAa5mB,KAAKi7C,YAAYv2B,UAChChU,OACA7N,UAAU,IAAM7C,KAAKmnB,kBAG1BnnB,KAAK+6C,OAAOp4C,MACd,CAKAujB,aACElmB,KAAK4nB,QAAQjlB,MAAK,GAClB3C,KAAKm7C,wBAEmBn5C,IAApBhC,KAAK4mB,YACP5mB,KAAK4mB,WAAWzY,mBAEGnM,IAAjBhC,KAAKmf,SACPnf,KAAKmf,QAAQhR,aAEjB,CASAitC,eACEvB,EACAtrC,EAAiC,GACjCwL,EAAuD,IAEvD/Z,KAAK46C,QAAQj4C,KAAKk3C,GAClB75C,KAAK66C,cAAcl4C,KAAK4L,GACxBvO,KAAK86C,mBAAmBn4C,KAAKoX,GAC7B/Z,KAAK+6C,OAAOp4C,MACd,CAKAw4C,mBACEn7C,KAAK46C,QAAQj4C,UAAKX,GAClBhC,KAAK+6C,OAAOp4C,MACd,CAKQwkB,gBACNnnB,KAAK+6C,OAAOp4C,MACd,iBChJK,IAAM04C,EAA0B,MAAjC,MAAOA,EAIFnrC,MAKA/C,SAKCmc,eAAiB,IAAIhc,MAQ/BguC,kBAAkBb,GAChB,SAAOl8B,MAAek8B,EACxB,CAQAc,iBAAiB7xB,GACf,MAAM+wB,EAAY/wB,EAAMhjB,MACxB1G,KAAKkQ,MAAMsqC,kBAAkBC,GAC7Bz6C,KAAKspB,eAAelb,KAAK,CAAEoa,UAAU,EAAM9hB,MAAO+zC,GACpD,4CApCWY,EAA0B,+BAA1BA,EAA0B/sC,UAAA,6BAAAC,OAAA,CAAA2B,MAAA,QAAA/C,SAAA,YAAAqB,QAAA,CAAA8a,eAAA,kBAAA7a,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kEAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC5BvC1N,MAAA,2BAKEA,MAAA,0BAAAqW,GAAA,OAAkB1I,EAAAwsC,iBAAA9jC,EAAwB,GAE5CrW,cAHEA,MAHA,QAAA2N,EAAAmB,MAGA9O,CAHe,WAGfA,CAFe,gBAAA2N,EAAAusC,kBAEfl6C,CADmC,WAAA2N,EAAA5B,yBDuBzB6b,MAAuBlZ,gBAAA,WAEtBurC,CAA0B,uEE5BvCj6C,MAAA,GACEA,MAAA,2DAKEA,MADA,0BAAAo6C,EAAAp6C,MAAAyK,GAAA4vC,KAAA/Z,GAAAtgC,QAAA,OAAAA,MAAUsgC,GAAAga,eAAAF,GAAsB,EAChCp6C,CADiC,4BAAAo6C,EAAAp6C,MAAAyK,GAAA4vC,KAAA/Z,GAAAtgC,QAAA,OAAAA,MACrBsgC,GAAAia,iBAAAH,GAAwB,GAEtCp6C,iDANEA,QAEAA,MAFA,SAAAo6C,EAEAp6C,CAFiB,SAAAA,MAAA,IAAAsgC,EAAAmZ,eAEjBz5C,CADgC,cAAAA,MAAA,IAAAsgC,EAAAoZ,sBCyB7B,IAAMc,EAA8B,MAArC,MAAOA,EAIFnB,UAMCU,iBAAmB,IAAI7tC,MAMjC,WAAIstC,GACF,OAAO56C,KAAKy6C,UAAUG,OACxB,CAMA,iBAAIC,GACF,OAAO76C,KAAKy6C,UAAUI,aACxB,CAMA,sBAAIC,GAGF,OAAO96C,KAAKy6C,UAAUK,kBACxB,CAEA/6C,cAAe,CAQf27C,eAAe7B,GACb75C,KAAKy6C,UAAUU,mBACfn7C,KAAKm7C,iBAAiB/sC,KAAKyrC,EAC7B,CAQA8B,iBAAiB9B,GACf75C,KAAKy6C,UAAUU,mBACfn7C,KAAKm7C,iBAAiB/sC,KAAKyrC,EAC7B,4CA5DW+B,EAA8B,+BAA9BA,EAA8BttC,UAAA,kCAAAC,OAAA,CAAAksC,UAAA,aAAAjsC,QAAA,CAAA2sC,iBAAA,oBAAA1sC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qEAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID5B3C1N,MAAA,EAAAy6C,EAAA,6CAAez6C,MAAA,OAAAA,MAAA,IAAA2N,EAAA6rC,yBC0BHzrC,KAAM4qC,KAAuBrqC,MAASG,OAAA,sDAAAC,gBAAA,WAErC8rC,CAA8B,wgBC5B/BE,EAAZ,SAAYA,IACVA,aAAAC,KAAA,UACAD,MAAAE,KAAA,UACAF,MAAAG,MAAA,WAHUH,EAIZ,CAJA,CAAYA,GAAc,0BCqDnB,IAAMI,EAAc,MAArB,MAAOA,GA6BDz6C,KACA0E,YACAxE,gBACA1B,OACA2B,eACAu6C,eACAC,cACYC,MAnCfC,SAAW,IAAIv6C,SAAiCC,GAChDu6C,UAAY,IAAIx6C,IAA8B,CAAEy6C,KAAM,KACtDC,kBAAoB,IAAI16C,SAAwBC,GAChD06C,eAAiB,IAAI36C,SAAiCC,GACtD26C,gBAA0C,GAC1CC,cAAgB,IAAI5B,IACnB6B,iBAAmC,GACnCh9C,QACAi9C,QAIAlG,MACAL,QAER,qBAAIwG,GACF,OACG/8C,KAAKm8C,eAAej8C,IAAI,yBACzBF,KAAKg9C,oBACLh9C,KAAKH,QAAQk9C,iBAEjB,CACA,qBAAIA,CAAkBE,GACpBj9C,KAAKg9C,mBAAqBC,CAC5B,CACQD,mBAERj9C,YACU0B,EACA0E,EACAxE,EACA1B,GACA2B,GACAu6C,GACAC,GACYC,IAPZr8C,KAAAyB,OACAzB,KAAAmG,cACAnG,KAAA2B,kBACA3B,KAAAC,UACAD,KAAA4B,kBACA5B,KAAAm8C,kBACAn8C,KAAAo8C,iBACYp8C,KAAAq8C,SAEpBr8C,KAAKH,QAAU2G,OAAO6H,OACpB,CACE6uC,SAAU,WACVC,gBAAiB,iBACjBJ,kBAAmB,YAErB/8C,KAAKC,OAAOG,UAAU,YAGxBJ,KAAK88C,QAAU98C,KAAKH,QAAQ0C,KAAO,GAEnCvC,KAAKo9C,sBAEDp9C,KAAKmG,YAAY7D,eACnBtC,KAAKmG,YAAYlE,QAAQY,UAAWsC,KAC9BA,KACFnF,KAAKu8C,UAAUx4C,QAAKmf,KAAK,IAAC,EAAGm6B,QAASx6C,UAAWm3B,KAC/Ch6B,KAAKs9C,sBAAoB,GAE3Bt9C,KAAKu9C,eAAY,IAIrBv9C,KAAKu9C,eACLv9C,KAAKs9C,sBAAqB,GAE9B,CAEAp9C,IAAIs9C,EAAwBpoC,GAC1B,IAAI7S,EAAMvC,KAAK88C,QAAU,YACzB,OAAIU,GAAex9C,KAAKmG,YAAYvD,gBAClCL,GAAO,eAAiBi7C,EAAY3zC,OAChCuL,IACF7S,GAAO,iBAGJvC,KAAKyB,KAAKvB,IAAkBqC,EACrC,CAEAk7C,QAAQvrC,GAEN,OAAOlS,KAAKyB,KAAKvB,IADLF,KAAK88C,QAAU,aAAe5qC,EAE5C,CAEAwrC,WAAWxrC,GAET,OAAOlS,KAAKyB,KAAKvB,IADL,GAAGF,KAAK88C,oBAAoB5qC,aACGnO,QACzCG,KAAYy5C,IACV,MAAA39C,KAAK49C,YAAYD,EAAKzrC,GAChByrC,IAGZ,CAEAE,aACE,GAAI79C,KAAKmG,YAAYvD,cAEnB,OAAO5C,KAAKyB,KAAKvB,IADLF,KAAK88C,QAAU,qBACgB/4C,QACzCC,KAAK85C,IACH99C,KAAKy8C,kBAAkB95C,KAAKm7C,EAAQ5rC,GAAE,IAGrC,CACL,MAAM+qC,EAAMj9C,KAAKm8C,eAAej8C,IAAI,wBACpC,OAAAF,KAAKy8C,kBAAkB95C,KAAKs6C,GACrBj9C,KAAK+9C,gBAAgBd,EAC9B,CACF,CAEAe,kBACE,OAAIh+C,KAAK88C,QAEA98C,KAAKyB,KAAKvB,IADLF,KAAK88C,QAAU,cAG7B,EAAOl5C,MAAG,GACZ,CAEAq6C,WAAW/rC,GACT,OAAIlS,KAAKmG,YAAYvD,cAEZ5C,KAAKyB,KAAKqC,KADL9D,KAAK88C,QAAU,oBACA,CAAEoB,iBAAkBhsC,KAE/ClS,KAAKm8C,eAAe97C,IAAI,uBAAwB6R,IAAE,EAC3CtO,WAAG5B,GAEd,CAEAm8C,YAAYjsC,GAEV,OAAOlS,KAAKyB,KAAKqC,KADL9D,KAAK88C,QAAU,aAAe5qC,EAAK,QACpB,GAC7B,CAEAksC,YAAYlsC,GAEV,OAAOlS,KAAKyB,KAAKqC,KADL9D,KAAK88C,QAAU,aAAe5qC,EAAK,QACpB,GAC7B,CAEAlJ,OAAOkJ,EAAYmsC,GAAW,GAC5B,MAAMC,EAAyB,CAAE9B,KAAM,IAMvC,OALAh2C,OAAOC,KAAKzG,KAAKu8C,UAAU71C,OAAO6T,QAC/BhU,IACE+3C,EAAS/3C,IAAOvG,KAAKu8C,UAAU71C,MAAMH,IAAKmD,OAAQswB,IAAMA,GAAE9nB,KAAOA,IAGlEmsC,GACFr+C,KAAK28C,gBAAkB38C,KAAK28C,gBAAgBjzC,OAAQswB,IAAMA,GAAE9nB,KAAOA,IAAE,EAC9DtO,MAAG5D,KAAKu8C,UAAU55C,KAAK27C,KAIzBt+C,KAAKyB,KAAKuH,OADLhJ,KAAK88C,QAAU,aAAe5qC,GACPnO,QACjCC,KAAK25C,KACH39C,KAAKu8C,UAAU55C,KAAK27C,EAAQ,GAGlC,CAEAviC,OAAO+hC,GAEL,OAAO99C,KAAKyB,KAAKqC,KADL9D,KAAK88C,QAAU,YACSgB,GAAS/5C,QAC3C0c,KAAK89B,IAEDA,EAAeC,WADbx+C,KAAKmG,YAAYvD,cACSk5C,EAAeA,EAAeG,OAE9BH,EAAeA,EAAeE,MAE5Dh8C,KAAKu8C,UAAU71C,MAAM81C,KAAKiC,QAAQF,GAClCv+C,KAAKu8C,UAAU55C,KAAK3C,KAAKu8C,UAAU71C,OAC5B63C,IAGb,CAEAv2C,MAAMkK,EAAYmlB,EAAa,IAE7B,OAAOr3B,KAAKyB,KAAKqC,KADL9D,KAAK88C,QAAU,aAAe5qC,EAAK,SACXmlB,GAAYtzB,QAC9C0c,KAAKi+B,KACHA,GAAcF,WAAa1C,EAAeA,EAAeG,OACzDj8C,KAAKu8C,UAAU71C,MAAM81C,KAAKiC,QAAQC,IAClC1+C,KAAKu8C,UAAU55C,KAAK3C,KAAKu8C,UAAU71C,OAC5Bg4C,KAGb,CAEA/+B,OAAOzN,EAAY4rC,GAEjB,OAAO99C,KAAKyB,KAAKuD,MADLhF,KAAK88C,QAAU,aAAe5qC,EACL4rC,EACvC,CAIAa,mBAAmBC,EAAmBC,GAKpC,OAAO7+C,KAAKyB,KAAKqC,KAJL,GAAG9D,KAAK88C,oBAAoB8B,UACpB,CAClBC,UAGJ,CAEAC,sBAAsBF,EAAmBC,GAEvC,OAAO7+C,KAAKyB,KAAKuH,OADL,GAAGhJ,KAAK88C,oBAAoB8B,WAAmBC,IAE7D,CAEAE,eAAe7sC,GAEb,OAAOlS,KAAKyB,KAAKvB,IADLF,KAAK88C,QAAU,aAAe5qC,EAAK,eAEjD,CAEA8sC,yBACEJ,EACAK,EACAz7C,GAQA,OAAOxD,KAAKyB,KAAKqC,KANL,GAAG9D,KAAK88C,oBAAoB8B,gBACpB,CAClBK,SACAC,eAAgB17C,IAG2CO,QAC3DG,KAAYy5C,KACV,MAAA39C,KAAK49C,YAAYD,QAAK37C,GAAW,GAC3B,CAAC27C,GAAG,GAGhB,CAEAwB,4BACEP,EACAQ,GAGA,OAAOp/C,KAAKyB,KAAKuH,OADL,GAAGhJ,KAAK88C,oBAAoB8B,iBAAyBQ,IAEnE,CAIAC,mBACE,MAAM98C,EAAMvC,KAAKs/C,QAAQt/C,KAAKH,QAAQs9C,iBACtC,OAAOn9C,KAAKyB,KAAKvB,IAAkBqC,GAAKwB,QACtC0c,KAAKk9B,KACMnB,KAAMmB,KAGrB,CAEA4B,gBAAgBtC,GACd,MAAM16C,EAAMvC,KAAKs/C,QAAQ,GAAGrC,UAC5B,OAAOj9C,KAAKyB,KAAKvB,IAAqBqC,GAAKwB,QACzCy7C,KAAU7B,IACR,IAAKA,EAAI8B,KACP,SAAO77C,MAAG+5C,GAEZ,MAAM+B,GAAU1/C,KAAKs/C,QAAQ,GAAG3B,EAAI8B,aACpC,OAAOz/C,KAAKyB,KAAKvB,IAAqBw/C,IAAS37C,QAC7C0c,KAAKk/B,KACH,MAAMC,GAAWjC,EACjBiC,UAASn/B,IAAMlE,MAAYsjC,UAAUF,GAAQl/B,IAAKk9B,EAAIl9B,KACtDm/B,GAASE,QAAUH,GAAQG,QAAU,IAClCn/B,OAAOg9B,EAAImC,QAAU,IACrB//B,UACArW,OACC,CAACq2C,GAAG9gC,GAAOguB,MACR8S,GAAE7tC,IAAM+6B,GAAK+H,UAAWgL,IAAOA,GAAG9tC,KAAO6tC,GAAE7tC,MAAQ+M,IAEvDc,UACH6/B,GAASrJ,QAAUoH,EAAIpH,SAAWoJ,GAAQpJ,QAC1CqJ,GAASpnC,QAAUmlC,EAAInlC,SAAWmnC,GAAQnnC,QAC1ConC,GAAShZ,SAAW+W,EAAI/W,UAAY+Y,GAAQ/Y,SAC5CgZ,GAAShJ,OAAS+G,EAAI/G,OAAS,IAC5Bj2B,OAAOg/B,GAAQ/I,OAAS,IACxBltC,OACC,CAACwU,GAAGe,GAAOguB,KACTA,GAAK+H,UAAWiL,IAAOA,GAAGjxB,OAAS9Q,GAAE8Q,QAAU/P,IAE9C2gC,MACR,EACD17C,KAAYC,KACV,MAAAnE,KAAK49C,YAAYz5C,GAAK84C,GAChB94C,KACN,IAEL,EACDD,KAAYg8C,IACV,MAAAlgD,KAAK49C,YAAYsC,EAAMjD,GACjBiD,IAGZ,CAEA3C,aAAaC,EAAwBpoC,GACnC,IAAI+qC,EAEFA,EADEngD,KAAK88C,QACG98C,KAAKE,IAAIs9C,EAAapoC,GAEtBpV,KAAKq/C,mBAEjBc,EAAQt9C,UAAWy7C,KACjBA,GAAS9B,KAAOx8C,KAAK28C,gBAAgBh8B,OAAO29B,GAAS9B,MACrDx8C,KAAKu8C,UAAU55C,KAAK27C,GAAQ,EAEhC,CAEA8B,qBACE,MAAMC,EAAUA,CAACC,GAAS,MACnBA,GAAUtgD,KAAK88C,SAAW98C,KAAKmG,YAAYvD,cAC9C5C,KAAK69C,aAAah7C,UACf09C,IACCvgD,KAAK+8C,kBAAoBwD,EAAStD,IAClCj9C,KAAKwgD,iBAAiBD,GACtBvgD,KAAKygD,WAAWF,EAAQ,EAE1B,KACEvgD,KAAKy8C,kBAAkB95C,UAAKX,GAC5BhC,KAAK0gD,YAAY1gD,KAAK+8C,kBAAiB,GAI3C/8C,KAAK0gD,YAAY1gD,KAAK+8C,kBAAiB,EAIvC/8C,KAAKq8C,OAASr8C,KAAKq8C,MAAMx8C,QAAQ8gD,WACnC3gD,KAAKq8C,MAAMuE,YAAY78C,QAAKof,KAAa,MAAMtgB,UAAWkE,IACxD,MAAM85C,EAAe95C,EAAO/G,KAAKq8C,MAAMx8C,QAAQ8gD,YAC/C,IAAIL,IAAS,EACTO,IACF7gD,KAAK+8C,kBAAoB8D,EACzBP,IAAS,GAEXD,EAAQC,GAAM,GAGhBD,GAEJ,CAEAK,YAAYzD,GACV,MAAMa,EAAU99C,KAAKs8C,SAAS51C,MAE1Bo3C,GAAWA,EAAQb,MAAQA,GAI/Bj9C,KAAK+9C,gBAAgBd,GAClBl5C,QAAKs5C,QACLx6C,UACE09C,IACCvgD,KAAKwgD,iBAAiBD,GACtBvgD,KAAKygD,WAAWF,EAAQ,EAEzBp8C,IACK84C,IAAQj9C,KAAKH,QAAQk9C,mBACvB/8C,KAAK0gD,YAAY1gD,KAAKH,QAAQk9C,kBAAiB,EAIzD,CAEA0D,WAAW3C,GACT99C,KAAK8gD,qBAAqBhD,GAC1B,MAAMiD,EAAiB/gD,KAAKs8C,SAAS51C,MACrC,GAAIq6C,GAAkBjD,GAAWA,EAAQ5rC,KAAO6uC,EAAe7uC,GAK7D,YAJyClQ,IAArC87C,EAAQr9B,IAAItQ,KAAK6wC,kBACnBlD,EAAQr9B,IAAItQ,KAAK6wC,iBAAkB,QAErChhD,KAAKs8C,SAAS35C,KAAKm7C,GAIhBA,EAAQr9B,MACXq9B,EAAQr9B,IAAM,CAAEtQ,KAAM,KAGxB3J,OAAO6H,OAAOyvC,EAAQr9B,IAAItQ,KAAMnQ,KAAK68C,kBAErC78C,KAAKs8C,SAAS35C,KAAKm7C,EACrB,CAEAmD,kBAAkBhE,GAChBj9C,KAAK+9C,gBAAgBd,GAAKp6C,UAAW09C,IACnCvgD,KAAKkhD,iBAAiBX,EAAQ,EAElC,CAEAW,iBAAiBpD,GACf99C,KAAK08C,eAAe/5C,KAAKm7C,EAC3B,CAEAqD,kBAAkBC,EAAgBhxC,GAChC,MAAMD,EAAOixC,EAAOC,GAAGC,UACjBC,GAAOpxC,EAAKqxC,gBAAgBC,UAC5BC,GAAc,IAAIC,IAAQxxC,EAAKyxC,aAAaxoC,UAChDmoC,GACA,aAGIzD,GAA2B,CAC/Bb,OAAKt6B,SACL/W,MAAO,GACPjF,MAAO,UACP8Z,IAAK,CACHtQ,KAAM,CACJuxC,OAAQA,GAAOG,iBACfC,KAAM3xC,EAAK4xC,UACXC,WAAYT,GACZU,gBAAiBb,EAAOc,eAAeD,kBAG3CnC,OAAQ,GACRlJ,MAAO,IAGT,IAAIkJ,GAAS,GAEXA,IADY,IAAV1vC,EACOgxC,EAAOe,QACbxoB,WACAjwB,OACE04C,KACmB,IAAlBA,GAAIC,WACe,2BAAnBD,GAAIviD,QAAQqS,IAEfsQ,KAAK,CAAC8/B,GAAGC,KAAMD,GAAEE,OAASD,GAAEC,QAEtBpB,EAAOe,QACbxoB,WACAjwB,OAAQ04C,KAASA,GAAIlwC,GAAG8lB,SAAS,0BACjCxV,KAAK,CAAC8/B,GAAGC,KAAMD,GAAEE,OAASD,GAAEC,QAGjC,IAAIpT,GAAI,EACR,UAAWqT,MAAS3C,GAAQ,CAC1B,MAAM4C,GAAgC,CACpC92C,MAAO62C,GAAM5iD,QAAQ+L,MACrB42C,SAAUpT,GACVvY,QAAS4rB,GAAM5rB,QACf8rB,SAAUF,GAAM5iD,QAAQ8iD,SACxBC,QAASH,GAAMG,SAEXC,GAAO,CACX3wC,GAAIuwC,GAAM5iD,QAAQqS,GAAKu3B,OAAOgZ,GAAM5iD,QAAQqS,SAAMlQ,EAClD0gD,gBACAI,cAAe,CACbt/C,KAAMi/C,GAAMpsB,WAAWx2B,QAAQ2D,KAC/BuD,OAAQ07C,GAAMpsB,WAAWx2B,QAAQkH,OACjCxE,IAAKkgD,GAAMpsB,WAAWx2B,QAAQ0C,IAC9BwgD,UAAWN,GAAMM,YAGjBF,GAAKC,cAAct/C,MACrBs6C,GAAQgC,OAAOx4C,KAAKu7C,GAExB,CAEA/E,UAAQlH,MAAQ52C,KAAK42C,MAAMn2B,IAAK21B,MAE5BlkC,GAAIu3B,OAAO2M,GAAKlkC,IAChB8wC,OAAQ5M,GAAK4M,UAIVlF,EACT,CAEAmF,qBACE7B,EACAtB,EACA9wB,EACAgyB,IAEA,MAAMD,GAAiB/gD,KAAKs8C,SAAS3iB,WAC/BxpB,GAAOixC,EAAOC,GAAGC,UACjBC,GAAOpxC,GAAKqxC,gBAAgBC,UAM5B3D,GAA2B,CAC/Bb,IAAKjuB,EACLpjB,MAAOojB,EACPvO,IAAK,CACHtQ,KAAM,CACJuxC,OAVc,IAAIC,IAAQxxC,GAAKyxC,aAAaxoC,UAChDmoC,GACA,aAQmBM,iBACfC,KAAM3xC,GAAK4xC,UACXC,WAAYT,GACZP,qBAGJlB,OAAQ,GACRvJ,QAAS,GACTK,MAAO,GACPsM,cAAe,IAGXC,GAAgB/B,EAAOe,QAAQxoB,WACrCmkB,UAAQgC,OAASqD,GACdz5C,OAAQq2C,IAAMA,GAAEsC,WAChB5hC,IAAKs/B,MAEFsC,WAAW,EACXS,cAAe/C,GAAElgD,QAAQijD,cACzBl3C,MAAOm0C,GAAElgD,QAAQ+L,MACjBirB,QAASkpB,GAAElpB,WAIjBipB,EAAOvlC,QAASkoC,KAEd,MAAMW,GAAarC,GAAejB,OAAO19B,KAAMihC,KAC7C,MAAM5/B,GAAS4/B,GAAa5/B,OAC5B,OAAOA,IAAUg/B,GAAMvwC,KAAOuR,GAAOvR,KAAOmxC,GAAahB,YAE3D,GAAIe,GAAY,CACd,IAAIE,GAAeF,GAGfG,GAAaD,GAAantC,MAC1BmtC,GAAaE,UAAUC,iBACzBF,QAAavhD,EACJshD,GAAaE,UAAUE,mBAChCH,QAAavhD,SACNohD,GAAWN,cAAcr/B,cACzB2/B,GAAWN,cAAcnrB,eAE3ByrB,GAAW3/B,OAClB,MAAMo/B,GAAwB,IACzBO,GACHx3C,MAAO62C,GAAM5iD,QAAQ+L,MACrB42C,OAAQC,GAAMD,OACdrsC,MAAOotC,GACP1sB,QAAS4rB,GAAM5rB,QACf+rB,QAASH,GAAMG,SAEjB9E,GAAQgC,OAAOx4C,KAAKu7C,GACtB,SACQJ,GAAMpB,GAAGsC,sBAAuBC,IAO/B,CACL,MAAMV,GAAgBljD,KAAK6jD,iBAAiBpB,IAC5CS,GAAcl0B,KAAOyzB,GAAM5iD,QAAQ+L,MACnCs3C,GAAcN,QAAUH,GAAMG,QAC9BM,GAAcrsB,QAAU4rB,GAAM5rB,QAC9BinB,GAAQoF,cAAc57C,KAAK47C,GAC7B,KAbuD,CACrD,MAAMY,GAAerB,GAAM5iD,QAC3BikD,GAAatB,OAASC,GAAMD,OAC3BsB,GAAajtB,QAAU4rB,GAAM5rB,QAC3BitB,GAAalB,QAAUH,GAAMG,eACzBkB,GAAargC,OACpBq6B,GAAQgC,OAAOx4C,KAAKw8C,GACtB,IAUJhG,GAAQvH,QAAUv2C,KAAKu2C,QACvBuH,GAAQlH,MAAQ52C,KAAK42C,MAEdkH,EACT,CAEQ+F,iBAAiBpB,GACvB,MAAMsB,EAAS,IAAIC,IACnB,IAAIC,EACAxB,EAAMpB,GAAGsC,sBAAuBO,KAElCD,EADsBxB,EAAMpB,GAAGsC,YACJQ,cAC3BF,EAAcA,EAAmBG,QAASC,IACxCA,GAAQnkD,IAAI,cAId+jD,EADexB,EAAMpB,GAAGsC,YACJQ,cAEtB,MAAMG,GAAoBtkD,KAAKo8C,cAAcmI,gBAC3CN,EACA,UACA,iBAEI15C,GAAWw5C,EAAOS,cAAcF,GAAmB,CACvDG,eAAgB,YAChBC,kBAAmB,cAErB,OAAOzsB,KAAKC,MAAM3tB,GACpB,CAEAosC,SAASC,GACP52C,KAAK42C,MAAQA,CACf,CAEAN,WAAWC,GACTv2C,KAAKu2C,QAAUA,CACjB,CAEQuK,qBAAqBhD,GAEzB99C,KAAKs8C,SAAS51C,OACdo3C,EAAQb,KACRj9C,KAAKs8C,SAAS51C,MAAMu2C,MAAQa,EAAQb,KAEpCj9C,KAAK4B,eAAe+iD,uBAGtB7G,EAAQlX,SAAWkX,EAAQlX,SAAWkX,EAAQlX,SAAW,GACzDkX,EAAQlX,SAASt/B,KAAKw2C,EAAQtlC,SAC9BslC,EAAQlX,SAASnmB,IAAKjI,IAChBA,GACFxY,KAAK4B,eAAe4W,QAAQA,EAAkB,EAGpD,CAEQulC,gBAAgBd,GACtB,GAAIj9C,KAAK88C,QAAS,CAChB,IAAI8H,EACJ,UAAWr+C,MAAOC,OAAOC,KAAKzG,KAAKu8C,UAAU71C,OAI3C,GAHAk+C,EAAgB5kD,KAAKu8C,UAAU71C,MAAMH,IAAK6b,KAAM4X,IACvCA,GAAEijB,MAAQA,GAEf2H,EACF,MAIJ,OAAIA,GAAiBA,EAAcvG,UACjC,EAAOz6C,MAAGghD,GAKL5kD,KAAK09C,WADDkH,EAAgBA,EAAc1yC,GAAK+qC,EAEhD,CAEA,MAAMN,EAAkB38C,KAAKu8C,UAAU71C,MAAM81C,KAAKp6B,KAAM2+B,GAC/CA,EAAe9D,MAAQA,IAAmC,IAA5B8D,EAAe1C,UAGtD,OAAI1B,KACK/4C,MAAG+4C,GAEH38C,KAAKu/C,gBAAgBtC,EAEhC,CAEA4H,iBAAiBzD,GACf,MAAMtB,EAAkB,GAExBgF,OADkB1D,EAAOe,QAAQxoB,WACvBpf,QAASkoC,MACZA,GAAMJ,WAAkC,2BAArBI,GAAM5iD,QAAQqS,IACpC4tC,EAAOx4C,KAAKm7C,GAAK,GAGd3C,CACT,CAEQ1C,sBACDp9C,KAAKq8C,OAIVr8C,KAAKq8C,MAAMuE,YAAY/9C,UAAWkE,IAChC,MAAMg+C,EAAY/kD,KAAKq8C,MAAMx8C,QAAQklD,UACjCA,GAAah+C,EAAOg+C,KAEtB/kD,KAAK68C,iBAAiB6E,OADD36C,EAAOg+C,GACgBz7C,MAAM,KAAKmX,IAAI0a,SAG7D,MAAM6pB,EAAgBhlD,KAAKq8C,MAAMx8C,QAAQmlD,cACrCA,GAAiBj+C,EAAOi+C,KAE1BhlD,KAAK68C,iBAAiBmF,WADEj7C,EAAOi+C,IAIjC,MAAMC,GAAUjlD,KAAKq8C,MAAMx8C,QAAQolD,QAC/BA,IAAWl+C,EAAOk+C,MAEpBjlD,KAAK68C,iBAAiBiF,KAAO3mB,OADXp0B,EAAOk+C,KAE3B,EAEJ,CAEQ3F,QAAQ4F,GAGd,MAAO,GAFUllD,KAAKH,QAAQq9C,SAASxkB,QAAQ,MAAO,OAEhCwsB,GACxB,CAEQtH,YACNx5C,EACA64C,EACAkI,GAEA,MAAMrH,GAAU99C,KAAKu8C,UAAU71C,MAAM81C,KAAKp6B,KAAMgjC,IAAQA,GAAInI,MAAQA,GAC9DoI,GAAevH,GAAUA,GAAQlyC,MAAQqxC,EAC/C74C,EAAMA,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QACjD,4CAGFzoC,EAAMA,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QACnD,0CACA,CAAEnmC,MAAO2+C,KAGXjhD,EAAMA,MAAMykC,WAAY,EAEpBsc,IACF/gD,EAAMA,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QACjD,wDAEFzoC,EAAMA,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QACnD,oDAGJ7sC,KAAK4B,eAAewC,MAClB,kDACA,uDAEJ,CAEQk5C,qBAAqBgI,GAAqB,GAChD,MAAMxH,EAAU99C,KAAKs8C,SAAS51C,MACxB6+C,EAAgBvlD,KAAK08C,eAAeh2C,QACrCo3C,GAAWA,EAAQb,MAAQj9C,KAAKH,QAAQk9C,qBAC3CuI,GAAqB,GAElBA,GAAuBtlD,KAAKwlD,YAAY1H,IAI3C99C,KAAK+9C,gBAAgBD,EAAQb,KAC1Bl5C,QAAKs5C,QACLx6C,UAAW4iD,KACVzlD,KAAK48C,cAAcj6C,KAAK8iD,GAAU,GAGlCzlD,KAAK88C,SAAW98C,KAAKmG,YAAYvD,eACnC5C,KAAK69C,aAAah7C,cAVpB7C,KAAK+8C,uBAAoB/6C,EACzBhC,KAAKogD,sBAYP,MAAMsF,GAAc1lD,KAAKwlD,YAAYD,KAChCG,IAA0C,UAA3BA,GAAYlH,aAC9Bx+C,KAAKkhD,sBAAiBl/C,EAE1B,CAEQw+C,iBAAiB1C,GACF99C,KAAKwlD,YAAY1H,IAUhC99C,KAAKu8C,UAAU71C,OAAS1G,KAAKu8C,UAAU71C,MAAMi/C,SAC/C3lD,KAAKu8C,UAAU71C,MAAMi/C,OAAOr+C,KATL,CACvB4K,GAAI4rC,EAAQ5rC,GACZ+qC,IAAKa,EAAQb,IACbrxC,MAAOkyC,EAAQlyC,MACfjF,MAAOm3C,EAAQn3C,MACf63C,WAAY1C,EAAeA,EAAeE,QAK1Ch8C,KAAKu8C,UAAU55C,KAAK3C,KAAKu8C,UAAU71C,OAGzC,CAEQ8+C,YAAY1H,GAClB,IAAKA,EACH,OAAO,EAGT,MAAMQ,EAAWt+C,KAAKu8C,UAAU71C,MAChC,IAAIk/C,EACJ,UAAWr/C,MAAOC,OAAOC,KAAK63C,GAO5B,GALAsH,EADctH,EAAS/3C,IACT6b,KACX4X,IACE8jB,EAAQ5rC,IAAM8nB,GAAE9nB,KAAO4rC,EAAQ5rC,IAC/B4rC,EAAQb,KAAOjjB,GAAEijB,MAAQa,EAAQb,KAElC2I,EACF,MAIJ,OAAOA,CACT,4CA7wBW1J,IAAc96C,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,MAAA5E,MAAAuT,OAAAvT,MAAAyT,KAAA,oCAAdqnC,GAAc76C,QAAd66C,GAAc56C,UAAAC,WAFb,gBAED26C,EAAc,qBCrDrB,MAAO2J,WAAoB7jC,OAS3B,MAAO8jC,WAAmCD,GAC9C9lD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM8lD,GAA2B9qC,UACzD,ECDK,IAAMgrC,GAAoB,MAA3B,MAAOA,GACXC,OAAOtI,GACL,OAAO39C,KAAKkmD,YAAYvI,EAC1B,CAEUuI,YAAYvI,GAepB,OAAO,IAAI/iC,KAdOouB,IAEhB,IAAwB,IADAhpC,KAAKmmD,gBAAgBxI,GAG3C,YADA3U,EAAS5kC,MAAM,IAAI0hD,IAGrB,MAAMM,GAAcnuB,KAAKouB,UAAU1I,IACnC2I,SACEF,GACA,0BACA,GAAGzI,EAAIV,YAETjU,EAASM,UAAQ,EAGrB,CAEU6c,gBAAgBxI,GACxB,YAAgB37C,IAAZ27C,EAAIl9B,GAIV,4CA5BWulC,GAAoB,iCAApBA,GAAoB3kD,QAApB2kD,GAAoB1kD,UAAAC,WAFnB,gBAEDykD,EAAoB,KCZ3B,MAAOO,WAAoBvkC,OAE3B,MAAOwkC,WAA+BD,GAC1CxmD,cACEqG,MAAM,gBACNI,OAAOu/C,eAAe/lD,KAAMwmD,GAAuBxrC,UACrD,EAGI,MAAOyrC,WAAkCF,GAC7CxmD,cACEqG,MAAM,uBACNI,OAAOu/C,eAAe/lD,KAAMymD,GAA0BzrC,UACxD,EAGI,MAAO0rC,WAAmCH,GAC9CxmD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM0mD,GAA2B1rC,UACzD,EAGI,MAAO2rC,WAAwBJ,GACnCxmD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM0mD,GAA2B1rC,UACzD,ECwCI,SAAU4rC,GACd1B,GACA9gD,GACAxC,GAEAA,EAAewC,MACb,sDACA,4DACApC,EACA,CACE0E,MAAOw+C,GAAKl2B,KACZ63B,SAAU3B,GAAK1hD,MAGrB,CAEM,SAAUsjD,GACd5B,GACA9gD,GACAxC,EACAmlD,GAEAnlD,EAAewC,MACb,uDACA,6DACApC,EACA,CACE0E,MAAOw+C,GAAKl2B,KACZ1P,KAAMynC,GAGZ,CAEM,SAAUC,GACd9B,GACA9gD,GACAxC,GAEAA,EAAewC,MACb,yDACA,+DACApC,EACA,CACE0E,MAAOw+C,GAAKl2B,MAGlB,CAkKA,SAASi4B,GACPC,IAOA,OALe,IAAIlD,KACKmD,aAAaD,GAAmB,CACtDzC,eAAgB,YAChBC,kBAAmB,aAGvB,CC3QO,IAAM0C,GAAoB,MAA3B,MAAOA,GAOSnnD,OANpBwsB,wBAA0B,CAAC,oBAE3BA,yBAA2B,OAEnB46B,sBAERtnD,YAAoBE,GAAAD,KAAAC,SAClB,MAAMqnD,EAAmBtnD,KAAKC,OAAOG,UACnC,wCAEFJ,KAAKqnD,uBACFC,GAAsC,IAAMp7B,KAAKq7B,IAAI,KAAM,EAChE,CAEAC,OAAOtC,GACL,OAAOllD,KAAKynD,YAAYvC,EAC1B,CAEQwC,gBACNxC,GAOA,MAAMyC,EDgGJ,SAAUC,GAAiB1C,IAC/B,OAAOA,GAAKl2B,KAAK1lB,MAAM,KAAK0xB,MAAM7C,aACpC,CClGsByvB,CAAiB1C,GAC7B2B,EAAW3B,EAAK1hD,KAChBqkD,GAAmB,IAAIT,GAAqBS,kBAC5CC,GAAoBV,GAAqBU,kBAE/C,KACED,GAAiBn/C,QAAQm+C,GAAY,GACrCiB,GAAkBp/C,QAAQi/C,GAAa,GAI1B,qBAAbd,GACAc,IAAcP,GAAqBU,mBAEnC,OAAO9nD,KAAK+nD,UAGhB,CAEQN,YAAYvC,GAelB,OAAO,IAAItqC,KAdOouB,IAChB,GAAIkc,EAAK5lC,MAAQtf,KAAKqnD,sBAEpB,YADAre,EAAS5kC,MAAM,IAAIuiD,IAGrB,MAAMqB,GAAWhoD,KAAK0nD,gBAAgBxC,QACrBljD,IAAbgmD,GAKJA,GAAS5sC,KAAKpb,KAAMklD,EAAMlc,GAJxBA,EAAS5kC,MAAM,IAAIoiD,GAIa,EAItC,CAEQuB,WAAW7C,EAAYlc,GAC7B,MAAMC,EAAS,IAAIC,WAEnBD,EAAOgf,OAAUv+B,KACf,IACE,MAAMo0B,GAAU99C,KAAKkoD,qBAAqBhD,EAAMx7B,GAAM9S,OAAOyyB,QAC7DL,EAASrmC,KAAKm7C,GAChB,OACE9U,EAAS5kC,MAAM,IAAIqiD,GACrB,CAEAzd,EAASM,UAAQ,EAGnBL,EAAOkf,QAAWC,KAChBpf,EAAS5kC,MAAM,IAAIqiD,GAA2B,EAGhDxd,EAAOof,WAAWnD,EAAM,QAC1B,CAEQgD,qBAAqBhD,EAAYjhD,GAEvC,OADiCg0B,KAAKC,MAAMj0B,EAE9C,4CAxFWmjD,IAAoBhmD,MAAAuE,MAAA,iCAApByhD,GAAoB/lD,QAApB+lD,GAAoB9lD,UAAAC,WAFnB,gBAED6lD,EAAoB,0FCA3BhmD,MAHN,QAGMA,CAHuC,WAGvCA,CAFmB,UAEnBA,CADiC,+BAI/BA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAy8C,EAAAlnD,MAAA,WAAAA,MAASknD,EAAApxC,QAAiB,GAG1B9V,MAAA,wBACFA,QACAA,MAAA,qCACAA,MAAA,gBAKEA,MADA,mBAAAA,MAAAyK,GAAA,MAAAy8C,EAAAlnD,MAAA,WAAAA,MAAAknD,EAAA5hD,MAA2B,KAAI,EAC/BtF,CADgC,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAA61B,GAAAtgC,QAAA,OAAAA,MACtBsgC,GAAA6mB,YAAA9wC,EAAAb,OAAA4xC,OAAsC,GAGtDpnD,YAEEA,MADF,gBACEA,CAD8B,SAC1BA,MAAA,0BAAiEA,QAEnEA,MADF,QACEA,CADE,SAEAA,MAAA,0BAORA,uCAzBQA,MAAA,GAAAA,MAAA,WAAAA,MAAA,IAAAsgC,EAAA+mB,WAEArnD,MAAA,GAAAA,MAAA,IAAAA,MAAA,kDAEWA,MAAA,GAAAA,MAAA,QAAAA,MAAA,KAAAsgC,EAAA+mB,WAIXrnD,MAAA,GAAAA,MAAA,kBAOAA,MAAA,GAAAA,YAAA,wDAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,+CAAAA,MAAA,GAAAoW,GAAAkqB,EAAAgnB,aAAA,mCAkCAtnD,MAAA,kBAGGA,MAAA,GAAiBA,oCADlBA,MAAA,QAAAunD,GACCvnD,cAAAunD,EAAA/8C,oDArBLxK,MAPN,YAOMA,CAHL,WAGKA,CAF6B,sBAE7BA,CADyC,eAC9BA,MAAA,wBAETA,QACFA,MAAA,cAEJA,UAGIA,MAFJ,WAEIA,CAF6B,mBAE7BA,CADc,eACHA,MAAA,0BAETA,QAEAA,MADF,mBACEA,CAD4C,sBACpBA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAs4C,EAAAxnD,MAAA,IAAAsgC,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAmnB,UAAAD,GAAY,GAC3CxnD,MAAA,0BAGFA,QACAA,MAAA,kBACAA,MAAA,GAAA0nD,GAAA,qBAON1nD,YAEEA,MADF,WACEA,CADiC,iCAK/BA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAoxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAqnB,uBAAArnB,EAAAvB,KAAAz5B,OAAkC,GAE3CtF,MAAA,0BACFA,QACAA,MAAA,uCAEJA,mCAzCEA,MAAA,YAAAsgC,EAAAvB,MAIe/+B,MAAA,GAAAA,YAAA,iEAQAA,MAAA,GAAAA,YAAA,mEAIGA,MAAA,GAAAA,MAAA,WACVA,MAAA,GAAAA,MAAA,IAAAA,MAAA,qEAMkBA,MAAA,GAAAA,MAAA,UAAAsgC,EAAAsnB,yBAWtB5nD,MAAA,GAAAA,MAAA,YAAAsgC,EAAAvB,KAAA4F,OAAA3kC,MAAA,MAAAsgC,EAAA+mB,WAGArnD,MAAA,GAAAA,MAAA,IAAAA,MAAA,oDAEWA,MAAA,GAAAA,MAAA,QAAAA,MAAA,MAAAsgC,EAAA+mB,YC9BV,IAAMQ,GAA4B,MAAnC,MAAOA,GAkBDC,qBACAC,qBACAvnD,eACA4zB,YACAv1B,OACAmpD,eAtBHjpB,KACA2f,OACAuJ,UAAoB,YACpBZ,SAAW,IAAI1mD,KAAgB,GAC/BunD,aAAc,EACdC,UACAP,wBACArL,IACC0J,sBACDqB,WACAc,mBAA6B,SAE5BC,SAEChpC,IAET1gB,YACUmpD,EACAC,EACAvnD,EACA4zB,GACAv1B,GACAmpD,IALAppD,KAAAkpD,uBACAlpD,KAAAmpD,uBACAnpD,KAAA4B,iBACA5B,KAAAw1B,eACAx1B,KAAAC,UACAD,KAAAopD,kBAERppD,KAAK0pD,WACP,CAEAn8C,WACE,MAAM+5C,EAAmBtnD,KAAKC,OAAOG,UACnC,wCAEFJ,KAAKqnD,uBACFC,GAAsC,IAAMp7B,KAAKq7B,IAAI,KAAM,GAC9DvnD,KAAK0oD,WAAa1oD,KAAKqnD,sBAAwBn7B,KAAKq7B,IAAI,KAAM,GAC9DvnD,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAU,KACzC7C,KAAKupD,UAAYvpD,KAAKopD,eAAevE,iBAAiB7kD,KAAKygB,KAC3DzgB,KAAKgpD,wBAA0BhpD,KAAKupD,UAAU7/C,OAC3C+4C,GAAUA,EAAMkH,gBAAe,EAGtC,CAEApB,YAAYC,GACVxoD,KAAKyoD,SAAS9lD,MAAK,GACnB,UAAWuiD,KAAQsD,EACjBxoD,KAAKkpD,qBACF1B,OAAOtC,GACPnhD,QAAK6lD,KAAK,IACV/mD,UACEi7C,GAA6B99C,KAAK6pD,oBAAoB3E,EAAMpH,GAC5D15C,GAAiBpE,KAAK8pD,kBAAkB5E,EAAM9gD,GAC/C,KACEpE,KAAKyoD,SAAS9lD,MAAK,EAAK,EAIlC,CAEAomD,uBAAuBgB,GACrB/pD,KAAKyoD,SAAS9lD,MAAK,GACnB3C,KAAK29C,IAAM39C,KAAKopD,eAAenG,qBAC7BjjD,KAAKygB,IACLspC,EAAejK,OACfiK,EAAe/6B,MACf,GAEFhvB,KAAK29C,IAAIU,UAAW,EACpBr+C,KAAKmpD,qBACFlD,OAAOjmD,KAAK29C,KACZ55C,QAAK6lD,KAAK,IACV/mD,UACC,OACCuB,GAAiBpE,KAAKgqD,kBAAkB5lD,GACzC,KACEpE,KAAKiqD,sBACLjqD,KAAKyoD,SAAS9lD,MAAK,EAAK,EAGhC,CAEQ+mD,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjC6e,OAAQ,CAAC,GAAI,CAAC/a,KAAW/C,WACzBhT,KAAM,CAAC,GAAI,CAAC+V,KAAW/C,YAE3B,CAEQ6nB,oBAAoB3E,EAAYpH,IHzHpC,SAAUoM,GACdhF,GACApH,GACAl8C,EACAwnD,GAEA,GAAI5iD,OAAOC,KAAKq3C,IAASl0C,QAAU,EAEjC,YAgFE,SAAUugD,GACdjF,GACAtjD,IAEAA,GAAewC,MACb,oDACA,0DACApC,EACA,CAAE0E,MAAOw+C,GAAKl2B,MAElB,CA3FIm7B,CAA2BjF,GAAMtjD,GAInC,MAAMwoD,EA0GF,SAAUC,GAA0BnF,IACxC,OAAOA,GAAKl2B,KAAKs7B,OAAO,EAAGpF,GAAKl2B,KAAKu7B,YAAY,KACnD,CA5GuBF,CAA0BnF,KAyF3C,SAAUsF,GACd1M,GACAsM,GACAhB,GAEAtL,GAAQlyC,MAAQw+C,GAChBtM,GAAQO,UAAW,EACnB+K,EAAe7M,UAAU71C,MAAM81C,KAAKiC,QAAQX,IAC5CsL,EAAe7M,UAAU55C,KAAKymD,EAAe7M,UAAU71C,OACvD0iD,EAAezM,gBAAgB8B,QAAQX,IACvCsL,EAAe1I,YAAY5C,GAAQb,IACrC,EAlGEuN,CAAwB1M,GAASsM,EAAchB,GAE/CxnD,EAAe6oD,QACb,sDACA,4DACAzoD,EACA,CACE0E,MAAO0jD,GAGb,CGmGIF,CACEhF,EACApH,EACA99C,KAAK4B,eACL5B,KAAKopD,eAET,CAEQU,kBAAkB5E,EAAY9gD,GACpCpE,KAAKyoD,SAAS9lD,MAAK,GH1GjB,SAAU+nD,GACdxF,GACA9gD,GACAxC,EACAmlD,IAGmB,CACjB,eAAgBH,GAChB,oBAAqBE,GACrB,sBAAuBE,KAEd5iD,GAAMoU,SAAS0sC,GAAM9gD,GAAOxC,EANvCmlD,EAASA,GAAkB,GAO7B,CG8FI2D,CAAsBxF,EAAM9gD,EAAOpE,KAAK4B,eAAgB5B,KAAK0oD,WAC/D,CAEQsB,kBAAkB5lD,GACxBpE,KAAKyoD,SAAS9lD,MAAK,GC/JjB,SAAUgoD,GACdvmD,GACAxC,IAEIwC,cAAiB0hD,GACnB9lD,KAAK4qD,2BAA2BhpD,IAGlCA,GAAewC,MACb,qDACA,sDAEJ,CDoJIumD,CAAsBvmD,EAAOpE,KAAK4B,eACpC,CAEQqoD,uBCrJJ,SAAUY,GAAwBjpD,IACtCA,GAAe6oD,QACb,sDACA,uDAEJ,CDiJII,CAAwB7qD,KAAK4B,eAC/B,CAEAinD,UAAUld,GACJA,EAAE9e,YACJ7sB,KAAKmgC,KAAK7I,SAASwoB,OAAOvoB,SAASv3B,KAAKgpD,yBACxCrd,EAAE9e,WAAY,IAEI,IAAhB8e,EAAE9e,WACJ7sB,KAAKmgC,KAAK7I,SAASwoB,OAAOvoB,SAAS,GAEvC,CAEAuzB,qBAAqBphC,GACnB1pB,KAAKwpD,mBAAqB9/B,EAAMhjB,KAClC,CAEAwH,cACElO,KAAKypD,SAASt7C,aAChB,4CA/HW86C,IAA4B7nD,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,GAAA,+BAA5BijD,GAA4B36C,UAAA,gCAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,+iBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID3DvC1N,MADF,UACEA,CAD+C,+BAG7CA,MAAA,kBAAAqW,IAAA,OAAU1I,EAAA+7C,qBAAArzC,GAA4B,GAEtCrW,MAAA,yBACEA,MAAA,wBACFA,QACAA,MAAA,yBACEA,MAAA,wBAGNA,YAoCAA,MAlCA,EAAA2pD,GAAA,cAkCA3pD,CAlC6C,EAAA4pD,GAAA,uBAZzC5pD,cAAA,QAAA2N,EAAAy6C,oBAGmBpoD,cAAA,kBACjBA,cAAA,IAAAA,MAAA,oDAEiBA,MAAA,GAAAA,MAAA,kBACjBA,cAAA,IAAAA,MAAA,oDAKAA,MAAA,GAAAA,MAAA,kBAAA2N,EAAAy6C,oBAoCHpoD,cAAA,kBAAA2N,EAAAy6C,oCCNCyB,KAAqBt2C,UACrBxF,KACAstB,KAAW32B,yBACXyJ,KAAesF,KACf6gC,KACAnY,KAAmBz3B,UACnBmkB,KAAkBnV,UAClB+nB,KAAcC,KACd5S,KAAe8S,KAAAE,KACf/S,KACA+gC,IAAgB9tB,IAChB3oB,KACA/E,KACAC,KAAiB0tB,OAAAxtB,OAAA,4qBAGRo5C,EAA4B,8DEzCrC7nD,MAAA,aAAoCA,MAAA,GAAaA,+BAAbA,cAAA,GAAAqnB,EAAA0iC,OAAA,MCkBjC,IAAMC,GAAoB,MAA3B,MAAOA,GAsCD51B,YACA5zB,eAtCHu+B,KACAgrB,OAEP,iBACIE,GACF,OAAOrrD,KAAKsrD,cACd,CACA,iBAAID,CAAc3kD,GAChB1G,KAAKsrD,eAAiB5kD,CACxB,CACQ4kD,eAER,WACIxN,GACF,OAAO99C,KAAKugD,QACd,CACA,WAAIzC,CAAQp3C,GACV1G,KAAKugD,SAAW75C,EAChB1G,KAAK0pD,WACP,CACQnJ,SAER,YACIpzC,GACF,OAAOnN,KAAK+xC,SACd,CACA,YAAI5kC,CAASzG,GACX1G,KAAK+xC,UAAYrrC,CACnB,CACQqrC,WAAY,EAGVzR,WAAgC,IAAIhzB,MACpCtF,MAA2B,IAAIsF,MAC/BtE,OAA4B,IAAIsE,MAE1CvN,YACUy1B,EACA5zB,GADA5B,KAAAw1B,cACAx1B,KAAA4B,gBACP,CAEH2L,WACEvN,KAAK0pD,WACP,CAEO6B,iBAAiB7kD,GACtB,IAAI6H,EAAS/H,OAAO6H,OAAO,GAAI3H,GAC/B6H,EAASgO,MAAYivC,WAAWj9C,GAChCA,EAAO0uC,IAAM1uC,EAAO0uC,IAAIvkB,QAAQ,IAAK,IAEnCnqB,EAAO0uC,IADL1uC,EAAO0uC,IACIj9C,KAAKmrD,OAAS,IAAM58C,EAAO0uC,IAE3Bj9C,KAAKmrD,OAEpBnrD,KAAKsgC,WAAWlyB,KAAKG,EACvB,CAEOk9C,sBACL,MAAM7e,EAAO5sC,KAAKmrD,OAAS,IAAMnrD,KAAKmgC,KAAKz5B,MAAMu2C,IAAIvkB,QAAQ,IAAK,IAC/CgzB,MAAUC,KAAK/e,IAEhC5sC,KAAK4B,eAAe6oD,QAClB,4CACA,8CAGN,CAEQf,YACN,MAAM5L,EAAe99C,KAAK89C,SAAW,GAE/B8N,EAAW9N,EAAQb,IAAI3zC,MAAM,KACnCtJ,KAAKmrD,OAASS,EAASpiD,QACvB,MAAMyzC,EAAM2O,EAAS/hD,KAAK,KAE1B7J,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCr1B,MAAO,CAACkyC,EAAQlyC,OAChBqxC,IAAK,CAACA,GAAO,MAEjB,4CAhFWmO,IAAoBhqD,MAAAuE,MAAAvE,MAAAwE,MAAA,+BAApBwlD,GAAoB98C,UAAA,uBAAAC,OAAA,CAAA88C,cAAA,gBAAAvN,QAAA,UAAA3wC,SAAA,YAAAqB,QAAA,CAAA8xB,WAAA,aAAAt4B,MAAA,QAAAgB,OAAA,UAAAyF,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,4jBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDrCjC1N,MAAA,YAGEA,MAAA,6BAAY2N,EAAAw8C,iBAAAx8C,EAAAoxB,KAAAz5B,MAA4B,GAExCtF,MAAA,sBACEA,MAAA,kCAOAA,MAAA,eACEA,MAAA,wBAEJA,UAEAA,MAAA,sBACEA,MAAA,EAAAyqD,GAAA,cACAzqD,MAAA,YACEA,MAAA,oCAQJA,UAEAA,MAAA,qCAQEA,MAAA,0BAAS2N,EAAA08C,qBAAqB,GAE9BrqD,MAAA,eAAUA,MAAA,mBACZA,UAGEA,MADF,WACEA,CADiC,eAM/BA,MAAA,0BAGNA,mBAnDEA,MAAA,YAAA2N,EAAAoxB,MAQI/+B,MAAA,GAAAA,MAAA,cAAAA,MAAA,8CAIAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2DAKKA,MAAA,GAAAA,MAAA,OAAA2N,EAAAo8C,QAMH/pD,MAAA,GAAAA,MAAA,cAAAA,MAAA,8CAYJA,MAAA,GAAAA,MAAA,aAAAA,MAAA,+CAWEA,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,KAAA4F,OAAAh3B,EAAA5B,UAEA/L,cAAA,IAAAA,MAAA,mECxBFq7B,KAAW92B,8BACX43B,KAAmB53B,UACnBskB,KAAkBpkB,UAClBg3B,KAAc/2B,KACdqJ,KACAI,KAAexJ,UACfsJ,MAAgBrJ,MAChBwJ,MAAamF,MACbhF,KAAiBkF,OAAAhF,OAAA,0VAGRu7C,EAAoB,iDCrCjChqD,MAAA,6CAIEA,MAAA,sBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAg1B,WAAAlyB,KAAAqJ,GAAuB,GAEvCrW,iCAHEA,MADA,gBAAAA,MAAA,uCACAA,CAD+D,UAAAkK,EAAAwyC,UCkB1D,IAAMgO,GAAoB,MAA3B,MAAOA,GAaSC,GAZpB,WACIjO,GACF,OAAO99C,KAAKugD,QACd,CACA,WAAIzC,CAAQp3C,GACV1G,KAAKugD,SAAW75C,EAChB1G,KAAK6D,SACP,CACQ08C,SAEEjgB,WAAoC,IAAIhzB,MAElDvN,YAAoBgsD,GAAA/rD,KAAA+rD,IAAwB,CAE5CloD,UACE7D,KAAK+rD,GAAGpvC,eACV,4CAjBWmvC,IAAoB1qD,aAAA,+BAApB0qD,GAAoBx9C,UAAA,uBAAAC,OAAA,CAAAuvC,QAAA,WAAAtvC,QAAA,CAAA8xB,WAAA,cAAA7xB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,iGAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDpBjC1N,MAAA,EAAA4qD,GAAA,+BACG5qD,MAAA,OAAA2N,EAAA+uC,wBCiBS3uC,KAAMi8C,GAAsBz7C,KAAiBhK,OAAA68B,cAAA,WAE5CspB,EAAoB,oHCF7B1qD,MAAA,cAAqCA,MAAA,GAMnCA,gCANmCA,cAAAkK,EAAAwyC,QAAAnyC,KAAAL,EAAAwyC,QAAAnyC,KAAA,WAAAL,EAAAwyC,QAAAn3C,MAAA,8CAOrCvF,MAAA,kCAA+BA,MAAA,MAAAkK,EAAAwyC,QAAAmO,UAAA7qD,oDArBjCA,MAAA,mCAYEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA4gD,cAAA5gD,EAAAwyC,SAAsB,GAS/B18C,MAPA,EAAA+qD,GAAA,iBAOA/qD,CAPqC,EAAAgrD,GAAA,aAQvChrD,iCAXEA,MANA,aAAAkK,EAAA+gD,KAAAzpD,cAAAxB,MAAA,8CAMAA,CAFC,QAAAkK,EAAAghD,QAAA,qBAKUlrD,MAAA,GAAAA,MAAA,QAAAkK,EAAAwyC,QAAAmO,WAOL7qD,cAAA,OAAAkK,EAAAwyC,QAAAmO,wDAER7qD,MAAA,mCAQEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA4gD,cAAA5gD,EAAAwyC,SAAsB,GAE/B18C,MAAA,cAAUA,MAAA,UACZA,mCAJEA,MAFA,aAAAA,MAAA,2CAEAA,CAFgE,QAAAkK,EAAAghD,QAAA,kEAehElrD,MAAA,oCAYEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAAjhD,EAAAlK,MAAA,UAAAA,MAASkK,EAAAkhD,KAAAp+C,KAAA9C,EAAAwyC,SAAkB,GAE3B18C,MAAA,cAAUA,MAAA,UACZA,oCAJEA,MAFA,aAAAA,MAAA,uCAEAA,CAF4D,QAAAkK,EAAAC,oDAS5DnK,MAAA,oCAQEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,MAAA,UAAAA,MAASkK,EAAAmhD,kBAAAr+C,KAAA9C,EAAAwyC,SAA+B,GAExC18C,MAAA,cAAUA,MAAA,qBACZA,oCAJEA,MAJA,aAAAA,MAAA,oDAIAA,CAFC,QAAAkK,EAAAC,oDAQHnK,MAAA,oCAOEA,MAAA,mBAAAA,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAASkK,EAAAtD,MAAAoG,KAAA9C,EAAAwyC,SAAmB,GAE5B18C,MAAA,cAAUA,MAAA,kBACZA,oCAJEA,MAFA,aAAAA,MAAA,wCAEAA,CAF6D,QAAAkK,EAAAC,oDAQ/DnK,MAAA,oCAUEA,MAAA,mBAAAA,MAAA8tB,GAAA,MAAA5jB,EAAAlK,MAAA,UAAAA,MAASkK,EAAAohD,KAAAt+C,KAAA9C,EAAAwyC,SAAkB,GAE3B18C,MAAA,cAAUA,MAAA,UACZA,oCALEA,MADA,QAAAkK,EAAAC,MACAnK,CADe,aAAAA,MAAA,qFAQjBA,MAAA,oCAOEA,MAAA,mBAAAA,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,UAAAA,MAASkK,EAAAq3B,KAAAv0B,KAAA9C,EAAAwyC,SAAkB,GAE3B18C,MAAA,cAAUA,MAAA,gBACZA,oCALEA,MADA,QAAAkK,EAAAC,MACAnK,CADe,aAAAA,MAAA,qFAQjBA,MAAA,oCAOEA,MAAA,mBAAAA,MAAAsQ,GAAA,MAAApG,EAAAlK,MAAA,UAAAA,MAASkK,EAAAijC,KAAAngC,KAAA9C,EAAAwyC,SAAkB,GAE3B18C,MAAA,cAAUA,MAAA,oBACZA,oCALEA,MADA,QAAAkK,EAAAC,MACAnK,CADe,aAAAA,MAAA,qFAQjBA,MAAA,oCAUEA,MAAA,mBAAAA,MAAAwrD,GAAA,MAAAthD,EAAAlK,MAAA,UAAAA,MAASkK,EAAAtC,OAAAoF,KAAA9C,EAAAwyC,SAAoB,GAE7B18C,MAAA,cAAUA,MAAA,YACZA,gBALEA,MAAA,aAAAA,MAAA,sFAhGNA,MAAA,WAMEA,MAAA,EAAAyrD,GAAA,iBAiBAzrD,MAAA,cAiEEA,MAhEA,EAAA0rD,GAAA,gBAgEA1rD,CAvDC,EAAA2rD,GAAA,gBAuDD3rD,CA3CC,EAAA4rD,GAAA,gBA2CD5rD,CA5BC,EAAA6rD,GAAA,gBA4BD7rD,CAhBC,EAAA8rD,GAAA,gBAgBD9rD,CAJC,EAAA+rD,GAAA,iBAkBH/rD,QAEAA,MAAA,gBAOEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAwF,WAAAxF,EAAAwF,UAAA,GAEA1P,MAAA,eAAUA,MAAA,iBAEdA,gDA5GKA,cAAA,OAAAkK,EAAAwF,WAAAxF,EAAAkd,WAAAld,EAAAwyC,QAAAU,aAAAlzC,EAAA4zC,eAAA5zC,EAAA4zC,eAAAjD,QAAA3wC,EAAAwyC,QAAAO,WAkBEj9C,MAAA,GAAAA,MAAA,OAAAkK,EAAA8hD,WAAA9hD,EAAAwyC,QAAAO,UAaAj9C,cAAA,QAAAkK,EAAAwyC,QAAAO,UAYAj9C,cAAA,OAAAkK,EAAAwyC,QAAAU,aAAAlzC,EAAA4zC,eAAA5zC,EAAA4zC,eAAAjD,SAAA3wC,EAAAwyC,QAAAO,UAeAj9C,cAAA,QAAAkK,EAAAwyC,QAAA1oC,SAAA9J,EAAAwyC,QAAAO,UAYAj9C,cAAA,OAAAkK,EAAAwyC,QAAA1oC,SAAA9J,EAAAwyC,QAAAO,UAYAj9C,cAAA,OAAAkK,EAAAwyC,QAAAU,aAAAlzC,EAAA4zC,eAAA5zC,EAAA4zC,eAAAjD,QAAA3wC,EAAAwyC,QAAAO,UAmBHj9C,QAEAA,MAFA,QAAAkK,EAAAC,MAEAnK,CAFe,SAAAisD,EAEfjsD,CADkB,YAAAkK,EAAAwF,YC9GjB,IAAMw8C,GAAoB,MAA3B,MAAOA,GA6BFjB,KACClQ,eA7BH+C,eAAiBpD,EACjBvwC,MAAQ,UACRuF,WAAY,EAEVy8C,cAAwB,EACxBzP,QACAwO,QACA9jC,SAECkkC,KAAO,IAAIp/C,MACXtE,OAAS,IAAIsE,MACbk/C,KAAO,IAAIl/C,MACXtF,MAAQ,IAAIsF,MACZq1B,KAAO,IAAIr1B,MACXihC,KAAO,IAAIjhC,MACXkgD,SAAW,IAAIlgD,MACfm/C,kBAAoB,IAAIn/C,MACxBmgD,YAAc,IAAIngD,MAE5B,UAAI8H,GACF,OAAOpV,KAAK89C,QAAQ1oC,MACtB,CAEA,YAAIg4C,GACF,OAA+C,IAAxCptD,KAAKm8C,eAAej8C,IAAI,WACjC,CAEAH,YACSssD,EACClQ,GADDn8C,KAAAqsD,OACCrsD,KAAAm8C,gBACP,CAEH+P,cAAcpO,GACZ99C,KAAKwtD,SAASp/C,KAAK0vC,EACrB,4CAnCWwP,IAAoBlsD,MAAAuE,MAAAvE,MAAAwE,MAAA,+BAApB0nD,GAAoBh/C,UAAA,uBAAAC,OAAA,CAAAg/C,aAAA,eAAAzP,QAAA,UAAAwO,QAAA,UAAA9jC,SAAA,YAAAha,QAAA,CAAAk+C,KAAA,OAAA1jD,OAAA,SAAAwjD,KAAA,OAAAxkD,MAAA,QAAA26B,KAAA,OAAA4L,KAAA,OAAAif,SAAA,WAAAf,kBAAA,oBAAAgB,YAAA,eAAAh/C,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,k4DAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDxCjC1N,MAAA,qBA2BEA,MAvBA,EAAAssD,GAAA,eAuBAtsD,CAVC,EAAAusD,GAAA,gBAsBDvsD,MAAA,YAAuBA,MAAA,GAAmBA,QAE1CA,MAAA,EAAAwsD,GAAA,eAoHFxsD,eA3JEA,MAAA,UAAAA,MAAA,EAAAoW,GAAAzI,EAAAqG,SAGGhU,cAAA,OAAA2N,EAAAs9C,KAAAzpD,eAwBAxB,cAAA,QAAA2N,EAAAs9C,KAAAzpD,eAAAmM,EAAAw+C,cAUoBnsD,MAAA,GAAAA,MAAA2N,EAAA+uC,QAAAlyC,OAGpBxK,cAAA,OAAA2N,EAAAs9C,KAAAzpD,+BCbDwM,MAAavJ,wBACbyJ,KACAH,KACAI,KAAezJ,KACf23B,MACApuB,MAAgBtJ,MAChByJ,MAAaxJ,MACb0Q,MACA/G,KAAiBgF,OAAA9E,OAAA,kWAAAC,gBAAA,WAGRw9C,EAAoB,wGCX1B,IAAMO,GAAuB,MAA9B,MAAOA,GAGQj2C,UAFZhM,MAEP7L,YAAmB6X,GAAA5X,KAAA4X,WAAmD,4CAH3Di2C,IAAuBzsD,MAAAuE,OAAA,+BAAvBkoD,GAAuBv/C,UAAA,0BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,wTAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC7BpC1N,MAAA,UACEA,MAAA,wBACFA,QAGIA,MAFJ,UAEIA,CAF2C,mBAE3CA,CADc,kCASZA,MAAA,yBAAAqW,IAAArW,aAAA2N,EAAAnD,MAAA6L,MAAA1I,EAAAnD,MAAA6L,MAAA,GAGNrW,YAEEA,MADF,UACEA,CADsB,cAKpBA,MAAA,0BAAS2N,EAAA6I,UAAAK,MAAAlJ,EAAAnD,MAAsB,GAE/BxK,MAAA,yBACFA,QACAA,MAAA,eAAmBA,MAAA,0BAAS2N,EAAA6I,UAAAK,OAAgB,EAAM,GAChD7W,MAAA,0BAEJA,iBA5BEA,cAAA,IAAAA,MAAA,qDASIA,MAAA,GAAAA,MAAA,cAAAA,MAAA,sDAGAA,MAAA,UAAA2N,EAAAnD,OAQFxK,MAAA,GAAAA,MAAA,YAAA2N,EAAAnD,OAGAxK,cAAA,IAAAA,MAAA,kDAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,iEDRA8W,MACAC,MACA8R,KAAkBrkB,KAClBi3B,KAAch3B,KACd42B,KAAW32B,yBACXsS,MACA7I,KAAexJ,KACf4J,KAAiB3J,OAAAw8B,cAAA,WAGRqrB,EAAuB,KE7B7B,IAAKC,GAAZ,SAAYA,IACVA,UAAAC,OAAA,SACAD,GAAAE,MAAA,QACAF,GAAAxB,QAAA,UAHUwB,EAIZ,CAJA,CAAYA,IAAuB,gDCc7B1sD,MAAA,eAOEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAoxB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAusB,cAAa,GAEtB7sD,MAAA,cAAUA,MAAA,WACZA,uDArBAA,MADF,sBACEA,CADuD,eAC5CA,MAAA,wBAETA,QACFA,MAAA,mCAMEA,MAAA,yBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,GAAAtgC,qBAAAsgC,GAAAwsB,KAAAz2C,KAAAiqB,GAAAwsB,KAAAz2C,GAAArW,MAAAqW,EAAA,GANFrW,QAQAA,MAAA,EAAA+sD,GAAA,iBAWF/sD,iCAtBaA,MAAA,GAAAA,YAAA,qDAMTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qDAGAA,MAAA,UAAAsgC,EAAAwsB,MAMC9sD,MAAA,GAAAA,MAAA,OAAAsgC,EAAAwsB,KAAAtkD,qCAuBHxI,MAAA,4CASEA,MANA,YAAAsgC,EAAAn2B,MAMAnK,CANmB,QAAAsgC,EAAAkW,YAMnBx2C,CALqB,cAKrBA,CAJiB,wBAAAsgC,EAAAzvB,cAIjB7Q,CAFyC,gBAEzCA,CADoB,OAAAsgC,EAAAzvB,6CAKtB7Q,MAAA,oCAQEA,MAAA,gBAA0BA,MAAA,gBAC5BA,2CAHEA,MAFA,aAAAA,MAAA,6CAEAA,CAFkE,oBAAAgtD,gDAa9DhtD,MALF,cAKEA,CADD,qBAKGA,MADA,iBAAAqW,GAAArW,aAAA2P,GAAA3P,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,oBAAAA,MAAA2P,GAAA,MAAAs9C,EAAAjtD,QAAAmP,UAAAmxB,GAAAtgC,QAAA,OAAAA,MACxBsgC,GAAA4sB,qBAAAD,GAA0B,GAEtCjtD,QACAA,MAAA,UAAMA,MAAA,GACRA,uDAPIA,QACAA,MADA,UAAAsgC,EAAA6sB,cAAAF,GAAAxgC,QACAzsB,CADuC,gBAAAsgC,EAAA6sB,cAAAF,GAAAG,eAMnCptD,MAAA,GAAAA,MAAAitD,EAAAziD,oDAwBFxK,MALF,cAKEA,CADD,qBAIGA,MADA,iBAAAqW,GAAArW,aAAAurD,GAAAvrD,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,0BAAAqtD,EAAArtD,MAAAurD,GAAAp8C,UAAA89C,GAAAjtD,MAAA,GAAAmP,UAAAmxB,GAAAtgC,QAAA,OAAAA,MACxBsgC,GAAA4sB,qBAAAG,EAAAJ,IAAiC,GAE3CjtD,MAAA,GAEJA,mDANIA,cAAA,UAAAsgC,EAAA6sB,cAAAE,GAAA5gC,SAIAzsB,cAAA,IAAAqtD,EAAA7iD,MAAA,kDArBJxK,MALF,cAKEA,CADD,qBAKGA,MADA,iBAAAqW,GAAArW,aAAA8tB,GAAA9tB,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,oBAAAA,MAAA8tB,GAAA,MAAAm/B,EAAAjtD,QAAAmP,UAAAmxB,GAAAtgC,QAAA,OAAAA,MACxBsgC,GAAA4sB,qBAAAD,GAA0B,GAEtCjtD,QACAA,MAAA,UAAMA,MAAA,GACRA,UAEAA,MAAA,qBACEA,MAAA,EAAAstD,GAAA,iBAaFttD,gEA3BEA,MAAA,oBAAAutD,GAIEvtD,QACAA,MADA,UAAAsgC,EAAA6sB,cAAAF,GAAAxgC,QACAzsB,CADuC,gBAAAsgC,EAAA6sB,cAAAF,GAAAG,eAMnCptD,MAAA,GAAAA,MAAAitD,EAAAziD,OAMcxK,MAAA,GAAAA,MAAA,UAAAitD,EAAAO,sCAlC1BxtD,MAAA,GAeEA,MAdA,EAAAytD,GAAA,gBAcAztD,CAVC,EAAA0tD,GAAA,yBAAA1tD,sDAHEA,QAAoBA,MAApB,QAAAitD,EAAAO,OAAoBxtD,CAAA,WAAA2tD,gDA0EzB3tD,MAAA,yBAoBEA,MAVA,wBAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAAQsgC,GAAAgrB,KAAAt+C,KAAA4gD,GAAkB,EAU1B5tD,CAV2B,0BAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACjBsgC,GAAA14B,OAAAoF,KAAA4gD,GAAoB,EAS9B5tD,CAT+B,yBAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACtBsgC,GAAA15B,MAAAoG,KAAA4gD,GAAmB,EAQ5B5tD,CAR6B,wBAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACrBsgC,GAAA8qB,KAAAp+C,KAAA4gD,GAAkB,EAO1B5tD,CAP2B,wBAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACnBsgC,GAAAyc,YAAA6Q,GAAoB,EAM5B5tD,CAN6B,wBAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACrBsgC,GAAA0c,YAAA4Q,GAAoB,EAK5B5tD,CAL6B,4BAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACjBsgC,GAAA8rB,SAAAp/C,KAAA4gD,GAAsB,EAIlC5tD,CAJmC,+BAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACpBsgC,GAAA+rB,YAAAr/C,KAAA4gD,GAAyB,EAGxC5tD,CAHyC,qCAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACpBsgC,GAAA+qB,kBAAAr+C,KAAA4gD,GAA+B,EAEpD5tD,CAFqD,0BAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAC3CsgC,GAAAzU,OAAA7e,KAAA4gD,GAAoB,EAC9B5tD,CAD+B,4BAAA4tD,EAAA5tD,MAAA+wB,GAAA5hB,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACnBsgC,GAAAoQ,SAAA1jC,KAAA4gD,GAAsB,GAEpC5tD,iDAjBEA,MAFA,WAAAsgC,EAAAutB,iBAAAvtB,EAAAutB,gBAAAhS,MAAA+R,EAAA/R,IAEA77C,CAFmE,UAAA4tD,EAEnE5tD,CADmB,UAAA4tD,EAAA98C,IAAAwvB,EAAAwc,kBAAAxc,EAAAwc,mBAAA8Q,EAAA98C,iDAXzB9Q,MAAA,6CAIEA,MAAA,kBAAAqW,GAAArW,MAAA8tD,GAAA,MAAAC,GAAA/tD,QAAAmP,UAAAmxB,GAAAtgC,QAAA,OAAAA,MAAAsgC,GAAA5wB,UAAA4wB,GAAA0tB,aAAAD,GAAA5oD,MAAAkR,EAAA,GAEArW,MAAA,EAAAiuD,GAAA,sBAyBFjuD,qDA5BEA,MADA,QAAAA,MAAA,IAAAsgC,EAAA0tB,aAAAD,EAAA5oD,MACAnF,CAD2D,YAAAsgC,EAAA5wB,UAAA4wB,EAAA0tB,aAAAD,EAAA5oD,OAI5BnF,MAAA,GAAAA,MAAA,UAAA+tD,EAAAzoD,oDAiC/BtF,MAAA,yBAeEA,MAFA,4BAAAkuD,EAAAluD,MAAAmuD,GAAAh/C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAAYsgC,GAAA8rB,SAAAp/C,KAAAkhD,GAAsB,EAElCluD,CAFmC,0BAAAkuD,EAAAluD,MAAAmuD,GAAAh/C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACzBsgC,GAAAzU,OAAA7e,KAAAkhD,GAAoB,EAC9BluD,CAD+B,4BAAAkuD,EAAAluD,MAAAmuD,GAAAh/C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACnBsgC,GAAAoQ,SAAA1jC,KAAAkhD,GAAsB,GAEpCluD,iDATEA,MALA,eAAAsgC,EAAA8G,cAAApoC,UAAA,oCAKAgB,CAHC,WAAAsgC,EAAAutB,iBAAAvtB,EAAAutB,gBAAAhS,MAAAqS,EAAArS,IAGD77C,CAFmE,UAAAkuD,EAEnEluD,CADmB,UAAAsgC,EAAA8tB,eAAA9tB,EAAAwc,mBAAAoR,EAAAp9C,GAAAwvB,EAAAwc,mBAAAoR,EAAArS,kCAbvB77C,MAAA,EAAAquD,GAAA,sDAIEruD,MAAA,UAAA+tD,EAAAzoD,oCAJFtF,MAjCA,EAAAsuD,GAAA,yBAiCAtuD,CA5BC,EAAAuuD,GAAA,kDAJEvuD,MAAA,OAAA+tD,EAAAzoD,MAAAkD,QAAA83B,EAAA2qB,KAAAzpD,eAiCAxB,cAAA,OAAA+tD,EAAAzoD,MAAAkD,SAAA83B,EAAA2qB,KAAAzpD,0CA0BLxB,MAAA,YACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,iDCtHG,IAAMwuD,GAAoB,MAA3B,MAAOA,GA2GD79C,MACDy2B,cACA6jB,KACC/zC,OACA3W,gBACAw6C,eA/GHqT,eACCK,gBAAgC,CAAErT,KAAM,IAChDD,UAA2C,IAAIx6C,IAC7C/B,KAAK6vD,iBAGP1wC,QAAU,IAAIC,KAAoB,GAE1B0wC,SAER,YACIxR,GACF,OAAOt+C,KAAK+vD,SACd,CACA,YAAIzR,CAAS53C,GACX1G,KAAK+vD,UAAYrpD,EACjB1G,KAAK2C,MACP,CACQotD,UAA0B,CAAEvT,KAAM,IAEjCyS,gBAEAxuC,IAET,oBACIy9B,GACF,OAAOl+C,KAAKwvD,eACRxvD,KAAKgwD,kBACJhwD,KAAKm8C,eAAej8C,IAAI,yBACvBF,KAAKgwD,iBACb,CACA,oBAAI9R,CAAiBx3C,GACnB1G,KAAKgwD,kBAAoBtpD,CAC3B,CACQspD,kBAEDl/C,UAAgC,GAE7Bmc,OAAS,IAAI3f,MACbwkC,SAAW,IAAIxkC,MACfo/C,KAAO,IAAIp/C,MACXtE,OAAS,IAAIsE,MACbk/C,KAAO,IAAIl/C,MACXtF,MAAQ,IAAIsF,MACZyO,OAAS,IAAIzO,MACbq1B,KAAO,IAAIr1B,MACXihC,KAAO,IAAIjhC,MACX2iD,mBAAqB,IAAI3iD,MACzBkgD,SAAW,IAAIlgD,MACfm/C,kBAAoB,IAAIn/C,MACxBmgD,YAAc,IAAIngD,MAClB4iD,yBAA2B,IAAI5iD,MAIlC8hD,aAAe,CACpB5S,KAAM,yCACN2T,OAAQ,4CACRxK,OAAQ,6CAGHyK,MACA5S,YAAuC,GAEvC5F,YAAc,IAAIxsC,MAAY,IAC9B6G,cAAgBjH,MAAcE,QAE9BK,MAAQ,UAER8kD,YAAa,EAKpB,QACInC,CAAKxnD,GACP1G,KAAKswD,MAAQ5pD,EACb1G,KAAK2C,MACP,CACA,QAAIurD,GACF,OAAOluD,KAAKswD,KACd,CACOA,MAAgB,GAEvB,eAAIC,GACF,OAAOvwD,KAAKwwD,YACd,CACA,eAAID,CAAY7pD,GACd1G,KAAKwwD,aAAe9pD,EACpB1G,KAAK2C,MACP,CACQ6tD,kBAAwBxuD,EAEzByuD,kBAAoB3C,GAAwBC,OAE5C2C,kBAAoB,EAE3B,WAAIC,GACF,OACG3wD,KAAKs+C,SAAS9B,KAAK5yC,SACnB5J,KAAKs+C,SAASqH,QAAQ/7C,SACtB5J,KAAKs+C,SAAS6R,QAAQvmD,MAE3B,CAEA7J,YACUgS,EACDy2B,EACA6jB,EACC/zC,GACA3W,GACAw6C,IALAn8C,KAAA+R,QACD/R,KAAAwoC,gBACAxoC,KAAAqsD,OACCrsD,KAAAsY,UACAtY,KAAA2B,mBACA3B,KAAAm8C,kBAERn8C,KAAKwvD,eAAiBxvD,KAAKwoC,cAAcpoC,UAAU,UACrD,CAEAmN,WACEvN,KAAK8vD,SAAW9vD,KAAKmf,QAClBpb,QAAK6sD,MAAS,OAAMC,MAAM,MAC1BhuD,UAAU,KACT7C,KAAKu8C,UAAU55C,KAAK3C,KAAK8wD,mBAAmB9wD,KAAKs+C,UAAS,GAG9Dt+C,KAAK43C,YAAY1yB,KAAK,CACpB,CACEhT,GAAI,eACJtG,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,2CAEFlhC,KAAM,OACNkC,QAAS7N,KAAK2B,gBAAgB4pB,UAAUshB,QACtC,kDAEFtgC,QAASA,KACPvM,KAAK+wD,eAAc,EAAI,GAG3B,CACE7+C,GAAI,iBACJtG,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,yCAEFlhC,KAAM,MACNkC,QAAS7N,KAAK2B,gBAAgB4pB,UAAUshB,QACtC,gDAEFtgC,QAASA,KACPvM,KAAK+wD,eAAc,EAAK,IAIhC,CAEQpuD,OACN3C,KAAKmf,QAAQxc,MACf,CAEQmuD,mBAAmBxS,GACzB,GAAkB,KAAdt+C,KAAKkuD,KACP,OAAIluD,KAAKuwD,cACPjS,EAAWt+C,KAAKgxD,iBAAiB1S,IAE5BA,EACF,CAaL,IAAI2S,EAA+B,CACjCzU,KAbW8B,EAAS9B,KAAK9yC,OAAQo0C,KACjC,MAAMtlB,GAAmBx4B,KAAKkuD,KAC3B/1B,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAK/B,OAJ+BolB,GAAQlyC,MACpCusB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACDV,SAASQ,GAAgB,IAOzD,GAAIx4B,KAAKs+C,SAASqH,OAAQ,CACxB,MAAMuL,GAAU5S,EAASqH,OAAOj8C,OAAQo0C,KACtC,MAAMtlB,GAAmBx4B,KAAKkuD,KAC3B/1B,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAK/B,OAJ+BolB,GAAQlyC,MACpCusB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACDV,SAASQ,GAAgB,GAEzDy4B,EAAetL,OAASuL,EAC1B,CAEA,GAAIlxD,KAAKs+C,SAAS6R,OAAQ,CACxB,MAAMA,GAAS7R,EAAS6R,OAAOzmD,OAAQo0C,KACrC,MAAMtlB,GAAmBx4B,KAAKkuD,KAC3B/1B,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAK/B,OAJ+BolB,GAAQlyC,MACpCusB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACDV,SAASQ,GAAgB,GAEzDy4B,EAAed,OAASA,EAC1B,CAEA,OAAInwD,KAAKuwD,cACPU,EAAiBjxD,KAAKgxD,iBAAiBC,IAElCA,CACT,CACF,CAEA/iD,cACElO,KAAK8vD,SAAS3hD,aAChB,CAEOgjD,aACL,OAAQnxD,KAAKywD,mBACX,KAAK3C,GAAwBC,OAC3B,OAAO,EACT,KAAKD,GAAwBE,MAC3B,OAAO,EACT,QACE,IAAIoD,EAAcpxD,KAAKs+C,SAAS9B,KAAK5yC,OAOrC,OALKwnD,GADLpxD,KAAKs+C,SAASqH,OACM3lD,KAAKs+C,SAASqH,OAAO/7C,OACrB,EAEfwnD,GADLpxD,KAAKs+C,SAAS6R,OACMnwD,KAAKs+C,SAAS6R,OAAOvmD,OACrB,EAChBwnD,GAAepxD,KAAK0wD,kBAK9B,CAEAM,iBAAiB1S,GACf,GAAIA,EAAU,CACZ,MAAM+S,EAAep5B,KAAKC,MAAMD,KAAKouB,UAAU/H,IAC/C+S,SAAa7U,KAAKh6B,KAAK,CAAC8/B,EAAGC,KACrBviD,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,QACtC,EAEL5L,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,OACtC,EAEF,GAGLylD,EAAalB,OACfkB,EAAalB,OAAO3tC,KAAK,CAAC8/B,EAAGC,KACvBviD,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,QACtC,EAEL5L,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,OACtC,EAEF,GAEAylD,EAAa1L,QACtB0L,EAAa1L,OAAOnjC,KAAK,CAAC8/B,EAAGC,KACvBviD,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,QACtC,EAEL5L,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,GAAE32C,OACtC,EAEF,GAGJylD,CACT,CACF,CAEA54B,UAAU64B,GACR,OAAOA,EACJ74B,UAAU,OACVC,QAAQ,mBAAoB,IAC5BP,aACL,CAEAo5B,aACEvxD,KAAKuwD,aAAevwD,KAAKuwD,WAC3B,CAEAtC,cACEjuD,KAAKkuD,KAAO,EACd,CAEA6C,cAAc3gD,GACZpQ,KAAKsY,OACFC,KAAKs1C,GAAyB,CAAEl1C,cAAc,IAC9CE,cACA9U,QAAK6lD,KAAK,IACV/mD,UAAW+I,IACNA,GACF5L,KAAK+b,OAAO3N,KAAK,CAAExC,QAAOwE,SAAO,EAGzC,CAEAm+C,cAAc/rD,GACZ,GAAIA,EAEF,OADmBxC,KAAKw9C,YAAYp7B,KAAMzY,GAAMA,EAAEqlB,OAASxsB,EAAKwsB,KAGpE,CAEAs/B,qBAAqB9rD,EAAM22C,GACzB,MAAMqF,EAAax+C,KAAKuuD,cAAc/rD,GAUtC,GATIg8C,IACFA,EAAW3wB,SAAW2wB,EAAW3wB,QACjC7tB,KAAKm8C,eAAe97C,IAClB,wBAA0Bm+C,EAAWxvB,KACrCwvB,EAAW3wB,SAEb2wB,EAAWgQ,eAAgB,GAGzBrV,EAAQ,CACV,IAAIqV,IAAgB,EAEpB,UAAWx0B,MAAKmf,EAAOyV,OAErB,GADoB5uD,KAAKuuD,cAAcv0B,IACvBnM,UAAY2wB,EAAW3wB,QAAS,CAC9C2gC,IAAgB,EAChB,KACF,CAEF,MAAMgD,GAAmBxxD,KAAKuuD,cAAcpV,GACxCqY,KACFA,GAAiB3jC,QAAU2wB,EAAW3wB,QACtC7tB,KAAKm8C,eAAe97C,IAClB,wBAA0BmxD,GAAiBxiC,KAC3CwvB,EAAW3wB,SAEb2jC,GAAiBhD,cAAgBA,GAErC,CAEA,GAAIhsD,EAAKosD,OACP,UAAW50B,MAAKx3B,EAAKosD,OAAQ,CAC3B,MAAM6C,GAAqBzxD,KAAKuuD,cAAcv0B,IAE5Cy3B,IACAA,GAAmB5jC,UAAY2wB,EAAW3wB,UAE1C4jC,GAAmB5jC,QAAU2wB,EAAW3wB,QACxC7tB,KAAKm8C,eAAe97C,IAClB,wBAA0BoxD,GAAmBziC,KAC7CwvB,EAAW3wB,SAGjB,CAGF7tB,KAAKkwD,yBAAyB9hD,KAAKpO,KAAKw9C,YAC1C,CAEAW,YAAYL,GAEV,GADAA,EAAQ1oC,QAAS,GACZpV,KAAKqwD,WAAY,CACpB,MAAM/R,EAAyB,CAAE9B,KAAM,GAAI2T,OAAQ,GAAIxK,OAAQ,IAC/DrH,EAAS9B,KAAOx8C,KAAKs+C,SAAS9B,KAAK9yC,OAAQswB,GAAMA,EAAE9nB,KAAO4rC,EAAQ5rC,IAClEosC,EAAS6R,OAASnwD,KAAKs+C,SAAS6R,OAAOzmD,OAAQswB,GAAMA,EAAE9nB,KAAO4rC,EAAQ5rC,IACtEosC,EAASqH,OAAS3lD,KAAKs+C,SAASqH,OAAOj8C,OAAQswB,GAAMA,EAAE9nB,KAAO4rC,EAAQ5rC,IACtElS,KAAKs+C,SAAWA,CAClB,CACAt+C,KAAK2iC,KAAKv0B,KAAK0vC,EACjB,CAEAM,YAAYN,GACVA,EAAQ1oC,QAAS,EACjBpV,KAAKuuC,KAAKngC,KAAK0vC,EACjB,4CA7XW8R,IAAoBxuD,mBAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA,+BAApB6pD,GAAoBthD,UAAA,uBAAAC,OAAA,CAAA+vC,SAAA,WAAA2Q,gBAAA,kBAAAxuC,IAAA,MAAAy9B,iBAAA,mBAAAgQ,KAAA,QAAA1/C,QAAA,CAAAye,OAAA,SAAA6kB,SAAA,WAAA4a,KAAA,OAAA1jD,OAAA,SAAAwjD,KAAA,OAAAxkD,MAAA,QAAA+T,OAAA,SAAA4mB,KAAA,OAAA4L,KAAA,OAAA0hB,mBAAA,qBAAAzC,SAAA,WAAAf,kBAAA,oBAAAgB,YAAA,cAAAyC,yBAAA,4BAAAzhD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,2xDAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,kBD5E/B1N,MADF,eACEA,CAD4B,WAE1BA,MAAA,EAAAswD,GAAA,wBA0BEtwD,MADF,UACEA,CAD6B,mCAS3BA,MAAA,mBAAAA,aAAAyK,IAAAzK,MAAS2N,EAAAwiD,aAAY,GAErBnwD,MAAA,gBAA0BA,MAAA,mBAC5BA,UAeAA,MAbA,EAAAuwD,GAAA,sBAaAvwD,CAHC,EAAAwwD,GAAA,iBAaDxwD,MAAA,sBACEA,MAAA,GAAAywD,GAAA,uBAkDEzwD,MADF,eACEA,CADwC,sBAItCA,MADA,iBAAAqW,IAAArW,aAAAyK,IAAAzK,MAASqW,GAAAgX,kBAAwB,EACjCrtB,CADkC,oBAAAA,aAAAyK,IAAAzK,MACxB2N,EAAAkhD,mBAAA7hD,OAAyB,GAErChN,QACAA,MAAA,WACEA,MAAA,0BAKVA,gBAEAA,MAAA,GAAA0wD,GAAA,6DAiEA1wD,MAAA,GAAA2wD,GAAA,cAGF3wD,cArMUA,MAAA,iBAEWA,MAAA,GAAAA,MAAA,OAAA2N,EAAAoiD,cA4Bb/vD,MAAA,GAAAA,MAAA,WAAA2N,EAAAwhD,aAEAnvD,MAAA,aAAAA,MAAA,uDAUCA,MAAA,GAAAA,MAAA,OAAA2N,EAAAs9C,KAAAzpD,eAAAmM,EAAAygD,gBAaApuD,cAAA,OAAA2N,EAAAs9C,KAAAzpD,eAAAmM,EAAAygD,gBAU8BpuD,MAAA,GAAAA,MAAA,UAAA2N,EAAAqhD,OAmD3BhvD,MAAA,GAAAA,MAAA,UAAA2N,EAAAshD,YAMAjvD,MAAA,GAAAA,MAAA,IAAAA,MAAA,oDAURA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAAA,MAAA,MAAA2N,EAAAwtC,aA8DIn7C,MAAA,GAAAA,MAAA,OAAA2N,EAAA4hD,yBCzIJ/d,MACAzjC,KACA8a,KAAkBjkB,eAClB62B,KAAcloB,KACd8nB,KAAW5nB,eACXtF,KAAeuF,KACftF,MAAastB,MACbztB,MAAgB2tB,MAChBprB,MACA8C,MAAawoB,kBACbzoB,KACAhF,MAAiB2tB,MACjB/lB,MACAi2C,GACApc,MACAxhC,KACAsiD,KACAriD,KAAiB0tB,OAAAxtB,OAAA,uwBAAAC,gBAAA,WAGR8/C,EAAoB,2DC3E7BxuD,MADF,UACEA,CADuC,QACnCA,MAAA,wBAAwDA,QAC5DA,MAAA,OAAGA,MAAA,wBACLA,kBAFMA,MAAA,GAAAA,YAAA,6CACDA,MAAA,GAAAA,YAAA,sEAcDA,MAAA,wBACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,6FAXJA,MADF,UACEA,CADsC,uBAEpCA,MAAA,yBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,MAAA,GAAAA,aAAAkK,GAAAwyC,QAAAn3C,MAAA8Q,KAAAnM,GAAAwyC,QAAAn3C,MAAA8Q,GAAArW,MAAAqW,EAAA,GACArW,MAAA,oBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,UAAAA,MAAUkK,EAAA2mD,aAAA7jD,KAAA9C,EAAAwyC,SAA0B,GAEpC18C,MAAA,wBACEA,MAAA,wBACFA,QACAA,MAAA,wBACEA,MAAA,wBACFA,QACAA,MAAA,EAAA8wD,GAAA,0BAIJ9wD,oCAbIA,cAAA,UAAAkK,EAAAwyC,QAAAn3C,OAIEvF,MAAA,GAAAA,MAAA,IAAAA,MAAA,iDAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,gDAEiBA,MAAA,GAAAA,MAAA,OAAAkK,EAAAnF,YAAAd,uCAwBjBjE,MAAA,mBACEA,MAAA,GAAkBA,MAAA,QAClBA,MAAA,cAA8BA,MAAA,GAChCA,sCAHgDA,MAAA,QAAA+wD,GAC9C/wD,cAAA,IAAA+wD,EAAAvmD,MAAA,IAC8BxK,MAAA,GAAAA,MAAA+wD,EAAAnjC,mDApBtC5tB,MAAA,aAGEA,MAAA,sBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,MAAA,UAAAA,MAAYkK,EAAAigD,iBAAAjgD,EAAA60B,KAAAz5B,OAA4B,GAExCtF,MAAA,uBACEA,MAAA,mCAOAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,GAAAlK,MAAA,UAAAA,MAAkBkK,GAAA8mD,iBAAA36C,EAAA+f,OAAA9wB,OAAqC,GAGvDtF,MAAA,EAAAixD,GAAA,qBAIFjxD,QACAA,MAAA,eACEA,MAAA,wBAEJA,UAGEA,MADF,wBACEA,CADgD,0BAE9CA,MAAA,0BACFA,QACAA,MAAA,0BACEA,MAAA,0BAEJA,UAGEA,MADF,YACEA,CADiC,gBAE/BA,MAAA,0BAGNA,iDAxCEA,MAAA,YAAAkK,EAAA60B,MAOI/+B,MAAA,GAEAA,MAFA,cAAAA,MAAA,oCAEAA,CAFyD,cAAAkK,EAAAy0B,YAEzD3+B,CAD2B,kBAAAkxD,GAM3BlxD,MAAA,GAAAA,MAAA,cAAAkK,EAAAinD,WAE+BnxD,MAAA,GAAAA,MAAA,UAAAkK,EAAAknD,SAM/BpxD,MAAA,GAAAA,MAAA,IAAAA,MAAA,mDAMAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0CAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2CAKsCA,MAAA,GAAAA,MAAA,YAAAkK,EAAA60B,KAAA4F,OACtC3kC,cAAA,IAAAA,MAAA,yFAwBMA,MAAA,oCASEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA0hD,EAAArxD,QAAAmP,UAAAjF,GAAAlK,MAAA,UAAAA,MAASkK,GAAAonD,iBAAAtkD,KAAAqkD,GAAiC,GAE1CrxD,MAAA,cAAUA,MAAA,YACZA,gBANEA,MAAA,aAAAA,MAAA,mEAjBJA,MADF,kBACEA,CADa,iBACaA,MAAA,YAAMA,QAChCA,MAAA,WACEA,MAAA,GACAA,MAAA,cAA8BA,MAAA,GAChCA,UAEAA,MAAA,YAKEA,MAAA,EAAAuxD,GAAA,iBAcJvxD,iDAvBIA,MAAA,GAAAA,MAAA,IAAAqxD,EAAAG,YAAA,KAC8BxxD,MAAA,GAAAA,MAAAqxD,EAAAxT,QAS3B79C,MAAA,GAAAA,MAAA,OAAAkK,EAAAunD,UAAAJ,EAAAxT,SAAA3zC,EAAAnF,YAAAzD,cAAAF,KAAAoG,wCAlBXxH,MAAA,6CAIEA,MAAA,EAAA0xD,GAAA,sBA6BF1xD,yCA/BEA,MAAA,QAAAA,MAAA,8BAAA2xD,EAAAxsD,MAEkCnF,MAAA,GAAAA,MAAA,UAAA2xD,EAAArsD,iCAJpCtF,MAAA,EAAA4xD,GAAA,gCACG5xD,MAAA,oBAAAsF,MAAAkD,qCAHPxI,MAAA,cACEA,MAAA,EAAA6xD,GAAA,0CAoCF7xD,gCApC0CA,cAAA,UAAAA,MAAA,IAAAkK,EAAAkyC,4CApE5Cp8C,MAAA,SAmEEA,MAlEA,EAAA8xD,GAAA,YAkEA9xD,CAlEyC,EAAA+xD,GAAA,YAkEzC/xD,CA7DwC,EAAAgyD,GAAA,eA6DxChyD,CAxCC,EAAAiyD,GAAA,kBA8EHjyD,+BAxGQA,cAAA,QAAAkK,EAAAunD,UAKAzxD,cAAA,OAAAkK,EAAAunD,UAkBHzxD,cAAA,mBAAAkK,EAAAwyC,QAAAn3C,OAAA2E,EAAAunD,UA2CQzxD,cAAA,OAAAkK,EAAAkyC,aAAA,YAAAlyC,EAAAwyC,QAAAn3C,QCGN,IAAM2sD,GAA2B,MAAlC,MAAOA,GA+CD99B,YACAu2B,GACAtqD,KACD0E,YACClG,OAlDHkgC,KAEP,WACI2d,GACF,OAAO99C,KAAKugD,QACd,CACA,WAAIzC,CAAQp3C,GACV1G,KAAKugD,SAAW75C,EAChB1G,KAAK+rD,GAAGpvC,eACV,CACQ4jC,SAER,eACI/C,GACF,OAAOx9C,KAAKuzD,YACd,CACA,eAAI/V,CAAY92C,GACd1G,KAAKuzD,aAAe7sD,EACpB1G,KAAK+rD,GAAGpvC,eACV,CACQ42C,aAER,WAAIf,GACF,OAAOxyD,KAAKwzD,QACd,CACA,WAAIhB,CAAQ9rD,GACV1G,KAAKwzD,SAAW9sD,EAChB1G,KAAK+rD,GAAGpvC,eACV,CACQ62C,SAA6B,GAErC,YAAIX,GACF,OAAO7yD,KAAK89C,QAAQU,aAAe1C,EAAeA,EAAeG,MACnE,CAEQwX,eAED1zB,YAAc,IAAI2zB,KACzBC,mBAEUC,cAAiD,IAAItmD,MACrDolD,iBACR,IAAIplD,MACI2kD,aAAsC,IAAI3kD,MAEpDvN,YACUy1B,EACAu2B,EACAtqD,EACD0E,GACClG,IAJAD,KAAAw1B,cACAx1B,KAAA+rD,KACA/rD,KAAAyB,OACDzB,KAAAmG,eACCnG,KAAAC,SACP,CAEHsN,WACEvN,KAAK0pD,YAEL1pD,KAAKyzD,eACHzzD,KAAKC,OAAOG,UAAU,eAAiB,kBAEzCJ,KAAK2zD,mBAAqB3zD,KAAK+/B,YAAYxH,aAAa11B,UACrD6D,IACKA,EAAMkD,QACR5J,KAAKyB,KACFvB,IAAIF,KAAKyzD,eAAiB,KAAO/sD,GACjC7D,UAAW2vD,IACVxyD,KAAKwyD,QAAUA,IAEnBxyD,KAAKwyD,QAAQ9oD,OAAQu1C,IACnB,MAAMzmB,EAAmB9xB,EACtByxB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACzBm7B,GAAwB5U,EAAOrzC,MAClCusB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAO/B,OAN6BumB,EAAOjwB,KACjCmJ,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAENm7B,IACD77B,SAASQ,EAAgB,IAGnDx4B,KAAKwyD,QAAU,IAIvB,CAEAD,UAAUtT,GACR,OAAOA,EAASA,EAAOrzC,WAAQ5J,CACjC,CAEOupD,iBAAiB7kD,GACtB1G,KAAK4zD,cAAcxlD,KAAK1H,EAC1B,CAEQgjD,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCge,OAAQ,GACRC,eAAgB,CAAC,SAErB,CAEAkT,iBAAiB1rD,GACf1G,KAAKmgC,KAAK5I,SAAS,CACjB0nB,OAAQv4C,EAAMsoB,KACdkwB,eAAgBl/C,KAAKmgC,KAAKz5B,MAAMw4C,gBAEpC,4CAhHWoU,IAA2BlyD,MAAAuE,MAAAvE,mBAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA,+BAA3BwtD,GAA2BhlD,UAAA,8BAAAC,OAAA,CAAAuvC,QAAA,UAAAN,YAAA,eAAAhvC,QAAA,CAAAolD,cAAA,gBAAAlB,iBAAA,mBAAAT,aAAA,gBAAAxjD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,g+BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDtExC1N,MAAA,EAAA0yD,GAAA,kBAAM1yD,MAAA,OAAA2N,EAAA+uC,wBCkDF3uC,KACA4kD,MAAchuD,YACd02B,KAAW92B,8BACX43B,KAAmB53B,eACnBskB,KAAkBjkB,UAClB62B,KAAcloB,KACdgoB,MAAqB9nB,MAAAC,KAAAD,MACrBJ,KACA0V,KACA5a,KAAeutB,UACf8V,MACAv7B,MACAjI,MAAa4tB,wBACbxtB,MAAa0tB,MACbO,MACApuB,MAAgB+tB,MAChB40B,KACAriD,KAAiB0tB,OAAAxtB,OAAA,qNAGRyjD,EAA2B,yDCvCjC,ICnBMU,GAAe,MAAtB,MAAOA,GAID5K,eACY/M,MAJd4X,SAAW,GAEnBl0D,YACUqpD,EACY/M,GADZr8C,KAAAopD,iBACYppD,KAAAq8C,QAEpBr8C,KAAKq8C,MAAMuE,YAAY/9C,UAAWkE,IAC5BA,EAAOmtD,OACTl0D,KAAKi0D,SAAWltD,EAAOmtD,KAAA,EAG7B,CAEAC,cAAcC,GACZ,OAAOp0D,KAAKi0D,SACR,GAAGzsD,SAAS6sD,OAAS7sD,SAAS8sD,oBAC5BF,EAAWnX,YACJj9C,KAAKi0D,WACd,GAAGzsD,SAAS6sD,OAAS7sD,SAAS8sD,oBAAoBF,EAAWnX,KACnE,CAEAsX,oBAAoB9zC,EAAa2zC,GAC/B,MAAMtW,EAAU99C,KAAKopD,eAAejI,kBAAkB1gC,GACtDq9B,SAAQn3C,MAAQ,SAChBm3C,EAAQlyC,MAAQwoD,EAAWxoD,MAC3BkyC,EAAQb,IAAMmX,EAAWnX,IAClBj9C,KAAKopD,eAAertC,OAAO+hC,EACpC,CAEA0W,oBAAoB/zC,EAAa2zC,EAAYliD,GAC3C,MAAM4rC,GAAU99C,KAAKopD,eAAejI,kBAAkB1gC,GACtD,OAAOzgB,KAAKopD,eAAezpC,OAAOzN,EAAI,CACpCtG,MAAOwoD,EAAWxoD,MAClB6U,IAAKq9B,GAAQr9B,KAEjB,CAEAg0C,iBAAiBh0C,EAAai0C,GAC5B,KACG10D,KAAKq8C,OACLr8C,KAAKq8C,MAAMx8C,QAAQ80D,oBACnB30D,KAAKq8C,MAAMx8C,QAAQ+0D,qBACnBn0C,EAAIyhC,eAAeH,WAEpB,OAEF,MAAM8S,EAAMH,EAAkBI,kBAAkBC,YAEhD,IAAIC,GAAah1D,KAAKq8C,MAAMx8C,QAAQ80D,mBAChCM,GAAej1D,KAAKq8C,MAAMx8C,QAAQ+0D,oBACtC,MAAM9U,GAASr/B,EAAIq/B,OAEboV,GAAgBpV,GAAOp2C,OAC1B04C,IAAQA,GAAIvrB,UAAYurB,GAAI+S,oBAEzBC,GAAkBtV,GAAOp2C,OAC5B04C,KAASA,GAAIvrB,UAAYurB,GAAI+S,oBAGH,IAAzBD,GAActrD,SAChBorD,GAAa,IAEgB,IAA3BI,GAAgBxrD,SAClBqrD,GAAe,IAGjB,IAAII,GAAY,GACZC,GAAe,GACfJ,GAActrD,OAASwrD,GAAgBxrD,QACzCyrD,GAAY,GAAGL,QAAgBC,MAC/BK,GAAeF,KAEfC,GAAY,GAAGJ,QAAkBD,MACjCM,GAAeJ,IAGjB,UAAWzS,MAAS6S,GACd7S,GAAMvwC,KACRmjD,IAAa5S,GAAMvwC,GAAK,KAG5B,MAAMqjD,GAAkB,GAClBC,GAAgBx1D,KAAKopD,eAAe9M,SAAS51C,MAAMo5C,OACzD,UAAWuD,MAAgBmS,WAEhBnS,GAAanxC,GAAO,YACpBmxC,GAAa5/B,OAAW,MAE/B8xC,GAAgBjuD,KAAK+7C,GAAanxC,IAAMmxC,GAAa5/B,OAAOvR,IAIhE,MAAMujD,GAA4Bz1D,KAAK01D,oBACrC5V,GACAyV,GACA,OAEII,GAA6B31D,KAAK01D,oBACtC5V,GACAyV,GACA,QAEIK,GAAmC51D,KAAK01D,oBAC5C5V,GACAyV,GACA,cAEIM,GAAwC71D,KAAK01D,oBACjD5V,GACAyV,GACA,mBAEIO,GAAuC91D,KAAK01D,oBAChD5V,GACAyV,GACA,kBAGFF,GAAYA,GAAU/K,OAAO,EAAG+K,GAAUzrD,OAAS,GAEnD,MACMm7C,GAAY/kD,KAAKq8C,MAAMx8C,QAAQklD,UAC/BpE,GAAa3gD,KAAKq8C,MAAMx8C,QAAQ8gD,WAEhCmB,GAAO,GAJG9hD,KAAKq8C,MAAMx8C,QAAQolD,WAIRxkC,EAAIyhC,eAAeH,YACxCgU,GAAct1C,EAAIyhC,eAAeN,UAAU,cAAgB,GAG3DF,GAAS,GAAGqD,MAFLgR,GAAY,GAAGC,QAAQ,GAAGt9B,QAAQ,eAAgB,UACnDq9B,GAAY,GAAGC,QAAQ,GAAGt9B,QAAQ,eAAgB,SACjBA,QAAQ,UAAW,IAChE,IAAIolB,GAAU,GACV99C,KAAKopD,eAAe9M,SAAS51C,QAC/Bo3C,GAAU,GAAG6C,MAAc3gD,KAAKopD,eAAe9M,SAAS51C,MAAMu2C,OAGhE,IAAI16C,GAAMvC,KAAKi0D,SACX,GAAGzsD,SAAS6sD,SAAS7sD,SAAS8sD,YAAYxW,MAAWgE,MAAQJ,MAAU2T,MAAaR,KAAOY,MAA6BZ,KAAOc,MAA8BC,MAAoCC,MAAyCC,WAA6C91D,KAAKi0D,WAC5R,GAAGzsD,SAAS6sD,SAAS7sD,SAAS8sD,YAAYxW,MAAWgE,MAAQJ,MAAU2T,MAAaR,KAAOY,MAA6BZ,KAAOc,MAA8BC,MAAoCC,MAAyCC,KAC9O,QAAS1mB,GAAI,EAAGA,GAAI,EAAGA,KACrB7sC,GAAMA,GAAIm2B,QAAQ,MAAO,KACzBn2B,GAAMA,GAAI0zD,SAAS,KAAO1zD,GAAIshB,MAAM,GAAG,GAAMthB,GAE/CA,UAAMA,GAAI0zD,SAAS,KAAO1zD,GAAIshB,MAAM,GAAG,GAAMthB,GAC7CA,GAAMA,GAAIm2B,QAAQ,OAAQ,OAC1Bn2B,GAAMA,GAAIm2B,QAAQ,KAAM,KAEjBn2B,EACT,CAEQmzD,oBACN5V,EACAyV,EACAW,GAEA,MAAMC,GAAuB,GAC7B,UAAW1T,MAAS3C,EAAOp2C,OACxBq2C,IAAMA,GAAE1pB,WAAWx2B,SAAS2D,OAAS0yD,GAEtC,IAA0C,IAAtCX,EAAgB7sD,QAAQ+5C,GAAMvwC,IAAY,CAC5C,IAEIkkD,GAFAC,GAAUC,mBAAoB7T,GAAMpsB,WAAWx2B,QAAgB0C,KAC/Dg0D,GAAa,GAEjB,OAAQ9T,GAAMpsB,WAAWx2B,QAAQ2D,KAAK20B,eACpC,IAAK,MACH,MAAMq+B,GAAoB/T,GAAMpsB,WAC7Bx2B,QACH02D,GAAaD,mBAAmBE,GAAkBzvD,OAAO0vD,QACzDL,GACuC,UAArCI,GAAkBzvD,OAAO2vD,QACrBN,GACAI,GAAkBzvD,OAAO2vD,QAC/B,MACF,IAAK,OACL,IAAK,aACL,IAAK,kBACL,IAAK,iBACHH,GAAaD,mBACV7T,GAAMpsB,WAAWx2B,QAAgB4iD,OAIxC,MAAMkU,GAAqB,GAAGJ,UAAkB9T,GAAMD,SAEtD,IAAIoU,GAAU,GACd,GAAIR,GAAc,CAChB,MAAMS,IACmD,IAAtDpU,GAAMpsB,WAAWx2B,QAAgB0C,IAAImG,QAAQ,KAC1C,IACA,IACNkuD,GAAUN,mBAAmB,GAAGO,aAAmBT,KACrD,CACAC,GAAU,GAAGA,KAAUO,KAGpBT,GAAqB/zC,KAAM00C,IAAeA,GAAWv0D,MAAQ8zD,IAO9DF,GAAqB57C,QAAS6zB,KACxBA,GAAQ7rC,MAAQ8zD,IAClBjoB,GAAQ0R,OAAOx4C,KAAKqvD,GAAkB,GAP1CR,GAAqB7uD,KAAK,CACxB/E,IAAK8zD,GACLvW,OAAQ,CAAC6W,KASf,CAGF,IAAII,GAAyB,GAC7B,GAAIZ,GAAqBvsD,QAAU,EAAG,CACpC,IAAIotD,GACAC,GAOJ,OAAQf,EAAY/9B,eAClB,IAAK,MACH6+B,GAAah3D,KAAKq8C,MAAMx8C,QAAQq3D,UAChCD,GAAYj3D,KAAKq8C,MAAMx8C,QAAQs3D,aAC/B,MACF,IAAK,OACHH,GAAah3D,KAAKq8C,MAAMx8C,QAAQu3D,WAChCH,GAAYj3D,KAAKq8C,MAAMx8C,QAAQw3D,cAC/B,MACF,IAAK,aACHL,GAAah3D,KAAKq8C,MAAMx8C,QAAQy3D,aAChCL,GAAYj3D,KAAKq8C,MAAMx8C,QAAQ03D,gBAC/B,MACF,IAAK,kBACHP,GAAah3D,KAAKq8C,MAAMx8C,QAAQ23D,cAChCP,GAAYj3D,KAAKq8C,MAAMx8C,QAAQ43D,iBAC/B,MACF,IAAK,iBACHT,GAAah3D,KAAKq8C,MAAMx8C,QAAQ63D,cAChCT,GAAYj3D,KAAKq8C,MAAMx8C,QAAQ83D,iBAC/B,MACF,QACEX,GAAa,GACbC,GAAY,GAGhB,IAAIW,GAAqB,GACrBC,GAAoB,GACxB1B,GAAqB57C,QAAS6zB,KAC5BwpB,IAAsB,GAAGxpB,GAAQ7rC,OACjCs1D,IAAqB,IAAIzpB,GAAQ0R,OAAOj2C,KAAK,QAAI,GAEnD+tD,GAAqBA,GAAmB3B,SAAS,KAC7C2B,GAAmB/zC,MAAM,GAAG,GAC5B+zC,GACJC,GAAoBA,GAAkB5B,SAAS,KAC3C4B,GAAkBh0C,MAAM,GAAG,GAC3Bg0C,GACJd,GAAyB,GAAGC,MAAcY,MAAsBX,MAAaY,IAC/E,CAEA,OAAOd,EACT,4CAtQW/C,IAAe5yD,MAAAuE,GAAAvE,MAAAwE,KAAA,oCAAfouD,GAAe3yD,QAAf2yD,GAAe1yD,UAAAC,WAFd,gBAEDyyD,EAAe,kCCKtB5yD,MAAA,aAAoCA,MAAA,GAAaA,+BAAbA,cAAA,GAAAqnB,EAAAqvC,OAAA,mCAiBtC12D,MAAA,eAMEA,MAAA,wBACFA,+BAHEA,MAAA,YAAAqnB,EAAA0X,KAAA4F,OAEA3kC,cAAA,IAAAA,MAAA,qFAEFA,MAAA,eAIEA,MAAA,mBAAAA,MAAAqgC,GAAA,MAAAhZ,EAAArnB,QAAA,OAAAA,MAASqnB,EAAA+rC,oBAAA/rC,EAAA0X,KAAAz5B,OAA+B,GAExCtF,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,yFAMJA,MADF,WACEA,CADuD,oBAErDA,MAAA,wCASAA,MAAA,oCAMEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAyrD,EAAA32D,MAAA,GAAAqnB,GAAArnB,QAAA,OAAAA,MAASqnB,GAAAgjC,oBAAAsM,GAA6B,GAEtC32D,MAAA,cAAUA,MAAA,kBAEdA,YACAA,MAAA,SACFA,iCAfMA,MAAA,GACAA,MADA,cAAAA,MAAA,4CACAA,CADkE,QAAAqnB,EAAAlmB,KAOlEnB,MAAA,GAAAA,MAAA,aAAAA,MAAA,mCC5BC,IAAM42D,GAAoB,MAA3B,MAAOA,GAUDr2D,gBACAC,eACAyqD,KACA4L,gBACAziC,YAbH2K,KAEE1f,IAEFle,IACAu1D,OACAI,gBAEPn4D,YACU4B,EACAC,EACAyqD,EACA4L,GACAziC,IAJAx1B,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAAqsD,OACArsD,KAAAi4D,mBACAj4D,KAAAw1B,cACP,CAEHjoB,WACEvN,KAAKqsD,KAAKvqD,cAAce,UAAWwpD,IACjC,MAAM3pD,EAAc1C,KAAKqsD,KAAK3pD,cAC9B1C,KAAK83D,OAASp1D,GAAaF,MAAM0P,GAAGimD,WACpCn4D,KAAK0pD,WAAS,EAElB,CAEA0O,UAAUz8C,EAAc,IACtB,MAAMpN,EAAS/H,OAAO6H,OAAO,GAAIsN,GACjCpN,EAAO0uC,IAAMj9C,KAAK83D,OAAS,GAAG93D,KAAK83D,UAAUn8C,EAAOshC,MAAQthC,EAAOshC,IACnEj9C,KAAKuC,IAAMvC,KAAKi4D,gBAAgB9D,cAAc5lD,GAC9CvO,KAAKi4D,gBAAgB1D,oBAAoBv0D,KAAKygB,IAAKlS,GAAQ1L,UACxDw1D,IACCr4D,KAAKk4D,gBAAkBG,EAAInmD,GAC3BlS,KAAK4B,eAAe6oD,QAClB,4CACA,mDACAzoD,EACA,CAAE0E,MAAO6H,EAAO3C,OAAO,EAG1BzH,IACCA,EAAIC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,mCAEF7sC,KAAK4B,eAAe02D,UAAUn0D,EAAG,EAGvC,CAEAqwD,oBAAoB74C,EAAc,IAChC,MAAMpN,EAAS/H,OAAO6H,OAAO,GAAIsN,GACjCpN,EAAO0uC,IAAMj9C,KAAK83D,OAAS,GAAG93D,KAAK83D,UAAUn8C,EAAOshC,MAAQthC,EAAOshC,IACnEj9C,KAAKi4D,gBACFzD,oBAAoBx0D,KAAKygB,IAAKlS,EAAQvO,KAAKk4D,iBAC3Cr1D,UACEw1D,IACCr4D,KAAK4B,eAAe6oD,QAClB,4CACA,mDACAzoD,EACA,CAAE0E,MAAO6H,EAAO3C,OAAO,EAG1BzH,IACCA,EAAIC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,mCAEF7sC,KAAK4B,eAAe02D,UAAUn0D,EAAG,EAGzC,CAEAsnD,oBAAoB8M,GACC7M,MAAUC,KAAK4M,IAEhCv4D,KAAK4B,eAAe6oD,QAClB,sCACA,wCAGN,CAEAf,YACE1pD,KAAKuC,SAAMP,EACX,MAAMkQ,KAAKyQ,SACX,IAAI/W,EAAQ,WACZA,GAAS5L,KAAK83D,OAAS,IAAI93D,KAAK83D,UAAU5lD,KAAQ,IAAIA,KACtDlS,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCr1B,MAAO,CAACA,GACRqxC,IAAK,CAAC/qC,IAEV,4CA1FW8lD,IAAoB52D,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,IAAA1E,MAAA2E,MAAA,+BAApBiyD,GAAoB1pD,UAAA,wBAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,+3BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDxCjC1N,MAAA,YAA0CA,MAAA,6BAAY2N,EAAAqpD,UAAArpD,EAAAoxB,KAAAz5B,MAAqB,GAEvEtF,MADF,UACEA,CAD+B,oBAE7BA,MAAA,kCAMAA,MAAA,eACEA,MAAA,wBAGNA,YAGEA,MADF,UACEA,CAD6C,oBAE3CA,MAAA,GAAAo3D,GAAA,cACAp3D,MAAA,aACEA,MAAA,oCAOFA,QACAA,MAAA,gBACEA,MAAA,0BAGNA,YAEAA,MAAA,YASEA,MARA,GAAAq3D,GAAA,eAQAr3D,CAHC,GAAAs3D,GAAA,iBAYLt3D,UAEAA,MAAA,GAAAu3D,GAAA,sBArDuBv3D,MAAA,YAAA2N,EAAAoxB,MAMf/+B,MAAA,GAAAA,MAAA,cAAAA,MAAA,+CAIAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2DAOKA,MAAA,GAAAA,MAAA,OAAA2N,EAAA+oD,QAKH12D,MAAA,GACAA,MADA,YAAA2N,EAAA+oD,OACA12D,CADoB,cAAAA,MAAA,8CAMtBA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0DAODA,MAAA,GAAAA,MAAA,QAAA2N,EAAAxM,KAQAnB,cAAA,OAAA2N,EAAAxM,KAUDnB,cAAA,OAAA2N,EAAAxM,qBCxBFk6B,KAAW12B,yBACXw3B,KAAmBx3B,UACnBkkB,KAAkBjkB,UAClB62B,KAAcloB,KACdxF,KACAI,KAAesF,UACfxF,MAAgByF,MAChBtF,MAAastB,MACbntB,KAAiBqtB,OAAAntB,OAAA,i0BAGRmoD,EAAoB,2DChBzB52D,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,qEAGAA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,oEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,mEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,iEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,wEAEFA,MAAA,QAGEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,6EAIJA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,qEAGAA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,kEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,oEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,sEAEFA,MAAA,QACEA,MAAA,wBACFA,gBADEA,cAAA,IAAAA,MAAA,uEAxCNA,MAAA,SAGEA,MAAA,EAAAw3D,GAAA,iCAGAx3D,MAAA,QACEA,MAAA,EAAAy3D,GAAA,iCAGAz3D,MAAA,EAAA03D,GAAA,iCAGA13D,MAAA,EAAA23D,GAAA,iCAGA33D,MAAA,GAAA43D,GAAA,kCAGA53D,MAAA,GAAA63D,GAAA,kCAKF73D,QAEAA,MAAA,GAAA83D,GAAA,kCAGA93D,MAAA,SACEA,MAAA,GAAA+3D,GAAA,kCAGA/3D,MAAA,GAAAg4D,GAAA,kCAGAh4D,MAAA,GAAAi4D,GAAA,kCAGAj4D,MAAA,GAAAk4D,GAAA,kCAIJl4D,kBAxCOA,cAAA,YAAAA,MAAA,uCAIEA,MAAA,GAAAA,MAAA,YAAAA,MAAA,sCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,qCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,mCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,2CAIFA,MAAA,GAAAA,MAAA,YAAAA,MAAA,gDAMAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,wCAIEA,MAAA,GAAAA,MAAA,YAAAA,MAAA,qCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,uCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,yCAGAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,qEAKTA,MAAA,mDAIEA,MAAA,OAAAA,MAAA,gDC9BD,IAAMm4D,GAAoB,MAA3B,MAAOA,GAWD33D,eACAq2D,gBACAlmD,MAZFynD,WAEC/4C,IAEFle,IACAmyD,kBAAoB,CACzBI,kBAAmB,CAAEC,YAAa,KAGpCh1D,YACU6B,EACAq2D,EACAlmD,GAFA/R,KAAA4B,iBACA5B,KAAAi4D,kBACAj4D,KAAA+R,OACP,CAEHxE,WACEvN,KAAKy5D,WACLz5D,KAAKw5D,cAAav2C,MAAc,CAC9BjjB,KAAKygB,IAAIyhC,eAAewX,OACxB15D,KAAKygB,IAAIk5C,UACR92D,UAAWm3B,IACZh6B,KAAKy5D,WACLz5D,KAAK+R,MAAM4K,eAAa,EAE5B,CAEA+2B,kBACE1zC,KAAKy5D,UACP,CAEAvrD,cACElO,KAAKw5D,WAAWrrD,aAClB,CAEAsrD,SAAS99C,EAAc,IACrB3b,KAAKuC,IAAMvC,KAAKi4D,gBAAgBxD,iBAC9Bz0D,KAAKygB,IACLzgB,KAAK00D,kBAET,CAEAjJ,oBAAoB8M,GACC7M,MAAUC,KAAK4M,IAEhCv4D,KAAK4B,eAAe6oD,QAClB,sCACA,wCAGN,4CAlDW8O,IAAoBn4D,MAAAuE,MAAAvE,MAAAwE,IAAAxE,aAAA,+BAApBm4D,GAAoBjrD,UAAA,wBAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,qSAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,kBDtC/B1N,MADF,UACEA,CAD2C,oBAEzCA,MAAA,uCAQFA,QAGEA,MADF,UACEA,CADiC,cACPA,MAAA,mBAAAA,MAAAyK,IAAA,MAAA+tD,GAAAx4D,MAAA,UAAAA,MAAS2N,EAAA08C,oBAAAmO,IAA6B,GAC9Dx4D,MAAA,cAAUA,MAAA,kBAAYA,QACtBA,MAAA,yBAEJA,UACAA,MAAA,UACEA,MAAA,SACAA,MAAA,gBACEA,MAAA,GAAAy4D,GAAA,qCA4CAz4D,MAAA,GAAA04D,GAAA,+CASN14D,kBAnEMA,MAAA,GACAA,MADA,cAAAA,MAAA,4CACAA,CADkE,QAAA2N,EAAAxM,KAQlEnB,MAAA,GAAAA,MAAA,IAAAA,MAAA,uCAOGA,MAAA,GAAAA,MAAA,YAAAA,MAAA,iDA6CAA,MAAA,GAAAA,MAAA,YAAAA,MAAA,kECrCL6oB,KAAkBpkB,KAClBg3B,KAAc/2B,KACdyJ,KAAexJ,KACfyJ,MAAaxJ,MACbmJ,KACAqK,MACA7J,KAAiBgF,OAAA9E,OAAA,4qBAGR0pD,EAAoB,kDCtC/Bn4D,MADF,kBACEA,CAD4B,oCAE1BA,MAAA,yBACFA,QACAA,MAAA,oCACEA,MAAA,yBAEJA,iCANWA,cAAA,QAAAA,MAAA,0CACYA,MAAA,GAAAA,MAAA,MAAAqnB,EAAAhI,KAEZrf,cAAA,QAAAA,MAAA,0CACYA,MAAA,GAAAA,MAAA,MAAAqnB,EAAAhI,kCAIvBrf,MAAA,+CAAmCA,MAAA,MAAAqnB,EAAAhI,MCe5B,IAAMs5C,GAAiB,MAAxB,MAAOA,GAKS95D,OAJXwgB,IAEFu5C,QAAS,EAEhBj6D,YAAoBE,GAAAD,KAAAC,SAClBD,KAAKg6D,SAASh6D,KAAKC,OAAOG,UAAU,cACtC,4CAPW25D,IAAiB34D,MAAAuE,MAAA,+BAAjBo0D,GAAiBzrD,UAAA,oBAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,sDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDf9B1N,MATA,EAAA64D,GAAA,sBASA74D,CAT8B,EAAA84D,GAAA,iCAAd94D,MAAA,OAAA2N,EAAAirD,QASI54D,cAAA,QAAA2N,EAAAirD,wBCQhB7qD,KACAgrD,MAAav0D,YACboyD,GACAuB,GACA5pD,KAAiB9J,gBAGRk0D,EAAiB,+DCOvB,IAAMK,GAAqB,MAA5B,MAAOA,GAaDh+C,UACAgtC,eACAiR,aACA7xB,cACA8xB,iBACAC,aACYle,MAlBdme,UACA5Z,YAEA4U,cAAyB,GAExBiF,6BAAuC,EAEhD,OAAIh6C,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA1gB,YACUqc,EACAgtC,EACAiR,EACA7xB,GACA8xB,GACAC,GACYle,IANZr8C,KAAAoc,YACApc,KAAAopD,iBACAppD,KAAAq6D,eACAr6D,KAAAwoC,iBACAxoC,KAAAs6D,oBACAt6D,KAAAu6D,gBACYv6D,KAAAq8C,QACnB,CAEH9uC,WACEvN,KAAKw6D,UAAYx6D,KAAKopD,eAAe9M,SAClCv4C,QAAK2F,MAAQo0C,QAAwB97C,IAAZ87C,IACzBj7C,UAAWi7C,GAAY99C,KAAK06D,oBAAoB5c,IAGjD99C,KAAKq8C,OACLr8C,KAAKq8C,MAAMx8C,QAAQ80D,oBACnB30D,KAAKq8C,MAAMx8C,QAAQ+0D,qBACnB50D,KAAKq8C,MAAMx8C,QAAQ8gD,YAEnB3gD,KAAKq8C,MAAMuE,YACR78C,QAAKs5C,KAAOt2C,IAAYwV,MAAYo0C,QAAQ5pD,KAC5ClE,UAAWkE,IACV/G,KAAK4gD,YAAc75C,GAG3B,CAEAmH,cACElO,KAAKw6D,UAAUrsD,aACjB,CAEQusD,oBAAoB5c,GAC1B,QAAuB97C,IAAnB87C,EAAQgC,OACV,QAEuC,IAArC9/C,KAAKy6D,4BACPz6D,KAAKygB,IAAIk6C,kBAET36D,KAAKygB,IAAIm6C,aAAa56D,KAAKw1D,eAE7Bx1D,KAAKw1D,cAAgB,GAErB,MAAMqF,KAAkBC,SACnBhd,EAAQgC,OAAOr/B,IAAI,CAACiiC,EAA4BzjC,KAC1Cjf,KAAKq6D,aAAaU,iBAAiBrY,EAAc5E,EAAQb,OAIpE4d,EACG92D,QAAKi3D,MAAOH,EAAgB92D,QAAKof,KAAa,QAC9CtgB,UAAWi9C,IACV9/C,KAAKi7D,gBAAgBnb,GAEjBhC,EAAQoF,eACVpF,EAAQoF,cAAc3oC,QAAS2sC,KAE3BlnD,KAAKwoC,cAAcpoC,UAAU,iBACL86D,gB1BkFhC,SAAUC,GACdjY,GACAziC,GACA65C,EACAC,GAEA,IAAIpkD,EACAilD,GAkDA33C,GAhDJ,GAAI62C,EAAiBe,aAAanY,GAAcl0B,KAAO,qBAAsB,CAC3E,MAAMy0B,GAAqC6W,EAAiBe,aAC1DnY,GAAcl0B,KAAO,qBAGvB7Y,EAAQA,CAACrL,GAASwwD,KACTf,EAAagB,uBAClBzwD,GACA24C,GACA6X,GAGN,SACEhB,EAAiBe,aAAanY,GAAcl0B,KAAO,iBACnD,CACA,MAAMwsC,GAA6BlB,EAAiBe,aAClDnY,GAAcl0B,KAAO,iBAEvBosC,GAAWd,EAAiBe,aAAanY,GAAcl0B,KAAO,aAE9D7Y,EAAQA,CAACrL,GAASwwD,MAChB,MAAMG,GAAYlB,EAAamB,YAC7BpB,EAAiBe,aAAanY,GAAcl0B,KAAO,iBACnDlkB,GACAwwD,IAEF,OAAOf,EAAaoB,mBAClB7wD,GACAwwD,GACAE,GACAC,GAAS,CAGf,MACEtlD,EADSmkD,EAAiBe,aAAanY,GAAcl0B,KAAO,UACpD7Y,CAACrL,GAASwwD,KAChBf,EAAamB,YACXpB,EAAiBe,aAAanY,GAAcl0B,KAAO,UACnDlkB,GACAwwD,IAGInlD,CAACrL,GAASwwD,KAChBf,EAAamB,YACXpB,EAAiBe,aAAa,iBAC9BvwD,GACAwwD,IAIN,MAAMrX,GAAagD,GAAiC/D,IAChDoX,EAAiBe,aAAanY,GAAcl0B,KAAO,kBAOrDvL,GAAS,IAAIm4C,MALX,CACER,YACA53D,KAAM,UACNu/C,WAAW,IAGft/B,GAAO49B,GAAG59B,OAAOo4C,YAAY5X,MAO7BxgC,GAAS,IAAIq4C,MAJX,CACEt4D,KAAM,SACNu/C,WAAW,IAGft/B,GAAO49B,GAAGwa,YAAY5X,KAGxB,MAAMxB,GAAQ,IAAIsZ,MAAY,CAC5BnwD,MAAOs3C,GAAcl0B,KACrBmmC,oBAAoB,EACpB1xC,UACAtN,QACAysC,QAASM,GAAcN,QACvB/rB,QAASqsB,GAAcrsB,UAEzBpW,GAAIu7C,SAASvZ,GAGf,C0BxKc0Y,CACEjU,GACAlnD,KAAKygB,IACLzgB,KAAKs6D,iBACLt6D,KAAKu6D,c1BuCf,SAAU0B,GACd/Y,GACAziC,IAEA,MAKMwjC,EAAagD,GAAiC/D,IAC9Cz/B,EAAS,IAAIq4C,MAN0D,CAC3Et4D,KAAM,SACNu/C,WAAW,IAKbt/B,EAAO49B,GAAGwa,YAAY5X,GAEtB,IAAIiY,GACAC,IAAoB,EACxB,MAAMC,GAAcnY,EAAW,IAAIoY,WAAa,GAC5CD,GAAYpkC,SAAS,WAAaokC,GAAYpkC,SAAS,aACzDkkC,MAAcI,UAEdJ,MAAcK,SACdJ,IAAW,GAEb,MAAM1Z,GAAQ,IAAIsZ,MAAY,CAC5BnwD,MAAOs3C,GAAcl0B,KACrBmmC,oBAAoB,EACpB1xC,SACA+/B,SAAU,CAAE2Y,aACZhmD,MAAO+lD,GACPrlC,QAASqsB,GAAcrsB,QACvB+rB,QAASM,GAAcN,UAEzBniC,GAAIu7C,SAASvZ,GAGf,C0B/EcwZ,CAAyB/U,GAAmBlnD,KAAKygB,IAAG,EASvD,GAIPzgB,KAAKq6D,aACFmC,qBAAqB1e,EAAQb,KAC7Bl5C,QAAKof,KAAa,MAClBtgB,UAAWi9C,GAAoB9/C,KAAKi7D,gBAAgBnb,GACzD,CAEQmb,gBAAgBnb,GACtBA,EAASA,EACNp2C,OAAQ+4C,QAA2BzgD,IAAVygD,GACzBhiC,IAAKgiC,IACJA,EAAM5rB,QAAU72B,KAAKy8D,8BAA8Bha,GACnDA,EAAMD,OAASC,EAAMD,OAEdC,IAEXziD,KAAKw1D,cAAc70C,OAAOm/B,GAC1B9/C,KAAKygB,IAAIi8C,UAAU5c,EACrB,CAEQ2c,8BAA8Bha,GACpC,MAAM17C,EAAS/G,KAAK4gD,YAEd+b,GAAyBla,EAAMvwC,GAErC,IAAI2kB,GAAU4rB,EAAM5rB,QACpB,IAAK9vB,IAAW41D,GACd,OAAO9lC,GAGT,MAAM+lC,GAAgB71D,EAAO/G,KAAKq8C,MAAMx8C,QAAQ8gD,YAChD,GAAIic,KATmB58D,KAAKopD,eAAe9M,SAAS51C,MAAMu2C,MASjB2f,GAAe,CACtD,IAAIC,GAAwB,GACxBC,GAAyB,GACzBC,GAA0B,GAC1BC,GAA4B,GAG9Bh9D,KAAKq8C,MAAMx8C,QAAQ80D,oBACnB5tD,EAAO/G,KAAKq8C,MAAMx8C,QAAQ80D,sBAE1BkI,GACE91D,EAAO/G,KAAKq8C,MAAMx8C,QAAQ80D,qBAG5B30D,KAAKq8C,MAAMx8C,QAAQ+0D,qBACnB7tD,EAAO/G,KAAKq8C,MAAMx8C,QAAQ+0D,uBAE1BkI,GACE/1D,EAAO/G,KAAKq8C,MAAMx8C,QAAQ+0D,sBAKA,MAA1BiI,KACFhmC,IAAU,GAEmB,MAA3BimC,KACFjmC,IAAU,GAIZkmC,GAAgBF,GAAsBvzD,MAAM,KAC5C0zD,GAAkBF,GAAuBxzD,MAAM,MAE7CyzD,GAAcr0D,QAAQi0D,KAAkB,GACxCI,GAAcr0D,QAAQi0D,GAAexE,aAAc,KAEnDthC,IAAU,IAGVmmC,GAAgBt0D,QAAQi0D,KAAkB,GAC1CK,GAAgBt0D,QAAQi0D,GAAexE,aAAc,KAErDthC,IAAU,EAEd,CAEA,OAAOA,EACT,4CAnKWujC,IAAqBh5D,MAAAuE,OAAAvE,MAAAwE,GAAAxE,MAAAuE,OAAAvE,MAAAyE,MAAAzE,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAA0E,KAAA,kCAArBs0D,GAAqB9rD,UAAA,4BAAAC,OAAA,CAAAksD,4BAAA,+BAAAhsD,YAAA,EAAAlE,SAAA,CAAAnJ,MAFrB,CAAC67D,iBAED7C,EAAqB,qBCV3B,IAAM8C,GAAmB,MAA1B,MAAOA,GAUD9T,eACAp3C,aAVFoK,UACAo+C,UAER,OAAI/5C,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA1gB,YACEqc,EACQgtC,EACAp3C,GADAhS,KAAAopD,iBACAppD,KAAAgS,eAERhS,KAAKoc,UAAYA,CACnB,CAEA7O,WACEvN,KAAKw6D,UAAYx6D,KAAKopD,eAAe9M,SAClCv4C,QAAK2F,MAAQo0C,QAAwB97C,IAAZ87C,IACzBj7C,UAAWi7C,GAAY99C,KAAK06D,oBAAoB5c,GACrD,CAEA5vC,cACElO,KAAKw6D,UAAUrsD,aACjB,CAEQusD,oBAAoB5c,GAC1B,QAAoB97C,IAAhB87C,EAAQr9B,IACV,OAiBF,MAAM08C,EAA8Brf,EAAQr9B,IAAItQ,OAE7CnQ,KAAKoc,UAAUjM,OACgB,IAAhCgtD,EAAYnc,iBACZlD,EAAQr9B,IAAItQ,KAAK6xC,aAAehiD,KAAKygB,IAAIuhC,cAEzChiD,KAAKoc,UAAUjM,KAAOgtD,GAEpBn9D,KAAKoc,UAAUqE,IAAI28C,uBACrBp9D,KAAKoc,UAAUqE,IAAI28C,sBAAsBC,yBACvCF,GAIJ,MAAMG,EAAsCxf,EAAQr9B,IAAI6W,SACxD,IAAKt3B,KAAKoc,UAAUkb,UAAYgmC,EAAiB,CAC/C,GAAIt9D,KAAKgS,aAAasZ,YACqB,kBAA9BgyC,EAAgBC,UAAyB,CAClD,MAAMC,GACJF,EAAgBC,UACbC,GAAgBC,WACnBD,GAAgBC,SAAWvxC,KAAKE,IAAI,GAAIoxC,GAAgBC,UACxDH,EAAgBC,UAAYC,GAEhC,CAEFx9D,KAAKoc,UAAUkb,SAAWgmC,CAC5B,CACF,4CAzEWJ,IAAmB97D,MAAAuE,OAAAvE,MAAAwE,GAAAxE,MAAAyE,OAAA,+BAAnBq3D,GAAmB5uD,UAAA,0BAAAG,YAAA,WAAnByuD,EAAmB,KCYnBQ,GAA2B,MAAlC,MAAOA,GAkLDtU,eACAuU,WACAh8D,gBACAi8D,qBACAh8D,eACAyqD,KACAlQ,eACApqC,MAxLFqK,UACAyhD,WACAC,kBACAC,mBACAC,kBAGRC,SAASngB,GACP99C,KAAKopD,eAAe1I,YAAY5C,EAAQb,IAC1C,CAGAihB,OAAOpgB,GACL99C,KAAKopD,eAAenI,kBAAkBnD,EAAQb,IAChD,CAGAkhB,OAAOrgB,GACL,MAAMr9B,EAAMzgB,KAAK29D,WAAWS,SACtBC,EAAiBr+D,KAAKopD,eAAejI,kBAAkB1gC,GAEvD69C,GAAaA,KACjBt+D,KAAK4B,eAAe6oD,QAClB,4CACA,mDACAzoD,EACA,CACE0E,MAAOo3C,EAAQlyC,OAChB,EAIL,GAAIkyC,EAAQO,SAOV,OANAggB,EAAezyD,MAAQkyC,EAAQlyC,MAC/B5L,KAAKopD,eAAepgD,OAAO80C,EAAQ5rC,IAAI,QACvClS,KAAKopD,eAAertC,OAAOsiD,GAAgBx7D,UAAW07C,KACpDv+C,KAAKopD,eAAe1I,YAAYnC,GAAetB,KAC/CqhB,IAAU,GAYdt+D,KAAKopD,eAAezpC,OAAOm+B,EAAQ5rC,GAPd,CACnB4tC,OAAQue,EAAeve,OACvBr/B,IAAK,CACHtQ,KAAMkuD,EAAe59C,IAAItQ,QAImBtN,UAAU,KACxDy7D,IAAU,EAEd,CAGAC,WAAWzgB,GACJA,EAAQ5rC,KACX4rC,EAAQ5rC,GAAK4rC,EAAQb,KAEvBj9C,KAAKopD,eAAenL,WAAWH,EAAQ5rC,IAAIrP,UAAU,KAC/C7C,KAAKg+D,mBACPh+D,KAAK4B,eAAenB,OAAOT,KAAKg+D,mBAElCh+D,KAAKopD,eAAe3M,kBAAkB95C,KAAKm7C,EAAQ5rC,IACnD,MAAMssD,EAAax+D,KAAK4B,eAAe6oD,QACrC,gDACA,uDACAzoD,EACA,CACE0E,MAAOo3C,EAAQlyC,QAGnB5L,KAAKg+D,kBAAoBQ,EAAWC,QACpCz+D,KAAK+R,MAAM4K,eAAa,EAE5B,CAGA+hD,cAAc5gB,GACZ99C,KAAKopD,eAAenI,kBAAkBnD,EAAQb,IAChD,CAGA0hB,oBAAoB7gB,GAClB99C,KAAKopD,eAAenI,kBAAkBnD,EAAQb,IAChD,CAGA2hB,SAAS9gB,GAEP99C,KAAK49D,qBACFrlD,KAFevY,KAAK2B,gBAAgB4pB,UAGzBshB,QAAQ,oDAEnBhqC,UAAWg8D,IACNA,GACF7+D,KAAKopD,eACFpgD,OAAO80C,EAAQ5rC,GAAI4rC,EAAQO,UAC3Bx7C,UAAU,KACT7C,KAAK4B,eAAek9D,KAClB,8CACA,qDACA98D,EACA,CAAE0E,MAAOo3C,EAAQlyC,OAAO,EAE3B,EAGX,CAGAmzD,QAAQjhB,GAKN99C,KAAKopD,eAAephD,MAAM81C,EAAQ5rC,GAJf,CACjBtG,MAAOkyC,EAAQlyC,MAAQ,QACvBqxC,IAAKa,EAAQb,IAAM,UAE6Bp6C,UAAU,KAC1D7C,KAAK4B,eAAe6oD,QAClB,6CACA,oDACAzoD,EACA,CAAE0E,MAAOo3C,EAAQlyC,OAAO,EAG9B,CAGAozD,SAASnc,GACP,MAAQj3C,QAAOwE,SAAUyyC,EACnB/E,GAAU99C,KAAKopD,eAAejI,kBAClCnhD,KAAKoc,UAAUqE,IACfrQ,GAEF0tC,GAAQlyC,MAAQA,EAChB5L,KAAKopD,eAAertC,OAAO+hC,IAASj7C,UAAU,KAC5C7C,KAAK4B,eAAe6oD,QAClB,8CACA,qDACAzoD,EACA,CAAE0E,MAAOo3C,GAAQlyC,QAEnB5L,KAAKopD,eAAe1I,YAAY5C,GAAQb,IAAG,EAE/C,CAGAM,eACE,MAAMC,EAAc,CAAC,QACrB,UAAW7zC,KAAK3J,KAAKoc,UAAUohC,cACX,IAAd7zC,EAAEkkB,UAAwC,IAApBlkB,EAAE6kD,gBAC1BhR,EAAYl2C,KAAKqC,EAAEqlB,MAInBhvB,KAAKopD,eAAe7L,aAAaC,IADrCx9C,KAAKoc,UAAUi0C,WAGjB,CAGAJ,qBACEjwD,KAAKoc,UAAUi0C,YAAcrwD,KAAKoc,UAAUi0C,WAC5CrwD,KAAKm8C,eAAe97C,IAAI,sBAAuBL,KAAKoc,UAAUi0C,YAC9DrwD,KAAKu9C,cACP,CAGA0hB,cAAcnhB,GACZ99C,KAAKopD,eAAehL,YAAYN,EAAQ5rC,IAAIrP,WAC9C,CAGAq8D,cAAcphB,GACZ99C,KAAKopD,eAAejL,YAAYL,EAAQ5rC,IAAIrP,WAC9C,CAEA9C,YACUqc,EACAgtC,EACAuU,EACAh8D,GACAi8D,GACAh8D,GACAyqD,GACAlQ,GACApqC,IAPA/R,KAAAopD,iBACAppD,KAAA29D,aACA39D,KAAA2B,mBACA3B,KAAA49D,wBACA59D,KAAA4B,kBACA5B,KAAAqsD,QACArsD,KAAAm8C,kBACAn8C,KAAA+R,SAER/R,KAAKoc,UAAYA,CACnB,CAEA7O,WAEEvN,KAAKoc,UAAUkiC,SAAW,CAAE9B,KAAM,IAClCx8C,KAAKoc,UAAUi0C,WAAarwD,KAAKm8C,eAAej8C,IAC9C,uBAGFF,KAAK69D,WAAa79D,KAAKopD,eAAe7M,UAAU15C,UAAWy7C,GACzDt+C,KAAKs9C,qBAAqBgB,IAG5Bt+C,KAAK+9D,mBAAqB/9D,KAAKopD,eAAe3M,kBAAkB55C,UAC7DqP,IACClS,KAAKoc,UAAU8hC,iBAAmBhsC,IAGtC,MAAMitD,EAAmBn/D,KAAKm8C,eAAej8C,IAC3C,wBAEEi/D,IAAqBn/D,KAAKqsD,KAAKzpD,eACjC5C,KAAKopD,eAAe3M,kBAAkB95C,KAAKw8D,GAI7Cn/D,KAAK89D,kBAAoB99D,KAAKopD,eAAe9M,SAC1Cv4C,QAAKof,KAAa,MAClBtgB,UAAWi7C,GAAa99C,KAAKoc,UAAU6yC,gBAAkBnR,GAE5D99C,KAAKqsD,KAAKvqD,cAAce,UAAWu8D,IAC7BA,GACFp/D,KAAKopD,eAAepL,kBAAkBn7C,UAAW2vD,IAC/CxyD,KAAKoc,UAAUg0C,MAAQoC,EACvBxyD,KAAKoc,UAAUohC,YAAc,GAC7B,MAAM6hB,GAAar/D,KAAKoc,UAAUg0C,MAAMlwC,OAAO,CAACC,GAAKm/C,MACnDn/C,GAAMA,GAAIQ,OAAO2+C,IACXA,GAAI1Q,OAASzuC,GAAIQ,OAAO2+C,GAAI1Q,QAAUzuC,IAE3C,IAEH,UAAW3d,MAAQ68D,GAAY,CAC7B,MAAM7gB,GAAoC,CACxCxvB,KAAMxsB,GAAKwsB,KACXnB,QAAS7tB,KAAKm8C,eAAej8C,IAC3B,wBAA0BsC,GAAKwsB,OAGR,OAAvBwvB,GAAW3wB,UACb2wB,GAAW3wB,SAAU,GAEvB7tB,KAAKoc,UAAUohC,YAAYl2C,KAAKk3C,GAClC,CAEA,MAAMhB,GAAc,CAAC,QACrB,UAAW7zC,MAAK3J,KAAKoc,UAAUohC,cACX,IAAd7zC,GAAEkkB,UAAwC,IAApBlkB,GAAE6kD,gBAC1BhR,GAAYl2C,KAAKqC,GAAEqlB,MAKnBhvB,KAAKopD,eAAe7L,aAAaC,KADrCx9C,KAAKoc,UAAUi0C,WAEwC,EACxD,EAGP,CAEAniD,cACElO,KAAK69D,WAAW1vD,cAChBnO,KAAK89D,kBAAkB3vD,cACvBnO,KAAK+9D,mBAAmB5vD,aAC1B,CAEQmvC,qBAAqBgB,GAC3Bt+C,KAAKoc,UAAUkiC,SAAWA,CAC5B,4CAzQWof,IAA2Bt8D,MAAAuE,GAAA,GAAAvE,MAAAwE,GAAAxE,MAAAyE,OAAAzE,MAAA0E,MAAA1E,MAAA2E,OAAA3E,MAAA4E,MAAA5E,MAAAuT,MAAAvT,MAAAyT,MAAAzT,aAAA,+BAA3Bs8D,GAA2BpvD,UAAA,kCAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAA3B1N,MAAA,kBAAAqW,IAAA,OAAA1I,EAAAkvD,SAAAxmD,GAAgB,EAAhBrW,CAA2B,gBAAAqW,IAAA,OAA3B1I,EAAAmvD,OAAAzmD,GAAc,EAAdrW,CAA2B,gBAAAqW,IAAA,OAA3B1I,EAAAovD,OAAA1mD,GAAc,EAAdrW,CAA2B,oBAAAqW,IAAA,OAA3B1I,EAAAwvD,WAAA9mD,GAAkB,EAAlBrW,CAA2B,uBAAAqW,IAAA,OAA3B1I,EAAA2vD,cAAAjnD,GAAqB,EAArBrW,CAA2B,6BAAAqW,IAAA,OAA3B1I,EAAA4vD,oBAAAlnD,GAA2B,EAA3BrW,CAA2B,kBAAAqW,IAAA,OAA3B1I,EAAA6vD,SAAAnnD,GAAgB,EAAhBrW,CAA2B,iBAAAqW,IAAA,OAA3B1I,EAAAgwD,QAAAtnD,GAAe,EAAfrW,CAA2B,kBAAAqW,IAAA,OAA3B1I,EAAAiwD,SAAAvnD,GAAgB,EAAhBrW,CAA2B,6CAA3B2N,EAAAwuC,cAAc,EAAdn8C,CAA2B,uCAA3B2N,EAAAkhD,oBAAoB,EAApB7uD,CAA2B,gBAAAqW,IAAA,OAA3B1I,EAAAkwD,cAAAxnD,GAAqB,EAArBrW,CAA2B,gBAAAqW,IAAA,OAA3B1I,EAAAmwD,cAAAznD,GAAqB,kCAFrB,CAACY,kBAEDqlD,EAA2B,KCX3B6B,GAA2B,MAAlC,MAAOA,GAyBDnW,eACAxnD,eAzBFwa,UACAojD,gBAEEC,gBAAyC,IAAInyD,MAGvD4wD,OAAOpgB,GAEL99C,KAAKopD,eAAezpC,OADT3f,KAAKoc,UAAU0hC,QAAQ5rC,GACH4rC,GAASj7C,UAAU,KAChD7C,KAAK4B,eAAe6oD,QAClB,4CACA,mDACAzoD,EACA,CACE0E,MAAOo3C,EAAQlyC,OAAS5L,KAAKoc,UAAU0hC,QAAQlyC,QAGnD5L,KAAKopD,eAAelI,sBAAiBl/C,GACrChC,KAAKy/D,gBAAgBrxD,KAAK0vC,EAAO,EAErC,CAEA/9C,YACUqc,EACAgtC,EACAxnD,GADA5B,KAAAopD,iBACAppD,KAAA4B,iBAER5B,KAAKoc,UAAYA,CACnB,CAEA7O,WACEvN,KAAKw/D,gBAAkBx/D,KAAKopD,eAAe1M,eAAe75C,UACvDi7C,GAAY99C,KAAK0/D,0BAA0B5hB,GAEhD,CAEA5vC,cACElO,KAAKw/D,gBAAgBrxD,aACvB,CAEQuxD,0BAA0B5hB,GAChC99C,KAAKoc,UAAU0hC,QAAUA,CAC3B,4CA3CWyhB,IAA2Bn+D,MAAAuE,GAAA,GAAAvE,MAAAwE,GAAAxE,MAAAyE,MAAA,+BAA3B05D,GAA2BjxD,UAAA,kCAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAA3B1N,MAAA,sBAAAqW,IAAA,OAAA1I,EAAAmvD,OAAAzmD,GAAc,uEAAd8nD,EAA2B,KCI3BI,GAAkC,MAAzC,MAAOA,GA0EDvW,eACAznD,gBACAC,eACAmqD,GA5EF3vC,UACAojD,gBAGRI,gBAAgBphB,GACTA,EAAWS,OAQhBj/C,KAAKopD,eACFpK,yBAFeh/C,KAAKoc,UAAU0hC,QAAQ5rC,GAIrCssC,EAAWS,OACXT,EAAWU,gBAEZr8C,UAAW2vD,IACV,UAAW7oD,MAAK6oD,EACdxyD,KAAKoc,UAAUohC,YAAYgB,EAAWU,gBAAgB53C,KAAKqC,IAG7D3J,KAAK4B,eAAe6oD,QAClB,uCACA,8CACAzoD,EACA,CAAE0E,MALW83C,EAAWS,SAO1Bj/C,KAAK+rD,GAAGpvC,eAAa,GAxBvB3c,KAAK4B,eAAewC,MAClB,uDACA,uDAwBN,CAGAy7D,mBAAmBrhB,GAEjBx+C,KAAKopD,eACFjK,4BAFen/C,KAAKoc,UAAU0hC,QAAQ5rC,GAECssC,EAAWtsC,IAClDrP,UAAU,KACT,MAAMoc,EAAQjf,KAAKoc,UAAUohC,YAC3BgB,EAAWU,gBACXlK,UAAWrrC,IACJA,GAAEuI,KAAOssC,EAAWtsC,IAE7BlS,KAAKoc,UAAUohC,YAAYgB,EAAWU,gBAAgBr5B,OAAO5G,EAAO,GAGpEjf,KAAK4B,eAAe6oD,QAClB,0CACA,iDACAzoD,EACA,CAAE0E,MALW83C,EAAWS,SAO1Bj/C,KAAK+rD,GAAGpvC,eAAa,EAE3B,CAGAmjD,eAAehiB,GACb,MAAMn3C,EAAQm3C,EAAQn3C,MACtB3G,KAAKopD,eAAezpC,OAAOm+B,EAAQ5rC,GAAI,CAAEvL,UAAS9D,UAAU,KAC1D7C,KAAK4B,eAAe6oD,QAClB,gDACA,uDACAzoD,EACA,CAAE0E,MAAO,gCAAkCC,GAAO,EAGxD,CAEA5G,YACUqc,EACAgtC,EACAznD,EACAC,GACAmqD,IAHA/rD,KAAAopD,iBACAppD,KAAA2B,kBACA3B,KAAA4B,kBACA5B,KAAA+rD,MAER/rD,KAAKoc,UAAYA,CACnB,CAEA7O,WACEvN,KAAKw/D,gBAAkBx/D,KAAKopD,eAAe1M,eAAe75C,UACvDi7C,GAAY99C,KAAK0/D,0BAA0B5hB,GAEhD,CAEA5vC,cACElO,KAAKw/D,gBAAgBrxD,cACrBnO,KAAKopD,eAAe1M,eAAe/5C,UAAKX,EAC1C,CAEQ09D,0BAA0B5hB,GAChC99C,KAAKoc,UAAU0hC,QAAUA,EAErBA,GACF99C,KAAKopD,eACFrK,eAAejB,EAAQ5rC,IACvBrP,UAAWk9D,IAEV,MAAMviB,EAAc,CAClBxB,MAFF+jB,EAAmBA,GAAoB,IAEdr2D,OAAQC,IACU,SAAhCA,GAAEu1C,eAAeiZ,YAE1Blc,MAAO8jB,EAAiBr2D,OAAQC,IACS,UAAhCA,GAAEu1C,eAAeiZ,aAG5B,OAAQn4D,KAAKoc,UAAUohC,YAAcA,GAG7C,4CAhHWmiB,IAAkCv+D,MAAAuE,GAAA,GAAAvE,MAAAwE,GAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,aAAA,+BAAlCu+D,GAAkCrxD,UAAA,yCAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAlC1N,MAAA,yBAAAqW,IAAA,OAAA1I,EAAA6wD,gBAAAnoD,GAAuB,EAAvBrW,CAAkC,4BAAAqW,IAAA,OAAlC1I,EAAA8wD,mBAAApoD,GAA0B,EAA1BrW,CAAkC,wBAAAqW,IAAA,OAAlC1I,EAAA+wD,eAAAroD,GAAsB,2BAAtBkoD,EAAkC,4FCZxC,IAAMK,EAAmB,MAA1B,MAAOA,EACSC,gBAApBlgE,YAAoBkgE,GAAAjgE,KAAAigE,iBAAmC,CAEvDt4D,UACEI,EACApF,GAEA,MAAMu9D,EAAWn4D,EAAIzC,QAAQpF,IAAI,uBACjC,GAAIggE,EAAU,CACZ,MAAMC,EAASp4D,EAAIC,MAAM,CACvB1C,QAASyC,EAAIzC,QAAQ0D,OAAO,yBAE9B,GAAiB,UAAbk3D,EACF,OAAOv9D,EAAKwF,OAAOg4D,EAEvB,CAEA,MAAMjuD,EAAKlS,KAAKigE,gBAAgB1+B,WAEhC,OAAO5+B,EAAKwF,OAAOJ,GAAKhE,QACtBq8D,KAAS,KACPpgE,KAAKigE,gBAAgBI,WAAWnuD,EAAE,GAGxC,4CAxBW8tD,GAAmB5+D,MAAAuE,KAAA,iCAAnBq6D,EAAmB3+D,QAAnB2+D,EAAmB1+D,mBAAnB0+D,CAAmB,4FCJzB,IAAMM,EAAiB,MAAxB,MAAOA,EACX,cAAOvnD,GACL,MAAO,CACLC,SAAUsnD,EACV91D,UAAW,CACT,CACEC,QAASC,KACTC,SAAUq1D,IACVp1D,OAAO,IAIf,4CAZW01D,EAAiB,8BAAjBA,uCAAiB,4FCDvB,IAAMC,EAAe,MAAtB,MAAOA,EACJC,SAAW,IAAIz+D,IAAwB,GAEtC0+D,IAAgB,GAExB1gE,cAAe,CAEfwhC,WACE,MAAMrvB,KAAKyQ,QACX,OAAA3iB,KAAKygE,IAAIn5D,KAAK4K,GACdlS,KAAKwgE,SAAS79D,KAAK3C,KAAKygE,IAAI72D,QAErBsI,CACT,CAEAmuD,WAAWnuD,GACT,MAAM+M,EAAQjf,KAAKygE,IAAI/3D,QAAQwJ,IACjB,IAAV+M,IAGJjf,KAAKygE,IAAI56C,OAAO5G,EAAO,GAEvBjf,KAAKwgE,SAAS79D,KAAK3C,KAAKygE,IAAI72D,QAC9B,4CAvBW22D,EAAe,iCAAfA,EAAel/D,QAAfk/D,EAAej/D,UAAAC,WAFd,gBAEDg/D,CAAe,oLCArB,IAAMG,EAAgB,MAAvB,MAAOA,EAOSzgE,OANZJ,QAER,OAAI8gE,GACF,OAASp5D,OAAeq5D,KAAQr5D,OAAeq5D,MAAQ,EACzD,CAEA7gE,YAAoBE,GAAAD,KAAAC,SAClBD,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,cAAgB,GAEvB,WAA1BJ,KAAKH,QAAQghE,UACf7gE,KAAK8gE,YAET,CAEQA,aACN,IAAK9gE,KAAKH,QAAQ0C,MAAQvC,KAAKH,QAAQqS,GACrC,OAEF,MAAM3P,EAC4B,MAAhCvC,KAAKH,QAAQ0C,IAAI+nD,QAAO,GACpBtqD,KAAKH,QAAQ0C,IAAM,SACnBvC,KAAKH,QAAQ0C,IAInB,MACEvC,KAAK2gE,IAAIr5D,KAAK,CAAC,gBAAiB/E,EAAM,SACtCvC,KAAK2gE,IAAIr5D,KAAK,CAAC,YAAatH,KAAKH,QAAQqS,KACzC,MAAM6uD,EAAIz4D,SAASC,cAAc,UAC3BqT,EAAItT,SAAS04D,qBAAqB,UAAU,GAClDD,EAAEv9D,KAAO,kBACTu9D,EAAEE,OAAQ,EACVF,EAAEG,OAAQ,EACVH,EAAEx4B,IAAMhmC,EAAM,MACdqZ,EAAEulD,WAAWjzB,aAAa6yB,EAAGnlD,EAC/B,EAVA,EAWF,CAKOwlD,QAAQ5+D,EAAgCgwD,GAC7C,GAA8B,WAA1BxyD,KAAKH,QAAQghE,SAAuB,CACtC,GAAKr+D,EAKE,CACLxC,KAAK2gE,IAAIr5D,KAAK,CAAC,YAAa9E,EAAK0P,KAEjC,MAAM8c,EAAO,GAAGxsB,EAAK6+D,aAAa7+D,EAAK8+D,WACvCthE,KAAK2gE,IAAIr5D,KAAK,CAAC,oBAAqB,EAAG,OAAQ9E,EAAKoG,SAAU,UAC9D5I,KAAK2gE,IAAIr5D,KAAK,CAAC,oBAAqB,EAAG,OAAQ0nB,EAAM,UACrDhvB,KAAK2gE,IAAIr5D,KAAK,CAAC,oBAAqB,EAAG,UAAWkrD,EAAS,SAC7D,MAXExyD,KAAK2gE,IAAIr5D,KAAK,CAAC,gBACftH,KAAK2gE,IAAIr5D,KAAK,CAAC,uBAAwB,EAAG,SAC1CtH,KAAK2gE,IAAIr5D,KAAK,CAAC,uBAAwB,EAAG,SAC1CtH,KAAK2gE,IAAIr5D,KAAK,CAAC,uBAAwB,EAAG,YAU5CtH,KAAK2gE,IAAIr5D,KAAK,CAAC,kBACftH,KAAK2gE,IAAIr5D,KAAK,CAAC,sBACjB,CACF,CAEOi6D,YAAYrT,EAAcsT,GACD,WAA1BxhE,KAAKH,QAAQghE,UACf7gE,KAAK2gE,IAAIr5D,KAAK,CAAC,kBAAmB4mD,GAAM,EAAOsT,GAEnD,CAEOC,WAAWC,EAAkBh2D,EAAgBsjB,GACpB,WAA1BhvB,KAAKH,QAAQghE,UACf7gE,KAAK2gE,IAAIr5D,KAAK,CAAC,aAAco6D,EAAUh2D,EAAQsjB,GAEnD,CAKO2yC,WAAWD,EAAkBh2D,EAAgBk2D,GACpB,WAA1B5hE,KAAKH,QAAQghE,UACf7gE,KAAK2gE,IAAIr5D,KAAK,CAAC,aAAco6D,EAAUh2D,EAAQk2D,GACnD,4CAjFWlB,GAAgBt/D,MAAAuE,MAAA,iCAAhB+6D,EAAgBr/D,QAAhBq/D,EAAgBp/D,UAAAC,WAFf,gBAEDm/D,CAAgB,gJCPtB,MAAMmB,EAA0D,CACrEC,eAAgB,CACdC,eAAgB,sBAChBC,cAAe,IAAI/gE,KAAK,eAE1BghE,uBAAwB,CACtBF,eAAgB,4BAChBC,cAAe,IAAI/gE,KAAK,eAE1Bi6D,gBAAiB,CACf6G,eAAgB,+BAChBC,cAAe,IAAI/gE,KAAK,eAE1BihE,mBAAoB,CAClBH,eAAgB,2BAChBC,cAAe,IAAI/gE,KAAK,gBAIfkhE,EAAoC,IAAIjjD,IAInD1Y,OAAOsa,QAAQ+gD,GACZn4D,OAAO,EAAE04D,EAAGviE,KAAaA,EAAQkiE,gBACjCthD,IAAI,EAAEla,EAAK1G,KAAa,CACvBA,EAAQkiE,eACR,CACEM,cAAe97D,MCvBVqwD,EAAmB,CAC9B0L,IAAK,SACLC,YAAa,eCSR,IAAMpiE,EAAa,MAApB,MAAOA,EACHF,OACAuiE,WACAC,iBAAmB,IAAIvjD,IAAI1Y,OAAOsa,QAAQ+gD,IAE1Ca,WAAa,IAAI3gE,IAAyB,MAClD4gE,UAAY3iE,KAAK0iE,WAAWE,eAE5B7iE,YAAYwM,GACVvM,KAAKwiE,WAAa,IAAIK,KAAWt2D,EACnC,CAKOu2D,aACLvnD,aAAMmE,KAAK1f,KAAKyiE,iBAAiBh8D,QAAQga,IAAK4hD,SAEpBrgE,IADAua,KAAYsyB,QAAQ7uC,KAAKC,OAAQoiE,IAEvDriE,KAAK+iE,uBAAuBV,EAAa,GAGtCriE,KAAKC,MACd,CAKOG,UAAmBmG,EAAay8D,GACrC,IAAIt8D,EAAQ6V,KAAYsyB,QAAQ7uC,KAAKC,OAAQsG,GAG7C,OADqBvG,KAAKyiE,iBAAiBviE,IAAIqG,SACjBvE,IAAV0E,EAClB1G,KAAK+iE,uBAAuBx8D,QACTvE,IAAV0E,IACTA,EAAQ1G,KAAKijE,6BAA6B18D,IAGrCG,GAASs8D,CAClB,CAEQD,uBAAuBx8D,GAC7B,MAAM1G,EAAUG,KAAKyiE,iBAAiBviE,IAAIqG,GAE1C,IAAIiS,EAAU,gBAAgBjS,+CAC1B1G,EAAQkiE,iBACVvpD,GAAW,6BAA6B3Y,EAAQkiE,4CAG9B,IAAI9gE,MACTpB,EAAQmiE,cACnBkB,QAAQ9+D,MAAMoU,GACd0qD,QAAQC,KAAK3qD,EACnB,CAEQyqD,6BAA6B18D,GACnC,MAAM1G,EAAUsiE,EAAkCjiE,IAAIqG,GACtD,GAAK1G,EAIL,OAAOG,KAAKI,UAAUP,EAAQwiE,cAChC,CAKOn9C,KAAKrlB,GACV,MAAMujE,EAAavjE,EAAQysD,QAC3B,OAAKzsD,EAAQwjE,KAMN,IAAIz0B,QAAQ,CAACC,EAASy0B,MAC3BtjE,KAAKwiE,WACFtiE,IAAIL,EAAQwjE,MACZt/D,QACCG,KAAYE,IACV8+D,QAAQK,IAAI,sBAAsB1jE,EAAQwjE,0BAC1CrjE,KAAK0iE,WAAW//D,MAAK,GACrBksC,GAAQ,IAAI,EACL20B,KAAWp/D,EAAMA,OAAS,mBAGpCvB,UAAW4gE,IACVzjE,KAAKC,OAASsc,KAAYsjC,UACxBtjC,KAAYsjC,UAAU,CAAE+W,QAAOA,GAAIwM,GACnCK,GAEFzjE,KAAK0iE,WAAW//D,MAAK,GACrBksC,GAAQ,EAAI,EACb,IAvBH7uC,KAAKC,OAASmjE,EACdpjE,KAAK0iE,WAAW//D,MAAK,IACd,EAuBX,4CA/FWxC,GAAaiB,MAAAuE,MAAA,iCAAbxF,EAAakB,QAAblB,EAAamB,UAAAC,WAFZ,gBAEDpB,CAAa,KCRfujE,EAAiB,IAAIC,MAA8B,iBAExD,SAAUC,EAAc/jE,GAC5B,SAAOkL,OAAyB,CAC9B,CACEN,QAASi5D,EACTG,SAAUhkE,GAEZ,CACE4K,QAASi9B,MACTC,WAAYm8B,EACZl5D,OAAO,EACPi9B,KAAM,CAAC1nC,EAAeujE,KAG5B,CAEA,SAASI,EAAct7B,EAA8B3oC,GACnD,MAAO,IAAM2oC,EAActjB,KAAKrlB,EAClC,kGCtBO,IAAM8P,EAAiB,MAAxB,MAAOA,+CAAiB,8BAAjBA,qCAFDo0D,cAECp0D,CAAiB,gGCExB,MAAOq0D,EAQDx7B,cACA2iB,OACA8Y,OATFzB,WAEAE,WAAa,IAAI3gE,IAAyB,MAClD4gE,UAAY3iE,KAAK0iE,WAAWE,eAE5B7iE,YACEwM,EACQi8B,EACA2iB,EACA8Y,EAAiB,SAFjBjkE,KAAAwoC,gBACAxoC,KAAAmrD,SACAnrD,KAAAikE,SAERjkE,KAAKwiE,WAAa,IAAIK,KAAWt2D,EACnC,CAEO23D,eAAehQ,GACpB,MAAMiQ,EAAankE,KAAKwiE,WAAWtiE,IAAI,sBAAsBg0D,UAC7D,OAAOl0D,KAAKwoC,cAAcm6B,UAAU5+D,QAClCs5C,KAAO+mB,GAAaA,IAAQ,EAC5Bt7B,KAAU,KACR,GAAI9oC,KAAKwoC,gBAAkBxoC,KAAKmrD,OAAQ,CACtC,MAAMA,EAASnrD,KAAKwoC,cAAcpoC,UAAU,mBAC5CJ,KAAKmrD,QAAUA,GAAU5vC,MAAMC,QAAQ2vC,GAAUA,EAAS,CAACA,EAC7D,CAEA,IAAKnrD,KAAKmrD,QAAiC,IAAvBnrD,KAAKmrD,OAAOvhD,OAC9B,OAAA5J,KAAK0iE,WAAW//D,MAAK,GACdwhE,EAGT,MAAME,EAAcrkE,KAAKmrD,OAAoB1qC,IAAK0qC,GAChDnrD,KAAKwiE,WAAWtiE,IAAI,GAAGirD,IAAS+I,IAAOl0D,KAAKikE,WAK9C,SAFgBK,KAAS,CAACH,KAAeE,IAE1BtgE,QACb0c,KAAK8jD,GACIA,EAAarkD,OAClB,CAACC,EAAK+2B,IAAY36B,KAAYsjC,UAAU1/B,EAAK+2B,GAC7C,MAEH,EACDlzC,KAAI,KACFhE,KAAK0iE,WAAW//D,MAAK,EAAI,GACzB,GAIV,kDClDK,IAAM6hE,EAAe,MAAtB,MAAOA,EAIQj5C,UAHX0oC,SACCwQ,UAAqC,IAAI1iE,SAAgBC,GAElEjC,YAAmBwrB,GAAAvrB,KAAAurB,YACjBvrB,KAAKi0D,SAAWj0D,KAAKurB,UAAUm5C,iBAC/B,MAAMxQ,EAAOl0D,KAAK2kE,cAClB3kE,KAAKurB,UAAUq5C,eAAe1Q,GAC9Bl0D,KAAKykE,UAAU9hE,KAAKuxD,EACtB,CAEOyQ,cACL,OAAO3kE,KAAKi0D,SAAS/4B,MAAM,SAAWl7B,KAAKi0D,SAAW,IACxD,CAEOxuD,YAAYwuD,GACjBj0D,KAAKi0D,SAAWA,EAAS/4B,MAAM,SAAW+4B,EAAW,QACrDhxC,KAAc,CACZjjB,KAAKurB,UAAUs5C,IAAI7kE,KAAKi0D,UACxBj0D,KAAKurB,UAAUu5C,WAAW9kE,KAAKi0D,YAC9BpxD,UAAU,KACX7C,KAAKykE,UAAU9hE,KAAK3C,KAAKi0D,SAAQ,EAErC,4CAvBWuQ,GAAepjE,MAAAuE,MAAA,iCAAf6+D,EAAenjE,QAAfmjE,EAAeljE,UAAAC,WAFd,gBAEDijE,CAAe,KCHtB,MAAOO,EACX58D,OAAOpB,GACL,IAAKA,EAAOi+D,iBAAiBC,MAAMr7D,OAIjC,MAAM,IAAIoY,MAFR,yFAKJ,GAAgC,SAA5Bjb,EAAOR,IAAI+jD,OAAO,EAAG,GACvB,MAAM,IAAItoC,MAAM,YAAYjb,EAAOR,mCAEnC,OAAOQ,EAAOR,GAElB,ECOF,MAAM2+D,EAAmB,IAKnB,SAAUC,GAAmBC,GACjC,SAAOr6D,OAAyB,IAC9Bs6D,OAAoBtB,IAAgBhrD,QAAQusD,EAAqBF,KACjE,CACE36D,QAASi9B,MACTC,WAAahmC,GAAqC,IAE9CA,EAAgB4pB,UAAUg6C,cAC1B5C,WAAW5+D,QACXyhE,KAAQN,IAAgB,EACxB7nB,KAAO+mB,IAA0B,IAAbA,IAAiB,EACrClgE,KAAYE,IACVA,QAAMoU,SAAW,mDAAmD0sD,IAC9D9gE,KAIZyjC,KAAM,CAAC28B,GACP55D,OAAO,IAGb,CAEO,MAAM06D,EACXF,KAEAK,gBAAiB,KACjBL,OAAQA,GAAUM,EAClBC,0BAA2B,CACzBl7D,QAASm7D,KACTj7D,SAAUo6D,KAIDW,EAAoC,CAC/Cj7D,QAASo7D,KACTl+B,WAIF,SAASm+B,EAAsBrkE,EAAmBxB,GAChD,OAAO,IAAI+jE,EAAeviE,EAAMxB,OAAQ+B,OAAWA,EACrD,EALE6lC,KAAM,CAACk+B,KAAa5lE,4ECpEf,IAAKsT,EAAZ,SAAYA,GACVA,SAAAuyD,OAAA,SACAvyD,EAAAwyD,OAAA,SACAxyD,EAAAC,QAAA,UAHUD,CAIZ,CAJA,CAAYA,GAAK,IAMLyyD,EAAZ,SAAYA,GACVA,SAAAC,SAAA,WACAD,EAAAE,UAAA,YAFUF,CAGZ,CAHA,CAAYA,GAAgB,qCCIrB,IAAMG,EAAY,MAAnB,MAAOA,EACJtnC,OAAS,IAAIh9B,SAAuBC,GACpCskE,aAAe,IAAIvkE,SAAkCC,GAE5DjC,YAAYwmE,GACVA,EACGC,QAAQ,CAACC,KAAYC,mBACrB7jE,UAAW86C,IACNA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMuyD,QACvBhmE,KAAKsmE,aAAa3jE,KAAKujE,EAAiBE,WAAS,GAIvDG,EACGC,QAAQ,CAACC,KAAYG,kBACrB/jE,UAAW86C,IACNA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMuyD,QACvBhmE,KAAKsmE,aAAa3jE,KAAKujE,EAAiBC,UAAQ,GAItDI,EACGC,QAAQ,CAACC,KAAYI,kBACrBhkE,UAAW86C,IACNA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMwyD,QACvBjmE,KAAKsmE,aAAa3jE,KAAKujE,EAAiBE,WAAS,GAIvDG,EACGC,QAAQ,CAACC,KAAYK,iBACrBjkE,UAAW86C,IACNA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMwyD,QACvBjmE,KAAKsmE,aAAa3jE,KAAKujE,EAAiBC,UAAQ,GAItDI,EAAmBC,QAAQ,CAACC,KAAYM,eAAelkE,UAAW86C,IAC5DA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMC,SACvB1T,KAAKsmE,aAAa3jE,KAAKujE,EAAiBE,WAAS,GAIrDG,EAAmBC,QAAQ,CAACC,KAAYO,cAAcnkE,UAAW86C,IAC3DA,EAAIgpB,UACN3mE,KAAK++B,OAAOp8B,KAAK8Q,EAAMC,SACvB1T,KAAKsmE,aAAa3jE,KAAKujE,EAAiBC,UAAQ,EAGtD,CAEA3yD,WACE,OAAOxT,KAAK++B,OAAOr4B,KACrB,CAEAugE,iBACE,OAAOjnE,KAAKsmE,aAAa5/D,KAC3B,CAEAwgE,gBACE,MAAO,iBAAkB5+D,SAAS6+D,eACpC,CAEA77C,WAEE,MAAiB,WADHtrB,KAAKwT,UAErB,CAEAD,YAEE,MAAiB,YADHvT,KAAKwT,UAErB,4CA5EW6yD,GAAYjlE,MAAAuE,MAAA,iCAAZ0gE,EAAYhlE,QAAZglE,EAAY/kE,UAAAC,WAFX,gBAED8kE,CAAY,mGCNzB,MAAMe,EAAuC,CAC3CC,cAAe,qBACfC,QAAS,IACTC,gBAAiB,IACjBC,WAAY,iBACZC,aAAc,gBACdC,aAAa,EACbC,aAAa,EACbC,YAAY,EACZC,cAAc,EACdC,UAAW,EACXC,mBAAmB,EACnBC,yBAAyB,EACzBC,iBAAiB,EACjBC,wBAAwB,GAGpB,SAAUC,IACd,SAAOp9D,OAAyB,IAACq9D,MAAchB,IACjD,CCXO,IAAMiB,EAAgB,MAAvB,MAAOA,EACX,cAAOtvD,GACL,MAAO,CACLC,SAAUqvD,EACV79D,UAAW,GAEf,4CANW69D,EAAgB,8BAAhBA,sCAHA,CAACF,cAGDE,CAAgB,KCZtB,IAAKC,EAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,MAAA,UACAF,EAAAG,QAAA,UACAH,EAAAI,KAAA,OACAJ,EAAAK,QAAA,UACAL,EAAAM,KAAA,OANUN,CAOZ,CAPA,CAAYA,GAAW,qECuBhB,IAAMO,EAAc,MAArB,MAAOA,EAMiBjpE,SAClB4oC,cACA7mC,gBAPHmnE,UAAY,IAAI/mE,IAA2B,IAC1ClC,QACAkpE,0BAAwD,GAEhEhpE,YAC4BH,EAClB4oC,EACA7mC,GAFkB3B,KAAAJ,WAClBI,KAAAwoC,gBACAxoC,KAAA2B,kBAER3B,KAAKH,QAAUG,KAAKwoC,cAAcpoC,UAAU,WAC5CJ,KAAK2B,gBAAgB8iE,UAAU1gE,QAAKof,KAAa,MAAMtgB,UAAWmmE,IAC9B,IAA9BhpE,KAAKipE,OAAOC,OAAOt/D,SACrB5J,KAAK+oE,0BAA4B,IAEnC/oE,KAAKipE,OAAOC,OAAOzoD,IAAK0oD,KACtB,MAAMC,EAA2BppE,KAAK+oE,0BAA0B3mD,KAC7DinD,GAAQA,EAAIn3D,KAAOi3D,GAAM1K,SAE5B,GAAI2K,EAA0B,CAC5B,MAAME,EAAkC,IACnCF,EAAyBG,uBAExBC,EAAmC,IACpCJ,EAAyBK,wBAG1BL,EAAyBG,uBAC3B/iE,OAAOC,KAAK2iE,EAAyBG,uBAAuB9oD,IACzDulB,IACKA,IACFsjC,EAAgCtjC,GAC9BhmC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7Bu8B,EAAyBG,sBAAsBvjC,IAAE,GAMzDojC,EAAyBK,wBAC3BjjE,OAAOC,KAAK2iE,EAAyBK,wBAAwBhpD,IAC1DulB,IACKA,IACFwjC,EAAiCxjC,GAC/BhmC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7Bu8B,EAAyBK,uBAAuBzjC,IAAE,IAGzD,EAILs+B,KAAS,CACPtkE,KAAK2B,gBAAgB4pB,UAAUrrB,IAC7BkpE,EAAyBM,QACzBJ,GAEFtpE,KAAK2B,gBAAgB4pB,UAAUrrB,IAC7BkpE,EAAyBtxD,SACzB0xD,KAGDzlE,QAAKs5C,QACLx6C,UAAW86C,IACVwrB,GAAMQ,SAAS/wD,kBAAkBJ,QAAUmlC,EAAI,GAC/CwrB,GAAMQ,SAAS/wD,kBAAkBhN,MAAQ+xC,EAAI,EAAC,EAEpD,GACD,EAEL,CAEA,UAAYsrB,GACV,OAAOjpE,KAAKJ,SAASM,IAAI0pE,KAC3B,CAEAtR,UAAUuR,GACRA,SAAUzlE,MAAMC,QAAS,EAClBrE,KAAKoE,MAAMylE,EAAUzlE,MAAMoU,QAASqxD,EAAUzlE,MAAMwH,MAC7D,CAEA4M,QAAQA,GACN,MAAMsxD,EAActxD,EAAQhV,KAC5BxD,KAAKipE,OAAOc,aAAaC,YAAYF,GAAe,SAASA,IAE7D9pE,KAAK8oE,UAAUnmE,KAAK3C,KAAK8oE,UAAUpiE,MAAMia,OAAO,CAACnI,KAEjDA,EAAQ3Y,QAAU2Y,EAAQ3Y,SAAY,GACtC,MAAMoqE,EAAc,IAAIhpE,KAkBxB,GAhBAuX,EAAQ3Y,QAAQ6f,KAAOlH,EAAQ3Y,QAAQ6f,KACnClH,EAAQ3Y,QAAQ6f,KAChB,IAAIze,KAAK,cACbuX,EAAQ3Y,QAAQqqE,GAAK1xD,EAAQ3Y,QAAQqqE,GACjC1xD,EAAQ3Y,QAAQqqE,GAChB,IAAIjpE,KAAK,cACuB,iBAAzBuX,EAAQ3Y,QAAQ6f,OACzBlH,EAAQ3Y,QAAQ6f,KAAO,IAAIze,KACzBA,KAAKi3B,MAAM1f,EAAQ3Y,QAAQ6f,KAAKgZ,QAAQ,KAAM,QAGhB,iBAAvBlgB,EAAQ3Y,QAAQqqE,KACzB1xD,EAAQ3Y,QAAQqqE,GAAK,IAAIjpE,KACvBA,KAAKi3B,MAAM1f,EAAQ3Y,QAAQqqE,GAAGxxC,QAAQ,KAAM,QAI9CuxC,EAAczxD,EAAQ3Y,QAAQ6f,MAC9BuqD,EAAczxD,EAAQ3Y,QAAQqqE,MAEL,IAArB1xD,EAAQ2xD,WACVnqE,KAAKipE,OAAOc,aAAaC,YAAYF,GACnC,SAASA,oBAEbtxD,EAAUxY,KAAKoqE,eAAe5xD,IAElBo0B,MAAM,CAChB,IAAIy9B,EACJ,OAAQ7xD,EAAQhV,MACd,KAAK8kE,EAAYK,QACf0B,EAAerqE,KAAKyqD,QAClBjyC,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAEV,MACF,KAAKnB,EAAYC,MACf8B,EAAerqE,KAAKoE,MAClBoU,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAEV,MACF,KAAKnB,EAAYI,KACf2B,EAAerqE,KAAK8+D,KAClBtmD,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAEV,MACF,KAAKnB,EAAYM,KACfyB,EAAerqE,KAAKuuC,KAClB/1B,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAEV,MACF,KAAKnB,EAAYE,MACjB,KAAKF,EAAYG,QACf4B,EAAerqE,KAAK0F,MAClB8S,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAEV,MACF,QACEY,EAAerqE,KAAK8+D,KAClBtmD,EAAQo0B,KACRp0B,EAAQ5M,MACR4M,EAAQ3Y,QACR2Y,EAAQ+wD,sBACR/wD,EAAQixD,wBAIdjxD,EAAQ3Y,QAAQqS,GAAKm4D,EAAa5L,OACpC,CAEJ,CAEAhU,QACE7d,EACAhhC,EAAgB,2BAChB/L,EAAqC,GACrC0pE,EACAE,IAEA,OAAOzpE,KAAKsqE,gBACV,UACA19B,EACAhhC,EACA/L,EACA0pE,EACAE,GAEJ,CAEArlE,MACEwoC,EACAhhC,EAAgB,yBAChB/L,EAAqC,GACrC0pE,EACAE,IAEA,OAAOzpE,KAAKsqE,gBACV,QACA19B,EACAhhC,EACA/L,EACA0pE,EACAE,GAEJ,CAEA3K,KACElyB,EACAhhC,EAAgB,wBAChB/L,EAAqC,GACrC0pE,EACAE,IAEA,OAAOzpE,KAAKsqE,gBACV,OACA19B,EACAhhC,EACA/L,EACA0pE,EACAE,GAEJ,CAEA/jE,MACEknC,EACAhhC,EAAgB,yBAChB/L,EAAqC,GACrC0pE,EACAE,IAEA,OAAOzpE,KAAKsqE,gBACV,QACA19B,EACAhhC,EACA/L,EACA0pE,EACAE,GAEJ,CAEAl7B,KACE3B,EACAhhC,EAAgB,wBAChB/L,EAAqC,GACrC0pE,EACAE,IAEA,OAAOzpE,KAAKsqE,gBACV,OACA19B,EACAhhC,EACA/L,EACA0pE,EACAE,GAEJ,CAEQa,gBACN9mE,EACAopC,EACAhhC,EACA/L,EAAqC,GACrC0pE,GACAE,GAEA,MAAMH,EAAkC,IAAKC,IACvCgB,EAAkC,IAAKd,GAEzCF,IACF/iE,OAAOC,KAAK8iE,IAAuB9oD,IAAKulB,IACtC,MAAMt/B,EAAQ6iE,GAAsBvjC,GAChCt/B,IACF4iE,EAAgCtjC,GACb,iBAAVt/B,EACH1G,KAAK2B,gBAAgB4pB,UAAUshB,QAAQnmC,GACvCA,KAIR+iE,GACFjjE,OAAOC,KAAKgjE,GAAwBhpD,IAAKulB,IACvC,GAAIA,EAAG,CACL,MAAMt/B,EAAQ+iE,EAAuBzjC,GACrCukC,EAAgCvkC,GACb,iBAAVt/B,EACH1G,KAAK2B,gBAAgB4pB,UAAUshB,QAAQnmC,GACvCA,CACR,IAIJ,MAAM8R,EAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QAC7CD,EACA08B,GAEIkB,EAAkBxqE,KAAK2B,gBAAgB4pB,UAAUshB,QACrDjhC,EACA2+D,GAGF,IAAIE,EACJ,OAAQjnE,GACN,IAAK,UACHinE,EAAczqE,KAAKipE,OAAOxe,QAAQjyC,EAASgyD,EAAiB3qE,GAC5D,MACF,IAAK,QACH4qE,EAAczqE,KAAKipE,OAAO7kE,MAAMoU,EAASgyD,EAAiB3qE,GAC1D,MACF,IAAK,OACL,IAAK,OACH4qE,EAAczqE,KAAKipE,OAAOnK,KAAKtmD,EAASgyD,EAAiB3qE,GACzD,MACF,IAAK,QACH4qE,EAAczqE,KAAKipE,OAAOyB,QAAQlyD,EAASgyD,EAAiB3qE,GAGhE,OAAAG,KAAK+oE,0BAA0BzhE,KAAK,CAClC4K,GAAIu4D,EAAYhM,QAChB3mD,SAAUlM,EACV89D,QAAS98B,EACT28B,yBACAE,2BAEKgB,CACT,CAEAhqE,OAAOyR,GACLlS,KAAKipE,OAAOxoE,OAAOyR,EACrB,CAEAyyC,uBACE,UAAWgmB,KAAQ3qE,KAAK8oE,UAAUpiE,MAC5BikE,EAAKnnE,OAAS8kE,EAAYC,OAC5BvoE,KAAKS,OAAOkqE,EAAK9qE,QAAQqS,GAG/B,CAEQk4D,eAAe5xD,GACrB,IAAKxY,KAAKH,SAASgP,UAAY2J,EAAQvD,KACrC,OAAOuD,EAGT,IAAIvD,EAAOjV,KAAKH,SAASgP,SACzBoG,SAAOA,EAAKyjB,QAAQ,UAAWlgB,EAAQo0B,MACvC33B,EAAOA,EAAKyjB,QAAQ,WAAYlgB,EAAQ5M,OAExC4M,EAAQvD,UAAOjT,EACfwW,EAAQo0B,KAAO33B,EACfuD,EAAQ5M,WAAQ5J,EACTwW,CACT,4CAvWWqwD,GAAcznE,MAMfwpE,OAAQxpE,MAAAuE,MAAAvE,MAAAwE,MAAA,iCANPijE,EAAcxnE,QAAdwnE,EAAcvnE,UAAAC,WAFb,gBAEDsnE,CAAc,iHCXpB,IAAMgC,EAAc,MAArB,MAAOA,EAWDjpE,eACAhC,SAXFkrE,wBAA0B,IAAIx9D,MAC9By9D,mBACAC,oBACAhN,kBAEAxtD,MAAyB,CAC/By6D,WAAY1jE,OAAO2jE,UAAUC,QAG/BprE,YACU6B,EACAhC,GADAI,KAAA4B,iBACA5B,KAAAJ,WAERI,KAAKorE,mBACP,CAEQA,oBACNprE,KAAK+qE,sBAAqBM,KAAU9jE,OAAQ,UAAU1E,UAAU,KAC1D7C,KAAKg+D,mBACPh+D,KAAK4B,eAAenB,OAAOT,KAAKg+D,mBAElC,MAAMQ,EAAax+D,KAAK4B,eAAek9D,KACrC,kCACA,iCAEF9+D,KAAKg+D,kBAAoBQ,EAAWC,QACpCz+D,KAAKwQ,MAAMy6D,YAAa,EACxBjrE,KAAKsrE,WAAS,GAGhBtrE,KAAKgrE,uBAAsBK,KAAU9jE,OAAQ,WAAW1E,UAAU,KAC5D7C,KAAKg+D,mBACPh+D,KAAK4B,eAAenB,OAAOT,KAAKg+D,mBAElC,MAAMQ,EAAax+D,KAAK4B,eAAek9D,KACrC,mCACA,kCAEF9+D,KAAKg+D,kBAAoBQ,EAAWC,QACpCz+D,KAAKwQ,MAAMy6D,YAAa,EACxBjrE,KAAKsrE,WAAS,EAElB,CAEQA,YACNtrE,KAAK8qE,wBAAwB18D,KAAKpO,KAAKwQ,MACzC,CAEAtC,cACE,IACElO,KAAKgrE,oBAAoB78D,cACzBnO,KAAK+qE,mBAAmB58D,aAC1B,OAAa,CACf,CAEA8R,aAAasrD,GAAc,GACzB,OAAOA,EACHvrE,KAAK8qE,wBAAwB/mE,QAC3Bof,KAAa,MAAG,EAChBqoD,KAAUxrE,KAAKwQ,QAEjBxQ,KAAK8qE,wBAAwB/mE,QAAKof,KAAa,KACrD,4CA/DW0nD,GAAczpE,MAAAuE,MAAAvE,aAAA,iCAAdypE,EAAcxpE,QAAdwpE,EAAcvpE,UAAAC,WAFb,gBAEDspE,CAAc,kFCLpB,IAAIY,EAAwB,IAAI9H,MACrC,uBAaW+H,EAAY,MAAnB,MAAOA,EAID7pE,OACDw6C,MAJFx8C,QAEPE,YACU8B,EACDw6C,EAGPx8C,GAJQG,KAAA6B,SACD7B,KAAAq8C,QA4BPr8C,KAAKH,QAAU2G,OAAO6H,OAAO,GAvBN,CACrB02C,UAAW,SACXE,QAAS,OACTD,cAAe,aACfrE,WAAY,UACZgrB,UAAW,SACXhX,mBAAoB,gBACpBC,oBAAqB,kBACrBgX,mBAAoB,UACpBC,qBAAsB,iBACtBC,QAAS,OACT5U,UAAW,SACXC,aAAc,YACdC,WAAY,UACZC,cAAe,aACfC,aAAc,YACdC,gBAAiB,eACjBC,cAAe,aACfC,iBAAkB,gBAClBC,cAAe,aACfC,iBAAkB,gBAClBoU,UAAW,UAEoClsE,EACnD,CAEA,eAAI+gD,GACF,IAAIr+C,EAAMypE,mBAAmBxkE,SAASykE,QACtC,GAAI1pE,EAAIy1B,SAAS,WAAS,CACxBz1B,EAAMA,EAAIm2B,QAAQ,SAAO,WACzB,MAAMkoB,EAAmBr+C,EACtBshB,MAAM,GACNva,MAAM,KACNmX,IAAK9W,GAAMA,EAAEL,MAAM,MACnB4W,OAAO,CAACklC,EAAK8mB,KACZ,MAAO3lE,EAAKG,GAASwlE,EAAKzrD,IAAIurD,oBAC9B5mB,SAAI7+C,GAAOG,EACJ0+C,GACN,IACLplD,KAAK6B,OAAO2xC,SAAS,GAAI,CAAEoN,eAC7B,CACA,OAAO5gD,KAAKq8C,MAAMuE,WACpB,4CApDW8qB,GAAYtqE,MAAAuE,MAAAvE,MAAAuE,MAAAvE,MAMbqqE,EAAqB,oCANpBC,EAAYrqE,QAAZqqE,EAAYpqE,UAAAC,WAFX,gBAEDmqE,CAAY,kGCrBb9kE,EAAZ,SAAYA,GACVA,SAAAulE,QAAA,UACAvlE,EAAAC,MAAA,QAFUD,CAGZ,CAHA,CAAYA,GAAY,IAiBZwlE,EAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,SAAA,WACAF,EAAAG,QAAA,UACAH,EAAAI,QAAA,UAJUJ,CAKZ,CALA,CAAYA,GAAuB,ICN7B,MAAgBlmE,EACVrG,QAEH4sE,eACL,IAAI1qE,SAAgBC,GAEtBjC,YAAYE,GACVD,KAAKH,QAAUI,EAAOG,UAAa,YAAe,CAAEmG,IAAK,MAC3D,CAKArG,IAAIqG,EAAaI,GACf,IAAID,EAUJ,KARKC,GAASA,IAAUC,EAAaulE,WACnCzlE,EAAQgmE,eAAe/rE,QAAQ,GAAGX,KAAKH,QAAQ0G,OAAOA,OAGpDI,IAAUC,EAAaC,QAAWH,IAAUC,KAC9CD,EAAQnG,aAAaI,QAAQ,GAAGX,KAAKH,QAAQ0G,OAAOA,MAGlDG,EACF,IACEA,EAAQuxB,KAAKC,MAAMxxB,EACrB,OAEA,CAGF,OAAOA,CACT,CAEArG,IACEkG,EACAG,EACAC,EAAsBC,EAAaC,OAEnC,MAAMiN,EAAgB9T,KAAKE,IAAIqG,EAAKI,GAChCA,IAAUC,EAAaulE,QACzBO,eAAelsE,QACb,GAAGR,KAAKH,QAAQ0G,OAAOA,IACvB0xB,KAAKouB,UAAU3/C,IAGjBnG,aAAaC,QAAQ,GAAGR,KAAKH,QAAQ0G,OAAOA,IAAO0xB,KAAKouB,UAAU3/C,IAEpE,MAAMmN,EAAe7T,KAAKE,IAAIqG,EAAKI,GAE/BkN,IAAiBC,GACnB9T,KAAKysE,eAAe9pE,KAAK,CACvB4D,MACAI,QACA+iB,WACoB1nB,IAAlB8R,EACIs4D,EAAwBE,SACxBF,EAAwBC,MAC9Bv4D,gBACAD,gBAGN,CAEApT,OAAO8F,EAAaI,EAAsBC,EAAaC,OACrD,MAAMiN,EAAgB9T,KAAKE,IAAIqG,EAAKI,GAChCA,IAAUC,EAAaulE,QACzBO,eAAehsE,WAAW,GAAGV,KAAKH,QAAQ0G,OAAOA,KAEjDhG,aAAaG,WAAW,GAAGV,KAAKH,QAAQ0G,OAAOA,KAEjDvG,KAAKysE,eAAe9pE,KAAK,CACvB4D,MACAI,QACA+iB,MAAO0iD,EAAwBG,QAC/Bz4D,iBAEJ,CAEAhN,MAAMH,EAAsBC,EAAaC,OACnCF,IAAUC,EAAaulE,QACzBO,eAAe5lE,QAEfvG,aAAauG,QAEf9G,KAAKysE,eAAe9pE,KAAK,CAAEgE,QAAO+iB,MAAO0iD,EAAwBI,SACnE,4BCxFK,IAAM3hE,EAAe,MAAtB,MAAOA,UAAuB3E,EACdjG,OAApBF,YAAoBE,GAClBmG,MAAMnG,GADYD,KAAAC,QAEpB,4CAHW4K,GAAczJ,MAAAuE,MAAA,iCAAdkF,EAAcxJ,QAAdwJ,EAAcvJ,UAAAC,WAFb,gBAEDsJ,CAAe,+DCVrB,IAAK8hE,EAAZ,SAAYA,GACVA,SAAAC,IAAA,MACAD,EAAAE,KAAA,OACAF,EAAAG,WAAA,WACAH,EAAAI,gBAAA,WACAJ,EAAAK,eAAA,WALUL,CAMZ,CANA,CAAYA,GAAgB,IAsBhBM,EAAZ,SAAYA,GACVA,SAAAC,aAAA,gBACAD,EAAAE,YAAA,eACAF,EAAAG,WAAA,cAHUH,CAIZ,CAJA,CAAYA,GAAgC,0SCuBtC,MAAOI,EAQD5rE,KACAk8D,WARF2P,QAAU,CAChBV,IAAK,IAAIW,IACTV,KAAM,IAAIW,IACVC,SAAU,IAAIC,KAGhB3tE,YACU0B,EACAk8D,GADA39D,KAAAyB,OACAzB,KAAA29D,YACP,CAEHgQ,cACEC,GAKA,OAAO5tE,KAAK6tE,gBAAgB,MAHhBD,EAAYrrE,IACPqrE,EAAY7mE,OAAe2vD,SAEK3yD,QAC/C0c,KAAKqtD,GACIA,EACH9tE,KAAK+tE,gBAAgBH,EAAaE,QAClC9rE,GAGV,CAEAgsE,eACEJ,GAYA,OAPgB5tE,KAAK6tE,gBAAgB,OAHzBD,EAAYrrE,IACRqrE,EAAYhX,SAE+B7yD,QACzD0c,KAAKqtD,GACIA,EACH9tE,KAAKiuE,iBAAiBL,EAAaE,QACnC9rE,GAIV,CAEAksE,gBACEN,GASA,OAAO5tE,KAAKyB,KACT0sE,MAPD,WACAP,EAAYQ,QACZ,yBACAR,EAAYS,MACZ,YAGgB,YACftqE,QACC0c,KAAK6tD,GACHtuE,KAAKuuE,kBAAkBX,EAAaU,IAG5C,CAKAE,iBACEZ,GAEA,MAAM9wB,EAAU8wB,EAAYrrE,IAAM,IAAMqrE,EAAYnrB,MAAQ,UACtDgsB,EAAsBzuE,KAAK6tE,gBAC/B,aACAD,EAAYrrE,KAERmsE,EAAgB1uE,KAAKyB,KAAKvB,IAAI48C,GACpC,SAAOwnB,KAAS,CAACoK,EAAeD,IAAsB1qE,QACpD0c,KAAKk9B,GACI39C,KAAK2uE,mBAAmBf,EAAajwB,EAAI,GAAIA,EAAI,KAG9D,CAKAixB,sBACEhB,GAMA,MAAM9wB,EAAU8wB,EAAYrrE,IAAM,IAAMqrE,EAAYnrB,MAAQ,UACtDosB,EAAYjB,EAAYrrE,IAAM,iBAC9BksE,EAAsBzuE,KAAK6tE,gBAC/B,kBACAD,EAAYrrE,KAERmsE,EAAgB1uE,KAAKyB,KAAKvB,IAAI48C,GAC9BgyB,EAAS9uE,KAAKyB,KAAKvB,IAAI2uE,GAAW9qE,QACtC0c,KAAKk9B,GAAaA,IAAG,EACrBz5C,KAAYC,IACV++D,QAAQK,IAAI,iDAA8C,EACnD3/D,MAAGO,MAGd,SAAOmgE,KAAS,CAACoK,EAAeI,EAAQL,IAAsB1qE,QAC5D0c,KAAKk9B,GACI39C,KAAK+uE,8BACVnB,EACAjwB,EAAI,GACJA,EAAI,GACJA,EAAI,KAIZ,CAKAqxB,qBACEpB,GAIA,MAAM9wB,EAAU8wB,EAAYrrE,IAAM,IAAMqrE,EAAYnrB,MAAQ,UACtDosB,EAAYjB,EAAYrrE,IAAM,iBAC9BksE,EAAsBzuE,KAAK6tE,gBAC/B,iBACAD,EAAYrrE,KAERmsE,EAAgB1uE,KAAKyB,KAAKvB,IAAI48C,GAC9BmyB,EAAajvE,KAAKyB,KAAKvB,IAAI2uE,GAAW9qE,QAC1C0c,KAAKk9B,GAAaA,IAAG,EACrBz5C,KAAYC,IACV++D,QAAQK,IAAI,gDAA6C,EAClD3/D,MAAGO,MAGd,SAAOmgE,KAAS,CAACoK,EAAeO,EAAYR,IAAsB1qE,QAChE0c,KAAKk9B,GACH39C,KAAK+uE,8BAA8BnB,EAAajwB,EAAI,GAAIA,EAAI,GAAIA,EAAI,KAG1E,CAKAkwB,gBACEz/B,EACA0O,EACA8Z,GAEA,MAAM7vD,EAAS,IAAImoE,KAAW,CAC5BC,WAAY,CACVhvB,QAAS,kBACT/R,QAASA,EAAQghC,cACjBxY,QAASA,GAAW,QACpByY,GAAI,UAIR,IAAIlvB,EACJ,OACEA,EADgC,aAA9BwsB,KAAiBv+B,GACTpuC,KAAKyB,KAAKvB,IAAI48C,EAAU,WAExB98C,KAAKyB,KAAKvB,IAAI48C,EAAS,CAC/B/1C,SACA6hC,aAAc,SAIXuX,EAAQp8C,QACb0c,KAAKk9B,IACH,GAAkC,aAA9BgvB,KAAiBv+B,GACnB,OAAOuP,EAET,GACElU,OAAOkU,GAAKxlB,cAAcH,SAAS,qBACnCyR,OAAOkU,GAAKxlB,cAAcH,SAAS,iBAEnC,KAAM,CACJ5zB,MAAO,CACLoU,QAAS,oDAIb,OAAOxY,KAAKstE,QAAQl/B,GAAS4N,KAAK2B,EAAG,IAExC,EACDz5C,KAAYynC,IACV,aAAWA,EAAEvnC,MAAU,MACrBunC,EAAEvnC,MAAMC,QAAS,GAEbsnC,IAGZ,CAEQoiC,gBACNH,EACAE,GAEA,MACMrrB,EAAQziD,KAAKsvE,6BACjBxB,EAAayB,WAAWC,MAFV5B,EAAY7mE,OAAe0vD,QAM3C,IAAKhU,EACH,KAAM,CACJr+C,MAAO,CACLoU,QAAS,oBAIf,MAAMi3D,EAAWhtB,EAAMitB,QAAUjtB,EAAMitB,QAAQ,QAAK1tE,EAC9C2tE,EAAWltB,EAAMmtB,SAAWntB,EAAMmtB,cAAW5tE,EAC7C6tE,EAAcptB,EAAMqtB,YAAcrtB,EAAMqtB,iBAAc9tE,EAC5D,IAAI+gD,EAAYN,EAAMM,UACtB,MAAMgtB,EAAa/vE,KAAKgwE,cAAcvtB,GAChCwtB,EAAiBF,GAAcvpE,OAAOC,KAAKspE,GAAYnmE,OAAS,EAChEsmE,EAAgBztB,EAAM0tB,MAAQnwE,KAAKowE,SAAS3tB,EAAM0tB,YAASnuE,EACjE,IAAIquE,GAAuB,EACvB5tB,EAAM6tB,yBACR7tB,EAAM6tB,yBAAyB/1D,QAAQ,CAACg2D,GAAOtxD,MACzCA,GAAQ,IAAMsxD,GAAQ,KAAOA,IAAQ,OACvCF,GAAuB,GAErBpxD,IAAS,IAAMsxD,GAAQ,IAAMA,IAAQ,MACvCF,GAAuB,KAI3BA,GAAuB,EAGzB,MAAMG,EAASH,EACXI,KACEhuB,EAAM6tB,yBACN,YACAtwE,KAAK29D,WAAWS,SAASpc,iBAE3BhgD,EAEJ,IAAI0uE,EACJ,MAAMC,GAA8B,CAClCC,KAAoBC,QACpBD,KAAoBE,SACpBF,KAAoBG,KACpBH,KAAoBI,KACpBJ,KAAoB34C,KACpB24C,KAAoB1zD,MAGtB,UAAW2pC,MAAY8pB,GACrB,IAGQ,IAFN7C,EAAayB,WAAW0B,QAAQC,eAAeC,OAAOzoE,QACpDm+C,IAEF,CACA,MAAMuqB,GAAU5qE,OAAOC,KAAKmqE,MAAqBxuD,KAC9C7b,IAAQqqE,KAAoBrqE,MAASsgD,IAExC6pB,EAAcW,KAAYD,IAC1B,KACF,CAEGV,IACH3tB,GAAY,GAGd,MAAMljD,GAAgC0c,KAAY+0D,gBAAgB,CAChEC,wBAAyB,CACvB3lE,MAAO62C,EAAM+uB,MACbC,iBAAeC,MAAuBjvB,EAAMkvB,qBAC5CC,iBAAeF,MAAuBjvB,EAAMovB,qBAC5CrB,SACAf,SAAU,CACRltE,IAAKktE,EAAWA,EAASqC,oBAAiB9vE,EAC1C+vE,SAAQtC,QAAkBztE,EAC1B2tE,WACAE,eAEFK,iBAEFntB,YACA2tB,cACAX,WAAYE,EAAiBF,OAAa/tE,EAC1CiuE,iBAAgBA,QAAwBjuE,EACxCgwE,QAAS/B,EAAiBF,EAAW3jD,SAAMpqB,EAC3CiwE,QAAShC,EAAiBF,EAAW5jD,SAAMnqB,EAC3CkwE,SAAUjC,EAAiBF,EAAWh/C,UAAO/uB,IAG/C,OAAOua,KAAYsjC,UAAUhgD,GAAS+tE,EACxC,CAEQK,iBACNL,EACAE,GAGA,MAAMrrB,EAAQqrB,EAAaqE,SAAS3C,MAAMptD,KACvCpP,GAAOA,EAAGo/D,aAAexE,EAAYnrB,OAGlC5iD,KAAUwyE,KAAwBvE,EAAcF,GAEhD0E,EAAe9rE,OAAO6H,OAAOxO,EAAS+tE,GACtC9qB,EAAgBvmC,KAAY+0D,gBAAgB,CAChDC,wBAAyB,CACvB3lE,MAAO62C,EAAM+uB,SAIjB,OAAOj1D,KAAYsjC,UAAUiD,EAAewvB,EAC9C,CAEQ/D,kBACNX,EACAU,GAEA,MAAMxuB,EAAS,GACT/4C,EAASunE,EAAaxuB,OAAO,GAAGjgD,QAAQ0yE,iBAC9CxrE,EAAO+4C,OAAOvlC,QAASlS,IACrBy3C,EAAOx4C,KAAK,CACV9D,KAAM6E,EAAQ7E,KAAK20B,cACnBt4B,QAASwI,EAAQxI,QACjBivE,OAAQzmE,EAAQymE,QACjB,GAEH,MAAMjvE,EAAU0c,KAAY+0D,gBAAgB,CAC1CrxE,OAAQ,CACN22D,QAAS7vD,EAAO6vD,QAChB9W,YAGJ,OAAOvjC,KAAYsjC,UAAUhgD,EAAS+tE,EACxC,CAEQe,mBACNf,EACAc,EACAD,GAEA,MAAM7iE,EAAQ8iE,EAAc1/C,KAC5B,IAAIigD,EAQA94D,EALF84D,EADEP,EAAc8D,aAAa77D,SAChB+3D,EAAc8D,YAAY77D,cAE1B3U,EAIX0sE,EAAc8D,cAGhBr8D,GAFuB,IAAIs8D,KAEJC,cAAchE,EADC,eAAxBA,EAAciE,MAAyB,IAAM,YAG7D,MAAMC,EAAe,IAAIC,IAAc,CACrCj8D,OAAQ83D,EAAcoE,gBAExB,IAAIC,EACAhD,EACJ,GAAIrB,EAAcsE,SAAU,CAC1B,MAAMC,EAAOvE,EAAcsE,SAASD,WACpCA,EAAaE,EAAK,GAAK,IAAMA,EAAK,GAClC,MAAM7mD,EAAM,IAAInrB,KAChBmrB,EAAI8mD,QAAQD,EAAK,IACjB,MAAM9mD,EAAM,IAAIlrB,KAChBkrB,EAAI+mD,QAAQD,EAAK,IACjBlD,EAAa,CACX3jD,IAAKA,EAAI+mD,cACThnD,IAAKA,EAAIgnD,cACTj5C,OAAO,EACP12B,KAAM4vE,IAAeC,SACrBl9D,MAAOm9D,IAAgBC,SAE3B,CACA,MAAMxsE,EAASP,OAAO6H,OACpB,GACA,CACE8H,QACAsgD,OAAQmX,EAAYnrB,MAAQ,QAAUmrB,EAAYnrB,WAAQzgD,EAC1DixE,KAAMF,IAGJlzE,EAAU0c,KAAY+0D,gBAAgB,CAC1CvqE,SACAwqE,wBAAyB,CACvB3lE,QACAgmE,iBAAeF,MAAuBhD,EAAc8E,UACpD/B,iBAAeC,MAAuBhD,EAAc+E,UACpDhE,SAAU,CACRsC,QAAQ,EACRpC,SACEjB,EAAcgF,aAAejF,EAAoBkF,qBAGvD1E,aACAc,aACA6D,aAAclF,EAAc3tC,OAC5B8yC,WAAYnF,EAAcoF,eAE5Bj0E,SAAQ+yE,aAAeA,EAChBr2D,KAAYsjC,UAAUhgD,EAAS+tE,EACxC,CAEQmB,8BACNnB,EAGAc,EACAI,EACAL,GAEA,MAAM7iE,EAAQ8iE,EAAc1/C,KACtBigD,EAAaH,EAAOhvB,OACtBgvB,EAAOhvB,OAAO19B,KAAM2xD,GAAMA,EAAEC,YAAcpoE,QAC1C5J,EACE4wE,EAAe,IAAIC,IAAc,CACrCj8D,OAAQ83D,EAAcoE,gBAExB,IAAIC,EACAhD,EACJ,GAAIrB,EAAcsE,SAAU,CAC1B,MAAMC,EAAOvE,EAAcsE,SAASD,WACpCA,EAAaE,EAAK,GAAK,IAAMA,EAAK,GAClC,MAAM7mD,EAAM,IAAInrB,KAChBmrB,EAAI8mD,QAAQD,EAAK,IACjB,MAAM9mD,EAAM,IAAIlrB,KAChBkrB,EAAI+mD,QAAQD,EAAK,IACjBlD,EAAa,CACX3jD,IAAKA,EAAI+mD,cACThnD,IAAKA,EAAIgnD,cACTj5C,OAAO,EACP12B,KAAM4vE,IAAeC,SACrBl9D,MAAOm9D,IAAgBC,SAE3B,CACA,MAAMxsE,EAASP,OAAO6H,OACpB,GACA,CACEooD,OAAQmX,EAAYnrB,MAAQ,QAAUmrB,EAAYnrB,WAAQzgD,EAC1DixE,KAAMF,IAGJlzE,EAAU0c,KAAY+0D,gBAAgB,CAC1CvqE,SACAwqE,wBAAyB,CACvB3lE,QACAgmE,iBAAeF,MAAuBhD,EAAc8E,UACpD/B,iBAAeC,MAAuBhD,EAAc+E,UACpDhE,SAAU,CACRsC,QAAQ,EACRpC,SACEjB,EAAcgF,aAAejF,EAAoBkF,qBAGvD1E,aACAc,aACA6D,aAAclF,EAAc3tC,OAC5B8yC,WAAYnF,EAAcoF,eAE5Bj0E,SAAQ+yE,aAAeA,EAChBr2D,KAAYsjC,UAAUhgD,EAAS+tE,EACxC,CAEQ0B,6BAA6B2E,EAAYjlD,GAC/C,GAAIzT,MAAMC,QAAQy4D,GAAa,CAC7B,IAAIxxB,EACJwxB,SAAW7xD,KAAM1b,IACf+7C,EAAQziD,KAAKsvE,6BAA6B5oE,EAAOsoB,QAChChtB,IAAVygD,GACNziD,MAEIyiD,CACT,CAAO,OAAIwxB,EAAWzE,MACbxvE,KAAKsvE,6BAA6B2E,EAAWzE,MAAOxgD,GAEvDilD,EAAWC,MAAQD,EAAWC,OAASllD,EAClCilD,OAET,CAEJ,CAEAjE,cAAcvtB,GACZ,IAAI0xB,EAEJ,GAAI1xB,EAAM2xB,UAAW,CACnB,MAAMrE,EAAkB,GAGxB,GAFAoE,EAAY1xB,EAAM2xB,UAAU,GAExBD,EAAUx4D,OAAQ,CACpB,MAAM04D,EAAYF,EAAUx4D,OAAOrS,MAAM,KACzCymE,EAAW3jD,SAAuBpqB,IAAjBqyE,EAAU,GAAmBA,EAAU,QAAKryE,EAC7D+tE,EAAW5jD,SAAuBnqB,IAAjBqyE,EAAU,GAAmBA,EAAU,QAAKryE,EAC7D+tE,EAAWh/C,UAAwB/uB,IAAjBqyE,EAAU,GAAmBA,EAAU,QAAKryE,CAChE,CAEA,OAAImyE,EAAU7nB,UACZyjB,EAAWrpE,MAAQytE,EAAU7nB,SAExByjB,CACT,CACF,CAEAK,SAASD,GAkBP,MAJqC,CACnCmE,gBAduCnE,EAAM1vD,IAAKtK,KAEhD6Y,KAAM7Y,EAAM+9D,KACZtoE,MAAOuK,EAAMq7D,SAId9nE,OACC,CAACmuB,EAAM5Y,EAAOguB,IACZA,EAAK+H,UAAW5F,GAAwBA,EAAEpgB,OAAS6I,EAAK7I,QACxD/P,GAQR,4CAlhBWouD,GAAmBjsE,MAAAuE,MAAAvE,MAAAwE,KAAA,iCAAnBynE,EAAmBhsE,QAAnBgsE,EAAmB/rE,UAAAC,WAFlB,UAmEZkhC,QAAA,IAHC8G,KAAU,CACTC,cAAe,MAChB,EAAC+qC,EAAAjxC,IAAA,cAAA5H,WAAA,EAAA64C,EAAAjxC,IAAA,qBAAA98B,UAAA,EAAA+tE,EAAAjxC,IAAA,oBAGC1oB,MAAUyyD,EAAAryD,UAAA,4BAiBbynB,MAAA,IAHC8G,KAAU,CACTC,cAAe,MAChB,EAAC+qC,EAAAjxC,IAAA,cAAA5H,WAAA,EAAA64C,EAAAjxC,IAAA,qBAAA98B,UAAA,EAAA+tE,EAAAjxC,IAAA,oBAKC1oB,MAAUyyD,EAAAryD,UAAA,iCAgCbynB,MAAA,IAHC8G,KAAU,CACTC,cAAe,MAChB,EAAC+qC,EAAAjxC,IAAA,cAAA5H,WAAA,EAAA64C,EAAAjxC,IAAA,qBAAA98B,UAAA,EAAA+tE,EAAAjxC,IAAA,oBAGC1oB,MAAUyyD,EAAAryD,UAAA,gCA2BbynB,MAAA,IAHC8G,KAAU,CACTC,cAAe,MAChB,EAAC+qC,EAAAjxC,IAAA,cAAA5H,WAAA,EAAA64C,EAAAjxC,IAAA,qBAAAmG,wBAAA,EAAA8qC,EAAAjxC,IAAA,oBAKC1oB,MAAUyyD,EAAAryD,UAAA,sOC7LT,MAAgBw5D,GCuCf,IAAMC,EAAiB,MAAxB,MAAOA,EAIDC,oBACYC,eACZC,qBACAjzE,gBACAC,eACAizE,gBARHC,aAAe,IAAI/yE,IAA8B,IAExDhC,YACU20E,EACYC,GACZC,EACAjzE,EACAC,EACAizE,GALA70E,KAAA00E,sBACY10E,KAAA20E,kBACZ30E,KAAA40E,uBACA50E,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAA60E,iBACP,CAEHE,sBACEj3B,EACAk3B,IAEA,IAAKl3B,EAAQt6C,KACX0/D,cAAQ9+D,MAAM05C,GACR,IAAI97B,MAAM,2BAElB,IAAIqU,EACJ,OAAQynB,EAAQt6C,KAAK20B,eACnB,IAAK,MACH9B,EAAar2B,KAAKi1E,oBAAoBn3B,GACtC,MACF,IAAK,SACHznB,EAAar2B,KAAKk1E,wBAChBp3B,GAEF,MACF,IAAK,MACHznB,EAAar2B,KAAKm1E,oBAAoBr3B,GACtC,MACF,IAAK,MACH,MAAMs3B,EAAat3B,EACnBvhC,KAAY84D,+BAA+BD,EAAWruE,QACtDsvB,EAAar2B,KAAKs1E,oBAAoBF,EAAYJ,IAClD,MACF,IAAK,OACH3+C,EAAar2B,KAAKu1E,qBAChBz3B,GAEF,MACF,IAAK,MACHznB,EAAar2B,KAAKw1E,oBAAoB13B,GACtC,MACF,IAAK,YACHznB,EAAar2B,KAAKy1E,0BAChB33B,GAEF,MACF,IAAK,QACHznB,EAAar2B,KAAK01E,sBAChB53B,GAEF,MACF,IAAK,aACHznB,EAAar2B,KAAK21E,2BAChB73B,EACAk3B,IAEF,MACF,IAAK,kBACH3+C,EAAar2B,KAAK41E,gCAChB93B,EACAk3B,IAEF,MACF,IAAK,YACH3+C,EAAar2B,KAAK61E,0BAChB/3B,GAEF,MACF,IAAK,MACHznB,EAAar2B,KAAK81E,oBAAoBh4B,GACtC,MACF,IAAK,iBACHznB,EAAar2B,KAAK+1E,+BAChBj4B,EACAk3B,IAEF,MACF,IAAK,UACH3+C,EAAar2B,KAAKg2E,wBAChBl4B,GAEF,MACF,QACEolB,cAAQ9+D,MAAM05C,GACR,IAAI97B,MAAM,2BAGpB,OAAAhiB,KAAK80E,aAAanyE,KAAK3C,KAAK80E,aAAapuE,MAAMia,OAAO,CAAC0V,KAEhDA,CACT,CAEQ4+C,oBACNn3B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIuzE,KAAcp4B,IACxD,CAEQo3B,wBACNp3B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIm5D,KAAkBhe,IAC5D,CAEQ+3B,0BACN/3B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIwzE,KAAoBr4B,IAC9D,CAEQq3B,oBACNr3B,GAEA,OAAO,IAAIljC,IAAYq7D,IACrBA,GAAEtzE,KACA,IAAIyzE,KACFt4B,EACA99C,KAAK40E,qBACL50E,KAAK60E,kBAIb,CAEQS,oBACNx3B,EACAk3B,IAEA,MAAMqB,EAAc,GACpB,OAAIv4B,EAAQu0B,yBAA2B9qE,OAAO2jE,UAAUC,QACtDkL,EAAY/uE,KACVtH,KAAK00E,oBAAoB/G,cAAc7vB,GAAS/5C,QAC9CG,KAAYynC,IACV,MAAA3rC,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOo3C,EAAQ/2C,OAAO0vD,SAEpB9qB,MAOZ3rC,KAAK20E,gBACL72B,EAAQw4B,gBACR/uE,OAAO2jE,UAAUC,QAEjBkL,EAAY/uE,KACVtH,KAAK20E,eAAehH,cAAc7vB,EAASk3B,IAAoBjxE,QAC7DG,KAAYynC,IACVA,EAAEvnC,MAAMykC,WAAY,EACpB8C,EAAEvnC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,uCAEFlB,EAAEvnC,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,6CAA0C,EAErCjpC,MAAG,QAMlByyE,EAAY/uE,QAAK1D,MAAGk6C,KAAQ,EAErBwmB,KAAS+R,GAAatyE,QAC3B0c,KAAK5gB,IACH,MAAM02E,EAAgB12E,EAAQqgB,OAAO,CAACoiC,EAAGC,IACvChmC,KAAYsjC,UAAUyC,EAAGC,IAE3B,OAAO,IAAIi0B,KAAcD,EAAev2E,KAAK40E,qBAAoB,IAClE,EACD1wE,KAAW,OACFN,WAAG5B,IAGhB,CAEQuzE,qBACNz3B,GAEA,OAAIA,EAAQu0B,yBAA2B9qE,OAAO2jE,UAAUC,OAC/CnrE,KAAK00E,oBAAoB1G,eAAelwB,GAAS/5C,QACtD0c,KAAK5gB,IACIA,GAAU,IAAI42E,KAAe52E,SAAWmC,IAChD,EACDkC,KAAW,KACTlE,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOo3C,EAAQ2E,SAAO,EAEnB7+C,WAAG5B,MAKT,IAAI4Y,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAI8zE,KAAe34B,IACzD,CAEQ03B,oBACN13B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAI+zE,KAAc54B,IACxD,CAEQ23B,0BACN33B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIg0E,KAAoB74B,IAC9D,CAEQ43B,sBACN53B,GAEA,OAAIA,EAAQuwB,MACHruE,KAAK00E,oBACTxG,gBAAgBpwB,GAChB/5C,QACC0c,KAAK5gB,IAAoC,IAAI+2E,KAAgB/2E,MAG5D,IAAI+a,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIi0E,KAAgB94B,IAC1D,CAEQ63B,2BACN73B,EACAk3B,IAEA,MAAMqB,EAAc,GACpB,OAAI9uE,OAAO2jE,UAAUC,QACnBkL,EAAY/uE,KACVtH,KAAK00E,oBAAoBlG,iBAAiB1wB,GAAS/5C,QACjDG,KAAYynC,IACV,MAAA3rC,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOo3C,EAAQ2E,QAEb9W,MAMZ3rC,KAAK20E,gBACL72B,EAAQw4B,gBACR/uE,OAAO2jE,UAAUC,QAEjBkL,EAAY/uE,KACVtH,KAAK20E,eACFkC,qBAAqB/4B,EAASk3B,IAC9BjxE,QACCG,KAAYynC,IACVA,EAAEvnC,MAAMykC,WAAY,EACpB8C,EAAEvnC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,uCAEFlB,EAAEvnC,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,6CAA0C,EAErCjpC,MAAG,QAKpByyE,EAAY/uE,QAAK1D,MAAGk6C,KAAQ,EACrBwmB,KAAS+R,GAAatyE,QAC3B0c,KAAK5gB,IACH,MAAM02E,EAAgB12E,EAAQqgB,OAAO,CAACoiC,EAAGC,IACvChmC,KAAYsjC,UAAUyC,EAAGC,IAE3B,OAAO,IAAIu0B,KAAqBP,EAAa,IAC9C,EACDryE,KAAW,OACFN,WAAG5B,IAGhB,CAEQ4zE,gCACN93B,EACAk3B,IAEA,MAAMqB,EAAc,GAEpB,OAAI9uE,OAAO2jE,UAAUC,QACnBkL,EAAY/uE,KACVtH,KAAK00E,oBAAoB9F,sBAAsB9wB,GAAS/5C,QACtDG,KAAYynC,IACV,MAAA3rC,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOo3C,EAAQ/2C,OAAO0vD,SAEpB9qB,MAMZ3rC,KAAK20E,gBACL72B,EAAQw4B,gBACR/uE,OAAO2jE,UAAUC,QAEjBkL,EAAY/uE,KACVtH,KAAK20E,eACFkC,qBAAqB/4B,EAASk3B,IAC9BjxE,QACCG,KAAYynC,IACVA,EAAEvnC,MAAMykC,WAAY,EACpB8C,EAAEvnC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,uCAEFlB,EAAEvnC,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,6CAA0C,EAErCjpC,MAAG,QAKpByyE,EAAY/uE,QAAK1D,MAAGk6C,KAAQ,EACrBwmB,KAAS+R,GAAatyE,QAC3B0c,KAAK5gB,IACH,MAAM02E,EAAgB12E,EAAQqgB,OAAO,CAACoiC,EAAGC,IACvChmC,KAAYsjC,UAAUyC,EAAGC,IAE3B,OAAO,IAAIw0B,IAA0BR,EAAa,IACnD,EACDryE,KAAW,OACFN,WAAG5B,IAGhB,CAEQ+zE,+BACNj4B,EACAk3B,IAEA,MAAMqB,EAAc,GACpB,OAAI9uE,OAAO2jE,UAAUC,QACnBkL,EAAY/uE,KACVtH,KAAK00E,oBAAoB9F,sBAAsB9wB,GAAS/5C,QACtDG,KAAYynC,IACV,MAAA3rC,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOo3C,EAAQ/2C,OAAO0vD,SAEpB9qB,MAMZ3rC,KAAK20E,gBACL72B,EAAQw4B,gBACR/uE,OAAO2jE,UAAUC,QAEjBkL,EAAY/uE,KACVtH,KAAK20E,eACFkC,qBAAqB/4B,EAASk3B,IAC9BjxE,QACCG,KAAYynC,IACVA,EAAEvnC,MAAMykC,WAAY,EACpB8C,EAAEvnC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,uCAEFlB,EAAEvnC,MAAMoU,QAAUxY,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,6CAA0C,EAErCjpC,MAAG,QAKpByyE,EAAY/uE,QAAK1D,MAAGk6C,KAAQ,EACrBwmB,KAAS+R,GAAatyE,QAC3B0c,KAAK5gB,IACH,MAAM02E,EAAgB12E,EAAQqgB,OAAO,CAACoiC,EAAGC,IACvChmC,KAAYsjC,UAAUyC,EAAGC,IAE3B,OAAO,IAAIy0B,KAAyBT,EAAa,IAClD,EACDryE,KAAW,OACFN,WAAG5B,IAGhB,CAEQ8zE,oBACNh4B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIs0E,KAAcn5B,IACxD,CAEQk4B,wBACNl4B,GAEA,OAAO,IAAIljC,IAAYq7D,IAAMA,GAAEtzE,KAAK,IAAIi5D,KAAkB9d,IAC5D,8CA7ZW22B,GAAiBrzE,MAAAuE,KAAAvE,MAAAwE,EAAA,GAAAxE,MAAAyE,KAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,MAAA,iCAAjByuE,EAAiBpzE,QAAjBozE,EAAiBnzE,UAAAC,WAFhB,gBAEDkzE,CAAiB,2FCzCxB,MAAO7Y,UAA0BE,IAI3Bob,iBACR,OAAAl3E,KAAKH,QAAQ83B,OAAS33B,KAAKm3E,2BAA2Bn3E,KAAKH,SAC3DG,KAAKH,QAAQ4jB,OAASrd,MAAM8wE,iBACrB,IAAIE,IAAgBp3E,KAAKH,QAClC,CAEUw3E,aACR,SAAO10D,OACT,CAEO20D,YAAa,oECThB,MAAgBC,EAMX13E,QACG23E,YANLtlE,GACAmvC,GACCytB,OAER/uE,YACSF,EAA6B,GAC1B23E,GADHx3E,KAAAH,UACGG,KAAAw3E,cAEVx3E,KAAKH,QAAUA,EACfG,KAAKkS,GAAKlS,KAAKH,QAAQqS,IAAMlS,KAAKq3E,aAClCr3E,KAAKqhD,GAAKrhD,KAAKk3E,gBACjB,CAIUG,aACR,SAAOI,MAA4Bz3E,KAAKH,QAC1C,CAEO63E,UAAUvhE,EAAgBhG,GAC/B,OAAOnQ,KAAK8uE,OAAS9uE,KAAK8uE,OAAS,EACrC,CAEO6I,UAAU93E,GACf,OACEG,KAAK8uE,OADHjvE,EAAQ0C,IACI,CAAC,CAAEA,IAAK1C,EAAQ0C,MACrB1C,EAAQoV,KACH,CAAC,CAAEA,KAAMpV,EAAQoV,OAEjB,GAGTjV,KAAK8uE,MACd,oGCxCI,MAAOhT,UAA0Byb,IAG3BL,iBACR,MAAMp0B,EAAgB,CACpBnrB,OAAQ33B,KAAKm3E,2BAA2Bn3E,KAAKH,UAG/C,OAAO,IAAI+3E,IAAepxE,OAAO6H,OAAOy0C,EAAe9iD,KAAKH,SAC9D,CAEUs3E,2BAA2Bt3E,GACnC,GAAIA,EAAQ83B,OACV,OAAO93B,EAAQ83B,OAEjB,IAAIkgD,EACJ,MAAMC,EAAaj4E,EAAQi4E,WAC3B,GAAKA,GACWC,GAEdF,EAAcE,EAASD,QACH91E,IAAhB61E,EACF,MAAM,IAAI71D,MAAM,oDAJlB61D,EAAcE,IAQhB,MAAMC,EAAgBn4E,EAAQm4E,cAC9B,IAAIrgD,EACJ,OACEA,EADEqgD,EACO,IAAIH,EAAYG,GAEhB,IAAIH,EAGRlgD,CACT,CAEO2/C,YAAa,CAEpB,cAAIzD,GACF,OAAQ7zE,KAAKH,QAAgBg0E,WACxB7zE,KAAKH,QAAgBg0E,WACtB,OACN,sNC5CI,MAAOqC,UAAsBqB,IAIvBL,iBACR,OAAKl3E,KAAKH,QAAQ0C,MAChBvC,KAAKH,QAAQ0C,IAAM,kDAEd,IAAI01E,IAAYj4E,KAAKH,QAC9B,CAEOy3E,YAAa,iBCXhB,MAAOZ,UAAsBa,IAIvBL,iBACR,OAAO,IAAIgB,IAAYl4E,KAAKH,QAC9B,CAEOy3E,YAAa,kDCMhB,MAAOlB,UAAsBmB,IAWxB13E,QACGs4E,WACFtD,gBAVV,cAAIuD,CAAW1xE,GACZ1G,KAAKH,QAA2Cu4E,WAAa1xE,CAChE,CACA,cAAI0xE,GACF,OAAQp4E,KAAKH,QAA2Cu4E,UAC1D,CAEAr4E,YACSF,EACGs4E,EACFtD,IAERzuE,OAAA,EAAMiyE,MAAex4E,EAAS,QAJvBG,KAAAH,UACGG,KAAAm4E,aACFn4E,KAAA60E,mBAIR,MAAMuD,GAAcp4E,KAAKH,QACtBu4E,WACGE,GACJt4E,KAAKH,QAAQ04E,UAAUD,mBAAqBE,KACxCC,GAAkB,IAAIC,IAC3B14E,KAAKH,QAA2Cu4E,WAC/CK,GAAgBE,+BACdP,GACAE,IAGDt4E,KAAKH,QAA2Cu4E,WAAWznC,SAC3D3wC,KAAKH,QAA2Cu4E,WAAWjc,WAC3Dt8D,EAAQ+zE,cAAgB,IAAIlqE,OAAQkvE,KAAQA,GAAGj9D,QAAQ/R,OAAS,GAEjE5J,KAAKm4E,WAAWU,uBAAuB74E,KAAKH,SAG1Cu4E,IAAYU,cACdV,GAAWU,YAAYC,aAAe,cAEpCX,IAAYY,aACdZ,GAAWY,WAAWD,aAAe,YAEnCX,IAAYa,eACdb,GAAWa,aAAaF,aAAe,eAErCX,IAAYnrD,SACdmrD,GAAWnrD,OAAO8rD,aAAe,UAE/BX,IAAY/3C,eACd+3C,GAAW/3C,aAAa04C,aAAe,gBAGzC/4E,KAAKk5E,cACFl5E,KAAKH,QAA2Cu4E,YACjD,EAEJ,CAEUlB,iBAKR,OAJqB,IAAIU,IAAe,CACtCjgD,UAAQwhD,MAAqBn5E,KAAKH,SAClC2lB,SAAU4zD,MAGd,CAEAF,cAAcd,EAA+BiB,GAAwB,GACnEr5E,KAAKo4E,WAAaA,EACdiB,GACFr5E,KAAKqhD,GAAGi4B,OAAO,aAAct5E,KAAKo4E,WAEtC,CAEOd,YAAa,+CCpFhB,MAAOb,UAAuBc,IAIlCx3E,YAAYF,GACVuG,MAAMvG,EACR,CAEUq3E,iBACR,MAAMp0B,EAAgBt8C,OAAO6H,OAC3B,CACEkrE,YAAUC,KAAsBx5E,KAAKH,QAAQmiD,aAE/ChiD,KAAKH,SAGP,OAAO,IAAI45E,IAAa32B,EAC1B,CAEOw0B,YAAa,4BCnBhB,MAAOV,UAAwBW,IAInC,UAAIxwE,GACF,OAAO/G,KAAKH,QAAQkH,MACtB,CAEA,cAAI8sE,GACF,OAAQ7zE,KAAKH,QAAgBg0E,WACxB7zE,KAAKH,QAAgBg0E,WACtB,OACN,CAEA,YAAI6F,GACF,OAAQ15E,KAAKH,QAAgB65E,QAC/B,CAEA,mBAAIC,GACF,OAAQ35E,KAAKH,QAAgB85E,gBACxB35E,KAAKH,QAAgB85E,gBACtBC,KAAgBC,KACtB,CAEU3C,iBACR,MAGMp0B,EAAgBt8C,OAAO6H,OAC3B,CACEyrE,YALgB95E,KAAKH,QAAQi6E,YAC7B95E,KAAKH,QAAQi6E,YACb,aAKF95E,KAAKH,SAEP,OAAO,IAAIk6E,IAAcj3B,EAC3B,CAEA40B,YACE,MAAM5I,EAAS1oE,MAAMsxE,YACrB,GAAI5I,EAAOllE,OAAS,EAClB,OAAOklE,EAGT,IAAIkL,EAAa,UACjB,GAAIh6E,KAAKH,QAAQI,OAAO6/C,OAAO,GAAGgvB,OAChC,OAAA9uE,KAAKH,QAAQI,OAAO6/C,OAAO,GAAGgvB,OAAOl7B,MAAMr5B,QAAS4rB,MAChC,IAAdA,GAAEtP,UACJmjD,GACE,oCAEA7zC,GAAEz/B,MACF,gCAEAy/B,GAAEnX,KACF,gBAGNgrD,GAAc,WACP,CAAC,CAAE/kE,KAAM+kE,IACX,CAEL,MAAMt3B,GAAe1iD,KAAKH,QAAQI,OAAO6/C,OAAO,GAAGjgD,QAE7Co6E,GAAQ,CACZ,gBACA,eACA,eACA,iBACA,eAEF,UAAWC,MAAWD,GACpB,GAAIv3B,GAAay3B,SAASniD,SAASkiD,IAAU,CAC3C,MAAM12E,GAAOk/C,GAAay3B,SAAS7wE,MAAM4wE,IAASl/C,MAC5CzvB,GAAQ/H,GAAK8mD,OAAO,EAAG9mD,GAAKkF,QAAQ,MAC1C,GAAI6C,GAAMysB,SAAS,QAAS,CAC1B,MAAMoiD,GAAS7uE,GAAMjC,MAAM,OAAO,GAAGA,MAAM,KACrCrF,GAAOsH,GAAMjC,MAAM,OAAO,GAAGA,MAAM,KACzC,QAAS+wE,GAAI,EAAGA,GAAID,GAAOxwE,OAAQywE,KACjCD,GAAOC,IAAKD,GAAOC,IAAG3hD,QAAQ,UAAW,IACzCz0B,GAAKo2E,IAAKp2E,GAAKo2E,IAAG3hD,QAAQ,UAAW,IACD,MAAhCz0B,GAAKo2E,IAAG3hD,QAAQ,OAAQ,MAC1Bz0B,GAAKo2E,IAAK,UAEZL,GACE,oCAEAI,GAAOC,IACP,gCAEAp2E,GAAKo2E,IACL,aAEJ,KACF,CAIEL,GACE,oCAEAzuE,GACA,iCAPYm3C,GAAa43B,WACvB53B,GAAa43B,WACb,IAQF,aACF,KAEJ,CAEFN,UAAc,WACP,CAAC,CAAE/kE,KAAM+kE,GAClB,CACF,CAEO1C,YAAa,iBCjHhB,MAAOR,UAA6BS,IAI9BL,iBACR,MAAMqD,EAAiB,IAAIC,KAC3B,OAAO,IAAI5C,IAAe,CACxBhF,aAAc5yE,KAAKH,QAAQkH,OAAO6rE,aAClC6H,UAAU,EACV9iD,OAAQ4iD,EACRh4E,IAAK,SAAUiuE,EAAQlV,GAAY/Z,IACjC,MAAMzE,GAAU98C,KAAKH,QAAQ0C,IAAM,IAAMvC,KAAKH,QAAQ4iD,MAAQ,UAYxD17C,GAAS,CACb,SACA,YAbeuvD,mBACf,WACEka,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,0CAKF,oCACA,cACA,sCACA,cACA,sBACA,gBAMF,OAJIxwE,KAAKH,QAAQkH,OAAOksE,MAEtBlsE,GAAOO,KADM,QAAQtH,KAAKH,QAAQkH,OAAOksE,QAGvCjzE,KAAKH,QAAQkH,OAAO2zE,cACtB16E,KAAKH,QAAQkH,OAAO2zE,aAAangE,QAASlS,KACxCtB,GAAOO,KAAKe,GAAO,GAGhB,GAAGy0C,MAAW/1C,GAAO8C,KAAK,MACnC,EAAE8wE,KAAK36E,MACPwlB,SAAUo1D,MAEd,CAEAlD,YACE,MAAMzI,EAAajvE,KAAKH,QAAQovE,WAC1BH,EAAS1oE,MAAMsxE,YACrB,QAAmB11E,IAAfitE,GAA4BH,EAAOllE,OAAS,EAC9C,OAAOklE,EAET,IAAKG,EACH,OAEF,IACI1mC,GACA/c,GACAub,GAHAizC,GAAa,UAKjB,GAAI/K,EAAWH,OACb,UAAW+L,MAAiB5L,EAAWH,OACrCvmC,GAAMvoC,KAAK86E,WACTD,GAAcE,YACdF,GAAcG,WAEhBxvD,GAAQqvD,GAAcrvD,MAClBqvD,GAAcrvD,MAAMkN,QAAQ,SAAU,QACtC,GACJshD,IACE,mCACAzxC,GACA,iDACA/c,GACA,qBAEyB,gBAApByjD,EAAWzrE,KACpB,UAAWq3E,MAAiB5L,EAAWgM,iBACrCzvD,GAAQqvD,GAAcrvD,MAAMkN,QAAQ,SAAU,QACZ,YAA9BmiD,GAAcK,OAAO13E,MACvB+kC,GAAMvoC,KAAK86E,WACTD,GAAcK,OAAOH,YACrBF,GAAcK,OAAOF,WAEvBhB,IACE,mCACAzxC,GACA,iDACA/c,GACA,cACqC,YAA9BqvD,GAAcK,OAAO13E,OAC9BujC,GAAM/mC,KAAKm7E,UAAUN,GAAcK,QACnClB,IACE,wBACAjzC,GACA,mCACAvb,GACA,kBAGuB,WAApByjD,EAAWzrE,OACpBgoB,GAAQyjD,EAAWzjD,MACfyjD,EAAWzjD,MAAMkN,QAAQ,SAAU,QACnC,GAC2B,YAA3Bu2C,EAAWiM,OAAO13E,MACpB+kC,GAAMvoC,KAAK86E,WACT7L,EAAWiM,OAAOH,YAClB9L,EAAWiM,OAAOF,WAEpBhB,IACE,mCACAzxC,GACA,iDACA/c,GACA,cACkC,YAA3ByjD,EAAWiM,OAAO13E,OAC3BujC,GAAM/mC,KAAKm7E,UAAUlM,EAAWiM,QAChClB,IACE,wBACAjzC,GACA,mCACAvb,GACA,eAGNwuD,WAAc,WACP,CAAC,CAAE/kE,KAAM+kE,IAClB,CAEAc,WAAWC,EAAqBC,GAC9B,MAAO,QAAQD,YAAsBC,GACvC,CAEAG,UAAUD,GACR,IAAIn0C,EAAc,GAElB,MAAMx7B,GAAuB2vE,EAAO3vE,MAAQ2vE,EAAO3vE,MAAQ,CAAC,EAAG,EAAG,EAAG,GAErE,GAAoB,YAAhB2vE,EAAO13E,KAAoB,CAC7B,MAEM43E,GACJ,eACA7vE,GAAM,GACN,IACAA,GAAM,GACN,IACAA,GAAM,GACN,IACAA,GAAM,GACN,IACI8vE,GAAsB,iBAZNH,EAAOh8C,MAAQg8C,EAAOh8C,MAAQ,GAc/B,iBAAjBg8C,EAAO/kE,MACT4wB,EACE,2EACAq0C,GACA,IACAC,GACA,YACwB,gBAAjBH,EAAO/kE,QAEhB4wB,EACE,2EACAq0C,GACA,IACAC,GAHA,mCAQN,SACmB,kBAAjBH,EAAO/kE,OACU,iBAAjB+kE,EAAO/kE,MACP,CACA,MAAMmlE,GAAeJ,EAAOK,QAAQhwE,MAI9B6vE,GACJ,eACAE,GAAa,GACb,IACAA,GAAa,GACb,IACAA,GAAa,GACb,IACAA,GAAa,GACb,IACID,GAAc,gBAbCH,EAAOK,QAAQr8C,MAc9Bs8C,GACJ,aACAjwE,GAAM,GACN,IACAA,GAAM,GACN,IACAA,GAAM,GACN,IACAA,GAAM,GACN,IAGAw7B,EADmB,kBAAjBm0C,EAAO/kE,MAEP,0DA1BS+kE,EAAO57D,KA2BT,EACP,YACA87D,GACA,IACAC,GACA,IACAG,GACA,YAGA,gFACAJ,GACA,IACAC,GACA,IACAG,GACA,WAEN,CACA,OAAOz0C,CACT,CAEOuwC,YAAa,iBCrOhB,MAAOP,UAAkCQ,IAI7C,UAAIxwE,GACF,OAAO/G,KAAKH,QAAQkH,MACtB,CAEA,cAAI8sE,GACF,OAAQ7zE,KAAKH,QAAgBg0E,WACxB7zE,KAAKH,QAAgBg0E,WACtB,OACN,CAEA,YAAI6F,GACF,OAAQ15E,KAAKH,QAAgB65E,QAC/B,CAEA,mBAAIC,GACF,OAAQ35E,KAAKH,QAAgB85E,gBACxB35E,KAAKH,QAAgB85E,gBACtBC,KAAgBC,KACtB,CAEU3C,iBACR,MAAMnwE,OACmB/E,IAAvBhC,KAAKH,QAAQ4iD,MACTziD,KAAKH,QAAQkH,OACbP,OAAO6H,OACL,CAAEooD,OAAQ,QAAQz2D,KAAKH,QAAQ4iD,SAC/BziD,KAAKH,QAAQkH,QAGrB,MAAoC,iBAAzBA,EAAO00E,gBAChB10E,EAAO00E,cAAgBxjD,KAAKouB,UAAUt/C,EAAO00E,gBAGxC,IAAIC,IAAgB,CACzBC,MAAO,EACP50E,SACAxE,IAAKvC,KAAKH,QAAQ0C,KAEtB,CAEAm1E,YACE,MAAMzI,EAAajvE,KAAKH,QAAQovE,WAC1BH,EAAS1oE,MAAMsxE,YACrB,QACiB11E,IAAfitE,QACuBjtE,IAAvBhC,KAAKH,QAAQ4iD,OACbqsB,EAAOllE,OAAS,EAEhB,OAAOklE,EAGT,IAAKG,EACH,OAEF,IAAI+K,GAAa,UAEjB,UAAWa,MAAiB5L,EAAWH,OAGrCkL,IAFY,kCAAGh6E,KAAKH,QAAQ0C,OAAO0sE,EAAW2M,kBAAkBf,GAAct4E,kDAChEs4E,GAAcrvD,MAAMkN,QAAQ,SAAU,QAMlD,aAEJshD,WAAc,WACP,CAAC,CAAE/kE,KAAM+kE,IAClB,CAEO1C,YAAa,sCC3EhB,MAAOX,UAA4BY,IAI7BL,iBACR,MAAMtJ,EAAc31C,KAAKC,MAAMD,KAAKouB,UAAUrmD,KAAKH,UACnD,OAAIG,KAAKH,QAAQ05E,kBACR3L,EAAY2L,SACnB3L,EAAY2L,SAAW,IAAIsC,IAAS77E,KAAKH,QAAQ05E,WAE5C,IAAIuC,IAAUlO,EACvB,CAEO0J,YAAa,ECbhB,MAAOnB,UAA4Bra,IAChCigB,GAGG7E,iBACR,OAAAl3E,KAAKg8E,kBACLh8E,KAAKH,QAAQ83B,OAAS33B,KAAKm3E,2BAA2Bn3E,KAAKH,SACpDuG,MAAM8wE,gBACf,CAEQ8E,kBACNh8E,KAAK+7E,GAAK,IAAIE,UAAUj8E,KAAKH,QAAQ0C,KACrCvC,KAAK+7E,GAAGG,UAAYl8E,KAAKm8E,UAAUxB,KAAK36E,MAEpCA,KAAKH,QAAQu8E,UACfp8E,KAAK+7E,GAAGK,QAAUp8E,KAAKq8E,QAAQ1B,KAAK36E,OAGlCA,KAAKH,QAAQsoD,UACfnoD,KAAK+7E,GAAG5zB,QAAUnoD,KAAKsoC,QAAQqyC,KAAK36E,OAGlCA,KAAKH,QAAQy8E,SACft8E,KAAK+7E,GAAGO,OAASt8E,KAAKu8E,OAAO5B,KAAK36E,MAEtC,CAEAm8E,UAAUzyD,GACR,MAAM8yD,EAAex8E,KAAKH,QAAQ83B,OAAO8kD,YACvC/yD,EAAMzlB,MAGR,OAAQjE,KAAKH,QAAQq8E,WACnB,IAAK,SAEH,MAAMQ,GAAkB18E,KAAKqhD,GAAGs7B,eAAeH,EAAaI,SACxDF,IACF18E,KAAKqhD,GAAGw7B,cAAcH,IAExB18E,KAAKqhD,GAAGy7B,WAAWN,GACnB,MACF,IAAK,SACHx8E,KAAKqhD,GAAGv6C,OAAM,GACd9G,KAAKqhD,GAAGy7B,WAAWN,GACnB,MAEF,QACEx8E,KAAKqhD,GAAGy7B,WAAWN,GAEzB,CAEAH,QAAQ3yD,GACN,CAGF4e,QAAQ5e,GACN,CAGF6yD,OAAO7yD,GACL,CAGK4tD,YACLt3E,KAAK+7E,GAAG9jE,OACV,6DC5DI,MAAOg/D,UAAsBM,IAIvBL,iBACR,IAAI6F,EACJ,OACEA,EADgC,YAA9B/8E,KAAKH,QAAQm9E,aACH,IAAIC,IAAY,CAAED,aAAclyE,MAEhC,IAAImyE,IAElBj9E,KAAKH,QAAQ83B,OAASolD,EACf,IAAIG,IAAmBl9E,KAAKH,QACrC,CAEUw3E,aACR,OAAKr3E,KAAKH,QAAQ0C,IAIXuG,KAAIC,QADG,MAAQ/I,KAAKH,QAAQ0C,MAFjC,EAAOogB,OAIX,CAEO20D,YAAa,wGC1BhB,MAAON,UAAiCO,IAI5C,UAAIxwE,GACF,OAAO/G,KAAKH,QAAQkH,MACtB,CAEA,cAAI8sE,GACF,OAAQ7zE,KAAKH,QAAgBg0E,WACxB7zE,KAAKH,QAAgBg0E,WACtB,OACN,CAEA,YAAI6F,GACF,OAAQ15E,KAAKH,QAAgB65E,QAC/B,CAEA,mBAAIC,GACF,OAAQ35E,KAAKH,QAAgB85E,gBACxB35E,KAAKH,QAAgB85E,gBACtBC,KAAgBC,KACtB,CAEU3C,iBACR,OAAO,IAAIiG,IAAuBn9E,KAAKH,QACzC,CAEA63E,YACE,MAAMzI,EAAajvE,KAAKH,QAAQovE,WAC1BH,EAAS1oE,MAAMsxE,YACrB,QACiB11E,IAAfitE,QACuBjtE,IAAvBhC,KAAKH,QAAQ4iD,OACbqsB,EAAOllE,OAAS,EAEhB,OAAOklE,EAGT,IAAKG,EACH,OAEF,IAAI+K,EAAa,UAEjB,UAAWa,KAAiB5L,EAAWH,OAGrCkL,GAFY,kCAAGh6E,KAAKH,QAAQ0C,OAAO0sE,EAAW2M,kBAAkBf,EAAct4E,kDAChEs4E,EAAcrvD,MAAMkN,QAAQ,SAAU,QAMlD,aAEJshD,UAAc,WACP,CAAC,CAAE/kE,KAAM+kE,GAClB,CAEO1C,YAAa,oGClEhB,MAAgB8F,wCCuBf,IAAMC,EAAW,MAAlB,MAAOA,UAAmBD,EACV37E,KAApB1B,YAAoB0B,GAClB2E,QADkBpG,KAAAyB,MAEpB,CAEAm/B,UACEsiC,eAAQK,IAAI,oCACL,kCACT,CAEOsV,uBACLyE,GAGGA,EAAkB1J,cACuB,IAA1C0J,EAAkB1J,aAAahqE,OAS/B5J,KAAKu9E,2BAA2BD,GAAmBz6E,UAChD26E,IACCF,EAAkB1J,aAAar5D,QAASkjE,SACZz7E,IAAtBy7E,EAAYC,QACdD,EAAYC,MAAQD,EAAYzuD,YAGThtB,IAAvBy7E,EAAY9hE,QACkB,IAA9B8hE,EAAY9hE,OAAO/R,UAEnB6zE,EAAY9hE,OAAS6hE,EAAsBp7D,KACxCw2D,GAAOA,EAAG5pD,OAASyuD,EAAYzuD,MAChCrT,SAEL,IArBL2hE,EAAkB1J,aAAe,GACjC5zE,KAAKu9E,2BAA2BD,GAAmBz6E,UAChD26E,IACCF,EAAkB1J,aAAe4J,IAsBzC,CAEQG,cACNL,EACAM,EAAaC,KACbC,EAAmBC,KACnBC,EACA/xD,EAAqB,EACrBgyD,GAAoC,GAUpC,MAAMnhC,KARoBohC,MACxBZ,EACAM,EACAE,EACAE,EACA/xD,EACAgyD,GAEgC77D,KAC/B+jB,GAAiB,eAAXA,EAAEnX,MACTtoB,MACIy3E,GAAeb,EAAkB/E,UAAU4F,aACjD,OACEF,GACAG,KAASl0E,KAAKi0E,MACbA,GAEMn+E,KAAKyB,KAAKvB,IAAI48C,EAAS,CAAElU,aAAc,SAEvC5oC,KAAKyB,KAAKvB,IAAI48C,EAEzB,CAEAygC,2BACED,GAEA,OAAO,IAAI1iE,IAAYq7D,IACrB,MAAMrC,EAAe,GACrB,IAAIyK,EACAC,EACAC,EACAC,EACAC,EAEJD,KAAYrF,MAAqBmE,GACjC,MAAMoB,GACJzmD,KAAKC,MAAMD,KAAKouB,UAAUi3B,WACrBoB,GAAqBnG,UAAU4F,oBAC9BO,GAA8C1G,cAEtDyG,KAAqBtF,MAAqBuF,IAC1C,IAAIC,EAA+BrB,EAAkB1J,cACjDlqE,OAAQy8B,IAAOA,EAAExqB,QAClB8E,IAAK0lB,GAAMA,EAAEnX,MAGhBhvB,KAAK29E,cAAcL,EAAmB,OAAGt7E,OAAWA,EAAW,GAAG,GAC/D+B,QACC66E,KAAWjhC,GACTlU,OAAOkU,GAAKxlB,cAAcH,SAAS,cAAW,EAC1Cp0B,OAAG,IAAK,EACRA,OAAG,KAAK,EAEdg7E,KAAWC,GAEF7+E,KAAK29E,cAAcL,EAAmB,GAAGv5E,QAC9C66E,KAAWE,IACT,MAAMv0E,EAAWi0E,EAAUr3B,aAAa23B,GACxCT,EAAY9zE,EAAS,GAAG8xD,WAEtBihB,EAAkB1J,cACwB,IAA1C0J,EAAkB1J,aAAahqE,UAE/B+0E,EAA+BN,GAEjCC,EAAkBD,EAAU30E,OACzB81B,GACCm/C,EAA6B3mD,SAASwH,IACtCA,IAAUj1B,EAAS,GAAGw0E,oBACrBv/C,EAAMtE,MAAM,gBAEjBqjD,EAAqBD,EAAgBz0E,KAAK,KAC1C,MAAMm1E,EAAkB,GACxB,IAAI/yD,EAAa,EAGjB,IACG4yD,GACuC,UAAxCvB,EAAkB/E,UAAU3hB,SAC5B0mB,EAAkB/E,UAAU0G,YAAcpB,KAC1C,CAEA,KAAO5xD,EAAaqxD,EAAkB/E,UAAU0G,aAC9CD,EAAgB13E,KACdtH,KAAK29E,cACHL,EACA4B,IACA5B,EAAkB/E,UAAU4G,QAC5BZ,EACAtyD,IAGJA,GAAcizD,IAEhBT,EAAqBD,CACvB,MACEQ,EAAgB13E,KACdtH,KAAK29E,cACHL,EACAA,EAAkB/E,UAAU0G,aAC1BpB,KACFP,EAAkB/E,UAAU4G,QAC5BZ,EACA,GACA,IAIN,SAAOt7D,KAAc+7D,EAAe,MAK3Cn8E,UAAWu8E,IACV,IAAIC,EAAqC,GACzCD,EAAQ3+D,IAAK4oB,IACX,MAAMi2C,EAAeb,EAAmBt3B,aAAa9d,GACrDg2C,EAAYA,EAAU1+D,OAAO2+D,EAAY,GAE3Ct/E,KAAKu/E,uBAAuBF,GAAW9kE,QAASlS,IAC9CurE,EAAatsE,KAAKe,EAAO,GAE3B4tE,EAAEtzE,KAAKixE,GACPqC,EAAE3sC,UAAQ,EACX,EAEP,CAEQi2C,uBAAuBh1E,GAC7B,GAAwB,IAApBA,EAASX,OACX,MAAO,GAET,MAAM41E,EAAKh5E,OAAO6H,OAAO,GAAI9D,EAAS,GAAGk1E,wBAClCD,EAAGj1E,EAAS,GAAGw0E,0BACfS,EAAGE,UACV,MAAM9L,EAAe,GACrB,UAAW31D,KAAYuhE,EACrB,GAAIA,EAAG7kE,eAAesD,GAAW,CAC/B,MAAM0hE,EACiC,iBAA9Bp1E,EAAS,GAAGrK,IAAI+d,QACnBjc,SACOuI,EAAS,GAAGrK,IAAI+d,GAC7B21D,EAAatsE,KAAK,CAChB0nB,KAAM/Q,EACNy/D,MAAOz/D,EACPza,KAAMm8E,EACNhkE,OAAQ,CAAC6jE,EAAGvhE,KAEhB,CAEF1T,SAAS0Z,MAAO5b,IACd,MAAMu3E,EAAoBv3E,EAAQo3E,gBAClC,UAAWl5E,KAAOq5E,EACZA,EAAkBjlE,eAAepU,IAAQA,KAAOi5E,GAClD5L,EACGlqE,OAAQy8B,GAAMA,EAAEnX,OAASzoB,GACzBgU,QAASlB,KACyC,IAA7CA,EAAEsC,OAAOjT,QAAQk3E,EAAkBr5E,KACrC8S,EAAEsC,OAAOrU,KAAKs4E,EAAkBr5E,GAAI,GAK9C,OAAO,IAEFqtE,CACT,4CA1NWyJ,GAAUj8E,MAAAuE,MAAA,iCAAV03E,EAAUh8E,QAAVg8E,EAAU/7E,UAAAC,WAFT,gBAED87E,CAAW,wICalB,MAAO7G,UAAsBe,IAwCxB13E,QACGs4E,WAtCZ,UAAIpxE,GACF,OAAO/G,KAAKH,QAAQkH,MACtB,CAEA,cAAI8sE,GACF,OAAQ7zE,KAAKH,QAAgBg0E,WACxB7zE,KAAKH,QAAgBg0E,WACtB,OACN,CAEA,YAAI6F,GACF,OAAQ15E,KAAKH,QAAgB65E,QAC/B,CAEA,mBAAIC,GACF,OAAQ35E,KAAKH,QAAgB85E,gBACxB35E,KAAKH,QAAgB85E,gBACtBC,KAAgBC,KACtB,CAEA,cAAIzB,CAAW1xE,GACZ1G,KAAKH,QAA2Cu4E,WAAa1xE,CAChE,CACA,cAAI0xE,GACF,OAAQp4E,KAAKH,QAA2Cu4E,UAC1D,CAEA,cAAIrI,CAAWrpE,GACZ1G,KAAKH,QAA4CkwE,WAAarpE,CACjE,CACA,cAAIqpE,GACF,OAAQ/vE,KAAKH,QAA4CkwE,UAC3D,CACS8P,YACP,IAAI99E,SAAgBC,GAEtBjC,YACSF,EACGs4E,GAEV/xE,MAAMvG,GAHCG,KAAAH,UACGG,KAAAm4E,aAGV,MAAM2H,EAAoBjgF,EAAQkH,OAE5Bg5E,EAAMD,EAAaE,KAAO,GAChCF,EAAaE,IAAMD,EACnBD,EAAaG,eAAiBF,EAC9BD,EAAaI,eAAiB,OAASH,EAEnClgF,EAAQsgF,oBAAsBtgF,EAAQsgF,mBAAqB,GAC7D/yC,YAAY,KACVptC,KAAK6D,SAAO,EACkB,IAA7BhE,EAAQsgF,oBAGb,IAAI7H,EAAoBE,KAGxB,GAAI34E,EAAQ04E,UAAW,CACrB,MAAM6H,KAAa/H,MAAex4E,EAAS,OAC3C0c,KAAYsjC,UAAUhgD,EAAQ04E,UAAW6H,EAAW7H,WAEpDD,EACEz4E,EAAQ04E,UAAUD,mBAAqBA,EAEzCz4E,EAAQwgF,SAAW75E,OAAO6H,OAAO,GAAIxO,EAAQwgF,SAAU,CACrDC,WAAYtgF,KAAKugF,qCAAqC1gF,IAE1D,CAEKA,EAAQ+zE,cAAgD,IAAhC/zE,EAAQ+zE,aAAahqE,OAGhD/J,EAAQ+zE,aAAar5D,QAASimE,IAC5BA,EAAY9C,MAAQ8C,EAAY9C,MAC5B8C,EAAY9C,MACZ8C,EAAYxxD,OALlBnvB,EAAQ+zE,aAAe,GASzB,MAAM6M,EAAkB5gF,EACrBu4E,WACGK,EAAkB,IAAIC,IAEvB+H,GAQHA,EAAeC,qBACbD,EAAe3H,aACf2H,EAAezH,YACfyH,EAAexH,cACfwH,EAAexzD,QACfwzD,EAAepgD,cAGbogD,EAAeC,oBAAsBD,EAAep9D,SACjCo9D,EAAep9D,QACnBs9D,mBACfF,EAAeC,oBAAqB,GAGpCD,EAAe3H,cACjB2H,EAAe3H,YAAYC,aAAe,cAExC0H,EAAezH,aACjByH,EAAezH,WAAWD,aAAe,YAEvC0H,EAAexH,eACjBwH,EAAexH,aAAaF,aAAe,eAEzC0H,EAAexzD,SACjBwzD,EAAexzD,OAAO8rD,aAAe,UAEnC0H,EAAepgD,eACjBogD,EAAepgD,aAAa04C,aAAe,iBAlC5Cl5E,EAA2Cu4E,WAC1CK,EAAgBE,+BACd8H,EACAnI,EACA,OAmCJwH,EAAarpB,OAAOntD,MAAM,KAAKM,OAAS,GACxC62E,GACAA,EAAe9vC,UAEfuyB,QAAQK,IAAI,mCACZL,QAAQK,IACN,iCACEuc,EAAarpB,OACb,gEAEJyM,QAAQK,IAAI,oCAIZ1jE,EAAQ04E,WACRkI,GACAA,EAAe9vC,SACf8vC,EAAetkB,WACdt8D,EAAQ+zE,cAAgB,IAAIlqE,OAAQkvE,IAAQA,EAAGj9D,QAAQ/R,OAAS,GAEjE5J,KAAKm4E,WAAWU,uBAAuBh5E,GAGzC,MAAM+gF,EAAoBnI,EAAgBoI,6BACxChhF,EACAy4E,GAEFwH,EAAagB,OAASF,EACtB5gF,KAAKqhD,GAAG0/B,aAAa,CAAED,OAAQhB,EAAagB,SAC5C9gF,KAAKk5E,cAAcuH,GAAgB,GAEnC,MAAMO,EACJnhF,EAEAmhF,GAAiC/Q,gBACjC+Q,GAAiCjR,YAEjC/vE,KAAKihF,cAAcD,EAAgCjR,YAAY,EAEnE,CAEAlsE,UACE7D,KAAKqhD,GAAG0/B,aAAa,CAAEG,WAAYh1D,KAAKi1D,UAC1C,CAEQZ,qCAAqCa,GAK3C,SAJ0BlD,MAAqBkD,GACTh/D,KACnC+jB,GAAiB,eAAXA,EAAEnX,MACTtoB,KAEJ,CAEUwwE,iBACR,OAAO,IAAImK,IAAiB76E,OAAO6H,OAAO,CAAEstE,MAAO,GAAK37E,KAAKH,SAC/D,CAEAq5E,cAAcd,EAA+BiB,GAAwB,GACnEr5E,KAAKo4E,WAAaA,EACdiB,GACFr5E,KAAKqhD,GAAGi4B,OAAO,aAAct5E,KAAKo4E,WAEtC,CAEA6I,cAAclR,EAA+BsJ,GAAwB,GACnEr5E,KAAK+vE,WAAaA,EACdsJ,IACFr5E,KAAK6/E,YAAYl9E,KAAK3C,KAAK+vE,YAC3B/vE,KAAKqhD,GAAGi4B,OAAO,aAAct5E,KAAKo4E,YAEtC,CAEAV,UAAUvhE,EAAgBhG,GACxB,IAAI2+D,EAAS1oE,MAAMsxE,YACnB,GAAI5I,EAAOllE,OAAS,QAAe5H,IAAVmU,IAAwBhG,GAAMmxE,MACrD,OAAOxS,EAGT,IACIyS,EADAC,GAAmB,EAIrBrxE,GAAMmP,MACNnP,GAAMqgE,QACNrgE,GAAM6xC,YACNhiD,KAAKH,QAAQ4hF,yBAEbF,EAC0B,UAAxBvhF,KAAK+G,OAAO2vD,cAA+C10D,IAAxBhC,KAAK+G,OAAO2vD,QAC3C,MACA,MACN8qB,GAAmB,GAGrB,MAAM1B,EAAe9/E,KAAK+G,OAE1B,IAAI+4C,EAAS,QACe99C,IAAxB89E,EAAarpB,SACf3W,EAASggC,EAAarpB,OAAOntD,MAAM,MAGrC,MAAMwzC,EAAU98C,KAAKH,QAAQ0C,IAAIm2B,QAAQ,MAAO,IAC1C3xB,EAAS,CACb,2BACA,cACA,mBACA,oBACA,WAAW+4E,EAAappB,SAAW,WAErC,YAAc10D,IAAVmU,GACFpP,EAAOO,KAAK,SAAS6O,UAEHnU,IAAhBmO,GAAMmxE,OACRv6E,EAAOO,KAAK,SAAS6I,EAAKmxE,SAExBE,IACFz6E,EAAOO,KAAK,SAAS6I,EAAKmP,KAAK,MAC/BvY,EAAOO,KAAK,UAAU6I,EAAKmP,KAAK,MAChCvY,EAAOO,KAAK,QAAQ6I,EAAKqgE,OAAO3mE,KAAK,QACrC9C,EAAOO,KAAK,GAAGi6E,KAAapxE,EAAK6xC,eAGnC8sB,EAAShvB,EAAOr/B,IAAKgiC,IACnB,MAAMi/B,GAAY5kC,EAAQ5hB,MAAM,MAAQ,IAAM,IAC9C,MAAO,CACL34B,IAAK,GAAGu6C,IAAU4kC,KAAY36E,EAAO8C,KAAK,cAAc44C,IACxD72C,MAAOk0C,EAAOl2C,OAAS,EAAI64C,OAAQzgD,EACnC2/E,kBAAwB3/E,IAAVmU,OAAsBnU,EAAamU,KAI9C24D,CACT,CAEOwI,YAAa,uQC3Rf,MAAMyG,EAAc,YACdF,EAAqB,IACrB+D,EAAoB,QACpBpJ,EAA2B,WAC3B4F,EAAW,IAAIp0E,OAAO,mBAW7B,SAAU63E,GACdhiF,EACA2wE,EACAjvB,EACA62B,EACA0J,GAEA,MAAMvJ,EAAY14E,EAAQ04E,UACpBwJ,EAAoB7D,EACxBr+E,OACAmC,EACAnC,EAAQ04E,UAAU4G,SAEpB,IAAI6C,EACA5J,GAAYznC,UACdqxC,EAAa5J,GAAY/0D,SAE3B,MAAMo1D,EAAkB,IAAIC,IACtBuJ,EAAcxJ,EAAgByJ,YAClCF,EACAxR,EACAjvB,EACA62B,GAAY+J,aACZtiF,GAEF,IAAIuiF,EAAe3J,EAAgBoI,6BACjChhF,EACAu4E,GAAY+J,aACZ3R,EACAjvB,GAGE4J,EAAS,SACRi3B,IACHj3B,EAAS,OACTi3B,EAAe5R,EAAO3mE,KAAK,KAAO,IAAM03C,EAAKE,WAG/C82B,EAAU8J,UAAYjK,GAAYsI,mBAC9BuB,EACA,GAAG92B,KAAUi3B,IACjB,IAAItlC,EAAUilC,EAAkB3/D,KAAM+jB,GAAiB,eAAXA,EAAEnX,MAAuBtoB,MAErEo2C,SADsB,qBACE5yC,KAAKquE,EAAU8J,WACnC,GAAGvlC,KAAWy7B,EAAU8J,YACxBvlC,EACJj9C,EAAQwgF,SAAW75E,OAAO6H,OAAO,GAAIxO,EAAQwgF,SAAU,CACrDC,WAAYxjC,IAEVglC,IACFhlC,GAAW,YAAW77C,MAAOC,aAExB47C,EAAQpkB,QAAQ,MAAO,IAChC,CAUM,SAAUwlD,EACdZ,EACAz7D,EACAygE,EACAjrD,EACApL,EAAqB,EACrBgyD,GAAoC,GAEpC,MAAMsE,EAAgB,QAChBhgF,EAAM+6E,EAAkBkF,OACxBjK,EAAY+E,EAAkB/E,UAC9BkK,EAAiB5gE,GAASg8D,EAC1B6E,EACJnK,EAAU3hB,UAAY2rB,EAAgB,cAAct2D,IAAe,GAC/D6xD,EAAWwE,GAAQvE,EACzB,IAAII,EAAe5F,EAAU4F,aACzB,gBAAgB5F,EAAU4F,eAC1B,GACAvnB,EAAU2hB,EAAU3hB,QACpB,WAAW2hB,EAAU3hB,UACrB,WAAWgrB,IAGf,MAAMe,GAAe,GADnBpK,EAAU3hB,UAAY2rB,EAAgB,YAAc,cACbhK,EAAUoK,eAC7CC,GACJrK,EAAU3hB,UAAY2rB,EAAgB,QAAU,cAClD,IAAIM,GAAMhhE,EACN,GAAG+gE,MAAoBH,IACvBlK,EAAU0G,YACR,GAAG2D,MAAoBrK,EAAU0G,cACjC,GAAG2D,MAAoBH,IACzBxE,IACFE,EAAe,GACfvnB,EAAU,gBACVisB,GAAMA,GAAInqD,QAAQ,QAAS,gBAG7B,MAAMoqD,GAAMR,EACR,WAAWxE,IACXvF,EAAU4G,QACR,WAAa5G,EAAU4G,QACvB,WAAWrB,IAEjB,IAAIE,GAAe,GACf+E,GAAiB,GACjB1rD,IACF2mD,GAAe,gBAAgB3mD,IAC/B0rD,GAAiB,kBAAkB1rD,KAErC,MAAMu8C,GAAe0J,EAAkB1J,aACvC,IAAKoK,IAAgBpK,IAAgBA,GAAahqE,OAAS,EAAG,CAC5D,MAAMo5E,GAAc,GACpB1F,EAAkB1J,aAAar5D,QAASkjE,KACtCuF,GAAY17E,KAAKm2E,GAAYzuD,KAAI,GAEnCgvD,GAAe,gBAAgBgF,GAAYn5E,KAAK,QAC9C0uE,EAAUD,mBAEd,CAEA,MAAMoJ,IAAiC,IAArBn/E,EAAImG,QAAQ,KAAc,IAAM,IAElD,IAAIu6E,GAAa,GAAG1gF,IAAMm/E,oCAA2C9qB,KAAW+rB,MAChFM,IAAc,GAAG9E,KAAgB2E,MAAOD,MAAO7E,MAAgB0E,IAE/D,IAAIQ,GAAmB,GAAG3gF,kDAAoDggF,KAAiBI,MAC/FO,WAAoB,IAAIL,MAAOE,KAExB,CACL,CAAE/zD,KAAM,eAAgBtoB,MAAOy3E,GAC/B,CAAEnvD,KAAM,UAAWtoB,MAAOkwD,GAC1B,CAAE5nC,KAAM,WAAYtoB,MAAOi8E,IAC3B,CAAE3zD,KAAM,QAAStoB,MAAOm8E,IACxB,CAAE7zD,KAAM,UAAWtoB,MAAOo8E,IAC1B,CAAE9zD,KAAM,eAAgBtoB,MAAOs3E,IAC/B,CAAEhvD,KAAM,iBAAkBtoB,MAAOq8E,IACjC,CAAE/zD,KAAM,kBAAmBtoB,MAfL,GAAGnE,IAAMm/E,yCAAgD9qB,IAe7Bl+B,QAAQ,MAAO,MACjE,CAAE1J,KAAM,aAActoB,MAAOu8E,GAAWvqD,QAAQ,MAAO,MACvD,CAAE1J,KAAM,mBAAoBtoB,MAAOw8E,GAAiBxqD,QAAQ,MAAO,MAEvE,CAUM,SAAU2/C,EAAe8K,EAAsBC,GAC/CA,GAAuB,QAAZA,IAEbD,EAAqB5K,UAAY4K,EAAqBp8E,QAGxD,MAAMwxE,EAAY4K,EAAqB5K,UASvC,IAAI4F,EACJ,OATAgF,EAAqBX,OACnBW,EAAqBX,QAAUW,EAAqB5gF,IAEtDg2E,EAAU3hB,QAAU2hB,EAAU3hB,SAAWgrB,EACzCrJ,EAAUD,kBACRC,EAAUD,mBAAqBE,EACjCD,EAAU0G,YAAc1G,EAAU0G,aAAepB,EAG7CtF,EAAU4F,eACZA,EAAe5F,EAAU4F,eAGvBC,EAASl0E,KAAKi0E,KAAkBA,KAClC5F,EAAU3hB,QAAU,SAEfpwD,OAAO6H,OAAO,GAAI80E,EAC3B,CAEM,SAAUhK,EACdt5E,GAEA,MAAMwjF,EAAaxjF,EAEnB,IAAIg4E,EACJ,MAAMsG,EAAekF,EAAW9K,UAAU4F,aACtCkF,EAAW9K,UAAU4F,kBACrBn8E,EAEJ,OAAKm8E,EAKDmF,EAASnF,IACXtG,EAAcyL,EAASnF,GAChB,IAAItG,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,SAC1C28C,EAAcyL,IACP,IAAIzL,EAAY,IAClBwL,EAAWrL,cACTuL,UAAWC,OAETrF,EAAahmD,cAAc+C,MAAM,UAC1C28C,EAAcyL,IACP,IAAIzL,EAAY,IAClBwL,EAAWrL,cACTuL,UAAWE,OAETtF,EAAahmD,cAAc+C,MAAM,SAC1C28C,EAAcyL,IACP,IAAIzL,EAAY,IAClBwL,EAAWrL,cACTuL,UAAWG,OAETvF,EAAahmD,cAAc+C,MAAM,aAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,YAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,aAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,SAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,QAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,QAC1C28C,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,WAC1C28C,EAAc8L,IACP,IAAI9L,EAAYwL,EAAWrL,gBACzBmG,EAAahmD,cAAc+C,MAAM,QAC1C28C,EAAcyL,KACP,IAAIzL,EAAYwL,EAAWrL,gBAG7B,IAAIH,GAnDTA,EAAcyL,IACP,IAAIzL,EAAYwL,EAAWrL,eAmDtC,yFCvQM,SAAUwB,EAAsB8I,GAEpC,MAAMsB,EADoBnT,KAAP6R,GAAqC,aACpBuB,YAC9BvkE,KAAOwkE,MAAeF,GAAoB,IAC1CG,EAAc,IAAIxoE,MAAM,IACxByoE,EAAY,IAAIzoE,MAAM,IAC5B,QAAS0oE,EAAI,EAAGA,EAAI,KAAMA,EACxBF,EAAYE,GAAK3kE,EAAO4M,KAAKq7B,IAAI,EAAG08B,GACpCD,EAAUC,GAAKA,EAGjB,OAAO,IAAIC,IAAe,CACxB7vB,UAAQ8vB,MAAiBP,GACzBG,cACAC,aAEJ,6QCZE5iF,MAAA,mCAUEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA84E,aAAY,GAErBhjF,MAAA,cAAUA,MAAA,kBACZA,eALEA,MAAA,aAAAA,MAAA,0FAMFA,MAAA,mCAKEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+4E,YAAW,GAIpBjjF,MAAA,cAAUA,MAAA,aACZA,eAJEA,MAAA,aAAAA,MAAA,iFAKFA,MAAA,mCAKEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,QAAA,OAAAA,MAASkK,EAAAg5E,4BAA2B,GAIpCljF,MAAA,cAAUA,MAAA,kBACZA,eAJEA,MAAA,aAAAA,MAAA,6EAKFA,MAAA,mCAKEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAAjhD,EAAAlK,QAAA,OAAAA,MAASkK,EAAAi5E,sBAAqB,GAI9BnjF,MAAA,cAAUA,MAAA,UACZA,eAJEA,MAAA,aAAAA,MAAA,4EAMFA,MAAA,oDAKEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAASkK,EAAAk5E,kBAAiB,GAK1BpjF,MAAA,cAAUA,MAAA,WACZA,kCAJEA,MADA,WAAAA,MAAA,IAAAkK,EAAAE,WACApK,CAD8B,aAAAA,MAAA,sCCtB3B,IAAMqjF,EAA0B,MAAjC,MAAOA,EAeD9iF,gBACAC,eACYy6C,MACZqoC,kBAjBV,eAAIC,GACF,OAAO3kF,KAAK4kF,mBACT3iE,MACAG,KAAMi6B,GAAUA,EAAMhlB,WAAW1P,OACtC,CACSk9D,WACAC,mBAAoC,IAAI9pC,IACxC+pC,WACAH,mBACAI,iBAEFx5E,UAAY,IAAIzJ,KAAgB,GAEvChC,YACU4B,EACAC,EACYy6C,EACZqoC,GAHA1kF,KAAA2B,kBACA3B,KAAA4B,iBACY5B,KAAAq8C,QACZr8C,KAAA0kF,mBACP,CAEHN,aACEpkF,KAAK+kF,WAAWE,YAClB,CAGAC,WACEC,QAAenlF,KAAK+kF,WACtB,CAEAR,sBACqB74B,KAAUC,KAAK3rD,KAAKolF,WAErCplF,KAAK4B,eAAe6oD,QAClB,4CACA,0CAGN,CAEA45B,YACErkF,KAAK8kF,mBAAmBniF,MAC1B,CAEA2hF,4BACE,MAAMe,EAAiBrlF,KAAKslF,mBACT55B,KAAUC,KAAK05B,IAEhCrlF,KAAK4B,eAAe6oD,QAClB,wCACA,0CAGN,CAEQ66B,mBACN,MAAMC,EAAS,KACf,IAAIC,EACFxlF,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCACE,MACF44C,EAAe,GACnB,MAAMC,EACJ1lF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,kCACvC,OACA04C,EACAvlF,KAAK2kF,YAAYttD,WAAW/S,UAAU1Y,MACtC,KACA25E,KACAI,MAAe3lF,KAAK2kF,YAAYttD,WAAW/S,UAAU82C,UACrD,KACAmqB,KACAK,MAAe5lF,KAAK2kF,YAAYttD,WAAW/S,UAAUuhE,UACrD,OACA7lF,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,oCAEF,MAEItqC,EACJvC,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,+BACvC,MACA04C,EACAvlF,KAAKolF,SAEP,IAAIU,EAAe,EACnB9lF,KAAK+kF,WAAW50E,KAAK8R,MAAM1H,QAASwrE,IAClC,IAAIxV,EAAQ,GACRyV,EAAW,GACXD,EAAKn5C,UAASq5C,MAAaF,EAAKG,aAAar8E,KAAK,MACpDm8E,EAAWD,EAAKn5C,KAChB2jC,EAAQ,SAAM0V,MAAaF,EAAKG,aAAar8E,KAAK,UAElDm8E,KAAWC,MAAaF,EAAKG,aAAar8E,KAAK,KAGjD47E,EACEA,EACAF,EACAO,EAAaK,iBACb,KACAH,EACAzV,EACA,KACFuV,MAGF,IAAIM,EAAW,EACf,OAAApmF,KAAK2kF,YAAYttD,WAAW/S,UAAUypB,MAAMxzB,QAASwW,IACnD,MAAMs1D,EAAcrmF,KAAKsmF,WAAWv1D,EAAMq1D,GAAUC,YAC9CjrB,OAC8Bp5D,KAD9Bo5D,EACJuqB,MAAe50D,EAAKqqC,UAChB,GACA,QAAOuqB,MAAe50D,EAAKqqC,UAAY,IAC7CoqB,EACEA,EACAD,GACCa,EAAW,GAAGD,iBACf,KACAE,EACAjrB,EACA,KACFgrB,MAIAV,EAAUD,EAAe,KAAOljF,EAAM,OAASijF,CAGnD,CAEAc,WAAWv1D,EAAM8xD,GACf,SAAO0D,MACLx1D,EAAKy1D,SAAShjF,KACdutB,EAAKy1D,SAASC,SACd11D,EAAK/B,KACL+B,EAAKy1D,SAASE,cACd7D,EACA9xD,EAAKy1D,SAASG,KACd3mF,KAAK2B,gBACLkhF,IAAQ7iF,KAAK2kF,YAAYttD,WAAW/S,UAAUypB,MAAMnkC,OAAS,EAEjE,CAEQw7E,SACN,IAAKplF,KAAKq8C,MACR,OAEF,IAAIyB,EAAU,GACV99C,KAAK6kF,aACP/mC,EAAU,WAAW99C,KAAK6kF,eAG5B,MAAM+B,EAAM5mF,KAAK4kF,mBACd3iE,MACAxB,IAAK6D,GAAoCA,EAAU+S,WAAWnlB,IAC9DxJ,QAAQ1I,KAAK2kF,YAAYttD,WAAWnlB,IACvC,IAAI20E,EAAiB,GACT,IAARD,IAEFC,EAAiB,IADS7mF,KAAKq8C,MAAMx8C,QAAQgsE,+BACI+a,KAEnD,MAAME,EAAgB9mF,KAAKq8C,MAAMx8C,QAAQ+rE,mBACnCmb,EAAmB/mF,KAAK+kF,WAAW50E,KACtC8R,MACAxB,IAAKslE,MAASE,MAAaF,EAAKG,YAAa,IAChD,IAAIc,EAAgB,GACpB,OAAID,EAAiBn9E,QAAU,GAC7Bo9E,EAAgB,GAAGF,KAAiBC,EAAiBl9E,KAAK,OACnD,GAAGrC,SAAS6sD,SAAS7sD,SAAS8sD,YAAYxW,8BAAoCkpC,IAAgBH,UAFvG,CAKF,CAEArC,kBACExkF,KAAKglF,iBAAiBl+E,QACtB9G,KAAKwL,UAAU7I,MAAK,GACpB3C,KAAK0kF,kBACFuC,kBACCjnF,KAAK4kF,mBAAmBnkE,IACxBzgB,KAAK2kF,YAAYttD,WAAW/S,WAE7BzhB,UAAU,KACT7C,KAAKwL,UAAU7I,MAAK,EAAK,EAE/B,4CAzLW8hF,GAA0BrjF,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,KAAA,GAAAzE,MAAA0E,MAAA,+BAA1B2+E,EAA0Bn2E,UAAA,6BAAAC,OAAA,CAAAs2E,WAAA,aAAAC,mBAAA,qBAAAC,WAAA,aAAAH,mBAAA,qBAAAI,iBAAA,oBAAAv2E,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,mxBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID1CrC1N,MADF,UACEA,CADiC,mCAO/BA,MAAA,0BAAS2N,EAAAm2E,SAAS,GAElB9jF,MAAA,cAAUA,MAAA,sBACZA,UACAA,MAAA,EAAA8lF,EAAA,kDAcA9lF,MAAA,EAAA+lF,EAAA,iCAWA/lF,MAAA,GAAAgmF,EAAA,kCAWAhmF,MAAA,GAAAimF,GAAA,kCAYAjmF,MAAA,GAAAkmF,EAAA,kCAYFlmF,eAlEIA,cAAA,aAAAA,MAAA,uCAUCA,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,EAAA61E,mBAAAhjE,SAAA,GAAAxgB,MAAA,KAAA2N,EAAAg2E,WAAAnjE,SAAA,GAcAxgB,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAA61E,mBAAAhjE,SAAA,GAWAxgB,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAA61E,mBAAAhjE,SAAA,GAWAxgB,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAA61E,mBAAAhjE,SAAA,GAYAxgB,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAA61E,mBAAAhjE,SAAA,mBC5BDrS,KAAexJ,KACfsJ,KAAgBrJ,KAChBwJ,KAAamF,KACbxF,KACAO,KACAC,KAAiBkF,eAGR4vE,CAA0B,8TCZ/BrjF,MAAA,oCAYEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAi3E,EAAAnmF,QAAAmP,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA8lD,UAAAD,GAAe,GAExBnmF,MAAA,cAAUA,MAAA,WACZA,eANEA,MAAA,aAAAA,MAAA,kEAkBEA,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MAFA,QAAAqmF,EAEArmF,CAFgB,aAAAqmF,EAAAppE,KAAAopE,EAAAppE,KAAAzS,MAAA,IAIhBxK,cAAA,IAAAqmF,EAAAppE,KAAAopE,EAAAppE,KAAAzS,MAAA,kCAXJxK,MAAA,qBAKEA,MAAA,EAAAsmF,EAAA,qBAQFtmF,kCAVEA,MADA,QAAAumF,EAAAlkE,OAAA7X,MACAxK,CAD6B,gBAAAumF,EAAAlkE,OAAAktB,SAIRvvC,cAAA,UAAAumF,EAAAvI,kDA4B3Bh+E,MAAA,oCAOEA,MAAA,mBAAAA,MAAA8P,GAAA,MAAAq2E,EAAAnmF,MAAA,GAAAmP,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAkmD,WAAAL,GAAgB,GAEzBnmF,MAAA,cAAUA,MAAA,YACZA,eALEA,MAAA,aAAAA,MAAA,mEAjBFA,MAJF,WAIEA,CADD,oCAUGA,MAAA,cAAUA,MAAA,oBACZA,UAEAA,MAAA,EAAAymF,EAAA,kCAWFzmF,+BAjBIA,cAAA,aAAAA,MAAA,wCAOCA,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAAsgC,EAAAqjD,WAAAnjE,QAAA,4CAvFPxgB,MAAA,WAOEA,MALA,8BAAAmmF,EAAAnmF,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAAcsgC,EAAAomD,YAAAP,GAAiB,EAK/BnmF,CALgC,wBAAAA,MAAAyK,GAAA,MAAA61B,EAAAtgC,QAAA,OAAAA,MAClBsgC,EAAAqmD,cAAa,EAI3B3mF,CAJ4B,6BAAAmmF,EAAAnmF,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MACfsgC,EAAAomD,YAAAP,GAAiB,EAG9BnmF,CAH+B,wBAAAA,MAAAyK,GAAA,MAAA61B,EAAAtgC,QAAA,OAAAA,MACjBsgC,EAAAqmD,cAAa,EAE3B3mF,CAF4B,4BAAAA,MAAAyK,GAAA,MAAA61B,EAAAtgC,QAAA,OAAAA,MAAAsgC,EAAAsmD,eACM,EAAI,EACtC5mF,CADuC,0BAAAA,MAAAyK,GAAA,MAAA61B,EAAAtgC,QAAA,OAAAA,MAAAsgC,EAAAsmD,eACP,EAAK,GAQjC5mF,MAFJ,UAEIA,CAF8B,qBAE9BA,CADwC,eAC7BA,MAAA,GAA0BA,QACrCA,MAAA,aAQEA,MAAA,yBAAAmmF,EAAAnmF,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAumD,aAAAV,GAAkB,GAC3BnmF,MAAA,yBAAAqW,GAAA,MAAA8vE,EAAAnmF,MAAAyK,GAAA0E,UAAAnP,aAAAmmF,EAAA36C,KAAAn1B,KAAA8vE,EAAA36C,KAAAn1B,GAAArW,MAAAqW,EAAA,GAEArW,MADA,iBAAAqW,GAAA,MAAA8vE,EAAAnmF,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAwmD,YAAAzwE,EAAA8vE,GAAyB,EAClCnmF,CADmC,yBAAAqW,GAAArW,aAAAyK,GAAAzK,MAClBqW,EAAA4W,iBAAuB,GAX1CjtB,QAcAA,MAAA,EAAA+mF,EAAA,gBAiBA/mF,MAAA,0BAGEA,MAAA,0BAAAqW,GAAA,MAAA8vE,EAAAnmF,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAAkBsgC,EAAA0mD,eAAA3wE,EAAA8vE,GAA4B,GAE9CnmF,MAAA,EAAAinF,EAAA,sBAgBNjnF,YAEAA,MAAA,GAAAknF,EAAA,cA4BFlnF,yDArFOA,cAAA,UAAAsgC,EAAA6mD,WAAAhB,IAEUnmF,MAAA,GAAAA,MAAAsgC,EAAA8mD,eAAAjB,IAETnmF,cAAA,KAAAmmF,EAAAr1E,IAIA9Q,MAFA,cAAAsgC,EAAA8mD,eAAAjB,GAEAnmF,CAFoC,aAAAmmF,EAAA36C,MAMpCxrC,MAAA,UAAAmmF,EAAA36C,MAGAxrC,MAAA,kBAAAqnF,GAGCrnF,cAAA,QAAAmmF,EAAA36C,MAAA26C,EAAArB,cAAAxkD,EAAAgnD,eAAAnB,EAAAr1E,KAAAwvB,EAAAgnD,cAAAx2E,IAiBD9Q,cAAA,cAAAsgC,EAAAinD,eAKqBvnF,MAAA,GAAAA,MAAA,UAAAmmF,EAAAqB,iBAkBxBxnF,cAAA,QAAAsgC,EAAAsmD,eAAAtmD,EAAAgnD,eAAAnB,EAAAr1E,KAAAwvB,EAAAgnD,cAAAx2E,KCFA,IAAM22E,EAAyB,MAAhC,MAAOA,EAeSlnF,gBAdHmnF,YAAc,CAAC,UAAW,QAAS,OAC5CC,oBAAsB,GACvBL,cACAV,eAAyB,EACvBjD,WACAiE,kBACAhnC,WACAinC,qBAA+B,EAE/Br4B,SAAmB,IACnBhnD,OAAiB,EAEhBs/E,kBACR,IAAI57E,OAAsB,GAC5BvN,YAAoB4B,GAAA3B,KAAA2B,iBAAmC,CAEvDuM,cACElO,KAAKmpF,wBACP,CACArB,YAAY/B,GACV/lF,KAAK0oF,cAAgB3C,CACvB,CACAgC,cACE/nF,KAAK0oF,mBAAgB1mF,CACvB,CAEA2mF,cAAcnxD,GACZ,OAAIA,aAAkBhxB,OACbgxB,GAAQnZ,KAAOmZ,EAAOnZ,KAAKzS,MAAQ,GAErC4rB,CACT,CAEA4wD,eACE1+D,EACAq8D,GAEA,MAAM18C,EAAkB3f,EAAM8N,OAAO9wB,MACrC,GAAI2iC,EAAQ,CACV,IAAI+/C,EACJ,MAAMC,EAAOhgD,EAAOigD,SACpB,GAAkB,UAAdD,EAAK7lF,KACP4lF,EAAYC,EAAKnD,gBACZ,CACL,MAAMqD,KAAQC,KAAengD,EAAOigD,UACpCF,EAAY,CACVG,EAAMD,SAASpD,YAAY,GAC3BqD,EAAMD,SAASpD,YAAY,GAE/B,CACIkD,IACFrD,EAAKG,YAAckD,EACnBrD,EAAKn5C,KAAOvD,EAAOhrB,KAAKzS,MACxB5L,KAAK+kF,WAAWplE,OAAOomE,GAE3B,CACF,CAEAmC,YAAYx+D,EAAsBq8D,GAChC/lF,KAAKmpF,yBACL,MAAMj7B,EAAQxkC,EAAM9S,OAA4BlQ,MAC5B,IAAhBwnD,EAAKtkD,OACP5J,KAAKwnF,UAAUzB,GACN/lF,KAAKypF,aAAav7B,KAC3B63B,EAAKn5C,KAAOshB,EACZluD,KAAK+kF,WAAWplE,OAAOomE,GAE3B,CAEA0D,aAAav7B,GACX,SACEluD,KAAK0pF,WAAWx7B,MACfA,EAAKtkD,QAAU5J,KAAK4J,QAA0B,IAAhBskD,EAAKtkD,QAKxC,CAEQ8/E,WAAWnjF,GACjB,YAA2DvE,IAApDhC,KAAK8oF,YAAY1mE,KAAM1b,GAAUA,IAAUH,EACpD,CAEAgiF,WAAWxC,GACT,OAAK/lF,KAAK0oF,eAEC3C,EAAK7zE,KAAOlS,KAAK0oF,cAAcx2E,GACjC,6BAFA,qBAMX,CAEAs2E,eAAezC,GACb,IAAI4D,EAAQ,GACZ,OAAI5D,EAAK6D,kBAEL7D,EAAK6D,mBAAqBC,KAA8BC,eAExDH,EAAQ,KAAO5D,EAAK12C,UAGpBrvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,0BAA4Bk5C,EAAK6D,kBAC/BD,GAGC,EAEX,CAEA/B,WAAW7B,IACTgE,QAAoB/pF,KAAK+kF,WAAYgB,EACvC,CAEAyB,UAAUzB,GACR/lF,KAAK+kF,WAAWplE,OAAO,CACrBzN,GAAI6zE,EAAK7zE,GACT03E,iBAAkB7D,EAAK6D,iBACvBv6C,SAAU02C,EAAK12C,UAEnB,CAEA26C,KAAKtgE,GACH1pB,KAAKiqF,UAAUvgE,EAAMwgE,cAAexgE,EAAMygE,aAC5C,CAEQF,UAAUG,EAAWC,GAC3B,GAAID,IAAcC,EAAS,CACzB,MAAMC,EAAQ,IAAItqF,KAAK+kF,WAAW50E,KAAK8R,QACvCsoE,QAAgBD,EAAOF,EAAWC,GAClCC,EAAM7pE,IAAI,CAACslE,EAAM32C,KACf22C,EAAK6D,oBAAmBY,MAAwBp7C,EAAGk7C,EAAM1gF,QACzDm8E,EAAK12C,SAAWD,IAElBpvC,KAAK+kF,WAAWllE,WAAWyqE,IAAK,EAChCG,MAAmBzqF,KAAK+kF,WAC1B,CACF,CAEAkD,aAAalC,KACNA,EAAKn5C,MAA8B,IAAtBm5C,EAAKn5C,MAAMhjC,UAC3B5J,KAAKmpF,yBACLnpF,KAAKkpF,kBAAkB96E,MAAK,GAC5BpO,KAAK0qF,qBAAqB3E,GAE9B,CAEQ2E,qBAAqB3E,GAC3B,MAAMx/E,EAAMvG,KAAKgpF,kBAAkBvmC,MAAMhiC,IAAI4gC,GAAGspC,KAC9C,cACCjhE,IACC,MAAMkhE,EAAmBC,KACvBnhE,EAAMohE,WACN9qF,KAAKgpF,kBAAkBvmC,MAAMhiC,IAAIuhC,WACjChiD,KAAKgiD,YAED+oC,KAAe9E,MACnB2E,EACA5qF,KAAKipF,sBAEPlD,EAAKn5C,KAAOm+C,EAAalhF,KAAK,KAC9Bk8E,EAAKG,YAAc6E,EACnB/qF,KAAK+kF,WAAWplE,OAAOomE,GACvBpnD,WAAW,KACT3+B,KAAKkpF,kBAAkB96E,MAAK,EAAK,EAChC,IAAG,GAGVpO,KAAK+oF,oBAAoBzhF,KAAKf,EAChC,CAEQ4iF,yBACNnpF,KAAK+oF,oBAAoBtoE,IAAKla,IAC5BykF,IAAqBzkF,EAAG,GAE1BvG,KAAK+oF,oBAAsB,EAC7B,4CAlLWF,GAAyBznF,MAAAuE,MAAA,+BAAzBkjF,EAAyBv6E,UAAA,4BAAAC,OAAA,CAAAw2E,WAAA,aAAAiE,kBAAA,oBAAAhnC,WAAA,aAAAinC,qBAAA,uBAAAr4B,SAAA,WAAAhnD,OAAA,UAAA4E,QAAA,CAAA06E,kBAAA,qBAAAz6E,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,2jDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDtEtC1N,MAAA,WAAoCA,MAAA,8BAAAqW,GAAA,OAAsB1I,EAAAi7E,KAAAvyE,EAAY,GACpErW,MAAA,EAAA6pF,EAAA,gCAmGF7pF,eAzFqBA,cAAA,UAAAA,MAAA,IAAA2N,EAAAg2E,WAAA50E,KAAAO,yBCyCjBw6E,KACAz2E,KACA02E,KACA77E,KACA2a,KAAkBrkB,eAClBi3B,KAAch3B,KACd42B,KAAW32B,eACX62B,KAAqB52B,KAAAC,UAAAD,KACrBsJ,KAAgBsF,KAChBxF,KACAI,KAAesF,KACfrF,KAAasF,KACbqV,KACAihE,KACA17E,KACAC,KAAiBmtB,OAAAjtB,OAAA,6zCAGRg5E,CAAyB,8SC5DhCznF,MAAA,kBAIEA,MAAA,GAGFA,uDALEA,MAAA,QAAAiqF,GAEAjqF,cAAA,WAAAkqF,EAAA,QAAA5pD,EAAAikD,eAAA0F,EAAAjwB,UAAA,KAAA15B,EAAAkkD,eAAAyF,EAAAxF,UAAA,+CAZJzkF,MADF,mBACEA,CAD0D,eAC/CA,MAAA,wBAETA,QACFA,MAAA,uCAEEA,MAAA,6BAAAA,MAAAqgC,GAAA,MAAAC,EAAAtgC,MAAA,UAAAA,MAAmBsgC,EAAA6pD,cAAa,GAChCnqF,MAAA,yBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,MAAA,GAAAA,aAAAsgC,EAAA8pD,gBAAA/zE,KAAAiqB,EAAA8pD,gBAAA/zE,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAAqqF,EAAA,oBASJrqF,mCAjBaA,MAAA,GAAAA,YAAA,8CAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,8CAEAA,MAAA,UAAAsgC,EAAA8pD,iBAGwBpqF,MAAA,GAAAA,MAAA,UAAAsgC,EAAAgqD,kCAU5BtqF,MAAA,yDAQEA,MAAA,sBAGEA,MADA,8BAAAuqF,EAAAvqF,MAAA2P,GAAAR,UAAAmxB,EAAAtgC,MAAA,UAAAA,MAAcsgC,EAAAkqD,YAAAD,GAAiB,EAC/BvqF,CADgC,yBAAAuqF,EAAAvqF,MAAA2P,GAAAR,UAAAmxB,EAAAtgC,MAAA,UAAAA,MACvBsgC,EAAAkqD,YAAAD,GAAkB,GAAK,GAIhCvqF,MAAA,iBACGA,MAAA,GACHA,QAEAA,MAAA,aACEA,MAAA,GACFA,QACAA,MAAA,aACEA,MAAA,GAEJA,2DAVYA,cAAA,UAAAsgC,EAAA4kD,WAAAqF,EAAAE,GAAAC,UACP1qF,cAAA,GAAAsgC,EAAA4kD,WAAAqF,EAAAE,GAAAE,MAAA,KAID3qF,MAAA,GAAAA,MAAA,IAAAyqF,EAAA,OAAAnqD,EAAA4kD,WAAAqF,EAAAE,GAAAxF,YAAA,KAGAjlF,MAAA,GAAAA,MAAA,IAAAsgC,EAAAikD,eAAAgG,EAAAvwB,UAAA,8CA5CRh6D,MAAA,WAqBEA,MApBA,EAAA4qF,EAAA,uBAoBA5qF,CApB4D,EAAA6qF,EAAA,qBAsB5D7qF,MAAA,gBAAUA,MAAA,wBAAAA,MAAAyK,GAAA,MAAA61B,EAAAtgC,QAAA,OAAAA,MAAcsgC,EAAAwqD,kBAAiB,GACvC9qF,MAAA,UAAuCA,MAAA,GAA2BA,QAClEA,MAAA,YACEA,MAAA,GAEFA,QACAA,MAAA,EAAA+qF,EAAA,uBAmBA/qF,MAAA,iBAEJA,kCAjDmBA,cAAA,OAAAsgC,EAAAgqD,YAAAhqD,EAAAgqD,WAAA9hF,OAAA,GAoBHxI,cAAA,OAAAsgC,EAAAgqD,YAAA,IAAAhqD,EAAAgqD,WAAA9hF,QAG2BxI,MAAA,GAAAA,MAAAsgC,EAAA8pD,gBAAA5/E,OAErCxK,MAAA,GAAAA,MAAA,IAAAsgC,EAAAikD,eAAAjkD,EAAA8pD,gBAAApwB,UAAA,KAAA15B,EAAAkkD,eAAAlkD,EAAA8pD,gBAAA3F,UAAA,KAOiBzkF,cAAA,UAAAsgC,EAAA8pD,gBAAAz9C,QC2BhB,IAAMq+C,EAA0B,MAAjC,MAAOA,EAUDzqF,gBACAoQ,MAVHy5E,gBACAE,WAEC9kE,WAECg+D,mBACAI,iBAETjlF,YACU4B,EACAoQ,GADA/R,KAAA2B,kBACA3B,KAAA+R,OACP,CAEHxE,WACEvN,KAAK4mB,WAAa5mB,KAAK4kF,mBAAmBngE,UACvC1gB,QAAKof,KAAa,MAClBtgB,UAAW2c,IACV,MAAM6sE,EAA6B7sE,EAAS4C,KACzCpE,GAAWA,EAAOqZ,WAAW1P,QAEhC3nB,KAAK0rF,WAAalsE,EAASiB,IAAKzC,GAAWA,EAAOqZ,WAAW/S,WAE3DtkB,KAAKwrF,gBADHa,EAEAA,EAA2Bh1D,WAAW/S,eAEjBtiB,EAEzBhC,KAAK+R,MAAM4K,eAAa,EAE9B,CAEAzO,cACElO,KAAK4mB,WAAWzY,aAClB,CAEAo9E,cACEvrF,KAAK4kF,mBAAmBngE,UAAU/d,MAAM+Z,IACrCzC,GAAYA,EAAOqZ,WAAW1P,QAAU3J,EAAOqZ,WAAW1P,QAE7D3nB,KAAK4kF,mBAAmBniC,MAAMpB,GAC3BsC,YACAQ,cACA1jC,IAAK3V,GAAYA,EAAQzK,IAAI,UAAWyK,EAAQ5K,IAAI,WACzD,CAEAylF,eAAevqB,GACb,SAAOuqB,MAAevqB,EACxB,CAEAwqB,eAAeC,GACb,SAAOD,MAAeC,EACxB,CAEAS,WAAWv1D,EAAM8xD,GACf,SAAO0D,MACLx1D,EAAKy1D,SAAShjF,KACdutB,EAAKy1D,SAASC,SACd11D,EAAK/B,KACL+B,EAAKy1D,SAASE,cACd7D,EACA9xD,EAAKy1D,SAASG,KACd3mF,KAAK2B,gBACLkhF,IAAQ7iF,KAAKwrF,gBAAgBz9C,MAAMnkC,OAAS,EAEhD,CAEAsiF,kBACElsF,KAAKglF,iBAAiBl+E,OACxB,CAEA8kF,YAAY76D,EAAeu7D,GAAe,GACxCtsF,KAAKusF,yBAAyBx7D,EAAMu7D,EACtC,CAEAC,yBAAyBx7D,EAAeu7D,GAAe,GACrD,MACME,EAAW,SASXC,EARe,IAAIC,IAFL37D,EAAKu4D,SAASpD,aAGS9sE,UACzC,YACApZ,KAAKglF,iBAAiBviC,MAAMhiC,IAAIuhC,YAIhCH,iBACwC,GAEpCynC,EAAW,IAAIoD,IAAaD,GAC5B3hF,EAAU,IAAI6hF,IAAU,CAAErD,aAE1BsD,IAAc,IAAIC,KAAYC,oBAAoBxD,EAAU,CAChE5kC,kBAAmB1kD,KAAKglF,iBAAiBviC,MAAMhiC,IAAIuhC,WACnDyC,eAAgBzkD,KAAKglF,iBAAiBviC,MAAMhiC,IAAIuhC,aAG5C+qC,GAAiB/sF,KAAKglF,iBAAiB9kF,IAAIssF,GAoBjDxsF,KAAKglF,iBAAiBrlE,OAfe,CACnCnc,KAAMwpF,IACN1D,SAAUsD,GACV5qC,WAAYhiD,KAAKglF,iBAAiBviC,MAAMhiC,IAAIuhC,WAC5C3qB,WAAY,CACVnlB,GAAIs6E,EACJz7D,OACAvtB,KAAMypF,KAAcC,QAEtB7uE,KAAM,CACJnM,GAAIs6E,EACJztE,UAf2BguE,GAC3BA,GAAe1uE,KAAKU,SACpB,GAamC,GAErCsiC,GAAIv2C,IAGFwhF,GACFtsF,KAAKglF,iBAAiBviC,MAAMhiC,IAAIyhC,eAAeoqC,aAC7CxhF,EAAQqiF,cAActJ,YAG5B,4CA1HWuI,GAA0BhrF,MAAAuE,MAAAvE,aAAA,+BAA1BgrF,EAA0B99E,UAAA,6BAAAC,OAAA,CAAAq2E,mBAAA,qBAAAI,iBAAA,oBAAAv2E,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,2dAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD5DvC1N,MAAA,EAAAgsF,EAAA,mBAAkChsF,MAAA,OAAA2N,EAAA28E,YAAA38E,EAAAy8E,gCC+C9Br8E,KACA8a,KAAkBrkB,UAClBskB,KAAerkB,KAAAC,KACf22B,KAAW12B,UACX0O,KACA0V,KACA+gC,IAAgBllD,IAChBoJ,KAAauF,oBACbnF,KAAaqF,KACbvF,KACAK,KAAiBmF,OAAAjF,OAAA,k2BAGRu8E,CAA0B,sDCtDjC,MAAgBiB,4ZCEpBjsF,MAAA,wBAIEA,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAgiF,2BAAA71E,EAAAoW,SAA0C,GAEpDzsB,MAAA,wBACFA,gCAJEA,MADA,UAAAkK,EAAAiiF,+BACAnsF,CAD0C,0BAI1CA,cAAA,IAAAA,MAAA,+CC6DG,IAAMosF,EAAmB,MAA1B,MAAOA,EAoDDz7E,MACAtQ,KACAE,gBACA+iF,kBACA+I,wBACAC,cACAC,aACA/rF,eA1DFuQ,QAED6vC,WAAqB,YACrB4rC,sBAAgC,EAChCC,qBAA+B,EAE9BC,YACAC,aACAC,cACAC,gBAAkC,GAElCC,sBACAC,cACAC,cACAC,aAAuB,EACvBC,eAAyB,EAE1BC,cAAwB,GAEvBC,UAA4B,GAC5BC,gBAEC5J,WACAE,WACAiE,kBACApE,mBACAI,iBACAp0B,SAAmB,IACnBhnD,OAAiB,EACjBq/E,qBAA+B,EAC/BnE,mBAAoC,IAAI9pC,IACxC0zC,eAMT,4BAAIC,GACF,OAAQ3uF,KAAK2tF,aAAaiB,YAC5B,CAEA,gBAAIC,GACF,MAAO,CAAC7uF,KAAKkuF,sBAAuBluF,KAAKmuF,cAAenuF,KAAKouF,cAC/D,CAEA,kCAAIb,GACF,OAAOvtF,KAAKytF,wBAAwBqB,QAAQ,GAAGC,oBAC5CC,aACL,CAEAjvF,YACUgS,EACAtQ,EACAE,EACA+iF,EACA+I,EACAC,GACAC,GACA/rF,IAPA5B,KAAA+R,QACA/R,KAAAyB,OACAzB,KAAA2B,kBACA3B,KAAA0kF,oBACA1kF,KAAAytF,0BACAztF,KAAA0tF,iBACA1tF,KAAA2tF,gBACA3tF,KAAA4B,iBACP,CAEH2L,WACEvN,KAAKyuF,gBAAkBzuF,KAAK0uF,eAAe7rF,UACxCD,IACC,GAAIA,EAAe,CACjB,MAAMqsF,EACJjvF,KAAKytF,wBAAwBqB,QAAQ,GAAGI,8BACtCD,GACFjvF,KAAKyB,KACFvB,IAAI+uF,EAAgBD,cAAczsF,KAClCM,UAAWL,IACVxC,KAAK4tF,qBACHprF,EAAKysF,EAAgBD,cAAc/wE,SAAQ,EAGrD,IAGJje,KAAK6tF,oBACyD,IAA5D7tF,KAAKytF,wBAAwBqB,QAAQ,GAAGK,SAASvlF,OAGnD5J,KAAK2tF,aAAaiB,cAAe,EACjC5uF,KAAKovF,mBACLzwD,WAAW,MACT0wD,QAAsBrvF,KAAKgpF,kBAAmBhpF,KAAK2B,kBAAe,EAClE2tF,MAAuBtvF,KAAK4kF,mBAAoB5kF,KAAK2B,kBAAe,EACpE4tF,MAAqBvvF,KAAKglF,kBAC1BhlF,KAAKwvF,mBAAiB,EACrB,EACL,CAEAthF,cACElO,KAAK2tF,aAAaiB,cAAe,EACjC5uF,KAAK+tF,aAAa5/E,cAClBnO,KAAKguF,cAAc7/E,cACnBnO,KAAKiuF,gBAAgBxtE,IAAKgvE,GAAMA,EAAEthF,eAClCnO,KAAK8tF,YAAY3/E,cACjBnO,KAAKyuF,gBAAgBtgF,cACrBnO,KAAK0vF,cACP,CAEQA,eACN1vF,KAAK6uF,aAAapuE,IAAKkvE,GACrB3vF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAI4gC,GAAGuuC,kBAAkBD,IAEzD3vF,KAAKgpF,kBAAkB/iE,yBACrB4pE,KAEF7vF,KAAK4kF,mBAAmB3+D,yBACtB4pE,KAEF7vF,KAAKglF,iBAAiB/+D,yBAAyB4pE,IACjD,CAEQT,mBACNpvF,KAAKmS,QAAU,IAAI6B,KAAmBhU,KAAK+kF,WAAY/kF,KAAK+R,OAC5D/R,KAAK8vF,0BACL9vF,KAAK+vF,2BACL/vF,KAAKgwF,wBACP,CAEQA,yBACNhwF,KAAK8tF,YAAc9tF,KAAK8kF,mBAAmBjiF,UAAU,KACnD,GAAI7C,KAAK4kF,mBAAmB/iE,OAAS,EAAG,CACtC,MAAM8iE,EAAc3kF,KAAK4kF,mBACtB3iE,MACAG,KAAMi6B,GAAUA,EAAMhlB,WAAW1P,QAEpC,GAAIg9D,EAAa,CACfA,EAAYtjC,GAAG8rC,cACf,MAAM8C,EAActL,EAAYtjC,GAAG8rC,cAActJ,YACjD7jF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAIyhC,eAAeoqC,aAC/C2D,EAEJ,CACF,GAEJ,CAEQT,oBACNxvF,KAAKkuF,sBAAwB,IAAIgC,IAAqB,CACpDpwC,OAAQ,CAAC9/C,KAAKgpF,kBAAkBvmC,MAAMpB,IACtC8uC,aAAc,EACd5jD,UAAY7iB,GACY,gBAAfA,EAAMlmB,OAA2BkmB,EAAM0mE,WAIlDpwF,KAAKmuF,cAAgB,IAAI+B,IAAwB,CAC/C3lF,SAAUvK,KAAKkuF,sBAAsB/pC,gBAEvCnkD,KAAKmuF,cAAc7+C,GAAG,cAAgB8Y,IACpCpoD,KAAKsuF,eAAgB,EACrBtuF,KAAKqwF,uBAAuBjoC,EAAI79C,SAAQ,GAE1CvK,KAAKmuF,cAAc7+C,GAAG,eAAiB8Y,IACrCpoD,KAAKsuF,eAAgB,EACrBtuF,KAAKqwF,uBAAuBjoC,EAAI79C,SAAQ,GAG1CvK,KAAKouF,cAAgB,IAAI8B,IAAqB,CAC5CpwC,OAAQ,CAAC9/C,KAAK4kF,mBAAmBniC,MAAMpB,IACvC9U,UAAW+jD,KACXH,aAAc,EACdzmF,OAASoB,GAELA,EAAQ5K,IAAI,UAAY+sF,KAAcsD,OACtCzlF,EAAQ5K,IAAI,YACXF,KAAKsuF,gBAIZtuF,KAAKouF,cAAc9+C,GAAG,SAAW8Y,IAC/B,IAAyB,IAArBpoD,KAAKquF,YAAuB,CAC9B,MAAMmC,KAAoBvK,MACxB4E,KACGziC,EAAYqoC,gBAAgB3F,WAC7B9qF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAIuhC,WAClChiD,KAAKgiD,YAEPhiD,KAAKipF,sBAEDyH,KAAYvL,MAAenlF,KAAK+kF,YACtC2L,EAAU9jD,KAAO4jD,EAAkB3mF,KAAK,KACxC6mF,EAAUxK,YAAc,CAACsK,EAAkB,GAAIA,EAAkB,GACnE,IAGFxwF,KAAK6uF,aAAapuE,IAAKkvE,GACrB3vF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAI4gC,GAAGsvC,eAAehB,GAExD,CAEAiB,0BAA0B1H,GACxBA,EACIlpF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAI4gC,GAAGuuC,kBACnC5vF,KAAKouF,eAEPpuF,KAAK4kF,mBAAmBniC,MAAMhiC,IAAI4gC,GAAGsvC,eAAe3wF,KAAKouF,cAC/D,CAEQiC,uBAAuB9lF,GAC7B,GAA6B,IAAzBA,EAASsmF,YACX,OAEF,MAAM/R,EAAev0E,EAASumF,WAAW,GACnCC,EAAmBjS,EAAalC,QAEhCoU,EAAyBnG,KAC7B/L,EAAaqO,cAActrC,iBAC3B7hD,KAAKgpF,kBAAkBvmC,MAAMhiC,IAAIuhC,WACjChiD,KAAKgiD,YAEDivC,EAAiBjxF,KAAK+kF,WAAW7kF,IAAI6wF,GACrChG,MAAe9E,MACnB+K,EACAhxF,KAAKipF,sBAEPgI,EAAe/K,YAAc6E,GAC7BkG,EAAerkD,KAAOm+C,GAAalhF,KAAK,KACxC7J,KAAK+kF,WAAWplE,OAAOsxE,EACzB,CAEQnB,0BAEN9vF,KAAK+tF,aAAe/tF,KAAK+kF,WAAWnjE,OACjC7d,QAAKmtF,QACLruF,UAAWgf,IACV,GAAIA,EAAQ,EAAG,CAEb,MADAsjE,MAAenlF,KAAK+kF,YACU,IAA1B/kF,KAAK+kF,WAAWljE,MAElB,YADA7hB,KAAK+kF,WAAWoM,kBAAkBxuF,MAAK,GAGzC3C,KAAK+kF,WAAWoM,kBAAkBxuF,MAAK,EACzC,CACA3C,KAAKiuF,gBAAgBxtE,IAAKgvE,GAAMA,EAAEthF,cAAa,EAErD,CAEQ4hF,2BACN/vF,KAAKguF,cAAgBhuF,KAAK+kF,WAAWtgE,UAClC1gB,QAAKof,KAAanjB,KAAK4wD,WACvB/tD,UAAWynF,IACVtqF,KAAKoxF,eAAe9G,IAAK,EACzBG,MAAmBzqF,KAAK+kF,YACxB/kF,KAAKqxF,qBACLrxF,KAAKsxF,UAAUtxF,KAAKsuF,cAAa,EAEvC,CAEAiD,eACEvxF,KAAKwuF,UAAU/tE,IAAK7E,GAAMA,EAAEzN,cAC9B,CAEQijF,eAAe9G,GACrB,MAAMkH,EAAkBlH,EAAM7pE,IAAKslE,GAC1BxpE,KAAY+0D,gBAAgB,CAC5Bp/D,GAAI6zE,EAAK7zE,GAAI06B,KAAMm5C,EAAKn5C,KAAMs5C,YAAaH,EAAKG,eAGnDuL,EAAOC,KAAYC,YAAY3xF,KAAKuuF,cAAeiD,EAAiB,CACxE,gBAEII,EAAkBH,EAAKx3D,MAAMtZ,OAAO8wE,EAAKI,UAC3CD,GACFA,EAAgBnxE,IAAKs6B,IACnB,MAAM+2C,GAAc/2C,EAAOg3C,SAC3B,GAAID,GAAa,CACf,MAAM/L,GAAa/lF,KAAK+kF,WAAW7kF,IAAI4xF,GAAY5/E,IAC7Cg8C,GAAO63B,GAAKn5C,KAClB,IAAKshB,IAAwB,IAAhBA,GAAKtkD,OAChB,OAEF,MAAMooF,MAAWC,MACf/jC,GACAluD,KAAKgpF,kBAAkBvmC,MAAMhiC,IAAIuhC,YAEnC,IAAIkwC,GACAC,IAAU,EACVH,GAASI,SACXD,IAAU,GAEZD,GAAalyF,KAAK0tF,cAAczhB,OAAO/d,GAAM,CAC3CmkC,WAAY,YAEdryF,KAAKuxF,eACL,MAAMe,GAAYJ,GAAWzxE,IAAKk9B,IAChCA,GAAIwC,QAAQp8C,QACV0c,KAAK2+D,IACHA,GAAQ11E,OAAQs/D,IACdmpB,GAC6B,UAAzBnpB,GAAE/kE,KAAKqlF,SAAS9lF,MAAoBwlE,GAAE/kE,KAAKqlF,SAC3CtgB,GAAE/kE,KAAKqlF,aAKnBtpF,KAAKwuF,UAAY8D,GAAU7xE,IAAK0/B,IACvBA,GACJp8C,QACC0c,KAAK2+D,IACHA,GAAQ11E,OAAQs/D,IACdmpB,GAC6B,UAAzBnpB,GAAE/kE,KAAKqlF,SAAS9lF,MAAoBwlE,GAAE/kE,KAAKqlF,SAC3CtgB,GAAE/kE,KAAKqlF,YAIhBzmF,UAAW86C,KACV,GAAIA,GAAI/zC,OAAS,EAAG,CAClB,MAAM6Z,GAASk6B,GAAI,GAAGl6B,OAChBpF,GAAOs/B,GAAI,GAAGt/B,KACd+gE,GAAUzhC,GAAIl9B,IAAKuoD,IAAMA,GAAE/kE,MAC5B8hF,GAAK6C,kBACR7C,GAAK6C,gBAAkB,IAEzB7C,GAAK6C,gBAAkB7C,GAAK6C,gBAAgBl/E,OACzC6oF,IACCA,GAAG/uF,QACF2uF,GAAUK,KAAaC,MAAQD,KAAaE,OAEjD,IAAIC,GAAe5M,GAAK6C,gBAAgBxmE,KACrCmwE,IAAOA,GAAG9uE,SAAWA,IAEpBkvE,GACFA,GAAavT,QAAUA,GAEvB2G,GAAK6C,gBAAgBthF,KAAK,CACxB9D,KAAM2uF,GAAUK,KAAaC,MAAQD,KAAaE,KAClDjvE,UACApF,QACA+gE,YAGN,CACAp/E,KAAK+R,MAAM4K,eAAa,GAGhC,IAGJ3c,KAAKuuF,cAAgBiD,CACvB,CAEQH,qBACN,MAAM/G,EAAQtqF,KAAK+kF,WAAW9iE,MACDqoE,EAAM5gF,OAAQq8E,GAASA,EAAKG,aACpCzlE,IAAKslE,GAAS/lF,KAAK4yF,eAAe7M,IACvD/lF,KAAKgpF,kBACF/mE,MACAxB,IAAKoyE,IACC7yF,KAAK+kF,WAAW7kF,IAAI2yF,EAAYx7D,WAAWnlB,KAC9ClS,KAAKgpF,kBAAkBhgF,OAAO6pF,EAAW,GAGfvI,EAAM5gF,OAAQq8E,IAAUA,EAAKG,aACrCzlE,IAAKslE,IAC3B,MAAM8M,EAAc7yF,KAAKgpF,kBAAkB9oF,IAAI6lF,EAAK7zE,IAChD2gF,GACF7yF,KAAKgpF,kBAAkBhgF,OAAO6pF,EAAW,EAG/C,CAEQvB,UAAUwB,GAAsB,GACtC,MAAMC,EAAuB/yF,KAAK+kF,WAAW50E,KAC1C8R,MACAvY,OAAQq8E,IAASA,GAAKG,aACzB,GAAI6M,EAAqBnpF,OAAS,EAEhC,YADA5J,KAAK4kF,mBAAmBz+D,WAAWnmB,KAAK4kF,mBAAmB3iE,OAI7D,MAAM+wE,EAAqBD,EAAqBtyE,IAAKslE,OAC9BE,MACnBF,GAAKG,YACLlmF,KAAKipF,uBAUTjpF,KAAKiuF,gBAAgBxtE,IAAKgvE,IAAMA,GAAEthF,eAClC,MAAM8kF,EAAgBjzF,KAAK0kF,kBAAkBroC,MAC3C22C,EACAF,EATkD,CAClDI,UAAU,EACVnlD,OAAO,EACPolD,cAAc,EACdC,mBAAmB,QAKsBpxF,GAEvCixF,GACFjzF,KAAKiuF,gBAAgB3mF,KACnB2rF,EAAcpwF,UAAW6oF,KACvB1rF,KAAK4kF,mBAAmBz+D,WAAWnmB,KAAK4kF,mBAAmB3iE,OAC3DypE,GAAWjrE,IAAK6D,OACd+uE,MACErzF,KAAK4kF,mBACLtgE,GACAtkB,KAAKgiD,WACL19B,KAAconE,GAAW,IAC1B,GAKX,CAEOkH,eAAe7M,IACpBuN,QACEvN,EACA/lF,KAAK+kF,WACL/kF,KAAKgpF,kBACLhpF,KAAKgiD,WACLhiD,KAAK2B,gBAET,CAEA4xF,0BAA0Bn7C,GACxBp4C,KAAK2tF,aAAaiB,cAAgBx2C,EAClC,MAAMiJ,EAAKrhD,KAAK4kF,mBAAmBniC,MAAMhiC,IAAI4gC,GAC7CrhD,KAAK6uF,aAAapuE,IAAKkvE,GACrBv3C,EACIiJ,EAAGsvC,eAAehB,GAClBtuC,EAAGuuC,kBAAkBD,GAE7B,CAEArC,2BAA2Bl1C,GACzBp4C,KAAKytF,wBAAwBqB,QAAQ,GAAGK,SAAS50E,QAC9Ci5E,GAAaA,EAAQ7iD,SAAU,GAE9ByH,GACFp4C,KAAKytF,wBAAwBqB,QAAQ,GAAGK,SAAS/sE,KAC9CoxE,GAAYA,EAAQxE,eACrBr+C,SAAU,EACZ3wC,KAAK4B,eAAe8D,MAClB1F,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,kDAEF7sC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,qDAIJ7sC,KAAKytF,wBAAwBqB,QAAQ,GAAGK,SAAS/sE,KAC9CoxE,IAAaA,EAAQxE,eACtBr+C,SAAU,EAEd3wC,KAAKsxF,WACP,4CArcW9D,GAAmBpsF,mBAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,KAAAzE,MAAA0E,MAAA1E,MAAA2E,KAAA3E,MAAA4E,KAAA5E,MAAAuT,MAAA,+BAAnB64E,EAAmBl/E,UAAA,qBAAAC,OAAA,CAAAs2E,WAAA,aAAAE,WAAA,aAAAiE,kBAAA,oBAAApE,mBAAA,qBAAAI,iBAAA,mBAAAp0B,SAAA,WAAAhnD,OAAA,SAAAq/E,qBAAA,uBAAAnE,mBAAA,qBAAA4J,eAAA,kBAAAjgF,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,0WAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID1E9B1N,MADF,UACEA,CAD8B,wBAI5BA,MAAA,kBAAAqW,GAAA,OAAU1I,EAAAwkF,0BAAA97E,EAAAoW,QAAyC,GAEnDzsB,MAAA,wBACFA,QACAA,MAAA,EAAAqyF,EAAA,0BAQFryF,QAEAA,MAAA,8BAQAA,MAAA,6BACEA,MAAA,6BAAAqW,GAAA,OAAqB1I,EAAA6hF,0BAAAn5E,EAAiC,GAOvDrW,QAEDA,MAAA,qCAlCIA,QACAA,MADA,UAAA2N,EAAA4/E,yBACAvtF,CADoC,0BAIpCA,cAAA,IAAAA,MAAA,iDAGCA,MAAA,GAAAA,MAAA,OAAA2N,EAAA6+E,sBAAA7+E,EAAA8+E,qBAUHzsF,QAIAA,MAJA,mBAAA2N,EAAAi2E,iBAIA5jF,CAJqC,aAAA2N,EAAA81E,WAIrCzjF,CAHyB,qBAAA2N,EAAA+1E,mBAGzB1jF,CAFyC,qBAAA2N,EAAA61E,mBAEzCxjF,CADyC,aAAA2N,EAAAg2E,YAMzC3jF,QAKAA,MALA,uBAAA2N,EAAAk6E,qBAKA7nF,CAL6C,aAAA2N,EAAAizC,WAK7C5gD,CAJyB,oBAAA2N,EAAAi6E,kBAIzB5nF,CAHuC,aAAA2N,EAAAg2E,WAGvC3jF,CAFyB,WAAA2N,EAAA6hD,SAEzBxvD,CADqB,SAAA2N,EAAAnF,QAKrBxI,QACAA,MADA,mBAAA2N,EAAAi2E,iBACA5jF,CADqC,qBAAA2N,EAAA61E,oCC8BnC8O,KAAY7+E,KACZ8+E,KAAoB7+E,KACpB2vE,IACAoE,KACAuD,IACAz8E,KAAiBmtB,MAAAjtB,OAAA,iWAGR29E,CAAmB,+ECzE1B,MAAOoG,EACQ9E,QAAnB/uF,YAAmB+uF,GAAA9uF,KAAA8uF,SAA8B,EAG7C,SAAU+E,EAA+B/E,GAC7C,OAAO,IAAI8E,EAAwB9E,EACrC,CAEM,SAAUgF,IACd,MAAO,CACLrpF,QAASmpF,EACTjsD,WAAYksD,EACZhsD,KAAM,CAACwlD,KAEX,yFChBO,IAAK0G,EAAZ,SAAYA,GACVA,WAAA/vC,QAAA,aACA+vC,IAAA97D,KAAA,UAFU87D,CAGZ,CAHA,CAAYA,GAAgB,IAIhBC,EAAZ,SAAYA,GACVA,SAAAzD,MAAA,QACAyD,EAAAC,KAAA,OAFUD,CAGZ,CAHA,CAAYA,GAAoB,IAKpBxB,EAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,KAAA,OAFUF,CAGZ,CAHA,CAAYA,GAAY,IAKZvF,EAAZ,SAAYA,GACVA,SAAAiH,KAAA,OACAjH,EAAAsD,MAAA,QACAtD,EAAAC,OAAA,SAHUD,CAIZ,CAJA,CAAYA,GAAa,IAMbpD,EAAZ,SAAYA,GACVA,SAAAsK,MAAA,QACAtK,EAAAC,aAAA,eACAD,EAAAuK,IAAA,MAHUvK,CAIZ,CAJA,CAAYA,GAA6B,wPCSlC,IAAMwK,GAAiB,MAAxB,MAAOA,EAED5G,wBACAjlD,cACA7mC,gBACA2yF,aACkBhsF,SAClB23D,gBANVlgE,YACU0tF,EACAjlD,EACA7mC,EACA2yF,EACkBhsF,EAClB23D,GALAjgE,KAAAytF,0BACAztF,KAAAwoC,gBACAxoC,KAAA2B,kBACA3B,KAAAs0F,eACkBt0F,KAAAsI,WAClBtI,KAAAigE,iBACP,CAEH5jB,MACE6pC,EACAqO,EAAsC,IAEtC,GAA2B,IAAvBrO,EAAYt8E,OAGhB,OAAO5J,KAAKw0F,YACVx0F,KAAKytF,wBAAwBqB,QAAQ,GACrC5I,EACAqO,EAEJ,CAEAC,YACE/wE,EACAyiE,EACAqO,EAAsC,IAGtC,OADgB9wE,EAAO44B,MAAM6pC,EAAaqO,EAE5C,CAEAtN,kBACExmE,EACA6D,GAAoB,IAAAmwE,EAAAz0F,KAEpB,MAAM00F,EAAa10F,KAAKigE,gBAAgB1+B,WAClCo4B,EAAU,IAAI3e,IAEd25C,EAAa,IAAIC,UAAM,CAC3BC,YAAa,IACbl9D,OAAQ,SACRm9D,KAAM,QAGA51D,MAAO61D,EAAW91D,OAAQ+1D,GAAeL,EAAIM,SAAS1qE,SAGxD2qE,EAA4C,CAAC,GAAI,GAAI,GAAI,IAC/Dl1F,KAAKm1F,eAAe10E,EAAKk0E,EAAKO,GAC9B,MAEME,EAAoC,CAF5BL,EAAYG,EAAQ,GAAKA,EAAQ,GAChCF,EAAaE,EAAQ,GAAKA,EAAQ,IAE3CtpF,EAAQ,GAAG0Y,EAAU1Y,WAAK,EAAK+5E,MACnCrhE,EAAU82C,eACX,EAAKwqB,MAAethE,EAAUuhE,aAG/B8O,SAAI/nD,KAAKhhC,EAAO+oF,EAAIM,SAAS1qE,SAAS2U,MAAQ,EAFxB,GAE0C,CAC9Dm2D,MAAO,WAITr1F,KAAKs0F,aACFgB,OACCX,EACAl0E,EAJe,GAMf20E,EACAF,EACAK,KAAoBC,MAErB3yF,UAAS,eAAA4yF,KAAAC,KAAC,UAAOC,IACZA,KAAWC,KAAcC,aACrBpB,EAAKqB,gBAAgBnB,EAAKrwE,EAAW1Y,GAC3C6oF,EAAKsB,oBAAoBpB,SACnBA,EAAInoC,KAAK,GAAG5gD,QAAa,CAAEoqF,eAAe,KAGlDvB,EAAKx0B,gBAAgBI,WAAWq0B,GAChC/6B,EAAQh3D,KAAKgzF,GACf,GAAC,gBAAAM,IAAA,OAAAR,EAAAS,MAAAl2F,KAAAm2F,UAAA,EATS,IAWLx8B,CACT,CAEQw7B,eACN10E,EACAk0E,EACAO,GAGA,MAAMkB,EAA0Bp2F,KAAKs0F,aAAa+B,mBAAmB51E,GACrE,GAAI21E,EAAiB,CACnBlB,EAAQ,IAAMoB,EACd,MAAM/kF,EAAY2jF,EAAQ,GAGpB1jF,EACJmjF,EAAIM,SAAS1qE,SAAS0U,OAHHi2D,EAAQ,GAGmBoB,EAChD3B,EAAI4B,YAAY,IAChB5B,EAAI/nD,KAAKwpD,EAAiB7kF,EAAWC,EACvC,CACF,CAEcglF,oBACZlyE,GAAoB,IAAAmyE,EAAAz2F,KAAA,SAAA01F,KAAA,YAEpB,MAAMzxF,QAAawyF,EAAKC,sBAAsBpyE,GACxCqyE,EAAQruF,SAASC,cAAc,SAC/BquF,EAAUtuF,SAASC,cAAc,SACvC,QAAS0W,EAAQ,EAAGA,EAAQhb,EAAK2F,OAAQqV,IAAS,CAChD,MAAM5W,EAAUpE,EAAKgb,GACrB,IAAI6a,EAAMxxB,SAASC,cAAc,MAC7BsuF,EAAYvuF,SAASC,cAAc,MACnCuuF,EAAWxuF,SAASC,cAAc,MAEtC,MAAMwuF,EAAMzuF,SAASC,cAAc,OACnCwuF,EAAIxuD,IAAMlgC,EAAQsD,KAElB,MAAMqrF,EAAO1uF,SAASC,cAAc,QAIpC,GAHAyuF,EAAK1gF,UAAYjO,EAAQg+E,YACzBwQ,EAAUI,YAAYF,GACtBD,EAASG,YAAYD,GACjB3uF,EAAQ+yD,SAAU,CACpB,MAAM87B,EAAe5uF,SAASC,cAAc,QAC5C2uF,EAAa/gF,MAAMghF,cAAgB,SACnCD,EAAa5gF,UACX,iCAAmCjO,EAAQ+yD,SAC7C07B,EAASG,YAAYC,EACvB,CACAp9D,EAAIs9D,OAAOP,GACX/8D,EAAIs9D,OAAON,GACXF,EAAQK,YAAYn9D,EACtB,CACA68D,SAAMM,YAAYL,GACXD,CAAM,EA9BO,EA+BtB,CAEcD,sBACZpyE,GAAoB,IAAA+yE,EAAAr3F,KAAA,SAAA01F,KAAA,YAKpB,MAAM4B,EAHeD,EAAK/uF,SACvB04D,qBAAqB,0BAA0B,GAC/CA,qBAAqB,YAAY,GACHA,qBAAqB,iBAEtD,IAAIu2B,EAAoD,GACxD,QAASt4E,EAAQ,EAAGA,EAAQq4E,EAAY1tF,OAAQqV,IAAS,CAEvD,MAAMtT,EADU2rF,EAAYr4E,GACP+hD,qBAAqB,YAAY,GAChDw2B,EAAW7rF,EAAKsiC,UAEtB,IADcspD,EAAW32E,KAAM5N,GAAOA,EAAGgc,OAASwoE,GACtC,CACV,MAAMC,QAAmBC,IAAY/rF,EAAM,CAAE21E,MAAO,IACpDiW,EAAWjwF,KAAK,CAAE0nB,KAAMwoE,EAAU7rF,KAAM8rF,EAAWE,aACrD,CACF,CAEA,IAAIC,EAIC,GACL,QAASxoD,EAAI,EAAGA,EAAI9qB,EAAUypB,MAAMnkC,OAAQwlC,IAAK,CAC/C,MAAMre,EAAOzM,EAAUypB,MAAMqB,GACvBi3C,KAAcE,MAClBx1D,EAAKy1D,SAAShjF,KACdutB,EAAKy1D,SAASC,SACd11D,EAAK/B,KACL+B,EAAKy1D,SAASE,cACdt3C,EACCre,EAAKy1D,SAAiBG,KACvB0Q,EAAK11F,gBACLytC,IAAM9qB,EAAUypB,MAAMnkC,OAAS,GAG3BwxD,KAAWuqB,MAAe50D,EAAKqqC,UACrCw8B,EAAmBtwF,KAAK,CACtB++E,YAAaj3C,EAAI,EAAI,KAAOi3C,EAAYA,YACxC16E,KAAM4rF,EAAWn1E,KAAMzW,GAASA,EAAKqjB,OAASq3D,EAAY0F,OAAOpgF,KACjEyvD,SAAUA,EAAW,IAAMA,EAAW,SAAMp5D,GAEhD,CACA,OAAO41F,CAAmB,EA5CN,EA6CtB,CAEc9B,gBACZnB,EACArwE,EACA1Y,GAAa,IAAAisF,EAAA73F,KAAA,SAAA01F,KAAA,YAEbf,EAAImD,UAEJnD,EAAI/nD,KAAKhhC,EAAO+oF,EAAIM,SAAS1qE,SAAS2U,MAAQ,EADxB,GAC0C,CAC9Dm2D,MAAO,WAET,MAAM0C,QAAkBF,EAAKrB,oBAAoBlyE,GAEhDqwE,EAAYqD,UAAU,CACrB/iF,KAAM8iF,EACNE,OAHeC,GAIfC,OAAQ,CAAEC,IAAK,GAAIC,OAAQ,IAC3BC,aAAc,CACZ,EAAG,CAAEC,UAAW,KAElBC,MAAO,QACP3oF,OAAQ,CACN4oF,SAAU,IAEZC,YAAa,SAAUz0F,GACrB,GAA0B,IAAtBA,EAAK2yB,OAAO3X,OAAqC,SAAtBhb,EAAK00F,KAAKC,QAAoB,CAC3D30F,EAAK61B,IAAImF,OAAS,GAElB,MAAM83D,EADK9yF,EAAK00F,KAAKE,IACN73B,qBAAqB,OAAO,GAC3C2zB,EAAImE,SAAS/B,EAAIxuD,IAAKtkC,EAAK00F,KAAK5kB,EAAG9vE,EAAK00F,KAAKI,EAAG,EAAG,EACrD,CACF,GACuB,EA5BZ,EA6Bf,CAEQhD,oBAAoBpB,GAC1B,MAAMqE,EAAYrE,EAAIsE,mBAChBjgE,EAAOtB,IAAOz2B,KAAKi4F,OAAOvhE,OAAO,oBAAoBwgC,WAGrDghC,EADan5F,KAAKwoC,cAAcpoC,UAAU,2BACT,kBAEvC,QAAS6e,EAAQ,EAAGA,EAAQ+5E,EAAW/5E,IAAS,CAC9C01E,EAAIyE,QAAQn6E,GACZ01E,EAAI4B,YAAY,GAChB,MAAMhsE,EAAWoqE,EAAIM,SAAS1qE,SACxByqE,EAAazqE,EAAS0U,OACxB1U,EAAS0U,OACT1U,EAAS8uE,YACPn6D,EAAQ3U,EAAS2U,MAAQ3U,EAAS2U,MAAQ3U,EAAS+uE,WACzD3E,EAAI/nD,KAAK5T,EAAM,GAAI,GAAI,CAAEugE,SAAU,QACnC5E,EAAImE,SAASK,EAAM,MAAOj6D,EAAQ,GAAI,EAAG,GAAI,IAC7Cy1D,EAAI/nD,KAAK5T,EAAM,GAAIg8D,EAAa,IAChCL,EAAI/nD,KACF,QAAU+nD,EAAI6E,qBAAqBC,WAAa,MAAQT,EACxD95D,EAAQ,GACR81D,EAAa,GAEjB,CACF,4CAtPWX,GAAiBjzF,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,KAAA1E,MAMlBs4F,MAAQt4F,MAAA2E,MAAA,iCANPsuF,EAAiBhzF,QAAjBgzF,EAAiB/yF,mBAAjB+yF,CAAiB,qVCYxB,SAAU5J,EACd1F,EACAzgE,EAA4B,MAC5Bkb,EAAQ,YAERulD,EAAW50E,KAAKqS,KAAK,CACnB8B,YACAD,cAAgBrG,GAAiBA,EAAOwhB,IAE5C,CAEM,SAAUgrD,EACdvrE,EACAmyC,GAEA,IAAIw4B,EAAmBC,KAA8BC,aACrD,OAAc,IAAV7qE,EACF2qE,EAAmBC,KAA8BsK,MACxCl1E,IAAUmyC,EAAc,IACjCw4B,EAAmBC,KAA8BuK,KAE5CxK,CACT,CAqBM,SAAUzE,EAAeJ,GAC7B,MAAM7yE,KAAKyQ,QACL2nE,EAAQvF,EAAW9iE,MACzB,IAAI03E,EAEFA,EADuB,IAArB5U,EAAWljE,MACD,CAAC,GAEDyoE,EAAM7pE,IAAKslE,IAASA,GAAK12C,UAEvC,MAAMuqD,EAAsB1tE,KAAKC,OAAOwtE,GAClCE,GAAyBD,EACzBE,GAAuBF,EAAc,EAErCG,GAAehV,EAClB9iE,MACAG,KAAM2jE,IAASA,GAAK12C,WAAauqD,GACpC,OAAIG,KACFA,GAAa1qD,SAAWyqD,GACxBC,GAAanQ,iBAAmBY,EAC9BsP,GACA/U,EAAWljE,MAAQ,IAIvBkjE,EAAW1/D,OAAO,CAChBnT,KACAm9B,SAAUwqD,GACVjQ,iBAAkBY,EAChBqP,GACA9U,EAAWljE,MAAQ,KAIvB4oE,EAAmB1F,GACZA,EAAW7kF,IAAIgS,EACxB,CAEM,SAAU63E,EAAoBhF,EAAwBgB,GAC1DhB,EAAW/7E,OAAO+8E,GAzDd,SAAUiU,GAAqBjV,GACnC,MAAMkV,EAAyB,IAAIlV,EAAW9iE,OAC9Cg4E,EAAuBz3E,KAAK,CAAC8/B,EAAGC,IAAMD,EAAEjT,SAAWkT,EAAElT,UACrD4qD,EAAuBx5E,IAAI,CAACslE,EAAM32C,KAChC22C,EAAK12C,SAAWD,EAChB22C,EAAK6D,iBAAmBY,EACtBzE,EAAK12C,SACL4qD,EAAuBrwF,OAAM,GAG7BqwF,GACFlV,EAAWllE,WAAWo6E,EAE1B,CA6CED,CAAqBjV,EACvB,CAOM,SAAUmV,EACdpvF,EACAwwD,GAEA,MAAM6+B,EAAc,CAClB,IAAIC,KAAc,CAChB9Q,SAAUx+E,EAAQqiF,cAClBpB,MAAO,IAAIqO,IAAe,CACxBC,OAAQ,EACRjf,OAAQ,IAAIgf,IAAe,CAAE7uF,MAAO,UAAW2zB,MAAO,SAKtDo7D,KAAYC,KAAyB,CACzC3tD,KAAM9hC,EAAQ5K,IAAI,YAClB0iD,QAAS93C,EAAQ5K,IAAI,eACrBs6F,YAAa1vF,EAAQ5K,IAAI,aACzBu6F,mBAAoB,CAAC,IAAK,IAAK,OAG3BC,EAAa,CACjB,IAAIN,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,uBAAuBT,EAAQ5K,IAAI,UAAY,IAAO,KAC7Dg/B,MAAO,OAGX,IAAIk7D,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,sBAAsBT,EAAQ5K,IAAI,UAAY,IAAO,KAC5Dg/B,MAAO,OAKb,OAAIp0B,EAAQ5K,IAAI,UAAY+sF,KAAciH,KACjCoG,EAEmB,WAAxBxvF,EAAQ5K,IAAI,QACPi6F,EAELrvF,EAAQ5K,IAAI,UAAY+sF,KAAcsD,MACjCmK,OADT,CAGF,CAEM,SAAUrL,EACdrG,EACArnF,GAEA,MAAMg5F,EAAkB,IAAI9K,IAA4B,CACtD+K,OAAQC,IAAcj9E,OAGlBk9E,EAAa,IAAI/+B,IAAY,CACjC5G,oBAAoB,EACpBjjD,GAAI,4BACJtG,MAAOjK,EAAgB4pB,UAAUshB,QAC/B,oCAEF2V,OAAQ,IACR/+B,OAAQ,IAAIq4C,IACZnS,iBAAiB,EACjBlP,UAAW,CACT9J,SAAS,GAEXoqD,aAAc,CACZC,OAAQ,4BACRC,MAAO,CACL,CACEC,cAAc,EACdC,UAAW,CAAC,6BACZ9jE,WAAY,MAIlB+jE,YAAY,EACZC,WAAW,EACXllF,MAAO+jF,KAEToB,OAAkBtS,EAAmB8R,GACrC9R,EAAkBvmC,MAAM5rB,SAAU,KAClC0kE,KAAsBvS,EAAmB2R,EAC3C,CAEM,SAAUrL,EACd1K,EACAjjF,GAEA,MAAMg5F,EAAkB,IAAI9K,IAA4B,CACtD+K,OAAQC,IAAcj9E,OAGlB49E,EAAa,IAAIz/B,IAAY,CACjC5G,oBAAoB,EACpBjjD,GAAI,4BACJtG,MAAOjK,EAAgB4pB,UAAUshB,QAC/B,qCAEF2V,OAAQ,IACR/+B,OAAQ,IAAIq4C,IACZnS,iBAAiB,EACjBlP,UAAW,CACT9J,SAAS,GAEXoqD,aAAc,CACZC,OAAQ,6BAEVI,YAAY,EACZC,WAAW,EACXllF,MAAO+jF,KAEToB,OAAkB1W,EAAoB4W,GACtC5W,EAAmBniC,MAAM5rB,SAAU,KACnC0kE,KAAsB3W,EAAoB+V,EAC5C,CAEM,SAAUpL,EAAqBvK,GACnC,MAAM2V,EAAkB,IAAI9K,IAA4B,CACtD+K,OAAQC,IAAcj9E,OAGlB69E,EAAY,IAAI1/B,IAAY,CAChC5G,oBAAoB,EACpBjjD,GAAI,2BACJtG,MAAO,GACP42C,OAAQ,IACR/+B,OAAQ,IAAIq4C,IACZnS,iBAAiB,EACjBlP,UAAW,CACT9J,SAAS,GAEXoqD,aAAc,CACZC,OAAQ,6BAEVI,YAAY,EACZC,WAAW,EACXllF,MAAO+jF,KAEToB,OAAkBtW,EAAkByW,GACpCzW,EAAiBviC,MAAM5rB,SAAU,KACjC0kE,KAAsBvW,EAAkB2V,EAC1C,CAEM,SAAUrH,EACdvN,EACAhB,EACAiE,EACAhnC,EACArgD,GAEA,IAAI+5F,GACA1V,GAEJ,OAAQD,EAAK6D,kBACX,KAAKC,KAA8BsK,MACjCuH,GAAY,UACZ1V,GAAWrkF,EAAgB4pB,UAAUshB,QACnC,gCAEF,MACF,KAAKg9C,KAA8BuK,IACjCsH,GAAY,UACZ1V,GAAWrkF,EAAgB4pB,UAAUshB,QACnC,8BAEF,MACF,QACE6uD,GAAY,UACZ1V,GACErkF,EAAgB4pB,UAAUshB,QACxB,uCAEF,KACAk5C,EAAK12C,SAIX,MAAMi6C,GAAW,IAAIoD,IACnB7B,KACE9E,EAAKG,YACLlkC,EACAgnC,EAAkBvoE,IAAIuhC,aAIpB4qC,IAAc,IAAIC,KAAYC,oBAAoBxD,GAAU,CAChE5kC,kBAAmBskC,EAAkBvoE,IAAIuhC,WACzCyC,eAAgBukC,EAAkBvoE,IAAIuhC,aAGlC25C,GAAe3S,EAAkB9oF,IAAI6lF,EAAK7zE,IAG1C0pF,GAAoC,CACxCp4F,KAAMwpF,IACN1D,SAAUsD,GACV5qC,WAAYgnC,EAAkBvoE,IAAIuhC,WAClC3qB,WAAY,CACVnlB,GAAI6zE,EAAK7zE,GACT1O,KAAMypF,KAAciH,KACpBlO,YACA0V,aACAG,YAAa,EACb9V,QAEF1nE,KAAM,CACJnM,GAAI6zE,EAAK7zE,GACT6M,UAhByB48E,GAAeA,GAAat9E,KAAKU,SAAW,GAgBpC,GAEnCsiC,GAAI,IAAIsrC,IAAU,CAAErD,eAEtBN,EAAkBrpE,OAAOi8E,GAC3B,CAEM,SAAUvI,EACdzO,EACAtgE,EACA09B,EACAr6B,GAAkB,EAClBm0E,GAAe,GAEf,MAEMxS,GADe,IAAIoD,IADZpoE,EAAUglE,SAASpD,aAEF9sE,UAC5B4oC,EACA4iC,EAAmBnkE,IAAIuhC,YAGnB4qC,IAAc,IAAIC,KAAYC,oBAAoBxD,GAAU,CAChE5kC,kBAAmBkgC,EAAmBnkE,IAAIuhC,WAC1CyC,eAAgBmgC,EAAmBnkE,IAAIuhC,aAGnC+5C,GAAgBnX,EAAmB1kF,IAAIokB,EAAUpS,IAGjD8pF,GAA0C,CAC9Cx4F,KAAMwpF,IACN1D,SAAUsD,GACV5qC,WAAY4iC,EAAmBnkE,IAAIuhC,WACnC3qB,WAAY,CACVnlB,GAAIoS,EAAUpS,GACd1O,KAAMypF,KAAcsD,MACpB5oE,SACArD,aAEFjG,KAAM,CACJnM,GAAIoS,EAAUpS,GACd6M,UAd0Bg9E,GAAgBA,GAAc19E,KAAKU,SAAW,GActC,GAEpCsiC,GAAI,IAAIsrC,IAAU,CAAErD,eAEtB1E,EAAmBjlE,OAAOq8E,GAC5B,CAEM,SAAUrW,EAAevqB,GAC7B,GAAiB,IAAbA,EAGJ,OAAIA,GAAY,IACP6gC,KAAYC,gBAAgBhwE,KAAKiwE,MAAM/gC,GAAY,IAAM,GAAK,MAEnEA,GAAY,KAKZA,GAAY,IAEZ6gC,KAAYC,gBAAgBhwE,KAAKiwE,MAAM/gC,GAAY,IAAM,GAAI,GAAK,MAG/D6gC,KAAYC,gBAAgB9gC,EAAU,GAAK,IACpD,CAEM,SAAUwqB,EAAeC,GAC7B,GAAIA,GAAY,KAAM,CACpB,MAAMuW,EAAOlwE,KAAKuN,MAAMosD,EAAW,MAC7BwW,EAASnwE,KAAKiwE,MAAiC,IAA1BtW,EAAW,KAAOuW,IAC7C,OAAe,KAAXC,EACKD,EAAO,EAAI,KAEbA,EAAO,MAAQC,EAAS,MACjC,CAEA,OAAIxW,GAAY,GACP35D,KAAKiwE,MAAMtW,EAAW,IAAM,OAE9BA,EAAW,IACpB,CAEM,SAAUU,EACd/iF,EACAijF,EACApqC,EAAgB,OAChB/3B,EACAg4E,EACA3V,GACAhlF,GACA46F,IAAW,GAEX,MAAMhxE,GAAY5pB,GAAgB4pB,UAClC,IAAIixE,GACAzQ,GAAQ,gBACRD,GAAW,aACf,MAAM2Q,GAsLF,SAAUC,EACdC,EACAh7F,GAEA,MAAM4pB,EAAY5pB,EAAgB4pB,UAClC,OAAIoxE,GAAW,KAAOA,EAAU,GACvBpxE,EAAUshB,QAAQ,4BAChB8vD,EAAU,GACZpxE,EAAUshB,QAAQ,6BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,4BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,6BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,4BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,6BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,4BAChB8vD,EAAU,IACZpxE,EAAUshB,QAAQ,kCAEzB,CAEJ,CA9M8B6vD,CAAiBp4E,EAAW3iB,IAClDi7F,GA8JF,SAAUC,EAAkBpW,EAAU9kF,GAC1C,MAAM4pB,EAAY5pB,EAAgB4pB,UAClC,MAAiB,UAAbk7D,EACKl7D,EAAUshB,QAAQ,4BACH,gBAAb45C,EACFl7D,EAAUshB,QAAQ,kCACH,UAAb45C,EACFl7D,EAAUshB,QAAQ,4BACH,iBAAb45C,EACFl7D,EAAUshB,QAAQ,mCACH,eAAb45C,EACF9kF,EAAgB4pB,UAAUshB,QAAQ,iCACnB,SAAb45C,EACF9kF,EAAgB4pB,UAAUshB,QAAQ,2BACnB,gBAAb45C,EACF9kF,EAAgB4pB,UAAUshB,QAAQ,kCACnB,aAAb45C,EACF9kF,EAAgB4pB,UAAUshB,QAAQ,+BAElC45C,CAEX,CAnL6BoW,CAAkBpW,EAAU9kF,IAMvD,IAAIm7F,IAJW,aAAbrW,EACI,GACAl7D,GAAUshB,QAAQ,uCAEW+vD,GA+BnC,GA7BInW,GAAUxa,OAAO,WAAa,IAChC6wB,GAAsBF,IAGP,UAAbnW,GACFsF,GAAQ,gBACRD,GAAW,aACW,gBAAbrF,GAGa,UAAbA,GAFTsF,GAAQ,2BACRD,GAAW,gBAIW,iBAAbrF,GACTsF,GAAQ,gBACRD,GAAW,cACW,aAAbrF,EACTsF,GAAQ,gBACc,gBAAbtF,GACTsF,GAAQ,gBACRD,GAAW,eACW,SAAbrF,GAGa,eAAbA,KACTsF,GAAQ,0BACRD,GAAW,gBAGA,SAATtoF,EAEAg5F,GADe,aAAb/V,EACUl7D,GAAUshB,QAAQ,mCAAoC,CAChEwP,UAEoB,UAAboqC,EACGl7D,GAAUshB,QAAQ,gCAAiC,CAAEwP,UAErD9wB,GAAUshB,QAAQ,+BAAgC,CAC5DwP,QACAygD,uBACAF,6BACD,GAEe,aAATp5F,EACTg5F,GAAYjxE,GAAUshB,QAAQ,8BAA+B,CAC3DwP,QACAogD,yBAEF1Q,GAAQ,UACRD,GAAW,WACO,WAATtoF,EACTg5F,GAAYjxE,GAAUshB,QAAQ,4BAA6B,CACzDwP,QACAogD,yBAEF1Q,GAAQ,UACRD,GAAW,WACO,WAATtoF,EACL+4F,IAEFO,GAAuBF,GAA0BE,GAAL,GAC5CN,GAAYjxE,GAAUshB,QAAQ,qCAAsC,CAClEkwD,KAHYH,GAA0B,KAAL,GAIjCE,2BAGFN,GAAYjxE,GAAUshB,QAAQ,yCAA0C,CACtEwP,UAEF0vC,GAAQ,cACRD,GAAW,YAEK,UAATtoF,EACTg5F,GAAYjxE,GAAUshB,QAAQ,2BAA4B,CAAEwP,UAC5D0vC,GAAQ,gBACRD,GAAW,qBACO,YAATtoF,EACTg5F,GAAYjxE,GAAUshB,QAAQ,6BAA8B,CAC1DiwD,8BACD,GACiB,aAATt5F,EACTg5F,GAAYjxE,GAAUshB,QAAQ,8BAA+B,CAC3DiwD,8BACD,GACiB,SAATt5F,EAEPg5F,GADE/V,EAASxa,OAAO,SAAW,EACjB1gD,GAAUshB,QAAQ,+BAAgC,CAAEwP,UACvDoqC,EAASxa,OAAO,UAAY,EACzB1gD,GAAUshB,QAAQ,gCAAiC,CAAEwP,UAErD9wB,GAAUshB,QAAQ,+BAAgC,CAAEwP,eAAO,GAEvD,gBAAT74C,EACTg5F,GAAYjxE,GAAUshB,QAAQ,iCAAkC,CAC9D+vD,sBACAvgD,eACD,GACiB,aAAT74C,EACTg5F,GAAYjxE,GAAUshB,QAAQ,oCAA6B,GACzC,aAATrpC,GAAoC,UAAbijF,EAChC+V,GAAYjxE,GAAUshB,QAAQ,uCAAwC,CACpEwP,UAEF0vC,GAAQ,gBACRD,GAAW,qBACO,eAATtoF,EAAuB,CAChC,MAAMw5F,GAEAzxE,GAAUshB,QADL,IAAT85C,GACsB,qCACA,8CACxB6V,GAAYjxE,GAAUshB,QAAQ,gCAAiC,CAC7D85C,QACAqW,aACA3gD,UAEF0vC,GAAQ,cACRD,GAAW,EACb,KAAoB,WAATtoF,GACTg5F,GAAYjxE,GAAUshB,QAAQ,6BAC9Bk/C,GAAQ,cACRD,GAAW,IACO,oBAATtoF,GACTg5F,GAAYjxE,GAAUshB,QAAQ,sCAC9Bk/C,GAAQ,cACRD,GAAW,IACO,oBAATtoF,GACTg5F,GAAYjxE,GAAUshB,QAAQ,qCAAsC,CAClEwP,UAEF0vC,GAAQ,gBACRD,GAAW,cAEX0Q,GADkB,iBAATh5F,EACG+nB,GAAUshB,QAAQ,mCACR,UAAb45C,EACGl7D,GAAUshB,QAAQ,+BAAgC,CAC5D4vD,uBACApgD,UAGU9wB,GAAUshB,QAAQ,8BAGhCk/C,UAAQwQ,GAAW,OAASxQ,GAC5BD,GAAWyQ,GAAW,GAAKzQ,GAC3BC,GAAyB,IAAjBuQ,EAAqB,UAAYvQ,GACzCD,GAA4B,IAAjBwQ,EAAqB,GAAKxQ,GAE9B,CAAEzF,YAAamW,GAAWzQ,SAAOD,YAC1C,oQCnkBM,MAAOmR,UAAmB5xF,KACvB8lF,kBAA8C,IAAIpvF,KACvD,GAGKkjF,aACLjlF,KAAKmxF,kBAAkBxuF,MAAK,GAC5B3C,KAAK8G,OACP,EAGI,MAAOo2F,UAA0BC,KACjC,MAAOC,UAA2BD,KAClC,MAAOE,UAAyBF,2TCf9B/7F,MAHF,OAGEA,CADD,gBAC2BA,MAAA,GAC5BA,iCAD4BA,MAAA,GAAAA,MAAAqnB,EAAA9c,gDAM1BvK,MAHF,OAGEA,CADD,SAMGA,MAAA,wBAAqDA,QAEvDA,MAAA,cAGEA,MAAA,mBAAAA,MAAAqgC,GAAA,MAAA67D,EAAAl8F,QAAAmP,UAAAkY,EAAArnB,MAAA,UAAAA,MAASqnB,EAAAgjC,oBAAA6xC,EAAA52F,OAAmC,GAE5CtF,MAAA,cAAUA,MAAA,kBAEdA,yDAbIA,cAAA,OAAAk8F,EAAA52F,MAAAtF,OAIAA,cAAA,IAAAA,MAAA,iCAAAqnB,EAAA7c,MAAA,8BAWJxK,MAAA,WACEA,MAAA,GACFA,wCADEA,cAAA,IAAAk8F,EAAA/2F,IAAA,8BAGFnF,MAAA,0CAOEA,MAAA,YAAAk8F,EAAA52F,MAAAtF,gDASAA,MANF,OAMEA,CADD,UAGGA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAgtF,EAAAl8F,QAAAmP,UAAAkY,EAAArnB,MAAA,UAAAA,MAASqnB,EAAA80E,cAAAD,EAAA52F,OAA6B,GACrCtF,MAAA,GAELA,uDAJIA,cAAA,UAAAA,MAAA,EAAAoW,IAECpW,cAAAqnB,EAAA+0E,oBAAAF,EAAA52F,iDAYHtF,MARF,OAQEA,CADD,UAGGA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAA+wC,EAAAl8F,QAAAmP,UAAAkY,EAAArnB,MAAA,UAAAA,MAASqnB,EAAA80E,cAAAD,EAAA52F,OAA6B,GACrCtF,MAAA,wBAAyCA,QAE5CA,MAAA,cAGEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAA+wC,EAAAl8F,QAAAmP,UAAAkY,EAAArnB,MAAA,UAAAA,MAASqnB,EAAAgjC,oBAAA6xC,EAAA52F,OAAmC,GAE5CtF,MAAA,cAAUA,MAAA,kBAEdA,kBAXIA,cAAA,UAAAA,MAAA,EAAAoW,IAECpW,oBAAA,uEAmBHA,MARF,OAQEA,CADD,UAIGA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAusF,EAAAl8F,QAAAmP,UAAAkY,EAAArnB,MAAA,UAAAA,MAASqnB,EAAA80E,cAAAD,EAAA52F,OAA6B,GAGtCtF,MAAA,oDAOJA,4CAZIA,cAAA,OAAAk8F,EAAA52F,MAAAtF,OAOEA,cAAA,MAAAA,MAAA,IAAAA,MAAA,IAAAk8F,EAAA52F,QAAAtF,iCAONA,MAAA,2DAIEA,MAAA,YAAAA,MAAA,IAAAk8F,EAAA52F,OAAAtF,iCAtGJA,MAAA,QAkGEA,MAjGA,EAAAq8F,EAAA,WAiGAr8F,CA/FC,EAAAs8F,GAAA,WA+FDt8F,CAzFC,EAAAu8F,EAAA,WAyFDv8F,CAxEkE,EAAAw8F,EAAA,WAwElEx8F,CA5DC,EAAAy8F,EAAA,WA4DDz8F,CArDC,EAAA08F,EAAA,WAqDD18F,CAtCC,EAAA28F,EAAA,WAsCD38F,CAhBC,EAAA48F,EAAA,YAsBH58F,6CAtGKA,cAAA,kBAAAqnB,EAAA3d,QAAAusB,WAAAzgB,QAAA,QAAA0mF,EAAA/2F,KAMAnF,cAAA,kBAAAqnB,EAAA3d,QAAAusB,WAAAzgB,QAAA,QAAA0mF,EAAA/2F,KAkBgBnF,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,QAKhBxV,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,SAAA6R,EAAAw1E,SAAAX,EAAA52F,SAAA+hB,EAAAgH,MAAA6tE,EAAA52F,SAAA+hB,EAAAy1E,eAAAZ,EAAA52F,QAUAtF,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,QAAA6R,EAAAy1E,eAAAZ,EAAA52F,QAaAtF,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,SAAA6R,EAAAw1E,SAAAX,EAAA52F,SAAA+hB,EAAA01E,MAAAb,EAAA52F,QAAA+hB,EAAAgH,MAAA6tE,EAAA52F,UAAA+hB,EAAA4G,MAAAiuE,EAAA52F,QAsBAtF,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,SAAA6R,EAAAw1E,SAAAX,EAAA52F,QAAA+hB,EAAAgH,MAAA6tE,EAAA52F,QAAA+hB,EAAA4G,MAAAiuE,EAAA52F,QAuBAtF,cAAA,YAAAY,IAAAymB,EAAA3d,QAAAusB,WAAAzgB,QAAA6R,EAAAw1E,SAAAX,EAAA52F,kCApGPtF,MATF,YASEA,CADD,WAEGA,MAAA,EAAAg9F,EAAA,gCA0GJh9F,gCA1G6BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAAqnB,EAAA41E,wBAAA51E,EAAA3d,oCA4G7B1J,MAAA,oCAGEA,MADA,SAAAqnB,EAAA61E,cAAA71E,EAAA3d,QAAAusB,YAAAj2B,MACAA,CAD4C,MAAAqnB,EAAA81E,aAAA91E,EAAA3d,QAAAusB,WAAA90B,KAAAnB,QC/DvC,IAAMo9F,EAAuB,MAA9B,MAAOA,EAkDD/8F,KACAsQ,MACAu1B,UACAm3D,eACA78F,eACA4mC,cAtDFh4B,MACAkuF,aAAe,IAAI1jD,IAC3B2jD,OAAQ,EAER,UACIl7E,GACF,OAAOzjB,KAAK4+F,OACd,CACA,UAAIn7E,CAAO/c,GACT1G,KAAK4+F,QAAUl4F,EACf1G,KAAK+R,MAAM4K,eACb,CAES8D,IAEA8pB,QAET,WACIz/B,GACF,OAAO9K,KAAK6+F,QACd,CACA,WAAI/zF,CAAQpE,GACV1G,KAAK6+F,SAAWn4F,EAChB1G,KAAK+R,MAAM4K,gBACX3c,KAAK8+F,cAAc1wF,MACrB,CAEQywF,SACAD,QAEEG,WAAa,IAAIzxF,MACjBwxF,cAAgB,IAAIxxF,MACpB0xF,iBAAmB,IAAI1xF,MAKjC,SAAI1B,GACF,SAAO2S,MAAeve,KAAK8K,QAC7B,CAKA,QAAIa,GACF,SAAOiT,MAAc5e,KAAK8K,UAAY,MACxC,CAEA/K,YACU0B,EACAsQ,EACAu1B,EACAm3D,EACA78F,EACA4mC,GALAxoC,KAAAyB,OACAzB,KAAA+R,QACA/R,KAAAsnC,YACAtnC,KAAAy+F,iBACAz+F,KAAA4B,iBACA5B,KAAAwoC,gBAERxoC,KAAKy+F,eACFx+E,eACAlc,QAAKk7F,KAAUj/F,KAAK0+F,eACpB77F,UAAW2N,KACVxQ,KAAKwQ,MAAQA,IAEnB,CAEAjD,WACEvN,KAAK2+F,OAAQ,CACf,CAEAzwF,cACElO,KAAK0+F,aAAa/7F,OAClB3C,KAAK0+F,aAAap1D,UACpB,CAEAi1D,aAAa73F,GACX,OAAO1G,KAAKsnC,UAAU43D,+BAA+Bx4F,EACvD,CAEAy4F,gBACE,OACEn/F,KAAK8K,SACL9K,KAAKi+F,SAASj+F,KAAK8K,QAAQusB,aACQ,WAAnCr3B,KAAK8K,QAAQusB,WAAWzgB,QAExB5W,KAAKg/F,iBAAiB5wF,MAAK,IACpB,IAEPpO,KAAKg/F,iBAAiB5wF,MAAK,IACpB,EAEX,CAEAkwF,cAAc53F,GACZ,GAAKA,EAAMtD,KAAX,CAIA,IADkB,2BACH8G,KAAKxD,EAAMtD,MAAO,CAC/B,MAAMb,EAAM,IAAI68F,IAAI14F,EAAMnE,IAAKgF,OAAOC,SAAS6sD,QAC/C3tD,EAAMtD,KAAOsD,EAAMtD,KAAKs1B,QACtB,SACA,qBAAqBn2B,EAAI8xD,WAE7B,CAEA,OAAOr0D,KAAKsnC,UAAUhuB,wBAAwB5S,EAAMtD,KAXlD,CAYJ,CAEA66F,SAASv3F,GACP,MAAwB,iBAAVA,CAChB,CAEA62F,cAAc72F,GACZ,IAAInE,EACJ,MAAMomC,EAAqB,IAAI3+B,OAC7BhK,KAAKwoC,eAAepoC,UAAU,aAAe,gBAG/C,GAAIuoC,EAAWz+B,KAAKxD,GAClBnE,EAAMmE,EAAMw0B,MAAMyN,GAAY,GAE9B3oC,KAAKyB,KACFvB,IAAIqC,EAAK,CACRqmC,aAAc,SAEf/lC,UACEw8F,IACC,MAAMC,EAAUF,IAAIG,gBAAgBF,GACpC93F,OAAOgR,KAAK+mF,EAAS,UACrBt/F,KAAK+R,MAAM4K,eAAa,EAEzBvY,IACCpE,KAAK4B,eAAewC,MAClB,oCACA,yCAAwC,OAI3C,CACL,IAAI7B,EAAMmE,EACV,GAAI1G,KAAKk+F,eAAex3F,GAAQ,CAC9B,IAAI84F,EAAMl3F,SAASC,cAAc,OACjCi3F,EAAIlpF,UAAY5P,EAChBnE,EAAMi9F,EAAI/+D,SAAS,GAAGg/D,aAAa,OACrC,CACAl4F,OAAOgR,KAAKhW,EAAK,SACnB,CACF,CAEAktB,MAAM/oB,GACJ,GAAqB,iBAAVA,EAET,MADc,eACDwD,KAAKxD,EAEtB,CAEAy3F,MAAMz3F,GACJ,GAAqB,iBAAVA,EACT,QAAI1G,KAAKyvB,MAAM/oB,IACC,qBACDwD,KAAKxD,EAAMyxB,cAK9B,CAEA9I,MAAM3oB,GACJ,GAAqB,iBAAVA,EACT,QAAI1G,KAAKyvB,MAAM/oB,IACC,mBACDwD,KAAKxD,EAAMyxB,cAK9B,CAEA+lE,eAAex3F,GACb,MAAqB,iBAAVA,GAIK,KAFAA,EAAMw0B,MADD,QACsB,IACrBtxB,MAQxB,CAEA4zF,oBAAoB92F,GAElB,IAAIkmC,EAAOlmC,EAAMw0B,MADH,mBACgB,GAC9B0R,SAAOA,EAAKlU,QAAQ,KAAM,IACnBkU,CACT,CAEAyxD,wBAAwBvzF,GACtB,MAAM40F,EAAwB50F,EAAQuT,KAAOvT,EAAQuT,KAAKq/D,WAAQ17E,EAC5Dq1B,EAAa,GACnB,IAAIsoE,EAmBJ,OAjBI3/F,KAAKygB,KACPzgB,KAAKygB,IAAIm/E,eACN77F,QAAKk7F,KAAUj/F,KAAK0+F,eACpB77F,UAAW2N,IACVmvF,EAAqBnvF,IAKzB1F,EAAQusB,YACRvsB,EAAQusB,WAAWk5D,OACnBvwF,KAAKuqC,UACJvqC,KAAKuqC,QAAQkM,QAAQ,sBAEf3rC,EAAQusB,WAAWk5D,MAGxBmP,GACFl5F,OAAOC,KAAKi5F,GAAuBnlF,QAASilB,IAC1CnI,EAAWqoE,EAAsBlgE,IAAU10B,EAAQusB,WAAWmI,EAAK,GAE9DnI,SACyBr1B,IAAvB29F,GACJA,EAqBC70F,EAAQuT,MAAQvT,EAAQuT,KAAKwhF,yBACC/0F,EAAQuT,KAAKwhF,wBACrBtlF,QAASulF,WACxBh1F,EAAQusB,WAAWyoE,EAAS,GAMvC9/F,KAAKwQ,MAAMy6D,YACXngE,EAAQuT,MACRvT,EAAQuT,KAAK0hF,iBAEYj1F,EAAQuT,KAAK0hF,iBACrBxlF,QAASulF,WACjBh1F,EAAQusB,WAAWyoE,EAAS,IAGpC9/F,KAAKwQ,MAAMy6D,YACZngE,EAAQuT,MACRvT,EAAQuT,KAAKwhF,yBAEmB/0F,EAAQuT,KAAKwhF,wBACrBtlF,QAASulF,WACxBh1F,EAAQusB,WAAWyoE,EAAS,GAIlCh1F,EAAQusB,WACjB,CAKAo0B,oBAAoB/kD,GACCglD,KAAUC,KAAKjlD,IAEhC1G,KAAK4B,eAAe6oD,QAAQ,6BAEhC,4CA/RW+zC,GAAuBp9F,MAAAuE,MAAAvE,mBAAAwE,MAAAxE,MAAAyE,KAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA,+BAAvBy4F,EAAuBlwF,UAAA,0BAAAC,OAAA,CAAAkV,OAAA,SAAAhD,IAAA,MAAA8pB,QAAA,UAAAz/B,QAAA,WAAA0D,QAAA,CAAAuwF,WAAA,aAAAD,cAAA,gBAAAE,iBAAA,oBAAAvwF,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,ghBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD6DpC1N,MAtHA,EAAA4+F,EAAA,cAsHA5+F,CA9GC,EAAA6+F,EAAA,sBANE7+F,MAAA,OAAA2N,EAAA4vF,OAAA5vF,EAAAjE,SAAAiE,EAAAkvF,SAAAlvF,EAAAjE,QAAAusB,aAAA,WAAAtoB,EAAAjE,QAAAusB,WAAAzgB,QAqHAxV,cAAA,OAAA2N,EAAAowF,iCC1EChwF,KACAsF,KACAjF,KAAaxJ,KACbs3B,KACAZ,KACAhtB,KACAwwF,KACAluC,KACAriD,KAAiBgF,KACjB6oB,MAAe3tB,OAAA,4VAAAC,gBAAA,WAGN0uF,CAAuB,4FCtC7B,IAAM2B,EAAuB,MAA9B,MAAOA,EAiBDntF,GAhBFoJ,UAER,WAAItR,GACF,OAAO9K,KAAKoc,UAAUtR,OACxB,CACAs1F,SAAW,IAAIr+F,SAAgBC,GAErBq+F,aAAe,IAAI/yF,MAG7BgzF,aACEtgG,KAAKogG,SAASz9F,KAAK3C,KAAK8K,QAC1B,CAEA/K,YACUqc,EACApJ,GAAAhT,KAAAgT,KAERhT,KAAKoc,UAAYA,CACnB,CAEA7O,WACEvN,KAAKogG,SAASv9F,UAAU,KAClB7C,KAAK8K,QAAQw+E,UACftpF,KAAKugG,cAAY,EAGvB,CAEAA,eACE5hE,WAAW,KACT,MAAM6hE,EAAexgG,KAAKgT,GAAGC,cAAcgD,cAAc,gBACrDuqF,GACFA,EAAaC,iBAAiB,QAAS,KACrCzgG,KAAKqgG,aAAajyF,MAAI,EACvB,EAEF,EACL,4CAvCW+xF,GAAuB/+F,MAAAuE,IAAA,GAAAvE,aAAA,+BAAvB++F,EAAuB7xF,UAAA,uCAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAvB1N,MAAA,kCAAA2N,EAAAuxF,YAAY,iEAAZH,CAAuB,gFCd7B,MAAMO,EAA6B,CACxClC,IACA2B,qTC2BK,IAAMQ,EAAoB,MAA3B,MAAOA,EAIFxgE,KAKT,WACIr1B,CAAQpE,GACV1G,KAAKogG,SAASz9F,KAAK+D,EACrB,CACA,WAAIoE,GACF,OAAO9K,KAAKogG,SAAS15F,KACvB,CACS05F,SAAqC,IAAIr+F,SAAgBC,GAKxDs+B,WAAa,IAAIhzB,MAEaszF,QAExC7gG,cAAe,CAOf4gC,SAAS18B,GACP,MAAM6G,EAAU9K,KAAK6gG,kBAAkB58F,GACvCjE,KAAKsgC,WAAWlyB,KAAKtD,EACvB,CAEA81B,UACE,OAAO5gC,KAAK6gG,kBAAkB7gG,KAAK4gG,QAAQhgE,UAC7C,CAOQigE,kBAAkB58F,GACxB,MAAMozB,EAAa,GACbhZ,EAAO,QACQrc,IAAjBhC,KAAK8K,QACNuT,EAAanM,MAAKyQ,SAEnBnc,OAAO6H,OAAOgpB,EAAYr3B,KAAK8K,QAAQusB,YACvC7wB,OAAO6H,OAAOgQ,EAAMre,KAAK8K,QAAQuT,KAAM,CACrCU,YAAUD,MAAkB9e,KAAK8K,SAAW,KAKhDtE,OAAOsa,QAAQ7c,GAAMsW,QAASumF,IAC5B,MAAOv6F,GAAKG,GAASo6F,EACrB,GAAIv6F,GAAIw6F,WAHa,eAGe,CAClC,MAAM9iF,EAAW1X,GAAI+jD,OAAO02C,IAC5B3pE,EAAWpZ,GAAYvX,CACzB,IAGF,IAAI4iF,EAAWrlF,EAAKqlF,SACpB,YAAiBtnF,IAAbsnF,QAA2CtnF,IAAjBhC,KAAK8K,UACjCw+E,EAAWtpF,KAAK8K,QAAQw+E,UAGnB,CACLjrE,KAAMA,EACN7a,KAAMwpF,IACN1D,WACAtnC,WAAY,YACZ3qB,aAEJ,4CA/EWspE,EAAoB,+BAApBA,EAAoBryF,UAAA,uBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,gUClCjC1N,MAAA,mCAIEA,MAAA,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAc2N,EAAA4xB,SAAAlpB,GAAgB,GAE9BrW,MAAA,GAEAA,MAAA,wBACFA,aANEA,MADA,OAAA2N,EAAAoxB,KACA/+B,CADa,WAAAA,MAAA,IAAA2N,EAAAqxF,0BD8BHlgE,KAAexwB,MAASG,OAAA,4EAAAC,gBAAA,WAEvB6wF,CAAoB,iaEvB3B,SAAUrF,EAAkBprF,EAAqBuyC,QACjCzgD,IAAhBkO,EAAMuyC,OAOVA,EAAQA,GAEJ,IAAIsZ,IAAY,CACdt4C,OAAQ,IAAIq4C,OAElB5rD,EAAM+wF,UAAUx+C,QACQzgD,IAApBkO,EAAMuyC,MAAMhiC,KACdvQ,EAAMuQ,IAAIu7C,SAAS9rD,EAAMuyC,aAbDzgD,IAApBkO,EAAMuyC,MAAMhiC,KACdvQ,EAAMuQ,IAAIu7C,SAAS9rD,EAAMuyC,MAc/B,2DC5BO,MAAMuqC,EAAU,UAEhB,IAAK6N,EAAZ,SAAYA,GACVA,WAAAj9E,KAAA,UACAi9E,IAAAqG,KAAA,UACArG,IAAAsG,KAAA,UACAtG,IAAA59E,QAAA,aAJU49E,CAKZ,CALA,CAAYA,GAAa,iPCkCnB,SAAUuG,EACdt2F,EACAu2F,EACAzkB,GAEAA,EAAQA,GAAgBx+D,KAGxB,MAAMuuE,GADW,IAAI2U,KACM7kB,YAAY3xE,EAAS,CAC9C25C,eAAgB35C,EAAQk3C,WACxB0C,kBAAmB28C,IAGrB1U,EAAU4U,MAAM3kB,EAAM9xE,IAEtB,MAAMc,KAAQ2S,MAAezT,QACf9I,IAAV4J,GACF+gF,EAAUtsF,IAAI,SAAUuL,GAAO,QAGV5J,IAAnB8I,EAAQ0lE,QACVmc,EAAUtsF,IAAI,UAAWyK,EAAQ0lE,QAAQ,QAGhBxuE,IAAvB8I,EAAQk3C,YACV2qC,EAAUtsF,IAAI,cAAeyK,EAAQk3C,YAAY,GAGnD,MAAMw/C,KAAWzjF,MAAkBjT,EAAS,sBAC3B9I,IAAbw/F,GACF7U,EAAUtsF,IAAI,YAAamhG,GAAU,GAGvC7U,EAAUtsF,IAAI,qBAAmBye,MAAkBhU,IAAU,GAE7D,MAAMa,KAAOiT,MAAc9T,GAC3B,YAAa9I,IAAT2J,GACFghF,EAAUtsF,IAAI,QAASsL,GAAM,GAG3Bb,EAAQuT,MAAQvT,EAAQuT,KAAKlI,OAC/Bw2E,EAAUtsF,IAAI,SAAUyK,EAAQuT,KAAKlI,OAAO,GAG1CrL,EAAQlC,UACV+jF,EAAUtsF,IAAI,YAAayK,EAAQlC,UAAU,GAGxC+jF,CACT,CAEM,SAAU8U,EACdC,EACAC,EACAC,EACAP,EAAgB,aAEhB,IAAIhY,EACAz9E,EACAi2F,EACAC,EAEAF,GACFh2F,EAAQg2F,EAAQ1hG,IAAI,SAChB0hG,EAAQ1hG,IAAI,mBACd2hG,EAAUD,EAAQ1hG,IAAI,iBAAiB6/F,iBACvC+B,EAAiBF,EAAQ1hG,IAAI,iBAAiB2/F,0BAGhDj0F,EAAQ81F,EAAgBxhG,IAAI,UAG9B,MAAM6hG,EAAW,IAAIT,IACfjqE,EAAaqqE,EAAgBjiB,gBAC7BuiB,EAAeN,EAAgBO,UAErC,GAAqB,YAAjBD,EAA4B,CAC9B,MAAME,EAAOR,EAAgBS,UAC7B9Y,EAAO,IAAI+Y,KACTV,EAAgBW,qBAChB,KACAH,EAEJ,KAA4B,UAAjBF,EACT3Y,EAAO,IAAIiZ,IACTZ,EAAgBW,qBAChB,MAEwB,eAAjBL,IACT3Y,EAAO,IAAIkZ,IACTb,EAAgBW,qBAChB,OAIJ,MAAM/Y,EAAWyY,EAASjV,oBAAoBzD,EAAM,CAClD5kC,eAAgB48C,EAChB38C,kBAAmBi9C,IAGfzvF,EAAKwvF,EAAgB9kB,QAAU8kB,EAAgB9kB,SAAK,EAAKj6D,QACzD6+E,EAAWE,EAAgBxhG,IAAI,aAC/BswE,EAASC,KACbixB,EAAgB7d,YAChB8d,EACAN,GAEF,MAAO,CACL79F,KAAMwpF,IACNhrC,WAAYq/C,EACZ7wB,SACAnyD,KAAM,CACJnM,KACAtG,MAAOA,GAAgB41F,GAAsBtvF,EAC7CsvF,WACAzB,iBAAkB8B,EAClBhC,wBAAyBiC,GAE3BzqE,aACAiyD,WACAjoC,GAAIqgD,EAER,CAUM,SAAUc,EACd7V,EACAgV,EACAC,EACAP,EAAgB,aAEhB,IAAIz1F,EACAi2F,EACAC,EACAW,EACJ,MAAMV,EAAW,IAAIT,IAKfjqE,EAHOs1D,EAAUtwB,UAAU3yD,OAAQnD,IAC/BA,EAAIw6F,WAAW,MAAgB,aAARx6F,GAET2Z,OAAO,CAACC,EAAa5Z,KAC3C4Z,EAAI5Z,GAAOomF,EAAUzsF,IAAIqG,GAClB4Z,GACN,IAEGmpE,EAAWyY,EAASjV,oBAAoBH,EAAUQ,cAAe,CACrE1oC,eAAgB48C,EAChB38C,kBAAmBi9C,IAGrB,GAAIC,EAAS,CACXh2F,EAAQg2F,EAAQ1hG,IAAI,SACpB,MAAM4iD,EAAgB8+C,EAAQ1hG,IAAI,iBAC9B4iD,IACF++C,EAAU/+C,EAAci9C,iBACxB+B,EAAiBh/C,EAAc+8C,wBAC/B4C,EACE3/C,EAAc2/C,WACU,eAAvB3/C,EAAct/C,MACQ,mBAAvBs/C,EAAct/C,KACV,gBACAxB,GAEV,MACE4J,EAAQ+gF,EAAUzsF,IAAI,UAExB,MAAMshG,EAAW7U,EAAUzsF,IAAI,aACzBgS,EAAKy6E,EAAU/P,QACjB+P,EAAU/P,QACV+P,EAAUzsF,IAAIuiG,GACZ9V,EAAUzsF,IAAIuiG,IAAQ,EACtB9/E,QAGN,OAFmBgqE,EAAUzsF,IAAI,eAE1B,CACLsD,KAAMwpF,IACNhrC,WAAYq/C,EACZ7wB,OAAQmc,EAAUzsF,IAAI,WACtBme,KAAM,CACJnM,KACAtG,MAAOA,GAAgB41F,GAAsBtvF,EAC7CsvF,WACAziF,SAAU4tE,EAAU+V,cACpBvsF,MAAOw2E,EAAUzsF,IAAI,UACrB6/F,iBAAkB8B,EAClBhC,wBAAyBiC,GAE3BzqE,aACAiyD,WACAjoC,GAAIsrC,EAER,CAsCM,SAAUgW,EACd1+C,EACAjC,GAEA,MAAMwuB,EAASoyB,OAEf3+C,SAAW1pC,QAASoyE,IAClB,MAAMkW,EArCJ,SAAUC,EACdnW,EACA3qC,GAEA,IAAI+gD,EAAWH,OAEf,MAAMI,EAAkBrW,EAAUzsF,IAAI,WAChC+iG,EAAsBtW,EAAUzsF,IAAI,eAC1C,QAAwB8B,IAApBghG,QAAyDhhG,IAAxBihG,EACnCF,EAAWtyB,KACTuyB,EACAC,EACAjhD,OAEG,CACL,MAAMkhD,EAAavW,EAAUQ,cACV,OAAf+V,IACFH,EAAWG,EAAWrf,YAE1B,CAEA,OAAOkf,CACT,CAe0BD,CAAuBnW,EAAW3qC,GACxD4gD,KAAgBpyB,EAAQqyB,EAAa,GAGhCryB,CACT,CAQM,SAAU2yB,EACd3yB,EACA8Q,GAEA,MAAOpiD,EAAOD,GAAU2jE,KAAiBpyB,GACzC,MAAO,CACL8Q,EAAM,GAAK9Q,EAAO,GAAKtxC,EAAQoiD,EAAM,GAAK9Q,EAAO,GACjD8Q,EAAM,GAAK9Q,EAAO,GAAKvxC,EAASqiD,EAAM,GAAK9Q,EAAO,GAClD8Q,EAAM,GAAK9Q,EAAO,GAAKtxC,EAAQoiD,EAAM,GAAK9Q,EAAO,GACjD8Q,EAAM,GAAK9Q,EAAO,GAAKvxC,EAASqiD,EAAM,GAAK9Q,EAAO,GAEtD,CAYM,SAAU4yB,EACd5yB,EACA6yB,EACAC,EAA+B,KAE/B,MAAMC,EAAahoF,MAAMC,QAAQ8nF,GAC7BA,EACA,CAACA,EAAWA,EAAWA,EAAWA,GAEhCE,EAAaL,EACjB3yB,EAFY,EAAC,GAAI,GAAI,GAAI,GAAI/vD,IAAI,CAACszD,EAAG3kC,IAAM2kC,EAAIwvB,EAAWn0D,KAM5D,OAAQwzD,KAAwBY,EAAYH,EAC9C,CAYM,SAAUI,EACdvhD,EACAmhD,EACAK,GAIAA,EAAYA,GAAwB,KACpC,MAAMC,EAAYzhD,EAAe2hC,YAC3B+f,EAAgBhB,KAAiBe,GACjCE,EAAqBjB,KAAiBS,GAE5C,QAA2B,IAAvBQ,GAA4B3hD,EAAeH,UAAY,KAKpD8hD,EAAqBD,EAAgBF,CAC9C,CAWM,SAAUI,EACd5hD,EACA+B,EACA22C,EAAwBC,IAAc59E,QACtCqkE,EACAoiB,GAEA,MAAMlzB,EAAStuB,EAAe2hC,YAExBwf,EAAiBV,EAAwB1+C,EAD5B/B,EAAe6hD,mBAElC,IAAIP,EAAaH,OACHrhG,IAAVs/E,IACFkiB,EAAaL,EAAYK,EAAYliB,IAGnCsZ,IAAWC,IAAcsG,KAC3Bj/C,EAAeoqC,aAAakX,GACnB5I,IAAWC,IAAcqG,KAClCh/C,EAAe45C,aAAa0H,GACnB5I,IAAWC,IAAc59E,UAEhCmmF,EAAqB5yB,EAAQ6yB,IAC7BI,EAAyBvhD,EAAgBmhD,EAAgBK,KAEzDxhD,EAAeoqC,aAAakX,EAGlC,CAMM,SAAUQ,GAAcrX,GAC5BA,EAAUsX,SAAS,IAAIC,KAAc,IACvC,CAQM,SAAUC,EACd1gF,EACA7M,GAKA,MAAMwtF,EAAgB,IAAIllF,IAC1BtI,EAAO2D,QAASoyE,IACdyX,EAAc/jG,IAAIssF,EAAU/P,QAAS+P,EAAS,GAGhD,MAAM0X,EAAqB,GAC3B5gF,EAAOlJ,QAASoyE,IACd,MAAM2X,EAAeF,EAAclkG,IAAIysF,EAAU/P,cAC5B56E,IAAjBsiG,GAGFA,EAAapkG,IAAI,qBAAuBysF,EAAUzsF,IAAI,mBAFtDmkG,EAAmB/8F,KAAKqlF,GAMxByX,EAAcp7F,OAAOs7F,EAAa1nB,QAAO,GAI7C,MAAM2nB,EAAqBhpF,MAAMmE,KAAK0kF,EAAc39F,QAKpD,MAAO,CACLmnC,IALsBh3B,EAAOlN,OAAQijF,GAC9B4X,EAAmB77F,QAAQikF,EAAU/P,UAAY,GAKxDn8E,OAAQ4jG,EAEZ,6UCtbM,MAAOG,UAA4C/8E,KAQjC5nB,QAJd4kG,SAAW,IAAIvlF,IACfwlF,aAA+B,GAC/BC,QAER5kG,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,SAEtB,CAMA8lB,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,GAElBlQ,KAAK2kG,QAAUz0F,EAAM4R,OAAOjf,UAAU,IACpC7C,KAAK6kG,2BACH30F,EACAA,EAAMuyC,MAAMhiC,IAAIyhC,eAAe4iD,iBAGrC,CAMAh/E,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMU4X,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CAMQJ,WAAW10F,GACblQ,KAAKykG,SAASl8E,IAAIrY,KAItBlQ,KAAK6kG,2BACH30F,EACAA,EAAMuyC,MAAMhiC,IAAIyhC,eAAe4iD,iBAEjC9kG,KAAK0kG,aAAap9F,KAChB4I,EAAMuyC,MAAMhiC,IAAIyhC,eAAe+iD,YAC5BlhG,QAAKof,KAAa,MAClBtgB,UAAW86C,IACV39C,KAAK6kG,2BAA2B30F,EAAOytC,EAAG,IAGlD,CAEQknD,2BAA2B30F,EAAOg1F,GAKtCh1F,EAAMM,MAAM8P,UAHZ4kF,EAAgBh1F,EAAMuyC,MAAMmvB,eAC5BszB,EAAgBh1F,EAAMuyC,MAAMgvB,cAEN,CAAE0zB,iBAAiB,GAEnB,CAAEA,iBAAiB,GAE7C,CAMQJ,aAAa70F,QAEPlO,IADAhC,KAAKykG,SAASvkG,IAAIgQ,IAE5BlQ,KAAKykG,SAASz7F,OAAOkH,EAEzB,CAKQ80F,aACNhlG,KAAKykG,SAAS39F,QACd9G,KAAK0kG,aAAajkF,IAAKjQ,GAAUA,EAAMrC,eACnCnO,KAAK2kG,SACP3kG,KAAK2kG,QAAQx2F,aAEjB,sCClGI,MAAOi3F,UAA8B39E,KAc7B5nB,QACFwlG,4BACA3wB,oBAZF+vB,SAAW,IAAIvlF,IACfomF,SAA2B,GAC3BX,QAKSlkF,IAEjB1gB,YACYF,EACFwlG,EACA3wB,GAERtuE,MAAMvG,GAJIG,KAAAH,UACFG,KAAAqlG,8BACArlG,KAAA00E,sBAGR10E,KAAKygB,IAAM5gB,EAAQ4gB,GACrB,CAMAkF,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,EAEpB,CAMA4V,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMU4X,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CAMQJ,WAAW10F,GACblQ,KAAKykG,SAASl8E,IAAIrY,KAItBlQ,KAAKulG,8BAA8Br1F,GACnClQ,KAAKslG,SAASh+F,KACZtH,KAAKygB,IAAI0hC,QACNp+C,QAAKof,KAAa,MAAG,EAAGqiF,QACxB3iG,UAAU,EAAE4iG,EAAYtiD,MACvB,IAAIuiD,EACAD,IACFC,EAAeD,EAAWhlF,IAAKs/B,GAAMA,EAAE7tC,KAEzC,MAAM4tC,EAASqD,EAAcz5C,OAC1Bq2C,IAAO2lD,EAAa1tE,SAAS+nB,EAAE7tC,KAElClS,KAAKulG,8BAA8Br1F,EAAO4vC,EAAM,IAGtD9/C,KAAKslG,SAASh+F,KACZ4I,EAAMuU,UAAU1gB,QAAKof,KAAa,MAAMtgB,UAAWy/C,IACjDtiD,KAAKulG,8BAA8Br1F,EAAK,IAG9C,CAEQq1F,8BAA8Br1F,EAAqB4vC,GACzD,MAAM6lD,EAAW3lG,KAAKygB,IAAIq/B,OAAOr/B,IAAKs/B,GAAMA,EAAE7tC,IAC9C,IAAIsN,EAAsB,GAExBA,EADEsgC,EACS5vC,EAAMuU,UAAU/d,MAEbwJ,EAAMwU,UAAUzC,MACbrY,OACbsG,EAAMwU,UACHzC,MACAvY,OAAQkS,IAAOA,EAAEpL,MAAMo1F,YACvBnlF,IAAKkrB,GAAMA,EAAE3tB,QAChB9N,EAAMuU,UAAU/d,MAEtB,MACMm/F,EAASrmF,EAASqE,MAAM,EADbrE,EAAS5V,QAAU,IAAM,IAAM4V,EAAS5V,QAEzD,IAAI2W,EAAU,GACdslF,EAAOplF,IAAKkrB,IACVprB,EAAUA,EAAQI,OAAOna,OAAOC,KAAKklC,EAAEtU,YAAc,IAAG,GAE1D9W,EAAU,IAAI,IAAIG,IAAIH,IACtB,MAAMulF,EAAiB,GACvBvlF,EAAQE,IAAKulB,IACX8/D,EAAe9/D,GAAK,IACf,IAAItlB,IAAIlB,EAASiB,IAAKoX,GAASA,EAAKR,WAAW2O,KAAI,GAG1D,MAAM+/D,EAAqB,GAC3Bv/F,OAAOsa,QAAQglF,GAAgBvrF,QAASumF,IACtC,MAAOv6F,EAAKoV,GAAUmlF,EAChBkF,EAAuBrqF,EAAOjS,OAAQhD,GAC1C1G,KAAKqlG,4BAA4BY,aAAav/F,IAE5Cs/F,GAAsBp8F,SACxBm8F,EAAmBx/F,GAAOy/F,KAS9B,MAAME,EAAkD,GACxD1/F,OAAOsa,QAAQilF,GAAoBxrF,QAASumF,IAC1C,MAAOv6F,EAAKoV,GAAUmlF,EACtBnlF,EAAO8E,IAAK/Z,IACV,MAAMk/F,EAAa5lG,KAAKqlG,4BAA4Bc,cAClDz/F,EACA6Z,GAEF,GAAIqlF,EAAY,CACd,MAAMQ,EAAyB7lF,EAAQ7W,OAAQC,IAC7Ci8F,EAAWQ,uBAAuBpuE,SAASruB,KAGvC08F,GAAuBD,EAAuBx8F,OAChDw8F,EAAuB,QACvBpkG,EACAqkG,IACFH,EAAuB5+F,KAAK,CAC1B/E,IAAKmE,EACL4/F,YAAa//F,EACbggG,kBAAmBF,GACnBT,cAGN,GACD,GAEH,MAAMY,EAGA,GACNN,EAAuBzlF,IAAKgmF,IAC1B,MAAMlkG,EAAMkkG,EAAsBlkG,IAC5BiB,EAAOijG,EAAsBb,WAAWpiG,MAAQ,MACtDsiG,EAAeW,EAAsBF,mBAAmB9lF,IACrDuzD,IACC,IACI0yB,EADAC,EAAmB3yB,EAGrB,CAAC,aAAc,kBAAmB,kBAAkBh8C,SAASx0B,KAE7DmjG,OAAmB3kG,EACnB0kG,EAAkB1yB,GAEpB,MAAM4yB,GAAKrqF,KAAY+0D,gBAAgB,CACrCxuB,cAAe,CACbt/C,KAAMA,GAAQ,MACdjB,MACA8vE,yBAAyB,EACzBiE,gBAAgB,EAChBvvE,OAAQ,CACN0vD,OAAQkwC,EACRE,MAAOH,MAIPI,MAAmBrvB,MACvBmvB,GAAG9jD,eAEL0jD,EAAiBl/F,KAAK,CACpBm/F,wBACAj2F,MAAO,CACLypB,WAAwDj4B,IAAjD2jG,EAASvjF,KAAM29B,IAAMA,KAAM+mD,IAClCC,0BAA0B,EAC1BvjG,OACAjB,MACAyxE,cAEH,EACF,GAGLwyB,EAAiB/lF,IAAKumF,IACpB,MAAMV,EAAcU,EAAgBP,sBAAsBH,YACpDC,EACJS,EAAgBP,sBAAsBF,kBAElCU,EAAWD,EAAgBx2F,MAAMjO,IACjC2kG,EAAiBF,EAAgBx2F,MAAMwjE,UACvCmzB,EAAoB3nF,EAAS9V,OAChCiiC,IACCA,GAAEtU,WAAWivE,KAAiBW,GAC9Bt7D,GAAEtU,WAAWkvE,KAAuBW,GAKxCh3F,EAAMM,MAAMqP,WAAWsnF,EAHZ,CACTvB,WAAYoB,EAAgBx2F,QAEgB,EAAI,EAEtD,CAMQu0F,aAAa70F,QAEPlO,IADAhC,KAAKykG,SAASvkG,IAAIgQ,IAE5BlQ,KAAKykG,SAASz7F,OAAOkH,EAEzB,CAKQ80F,aACNhlG,KAAKykG,SAAS39F,QACd9G,KAAKslG,SAAS7kF,IAAKjQ,GAAUA,EAAMrC,eAC/BnO,KAAK2kG,SACP3kG,KAAK2kG,QAAQx2F,aAEjB,2BC3PI,MAAOi5F,UAAyC3/E,KAM9B5nB,QAFd4kG,SAAW,IAAIvlF,IAEvBnf,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,SAEtB,CAMA8lB,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,EAEpB,CAMA4V,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMU4X,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CAMQJ,WAAW10F,GACblQ,KAAKykG,SAASl8E,IAAIrY,KAItBlQ,KAAKqnG,gBAAgBn3F,GACJA,EAAMuyC,MAAMpB,GAAGsC,YACvBrU,GAAG,SAAW5lB,IACrB1pB,KAAKqnG,gBAAgBn3F,EAAK,GAE9B,CAMQ60F,aAAa70F,QAEPlO,IADAhC,KAAKykG,SAASvkG,IAAIgQ,IAE5BlQ,KAAKykG,SAASz7F,OAAOkH,EAEzB,CAKQ80F,aACNzpF,MAAMmE,KAAK1f,KAAKykG,SAAS3jF,WAAWvG,QACjCuG,OAEH9gB,KAAKykG,SAAS39F,OAChB,CAOQugG,gBAAgBn3F,GACtB,IAAI+zC,EAAa/zC,EAAMuyC,MAAMpB,GAAGsC,YAAYQ,cAExCj0C,EAAMuyC,MAAMpsB,sBAAsBulC,MACpC3X,EAAcA,EAAmBG,QAASC,GACxCA,EAAQnkD,IAAI,cAGU,IAAtB+jD,EAAWr6C,OACbsG,EAAMpJ,QAENoJ,EAAMo3F,mBAAmBrjD,EAE7B,uCC3GI,MAAOsjD,UAAwC9/E,KAM7B5nB,QAFd4kG,SAAW,IAAIvlF,IAEvBnf,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,SAEtB,CAMA8lB,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,EAEpB,CAMA4V,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMU4X,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CAEQwC,qBAAqBt3F,GAC3BA,EAAMu3F,eAAiB,IAAIC,WAAmB,CAAEC,SAAU,QAC5D,CAMQ/C,WAAW10F,GACblQ,KAAKykG,SAASl8E,IAAIrY,KAGtBlQ,KAAKwnG,qBAAqBt3F,GAE1BA,EAAMuU,UACH1gB,QAAK6jG,KAAWj8D,IAAOA,EAAE/hC,SACzB/G,UAAU,IAAM7C,KAAK6nG,kBAAkB33F,IAC5C,CAMQ60F,aAAa70F,QAEPlO,IADAhC,KAAKykG,SAASvkG,IAAIgQ,KAE5BA,EAAMu3F,oBAAiBzlG,EACvBhC,KAAKykG,SAASz7F,OAAOkH,GAEzB,CAKQ80F,aACNzpF,MAAMmE,KAAK1f,KAAKykG,SAAS3jF,WAAWvG,QACjCuG,OAEH9gB,KAAKykG,SAAS39F,OAChB,CAMQ+gG,kBAAkB33F,GACxB,MAAMyrE,EAAQ37E,KAAKH,QAAQioG,2BAA6B,EAClDC,EAAqB,GAC3B73F,EAAM+O,MAAM1E,QAAQ,CAAC7T,EAAOH,KAC1B,MAAMyhG,EAAKthG,EAAM2wB,WACjB2wE,EAAGC,YAAc1hG,EACjBwhG,EAAmBzgG,KAAK0gG,EAAE,GAE5B,MAAM3d,EAAU,GAChB,IAAI6d,EAAoB,GACpBC,EAAiB,GACrB,GAAInoG,KAAKH,QAAQ+zE,aACfs0B,EAAoBloG,KAAKH,QAAQ+zE,aAAalqE,OAC3CkvE,IAAQA,EAAGwvB,aAAaz3D,SAE3Bw3D,EAAiBnoG,KAAKH,QAAQ+zE,aAC3BlqE,OAAQkvE,GAAOA,EAAGwvB,aAAaz3D,SAC/BlwB,IAAK4nF,GACG7hG,OAAO6H,OACZ,GACA,CAAEmxB,MAAO6oE,EAAIr5E,KAAM24E,SAAU,QAC7BU,EAAID,mBAEP,GAECL,EAAmBn+F,OAAQ,CAE7B,MAAM+sB,EAAUnwB,OAAOC,KAAKshG,EAAmB,IACzCO,EAAiB,GACvBJ,EAAoBvxE,EACjBlW,IAAKmW,IACJ,MAAMkvE,EAAiB,IAClB,IAAIplF,IAAIqnF,EAAmBtnF,IAAKoX,GAASA,EAAKjB,MAIhDkvE,EAAel8F,OAASm+F,EAAmBn+F,OAAU,KACpD+xE,GACFmqB,EAAe7hF,MAAOskF,GAAMptE,OAAOotE,KAAOA,GAAKA,EAAI,GAAM,GAEzDL,EAAkB5gG,KAAKsvB,GAEvB0xE,EAAehhG,KAAKsvB,EAAM,GAG7BltB,OAAQy8B,GAAMA,GAEjBgiE,EADoBG,EAAe5+F,OAAQy8B,GAAY,gBAANA,GACpB1lB,IAAKla,KACvBi5B,MAAOj5B,EAAKohG,SAAU,SAEnC,CAEFz3F,EAAM+O,MAAM1E,QAAQ,CAAC7T,EAAOH,KAC1B,MAAMiiG,EAAoBvwE,KAAKC,MAAMD,KAAKouB,UAAU3/C,EAAM2wB,aAC1D6wE,EAAkBznF,IAAKuZ,UAAawuE,EAAkBxuE,IAClDxzB,OAAOC,KAAK+hG,GAAmB5+F,QACjCygF,EAAQ/iF,KAAKkhG,EAAiB,GAIX,IAAnBne,EAAQzgF,OACV5J,KAAKwnG,qBAAqBt3F,IAE1BA,EAAMu3F,eAAiB,IAAIC,WAAmB,CAC5Cp/F,SAAU,CACR4J,GAAI,cACJ+M,MAAOkpF,KAGX9d,EAAQ5pE,IAAK2uB,IACXl/B,EAAMu3F,eAAe75D,IAAIwB,EAAE64D,YAAa74D,EAAC,GAG/C,mHCxJI,MAAO+tD,UAAkD9xF,KAI7Do3C,MAKShiC,IAKT,UAAIgD,GACF,OAAOzjB,KAAKyiD,MACPziD,KAAKyiD,MAAMpsB,gBACZr0B,CACN,CAKA,kBAAIylG,CAAepuF,GACjBrZ,KAAKyoG,gBAAkBpvF,CACzB,CAEA,kBAAIouF,GACF,OAAOznG,KAAKyoG,eACd,CACQA,gBAER1oG,YAAYyf,EAAe3f,GACzBuG,MAAMoZ,EAAU3f,GAChBG,KAAKygB,IAAM5gB,EAAQ4gB,GACrB,CAOAwgF,UAAUx+C,GACR,OAAAziD,KAAKyiD,MAAQA,EACNziD,IACT,CAQA0oG,iBACEn+F,EACAqwF,EAAwBC,IAAc59E,QACtC0rF,EACAjF,EACA9mB,GAEAA,EAAQA,GAAgBx+D,KACxBpe,KAAK4oG,aAEL,MAAM3kD,EAAa15C,EAASkW,IAAK3V,MAC/Bs2F,MAAYt2F,EAAS9K,KAAKygB,IAAIuhC,WAAY46B,IAE5C58E,KAAK6oG,mBAAmB5kD,EAAY22C,EAAQ+N,EAAWjF,EACzD,CAMA4D,mBAAmBrjD,GACjBjkD,KAAK4oG,aAEL,MAAMr+F,EAAW05C,EAAWxjC,IAAKksE,IAC/BA,EAAUtsF,IAAI,gBAAiBL,MAAM,IAAI,EAClCwiG,MAAc7V,EAAW3sF,KAAKyiD,MAAMhiC,IAAIuhC,cAEjDhiD,KAAKklB,KAAK3a,EACZ,CAKAu+F,aACE9oG,KAAK4oG,aACL5oG,KAAKyjB,OAAO49B,GAAGv6C,OACjB,CAKQ8hG,aACN,QAAmB5mG,IAAfhC,KAAKyiD,MACP,MAAM,IAAIzgC,MAAM,6CAEpB,CAOO6mF,mBACL5kD,EACA22C,EAAwBC,IAAc59E,QACtC0rF,EACAjF,GAEA,MAAMqF,EAAW/oG,KAAKyiD,MAAMpB,GAAGsC,YACzB8tC,KAAO0S,MAAsB4E,EAAS5kD,cAAeF,GACvDwtC,EAAKhxF,OAAOmJ,OAAS,GACvB5J,KAAKgpG,0BAA0BvX,EAAKhxF,QAGlCgxF,EAAK7jD,IAAIhkC,OAAS,GACpB5J,KAAKipG,qBAAqBxX,EAAK7jD,KAG7B6jD,EAAK7jD,IAAIhkC,OAAS,KAEpBk6F,MACE9jG,KAAKygB,IAAIyhC,eACTuvC,EAAK7jD,IACLgtD,EACA+N,EACAjF,GAEOjS,EAAKhxF,OAAOmJ,OAAS,MAE9Bk6F,MACE9jG,KAAKygB,IAAIyhC,eACT+B,EACA22C,EACA+N,EACAjF,EAGN,CAEAwF,iBACE,IAAI3+F,EAAWvK,KAAKykB,UAAUkV,WAC1B62C,EAASoyB,OACT3+C,EAAa,GAEjB15C,EAASgQ,QAASzP,IAChBm5C,EAAW38C,QAAK85F,MAAYt2F,EAAS9K,KAAKygB,IAAIuhC,YAAW,GAE3D,MAAMqhD,KAAiBV,MACrB1+C,EACAjkD,KAAKygB,IAAI0oF,gBAEXvG,KAAgBpyB,EAAQ6yB,GACxBrjG,KAAKyiD,MAAM2mD,UAAU54B,EACvB,CAKQy4B,qBAAqBhlD,GAC3BA,EAAW1pC,QAASoyE,IAClBA,EAAUtsF,IAAI,gBAAiBL,MAAM,EAAI,GAE3CA,KAAKyjB,OAAO49B,GAAGwa,YAAY5X,EAC7B,CAMQ+kD,0BAA0B/kD,GAChCA,EAAW1pC,QAASoyE,IAClB3sF,KAAKyjB,OAAO49B,GAAGw7B,cAAc8P,EAAS,EAE1C,sFChMI,SAAU4O,EACdrrF,EACAsV,QAE6DxjB,IAAzDkO,EAAM6V,kBAAkB8pE,MAK5BrqE,EAAWA,GAAsB,IAAIqqE,IAA4B,IACjE3/E,EAAMqV,YAAYC,GAClBA,EAASC,YANPvV,EAAM8V,uBAAuB6pE,IAOjC,CAQM,SAAUwZ,EACdn5F,EACAsV,QAE+DxjB,IAA3DkO,EAAM6V,kBAAkBujF,MAI5B9jF,EAAWA,GAEP,IAAI8jF,IAA8B,CAChC7oF,IAAKvQ,EAAMuQ,MAEjBvQ,EAAMqV,YAAYC,GAClBA,EAASC,YATPvV,EAAM8V,uBAAuBsjF,IAUjC,oGC3BM,MAAOC,UAAwC9hF,KAQ7B5nB,QAJd4kG,SAAW,IAAIvlF,IACfomF,SAA2B,GAC3BX,QAER5kG,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,SAEtB,CAMA8lB,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,GAElBlQ,KAAK2kG,QAAUz0F,EAAM4R,OAClB/d,QAAK6jG,KAAWx3F,IAAWA,IAC3BvN,UAAU,IAAM7C,KAAKwpG,uBAAuBt5F,GACjD,CAMA4V,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMU4X,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CAMQJ,WAAW10F,GACblQ,KAAKykG,SAASl8E,IAAIrY,KAItBlQ,KAAKwpG,uBAAuBt5F,GAC5BlQ,KAAKslG,SAASh+F,KACZ4I,EAAMuyC,MAAMhiC,IAAIyhC,eAAewX,OAC5B31D,QAAKof,KAAa,MAClBtgB,UAAU,IAAM7C,KAAKwpG,uBAAuBt5F,KAEnD,CAEQs5F,uBAAuBt5F,GAC7B,GAAIA,GAAOuyC,OAAOhiC,KAAKyhC,eAAgB,CACrChyC,EAAMM,MAAM8P,UAAU,CAAEmpF,aAAa,IACrC,MAAM9F,EAAYzzF,EAAMuyC,MAAMhiC,IAAIyhC,eAAe2hC,YAE3C6lB,EAAsB1pG,KAAK2pG,oBADhBz5F,EAAMuU,UAAU/d,MAC8Bi9F,GAC/DzzF,EAAMM,MAAMqP,WAAW6pF,EAAqB,CAAED,aAAa,IAAQ,EACrE,CACF,CAEQE,oBACNp/F,EACAimE,GAEA,OAAOjmE,EAAS2V,OAAO,CAACC,EAAKrV,KAC3B,MAAMu+E,EAAOv+E,EAAQu2C,IAAI8rC,cACzB,GAAI9D,EAAM,CACR,MAAMwZ,EAAgBxZ,EAAKxF,YAEvB+e,KAAoBC,EAAeryB,IACrCrwD,EAAI7Y,KAAKwD,EAEb,MAEEqV,EAAI7Y,KAAKwD,GAEX,OAAOqV,GACN,GACL,CAMQ4kF,aAAa70F,QAEPlO,IADAhC,KAAKykG,SAASvkG,IAAIgQ,IAE5BlQ,KAAKykG,SAASz7F,OAAOkH,EAEzB,CAKQ80F,aACNhlG,KAAKykG,SAAS39F,QACd9G,KAAKslG,SAAS7kF,IAAKjQ,GAAUA,EAAMrC,eAC/BnO,KAAK2kG,SACP3kG,KAAK2kG,QAAQx2F,aAEjB,6ECvHI,MAAO0hF,UAAoCpoE,KAQzB5nB,QAJd4kG,SAAW,IAAIvlF,IAEf07E,OAER76F,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,UAEpBG,KAAK4pG,UAAU/pG,EAAQ+6F,OACzB,CAMAj1E,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QACP3nB,KAAK4kG,WAAW10F,EAEpB,CAMA4V,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QACP3nB,KAAK+kG,aAAa70F,EAEtB,CAMA05F,UAAUhP,GACR56F,KAAK46F,OAASA,CAChB,CAMU9yE,aACR9nB,KAAK0nB,OAAOnN,QAASrK,GAAwBlQ,KAAK4kG,WAAW10F,GAC/D,CAMU2X,eACR7nB,KAAKglG,YACP,CASQJ,WAAW10F,GACjB,GAAIlQ,KAAKykG,SAASl8E,IAAIrY,GACpB,OAGF,MAAM25F,EAAe35F,EAAMC,KACxBO,OACA7N,UAAW0H,GACVvK,KAAK8pG,iBAAiBv/F,EAAU2F,IAEpClQ,KAAKykG,SAASpkG,IAAI6P,EAAO25F,EAC3B,CAMQ9E,aAAa70F,GACnB,MAAM25F,EAAe7pG,KAAKykG,SAASvkG,IAAIgQ,QAClBlO,IAAjB6nG,IACFA,EAAa17F,cACbnO,KAAKykG,SAASz7F,OAAOkH,GAEzB,CAKQ80F,aACNzpF,MAAMmE,KAAK1f,KAAKykG,SAAS3jF,WAAWvG,QACjCuG,IACCA,EAAQ,GAAG3S,aAAW,GAG1BnO,KAAKykG,SAAS39F,OAChB,CAOQgjG,iBAAiBv/F,EAAqB2F,GACpB,IAApB3F,EAASX,OACXsG,EAAM44F,aAEN54F,EAAMw4F,iBACJn+F,EACAvK,KAAK+pG,aAAa75F,GAClBlQ,KAAKH,QAAQ8oG,UACb3oG,KAAKH,QAAQ6jG,UACb1jG,KAAKH,QAAQmqG,aAGnB,CAOQD,aAAa75F,GACnB,YAAoBlO,IAAhBhC,KAAK46F,OACA56F,KAAK46F,QAGS,IAAnB1qF,EAAM0U,UAGC1U,EAAM2R,MAAQ3R,EAAMC,KAAK0R,MAD3Bg5E,IAAc59E,QAMd49E,IAAcj9E,IAEzB,oMCrII,MAAOqsF,UAAgCC,IAC3CnqG,YAAYF,GACVuG,MAAMvG,EACR,EAaI,MAAOypG,UAAsC7hF,KAkC3B5nB,QA7BdsqG,iBAEAC,wBAEAC,8BAKA5F,SAEA7J,OAKR,OAAIn6E,GACF,OAAOzgB,KAAKH,QAAQ4gB,GACtB,CAMA,gBAAI6pF,GACF,OAAOtqG,KAAKuqG,aACd,CACQA,cAERxqG,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,UAEpBG,KAAK4pG,UAAU/pG,EAAQ+6F,QACvB56F,KAAKuqG,cAAgBvqG,KAAKwqG,oBAC5B,CAOA7kF,UAAUzV,GACR9J,MAAMuf,UAAUzV,IACI,IAAhBlQ,KAAK2nB,QAEP3nB,KAAKylB,UAET,CAOAK,YAAY5V,GACV9J,MAAM0f,YAAY5V,IACE,IAAhBlQ,KAAK2nB,QAEP3nB,KAAKylB,UAET,CAMAmkF,UAAUhP,GACR56F,KAAK46F,OAASA,CAChB,CAKA6P,cACEzqG,KAAK0nB,OAAOnN,QAASrK,IACnBA,EAAMM,MAAM8P,UAAU,CAAEkI,UAAU,GAAO,EAE7C,CAKA1hB,QACE9G,KAAKsqG,aAAa7mF,OAAO49B,GAAGv6C,QAC5B9G,KAAKsqG,aAAaxjG,OACpB,CAMA4jG,sBACE1qG,KAAK2qG,qBACL3qG,KAAK4qG,2BACL5qG,KAAKglG,YACP,CAOUl9E,aACR9nB,KAAK6qG,kBACL7qG,KAAK8qG,oBACwB,IAAzB9qG,KAAKH,QAAQkrG,SACf/qG,KAAKgrG,wBAEPhrG,KAAKirG,UACP,CAOUpjF,eACR7nB,KAAK0qG,sBACL1qG,KAAKkrG,oBACP,CAQQD,WACNjrG,KAAKglG,aAEL,MAAMmG,EAAUnrG,KAAK0nB,OAAOjH,IAAKvQ,GACxBA,EAAMwU,UACVnC,QAASgE,IACyB,IAA1BA,EAAO/V,MAAMgY,UAErBzkB,QACC0c,KAAK8I,GACHA,EAAQ9I,IAAK8F,GAAWA,EAAOvI,WAIvChe,KAAKykG,YAAWxhF,KAAckoF,GAC3BpnG,QACCof,KAAa,IAAC,EACdD,KAAK,IAAC,EACNzC,KAAKlW,GACHA,EAAS2V,OAAO,CAACoiC,EAAGC,IAAMD,EAAE3hC,OAAO4hC,MAGtC1/C,UAAW0H,GAAwBvK,KAAKwpB,kBAAkBjf,GAC/D,CAKQy6F,kBACgBhjG,IAAlBhC,KAAKykG,UACPzkG,KAAKykG,SAASt2F,aAElB,CAOQ28F,mBACN9qG,KAAKmqG,iBAAmBnqG,KAAKygB,IAAI4gC,GAAG/R,GAClC,cACC5lB,IACC1pB,KAAKorG,WAAW1hF,EAAK,EAG3B,CAKQihF,sBACNU,OAAQrrG,KAAKmqG,iBACf,CAMQiB,WAAW1hF,GACjB,MAAM9J,IAAY,EAAC0rF,MAAY5hF,GACzB3J,GAAWH,EACXqkC,EAAav6B,EAAMjJ,IAAI8qF,mBAAmB7hF,EAAM8hF,MAAO,CAC3Drb,aAAcnwF,KAAKH,QAAQswF,cAAgB,EAC3Csb,YAAc7J,SAIY5/F,IAHHhC,KAAK0nB,OAAOtF,KAAMlS,GAC9BA,EAAMuyC,OAAOpB,KAAOugD,MAKjC5hG,KAAK0rG,gBAAgBznD,EAAYrkC,EAAWG,EAC9C,CAKQirF,wBACN,IAAIZ,EACJ,MAAMuB,EAAiB3rG,KAAKygB,IAAI4gC,GAAGuqD,kBAAkB9a,WAKrD,UAAWZ,KAAiByb,EAC1B,GAAIzb,aAAyB+Z,EAAyB,CACpDG,EAA0Bla,EAC1B,KACF,MAG8BluF,IAA5BooG,IACFA,EAA0B,IAAIH,EAAwB,CACpD19D,UAAW++D,OAEbtrG,KAAKygB,IAAI4gC,GAAGsvC,eAAeyZ,GAC3BpqG,KAAKoqG,wBAA0BA,GAGjCpqG,KAAKqqG,8BAAgCD,EAAwB96D,GAC3D,SACC5lB,GAAwB1pB,KAAK6rG,aAAaniF,GAE/C,CAKQkhF,gCACqC5oG,IAAvChC,KAAKqqG,gCAAkCroG,EACzCqpG,KAAQrrG,KAAKqqG,oCAEsBroG,IAAjChC,KAAKoqG,yBACPpqG,KAAKygB,IAAI4gC,GAAGuuC,kBAAkB5vF,KAAKoqG,yBAErCpqG,KAAKoqG,6BAA0BpoG,CACjC,CAMQ6pG,aAAaniF,GACnB,MAAM9J,IAAY,EAAC0rF,MAAY5hF,EAAM+mE,iBAE/BjgB,EADS9mD,EAAM9S,OACCu2E,cAActJ,YAC9B5/B,GAAajkD,KAAK0nB,OAAOxH,OAC7B,CAACC,EAA8BjQ,KAC7B,MAAM64F,EAAW74F,EAAMuyC,MAAMpB,GAAGsC,YAChCxjC,SAAI7Y,QAAQyhG,EAASY,oBAAoBn5B,IAClCrwD,GAET,IAEFngB,KAAK0rG,gBAAgBznD,GAAYrkC,GAAW,EAC9C,CAOQ4J,kBAAkBjf,GACxB,MAAMqwF,EAAS56F,KAAK46F,OAIdkR,EAHoB9rG,KAAKsqG,aAAa7nD,MAAMpB,GAC/CsC,YACAQ,cAC2C1jC,IAC3CksE,GAAqCA,EAAU/P,SAE5CmvB,GAAexhG,EAASkW,IAAIzgB,KAAKsqG,aAAajrF,QAEpD,IAAI2sF,EAEFA,EADsB,IAApBzhG,EAASX,SAITkiG,EAAoBliG,SAAWmiG,GAAaniG,SAC3CkiG,EAAoB7nF,MAClB1d,GAAmBwlG,GAAarjG,QAAQnC,IAAQ,IAIvDvG,KAAKsqG,aAAa5B,iBAChBn+F,EACAyhG,EAAWpR,EAASC,IAAcj9E,KAClC5d,KAAKH,QAAQ8oG,UACb3oG,KAAKH,QAAQ6jG,UACb1jG,KAAKH,QAAQmqG,aAEjB,CAOQ0B,gBACNznD,EACArkC,EACAG,GAEA,MAAMksF,EAAkBjsG,KAAKksG,qBAAqBjoD,GAElDjkD,KAAK0nB,OAAOnN,QAASrK,KACnB,MAAM3F,EAAW0hG,EAAgB/rG,IAAIgQ,SACpBlO,IAAbuI,IAAwC,IAAdqV,EAC5B5f,KAAKmsG,6BAA6Bj8F,SACZlO,IAAbuI,IAAwC,IAAdqV,GAGnC5f,KAAKosG,wBAAwBl8F,GAAO3F,EAAUqV,EAAWG,EAAO,EAGtE,CAOQqsF,wBACNl8F,EACA3F,EACAqV,EACAG,IAEgB,IAAZA,EACF7P,EAAMM,MAAMwP,YAAYzV,EAAU,CAAC,aAEnC2F,EAAMM,MAAMqP,WAAWtV,EAAU,CAAEie,UAAU,GAAQ5I,EAEzD,CAMQusF,6BAA6Bj8F,GACnCA,EAAMM,MAAM8P,UAAU,CAAEkI,UAAU,GACpC,CASQ0jF,qBACNjoD,GAEA,MAAMgoD,EAAkB,IAAI/sF,IAC5B,OAAmB,MAAf+kC,GAIJA,EAAW1pC,QAASoyE,IAClB,MAAMz8E,EAAQy8E,EAAUzsF,IAAI,iBAC5B,QAAc8B,IAAVkO,EACF,OAGF,IAAI3F,GAAW0hG,EAAgB/rG,IAAIgQ,QAClBlO,IAAbuI,KACFA,GAAW,GACX0hG,EAAgB5rG,IAAI6P,EAAO3F,KAG7B,MAAMO,EAAUoF,EAAMhQ,IAAIysF,EAAU/P,cACpB56E,IAAZ8I,GACFP,GAASjD,KAAKwD,EAAO,GAIlBmhG,CACT,CAMQzB,qBACN,MAAM6B,EAAersG,KAAKH,QAAQ4iD,MAC9BziD,KAAKH,QAAQ4iD,MACbziD,KAAKssG,qBACT,OAAO,IAAInP,IAAa,GAAI,CAAE18E,IAAKzgB,KAAKygB,MAAOwgF,UAAUoL,EAC3D,CAMQC,qBACN,OAAO,IAAIvwC,IAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,KACZ3lD,WAAOnU,EACP2nD,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,GAEf,CAMQwP,uBAC8B7oG,IAAhChC,KAAKsqG,aAAa7nD,MAAMhiC,KAC1BzgB,KAAKygB,IAAIu7C,SAASh8D,KAAKsqG,aAAa7nD,MAExC,CAKQyoD,qBACNlrG,KAAKsqG,aAAa7mF,OAAO49B,GAAGv6C,QAC5B9G,KAAKygB,IAAI8rF,YAAYvsG,KAAKsqG,aAAa7nD,MACzC,6DC3dK,IAAK+pD,EAAZ,SAAYA,GACVA,SAAAC,qBAAA,uBACAD,EAAAE,MAAA,QACAF,EAAAG,gBAAA,kBACAH,EAAAI,QAAA,UACAJ,EAAA3uF,IAAA,MACA2uF,EAAAK,KAAA,OANUL,CAOZ,CAPA,CAAYA,GAAqB,IASrBM,EAAZ,SAAYA,GACVA,SAAAC,KAAA,OACAD,EAAAE,kBAAA,oBACAF,EAAAG,SAAA,WACAH,EAAAI,OAAA,SACAJ,EAAAK,kBAAA,oBACAL,EAAAM,sBAAA,wBACAN,EAAAO,+BAAA,iCACAP,EAAAQ,WAAA,aACAR,EAAAS,eAAA,iBACAT,EAAAU,mBAAA,qBACAV,EAAAW,4BAAA,8BACAX,EAAAY,eAAA,iBACAZ,EAAAa,qBAAA,uBACAb,EAAAc,OAAA,SACAd,EAAAe,IAAA,MACAf,EAAAgB,GAAA,KACAhB,EAAAiB,IAAA,MAjBUjB,CAkBZ,CAlBA,CAAYA,GAAiB,oICgBvB,MAAOp0B,EACHs1B,eAA8C,GAC/CC,UAAY,CACjB,CAACnB,IAAkBK,mBAA8B,CAC/Ce,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBa,sBAAiC,CAClDO,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBY,gBAA2B,CAC5CQ,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBM,uBAAkC,CACnDc,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBO,gCAA2C,CAC5Da,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBU,oBAA+B,CAChDU,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBW,6BAAwC,CACzDS,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBE,mBAA8B,CAC/CkB,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBI,QAAmB,CAAEgB,SAAS,EAAOC,cAAe,IACvE,CAACrB,IAAkBS,gBAA2B,CAC5CW,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBQ,YAAuB,CACxCY,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBc,QAAmB,CAAEM,SAAS,EAAMC,cAAe,IACtE,CAACrB,IAAkBG,UAAqB,CAAEiB,SAAS,EAAMC,cAAe,KAG1Ex1B,+BACEy1B,EACA91B,EACA8K,GAEA,IAAIirB,GAAyB,EAC7B,OAAIjrB,GAAuB,QAAZA,IACbirB,GAAyB,IAG3BD,EAAoBA,GAAqB,IACvBz9D,aACc3uC,IAA9BosG,EAAkBz9D,QACd09D,EACAD,EAAkBz9D,QACxBy9D,EAAkBjyC,cACen6D,IAA/BosG,EAAkBjyC,SACdkyC,EACAD,EAAkBjyC,SACxBiyC,EAAkBjsB,aAAe7J,EAEjC81B,EAAkB1tB,oBAAqB,EAErC0tB,EAAkBz9D,UACjBy9D,EAAkBt1B,aACjBs1B,EAAkBp1B,YAClBo1B,EAAkBn1B,cAClBm1B,EAAkBnhF,QAClBmhF,EAAkB/tE,gBAEpB+tE,EAAkB1tB,oBAAqB,GAElC0tB,CACT,CAEOlsB,YACL7+D,EACAmtD,EACAjvB,EACA+2B,EACAz4E,GAEA,IAAIyuG,EACAC,EAeAC,EACJ,GAdED,GADE,+BAA+BrkG,KAAK+tB,KAAKouB,UAAUhjC,IAKnDA,IACFi1D,OACoCt2E,IAAjCqhB,EAAgB8+D,aACZ9+D,EAAgB8+D,aACjB7J,GAEJ9H,GAAUntD,IACZirF,EAAgBG,KAAcn2B,EAAmB9H,EAAQjvB,EAAKE,aAG5Dp+B,EAeF,MAAO,QAAUmtD,EAAO3mE,KAAK,KAAO,IAAM03C,EAAKE,UAd/Cp+B,EAAUrjB,KAAK0uG,0BACbrrF,EACAi1D,EACA/2B,GAGAitD,EADEh+B,GAAU+9B,EACKE,KACfH,EACAtuG,KAAK2uG,aAAatrF,EAASxjB,IAGZG,KAAK2uG,aAAatrF,EAASxjB,GAMhD,MAAMwjF,EAAqC,CACzClE,QAAS,GACTyvB,UAAW,GACXC,cAAe,GACflsB,aAAc,CAAC,gBACfj5E,OAAQ8kG,EACRrwB,aAAc,GACdgE,aAAc7J,GAGVw2B,GAAQ,IAAIC,KAAcC,gBAAgB3rB,GAKhD,MAAO,WAJK,IAAI4rB,eAAgBC,kBAAkBJ,GAI3BxlG,MAHP,iDAGsB,GAAGA,MAFzB,6BAEwC,EAC1D,CAEQqlG,aACNQ,EACAtvG,GAEA,GAAIsvG,aAAwB5zF,MAAO,CACjC,MAAM6zF,EAAe,GACrBD,SAAa50F,QAASlS,IACpB+mG,EAAa9nG,KAAKtH,KAAK2uG,aAAatmG,EAASxI,GAAQ,GAEhDuvG,CACT,CACE,OAAID,EAAax0F,eAAe,WACvB3a,KAAKqvG,aACV,CACEx4C,SAAUs4C,EAAaG,QACvBF,aAAcpvG,KAAK2uG,aAAaQ,EAAa9rF,QAASxjB,IAExDA,GAEOsvG,EAAax0F,eAAe,YAC9B3a,KAAKqvG,aACVF,EACAtvG,QAHG,CAOX,CAEQwvG,aACNE,EACA1vG,GAEA,MAAMg3D,EAAW04C,EAAc14C,SACzBu4C,EAAeG,EAAcH,aAE7BI,EAAkBD,EAAcvxB,aAChCyxB,EAAaF,EAAcG,QAC3BC,GAAeJ,EAAcK,WAC/BL,EAAcK,UAEZC,EAAcN,EAAcO,SAAWP,EAAcO,SAAW,IAChEC,EAAgBR,EAAcS,WAChCT,EAAcS,WACd,IACEC,EAAgBV,EAAcW,WAChCX,EAAcW,WACd,IAEEC,GAAmBZ,EAAca,cACjCC,EAAmBd,EAAce,cAEjCC,EAAkBhB,EAAcptB,aAChCquB,EAAYjB,EAAc/+B,OAC1BigC,EAAiBlB,EAAcmB,aAC/BC,EAAapB,EAAcpwB,QAC7BowB,EAAcpwB,QACd,YAEEyxB,EAAW5wG,KAAK6wG,sBACpBtB,EAAcuB,MACdjxG,EAAUA,EAAQmyE,aAAUhwE,GAExB+uG,EAAS/wG,KAAK6wG,sBAClBtB,EAAcyB,IACdnxG,EAAUA,EAAQoyE,aAAUjwE,GAGxBivG,EAAgB1B,EAAc2B,WAEpC,IAAI5nB,EASJ,OARImnB,IAEFnnB,GADY,IAAI6nB,KACDC,aAAaX,EAAgB,CAC1ChsD,eAAgBksD,EAChBjsD,kBAAmBisD,GAAc,eAI7B95C,EAAS1+B,eACf,KAAK20E,IAAkBC,KAAK50E,cAC1B,OAAOs2E,KAAc8B,EAAiBC,EAAWG,GACnD,KAAK7D,IAAkBE,kBAAkB70E,cACvC,OAAOs2E,KACLe,EACAW,KAAoB,KACpBE,GAAoB,MAExB,KAAKvD,IAAkBG,SAAS90E,cAC9B,OAAOs2E,KAAkB8B,EAAiBjnB,EAAUqnB,GACtD,KAAK7D,IAAkBI,OAAO/0E,cAC5B,OAAOs2E,KAAgBe,EAAiBoB,EAAUG,GACpD,KAAKjE,IAAkBK,kBAAkBh1E,cACvC,OAAOs2E,KAAiBe,EAAiByB,EAAetB,GAC1D,KAAK7C,IAAkBM,sBAAsBj1E,cAC3C,OAAOs2E,KAAqBe,EAAiByB,GAC/C,KAAKnE,IAAkBO,+BAA+Bl1E,cACpD,OAAOs2E,KAA8Be,EAAiByB,GACxD,KAAKnE,IAAkBQ,WAAWn1E,cAChC,OAAOs2E,KAAoB8B,EAAiBjnB,EAAUqnB,GACxD,KAAK7D,IAAkBS,eAAep1E,cACpC,OAAOs2E,KAAgBe,GACzB,KAAK1C,IAAkBU,mBAAmBr1E,cACxC,OAAOs2E,KAAkBe,EAAiByB,GAC5C,KAAKnE,IAAkBW,4BAA4Bt1E,cACjD,OAAOs2E,KAA2Be,EAAiByB,GACrD,KAAKnE,IAAkBY,eAAev1E,cACpC,OAAOs2E,KACLe,EACAC,EACIA,EAAW/2E,QAAQ,UAAWq3E,GAC9BF,EACJA,EACAE,EACAE,EACAN,GAEJ,KAAK7C,IAAkBa,qBAAqBx1E,cAC1C,OAAOs2E,KACLe,EACAyB,EACAtB,GAEJ,KAAK7C,IAAkBc,OAAOz1E,cAC5B,OAAOs2E,KAAgB8B,EAAiBjnB,EAAUqnB,GAEpD,KAAK7D,IAAkBe,IAAI11E,cACzB,OAAOs2E,KAAavY,MAAM,KAAMkZ,GAClC,KAAKtC,IAAkBgB,GAAG31E,cACxB,OAAOs2E,KAAYvY,MAAM,KAAMkZ,GACjC,KAAKtC,IAAkBiB,IAAI51E,cACzB,OAAOs2E,KAAavY,MAAM,KAAMkZ,GAElC,QACE,OAEN,CAEOiC,8BACLlC,EACAhtB,EACAmtB,EAAU,GACVgC,GAAQ,GAER,OAAInC,aAAwB5zF,MAC1B4zF,EAAa50F,QAASlS,IACpBrI,KAAKguG,eAAertF,OAClB3gB,KAAKqxG,8BACHhpG,EACA85E,EACAmtB,EACAgC,GACD,GAIDnC,EAAax0F,eAAe,WAE9B3a,KAAKguG,eAAertF,OAClB3gB,KAAKqxG,8BACHlC,EAAa9rF,QACb8+D,EACAgtB,EAAaG,QALjBgC,GAAgB,IASPnC,EAAax0F,eAAe,aACrC3a,KAAKguG,eAAe1mG,KAClBtH,KAAKuxG,mBAAmBpC,EAAchtB,EAAcmvB,EAAOhC,IAI1DtvG,KAAKguG,cACd,CAEOwD,wBACLzwE,EACAi9C,EACAyzB,GAEA,IACIC,EACAC,EACAC,EAHAC,EAAyB,GAK7B,GAAI9wE,GAAUi9C,EAAc,CAC1B,MAAM8zB,EAAW/wE,EAAO3e,KAAMod,GAAUA,EAAMxQ,OAASgvD,GACvD0zB,EACEI,GAAYA,EAASC,qBACjBD,EAASC,qBACTN,CACR,CA6BA,OA3BI1wE,GACFA,EAAOtgB,IAAK+e,IACV,IAAKA,EAAMuyE,qBACT,OAEF,MAAMA,EAAuBvyE,EAAMuyE,qBAAqB55E,eAEtD45E,IAAyBvF,IAAsB3uF,IAAIsa,eACnD45E,IACEvF,IAAsBI,QAAQz0E,eAChC45E,IACEvF,IAAsBG,gBAAgBx0E,iBAExCw5E,GAA2B,EAEzBI,IAAyBvF,IAAsB3uF,IAAIsa,gBAEnDy5E,GAAkB,MAM1BF,EAAmBA,GAEflF,IAAsBG,gBAElB+E,EAAiBv5E,eACvB,KAAKq0E,IAAsB3uF,IACzBg0F,EAAqB7xG,KAAKiuG,UAC1B,MACF,KAAKzB,IAAsBI,QACzBiF,EAAqB,CACnB,CAAC/E,IAAkBQ,YAAa,CAAEY,SAAS,EAAMC,cAAe,IAChE,CAACrB,IAAkBc,QAAS,CAAEM,SAAS,EAAMC,cAAe,KAE9D,MACF,KAAK3B,IAAsBG,gBACzBkF,EAAqB,CACnB,CAAC/E,IAAkBK,mBAAoB,CACrCe,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBa,sBAAuB,CACxCO,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBQ,YAAa,CAAEY,SAAS,EAAMC,cAAe,IAChE,CAACrB,IAAkBc,QAAS,CAAEM,SAAS,EAAMC,cAAe,KAE9D,MACF,KAAK3B,IAAsBE,MACzBmF,EAAqB,CACnB,CAAC/E,IAAkBK,mBAAoB,CACrCe,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBa,sBAAuB,CACxCO,SAAS,EACTC,cAAe,KAGnB,MACF,KAAK3B,IAAsBK,KACzBgF,EAAqB,CACnB,CAAC/E,IAAkBI,QAAS,CAAEgB,SAAS,EAAOC,cAAe,KAE/D,MACF,KAAK3B,IAAsBC,qBACzBoF,EAAqB,CACnB,CAAC/E,IAAkBK,mBAAoB,CACrCe,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBa,sBAAuB,CACxCO,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBM,uBAAwB,CACzCc,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBO,gCAAiC,CAClDa,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBU,oBAAqB,CACtCU,SAAS,EACTC,cAAe,CAAC,WAElB,CAACrB,IAAkBW,6BAA8B,CAC/CS,SAAS,EACTC,cAAe,CAAC,YAGpB,MACF,QACE0D,EAAqB,CACnB,CAAC/E,IAAkBK,mBAAoB,CACrCe,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBa,sBAAuB,CACxCO,SAAS,EACTC,cAAe,IAEjB,CAACrB,IAAkBQ,YAAa,CAAEY,SAAS,EAAMC,cAAe,IAChE,CAACrB,IAAkBc,QAAS,CAAEM,SAAS,EAAMC,cAAe,KAIlE,OAAIwD,IACDE,EAA2BvE,WAAa,CACvCY,SAAS,EACTC,cAAe,IAEhB0D,EAA2BjE,OAAS,CAAEM,SAAS,EAAMC,cAAe,IACjEyD,IACDC,EAA2B5E,SAAW,CACrCiB,SAAS,EACTC,cAAe,MAKd0D,CACT,CAEON,mBACLS,EACA7vB,EACAmvB,EAAQ,EACRW,EAAgB,MAEXD,IACHA,EAAqB,CAAEn7C,SAAU,sBAEnC,MAAM1wB,EAAI,CACR63C,aAAc,GACdnnB,SAAU,GACVlvC,OAAQ,GACRuqF,YAAUvvF,QACVoO,KAAM,GACN+/E,MAAO,GACPE,IAAK,GACLmB,cAAe,GACf/B,cAAe,GACfE,cAAe,GACfY,WAAY,GACZxB,QAAS,GACTI,SAAU,IACVE,WAAY,IACZE,WAAY,IACZN,WAAW,EACXwC,mBAAoB,GACpBC,QAAS,GACTlwB,aAAc,GACdmH,SAAU,GACVonB,aAAc,GACdlgC,OAAQ,GACR2O,QAAS,GACT8yB,cAAe,GACfX,MAAO,GAGT,OAAO9qG,OAAO6H,OACZ83B,EACA,CACE8rE,gBACAX,QACAnvB,gBAEF6vB,EAEJ,CAEOtD,0BACLS,EACA72B,EACA/2B,EACA55B,GAAS,GAET,MAAM2qF,EAAc,GACpB,OAAInD,aAAwB5zF,OAC1B4zF,EAAa50F,QAASlS,IACpBiqG,EAAYhrG,KACVtH,KAAK0uG,0BACHrmG,EACAiwE,EACA/2B,EACA55B,GACD,GAGE2qF,GAEHnD,EAAax0F,eAAe,WACvBnU,OAAO6H,OACZ,GACA,CACEihG,QAASH,EAAaG,QACtBjsF,QAASrjB,KAAK0uG,0BACZS,EAAa9rF,QACbi1D,EACA/2B,EACA55B,KAIGwnF,EAAax0F,eAAe,YAC9B3a,KAAKuyG,oBACVpD,EACA72B,EACA/2B,EACA55B,QALG,CASX,CAEQ4qF,oBACNP,EACA15B,EACA/2B,EACA55B,GAAS,GAET,MAAMuqF,EAAWF,EAAmBr3F,eAAe,YAC/Cq3F,EAAmBE,YACnBvvF,QACEgzE,EAASqc,EAAmBr3F,eAAe,UAC7Cq3F,EAAmBrqF,OACnBA,EAEEw3D,EAAU6yB,EAAmBr3F,eAAe,WAC9Cq3F,EAAmB7yB,QACnB59B,EACEA,EAAKE,UACL,YAEN,OAAOj7C,OAAO6H,OACZ,GACA,CACE6jG,WACAvqF,OAAQguE,EACRyc,mBAAoB,cACpBjzB,WAEF6yB,EACA,CAAE7vB,aAAc7J,GAEpB,CAEOk6B,sCACLC,GAEA,GAAIA,aAAoBl3F,OAClBk3F,EAAS7oG,QAAU,EAAG,CACxB,IACI8oG,EAEAC,EAHAC,EAAoBH,EAAS,GAAGR,cAEhC7C,EAAe,GAEnBqD,SAASl4F,QAASs4F,IAChB,MAAMxqG,EAAU7B,OAAO6H,OAAO,GAAIwkG,GAC5B5zF,EAAQwzF,EAAS/pG,QAAQmqG,GAE7BH,EADEzzF,GAAS,GAAKA,EAAQwzF,EAAS7oG,OAAS,EAC5B6oG,EAASxzF,EAAQ,GAEjB5W,SAETA,EAAQsf,cACRtf,EAAQ6pG,gBACR7pG,EAAQ4pG,cACf7C,EAAa9nG,KAAKe,GAEM,IAApBoqG,EAAS7oG,OACX+oG,EAAsBtqG,EACbuqG,IAAsBF,EAAYT,gBACf,IAAxB7C,EAAaxlG,OACfs5D,QAAQK,IACN,oDAEEqvC,EACA,MAGJD,EAAsBnsG,OAAO6H,OAC3B,GACA,CAAEihG,QAASsD,EAAmBvvF,QAAS+rF,IAEzCA,EAAe,CAACuD,GAChBC,EAAoBF,EAAYT,kBAI/BU,CACT,CAMJ,CAEQG,mBAAmBxkG,GACzB,GACEA,EAAU0yB,OAAO/c,MAAOgd,QAAsCj/B,IAA5Bi/B,EAAM8xE,mBAExC,OAAOzkG,EAET,IAAI0kG,EACJ,GAAI1kG,EAAU0yB,QAAU1yB,EAAU2kG,QAAS,CACzC,IAAK3kG,EAAU2kG,QAAQhvF,MAAOivF,QAAyBlxG,IAAdkxG,EAAOhhG,IAC9C,MAAM,IAAI8P,MAAM,+CAElBgxF,EAAWz2F,KAAY42F,SAAS7kG,GAChC0kG,EAAShyE,OAAOzmB,QAAS0mB,IACvBA,EAAMr1B,MAAQq1B,EAAMr1B,MAAQq1B,EAAMr1B,MAAQq1B,EAAMjS,KAChDiS,EAAM0P,UAAU1P,EAAM0P,SAAU1P,EAAM0P,QACtC1P,EAAM8xE,kBAAoBx2F,KAAY42F,SACpCH,EAASC,QAAQvpG,OAAQ64C,GAAMthB,EAAMw/B,IAAIzoC,SAASuqB,EAAErwC,KAAI,EAG9D,MAAY5D,EAAU0yB,QAAU1yB,EAAU2kG,SACxCD,EAAWz2F,KAAY42F,SAAS7kG,GAChC0kG,EAAShyE,OAAS,CAChB,CACEp1B,MAAO,SACPojB,KAAM,SACN+jF,kBAAmBx2F,KAAY42F,SAASH,EAASC,YAIrDD,EAAW,CACTC,QAAS3kG,EACT0yB,OAAQ,CACN,CACEp1B,MAAO,SACPojB,KAAM,SACN+jF,kBAAmBx2F,KAAY42F,SAC7B7kG,KAINyqE,aAAci6B,EAASj6B,cAG3B,OAAKi6B,EAAShyE,OAAO5e,KAAMgxF,GAAkBA,EAAcziE,WACzDqiE,EAAShyE,OAAO,GAAG2P,SAAU,GAExBqiE,CACT,CAEOnyB,6BACLhhF,EACAy4E,EACA9H,EACAjvB,GAEA,MAAM62B,EAAav4E,EAAQu4E,WAC3B,IAAKA,EACH,OAEF,MAAM9rC,EAAa,GACnB,IAAI+mE,EAA4B,GAC5BC,EAAmC,GACvC,GACEl7B,EAAWznC,UACVynC,EAAWU,aACVV,EAAWY,YACXZ,EAAWa,cACXb,EAAWnrD,QACXmrD,EAAW/3C,cACb,CACA,IAAI/xB,EACJ,GAAI8pE,EAAWU,YAAa,CAC1BxqE,EAAY8pE,EAAWU,YACvB,MAAMy6B,GAAiBvzG,KAAKwzG,qBAAqBp7B,EAAY9pE,GAC7D,UAAWi+B,KAAagnE,GACtBjnE,EAAWhlC,KAAKilC,EAEpB,CACA,GAAI6rC,EAAWY,WAAY,CACzB1qE,EAAY8pE,EAAWY,WACvB,MAAMy6B,GAAqBzzG,KAAKwzG,qBAC9Bp7B,EACA9pE,GAEF,UAAWi+B,KAAaknE,GACtBnnE,EAAWhlC,KAAKilC,EAEpB,CACA,GAAI6rC,EAAWa,aAAc,CAC3B3qE,EAAY8pE,EAAWa,aACvB,MAAMy6B,GAAgB1zG,KAAK2zG,uBAAuBrlG,GAC5CslG,EAAkB5zG,KAAKwzG,qBAC3Bp7B,EACAs7B,IAEF,UAAWnnE,KAAaqnE,EACtBtnE,EAAWhlC,KAAKilC,EAEpB,CACA,GAAI6rC,EAAWnrD,OAAQ,CACrB3e,EAAY8pE,EAAWnrD,OACvB,MAAMymF,GAAgB1zG,KAAK2zG,uBAAuBrlG,GAC5CulG,EAAmB7zG,KAAKwzG,qBAC5Bp7B,EACAs7B,IAEF,UAAWnnE,KAAasnE,EACtBvnE,EAAWhlC,KAAKilC,EAEpB,CACA,GAAI6rC,EAAW/3C,aAAc,CAC3B/xB,EAAY8pE,EAAW/3C,aACvB,MAAMwzE,GAAmB7zG,KAAKwzG,qBAC5Bp7B,EACA9pE,GAEF,UAAWi+B,KAAasnE,GACtBvnE,EAAWhlC,KAAKilC,EAEpB,CAGE6rC,EAAW/0D,SACX,aAAc+0D,EAAW/0D,SACzB+0D,EAAW/0D,QAAQwzC,SAAS1+B,gBAC1B20E,IAAkBI,OAAO/0E,eAC3BigD,EAAW/0D,QAAQsE,QACnBywD,EAAW07B,qBAAqBlqG,OAAS,GAEzC0iC,EAAWhlC,KAAK8wE,EAAW07B,oBAAoB,IAG7CxnE,EAAW1iC,QAAU,IACvBypG,EAA4BrzG,KAAKkiF,YACT,IAAtB51C,EAAW1iC,OACP0iC,EAAW,GACX,CAAEgjE,QAAS,MAAOjsF,QAASipB,GAC/BkkC,EACAjvB,EACA62B,EAAW+J,cAGjB,CACI/J,EAAWznC,SAAWynC,EAAW/0D,UACnC+0D,EAAW+J,aAAe/J,EAAW+J,cAAgB7J,EAErDg7B,EAAmCtzG,KAAKkiF,YADrB9J,EAAW/0D,QAG5BmtD,EACAjvB,EACA62B,EAAW+J,aACXtiF,IAIJ,IAAI+gF,EAAoBxI,EAAWsI,mBAC/B4yB,EACAD,EACJ,MAAqB,QAAjBxzG,EAAQ2D,OACVo9E,EAAoB5gF,KAAK+zG,yBACvBnzB,EACC/gF,EAAgBkH,OAAO0vD,SAGP,QAAjB52D,EAAQ2D,OACVo9E,EAAoB5gF,KAAK+zG,yBACvBnzB,EACC/gF,EAAgBkH,OAAO47E,eAIrB/B,CACT,CAEO+yB,uBAAuBrlG,GAC5BA,SAAU2kG,QAAQ14F,QAAS24F,IACzB,IAAKA,EAAO1hF,UAAY0hF,EAAO5kG,UAAW,CACxC,MAAM0lG,EAAWd,EAAO5kG,UAAU4R,OAChC,CAAC+zF,EAAMvqG,EAAQuV,KACM,IAAnBvV,EAAOinC,QAAmBsjE,EAAKtzF,OAAO1B,GAASg1F,EACjD,IAEED,EAASpqG,OAAS,IACpBoqG,EAASnuF,OAAO,EAAG,GACnBmuF,EAASz5F,QAAS0E,IAChBi0F,EAAO5kG,UAAU2Q,GAAO0xB,SAAU,IAGxC,IAEKriC,CACT,CAEOklG,qBAAqBp7B,EAA+B9pE,GAEzD,MAAM4lG,GADN5lG,EAAYtO,KAAK8yG,mBAAmBxkG,IACH0yB,OAAO5e,KACrC2+C,GAAMA,EAAEpwB,SACToiE,kBACIzmE,EAAa,GACnB4nE,SAAezzF,IAAKyyF,IAClB,MAAMiB,EAAkB,GAClBC,EAAgBlB,EAAO5kG,UACxB8lG,IAGLA,EACG1qG,OAAQ2qG,IAAwC,IAAxBA,EAAY1jE,SACpCp2B,QAAS+5F,GACRH,EAAgB7sG,KAAKgtG,EAAgBjxF,UAEV,IAA3B8wF,EAAgBvqG,OAClB0iC,EAAWhlC,KAAK6sG,EAAgB,IACvBA,EAAgBvqG,OAAS,GAClC0iC,EAAWhlC,KAAK,CACdgoG,QAAS4D,EAAO5D,QAChBjsF,QAAS8wF,IACV,GAI0B,eAA3B7lG,EAAUyqE,aACZX,EAAWU,YAAcxqE,EACW,aAA3BA,EAAUyqE,aACnBX,EAAWY,WAAa1qE,EACY,gBAA3BA,EAAUyqE,aACnBX,EAAWa,aAAe3qE,EACU,WAA3BA,EAAUyqE,aACnBX,EAAWnrD,OAAS3e,EACgB,iBAA3BA,EAAUyqE,eACnBX,EAAW/3C,aAAe/xB,GAErBg+B,CACT,CAEOynE,yBACLQ,EACAC,GAEA,IAAKD,EACH,OAEF,IAAIE,EAAgB,GACpB,OAA+B,IAA3BF,EAAgB3qG,SAAmD,IAAnC4qG,EAAkB9rG,QAAQ,KAC5D+rG,EAAgBF,EAEhBC,EAAkBlrG,MAAM,KAAKiR,QAASm6F,IACpCD,EAAgB,GAAGA,KAAiBF,EAAgB77E,QAClD,UACA,MACD,GAGL+7E,EAAgBA,EAAc/7E,QAAQ,QAAS,IAE7C+7E,EAAc7qG,OAAS,EACnB6qG,EAAc/7E,QAAQ,UAAW,SACjC12B,CAER,CAEO6uG,sBAAsBnqG,EAAes8D,GAC1C,OAAKt8D,EAGHA,EAAMyxB,cAAcH,SAAS,QAC7BtxB,EAAMyxB,cAAcH,SAAS,SAEtBh4B,KAAK20G,mBAAmBjuG,GACtBgxB,IAAOhxB,GAAOkuG,UAChBluG,OAEP,EATOs8D,CAWX,CAOQ2xC,mBAAmBjuG,GACzB,MAAMmuG,EAAoBnuG,EAAMyxB,cAAc7uB,MAAM,KAC9CwrG,EAAcD,EAAkB,GAChCh+C,EAAW,CAAC,IAAK,KAAK7+B,SAAS68E,EAAkB,IACnDA,EAAkB,QAClB7yG,EACE+yG,EAAe,WAAW7qG,KAAK2qG,EAAkB,IACnDA,EAAkB,QAClB7yG,EACEgzG,EACJ,CAAC,QAAS,SAAU,QAAS,OAAQ,QAAS,WAAWh9E,SACvD68E,EAAkB,IAEhBA,EAAkB,QAClB7yG,EAGN,OAAK60D,GAAam+C,GAAqBD,EAMtB,MAAbl+C,EACqB,QAAhBi+C,EACHp9E,MAASkW,IAAItV,SAASy8E,EAAc,IAAKC,GAAkBr9E,SAC3DD,MACGu9E,MAAM,OACNrnE,IAAItV,SAASy8E,EAAc,IAAKC,GAChCr9E,SAEgB,QAAhBm9E,EACHp9E,MACGw9E,SAAS58E,SAASy8E,EAAc,IAAKC,GACrCr9E,SACHD,MACGu9E,MAAM,OACNC,SAAS58E,SAASy8E,EAAc,IAAKC,GACrCr9E,SApBgB,QAAhBm9E,EACHp9E,MAASC,SACTD,MAASu9E,MAAM,OAAOt9E,QAoB9B,6DCv9BK,IAAKy7C,EAAZ,SAAYA,GACVA,SAAA+hC,KAAA,OACA/hC,EAAAgiC,KAAA,OACAhiC,EAAAC,SAAA,WACAD,EAAAiiC,KAAA,OAJUjiC,CAKZ,CALA,CAAYA,GAAc,IAOdE,EAAZ,SAAYA,GACVA,SAAAC,SAAA,WACAD,EAAAgiC,OAAA,SAFUhiC,CAGZ,CAHA,CAAYA,GAAe,mLCyBrB,MAAOiiC,EAoFS11G,QAhFb21G,OAA8B,IAAIx6D,IAKlCy6D,KAA4B,IAAIz6D,IAKhC06D,SAAyB,IAAI16D,IAK7B26D,QAA+B,IAAI36D,IAKnC46D,QAAwB,IAAI56D,IAK5B66D,OAAuB,IAAI76D,IAKlC86D,UAAsC,IAAI/zG,KAAgB,GAI1Dg0G,oBAAgD,IAAIh0G,KAAgB,GACpEi0G,kBAA6C,IAAIj0G,SAAgBC,GACjEi0G,eAA0C,IAAIl0G,SAAgBC,GAEtDk0G,UAEAC,eACAC,mBACAC,MACAC,eACAC,kBACAC,oBACAC,oBACAC,eACAC,aACAC,eACAC,UACDxc,OAECyc,cAKR,aAAIC,GACF,OAAO/2G,KAAKg2G,kBAAkBr8E,UAChC,CACA,iBAAIq9E,CAAcC,GAChBj3G,KAAKg2G,kBAAkBrzG,KAAKs0G,EAC9B,CAKA,UAAItvF,GACF,YAAsB3lB,IAAfhC,KAAKq2G,KACd,CAMA,wBAAIa,GACF,OAAOl3G,KAAKs2G,eAAe3yD,WAC7B,CAEA5jD,YAAoBF,GAAAG,KAAAH,UAClBG,KAAKs2G,eAAiBz2G,EAAQs3G,aAC1Bt3G,EAAQs3G,aACRn3G,KAAKo3G,4BACTp3G,KAAKm2G,eAAiBn2G,KAAKH,QAAQmiG,aACnChiG,KAAKo2G,mBAAqBp2G,KAAKH,QAAQw3G,gBACzC,CAMAC,SAASjB,EAA0BkB,GACjC,IAAKlB,EAKH,OAJAr2G,KAAKw3G,4BACLx3G,KAAKy3G,4BACLz3G,KAAK03G,4BACL13G,KAAKq2G,MAAQA,GAIfr2G,KAAKq2G,MAAQA,EACbr2G,KAAK23G,yBACL33G,KAAK43G,kBAAkBL,EACzB,CAKA5zD,YACE,OAAO3jD,KAAKk3G,oBACd,CAEAW,sBAAsB1hG,GACpBnW,KAAKo2G,mBAAqBjgG,CAC5B,CAMA2hG,gBAAgB9V,GACdhiG,KAAKm2G,eAAiBnU,CACxB,CAKA+V,kBACE,OAAO/3G,KAAKm2G,cACd,CAKQiB,4BACN,OAAO,IAAIY,IAAc,CACvBv0F,OAAQzjB,KAAKH,QAAQo4G,mBACjBj4G,KAAKH,QAAQo4G,mBACb,IAAIC,IACR/hG,MAAOnW,KAAKH,QAAQs4G,kBACpB31D,OAAQ,KAEZ,CAKQi1D,6BACDz3G,KAAKH,QAAQs3G,cAAgBn3G,KAAKq2G,OACrCr2G,KAAKq2G,MAAM9J,YAAYvsG,KAAKs2G,eAEhC,CAKQqB,yBACD33G,KAAKH,QAAQs3G,cAChBn3G,KAAKq2G,MAAMr6C,SAASh8D,KAAKs2G,eAE7B,CAKQkB,6BACDx3G,KAAKH,QAAQs3G,eAAiBn3G,KAAKH,QAAQo4G,oBAC9Cj4G,KAAKk3G,qBAAqBpwG,OAAM,EAEpC,CAKA8wG,kBAAkBL,GAEhB,IAAIhB,EA6DJ,GApCIA,EAxBCv2G,KAAK81G,UAAUn8E,WAwBI,IAAIy+E,KADE,UAAxBp4G,KAAKm2G,eACwB,CAC7B3yG,KAAM,SACNigB,OAAQzjB,KAAK2jD,YACbxtC,MACqC,mBAA5BnW,KAAKo2G,wBACRp0G,EACAhC,KAAKo2G,mBACXiC,UAAWr4G,KAAKH,QAAQw4G,UACxBC,UAAU,GAGmB,CAC7B90G,KAAMxD,KAAKm2G,eACX1yF,OAAQzjB,KAAK2jD,YACbxtC,MAAOnW,KAAKo2G,mBACZiC,UAAWr4G,KAAKH,QAAQw4G,UACxBC,UAAU,IAvCTt4G,KAAK+1G,oBAAoBp8E,WAWR,IAAIy+E,KAAO,CAC7B50G,KAAM,QACNigB,OAAQzjB,KAAK2jD,YACb40D,WAAW,EACXpiG,MAAOnW,KAAKo2G,mBACZiC,UAAWr4G,KAAKH,QAAQw4G,UACxBC,UAAU,EACVE,kBAAmBA,KAAM,IAjBP,IAAIJ,KAAO,CAC7B50G,KAAMxD,KAAKm2G,eACX1yF,OAAQzjB,KAAK2jD,YACb40D,WAAW,EACXpiG,MAAOnW,KAAKo2G,mBACZiC,UAAWr4G,KAAKH,QAAQw4G,UACxBC,UAAU,EACVE,kBAAmBA,KAAM,IAqC/Bx4G,KAAKq2G,MAAM1lB,eAAe4lB,GAC1Bv2G,KAAKu2G,kBAAoBA,EACzBv2G,KAAK02G,eAAiBH,EAAkBjnE,GACtC,YACC5lB,GAAuB1pB,KAAKy4G,YAAY/uF,IAE3C1pB,KAAK22G,aAAeJ,EAAkBjnE,GAAG,UAAY5lB,GACnD1pB,KAAK04G,UAAUhvF,IAEjB1pB,KAAK42G,eAAiBL,EAAkBjnE,GACtC,YACC5lB,GAAuB1pB,KAAK61G,OAAOlzG,KAAK+mB,EAAM5e,QAAQqiF,gBAGrDoqB,EAAyB,CAE3B,MAAMd,EAAsB,IAAIkC,IAAS,CACvCl1F,OAAQzjB,KAAK2jD,cAOf,GAJA3jD,KAAKq2G,MAAM1lB,eAAe8lB,GAC1Bz2G,KAAKy2G,oBAAsBA,GAGtBz2G,KAAKw2G,oBAAqB,CAC7B,MAAMA,EAAsB,IAAIoC,IAAS,CACvCrsE,UAAWssE,KACX1iG,WAAOnU,IAEThC,KAAKq2G,MAAM1lB,eAAe6lB,GAC1Bx2G,KAAKw2G,oBAAsBA,EAE3Bx2G,KAAKw2G,oBAAoBlnE,GAAG,SAAW5lB,GACrC1pB,KAAKi+D,SAASv0C,GAElB,CACF,CACF,CAKQguF,uBACN13G,KAAK84G,sBAAkB,EACvBzN,KAAQ,CACNrrG,KAAK02G,eACL12G,KAAK22G,aACL32G,KAAK62G,UACL72G,KAAK42G,iBAGH52G,KAAKq2G,QACPr2G,KAAKq2G,MAAMzmB,kBAAkB5vF,KAAKu2G,mBAClCv2G,KAAKq2G,MAAMzmB,kBAAkB5vF,KAAKy2G,sBAGpCz2G,KAAKu2G,uBAAoBv0G,EACzBhC,KAAKy2G,yBAAsBz0G,CAC7B,CAMQy2G,YAAY/uF,GAClB,MAAMw5E,EAAax5E,EAAM5e,QAAQqiF,cACjCntF,KAAKw1G,OAAO7yG,KAAKugG,GACjBljG,KAAKw3G,4BACLx3G,KAAK62G,UAAY3T,EAAW5zD,GAAG,SAAWypE,IACxC/4G,KAAK82G,iBAAgBkC,MAAoCD,GACzD/4G,KAAK01G,SAAS/yG,KAAKo2G,EAAgBniG,OAAM,GAE3C5W,KAAKi5G,kBACP,CAMQP,UAAUhvF,GAC8B,UAA1CA,EAAM5e,QAAQqiF,cAAc8U,WAC9BjiG,KAAKi2G,eAAetzG,KAAK3C,KAAKg2G,kBAAkBr8E,YAElD35B,KAAK84G,sBAAkB,EACvBzN,KAAQrrG,KAAK62G,WACb,MAAM3T,EAAax5E,EAAM5e,QAAQqiF,cACjC+V,EAAW5zD,GAAG,SAAU,KACtBtvC,KAAK21G,QAAQhzG,KAAKugG,EAAU,GAE9BljG,KAAKy1G,KAAK9yG,KAAKugG,EACjB,CAMQjlC,SAASv0C,GACe,IAA1BA,EAAMlB,SAAS5e,QACjB5J,KAAK41G,QAAQjzG,KAAK+mB,EAAMlB,SAAS,GAErC,CAKQywF,mBACNj5G,KAAK84G,qBACL94G,KAAKk2G,aAAY7qC,KAAU/iE,SAAU,WAAWzF,UAC7C6mB,IAEmB,WAAdA,EAAMnjB,KAMQ,cAAdmjB,EAAMnjB,KACRvG,KAAKu2G,kBAAkB2C,kBAIP,UAAdxvF,EAAMnjB,KACRvG,KAAKu2G,kBAAkB4C,gBAIP,MAAdzvF,EAAMnjB,KACRvG,KAAKq2G,MAAM/0D,UAAU3J,QAAQ,CAC3B+J,OAAQ1hD,KAAK82G,cACbjxB,SAAU,OAlBZ7lF,KAAKu2G,kBAAkB6C,cAqBzB,EAGN,CAKQN,qBACF94G,KAAKk2G,YACPl2G,KAAKk2G,UAAU/nG,cACfnO,KAAKk2G,eAAYl0G,EAErB,+NC1WI,MAAOq3G,EA+ESx5G,QA3Eb21G,OAA8B,IAAIx6D,IAKlCy6D,KAA4B,IAAIz6D,IAKhC06D,SAAgC,IAAI16D,IAEnCq7D,MACAiD,eACD7C,oBACC8C,iBACAC,eACAC,YACAC,6BAAuC,EACvCC,uBACAC,oBACAC,kBACAC,eACAC,gCAA0C,EAC1CxD,kBACAG,eACAC,aACAE,UACAmD,2BAAqC,EAErClD,cAEAZ,UACA+D,YACAC,cAEAC,sBAAyC,GACzCC,mBAGAC,gBAKR,UAAI1yF,GACF,YAAsB3lB,IAAfhC,KAAKq2G,KACd,CAMA,mBAAIiE,GACF,OAAOt6G,KAAKs5G,eAAe31D,WAC7B,CAMA,uBAAI42D,GACF,OAAOv6G,KAAKo6G,mBAAmBz2D,WACjC,CAKQ62D,QAAkB,EAKlBjvF,WAAqB,EAE7BxrB,YAAoBF,GAAAG,KAAAH,eACKmC,IAAnBnC,EAAQ26G,SACVx6G,KAAKw6G,OAAS36G,EAAQ26G,aAEEx4G,IAAtBnC,EAAQ0rB,YACVvrB,KAAKurB,UAAY1rB,EAAQ0rB,WAIzBvrB,KAAKs5G,oBADet3G,IAAlBnC,EAAQ4iD,MACY5iD,EAAQ4iD,MAERziD,KAAKo3G,4BAE7Bp3G,KAAKo6G,mBAAqBp6G,KAAKy6G,0BACjC,CAMAnD,SAASjB,GACP,QAAcr0G,IAAVq0G,EAOF,OANAr2G,KAAKw3G,4BACLx3G,KAAKy3G,4BACLz3G,KAAK06G,4BACL16G,KAAK26G,+BACL36G,KAAK46G,+BACL56G,KAAKq2G,MAAQA,GAIfr2G,KAAKq2G,MAAQA,EACbr2G,KAAK23G,0BAIe,IAAhB33G,KAAKw6G,QACPx6G,KAAK66G,wBAGgB,IAAnB76G,KAAKurB,YACPvrB,KAAK86G,4BACL96G,KAAK+6G,iCAGa,IAAhB/6G,KAAKw6G,SACPx6G,KAAKg7G,yBACLh7G,KAAKi7G,4BAET,CAKAt3D,YACE,OAAO3jD,KAAKs6G,eACd,CAMAY,cAAchY,GACZ,MAAMvW,GAAY,IAAIwuB,IAAU,CAAE7xB,SAAU4Z,IAC5CljG,KAAKs6G,gBAAgBxzG,QACrB9G,KAAKs6G,gBAAgBx9B,WAAW6P,GAClC,CAKQyqB,4BACN,OAAO,IAAIY,IAAc,CACvBv0F,OAAQzjB,KAAKH,QAAQ4jB,OAASzjB,KAAKH,QAAQ4jB,OAAS,IAAIy0F,IACxD/hG,MAAOnW,KAAKH,QAAQ0jD,WACpBf,OAAQ,KAEZ,CAKQm1D,8BACqB31G,IAAvBhC,KAAKH,QAAQ4iD,OACfziD,KAAKq2G,MAAMr6C,SAASh8D,KAAKs5G,eAE7B,CAKQ7B,iCACqBz1G,IAAvBhC,KAAKH,QAAQ4iD,YAAsCzgD,IAAfhC,KAAKq2G,OAC3Cr2G,KAAKq2G,MAAM9J,YAAYvsG,KAAKs5G,eAEhC,CAKQ9B,iCACqBx1G,IAAvBhC,KAAKH,QAAQ4iD,YAA+CzgD,IAAxBhC,KAAKH,QAAQ4jB,QACnDzjB,KAAKs6G,gBAAgBxzG,OAAM,EAE/B,CAEQ2zG,2BACN,OAAO,IAAIzC,IAAc,CACvBv0F,OAAQ,IAAIy0F,IACZ/hG,SAAOilG,QACP54D,OAAQ,KAEZ,CAKQ64D,wBACNr7G,KAAKq2G,MAAMr6C,SAASh8D,KAAKo6G,mBAC3B,CAKQkB,2BACNt7G,KAAKq2G,MAAM9J,YAAYvsG,KAAKo6G,mBAC9B,CAKQmB,2BACNv7G,KAAKu6G,oBAAoBzzG,OAAM,EACjC,CAKQk0G,yBACN,MAAMvE,EAAsB,IAAIkC,IAAS,CACvCl1F,OAAQzjB,KAAKs6G,gBACbnkG,MAAOnW,KAAKH,QAAQ27G,YAEtBx7G,KAAKy2G,oBAAsBA,CAC7B,CAKQiE,iCAC2B14G,IAA7BhC,KAAKy2G,sBAITz2G,KAAKy7G,8BACLz7G,KAAKy2G,yBAAsBz0G,EAC7B,CAEQi5G,6BACmC,IAArCj7G,KAAK05G,8BAIT15G,KAAK05G,6BAA8B,EACnC15G,KAAKu5G,iBAAmBv5G,KAAKy2G,oBAAoBnnE,GAC/C,cACC5lB,GAAyB1pB,KAAK07G,cAAchyF,IAE/C1pB,KAAKw5G,eAAiBx5G,KAAKy2G,oBAAoBnnE,GAC7C,YACC5lB,GAAyB1pB,KAAK27G,YAAYjyF,IAE7C1pB,KAAKq2G,MAAM1lB,eAAe3wF,KAAKy2G,qBACjC,CAEQgF,+BACmC,IAArCz7G,KAAK05G,8BAIT15G,KAAK05G,6BAA8B,KAEnCrO,KAAQ,CAACrrG,KAAKu5G,iBAAkBv5G,KAAKw5G,eAAgBx5G,KAAKy5G,mBACvCz3G,IAAfhC,KAAKq2G,OACPr2G,KAAKq2G,MAAMzmB,kBAAkB5vF,KAAKy2G,qBAEtC,CAMQiF,cAAchyF,GACpB,MAAMw5E,GAAax5E,EAAMnf,SAASstB,KAAK,GAAGs1D,cAC1CntF,KAAKw1G,OAAO7yG,KAAKugG,IACjBljG,KAAKy5G,YAAcvW,GAAW5zD,GAC5B,SACCypE,IACC/4G,KAAK82G,iBACHkC,MAAoCD,GACtC/4G,KAAK01G,SAAS/yG,KACZo2G,EAAgBniG,OAA6C,GAInE5W,KAAK47G,oBACP,CAMQD,YAAYjyF,IAClB2hF,OAAQrrG,KAAKy5G,aACbz5G,KAAKy1G,KAAK9yG,KAAK+mB,EAAMnf,SAASstB,KAAK,GAAGs1D,eACtCntF,KAAK67G,sBACP,CAKQD,qBACN57G,KAAKk2G,aAAY7qC,KAAU/iE,SAAU,WAAWzF,UAC7C6mB,IACmB,MAAdA,EAAMnjB,KAERvG,KAAKq2G,MAAM/0D,UAAU3J,QAAQ,CAC3B+J,OAAQ1hD,KAAK82G,cACbjxB,SAAU,GAGd,EAGN,CAKQg2B,4BACiB75G,IAAnBhC,KAAKk2G,WACPl2G,KAAKk2G,UAAU/nG,aAEnB,CAKQ2sG,4BACN,MAAMnB,EAAyB,IAAImC,IAAY,CAC7Ch8D,OAAQ,CAAC9/C,KAAKs5G,kBAEhBt5G,KAAK25G,uBAAyBA,CAChC,CAKQgB,oCAC8B34G,IAAhChC,KAAK25G,yBAIT35G,KAAK+7G,iCACL/7G,KAAK25G,4BAAyB33G,EAChC,CAEQ+4G,gCACsC,IAAxC/6G,KAAK+5G,iCAIT/5G,KAAK+5G,gCAAiC,EACtC/5G,KAAK45G,oBAAsB55G,KAAK25G,uBAAuBrqE,GACrD,iBACC5lB,GAA4B1pB,KAAKg8G,iBAAiBtyF,IAErD1pB,KAAK65G,kBAAoB75G,KAAK25G,uBAAuBrqE,GACnD,eACC5lB,GAA4B1pB,KAAKi8G,eAAevyF,IAEnD1pB,KAAKq2G,MAAM1lB,eAAe3wF,KAAK25G,wBACjC,CAEQoC,kCACsC,IAAxC/7G,KAAK+5G,iCAIT/5G,KAAK+5G,gCAAiC,KACtC1O,KAAQ,CACNrrG,KAAK45G,oBACL55G,KAAK65G,kBACL75G,KAAK85G,sBAEY93G,IAAfhC,KAAKq2G,OACPr2G,KAAKq2G,MAAMzmB,kBAAkB5vF,KAAK25G,wBAEtC,CAMQqC,iBAAiBtyF,GACvB,MAAMw5E,GAAax5E,EAAMnf,SAASstB,KAAK,GAAGs1D,cAC1CntF,KAAKw1G,OAAO7yG,KAAKugG,IACjBljG,KAAK85G,eAAiB5W,GAAW5zD,GAC/B,SACCypE,MAIL,CAMQkD,eAAevyF,IACrB2hF,OAAQrrG,KAAK85G,gBACb95G,KAAKy1G,KAAK9yG,KAAK+mB,EAAMnf,SAASstB,KAAK,GAAGs1D,cACxC,CAKQ0tB,uBACN,MAAMtE,EAAoB,IAAI6B,KAAO,CACnC50G,KAAM,UACNigB,OAAQzjB,KAAKu6G,oBACbhC,WAAW,EACXpiG,SAAOilG,QACP7uE,UAAY7iB,KACc1pB,KAAKq6G,iBAAmBr6G,KAAKk8G,iBAClBC,qBACjCzyF,GAAMohE,cAMZ9qF,KAAKu2G,kBAAoBA,EACzBv2G,KAAKo8G,wBACP,CAKQA,yBACNp8G,KAAKk6G,iBAAgB7uC,KAAU/iE,SAAU,WAAWzF,UACjD6mB,IACC,GAAkB,YAAdA,EAAMnjB,IACR,OAGFvG,KAAKq8G,2BAEL,MAAMnZ,GAAaljG,KAAKk8G,iBACnBhZ,MAAgBA,cAAsBd,QAI3CpiG,KAAKs8G,uBAELt8G,KAAKy7G,8BACLz7G,KAAK+7G,iCACL/7G,KAAKu8G,0BAAuB,EAGlC,CAKQD,uBACNt8G,KAAKi6G,eAAc5uC,KAAU/iE,SAAU,SAASzF,UAC7C6mB,IACmB,YAAdA,EAAMnjB,MAIVvG,KAAKw8G,yBACLx8G,KAAK67G,uBACL77G,KAAKy8G,4BAELz8G,KAAKi7G,6BACkB,IAAnBj7G,KAAKurB,WACPvrB,KAAK+6G,+BAEP/6G,KAAKo8G,yBAELp8G,KAAKq6G,qBAAkBr4G,EACvBhC,KAAKu7G,2BACLv7G,KAAKy1G,KAAK9yG,KAAK3C,KAAKk8G,iBAAe,EAGzC,CAKQG,gCACqBr6G,IAAvBhC,KAAKk6G,eACPl6G,KAAKk6G,cAAc/rG,aAEvB,CAKQquG,8BACmBx6G,IAArBhC,KAAKi6G,aACPj6G,KAAKi6G,YAAY9rG,aAErB,CAKQysG,+BACyB54G,IAA3BhC,KAAKu2G,oBAITv2G,KAAK67G,uBACL77G,KAAKw8G,yBACLx8G,KAAKq8G,2BACLr8G,KAAKy8G,4BACLz8G,KAAKu7G,2BACLv7G,KAAKu2G,uBAAoBv0G,EAC3B,CAKQu6G,2BACiC,IAAnCv8G,KAAKg6G,4BAITh6G,KAAKu7G,2BACLv7G,KAAKq7G,wBAELr7G,KAAKq2G,MAAMzK,kBAAkBrxF,QAAS21E,IAChCA,aAAyBga,MAC3BlqG,KAAKq2G,MAAMzmB,kBAAkBM,GAC7BlwF,KAAKm6G,sBAAsB7yG,KAAK4oF,GAAa,GAIjDlwF,KAAKg6G,2BAA4B,EACjCh6G,KAAK02G,eAAiB12G,KAAKu2G,kBAAkBjnE,GAC3C,YACC5lB,GAAuB1pB,KAAKy4G,YAAY/uF,IAE3C1pB,KAAK22G,aAAe32G,KAAKu2G,kBAAkBjnE,GACzC,UACC5lB,GAAuB1pB,KAAK04G,UAAUhvF,IAEzC1pB,KAAKq2G,MAAM1lB,eAAe3wF,KAAKu2G,mBACjC,CAKQkG,6BACiC,IAAnCz8G,KAAKg6G,4BAITh6G,KAAKs7G,2BAELt7G,KAAKm6G,sBAAsB5/F,QAAS21E,IAClClwF,KAAKq2G,MAAM1lB,eAAeT,EAAa,GAEzClwF,KAAKm6G,sBAAwB,GAE7Bn6G,KAAKg6G,2BAA4B,KACjC3O,KAAQ,CAACrrG,KAAK02G,eAAgB12G,KAAK22G,aAAc32G,KAAK62G,iBACnC70G,IAAfhC,KAAKq2G,OACPr2G,KAAKq2G,MAAMzmB,kBAAkB5vF,KAAKu2G,mBAEtC,CAMQkC,YAAY/uF,GAClB,MAAMw5E,GAAax5E,EAAM5e,QAAQqiF,cACjCntF,KAAKq6G,gBAAkBr6G,KAAKk8G,gBAAgBl0G,QAE5C,MAAM00G,EACHxZ,GAAmByZ,gBACpB96D,iBACF7hD,KAAK48G,0BAA0BF,GAC/B18G,KAAKw1G,OAAO7yG,KAAK3C,KAAKk8G,iBAEtBl8G,KAAK62G,UAAY3T,GAAW5zD,GAAG,SAAWypE,IACxC/4G,KAAK82G,iBAAgBkC,MAAoCD,GAEzD,MAAM8D,EADmB9D,EAAgBniG,OAEtC+lG,cAAc,GACd96D,iBACH7hD,KAAK88G,6BAA6BD,GAClC78G,KAAK01G,SAAS/yG,KAAK3C,KAAKk8G,gBAAe,GAEzCl8G,KAAK47G,oBACP,CAMQlD,UAAUhvF,IAChB2hF,OAAQrrG,KAAK62G,WACb72G,KAAKq6G,qBAAkBr4G,EAEvB,MAAM06G,GACHhzF,EAAM5e,QAAQqiF,cAAsBwvB,gBACrC96D,iBACF7hD,KAAK88G,6BAA6BJ,IAClC18G,KAAKu7G,2BACLv7G,KAAKy1G,KAAK9yG,KAAK3C,KAAKk8G,iBACpBl8G,KAAK67G,sBACP,CAMQe,0BAA0B12B,GAChC,MAAMgd,GAAaljG,KAAKk8G,gBAClBa,EAAe,IAAIC,IAAa92B,IACtC+2B,QAAyB/Z,GAAY6Z,EACvC,CAMQD,6BAA6B52B,GACnC,MAAMgd,GAAaljG,KAAKk8G,gBAGlBgB,EADgBha,GAAWia,iBAAiBt5F,MAAM,GAAG,GACtBpD,IAAKs8F,GACjCA,EAAal7D,kBAEtBq7D,EAAe51G,KAAK4+E,GACpBgd,GAAWka,eAAeF,EAC5B,CAMQhB,gBACN,MAAMj4D,EAAajkD,KAAKs6G,gBAAgBn2D,cACxC,OAAOF,EAAWr6C,OAAS,EAAIq6C,EAAW,GAAGkpC,mBAAgBnrF,CAC/D,yCCpqBsCggB,8ICkBlC,SAAUq7F,EACd9xG,GAEAA,OACO,IAAI24F,IAAe,CACxB9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,OAHJA,EAAQA,GAAS,CAAC,EAAG,IAAK,MAGToV,OAAO,CAAC,IACrBue,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAOA,EAAMoV,OAAO,CAAC,OAEvB05E,OAAQ,GAEZ,CAMM,SAAU+gB,IACd,OAAO,IAAIlX,KAAc,CACvB9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,EAAG,IAAK,IAAK,GACrB2zB,MAAO,KAGb,CA6FM,SAAU+9E,EACdK,EACAP,GAGAO,EAAUC,iBAAiBR,EAC7B,CAEM,SAAU/D,EAAoCwE,GAClD,MAAMta,EAAasa,EAAQ5mG,OAC3B,OAAIssF,aAAsBd,KACjBc,EAAWb,qBAAqBx+E,OAAM,GAAI,GAE5Bq/E,EACDb,qBAAqBx+E,OAAM,EACnD,kSC/JO,MAAMgjF,EAAQ,iOCGf,SAAU4W,EAAyB/6D,GACvC,MAAMg7D,EAAyBh7D,EAS/B,MAPiD,QAA/Cg7D,EAAuB56D,eAAet/C,OACrCk6G,EAAuBl6D,UAAUC,kBAAkBk6D,YAClDD,EAAuBl6D,UAAUm6D,cAGnCD,EAAuB56D,cAAck6B,aAD1B0gC,EAAuB56D,cAAck6B,cACc,WAEzDt6B,CACT,uECHO,IAAMk7D,EAAc,MAArB,MAAOA,EAGSC,oBAFXC,OAAiB,YAE1B/9G,YAAoB89G,GAAA79G,KAAA69G,qBAA2C,CAO/Dl+F,OAAOo+F,GACL,MAAMC,EAAgC,IAAIhjE,KAC1C,OAAAh7C,KAAK69G,oBACFI,QAAQj+G,KAAK89G,OAAQC,EAAYniC,SACjC73E,QACCs5C,QAAK,EACLuhC,KAAWs/B,GACJA,EAGIl+G,KAAKm+G,aAAaJ,GAFlB/9G,KAAK69G,oBAAoBjwE,IAAI5tC,KAAK89G,OAAQC,KAMtDl7G,UAAWmvF,IACVgsB,EAAQr7G,KAAKqvF,GACbgsB,EAAQ10E,UAAQ,GAEb00E,CACT,CAEQG,aAAaJ,GACnB,MAAMC,EAAgC,IAAIhjE,KAK1CojE,OAJsBp+G,KAAK69G,oBAAoBQ,YAC7Cr+G,KAAK89G,OACLC,EAAYniC,SAGX73E,QACC66E,KAAW0/B,GACTA,EACIt+G,KAAK69G,oBAAoBjwE,IAAI5tC,KAAK89G,OAAQC,IAAW,EACrDn6G,WAAG5B,KAGVa,UAAW07G,IACNA,GACFP,EAAQr7G,KAAK47G,GAEfP,EAAQ10E,UAAQ,GAEb00E,CACT,CAOAC,QAAQriC,GACN,OAAO57E,KAAK69G,oBAAoBI,QAAQj+G,KAAK89G,OAAQliC,EACvD,CAOAyiC,YAAYziC,GACV,OAAO57E,KAAK69G,oBAAoBQ,YAAYr+G,KAAK89G,OAAQliC,EAC3D,CAOA4iC,SACE,OAAOx+G,KAAK69G,oBAAoBW,OAAOx+G,KAAK89G,OAC9C,4CA/EWF,GAAcx8G,MAAAuE,MAAA,iCAAdi4G,EAAcv8G,QAAdu8G,EAAct8G,UAAAC,WAFb,gBAEDq8G,CAAc,KC2Cda,EAAY,MAAnB,MAAOA,EAEDh9G,KACA84D,aACAmkD,kBACAC,kBACA/8G,eACAg9G,eACY/pC,gBAPtB90E,YACU0B,EACA84D,EACAmkD,EACAC,EACA/8G,EACAg9G,EACY/pC,GANZ70E,KAAAyB,OACAzB,KAAAu6D,eACAv6D,KAAA0+G,oBACA1+G,KAAA2+G,oBACA3+G,KAAA4B,iBACA5B,KAAA4+G,iBACY5+G,KAAA60E,iBACnB,CAEHgqC,YAAYn8D,GACV,IAAKA,EAAaj/B,OAChB,OAaF,IAAIg/B,EACJ,OAVEC,EAAaj/B,OAAO5jB,SACpB6iD,EAAaj/B,OAAO5jB,QAAQ0xE,0BAE5B7uB,EAAenmC,KAAYsjC,UACzB6C,EAAaj/B,OAAO5jB,QAAQ0xE,wBAC5B7uB,GAAgB,KAKZA,EAAaj/B,OAAO1jB,aAC1B,KAAKm2E,KACL,KAAKO,KACL,KAAKC,KACL,KAAKC,KACL,KAAKC,KACL,KAAKI,KACHv0B,EAAQziD,KAAK8+G,gBAAgBp8D,GAC7B,MACF,KAAKoZ,KACL,KAAKsa,KACL,KAAKU,KACL,KAAKX,KACL,KAAKva,KACHnZ,EAAQziD,KAAK++G,kBAAkBr8D,GAC/B,MACF,KAAKq0B,IACL,KAAKP,KACH/zB,EAAQziD,KAAKg/G,iBAAiBt8D,GAC9B,MACF,KAAKu0B,KACH,MAAMgoC,EAAgBxB,EAAyB/6D,GAC/CD,EAAQziD,KAAKk/G,sBACXD,GAON,OAAOx8D,CACT,CAEAsY,iBACEkkD,EACAjqC,GAEA,MAAMtyB,EAAe+6D,EAAyBwB,GAC9C,OAAIv8D,EAAaj/B,OACR,IAAI7I,IAAYq7D,GAAMA,EAAEtzE,KAAK3C,KAAK6+G,YAAYn8D,KAGhD1iD,KAAK0+G,kBACT3pC,sBAAsBryB,EAAaI,cAAekyB,GAClDjxE,QACC0c,KAAKgD,IACH,QAAezhB,IAAXyhB,EAGJ,OAAOzjB,KAAK6+G,YAAYr4G,OAAO6H,OAAOq0C,EAAc,CAAEj/B,WAAS,GAGvE,CAEQu7F,iBAAiBt8D,GACvB,OAAO,IAAIy8D,KACTz8D,EACA1iD,KAAK4B,eACL5B,KAAK60E,gBAET,CAEQiqC,gBAAgBp8D,GACtB,OAAO,IAAI08D,KACT18D,EACA1iD,KAAK4B,eACL5B,KAAK60E,gBAET,CAEQkqC,kBAAkBr8D,GACxB,IACI28D,EADAlpG,EAAuCusC,EAAavsC,MAoCxD,GAjCKusC,EAAac,WAChBd,EAAac,SAAW,IAU1BxjD,KAAKs/G,mBAAmB58D,EARG,CACzB,mBACA,aACA,cACA,mBACA,UAKAA,EAAac,SAAS+7D,iBACrB78D,EAAa88D,SAASC,WAEvBtpG,EAAQA,CAACrL,EAASwwD,IAChBt7D,KAAKu6D,aAAamB,YAChBhZ,EAAac,SAAS+7D,eACtBz0G,EACAwwD,GAGJ5Y,EAAac,SAAS+7D,gBACtB78D,EAAa88D,SAASC,aAGtBtpG,EAAQnW,KAAKu6D,aAAamlD,WACxB,QACAh9D,EAAac,SAAS+7D,iBAItB78D,EAAaj/B,kBAAkBqzD,KAEjC3gE,EADeusC,EAAaj/B,OACb5jB,QAAQkH,OAAOoP,cACrBusC,EAAac,UAAUC,iBAAkB,CAClD,MAAMk8D,EAAe3/G,KAAKu6D,aAC1B7X,EAAavsC,MAAQ,CAACrL,EAASwwD,IACtBqkD,EAAapkD,uBAClBzwD,EACA43C,EAAac,SAASC,iBACtB6X,GAGJ+jD,EAAW,IAAItjD,KACbrZ,EACA1iD,KAAK4B,eACL5B,KAAK60E,gBACL70E,KAAK2+G,kBACL3+G,KAAK2+G,kBAAkBiB,aACvB5/G,KAAK4+G,eAET,CAEA,GAAIl8D,EAAaj/B,kBAAkBm4C,KAAmB,CACpD,MAAM+jD,EAAe3/G,KAAKu6D,aACpBkB,EAAY/Y,EAAac,SAASE,iBACxChB,EAAavsC,MAAQ,CAACrL,EAASwwD,IACtBqkD,EAAahkD,mBAClB7wD,EACAwwD,EACA5Y,EAAa8Y,aACbC,GAGJ4jD,EAAW,IAAItjD,KACbrZ,EACA1iD,KAAK4B,eACL5B,KAAK60E,gBACL70E,KAAK2+G,kBACL3+G,KAAK2+G,kBAAkBiB,aACvB5/G,KAAK4+G,eAET,CAEA,MAAMiB,EAAiBr5G,OAAO6H,OAAO,GAAIq0C,EAAc,CACrDvsC,UAGF,OAAKkpG,IACHA,EAAW,IAAItjD,KACb8jD,EACA7/G,KAAK4B,eACL5B,KAAK60E,gBACL70E,KAAK2+G,kBACL3+G,KAAK2+G,kBAAkBiB,aACvB5/G,KAAK4+G,iBAIT5+G,KAAK8/G,iBAAiBT,EAAUQ,GAEzBR,CACT,CAEQC,mBAAmB58D,EAAcq9D,GACvCA,EAAmBt/F,IAAKu/F,IACtB,GAAIt9D,EAAas9D,GAAe,CAC9B,IAAI9mF,EAAS8mF,EACb,GAAqB,UAAjBA,EAA0B,CAC5B,GAAIt9D,EAAas9D,aAAyB5lB,KACxC,OAEF,GAA0C,iBAA/B13C,EAAas9D,GAGtB,OAFA9mF,EAAS,gBAIb,CACAwpB,EAAac,SAAStqB,GAAUwpB,EAAas9D,UACtCt9D,EAAas9D,GACpB98C,QAAQC,KAAK,gDACwB68C,+FAE/BA,8CAAyD9mF,gFAGjE,GAEJ,CAEQgmF,sBACNx8D,GAEA,IAAIvsC,EACAkpG,EAuBJ,GArBK38D,EAAac,WAChBd,EAAac,SAAW,IAS1BxjD,KAAKs/G,mBAAmB58D,EAPG,CACzB,mBACA,aACA,cACA,UAKEA,EAAac,SAAS+7D,iBACxBppG,EAAQA,CAACrL,EAASwwD,IAChBt7D,KAAKu6D,aAAamB,YAChBhZ,EAAac,SAAS+7D,eACtBz0G,EACAwwD,IAIF5Y,EAAac,SAASC,iBAAkB,CAC1C,MAAMk8D,EAAe3/G,KAAKu6D,aAC1B7X,EAAavsC,MAAQ,CAACrL,EAASwwD,IACtBqkD,EAAapkD,uBAClBzwD,EACA43C,EAAac,SAASC,iBACtB6X,GAGJ+jD,EAAW,IAAIY,KACbv9D,EACA1iD,KAAK4B,eACL5B,KAAK60E,gBAET,CAEA,MAAMgrC,EAAiBr5G,OAAO6H,OAAO,GAAIq0C,EAAc,CACrDvsC,UAGF,OAAKkpG,IACHA,EAAW,IAAIY,KACbJ,EACA7/G,KAAK4B,eACL5B,KAAK60E,kBAIT70E,KAAK8/G,iBAAiBT,EAAUQ,GACzBR,CACT,CAEQS,iBAAiBr9D,EAAcC,GACjCA,EAAac,UAAU08D,aACzBlgH,KAAKmgH,SAASz9D,EAAac,SAAS08D,YAAY39G,KAAKM,UAAW86C,IAC9D,GAAIA,EAAIyiE,OAAQ,CACd,MAAM79G,EAAMvC,KAAKqgH,eACf39D,EAAac,SAAS08D,YAAY39G,IAClCo7C,EAAIyiE,QAENpgH,KAAKmgH,SAAS59G,EAAM,SAASM,UAAWy9G,KACtCC,QACE99D,EAAMpB,GACN1D,EACA+E,EAAac,SAAS08D,YAAYz8F,YAClCzhB,EACAs+G,EACA/9G,EAAM,OAAM,EAGlB,MACEg+G,QACE99D,EAAMpB,GACN1D,EACA+E,EAAac,SAAS08D,YAAYz8F,OAAM,EAKlD,CAEQ08F,SAAS59G,GACf,OAAOvC,KAAKyB,KAAKvB,IAAIqC,GAAKwB,QACxB0c,KAAKk9B,GAAaA,IAAG,EACrBz5C,KAAYC,IACV++D,QAAQK,IAAI,uBAAoB,EACzB3/D,MAAGO,KAGhB,CAEQk8G,eAAe58F,EAAQlhB,GAE7B,OADU,IAAIyH,OAAO,WAAY,KAC3BE,KAAK3H,GACFA,EAEkC,MAArCkhB,EAAO6mC,OAAO7mC,EAAO7Z,OAAS,GACzB6Z,EAASlhB,EAETkhB,EAAS,IAAMlhB,CAG5B,CAEAi6D,qBAAqBqoB,EAAqB,KACxC,OAAO7kF,KAAK4+G,eAAeJ,SAASz6G,QAClC66E,KAAWjhC,IAKT,MAAM6iE,GAHW,MAAf37B,EACIlnC,EAAIj0C,OAAQq2C,GAAMA,EAAEi1B,qBAAuB6P,GAC3ClnC,GAC0Cl9B,IAAKggG,GACnDj6G,OAAO6H,OAAO,GAAIoyG,EAAK/9D,aAAc,CACnCI,cAAe29D,EAAK39D,iBAGxB,SAAO7/B,KACLu9F,EAAc//F,IAAKiiC,GACjB1iD,KAAK+6D,iBAAiBrY,IACvB,GAIT,4CAjWW+7D,GAAYr9G,MAAAuE,MAAAvE,MAAAwE,KAAAxE,MAAAyE,KAAAzE,MAAA0E,KAAA1E,MAAA2E,MAAA3E,MAAA4E,GAAA5E,MAAAuT,KAAA,oCAAZ8pG,EAAYp9G,QAAZo9G,EAAYn9G,UAAAC,WAFX,gBAEDk9G,CAAY,0JCzCnB,MAAOU,UAAmB3vC,IASrB5tE,eACAizE,gBALD1iE,QAERpS,YACEF,EACO+B,EACAizE,GAEPzuE,MAAMvG,EAAS+B,EAAgBizE,GAHxB70E,KAAA4B,iBACA5B,KAAA60E,kBAGP70E,KAAKmS,QAAU,IAAIuuG,IAAa1gH,KAAMA,KAAK4B,gBAC3C5B,KAAK25D,QAAU35D,KAAKmS,QAAQwnD,QAC5B35D,KAAK25D,QAAQ92D,UAAW89G,IACJ,IAAdA,IACF3gH,KAAK4gH,kBAAmB,IAG9B,CAEUC,gBACR,MAAMC,EAAYt6G,OAAO6H,OAAO,GAAIrO,KAAKH,QAAS,CAChD4jB,OAAQzjB,KAAKH,QAAQ4jB,OAAO49B,KAGxB0qC,EAAQ,IAAIg1B,IAAaD,GAC/B,OAAI9gH,KAAK60E,iBACNkX,EAAMpoC,YAAoBq9D,qBAAqB,CAACC,EAAM14E,KACrDvoC,KAAKkhH,aAAaD,EAAM14E,EAAKvoC,KAAK60E,gBAAiB70E,KAAK4B,eAAc,GAInEmqF,CACT,CAEOo1B,OAAO1gG,QACAze,IAARye,EACFzgB,KAAKmS,QAAQhE,cAEbnO,KAAKmS,QAAQtP,UAAU,QAEzBuD,MAAM+6G,OAAO1gG,EACf,CAEQygG,aACND,EACA14E,EACA64E,EACAx/G,GAEA,MAAMsH,EAAM,IAAIm4G,eAEVC,EAAwBF,EAAYh4G,oBAAoBm/B,GAC9D,IAAIhmC,EAAMgmC,EAMV,GALI+4E,IACF/+G,EAAM++G,GAERp4G,EAAIqP,KAAK,MAAOhW,IACI6+G,EAAYn4G,aAAaC,EAAK3G,GAIhD,OAFA2G,EAAIq4G,aACJN,EAAKO,WAAWj5E,IAAMhmC,GAIxB2G,EAAI0/B,aAAe,cAEnB1/B,EAAI++C,OAAS,WACX,MAAMw5D,EAAkB,IAAIC,WAAY1hH,KAAagyF,WAC9B,IAAI2vB,aAAc/gH,OAAO6gH,GAC7BzpF,SAAS,2BAC1Bp2B,EAAewC,MACb,2CACA,uCAGJ,MAAM2kC,EAAO,IAAI64E,KAAK,CAACH,GAAkB,CAAEj+G,KAAM,cAE3Cq+G,EADat6G,OAAO63F,IACEG,gBAAgBx2D,GAC5Ck4E,EAAKO,WAAWj5E,IAAMs5E,CACxB,EACA34G,EAAI44G,MACN,4BC/EI,MAAO1C,UAAkB5vC,IAepB5tE,eACAizE,gBALD1iE,QAERpS,YACEF,EACO+B,EACAizE,GAEPzuE,MAAMvG,EAAS+B,GAHR5B,KAAA4B,iBACA5B,KAAA60E,kBAIP70E,KAAKmS,QAAU,IAAI4vG,IAAY/hH,MAC/BA,KAAK25D,QAAU35D,KAAKmS,QAAQwnD,OAC9B,CAEUknD,gBACR,MAAMC,EAAYt6G,OAAO6H,OAAO,GAAIrO,KAAKH,QAAS,CAChD4jB,OAAQzjB,KAAKH,QAAQ4jB,OAAO49B,KAExB2gE,EAAY,IAAIC,IAAYnB,GAElCoB,OADmBF,EAAUr+D,YAClBw+D,oBAAoB,CAAClB,EAAY1+G,KAC1CvC,KAAKkhH,aAAaD,EAAM1+G,EAAKvC,KAAK60E,gBAAe,GAG5CmtC,CACT,CAQAd,aAAaD,EAAM1+G,EAAa6+G,GAC9B,MAAME,EAAwBF,EAAYh4G,oBAAoB7G,GAC9D,IAAI6/G,EAAc7/G,EACd++G,IACFc,EAAcd,GAEhBL,EAAKO,WAAWj5E,IAAM65E,CACxB,CAEOjB,OAAO1gG,QACAze,IAARye,EACFzgB,KAAKmS,QAAQhE,cAEbnO,KAAKmS,QAAQtP,UAAU,QAEzBuD,MAAM+6G,OAAO1gG,EACf,4BChEI,MAAOw/F,UAAwBzwC,IAS1B5tE,eACAizE,gBALD1iE,QAERpS,YACEF,EACO+B,EACAizE,GAEPzuE,MAAMvG,EAAS+B,EAAgBizE,GAHxB70E,KAAA4B,iBACA5B,KAAA60E,kBAGP70E,KAAKmS,QAAU,IAAI4vG,IAAY/hH,MAC/BA,KAAK25D,QAAU35D,KAAKmS,QAAQwnD,OAC9B,CAEUknD,gBACR,MAAMC,EAAYt6G,OAAO6H,OAAO,GAAIrO,KAAKH,QAAS,CAChD4jB,OAAQzjB,KAAKH,QAAQ4jB,OAAO49B,KAGxBghE,EAAa,IAAIC,IAAkBxB,GAGzCyB,OAFyBF,EAAW1+D,YAEnBw+D,oBAAoB,CAAClB,EAAkB1+G,KACtD,MAAM6iE,EAASplE,KAAKkhH,aAClB3+G,EACA0+G,EAAKuB,YACLxiH,KAAK60E,gBACLosC,EAAKwB,OAAO9nC,KAAKsmC,IAEf77C,GACF67C,EAAKyB,UAAUt9C,EAAM,GAIlBi9C,CACT,CAWAnB,aAAa3+G,EAAKo1B,EAAQypF,EAAa32D,EAASk4D,GAC9C,MAAO,CAACnyC,EAAQlV,EAAYtZ,MAC1B,MAAM94C,EAAM,IAAIm4G,eAChB,IAAIe,EAAc7/G,EAClB,GAAmB,mBAARA,EAAoB,CAC7B,MAAM++G,EAAwBF,EAAYh4G,oBAAoB7G,GAC1D++G,IACFc,EAAcd,EAElB,MACEc,EAAc7/G,EAAIiuE,EAAQlV,EAAYtZ,IAExC94C,EAAIqP,KAAK,MAAO6pG,GACZhB,GACFA,EAAYn4G,aAAaC,EAAKk5G,GAGP,gBAArBzqF,EAAOsqE,YACT/4F,EAAI0/B,aAAe,eAErB1/B,EAAI++C,OAAUv+B,IACZ,IAAKxgB,EAAIysF,QAAWzsF,EAAIysF,QAAU,KAAOzsF,EAAIysF,OAAS,IAAM,CAC1D,MAAMnyF,EAAOm0B,EAAOsqE,UACpB,IAAIx+E,EACS,SAATjgB,GAA4B,SAATA,EACrBigB,EAASva,EAAI05G,aACK,QAATp/G,GACTigB,EAASva,EAAI25G,YACRp/F,IACHA,GAAS,IAAIq/F,WAAYC,gBACvB75G,EAAI05G,aACJ,qBAGc,gBAATp/G,IACTigB,EAASva,EAAI8oF,UAEXvuE,EACFgnC,EAAQrvC,KACNpb,KACA23B,EAAOwvB,aAAa1jC,EAAQ,CAC1B+sD,SACA9rB,kBAAmB1C,KAErBrqB,EAAOqrF,eAAev/F,IAIxBk/F,EAAQvnG,KAAKpb,KAEjB,MAEE2iH,EAAQvnG,KAAKpb,KAAI,EAGrBkJ,EAAIi/C,QAAU,KAEZw6D,EAAQvnG,KAAKpb,KAAI,EAEnBkJ,EAAI44G,MAAI,CAEZ,CAEOX,OAAO1gG,QACAze,IAARye,EACFzgB,KAAKmS,QAAQhE,cAEbnO,KAAKmS,QAAQtP,UAAU,QAEzBuD,MAAM+6G,OAAO1gG,EACf,6DCzDK,IAAKwiG,EAAZ,SAAYA,GACVA,SAAAC,QAAA,UACAD,EAAAE,QAAA,UACAF,EAAAG,WAAA,aACAH,EAAAI,cAAA,gBACAJ,EAAAK,cAAA,gBACAL,EAAAM,OAAA,SACAN,EAAAO,WAAA,aAPUP,CAQZ,CARA,CAAYA,GAAgB,IAoBhBQ,EAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,SAAA,WACAF,EAAAG,OAAA,SAHUH,CAIZ,CAJA,CAAYA,GAAW,sGCvEjB,MAAgBj0C,EAwHX3vE,QACG+B,eACAizE,gBACA+qC,aACHhB,eA3HF9tG,UACAulB,WACAy4C,OACA+0C,iBAA2B,EAC3BC,oBAA8B,EAC9BrjG,IACA4gC,GACAu/D,kBAA4B,EAC5BjnD,QACAoqD,gBAA4C,IAAIhiH,SACrDC,GAEMgiH,iBACAtf,aAOR,sBAAIvvC,GACF,OAAOn1D,KAAKH,QAAQs1D,qBAAsB,CAC5C,CAEA,MAAIjjD,GACF,OAAOlS,KAAKH,QAAQqS,IAAMlS,KAAKq2B,WAAWnkB,EAC5C,CAEA,SAAIwrE,GACF,OAAO19E,KAAKH,QAAQ69E,KACtB,CAEA,SAAI9xE,GACF,OAAO5L,KAAKH,QAAQ+L,KACtB,CAEA,SAAIA,CAAMA,GACR5L,KAAKH,QAAQ+L,MAAQA,CACvB,CAEA,UAAI42C,GACF,OAAOxiD,KAAKqhD,GAAG4iE,WACjB,CAEA,UAAIzhE,CAAOA,GACTxiD,KAAKqhD,GAAG6iE,UAAU1hE,EACpB,CAEA,aAAIH,GACF,OAAOriD,KAAKH,QAAQwiD,SACtB,CAEA,aAAIA,CAAUA,GACZriD,KAAKH,QAAQwiD,UAAYA,CAC3B,CAEA,WAAIO,GACF,OAAO5iD,KAAKqhD,GAAGnhD,IAAI,UACrB,CAEA,WAAI0iD,CAAQA,GACV5iD,KAAKqhD,GAAG8iE,WAAWvhE,EACrB,CAEA,wBAAIwhE,CAAqB19G,GACvB1G,KAAKqkH,sBAAsB1hH,KAAK+D,EAClC,CACA,wBAAI09G,GACF,OAAOpkH,KAAKqkH,sBAAsB39G,KACpC,CACS29G,sBACP,IAAItiH,KAAgB,GAEtB,iBAAI0vE,CAAc/qE,GAChB1G,KAAKqhD,GAAGijE,iBAA2B,IAAV59G,EAAc,EAAIA,GAAS69G,KACpDvkH,KAAKwkH,0BACP,CACA,iBAAI/yC,GACF,OAAOzxE,KAAKqhD,GAAGojE,kBACjB,CAEA,iBAAI7yC,CAAclrE,GAChB1G,KAAKqhD,GAAGqjE,iBAAiBh+G,GAAS,GAClC1G,KAAKwkH,0BACP,CACA,iBAAI5yC,GACF,OAAO5xE,KAAKqhD,GAAGsjE,kBACjB,CAEA,WAAI9tF,CAAQnwB,GACV1G,KAAKqhD,GAAGujE,WAAWl+G,GACnB1G,KAAK6kH,SAASliH,KAAK+D,IACd1G,KAAK+jH,gBAAgBr9G,OAASA,GACjC1G,KAAK+jH,gBAAgBphH,KAAK+D,GAExB1G,KAAKH,SAAS+mC,UAAYlgC,GAC5B1G,KAAKH,SAAS+mC,SACXl9B,OAAQo7G,GAAMA,EAAEjlH,SAASklH,2BACzBtkG,IAAKjI,GAAYxY,KAAKglH,YAAYxsG,GAEzC,CACA,WAAIqe,GACF,OAAO72B,KAAK6kH,SAASn+G,KACvB,CACSm+G,SAAqC,IAAI9iH,SAAgBC,GAElE,aAAIijH,GACF,OAAOjlH,KAAK62B,SAAW72B,KAAKokH,oBAC9B,CACSc,cAAkCjiG,KAAc,CACvDjjB,KAAKqkH,sBACLrkH,KAAK6kH,WACJ9gH,QAAK0c,KAAKM,GAA8BA,EAAM,IAAMA,EAAM,KAE7D,mBAAI4oC,GACF,OAAwC,IAAjC3pD,KAAKH,QAAQ8pD,eACtB,CAEA5pD,YACSF,EACG+B,EACAizE,EACA+qC,EACHhB,GAJA5+G,KAAAH,UACGG,KAAA4B,iBACA5B,KAAA60E,kBACA70E,KAAA4/G,eACH5/G,KAAA4+G,iBAEP5+G,KAAKq2B,WAAax2B,EAAQ4jB,OAE1BzjB,KAAKqhD,GAAKrhD,KAAK6gH,qBACQ7+G,IAAnBnC,EAAQ2iD,SACVxiD,KAAKwiD,OAAS3iD,EAAQ2iD,QAGpB3iD,EAAQwiD,gBAAiCrgD,IAApBnC,EAAQg3B,UAC/Bh3B,EAAQg3B,SAAU,GAGpB72B,KAAKyxE,cACH5xE,EAAQ4xE,kBACRC,MAAuBv2C,OAAOt7B,EAAQslH,gBACxCnlH,KAAK4xE,cACH/xE,EAAQ+xE,kBACRF,MAAuBv2C,OAAOt7B,EAAQulH,gBAExCplH,KAAK62B,aAA8B70B,IAApBnC,EAAQg3B,SAA+Bh3B,EAAQg3B,QAC9D72B,KAAK4iD,aAA8B5gD,IAApBnC,EAAQ+iD,QAAwB,EAAI/iD,EAAQ+iD,QAGzD/iD,EAAQqwE,gBACPrwE,EAAQqwE,cAAc3tE,KAAO1C,EAAQqwE,cAAcj7D,QAEpDjV,KAAK8uE,OAAS9uE,KAAKq2B,WAAWshD,UAAU93E,EAAQqwE,gBAGlDlwE,KAAK6jH,iBAAkBhkH,EAAQqwE,gBAC3BrwE,EAAQqwE,cAAcp/D,WACpBjR,EAAQqwE,cAAcp/D,UAI5B9Q,KAAKqhD,GAAGhhD,IAAI,SAAUL,MAAM,EAC9B,CAIAmhH,OAAO1gG,GACLzgB,KAAKygB,IAAMA,EAEXzgB,KAAKqlH,2BACOrjH,IAARye,IACFzgB,KAAKslH,oBACLtlH,KAAKgkH,iBAAmBhkH,KAAK+jH,gBAAgBlhH,UAAU,KACjD7C,KAAKH,QAAQ+mC,UAAY5mC,KAAK62B,SAChC72B,KAAKH,QAAQ+mC,SAASnmB,IAAKjI,IACzBxY,KAAKglH,YAAYxsG,EAAO,EACzB,GAIT,CAEQwsG,YAAYxsG,GACbxY,KAAK4B,iBAGV4W,EAAQ5M,MAAQ4M,EAAQ5M,MACxB4M,EAAQo0B,KAAOp0B,EAAQo0B,KACvB5sC,KAAK4B,eAAe4W,QAAQA,GAC9B,CAEQ8sG,oBACNtlH,KAAK0kG,aAAe1kG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UAAU,IAChE7C,KAAKwkH,2BAET,CAEQa,2BACoBrjH,IAAtBhC,KAAK0kG,eACP1kG,KAAK0kG,aAAav2F,cAClBnO,KAAK0kG,kBAAe1iG,EAExB,CAEQwiH,2BACN,QAAiBxiH,IAAbhC,KAAKygB,IAAmB,CAC1B,MAAM66C,EAAat7D,KAAKygB,IAAIyhC,eAAe4iD,gBAI3C9kG,KAAKokH,qBACH9oD,GAJoBt7D,KAAK4xE,eAIMtW,SAFRt5D,IAAvBhC,KAAKyxE,cAA8B8yC,IAAWvkH,KAAKyxE,cAGvD,MACEzxE,KAAKokH,sBAAuB,CAEhC,qTCrLI,MAAOroD,UAAoByT,IA0BtB5tE,eACAizE,gBACC8pC,kBACDiB,aACAhB,eA7BD2G,mBACAC,uBACAC,mBACAC,eAAmC,GASnCvzG,QACAwzG,uBAER,aAAItqB,GACF,OAAkC,IAA3Br7F,KAAKH,QAAQw7F,SACtB,CAEA,cAAID,GACF,OAAmC,IAA5Bp7F,KAAKH,QAAQu7F,UACtB,CAEAr7F,YACEF,EACO+B,EACAizE,EACC8pC,EACDiB,EACAhB,GAEPx4G,MACEvG,EACA+B,EACAizE,EACA+qC,EACAhB,GAXK5+G,KAAA4B,iBACA5B,KAAA60E,kBACC70E,KAAA2+G,oBACD3+G,KAAA4/G,eACA5/G,KAAA4+G,iBASP5+G,KAAKmS,QAAU,IAAIyzG,IAAc5lH,MACjCA,KAAK25D,QAAU35D,KAAKmS,QAAQwnD,OAC9B,CAEUknD,gBACR,MAAMgF,EAAsB7lH,KAAKH,QAAQ+iD,SAAW,EAC9CkjE,GAA+C,IAAzB9lH,KAAKH,QAAQg3B,QACnCkvF,EACJ/lH,KAAKH,QAAQ+xE,kBACbF,OAAuBv2C,OAAOn7B,KAAKH,QAAQulH,gBACvCY,EACJhmH,KAAKH,QAAQ4xE,kBACbC,OAAuBv2C,OAAOn7B,KAAKH,QAAQslH,gBACvCve,EAAK5mG,KAAKH,QAAQijD,cACpB9iD,KAAKq2B,sBAAsBylC,MACzB8qC,GAAIqf,SAASC,kBAAoBtf,GAAIqf,SAASE,iBAChDnmH,KAAKH,QAAQ+iD,QAAU,EAErBgkD,EAAGqf,QAAQC,mBACVlmH,KAAKH,QAAQ+xE,eAAiB5xE,KAAKH,QAAQ4xE,iBAE5CzxE,KAAKH,QAAQ+xE,cAAgB,EAC7B5xE,KAAKH,QAAQ4xE,cAAgB8yC,KAE3B3d,EAAGqf,QAAQE,gBAAkBL,IAC/B9lH,KAAKH,QAAQg3B,SAAU,IAK7B,MAAMiqF,EAAYt6G,OAAO6H,OAAO,GAAIrO,KAAKH,QAAS,CAChD4jB,OAAQzjB,KAAKH,QAAQ4jB,OAAO49B,GAC5ByB,cAAe9iD,KAAKH,QAAQijD,eAAiB9iD,KAAKH,QAAQ4jB,OAAO5jB,UAG/DG,KAAKH,QAAQy5C,WACft5C,KAAKq2B,WAAWgrB,GAAG/R,GACjB,aACA,SAAU3D,GACR3rC,KAAKomH,MAAMz6E,EAAE7gC,QACf,EAAE6vE,KAAK36E,OAGPA,KAAKH,QAAQ2/G,SAASC,YAAcz/G,KAAK4/G,eACvC5/G,KAAKH,QAAQ2/G,QAAQ6G,WACvBrmH,KAAKsmH,wBAEPtmH,KAAKq2B,WAAWgrB,GAAGspC,KAAK,kBAAmB,KACzC3qF,KAAKq2B,WAAWgrB,GAAG/R,GAAG,aAAc,IAAMtvC,KAAKsmH,yBAC/CtmH,KAAKq2B,WAAWgrB,GAAG/R,GAAG,gBAAiB,IACrCtvC,KAAKsmH,yBAEPtmH,KAAKq2B,WAAWgrB,GAAG/R,GAAG,QAAS,IAAMtvC,KAAKsmH,yBAC1CtmH,KAAKq2B,WAAWgrB,GAAG/R,GAAG,gBAAiB,IACrCtvC,KAAKsmH,wBAAuB,IAMhCtmH,KAAKq2B,sBAAsBylC,MAC1B8qC,GAAIqf,SAASC,kBAAoBtf,GAAIqf,SAASE,gBAE/CnmH,KAAKq2B,WAAWgrB,GAAGspC,KAAK,kBAAmB,KACrCk7B,IACF7lH,KAAK4iD,QAAUijE,GAEbjf,EAAGqf,QAAQC,mBACblmH,KAAK4xE,cAAgBm0C,EACrB/lH,KAAKyxE,cAAgBu0C,GAEnBpf,EAAGqf,QAAQE,gBACbnmH,KAAK62B,QAAUivF,KAKjB9lH,KAAKH,QAAQ0mH,cACfvmH,KAAKwmH,mBAAmBxmH,KAAKH,QAAQ0mH,cAGvC,MAAME,EAAS,IAAIC,IAAc5F,GAC3B6F,EAAeF,EAAO9iE,YACtBphD,EAAMokH,EAAavhC,SACzB,GAAmB,mBAAR7iF,EACT,OAAOkkH,EAET,GAAIlkH,GAAyC,QAAlCu+G,EAAUh+D,eAAet/C,KAAgB,CAClD,IAAI4hE,EACJ,MAAMie,EAAay9B,EAAUh+D,cAK3BsiB,EAHqB,QAArBie,GAAY7/E,OACX6/E,EAAWt8E,QAAUs8E,EAAW9K,WAExBnT,CAACoL,EAAQlV,GAAY/Z,GAAMkJ,GAASk4D,MAC3C3iH,KAAK4mH,gBACHD,EACAtjC,EACArjF,KAAK60E,gBACLrE,EACAlV,GACA/Z,GACAkJ,GACAk4D,GAAO,EAIFv9C,CAACoL,EAAQlV,GAAY/Z,GAAMkJ,GAASk4D,MAC3C3iH,KAAKkhH,aACHyF,EACApkH,EACAvC,KAAK60E,gBACLrE,EACAlV,GACA/Z,GACAkJ,GACAk4D,GAAO,EAITv9C,GACFuhD,EAAajE,UAAUt9C,EAE3B,SAAWplE,KAAKH,QAAQ2/G,SAASC,YAAcz/G,KAAK4/G,aAAc,CAChE,MAAMiH,EAAYA,CAACr2C,EAAQlV,EAAY/Z,GAAMkJ,GAASk4D,MACpD3iH,KAAK8mH,gBACHH,EACA7F,EAAU5uG,GACVs+D,EACAjvB,GACAkJ,GACAk4D,GAAO,EAGPkE,GACFF,EAAajE,UAAUmE,EAE3B,CAEA,OAAI7mH,KAAKH,QAAQ2/G,SAASC,YAAcz/G,KAAK4/G,cAC3C6G,EAAO97B,KAAK,cAAe,KACrB3qF,KAAKH,QAAQ2/G,QAAQ6G,WACvBrmH,KAAK+mH,wBAAoB,EAE3B17C,KAAqBo7C,EAAQ,UAC1B1iH,QAAKof,KAAa,MAClBtgB,UAAU,IAAM7C,KAAK+mH,wBACxBN,EAAOn3E,GAAG,gBAAiB,IAAMtvC,KAAK+mH,uBAAsB,GAGzDN,CACT,CAEAO,qBACMhnH,KAAK4/G,cAAgB5/G,KAAK4+G,mBAC5BqI,KACEjnH,KAAK4/G,aAAavB,YAAYr+G,KAAKkS,IACnClS,KAAK4+G,eAAeP,YAAYr+G,KAAKkS,KACrCrP,WAEN,CAEQkkH,uBACN/mH,KAAKH,QAAQ2jD,SAAS+7D,eChQpB,SAAU2H,EAAuBzkE,GACrC,MAAM0kE,EAAe1kE,EAAM2tB,WAC3B,MAA4B,mBAAjB+2C,GAA+BA,aAAwB5rG,WAChE,EAGa,CACbigE,KAAM,CACJjwE,MAAO47G,EAAaC,UAAUC,YAEhCjsC,OAAQ,CACN7vE,MAAO47G,EAAaG,YAAYD,WAChCnoF,MAAO,GAETqoF,OAAQ,CACN/rC,KAAM,CACJjwE,MAAQ47G,EAAa3F,WAAmB4F,UAAUC,YAEpDjsC,OAAQ,CACN7vE,MAAQ47G,EAAa3F,WAAmB8F,YAAYD,WACpDnoF,MAAO,GAETm7D,OAAQ,GAId,CDsO2C6sB,CAAuBlnH,KAAKqhD,IACnE,MAAMmmE,EAAyBjrG,KAAY+0D,gBAAgB,CACzDsK,QAAS57E,KAAKkS,GACd8iE,mBAAoBh1E,KAAKH,QAAQ2/G,QAAQ36B,WACzC/hC,cAAe,CACb5wC,GAAIlS,KAAKkS,GACT1O,KAAM,SACNu/C,WAAW,GAEbL,aAAc,CACZjI,UAAWz6C,KAAKH,QAAQ46C,UACxB+H,OAAQxiD,KAAKqhD,GAAKrhD,KAAKwiD,OAAS,IAChCtwC,GAAIlS,KAAKkS,GACTijD,mBAAoBn1D,KAAKm1D,mBACzBvpD,MAAO5L,KAAK4L,MACZ43C,SAAUxjD,KAAKH,QAAQ2jD,SACvBg8D,QAASh5G,OAAO6H,OAAO,GAAIrO,KAAKH,QAAQ2/G,QAAS,CAAE6G,WAAW,KAEhEoB,YAAa,GAAGznH,KAAK4L,SAAS5L,KAAKkS,MAAM,IAAIjR,SAE/CjB,KAAK4+G,eAAej/F,OAAO6nG,EAC7B,CAEQlB,wBACN,MAAMoB,EAAa1nH,KAAKq2B,WAAWgrB,GAAG8C,cAChCwjE,EAAgB1vF,KAAKC,OACzB,IAAI6/C,KAAmBvzB,cAAckjE,EAAY,CAC/CjjE,eAAgB,YAChBC,kBAAmB1kD,KAAKq2B,WAAWgrB,GAAGG,iBAAmB,eAG7DxhD,KAAK4/G,aAAajgG,OAChB3f,KAAKkS,GACLlS,KAAKkS,GACLy1G,EACAC,IAAyBC,KACzB,GAAG7nH,KAAK4L,SAAS5L,KAAKkS,MAAM,IAAIjR,OAEpC,CAEUmlH,MAAMt7G,GACd,MAAMkmC,OAAY/vC,MAAOC,UACnB4mH,EAAc9nH,KAAKqhD,GAAG/R,GAAG,aAE/B,SAASqI,EAAQjuB,GACf,MAAMq+F,KAAgBC,MAAiBt+F,GACjCu+F,EAAav+F,EAAMu+F,WACnBC,EAAYp9G,EAAQqiF,cAAcnlF,QAClCmgH,EAAUF,EAAWh1C,KAAOjiC,EAC5Bo3E,EAAeD,EAAUnoH,KAAKH,QAAQy5C,UAAUusC,SAChDjjC,KAAUylE,MAAQ,EAAID,GACtBE,KAAWC,MAAavoH,KAAKH,QAAQy5C,UAAU/tC,OAAS,OAC9D+8G,EAAS,GAAK1lE,EACd,IAAIzsC,GAAQnW,KAAKqhD,GACdmnE,mBACAptG,KAAKpb,KAAM8K,GACXsX,KAAMqmG,IACEA,GAAOjH,YAEbrrG,KACHA,GAAQnW,KAAKqhD,GAAGmnE,mBAAmBptG,KAAKpb,KAAM8K,GAAS,IAEzD,MAAM49G,GAAavyG,GAAMnO,QAEzB,OAAQ8C,EAAQqiF,cAAc8U,WAC5B,IAAK,QACH,GAC4B,OAA1BymB,GAAWlH,YACgC,mBAApCkH,GAAWlH,WAAWmH,UAC7B,CACA,MAAMtuB,MACJguB,MAAQD,IAAqD,EAApCM,GAAWlH,WAAWmH,aACjDD,GAAWlH,WAAWoH,UAAUvuB,IAChCquB,GAAWlH,WAAW2C,WAAWvhE,EACnC,CAEA,MACF,IAAK,aAEC8lE,GAAWlH,aACbkH,GAAWlH,WAAW8F,YAAYuB,SAASP,GAC3CI,GACGlH,WACA8F,YACAwB,YACCT,MAAQD,IAC0C,EAA/CM,GAAWlH,WAAW8F,YAAYhuB,cAGvCovB,GAAWpB,cACboB,GAAWpB,YAAYuB,SAASP,GAChCI,GACGpB,YACAwB,YACCT,MAAQD,IAAqD,EAApCM,GAAWpB,YAAYhuB,cAGtD,MACF,IAAK,UAECovB,GAAWlH,YACbkH,GAAWlH,WAAW4F,UAAUyB,SAASP,GAEvCI,GAAWtB,WACbsB,GAAWtB,UAAUyB,SAASP,GASpC,GAJAI,GAAWK,QAAQ,IACnBhB,EAAc9jB,SAASykB,IACvBX,EAAciB,aAAad,GAEvBC,EAAUnoH,KAAKH,QAAQy5C,UAAUusC,SAKnC,OAJAwlB,OAAQyc,QAGR9nH,KAAKygB,IAAI4gC,GAAG4nE,SAIdjpH,KAAKygB,IAAI4gC,GAAG4nE,QACd,EAhFqDtuC,KAAK36E,MAiF5D,CAEOmhH,OAAO1gG,QACAze,IAARye,EACFzgB,KAAKmS,QAAQhE,cAEbnO,KAAKmS,QAAQtP,UAAU,QAEzBuD,MAAM+6G,OAAO1gG,EACf,CAEO2oF,UAAU54B,GACfxwE,KAAKH,QAAQ2wE,OAASA,CACxB,CAEO8G,YACLt3E,KAAKq2B,WAAWihD,YAChBt3E,KAAKkpH,eACP,CAEOA,gBACLlpH,KAAKq2B,WAAWgrB,GAAG8nE,GACjB,aACA,SAAUx9E,GACJ3rC,KAAK62B,SACP72B,KAAKomH,MAAMz6E,EAAE7gC,QAEjB,EAAE6vE,KAAK36E,MAEX,CAEOwmH,mBAAmBt0G,GACxBlS,KAAK2lH,uBAAyB3lH,KAAKq2B,WAAWgrB,GAAG/R,GAC/C,aACAtvC,KAAKumH,aAAa5rC,KAAK36E,KAAMkS,GAEjC,CACOk3G,mBAAmBl3G,GACxB,MAAMm3G,EAAOrpH,KAAKq2B,WAAWgrB,GAAGs7B,eAAezqE,GAC3Cm3G,GACFrpH,KAAKygB,IAAI4gC,GACNC,UACAgoE,UAAWD,EAAKl8B,cAAsBtrC,iBAE7C,CAEO0kE,aAAar0G,EAAIm3G,GAClBA,EAAKv+G,QAAQ8xE,UAAY1qE,GAAMlS,KAAK62B,SACtC72B,KAAKopH,mBAAmBl3G,EAE5B,CAEOq3G,oBAAoBr3G,IACzBm5F,OAAQrrG,KAAK2lH,uBACf,CAeOiB,gBACLD,EACA9mH,EACAuhH,EACA5wC,EACAlV,EACA/Z,EACAkJ,EACAk4D,EACA7gC,GAEA,CACE,MAAMvJ,EAAY14E,EAAQ04E,UACpBixC,EAAUjxC,EAAU4G,QACtB,IAAIsqC,IAAa,CAAEC,KAAMnxC,EAAU4G,UACnC59B,EACEooE,EAAgBl5C,KAAuBD,EAAQjvB,EAAMioE,GACrDpxC,GAAcv4E,EAA2Cu4E,WAE/D,GACGp4E,KAAKulH,oBACJvlH,KAAKulH,qBAAuBoE,GAC7B3pH,KAAKwlH,wBACJxlH,KAAKwlH,yBAA2BlqD,GACjCt7D,KAAKylH,oBAAsBzlH,KAAKylH,qBAAuBrtC,GACxD,CACAuuC,EAAaiD,mBAAmB5pH,KAAKulH,oBACrC,QAASr8G,MAAOlJ,KAAK0lH,eACnBx8G,GAAIq4G,OAER,CAEAvhH,KAAKulH,mBAAqBoE,EAC1B3pH,KAAKwlH,uBAAyBlqD,EAC9Bt7D,KAAKylH,mBAAqBrtC,GAE1BG,EAAU4G,QAAU5G,EAAU4G,SAAW59B,EAAKE,UAC9C,MAAMl/C,MAAMs/E,MACVhiF,EACA8pH,EACAH,EACApxC,GACA0J,GAEF,IAAI71D,GAAa,EACjB,GACwB,UAAtBssD,EAAU3hB,SACV2hB,EAAU0G,YAAcpB,KAGxB,KAAO5xD,GAAassD,EAAU0G,aAAa,CACzC,IAAI4qC,GAAatnH,GAAIm2B,QACnB,SAAW6/C,EAAU0G,YACrB,cAEF4qC,GAAaA,GAAWnxF,QAAQ,eAAgB,KAChDmxF,IAAc,eAAiB59F,GAC/B49F,GAAWnxF,QAAQ,MAAO,KAC1B14B,KAAKmkD,YACHwiE,EACAvF,EACAuI,EACAH,EACAjoE,EACAsoE,GACAp/D,EACAk4D,GAEF12F,IAAc69F,GAChB,MAEA9pH,KAAKmkD,YACHwiE,EACAvF,EACAuI,EACAH,EACAjoE,EACAh/C,GACAkoD,EACAk4D,EAGN,CACF,CAcQx+D,YACNwiE,EACAvF,EACA5wC,EACA/rB,EACAC,EACAniD,EACAkoD,EACAk4D,GAEA,MAAMz5G,EAAM,IAAIm4G,eACVC,EAAwBF,EAAYh4G,oBAAoB7G,GAC9D,IAAI6/G,EAAc7/G,EACd++G,IACFc,EAAcd,GAEhBp4G,EAAIqP,KAAK,MAAO6pG,GACZhB,GACFA,EAAYn4G,aAAaC,EAAKk5G,GAEhC,MAAM95E,EAAUA,KACdq+E,EAAaiD,mBAAmBp5C,GAChCmyC,GAAO,EAETz5G,EAAIi/C,QAAU7f,EACdp/B,EAAI++C,OAAS,KACX,GAAmB,MAAf/+C,EAAIysF,QAAkBzsF,EAAI05G,aAAah5G,OAAS,EAAG,CACrD,MAAMW,GAAWo8G,EACdnE,YACAr7D,aAAaj+C,EAAI05G,aAAc,CAC9Bn+D,iBACAC,sBAEAn6C,IACFo8G,EAAa9qD,YAAYtxD,IACzBkgD,EAAQlgD,KAERkgD,EAAQ,GAEZ,MACEniB,GAAO,EAGXtoC,KAAK0lH,eAAep+G,KAAK4B,GACzBA,EAAI44G,MACN,CAYQZ,aACNyF,EACApkH,EACA6+G,EACA5wC,EACAlV,EACAtZ,EACAyI,EACAk4D,GAEA,MAAMz5G,EAAM,IAAIm4G,eAChB,IAAIe,EAAc7/G,EAClB,GAAmB,mBAARA,EAAoB,CAC7B,MAAM++G,EAAwBF,EAAYh4G,oBAAoB7G,GAC1D++G,IACFc,EAAcd,EAElB,CAEA,GAAIthH,KAAK2+G,mBAAoC,mBAARp8G,EAAoB,CAIvD,IAAIqmC,GAHW+9E,EAAanE,YACRvgB,UAGpB,MAAM35D,GAAUA,KACdq+E,EAAaiD,mBAAmBp5C,GAChCmyC,GAAO,EAGH9iH,GAA4B,CAAE+oC,iBACpC5oC,KAAK2+G,kBAAkBiB,aACpB1/G,IAAIqC,GACJwB,QAAKgmH,KAAM,MACXhmH,QACC66E,KAAW5V,IACTA,MACIplE,MAAGolE,IACHhpE,KAAK2+G,kBAAkBz+G,IAAIkiH,EAAuBviH,IAASkE,QACzDs5C,QAAK,EACLn5C,KAAYy5C,KACVrV,WACMqV,QAKjB96C,UAAWmnH,KACV,GAAIA,GAAS,CACX,MAAMryF,GAASgvF,EAAanE,YACtBh/G,GAAOm0B,GAAOsqE,UACpB,IAAIx+E,GAcJ,GAba,SAATjgB,IAA4B,SAATA,GACrBigB,GAASumG,GACS,QAATxmH,IACTigB,GAASumG,GACJvmG,KACHA,IAAS,IAAIq/F,WAAYC,gBACvBiH,GACA,qBAGc,gBAATxmH,KACTigB,GAASumG,IAEPvmG,GAAQ,CACV,MAAMlZ,GAAWotB,GAAOwvB,aAAa1jC,GAAQ,CAC3C+sD,SACA9rB,kBAAmB1C,IAErB2kE,EAAa9qD,YAAYtxD,IACzBkgD,EAAQlgD,GACV,MACE+9B,IAEJ,GAEN,KAAO,CACLp/B,EAAIqP,KAAK,MAAO6pG,GAChB,MAAMzqF,EAASgvF,EAAanE,YACH,gBAArB7qF,EAAOsqE,YACT/4F,EAAI0/B,aAAe,eAEjBw4E,GACFA,EAAYn4G,aAAaC,EAAKk5G,GAGhC,MAAM95E,EAAUA,KACdq+E,EAAaiD,mBAAmBp5C,GAChCmyC,GAAO,EAETz5G,EAAIi/C,QAAU7f,EACdp/B,EAAI++C,OAAS,KAEX,IAAK/+C,EAAIysF,QAAWzsF,EAAIysF,QAAU,KAAOzsF,EAAIysF,OAAS,IAAM,CAC1D,MAAMnyF,GAAOm0B,EAAOsqE,UACpB,IAAIx+E,GAcJ,GAba,SAATjgB,IAA4B,SAATA,GACrBigB,GAASva,EAAI05G,aACK,QAATp/G,IACTigB,GAASva,EAAI25G,YACRp/F,KACHA,IAAS,IAAIq/F,WAAYC,gBACvB75G,EAAI05G,aACJ,qBAGc,gBAATp/G,KACTigB,GAASva,EAAI8oF,UAEXvuE,GAAQ,CACV,MAAMlZ,GAAWotB,EAAOwvB,aAAa1jC,GAAQ,CAC3C+sD,SACA9rB,kBAAmB1C,IAErB2kE,EAAa9qD,YAAYtxD,IACzBkgD,EAAQlgD,GACV,MACE+9B,GAEJ,MACEA,GAAO,EAGXp/B,EAAI44G,MACN,CACF,CAYQgF,gBACNH,EACAsD,EACAz5C,EACAxuB,EACAyI,EACAk4D,GAEA,GAAI3iH,KAAK2+G,kBAAmB,CAC1B,MAAMr2E,EAAUA,KACdq+E,EAAaiD,mBAAmBp5C,GAChCmyC,GAAO,EAET3iH,KAAK2+G,kBAAkBiB,aAAa1/G,IAAI+pH,GAASpnH,UAAWmnH,IAC1D,GAAIA,EAAS,CACX,MAAMryF,EAASgvF,EAAanE,YACtBh/G,EAAOm0B,EAAOsqE,UACpB,IAAIx+E,EAcJ,GAba,SAATjgB,GAA4B,SAATA,EACrBigB,EAASumG,EACS,QAATxmH,GACTigB,EAASumG,EACJvmG,IACHA,GAAS,IAAIq/F,WAAYC,gBACvBiH,EACA,qBAGc,gBAATxmH,IACTigB,EAASumG,GAEPvmG,EAAQ,CACV,MAAMlZ,EAAWotB,EAAOwvB,aAAa1jC,EAAQ,CAC3C+sD,SACA9rB,kBAAmB1C,IAErB2kE,EAAa9qD,YAAYtxD,EAAUotB,EAAOqrF,eAAev/F,IACzDgnC,EAAQlgD,EACV,MACE+9B,GAEJ,GAEJ,CACF,oEE3wBI,MAAOo4E,UAAqBwJ,KACtBh4G,GACAi4G,OAAS,EACTC,QAAU,EAEZ3mG,OAEA7hB,eAER7B,YAAY0iD,EAAmB7gD,GAC7BwE,QACApG,KAAKyjB,OAASg/B,EAAM5iD,QAAQ4jB,OAAO49B,GACnCrhD,KAAKkS,MAAKyQ,QACV3iB,KAAK4B,eAAiBA,CACxB,CAEUyoH,QACRrqH,KAAKyjB,OAAO6rB,GAAG,iBAAmB3D,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC7D3rC,KAAKyjB,OAAO6rB,GAAG,eAAiB3D,GAAM3rC,KAAKuqH,cAAc5+E,IACzD3rC,KAAKyjB,OAAO6rB,GAAG,iBAAmB3D,GAAM3rC,KAAKuqH,cAAc5+E,IAC3D3rC,KAAKyjB,OAAO6rB,GAAG,iBAAmB3D,GAAM3rC,KAAKwqH,gBAAgB7+E,GAC/D,CAEU8+E,UACRzqH,KAAKyjB,OAAO0lG,GAAG,iBAAmBx9E,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC7D3rC,KAAKyjB,OAAO0lG,GAAG,eAAiBx9E,GAAM3rC,KAAKuqH,cAAc5+E,IACzD3rC,KAAKyjB,OAAO0lG,GAAG,iBAAmBx9E,GAAM3rC,KAAKuqH,cAAc5+E,IAC3D3rC,KAAKyjB,OAAO0lG,GAAG,iBAAmBx9E,GAAM3rC,KAAKwqH,gBAAgB7+E,GAC/D,CAEQ2+E,gBAAgB5gG,GACjBA,EAAMqiE,MAAM2+B,eACfhhG,EAAMqiE,MAAM2+B,aAAe,IAE7BhhG,EAAMqiE,MAAM2+B,aAAapjH,KAAKtH,KAAKkS,IAEnClS,KAAKoqH,SAAW,EAChBpqH,KAAK21F,OAASC,KAAc+0B,OAC9B,CAEQJ,cAAc7gG,GACpB,IAAKA,EAAMqiE,MAAM2+B,aACf,OAGF,MAAME,EAAelhG,EAAMqiE,MAAM2+B,aAAahiH,QAAQ1I,KAAKkS,IAC3D,GAAI04G,EAAe,EACjB,OAGFlhG,EAAMqiE,MAAM2+B,aAAa7kG,OAAO+kG,EAAc,GAE9C5qH,KAAKmqH,QAAU,EAEf,MAAMC,EAAUpqH,KAAKoqH,QACjBpqH,KAAKmqH,QAAUC,GACbA,IAAYpqH,KAAKoqH,UACnBpqH,KAAK21F,OAASC,KAAcC,KAC5B71F,KAAKmqH,OAASnqH,KAAKoqH,QAAU,EAGnC,CAEQI,gBAAgB9gG,GACjBA,EAAMqiE,MAAM2+B,eAGjB1qH,KAAK4B,eAAewC,MAClB,iCACA,2CACApC,EACA,CAAE0E,MAAOgjB,EAAM9S,OAAOi0G,QAAQp0D,SAEhCz2D,KAAKmqH,QAAS,EACdnqH,KAAKoqH,QAAU,EACfpqH,KAAK21F,OAASC,KAAc5zE,MAC9B,oEC5EI,MAAO+/F,UAAoBmI,KACvBh4G,GACAi4G,OAAS,EACTC,QAAU,EAEV3mG,OAER1jB,YAAY0iD,GACVr8C,QACApG,KAAKyjB,OAASg/B,EAAM5iD,QAAQ4jB,OAAO49B,GACnCrhD,KAAKkS,MAAKyQ,OACZ,CAEU0nG,QACRrqH,KAAKyjB,OAAO6rB,GAAG,gBAAkB3D,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC5D3rC,KAAKyjB,OAAO6rB,GAAG,cAAgB3D,GAAM3rC,KAAKuqH,cAAc5+E,IACxD3rC,KAAKyjB,OAAO6rB,GAAG,gBAAkB3D,GAAM3rC,KAAKuqH,cAAc5+E,GAC5D,CAEU8+E,UACRzqH,KAAKyjB,OAAO0lG,GAAG,gBAAkBx9E,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC5D3rC,KAAKyjB,OAAO0lG,GAAG,cAAgBx9E,GAAM3rC,KAAKuqH,cAAc5+E,IACxD3rC,KAAKyjB,OAAO0lG,GAAG,gBAAkBx9E,GAAM3rC,KAAKuqH,cAAc5+E,GAC5D,CAEQ2+E,gBAAgB5gG,GAIjBA,EAAMu3F,KAAKyJ,eACdhhG,EAAMu3F,KAAKyJ,aAAe,IAE5BhhG,EAAMu3F,KAAKyJ,aAAapjH,KAAKtH,KAAKkS,IAElClS,KAAKoqH,SAAW,EAChBpqH,KAAK21F,OAASC,KAAc+0B,OAC9B,CAEQJ,cAAc7gG,GACpB,IAAKA,EAAMu3F,KAAKyJ,aACd,OAGF,MAAME,EAAelhG,EAAMu3F,KAAKyJ,aAAahiH,QAAQ1I,KAAKkS,IAC1D,GAAI04G,EAAe,EACjB,OAGFlhG,EAAMu3F,KAAKyJ,aAAa7kG,OAAO+kG,EAAc,GAE7C5qH,KAAKmqH,QAAU,EAEf,MAAMC,EAAUpqH,KAAKoqH,QACjBpqH,KAAKmqH,QAAUC,GACbA,IAAYpqH,KAAKoqH,UACnBpqH,KAAK21F,OAASC,KAAcC,KAC5B71F,KAAKmqH,OAASnqH,KAAKoqH,QAAU,EAGnC,+EC7DI,MAAOxE,UAAsBsE,KACzBh4G,GACAi4G,OAAS,EACTC,QAAU,EAEV3nE,MAER1iD,YAAY0iD,GACVr8C,QACApG,KAAKyiD,MAAQA,EACbziD,KAAKkS,MAAKyQ,OACZ,CAEU0nG,QACR,IAAIthB,EAAW/oG,KAAKyiD,MAAM5iD,QAAQ4jB,OAAO49B,GACrCrhD,KAAKyiD,MAAMpsB,sBAAsBulC,MACnCmtC,EAAY/oG,KAAKyiD,MAAM5iD,QAAQ4jB,OAAO5jB,QAAgB4jB,QAGpDslF,EAAS3jB,WACX2jB,EAASz5D,GAAG,oBAAsB3D,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC7Do9D,EAASz5D,GAAG,kBAAoB3D,GAAM3rC,KAAKuqH,cAAc5+E,IACzDo9D,EAASz5D,GAAG,oBAAsB3D,GAAM3rC,KAAKuqH,cAAc5+E,IAE/D,CAEU8+E,UACR,IAAI1hB,EAAW/oG,KAAKyiD,MAAM5iD,QAAQ4jB,OAAO49B,GACrCrhD,KAAKyiD,MAAMpsB,sBAAsBulC,MACnCmtC,EAAY/oG,KAAKyiD,MAAM5iD,QAAQ4jB,OAAO5jB,QAAgB4jB,QAEpDslF,EAAS3jB,WACX2jB,EAASogB,GAAG,oBAAsBx9E,GAAM3rC,KAAKsqH,gBAAgB3+E,IAC7Do9D,EAASogB,GAAG,kBAAoBx9E,GAAM3rC,KAAKuqH,cAAc5+E,IACzDo9D,EAASogB,GAAG,oBAAsBx9E,GAAM3rC,KAAKuqH,cAAc5+E,IAE/D,CAEQ2+E,gBAAgB5gG,GACtB1pB,KAAKoqH,SAAW,EAChBpqH,KAAK21F,OAASC,KAAc+0B,OAC9B,CAEQJ,cAAc7gG,GACpB1pB,KAAKmqH,QAAU,EAEf,MAAMC,EAAUpqH,KAAKoqH,QACjBpqH,KAAKmqH,QAAUC,GACbA,IAAYpqH,KAAKoqH,UACnBpqH,KAAK21F,OAASC,KAAcC,KAC5B71F,KAAKmqH,OAASnqH,KAAKoqH,QAAU,EAGnC,iJCjDI,SAAUU,IACd,SAAOz9G,MAAQ,yBAA0B,IACvCmD,MACE,kBACA2F,MAAM,CACJ8oB,OAAQ,OACRC,MAAO,OACP6rF,SAAU,aACV,EAEJv6G,MACE,iBACA2F,MAAM,CACJ8oB,OAAQ,OACR8rF,SAAU,aACV,EAEJv6G,MACE,YACA2F,MAAM,CACJ40G,SAAU,aACV,EAEJrzE,MAAW,wBAAsBC,MAAQ,WAAQ,EACjDD,MAAW,wBAAsBC,MAAQ,WAE7C,iGCpBIv2C,MAJF,UAIEA,CADD,mCAOGA,MAAA,cAAUA,MAAA,mBAEdA,mBANIA,cAAA,aAAAA,MAAA,wEASFA,MAAA,8FAUEA,MARA,MAAAkK,EAAAmV,IAQArf,CARW,YAAA4pH,EAQX5pH,CAPuB,QAAAkK,EAAA2/G,WAAArhH,OAAA,IAAA0B,EAAA4/G,OAAA9pH,MAAA,wCAAA4pH,EAAAp/G,MAOvBxK,CAFC,UAAAkK,EAAA4/G,QAAA,IAAAC,IAAA7/G,EAAA8/G,cAEDhqH,CADiD,YAAAkK,EAAA4/G,QAAA5/G,EAAA2/G,WAAArhH,OAAA,2BAOnDxI,MADF,UACEA,CADkD,iBAE/CA,MAAA,qBAELA,oDA7CFA,MAAA,WASEA,MAFA,2CAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAAkK,EAAA+/G,YAA8C,EAAK,EAEnDjqH,CAFoD,0CAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAAkK,EAAA+/G,YACP,EAAI,EACjDjqH,CADkD,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MACzCkK,EAAAggH,mBAAkB,GAE3BlqH,MAAA,EAAAmqH,EAAA,aAcAnqH,MAAA,WACEA,MAAA,EAAAoqH,EAAA,0BAaFpqH,QAEAA,MAAA,EAAAqqH,EAAA,aAKFrqH,gCA1CEA,MADA,UAAAA,MAAA,EAAAoW,EAAAlM,EAAA4/G,QACA9pH,CAD0C,0BAAAkK,EAAA4/G,OAAA,SAAA5/G,EAAA8/G,cAAA,8BASvChqH,cAAA,OAAAkK,EAAA8/G,gBAAA9/G,EAAA4/G,QAAA5/G,EAAA+/G,YAeuBjqH,MAAA,GAAAA,MAAA,UAAAkK,EAAA2/G,YAcpB7pH,cAAA,OAAAkK,EAAAogH,iBCRD,IAAMC,EAA2B,MAAlC,MAAOA,EAcS35G,aAbXyO,IACA2qG,cAEFQ,YAAuB,GACvBV,QAAS,EACTG,YAAa,EAEZ5hE,SAER,kBAAIiiE,GACF,OAAO1rH,KAAKirH,WAAWrhH,OAAS,CAClC,CAEA7J,YAAoBiS,GAAAhS,KAAAgS,eACJhS,KAAKgS,aAAa+sB,OAAOr4B,QACzB+M,KAAMuyD,aAAiChkE,IAAvBhC,KAAKorH,gBACjCprH,KAAKorH,eAAgB,EAEzB,CAEA13E,kBACE1zC,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAWgpH,IAC1C7rH,KAAK4rH,YAAcC,EAAYniH,OAAQq2C,GAAMA,EAAEsC,UAAS,EAE5D,CAEAn0C,cACElO,KAAKypD,SAASt7C,aAChB,CAEAm9G,mBAEItrH,KAAKkrH,UADHlrH,KAAK0rH,iBAAkB1rH,KAAKorH,eACfprH,KAAKkrH,OAIxB,CAEA,cAAID,GACF,MAAM/lB,EAAgBllG,KAAKygB,IAAIyhC,eAAe4iD,gBACxCgnB,EAAU9rH,KAAKygB,IAAIyhC,eAAeH,UAElCgqE,EAAK/rH,KAAK4rH,YAAYliH,OAAQq2C,KAE9BA,EAAElgD,QAAQ4xE,eACVyzB,GAAiBnlD,EAAElgD,QAAQ4xE,kBAC3B1xB,EAAElgD,QAAQ+xE,eACVszB,GAAiBnlD,EAAElgD,QAAQ+xE,kBAC3B7xB,EAAElgD,QAAQ4jB,OAAO5jB,QAAQmsH,SACzBF,GAAW/rE,EAAElgD,QAAQ4jB,OAAO5jB,QAAQmsH,YACpCjsE,EAAElgD,QAAQ4jB,OAAO5jB,QAAQosH,SACzBH,GAAW/rE,EAAElgD,QAAQ4jB,OAAO5jB,QAAQosH,UAIpCC,EAAWH,EAAGriH,OAAQq2C,IAAOA,EAAElpB,SACrC,OAAOq1F,EAAStiH,OAAS,IAAMmiH,EAAGniH,OAASsiH,EAAWH,CACxD,4CA1DWJ,GAA2BvqH,MAAAuE,MAAA,+BAA3BgmH,EAA2Br9G,UAAA,8BAAAC,OAAA,CAAAkS,IAAA,MAAA2qG,cAAA,iBAAA38G,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qkBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDjCxC1N,MAAA,EAAA+qH,EAAA,kBACG/qH,MAAA,OAAA2N,EAAAk8G,WAAArhH,OAAA,kBCsBCuF,KACAG,KACAC,KAAe3J,KACfyJ,KAAgBxJ,KAChB2J,KAAa1J,KACb2O,KACA23G,IACAz8G,KAAiB5J,MAAA8J,OAAA,o9BAAA5L,KAAA,CAAAq1C,UAVP,CAACwxE,eAaFa,CAA2B,sJC9BpCvqH,MAAA,WAAkDA,MAAA,GAAWA,+BAAXA,cAAAkK,EAAAM,gDAFpDxK,MAAA,WAAqBA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+gH,gBAAA/gH,EAAA+2C,WAA0B,GACtDjhD,MAAA,uBACAA,MAAA,EAAAkrH,EAAA,aACFlrH,gCAFmBA,cAAA,MAAAkK,EAAAihH,SACXnrH,cAAA,OAAAkK,EAAAM,QC4BH,IAAMwgH,EAAoB,MAA3B,MAAOA,EA+BD/xD,aACAmyD,OA/BD/rG,IACAtT,SACAvB,MAET,WACIqC,GACF,OAAOjO,KAAKysH,QACd,CACA,WAAIx+G,CAAQvH,GACV1G,KAAKysH,SAAW/lH,EAChB1G,KAAKusH,QAAQlrE,GAAGC,UAAUorE,SAC5B,CACQD,SAER,aACIpqE,GACF,OAAOriD,KAAK2sH,UACd,CACA,aAAItqE,CAAU37C,GACZ1G,KAAK2sH,WAAajmH,EAClB1G,KAAK4sH,uBAAuBlmH,EAC9B,CACQimH,WAEDJ,QAAU,IAAIM,IAAO,CAC1Bv1F,SAAU,GACVu3D,cAAc,IAGhB9uF,YACUs6D,EACAmyD,GADAxsH,KAAAq6D,eACAr6D,KAAAwsH,QACP,CAEH94E,kBACE1zC,KAAK8sH,wBAAwB9sH,KAAKygB,IAAI4gC,GAAGC,WACzCthD,KAAKygB,IAAIyhC,eAAe6qE,OAAOz9E,GAAG,SAAWyL,IAC3C/6C,KAAK8sH,wBAAwB/xE,EAAOnkC,OAAgB,GAEtD5W,KAAKygB,IAAI4gC,GAAG/R,GAAG,cAAgByL,IAC7B/6C,KAAK8sH,wBAAyB/xE,EAAOnkC,OAAiB0qC,UAAS,EAEnE,CAEApzC,cACElO,KAAKygB,IAAIyhC,eAAe6qE,OAAO5D,GAAG,SAAWpuE,IAC3C/6C,KAAK8sH,wBAAwB/xE,EAAOnkC,OAAgB,GAEtD5W,KAAKygB,IAAI4gC,GAAG8nE,GAAG,cAAgBpuE,IAC7B/6C,KAAK8sH,wBAAyB/xE,EAAOnkC,OAAiB0qC,UAAS,EAEnE,CAEA+qE,gBAAgBhqE,GACVriD,KAAKmN,WAGTnN,KAAKygB,IAAI4rG,gBAAgBhqE,GACzBriD,KAAKwsH,OAAOQ,OACd,CAEQF,wBAAwBG,GAC9B,MAAMC,EAAwBD,EAAYxtC,gBAC1Cz/E,KAAKusH,QAAQrqE,eAAe6qE,OAAOI,cACjCD,EAAsB5xD,YAExBt7D,KAAKusH,QAAQrqE,eAAe6qE,OAAOK,YACjCF,EAAsBG,UAExBrtH,KAAKusH,QAAQrqE,eAAe6qE,OAAOzD,UACjCtpH,KAAKygB,IAAIyhC,eAAeN,YAE5B,CAEQgrE,uBAAuBU,GAC7BttH,KAAKusH,QAAQ5xD,kBAEb,MAAM96D,EAAe2G,OAAO6H,OAC1B7H,OAAOuV,OAAOuxG,EAAUztH,SACxBytH,EAAUztH,QACV,CACEg3B,SAAS,EACTwrB,WAAW,IAITI,EAAQziD,KAAKq6D,aAAawkD,YAAYh/G,GAC5CG,KAAKusH,QAAQvwD,SAASvZ,GACtBziD,KAAKutH,sBAAsB9qE,EAC7B,CAEQ8qE,sBAAsBD,GAC5B,MAAMvyB,EAA2BuyB,EAAUztH,QAAQk7F,aACnD,IAAKA,EACH,OAEF,MAAME,EAAgCF,EAAaE,MACpBA,GAG7BA,EAAMx6E,IAAK+sG,IACTA,EAAKryB,UAAU16E,IAAKgtG,IAClB,MAAMC,EAAsB1tH,KAAKygB,IAAIq/B,OAAO19B,KACzCqgC,GAAiBA,EAAM5iD,QAAQk7F,cAAcC,SAAWyyB,GAE3D,GAAIC,EAAc,CAChB,MAAMC,EAAmCnnH,OAAO6H,OAC9C7H,OAAOuV,OAAO2xG,EAAa7tH,SAC3B6tH,EAAa7tH,QACb,CACE2iD,OAAQ,IACR3rB,QACE62F,EAAa7tH,QAAQk7F,cAAc6yB,oBAAqB,EAC1DvrE,WAAW,IAGfriD,KAAKusH,QAAQvwD,SACXh8D,KAAKq6D,aAAawkD,YAAY8O,GAElC,GACD,EAGP,4CA5HWvB,GAAoBhrH,MAAAuE,KAAAvE,aAAA,+BAApBgrH,EAAoB99G,UAAA,uBAAAC,OAAA,CAAAkS,IAAA,MAAAtT,SAAA,WAAAvB,MAAA,QAAAqC,QAAA,UAAAo0C,UAAA,aAAA5zC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,uJAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID/BjC1N,MAAA,WACEA,MAAA,EAAAysH,EAAA,aAIFzsH,eAJQA,cAAA,OAAA2N,EAAAd,yBC4BIkB,KAAM2+G,KAAmBj+G,OAAA,woBAAAC,gBAAA,WAExBs8G,CAAoB,iNC9B/BhrH,MADF,UACEA,CAD4E,wDAU1EA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAyiH,qBAAoB,GAE7B3sH,MAAA,cAAUA,MAAA,oBAEdA,oCAXIA,QAMAA,MANA,aAAAkK,EAAAmV,IAAA28C,sBAAA4wD,SAAA5sH,MAAA,4CAAAA,MAAA,oCAMAA,CAFC,QAAAkK,EAAAC,OAKSnK,MAAA,GAAAA,YAAA,IAAAkK,EAAA2iH,SCeP,IAAMC,EAAwB,MAA/B,MAAOA,EAsBS1lF,cArBZ2lF,WACCF,MAAiC,IAAIlsH,IAAgB,eAE9D,OACI0e,GACF,OAAOzgB,KAAKouH,IACd,CACA,OAAI3tG,CAAI/Z,GACN1G,KAAKouH,KAAO1nH,CACd,CACQ0nH,KAER,SACI7iH,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,GACR1G,KAAKmxC,OAASzqC,CAChB,CACQyqC,OAERpxC,YAAoByoC,GAAAxoC,KAAAwoC,eAA+B,CACnD6lF,qBACEruH,KAAKygB,IAAI4gC,GAAGspC,KAAK,iBAAkB,KACjC3qF,KAAKmuH,WAAanuH,KAAKygB,IAAI28C,sBAAsBkxD,UAAUzrH,UACxDmrH,IACKA,GAGFhuH,KAAKwoC,cAAcpoC,UAAU,mBAF7BJ,KAAKiuH,MAAMtrH,KAAK,eAIZ3C,KAAKiuH,MAAMtrH,KAAK,qBAAoB,EAE3C,EAGP,CAEAuL,cACMlO,KAAKmuH,YACPnuH,KAAKmuH,WAAWhgH,aAEpB,CAEA4/G,qBAEE/tH,KAAKygB,IAAI28C,sBAAsB4wD,UADdhuH,KAAKygB,IAAI28C,sBAAsB4wD,QAElD,4CAhDWE,GAAwB9sH,MAAAuE,MAAA,+BAAxBuoH,EAAwB5/G,UAAA,2BAAAC,OAAA,CAAAkS,IAAA,MAAAlV,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6KAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD3BrC1N,MAAA,EAAAmtH,EAAA,kBAA6CntH,MAAA,OAAA2N,EAAA0R,IAAA28C,sCCmBzCjuD,KACAI,KAAe3J,KACfyJ,KAAgBxJ,KAChB2J,KAAa1J,KACb4J,KACAC,KAAiB5J,MAAA8J,OAAA,qeAGRq+G,CAAwB,8JCH9B,IAAMM,EAAyB,MAAhC,MAAOA,EAWQhmF,cAVV/nB,IACAlV,MACAkjH,eACAC,eACAC,aAEDC,uBACAC,uBACAC,qBAER/uH,YAAmByoC,GAAAxoC,KAAAwoC,gBACjBxoC,KAAK+uH,mBACP,CAEAA,oBACE,MAAMC,EACJhvH,KAAKwoC,cAAcpoC,UAAU,oBAE/BJ,KAAK4uH,uBACH5uH,KAAKyuH,gBAAkBO,GAAyBC,oBAClDjvH,KAAK6uH,uBACH7uH,KAAK0uH,gBAAkBM,GAAyBE,oBAClDlvH,KAAK8uH,qBACH9uH,KAAK2uH,cAAgBK,GAAyBG,kBAG5CnvH,KAAK0uH,gBAAkB1uH,KAAK2uH,eAC9B3uH,KAAK4uH,4BAAyB5sH,EAElC,CAEAotH,gBAEE,GADApvH,KAAK+uH,oBACD/uH,KAAK4uH,uBACP5uH,KAAKygB,IAAIyhC,eAAeoqC,aAAatsF,KAAK4uH,6BAAsB,GACvD5uH,KAAK6uH,wBAA0B7uH,KAAK8uH,qBAAsB,CACnE,MAAMptE,EAAS+uB,KACbzwE,KAAK6uH,uBACL7uH,KAAKygB,IAAIyhC,eAAe6qE,OAAOvrE,gBAAgBC,WAEjDzhD,KAAKygB,IAAIyhC,eAAe6qE,OAAOzD,UAAU5nE,GACzC1hD,KAAKygB,IAAIyhC,eAAemtE,OAAOrvH,KAAK8uH,qBACtC,CACF,4CA5CWN,GAAyBptH,MAAAuE,MAAA,+BAAzB6oH,EAAyBlgH,UAAA,6BAAAC,OAAA,CAAAkS,IAAA,MAAAlV,MAAA,QAAAkjH,eAAA,iBAAAC,eAAA,iBAAAC,aAAA,gBAAAlgH,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,2HAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICvBpC1N,MADF,UACEA,CAD4C,mCAM1CA,MAAA,0BAAS2N,EAAAqgH,eAAe,GAExBhuH,MAAA,cAAUA,MAAA,UAEdA,mBAPIA,QAEAA,MAFA,aAAAA,MAAA,sCAEAA,CAF2D,QAAA2N,EAAAxD,uBDmBnDgE,KAAe3J,KAAEyJ,KAAgBxJ,KAAE2J,KAAa1J,KAAE6J,KAAiB5J,MAAA8J,OAAA,yeAElE2+G,CAAyB,kfEvBpCptH,MADF,UACEA,CADiE,SAC5DA,MAAA,GACPA,gCADOA,MAAA,GAAAA,MAAAqnB,EAAA6mG,cCSA,IAAMC,EAAoB,MAA3B,MAAOA,EACFD,YAAsB,GAE/BvvH,cAAe,4CAHJwvH,EAAoB,+BAApBA,EAAoBjhH,UAAA,uBAAAC,OAAA,CAAA+gH,YAAA,eAAA7gH,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDVjC1N,MAAA,EAAAouH,EAAA,kBAAMpuH,MAAA,OAAA2N,EAAAugH,aAAAvgH,EAAAugH,YAAA1lH,uBCQMuF,MAAIU,OAAA,8YAEH0/G,CAAoB,qHCY1B,IAAMzB,EAAmB,MAA1B,MAAOA,EAgCS7tD,gBA/BZy0B,WACA+6B,SAEChvG,IAET,QACItQ,GACF,OAAOnQ,KAAK0vH,KACd,CACA,QAAIv/G,CAAKzJ,GACP1G,KAAK0vH,MAAQhpH,OACI1E,IAAbhC,KAAKygB,KACPzgB,KAAKygB,IAAIkvG,WAAWjpH,EAExB,CACQgpH,MAER,YAAIp4F,GACF,OAAOt3B,KAAK4vH,SACd,CAEA,YAAIt4F,CAAS5wB,GACX1G,KAAK4vH,UAAYlpH,OACA1E,IAAbhC,KAAKygB,KACPzgB,KAAKygB,IAAIovG,eAAenpH,EAE5B,CACQkpH,UAED19G,GAAK,qBAAkByQ,UAE9B5iB,YAAoBkgE,GAAAjgE,KAAAigE,iBAAmC,CAEvD1yD,WACEvN,KAAKyvH,SAAWzvH,KAAKygB,IAAIk5C,QAAQ92D,UAAW8yF,GAC1C31F,KAAK8vH,mBAAmBn6B,GAE5B,CAEAjiD,kBACE1zC,KAAKygB,IAAIzG,UAAUha,KAAKkS,GAC1B,CAEAhE,cACElO,KAAKygB,IAAIzG,eAAUhY,GACnBhC,KAAKigE,gBAAgBI,WAAWrgE,KAAK00F,YACrC10F,KAAKyvH,SAASthH,aAChB,CAEQ2hH,mBAAmBn6B,GACrBA,IAAWC,KAAc+0B,cAA+B3oH,IAApBhC,KAAK00F,WAC3C10F,KAAK00F,WAAa10F,KAAKigE,gBAAgB1+B,WAC9Bo0D,IAAWC,KAAcC,WAA4B7zF,IAApBhC,KAAK00F,aAC/C10F,KAAKigE,gBAAgBI,WAAWrgE,KAAK00F,YACrC10F,KAAK00F,gBAAa1yF,EAEtB,4CAzDW8rH,GAAmB1sH,MAAAuE,MAAA,+BAAnBmoH,EAAmBx/G,UAAA,sBAAAC,OAAA,CAAAkS,IAAA,MAAAtQ,KAAA,QAAA1B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAAC,EAAA9I,MAAA,EAAAC,KAAA,EAAAC,OAAA,sCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,YCtBhC1N,MAAA,WACAA,MAAA,SADKA,MAAA,KAAA2N,EAAAmD,67CDsBQ47G,CAAmB,+EEPzB,IAAMiC,EAAkB,MAAzB,MAAOA,EAIFtvG,IAKDuvG,gBACRjwH,cAAe,CAKf2zC,kBACM1zC,KAAKygB,MACPzgB,KAAKgwH,gBAAkBhwH,KAAKygB,IAAIwvG,WAAWptH,UAAW6D,IAE/C4B,SAAS4nH,eAAe,aAAa/5G,MAAMg6G,WADhDzpH,EAC6D,UACA,YAGjE1G,KAAKowH,SACP,CAKAliH,cACMlO,KAAKgwH,iBACPhwH,KAAKgwH,gBAAgB7hH,aAEzB,CAKQiiH,UACN9nH,SAAS4nH,eAAe,aAAazvB,iBACnC,QACC/2E,IACCA,EAAM2mG,OAAS,EACXrwH,KAAKygB,IAAIyhC,eAAeouE,UACxBtwH,KAAKygB,IAAIyhC,eAAequE,QAAM,GAEpC,EAEJ,4CAhDWR,EAAkB,+BAAlBA,EAAkBzhH,UAAA,qBAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mEAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICf/B1N,MAAA,WAEEA,MADA,UACAA,CAD4B,WAE9BA,wcDYa2uH,CAAkB,mJEOxB,IAAMS,EAAmB,MAA1B,MAAOA,EAiBQhoF,cAhBnB,iBACIioF,GACF,OAAOzwH,KAAK0wH,eACd,CACA,iBAAID,CAAc/pH,GAChB1G,KAAK0wH,gBAAkBhqH,EACvB1G,KAAK2wH,oBACP,CACQD,gBAEEE,YAAc,IAAItjH,MAErBujH,cAEAC,gBAEP/wH,YAAmByoC,GAAAxoC,KAAAwoC,gBACjB,MAAMuoF,EAAc/wH,KAAKwoC,cAAcpoC,UACrC,6BAEFJ,KAAK6wH,mBAAgC7uH,IAAhB+uH,GAA4BA,CACnD,CAEAJ,qBACE3wH,KAAK8wH,gBAAkB,CACrB,gCAAiC9wH,KAAK6wH,cAE1C,CAEAG,uBACEhxH,KAAK4wH,YAAYxiH,MACnB,4CAhCWoiH,GAAmBpvH,MAAAuE,MAAA,+BAAnB6qH,EAAmBliH,UAAA,sBAAAC,OAAA,CAAAkiH,cAAA,iBAAAjiH,QAAA,CAAAoiH,YAAA,eAAAniH,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,oIAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICtBhC1N,MAAA,mCAOEA,MAAA,0BAAS2N,EAAAiiH,sBAAsB,GAE/B5vH,MAAA,cAAUA,MAAA,UACZA,gBAJEA,MAHA,UAAA2N,EAAA+hH,gBAGA1vH,CAH2B,aAAAA,MAAA,IAAA2N,EAAA0hH,cAAA,0CDYzBlhH,KAAe3J,KACf0J,KACAD,KAAgBxJ,KAChB2J,KAAa1J,KACb6J,KAAiB5J,MAAA8J,OAAA,yRAGR2gH,CAAmB,kKECzB,IAAMS,EAAsB,MAA7B,MAAOA,EACXC,SAAmB,cAEVzwG,IACAlV,MACAolC,SAAmB,EAE5B5wC,cAAe,CAEfwN,WACEvN,KAAKygB,IAAIm/E,eAAej9F,KAAK3C,KAAK2wC,QACpC,CAEA7kC,UACE9L,KAAK2wC,SAAW3wC,KAAK2wC,QACrB3wC,KAAKmxH,oBACLnxH,KAAKygB,IAAIm/E,eAAej9F,KAAK3C,KAAK2wC,QACpC,CAEQwgF,oBAEJnxH,KAAKkxH,SADHlxH,KAAK2wC,QACS,eAEA,aAEpB,4CAzBWsgF,EAAsB,+BAAtBA,EAAsB3iH,UAAA,yBAAAC,OAAA,CAAAkS,IAAA,MAAAlV,MAAA,QAAAolC,QAAA,WAAAliC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,8HAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICtBjC1N,MADF,UACEA,CADqC,wDAWnCA,MAAA,0BAAS2N,EAAAjD,SAAS,GAElB1K,MAAA,cAAUA,MAAA,cAEdA,mBAZIA,QAOAA,MAPA,aAAA2N,EAAA4hC,QAAAvvC,MAAA,iCAAAA,MAAA,kCAOAA,CAHC,UAAAA,MAAA,EAAAoW,EAAAzI,EAAAmiH,UAGD9vH,CADsB,QAAA2N,EAAA4hC,QAAA5hC,EAAAxD,MAAA,sBDOtBgE,KAAe5J,KACf0J,KAAgBzJ,KAChB0J,KACAE,KAAa3J,KACb8J,KAAiB7J,MAAA+J,OAAA,uhBAGRohH,CAAsB,yPEvBnC7vH,MAAA,sEAWEA,MAAA,+BAKEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAmV,IAAAyhC,eAAAkvE,gBAAkC,GAE3ChwH,MAAA,iCAA4CA,MAAA,iBAEhDA,oCAjBEA,MAAA,aAAAA,MAAA,IAAAkK,EAAA+lH,UAAAjwH,MAAA,uCAAAA,MAAA,GAAAoW,EAAAlM,EAAAgmH,eAAAhmH,EAAAimH,kBAAAnwH,MAAA,uCAWEA,MAAA,GACAA,MADA,QAAAkK,EAAAC,MACAnK,CADe,gBAAAA,MAAA,KAAAkK,EAAA+lH,WAILjwH,MAAA,GAAAA,MAAA,UAAAA,MAAA,KAAAkK,EAAAkmH,iBCUP,IAAMC,EAAuB,MAA9B,MAAOA,EACFJ,SAAW,IAAItvH,KAAyB,GAC1CuvH,eAAyB,EACzBC,gBAA0B,EACxBC,cAAgB,IAAIzvH,IAAoB,CAC/CqX,UAAW,iBAGJqH,IACAixG,iBACAnmH,MAETxL,cAAe,CAEfsuH,qBACEruH,KAAKygB,IAAIyhC,eAAeyvE,UAAU9uH,UAAWmmE,IAC3C,MAAM4oD,EAAU5oD,GAAK,EACf6oD,EAAiB,IAAVD,EAAiB1lG,KAAK4lG,GACnC9xH,KAAKuxH,gBAAkBrlG,KAAKiwE,MAAM01B,GAClC7xH,KAAKsxH,eAAiBplG,KAAKiwE,SAAM41B,OAAuB,EAANF,IAClD7xH,KAAKwxH,cAAc7uH,KAAK,CACtByW,UAAW,UAAYw4G,EAAU,SAEnC5xH,KAAKqxH,SAAS1uH,KAAiB,IAAZivH,EAAa,EAEpC,4CAzBWH,EAAuB,+BAAvBA,EAAuBnjH,UAAA,0BAAAC,OAAA,CAAAkS,IAAA,MAAAixG,iBAAA,mBAAAnmH,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6QAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID5BpC1N,MAAA,EAAA4wH,EAAA,qCACG5wH,MAAA,OAAAA,MAAA,IAAA2N,EAAAsiH,YAAAtiH,EAAA2iH,kBAAA3iH,EAAA2iH,iCCkBCviH,KACAE,KAAgB1J,KAChB4J,KAAe3J,KACf4J,KAAa3J,KACby3B,KACA5tB,KACAC,KAAiB7J,MAAA+J,OAAA,meAGR4hH,CAAuB,sECrB9B,MAAOQ,EAID5b,MAKA6b,aAA4B,GAMtCC,WACE,OAAOnyH,KAAKq2G,KACd,CAMAiB,SAASjB,GACP,QAAcr0G,IAAVq0G,QAA2Cr0G,IAApBhC,KAAKmyH,WAC9B,MAAM,IAAInwG,MAAM,8CAGlB,QAAchgB,IAAVq0G,EAGF,OAFAr2G,KAAKgnB,yBACLhnB,KAAKq2G,MAAQA,GAIfr2G,KAAKq2G,MAAQA,CACf,CAKArvF,oBACEhnB,KAAKkyH,aAAa33G,QAAShU,MAAmB8kG,KAAQ9kG,IACtDvG,KAAKkyH,aAAe,EACtB,qDCdK,IAAKE,EAAZ,SAAYA,GACVA,SAAAC,SAAA,WACAD,EAAAE,kBAAA,oBACAF,EAAAG,SAAA,WACAH,EAAAI,OAAA,SAJUJ,CAKZ,CALA,CAAYA,GAAsB,+RCE5B,MAAOK,UAAiCR,KAgKlCxxG,IACA5gB,QACAs8C,eACA3T,cAlKFkqF,cACAC,gBAAkC,GAClCC,mBACAC,qBACN,IAAI3uB,KAAc,CAChBnY,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACR7e,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,YAET6vE,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,OACP2zB,MAAO,QAIP4zF,qBACN,IAAI5uB,KAAc,CAChB9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,2BACP2zB,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,+BAIb,eAAYwnH,GACV,OAAO,IAAI7uB,KAAc,CACvB9oB,OAAQ,IAAI8oB,IAAe,CAAEhlE,MAAO,EAAG3zB,MAAOvL,KAAKg7D,OAAOg4D,eAC1Dx3C,KAAM,IAAI0oB,IAAa,CAAE34F,MAAOvL,KAAKg7D,OAAOi4D,aAC5CrmF,KAAM,IAAIs3D,IAAa,CACrBgvB,UAAW,OACXC,QAAS,GACTC,SAAS,GACTC,KAAM,0BACNzmF,KAAM5sC,KAAKg7D,OAAOs4D,iBACd,GAAGtzH,KAAKg7D,OAAOu4D,gBACf,GACJ/3C,KAAM,IAAI0oB,IAAa,CAAE34F,MAAO,SAChC6vE,OAAQ,IAAI8oB,IAAe,CAAE34F,MAAO,OAAQ2zB,MAAO,OAGzD,CAEA,cAAYs0F,GACV,OAAO,IAAItvB,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B7J,OAAQ,IACR7e,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,sBAET6vE,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,OACP2zB,MAAO,MAETu0F,OAAQ,EACRC,aAAc,CAAC,EAAG,GAClBrG,SAAUrtH,KAAK0yH,cACfiB,gBAAgB,KAGtB,CAEQC,YAKQC,yBACd,IAAI9xH,IAAgB,GAKN+xH,UAAY,IAAI/xH,SAC9BC,GAKcssH,UAAY,IAAIvsH,SAAyBC,GAIzC+xH,gBAAkB,IAAIhyH,SAAyBC,GAEvD83F,aAKR,UAAI9+B,CAAOt0D,GACT1G,KAAKg0H,QAAUttH,EACf1G,KAAKi0H,sBAAsBj0H,KAAK8zH,UAAUptH,MAC5C,CACA,UAAIs0D,GACF,OAAOh7D,KAAKg0H,OACd,CACQA,QAKR,qBAAIE,CAAkBxtH,GACpB1G,KAAKm0H,mBAAqBztH,EAC1B1G,KAAKi0H,sBAAsBj0H,KAAK8zH,UAAUptH,MAC5C,CAEA,qBAAIwtH,GACF,OAAOl0H,KAAKm0H,kBACd,CACQA,mBAER,iBAAIC,GACF,OAAOp0H,KAAK4zH,WACd,CAKA,YAAI5F,GACF,OAAOhuH,KAAK4zH,YAAYS,aAC1B,CAEA,YAAIrG,CAAStnH,GACX1G,KAAK4zH,YAAYU,YAAY5tH,IAAS,GACtC1G,KAAKsuH,UAAU3rH,KAAK+D,GAChB1G,KAAKm8C,qBAA4Bn6C,IAAV0E,GACzB1G,KAAKm8C,eAAe97C,IAAI,uBAAwBqG,GAE7CA,GACH1G,KAAK8zH,UAAUnxH,UAAKX,EAExB,CAKA,kBAAIuyH,CAAe7tH,GACjB1G,KAAKw0H,gBAAkB9tH,EACvB1G,KAAK+zH,gBAAgBpxH,KAAK+D,IACwC,IAA9D1G,KAAKwoC,eAAepoC,UAAU,8BAChCJ,KAAKw0H,iBAAkB,EACvBx0H,KAAK+zH,gBAAgBpxH,MAAK,IAE5B3C,KAAKi0H,sBAAsBj0H,KAAK8zH,UAAUptH,OACtC1G,KAAKm8C,qBAA4Bn6C,IAAV0E,GACzB1G,KAAKm8C,eAAe97C,IAAI,6BAA8BqG,EAE1D,CAEA,kBAAI6tH,GACF,OAAOv0H,KAAKw0H,eACd,CAEQA,gBAERz0H,YACU0gB,EACA5gB,EACAs8C,EACA3T,GAERpiC,QALQpG,KAAAygB,MACAzgB,KAAAH,UACAG,KAAAm8C,iBACAn8C,KAAAwoC,gBAGRxoC,KAAK4yH,mBAAqB,IAAI1nH,IAAQlL,KAAKygB,KAC3CzgB,KAAKw0H,mBACHx0H,KAAKH,UAAWG,KAAKH,QAAQ00H,iBACzBv0H,KAAKH,QAAQ00H,eAGnBv0H,KAAKg0H,QACHh0H,KAAKH,SAAWG,KAAKH,QAAQm7D,OAASh7D,KAAKH,QAAQm7D,YAASh5D,EAC9DhC,KAAKm0H,mBACHn0H,KAAKH,SAAWG,KAAKH,QAAQq0H,kBACzBl0H,KAAKH,QAAQq0H,kBACb,GACR,CAMA5c,SAASjB,GACPjwG,MAAMkxG,SAASjB,GACfr2G,KAAKinB,gBACP,CAEQwtG,4BACNz0H,KAAK00H,oBAAoBtC,IAAuBC,UAChDryH,KAAK00H,oBAAoBtC,IAAuBE,mBAChDtyH,KAAK00H,oBAAoBtC,IAAuBG,UAChDvyH,KAAK00H,oBAAoBtC,IAAuBI,OAClD,CAEAvrG,iBACEjnB,KAAKsuH,UAAUzrH,UAAWmrH,IACpBA,EACFhuH,KAAK20H,kBAAiB,GAAM,GAE5B30H,KAAKy0H,2BAAyB,GAIlCz0H,KAAK4zH,YAAc,IAAIQ,IAAc,CAEnCQ,gBAAiB,CACfC,oBAAoB,EACpBC,WAAY,IACZtvD,QAAS,KAEXxjB,WAAYhiD,KAAKH,QAAQmiD,aAE3B,IAAIgsE,GAAW,EACfhuH,KAAK2yH,gBAAgBrrH,KACnBtH,KAAK6zH,yBACF9vH,QAAK+kC,KAAWpiC,MAAUquH,KAAiB,IAARruH,KACnC7D,UAAU,KACLmrH,IAAahuH,KAAKguH,SACpBhuH,KAAK20H,kBAAiB,IAEtB3G,EAAWhuH,KAAKguH,SAChBhuH,KAAK20H,kBAAiB,GAAM,GAAI,IAKxC30H,KAAK4zH,YAAYtkF,GAAG,SAAW8Y,IAC7BpoD,KAAK20H,kBAAiB,GAAO,EAAK,EAEtC,CAEAK,8BAA8B3lF,GAC5B,MAAM4lF,EAAexkD,KACnBphC,EAASA,SACTA,EAAS2S,WACT,aAEF,IAAKhiD,KAAK85F,aAER,YADA95F,KAAK85F,aAAe,CAAE5T,YAAa+uC,EAAcC,SAAU,IAAIj0H,OAGjE,MAAMk0H,EAAen1H,KAAKo1H,iBACxBhD,IAAuBE,mBAEnB+C,EACJhmF,GAAUoI,MAAQ,MAClBz3C,KAAKs1H,sBAAsBt1H,KAAK85F,aAAa5T,YAAa+uC,GACxD,KACJ,GAAI5lF,EAASkmF,UAAYv1H,KAAKk0H,mBAAqBmB,EAAU,CAG3D,IAEIG,EAAQtpG,KAAKupG,MADRR,EAAa,GAAKj1H,KAAK85F,aAAa5T,YAAY,GADhD+uC,EAAa,GAAKj1H,KAAK85F,aAAa5T,YAAY,IAGrDsvC,EAAQ,IAAGA,EAAQ,EAAItpG,KAAK4lG,GAAK0D,GACrCx1H,KAAK0yH,cAAgB8C,EACjBL,GACFA,EAAalxB,SAASjkG,KAAKwzH,YAE7BxzH,KAAK85F,aAAe,CAAE5T,YAAa+uC,EAAcC,SAAU,IAAIj0H,KACjE,MAEIk0H,QACIl0H,MAAOC,UAAYlB,KAAK85F,aAAao7B,SAASh0H,UAAY,QAE9D8iG,MAAcmxB,EAEpB,CAKQG,sBAAsBI,EAAkBC,GAC9C,OAAOC,KAAqBF,EAAQC,GAAU,GAChD,CAEOE,qBAAqBnsG,GAC1B,IAAIosG,EAAWA,KACbpsG,EAAM1pB,KAAK4zH,YAAW,EAExB,OAAA5zH,KAAK4zH,YAAYtkF,GAAG,SAAUwmF,GACvBA,CACT,CAEOC,sBAAsBrsG,GAC3B1pB,KAAK4zH,YAAYzK,GAAG,SAAUz/F,EAChC,CAEO2zC,yBAAyBx9D,GAC9B,IAAKA,EACH,OAGF,IAAImuH,EAAWnuH,EAAQm2H,UACnBzB,EAAiB10H,EAAQo2H,eAC7B,GAAIj2H,KAAKm8C,eAAgB,CACvB,MAAM+5E,EAAiBl2H,KAAKm8C,eAAej8C,IACzC,wBAEqB,MAAnBg2H,IACFlI,EAAWkI,GAGb,MAAMC,EAAuBn2H,KAAKm8C,eAAej8C,IAC/C,8BAE2B,MAAzBi2H,IACF5B,EAAiB4B,EAErB,CACAn2H,KAAKguH,SAAWA,EAChBhuH,KAAKu0H,eAAiBA,EACtBv0H,KAAKg7D,OAASn7D,EAAQm7D,MACxB,CAKAh0C,oBACMhnB,KAAK2yH,gBAAgB/oH,QACvB5J,KAAK2yH,gBAAgBlyG,IAAK7E,GAAMA,EAAEzN,eAEpC/H,MAAM4gB,mBACR,CAMQ2tG,iBACNrpD,GAAqB,EACrB+jD,GAAkB,GAElB,IAAKrvH,KAAKguH,SACR,OAEF,MAAMoI,EAAsBp2H,KAAK4zH,YAAYn0C,gBAE7C,GAAI22C,EAAoBb,SAAWv1H,KAAKk0H,kBAGtC,OAFAhxD,QAAQC,KAAK,gEACbnjE,KAAK8zH,UAAUnxH,UAAKX,GAItB,MAAMqtC,EAAgC,CACpCA,SAAU+mF,EAAoB/mF,SAC9B2S,WAAYhiD,KAAK4zH,YAAYpyE,gBAAgBC,UAC7C8zE,SAAUa,EAAoBb,SAC9Bc,SAAUD,EAAoBC,SAC9BC,iBAAkBF,EAAoBE,iBACtCC,QAASH,EAAoBG,QAC7B9+E,MAAO2+E,EAAoB3+E,MAC3Bo9E,qBAAoBuB,EAAoBxB,iBACpCC,mBAGJ2B,UAAW,IAAIv1H,MAEjBjB,KAAKi0H,sBAAsB5kF,GAC3BrvC,KAAKy2H,uBAAuBpnF,EAAUggF,GAClC/jD,GACFtrE,KAAK8zH,UAAUnxH,KAAK0sC,EAExB,CAEQ+lF,iBAAiB5xH,GACvB,OAAOxD,KAAK4yH,mBAAmBv8F,WAAWgrB,GAAGs7B,eAAen5E,EAC9D,CAEQkxH,oBAAoBlxH,GAC1B,MAAMkzH,EACJ12H,KAAK4yH,oBAAoBv8F,WAAWgrB,GAAGs7B,eAAen5E,GACpDkzH,GACF12H,KAAK4yH,mBAAmBv8F,WAAWgrB,GAAGw7B,cAAc65C,EAExD,CAEQzC,sBAAsB5kF,GAC5B,IAAKA,IAAaA,EAASA,SACzB,OAEF,MAAMsnF,EAAmB,IAAIC,IAAMvnF,EAASA,UACtCwnF,KAAmBC,MACvB,IAAIC,IAAS1nF,EAASA,SAAUA,EAASkmF,UAAY,IAEvD,IAAIyB,EAAkBh3H,KAAKo1H,iBACzBhD,IAAuBC,UAErB4E,EAAuBj3H,KAAKo1H,iBAC9BhD,IAAuBE,mBAErB4E,EAAkBl3H,KAAKo1H,iBACzBhD,IAAuBG,UAEzB,MAAM4E,IAAwBH,EACxBI,IAA6BH,EAC7BI,IAAwBH,EAmB9B,GAlBKE,IACHH,EAAuB,IAAItqC,IAAiB,CAC1CrD,SAAUqtC,IAEZM,EAAqB11B,MAAM6wB,IAAuBE,oBAAiB,EACnEtuB,MAAcizB,IAEXE,IACHH,EAAkB,IAAIrqC,IAAiB,CAAErD,SAAUqtC,IACnDK,EAAgBz1B,MAAM6wB,IAAuBC,UAC7C2E,EAAgB/yB,SAASjkG,KAAK6yH,uBAE3BwE,IACHH,EAAkB,IAAIvqC,IAAmB,CAAErD,SAAUutC,IACrDK,EAAgB31B,MAAM6wB,IAAuBG,UAC7C2E,EAAgBjzB,SAASjkG,KAAK8yH,uBAG5B6D,IACFQ,EACIH,EAAgBM,YAAYX,GAC5B32H,KAAK4yH,mBAAmB2E,aACtBP,EACAn8B,IAAcj9E,MAEpBw5G,EACIH,EAAqBK,YAAYX,GACjC32H,KAAK4yH,mBAAmB2E,aACtBN,EACAp8B,IAAcj9E,MAEpB5d,KAAKg1H,8BAA8B3lF,GACnCgoF,EACIH,EAAgBI,YAAYT,GAC5B72H,KAAK4yH,mBAAmB2E,aACtBL,EACAr8B,IAAcj9E,MAGhB5d,KAAKg7D,QAAQ,CACf,IAAIw8D,EAAgBx3H,KAAKo1H,iBACvBhD,IAAuBI,QAEzB,MAAMiF,IAAsBD,EACtBE,EAAiB,IAAIX,IACzB1nF,EAASA,SACTrvC,KAAKg7D,OAAOu4D,cAETkE,IACHD,EAAgB,IAAI7qC,IAAU+qC,GAC9BF,EAAcj2B,MAAM6wB,IAAuBI,QAC3CgF,EAAcvzB,SAASjkG,KAAK6yH,uBAE9B2E,EAAcvzB,SAASjkG,KAAK+yH,aAC5B0E,EACID,EAAcF,YAAYI,GAC1B13H,KAAK4yH,mBAAmB2E,aACtBC,EACA38B,IAAcj9E,KAEtB,CAEJ,CACA64G,uBACEpnF,EACAggF,GAAkB,GAYlB,MAAM9kH,EAAW,CAVKvK,KAAKo1H,iBACzBhD,IAAuBC,UAEEryH,KAAKo1H,iBAC9BhD,IAAuBE,mBAEHtyH,KAAKo1H,iBACzBhD,IAAuBG,UAELvyH,KAAKo1H,iBAAiBhD,IAAuBI,SAM/D9oH,OAAQy8B,GAAMA,GAChB,GAAI57B,EAASX,OAAS,EAAG,CACvB,MAAMy5F,KAAiBV,MACrBp4F,EACAvK,KAAKygB,IAAI0oF,gBAELwuB,EACJtoF,GAAUoI,MAAQ,KACd,CAAC,IAAM,IAAM,IAAM,KACnB,CAAC,IAAM,GAAK,GAAK,IACjBmgF,KAAex0B,MACnBpjG,KAAKygB,IAAIojE,YACTwf,EACAs0B,GAEF,IAAI/8B,EACF56F,KAAKu0H,gBAAkBqD,EACnB/8B,IAAcqG,KACdrG,IAAcj9E,KAChByxG,IACFz0B,EAASC,IAAcsG,MAEzBvG,IAAWC,IAAcj9E,SACrBkmF,MAAiB9jG,KAAKygB,IAAIyhC,eAAgB33C,EAAUqwF,EAE1D,CACF,iJCzgBI,MAAOi9B,UAA0B5F,IAkEjBpyH,QA9DX8xH,UAAY,IAAI5vH,IAAwB,GAKjDkjG,YAAc,IAAIljG,SAAwBC,GAK1C03D,OAAS,IAAI33D,SAA8BC,GAM3CqwC,QAAU,CAAC,EAAG,EAAG,EAAG,GAKpB4P,gBAAkB,GAKlB61E,mBAKQC,QAAU,IAAI/8E,IAKdg9E,SAKAC,OAAyB,GAKzBC,WAAqB,EAK7B,gBAAIC,GACF,QAAOn4H,KAAKH,UAAwC,IAA9BG,KAAKH,QAAQs4H,YACrC,CAKA,UAAIpL,GACF,OAAO/sH,KAAKq2G,MAAM/0D,SACpB,CAEAvhD,YAAoBF,GAClBuG,QADkBpG,KAAAH,SAEpB,CAEAu4H,WAAW/lF,IAOLA,EAAQ+lD,KAAuB,IAAhB/lD,EAAQ+lD,OACzBp4F,KAAKqyC,QAAQ,GAAKA,EAAQ+lD,MAExB/lD,EAAQgmF,OAA2B,IAAlBhmF,EAAQgmF,SAC3Br4H,KAAKqyC,QAAQ,GAAKA,EAAQgmF,QAExBhmF,EAAQgmD,QAA6B,IAAnBhmD,EAAQgmD,UAC5Br4F,KAAKqyC,QAAQ,GAAKA,EAAQgmD,SAExBhmD,EAAQimF,MAAyB,IAAjBjmF,EAAQimF,QAC1Bt4H,KAAKqyC,QAAQ,GAAKA,EAAQimF,KAE9B,CAMAhhB,SAASjB,GACPjwG,MAAMkxG,SAASjB,GACfr2G,KAAKinB,gBACP,CAKAA,kBAC4B,IAAtBjnB,KAAKm4H,cACPn4H,KAAKkyH,aAAa5qH,KAChBtH,KAAKq2G,MAAM/mE,GAAG,UAAY5lB,GACxB1pB,KAAKu4H,UAAU7uG,KAKrB1pB,KAAKg4H,SAAWh4H,KAAK+3H,QAClBh0H,QAAKof,KAAa,KAClBtgB,UAAW6D,IACV1G,KAAKopG,UAAU1iG,EAAM8pE,OAAQ9pE,EAAMgF,OAAM,EAE/C,CAEA8sH,kBACEx4H,KAAKkyH,aAAa5qH,KAChBtH,KAAKq2G,MAAM/0D,UAAUhS,GAAG,kBAAoB8Y,IAC1CpoD,KAAK2xH,UAAUhvH,KAAKylD,EAAIxxC,OAAO6hH,cAAa,IAGhDz4H,KAAK2xH,UAAUhvH,KAAK3C,KAAKy4H,cAC3B,CAKAzxG,oBACE5gB,MAAM4gB,yBACgBhlB,IAAlBhC,KAAKg4H,WACPh4H,KAAKg4H,SAAS7pH,cACdnO,KAAKg4H,cAAWh2H,EAEpB,CAMA+hG,kBACE,OAAO/jG,KAAK+sH,OAAOvrE,eACrB,CAOAI,UAAUI,GACR,IAAIN,EAAS1hD,KAAK+sH,OAAOnrE,YACzB,OAAII,GAAcN,IAChBA,EAAS+uB,KAAiB/uB,EAAQ1hD,KAAK+jG,kBAAmB/hD,IAKrDN,CACT,CAOAmiC,UAAU7hC,GACR,IAAIwuB,EAASxwE,KAAK+sH,OAAO2L,gBAAgB14H,KAAKq2G,MAAMsiB,WACpD,OAAI32E,GAAcwuB,IAChBA,EAASC,KACPD,EACAxwE,KAAK+jG,kBACL/hD,IAGGwuB,CACT,CAOAooD,SAAS74C,EAAM,IACb,SAAO84C,MACL74H,KAAK8kG,gBACL9kG,KAAK+jG,kBAAkB+0B,WACvB/4C,EAEJ,CAMA+kB,gBACE,OAAO9kG,KAAK+sH,OAAOjoB,eACrB,CAMA/iD,UACE,OAAO71B,KAAKiwE,MAAMn8F,KAAK+sH,OAAOhrE,UAChC,CAKAwuE,SACEvwH,KAAKqvH,OAAOrvH,KAAK+sH,OAAOhrE,UAAY,EACtC,CAKAuuE,UACEtwH,KAAKqvH,OAAOrvH,KAAK+sH,OAAOhrE,UAAY,EACtC,CAMAstE,OAAOvtE,GACL9hD,KAAK+sH,OAAOgM,mBACZ/4H,KAAK+sH,OAAOp1E,QAAQ,CAClBmK,OACA+jC,SAAU,IACVmzC,OAAQC,MAEZ,CAOAn9B,aAAatrB,GACXxwE,KAAK+3H,QAAQp1H,KAAK,CAAE6tE,SAAQ9kE,OAAQwtH,IAAch4B,MACpD,CAOA5U,aAAa9b,GACXxwE,KAAK+3H,QAAQp1H,KAAK,CAAE6tE,SAAQ9kE,OAAQwtH,IAAc/3B,MACpD,CAMAs3B,cACE,OAAOz4H,KAAK+sH,OAAO0L,aACrB,CAKArH,gBACEpxH,KAAK+sH,OAAOp1E,QAAQ,CAAE01E,SAAU,GAClC,CAMA8L,mBACE,OAAOn5H,KAAKi4H,OAAOruH,OAAS,GAAK5J,KAAKk4H,WAAa,CACrD,CAMAkB,eACE,OAAOp5H,KAAKi4H,OAAOruH,OAAS,GAAK5J,KAAKk4H,WAAal4H,KAAKi4H,OAAOruH,OAAS,CAC1E,CAKAyvH,gBACMr5H,KAAKm5H,oBACPn5H,KAAKs5H,cAAct5H,KAAKk4H,WAAa,EAEzC,CAKAqB,YACMv5H,KAAKo5H,gBACPp5H,KAAKs5H,cAAct5H,KAAKk4H,WAAa,EAEzC,CAKAsB,oBACEx5H,KAAKi4H,OAAS,GACdj4H,KAAKk4H,WAAa,CACpB,CAKAuB,kBACMz5H,KAAKi4H,OAAOruH,OAAS,GACvB5J,KAAKs5H,cAAc,EAEvB,CAQQlwB,UACN54B,EACA9kE,EACA4tC,GAAqB,GAErB,MAAMyzE,EAAS/sH,KAAK+sH,OACpBA,EAAOgM,mBACP,MAAMlzC,EAAWvsC,EAAY,IAAM,EAC7BwI,EAAOirE,EAAOhrE,UAEd23E,EAAa3M,EAAOnrE,YACpB+3E,EAAW,CACfnpD,EAAO,IAAMA,EAAO,GAAKA,EAAO,IAAM,EACtCA,EAAO,IAAMA,EAAO,GAAKA,EAAO,IAAM,GAElCopD,EAAa1tG,KAAK2tG,KACtB3tG,KAAKq7B,IAAImyE,EAAW,GAAKC,EAAS,GAAI,GACpCztG,KAAKq7B,IAAImyE,EAAW,GAAKC,EAAS,GAAI,IAEpCG,GAAa/M,EAAO2L,kBACpBqB,EAAW7tG,KAAK2tG,KACpB3tG,KAAKq7B,IAAIuyE,GAAW,GAAKA,GAAW,GAAI,GACtC5tG,KAAKq7B,IAAIuyE,GAAW,GAAKA,GAAW,GAAI,IAMtCE,EAAQJ,IAJC1tG,KAAK2tG,KAClB3tG,KAAKq7B,IAAIipB,EAAO,GAAKA,EAAO,GAAI,GAAKtkD,KAAKq7B,IAAIipB,EAAO,GAAKA,EAAO,GAAI,IAE7CupD,GAAY,GAGhC/N,EACJtgH,IAAWwtH,IAAch4B,MAAQp/C,EAAO9hD,KAAKiiD,gBACzCH,EACA9hD,KAAKiiD,gBAEX8qE,EAAOkN,IAAIzpD,EAAQ,CACjBlxD,KAAMtf,KAAKq2G,MAAMsiB,UACjB3M,UACA35E,QAASryC,KAAKqyC,QACdwzC,SAAUm0C,EAAQ,EAAI,EAAIn0C,EAC1BzsC,SAAW8gF,IACJA,GACHnN,EAAOkN,IAAIzpD,EAAQ,CACjBlxD,KAAMtf,KAAKq2G,MAAMsiB,UACjB3M,UACA35E,QAASryC,KAAKqyC,QACdwzC,SAAUm0C,EAAQ,EAAI,EAAIn0C,GAC3B,GAIT,CAMQyzC,cAAcr6G,GACpBjf,KAAKk4H,WAAaj5G,EAClBjf,KAAKm6H,SAASn6H,KAAKi4H,OAAOh5G,GAC5B,CAMQk7G,SAAS3pH,GACfxQ,KAAK+sH,OAAOp1E,QAAQ,CAClB2jB,WAAY9qD,EAAM8qD,WAClB5Z,OAAQlxC,EAAMkxC,OACdmkC,SAAU,GAEd,CAMQ0yC,UAAU7uG,GAChB,MAAM4xC,EAAat7D,KAAK8kG,gBACpB9kG,KAAKilG,YAAYv+F,QAAU40D,GAC7Bt7D,KAAKilG,YAAYtiG,KAAK24D,GAGxB,MAAM9qD,EAAQ,CACZ8qD,aACA5Z,OAAQ1hD,KAAK4hD,YACbE,KAAM9hD,KAAK+hD,WAGb,IAA0B,IAAtB/hD,KAAKm4H,aAAuB,CAC9B,MAAMD,EAAal4H,KAAKk4H,YAGxB,EAAKkC,MAAmB5pH,EADC,IAAvBxQ,KAAKi4H,OAAOruH,YAAe5H,EAAYhC,KAAKi4H,OAAOC,MAEnDl4H,KAAKi4H,OAASj4H,KAAKi4H,OAAOp0G,MAAM,EAAGq0G,EAAa,GAAGv3G,OAAO,CAACnQ,IAC3DxQ,KAAKk4H,WAAal4H,KAAKi4H,OAAOruH,OAAS,EAE3C,CAEA5J,KAAK05D,OAAO/2D,KAAK6N,EACnB,ySCnZK,IAAM6pH,EAAqB,MAA5B,MAAOA,EAiDOj+G,UACRpK,aACAuoD,aAlDHrqD,MACCoqH,yBACN,IAAIjvH,KAAmC,IACjCw3B,mBACA03F,QACA9wE,SAEA+wE,eACAC,aAAe,GACfC,gBAKAC,oBAEAC,uBAEAC,eAAyB,iBAIxBC,qBAA+B,IAK/BC,wBAAkC,EAG3CC,WACE/3F,aAAajjC,KAAK6iC,oBAClB7iC,KAAK8oG,YACP,CAMA,OAAIroF,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA,iBAAIw6G,GACF,OAAQj7H,KAAKoc,UAAUqE,IAAeuhC,UACxC,CAEAjiD,YACkBqc,EACRpK,EACAuoD,GAFQv6D,KAAAoc,YACRpc,KAAAgS,eACAhS,KAAAu6D,cACP,CAMHhtD,WACEvN,KAAKygB,IAAIk5C,QACN51D,QAAKs5C,KAAOs4C,GAAWA,IAAWC,KAAcC,OAChDhzF,UAAU,KACT7C,KAAKkQ,MAAQ,IAAIitF,IAAsB,GAAI,CAAE18E,IAAKzgB,KAAKygB,MACvDzgB,KAAKw2C,YACLx2C,KAAKk7H,yBACLl7H,KAAKm7H,0BACLn7H,KAAK8qG,kBAAgB,GAIzB9qG,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAWi9C,IACtC9/C,KAAKkQ,QAAU4vC,EAAO19B,KAAM29B,GAAe,mBAATA,EAAE7tC,KACtClS,KAAKw2C,WAAS,EAGpB,CAMQA,YACN,MAAMtmC,EAAQlQ,KAAKkQ,MAEbuyC,EAAQ,IAAIsZ,KAAY,CAC5B5G,oBAAoB,EACpBjjD,GAAI,iBACJtG,MAAO,eACP42C,OAAQ,IACR/+B,OAAQ,IAAIq4C,IACZnS,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,EACXllF,MAAOilH,SAET9/B,OAAkBprF,EAAOuyC,GAEzBziD,KAAKw6H,eAAiB,IAAIlY,IAAkB,CAC1C7hG,IAAKzgB,KAAKygB,IAAI4gC,GACdmB,OAAQ,IACR64E,WAAY,SACZC,WAAW,EACX73G,OAAQ,IAAI83G,IAAmB,CAAEv5E,WAAYhiD,KAAKygB,IAAIuhC,aACtD7rC,MAAOA,CAACrL,EAASwwD,KACf,GAAIt7D,KAAK06H,iBAAmB5vH,EAAQ8xE,UAAW58E,KAAKy6H,aAClD,OAAOz6H,KAAKw7H,iBACV1wH,EACA9K,KAAK06H,gBACLp/D,EAAU,GAKpB,CAEAkgE,iBACE1wH,EACA6yG,EACAriD,GAEA,MAAMmgE,EAAkB,IAAK9d,GAC7B,IAAInyF,EAAQmyF,EAAWnyF,MAAQmyF,EAAWnyF,MAAMs0E,eAAY99F,EACxD05H,IAAgB/d,EAAWnyF,OAAOrV,MAEtC,GAAKrL,EAAQ5K,IAAI,YAIV,CAEL,MAAMof,EAAOm8G,EAAgBx3H,KAAOw3H,EAAgBx3H,KAAK2F,OAAS,EAC5DywF,EAAS,GACTjf,EAAS,GACTl8C,EAAQ,GACRs8C,EAAO,GACb,QAASpsC,EAAI,EAAGA,EAAI9vB,EAAM8vB,IACxBirD,EAAO/yF,KAAK,GACZ8zE,EAAO9zE,KAAK,0BACZ43B,EAAM53B,KAAK,GACXk0E,EAAKl0E,KAAK,0BAEZm0H,EAAgBphC,OAASA,EACzBohC,EAAgBrgD,OAASA,EACzBqgD,EAAgBv8F,MAAQA,EACxBu8F,EAAgBjgD,KAAOA,CACzB,MApBEigD,EAAgBjwG,WAAQxpB,EACxB05H,GAAgB,EAChBlwG,OAAQxpB,EAmBV,OAAK05H,GAAiBlwG,IACpBiwG,EAAgBjwG,MAAMrV,MAAQ,CAC5B+8G,UAAW,OACXyI,aAAc,MACdtI,KAAM,0BACN73C,KAAM,CAAEjwE,MAAO,QACfqwH,eAAgB,CAAErwH,MAAO,4BACzBswH,iBAAkB,CAAEtwH,MAAO,4BAA6B2zB,MAAO,GAC/Dk8C,OAAQ,CAAE7vE,MAAO,OAAQ2zB,MAAO,GAChC6rF,UAAU,EACVoI,QAAS,GACTC,QAAS,GACT/gF,QAAS,CAAC,IAAK,IAAK,IAAK,OAGtBryC,KAAKu6D,aAAagB,uBACvBzwD,EACA2wH,EACAngE,EAEJ,CAMAptD,cACElO,KAAK87H,2BACL97H,KAAK+7H,4BACL/7H,KAAKg8H,2BACLh8H,KAAKypD,SAASt7C,aAChB,CAMAgtH,0BACEn7H,KAAKu6H,QAAUv6H,KAAKs6H,yBAAyB71G,UAAU5hB,UACpDo5H,IACCj8H,KAAKk8H,kBAAkBD,EAA2B,EAGxD,CAKQf,yBACNl7H,KAAK26H,oBAAsB36H,KAAKygB,IAAI4gC,GAAG/R,GACrC,cACC5lB,GAAkC1pB,KAAKm8H,WAAWzyG,GAEvD,CAKQohF,mBACN9qG,KAAK46H,uBAAyB56H,KAAKygB,IAAI4gC,GAAG/R,GACxC,cACC5lB,GAAkC1pB,KAAKo8H,sBAAsB1yG,GAElE,CAMAqyG,4BACE/7H,KAAKu6H,QAAQpsH,aACf,CAMQ2tH,4BACNzwB,OAAQrrG,KAAK26H,qBACb36H,KAAK26H,yBAAsB34H,CAC7B,CAMQg6H,4BACN3wB,OAAQrrG,KAAK46H,wBACb56H,KAAK46H,4BAAyB54H,CAChC,CAMQo6H,sBAAsB1yG,GAC5B1pB,KAAK8oG,YACP,CAMQqzB,WAAWzyG,GACjB,GACEA,EAAM0mE,WACLpwF,KAAK+6H,wBACN/6H,KAAKgS,aAAak1D,gBAGlB,YADAlnE,KAAK8oG,oBAGI9oG,KAAK6iC,mBAAuB,KAErCI,aAAajjC,KAAK6iC,oBAEpB,IACIw5F,EADAC,GAAgB,IAEpB,MAAM9wB,EAAQxrG,KAAKygB,IAAI4gC,GAAGk7E,uBAAuB7yG,EAAMohE,YACvD9qF,KAAK6iC,mBAAqBlE,WAAW,KAyBnC,GAvBA3+B,KAAKygB,IAAI4gC,GAAGm7E,sBACVhxB,EACA,CAACixB,EAAmDC,KAClD,IAAKA,EACH,OAEF,MAAMrd,EAAWr/G,KAAKygB,IAAIk8G,gBAAiBD,EAAgBE,QACtD58H,KAAK68H,gBAAgBxd,KAGtBA,EAAS78D,QAAU85E,IAGvBA,EAAgBjd,EAAS78D,OACzB65E,EAAiBK,KAEnB,CACEvsC,aAAc,GACdsb,YAAc7J,GACZA,aAAmB8kB,KACnB9kB,aAAmB0gB,OAGpB+Z,EAIH,OAFAr8H,KAAK8oG,kBACL9oG,KAAKs6H,yBAAyBxzH,QAIhC9G,KAAKygB,IAAI4gC,GAAGm7E,sBACVhxB,EACA,CAACixB,EAAmDC,KAElD,QACqC16H,IAAnCy6H,EAAWv8H,IAAI,iBACfu8H,EAAWh9C,kBACTz/E,KAAKs6H,yBAAyBr4G,MAAM,IAAIw9D,gBAC1C,CAEA,IAAI4/B,EACJ,GAFAr/G,KAAK8oG,aAED4zB,aAAmBhW,IAAe,CACpC,MAAMoW,EAAgB98H,KAAKygB,IAAIk8G,gBAC5BD,EAAgBE,QAEnB,IAAK58H,KAAK68H,gBAAgBC,GACxB,OAEF,IAAIC,EAAiB/8H,KAAKg9H,oBAAoBP,GAC9Cz8H,KAAKi9H,yBAAyBH,EAAeC,GAC7C,MAAMG,EAAiB,CAACH,GACxBA,EAAe18H,IAAI,YAAY,GAC/B,MAAM88H,EAAmB,IAAIhiB,IAC7BgiB,EAAiBC,cAAcL,EAAet9C,iBAC9C,MAAM49C,EACuC,UAA3CN,EAAe5vC,cAAc8U,UACzB86B,EAAe5vC,cACf,IAAImwC,IAAa5zG,EAAMohE,YAC7BqyC,SAAiB7F,YAAY+F,GAC7BF,EAAiB57B,MAAMw7B,EAAengD,SACtCugD,EAAiB98H,IAAI,YAAY,GACjCL,KAAKi9H,yBAAyBH,EAAeK,GAC7CD,EAAe51H,KAAK61H,GACpBn9H,KAAKs6H,yBAAyBp1G,KAAKg4G,GACnC7d,EAAWyd,GACJ,CACT,CACA,GAAIJ,aAAmBpa,IAAmB,CACxC,MAAMib,EAAoBv9H,KAAKygB,IAAIk8G,gBAChCD,EAAgBE,QAEnB,IAAK58H,KAAK68H,gBAAgBU,GACxB,OAGAA,GAAmB19H,SAAS2jD,UAAUC,kBAClCk6D,WAEJ39G,KAAK06H,gBACH6C,EAAkB19H,QAAQ2jD,SAASC,iBAAiBk6D,WAC7C4f,GAAmB19H,SAAS2jD,UAAUm6D,aAC/C39G,KAAK06H,gBACH6C,EAAkB19H,QAAQ2jD,SAASm6D,YAEvC39G,KAAKw6H,eAAegD,UAAUd,EAAQ/4E,aACtC+4E,EACGv4E,YAAYz6B,EAAM8hF,OAClBiyB,KACEC,IACC,IAAKA,EAAY9zH,OAIf,OAHA5J,KAAKy6H,aAAe,GACpBz6H,KAAKw6H,eAAe9N,eACpB1sH,KAAK8oG,aAGP,MAAMh+F,EAAU4yH,EAAY,GAC5B,IAAK5yH,EAEH,YADA9K,KAAK8oG,aAGP,IAAIi0B,EAAiB/8H,KAAKg9H,oBAAoBlyH,GAC9CiyH,EAAe18H,IAAI,YAAY,GAC/B,MAAM88H,EAAmB,IAAIhiB,IAC7BgiB,EAAiBC,cACfL,EAAet9C,iBAEjB,MAAM49C,EACuC,UAA3CN,EAAe5vC,cAAc8U,UACzB86B,EAAe5vC,cACf,IAAImwC,IAAa5zG,EAAMohE,YAC7BqyC,EAAiB7F,YAAY+F,GAC7BF,EAAiB57B,MAAMw7B,EAAengD,SACtCugD,EAAiB98H,IAAI,YAAY,GACjCL,KAAKi9H,yBACHM,EACAJ,GAEFn9H,KAAKs6H,yBAAyBp1G,KAAK,CAACi4G,IACpCn9H,KAAKy6H,aAAa3vH,EAAQ8xE,SAAWmgD,EACrC/8H,KAAKw6H,eAAe9N,SAAO,GAGjCrN,EAAWke,CACb,CACF,GAEF,CACEptC,aAAc,GACdsb,YAAc7J,GAAYA,IAAYy6B,GACvC,EAEFr8H,KAAK86H,qBACV,CAEA+B,gBAAgBxd,GAkBd,SAjBKA,IAGAA,EAASxoF,UAGTwoF,EAASx/G,UAKXw/G,EAASx/G,QAAQ2jD,UAAUC,mBAC3B47D,EAASx/G,QAAQ2jD,UAAUm6D,YAM5B0B,EAASx/G,QAAQ2jD,UAAUC,mBAC1B47D,EAASx/G,QAAQ2jD,UAAUC,iBAAiBk6D,aAC5C0B,EAASx/G,QAAQ2jD,UAAUm6D,WAKhC,CAEAqf,oBACElyH,GAEA,IAAI6yH,EACJ,OAAI7yH,aAAmB8yH,MACrBD,EAAe,IAAIxiB,IAAU,CAC3B7xB,SAAUtpF,KAAKmtF,YAAYriF,KAE7B6yH,EAAap8B,MAAMz2F,EAAQ8xE,UAClB9xE,aAAmBqwG,MAC5BwiB,EAAe7yH,GAEjB6yH,EAAaP,cAActyH,EAAQ20E,iBAC5Bk+C,CACT,CAMQzB,kBAAkB2B,GACxB,GAAIA,EAAYj0H,OAAS,EAAG,CAC1B,MAAMy/B,EAASw0F,EAAY,GAC3B79H,KAAK8oG,aACL,MAAMh+F,EAAU,IAAIqwG,IAAU,CAC5B7xB,SAAUjgD,EAAO8jD,cACjB9uE,KAAM,CAAEnM,GAAIlS,KAAK66H,gBACjBiD,aAAc99H,KAAK+9H,gBAAgB10F,EAAOo2C,mBAG5Cz/E,KAAKkQ,MAAM24F,mBAAmB,CAAC/9F,GAAU+vF,IAAcj9E,KACzD,CACF,CAEQq/G,yBACN5d,EACAv0G,GAEA,MAAMwwD,EAAat7D,KAAKkQ,MAAMuyC,MAAMhiC,IAAIyhC,eAAe4iD,gBACnDua,GAAUx/G,SAAS2jD,UAAUC,kBAAkBk6D,WACjD39G,KAAKkQ,MAAMuyC,MAAMpB,GAAG4iD,SAClBjkG,KAAKw7H,iBACH1wH,EACAu0G,EAASx/G,QAAQ2jD,SAASC,iBAAiBk6D,WAC3CriD,IAKF+jD,GAAUx/G,SAAS2jD,UAAUm6D,YAC/B39G,KAAKkQ,MAAMuyC,MAAMpB,GAAG4iD,SAClBjkG,KAAKw7H,iBACH1wH,EACAu0G,EAASx/G,QAAQ2jD,SAASm6D,WAC1BriD,GAIR,CAEQyiE,gBAAgB1mG,GACtB,IAAIquD,EAAU,GACd,UAAYn/E,EAAKG,KAAUF,OAAOsa,QAAQuW,IACnC9wB,EAAIw6F,WAAW,MAAgB,aAARx6F,IAC1Bm/E,GAAW,GAAGn/E,MAAQG,OAG1B,OAAOg/E,EAAQ97E,QAAU,EAAI87E,EAAQ7hE,MAAM,GAAG,GAAM6hE,CACtD,CAEQyH,YAAYriF,GAClB,IAAIu+E,EACJ,GAAKv+E,EAAQkzH,2BAEN,CACL,MAAMC,EAASnzH,EAAQkzH,6BACjBE,EAAa,GAYnB,OAVAD,EAAO1jH,QAAQ,CAACyf,EAAGmkG,KACbA,EAAM,GAAM,GACdD,EAAW52H,KAAK,CACd82H,WAAWH,EAAOE,IAClBC,WAAWH,EAAOE,EAAM,KACzB,GAKGrzH,EAAQm3F,WACd,IAAK,QACH5Y,EAAO,IAAIi0C,IAAaY,GACxB,MACF,IAAK,UACH70C,EAAO,IAAIi0C,KAAe,CAACY,IAC3B,MACF,IAAK,aACH70C,EAAO,IAAIi0C,IAAkB,CAACY,IAGpC,MA1BE70C,EAAOv+E,EAAQqiF,cA4BjB,OAAO9D,CACT,CAKQyf,aACN9oG,KAAKy6H,aAAe,GAChBz6H,KAAKw6H,gBACPx6H,KAAKw6H,eAAe9N,UAElB1sH,KAAKkQ,OACPlQ,KAAKkQ,MAAM44F,YAEf,4CAhiBWuxB,GAAqBj5H,MAAAuE,IAAA,GAAAvE,MAAAwE,MAAAxE,MAAAyE,KAAA,+BAArBw0H,EAAqB/rH,UAAA,4BAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAArB1N,MAAA,6BAAA2N,EAAAisH,UAAU,gIAAVX,CAAqB,2cC/B5B,SAAUgE,EAAuB57E,GACrC,OAAOA,EAAM5iD,QAAQk7F,YACvB,CAEM,SAAUujC,EAAoB79G,EAAcvO,IAChD,OAAOuO,EAAIq/B,OAAO19B,KAAM29B,GAAMA,EAAElgD,QAAQk7F,cAAcC,SAAW9oF,GACnE,CA2BM,SAAUqsH,EACd99G,EACAgiC,GACAxkC,GAEA,IAAIugH,EAAa/7E,GACbg8E,EAAcD,EACdE,GAAiB,EACrB,KAAOA,GACLF,EAAaC,EACbA,EAAcE,EAA+Bl+G,EAAK+9G,EAAYvgH,GAC9DygH,IAAiBD,EAEnB,OAAKC,GAtCD,SAAUE,EACdn8E,EACAxkC,IAEA,IAAI4gH,GAAsB,EAC1B,MAAMC,EAAiBT,EAAuB57E,GAC9C,OAAIq8E,GAAgB7jC,QAIlB4jC,IAHaC,EAAe7jC,MAAM74E,KAAM29B,GACtCA,EAAE1oB,WAAWW,SAAS/Z,MAInB4gH,CACT,CA0BSD,CAAyBJ,EAAYvgH,KACxCugH,OAAax8H,GAGV08H,EAAiBD,EAAcD,CACxC,CAEM,SAAUG,EACdl+G,EACAgiC,GACAxkC,GAEA,GAAIwkC,IAAO5iD,QAAQk7F,cAAcC,OAAQ,CACvC,MAAM+jC,EAAgBt8E,GAAM5iD,QAAQk7F,aAAaC,OACjD,IAAIgkC,EAAUv+G,EAAIq/B,OAAOp2C,OAAQu1H,IAC/B,MAAMlkC,EAAekkC,EAAGp/H,QAAQk7F,aAChC,GAAIA,GAAgBA,EAAaE,MAM/B,OALUF,EAAaE,MAAM74E,KAC1B29B,GACCA,EAAEo7C,UAAUnjE,SAAS+mG,IACrBh/E,EAAE1oB,WAAWW,SAAS/Z,GAAS,GAKvC,OAAI+gH,EAAQp1H,OAAS,GACnBs5D,QAAQC,KAAK,cACX1gB,GAAM72C,OAAS62C,GAAMvwC,+BACM8sH,EAAQv+G,IAAK9W,GAAMA,EAAEiC,OAASjC,EAAEuI,yCAErD8sH,EAAQ,GAAGpzH,OAASozH,EAAQ,GAAG9sH,sCAGlC8sH,EAAQ,EACjB,CACF,CAEM,SAAUE,EACdz+G,EACAgiC,GACAxkC,GAEA,IAAIk9E,EAAY,GAChB,OAAI14C,IAAO5iD,QAAQk7F,cAAcE,OAC/Bx4C,GAAM5iD,QAAQk7F,aAAaE,MACxBvxF,OAAQq2C,GAAMA,EAAE1oB,WAAWW,SAAS/Z,IACpCwC,IAAK+sG,IACJryB,EAAYA,EAAUx6E,OAAO6sG,EAAKryB,UAAS,GAG1CA,EAAU16E,IAAK0+G,GAAQb,EAAoB79G,EAAK0+G,GACzD,CAEM,SAAUC,EACd3+G,EACAgiC,GACA48E,EACAphH,GAGAqhH,OADkBJ,EAA+Bz+G,EAAKgiC,GAAOxkC,GACjDwC,IAAK8+G,IACfF,EAAiB/3H,KAAKi4H,GACIL,EAA+Bz+G,EAAK8+G,EAAIthH,IAEhEmhH,EAA4B3+G,EAAK8+G,EAAIF,EAAkBphH,EAAQ,GAG5DohH,CACT,CAEM,SAAUG,EAAwB/+G,EAAcgiC,IACpD,IAAI+7E,EAAa/7E,GACbg8E,EAAcD,EACdE,GAAiB,EACrB,KAAOA,GACLF,EAAaC,EACbA,EAAcgB,EAA+Bh/G,EAAK+9G,GAClDE,IAAiBD,EAEnB,OAAKC,GAvGD,SAAUgB,EAAqBj9E,GACnC,IAAIk9E,IAA0B,EAC9B,MAAMb,EAAiBT,EAAuB57E,GAC9C,OAAIq8E,GAAgB7jC,QAElB0kC,KADab,EAAe7jC,MAAM74E,KAAM29B,GAAMA,EAAEm7C,eAG3CykC,EACT,CAgGSD,CAAqBlB,KACxBA,OAAax8H,GAGV08H,EAAiBD,EAAcD,CACxC,CAEM,SAAUiB,EACdh/G,EACAgiC,IAEA,GAAIA,GAAM5iD,QAAQk7F,cAAcC,OAAQ,CACtC,MAAM+jC,EAAgBt8E,GAAM5iD,QAAQk7F,aAAaC,OACjD,IAAIgkC,EAAUv+G,EAAIq/B,OAAOp2C,OAAQu1H,IAC/B,MAAMlkC,EAAekkC,EAAGp/H,QAAQk7F,aAChC,GAAIA,GAAgBA,EAAaE,MAI/B,OAHUF,EAAaE,MAAM74E,KAC1B29B,GAAMA,EAAEo7C,UAAUnjE,SAAS+mG,IAAkBh/E,EAAEm7C,aAAY,GAKlE,OAAI8jC,EAAQp1H,OAAS,GACnBs5D,QAAQC,KAAK,cACX1gB,GAAM72C,OAAS62C,GAAMvwC,+BACM8sH,EAAQv+G,IAAK9W,GAAMA,EAAEiC,OAASjC,EAAEuI,uCAEvD8sH,EAAQ,GAAGpzH,OAASozH,EAAQ,GAAG9sH,sCAGhC8sH,EAAQ,EACjB,CACF,CAEM,SAAUY,EACdn/G,EACAgiC,IAEA,IAAI04C,EAAY,GAChB,OAAI14C,IAAO5iD,QAAQk7F,cAAcE,OAC/Bx4C,GAAM5iD,QAAQk7F,aAAaE,MACxBvxF,OAAQq2C,GAAMA,EAAEm7C,cAChBz6E,IAAK+sG,IACJryB,EAAYA,EAAUx6E,OAAO6sG,EAAKryB,UAAS,GAG1CA,EAAU16E,IAAK0+G,GAAQb,EAAoB79G,EAAK0+G,GACzD,CAEM,SAAUU,EACdp/G,EACAgiC,GACA48E,GAGAC,OADkBM,EAA+Bn/G,EAAKgiC,IAC1ChiC,IAAK8+G,IACfF,EAAiB/3H,KAAKi4H,GACIK,EAA+Bn/G,EAAK8+G,IAE5DM,EAA4Bp/G,EAAK8+G,EAAIF,EAAgB,GAGlDA,CACT,CAEM,SAAUS,EACdr/G,EACAq/B,IAEA,MAAMigF,EAAuB,GACvBt5H,EAAOD,OAAOC,KAAKw8G,MACzBx8G,EAAKga,IAAKulB,IACR+5F,EAAqB9c,KAAiBj9E,IAAM,KAE9C8Z,GACGp2C,OAAQq2C,GAAMs+E,EAAuBt+E,IACrCt/B,IAAKs/B,IACJt5C,EAAKga,IAAKla,IACR,MAAMy/B,EAAIi9E,KAAiB18G,GACrBy5H,EAAOzB,EAAwB99G,EAAKs/B,EAAG/Z,GAEvC2/D,EADSo6B,EAAqB/5F,GACZvlB,IAAKs/B,GAAMA,EAAE7tC,IACjC8tH,IAASr6B,EAAS3tE,SAASgoG,EAAK9tH,KAClC6tH,EAAqB/5F,GAAG1+B,KAAK04H,EAAI,EAEpC,GAELx5H,OAAOC,KAAKs5H,GAAsBt/G,IAAKulB,IACtB+5F,EAAqB/5F,GAC7BvlB,IAAKs/B,GAAaA,EAAEsB,GAAGi4B,OAAOtzC,OAAGhkC,GAAU,EAEtD,CAEM,SAAUi+H,EACdx/G,EACAy/G,GACAC,GAEA,IAAKD,GACH,OAEF,MAAMznD,EAAkB,IAAIC,IAC5B,IAAI0nD,GAAkB,EAClBC,GAAuB,EAC3B,MAAM95H,EAAM25H,GAAe35H,IAC3B,IAAIwrF,EAqBJ,GApBY,eAARxrF,GACF65H,GAAkB,EAClBC,GAAuB,EACvBtuC,EACEouC,EAAkB9pG,WAAWx2B,QAC7Bu4E,YACe,eAAR7xE,GACT65H,GAAkB,EAClBC,GAAuB,EACvBtuC,EACEouC,EAAkB9pG,WAAWx2B,QAC7BkwE,aAEFqwD,GAAkB,EAClBC,GAAuB,EACvBtuC,EAAWouC,EAAkB9+E,GAAGnhD,IAAIqG,IAIpC83H,EAAuB8B,GACS,CAChC,IAAIG,EAAuB/B,EACzB99G,EACA0/G,EACA55H,GAEG+5H,IACHA,EAAuBH,GAGzB,MAAMI,EAAO,CAACD,GACdlB,EACE3+G,EACA6/G,EACAC,EACAh6H,GAGF,IAAIi6H,GAA+B,EACnC,MAAMC,EACJN,EAAkBtgI,QAAQ4jB,OAAO5jB,QAAQ2D,KACrCk9H,EAAkDP,EACrD9pG,WAAWx2B,QACd0gI,EAAK9/G,IAAKs/B,IACR,GACEogF,GACApgF,MACA4gF,MAAOR,EAAkB9+E,OAAE,EAAMs/E,MAAO5gF,GAAGsB,IAC3C,CACA,MAAMu/E,EAAa7gF,EAAElgD,QAAQ4jB,OAAO5jB,QAAQ2D,KAC5C,GAAI48H,EACFrgF,EAAEsB,GAAGhhD,IAAIkG,EAAKwrF,GAAU,GACZ,YAARxrF,GACFw5C,EAAE8kE,SAASliH,KAAKovF,IAEN,kBAARxrF,GAAmC,kBAARA,KAC7Bi6H,GAA+B,WAExBH,EACT,GAAY,eAAR95H,GAQF,GAPCw5C,EAAE1pB,WAAuC6iD,cACxC6Y,GACA,GAEiB,QAAf6uC,GACF7gF,EAAEsB,GAAGsC,YAAY9/C,UAEA,QAAf+8H,EAAsB,CACxB,IAAIC,EACgC,QAAhCJ,EACFI,EAAmBpoD,EAAgBoI,6BACjC6/C,EACCP,EAAkB9pG,WAAWx2B,QAC3By4E,uBACHt2E,EACAye,EAAIyhC,eAAe6hD,mBAEoB,QAAhC08B,IACTI,EACEV,EAAkB9pG,WAClBgrB,GAAGy/E,YAAYhgD,QAElB/gC,EAAE1pB,WAA6BgrB,GAAG0/B,aAAa,CAC9CD,OAAQ+/C,GAEZ,UAEA9gF,EAAE1pB,sBAAsBmgD,KAChB,eAARjwE,EACA,CACCw5C,EAAE1pB,WAAwC4qD,cACzC8Q,GACA,GAEF,MAAMgvC,EACJZ,EAAkB9+E,GAAGsC,YACrBm9E,YAAY1rB,KACdr1D,EAAE1pB,WAAWgrB,GAAG0/B,aAAa,CAAEq0B,KAAM2rB,GACvC,CAEJ,IAEEP,GACF//G,EAAIyhC,eAAe+iD,YAAYtiG,KAAK8d,EAAIyhC,eAAe+iD,YAAYv+F,MAEvE,CACF,+GCxUO,IAAMs6H,EAAwB,MAA/B,MAAOA,EAoCO5kH,UACRpK,aApCF6wB,mBAKA83F,oBAKAxwB,iBAKC82B,qBAA+B,IAK9BC,qBAAuB,IAAI5zH,MAMrC,OAAImT,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA,iBAAIw6G,GACF,OAAQj7H,KAAKoc,UAAUqE,IAAeuhC,UACxC,CAEAjiD,YACkBqc,EACRpK,GADQhS,KAAAoc,YACRpc,KAAAgS,cACP,CAMHzE,WACEvN,KAAKk7H,yBACLl7H,KAAK8qG,kBACP,CAMA58F,cACElO,KAAK87H,2BACL97H,KAAK2qG,oBACP,CAKQuwB,yBACNl7H,KAAK26H,oBAAsB36H,KAAKygB,IAAI4gC,GAAG/R,GACrC,cACC5lB,GACC1pB,KAAKmhI,eAAez3G,EAAO1pB,KAAKihI,sBAEtC,CAKQn2B,mBACN9qG,KAAKmqG,iBAAmBnqG,KAAKygB,IAAI4gC,GAAG/R,GAClC,cACC5lB,GAAuC1pB,KAAKmhI,eAAez3G,EAAO,GAEvE,CAKQoyG,4BACNzwB,OAAQrrG,KAAK26H,qBACb36H,KAAK26H,yBAAsB34H,CAC7B,CAKQ2oG,qBACN3qG,KAAKmqG,sBAAmBnoG,CAC1B,CAMQm/H,eAAez3G,EAAoCqgG,GACzD,GAAIrgG,EAAM0mE,UAAYpwF,KAAKgS,aAAak1D,gBACtC,cAESlnE,KAAK6iC,mBAAuB,KAErCI,aAAajjC,KAAK6iC,oBAGpB,MAAMu+F,KAAShoH,MACbsQ,EAAMohE,WACN9qF,KAAKi7H,cACL,aAEFj7H,KAAK6iC,mBAAqBlE,WAAW,KACnC3+B,KAAKkhI,qBAAqB9yH,KAAKgzH,EAAM,EACpCrX,EACL,4CAnHWiX,GAAwB5/H,MAAAuE,IAAA,GAAAvE,MAAAwE,MAAA,+BAAxBo7H,EAAwB1yH,UAAA,+BAAAC,OAAA,CAAA0yH,qBAAA,wBAAAzyH,QAAA,CAAA0yH,qBAAA,wBAAAzyH,YAAA,WAAxBuyH,CAAwB,uDC5B9B,IAAK9H,EAAZ,SAAYA,GACVA,WAAAh4B,KAAA,UACAg4B,IAAA/3B,KAAA,UAFU+3B,CAGZ,CAHA,CAAYA,GAAa,qECgBlB,IAAMmI,EAAU,MAAjB,MAAOA,EACH5gH,IAER1gB,cAAe,CAEfq+D,SACE,OAAOp+D,KAAKygB,GACd,CAEA0gG,OAAO1gG,GACLzgB,KAAKygB,IAAMA,CACb,4CAXW4gH,EAAU,iCAAVA,EAAUhgI,QAAVggI,EAAU//H,UAAAC,WAFT,gBAED8/H,CAAU,wOCPjB,MAAOC,UAAqBpX,KACzBqX,gBAGF,IAAIx/H,SAAgBC,GACjBmoH,OAAS,EACTC,QAAU,EACVtqE,OAAkB,GAClBjmC,cAAgC,GAExC9Z,cACEqG,OACF,CAEAikH,QAAS,CAETI,UACEzqH,KAAK8/C,OAAOvlC,QAASkoC,GAAUziD,KAAKwhI,aAAa/+E,GAAQziD,KAC3D,CAEAyhI,kBAAkB1mF,EAAqB0H,GAElC,CACCwgE,KAAiBO,WACjBP,KAAiBG,WACjBH,KAAiBE,QACjBF,KAAiBC,QACjBD,KAAiBI,cACjBJ,KAAiBK,eACjBtrF,SAAS+iB,EAAOx0C,MAIpBvG,KAAKuhI,gBAAgB5+H,KAAK,CAAE+mB,MAAOqxB,EAAQ0H,SAC7C,CAEAi/E,WAAWj/E,GACT,QAAsBzgD,IAAlBygD,EAAMkX,QACR,OAEFlX,EAAMpB,GAAG/R,GAAG,iBAAmB8Y,GAAQpoD,KAAKyhI,kBAAkBr5E,EAAK3F,IACnEA,EAAMpsB,WAAWgrB,GAAG/R,GAAG,iBAAmB8Y,GACxCpoD,KAAKyhI,kBAAkBr5E,EAAK3F,IAG9BziD,KAAK8/C,OAAOx4C,KAAKm7C,GAEjB,MAAMk/E,EAAUl/E,EAAMkX,QACnB51D,QAAKmtF,QACLruF,UAAW8yF,IACNA,IAAWC,KAAc5zE,QAC3BhiB,KAAKoqH,QAAU,EACfpqH,KAAKmqH,QAAS,GAEZx0B,IAAWC,KAAc+0B,QAC3B3qH,KAAKoqH,SAAW,EACPz0B,IAAWC,KAAcC,OAClC71F,KAAKmqH,QAAU,GAGbnqH,KAAKmqH,QAAUnqH,KAAKoqH,SACtBpqH,KAAKoqH,QAAUpqH,KAAKmqH,OAAS,EAC7BnqH,KAAK21F,OAASC,KAAcC,MACnB71F,KAAKoqH,QAAU,IACxBpqH,KAAK21F,OAASC,KAAc+0B,WAIlC3qH,KAAK6Z,cAAcvS,KAAKq6H,EAC1B,CAEAH,aAAa/+E,GACXA,EAAMpB,GAAG8nE,GAAG,iBAAmB/gE,GAAQpoD,KAAKyhI,kBAAkBr5E,EAAK3F,IACnEA,EAAMpsB,WAAWgrB,GAAG8nE,GAAG,iBAAmB/gE,GACxCpoD,KAAKyhI,kBAAkBr5E,EAAK3F,IAE9BA,EAAMkX,QAAQh3D,KAAKizF,KAAcC,MACjC,MAAM52E,EAAQjf,KAAK8/C,OAAOp3C,QAAQ+5C,GAC9BxjC,GAAS,KAG0D,IAAnE,CAAC22E,KAAc+0B,QAAS/0B,KAAcgsC,SAASl5H,QAFjC+5C,EAActwC,QAAQwjF,UAIpC31F,KAAKmqH,QAAU,GAEjBnqH,KAAK6Z,cAAcoF,GAAO9Q,cAC1BnO,KAAK6Z,cAAcgM,OAAO5G,EAAO,GACjCjf,KAAK8/C,OAAOj6B,OAAO5G,EAAO,GACzBwjC,EAActwC,QAAQs4G,UAE3B,wCCvDI,MAAOoC,EA4CD1wE,eACA3T,cA5CH6Y,GACAu+C,eAAiB,IAAI79F,KAAyB,GAC9CogD,QAAU,IAAIpgD,IAAyB,IACvC8/H,oBAAsB,IAAI9/H,SAAyBC,GACnD23D,QACA4nE,gBACA1vH,QACAiwH,oBACAC,qBACA7/E,eACAkb,sBACA4kE,cAAgB,IAAIjgI,KAAyB,GAC7CkuH,WAAa,IAAIluH,KAAyB,GAC1CkgI,kBAAoB,IAAIlgI,IAAyB,MAEjDmgI,iBAECC,aACAtiI,QACAuiI,eACAC,eAAsC,CAC5C/qG,SAAU,CAAEgrG,aAAa,IAG3B,UAAIxiF,GACF,OAAO9/C,KAAKmiD,QAAQz7C,KACtB,CAGA,cAAIs7C,GACF,OAAOhiD,KAAKuiI,cACd,CAEA,kBAAIp5B,GACF,OAAOnpG,KAAKkiD,eAAe6hD,iBAC7B,CAEA,kBAAIw+B,GACF,OAAOviI,KAAKmpG,eAAe1nD,SAC7B,CAEA1hD,YACEF,EACQs8C,EACA3T,GADAxoC,KAAAm8C,iBACAn8C,KAAAwoC,gBAERxoC,KAAKH,QAAU2G,OAAO6H,OAAO,GAAIrO,KAAKqiI,eAAgBxiI,GACtDG,KAAKmiI,aAAe,IAAIb,EACxBthI,KAAK25D,QAAU35D,KAAKmiI,aAAaxoE,QACjC35D,KAAKuhI,gBAAkBvhI,KAAKmiI,aAAaZ,gBACzCiB,KAAiBC,KACjBziI,KAAK2zC,MACP,CAEAA,OACE,MAAMrc,EAAW,GACbt3B,KAAKH,QAAQy3B,WACXt3B,KAAKH,QAAQy3B,SAASgrG,aAMxBhrG,EAAShwB,KAAK,IAAIo7H,KAJsB,IAAtC1iI,KAAKH,QAAQy3B,SAASgrG,YAClB,GACAtiI,KAAKH,QAAQy3B,SAASgrG,cAI1BtiI,KAAKH,QAAQy3B,SAASimC,WAMxBjmC,EAAShwB,KAAK,IAAIq7H,KAJoB,IAApC3iI,KAAKH,QAAQy3B,SAASimC,UAClB,GACAv9D,KAAKH,QAAQy3B,SAASimC,aAKhC,IAAIsxB,EAAe,IACe,IAA9B7uF,KAAKH,QAAQgvF,eACfA,EAAe,CACb+zC,oBAAoB,EACpBC,iBAAiB,EACjBC,UAAU,EACVC,gBAAgB,EAChBC,eAAe,EACfC,SAAS,EACTC,aAAa,EACbC,WAAW,IAIfnjI,KAAKqhD,GAAK,IAAIg1D,IAAM,CAClBxnB,aAAcu0C,IAAuBv0C,GACrCv3D,aAGFt3B,KAAKqjI,QAAQrjI,KAAKH,QAAQsQ,MAAQ,IAClCnQ,KAAKkiD,eAAiB,IAAI21E,IAAkB,CAC1CM,cAAc,IAEhBn4H,KAAKkiD,eAAeo1D,SAASt3G,KAAKqhD,IAClCrhD,KAAK6R,QAAU,IAAI3G,IAAQlL,MAC3BA,KAAK8hI,oBAAsB,IAAI52H,IAAQlL,MACvCA,KAAK+hI,qBAAuB,IAAI72H,IAAQlL,MACxCA,KAAKqhD,GAAGspC,KAAK,iBAAkB,KAC7B3qF,KAAKo9D,sBAAwB,IAAIq1D,IAC/BzyH,KACA,CACEgiD,WAAYhiD,KAAKkiD,eAAe6hD,mBAElC/jG,KAAKm8C,eACLn8C,KAAKwoC,eAEPxoC,KAAKo9D,sBAAsBk6C,SAASt3G,KAAKqhD,IACrCrhD,KAAKo9D,uBACPp9D,KAAKo9D,sBAAsBC,yBACzBr9D,KAAKoiI,gBAGTpiI,KAAKmiD,QAAQp+C,QAAKyhG,QAAY3iG,UAAU,EAAE4iG,EAAYtiD,MACpD,IAAIuiD,EACAD,IACFC,EAAeD,EAAWhlF,IAAKs/B,GAAMA,EAAE7tC,KAEzC,MAAM4tC,EAASqD,EAAcz5C,OAC1Bq2C,IAAO2lD,EAAa1tE,SAAS+nB,EAAE7tC,KAGlC,UAAWuwC,KAAS3C,EACd2C,EAAM5iD,QAAQk7F,cAChBt4C,EAAMpB,GAAGspC,KAAK,aAAc,MAC1Bm1C,SAAkC9/H,KAAM8/C,EAAM,EAC/C,GAIP9/C,KAAKkiD,eAAes2E,iBAAe,GAErCx4H,KAAKuhI,gBACFx9H,QAAK6jG,KAAW07B,IAAQA,IACxBzgI,UAAW8G,MAAMs2H,OAA0BjgI,KAAM2J,EAAE+f,MAAO/f,EAAE84C,OACjE,CAEAzoC,UAAU9H,GACRlS,KAAKqhD,GAAGrnC,UAAU9H,QACPlQ,IAAPkQ,EACFlS,KAAKmiI,aAAat/H,UAAU,OAAU,MAEtC7C,KAAKmiI,aAAah0H,aAEtB,CAEAwhH,WAAW9vH,GAET,MAAM0jI,EAA8B,IADhBvjI,KAAKqhD,GAAGC,UAEXm+B,mBACZ5/E,GAGDA,EAAQiiD,MAA8B,MAAtBjiD,EAAQy7D,aAC1BioE,EAAYjoE,gBAAat5D,GAG3BhC,KAAKqjI,QAAQE,GACT1jI,EAAQoiD,kBACVjiD,KAAKkiD,eAAeD,gBAAkBpiD,EAAQoiD,iBAEhDjiD,KAAKoiI,eAAiBviI,CACxB,CAMAwjI,QAAQxjI,QACsBmC,IAAxBhC,KAAKkiD,gBACPliD,KAAKkiD,eAAes3E,oBAGtB,MAAM+J,EAA2B,CAAEC,qBAAqB,KAAS3jI,GAC7DA,EAAQ6hD,SACV6hF,EAAY7hF,OAAS+uB,KACnB5wE,EAAQ6hD,OACR7hD,EAAQmiD,aAIZhiD,KAAKqhD,GAAGgiF,QAAQ,IAAItW,KAAOwW,IAEvB1jI,EAAQi4H,qBACV93H,KAAKkiD,eAAe41E,mBAAqBj4H,EAAQi4H,mBAErD,CAEAjI,eAAenpH,GACb,QAAc1E,IAAV0E,EACF,OAGF,MAAM4wB,EAAW,GACb5wB,EAAM47H,aAIRhrG,EAAShwB,KAAK,IAAIo7H,KAFM,IAAtBh8H,EAAM47H,YAAuB,GAAK57H,EAAM47H,cAIxC57H,EAAM62D,WAIRjmC,EAAShwB,KAAK,IAAIq7H,KAFI,IAApBj8H,EAAM62D,UAAqB,GAAK72D,EAAM62D,YAKlB/2D,OAAO6H,OAAO,GAAIrO,KAAKqhD,GAAGoiF,cAAc3yC,YAChDv2E,QAAS8d,IACvBr4B,KAAKqhD,GAAGqiF,cAAcrrG,EAAO,GAE/Bf,EAAS/c,QAAS8d,IAChBr4B,KAAKqhD,GAAGhd,WAAWhM,EAAO,EAE9B,CAMAupB,UAAUI,GACR,OAAOhiD,KAAKkiD,eAAeN,UAAUI,EACvC,CAMA6hC,UAAU7hC,GACR,OAAOhiD,KAAKkiD,eAAe2hC,UAAU7hC,EACvC,CAKAD,UACE,OAAO/hD,KAAKkiD,eAAeH,SAC7B,CAEAsqE,gBAAgBhqE,GACd,GAAKA,EAIL,WAAW0pE,KAAM/rH,KAAK2jI,gBACpB5X,EAAGl1F,SAAU,EAGfwrB,EAAUxrB,SAAU,EAEpB72B,KAAKkiD,eAAe6qE,OAAO6W,WACzBvhF,EAAUhsB,WAAWx2B,QAAQosH,UAAYjsH,KAAKH,QAAQsQ,MAAQ,IAAI87G,SAEpEjsH,KAAKkiD,eAAe6qE,OAAO8W,WACzBxhF,EAAUhsB,WAAWx2B,QAAQmsH,UAAYhsH,KAAKH,QAAQsQ,MAAQ,IAAI67G,QAAO,CAE7E,CAEA2X,gBACE,OAAO3jI,KAAK8/C,OAAOp2C,OAAQ+4C,IAAqC,IAApBA,EAAMJ,UACpD,CAEAyhF,aAAa5xH,GACX,OAAOlS,KAAK8/C,OAAO19B,KAAMqgC,GAAiBA,EAAMvwC,IAAMuwC,EAAMvwC,KAAOA,EACrE,CAEA6xH,gBAAgBrmD,GACd,OAAO19E,KAAK8/C,OAAO19B,KAChBqgC,GAAiBA,EAAMi7B,OAASj7B,EAAMi7B,QAAUA,EAErD,CAEAi/C,gBAAgBqH,GACd,OAAOhkI,KAAK8/C,OAAO19B,KAChBqgC,MAAiBk+E,MAAOl+E,EAAMpB,MAAE,EAAKs/E,MAAOl+E,EAAMpB,MAAQ2iF,EAE/D,CAEAC,kBAAkBriC,GAChB,MAAMoiC,KAAQrD,MAAO/+B,GACrB,OAAO5hG,KAAK28H,gBAAgBqH,EAC9B,CAOAhoE,SAASvZ,EAAcn7C,GAAO,GAC5BtH,KAAK08D,UAAU,CAACja,GAClB,CAOAia,UAAU5c,EAAiBx4C,GAAO,GAChC,IAAI48H,EAAe,EACfC,EAAwB,EAC5B,MAAMC,EAActkF,EACjBr/B,IAAKgiC,IACJ,IAAKA,EACH,OAEF,MAAM/S,EAAS+S,EAAMD,OACjB,EACAC,EAAMJ,UACJ8hF,IACAD,IACN,OAAOlkI,KAAKqkI,WAAW5hF,EAAO/S,EAAM,GAErChmC,OAAQ+4C,QAAuCzgD,IAAVygD,GACxCziD,KAAKskI,UAAU,GAAG3jH,OAAO3gB,KAAK8/C,OAAQskF,GACxC,CAMA73B,YAAY9pD,GACVziD,KAAK46D,aAAa,CAACnY,GACrB,CAMAmY,aAAa9a,GACX,MAAMykF,EAAYvkI,KAAKmiD,QAAQz7C,MAAMmd,MAAM,GACrC2gH,EAAiB,GACvB1kF,EAAOvlC,QAASkoC,IACVA,aAAiBsZ,MACnBtZ,EAAMukE,qBAER,MAAM/nG,EAAQslH,EAAU77H,QAAQ+5C,GAC5BxjC,GAAS,IACXulH,EAAel9H,KAAKm7C,GACpB8hF,EAAU1+G,OAAO5G,EAAO,GACxBjf,KAAKykI,2BAA2BhiF,EAAO+hF,GACvCA,EAAe/jH,IAAKikH,IAClB,MAAMC,EAAcJ,EAAU77H,QAAQg8H,GAClCC,GAAe,GACjBJ,EAAU1+G,OAAO8+G,EAAa,EAAC,GAElC,GAILH,EAAejqH,QAASkoC,GAAiBziD,KAAK4kI,cAAcniF,IAC5DziD,KAAKskI,UAAUC,EACjB,CAOAE,2BAA2BI,EAAiBL,GAC1C,IAAIM,KAAuBtF,MAAwBx/H,KAAM6kI,GACpDC,IACHA,EAAuBD,GAEzB,MAAME,KAAOlF,OAA4B7/H,KAAM8kI,EAAsB,CACnEA,IAEF,UAAWriF,KAASsiF,EAClBP,EAAel9H,KAAKm7C,EAExB,CAKAkY,kBACE36D,KAAK8/C,OAAOvlC,QAASkoC,GAAiBziD,KAAK4kI,cAAcniF,IACzDziD,KAAKmiD,QAAQx/C,KAAK,GACpB,CAEAqiI,WAAWviF,GACT,MAAMxjC,EAAQjf,KAAKilI,cAAcxiF,GAC7BxjC,EAAQ,GACVjf,KAAKklI,UAAUziF,EAAOxjC,EAAOA,EAAQ,EAEzC,CAEAkmH,YAAYrlF,GACV,UAAW2C,KAAS3C,EAClB9/C,KAAKglI,WAAWviF,EAEpB,CAEA2iF,WAAW3iF,GACT,MAAMxjC,EAAQjf,KAAKilI,cAAcxiF,GAC7BxjC,EAAQjf,KAAK8/C,OAAOl2C,OAAS,GAC/B5J,KAAKklI,UAAUziF,EAAOxjC,EAAOA,EAAQ,EAEzC,CAEAomH,YAAYvlF,GACV,MAAMwlF,EAAgBxlF,EAAO//B,UAC7B,UAAW0iC,KAAS6iF,EAClBtlI,KAAKolI,WAAW3iF,EAEpB,CAEAyiF,UAAUziF,EAAc/iC,EAAcwqD,GACpC,MAAMq7D,EAAUvlI,KAAK8/C,OAAOoqB,GAEtBs7D,EAAa/iF,EAAMD,OAErB+iF,EAAQljF,WAAaI,EAAMJ,YAI/BI,EAAMD,OAPW+iF,EAAQ/iF,OAQzB+iF,EAAQ/iF,OAASgjF,EAEjBxlI,KAAK8/C,OAAOoqB,GAAMznB,EAClBziD,KAAK8/C,OAAOpgC,GAAQ6lH,EACpBvlI,KAAKmiD,QAAQx/C,KAAK3C,KAAK8/C,OAAOj8B,MAAM,IACtC,CAQQwgH,WAAW5hF,EAAcyhF,GAC3BzhF,EAAMJ,WAAaI,EAAM5rB,SAC3B72B,KAAKqsH,gBAAgB5pE,GAGvB,MAAMgjF,EAAgBzlI,KAAK8jI,aAAarhF,EAAMvwC,IAC9C,QAAsBlQ,IAAlByjI,EAAJ,CASA,IAJKhjF,EAAMJ,WAAaI,EAAMD,SAC5BC,EAAMD,QAAU,SAGGxgD,IAAjBygD,EAAMD,QAAyC,IAAjBC,EAAMD,OAAc,CACpD,MAAMkjF,EAAYx5G,KAAKC,IACrBs2B,EAAMJ,UAAY,EAAI,MACnBriD,KAAK8/C,OACLp2C,OACEq2C,GAAMA,EAAEsC,YAAcI,EAAMJ,WAAatC,EAAEyC,OAAS,KAEtD/hC,IAAKs/B,GAAMA,EAAEyC,SAElBC,EAAMD,OAASkjF,EAAY,EAAIxB,CACjC,CAEA,OAAIzhF,EAAMJ,WAAaI,EAAMD,OAAS,IACpCC,EAAMD,OAAS,IAGjBC,EAAM0+D,OAAOnhH,MACbA,KAAKmiI,aAAaT,WAAWj/E,GAC7BziD,KAAKqhD,GAAG2a,SAASvZ,EAAMpB,IAEhBoB,CA1BP,CAFEgjF,EAAc5uG,SAAU,CA6B5B,CAMQ+tG,cAAcniF,GACpBziD,KAAKmiI,aAAaX,aAAa/+E,GAC/BziD,KAAKqhD,GAAGkrD,YAAY9pD,EAAMpB,IAC1BoB,EAAM0+D,YAAOn/G,EACf,CAMQsiI,UAAUxkF,GAChB9/C,KAAKmiD,QAAQx/C,KAAK3C,KAAK2lI,mBAAmB7lF,GAAQj8B,MAAM,GAC1D,CAOQ8hH,mBAAmB7lF,GAEzB,OAAOA,EAAOt9B,KACZ,CAACojH,EAAeC,IAAkBA,EAAOrjF,OAASojF,EAAOpjF,OAE7D,CAOQyiF,cAAcxiF,GACpB,OAAOziD,KAAK8/C,OAAO9K,UAAW8wF,GAAkBA,IAAWrjF,EAC7D,4KCphBI,SAAUwvC,EACd3gC,EACA2pE,EACAp4E,EAA8B,IAO9B,IAAIuvC,GACA2zC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAvsC,EACAwsC,EACAC,EACAC,EAIAC,GACJ,MAAMC,GAAkB,IAAIj9H,OAHF,wBAG4B,KAEhDk9H,GAAc,mCACdC,GAAgB,GAAGD,YAAqBA,KACxCE,GAAc,IAAIp9H,OAAO,IAAIm9H,MAAkB,KAE/CE,GACJ,yHACIC,GAAkB,GAAGD,wBAA8BA,kBACnDE,GAAW,IAAIv9H,OAAO,IAAIs9H,MAAoB,MAE9CE,GACJ,gEACIC,GAAW,IAAIz9H,OAAO,IAAIw9H,KAAc,MAExCE,GACJ,gEACIC,GAAW,IAAI39H,OAAO,IAAI09H,KAAc,MAExCE,GAAU,8BACVC,GAAY,GAAGD,iBAAsBA,KACrCE,GAAU,IAAI99H,OAAO,IAAI69H,KAAa,KAEtCE,GACJ,4EACIC,GAAa,GAAGD,kBAAwBA,KACxCE,GAAW,IAAIj+H,OAAO,IAAIg+H,KAAc,KAGxCE,GACJ,yQACIC,GAAY,IAAIn+H,OAAO,IAAIk+H,MAAgB,MAE3CE,GAAU,0BACVC,GAAY,GAAGD,YAAiBA,KAChCE,GAAU,IAAIt+H,OAAO,IAAIq+H,MAAc,KAE7C,IAAIE,IAAa,EAUjB,GARAj3E,EAAMA,EAAIk3E,oBAAoBC,OAG1BxB,GAAgB/8H,KAAKonD,IACtBy0E,EAAUiB,IAAiB11E,EAAIhoD,MAAM,KAAKmX,IAAK7E,IAAMA,GAAE6sH,QAExD1C,EAAWz0E,EAET81E,GAAYl9H,KAAK67H,IACnB,CAAGC,EAAac,EAAG,CAAIT,EAAYC,EAAaS,EAAG,CAAIJ,GACrDZ,EAAS7qG,MAAMisG,IAEjBL,EAAM1I,YAAY4H,GAA4B,IAAMc,EAAM,IAAMT,GAChEU,EAAM3I,YAAYkI,GAA4B,IAAMS,EAAM,IAAMJ,QAAU,GACjEY,GAASr9H,KAAK67H,IACvB,CAEEE,EACAC,EACAC,EACAC,EACAG,EACAC,EACAC,EACAC,GACEX,EAAS7qG,MAAMosG,KAEE,MAAjBlB,GAAyC,MAAjBA,KAC1BH,EAAa,CAACM,EAAaA,EAAaN,GAAa,GACrDC,EAAa,CAACM,EAAaA,EAAaN,GAAa,GACrDC,EAAa,CAACM,EAAaA,EAAaN,GAAa,GACrDC,EAAe,CAACM,EAAeA,EAAeN,GAAe,IAG/DU,EAAM4B,EACJtK,WAAW6H,GACX7H,WAAW8H,GACX9H,WAAW+H,GACXC,GAEFW,EAAM2B,EACJtK,WAAWmI,GACXnI,WAAWoI,GACXpI,WAAWqI,GACXC,QAAY,GAELe,GAASv9H,KAAK67H,GAAW,CAClCwC,IAAa,GACb,EAAK3B,EAAME,EAAKC,GAAOhB,EAAS7qG,MAAMssG,IACtC,MAAMmB,GAAUxtG,OAAOyrG,GAAQ,GAAK,YAAYA,IAAS,WAAWA,KACnEE,EAAKC,GAAOt2D,KACX,CAAC2tD,WAAW0I,GAAM1I,WAAW2I,IAC7B4B,GACA,YAEJ,SAAWhB,GAASz9H,KAAK67H,GAAW,CAClCwC,IAAa,GACb,EAAK3B,EAAME,EAAKC,GAAOhB,EAAS7qG,MAAMwsG,IACtC,MAAMkB,GACJztG,OAAOyrG,GAAQ,GAAK,YAAYA,IAAS,WAAW,GAAKzrG,OAAOyrG,MACjEE,EAAKC,GAAOt2D,KACX,CAAC2tD,WAAW0I,GAAM1I,WAAW2I,IAC7B6B,GACA,YAEJ,SAAWX,GAAS/9H,KAAK67H,IACvB,CAEEC,EACAC,EACAC,EACAC,EACAE,EACAC,EACAC,EACAC,EACAC,EACAE,GACEZ,EAAS7qG,MAAM8sG,IAEnBlB,EAAM4B,EACJtK,YAAY4H,GAA4B,IAAMC,GAC9C7H,WAAW8H,GACX9H,WAAW+H,GACXC,GAEFW,EAAM2B,EACJtK,YAAYkI,GAA4B,IAAMC,GAC9CnI,WAAWoI,GACXpI,WAAWqI,GACXC,QAAY,GAELoB,GAAQ59H,KAAK67H,IACtB,CAEEC,EACAC,EACAI,EACAC,EACAC,EACAI,GACEZ,EAAS7qG,MAAM2sG,IAEnBf,EAAM4B,EACJtK,YAAY4H,GAA4B,IAAMC,GAC9C7H,WAAW8H,GACX9H,WAAW+H,GACXC,GAEFW,EAAM2B,EACJtK,YAAYkI,GAA4B,IAAMC,GAC9CnI,WAAWoI,GACXpI,WAAWqI,GACXC,QAAY,GAELyB,GAAUj+H,KAAK67H,IACxB,CAEEO,EACAC,EACAC,EACAC,EAAU,CAEVC,EACAV,EACAC,EACAC,EACAC,EAAU,CAEVC,EACA/rC,EACAwsC,GACEd,EAAS7qG,MAAMgtG,IAGd9B,IACHA,EAAe,KAKfU,EADEZ,GAAcA,EAAWt8H,OAAS,EAC9Bw0H,YACH4H,GAA4B,IAAMC,EAAa,IAAMC,GAGlDwC,EACJtK,WAAW6H,GACX7H,WAAW8H,GACX9H,WAAW+H,GACXC,GAKFW,EADEP,GAAcA,EAAW58H,OAAS,EAC9Bw0H,YACHkI,GAA4B,IAAMC,EAAa,IAAMC,GAGlDkC,EACJtK,WAAWmI,GACXnI,WAAWoI,GACXpI,WAAWqI,GACXC,OAAY,KAGP4B,GAAQp+H,KAAK67H,GAYtB,MAAO,CACL3zC,YAAQpwF,EACRwW,QAAS,GACT6hF,YAAQr4F,EACR6kI,UAAM7kI,GAfRumI,IAAa,GACb,CAAGzB,EAAKT,EAAYU,EAAKJ,GAAcZ,EAAS7qG,MAAMmtG,IAElDhC,IACFS,EAAM1I,WAAW0I,EAAM,IAAMT,IAG3BM,IACFI,EAAM3I,WAAW2I,EAAM,IAAMJ,IA8BjC,GAnBI9jF,EAAKgmF,UAAYN,KAEfzB,EAAM,GAAKC,EAAM,IACfD,EAAMC,EACRD,GAAOA,EAEPC,GAAOA,GAKPD,EAAMC,IACRD,EAAM,CAACC,EAAMA,EAAMD,GAAM,KAI7B10C,GAAS,CAACj3D,OAAO2rG,GAAM3rG,OAAO4rG,SAIT/kI,IAAlBglI,IAtPkB,SAsPaA,IAChC50C,GAAO,GAAK,KACZA,GAAO,IAAK,KACZA,GAAO,GAAK,IACZA,GAAO,IAAK,GACZ,CACA,MAAM3uE,GAASujH,GAAgB,QAAUA,GAAgB/L,EACnD6N,GAAO,YAEb,IACE12C,GAAS3hB,KAAiB2hB,GAAQ3uE,GAAQqlH,GAC5C,OACE,MAAO,CACL12C,YAAQpwF,EACRwW,QAAS,cAAgBiL,GAAS,iBAClC42E,YAAQr4F,EACR6kI,UAAM7kI,EAEV,CACF,CACA,OAAIkqB,KAAK68G,IAAI32C,GAAO,KAAO,KAAOlmE,KAAK68G,IAAI32C,GAAO,KAAO,GAChD,CACLA,UACA55E,QAAS,GACT6hF,OAAQA,EAAS/hE,SAAS+hE,EAAQ,SAAMr4F,EACxC6kI,KAAMA,EAAOvuG,SAASuuG,EAAM,SAAM7kI,GAG7B,CACLowF,YAAQpwF,EACRwW,QAAS,8CACT6hF,YAAQr4F,EACR6kI,UAAM7kI,EAGZ,CASA,SAAS0mI,EACPM,EACAC,EACAC,EACA5kH,IAEA2kH,EAAUA,GAAW,EACrBC,EAAUA,GAAW,EAErB,MAAMC,EAAMH,EAAU,EACtB,IAAII,EAAKl9G,KAAK68G,IAAIC,GAAWC,EAAU,GAAKC,EAAU,KAEtD,OAAIC,GAAqB,MAAd7kH,IAAmC,MAAdA,MAC9B8kH,GAAMA,GAEDA,CACT,CAQM,SAAUC,EACdC,EACAC,EAAkB,GAElB,MAAMC,EAAY,GAElBF,SAAS/uH,QAAS6uH,KAChB,MAAMJ,EAAUI,GAAK,EAAIl9G,KAAKu9G,KAAKL,IAAMl9G,KAAKuN,MAAM2vG,IAC9CM,EAAMN,GAAK,EAAqB,IAAhBJ,EAAUI,IAA4B,IAAhBA,GAAKJ,GAC3CC,EAAU/8G,KAAKuN,MAAMiwG,GACrBR,GAA6B,IAAjBQ,EAAMT,IAAejzE,QAAQuzE,GAE/CC,EAAUliI,KAAK,GAAG0hI,SAAYC,MAAYC,KAAU,GAE/CM,CACT,CAQM,SAAUpP,EACduP,EACAC,GAEA,QAAe5nI,IAAX2nI,QAAmC3nI,IAAX4nI,EAC1B,OAAO,EAGT,MAAMC,EAAY,KAClB,OACEF,EAAO7nF,OAAS8nF,EAAO9nF,MACvB51B,KAAK49G,MAAMH,EAAOjoF,OAAO,GAAKmoF,KAC5B39G,KAAK49G,MAAMF,EAAOloF,OAAO,GAAKmoF,IAChC39G,KAAK49G,MAAMH,EAAOjoF,OAAO,GAAKmoF,KAC5B39G,KAAK49G,MAAMF,EAAOloF,OAAO,GAAKmoF,EAEpC,CAOM,SAAUE,EAAYzoD,GAE1B,OADAA,EAAQp1D,KAAKiwE,MAAM7a,IACP,IACHA,EAAQ,IAGjBA,EAAQp1D,KAAKiwE,MAAM7a,EAAQ,MACf,IACHA,EAAQ,KAGjBA,EAAQp1D,KAAKiwE,MAAM7a,EAAQ,MACZ,GACjB,CAQM,SAAU5P,EACd4P,EACAvB,EAAc,IAGd,OAAOuB,GAAS0oD,QAAiBjqD,EACnC,CAOM,SAAU84C,EACdv9D,EACAw5B,EAAe,IACf/U,EAAc,IAGd,OAAOzkB,EAAamV,KAAuBqkB,GAAQk1C,QAAiBjqD,CACtE,CAOM,SAAUurB,EAAY5hF,GAC1B,MAAMugH,EAAgBvgH,EAAMugH,cAC5B,OACGA,EAAcC,SACdC,KAAMF,EAAcG,QAAUH,EAAcI,WAC5CJ,EAAc77G,QAEnB,CAEM,SAAU63D,EACd1V,EACAg5D,EAAkB,GAElB,MAAO,CACLttC,KAAYC,gBAAgB3rB,EAAM,GAAIg5D,GACtCttC,KAAYC,gBAAgB3rB,EAAM,GAAIg5D,GAE1C,CAEM,SAAUe,EACd/5D,EACAg5D,EAAkB,GAElB,OAAOtjD,EAAa1V,EAAOg5D,GAAS9oH,IAAKuoD,GAAMA,EAAE7Q,WAInD,CAWM,SAAUoyE,EACdn4C,EACAo4C,GAOA,MAAMC,EAAeh6D,KAAiB2hB,EAAQ,YAAa,aAIrDs4C,GAAkB,CACtB,CACEhhB,KAAM,YACNhsC,MAAO,eACPnN,MAAOk6D,EACPE,gBAAiB,GAAG1kD,EAAawkD,GAAc5gI,KAAK,iBAKlD+gI,EAwDF,SAAUC,EAAkBz4C,GAChC,OAAOlmE,KAAKu9G,MAAMr3C,EAAO,GAAK,KAAO,EACvC,CA1DkBy4C,CAAkBz4C,GAC5Bu2C,EAAUiC,EAAU,GAAK,YAAYA,IAAY,WAAWA,IAC5DE,EAAU,OAAOF,IACjBG,EAAct6D,KAAiB2hB,EAAQ,YAAau2C,GAI1D+B,GAAgBpjI,KAAK,CACnBoiH,KAAMif,EACNjrD,MAAO,MACPnN,MAAOw6D,EACPJ,gBAAiB,GAAGG,KAAW7kD,EAAa8kD,GAAalhI,KAAK,UAIhE,MAAMmhI,EAkDF,SAAUC,EAAkB74C,GAChC,MAAM84C,EAAO94C,EAAO,GACpB,IAAI44C,EACJ,OAAIE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,GAERE,GAAO,IAAOA,GAAO,KACvBF,EAAU,IAELA,CACT,CApFkBC,CAAkB74C,GAClC,GAAI44C,EAAS,CACX,MAAMpC,EACJoC,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IACnDG,EAAU,OAAOH,IACjBI,EAAc36D,KAAiB2hB,EAAQ,YAAaw2C,GAI1D8B,GAAgBpjI,KAAK,CACnBoiH,KAAMkf,EACNlrD,MAAO,MACPnN,MAAO66D,EACPT,gBAAiB,GAAGQ,KAAWllD,EAAamlD,GAAavhI,KAAK,SAElE,CAEA2gI,SAAYjwH,QAASynC,IACnB,MAAMqpF,EAAW56D,KAAiB2hB,EAAQ,YAAapwC,EAAW0nE,MAI5D4hB,EAAkBtpF,EAAW0nE,KAAKpgH,MAAM,KAAK,GACnDohI,GAAgBpjI,KAAK,CACnBoiH,KAAM1nE,EAAW0nE,KACjBhsC,MAAO17B,EAAW07B,OAAS17B,EAAW0nE,KACtCn5C,MAAO86D,EACPV,gBAAiB,GAAG1kD,EAAaolD,GAAUxhI,KACzC,WACKyhI,KACR,GAGIZ,EACT,8GCriBO,IAAMa,EAAmB,MAA1B,MAAOA,EAWD9sC,eACA78F,eAXFwa,UAER,OAAIqE,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEQu9C,kBAERj+D,YACEqc,EACQqiF,EACA78F,GADA5B,KAAAy+F,iBACAz+F,KAAA4B,iBAER5B,KAAKoc,UAAYA,CACnB,CAEAs3B,kBACE,MAAM83F,EAAgBjkI,OAAO2jE,UAAUC,OACvCnrE,KAAKygB,IAAIm/E,eAAe/8F,UAAW4oI,IACjC,MAAMC,EAASnkI,OAAO2jE,UAAUC,OAEhC,IAAIqgE,GAAiBA,IAAkBE,GAAWD,EAMlD,GAHIzrI,KAAKg+D,mBACPh+D,KAAK4B,eAAenB,OAAOT,KAAKg+D,oBAE7BytE,GAAiBC,EAAQ,CAC5B,MAAMltE,EAAax+D,KAAK4B,eAAek9D,KACrC,iCACA,gCAEF9+D,KAAKg+D,kBAAoBQ,EAAWC,OACtC,SAAWgtE,EAAe,CACxB,MAAMjtE,EAAax+D,KAAK4B,eAAek9D,KACrC,kCACA,iCAEF9+D,KAAKg+D,kBAAoBQ,EAAWC,OACtC,KACD,EAEDx7C,KAAc,CACZjjB,KAAKy+F,eAAex+E,eACpBjgB,KAAKygB,IAAIm/E,eACT5/F,KAAKygB,IAAI0hC,UACRt/C,UAAWke,IAIZ/gB,KAAK2rI,wBAHU5qH,EAAM,GAAGkqD,WACFlqD,EAAM,GACbA,EAAM,GACqC,EAE9D,CAEQ6qH,mCACNF,EACAD,EACAhpF,IAEKipF,GAAUD,EACbhpF,EAAMgvB,cAAgB,GACbi6D,IAAWD,KACpBhpF,EAAMgvB,cAAgBhvB,EAAM5iD,QAAQ4xE,eAAiB8yC,IAEzD,CAEQonB,wBACND,EACAD,EACA3rF,GAEAA,EAAOvlC,QAASkoC,IACd,IAAIopF,EACJ,IAAIppF,EAAM0S,mBASV,IAJG1S,EAAM5iD,QAAQijD,eAA2CgpF,cAE1DD,EAA+BppF,EAAM5iD,QAAQijD,gBAE3C+oF,EAyBF,YADA7rI,KAAK4rI,mCAAmCF,EAAQD,EAAehpF,GAxB/B,CAChC,MAAMj/C,EAAOqoI,EAA6BroI,KAI1C,GAHa,QAATA,GACFi/C,EAAMpB,GAAGsC,YAAY9/C,WAElB6nI,GAAUD,EAAe,CAC5B,GAAI,CAAC,SAAU,WAAWzzG,SAASx0B,GACjC,OAEDi/C,EAAMpB,GAAGsC,YAAoBooF,OAC5BF,EAA6BC,YAEjC,SAAYJ,GAAWD,EAQrBzrI,KAAK4rI,mCAAmCF,EAAQD,EAAehpF,OAR3B,CACpC,GAAI,CAAC,SAAU,WAAWzqB,SAASx0B,GACjC,OAEDi/C,EAAMpB,GAAGsC,YAAoBooF,OAC5BF,EAA6BtpI,IAEjC,CAGF,CAIA,GAEJ,4CA/GWgpI,GAAmBnqI,MAAAuE,KAAAvE,MAAAwE,KAAAxE,MAAAyE,MAAA,+BAAnB0lI,EAAmBj9H,UAAA,0BAAAG,YAAA,WAAnB88H,CAAmB,iHCDzB,IAAMS,EAAiB,MAAxB,MAAOA,EACS/rI,OAApBF,YAAoBE,GAAAD,KAAAC,UAEhBD,KAAKC,OAAOG,UAAU,gBAAkB,IAC9Bma,QAASynC,IACnBA,EAAW07B,MAAQ17B,EAAW07B,MAAQ17B,EAAW07B,MAAQ17B,EAAW0nE,KACpE1pH,KAAKisI,mBAAmBjqF,EAAU,GAIpC,QAAS4oF,EAAU,EAAGA,EAAU,GAAIA,IAIlC5qI,KAAKisI,mBADoB,CAAEviB,KAFdkhB,EAAU,GAAK,YAAYA,IAAY,WAAWA,IAE9BsB,IADrB,mBAAmBtB,mCACOp6D,YAAQxuE,IAKhD,QAASgpI,EAAU,EAAGA,EAAU,GAAIA,IAAW,CAC7C,MAAMthB,EACJshB,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IACzD,IAAImB,EAEFA,EADEhxG,OAAO6vG,IAAY,GACd,GAAwB,EAAlB7vG,OAAO6vG,GACX7vG,OAAO6vG,IAAY,IACrB,GAA+B,GAAxB7vG,OAAO6vG,GAAW,KAEzB,KAA0B,EAAlB7vG,OAAO6vG,GAIxBhrI,KAAKisI,mBADoB,CAAEviB,OAAMwiB,IADrB,+BAA+BC,wFACL37D,YAAQxuE,GAEhD,CACF,CAMAiqI,mBAAmBjqF,GACjBygF,IAAM2J,KAAKpqF,EAAW0nE,KAAM1nE,EAAWkqF,KACvC1J,KAAiBC,KACbzgF,EAAWwuB,QACbC,KAAWzuB,EAAW0nE,MAAMtgB,UAAUpnD,EAAWwuB,OAErD,4CA7CWw7D,GAAiB5qI,MAAAuE,MAAA,iCAAjBqmI,EAAiB3qI,QAAjB2qI,EAAiB1qI,UAAAC,WAFhB,gBAEDyqI,CAAiB,kGCVxB,SAAUK,EAAQvF,GACtB,IAAIwF,GAAS,GAEb,GAAIxF,GADW,IACKA,EAAMwF,EACxB,OAAO,EACF,CAEL,IAAI1F,EAAO,EACX,KAAO16G,KAAK68G,IAAIjC,EAAMwF,GAAUC,GAC9BD,GAAkBC,EAClB3F,IAEF,OAAOA,CACT,CACF,CAMM,SAAU4F,EAAQ1F,GACtB,IAAIwF,GAAS,IAGT1F,EAAO,EACX,KAAO16G,KAAK68G,IAAIjC,EAAMwF,GAFL,GAGfA,GAHe,EAIf1F,IAEF,OAAOA,CACT,CAOM,SAAU6F,EACdC,GAEA,MAAM1B,EAAU0B,EAAuB1B,QACjCJ,EAAU8B,EAAuB9B,QAkBvC,MAjB+B,CAC7B+B,gBAC4C,IAA1CD,EAAuBC,eACzBC,OAAwC,IAAjCF,EAAuBE,MAC9BC,OAAwC,IAAjCH,EAAuBG,MAC9BC,aAAoD,IAAvCJ,EAAuBI,YACpCC,KAAoC,IAA/BL,EAAuBK,IAC5BC,KAAoC,IAA/BN,EAAuBM,IAC5BpC,QAAS,CACPqC,QAASrC,GAAWA,EAAQqC,QAAUrC,EAAQqC,QAAU,GACxDC,QAAStC,GAAWA,EAAQsC,QAAUtC,EAAQsC,QAAU,IAE1DlC,QAAS,CACPiC,QAASjC,GAAWA,EAAQiC,QAAUjC,EAAQiC,QAAU,EACxDC,QAASlC,GAAWA,EAAQkC,QAAUlC,EAAQkC,QAAU,IAI9D,CAOM,SAAUC,EAAettI,GAI7B,MAAMqlD,EAAOrlD,EAAQqlD,KACfkoF,EAAUvtI,EAAQutI,SAAW,IAE7BnkG,EAAS,IAAIC,WACnB,SAAOxpB,KACL,IAAIkvB,QAAiBC,IAEhBqW,EAAKl2B,KAAKmJ,cAAc89B,SAAS,aACjC/Q,EAAKl2B,KAAKmJ,cAAc89B,SAAS,UACjC/Q,EAAKl2B,KAAKmJ,cAAc89B,SAAS,SAMpChtB,EAAOgf,OAAUtc,IACf,GACEuZ,EAAKl2B,KAAKmJ,cAAc89B,SAAS,aACjC/Q,EAAKl2B,KAAKmJ,cAAc89B,SAAS,SAFnC,CAIE,MAAMo3E,EAAUp1G,KAAKC,MAAM+Q,EAAOI,QAClC,GAAIgkG,EAAQC,KAAKj2G,YAAYrI,KAAM,CACjC,MAAMszD,EACJ+qD,EAAQC,IAAIj2G,WAAWrI,KAAKkM,MAAM,uBACpC,OAAa,OAATonD,GAAiBA,EAAK14E,YACxBilC,EAAQyzC,EAAK,GAAG5pD,QAAQ,MAAO,WAG/BmW,EAAQ,iBAGZ,CACEA,EAAQ,iBAgBc,MAb1B,GAAWqW,EAAKl2B,KAAKmJ,cAAc89B,SAAS,QAAS,CAEnD,MAAMs3E,EADOtkG,EAAOI,OACW//B,MAAM,MACrC,QAASkkI,EAAO,EAAGA,GAAQJ,EAASI,IAAQ,CAC1C,MAAMlrD,EAAOirD,EAAMC,GAAMtyG,MAAM,kBAC/B,GAAa,OAATonD,GAAiBA,EAAK14E,OAAQ,CAChCilC,EAAQyzC,EAAK,IACb,KACF,CACEzzC,OAAQ7sC,EAEZ,CACF,MACE6sC,EAAQ,iBAAgB,EAG5B5F,EAAOof,WAAWnD,EAAM,UAxCtBrW,EAAQ,iBAwCqB,GAGrC,wFCpHO,IAAM4+F,EAAqB,MAA5B,MAAOA,EAIFhtH,IAKDq/B,OAKA4tF,KAKAC,KAKAC,cAAwB,EAKxBC,eAKAC,eAAiB9tI,KAAK+tI,UAAUpzD,KAAK36E,MAE7CD,cAAe,CAMf2zC,kBACE1zC,KAAKguI,kBACLhuI,KAAK6tI,eAAiB7tI,KAAKygB,IAAIuhH,cAAcn/H,UAAW6D,IACtDA,EAAQ1G,KAAKiuI,eAAiBjuI,KAAKkuI,iBAAe,GAEpDluI,KAAKowH,SACP,CAMAliH,cACElO,KAAK6tI,eAAe1/H,cACpBnO,KAAKygB,IAAIuhH,cAAc7zH,cACvBnO,KAAKkuI,iBACP,CAKAD,eACMjuI,KAAKmuI,UACPnuI,KAAKmuI,QAAQh4H,MAAMg6G,WAAa,WAElCnwH,KAAK8/C,OAAOr/B,IAAKgiC,GAAUA,EAAMpB,GAAG/R,GAAG,YAAatvC,KAAK8tI,iBACzD9tI,KAAK8/C,OAAOr/B,IAAKgiC,GAAUA,EAAMpB,GAAG/R,GAAG,aAActvC,KAAKouI,aAC1DpuI,KAAKygB,IAAI4gC,GAAG4nE,QACd,CAKAilB,kBACMluI,KAAKmuI,UACPnuI,KAAKmuI,QAAQh4H,MAAMg6G,WAAa,UAElCnwH,KAAK8/C,OAAOr/B,IAAKgiC,GAAUA,EAAMpB,GAAG8nE,GAAG,YAAanpH,KAAK8tI,iBACzD9tI,KAAK8/C,OAAOr/B,IAAKgiC,GAAUA,EAAMpB,GAAG8nE,GAAG,aAAcnpH,KAAKouI,aAC1DpuI,KAAKygB,IAAI4gC,GAAG4nE,SACZjpH,KAAK8/C,OAAS,EAChB,CAKA,WAAIquF,GACF,OAAO7lI,SAAS4nH,eAAe,kBACjC,CAKA8d,kBACEhuI,KAAKygB,IAAIwhH,kBAAkBp/H,UAAWi9C,IAEpC,GADA9/C,KAAK8/C,OAAS,GACC,OAAXA,EACF,UAAW2C,KAAS3C,EACb9/C,KAAK8/C,OAAO9nB,SAASyqB,IACxBziD,KAAK8/C,OAAOx4C,KAAKm7C,EAAK,EAKhC,CAKA4rF,SAAS3kH,GACP1pB,KAAK4tI,cAAe,EACpBlkH,EAAM2E,iBACa,cAAf3E,EAAMlmB,MACRxD,KAAK2tI,KAAOjkH,EAAM4kH,QAClBtuI,KAAKuuI,aACLjmI,SAASkmI,UAAYxuI,KAAKyuI,uBACF,eAAf/kH,EAAMlmB,OACf8E,SAAS4nH,eAAe,UAAU/5G,MAAMg6G,WAAa,SACrDnwH,KAAK2tI,KAAOjkH,EAAMglH,QAAQ,GAAGJ,QAC7BtuI,KAAK2uI,aACLrmI,SAASsmI,WAAa5uI,KAAK6uI,sBAE/B,CAKAN,aACEjmI,SAASm4F,iBAAiB,YAAc/2E,IAClC1pB,KAAK4tI,eACPlkH,EAAM2E,iBACNruB,KAAK0tI,KAAO1tI,KAAK2tI,KAAOjkH,EAAM4kH,QAC9BtuI,KAAK2tI,KAAOjkH,EAAM4kH,QAClBtuI,KAAKmuI,QAAQh4H,MAAMmiH,KAAOt4H,KAAKmuI,QAAQW,WAAa9uI,KAAK0tI,KAAO,MAElE1tI,KAAKygB,IAAI4gC,GAAG4nE,QAAM,EAEtB,CAKA0lB,aACErmI,SAASm4F,iBAAiB,YAAc/2E,IAClC1pB,KAAK4tI,eACPlkH,EAAM2E,iBACN/lB,SAAS4nH,eAAe,UAAU/5G,MAAMg6G,WAAa,SACrDnwH,KAAK0tI,KAAO1tI,KAAK2tI,KAAOjkH,EAAMqlH,eAAe,GAAGT,QAChDtuI,KAAK2tI,KAAOjkH,EAAMqlH,eAAe,GAAGT,QACpCtuI,KAAKmuI,QAAQh4H,MAAMmiH,KAAOt4H,KAAKmuI,QAAQW,WAAa9uI,KAAK0tI,KAAO,MAElE1tI,KAAKygB,IAAI4gC,GAAG4nE,QAAM,EAEtB,CAKAwlB,wBACEnmI,SAASkmI,UAAY,KACrBlmI,SAAS0mI,YAAc,KACvBhvI,KAAK4tI,cAAe,CACtB,CAKAiB,wBACEvmI,SAASsmI,WAAa,KACtBtmI,SAAS2mI,YAAc,KACvB3mI,SAAS4nH,eAAe,UAAU/5G,MAAMg6G,WAAa,UACrDnwH,KAAK4tI,cAAe,CACtB,CAKAG,UAAUrkH,GACR,MAAM3a,EAAM2a,EAAMo0B,QACZoxF,EAAUlvI,KAAKygB,IAAI4gC,GAAGs3E,UACtBz5F,EAAQl/B,KAAKmuI,QAAQW,WACrBK,KAAKC,MAAe1lH,EAAO,CAACwV,EAAO,IACnCmwG,KAAKD,MAAe1lH,EAAO,CAAC,EAAG,IAC/BqiG,KAAKqjB,MAAe1lH,EAAO,CAACwV,EAAOgwG,EAAQ,KAC3CI,KAAKF,MAAe1lH,EAAO,CAAC,EAAGwlH,EAAQ,KAC7CngI,EAAIy9C,OACJz9C,EAAIwgI,YACJxgI,EAAIygI,OAAOL,EAAG,GAAIA,EAAG,IACrBpgI,EAAI0gI,OAAO1jB,EAAG,GAAIA,EAAG,IACrBh9G,EAAI0gI,OAAOH,EAAG,GAAIA,EAAG,IACrBvgI,EAAI0gI,OAAOJ,EAAG,GAAIA,EAAG,IACrBtgI,EAAI2gI,YACJ3gI,EAAI4gI,MACN,CAKAvB,WAAW1kH,GACTA,EAAMo0B,QAAQ8xF,UACdlmH,EAAMo0B,QAAQ0O,MAChB,CAKQ4jE,UACN9nH,SAAS4nH,eAAe,mBAAmBzvB,iBACzC,QACC/2E,IACCA,EAAM2mG,OAAS,EACXrwH,KAAKygB,IAAIyhC,eAAeouE,UACxBtwH,KAAKygB,IAAIyhC,eAAequE,QAAM,GAEpC,EAEJ,4CA1NWkd,EAAqB,+BAArBA,EAAqBn/H,UAAA,wBAAAC,OAAA,CAAAkS,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,gOAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IClBlC1N,MAAA,WAMEA,MAHA,qBAAAqW,GAAA,OAAa1I,EAAAs/H,SAAA52H,EAAgB,EAG7BrW,CAH8B,4BACnB2N,EAAA0/H,uBAAuB,EAElCrtI,CAFmC,sBAAAqW,GAAA,OACrB1I,EAAAs/H,SAAA52H,EAAgB,EAC9BrW,CAD+B,6BACnB2N,EAAA8/H,uBAAuB,GAEnCztI,MAAA,WAEAA,MAAA,WAEEA,MADA,UACAA,CADkC,WAGtCA,snCDIaqsI,CAAqB,6LEkB3B,IAAMoC,EAAuB,MAA9B,MAAOA,EAcS1zF,eAbX5wC,MAAgB,UACzB,WACIolC,GACF,OAAO3wC,KAAKm8C,eAAej8C,IAAI,kBACjC,CACA,WAAIywC,CAAQjqC,GACV1G,KAAKm8C,eAAe97C,IAAI,kBAAmBqG,EAC7C,CAEQopI,QACC7hB,MAAiC,IAAIlsH,IAAgB,WACvD80B,SAAU,EAEjB92B,YAAoBo8C,GAAAn8C,KAAAm8C,iBAClBn8C,KAAK8vI,QAAU,IAAIC,KACWC,KAAUC,UAAU,CAChDC,GAAI,KACJC,KAAM,MACNC,OAAQ,MACRC,QAAS,KACTC,MAAO,MACPC,OAAQ,SAGRvwI,KAAKwwI,kBACLxwI,KAAK2wC,SAAU,EACfppC,OAAOk5F,iBAAiB,OAAQ,KAC9BzgG,KAAKwwI,kBACLxwI,KAAK2wC,SAAU,KAGnB3wC,KAAK2wC,QAAU3wC,KAAKywI,iBAAmBzwI,KAAKwwI,iBAC9C,CAQQC,iBACNzwI,KAAK8vI,QAAQ1tG,SACbpiC,KAAK2wC,SAAU,EACf3wC,KAAKiuH,MAAMtrH,KAAK,cAClB,CAIQ6tI,kBACNxwI,KAAK8vI,QAAQ32G,UACbn5B,KAAK2wC,SAAU,EACf3wC,KAAKiuH,MAAMtrH,KAAK,UAClB,CAEA+tI,iBACM1wI,KAAK2wC,QACP3wC,KAAKwwI,kBAELxwI,KAAKywI,gBAET,4CA7DWZ,GAAuBzuI,MAAAuE,MAAA,+BAAvBkqI,EAAuBvhI,UAAA,2BAAAC,OAAA,CAAAhD,MAAA,QAAAolC,QAAA,WAAAliC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,yHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICnClC1N,MADF,UACEA,CAD0C,wDAUxCA,MAAA,0BAAS2N,EAAA2hI,gBAAgB,GAEzBtvI,MAAA,cAAUA,MAAA,oBAEdA,mBAZIA,QAEAA,MAFA,QAAA2N,EAAAxD,MAEAnK,CAFe,aAAA2N,EAAA4hC,QAAAvvC,MAAA,4CAAAA,MAAA,yCAULA,MAAA,GAAAA,YAAA,IAAA2N,EAAAk/G,wBDOV1+G,KAAe3J,KACfyJ,KAAgBxJ,KAChB2J,KAAa1J,KACb4J,KACAC,KAAiB5J,MAAA8J,OAAA,qeAaRggI,CAAuB,8JEpB7B,IAAMc,EAAmB,MAA1B,MAAOA,EACFlwH,IAEAlV,MAET,QAAIu2C,GACF,OAAO9hD,KAAKygB,IAAIyhC,eAAeH,SACjC,CAEA,WAAIkqE,GACF,OAAOjsH,KAAKygB,IAAIyhC,eAAe6qE,OAAO6jB,cAAgB,CACxD,CAEA,WAAI5kB,GACF,OAAOhsH,KAAKygB,IAAIyhC,eAAe6qE,OAAO8jB,YACxC,CAEA9wI,cAAe,4CAjBJ4wI,EAAmB,+BAAnBA,EAAmBriI,UAAA,sBAAAC,OAAA,CAAAkS,IAAA,MAAAlV,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,+HAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICf9B1N,MADF,UACEA,CADqC,mCAOnCA,MAAA,0BAAS2N,EAAA0R,IAAAyhC,eAAAquE,QAA2B,GAEpCnvH,MAAA,cAAUA,MAAA,SACZA,UAEAA,MAAA,mCAMEA,MAAA,0BAAS2N,EAAA0R,IAAAyhC,eAAAouE,SAA4B,GAErClvH,MAAA,cAAUA,MAAA,YAEdA,mBAnBIA,QAGAA,MAHA,aAAAA,MAAA,gCAAAA,MAAA,GAAAoW,EAAAzI,EAAA+yC,KAAA,IAGA1gD,CAH0E,QAAA2N,EAAAxD,MAG1EnK,CADe,WAAA2N,EAAA+yC,MAAA/yC,EAAAi9G,SASf5qH,MAAA,GAGAA,MAHA,aAAAA,MAAA,iCAAAA,MAAA,GAAAoW,EAAAzI,EAAA+yC,KAAA,IAGA1gD,CAH2E,QAAA2N,EAAAxD,MAG3EnK,CADe,WAAA2N,EAAA+yC,MAAA/yC,EAAAk9G,yBDFP18G,KAAe5J,KAAE0J,KAAgBzJ,KAAE4J,KAAa3J,KAAE8J,KAAiB7J,MAAA+J,OAAA,+sBAElE8gI,CAAmB,8PECzB,IAAMG,EAAiB,MAAxB,MAAOA,EAIX13H,UACE1S,EACAouF,EACAi8C,GAAoB,EACpBxH,EAAkB,GAElB,IAAIyH,EACJ,OAAIxqI,OAAOmV,OAAOs1H,MAAiBvoI,QAAQosF,IAA4B,EACrEk8C,KAAME,MAAmBxqI,EAAOouF,GAEhCtuF,OAAOmV,OAAOw1H,MAAmBzoI,QAAQosF,IAA8B,IAEvEk8C,KAAMI,MAAa1qI,EAAOouF,IAGrBk8C,MACHK,MAAcL,EAAK,CACjBzH,QAAS,EACTz0C,OACAi8C,WACAvrI,OAAQ,MAGhB,4CA3BWsrI,EAAiB,qDAAjBA,EAAiBv3H,MAAA,EAAA9K,YAAA,WAAjBqiI,CAAiB,4YCZtB1vI,MAHN,YAGMA,CAHgD,UAGhDA,CAFG,OAEHA,CADE,UAEAA,MAAA,wBAGNA,YAGIA,MAFJ,UAEIA,CAFG,OAEHA,CADE,QACEA,MAAA,6BAA2DA,QAC/DA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SAEAA,MAAA,8BACFA,QACAA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,8BAA0DA,QAC9DA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,8BAAyDA,QAC7DA,MAAA,SAAIA,MAAA,0BAGVA,sCAxBQA,MAAA,GAAAA,MAAA,IAAAA,MAAA,gDAMEA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA2F,OAAA6e,GAAA6oH,kBAAAC,SACAnwI,MAAA,GAAAA,YAAA,gDAIFA,MAAA,GAAAA,MAAA,IAAAA,MAAA,MAAAqnB,GAAAxkB,KAAA2F,OAAA6e,GAAA6oH,kBAAAE,YAAA,KAEEpwI,MAAA,GAAAA,YAAA,oDAGAA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA2F,OAAA6e,GAAA6oH,kBAAAG,QACArwI,MAAA,GAAAA,YAAA,+CAGAA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA2F,OAAA6e,GAAA6oH,kBAAAI,OACAtwI,MAAA,GAAAA,YAAA,2EAQJA,MAHN,YAGMA,CAH8C,UAG9CA,CAFG,OAEHA,CADE,UAEAA,MAAA,wBAGNA,YAGIA,MAFJ,UAEIA,CAFG,OAEHA,CADE,QACEA,MAAA,6BAA6DA,QACjEA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SAEAA,MAAA,8BACFA,QACAA,MAAA,SACEA,MAAA,0BAEJA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,8BAA4DA,QAChEA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,8BAAsDA,QAC1DA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,8BAAyDA,QAC7DA,MAAA,SAAIA,MAAA,0BACNA,UAEEA,MADF,QACEA,CADE,SACEA,MAAA,0BAA4DA,QAChEA,MAAA,SAAIA,MAAA,8BAGVA,sCAlCQA,MAAA,GAAAA,MAAA,IAAAA,MAAA,+CAMEA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA0tI,KAAAlpH,GAAAmpH,gBAAAC,eACAzwI,MAAA,GAAAA,YAAA,oDAIFA,MAAA,GAAAA,MAAA,IAAAA,MAAA,MAAAqnB,GAAAxkB,KAAA0tI,KAAAlpH,GAAAmpH,gBAAAE,kBAAA,KAGA1wI,MAAA,GAAAA,MAAA,IAAAA,MAAA,4DAIEA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA0tI,KAAAlpH,GAAAmpH,gBAAAG,cACA3wI,MAAA,GAAAA,YAAA,mDAGAA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA0tI,KAAAlpH,GAAAmpH,gBAAAI,QACA5wI,MAAA,GAAAA,YAAA,6CAGAA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAA0tI,KAAAlpH,GAAAmpH,gBAAAK,WACA7wI,MAAA,GAAAA,YAAA,gDAGAA,MAAA,GAAAA,YAAA,mDACAA,MAAA,GAAAA,YAAA,MAAAqnB,GAAAxkB,KAAAiuI,UAAAzpH,GAAA6oH,kBAAAC,UCvCL,IAAMY,EAAuB,MAA9B,MAAOA,GAMFv6H,UACyB3T,KANlC2tI,gBAAkBX,KAElBK,kBAAoBH,KAEpBpxI,YACS6X,GACyB3T,IADzBjE,KAAA4X,aACyB5X,KAAAiE,OAC/B,CAEHmuI,YACEpyI,KAAK4X,UAAUK,OACjB,8CAZWk6H,IAAuB/wI,MAAAuE,MAAAvE,MAOxBglC,MAAe,+BAPd+rG,GAAuB7jI,UAAA,0BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6HAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD5BpC1N,MAAA,UAAqBA,MAAA,wBAAgDA,QACrEA,MAAA,WA+BEA,MA9BA,EAAAixI,EAAA,gBA8BAjxI,CA9BsD,EAAAkxI,EAAA,iBAqExDlxI,gBAvEqBA,oBAAA,qCAEXA,MAAA,GAAAA,MAAA,OAAA2N,GAAA9K,KAAA2F,OAAA,GA8BAxI,cAAA,OAAA2N,GAAA9K,KAAA0tI,KAAA,mBCXNz5H,KACAC,KACAhJ,KACAQ,KAAiB/J,KACjBkrI,KAAiBjhI,OAAA,+SAGRsiI,EAAuB,iFCbhC/wI,MAAA,kBACEA,MAAA,wBACFA,qCAFqDA,MAAA,QAAAmxI,IACnDnxI,cAAA,IAAAA,MAAA,uBAAAmxI,IAAA,MCiCC,IAAMC,EAAqB,MAA5B,MAAOA,GAKJC,SAAoC,IAAI1wI,SAAgBC,GAMxD0wI,UAKEC,YAKAC,YAKT,WACIC,CAAQnsI,IACV1G,KAAKyyI,SAAS9vI,KAAK+D,GACrB,CACA,WAAImsI,GACF,OAAO7yI,KAAKyyI,SAAS/rI,KACvB,CAKA,QACIosI,CAAKpsI,IACP1G,KAAK+yI,eAAersI,GACtB,CACA,QAAIosI,GACF,OAAO9yI,KAAKgzI,KACd,CACQA,OAAiB,EAKhB3pH,YAKC4pH,kBAAoB,IAAI3lI,MAQlC,gBAAI4lI,GACF,OACS1sI,OAAOmV,OADZ3b,KAAK2yI,cAAgBQ,KAAYC,KACdnC,KAEFE,KACvB,CAEApxI,cAAe,CAMfmO,cACElO,KAAK+yI,gBAAe,EACtB,CAMAM,oBAAoBv+C,IAClB90F,KAAK4yI,YAAc99C,GACnB90F,KAAKizI,kBAAkB7kI,KAAK0mF,GAC9B,CAEQi+C,eAAe97H,SACEjV,IAAnBhC,KAAK0yI,WACP1yI,KAAK0yI,UAAUvkI,eAEF,IAAX8I,KACFjX,KAAK0yI,UAAY1yI,KAAKyyI,SAAS5vI,UAAWgwI,KACxC7yI,KAAKszI,uBAAuBT,GAAO,IAGvC7yI,KAAKgzI,MAAQ/7H,EACf,CAEQq8H,uBAAuBT,IAC7B,IAAID,GAAc5yI,KAAK4yI,YACnB5yI,KAAK2yI,cAAgBQ,KAAYC,KACnCR,MAAcW,MAAoBV,IACzB7yI,KAAK2yI,cAAgBQ,KAAYK,SAC1CZ,MAAca,MAAsBZ,KAElCD,KAAgB5yI,KAAK4yI,aACvB5yI,KAAKqzI,oBAAoBT,GAE7B,8CA9GWJ,GAAqB,+BAArBA,GAAqBlkI,UAAA,wBAAAC,OAAA,CAAAokI,YAAA,cAAAC,YAAA,cAAAC,QAAA,UAAAC,KAAA,OAAAzpH,YAAA,eAAA7a,QAAA,CAAAykI,kBAAA,qBAAAxkI,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,kMAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KDhDhC1N,MADF,qBACEA,CADwD,eAC7CA,MAAA,GAAiBA,QAC5BA,MAAA,uDAMFA,QAEEA,MADF,qBACEA,CADiC,kBAI/BA,MAAA,2BAAAqW,IAAA,OAAmB1I,GAAAskI,oBAAA57H,GAAA/Q,MAAiC,GAEpDtF,MAAA,EAAAsyI,EAAA,oBAIJtyI,kBAlBaA,MAAA,GAAAA,MAAA2N,GAAAsa,aAGTjoB,QAEAA,MAFA,cAEAA,CAFiB,cAEjBA,CADiB,QAAAA,MAAA,IAAAA,MAAA,IAAA2N,GAAA0jI,WAAA,EAAA1jI,GAAA6jI,cAMjBxxI,MAAA,GACAA,MADA,QAAA2N,GAAA6jI,YACAxxI,CADqB,WAAA2N,GAAA+jI,MAIe1xI,cAAA,UAAA2N,GAAAmkI,8BCwBpCjpH,KAAkBtkB,UAClBk3B,KAAcj3B,KACdskB,KAAerkB,KAAAC,KACf2O,KACA0V,KACAza,KACAC,KAAiB5J,KACjB+qI,KAAiBjhI,OAAA,+SAAAC,gBAAA,WAGR0iI,EAAqB,gDCxB9BpxI,MAAA,8DAEAA,MAAA,wBAIEA,MAAA,kBAAAqW,IAAArW,MAAAqgC,IAAA,MAAAC,GAAAtgC,QAAA,OAAAA,MAAUsgC,GAAAiyG,qBAAAl8H,GAAAoW,SAAoC,GAE9CzsB,MAAA,wBACFA,kCAJEA,MADA,UAAAsgC,GAAAkyG,aACAxyI,CADwB,0BAIxBA,cAAA,IAAAA,MAAA,yEAGFA,MAAA,8DAEAA,MAAA,wBAIEA,MAAA,kBAAAqW,IAAArW,MAAAkP,IAAA,MAAAoxB,GAAAtgC,QAAA,OAAAA,MAAUsgC,GAAAmyG,wBAAAp8H,GAAAoW,SAAuC,GAEjDzsB,MAAA,wBACFA,kCAJEA,MADA,UAAAsgC,GAAAoyG,gBACA1yI,CAD2B,0BAI3BA,cAAA,IAAAA,MAAA,gGAGFA,MAAA,wBAIEA,MAAA,kBAAAqW,IAAArW,MAAAmrD,IAAA,MAAA7qB,GAAAtgC,QAAA,OAAAA,MAAUsgC,GAAAqyG,qBAAAt8H,GAAAoW,SAAoC,GAE9CzsB,MAAA,wBACFA,kCAJEA,MADA,UAAAsgC,GAAAsyG,aACA5yI,CADwB,0BAIxBA,cAAA,IAAAA,MAAA,yEAGFA,MAAA,8DAYAA,MAAA,+CAeEA,MAAA,6BAAAqW,IAAArW,MAAA2P,IAAA,MAAA2wB,GAAAtgC,MAAA,UAAAA,MAAqBsgC,GAAAuyG,mBAAAx8H,IAAgC,GAEvDrW,kDAREA,MAJA,cAAAsgC,GAAAixG,YAAAa,OAIApyI,CAJkC,cAAAsgC,GAAAwyG,iBAIlC9yI,CAHgC,UAAA+yI,GAAAvqI,OAGhCxI,CAF0B,OAAAsgC,GAAA0yG,iBAE1BhzI,CADyB,cAAAA,MAAA,IAAAsgC,GAAA2yG,oBAAA3yG,GAAAixG,YAAAS,KAAA,qGAW3BhyI,MAAA,+CAOEA,MAAA,6BAAAqW,IAAArW,MAAA8tB,IAAA,MAAAwS,GAAAtgC,MAAA,UAAAA,MAAqBsgC,GAAA4yG,iBAAA78H,IAA8B,GAErDrW,kDAHEA,MAJA,cAAAsgC,GAAAixG,YAAAS,KAIAhyI,CAJgC,cAAAsgC,GAAA6yG,eAIhCnzI,CAH8B,UAAA+yI,GAAAxC,KAG9BvwI,CAFwB,OAAAsgC,GAAA0yG,iBAExBhzI,CADyB,cAAAA,MAAA,2DAzB7BA,MAAA,GAoBEA,MAnBA,EAAAozI,GAAA,2BAmBApzI,CAHC,EAAAqzI,GAAA,4DAfErzI,cAAA,OAAAsgC,GAAA2yG,oBAAA3yG,GAAAixG,YAAAa,QAAA9xG,GAAA2yG,oBAAA3yG,GAAAixG,YAAAS,MAmBAhyI,cAAA,OAAAsgC,GAAA2yG,oBAAA3yG,GAAAixG,YAAAS,gCAWLhyI,MAAA,8DAGEA,MAAA,qDAMEA,MAAA,mBAAAA,MAAAurD,IAAA,MAAAjrB,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAgzG,mBAAkB,GAE3BtzI,MAAA,cAAUA,MAAA,eACZA,oCALEA,MADA,aAAAA,MAAA,mDACAA,CADwE,eAAAA,MAAA,IAAAsgC,GAAAugG,mBAAAr4H,sDAQ1ExI,MAAA,qDAMEA,MAAA,mBAAAA,MAAAsQ,IAAA,MAAAgwB,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAizG,gBAAe,GAExBvzI,MAAA,cAAUA,MAAA,YACZA,oCALEA,MADA,aAAAA,MAAA,gDACAA,CADqE,eAAAA,MAAA,IAAAsgC,GAAAugG,mBAAAr4H,SCfpE,IAAMgrI,GAAiB,MAAxB,MAAOA,GA0NDjzI,gBACA2W,OACA6jC,eACkB7zC,SAxNrBusI,cAECliB,gBAAkC,GAMnCggB,YAAcQ,KAMdvB,gBAAkBX,KAMlBK,kBAAoBH,KAMpBiD,kBAA4B,EAM5BN,iBAA2B,EAM3BF,cAAwB,EAMxBI,cAAwB,EAMxBc,SAAqC,IAAI/yI,KAAgB,GAMzDgzI,SAAqC,IAAIhzI,KAAgB,GAMzD0wI,SAAqC,IAAI1wI,IAAgB,IAMzDkgI,kBACL,IAAIlgI,IAAgB,IAMfizI,cAAwB,EAMxBC,uBAAiC,EAKhCC,gBAKAC,mBAKAC,cAKAC,iBAKDnB,iBAAsC/C,KAAkBI,OAKxDgD,eAAkCtD,KAAgBY,aAKjDyD,kBAKAC,oBAMAC,kBAKAC,YAKAC,UAKAC,cAKAC,cAKAC,YAKAC,gBAKAC,mBAKAC,aAAe,IAAI99B,IAKlBz3F,IAKAvQ,MAMT,qBACImkI,CAAkB3tI,IACpB1G,KAAKi2I,qBAAqBvvI,GAC5B,CACA,qBAAI2tI,GACF,OAAOr0I,KAAKk2I,kBACd,CACQA,mBAMCC,iBAA2B,GAEEx/C,MAMtC,uBAAIy/C,GACF,YAAkCp0I,IAA3BhC,KAAKw1I,iBACd,CAEA,cAAIxzF,GACF,OAAOhiD,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,SAC/C,CAEA1hD,YACU4B,GACA2W,GACA6jC,GACkB7zC,IAHlBtI,KAAA2B,mBACA3B,KAAAsY,UACAtY,KAAAm8C,kBACkBn8C,KAAAsI,YAE1BtI,KAAK60I,cAAgB,CACnBnoH,WAAW,EACXyB,YAAY,EACZ2I,mBAAmB,EACnBtU,MAAM,EACNmU,QAAS,CACP,CACE3H,KAAM,SACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,gCAEFxoB,cAAgBs5G,KACd,MAAM7oC,GAAO90F,KAAKk0I,iBACZrB,MAAUzB,MACdzT,GAAatmG,WAAWw7G,QAAQjpI,OAChCkrF,IAEF,SAAOu8C,MAAcwB,GAAS,CAC5BtJ,QAAS,EACTz0C,QACAi8C,UAAU,EACVvrI,OAAQ,MACT,GAGL,CACEwpB,KAAM,OACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,8BAEFxoB,cAAgBs5G,KACd,MAAM7oC,GAAO90F,KAAKu0I,eACZ1B,MAAU3B,MACdvT,GAAatmG,WAAWw7G,QAAQlB,KAChC78C,IAEF,OAAO+9C,MACHxB,MAAcwB,GAAS,CACrBtJ,QAAS,EACTz0C,QACAi8C,UAAU,EACVvrI,OAAQ,OAEV,MAKd,CAMA+H,WACEvN,KAAKq2I,gBACLr2I,KAAKw2C,YACLx2C,KAAKs2I,wBACLt2I,KAAKu2I,2BACLv2I,KAAKw2I,sBACLx2I,KAAKy2I,oBACLz2I,KAAK02I,yBAAyB12I,KAAKkQ,MAAMuT,OAAO49B,IAChDrhD,KAAK22I,0BACL32I,KAAKi2I,qBAAqB9C,KAAYK,OACxC,CAMAtlI,cACElO,KAAKi2I,0BAAqBj0I,GAC1BhC,KAAK42I,0BACL52I,KAAK62I,cACL72I,KAAK2yH,gBAAgBlyG,IAAK7E,IAAMA,GAAEzN,cACpC,CAMA2oI,oBAAoBnE,IAClB3yI,KAAKq0I,kBAAoB1B,EAC3B,CAMAoE,oBAAoB9/H,KACH,IAAXA,GACFjX,KAAKy2I,oBAELz2I,KAAKg3I,uBAET,CAMAC,yBAAyBhgI,IACvBjX,KAAKo0I,iBAAmBn9H,EAC1B,CAMA48H,wBAAwB58H,IACtBjX,KAAK8zI,gBAAkB78H,GACvBjX,KAAKk3I,oBAEDl3I,KAAKm8C,eAAe97C,IAAI,mBAD5B4W,GACoDrQ,KAAaulE,QAEnE,CAMAwnE,qBAAqB18H,IACnBjX,KAAK4zI,aAAe38H,GACpBjX,KAAKm3I,iBAEDn3I,KAAKm8C,eAAe97C,IAAI,gBAD5B4W,GACiDrQ,KAAaulE,QAEhE,CAMA4nE,qBAAqB98H,IACnBjX,KAAKg0I,aAAe/8H,GACpBjX,KAAKo3I,iBAEDp3I,KAAKm8C,eAAe97C,IAAI,gBAD5B4W,GACiDrQ,KAAaulE,QAEhE,CAMAwqE,2BACoD,IAA9C32I,KAAKm8C,eAAej8C,IAAI,oBAC1BF,KAAK8zI,iBAAkB,IAEsB,IAA3C9zI,KAAKm8C,eAAej8C,IAAI,iBAC1BF,KAAK4zI,cAAe,IAEyB,IAA3C5zI,KAAKm8C,eAAej8C,IAAI,iBAC1BF,KAAKg0I,cAAe,EAExB,CAMAkD,oBACE,MAAMG,GACJr3I,KAAKsI,SAASgvI,uBACZ,6CAEAt3I,KAAK8zI,gBACPv4H,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUltC,OAAO,2BAGzB8a,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUC,IAAI,0BAG1B,CAMAupG,iBACE,MAAME,GACJr3I,KAAKsI,SAASgvI,uBACZ,yCAGAt3I,KAAK4zI,aACPr4H,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,KACxBA,GAAMinC,UAAUltC,OAAO,yBAAwB,GAGjD8a,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,KACxBA,GAAMinC,UAAUC,IAAI,yBAAwB,EAGlD,CAMAwpG,iBACE,MAAMC,GACJr3I,KAAKsI,SAASgvI,uBAAuB,gCAEnCt3I,KAAKg0I,aACPz4H,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUltC,OAAO,2BAGzB8a,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUC,IAAI,0BAG1B,CAMAqmG,mBAAmBn/C,IACjB90F,KAAKk0I,iBAAmBp/C,GACxB90F,KAAKu3I,mBACLv3I,KAAKw3I,wBACP,CAMAlD,iBAAiBx/C,IACf90F,KAAKu0I,eAAiBz/C,GACtB90F,KAAKu3I,mBACLv3I,KAAKw3I,wBACP,CAEQA,yBACNx3I,KAAKkQ,MAAMwU,UAAU5d,QAErB9G,KAAK02I,yBAAyB12I,KAAKkQ,MAAMuT,OAAO49B,SAClBr/C,IAA1BhC,KAAKq1I,kBACPr1I,KAAKy3I,2BAA2Bz3I,KAAKq1I,iBAEzC,CAEAX,mBACE,MAAMnqI,GAAWvK,KAAKiiI,kBAAkBv7H,MAClCirI,GAAOpnI,GAAS2V,OACpB,CAACw3H,GAAa/Z,KACL+Z,GAAM/Z,GAAatmG,WAAWw7G,QAAQlB,MAAQ,EAEvD,GAEI/nI,GAASW,GAAS2V,OACtB,CAACw3H,GAAa/Z,KACuB,YAA/BA,GAAar0C,SAAS9lF,KACjBk0I,GAEFA,GAAM/Z,GAAatmG,WAAWw7G,QAAQjpI,QAAU,EAEzD,GAEIsoI,GAAY3nI,GAAS2V,OACzB,CAACw3H,GAAa/Z,KACuB,eAA/BA,GAAar0C,SAAS9lF,KACjBk0I,GAEFA,GAAM/Z,GAAatmG,WAAWw7G,QAAQjpI,QAAU,EAEzD,GAGF5J,KAAK23I,WAAW,CACdhG,QACA/nI,UACAsoI,cAEJ,CAEAyC,gBACE30I,KAAKkQ,MAAMiW,WAAWnmB,KAAKiiI,kBAAkBv7H,OAC7C1G,KAAKiiI,kBAAkBv7H,MAAM6T,QAASq9H,KACpC53I,KAAKg2I,aAAa7xF,cAAc5pC,QAASs9H,KACvC,MAAMvuD,GAAWuuD,GAAoB1qD,cACjCyqD,GAAgBvgH,WAAWnlB,KAAOo3E,GAASszC,QAC7C58H,KAAKg2I,aAAan5D,cAAcg7D,GAAmB,EAEtD,EAEL,CAEAC,gBACE,GAA4C,IAAxC93I,KAAKiiI,kBAAkBv7H,MAAMkD,OAIjC,IAAkC,IAA9B5J,KAAKo1I,cAAcztH,OACrB3nB,KAAK42I,0BACL52I,KAAKy2I,wBACA,CACL,MAAM9Y,GAAe39H,KAAKiiI,kBAAkBv7H,MAAM,GAE5CimF,GADa3sF,KAAKkQ,MAAMuyC,MAAMpB,GAAGsC,YAAYQ,cACtB/hC,KAAM21H,IAC1BA,GAAW73I,IAAI,QAAUy9H,GAAatmG,WAAWnlB,IAG1D,QAAkBlQ,IAAd2qF,GAAyB,CAC3B3sF,KAAKg3I,wBACLh3I,KAAKg4I,wBAEL,MAAM90C,GAAavW,GAAUQ,cAC7BntF,KAAKi4I,0BAA0B/0C,IAC/BljG,KAAKo1I,cAAcl6B,cAAchY,GACnC,CACF,CACF,CAEQy0C,WAAW1zI,IACjBjE,KAAKsY,OAAOC,KAAK45H,EAAyB,CAAEluI,SAC9C,CAMQuyC,YACN,MAAMtmC,GAAQlQ,KAAKkQ,MAEbuyC,GAAQ,IAAIsZ,KAAY,CAC5BnwD,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,8BAEFsoB,oBAAoB,EACpBjjD,GAAI,mBAAgByQ,UACpB6/B,OAAQ,IACR/+B,OAAQ,IAAIq4C,KACZ3lD,SAAO+hI,QACPvuF,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,EACX5gD,UAAW,CAAE9J,SAAS,MAExB2qD,QAAkBprF,GAAOuyC,IACzBvyC,GAAMuyC,MAAM5rB,SAAU,EACtB4rB,GAAMoiE,SAAShiH,UAAWg0B,KACxB,MAAMwgH,GACJr3I,KAAKsI,SAASgvI,uBAAuB,2BAEnCzgH,GACFtb,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUltC,OAAO,uCAGzB8a,MAAMmE,KAAK23H,IAAU52H,IAAK/Z,IACxBA,GAAMinC,UAAUC,IAAI,sCAAqC,IAG9D,EAED2tD,MAAsBrrF,KAAK,EAE3Bm5F,MACEn5F,GACA,IAAIo5F,KAA8B,CAChC7oF,IAAKzgB,KAAKygB,IACV03H,MAAM,KAIVn4I,KAAKs1I,kBAAoBplI,GAAMuT,OAAO49B,GAAG/R,GACvC,aACC5lB,KACC,MAAMi0G,GAAej0G,GAAM5e,QACrBo4F,GAAay6B,GAAaxwC,cAChCntF,KAAKo4I,0BAA0Bl1C,GAAYy6B,GAAaz9H,IAAI,YAC5DF,KAAKk3I,oBACLl3I,KAAKm3I,iBACLn3I,KAAKo3I,gBAAc,GAIvBp3I,KAAKu1I,oBAAsBrlI,GAAMuT,OAAO49B,GAAG/R,GACzC,gBACC5lB,KACC,MAAMw5E,GAAax5E,GAAM5e,QAAQqiF,cACjCntF,KAAKi4I,0BAA0B/0C,GAAU,GAI7CljG,KAAK+1I,mBAAqB7lI,GAAMwU,UAC7BnC,QAASgE,KACyB,IAA1BA,GAAO/V,MAAMgY,UAErBzkB,QACCmf,KAAK,IAENrgB,UAAW0mB,MACwB,IAA9BvpB,KAAKo1I,cAAcztH,QACrB3nB,KAAK42I,0BAEP52I,KAAKiiI,kBAAkBt/H,KAAK4mB,GAAQ9I,IAAK8F,IAAWA,GAAOvI,QAAO,GAGtEhe,KAAK2yH,gBAAgBrrH,KACnBtH,KAAKkQ,MAAMuU,UAAU5hB,UAAWw1I,KAE5BA,GAAcj2H,KACXk2H,IAA8C,YAA9BA,GAAYhvD,SAAS9lF,MAGxCxD,KAAK+0I,SAASpyI,MAAK,GAEnB3C,KAAK+0I,SAASpyI,MAAK,GAInB01I,GAAcj2H,KACXk2H,IAA8C,eAA9BA,GAAYhvD,SAAS9lF,MAGxCxD,KAAK80I,SAASnyI,MAAK,GAEnB3C,KAAK80I,SAASnyI,MAAK,EAAK,IAK9B3C,KAAK2yH,gBAAgBrrH,KACnBtH,KAAKkQ,MAAM0R,OAAO/e,UAAWggF,KAEtB7iF,KAAKkQ,MAAMuyC,MAAM5iD,QAAQ8pD,gBAD9Bk5B,IAAO,CAEyC,GAGtD,CAOQg0D,cACN,MAAM3mI,GAAQlQ,KAAKkQ,MACnBlQ,KAAK+1I,mBAAmB5nI,eAAW,EACnCk9F,KAAQrrG,KAAKs1I,oBAAiB,EAC9BjqC,KAAQrrG,KAAKu1I,qBACbrlI,GAAM+V,yBAAyB4pE,MAC/B3/E,GAAM+V,yBAAyBqjF,KACjC,CAKQgtC,wBACNt2I,KAAKk1I,gBAAkB,IAAI3/B,MAAY,CACrCvT,aAAc,aACdiW,mBAAoBj4G,KAAKg2I,aACzB3+B,oBAAkBkhC,QAClBpgC,kBAAmB,IAAIqgC,KAAQ,KAEnC,CAKQjC,2BACNv2I,KAAKm1I,mBAAqB,IAAI5/B,MAAY,CACxCvT,aAAc,UACdiW,mBAAoBj4G,KAAKg2I,aACzB3+B,oBAAkBkhC,QAClBpgC,kBAAmB,IAAIqgC,KAAQ,KAEnC,CAKQhC,sBACNx2I,KAAKo1I,cAAgB,IAAI/7B,MAAc,CACrC51F,OAAQzjB,KAAKg2I,aACbx6B,aAAW+8B,QACXh1F,WAAY,IAAIi1F,KAAQ,KAE5B,CAKQ/B,oBACNz2I,KAAKg3I,wBAEDh3I,KAAKq0I,oBAAsBlB,KAAYK,OACzCxzI,KAAKy4I,oBAAoBz4I,KAAKk1I,iBACrBl1I,KAAKq0I,oBAAsBlB,KAAYC,MAChDpzI,KAAKy4I,oBAAoBz4I,KAAKm1I,mBAElC,CAMQsD,oBAAoBC,IAC1B14I,KAAKi1I,uBAAwB,EAC7Bj1I,KAAKw1I,kBAAoBkD,GACzB14I,KAAKy1I,YAAciD,GAAYljC,OAAO3yG,UACnCqgG,IAAyCljG,KAAKy4G,YAAYvV,KAE7DljG,KAAK01I,UAAYgD,GAAYjjC,KAAK5yG,UAC/BqgG,IAAyCljG,KAAK04G,UAAUxV,KAE3DljG,KAAK21I,cAAgB+C,GAAYhjC,SAAS7yG,UACvCqgG,IAAyCljG,KAAK24I,cAAcz1C,KAE/DljG,KAAK21I,cAAgB+C,GAAY7iC,OAAOhzG,UACrCqgG,KACCljG,KAAKi4I,0BAA0B/0C,IAC/BljG,KAAK44I,eAAa,GAGtBF,GAAYphC,SAASt3G,KAAKygB,IAAI4gC,IAAI,EACpC,CAKQ21F,6BACyBh1I,IAA3BhC,KAAKw1I,oBAITx1I,KAAKg2I,aAAalvI,aACO9E,IAArBhC,KAAKy1I,aACPz1I,KAAKy1I,YAAYtnI,mBAEInM,IAAnBhC,KAAK01I,WACP11I,KAAK01I,UAAUvnI,mBAEUnM,IAAvBhC,KAAK21I,eACP31I,KAAK21I,cAAcxnI,cAGrBnO,KAAK64I,wBAAwB74I,KAAKg2I,mBACJh0I,IAA1BhC,KAAKq1I,kBACPr1I,KAAKi4I,0BAA0Bj4I,KAAKq1I,kBAEtCr1I,KAAKw1I,kBAAkBl+B,cAASt1G,GAChChC,KAAKw1I,uBAAoBxzI,EACzBhC,KAAKq1I,sBAAmBrzI,EAC1B,CAEQi0I,qBAAqBtD,IAC3B3yI,KAAKk2I,mBAAqBvD,GAC1B3yI,KAAK44I,gBACL54I,KAAKy2I,mBACP,CAMQh+B,YAAYvV,IAClBljG,KAAKq1I,iBAAmBnyC,EAC1B,CAMQwV,UAAUxV,IAChBljG,KAAKq1I,sBAAmBrzI,EACxBhC,KAAK84I,4BAA4B51C,IACjCljG,KAAK+4I,kBAAkB71C,IACvBljG,KAAKi4I,0BAA0B/0C,IAC/BljG,KAAKg2I,aAAalvI,OAAM,EAC1B,CAMQ6xI,cAAcz1C,IACpB,MAAM2vC,MAAUmG,MAAkB91C,GAAYljG,KAAKgiD,YACnDhiD,KAAKo4I,0BACHl1C,GACA18F,OAAO6H,OAAO,GAAIwkI,GAAS,CACzBlB,UAAM3vI,KAGVhC,KAAKyyI,SAAS9vI,KAAKkwI,GACrB,CAMQmF,wBACN,MAAMtrH,GAAY1sB,KAAKkQ,MAAM6V,kBAC3BujF,MAEF58E,GAAUxG,aACVwG,GAAU5lB,QAEV9G,KAAK41I,cAAgB51I,KAAKo1I,cAAc5/B,OAAO3yG,UAC5CqgG,IAAyCljG,KAAK07G,cAAcxY,KAE/DljG,KAAK61I,YAAc71I,KAAKo1I,cAAc3/B,KAAK5yG,UACxCqgG,IAAyCljG,KAAK27G,YAAYzY,KAE7DljG,KAAK81I,gBAAkB91I,KAAKo1I,cAAc1/B,SAAS7yG,UAChDqgG,IAAyCljG,KAAKi5I,gBAAgB/1C,KAEjEljG,KAAKo1I,cAAc99B,SAASt3G,KAAKygB,IAAI4gC,GACvC,CAKQu1F,+BACqB50I,IAAvBhC,KAAK41I,eACP51I,KAAK41I,cAAcznI,mBAEInM,IAArBhC,KAAK61I,aACP71I,KAAK61I,YAAY1nI,mBAEUnM,IAAzBhC,KAAK81I,iBACP91I,KAAK81I,gBAAgB3nI,mBAGOnM,IAA1BhC,KAAKq1I,mBACqC,IAAxCr1I,KAAKiiI,kBAAkBv7H,MAAMkD,QAE/B5J,KAAK+4I,kBAAkB/4I,KAAKq1I,iBADPr1I,KAAKiiI,kBAAkBv7H,MAAM,IAGpD1G,KAAK84I,4BAA4B94I,KAAKq1I,mBAGxCr1I,KAAKg2I,aAAalvI,QAElB9G,KAAKkQ,MAAM8V,uBAAuBsjF,MAElCtpG,KAAKq1I,sBAAmBrzI,EACxBhC,KAAKo1I,cAAc99B,cAASt1G,EAC9B,CAMQ05G,cAAcxY,IACpBljG,KAAKy4G,YAAYvV,GACnB,CAMQ+1C,gBAAgB/1C,IACtBljG,KAAK24I,cAAcz1C,GACrB,CAMQyY,YAAYzY,IAClBljG,KAAK84I,4BAA4B51C,GACnC,CAEQ41C,4BAA4B51C,IAClC,MAAM2vC,MAAUmG,MAAkB91C,GAAYljG,KAAKgiD,YACnDhiD,KAAKo4I,0BAA0Bl1C,GAAY2vC,GAC7C,CAOQuF,0BACNl1C,GACA2vC,IAEA3vC,GAAWk6B,cAAc,CAAE8b,SAAUrG,KAAW,GAChD7yI,KAAKy3I,2BAA2Bv0C,GAClC,CAKQ01C,gBACN54I,KAAKyyI,SAAS9vI,KAAK,GACrB,CAOQo2I,kBAAkB71C,GAAYy6B,IACpC,MAAMwb,GAAYxb,GACdA,GAAatmG,WAAWnlB,GACxBgxF,GAAW05B,OACT56E,GAAahiD,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBACnC8nC,IAAW,IAAIuD,KAAYC,oBAAoBoW,GAAY,CAC/Dx+C,kBAAmB1C,GACnByC,eAAgBzC,KAElBhiD,KAAKkQ,MAAMyP,OAAO,CAChBnc,KAAMwpF,KACN1D,YACAtnC,WAAYA,GAAWP,UACvBpqB,WAAY,CACVnlB,GAAIinI,GACJtG,QAAS3vC,GAAWhjG,IAAI,aAE1Bme,KAAM,CACJnM,GAAIinI,KAGV,CAQQ1B,2BAA2Bv0C,IACjC,MAAM2vC,GAAU3vC,GAAWhjG,IAAI,YACzBk5I,GAAUvG,GAAQuG,QAClBzH,GAAOkB,GAAQlB,KAEf0H,MAAsBC,MAA4Bp2C,IACxD,GAAIk2C,GAAQxvI,SAAWyvI,GAAoBzvI,OACzC,QAASwlC,GAAI,EAAGA,GAAIiqG,GAAoBzvI,OAAQwlC,KAAK,CACnD,MAAMxlC,GAASwvI,GAAQhqG,SACRptC,IAAX4H,IACF5J,KAAKu5I,gBACHF,GAAoBjqG,KAAC,EACrBgiG,MAAaxnI,GAAQ5J,KAAKk0I,kBAC1Bl0I,KAAKk0I,iBACLf,KAAYK,OAGlB,MAGWxxI,IAAT2vI,IACF3xI,KAAKu5I,mBACHC,MAAwBt2C,KAAU,EAClCguC,MAAmBS,GAAM3xI,KAAKu0I,gBAC9Bv0I,KAAKu0I,eACLpB,KAAYC,KAGlB,CAKQqG,yBAAyBv2C,KAC/Bw2C,QAAwBx2C,IAAY3oF,QACjCo/H,KACK35I,KAAK45I,kBAAkBD,KACzB35I,KAAKygB,IAAI4gC,GAAGw4F,WAAWF,GAAS,EAIxC,CAMQ1B,0BAA0B/0C,KAChCw2C,QAAwBx2C,IAAY3oF,QACjCo/H,UACmB33I,IAAd23I,SAAkD33I,IAAvB23I,GAAUv7E,UACvCp+D,KAAKygB,IAAI4gC,GAAGy4F,cAAcH,GAAS,EAI3C,CAKQjD,yBAAyB3tC,IAC/BA,GAASgxC,eAAgBptD,KACvB3sF,KAAKy3I,2BAA2B9qD,GAAUQ,cAAoB,EAElE,CAKQ6sD,uBAAuBjxC,IAC7BA,GAASgxC,eAAgBptD,KACvB3sF,KAAKy5I,yBAAyB9sD,GAAUQ,cAAoB,EAEhE,CAMQ0rD,wBAAwB9vC,IAC9BA,GAASgxC,eAAgBptD,UAEJ3qF,IADA2qF,GAAUQ,eAE3BntF,KAAKi4I,0BAA0BtrD,GAAUQ,cAAoB,EAGnE,CAQQosD,gBACNI,GACA9G,GACA/9C,GACAtxF,IAEAm2I,GAAUvc,cACR,CAAE8b,SAAUrG,GAASoH,MAAOnlD,GAAMolD,MAAO12I,KACzC,GAEFm2I,GAAUlsG,aAAan3B,UAAYtW,KAAKm6I,wBAAwBR,IAC5D35I,KAAK45I,kBAAkBD,KACzB35I,KAAKygB,IAAI4gC,GAAGw4F,WAAWF,GAE3B,CAOQQ,wBAAwBR,IAC9B,MAAMtiH,GAAasiH,GAAUl6D,gBAC7B,SAAO4xD,MACLh6G,GAAW6hH,SACX,CACE3P,QAAS,EACTz0C,KAAMz9D,GAAW4iH,MACjBlJ,UAAU,EACVvrI,OAAQ,MAEVxF,KAAK2B,gBAET,CAQQi4I,kBAAkBD,IACxB,IAA0B,IAAtB35I,KAAKg1I,aACP,OAAO,EAGT,MAAM39G,GAAasiH,GAAUl6D,gBACvBozD,GAAUx7G,GAAW6hH,SAC3B,QAAgBl3I,IAAZ6wI,GACF,OAAO,EAGT,GAAIx7G,GAAW4iH,QAAU9G,KAAYK,OAAQ,CAC3C,MAAM2C,MACJ/E,MAAapxI,KAAKm2I,iBAAkB9+G,GAAW4iH,QAAU,EAC3D,OAAOpH,GAAU3mH,KAAKC,IAAIgqH,GAAkB,EAC9C,CAEA,OAAO,CACT,CAEQoB,mBACNv3I,KAAKm8C,eAAe97C,IAClB,eACAL,KAAKk0I,iBACLttI,KAAaulE,SAEfnsE,KAAKm8C,eAAe97C,IAClB,WACAL,KAAKu0I,eACL3tI,KAAaulE,QAEjB,CAEQkqE,gBACN,MAAM+D,GAAep6I,KAAKm8C,eAAej8C,IACvC,gBAEIm6I,GAAWr6I,KAAKm8C,eAAej8C,IAAI,YAEzCF,KAAKk0I,iBAAmBkG,IAA8Bp6I,KAAKk0I,iBAC3Dl0I,KAAKu0I,eAAiB8F,IAAsBr6I,KAAKu0I,cACnD,8CAxmCWK,IAAiBxzI,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MA6NlBs4F,MAAQ,+BA7NPk7C,GAAiBtmI,UAAA,mBAAAuO,UAAA,SAAA/N,GAAAC,OAAA,EAAAD,0lCDnG1B1N,MAFJ,QAEIA,CAFC,UAEDA,CAD8C,+BAG5CA,MAAA,kBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAU2N,GAAA+nI,oBAAAr/H,GAAA/Q,OAAiC,GAE3CtF,MAAA,yBACEA,MAAA,wBACFA,QACAA,MAAA,yBACEA,MAAA,wBAGNA,YAGEA,MADF,UACEA,CAD0C,yBAKxCA,MAAA,kBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAU2N,GAAAgoI,oBAAAt/H,GAAAoW,SAAmC,GAE7CzsB,MAAA,0BACFA,QAEAA,MAAA,GAAAk5I,GAAA,uCAEAl5I,MAAA,GAAAm5I,GAAA,4CASAn5I,MAAA,GAAAo5I,GAAA,yDAEAp5I,MAAA,GAAAq5I,GAAA,4CASAr5I,MAAA,GAAAs5I,GAAA,4CASAt5I,MAAA,GAAAu5I,GAAA,uCAEAv5I,MAAA,yBAGEA,MAAA,kBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAU2N,GAAAkoI,yBAAAx/H,GAAAoW,SAAwC,GAElDzsB,MAAA,0BAEJA,UAEAA,MAAA,GAAAw5I,GAAA,wCAgCAx5I,MAAA,GAAAy5I,GAAA,yDAEAz5I,MAAA,YACEA,MAAA,GAAA05I,GAAA,qDAWA15I,MAAA,GAAA25I,GAAA,qDAUF35I,QAEAA,MAAA,4BAOFA,eAjIMA,MAAA,GAAAA,MAAA,QAAA2N,GAAAslI,mBAGmBjzI,cAAA,QAAA2N,GAAA4jI,YAAAa,QACjBpyI,cAAA,IAAAA,MAAA,wBAAA2N,GAAA4jI,YAAAa,QAAA,KAEiBpyI,MAAA,GAAAA,MAAA,QAAA2N,GAAA4jI,YAAAS,MACjBhyI,cAAA,IAAAA,MAAA,wBAAA2N,GAAA4jI,YAAAS,MAAA,KAOFhyI,MAAA,GAEAA,MAFA,WAAA2N,GAAAkmI,sBAEA7zI,CAFkC,UAAA2N,GAAAqnI,oBAElCh1I,CAD+B,0BAI/BA,cAAA,IAAAA,MAAA,2CAGYA,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAGX1zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAQW1zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAAA1zI,MAAA,MAAA2N,GAAAgmI,WAGX3zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAAgmI,WASA3zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAAgmI,WAQW3zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAAgmI,WAGZ3zI,MAAA,GACAA,MADA,UAAA2N,GAAAqlI,iBACAhzI,CAD4B,0BAI5BA,cAAA,IAAAA,MAAA,8CAIWA,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA0jI,WAgCDrxI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAAA1zI,MAAA,MAAA2N,GAAAgmI,WAIT3zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAAA1zI,MAAA,MAAA2N,GAAAgmI,WAWA3zI,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,GAAA+lI,WAAA1zI,MAAA,MAAA2N,GAAAgmI,WAcH3zI,MAAA,GACAA,MADA,QAAA2N,GAAAmB,MACA9O,CADe,WAAA2N,GAAA8lI,+BCxCf5pF,KAAqBnlD,UACrB6tF,KAAoB5tF,KACpBoJ,KACA+7C,IAAgBllD,IAChBwsI,EACAjjI,KAAeoF,KACftF,KAAgBwF,KAChBrF,KAAasF,KACbygB,KACA7lB,KACAC,KAAiBmtB,MAAAjtB,OAAA,uwCAAAC,gBAAA,WAGR8kI,EAAiB,wOCnGvB,IAAKzB,EAAZ,SAAYA,GACVA,SAAAK,OAAA,SACAL,EAAAC,KAAA,OAFUD,CAGZ,CAHA,CAAYA,GAAW,IAKXhC,EAAZ,SAAYA,GACVA,SAAAI,OAAA,SACAJ,EAAAK,WAAA,aACAL,EAAAM,MAAA,QACAN,EAAAO,KAAA,OAJUP,CAKZ,CALA,CAAYA,GAAiB,IAOtB,MAAM6J,EAAgC,CAC3C,CAAC7J,EAAkBI,QAAS,IAC5B,CAACJ,EAAkBK,YAAa,KAChC,CAACL,EAAkBM,OAAQ,KAC3B,CAACN,EAAkBO,MAAO,MAGrB,IAAKT,EAAZ,SAAYA,GACVA,SAAAY,aAAA,eACAZ,EAAAa,iBAAA,mBACAb,EAAAc,YAAA,cACAd,EAAAgK,WAAA,aACAhK,EAAAgB,SAAA,WACAhB,EAAAe,MAAA,QANUf,CAOZ,CAPA,CAAYA,GAAe,IASpB,MAAMiK,EAA8B,CACzC,CAACjK,EAAgBY,cAAe,QAChC,CAACZ,EAAgBa,kBAAmB,SACpC,CAACb,EAAgBc,aAAc,SAC/B,CAACd,EAAgBgK,YAAa,SAC9B,CAAChK,EAAgBgB,UAAW,KAC5B,CAAChB,EAAgBe,OAAQ,sTCZrB,SAAUmJ,EAAmBz0I,IACjC,MAAe,KAARA,EACT,CAOM,SAAU00I,EAAa10I,IAC3B,OAAe,OAARA,EACT,CAOM,SAAU20I,EAAc30I,IAC5B,OAAe,OAARA,EACT,CAOM,SAAU40I,EAA+B50I,IAC7C,OAAe,KAARA,EACT,CAOM,SAAU60I,EAA0B70I,IACxC,OAAe,SAARA,EACT,CAOM,SAAU80I,EAAyB90I,IACvC,OAAe,OAARA,EACT,CAOM,SAAU+0I,EAAuB/0I,IACrC,OAAe,KAARA,EACT,CAOM,SAAUg1I,GAAoBh1I,IAClC,OAAe,SAARA,EACT,CAQM,SAAU0qI,EACd1qI,GACAouF,IAQA,MAAM6mD,OANuBz8H,IAAI,CAC/B,CAACiyH,KAAkBI,OAASqK,IAAgBA,IAC5C,CAACzK,KAAkBK,WAAY2J,GAC/B,CAAChK,KAAkBM,MAAO4J,GAC1B,CAAClK,KAAkBO,KAAM0J,KAESl7I,IAAI40F,IAExC,OAAO6mD,GAAaA,GAAWj1I,SAAS1E,CAC1C,CAQM,SAAUkvI,EACdxqI,GACAouF,IAUA,MAAM6mD,OARuBz8H,IAAI,CAC/B,CAAC+xH,KAAgBY,aAAe+J,IAAgBA,IAChD,CAAC3K,KAAgBa,iBAAkBwJ,GACnC,CAACrK,KAAgBc,YAAawJ,GAC9B,CAACtK,KAAgBgK,WAAYO,GAC7B,CAACvK,KAAgBgB,SAAUwJ,GAC3B,CAACxK,KAAgBe,MAAO0J,MAEUx7I,IAAI40F,IAExC,OAAO6mD,GAAaA,GAAWj1I,SAAS1E,CAC1C,CAQM,SAAUqvI,EACdwB,GACAhzI,GAMA8B,IAEA,IAAI4nI,GAAU1pI,GAAQ0pI,cACNvnI,IAAZunI,IAAyBA,GAAU,KACrCA,GAAU,GAGZ,MAAMsS,GAAQ,GACd,OACEA,GAAMv0I,UADetF,IAAnBnC,GAAQ2F,OAERqtI,GAAQ1sD,eAAetmF,GAAQ2F,OAAQ,CACrCs2I,sBAAuBvS,GACvBwS,sBAAuBxS,KAIhBsJ,GAAQ78E,QAAQuzE,IAASpxE,iBAGjBn2D,IAAjBnC,GAAQi1F,OAA2C,IAArBj1F,GAAQkxI,UAEtC8K,GAAMv0I,KADJ3F,GAGIA,GAAgB4pB,UAAUshB,QAD9BmuG,KAA8Bn7I,GAAQi1F,MAEhC,mBAAqBkmD,KAA8Bn7I,GAAQi1F,MAG3D,mBAAqBomD,KAA4Br7I,GAAQi1F,OAK/DkmD,KAA8Bn7I,GAAQi1F,OACpComD,KAA4Br7I,GAAQi1F,OAKrC+mD,GAAMnyI,OAAQC,SAAY3H,IAAN2H,IAAiBE,KAAK,IACnD,CAOM,SAAU4pI,EAAsB/sI,IACpC,IAAIouF,GAAOq8C,KAAkBI,OACzByK,GAAYt1I,GAChB,MAAMu1I,GAAgB,CAAC9K,KAAkBK,YACzC,KAAOwK,GAAY,KAAQC,GAAcryI,OAAS,GAChDkrF,GAAOmnD,GAAcjhH,MACrBghH,GAAY5K,EAAa1qI,GAAOouF,IAElC,OAAOA,EACT,CAOM,SAAUy+C,EAAoB7sI,IAClC,IAAIouF,GAAOm8C,KAAgBY,aACvBmK,GAAYt1I,GAChB,MAAMu1I,GAAgB,CAAChL,KAAgBa,kBACvC,KAAOkK,GAAY,KAAWC,GAAcryI,OAAS,GACnDkrF,GAAOmnD,GAAcjhH,MACrBghH,GAAY9K,EAAmBxqI,GAAOouF,IAExC,OAAOA,EACT,CAMM,SAAUyjD,IACd,OAAO,IAAIr0C,KAAc,CACvB9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,UACP2wI,SAAU,CAAC,GAAI,IACfh9G,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,6BAETwgF,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,YAETiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,gCAIf,CAMM,SAAU2sI,IACd,OAAO,IAAIh0C,KAAc,CACvB9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,UACP2zB,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,8BAGb,CAQM,SAAU4wI,EACdj5C,GACAlhD,IAEA,KAAIkhD,cAAsBZ,MAGqB,IAA3CY,GAAWb,qBAAqBz4F,OAGpC,SAAOwyI,MAAYl5C,GAAY,CAAElhD,eACnC,CAQM,SAAUq6F,EACdn5C,GACAlhD,IAEA,KAAIkhD,cAAsBZ,KAAWY,cAAsBX,MAGZ,IAA3CW,GAAWb,qBAAqBz4F,OAGpC,SAAO0yI,MAAUp5C,GAAY,CAAElhD,eACjC,CASM,SAAUg3F,EACd91C,GACAlhD,IAEA,MAAMp4C,GAASuyI,EAAwBj5C,GAAYlhD,IAC7C2vF,GAAO0K,EAAsBn5C,GAAYlhD,IAEzCo3F,GAAU,GACVlzD,GAAcgd,GAAWb,qBACzBk6C,GAAoBr2D,GAAYt8E,OACtC,QAASwlC,GAAI,EAAGA,IAAKmtG,GAAoB,EAAGntG,IAAK,EAAG,CAClD,MAAMotG,GAAY,IAAIj6C,IAAa,CACjC,CAACrc,GAAY92C,IAAI82C,GAAY92C,GAAI,IACjC,CAAC82C,GAAY92C,GAAI,GAAI82C,GAAY92C,GAAI,MAGvCgqG,GAAQ9xI,KAAK60I,EAAwBK,GAAWx6F,IAClD,CAEA,MAAO,CACL2vF,QACA/nI,UACAwvI,WAEJ,CAOM,SAAUqD,EACdv5C,IAEA,IAAIw5C,GACJ,GAAIx5C,cAAsBZ,IAAS,CACjC,MAAMq6C,GAAkB,IAAIr6C,IAAQY,GAAWb,sBAC/Cq6C,GAAc,IAAInhI,MAAM,GACxBmhI,GAAY,GAAKC,EACnB,KAAO,CACLD,GAAcE,EAAuB15C,IAErC,MAAMhd,GAAcgd,GAAWb,qBACzBw6C,GAAkBH,GAAY9yI,OACpC,QAASwlC,GAAI,EAAGA,GAAIytG,GAAiBztG,KAAK,CACxC,MAAMirC,GAAQ,EAAJjrC,GAMJ0tG,GALY,IAAIv6C,IAAa,CACjC,CAACrc,GAAY7L,IAAI6L,GAAY7L,GAAI,IACjC,CAAC6L,GAAY7L,GAAI,GAAI6L,GAAY7L,GAAI,MAGF0iE,gBAAgB,IAC/CC,GAAaN,GAAYttG,SACZptC,IAAfg7I,GACFA,GAAW5/B,eAAe0/B,IAE1BJ,GAAYttG,IAAK,IAAIkzD,IAAQw6C,GAEjC,CACF,CACA,OAAOJ,EACT,CA8BA,SAASE,EACP15C,IAEA,IAAI+5C,GAEFA,GADE/5C,cAAsB6zB,IACP,EAEA7qG,KAAKC,IACpB+2E,GAAWb,qBAAqBz4F,OAAS,EAAI,EAC7C,GAKJ,IAAI8yI,GAAcx5C,GAAWhjG,IAAI,cAEjC,QAAoB8B,IAAhB06I,GACF,OACEA,GAAc,IAAInhI,MADhB2nF,cAAsBZ,IACA,EAEA26C,IAE1B/5C,GAAW7iG,IAAI,aAAcq8I,IAAa,GACnCA,GAOT,GAJuB,IAAnBO,IAIAA,KAAmBP,GAAY9yI,OACjC,OAAO8yI,GAGT,GAAIO,GAAiBP,GAAY9yI,OAC/B8yI,UAAYp1I,QAAQ,IAAIiU,MAAM0hI,GAAiBP,GAAY9yI,SACpD8yI,GAGT,QAASttG,GAAI6tG,GAAgB7tG,GAAIstG,GAAY9yI,OAAQwlC,KAAK,CACxD,MAAM4tG,GAAaN,GAAYO,SACZj7I,IAAfg7I,IACFE,EAAuBF,GAE3B,CACAN,UAAY72H,OAAOo3H,IAEZP,EACT,CAMA,SAASQ,EAAuBF,IAC9B,MAAMrD,GAAYqD,GAAW98I,IAAI,YACjC,QAAkB8B,IAAd23I,GAAyB,CAC3B,MAAMtjC,GAAQsjC,GAAUv7E,cACVp8D,IAAVq0G,IACFA,GAAMyjC,cAAcH,GAExB,CACF,CAOM,SAAUL,EACdp2C,IAEA,MAAMw5C,GAAcD,EAA0Bv5C,IAC9C,IAAIi6C,GAAW,GACf,OAAIj6C,cAAsBX,IACxB46C,GAAW,QACFj6C,cAAsBd,OAC/B+6C,GAAW,aAEMT,GAAYj8H,IAAKu8H,KAClC,IAAIrD,GAAYqD,GAAW98I,IAAI,YAC/B,YAAkB8B,IAAd23I,GACFA,GAAYyD,GAAuBJ,IAAY,EAAOG,IAEtDxD,GAAU0D,YAAYL,GAAW36C,sBAE5Bs3C,IAGX,CAyCM,SAAUH,EACdt2C,IAEA,MAAMo6C,GAvBF,SAAUC,EACdr6C,IAEA,IAAIo6C,GAAWp6C,GAAWhjG,IAAI,WAC9B,MAAMs9I,MAAmBC,MAAYv6C,GAAWrf,aAChD,YAAiB7hF,IAAbs7I,GACFA,GAASlgC,eAAeogC,KAExBF,GAAW,IAAIh7C,IAAQk7C,IACvBt6C,GAAW7iG,IAAI,UAAWi9I,KAGrBA,EACT,CAUmBC,CAAuBr6C,IACxC,IAAIy2C,GAAY2D,GAASp9I,IAAI,YAC7B,YAAkB8B,IAAd23I,GACFA,GAAYyD,GAAuBE,IAAU,GAE7C3D,GAAU0D,YAAYC,GAASj7C,sBAE1Bs3C,EACT,CAmBM,SAAUD,GACdx2C,IAEA,MAAMw6C,GAAa,GAAG/8H,OAnElB,SAAUg9H,EACdz6C,IAGA,OADoB05C,EAAuB15C,IACxBziF,IAAKu8H,IACfA,GAAaA,GAAW98I,IAAI,iBAAc8B,EAErD,CA4D+B27I,CAAyBz6C,KAAe,IAC/D06C,GAhBF,SAAUC,GACd36C,IAEA,MAAMo6C,GAAWp6C,GAAWhjG,IAAI,WAChC,OAAOo9I,GAAWA,GAASp9I,IAAI,iBAAc8B,CAC/C,CAW0B67I,CAAqB36C,IAC7C,YAAwBlhG,IAApB47I,IACFF,GAAWp2I,KAAKs2I,IAEXF,EACT,CAOM,SAAUN,GACdz7F,GACAD,IAAkB,EAClBo8F,GAAsB,IAEtB,MAAMnE,GAAY,IAAIoE,IAAU,CAC9B11I,QAASC,SAASC,cAAc,OAChCmnC,OAAQ,EAAC,IAAK,IACd5Q,WAAY4iB,GACR,CACE,kBACA,0BACA,gCAEF,CACE,kBACA,0BACA,2BAA2Bo8F,eAE/Bj0I,KAAK,KACPm0I,WAAW,IAEbrE,UAAU0D,YAAY17F,GAAQ0gD,sBAC9B1gD,GAAQthD,IAAI,WAAYs5I,IAEjBA,EACT,oDC1lBO,IAAK/xB,EAAZ,SAAYA,GACVA,SAAAq2B,OAAA,SACAr2B,EAAAC,KAAA,OAFUD,CAGZ,CAHA,CAAYA,GAAwB,4JCc7B,IAAMs2B,EAAY,MAAnB,MAAOA,EAMSrgC,oBALXC,OAAiB,UACnBqgC,cAAuC,IAAIj/H,IAC3Ck/H,SAAmB,EAClBC,YAAc,IAAIC,KAE1Bv+I,YAAoB89G,GAAA79G,KAAA69G,qBAA2C,CAW/Dl+F,OACEpd,EACAg8I,EACAhgC,EACAigC,EACA/2B,GAEA,IAAKlJ,EACH,OAEF,IAAIkgC,GAAW,EAEf,MAAMzgC,EAA8B,IAAIhjE,IACxC,IAKI0jG,EALAC,MAA2B/6I,MAAG26G,GAMlCogC,OALIpgC,aAAkBqD,OACpB+8B,GAAU3+I,KAAKq+I,YAAYO,aAAargC,GACxCkgC,GAAW,GAGbE,GACG56I,QACCs5C,QAAK,EACLuhC,KAAW2/B,IACTmgC,EAAY,CACVn8I,MACAg8I,WACAhgC,OAAQA,EACRsgC,WAAYJ,EACZD,eACA/2B,eAEKznH,KAAK69G,oBAAoBI,QAAQj+G,KAAK89G,OAAQv7G,MACtD,EACDq8E,KAAWs/B,IACT,GAAKA,EAGE,CACL,MAAM4gC,EAAkB5gC,EAASqgC,SACjC,GAAIO,IAAoBP,EAAU,CAChC,MAAMQ,EAAa/+I,KAAKm+I,cAAcj+I,IAAI4+I,QACvB98I,IAAf+8I,GACFA,EAAWz3I,KAAK42G,EAAS37G,KACzBvC,KAAKm+I,cAAc99I,IAAIy+I,EAAiBC,IAExC/+I,KAAKm+I,cAAc99I,IAAIy+I,EAAiB,CAAC5gC,EAAS37G,KAEtD,CACA,OAAOvC,KAAKm+G,aAAaugC,EAC3B,CAdE,OAAA1+I,KAAKo+I,WACEp+I,KAAK69G,oBAAoBjwE,IAAI5tC,KAAK89G,OAAQ4gC,EAAS,IAgB/D77I,UAAWmvF,IACVgsB,EAAQr7G,KAAKqvF,GACbgsB,EAAQ10E,UAAQ,GAEb00E,CACT,CAEQG,aAAaugC,GACnB,MAAM1gC,EAA8B,IAAIhjE,IAKxCojE,OAJsBp+G,KAAK69G,oBAAoBQ,YAC7Cr+G,KAAK89G,OACL4gC,EAAUn8I,KAGTwB,QACC66E,KAAW0/B,GACTA,EACIt+G,KAAK69G,oBAAoBjwE,IAAI5tC,KAAK89G,OAAQ4gC,IAAS,EACnD96I,WAAG5B,KAGVa,UAAW07G,IACNA,GACFP,EAAQr7G,KAAK47G,GAEfP,EAAQ10E,UAAQ,GAEb00E,CACT,CAEA99G,IAAIqC,GACF,OAAOvC,KAAK69G,oBAAoBI,QAAQj+G,KAAK89G,OAAQv7G,GAAKwB,QACxD0c,KAAKxc,IACH,GAAIA,EAAM,CACR,MAAMs6G,EAASt6G,EAAKs6G,OACpB,OAAKt6G,EAAK46I,WAGH7+I,KAAKq+I,YAAYW,eAAezgC,GAF9BA,CAGX,IAGN,CAEAN,QAAQ17G,GACN,OAAOvC,KAAK69G,oBAAoBI,QAAQj+G,KAAK89G,OAAQv7G,EACvD,CAEA87G,YAAY97G,GACV,OAAOvC,KAAK69G,oBAAoBQ,YAAYr+G,KAAK89G,OAAQv7G,EAC3D,CAEA08I,mBAAmB/sI,GACjB,MAAM8rG,EAA2B,IAAIhjE,IAKrC,OAJkBh7C,KAAKk/I,cAAchtI,GAAIrP,UAAWs8I,IAClDnhC,EAAQr7G,KAAKw8I,EAAMv1I,QACnBo0G,EAAQ10E,UAAQ,GAEX00E,CACT,CAEAkhC,cAAchtI,GACZ,IAAKA,EACH,OAGF,MAAMktI,EAAsBC,YAAYC,KAAKptI,GAM7C,OALkBlS,KAAK69G,oBAAoB0hC,cACzCv/I,KAAK89G,OACL,WACAshC,EAGJ,CAEAI,iBAAiBttI,GACf,IAAKA,EACH,OAGF,MAAMktI,EAAsBC,YAAYC,KAAKptI,GACvCutI,EAAYz/I,KAAK69G,oBAAoB0hC,cACzCv/I,KAAK89G,OACL,WACAshC,GAEFK,SAAU58I,UAAWs8I,IACnBA,EAAM5kI,QAAStW,IACbjE,KAAK69G,oBAAoBQ,YAAYr+G,KAAK89G,OAAQ75G,EAAK1B,IAAG,EAC3D,GAEIk9I,CACT,CAEAC,WACEC,EAAwBN,YAAYO,WAAW,GAC/CrtI,EAAestI,KAAOC,UAQtB,OANgB9/I,KAAK69G,oBAAoBkiC,kBACvC//I,KAAK89G,OACL,WACA6hC,EACAptI,EAGJ,CAEAytI,gBACEhgJ,KAAKigJ,qBACLjgJ,KAAKo+I,SAAW,CAClB,CAEA6B,qBACEjgJ,KAAKm+I,cAAgB,IAAIj/H,GAC3B,CAEAghI,mBACE,UAAY3B,EAAUQ,KAAe/+I,KAAKm+I,cACxC,UAAW57I,KAAOw8I,EAChB/+I,KAAK69G,oBACFsiC,SAASngJ,KAAK89G,OAAQv7G,GACtBwB,QAAK6lD,KAAK,IACV/mD,UAAWq7G,IACYA,EACRqgC,SAAWA,EACzBv+I,KAAKm+G,aAAaD,EAAQ,EAIpC,CAEA,WAAIkiC,GACF,OAAOpgJ,KAAKo+I,QACd,4CA1MWF,GAAY98I,MAAAuE,MAAA,iCAAZu4I,EAAY78I,QAAZ68I,EAAY58I,UAAAC,WAFX,gBAED28I,CAAY,sGCUlB,IAAMmC,EAAiB,MAAxB,MAAOA,EAGD5+I,KACDm+G,aACCnhB,eAJF6hD,eAAyB,EACjCvgJ,YACU0B,EACDm+G,EACCnhB,GAFAz+F,KAAAyB,OACDzB,KAAA4/G,eACC5/G,KAAAy+F,iBAERz+F,KAAKy+F,eAAex+E,eAAepd,UAAW2N,IAC5CxQ,KAAKsgJ,cAAgB9vI,EAAMy6D,YAE/B,CAEA/qE,IAAIqC,EAAag+I,GACf,OAAIh5I,OAAO2jE,UAAUC,QAAUnrE,KAAKsgJ,cAC3BtgJ,KAAKwgJ,UAAUj+I,EAAKg+I,GAEtBvgJ,KAAKygJ,WAAWl+I,EACzB,CAEQi+I,UACNj+I,EACAg+I,GAEA,IAAIpgG,EACJ,OAAQogG,EAAiB33G,cACvB,IAAK,cACHuX,EAAUngD,KAAKyB,KAAKvB,IAAIqC,EAAK,CAC3BqmC,aAAc,cACd/gC,gBAAiB04I,EAAiB14I,kBAEpC,MACF,IAAK,OACHs4C,EAAUngD,KAAKyB,KAAKvB,IAAIqC,EAAK,CAC3BqmC,aAAc,OACd/gC,gBAAiB04I,EAAiB14I,kBAEpC,MACF,IAAK,OACHs4C,EAAUngD,KAAKyB,KAAKvB,IAAIqC,EAAK,CAC3BqmC,aAAc,OACd/gC,gBAAiB04I,EAAiB14I,kBAEpC,MACF,QACEs4C,EAAUngD,KAAKyB,KAAKvB,IAAIqC,EAAK,CAC3BqmC,aAAc,OACd/gC,gBAAiB04I,EAAiB14I,kBAIxC,OAAOs4C,CACT,CAEQsgG,WAAWl+I,GACjB,OAAOvC,KAAK4/G,aAAa1/G,IAAIqC,EAC/B,CAEOm+I,WACL,OAAO1gJ,KAAKsgJ,eAAiB/4I,OAAO2jE,UAAUC,MAChD,4CA3DWk1E,GAAiBj/I,MAAAuE,MAAAvE,MAAAwE,KAAAxE,MAAAyE,KAAA,iCAAjBw6I,EAAiBh/I,QAAjBg/I,EAAiB/+I,UAAAC,WAFhB,gBAED8+I,CAAiB,gFCJxB,MAAOn1I,EAIHuV,IAKAgiC,MAKR,cAAIpsB,GACF,OAAOr2B,KAAKyiD,MAAMpsB,UACpB,CAEAt2B,YAAY0gB,GACVzgB,KAAKyiD,SAAQ6pD,OACbtsG,KAAKmhH,OAAO1gG,EACd,CAMA0gG,OAAO1gG,QACOze,IAARye,OACeze,IAAbhC,KAAKygB,KACPzgB,KAAKygB,IAAI4gC,GAAGkrD,YAAYvsG,KAAKyiD,MAAMpB,IAGrC5gC,EAAI4gC,GAAG2a,SAASh8D,KAAKyiD,MAAMpB,IAE7BrhD,KAAKygB,IAAMA,CACb,CAQAkgI,YACEp2I,EACAqwF,EAAwBC,KAAc59E,QACtCrU,GAEA,GAAIA,EACF,UAAW+jF,KAAa3sF,KAAKq2B,WAAWgrB,GAAG8C,cACrCwoC,EAAUzsF,IAAI,eAAiB0I,GACjC5I,KAAK4gJ,gBAAgBj0D,QAIzB3sF,KAAK8G,QAEP9G,KAAK67D,YAAYtxD,EAAUqwF,EAC7B,CAOA9d,WAAWhyE,EAAkB8vF,EAAwBC,KAAc59E,SACjEjd,KAAK67D,YAAY,CAAC/wD,GAAU8vF,EAC9B,CAOA/+B,YACEtxD,EACAqwF,EAAwBC,KAAc59E,SAEtC,MAAMgnC,EAAa,GACnB15C,EAASgQ,QAASzP,IAChB,MAAM6hF,KAAYyU,MAAYt2F,EAAS9K,KAAKygB,IAAIuhC,YAE7B,OADA2qC,EAAUQ,eAI7BlpC,EAAW38C,KAAKqlF,EAAS,GAG3B3sF,KAAK6gJ,cAAc58F,EAAY22C,EACjC,CAOA28B,aACE5qC,EACAiO,EAAwBC,KAAc59E,SAEtCjd,KAAK6gJ,cAAc,CAACl0D,GAAYiO,EAClC,CAOAimD,cACE58F,EACA22C,EAAwBC,KAAc59E,SAEtCjd,KAAKq2B,WAAWgrB,GAAGwa,YAAY5X,IAAU,EACzC6/C,MAAiB9jG,KAAKygB,IAAIyhC,eAAgB+B,EAAY22C,EACxD,CAMA/d,cAAc/xE,GACZ9K,KAAK8gJ,eAAe,CAACh2I,GACvB,CAMAg2I,eAAev2I,GACbA,EAASgQ,QAASzP,IACZA,EAAQuT,MACNre,KAAKq2B,WAAWgrB,GAAGs7B,eAAe7xE,EAAQuT,KAAKnM,KACjDlS,KAAK4gJ,gBACH5gJ,KAAKq2B,WAAWgrB,GAAGs7B,eAAe7xE,EAAQuT,KAAKnM,IAAG,EAK5D,CAMA0uI,gBAAgBj0D,GACd3sF,KAAKq2B,WAAWgrB,GAAGw7B,cAAc8P,EACnC,CAKA7lF,QACE9G,KAAKq2B,WAAWgrB,GAAGv6C,OACrB,yFCtKI,SAAUwlG,IACd,MAAMy0C,EAAoB,IAAIjlF,KAC9B,OAAO,IAAIC,IAAY,CACrBnwD,MAAO,UACP42C,OAAQ,IACR/+B,OAAQs9H,EACR5qI,SAAO6qI,QAEX,oQCQc,SAAUC,EAAeC,GACrC,MAAMC,EAAa,SAAUC,EAAQC,GACnC,MAAMC,EAAOF,EAAOv3I,KAAK,KAInB03I,EAAOF,EAAO,GACdG,EAAOH,EAAO,GACdI,EAAOJ,EAAO,GACdK,EAAOL,EAAO,GACdM,EAAS,CAACD,EAAMH,EAAME,EAAMF,EAAME,EAAMD,EAAME,EAAMF,GAAM33I,KAAK,KAC/D+3I,EAAW5hJ,KAAKi1F,SAAS4sD,sBACzBC,EAAa9hJ,KAAKi1F,SAAS4sD,sBAC3BE,EAAW/hJ,KAAKi1F,SAAS4sD,sBAE/BE,EAAS/3B,QACP,odAMF83B,EAAW93B,QACT,uCACA+3B,EAASC,MACT,gBACAL,EACA,+DAEFC,EAAS53B,QACP,cACAs3B,EACA,eACAQ,EAAWE,MACX,wCAEF,MAAMC,GAAYjiJ,KAAKi1F,SAAS4sD,sBAC1B7oH,QAAW/3B,MAAOihJ,mBAAmB,SAC3CD,UAAUj4B,QAAU,kCAAoChxF,GAAO,MAExD4oH,EAASI,KAClB,EAEAd,EAASC,WAAa,SAAUC,EAAQC,GACtCrhJ,KAAKi1F,SAASktD,OAAOt/I,UAAU,UAAW,WACxC,MAAMu/I,EAAUjB,EAAW/lI,KAAKpb,KAAMohJ,EAAQC,GAC9CrhJ,KAAKi1F,SAASh5C,MAAM,SAAWmmG,EAAU,SAC3C,EACF,CACF,qCClCO,IAAMC,EAAY,MAAnB,MAAOA,EAkBD5gJ,KACAG,eACAq+D,gBACAt+D,gBACA6mC,cACkBlgC,SAtB5Bg6I,QACAC,gBACA7tD,WACA8tD,eACAC,aAEAC,YAAc,CACZC,UAAW,QACXC,eAAgB,OAChBC,aAAc,QACdC,kBAAmB,OACnBC,YAAa,QACbC,iBAAkB,SAClBC,gBAAiB,IAGnBljJ,YACU0B,EACAG,EACAq+D,EACAt+D,EACA6mC,EACkBlgC,GALlBtI,KAAAyB,OACAzB,KAAA4B,iBACA5B,KAAAigE,kBACAjgE,KAAA2B,kBACA3B,KAAAwoC,gBACkBxoC,KAAAsI,UACzB,CAEH46I,MAAMziI,EAAa5gB,GAAqB,IAAA40F,EAAAz0F,KACtC,MAAM25D,EAAU,IAAI3e,IACdmoG,EAAsBtjJ,EAAQsjJ,YAC9B7nF,GAAcz7D,EAAQy7D,WACtBu5B,EAAch1F,EAAQg1F,YACtBuuD,EAAgBvjJ,EAAQwjJ,eAC9BrjJ,KAAK00F,WAAa10F,KAAKigE,gBAAgB1+B,WAEvC+hH,EAAa1uD,UAAM2uD,KAEnB,MAAM5uD,EAAM,IAAIC,UAAM,CACpBC,cACAl9D,OAAQwrH,EAAYhrH,cACpB28D,KAAM,QAGA51D,MAAO61D,EAAW91D,OAAQ+1D,GAAeL,EAAIM,SAAS1qE,SAGxDi5H,GAAgD,CAAC,GAAI,GAAI,GAAI,IAEnE,IAAIC,GACAC,IAIiB,KAAlB7jJ,EAAQ+L,OAAqC,KAArB/L,EAAQ8jJ,YAChCR,IAAgBS,KAAiBC,IAChCV,IAAgBS,KAAiBE,MAEnCN,GAAY,IAAM,IAGpB,MAAMO,GAAe73H,KAAKiwE,MAAM,GAAKnH,EAAa,KAAO,KAAQ,EAkEjE,YAjEsBhzF,IAAlBnC,EAAQ+L,OAAyC,KAAlB/L,EAAQ+L,QACzC63I,GAAazjJ,KAAKgkJ,4BAChBnkJ,EAAQ+L,MACR43I,GACAxjJ,KAAK0iJ,YAAYC,UACjBoB,GACA/jJ,KAAK0iJ,YAAYE,eACjBjuD,GAGF30F,KAAKikJ,gBACHtvD,EACA90F,EAAQ+L,MACR5L,KAAK0iJ,YAAYC,UACjB3iJ,KAAK0iJ,YAAYE,eACjBa,GAAWhrD,SACXgrD,GAAWS,WAAaV,GAAY,GACpCA,GAAY,IAGdA,GAAY,GAAKC,GAAWxkH,OAASukH,GAAY,SAI1BxhJ,IAArBnC,EAAQ8jJ,UAA+C,KAArB9jJ,EAAQ8jJ,WAC5CD,GAAgB1jJ,KAAKgkJ,4BACnBnkJ,EAAQ8jJ,SACRH,GACAxjJ,KAAK0iJ,YAAYG,aACC,KAAlBhjJ,EAAQ+L,MAAqC,GAAtB63I,GAAWhrD,SAAgC,GAAfsrD,GACnD/jJ,KAAK0iJ,YAAYI,kBACjBnuD,GAGF30F,KAAKikJ,gBACHtvD,EACA90F,EAAQ8jJ,SACR3jJ,KAAK0iJ,YAAYG,aACjB7iJ,KAAK0iJ,YAAYI,kBACjBY,GAAcjrD,SACdirD,GAAcQ,WAAaV,GAAY,GACvCA,GAAY,IAGdA,GAAY,IAAM,QAIIxhJ,IAApBnC,EAAQskJ,SAA6C,KAApBtkJ,EAAQskJ,SAC3CnkJ,KAAKokJ,WAAWzvD,EAAK90F,EAAQskJ,QAASX,GAFR,GAKhCxjJ,KAAKqkJ,aACH5jI,EACAk0E,EACA90F,EACAy7D,EAT8B,EAW9BkoF,IAOFxjJ,KAAKs1F,OACHX,EACAl0E,EACA66C,EAL6B,CAFjBy5B,EAAYyuD,GAAY,GAAKA,GAAY,GACxCxuD,EAAawuD,GAAY,GAAKA,GAAY,IAQvDA,GACAJ,GACAvgJ,UAAS,eAAA4yF,MAAAC,KAAC,UAAOC,IACjB,GAAIA,KAAWC,KAAcC,KAAM,CACjC,MAAM32D,GAAQu1D,EAAKguD,aAAa,GAIhC,GAFAhuD,EAAK6vD,UAAU3vD,EAAKl0E,EAAKye,GADVu1D,EAAKguD,aAAa,GACOe,UAClC/uD,EAAK8vD,mBAAmB5vD,EAAKl0E,EAAK+iI,IACpC3jJ,EAAQ2kJ,eAAgB,CAC1B,MAAMC,SAAyBhwD,EAAKiwD,0BAClCjkI,EAAIyhC,eAAeu2E,qBAEfhkC,EAAKkwD,mBACThwD,EACA8vD,GACAjB,GACAJ,EACAlkH,GAEJ,CAE+B,SAA3Br/B,EAAQwjJ,eAER,CAAC,UAAW,WAAY,aAAc,eAAe36I,QACnD7I,EAAQwjJ,iBACN,QAEE5uD,EAAKmwD,kBACTjwD,EACAl0E,EACA+iI,GACAloF,EACAz7D,EAAQwjJ,gBAE0B,YAA3BxjJ,EAAQwjJ,uBACX5uD,EAAKowD,UAAUlwD,EAAKl0E,EAAK+iI,GAAaloF,UAGxCm5B,EAAKqwD,QAAQnwD,EAEvB,EAEIgB,KAAWC,KAAcC,MAAQF,KAAWC,KAAc5zE,SAC5DyyE,EAAKx0B,gBAAgBI,WAAWo0B,EAAKC,YACrC/6B,EAAQh3D,KAAKizF,KAAcC,MAE/B,GAAC,gBAAAI,IAAA,OAAAR,GAAAS,MAAAl2F,KAAAm2F,UAAA,EA5CU,IA8CJx8B,CACT,CAEA2qF,UACE3vD,EACAl0E,EACAye,EACAD,EACAukH,GAEA,MACMuB,EAAYpwD,EAAIM,SAAS1qE,SAAS8uE,YAGlCtlB,EAAIyvE,EAAY,GAChBzqD,EAAIgsD,EAAYvB,EAAY,GAAKvkH,EAEvC,IAAI+lH,EAAc,CAACjxE,EAAGglB,EAAGhlB,EAAI70C,EAAO65D,EAAI95D,GACxC,QAASmQ,EAAI,EAAGA,EAAI41G,EAAYp7I,OAAQwlC,IACtC41G,EAAY51G,GAAKpvC,KAAKilJ,iBAAiBD,EAAY51G,GATxC,MAWbulD,EAAIwsD,WAAW6D,EAAahlJ,KAAKwiJ,eACnC,CAQc+B,mBACZ5vD,EACAl0E,EACA+iI,GAA6C,IAAA/sD,EAAAz2F,KAAA,SAAA01F,KAAA,YAE7C,GACEj1E,EAAIq/B,OAAO19B,KACRqgC,GAAUA,EAAM5rB,SAAW4rB,EAAMvwC,GAAG6uF,WAAW,kBAElD,CACA,IAAImkD,EACJ,MAAMC,EAAyB1kI,EAAI4gC,GAAG+jG,4BAChC1tD,IAAYytD,EAAwB,CACxC7jE,MAAO,EACPvrE,gBAAiB,OAChB0nH,KAAM9xF,IACPu5G,EAA4Bv5G,IAE9B8qD,EAAK4uD,UAAU1wD,EAAKuwD,EAA2B1B,EACjD,CAAC,EAhB4C,EAiB/C,CAQA8B,oBACE7kI,EACAye,EACAo8B,GAEA,OAAO,IAAI1gD,IAAYouB,IACrB,IAAI/zB,EAAO,GACX,MAAMswI,EChRN,SAAUC,EACd1lG,EACA3vC,GAEA,MAAMo1I,EAAU,GAEhB,UAAW9iG,KAAS3C,EAAQ,CAC1B,MAAMowB,EAAgBztB,EAAM5iD,QAAQqwE,cACpC,IAAsB,IAAlBztB,EAAM5rB,QACR,SAGF,MAAM4uH,EAAahjG,EAAMpsB,WAAWqhD,eAAU11E,EAAWmO,IAAS,GAClE,UAAW0+D,KAAa42E,OACAzjJ,IAAlB6sE,EAAUtsE,KAKdgjJ,EAAQj+I,KAAK,CACXsE,MAAO62C,EAAM72C,OAAS,GACtBrJ,IAAKssE,EAAUtsE,IACf0L,aAC6BjM,IAA3BkuE,GAAejiE,SAA+BiiE,EAAcjiE,QAC9Dm2G,qBAAsB3hE,EAAM2hE,sBAGlC,CAEA,OAAOmhC,CACT,CDkPsBC,CAAiB/kI,EAAIq/B,OAAQ,CAC3Cwb,WAAY76C,EAAIyhC,eAAe4iD,gBAC/Bt0B,OAAQ/vD,EAAIyhC,eAAe2hC,YAC3B7hC,WAAYvhC,EAAIyhC,eAAe6hD,kBAAkBtiD,UAEjDniC,KAAMmB,EAAI4gC,GAAGs3E,YAGf,GAAyD,IAArD4sB,EAAQ77I,OAAQq2C,IAAoB,IAAdA,EAAE9xC,SAAkBrE,OAG5C,OAFAo/B,EAASrmC,KAAKsS,QACd+zB,EAASM,WAKXr0B,GAAQ,yCACRA,GACE,mCACAiqB,EACA,8CACFjqB,GAAQ,0CACRA,GACE,6FACFA,GAAQ,WAIRA,GAAQ,gCACRA,GAAQ,4BACRA,GAAQ,+BAGR,MAAMywI,EAAUH,EACb77I,OAAQq2C,GAAMA,EAAE9xC,UAAsC,IAA3B8xC,EAAEqkE,sBAC7B3jG,IAAKquD,GACJ9uE,KAAK2lJ,aAAa72E,EAAOvsE,KAAKwB,QAC5B6hJ,KAAOC,IACL,IAAIC,EACF,WAAah3E,EAAOljE,MAAMwjE,cAAgB,aAC5C02E,UAAW,qBAAuBD,EAAY,eACvCC,OAIfxhF,OAASohF,GAAS7iJ,UAAWkjJ,IAC3B9wI,EAAO8wI,EAAW7lI,OAAO,CAACC,EAAK+2B,IAAa/2B,EAAO+2B,EAAUjiC,GAC7DA,GAAQ,WACRA,GAAQ,SACR+zB,EAASrmC,KAAKsS,GACd+zB,EAASM,UAAQ,EAClB,EAEL,CAEAq8G,aAAapjJ,GAEX,OADkB,IAAIi7B,KAAgBx9B,KAAKyB,KAAMzB,KAAKwoC,eACrCpvB,UAAU7W,EAC7B,CAOMyjJ,qBACJvlI,EACAkX,EAAiB,MACjBsuH,EACA3qF,GAAkB,IAAA+7B,EAAAr3F,KAAA,SAAA01F,KAAA,YAElB,MAAM/7B,EAAU,IAAI3e,IAGpB,IAAI/lC,QAAaoiF,EAAKiuD,oBACpB7kI,EAFY,IAIZ66C,GACA4qF,YACFvuH,EAASA,EAAOQ,cAGI,IAAhBljB,EAAKrL,SACPqL,EAAO,uCACPA,GAAQ,8CAGV,MAAMuqF,EAAMj4F,OAAOe,SAASC,cAAc,OAC1Ci3F,EAAIrpF,MAAMk5B,SAAW,WACrBmwD,EAAIrpF,MAAMiiF,IAAM,IAChBoH,EAAIrpF,MAAMqsC,OAAS,KAEnBj7C,OAAOe,SAASlF,KAAK6zF,YAAYuI,GACjCA,EAAIlpF,UAAYrB,QAEVoiF,EAAK7xB,QAAQ,GACnB,MAAM2gF,QAAezuD,IAAY8H,EAAK,CAAE4mD,SAAS,IAAQC,MAAO16G,IAC9Du3B,QAAQK,IAAI53B,EAAC,GAGf,GADA0rD,EAAKivD,kBAAkB9mD,GACnB2mD,EAAQ,CACV,IAAIxwD,EAASC,KAAcC,KAC3B,IACOowD,EAKH5uD,EAAKkvD,uBAAuBJ,EAAQ,eAAsBxuH,GAH1D0/D,EAAKmvD,sBAAsBL,EAAQ,cAAexuH,EAKtD,OACEg+D,EAASC,KAAc5zE,KACzB,CACA23C,EAAQh3D,KAAKgzF,EACf,CAEA,OAAOh8B,CAAQ,EA/CG,EAgDpB,CAEQ2sF,kBAAkBj+I,GACxBA,EAAQ84D,WAAWslF,YAAYp+I,EACjC,CAEA27I,4BACEp3G,EACAsoD,EACAm+B,EACA0wB,EACA2C,EACA/xD,GAIA,MAAMI,EADWJ,EAAIM,SAAS1qE,SAAS+uE,WACVpE,EAAQ,GAAKA,EAAQ,GAGlDP,EAAIgyD,QAAQtzB,EAAMqzB,GAClB/xD,EAAI4B,YAAYwtD,GAEhB,IACI6C,EADAC,EAAiBlyD,EAAImyD,kBAAkBl6G,GAG3C,OAAIi6G,EAAeE,EAAIhyD,GAErB6xD,EAAiB,EAEjBjyD,EAAI4B,YADJwtD,GAA8B,IAE9B8C,EAAiBlyD,EAAImyD,kBAAkBl6G,IAEvCg6G,GAAkB7xD,EAAY8xD,EAAeE,GAAK,EAG7C,CACLtuD,SAAUsrD,EACVG,WAAY0C,EACZ3nH,OAAQ4nH,EAAeG,EAE3B,CASQ5C,WACNzvD,EACAwvD,EACAX,EACAltD,GAGAktD,EAAY,IAAMltD,EAQlBt2F,KAAKikJ,gBACHtvD,EACAwvD,EACAnkJ,KAAK0iJ,YAAYK,YACjB/iJ,KAAK0iJ,YAAYM,iBACjBhjJ,KAAK0iJ,YAAYO,gBAXDO,EAAY,GAI5B7uD,EAAIM,SAAS1qE,SAAS0U,OAHHukH,EAAY,GAGeltD,GAU9C,EAEJ,CAEQ2tD,gBACNtvD,EACAsyD,EACAC,EACAC,EACAC,EACAR,EACAS,EACAC,GAAqB,GAErB3yD,EAAIgyD,QAAQO,EAAUC,GACtBxyD,EAAI4B,YAAY6wD,GAEZE,IACFL,EAAYtyD,EAAI4yD,gBACdN,EACAtyD,EAAIM,SAAS1qE,SAAS+uE,WAA8B,EAAjBstD,IAGvCjyD,EAAI/nD,KAAKq6G,EAAWL,EAAgBS,EACtC,CAWchD,aACZ5jI,EACAk0E,EACA90F,EACAy7D,EACAg7B,EACAktD,GAA6C,IAAA3rD,EAAA73F,KAAA,SAAA01F,KAAA,YAE7C,IAAI9oD,EAAe,GAEnB,MAAMwpD,EAA0ByB,EAAKxB,mBAAmB51E,GACpD21E,IACFxpD,GAAQwpD,EAAkB,QAEG,IAA3Bv2F,EAAQ2nJ,iBAAiD,IAAtB3nJ,EAAQ4nJ,aAC7C76G,GAAQirD,EAAK6vD,aAAajnI,EAAK5gB,EAASy7D,IAGtC1uB,IACF42G,EAAY,IAAMltD,GASpBuB,EAAKosD,gBACHtvD,EACA/nD,EACAirD,EAAK6qD,YAAYK,YACjBlrD,EAAK6qD,YAAYM,iBACjBnrD,EAAK6qD,YAAYO,gBAXDO,EAAY,GAI5B7uD,EAAIM,SAAS1qE,SAAS0U,OAHHukH,EAAY,GAGeltD,EAU9C,EA9B2C,EA+B/C,CAEAD,mBAAmB51E,GAEjB,MAAMknI,EADiBlnI,EAAI4gC,GAAGumG,+BAE3BtQ,uBAAuB,kBAAkB,GACzCuQ,WAAU,GACbF,SAAgB3mF,qBAAqB,UAAU,GAAGvgE,SAC3CknJ,EAAgB15G,SACzB,CAEQy5G,aACNjnI,EACA5gB,EACAkgF,GAEA,MAAMx0D,EAAYvrB,KAAK2B,gBAAgB4pB,UACvC,IAAIu8H,EAAwB,GAK5B,IAJ+B,IAA3BjoJ,EAAQ2nJ,iBAEVM,GADiBv8H,EAAUshB,QAAQ,gCACP,KAAOpsB,EAAIuhC,aAEf,IAAtBniD,EAAQ4nJ,UAAoB,EACC,IAA3B5nJ,EAAQ2nJ,iBACVM,GAAiB,OAEnB,MAAMC,EAAYx8H,EAAUshB,QAAQ,2BAC9Bm7G,EAAWvnI,EAAIyhC,eAAe02E,SAAS74C,GAC7C+nE,GAAiBC,EAAY,cAAahe,OAAYie,EACxD,CACA,OAAOF,CACT,CAQcjD,UACZlwD,EACAl0E,EACAy0E,EACA55B,GAAkB,IAAA2sF,EAAAjoJ,KAAA,SAAA01F,KAAA,YAGlB,MAAMx2D,EAAQy1D,EAAIM,SAAS1qE,SAAS2U,MAC9BjqB,QAAagzI,EAAK3C,oBACtB7kI,EACAye,EACAo8B,GACA4qF,YAEF,GAAa,KAATjxI,EACF,aAAMgzI,EAAKnD,QAAQnwD,IACZ,EAGT,MAAM6K,EAAMj4F,OAAOe,SAASC,cAAc,OAC1Ci3F,EAAIrpF,MAAMk5B,SAAW,WACrBmwD,EAAIrpF,MAAMiiF,IAAM,IAChBoH,EAAIrpF,MAAMqsC,OAAS,KAGnBj7C,OAAOe,SAASlF,KAAK6zF,YAAYuI,GACjCA,EAAIlpF,UAAYrB,QAEVgzI,EAAKziF,QAAQ,GACnB,MAAM2gF,QAAezuD,IAAY8H,EAAK,CAAE4mD,SAAS,IAAQC,MAAO16G,IAC9Du3B,QAAQK,IAAI53B,EAAC,GAGf,GADAs8G,EAAK3B,kBAAkB9mD,GACnB2mD,EAAQ,CAEV,MAAM+B,EAAY,CACS,KAAO/B,EAAOjnH,MAAtCipH,IAAgD7sF,EACxB,KAAO6qF,EAAOlnH,OAAtCkpH,IAAiD7sF,GAEpD,IAAI8sF,GACJzzD,EAAImD,UACJswD,GAAUjC,EAAOxuD,UAAU,aAC3BhD,EAAImE,SAASsvD,GAAS,MAAO,GAAI,GAAIF,EAAU,GAAIA,EAAU,GAC/D,OAEMD,EAAKnD,QAAQnwD,EAAK,EAzCN,EA0CpB,CAQciwD,kBACZjwD,EACAl0E,EACA+iI,EACAloF,EACA+nF,GAAsB,IAAAgF,EAAAroJ,KAAA,SAAA01F,KAAA,YAGtB,MAAMx2D,EAAQy1D,EAAIM,SAAS1qE,SAAS2U,MAC9BjqB,QAAaozI,EAAK/C,oBACtB7kI,EACAye,EACAo8B,GACA4qF,YAEF,GAAa,KAATjxI,EACF,aAAMozI,EAAKvD,QAAQnwD,IACZ,EAGT,MAAM6K,EAAMj4F,OAAOe,SAASC,cAAc,OAC1Ci3F,EAAIrpF,MAAMk5B,SAAW,WACrBmwD,EAAIrpF,MAAMiiF,IAAM,IAChBoH,EAAIrpF,MAAMqsC,OAAS,KAEnBj7C,OAAOe,SAASlF,KAAK6zF,YAAYuI,GACjCA,EAAIlpF,UAAYrB,QACVozI,EAAK7iF,QAAQ,GACnB,MAAM2gF,QAAezuD,IAAY8H,EAAK,CAAE4mD,SAAS,IAAQC,MAAO16G,KAC9Du3B,QAAQK,IAAI53B,GAAC,GAGf,IAAI28G,EACJ,GAFAD,EAAK/B,kBAAkB9mD,GAEnB2mD,EAAQ,CAEV,MAAM+B,GAAY,CACS,KAAO/B,EAAOjnH,MAAtCipH,IAAgD7sF,EACxB,KAAO6qF,EAAOlnH,OAAtCkpH,IAAiD7sF,GAG7B,gBAAnB+nF,EACFiF,EAAgB,CACd3zD,EAAIM,SAAS1qE,SAAS0U,OAASukH,EAAY,GAAK0E,GAAU,GAC1D1E,EAAY,GACZA,EAAY,GACZ7uD,EAAIM,SAAS1qE,SAAS2U,MAAQskH,EAAY,GAAK0E,GAAU,IAE/B,aAAnB7E,EACTiF,EAAgB,CACd9E,EAAY,GACZA,EAAY,GACZ7uD,EAAIM,SAAS1qE,SAAS0U,OAASukH,EAAY,GAAK0E,GAAU,GAC1DvzD,EAAIM,SAAS1qE,SAAS2U,MAAQskH,EAAY,GAAK0E,GAAU,IAE/B,eAAnB7E,EAETiF,EAAgB,CACd3zD,EAAIM,SAAS1qE,SAAS0U,OAASukH,EAAY,GAAK0E,GAAU,GAC1DvzD,EAAIM,SAAS1qE,SAAS2U,MAAQskH,EAAY,GAAK0E,GAAU,GACzD1E,EAAY,GACZA,EAAY,IAEc,YAAnBH,IACTiF,EAAgB,CACd9E,EAAY,GACZ7uD,EAAIM,SAAS1qE,SAAS2U,MAAQskH,EAAY,GAAK0E,GAAU,GACzDvzD,EAAIM,SAAS1qE,SAAS0U,OAASukH,EAAY,GAAK0E,GAAU,GAC1D1E,EAAY,KAGhB6E,EAAKhD,UAAU1wD,EAAKwxD,EAAQmC,SACtBD,EAAKvD,QAAQnwD,EACrB,CAAC,EAnEqB,EAoExB,CAEA4zD,sBAAsBhG,GACpBviJ,KAAKuiJ,gBAAkBA,CACzB,CAEQ/8E,QAAQgjF,GACd,OAAO,IAAI55G,QAASC,GAAYlQ,WAAWkQ,EAAS25G,GACtD,CAEQnD,UACN1wD,EACAwxD,EACA3C,GAEA,IAAIz3D,EAKJ,GAJIo6D,IACFp6D,EAAQo6D,EAAOxuD,UAAU,mBAGb31F,IAAV+pF,EAAqB,CACvB,GAAIA,EAAMniF,OAAS,GAEjB,YADAs5D,QAAQK,IAAI,iDAGd,MAAM2kF,EAAYloJ,KAAKyoJ,qBAAqB9zD,EAAKwxD,EAAQ3C,GACzD7uD,EAAImE,SACF/M,EACA,MACAy3D,EAAY,GACZA,EAAY,GACZ0E,EAAU,GACVA,EAAU,IAEZvzD,EAAI+zD,KAAKlF,EAAY,GAAIA,EAAY,GAAI0E,EAAU,GAAIA,EAAU,IACjEloJ,KAAKyiJ,aAAeyF,CACtB,CACF,CAGA5yD,OACEX,EACAl0E,EACA66C,EACA85B,EACAouD,EACAJ,GAAkC,IAAAuF,EAAA3oJ,KAElC,MAAMkvI,EAAUzuH,EAAI4gC,GAAGs3E,UACjBiwB,EAAiBnoI,EAAI4gC,GAAGC,UAAUwjD,gBAClC+jD,EAAkB7oJ,KAAK8oJ,iBAC3BroI,EACA20E,EACA95B,EACAstF,GAEIjvF,EAAU,IAAI3e,IAEpB,IAAIwqB,GACJ/kD,SAAI4gC,GAAGspC,KAAK,iBAAgB,eAAAo+D,MAAArzD,KAAE,UAAOhsE,IACnC,MAAMs/H,GAAYt/H,GAAM9S,OACrBqyI,cACAjoF,qBAAqB,UAElBkoF,SAAwBP,EAAKQ,QAAQN,EAAiBG,IAE5DL,EAAKnG,eAAiB/hI,EAAIyhC,eAAe2hC,UAAU,aAEnD8kE,EAAKS,qBAAqB3oI,EAAKyuH,EAAS0Z,SAClCD,EAAKU,gBAAgB5oI,EAAKyoI,GAAiB9F,GAEjD,MAAMkG,GAAc7oI,EAAIk5C,QAAQ92D,UAAW0mJ,KAEzC,GADAtmH,aAAauiC,IACT+jF,KAAc3zD,KAAcC,KAC9B,OAEFyzD,GAAYn7I,cACZ,IAAIwnF,GAASC,KAAcC,KAC3B,IACgC,IAA1BqzD,GAAgBhqH,OAClBypH,EAAKtD,UAAU1wD,EAAKu0D,GAAiB1F,EAEzC,OACE7tD,GAASC,KAAc5zE,MACvB2mI,EAAK/mJ,eAAewC,MAClB,yCACA,2CAEJ,CACAu1D,EAAQh3D,KAAKgzF,GAAM,GAKrBnwB,GAAUj+D,OAAOo3B,WAAW,KAC1B2qH,GAAYn7I,cAEZ,IAAIwnF,GAASC,KAAcC,KAC3B,IACgC,IAA1BqzD,GAAgBhqH,OAClBypH,EAAKtD,UAAU1wD,EAAKu0D,GAAiB1F,EAEzC,OACE7tD,GAASC,KAAc5zE,MACvB2mI,EAAK/mJ,eAAewC,MAClB,yCACA,2CAEJ,CACAukJ,EAAKS,qBAAqB3oI,EAAKyuH,EAAS0Z,GACxCjvF,EAAQh3D,KAAKgzF,GAAM,EAClB,IACL,GAAC,gBAAA6zD,IAAA,OAAAT,GAAA7yD,MAAAl2F,KAAAm2F,UAAA,EArD2B,IAuDrBx8B,CACT,CAEQmvF,iBACNroI,EACAgpI,EACAnuF,EACAstF,GAEA,MAAM1Z,EAAUzuH,EAAI4gC,GAAGs3E,UACjB+wB,EAAcx9H,KAAKiwE,MAAOstD,EAAY,GAAKnuF,EAAc,MACzDquF,EAAez9H,KAAKiwE,MAAOstD,EAAY,GAAKnuF,EAAc,MAIhE76C,EAAI4gC,GAAG3iB,QADW,CAACgrH,EAAaC,IAEhC,MAAMC,EAAU19H,KAAKE,IACnBs9H,EAAcxa,EAAQ,GACtBya,EAAeza,EAAQ,IAEzBzuH,SAAI4gC,GAAGC,UAAU6rE,cAAcy7B,EAAiBgB,GAEzC,CAACF,EAAaC,EACvB,CAEQP,qBACN3oI,EACAgpI,EACAb,GAEAnoI,EAAI4gC,GAAG3iB,QAAQ+qH,GACfhpI,EAAI4gC,GAAGC,UAAU6rE,cAAcy7B,GAC/BnoI,EAAI4gC,GAAGwoG,aACPppI,EAAI4gC,GAAGyoG,YACT,CAEMX,QACJ7pI,EACA0pI,GAA8C,IAAAe,EAAA/pJ,KAAA,SAAA01F,KAAA,YAE9C,MAAMwzD,EAAkB5gJ,SAASC,cAAc,UAC/C2gJ,EAAgBhqH,MAAQ5f,EAAK,GAC7B4pI,EAAgBjqH,OAAS3f,EAAK,GAE9B,QAASL,EAAQ,EAAGA,EAAQ+pI,EAAUp/I,OAAQqV,IAAS,CACrD,MAAMknI,EAAS6C,EAAU/pI,GACrBknI,EAAOjnH,MAAQ,GACjB6qH,EAAKC,aAAa7D,EAAQ+C,EAE9B,CACA,OAAOA,CAAgB,EAZuB,EAahD,CAEQc,aACN7D,EACA+C,GAEA,MAAMe,EAAmBf,EAAgBgB,WAAW,MAC9CtnG,EAAUujG,EAAOgE,cAAch0I,MAAMysC,SAAWujG,EAAOhwI,MAAMysC,QACnEqnG,EAAiBG,YAA0B,KAAZxnG,EAAiB,EAAIznB,OAAOynB,GAC3D,MAAMxpC,EAAY+sI,EAAOhwI,MAAMiD,UAC/B,IAAIixI,EAGFA,EAFEjxI,EAEOA,EACN8hB,MAAM,wBAAwB,GAC9B5xB,MAAM,KACNmX,IAAI0a,QAEE,CACPijG,WAAW+nB,EAAOhwI,MAAM+oB,OAASinH,EAAOjnH,MACxC,EACA,EACAk/F,WAAW+nB,EAAOhwI,MAAM8oB,QAAUknH,EAAOlnH,OACzC,EACA,GAGJqrH,yBAAyBtvI,UAAUuvI,aAAar0D,MAC9C+zD,EACAI,GAEF,MAAMt0I,EAAkBowI,EAAOgE,cAAch0I,MAAMJ,gBAC/CA,IACFk0I,EAAiBO,UAAYz0I,EAC7Bk0I,EAAiBQ,SAAS,EAAG,EAAGtE,EAAOjnH,MAAOinH,EAAOlnH,SAEvDgrH,EAAiBS,UAAUvE,EAAQ,EAAG,GACtC8D,EAAiBG,YAAc,EAE/BH,EAAiBM,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,EAC/C,CAEMlB,gBACJ5oI,EACA0lI,EACA92G,GAA6B,SAAAqmD,KAAA,YAE7B,MAAM53C,EAAUqoG,EAAO+D,WAAW,MAG5BS,EAAiBlqI,EAAI4gC,GACxBumG,+BACAC,WAAU,GAGb8C,EAAex0I,MAAM+oB,MAAQinH,EAAOjnH,MAAQ,KAC5CyrH,EAAex0I,MAAM8oB,OAASknH,EAAOlnH,OAAS,KAE9C0rH,EAAex0I,MAAMqsC,OAAS,KAE9Bl6C,SACGgvI,uBAAuB,eAAe,GACtCrgD,YAAY0zD,GAOf,MAAMC,QAA0BlzD,IAAYizD,EAAgB,CAC1DrpE,MAAO,EACPvrE,gBAAiB,KACjB80I,YAAY,EACZzE,SAAS,EACT0E,eAAiBziJ,GACRA,aAAmB0iJ,aACtB1iJ,EAAQy2B,UAAU9G,SAAS,oBAKH,IAA5B4yH,EAAkB1rH,OAA4C,IAA7B0rH,EAAkB3rH,QACrD6e,EAAQ4sG,UAAUE,EAAmB,EAAG,GAI1CD,EAAelqJ,QAAS,EAzCK,EA0C/B,CAEckkJ,mBACZhwD,EACAq2D,EACAxH,EACAH,EACAnkH,EACA1tB,EAAoB,GAAC,SAAAkkF,KAAA,YAErB,IAAInkF,EAAoB,EACpB05I,EAA8B,EAC9Bt2D,aAAe21D,0BACjBW,EAAsB,GACtB15I,EACqB,aAAnB8xI,EAAgC,EAAInkH,EAAQ+rH,EAC9Ct2D,EAAI+1D,UACFM,EACAz5I,EACAC,EACAy5I,EACAA,KAGFA,EAAsB,GACtB15I,EAA+B,aAAnB8xI,EAAgC,GAAKnkH,EAAQskH,EAAY,GACrEhyI,EAAYgyI,EAAY,GACxB7uD,EAAImE,SACFkyD,EAAYrzD,YACZpmF,EACAC,EACAy5I,EACAA,GAEH,EA1BoB,EA2BvB,CAMcvG,0BACZr3B,GAAgB,IAAA69B,EAAAlrJ,KAAA,SAAA01F,KAAA,YAEhB,MAAM8J,EAAM0rD,EAAK5iJ,SAASC,cAAc,OACxCi3F,EAAIrpF,MAAMg1I,SAAW,OACrB3rD,EAAIrpF,MAAMi1I,UAAY,OACtB5rD,EAAIrpF,MAAM+8G,UAAY,SAEtB,MAAMn8B,EAAMm0D,EAAK5iJ,SAASC,cAAc,OACxCwuF,EAAIxuD,IAAM,+CACVwuD,EAAI5gF,MAAMg1I,SAAW,OACrBp0D,EAAI5gF,MAAMi1I,UAAY,OACtBr0D,EAAI5gF,MAAMiD,UAAY,UAAYi0G,EAAW,OAC7Ct2B,EAAI5gF,MAAMk8B,QAAU,MACpBmtD,EAAIvI,YAAYF,GAChBm0D,EAAK5iJ,SAASlF,KAAK6zF,YAAYuI,GAC/B,MAAM2mD,QAAezuD,IAAY8H,EAAK,CAAEzpF,gBAAiB,OAEzD,GADAm1I,EAAK5E,kBAAkB9mD,GACnB2mD,EACF,OAAOA,CACR,EAnBe,EAoBlB,CAeAkF,iBACE5qI,EACA6qI,EACA3zH,EAAS,MACTqqB,GAAa,EACbs/B,GAAQ,EACR11E,EAAQ,GACR+3I,EAAW,GACXQ,EAAU,GACV8B,GAAY,EACZ5C,EACAmB,GAAuB,IAAA+G,GAAAvrJ,KAEvB,MAAM25D,GAAU,IAAI3e,IACpBh7C,KAAK00F,WAAa10F,KAAKigE,gBAAgB1+B,WACvC,MAAMhW,GAAYvrB,KAAK2B,gBAAgB4pB,UACvCoM,EAASA,EAAOQ,cAChB,MAAMmjC,IAAcgwF,EACdE,GAAiB/qI,EAAI4gC,GAAGs3E,UACxBiwB,GAAiBnoI,EAAI4gC,GAAGC,UAAUwjD,gBAExCrkF,SAAI4gC,GAAGspC,KAAK,iBAAgB,eAAA8gE,MAAA/1D,KAAE,UAAOhsE,IACnC,MAAMpK,GAAOmB,EAAI4gC,GAAGs3E,UACdqwB,GAAYt/H,GAAM9S,OACrBqyI,cACAjoF,qBAAqB,UAClBkoF,SAAwBqC,GAAKpC,QAAQ7pI,GAAM0pI,IAEjDuC,GAAKnC,qBAAqB3oI,EAAK+qI,GAAgB5C,UAEzC2C,GAAKlC,gBAAgB5oI,EAAKyoI,GAAiB7F,GAG1B,SAAnBA,IAEA,CAAC,UAAW,WAAY,aAAc,eAAe36I,QACnD26I,IACE,QAEEkI,GAAKG,iBACTxC,GACAzoI,EACA66C,GACA+nF,EACA1rH,GAE0B,YAAnB0rH,UACHkI,GAAKvF,qBAAqBvlI,EAAKkX,EAAQsuH,EAAW3qF,MAI5D,MAAMqwF,GAAYrjJ,SAASC,cAAc,UACnCk9C,GAAakmG,GAAUzB,WAAW,MAExC,IAAI0B,GAAkB,EAEtB,MAAM1sH,GAAQgqH,GAAgBhqH,MAC9B,IAAID,GAASiqH,GAAgBjqH,OAE7BwmB,GAAW4tE,KAAO,eAClB,MAAMw4B,GAAepmG,GAAWqmG,YAAY3H,GAASjlH,MAErDD,GAAmB,KAAVrzB,EAAeqzB,GAAS,GAAKA,GAEtCA,GAAsB,KAAb0kH,EAAkB1kH,GAAS,GAAKA,GAEzCA,IAAwB,IAAf+iB,IAAkC,IAAVs/B,EAAkBriD,GAAS,GAAKA,GACjE,MAAM8sH,GAAqB9sH,GAAS,GAE9B+sH,GAAgB9/H,KAAKu9G,KAAKoiB,GAAe3sH,IAE/CD,GAAqB,KAAZklH,EAAiBllH,GAAyB,GAAhB+sH,GAAqB/sH,GACxD,IAAIgtH,GAAmBhtH,GAAyB,GAAhB+sH,GAAqB,EA0CrD,GAxCAL,GAAUzsH,MAAQA,GAClBysH,GAAU1sH,OAASA,GAEf,CAAC,MAAO,MAAO,OAAQ,MAAO,QAAQv2B,QAAQivB,IAAU,IAG7C,SAAXA,GACU,KAAV/rB,GACa,KAAb+3I,GACY,KAAZQ,IACe,IAAfniG,IACU,IAAVs/B,KAEA77B,GAAW+kG,UAAY,UACvB/kG,GAAWglG,SAAS,EAAG,EAAGvrH,GAAOD,IACjCwmB,GAAW+kG,UAAY,WAIb,KAAV5+I,IAGF65C,GAAW4tE,KAAO,eAClBu4B,GAAkB,GAClBnmG,GAAWytE,UAAY,SACvBztE,GAAWymG,SAAStgJ,EAAOszB,GAAQ,EAAG,GAAY,GAARA,KAG3B,KAAbykH,IAGFl+F,GAAW4tE,KAAO,eAClBu4B,GAAkB,GAClBnmG,GAAWytE,UAAY,SACvBztE,GAAWymG,SAASvI,EAAUzkH,GAAQ,EAAG,GAAY,GAARA,KAI/CumB,GAAW4tE,KAAO,gBAEC,IAAfrxE,IAAkC,IAAVs/B,EAAiB,CAC3C,IAAI6qE,GAAsB,GAM1B,IALmB,IAAfnqG,IAEFmqG,GADiB5gI,GAAUshB,QAAQ,gCACF,KAAOpsB,EAAIuhC,WAAa,cAG7C,IAAVs/B,EAAiB,CACnB,MAAMymE,GAAYx8H,GAAUshB,QAAQ,2BAC9Bm7G,GAAWvnI,EAAIyhC,eAAe02E,SAASt9D,IAC7C6wF,IAAuBpE,GAAY,cAAahe,OAAYie,GAC9D,CACAviG,GAAWytE,UAAY,SACvBztE,GAAWymG,SACTC,GACAjtH,GAAQ,EACR6sH,GACQ,GAAR7sH,GAEJ,CAGA,GAAgB,KAAZilH,EAGF,GAFA1+F,GAAWytE,UAAY,SAED,IAAlB84B,GACFvmG,GAAWymG,SAAS/H,EAASjlH,GAAQ,EAAG+sH,QACnC,CAEL,MACMG,GAAqBlgI,KAAKuN,MADV0qH,EAAQv6I,OACwBoiJ,IACtD,IAEIK,GAFAC,GAAqB,GACrBC,GAAuB,EAG3B,QAASn9G,GAAI,EAAGA,GAAI48G,GAAe58G,KAE7B48G,GAAgB,EAAI58G,IAEtBk9G,GAAqBnI,EAAQ75F,OAC3BiiG,GACAH,IAGFC,GAAoBC,GAAmB/hG,YAAY,KACnD9E,GAAWymG,SACTI,GAAmBhiG,OAAO,EAAG+hG,IAC7BntH,GAAQ,EACR+sH,IAEFM,IAAwBF,GAExBJ,IAAoB,IAGpBxmG,GAAWymG,SACT/H,EAAQ75F,OAAOiiG,IACfrtH,GAAQ,EACR+sH,GAIR,CAKF,GAFAxmG,GAAWilG,UAAUxB,GAAiB,EAAG0C,IAErCpH,EAAgB,CAClB,MAAMC,SAAyB8G,GAAK7G,0BAClCjkI,EAAIyhC,eAAeu2E,qBAEf8yB,GAAK5G,mBACTl/F,GACAg/F,GACA,KACApB,EACAnkH,GACA0sH,GAEJ,CAEA,IAAIj2D,GAASC,KAAcC,KACvB22D,GAAkB,OAAS70H,EACF,SAAzBA,EAAOQ,gBACTq0H,GACE,MAAQ/rI,EAAIuhC,WAAWtpB,QAAQ,IAAK,KAAO,IAAMf,GAGrD,IAEOsuH,GAEMtuH,EAAOQ,cAEhBozH,GAAKhF,uBAAuBoF,GAAWa,KAHvCjB,GAAK/E,sBAAsBmF,GAAWa,GAAiB70H,EAQ3D,OACEg+D,GAASC,KAAc5zE,KACzB,CAGA,GAFA23C,GAAQh3D,KAAKgzF,IAEgB,SAAzBh+D,EAAOQ,cAA0B,CACnC,MAAMs0H,GACJD,GAAgBE,UACd,EACAF,GAAgBr0H,cAAczvB,QAAQ,UACpC,OACAikJ,GAAapB,GAAKqB,wBAAwBnsI,GAC1CsoB,GAAO,IAAI64E,KAAK,CAAC+qC,IAAa,CAClCnpJ,KAAM,6BAEHyiJ,EAMHsF,GAAKsB,aAAaJ,GAAoB1jH,MAAI,EAJ1C+jH,UAAO/jH,GAAM0jH,IACblB,GAAKwB,qBAKT,CACF,GAAC,gBAAAC,IAAA,OAAAvB,GAAAv1D,MAAAl2F,KAAAm2F,UAAA,EAxN2B,IA0N5Bn2F,KAAKitJ,sBAAsBxsI,EAAK+qI,GAAgBlwF,GAAYstF,IAErDjvF,EACT,CAEQszF,sBACNxsI,EACA+qI,EACAlwF,EACAstF,GAEA,MAAMsE,EAAc5xF,EAAa,GAC3B6xF,EAAa,CACjBjhI,KAAKiwE,MAAMqvD,EAAe,GAAK0B,GAC/BhhI,KAAKiwE,MAAMqvD,EAAe,GAAK0B,IAEjCzsI,EAAI4gC,GAAG3iB,QAAQyuH,GACf,MAAMvD,EAAU19H,KAAKE,IACnB+gI,EAAW,GAAK3B,EAAe,GAC/B2B,EAAW,GAAK3B,EAAe,IAEpB/qI,EAAI4gC,GAAGC,UACf6rE,cAAcy7B,EAAiBgB,GACpCnpI,EAAI4gC,GAAGyoG,YACT,CAUc4B,iBACZvF,EACA1lI,EACA66C,EACA+nF,EACA1rH,GAAc,IAAAy1H,EAAAptJ,KAAA,SAAA01F,KAAA,YAEd,MAAM82D,EAAkB,OAAS70H,EAC3BmmB,EAAUqoG,EAAO+D,WAAW,MAG5Bj1I,QAAam4I,EAAK9H,oBACtB7kI,EACA0lI,EAAOjnH,MACPo8B,GACA4qF,YAEF,GAAa,KAATjxI,EACF,aAAMm4I,EAAK5G,sBAAsBL,EAAQqG,EAAiB70H,IACnD,EAGT,MAAM6nE,EAAMj4F,OAAOe,SAASC,cAAc,OAC1Ci3F,EAAIrpF,MAAMk5B,SAAW,WACrBmwD,EAAIrpF,MAAMiiF,IAAM,IAChBoH,EAAIrpF,MAAMqsC,OAAS,KAEnBj7C,OAAOe,SAASlF,KAAK6zF,YAAYuI,GACjCA,EAAIlpF,UAAYrB,QACVm4I,EAAK5nF,QAAQ,GACnB,MAAM6nF,QAAqB31D,IAAY8H,EAAK,CAAE4mD,SAAS,IAAQC,MAC5D16G,KACCu3B,QAAQK,IAAI53B,GAAC,GAIjB,GAAI0hH,EAAc,CAChB,MAAMC,GAAenH,EAAOlnH,OACtBsuH,GAAcpH,EAAOjnH,MACrBsuH,GAAeH,EAAapuH,OAC5BwuH,GAAcJ,EAAanuH,MAE3BwQ,GAAwB,IAAf49G,GACf,IAAII,GACAC,GAEJ,MAAuB,gBAAnBtK,GACFqK,GAAUH,GAAcE,GAAc/9G,GACtCi+G,GAAUL,GAAeE,GAAe99G,IACZ,aAAnB2zG,GACTqK,GAAUH,GAAcE,GAAc/9G,GACtCi+G,GAAUj+G,IACkB,eAAnB2zG,GACTqK,GAAUh+G,GACVi+G,GAAUL,GAAeE,GAAe99G,GAAS,IACrB,YAAnB2zG,IACTqK,GAAUh+G,GACVi+G,GAAUj+G,IAGZoO,EAAQ4sG,UACN2C,EACAK,GACAC,GACAF,GACAD,IAEF1vG,EAAQ8vG,WAAWF,GAASC,GAASF,GAAaD,IAClDJ,EAAK9G,kBAAkB9mD,IAChB,CACT,CAAC,EAjEa,EAkEhB,CAEQquD,UAAUptI,EAAKnB,EAAMkxD,GAC3B/vD,EAAI4gC,GAAGwoG,aACPppI,EAAI4gC,GAAGyoG,YACT,CAMgBhF,QAAQnwD,GAAU,SAAAe,KAAA,kBAC1Bf,EAAInoC,KAAK,iBAAkB,CAAEwpC,eAAe,GAAQ,EAD1B,EAElC,CAQAyyD,qBAAqB9zD,EAAKwxD,EAAQjxD,GAEhC,MAAMF,EACJL,EAAIM,SAAS1qE,SAAS8uE,aAAenE,EAAQ,GAAKA,EAAQ,IACtDH,EACJJ,EAAIM,SAAS1qE,SAAS+uE,YAAcpE,EAAQ,GAAKA,EAAQ,IACrD44D,EAAY9tJ,KAAKilJ,iBAAiBkB,EAAOlnH,OAAQ,MACjD8uH,EAAW/tJ,KAAKilJ,iBAAiBkB,EAAOjnH,MAAO,MAE/C8uH,EAAcF,EAAY94D,EAC1Bi5D,EAAaF,EAAWh5D,EACxBm5D,EAAWF,EAAcC,EAAaD,EAAcC,EAG1D,MAAO,CADUC,EAAW,EAAIH,EAAWG,EAAWH,EADrCG,EAAW,EAAIJ,EAAYI,EAAWJ,EAGzD,CAMQlB,wBAAwBnsI,GAC9B,MAAM0tI,EAAoB1tI,EAAIyhC,eAAe4iD,gBACvC6kB,EAAgBlpG,EAAIyhC,eAAe2hC,YACzC,MAAO,CACLsqE,EACA,EACA,GACCA,EACDxkC,EAAc,GAAKwkC,EAAoB,GACvCxkC,EAAc,GAAKwkC,EAAoB,IACvCtkJ,KAAK,KACT,CAQQ28I,sBAAsBL,EAAQiI,EAAaz2H,GACjD,MAAM02H,EAAa,SAAW12H,EACxB22H,EAAOtuJ,KAEb,IACEmmJ,EAAOxuD,YACPwuD,EAAOoI,OAAQxlH,KAEb+jH,YAAO/jH,EAAMqlH,GACbE,EAAKvB,oBAAkB,EACtBsB,EACL,OACEruJ,KAAK4B,eAAewC,MAClB,yCACA,2CAEJ,CACF,CAOQmiJ,uBAAuBJ,EAAQn3H,GACrC,MACMs/H,EAAOtuJ,OAEVA,KAAK2a,eAAe,mBACd3a,KAAKsiJ,QAAY,OAExBtiJ,KAAKsiJ,QAAU,IAAIkM,MAGrB,IACErI,EAAOxuD,YACHzsB,UAAUujF,WACZzuJ,KAAK6sJ,aAAa79H,EAAMm3H,EAAOuI,YAE/BvI,EAAOoI,OAAQxlH,IACbulH,EAAKzB,aAAa79H,EAAM+Z,EAAI,EAff,aAkBnB,OACE/oC,KAAK4B,eAAewC,MAClB,yCACA,2CAEJ,CACF,CAOQyoJ,aAAa79H,EAAM+Z,GAEzB/oC,KAAKsiJ,QAAQp9F,KAAKl2B,EAAM+Z,GACxB/oC,KAAKuiJ,kBAGwB,IAAzBviJ,KAAKuiJ,kBAEPviJ,KAAK2uJ,aAEL3uJ,KAAKigE,gBAAgBI,WAAWrgE,KAAK00F,YAEzC,CAEQq4D,qBACN/sJ,KAAKuiJ,kBAGwB,IAAzBviJ,KAAKuiJ,iBAEPviJ,KAAKigE,gBAAgBI,WAAWrgE,KAAK00F,WAEzC,CAMQi6D,aACN,MAAML,EAAOtuJ,KACbA,KAAKsiJ,QAAQsM,cAAc,CAAEprJ,KAAM,SAAUi6H,KAAM10F,KAEjD+jH,YAAO/jH,EAAM,kBACNulH,EAAKhM,SAEhB,CAEQ2C,iBAAiB18C,EAAGzT,GAC1B,IAAI9uD,EAAI,EAKR,OAAQ8uD,GACN,IAAK,KACH9uD,EAAI,EACJ,MACF,IAAK,KACHA,EAAI,GAAK,KACT,MACF,IAAK,KACHA,EAAI,GAAK,KACT,MACF,IAAK,KACHA,EAAI,GACJ,MACF,IAAK,KACHA,EAAI,GAAK,GACT,MACF,IAAK,KAGL,IAAK,KACHA,EAAI,GACJ,MACF,IAAK,KACHA,EAAI,EACJ,MACF,QACE,MAAM,IAAIhkB,MAAM,iBAAmB8yE,GAGvC,OAAOyT,EAAIviE,CACb,4CA5/CWq8G,GAAYjhJ,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAuBbs4F,MAAQ,iCAvBP2oD,EAAYhhJ,QAAZghJ,EAAY/gJ,UAAAC,WAFX,gBAED8gJ,CAAY,mHErClB,MAAMwM,KAAoBC,MAAQ,CAAC,MAAO,UAIpClL,KAAmBkL,MAAQ,CACtC,KACA,KACA,KACA,KACA,KACA,KACA,SACA,UAIWC,KAAmBD,MAAQ,CAAC,YAAa,aAGzCE,EAAkB,CAAC,KAAM,KAAM,MAAO,OAGtCC,KAAuBH,MAAQ,CAC1C,MACA,MACA,OACA,MACA,SAIWv5D,KAAsBu5D,MAAQ,CACzC,OACA,WACA,UACA,aACA,cACA,sMCGK,IAAMI,EAAc,MAArB,MAAOA,EA0DO9yI,UACRuxE,aAvDFwhE,UAA4B,GAK5BhlD,iBAKAC,wBAKAC,8BAKC+kD,eAAyB,EAKzBC,0BAAoC,EAKpCC,uBAKAC,mBAA6B,EAK5BzgD,MAAQ,IAAIxhG,MAStB,OAAImT,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA1gB,YACkBqc,EACRuxE,GADQ3tF,KAAAoc,YACRpc,KAAA2tF,cACP,CAMHj6C,kBACE1zC,KAAK8qG,mBACL9qG,KAAKgrG,uBACP,CAMA98F,cACElO,KAAKwvJ,uBACLxvJ,KAAK2qG,qBACL3qG,KAAK4qG,0BACP,CAKQE,mBACN9qG,KAAKmqG,iBAAmBnqG,KAAKygB,IAAI4gC,GAAG/R,GAClC,cACC5lB,GAAuC1pB,KAAKm8H,WAAWzyG,GAE5D,CAKQihF,sBACNU,OAAQrrG,KAAKmqG,kBACbnqG,KAAKmqG,sBAAmBnoG,CAC1B,CAMQm6H,WAAWzyG,GAEjB,GADA1pB,KAAKwvJ,wBACAxvJ,KAAK2tF,aAAaiB,aACrB,OAGF,MAAM6gE,EAAW,GACbzvJ,KAAKovJ,eACPK,EAASnoJ,KAAKtH,KAAK0vJ,gBAAgBhmI,IAGrC,MAAM4xC,EAAat7D,KAAKygB,IAAI4gC,GAAGC,UAAUwjD,gBACnC6qD,EAAc3vJ,KAAKygB,IAAIq/B,OAAOp2C,OAAOkmJ,MAC3CH,EAASnoJ,QACJtH,KAAK2tF,aAAamhB,MAAM6gD,EAAa,CACtCzpE,YAAax8D,EAAMohE,WACnB9oC,WAAYhiD,KAAKygB,IAAIuhC,WACrBsZ,gBAIoB,IAApBm0F,EAAS7lJ,SAIT5J,KAAKuvJ,kBACPvvJ,KAAKmvJ,UAAU7nJ,QACb2/G,QAAOwoC,GAAU5sJ,UAAWu8E,KAC1B,MAAM70E,EAAW,GAAGoW,UAAUy+D,IAC9Bp/E,KAAK8uG,MAAM1gG,KAAK,CAAE7D,WAAUmf,SAAO,IAIvC1pB,KAAKmvJ,UAAYM,EAAShvI,IAAKovI,IACtBA,GAAOhtJ,UAAW0H,IACvBvK,KAAK8uG,MAAM1gG,KAAK,CAAE7D,WAAUmf,SAAO,IAI3C,CAMQgmI,gBACNhmI,GAEA,MAAMomI,EAAkB,GAExB,GAAmB,gBAAfpmI,EAAMlmB,KACRxD,KAAKygB,IAAI4gC,GAAGm7E,sBACV9yG,EAAM8hF,MACN,CAACukD,EAAsBrzB,KACrB,MAAMj6E,GAAQziD,KAAKygB,IAAIqjH,aAAapH,EAAQszB,QAAQlqB,OAAO5zH,IAC3D,IACGuwC,GAAMpsB,WAAWx2B,QACfowJ,kBAIDF,EACF,GAAIA,EAAU7vJ,IAAI,YAChB,UAAW4K,KAAWilJ,EAAU7vJ,IAAI,YAAa,CAC/C,MAAMgwJ,KAAa1tD,MAAc13F,EAAS9K,KAAKygB,IAAIuhC,YACnDkuG,EAAW7xI,KAAO,CAChBzS,MAAOd,EAAQklJ,QAAQG,IACvBj+I,GAAIwqH,EAAQszB,QAAQlqB,OAAO5zH,GAAK,IAAMpH,EAAQslJ,IAC9CzkJ,KAAMb,EAAQklJ,QAAQ/nH,MACtBooH,YAAa3zB,EAAQszB,QAAQpkJ,MAC7B8xE,MAAO19E,KAAK2tF,aAAa2iE,yBAAyB7tG,KAGpDqtG,EAAgBxoJ,KAAK4oJ,EACvB,SACSH,aAAqBQ,KAAiB,CAC/C,MAAML,KAAazuD,MACjBsuD,EACA/vJ,KAAKygB,IAAIuhC,WACT06E,GAEFwzB,EAAW7xI,KAAO,CAChBnM,GAAIwqH,EAAQszB,QAAQlqB,OAAO5zH,GAAK,IAAMg+I,EAAW7xI,KAAKnM,GACtDm+I,YAAa3zB,EAAQszB,QAAQpkJ,MAC7B8xE,MAAO19E,KAAK2tF,aAAa2iE,yBAAyB7tG,IAClD72C,MACE5L,KAAK2tF,aAAa6iE,cAAcN,EAAYztG,KAC5CytG,EAAW7xI,KAAKzS,OAEpBkkJ,EAAgBxoJ,KAAK4oJ,EACvB,KAAO,CACL,MAAMA,KAAa1tD,MACjButD,EACA/vJ,KAAKygB,IAAIuhC,WACT06E,GAEFwzB,EAAW7xI,KAAO,CAChBnM,GAAIwqH,EAAQszB,QAAQlqB,OAAO5zH,GAAK,IAAMg+I,EAAW7xI,KAAKnM,GACtDm+I,YAAa3zB,EAAQszB,QAAQpkJ,MAC7B8xE,MAAO19E,KAAK2tF,aAAa2iE,yBAAyB7tG,IAClD72C,MACE5L,KAAK2tF,aAAa6iE,cAAcN,EAAYztG,KAC5CytG,EAAW7xI,KAAKzS,OAEpBkkJ,EAAgBxoJ,KAAK4oJ,EACvB,GAGJ,CACE//D,aAAcnwF,KAAKqvJ,2BAA6B,EAChD5jD,YAAazrG,KAAKsvJ,uBACdtvJ,KAAKsvJ,uBACLmB,YACL,GAEqB,WAAf/mI,EAAMlmB,KAAmB,CAElC,MAAMktJ,EADShnI,EAAM9S,OACKu2E,cAActJ,YACxC7jF,KAAKygB,IAAIq/B,OACNp2C,OAAOkmJ,MACPlmJ,OAAQ+4C,IAAUA,cAAiBsZ,KAAetZ,GAAM5rB,SACxDpW,IAAKgiC,KACeA,GAAMpsB,WAAWgrB,GACzBsvG,iCACTD,EACC/jE,IACC,MAAMujE,KAAsB1tD,MAC1B7V,EACA3sF,KAAKygB,IAAIuhC,WACTS,GAAMpB,IAER6uG,EAAW7xI,KAAO,CAChBnM,GAAIuwC,GAAMvwC,GAAK,IAAMy6E,EAAU/P,QAC/BjxE,KAAMghF,EAAUqjE,QAAQ/nH,MACxBooH,YAAa5tG,GAAM72C,MACnB8xE,MAAO19E,KAAK2tF,aAAa2iE,yBAAyB7tG,IAClD72C,MACE5L,KAAK2tF,aAAa6iE,cAAcN,EAAYztG,KAC5CytG,EAAW7xI,KAAKzS,OAEpBkkJ,EAAgBxoJ,KAAK4oJ,EAAU,EAChC,EAGT,CAEA,SAAOtsJ,MAAGksJ,EACZ,CAKQN,uBACNxvJ,KAAKmvJ,UAAU50I,QAAS8R,GAAsBA,EAAIle,eAClDnO,KAAKmvJ,UAAY,EACnB,CAKQnkD,wBACN,IAAI4lD,EACJ,MAAMjlD,EAAiB3rG,KAAKygB,IAAI4gC,GAAGuqD,kBAAkB9a,WAKrD,UAAWZ,KAAiByb,EAC1B,GAAIzb,aAAyB+Z,IAAyB,CACpD2mD,EAAiC1gE,EACjC,KACF,MAGqCluF,IAAnC4uJ,IACFA,EAAiC,IAAI3mD,IAAwB,CAC3D19D,UAAW++D,OAEbtrG,KAAKygB,IAAI4gC,GAAGsvC,eAAeigE,GAC3B5wJ,KAAKoqG,wBAA0BwmD,GAGjC5wJ,KAAKqqG,8BAAgCumD,EAA+BthH,GAClE,SACC5lB,GAAuC1pB,KAAKm8H,WAAWzyG,GAE5D,CAKQkhF,gCACqC5oG,IAAvChC,KAAKqqG,gCAAkCroG,EACzCqpG,KAAQrrG,KAAKqqG,oCAEsBroG,IAAjChC,KAAKoqG,yBACPpqG,KAAKygB,IAAI4gC,GAAGuuC,kBAAkB5vF,KAAKoqG,yBAErCpqG,KAAKoqG,6BAA0BpoG,CACjC,4CA9SWktJ,GAAc9tJ,MAAAuE,IAAA,GAAAvE,MAAAwE,KAAA,+BAAdspJ,EAAc5gJ,UAAA,qBAAAC,OAAA,CAAA6gJ,cAAA,gBAAAC,0BAAA,4BAAAC,uBAAA,yBAAAC,kBAAA,qBAAA/gJ,QAAA,CAAAsgG,MAAA,SAAArgG,YAAA,WAAdygJ,CAAc,0EC1CpB,IAAK79E,EAAZ,SAAYA,GACVA,SAAAL,KAAA,OACAK,EAAAN,KAAA,OACAM,EAAAp5C,KAAA,OACAo5C,EAAAR,QAAA,UACAQ,EAAAP,SAAA,WACAO,EAAAw/E,SAAA,WACAx/E,EAAAy/E,KAAA,OACAz/E,EAAAn0D,KAAA,OACAm0D,EAAA0/E,SAAA,WATU1/E,CAUZ,CAVA,CAAYA,GAAW,IAYXT,EAAZ,SAAYA,GACVA,SAAAI,KAAA,0BACAJ,EAAAG,KAAA,gCACAH,EAAA34C,KAAA,mBACA24C,EAAAC,QAAA,sBACAD,EAAAE,SAAA,UACAF,EAAAigF,SAAA,mBACAjgF,EAAAkgF,KAAA,aACAlgF,EAAA1zD,KAAA,YACA0zD,EAAAmgF,SAAA,YATUngF,CAUZ,CAVA,CAAYA,GAAmB,IAYnBgJ,EAAZ,SAAYA,GACVA,SAAAo3E,OAAA,SACAp3E,EAAAC,MAAA,SAFUD,CAGZ,CAHA,CAAYA,GAAe,kTCuBpB,IAAMq3E,EAAY,MAAnB,MAAOA,EAQDxvJ,KACAG,eARHgtF,cAAe,EACfsiE,oBAAsB,GACtBC,aAAe,GAEdC,mBAAqB,GAE7BrxJ,YACU0B,EACAG,GADA5B,KAAAyB,OACAzB,KAAA4B,gBACP,CAEHktG,MAAMhvD,EAAiBjgD,GACjBG,KAAKoxJ,mBAAmBxnJ,QAC1B5J,KAAKoxJ,mBAAmB72I,QAASrI,IAC/BlS,KAAK4B,eAAenB,OAAOyR,EAAE,GAIjC,MAAMqyH,EAAYzkF,EACfp2C,OAAQ+4C,GAAiBA,EAAM5rB,SAAW4rB,EAAM2hE,sBAChD3jG,IAAKgiC,GAAiBziD,KAAKqxJ,WAAW5uG,EAAO5iD,IAKhD,MADgB,GAAG8gB,OAAOu1E,MAAM,GAAIquC,EAEtC,CAEA8sB,WACE5uG,EACA5iD,GAEA,MAAM0C,EAAMvC,KAAKsxJ,YACf7uG,EAAMpsB,WACNx2B,GACA,EACA4iD,EAAMhiC,IAAIyhC,eAAe2hC,aAE3B,IAAKthF,EACH,SAAOqB,MAAG,IAGZ,MAAM03D,EAAqB7Y,EAAMhiC,IAAIyhC,eAAe4iD,gBAC9CxjB,EAAgB7+B,EAAMhiC,IAAIyhC,eAAe02E,WAE/C,GACGn2E,EAAMpsB,WAAmCx2B,QAAQ6wE,cAClDW,KAAY0/E,SACZ,CACA,GAAmB,iBAARxuJ,EAAkB,CAC3B,MAAMgvJ,EAASvxJ,KAAKsxJ,YAClB7uG,EAAMpsB,WACNx2B,GACA,GAEF,OAAOG,KAAKyB,KAAKvB,IAAIqxJ,EAAQ,CAAE3oH,aAAc,SAAU7kC,QACrDy7C,KAAUgyG,IACR,MAAMC,EAAYzxJ,KAAK0xJ,SAASF,EAAQjvJ,EAAKkgD,GACvCkvG,EAAcF,EAAU,GACxBG,EAAoBH,EAAU,GACpC,OAAOzxJ,KAAKyB,KACTvB,IAAIqC,EAAK,CAAEqmC,aAAc,SACzB7kC,QACC0c,KAAKk9B,IACH39C,KAAK6xJ,YACHl0G,GACA8E,EACA5iD,EACA0C,EACAovJ,EACAC,IAEH,GAIX,CACA,MAAME,EAAU9xJ,KAAKsxJ,YAAY7uG,EAAMpsB,WAAYx2B,GAAS,GAC5D,IAAIw2E,EAAmB,GACvB,QAASjnC,EAAI,EAAGA,EAAI0iH,EAAQloJ,OAAQwlC,IAAK,CACvC,MAAM/mC,EAAUypJ,EAAQ1iH,GACpBpvC,KAAK+xJ,wBAAwBz2F,EAAYgmB,EAAOj5E,IAClDguE,EAAY/uE,KACVtH,KAAKgyJ,uBAAuB3pJ,EAAQ9F,IAAKA,EAAI6sC,GAAG7sC,IAAKkgD,EAAO5iD,GAGlE,CACA,OAAOw2E,CACT,CAAO,CACL,GAAmB,iBAAR9zE,EAET,OADgBvC,KAAKyB,KAAKvB,IAAIqC,EAAK,CAAEqmC,aAAc,SACpC7kC,QACb0c,KAAKk9B,GAAQ39C,KAAK6xJ,YAAYl0G,EAAK8E,EAAO5iD,EAAS0C,KAGvD,IAAI8zE,EAAmB,GACvB,QAASjnC,EAAI,EAAGA,EAAI7sC,EAAIqH,OAAQwlC,IAAK,CACnC,MAAM/mC,EAAwB9F,EAAI6sC,GAClC,GAAIpvC,KAAK+xJ,wBAAwBz2F,EAAYgmB,EAAOj5E,GAAU,CAC5D,MAAM83C,EAAUngD,KAAKyB,KAAKvB,IAAImI,EAAQ9F,IAAK,CAAEqmC,aAAc,SAC3DytC,EAAY/uE,KACV64C,EAAQp8C,QACN0c,KAAKk9B,GAAQ39C,KAAK6xJ,YAAYl0G,EAAK8E,EAAO5iD,EAASwI,EAAQ9F,OAGjE,CACF,CACA,OAAO8zE,CACT,CACF,CAEQ27E,uBACNT,EACAhvJ,EACAkgD,EACA5iD,GAEA,OAAOG,KAAKyB,KAAKvB,IAAIqxJ,EAAQ,CAAE3oH,aAAc,SAAU7kC,QACrDy7C,KAAUgyG,IACR,MAAMC,EAAYzxJ,KAAK0xJ,SAASF,EAAQjvJ,EAAKkgD,GACvCkvG,EAAcF,EAAU,GACxBG,EAAoBH,EAAU,GACpC,OAAOzxJ,KAAKyB,KACTvB,IAAIqC,EAAK,CAAEqmC,aAAc,SACzB7kC,QACC0c,KAAKk9B,GACH39C,KAAK6xJ,YACHl0G,EACA8E,EACA5iD,EACA0C,EACAovJ,EACAC,IAEH,GAIX,CAEQG,wBACNz2F,EACAgmB,EACAj5E,GAEA,IAAI4pJ,EACAC,EAEJ,QACG7pJ,EAAQupE,eACRvpE,EAAQopE,eACRppE,EAAQorE,UACRprE,EAAQmrE,YAKLnrE,EAAQupE,eAAiBvpE,EAAQopE,cAGjCnW,GAAcjzD,EAAQupE,eACtBtW,GAAcjzD,EAAQopE,gBAEtBygF,GAAkB,IAIhB7pJ,EAAQupE,eAAiBtW,GAAcjzD,EAAQupE,gBACjDsgF,GAAkB,GAEhB7pJ,EAAQopE,eAAiBnW,GAAcjzD,EAAQopE,gBACjDygF,GAAkB,IAKlB7pJ,EAAQorE,UAAYprE,EAAQmrE,SAE1B8N,EAAQj5E,EAAQorE,UAAY6N,EAAQj5E,EAAQmrE,WAC9Cy+E,GAAa,IAIX5pJ,EAAQmrE,UAAY8N,GAASj5E,EAAQmrE,WACvCy+E,GAAa,GAEX5pJ,EAAQorE,UAAY6N,GAASj5E,EAAQorE,WACvCw+E,GAAa,KAKE,IAAfA,IAA2C,IAApBC,IAGJ,IAApBA,IAA6BD,IACd,IAAfA,IAAwBC,EAO/B,CAEQR,SACNF,EACAjvJ,EACAkgD,GAGA,IAAIl4C,GADW,IAAIi5E,KACGr8B,aAAaqqG,GAEX,IAApBjnJ,EAASX,SAEXW,GADkB,IAAIwtE,KACD5wB,aAAaqqG,IAEpC,MAAMW,EAAU,IAAIC,IAAuB,IAC3C,IAAIC,EACJ,MAAMC,EAAW,GACjB,IACIC,EADAC,EAAU,IAAIJ,IAAoB,IAEtC,MAAMK,EAAaloJ,EAASX,OAMtB03I,GAFoBthJ,KAAK0yJ,eAAenwJ,EAAI41B,eACrBmpH,KACRh4I,MAAM,KACrBqpJ,GAAa/vD,OAGnB,IAAIgwD,GACAC,GAyDAC,GAaAC,GArEJ,GAJAnwD,KAAgB+vD,GAAYrR,IAIxB7+F,EAAM5iD,SAAS4jB,QAAQ5jB,QAAS,CAClC,MAAMy9E,GAAoB76B,EAAM5iD,QAAQ4jB,OACrC5jB,QACCy9E,GAAkBzJ,aACpBg/E,GAAiBv1E,GAAkBzJ,WAEvC,CAgEA,OA/DAtpE,EAASkW,IAAK3V,KACZ,GAAI+nJ,GAAgB,CAClB,IAAIG,GAAoBloJ,GAAQ20E,gBAAgBozE,IAC5CG,KACFJ,GAAgBA,GAEZ,GAAGA,MAAgBI,KADnBA,GAGR,CAKA,MAAMC,GACJnoJ,GAAQqiF,cACRtrC,iBACIqxG,GAAsBpoJ,GAAQqiF,cAAc8U,UAMhD,QAJGswD,IACHA,EAAmBW,IAGXA,IACN,IAAK,QACgB,IAAfT,EACFJ,EAAM,IAAID,IAAaa,GAA4B,MAEnDX,EAAShrJ,KAAK2rJ,IAEhB,MACF,IAAK,aACHd,EAAQgB,iBACN,IAAIf,IAAkBa,GAA4B,OAEpD,MACF,IAAK,UACHT,EAAQY,cACN,IAAIhB,KAAea,GAA4B,OAEjD,MACF,IAAK,eACHT,EAAU,IAAIJ,IAAoBa,GAA4B,MAC9D,MACF,QACE,OACJ,GAMFH,GADsB,IAApBR,EAAS1oJ,QAAgByoJ,EAClB,CACP7uJ,KAAM6uJ,EAAIpwD,UACV/b,YAAamsE,EAAIxwG,kBAGV,CACPr+C,KAAM,UACN0iF,YAAa,CAAClmF,KAAKqzJ,WAAWf,KAK1BC,GACN,IAAK,aACHQ,GAAiB,CACfvvJ,KAAM2uJ,EAAQlwD,UACd/b,YAAaisE,EAAQtwG,kBAEvB,MACF,IAAK,QACHkxG,GAAiBD,GACjB,MACF,IAAK,UAML,IAAK,eACHC,GAAiB,CACfvvJ,KAAMgvJ,EAAQvwD,UACd/b,YAAassE,EAAQ3wG,kBAI3B,MAAM+vG,GAAoB,GAE1B,OAAIiB,KACFjB,GAAkBiB,IAAkBD,IAG/B,CAACG,GAAgBnB,GAC1B,CAEA0B,MAAMhxG,EAAGC,EAAGgxG,GACV,OAAQjxG,EAAE,GAAKixG,EAAE,KAAOhxG,EAAE,GAAKgxG,EAAE,KAAOjxG,EAAE,GAAKixG,EAAE,KAAOhxG,EAAE,GAAKgxG,EAAE,GACnE,CAOAF,WAAW5/B,GACTA,EAAOjxG,KAAK,CAAC8/B,EAAGC,IACPD,EAAE,KAAOC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,IAGhD,MAAMixG,EAAQ,GACd,UAAWjqE,KAASkqC,EAAQ,CAC1B,KACE+/B,EAAM5pJ,QAAU,GAChB5J,KAAKszJ,MAAME,EAAMA,EAAM5pJ,OAAS,GAAI4pJ,EAAMA,EAAM5pJ,OAAS,GAAI2/E,IAAU,GAEvEiqE,EAAMx4H,MAERw4H,EAAMlsJ,KAAKiiF,EACb,CAEA,MAAMkqE,EAAQ,GACd,QAASrkH,EAAIqkF,EAAO7pH,OAAS,EAAGwlC,GAAK,EAAGA,IAAK,CAC3C,KACEqkH,EAAM7pJ,QAAU,GAChB5J,KAAKszJ,MACHG,EAAMA,EAAM7pJ,OAAS,GACrB6pJ,EAAMA,EAAM7pJ,OAAS,GACrB6pH,EAAOrkF,KACJ,GAELqkH,EAAMz4H,MAERy4H,EAAMnsJ,KAAKmsH,EAAOrkF,GACpB,CAEAqkH,SAAMz4H,MACNw4H,EAAMx4H,MACCw4H,EAAM7yI,OAAO8yI,EACtB,CAEQ5B,YACNl0G,EACA8E,EACA5iD,EACA0C,EACAmxJ,EACA9B,GAEA,MAAM+B,EAAkBlxG,EAAMpsB,WAExBqpE,EAAwB1/F,KAAKswJ,yBAAyB7tG,GAC5D,IAAIl4C,EAAW,GACf,OAAQopJ,EAAgB9zJ,QAAQ6wE,aAC9B,KAAKW,KAAYN,KACfxmE,EAAWvK,KAAK4zJ,gBACdj2G,EACA8E,EAAMD,OACNk9C,GAEF,MACF,KAAKruB,KAAYp5C,KACjB,KAAKo5C,KAAYR,QACjB,KAAKQ,KAAYP,SACfvmE,EAAWvK,KAAK6zJ,mBACdl2G,EACA8E,EAAMD,OACNk9C,GAEF,MACF,KAAKruB,KAAYw/E,SACftmJ,EAAWvK,KAAK8zJ,oBACdn2G,EACA8E,EAAMD,OACNk9C,GAEF,MACF,KAAKruB,KAAYy/E,KACfvmJ,EAAWvK,KAAK+zJ,gBAAgBp2G,GAChC,MACF,KAAK0zB,KAAYn0D,KACf3S,EAAWvK,KAAKg0J,gBACdr2G,EACAg2G,EAAgBh6E,gBAChBp3E,GAEF,MACF,KAAK8uE,KAAY0/E,SACfxmJ,EAAWvK,KAAKg0J,gBACdr2G,EACAg2G,EAAgBh6E,gBAChBp3E,EACAmxJ,EACA9B,GAEF,MAEF,QACErnJ,EAAWvK,KAAKi0J,gBAAgBt2G,EAAK8E,EAAOi9C,GAGhD,GACEn1F,EAASX,OAAS,IACQ,OAAzBW,EAAS,GAAG++E,WAAsB/+E,EAAS,GAAG++E,UAC/C,CACA,MAAM4qE,EAAYl0J,KAAKm0J,2BAA2B5xJ,GAElD,UAAWuI,MAAWP,EACpBO,GAAQw+E,SAAW4qE,CAEvB,CAEA,MAAME,EAAgB3xG,EAAMpsB,WAK5B,IAJqB+9H,EAAcrtJ,QAAQstJ,cACvC,IAAIrqJ,OAAO,iBAAmBhK,KAAKmxJ,cACnC,IAAInnJ,OAAO,iBAAmBhK,KAAKkxJ,sBAGxBhnJ,KAAK3H,KAChB6xJ,EAAcrtJ,QAAQstJ,eACtBr0J,KAAKmxJ,aAAe,GACpB5mJ,EAASX,SAAW5J,KAAKmxJ,eACvBiD,EAAcrtJ,QAAQstJ,eACtB9pJ,EAASX,SAAW5J,KAAKkxJ,qBAC7B,CACA,MAAM1yF,EAAax+D,KAAK4B,eAAek9D,KACrC,qCACA98D,OACAA,EACA,CAAE0E,MAAO+7C,EAAM72C,QAEjB5L,KAAKoxJ,mBAAmB9pJ,KAAKk3D,EAAWC,QAC1C,CAEA,OAAOl0D,EAASkW,IAAI,CAAC3V,EAAkBmU,MACrC,MAAMy6D,GAAW5uE,EAAQusB,WAAWs8H,EAAgBj6E,UAEpD,IAAImoB,GACJ,GAA0C,QAAtCp/C,EAAM5iD,QAAQijD,eAAet/C,KAAgB,CAC/C,MAAMs/C,GAAgBL,EAAM5iD,QACzBijD,cACH++C,GAAU/+C,GAAgBA,GAAci9C,sBAAmB/9F,CAC7D,CAEA,IAAI4J,GAAQ5L,KAAKwwJ,cAAc1lJ,EAAS23C,IACnC72C,IAASrB,EAASX,OAAS,EAC9BgC,GAAQ,GAAG62C,EAAM72C,UAAUqT,GAAQ,KACzBrT,KACVA,GAAQ62C,EAAM72C,OAGhB,MAAMyS,GAAO7X,OAAO6H,OAAO,GAAIvD,EAAQuT,MAAQ,GAAI,CACjDnM,MAAIyQ,QACJ/W,SACA41F,SAAU9nB,GACV22E,YAAa5tG,EAAM72C,MACnB0oJ,MAAO,IAAO7xG,EAAMD,OACpBu9C,iBAAkB8B,KAGpB,OAAOr7F,OAAO6H,OAAOvD,EAAS,CAC5BuT,QACA2jC,WACmC,UAAjC2xG,EAAgB9zJ,QAAQ2D,KACpB,YACA3D,EAAQmiD,YACf,EAEL,CAEQmyG,2BAA2B5xJ,GACjC,MAAMgyJ,EAAoBv0J,KAAK0yJ,eAAenwJ,EAAI41B,eAC5Cq8H,EAAUD,EAAajT,KACvBpiH,EAAQ5G,SAASi8H,EAAar1H,MAAO,IACrCD,EAAS3G,SAASi8H,EAAat1H,OAAQ,IACvC1tB,EAAY+mB,SAASi8H,EAAanlH,GAAKmlH,EAAaxgF,EAAG,IACvDviE,EAAY8mB,SAASi8H,EAAal6E,GAAKk6E,EAAax7D,EAAG,IAEvDuoD,EAAOkT,EAAQlrJ,MAAM,KAC3B,IAAImrJ,EACgE,KAAjEvoI,KAAK68G,IAAI3K,WAAWkjB,EAAK,KAAOp1H,KAAK68G,IAAI3K,WAAWkjB,EAAK,MAGxDp1H,KAAK68G,IAAI3K,WAAWkjB,EAAK,KAAO,MAClCmT,EAAY,MAEd,MAAMC,EACJt2B,WAAWkjB,EAAK,IACfp1H,KAAK68G,IAAI3K,WAAWkjB,EAAK,IAAMljB,WAAWkjB,EAAK,KAAO/vI,EACrD2tB,EACFu1H,EACIE,EACJv2B,WAAWkjB,EAAK,IACfp1H,KAAK68G,IAAI3K,WAAWkjB,EAAK,IAAMljB,WAAWkjB,EAAK,KAAO9vI,EACrDytB,EACFw1H,EACIG,EAAUF,EAAqB,EAAZD,EACnBI,GAAUF,EAAqB,EAAZF,EAEnBK,GACJ,YACAJ,EACA,IACAC,EACA,KACAD,EACA,IACAG,GACA,KACAD,EACA,IACAC,GACA,KACAD,EACA,IACAD,EACA,KACAD,EACA,IACAC,EACA,KAIIxuH,IAFS,IAAI4xC,KACgB0E,YAAYq4E,IACjB3nE,cAO9B,MALgB,CACd3pF,KAAM2iC,GAAE87D,UACR/b,YAAa//C,GAAE0b,iBAInB,CAEQoyG,gBAAgBt2G,EAAK6E,EAAQk9C,GAEnC,IAAIn1F,GADW,IAAIi5E,KACGr8B,aAAaxJ,GAEnC,GAAwB,IAApBpzC,EAASX,OAAc,CACzB,MAAMmrJ,EAAY,IAAIh9E,IACtB,IACExtE,EAAWwqJ,EAAU5tG,aAAaxJ,EACpC,OACEulB,QAAQC,KACN,2FAEJ,CACF,CAEA,OAAO54D,EAASkW,IAAK3V,GACnB9K,KAAKg1J,gBAAgBlqJ,EAAS03C,EAAQk9C,GAE1C,CAEQk0D,gBAAgBj2G,EAAK6E,EAAQk9C,GACnC,MAAMu1D,EAAS,IAAIvxE,IACnB,IAAIn5E,EAAW,GACf,IACEA,EAAW0qJ,EAAO9tG,aAAaxJ,EACjC,OACEulB,QAAQC,KAAK,4CACf,CACA,OAAO54D,EAASkW,IAAK3V,GACnB9K,KAAKg1J,gBAAgBlqJ,EAAS03C,EAAQk9C,GAE1C,CAEQm0D,mBAAmBl2G,EAAK6E,EAAQk9C,GACtC,IAAIn1F,EAAW,GACf,IACEA,EAAW0tB,KAAKC,MAAMylB,EAAIjlB,QAAQ,WAAY,MAAMnuB,QACtD,OACE24D,QAAQC,KAAK,yCAA0C,KAAMxlB,EAC/D,CACApzC,SAASkW,IACN3V,GACEA,EAAQuT,KAAO,CACdnM,MAAIyQ,QACJ2xI,MAAO,IAAO9xG,EACdk7B,MAAOgiB,IAGNn1F,CACT,CAEQupJ,oBAAoBn2G,EAAK6E,EAAQk9C,GACvC,GAAI/hD,EACF,IACE,GAAI1lB,KAAKC,MAAMylB,GAAKv5C,MAClB,MAAO,EAEX,OAAa,CAKf,OAHe,IAAIo2E,KACKrzB,aAAaxJ,GAErBl9B,IAAK3V,GACnB9K,KAAKg1J,gBAAgBlqJ,EAAS03C,EAAQk9C,GAE1C,CAEQq0D,gBAAgBp2G,GAEtB,MAAO,EACT,CAEQq2G,gBACNr2G,EACAu3G,EACA3yJ,EACAmxJ,EACA9B,GAEA,MAAM2C,EAAoBv0J,KAAK0yJ,eAAenwJ,EAAI41B,eAC5C6pB,EAAauyG,EAAajnB,KAAOinB,EAAazxE,KAAO,YACrDoxE,EAAYl0J,KAAKm0J,2BAA2B5xJ,GAGhD2yJ,IAAet7E,KAAgBC,OAC/Bq7E,IAAet7E,KAAgBo3E,SAE/BkE,EAAat7E,KAAgBo3E,QAG/B,MAAMmE,EAAex3G,EAAIxlB,cAAczvB,QAAQ,UACzC0sJ,EAAaz3G,EAAIxlB,cAAcoyB,YAAY,WAAa,EAK9D,MAAa,KAHA8qG,IACX13G,EAAI95B,MAAMsxI,EAAcC,GAAY18H,QAAQ,cAAe,MAElC,KAARilB,EACV,GAGF,CACL,CACEn6C,KAAMwpF,KACNhrC,aACA3qB,WAAY7wB,OAAO6H,OACjB,CAAEuI,OAAQs+I,EAAY9xJ,KAAMu6C,EAAKp7C,OACjCqvJ,GAEFtoE,SAAUoqE,GAAmBQ,GAGnC,CAEQxB,eAAenwJ,GACrB,MAAM+yJ,EAAc/yJ,EAAI+G,MAAM,KAC9B,IAAKgsJ,EAAY,GACf,OAEF,MAAMC,EAAQD,EAAY,GAAGhsJ,MAAM,KAE7B+/B,EAAS,GACfksH,SAAMh7I,QAAS2xD,IACbA,EAAOA,EAAK5iE,MAAM,KAClB+/B,EAAO6iC,EAAK,IAAMF,mBAAmBE,EAAK,IAAM,GAAE,GAE7C7iC,CACT,CAEO2rH,gBACLjF,EACAvtG,EACAk9C,GAEA,MAAM81D,EAAkBzF,EAAU5iE,cAC5B91D,EAAkB7wB,OAAO6H,OAAO,GAAI0hJ,EAAUtwE,iBAapD,IAAI6J,EACJ,cAbOjyD,EAAWiyD,gBACXjyD,EAAWo+H,iBACXp+H,EAAWqoD,iBACXroD,EAAWq+H,aACXr+H,EAAWs+H,aACXt+H,EAAWu+H,eACXv+H,EAAWw+H,eACXx+H,EAAWy+H,eACXz+H,EAAW0+H,gBACX1+H,EAAWgyD,YACXhyD,EAAW2+H,UAGdR,IACFlsE,EAAW,CACT9lF,KAAMgyJ,EAAgBvzD,UACtB/b,YAAasvE,EAAgB3zG,mBAI1B,CACLr+C,KAAMwpF,KACNhrC,gBAAYhgD,EACZq1B,aACAiyD,WACAjrE,KAAM,CACJnM,MAAIyQ,QACJ2xI,MAAO,IAAO9xG,EACdk7B,MAAOgiB,GAGb,CAEQ4xD,YACN2E,EACAp2J,EACAq2J,GAAY,EACZvyD,GAEA,IAAIphG,EAEJ,GAAI0zJ,EAAWp2J,QAAQs2J,UACrB,OAAOn2J,KAAKo2J,kBAAkBH,EAAYp2J,EAAS8jG,GAGrD,OAAQsyD,EAAWl2J,aACjB,KAAKy2E,KACH,MAAM49E,EAAgB6B,EAEhBI,EAA2B,CAC/BC,YACElC,EAAcrtJ,OAAOuvJ,aACrBt2J,KAAKu2J,kBAAkBN,EAAWp2J,QAAQ6wE,aAC5C8lF,aAAcpC,EAAcrtJ,OAAO0vD,OACnC49F,cACED,EAAcrtJ,OAAOstJ,eAAiBr0J,KAAKkxJ,qBAG3CkD,EAAcrtJ,OAAOstJ,gBACvBr0J,KAAKmxJ,aAAeiD,EAAcrtJ,OAAOstJ,eAGvC6B,IACFG,EAAyBC,YAAct2J,KAAKu2J,kBAC1CllF,KAAYL,OAIhBzuE,EAAM6xJ,EAAc/yG,GAAGo1G,kBACrB52J,EAAQqmF,YACRrmF,EAAQy7D,WACRz7D,EAAQmiD,WACRq0G,GAUF,MACF,KAAKz/E,KAsBHr0E,EAAM,GAnBJ,WAFsB0zJ,EAGNp2J,QAAQuuE,QACxB,yCAGA,MAPsB6nF,EAOEp2J,QAAQI,OAAO6/C,OAAO,GAAGjgD,QAAQ62J,8EAOzD72J,EAAQqmF,YAAY,GACpB,IACArmF,EAAQqmF,YAAY,GACpB,YAjBsB+vE,EAUOp2J,QAAQ82J,eAVfV,EAWJp2J,QAAQ82J,eACxB,QAOF,OAGF,MACF,KAAK5/E,IACL,KAAKC,KACH,MAAM4/E,GAA2BX,EAC3BY,GAAS3qI,KAAK68G,IAAIplC,EAAU,GAAKA,EAAU,IAC3C0sB,GAASnkG,KAAK68G,IAAIplC,EAAU,GAAKA,EAAU,IAG3C8wD,GAAYmC,GAAyB/2J,QAAQ82J,eAC/CC,GAAyB/2J,QAAQ82J,eAFN,MADdE,GAASxmC,GAASwmC,GAASxmC,IAKtC7/C,GAASoyB,IACbA,KAAwB,CAAC/iG,EAAQqmF,cACjCuuE,IA4BFlyJ,EAAM,GAzBJq0J,GAAyB/2J,QAAQ0C,IACjC,IACAq0J,GAAyB/2J,QAAQ4iD,MACjC,aAYa,CACb,SACA,YAbe6T,mBACf,WACEka,GAAO,GACP,WACAA,GAAO,GACP,WACAA,GAAO,GACP,WACAA,GAAO,GACP,0CAKF,oCACA,cACA,sCACA,cACA,sBACA,gBAE4B3mE,KAAK,OAMvC,OAAOtH,CACT,CAEQg0J,kBAAkB7lF,GACxB,IAAIomF,EAAO,0BACX,MAAM1lF,EAAU5qE,OAAOC,KAAK4qE,MAAajvD,KACtC7b,GAAQ8qE,KAAY9qE,KAASmqE,GAEhC,OAAIU,IACF0lF,EAAOlmF,KAAoBQ,IAGtB0lF,CACT,CAEAxG,yBAAyB7tG,GACvB,IAAIi9C,EACJ,OACEj9C,EAAM5iD,SAAS4jB,QAAQ5jB,SAAS+zE,cAChCnxB,EAAM5iD,QAAQ4jB,OAAO5jB,QAAQ+zE,aAAahqE,QAAU,IAEpD81F,EAAwB,GACxBj9C,EAAM5iD,QAAQ4jB,OAAO5jB,QAAQ+zE,aAAar5D,QAASimE,IAEjDkf,EAAsBlf,EAAYxxD,MADpBwxD,EAAY9C,MAAQ8C,EAAY9C,MAAQ8C,EAAYxxD,IACxB0uD,IAGvCgiB,CACT,CAEA8wD,cAAc1lJ,EAAkB23C,GAC9B,IAAI72C,EACJ,GAAI62C,EAAM5iD,SAAS4jB,QAAQ5jB,QAAS,CAClC,MAAMy9E,EAAoB76B,EAAM5iD,QAAQ4jB,OACrC5jB,QACCy9E,EAAkBzJ,aACpBjoE,EAAQ5L,KAAK+2J,cAAcjsJ,EAASwyE,EAAkBzJ,YAE1D,CAEA,OAAOjoE,CACT,CAEAmrJ,cAAcjsJ,EAAkBksJ,GAC9B,IAAIxrI,EAAQwrI,EACZ,MAAMC,EAAa17I,MAAMmE,KAAKs3I,EAAWE,SAAS,sBAElDD,SAAW18I,QAASlB,IAClBmS,EAAQA,EAAMkN,QAAQrf,EAAE,GAAIvO,EAAQusB,WAAWhe,EAAE,IAAG,GAI5B,IAAtB49I,EAAWrtJ,QAAgB4hB,IAAUwrI,IACvCxrI,EAAQ1gB,EAAQusB,WAAW2/H,IAAeA,GAGrCxrI,CACT,CASA4qI,kBACEH,EACAp2J,EACA8jG,GAEA,MAAMnzB,EAASoyB,KACb/iG,EAAQqmF,YACRrmF,EAAQy7D,WACR,EACA,CAAC,IAAK,MAGR,OAAO26F,EAAWp2J,QAAQs2J,UAAU11I,IAAKoX,IACvC,IAAI5zB,EAAqB,CACvB1B,IAAKs1B,EAAKt1B,IACPm2B,QAAQ,YAAa83C,EAAO3mE,KAAK,MACjC6uB,QAAQ,SAAU74B,EAAQqmF,YAAY,GAAG/tB,YACzCz/B,QAAQ,SAAU74B,EAAQqmF,YAAY,GAAG/tB,YACzCz/B,QAAQ,kBAAmB74B,EAAQy7D,WAAWnD,YAC9Cz/B,QAAQ,YAAa74B,EAAQmiD,WAAWtpB,QAAQ,QAAS,MAK9D,OAAIirE,GACF1/F,EAAK1B,IACFm2B,QAAQ,YAAairE,EAAU,GAAGxrC,YAClCz/B,QAAQ,YAAairE,EAAU,GAAGxrC,YAClCz/B,QAAQ,YAAairE,EAAU,GAAGxrC,YAClCz/B,QAAQ,YAAairE,EAAU,GAAGxrC,YAGnCtgC,EAAK45C,gBACPxtE,EAAKwtE,cAAgB55C,EAAK45C,eAGxB55C,EAAK+5C,gBACP3tE,EAAK2tE,cAAgB/5C,EAAK+5C,eAGxB/5C,EAAK47C,WACPxvE,EAAKwvE,SAAW57C,EAAK47C,UAGnB57C,EAAK27C,WACPvvE,EAAKuvE,SAAW37C,EAAK27C,UAGhBvvE,GAEX,4CAn9BWgtJ,GAAY7vJ,MAAAuE,MAAAvE,MAAAwE,MAAA,iCAAZqrJ,EAAY5vJ,QAAZ4vJ,EAAY3vJ,UAAAC,WAFX,gBAED0vJ,CAAY,qCCpCnB,SAAUrB,EAAiBntG,GAE/B,OAAwC,IADrBA,EAAMpsB,WACPx2B,QAAQkjD,SAC5B,CA6BM,SAAU0tG,EAA0B7uD,GACxC,MAAMn/C,EAAQm/C,EAAQ1hG,IAAI,UAC1B,YAAiB8B,IAAVygD,GAEHmtG,EAAiBntG,IAhBjB,SAAU00G,EAAwB10G,GACtC,MAAMpsB,EAAaosB,EAAMpsB,WACzB,YAAiDr0B,IAA1Cq0B,EAAWx2B,QAAQu3J,qBACoB,IAA1C/gI,EAAWx2B,QAAQu3J,kBAEzB,CAWiCD,CAAwB10G,EACzD,+YC9CIrhD,MAAA,eAAyBA,MAAA,GAAWA,8BAAXA,cAAAkK,EAAAkgB,gDAiBzBpqB,MAAA,oCAKEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+rJ,qBAAoB,GAG7Bj2J,MAAA,cAAUA,MAAA,WACZA,kCAHEA,MAFA,QAAAkK,EAAAC,MAEAnK,CAFe,aAAAA,MAAA,yDAQnBA,MAAA,yBAAiCA,MAAA,uDAG/BA,MAAA,eAIEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,QAAA,OAAAA,MAASkK,EAAAgsJ,eAAc,GAEvBl2J,MAAA,cAAUA,MAAA,YACZA,kCAJEA,MAAA,QAAAkK,EAAAC,gDAMFnK,MAAA,6CAIEA,MAAA,4BAAAqW,GAAArW,MAAAmrD,GAAA,MAAAjhD,EAAAlK,QAAA,OAAAA,MAAoBkK,EAAAisJ,mBAAA9/I,GAA0B,GAEhDrW,gCAHEA,MADA,cAAAkK,EAAAksJ,YACAp2J,CAD2B,aAAAA,MAAA,IAAAkK,EAAAmsJ,uDAM7Br2J,MAAA,4BAUEA,MAPA,gCAAAqW,GAAArW,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAAwBkK,EAAAosJ,qBAAAtpJ,KAAAqJ,GAAiC,EAOzDrW,CAP0D,uCAAAqW,GAAArW,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAE3BkK,EAAAqsJ,4BAAAvpJ,KAAAqJ,GAAwC,EAKvErW,CALwE,2CAAAqW,GAAArW,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAG7DkK,EAAAssJ,gCAAAxpJ,KAAAqJ,GAEjB,EAAMrW,CADC,gCAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MACqBkK,EAAAusJ,yBAAwB,GAEhDz2J,gCANEA,MAJA,wBAAAkK,EAAAwsJ,sBAIA12J,CAJ+C,+BAAAkK,EAAAysJ,6BAI/C32J,CAF6D,mCAAAkK,EAAA0sJ,mCCQ5D,IAAMC,EAAkB,MAAzB,MAAOA,EAuNDzvH,cACAklD,cACAwqE,oBArNVzrI,mBAAqB,CACnB,UACA,QACA,MACA,YACA,UACA,aACA,aAGO0rI,aAAwC,IAAIp2J,IACnD,8BAGO+f,OAAmC,IAAI/f,KAAgB,GAKxDq2J,OAKAC,QAAmC,IAAIt2J,IAAgB,IAKvDu2J,SAKAC,aAEAC,aAMDC,kBAA4B,EAK1BjB,YAAwBkB,IAExBC,YAKT,cACItmE,CAAW3rF,GACb1G,KAAK44J,cAAclyJ,EACrB,CACA,cAAI2rF,GACF,OAAOryF,KAAKy3J,YAAY/wJ,KAC1B,CACS+wJ,YAAuC,IAAI11J,SAClDC,GAMQ01J,qBAAuB,IAAIpqJ,MAK3BqqJ,4BAA8B,IAAIrqJ,MAKlCsqJ,gCAAkC,IAAItqJ,MAKhD,QACI4gD,CAAKxnD,GACP1G,KAAK64J,QAAQnyJ,EACf,CACA,QAAIwnD,GACF,OAAOluD,KAAK84J,MAAMpyJ,KACpB,CACSoyJ,MAAiC,IAAI/2J,IAAgB,IAK9D,YACIoL,CAASzG,GACX1G,KAAKwL,UAAU7I,KAAK+D,EACtB,CACA,YAAIyG,GACF,OAAOnN,KAAKwL,UAAU9E,KACxB,CACS8E,UAAsC,IAAIzJ,KAAgB,GAE1D+1J,uBAAiC,EACjCC,8BAAwC,EAKjD,oCACIC,GACF,OAAOh4J,KAAK+4J,iCACd,CACA,oCAAIf,CAAiCtxJ,GACnC1G,KAAK+4J,kCAAoCryJ,EACzC1G,KAAK64J,QAAQ74J,KAAKkuD,MAAM,EAC1B,CACQ6qG,mCAAoC,EAKnCC,WAA6B,OAE7BC,WAAqC,OAErC5vI,YAEAmC,MAKAjgB,MAAQ,UAER2tJ,aAAuB,IAKvBtoG,SAAW,IAKXuoG,UAAY,EAKZC,gBAAiB,EAKjBC,gBAAiB,EAKjBxwB,SAAU,EAKV34H,MAKCopJ,iBAAmB,IAAIhsJ,MAKvB2+D,OAAS,IAAI3+D,MAQbisJ,iBAAmB,IAAIjsJ,MAKvBksJ,aAAe,IAAIlsJ,MAKnBmsJ,qBAAuB,IAAInsJ,MAMCosJ,MAMtC,SAAItpJ,GACF,OAA4B,IAArBpQ,KAAKkuD,KAAKtkD,MACnB,CAEA7J,YACUyoC,EACAklD,EACAwqE,GAFAl4J,KAAAwoC,gBACAxoC,KAAA0tF,gBACA1tF,KAAAk4J,qBACP,CAMH3qJ,WACEvN,KAAKo4J,OAASp4J,KAAK84J,MAAMj2J,UAAWqrD,IAClCluD,KAAK8hB,OAAOnf,UAAcX,IAATksD,GAAsC,IAAhBA,EAAKtkD,OAAY,GAG1D5J,KAAKs4J,SAAWt4J,KAAKq4J,QAClBt0J,QAAK6sD,KAAS,OAAMC,KAAM7wD,KAAK4wD,YAC/B/tD,UAAWqrD,GAAiBluD,KAAK25J,UAAUzrG,IAE9CluD,KAAK45J,oBAEL55J,KAAKu4J,aAAev4J,KAAKy3J,YACtB1zJ,QAAKmtF,QACLruF,UAAWwvF,GAAuBryF,KAAK65J,gBAAgBxnE,IAE1D,MAAM0+B,EAAc/wH,KAAKwoC,cAAcpoC,UACrC,8BAEFJ,KAAKy4J,sBAAmCz2J,IAAhB+uH,GAA4BA,CACtD,CAMA7iH,cACElO,KAAKo4J,OAAOjqJ,cACZnO,KAAKs4J,SAASnqJ,cACdnO,KAAKu4J,aAAapqJ,aACpB,CAQA2rJ,QAAQpwI,GAED1pB,KAAK0pF,WADEhgE,EAAMnjB,MAKlBvG,KAAK64J,QADSnvI,EAAM9S,OAA4BlQ,MAElD,CAMA2wJ,qBACEr3J,KAAK8G,QACL9G,KAAKw5J,aAAaprJ,MACpB,CAOAmpJ,mBAAmBllE,GACjBryF,KAAK44J,cAAcvmE,EACrB,CASAumE,cAAcvmE,GACZryF,KAAKy3J,YAAY90J,KAAK0vF,EACxB,CAEAwlE,yBACE73J,KAAK+5J,SAAS/5J,KAAKkuD,MACnBluD,KAAKy5J,qBAAqBrrJ,OAC1BpO,KAAK45J,mBACP,CAMAf,QAAQ3qG,EAAc8rG,GACpB,GAAIh6J,KAAKmN,SACP,QAGF+gD,EAAOA,GAAQ,MAEFluD,KAAKkuD,OAAS8rG,GACzBh6J,KAAK84J,MAAMn2J,KAAKurD,GAGlB,MAAM+rG,EAAO/rG,EAAKx1B,QAAQ,aAAc,IAAI+vG,QACxCwxB,EAAKrwJ,QAAU5J,KAAKm5J,WAA6B,IAAhBc,EAAKrwJ,SACxC5J,KAAKq4J,QAAQ11J,KAAKurD,EAEtB,CAEAopG,eACEt3J,KAAK+5J,SAAS/5J,KAAKkuD,KACrB,CAKQpnD,QACN9G,KAAK84J,MAAMn2J,KAAK,IAChB3C,KAAKq4J,QAAQ11J,KAAK,IAClB3C,KAAK05J,MAAMzmJ,cAAcw+B,OAC3B,CAKQi4C,WAAWnjF,GACjB,OAAuD,IAAhD0xJ,EAAmBnvE,YAAYpgF,QAAQnC,EAChD,CAOQozJ,UAAUzrG,GAChBluD,KAAKs5J,iBAAiBlrJ,KAAK8/C,GAC3BluD,KAAK+5J,SAAS7rG,EAChB,CAEQ0rG,oBACN,MAAMpC,EAAc,IACf,IAAI92I,IACL1gB,KAAKk4J,oBACFgC,oBACAxwJ,OAAQywJ,IAAQ,CAAC,MAAO,sBAAsBniI,SAASmiI,EAAGv9E,UAC1Dn8D,IAAK05I,GAAOA,EAAGl4D,aAItB,IAAI54E,EAAc,6BACS,IAAvBmuI,EAAY5tJ,OACdyf,EAAc,kBAAkBmuI,EAAY,GAAGr/H,4BACf,IAAvBq/H,EAAY5tJ,SACrByf,EAAc,wCAEhBrpB,KAAKm4J,aAAax1J,KAAK0mB,EACzB,CAEQwwI,gBAAgBxnE,GACtB,GAA+C,MAAfA,EAC9B,OAGFryF,KAAKu5J,iBAAiBnrJ,KAAKikF,GAE3B,MAAMhpE,EAAc,kBAAkBgpE,EAAWl6D,4BACjDn4B,KAAKm4J,aAAax1J,KAAK0mB,GAEvBrpB,KAAK64J,QAAQ74J,KAAKkuD,KACpB,CAMQ6rG,SAASK,GAMf,IAAIC,EALAr6J,KAAKw4J,eACPx4J,KAAKw4J,aAAa/3I,IAAK65I,GAAaA,EAASnsJ,eAC7CnO,KAAKw4J,kBAAex2J,GAKpBhC,KAAKk5J,cACLkB,EAAQl/H,MAAM,IAAIlxB,OAAOhK,KAAKk5J,aAAc,OAE5CmB,EAAQD,EACL9wJ,MAAMtJ,KAAKk5J,cACXxvJ,OAAQwU,GAAMA,EAAEtU,QAAU5J,KAAKm5J,WAC9Bn5J,KAAKkQ,OACPlQ,KAAKkQ,MAAMpJ,SAGbuzJ,EAAQ,CAACD,GAGX,IAAIloE,EAAyB,GAC7BmoE,EAAM55I,IAAKytC,IAEI,MADAA,EAAOA,EAAKx1B,QAAQ,aAAc,IAAI+vG,OAAS,IAQ5Dv2C,EAAaA,EAAWvxE,OACtB3gB,KAAK0tF,cAAczhB,OAAO/d,EAAM,CAC9B26E,QAAS7oI,KAAK6oI,gBARG7mI,IAAfhC,KAAKkQ,OACPlQ,KAAKkQ,MAAMpJ,OAQX,GAGN9G,KAAKw4J,aAAetmE,EAAWzxE,IAAK65I,GAC3BA,EAASn6G,QAAQt9C,UAAWu8E,IACjCp/E,KAAKu6J,oBAAoBD,EAAUl7E,EAAO,GAGhD,CAQQm7E,oBAAoBD,EAAoBl7E,GAG9C,GAFAp/E,KAAKisE,OAAO79D,KAAK,CAAEksJ,WAAUl7E,iBAEVp9E,IAAfhC,KAAKkQ,MAAqB,CAC5B,MAAMsqJ,EAAax6J,KAAKkQ,MACrB+R,MACAvY,OAAQ2/B,GAAWA,EAAO5lB,SAAW62I,EAAS72I,QAC9C9C,OAAOy+D,GACVp/E,KAAKkQ,MAAM2P,WAAW26I,EACxB,CACF,4CApcWvC,GAAkB72J,MAAAuE,MAAAvE,MAAAwE,KAAAxE,MAAAyE,MAAA,+BAAlBoyJ,EAAkB3pJ,UAAA,qBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,2hED/D/B1N,MAAA,4BACEA,MAAA,sBACEA,MAAA,EAAAq5J,EAAA,mBACAr5J,MAAA,uFAcEA,MAAA,iBAAAqW,IAAArW,aAAAyK,GAAAzK,MAAS2N,EAAA+qJ,QAAAriJ,IAAe,GAd1BrW,QAgBAA,MAAA,GAAAs5J,EAAA,kCAUFt5J,QAEAA,MAAA,GAAAu5J,EAAA,qBAEAv5J,MAAA,YAkBEA,MAjBA,GAAAw5J,EAAA,eAiBAx5J,CAZC,GAAAy5J,EAAA,4BAYDz5J,CAHC,GAAA05J,EAAA,8BAiBL15J,gBAjEsCA,MAAA,UAAAA,MAAA,GAAA+zC,EAAA/zC,MAAA,KAAA2N,EAAA+S,UACpB1gB,MAAA,GAA0BA,MAA1B,aAAA2N,EAAAiqJ,WAA0B53J,CAAD,aAAA2N,EAAAkqJ,YAC3B73J,cAAA,OAAA2N,EAAAyc,OAKVpqB,QASAA,MATA,UAAAA,MAAA,GAAAg0C,EAAArmC,EAAA0pJ,kBASAr3J,CAT+C,WAAAA,MAAA,KAAA2N,EAAAvD,WAS/CpK,CAR8B,cAAA2N,EAAAsa,YAAAta,EAAAsa,YAAAjoB,MAAA,KAAA2N,EAAAopJ,cAAA/2J,MAAA,KAAA2N,EAAAopJ,aAAAzxJ,YAAA1E,EAQ9BZ,CADC,QAAAA,MAAA,KAAA2N,EAAA+pJ,QAKA13J,MAAA,GAAAA,MAAA,YAAAA,MAAA,MAAA2N,EAAA+S,SAWS1gB,MAAA,GAAAA,MAAA,OAAA2N,EAAA4pJ,aAITv3J,MAAA,GAAAA,MAAA,OAAA2N,EAAA0pJ,kBASAr3J,cAAA,OAAA2N,EAAAqqJ,gBAQAh4J,cAAA,OAAA2N,EAAAsqJ,gCCHH/pJ,KACA2a,KAAkBnkB,eAClBqJ,KACA0tB,KAAc92B,KACdwJ,KAAevJ,KACfqJ,KAAgBsF,KAChBnF,KAAaqF,KACbq2C,IAAgBp2C,IAChBimJ,IACAC,IACAtrJ,KACAC,KAAiBmtB,MAAAjtB,OAAA,ugCAAAC,gBAAA,WAGRmoJ,CAAkB,oeCjCnB72J,MAJF,kBAIEA,CADD,UACqBA,MAAA,GACtBA,uCAHEA,MAAA,QAAA65J,IAEoB75J,MAAA,GAAAA,MAAA65J,GAAArvJ,QC6BzB,IAAMsvJ,EAA0B,MAAjC,MAAOA,GAOD1lI,YACD7zB,gBACAiW,UAGA3T,KAXFk8B,KACPr1B,QACAg1C,OAAkB,GAClBq7G,gBAEAp7J,YACUy1B,GACD7zB,GACAiW,GAGA3T,IALCjE,KAAAw1B,eACDx1B,KAAA2B,mBACA3B,KAAA4X,aAGA5X,KAAAiE,QAEPjE,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjC+yC,UAAW,CAAC,GAAI,CAACjvC,KAAW/C,YAEhC,CAEAz0B,WACEvN,KAAK8K,QAAU9K,KAAKiE,KAAK6G,QACzB9K,KAAK8/C,OAAS9/C,KAAKiE,KAAK67C,OACxB9/C,KAAKm7J,gBAAkBn7J,KAAKmgC,KAAK7I,SAAS08C,UAAaz7C,aAAax0B,QAClEynE,KAAU,KAAE,EACZ/qD,KAAKm7H,IAAQ57I,KAAK0J,OAAOkyI,KAE7B,CAEQlyI,OAAOkyI,IACb,GAAmB,iBAARA,GAGX,OAAO57I,KAAK8/C,OACTr/B,IAAKs/B,IAAMA,IACXr2C,OAAQ+4C,IACPA,IAAO72C,OAAOusB,cAAcH,SAAS4jH,GAAIzjH,eAE/C,CAEAo6B,UAAU9P,IACR,OAAOA,IAASA,GAAM72C,MAAQ62C,GAAM72C,MAAQ,EAC9C,CAEA4gD,OAKExsD,KAAK4X,UAAUK,MAJgD,CAC7DwqC,MAAOziD,KAAKmgC,KAAKz5B,MAAMstE,UACvBlpE,QAAS9K,KAAK8K,SAGlB,CAEAs6B,SACEplC,KAAK4X,UAAUK,OACjB,8CArDWijJ,IAA0B95J,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAW3BglC,KAAe,kCAXd80H,GAA0B5sJ,UAAA,8BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,isBAAAC,SAAA,SAAAC,GAAAC,IAAA,KAAAD,GAAA,kBD3DvC1N,MAAA,UACEA,MAAA,wBACFA,QAIIA,MAFJ,UAEIA,CAF2C,WAE3CA,CADwC,gBAEtCA,MAAA,+BAOFA,QAGEA,MADF,UACEA,CAD+B,oBAE7BA,MAAA,mCAOAA,MAAA,2BACEA,MAAA,GAAAg6J,EAAA,sCAUVh6J,gBAIIA,MAFJ,YAEIA,CAFoD,YAEpDA,CADiE,gBACzBA,MAAA,mBAAAA,aAAAyK,IAAAzK,MAAS2N,GAAAq2B,SAAQ,GACvDhkC,MAAA,0BACFA,QACAA,MAAA,gBAKEA,MAAA,mBAAAA,aAAAyK,IAAAzK,MAAS2N,GAAAy9C,OAAM,GAEfprD,MAAA,0BAGNA,wCApDEA,cAAA,IAAAA,MAAA,+CAIuBA,MAAA,GAAAA,MAAA,YAAA2N,GAAAoxB,MACX/+B,QAAqBA,MAArB,gBAAqBA,CAAD,gBAI1BA,QACAA,MADA,SAAA2N,GAAAjE,QACA1J,CADkB,gBAUhBA,MAAA,GAAAA,MAAA,cAAAA,MAAA,oCAEAA,MAAA,kBAAAi6J,IAGgBj6J,MAAA,GAAAA,MAAA,cAAA2N,GAAAwjD,WAEInxD,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,GAAAosJ,kBAcxB/5J,MAAA,GAAAA,MAAA,IAAAA,MAAA,sCASAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,oDCVF8W,KACAC,KACAskB,KAAW92B,oBACX43B,KAAmB53B,UACnBitC,KACA0oH,IACApqH,KACAjnB,KAAkBnkB,KAClB+2B,KAAc92B,KACd42B,KAAqB32B,KAAA2O,KAAA3O,KACrByO,KACA0V,KACA/a,KAAayF,KACbuD,KACA7I,KAAeuF,KACfpF,KACAC,KAAiBmtB,MAAAjtB,OAAA,wjBAGRqrJ,EAA0B,kDC3DvC95J,MAAA,oDAUEA,MARA,sBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAiwJ,aAAA9jJ,IAAoB,EAQlCrW,CARmC,sBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MACrBkK,GAAAiwJ,aAAA9jJ,IAAoB,EAOlCrW,CAPmC,iBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAO1BkK,GAAA8jH,cAAA33G,IAAqB,GAE9BrW,MAAA,sHAeGA,MAAA,sBAELA,oCApBEA,MADA,aAAAA,MAAA,IAAAkK,GAAAkwJ,kBACAp6J,CAD2C,QAAAA,MAAA,IAAAkK,GAAAmwJ,YAAA,GAAAnwJ,GAAA2uB,MAAA,WAOzC74B,MAAA,GASAA,MATA,kBAAAkK,GAAAowJ,eASAt6J,CATkC,6BASlCA,CANgC,iBAAAA,MAAA,KAAAkK,GAAAqwJ,YAAA,IAAAv6J,MAAA,KAAAkK,GAAAswJ,aAAAx6J,MAAA,KAAAkK,GAAAqwJ,YAAArwJ,GAAA2uB,OAAA74B,MAAA,KAAAkK,GAAAqwJ,WAAAv6J,MAAA,KAAAkK,GAAAmwJ,YAMhCr6J,CADC,wBAAAA,MAAA,KAAAkK,GAAAqwJ,WAIAv6J,MAAA,GAAAA,MAAA,GAAAA,MAAA,MAAAkK,GAAAmwJ,YAAA,MAAAnwJ,GAAA2uB,MAAA,kEAIL74B,MAAA,oDAQEA,MAAA,mBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAASkK,GAAAuwJ,oBAAmB,GAE5Bz6J,MAAA,iCASGA,MAAA,oBAELA,oCAdEA,MANA,KAAAkK,GAAAggB,SAAA,iCAMAlqB,CANqD,aAAAA,MAAA,IAAAA,MAAA,IAAAkK,GAAAwwJ,6BAanD16J,MAAA,GAEAA,MAFA,6BAEAA,CAFgC,iBAAAA,MAAA,IAAAkK,GAAAqwJ,UAEhCv6J,CADmC,wBCuBhC,IAAM26J,GAA8B,MAArC,MAAOA,GA6DD1hG,aACA/hD,OACAomG,kBACA1sG,aA/DH9F,SAAoC,IAAInK,IAC7C,kCAGK+5J,0BACL,IAAI/5J,IAAgB,6BAEd2iG,aACAj7C,SAEDkyG,SAAqC,IAAI55J,KAAgB,GAEzD65J,WAAuC,IAAI75J,KAAgB,GAE3D05J,WAAuC,IAAI15J,KAAgB,GAE1Di6J,mBAAqB,GAErBn5H,mBAEAo5H,gBAA0B,EAEzBx5G,MAEAvyC,MAKA+pB,MAKAxZ,IAKAy7I,yBAAmC,EAE5C,SACI3wJ,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,IACR1G,KAAKmxC,OAASzqC,EAChB,CACQyqC,OAAS,UAERzpB,OAAkC,GAE3C,aAAIy0I,GACF,OAAOn8J,KAAKygB,IAAIq/B,OAAOp2C,OAAQ+4C,IAC7BhZ,OAAOgZ,GAAMvwC,IAAI8lB,SAAS,oBAE9B,CACQ6G,eACDvT,UAAoB,EAC3BvrB,YACUs6D,GACA/hD,GACAomG,GACA1sG,IAHAhS,KAAAq6D,gBACAr6D,KAAAsY,UACAtY,KAAA0+G,qBACA1+G,KAAAgS,eACP,CAKHzE,WAEEvN,KAAK6+B,eAAiB7+B,KAAKgS,aAAa+sB,OAAOl8B,UAAWm8B,KACpDA,KAAUvrB,KAAMuyD,SAClBhmE,KAAKsrB,UAAW,KAGa,UAA7BtrB,KAAKyiD,MAAMpkC,KAAK+9I,WAClBp8J,KAAKi6B,OAGG,IAFNj6B,KAAKygB,IAAIq/B,OAAO9K,UACboN,IAAQA,GAAIlwC,KAAOlS,KAAKyiD,MAAMx+C,KAAK6+C,cAAc5wC,KAGxDlS,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAU,KACzC7C,KAAKq8J,WAAS,GAEhBr8J,KAAK0kG,aAAe1kG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UACrD6D,KACC1G,KAAKokH,qBAAqB19G,IAC1B1G,KAAKq8J,WAAS,EAGpB,CAEAnuJ,cACElO,KAAK0kG,aAAav2F,cAClBnO,KAAKypD,SAASt7C,cACVnO,KAAK6+B,gBACP7+B,KAAK6+B,eAAe1wB,aAExB,CAMAotJ,aAAa7xI,IACX1pB,KAAKovH,cAAc1lG,GACrB,CAMA0lG,cAAcktC,WACDt8J,KAAK6iC,mBAAuB,KACrCI,aAAajjC,KAAK6iC,oBAEpB,MAAMnZ,GAAQ4yI,IAAyB,GAEvC,GAAmB,eAAf5yI,GAAMlmB,OAAyBxD,KAAKi8J,eAGxC,OAAQvyI,GAAMlmB,MACZ,IAAK,QACExD,KAAKy7J,WAAW/0J,QACf1G,KAAKi6B,MACPj6B,KAAKS,SAELT,KAAK4tC,IAAIlkB,KAGb1pB,KAAKy7J,WAAW94J,MAAK,GACrB,MACF,IAAK,cACE3C,KAAKy7J,WAAW/0J,QAAU1G,KAAKi6B,QAClCj6B,KAAK6iC,mBAAqBlE,WAAW,KACnC3+B,KAAK4tC,IAAIlkB,IACT1pB,KAAKy7J,WAAW94J,MAAK,EAAI,EACxB,MAEL3C,KAAKi8J,gBAAiB,EACtB,MACF,IAAK,aACCj8J,KAAKy7J,WAAW/0J,QAClB1G,KAAKS,SACLT,KAAKy7J,WAAW94J,MAAK,IAEvB3C,KAAKi8J,gBAAiB,EAK5B,CAEQruH,IAAIlkB,IACL1pB,KAAKi6B,QACRj6B,KAAKi6B,OAAQ,EACbj6B,KAAKu8J,cAAc7yI,IAEvB,CAEQjpB,SACFT,KAAKi6B,QACPj6B,KAAKi6B,OAAQ,EACbj6B,KAAKw8J,qBACLx8J,KAAKg8J,mBAAmBv7I,IAAK7E,IAAMA,GAAEzN,eACrCnO,KAAKg8J,mBAAqB,GAE9B,CAKQO,cAAc7yI,IAKpB,QAJiB1nB,IAAbhC,KAAKygB,KAILzgB,KAAKyiD,MAAMpkC,KAAK+9I,WAAav1D,IAC/B,OAGF,MAAMnkD,GAAgB1iD,KAAKyiD,MAAqCx+C,UACdjC,IAA9C0gD,GAAaI,cAAcwzB,iBAC7B5zB,GAAaI,cAAcwzB,gBAAiB,GAE9Ct2E,KAAKg8J,mBAAmB10J,KACtBtH,KAAKq6D,aAAaU,iBAAiBrY,IAAc7/C,UAAW4/C,KACvC,UAAf/4B,GAAMlmB,MACRxD,KAAKygB,IAAIohH,oBAAoBl/H,KAAK,CAAC8/C,KAErCziD,KAAKygB,IAAIu7C,SAASvZ,GAAK,GAG7B,CAKQ+5G,qBAKN,QAJiBx6J,IAAbhC,KAAKygB,KAILzgB,KAAKyiD,MAAMpkC,KAAK+9I,WAAav1D,IAC/B,OAGF,MAAM41D,GAASz8J,KAAKygB,IAAIqjH,aAAa9jI,KAAKyiD,MAAMx+C,KAAK6+C,cAAc5wC,IACnElS,KAAKygB,IAAI8rF,YAAYkwD,GACvB,CAEAr4C,qBAAqB9oD,IAGnBt7D,KAAK27J,SAASh5J,KACZ24D,KAHoBt7D,KAAKyiD,MAAMx+C,KAAK2tE,eAAiB,IAGtBtW,KAFXt7D,KAAKyiD,MAAMx+C,KAAKwtE,eAAiB8yC,KAIzD,CAEA83C,YACE,GAAIr8J,KAAKyiD,OAAOx+C,MAAM6+C,eAAe5wC,GAAI,CACvC,MAAMuqJ,GAASz8J,KAAKygB,IAAIqjH,aAAa9jI,KAAKyiD,MAAMx+C,KAAK6+C,cAAc5wC,IAE/DlS,KAAK47J,WAAWj5J,OADpB85J,IACyBA,GAAO5lI,QAElC,CACF,CAEA6kI,eACE,OAAI17J,KAAK27J,SAASj1J,OACT1G,KAAK47J,WAAWl1J,MAAQ,GAExB,gBAEX,CAEA80J,iBACE,OAAIx7J,KAAKi6B,MACHj6B,KAAKy7J,WAAW/0J,MACX,iCACE1G,KAAK27J,SAASj1J,MAChB1G,KAAK47J,WAAWl1J,MACnB,sCACA,gDAEG,8CAGF1G,KAAK27J,SAASj1J,MACjB,iCACA,wCAER,CAEAm1J,oBACmC,YAA7B77J,KAAKyiD,MAAMpkC,KAAK+9I,UAKFp8J,KAAKsY,OAAOC,KAAK2iJ,EAA4B,CAC7Dh8H,MAAO,QACPj7B,KAAM,CACJ6G,QAJoB9K,KAAKyiD,MAKzB3C,OAAQ9/C,KAAKm8J,aAKdtjJ,cACAhW,UAAWoB,KACV,GAAIA,GAWF,GAVIjE,KAAK0nB,OAAO9d,OAAS,GACvB5J,KAAK0nB,OAAOjH,IAAKvQ,KACfA,GAAMM,MAAM8P,UAAU,CAAEkI,UAAU,IAC9BtY,IAAOuyC,QACTvyC,GAAMuyC,MAAM5rB,SAAU,GAEjB3mB,KAIe,iBAAfjM,GAAKw+C,MACdziD,KAAK6+G,YAAY56G,GAAKw+C,MAAOx+C,GAAK6G,aAC7B,CACL,MAAM4xJ,GAAc18J,KAAK0nB,OAAOtF,KAC7BlS,IAAUA,GAAMuyC,MAAMvwC,KAAOjO,GAAKw+C,MAAMvwC,IAE3CwqJ,GAAYj6G,MAAM5rB,SAAU,EAC5B6lI,GAAYj6G,MAAMG,QAAU,EAC5B5iD,KAAK88E,WAAW74E,GAAK6G,QAAS4xJ,GAChC,GAGR,CAEA79C,YAAY89C,GAAoB/kB,IAC9B,MAAM8kB,GAAqC,IAAIv/D,KAAsB,GAAI,CACvE18E,IAAKzgB,KAAKygB,MAGN5Q,GAAS,CACb,IAAIsgE,KAAM,CACR4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACRjf,OAAQ,IAAIyhF,IAAO,CACjB39H,MAAO,EACP3zB,MAAO,oBAETiwE,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,wBAIb,IAAI4kE,KAAM,CACRiL,OAAQ,IAAIyhF,IAAO,CACjB39H,MAAO,EACP3zB,MAAO,oBAETiwE,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,4BAMb,IAAIwxJ,GAAyB,EAC7B,UAAWt6G,MAASziD,KAAKm8J,UAAW,CAClC,IAAIa,GAAW7hI,OAAOsnB,GAAMvwC,GAAGwmB,QAAQ,mBAAoB,KAC3DqkI,GAAiB7wI,KAAKC,IAAI6wI,GAAUD,GACtC,CAEA/8J,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACNu/C,WAAW,IAEZh/C,QAAK6lD,KAAK,IACV/mD,UAAWwzB,KACV,IAAI4mI,GAA2B,IAAIlhG,IAAY,CAC7C5G,oBAAoB,EACpBjjD,GAAI,sBAAuB6qJ,GAC3BnxJ,MAAO+wJ,GACPl5I,OAAQ4S,GACRmtB,SAAU,CACR2Y,UAAU,EACVojD,eAAgB,CACd/jC,KAAM,CAAEjwE,MAAO,yBACf6vE,OAAQ,CAAE7vE,MAAO,kBAAmB2zB,MAAO,GAC3CqoF,OAAQ,CACN/rC,KAAM,CAAEjwE,MAAO,yBACf6vE,OAAQ,CAAE7vE,MAAO,kBAAmB2zB,MAAO,GAC3Cm7D,OAAQ,KAIdlkF,MAAOtG,GACP85C,iBAAiB,EACjByxC,YAAY,EACZ3gD,UAAW,CACT9J,SAAS,MAIb2qD,QAAkBohE,GAAaO,KAAW,EAC1C1hE,MACEmhE,GACA,IAAI7sE,KAA4B,CAC9B+K,OAAQC,KAAcj9E,SACtB,EAGJyrF,MACEqzD,GACA,IAAIpzD,KAA8B,CAChC7oF,IAAKzgB,KAAKygB,IACVm6E,OAAQC,KAAcj9E,KACtBu6H,MAAM,KAIVukB,GAAYj6G,MAAM5rB,SAAU,EAC5B6lI,GAAYj5I,OAAO49B,GAAG/R,GACpB,gBACC5lB,KACC,MAAMw5E,GAAax5E,GAAM5e,QAAQqiF,cACjCntF,KAAKk9J,wBAAwBh6D,GAAU,GAI3CljG,KAAK88E,WAAW86D,GAAiB8kB,IACjC18J,KAAK0nB,OAAOpgB,KAAKo1J,GAAW,EAElC,CAEA5/E,WAAWhyE,GAAuB4xJ,IAChC,MAAMxM,GAAa,CACjB1sJ,KAAMsH,GAAQ7G,KAAKT,KACnB8lF,SAAU,CACRpD,YAAap7E,GAAQ7G,KAAKqlF,SAASpD,YACnC1iF,KAAMsH,GAAQ7G,KAAKqlF,SAAS9lF,MAE9Bw+C,WAAYl3C,GAAQ7G,KAAK+9C,WACzB3qB,WAAYvsB,GAAQ7G,KAAKozB,WACzBhZ,KAAM,CACJnM,GAAIpH,GAAQuT,KAAKnM,YAGdg+I,GAAW74H,WAAWk5D,MAC7BmsE,GAAY/8I,OAAOuwI,IACnBwM,GAAYxzD,iBACZwzD,GAAYj6G,MAAMpB,GAAGsC,YAAY9/C,SACnC,CAEQq5J,wBAAwBh6D,KAC9Bw2C,QAAwBx2C,IAAY3oF,QACjCo/H,KACKA,IAAaA,GAAUv7E,UACzBp+D,KAAKygB,IAAI4gC,GAAGy4F,cAAcH,GAAS,EAI3C,8CAxaWoiB,IAA8B36J,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,KAAAzE,MAAA0E,MAAA,+BAA9Bi2J,GAA8BztJ,UAAA,4BAAAC,OAAA,CAAAk0C,MAAA,QAAAvyC,MAAA,QAAA+pB,MAAA,QAAAxZ,IAAA,MAAAy7I,wBAAA,0BAAA3wJ,MAAA,QAAAmc,OAAA,UAAAjZ,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6gCAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,IDtC3C1N,MA/BA,EAAA+7J,GAAA,iBA+BA/7J,CApBC,EAAAg8J,GAAA,wBAPEh8J,MAAA,iBAAA2N,GAAA0zC,MAAApkC,KAAA+9I,UA8BAh7J,cAAA,mBAAA2N,GAAA0zC,MAAApkC,KAAA+9I,UAAArtJ,GAAAmtJ,yCCwBC/sJ,KACAI,KAAexJ,KACf03B,KACApuB,KAAgBrJ,KAChBwJ,KAAamF,KACb0oJ,IAAcxoJ,IACdE,IACArF,KACAC,KAAiBmF,MAAAjF,OAAA,sKAAAC,gBAAA,WAGRisJ,EAA8B,qRCjEzC36J,MAAA,gBAAuCA,MAAA,GAErCA,+BAFqCA,cAAAkK,EAAAgyJ,UAAAhyJ,EAAAK,KAAA,oCAIvCvK,MAAA,iCAKEA,MAFA,YAAAkK,EAAAoT,UAAAtd,MAEAA,CAFuB,aAAAkK,EAAAiyJ,yCAMvBn8J,MAAA,YAKGA,MAAA,GAAWA,gCADZA,MAAA,aAAAkK,EAAAM,OACCxK,cAAAkK,EAAAM,kCALHxK,MAAA,EAAAo8J,EAAA,oCAEGp8J,MAAA,QAAAkK,EAAAoT,sDAQHtd,MAAA,eAIEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAASkK,EAAAmyJ,gBAAe,GAExBr8J,MAAA,cAAUA,MAAA,YACZA,WCUG,IAAMk6J,EAA0B,MAAjC,MAAOA,GAIFjyH,OAEA5oB,IAUA68I,UAKAI,gBAAiB,EAEhBC,UAAY,IAAIrwJ,MAElBqqB,OAAS,IAAIimI,IAErB,SAAIhyJ,GACF,SAAO2S,MAAeve,KAAKqpC,OAC7B,CAMA,aAAI3qB,GACF,SAAOD,MAAmBze,KAAKqpC,OACjC,CAMA,eAAIk0H,GACF,OAAOv9J,KAAK0e,UACTga,QAAQ,qBAAsB,MAC9BA,QAAQ,kBAAmB,GAChC,CAMA,QAAI/sB,GACF,SAAOiT,MAAc5e,KAAKqpC,OAC5B,CAEAo0H,gBACE,MAAM9wE,EAAY3sF,KAAK23B,OAAO8kD,YAAYz8E,KAAKqpC,OAAOplC,KAAM,CAC1DwgD,eAAgBzkD,KAAKqpC,OAAOplC,KAAK+9C,WACjC0C,kBAAmB1kD,KAAKygB,IAAIuhC,cAE9B8hD,QACE9jG,KAAKygB,IAAIyhC,eACT,CAACyqC,GACDkO,KAAc59E,QAElB,CAMAs+I,aAAa7xI,GACX,MAAMrhB,EAAUqhB,EAAM9S,OAEtB,OADa8S,EAAMlmB,MAEjB,IAAK,aACH,MAAMq6J,EAAUx1J,EAAQ4N,cAAc,gCACtC4nJ,GACIA,EAAQC,aAAa,KAAM,+BAE/B,MACF,IAAK,aACH,MAAMC,EAAU11J,EAAQ4N,cAAc,gCACtC8nJ,GACIA,EAAQD,aAAa,KAAM,+BAMrC,4CA5FWxC,GAA0B,+BAA1BA,GAA0BhtJ,UAAA,8BAAAC,OAAA,CAAA86B,OAAA,SAAA5oB,IAAA,MAAA68I,UAAA,YAAAI,eAAA,kBAAAlvJ,QAAA,CAAAmvJ,UAAA,aAAAlvJ,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAA49B,EAAAzmC,MAAA,EAAAC,KAAA,EAAAC,OAAA,ipBAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,0BD5CvC1N,MAAA,qBAEEA,MADA,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAc2N,EAAAwsJ,aAAA9jJ,GAAoB,EAClCrW,CADmC,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MACrB2N,EAAAwsJ,aAAA9jJ,GAAoB,GAclCrW,MAZA,EAAA48J,EAAA,iBAYA58J,CAZuC,EAAA68J,EAAA,YAYvC78J,CADC,EAAA88J,EAAA,yBAAA98J,OAWDA,MAAA,WACEA,MAAA,EAAA+8J,EAAA,gBASA/8J,MAAA,GAEJA,mCAlCaA,cAAA,OAAA2N,EAAApD,MAMRvK,QAAiBA,MAAjB,OAAA2N,EAAA2P,UAAiBtd,CAAA,WAAAg9J,GAkBfh9J,MAAA,GAAAA,MAAA,OAAA2N,EAAA2uJ,gCCQHtuJ,KAAazJ,oBACbwJ,KACAK,KAAa5J,KACbyJ,KAAgBxJ,KAChB0J,KAAezJ,KACf23B,MAAwB5tB,OAAA,6LAAAC,gBAAA,WAGfwrJ,EAA0B,4WCnCjCl6J,MAAA,+CAPFA,MAAA,uBAKEA,MAAA,kBAAAqW,IAAArW,MAAAyK,IAAA,MAAAwyJ,GAAAj9J,QAAAmP,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAAAsgC,GAAA5wB,UAAAutJ,GAAA56I,OAAA7X,OAAA6L,GAAA,GAEArW,MAAA,EAAAk9J,EAAA,sBAMFl9J,oEAZEA,MAAAi9J,GAAA56I,OAAAm5D,SAGAx7E,MADA,QAAAsgC,GAAA68H,kBAAAF,IACAj9J,CADkC,YAAAsgC,GAAA5wB,UAAAutJ,GAAA56I,OAAA7X,QAK/BxK,QAEYA,MAFZ,mBAAAo9J,GAEYp9J,CAAA,0BAAAA,MAAA,EAAA+zC,EAAAkpH,GAAAj/E,mCAMfh+E,MAAA,8BAAAA,MAAA,EAAAq9J,EAAA,mEAGer9J,MAFZ,mBAAAo9J,GAEYp9J,CAAA,0BAAAA,MAAA,EAAA+zC,EAAAkpH,GAAAj/E,uDAObh+E,MAAA,gCAaEA,MAJA,yBAAAs9J,GAAAt9J,MAAAmrD,IAAAh8C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAi9H,YAAAvwJ,KAAAswJ,IAAwB,EAIjCt9J,CAJkC,2BAAAs9J,GAAAt9J,MAAAmrD,IAAAh8C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACvBsgC,GAAAk9H,cAAAxwJ,KAAAswJ,IAA0B,EAGrCt9J,CAHsC,0BAAAs9J,GAAAt9J,MAAAmrD,IAAAh8C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAC5BsgC,GAAAm9H,eAAAH,IAAsB,EAEhCt9J,CAFiC,8BAAAs9J,GAAAt9J,MAAAmrD,IAAAh8C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACnBsgC,GAAAi9H,YAAAvwJ,KAAAswJ,IAAwB,EACtCt9J,CADuC,8BAAAs9J,GAAAt9J,MAAAmrD,IAAAh8C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACzBsgC,GAAAk9H,cAAAxwJ,KAAAswJ,IAA0B,GAExCt9J,MAAA,MAMFA,mDAbEA,MALA,MAAAsgC,GAAAjhB,IAKArf,CALW,SAAAs9J,GAKXt9J,CAJiB,YAAAsgC,GAAA47H,UAIjBl8J,CAHuB,iBAAAsgC,GAAAg8H,eAGvBt8J,CAFiC,UAAAsgC,GAAAxxB,MAAAM,MAAAtQ,IAAAw+J,IAAAttH,QAEjChwC,CAD2C,WAAAsgC,GAAAxxB,MAAAM,MAAAtQ,IAAAw+J,IAAAl2I,UAUzCpnB,QACAA,MADA,mBAAAsgC,GAAAo9H,sBACA19J,CAD0C,0BAAAA,MAAA,EAAAg0C,GAAAspH,kDAMhDt9J,MAAA,aAGEA,MAAA,mBAAAA,MAAA8P,IAAA,MAAAmtJ,GAAAj9J,MAAA,GAAAmP,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAq9H,mBAAAV,IAAyB,GAElCj9J,MAAA,OAAGA,MAAA,wBACLA,iBADKA,MAAA,GAAAA,YAAA,sEALLA,MAxBA,EAAA49J,EAAA,qBAwBA59J,CAxBkD,EAAA69J,EAAA,0EAApB79J,MAAA,UAAA89J,IA0B3B99J,cAAA,OAAAsgC,GAAAy9H,cAAAd,iCA3BLj9J,MAxBA,EAAAg+J,EAAA,wBAwBAh+J,CAlBC,EAAAi+J,EAAA,yBAAAj+J,MAkBDA,CAT2B,EAAAk+J,EAAA,yBAAAl+J,2CAbiBA,MAAzC,OAAAsgC,GAAAnvB,OAAAmvB,GAAA69H,iBAAAC,QAAyCp+J,CAAA,WAAAq+J,iCAJhDr+J,MAAA,gBACEA,MAAA,EAAAs+J,EAAA,sBAAAt+J,wBA2DFA,gCA5DUA,MAAA,iBACoCA,cAAA,UAAAA,MAAA,IAAAsgC,GAAAi+H,oCA8D5Cv+J,MAAA,2BAcMA,MAAA,+BAJFA,MAAA,gBAIEA,MAAA,EAAAw+J,EAAA,sBAGFx+J,2EALEA,MAAA,QAAAsgC,GAAA68H,kBAAAsB,KAGGz+J,QAAqCA,MAArC,mBAAA0+J,GAAqC1+J,CAAA,0BAAAA,MAAA,EAAA+/B,EAAA0+H,kCAN5Cz+J,MAAA,sBACEA,MAAA,EAAA2+J,EAAA,mCAQF3+J,iCAPsBA,cAAA,UAAAA,MAAA,IAAAsgC,GAAAi+H,oCAYpBv+J,MAAA,8BAAAA,MAAA,EAAA4+J,EAAA,6EACwC5+J,MAArC,mBAAA0+J,GAAqC1+J,CAAA,0BAAAA,MAAA,EAAA+/B,EAAA8+H,kCAF1C7+J,MAAA,EAAA8+J,EAAA,+DAA6B9+J,MAAA,UAAAA,MAAA,IAAAsgC,GAAAi+H,wDAS3Bv+J,MAAA,gCAaEA,MAJA,yBAAA++J,GAAA/+J,MAAA8tD,IAAA3+C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAi9H,YAAAvwJ,KAAA+xJ,IAAwB,EAIjC/+J,CAJkC,2BAAA++J,GAAA/+J,MAAA8tD,IAAA3+C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACvBsgC,GAAAk9H,cAAAxwJ,KAAA+xJ,IAA0B,EAGrC/+J,CAHsC,0BAAA++J,GAAA/+J,MAAA8tD,IAAA3+C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MAC5BsgC,GAAAm9H,eAAAsB,IAAsB,EAEhC/+J,CAFiC,8BAAA++J,GAAA/+J,MAAA8tD,IAAA3+C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACnBsgC,GAAAi9H,YAAAvwJ,KAAA+xJ,IAAwB,EACtC/+J,CADuC,8BAAA++J,GAAA/+J,MAAA8tD,IAAA3+C,UAAAmxB,GAAAtgC,MAAA,UAAAA,MACzBsgC,GAAAk9H,cAAAxwJ,KAAA+xJ,IAA0B,GAExC/+J,MAAA,MAMFA,mDAbEA,MALA,MAAAsgC,GAAAjhB,IAKArf,CALW,SAAA++J,GAKX/+J,CAJiB,YAAAsgC,GAAA47H,UAIjBl8J,CAHuB,iBAAAsgC,GAAAg8H,eAGvBt8J,CAFiC,UAAAsgC,GAAAxxB,MAAAM,MAAAtQ,IAAAigK,IAAA/uH,QAEjChwC,CAD2C,WAAAsgC,GAAAxxB,MAAAM,MAAAtQ,IAAAigK,IAAA33I,UAUzCpnB,QACAA,MADA,mBAAAsgC,GAAAo9H,sBACA19J,CAD0C,0BAAAA,MAAA,EAAAg0C,GAAA+qH,mDAMhD/+J,MAAA,aAGEA,MAAA,mBAAAA,MAAA+wB,IAAA,MAAAiuI,GAAAh/J,QAAA6/B,MAAAS,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAq9H,mBAAAqB,IAAyB,GAElCh/J,MAAA,OAAGA,MAAA,wBACLA,iBADKA,MAAA,GAAAA,YAAA,uEALLA,MAxBA,EAAAi/J,EAAA,qBAwBAj/J,CAxBwD,EAAAk/J,GAAA,mDAA1Bl/J,MAAA,UAAAg/J,GAAAhhF,SA0B3Bh+E,cAAA,OAAAsgC,GAAAy9H,cAAAiB,mCAzDPh/J,MAAA,gBA8BEA,MA7BA,EAAAm/J,EAAA,sBA6BAn/J,CAvBC,EAAAo/J,EAAA,yBAAAp/J,MAuBDA,CArB2B,EAAAq/J,EAAA,yBAAAr/J,MAqB3BA,CAR2B,EAAAs/J,GAAA,yBAAAt/J,OAyC7BA,wDA/DUA,MAAA,iBAELA,QAGQA,MAHR,OAAAsgC,GAAAnvB,OAAAmvB,GAAA69H,iBAAAC,QAGQp+J,CADA,WAAAu/J,GACAv/J,CAAA,WAAAw/J,KC/BN,IAAKC,GAAZ,SAAYA,IACVA,UAAArB,QAAA,UACAqB,GAAAC,KAAA,OAFUD,EAGZ,CAHA,CAAYA,IAAgB,IA4BrB,IAAME,GAAsB,MAA7B,MAAOA,GA6GDhvJ,MACA27E,cACAllD,cA9GFw4H,kBAA4B,EAM7BzB,iBAAmBsB,GAKlB1uJ,QAEA8uJ,iBAEDC,aAAuC,GAEvCpwJ,UAAoC,GAElC2P,IAKAvQ,MAKAotJ,UAKA/qJ,KAAyBsuJ,GAAiBrB,QAK1C9B,gBAAiB,EAKjByD,UAAoB,EAK7B,QACIjzG,GACF,OAAOluD,KAAKswD,KACd,CACA,QAAIpC,CAAKxnD,IACP1G,KAAKswD,MAAQ5pD,GACb1G,KAAKkhK,aAAe,EACtB,CACO5wG,MAEE8wG,gBAAkB,IAAIr/J,SAAyBC,GAE/Ck3J,aAAuB,IAKtByF,YAAc,IAAIrxJ,MAKlBsxJ,cAAgB,IAAItxJ,MAKpB+zJ,aAAe,IAAI/zJ,MAKnBg0J,YAAc,IAAIh0J,MAQlBi0J,iBAAmB,IAAIj0J,MACvBk0J,iBAAmB,IAAIl0J,MAGjCwxJ,sBAEA,YAAIa,GAGF,YAAuB39J,IAAnBhC,KAAKyhK,YACPzhK,KAAKyhK,UAAYzhK,KAAK0hK,eAEjB1hK,KAAKyhK,SACd,CACQA,UAIR1hK,YACUgS,GACA27E,GACAllD,IAFAxoC,KAAA+R,SACA/R,KAAA0tF,iBACA1tF,KAAAwoC,gBACP,CAMHj7B,WACEvN,KAAKmS,QAAU,IAAI6B,KAAmBhU,KAAKkQ,MAAOlQ,KAAK+R,OAEvD/R,KAAKihK,iBAAmBjhK,KAAKohK,gBAAgBv+J,UAAU,KACrD7C,KAAKkhK,aAAe,MAI+C,IAAnElhK,KAAKwoC,cAAcpoC,UAAU,oCAE7BJ,KAAKghK,kBAAmB,EAE5B,CAMA9yJ,cACElO,KAAKmS,QAAQ4B,UACb/T,KAAKihK,iBAAiB9yJ,aACxB,CAQAowJ,kBAAkBt9H,IAIhB,MAAM46G,GAAQ,CAAC56G,GAAMxd,OAAO7X,OACtBiW,GAAQof,GAAMm+C,QAAQx1E,OAC5B,OAAIiY,GAAQ,GAAK7hB,KAAKghK,kBACpBnlB,GAAMv0I,KAAK,IAAIua,OAEVg6H,GAAMhyI,KAAK,IACpB,CAQAg1J,eAAex1H,IACTrpC,KAAKkQ,MAAMM,MAAMtQ,IAAImpC,MACuB,IAA1CrpC,KAAKkQ,MAAMM,MAAMtQ,IAAImpC,IAAQ7gB,WAInCxoB,KAAKkQ,MAAMM,MAAMmP,OAAO0pB,GAAQ,CAAE+H,SAAS,EAAM5oB,UAAU,IAAQ,GACnExoB,KAAKqhK,aAAajzJ,KAAKi7B,IACzB,CAOQq4H,cAGN,OAAO1hK,KAAKkQ,MAAMwU,UAAUhU,OAAO3M,QACjC6sD,KAAUwuB,IACkB,IAAnBA,GAAQx1E,OAAe+3J,OAAQ9wG,KAAM,OAC7C,EACDpwC,KAAK2+D,IACIp/E,KAAK4hK,aACVxiF,GAAQ3+D,IAAKuoD,IAAMA,GAAEhrD,QAAQwE,KAAKxiB,KAAK6hK,eAI/C,CAOQA,YAAYC,GAAkBC,IACpC,OAAOD,GAAGr+I,OAAOu+I,aAAeD,GAAGt+I,OAAOu+I,YAC5C,CAOQJ,aACNxiF,IAEA,MAAM6iF,GAAU,IAAI/iJ,IACpBkgE,UAAQ7kE,QAAS8uB,KACf,MAAM5lB,GAAS4lB,GAAO5lB,OACtB,IAAIy+I,GAAgBD,GAAQ/hK,IAAIujB,SACVzhB,IAAlBkgK,KACFA,GAAgB,GAChBD,GAAQ5hK,IAAIojB,GAAQy+I,KAEtBA,GAAc56J,KAAK+hC,GAAM,GAGpB9tB,MAAMmE,KAAKuiJ,GAAQx7J,QAAQga,IAAKgD,UACKzhB,IAAtChC,KAAKkhK,aAAaz9I,GAAOm5D,WAC3B58E,KAAKkhK,aAAaz9I,GAAOm5D,SAAW,GAE/B,CAAEn5D,UAAQ27D,QAAS6iF,GAAQ/hK,IAAIujB,MAE1C,CAEA07I,cAAcl+H,IAKZ,OAJgBjhC,KAAKkQ,MAAM6V,kBACzBgC,OAEsBJ,OAQpBsZ,GAAMm+C,SAASx1E,QAAUq3B,GAAMxd,OAAO1c,OAAOo7J,OAAU,IACtDlhI,GAAMxd,OAAO1c,OAAOgkB,KAAO,GAN5BkW,GAAMm+C,UACoD,IAA1Dn+C,GAAMm+C,QAAQn+C,GAAMm+C,QAAQx1E,OAAS,GAAGyU,KAAK+jJ,QAQnD,CAEArD,mBAAmB99H,IACjB,MAAMphC,GAA6B,CACjC+I,SAAUq4B,GAAMxd,OAAOm5D,QACvB7xD,OAAQ/qB,KAAKkhK,aAAajgI,GAAMxd,OAAOm5D,UAGzC,IAAIy9E,GAKFA,GAHAr6J,KAAKk5J,cACLl5J,KAAKkuD,KAAKhzB,MAAM,IAAIlxB,OAAOhK,KAAKk5J,aAAc,MAEtCl5J,KAAKkuD,KAAK5kD,MAAMtJ,KAAKk5J,cAErB,CAACl5J,KAAKkuD,MAGhB,IAAIgkC,GAAyB,GAC7BmoE,GAAM55I,IAAKytC,KACTgkC,GAAaA,GAAWvxE,OAAO3gB,KAAK0tF,cAAczhB,OAAO/d,GAAMruD,IAAQ,GAGzEqyF,GAAWzxE,IAAK65I,KACdA,GAASn6G,QAAQt9C,UAAWu8E,KAC1B,MAAMo7E,GAAav5H,GAAMm+C,QAAQz+D,OAAOy+D,IACnCA,GAAQx1E,SACX4wJ,GAAWA,GAAW5wJ,OAAS,GAAGyU,KAAK+jJ,UAAW,GAEpDpiK,KAAKshK,YAAYlzJ,KAAK,CAAEksJ,YAAUl7E,QAASo7E,IAAY,EACxD,EAGL,8CAxRWuG,IAAsB3/J,mBAAAuE,KAAAvE,MAAAwE,MAAA,+BAAtBm7J,GAAsBzyJ,UAAA,yBAAA2mC,eAAA,SAAAnmC,GAAAC,GAAAmmC,OAAA,EAAApmC,6xCDFnC1N,MA9DA,EAAAihK,EAAA,iBA8DAjhK,CA9DyD,EAAAkhK,GAAA,yBAA1BlhK,MAAA,YAAA2N,GAAAoyJ,UA8DA//J,cAAA,OAAA2N,GAAAoyJ,0BCV3BhyJ,KACAyjC,KACAn+B,KACA4C,KACAkrJ,KACAjH,IACApqH,KACAipB,KAAat0D,UACb6J,KACAC,KAAiB7J,MAAA+J,OAAA,mUAAAC,gBAAA,WAGRixJ,EAAsB,mOCxC7B3/J,MAAA,wBAIEA,MAAA,wBACFA,4CAHEA,MAAA,QAAAohK,GAEAphK,cAAA,IAAAA,MAAA,IAAAsgC,EAAA+gI,mBAAAD,IAAA,MCqBD,IAAMzH,EAAuB,MAA9B,MAAOA,EA+BS7C,oBA9BXT,YAAuC,IAAI11J,SAClDC,GAMMu2J,aAKCf,YAAwBkB,IAKjC,cACIrmE,CAAW3rF,GACb1G,KAAK44J,cAAclyJ,EACrB,CACA,cAAI2rF,GACF,OAAOryF,KAAKy3J,YAAY/wJ,KAC1B,CAKU6yJ,iBAAmB,IAAIjsJ,MAEjCvN,YAAoBm4J,GAAAl4J,KAAAk4J,qBAA2C,CAE/D3qJ,WACEvN,KAAKu4J,aAAev4J,KAAKy3J,YACtB1zJ,QAAKmtF,QACLruF,UAAWwvF,GAAuBryF,KAAK65J,gBAAgBxnE,GAC5D,CAEAnkF,cACElO,KAAKu4J,aAAapqJ,aACpB,CAOAopJ,mBAAmBllE,GACjBryF,KAAK44J,cAAcvmE,EACrB,CASAowE,mBAAmBpwE,GACjB,MAAO,kBAAkBA,EAAWl6D,qBACtC,CAMQygI,cAAcvmE,GACpBryF,KAAKy3J,YAAY90J,KAAK0vF,EACxB,CAEQwnE,gBAAgBxnE,GACyB,MAAfA,IAIhCryF,KAAKk4J,oBAAoBwK,oBAAoBrwE,GAC7CryF,KAAKu5J,iBAAiBnrJ,KAAKikF,GAC7B,4CA9EW0oE,GAAuB35J,MAAAuE,KAAA,+BAAvBo1J,EAAuBzsJ,UAAA,0BAAAC,OAAA,CAAAipJ,YAAA,cAAAnlE,WAAA,cAAA7jF,QAAA,CAAA+qJ,iBAAA,oBAAA9qJ,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,oYAAAC,SAAA,SAAAC,EAAAC,IAAA,KAAAD,EAAA,iBDhDlC1N,MADF,UACEA,CAD+B,mCAU7BA,MAAA,cAAUA,MAAA,qBACZA,UAQEA,MANF,iBAMEA,CADD,wCAIGA,MAAA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,GAAAwoJ,mBAAA9/I,EAAA/Q,OAAgC,GAE1CtF,MAAA,EAAAuhK,EAAA,0BAQNvhK,qCAzBIA,QACAA,MADA,aAAAA,MAAA,mCACAA,CADwD,oBAAAwhK,GActDxhK,MAAA,GAAAA,MAAA,QAAAA,MAAA,IAAA2N,GAAA0oJ,cAIyBr2J,MAAA,GAAAA,MAAA,UAAA2N,GAAAyoJ,6BCc3BjoJ,KAAe3J,KACfyJ,KAAgBxJ,KAChB6O,KAAa5O,UACb0J,KAAazJ,KACbguD,KAAc/tD,UACdyO,KACA/E,KACAC,KAAiBgF,MAAA9E,OAAA,8tBAAAC,gBAAA,WAGRirJ,CAAuB,kRCnC9B35J,MADF,WACEA,CADgE,eACtCA,MAAA,iBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAmhI,uBAAAprJ,GAA8B,GAC/DrW,MAAA,6CAMJA,kCANIA,MAAA,GAAAA,MAAA,IAAAsgC,EAAAohI,wBAAA1hK,MAAA,8CAAAA,MAAA,+EAiBAA,MAAA,eAKEA,MAAA,GACFA,mDAJEA,MAAA,oBAAA2hK,GAGA3hK,cAAA,IAAA4hK,EAAAp3J,MAAA,+BAEFxK,MAAA,cACEA,MAAA,GACFA,wCADEA,cAAA,IAAA4hK,EAAAp3J,MAAA,+CAqBMxK,MAAA,yBAOEA,MADA,iBAAAqW,GAAArW,aAAA8P,GAAA9P,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,kBAAAqW,GAAA,MAAAwrJ,EAAA7hK,MAAA8P,GAAAX,UAAA2yJ,EAAA9hK,MAAA,GAAAmP,UAAAyyJ,EAAA5hK,QAAAmP,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAEXsgC,EAAAyhI,gCAAA1rJ,EAAAurJ,EAAAE,EAAAD,GAOzC,GACkB7hK,MAAA,wBACFA,+CAZEA,MAFA,QAAA6hK,EAEA7hK,CAFsB,aAAAsgC,EAAA0hI,2BAAAH,GAEtB7hK,CADuD,UAAA6hK,EAAAtyH,SAYvDvvC,cAAA,IAAAA,MAAA,IAAA6hK,EAAAr3J,OAAA,+BApBJxK,MADF,SACEA,CADkC,wBAKhCA,MAAA,EAAAiiK,GAAA,2BAmBJjiK,0CArBIA,cAAA,QAAA8hK,GAG2B9hK,cAAA,UAAA8hK,EAAAvnJ,iDAqB3Bva,MADF,WACEA,CAD4D,eAG1DA,MAAA,iBAAAqW,GAAArW,MAAAsQ,GAAA,MAAAwxJ,EAAA9hK,MAAA,GAAAmP,UAAAyyJ,EAAA5hK,QAAAmP,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA4hI,gBAAA7rJ,EAAAurJ,EAAAE,GAAwC,GAEjD9hK,MAAA,6CAQJA,6CARIA,MAAA,GAAAA,MAAA,IAAA8hK,EAAAK,iBAAAvhK,IAAAkhK,EAAAK,WAAAniK,MAAA,yDAAAA,MAAA,qGAcFA,MALF,WAKEA,CADD,qBAOGA,MADA,iBAAAqW,GAAArW,aAAAwrD,GAAAxrD,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,kBAAAqW,GAAA,MAAA+rJ,EAAApiK,MAAAwrD,GAAAr8C,UAAA2yJ,EAAA9hK,MAAA,GAAAmP,UAAAyyJ,EAAA5hK,QAAAmP,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAEXsgC,EAAA+hI,6BAAAhsJ,EAAAurJ,EAAAE,EAAAM,GAOzC,GACkBpiK,MAAA,wBAEJA,sEAhBIA,cAAA,UAAAsgC,EAAAgiI,cAGAtiK,MAFA,UAAAoiK,EAAA7yH,QAEAvvC,CAFgC,QAAA8hK,EAEhC9hK,CADuB,aAAAsgC,EAAA0hI,2BAAAI,IAYvBpiK,cAAA,IAAAA,MAAA,IAAAoiK,EAAA53J,OAAA,+BAnCNxK,MAAA,UAeEA,MAdA,EAAAuiK,EAAA,YAcAviK,CAd8D,EAAAwiK,EAAA,cAqChExiK,mDArC+BA,cAAA,OAAA8hK,EAAAvnJ,OAAA/R,OAAA,GAiBFxI,cAAA,UAAAsgC,EAAAmiI,mBAAAX,8BAvDjC9hK,MAAA,GACEA,MAAA,eACEA,MAAA,wBAIFA,QACAA,MAAA,mBA8BEA,MAzBA,EAAA0iK,EAAA,cAyBA1iK,CAzBoC,EAAA2iK,EAAA,eAgEtC3iK,qDA3EsBA,cAAA,oBAAA4iK,GACpB5iK,cAAA,IAAAA,MAAA,6CAAA8hK,EAAAt3J,OAAA,KAOAxK,MAAA,GAAAA,MAAA,WAAA8hK,EAAA1/J,MAGOpC,MAAA,GAAAA,MAAA,8BAyBAA,cAAA,oEA3DfA,MAAA,GAEIA,MADF,YACEA,CAD8C,qBAM5CA,MADA,iBAAAqW,GAAArW,aAAAkP,GAAAlP,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,kBAAAqW,GAAA,MAAAurJ,EAAA5hK,MAAAkP,GAAAC,UAAAmxB,EAAAtgC,QAAA,OAAAA,MACxBsgC,EAAAuiI,oBAAAxsJ,EAAAurJ,GAAmC,GAE/C5hK,QAQAA,MAPA,EAAA8iK,EAAA,gBAOA9iK,CAHC,EAAA+iK,EAAA,iBAMH/iK,QACAA,MAAA,qBACEA,MAAA,EAAAgjK,EAAA,sBA8EFhjK,4CAhGIA,MAAA,GACAA,MADA,UAAA4hK,EAAAryH,QACAvvC,CAD0B,QAAA4hK,GAOzB5hK,cAAA,OAAA4hK,EAAAqB,SAAAz6J,OAAA,GAMoBxI,cAAA,WAAA4hK,EAAAqB,SAAAz6J,QAKWxI,MAAA,GAAAA,MAAA,UAAA4hK,EAAAqB,mDAmFlCjjK,MAAA,8CASEA,MAPA,kBAAAqW,GAAArW,MAAAkjK,GAAA,MAAA5iI,EAAAtgC,QAAA,OAAAA,MAAUsgC,EAAA6iI,2BAAA9sJ,GAAkC,EAO5CrW,CAP6C,iBAAAqW,GAAArW,aAAAkjK,GAAAljK,MAOpCqW,EAAAgX,kBAAwB,GAGjCrtB,MAAA,wBACFA,gCAHEA,MAJA,aAAAA,MAAA,mDAIAA,CAFC,UAAAsgC,EAAAo2H,uBAID12J,MAAA,GAAAA,MAAA,IAAAA,MAAA,uDCvEH,IAAM45J,EAAuB,MAA9B,MAAOA,EA8CD9C,oBACAlmJ,aACAmqC,eA/CHqoH,+BAAyC,EACzC1B,yBAAmC,EAEnC9nG,OAAS,GACTypG,YAAcxjK,KAAKi4F,MAEnBwqE,aAAe,QAEtB,iBAAIx8F,GACF,OAAOlnE,KAAKgS,aAAak1D,eAC3B,CAES4wF,uBAAiC,EACjCC,8BAAwC,EACxCC,kCAA4C,EAK3C0M,mBAAqB,IAAIp3J,MAKzBoqJ,qBAAuB,IAAIpqJ,MAK3BqqJ,4BAA8B,IAAIrqJ,MAKlCsqJ,gCAAkC,IAAItqJ,MAGhDimC,oBAAoB7pB,GACA,OAAdA,EAAMnjB,MACRvG,KAAK83J,uBAAyB93J,KAAK83J,sBACnC93J,KAAK03J,qBAAqBtpJ,KAAKpO,KAAK83J,uBAExC,CAEA/3J,YACUm4J,EACAlmJ,EACAmqC,GAFAn8C,KAAAk4J,sBACAl4J,KAAAgS,eACAhS,KAAAm8C,gBACP,CAEH5uC,WACEvN,KAAKwkK,8BACHxkK,KAAK2kK,0CACT,CAMAC,mBACE,MAAMC,EAAoB7kK,KAAKk4J,oBAC5B4M,aACAp7J,OAAOq7J,MACPr7J,OAAQkS,GAAMA,EAAE5N,WAA2B,QAAd4N,EAAEghE,SAAqBhhE,EAAEopJ,gBAEnDC,EAAuBjlK,KAAKk4J,oBAC/B4M,aACAp7J,OAAOw7J,MACPx7J,OAAQkS,GAAMA,EAAE5N,WAA2B,QAAd4N,EAAEghE,SAAqBhhE,EAAEopJ,gBACnDl2E,EAAU+1E,EAAkBlkJ,OAAOskJ,GACzC,OAAAjlK,KAAKmlK,+BAA+Br2E,GAC7BA,CACT,CAMA61E,2CACE,QACE3kK,KAAKk4J,oBACFgC,oBACAxwJ,OAAO07J,MAAiCx7J,MAM/C,CAMA65J,6BACE/5I,EACAjG,EACA4hJ,EACAC,GAEAA,EAAa30H,QAAUjnB,EAAMmE,QAC7BpK,EAAO8hJ,oBAAoBF,GAC3BrlK,KAAK0kK,mBAAmBt2J,KAAKqV,EAC/B,CAQA+hJ,+BAA+BH,GAGzBA,EAAQ9B,gBAFevhK,IAAvBqjK,EAAQ9B,YACN8B,EAAQ1pJ,OAAOyG,KAAMkjJ,GAAiBA,EAAa30H,UAMjC00H,EAAQ9B,UAElC,CAQA4B,+BAA+Br2E,GAC7B,MAAM22E,EAAoB32E,EAAQplF,OAAQ+Z,GAAWA,EAAOktB,SAAS/mC,OAC/D87J,EAAqB52E,EAAQplF,OAChC+Z,IAAYA,EAAOktB,SACpB/mC,OACF5J,KAAK8iK,0BACH2C,GAAqBC,EACzB,CAMApC,gBAAgB55I,EAAOjG,EAAsB4hJ,GAC3C37I,EAAM+E,kBACNzuB,KAAKwlK,+BAA+BH,GACpCA,EAAQ1pJ,OAAOpB,QAAS+qJ,IACtBA,EAAa30H,QAAU00H,EAAQ9B,aAEjC9/I,EAAO8hJ,oBAAoBF,GAC3BrlK,KAAK0kK,mBAAmBt2J,KAAKqV,EAC/B,CAMAo/I,uBAAuBn5I,GACrBA,EAAM+E,kBACNzuB,KAAK4kK,mBAAmBnkJ,IAAKgD,IAC3BA,EAAOktB,QAAU3wC,KAAK8iK,wBACtB9iK,KAAK0kK,mBAAmBt2J,KAAKqV,EAAM,EAEvC,CAMA0/I,gCACEz5I,EACAjG,EACA4hJ,EACAC,GAEAD,EAAQ1pJ,OAAOpB,QAASssH,IAEpBA,EAAKl2F,QADHk2F,EAAKngI,QAAU4+J,EAAa5+J,OACdgjB,EAAMjG,OAAOoK,QAEdnE,EAAMjG,OAAOoK,UAGhCpK,EAAO8hJ,oBAAoBF,GAC3BrlK,KAAK0kK,mBAAmBt2J,KAAKqV,EAC/B,CAEAwgJ,oBAAoBv6I,EAA0BjG,GAC5CA,EAAOktB,QAAUjnB,EAAMmE,QACvB,MAAM83I,EAAW3lK,KAAKm8C,eAAej8C,IAAIujB,EAAOm5D,QAAU,aACxD,GACF+oF,EAAQh1H,QAAUltB,EAAOktB,QACzB3wC,KAAKm8C,eAAe97C,IAAIojB,EAAOm5D,QAAU,WAAY+oF,GACrD3lK,KAAK0kK,mBAAmBt2J,KAAKqV,EAC/B,CAEAogJ,mBAAmBwB,GACjB,OAAOA,EAAQ1pJ,OAAOjS,OAAQkS,IAAsB,IAAhBA,EAAE5N,UACxC,CAEAo1J,2BAA2BiC,GACzB,GAAIA,EAAQO,SACV,OAAOP,EAAQO,SAASnlJ,IAAKumI,GAAM,IAAMA,GAAGn9I,KAAK,KAGrD,CAEA4kB,gBAAgB/E,GACdA,EAAM+E,iBACR,CAEA81I,2BAA2B76I,GACzB1pB,KAAK83J,sBAAwBpuI,EAAMmE,QACnC7tB,KAAK03J,qBAAqBtpJ,KAAKpO,KAAK83J,sBACtC,CAEA+N,4BAA4Bn8I,GAC1B1pB,KAAK+3J,6BAA+BruI,EAAMmE,QAC1C7tB,KAAK23J,4BAA4BvpJ,KAAKpO,KAAK+3J,6BAC7C,CAEA+N,0BAA0Bp8I,GACxB1pB,KAAKg4J,iCAAmCtuI,EAAMmE,QAC9C7tB,KAAK43J,gCAAgCxpJ,KACnCpO,KAAKg4J,iCAET,4CAjOWgD,GAAuB55J,MAAAuE,KAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,+BAAvBm1J,EAAuB1sJ,UAAA,0BAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAvB1N,MAAA,mBAAAqW,GAAA,OAAA1I,EAAAwkC,oBAAA97B,EAA2B,KAAArW,04DDnEtCA,MADF,UACEA,CAD+B,mCAU7BA,MAAA,cAAUA,MAAA,iBACZA,UACAA,MAAA,kBAUEA,MATA,EAAA2kK,EAAA,YASA3kK,CATkE,EAAA4kK,EAAA,sBA+GlE5kK,MAAA,iBAEEA,MADF,YACEA,CADmD,YAEjDA,MAAA,GAAA6kK,EAAA,2BAcF7kK,QAEEA,MADF,WACEA,CADiB,gDASfA,MANA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAA82J,4BAAApuJ,GAAmC,EAM7CrW,CAN8C,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAMrCqW,EAAAgX,kBAAwB,GAGjCrtB,MAAA,0BAEJA,UAEEA,MADF,WACEA,CADiB,sEAWfA,MARA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAA+2J,0BAAAruJ,GAAiC,EAQ3CrW,CAR4C,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAQnCqW,EAAAgX,kBAAwB,GAGjCrtB,MAAA,0BAKVA,yCAzKIA,QACAA,MADA,aAAAA,MAAA,oCACAA,CADwD,oBAAA8kK,GAM3B9kK,MAAA,GAAAA,MAAA,OAAA2N,EAAA61J,mBAAAh7J,OAAA,GASIxI,cAAA,UAAA2N,EAAA61J,oBA6G1BxjK,MAAA,GAAAA,MAAA,OAAA2N,EAAAy1J,gCAAAz1J,EAAAm4D,eAiBD9lE,MAAA,GAIAA,MAJA,aAAAA,MAAA,sDAIAA,CAFC,UAAA2N,EAAAgpJ,8BAID32J,MAAA,GAAAA,MAAA,IAAAA,MAAA,yDASAA,MAAA,GAMAA,MANA,aAAA2N,EAAAipJ,iCAAA52J,MAAA,yDAAAA,MAAA,yDAMAA,CAFC,UAAA2N,EAAAipJ,kCAID52J,MAAA,GAAAA,MAAA,IAAAA,MAAA,sECtHNmO,KAAezJ,UACfuJ,KAAgBtJ,KAChB2O,KAAa1O,eACbwJ,KAAamF,KACbxF,KACAsF,KACAhF,KAAiBoF,KACjBsxJ,KACAC,KACAryG,KAAcj/C,UACdo2C,IAAgBpuB,IAChB62D,KAAoB32D,KACpBrtB,KAAiButB,MAAArtB,OAAA,yrCAAAC,gBAAA,WAGRkrJ,CAAuB,qRCpB7B,IAAMqL,EAA6B,MAApC,MAAOA,EAiDOjqJ,UACRsxE,cACAwqE,oBACAlmJ,aAjDH9B,MACCkiF,OACAk0E,mBACN,IAAIj7J,KAA0B,IACxBw3B,mBACA03F,QACA9wE,SACA88G,gBAAkC,GAClC/B,+BAAyC,EAKzC7pC,oBAEA6rC,8BACN,gCAIOC,6BAAuC,IAKvCC,gCAA0C,EAGnDC,aACE1jI,aAAajjC,KAAK6iC,oBAClB7iC,KAAK8oG,YACP,CAMA,OAAIroF,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA,iBAAIw6G,GACF,OAAQj7H,KAAKoc,UAAUqE,IAAeuhC,UACxC,CAEAjiD,YACkBqc,EACRsxE,EACAwqE,EACAlmJ,GAHQhS,KAAAoc,YACRpc,KAAA0tF,gBACA1tF,KAAAk4J,sBACAl4J,KAAAgS,cACP,CAMHzE,WACEvN,KAAKk7H,yBAELl7H,KAAKygB,IAAIk5C,QACN51D,QAAKs5C,KAAOs4C,GAAWA,IAAWC,KAAcC,OAChDhzF,UAAU,KACT7C,KAAKkQ,MAAQ,IAAIitF,IAAsB,GAAI,CAAE18E,IAAKzgB,KAAKygB,MACvDzgB,KAAKw2C,YACLx2C,KAAKm7H,yBAAuB,GAIhCn7H,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAWi9C,IAExC9/C,KAAKkQ,QACJ4vC,EAAO19B,KAAM29B,GAAe,2BAATA,EAAE7tC,KAEtBlS,KAAKw2C,WAAS,EAGpB,CAMQA,YACN,MAAMtmC,EAAQlQ,KAAKkQ,MAEbuyC,EAAQ,IAAIsZ,IAAY,CAC5B5G,oBAAoB,EACpBjjD,GAAI,yBACJtG,MAAO,uBACP42C,OAAQ,IACR/+B,OAAQ,IAAIq4C,IACZnS,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,EACXllF,MAAOywJ,QAETtrE,OAAkBprF,EAAOuyC,EAC3B,CAEAokH,wBAQI7mK,KAAKwkK,gCANJxkK,KAAKk4J,oBACHgC,oBACAxwJ,OAAO07J,MAAiCx7J,MAM/C,CAMAsE,cACElO,KAAK87H,2BACL97H,KAAK+7H,4BACL/7H,KAAK8mK,2BACL9mK,KAAKypD,SAASt7C,aAChB,CAMAgtH,0BACEn7H,KAAKu6H,QAAUv6H,KAAKsmK,mBAAmB7hJ,UAAU5hB,UAC9Co5H,IACCj8H,KAAK+mK,yBAAyB9qC,EAA2B,EAG/D,CAOQ+qC,6BAA6B5nF,GACnC,MAAM6nF,EAAsB,GAE5B7nF,SAAQ3+D,IAAK4oB,IACPA,EAAOplC,KAAKozB,WAAW7zB,MAAQ6lC,EAAOplC,KAAKozB,WAAW+jC,UAAY,IAChE6rG,EAAoBtsJ,eAAe0uB,EAAOplC,KAAKozB,WAAW7zB,MAGxD6lC,EAAOplC,KAAKozB,WAAW+jC,SADzB6rG,EAAoB59H,EAAOplC,KAAKozB,WAAW7zB,MAAM43D,WAGjD6rG,EAAoB59H,EAAOplC,KAAKozB,WAAW7zB,MAAQ,CACjD43D,SAAU/xB,EAAOplC,KAAKozB,WAAW+jC,SACjCxvD,MAHYy9B,EAAOhrB,KAAK6oJ,qBAAuB79H,EAAOhrB,KAAKzS,QAQ/Dq7J,EAAoB59H,EAAOplC,KAAKozB,WAAW7zB,MAAQ,CACjD43D,SAAU/xB,EAAOplC,KAAKozB,WAAW+jC,SACjCxvD,MAHYy9B,EAAOhrB,KAAK6oJ,qBAAuB79H,EAAOhrB,KAAKzS,OAK/D,GAIGq7J,CACT,CAMQF,yBACN9qC,GAEA,MAAMgrC,EAAsBjnK,KAAKgnK,6BAC/B/qC,GAEIkrC,EAAwB3gK,OAAOC,KAAKwgK,GACpCG,EAAiC,GACjC1hF,EAAU,GAChBu2C,EAA4Bx7G,IAAK4oB,IAC/B,MAAMg+H,EAAYF,EAAsBz+J,QACtC2gC,EAAOplC,KAAKozB,WAAW7zB,OAEP,IAAd6jK,GACF3hF,EAAQp+E,KAAK2/J,EAAoB59H,EAAOplC,KAAKozB,WAAW7zB,MAAMoI,OAC9Du7J,EAAsBthJ,OAAOwhJ,EAAW,GACxCD,EAA+B9/J,KAAK+hC,EAAOplC,KAAKozB,WAAW7zB,QAKnD,IAFN4jK,EAA+B1+J,QAC7B2gC,EAAOplC,KAAKozB,WAAW7zB,OAGzBkiF,EAAQp+E,KAAK+hC,EAAOhrB,KAAK6oJ,qBAAuB79H,EAAOhrB,KAAKzS,MAAK,GAInE85E,EAAQ97E,QACV5J,KAAKsnK,kBAAkB5hF,EAAQ77E,KAAK,MAExC,CAKQqxH,yBACNl7H,KAAK26H,oBAAsB36H,KAAKygB,IAAI4gC,GAAG/R,GACrC,cACC5lB,GAAuC1pB,KAAKm8H,WAAWzyG,GAE5D,CAMAqyG,4BACE/7H,KAAKu6H,QAAQpsH,aACf,CAKA24J,2BACE9mK,KAAKumK,gBAAgB9lJ,IAAK7E,GAAMA,EAAEzN,eAClCnO,KAAKumK,gBAAkB,EACzB,CAMQzqC,4BACNzwB,OAAQrrG,KAAK26H,qBACb36H,KAAK26H,yBAAsB34H,CAC7B,CAMQm6H,WAAWzyG,IAEfA,EAAM0mE,UACLpwF,KAAK0mK,gCACL1mK,KAAKwkK,gCACNxkK,KAAKgS,aAAak1D,wBAKTlnE,KAAK6iC,mBAAuB,MAErCI,aAAajjC,KAAK6iC,oBAClB7iC,KAAK8oG,aACL9oG,KAAK8mK,4BAGP9mK,KAAKoyF,UAASh5E,MACZsQ,EAAMohE,WACN9qF,KAAKi7H,cACL,aAGFj7H,KAAK6iC,mBAAqBlE,WAAW,KACnC3+B,KAAKunK,oBAAkB,EACtBvnK,KAAKymK,+BAlBNzmK,KAAK8oG,YAmBT,CAOQ+4D,YAAYC,EAAkBC,GACpC,OAAOD,EAAGr+I,OAAOu+I,aAAeD,EAAGt+I,OAAOu+I,YAC5C,CAEQuF,qBACNvnK,KAAKsmK,mBAAmBx/J,QACxB,MAAMs4E,EAAUp/E,KAAK0tF,cAAc85E,cACjCxnK,KAAKoyF,OACL,CAAErrF,OAAQ,CAAEuiF,SAAU,QAAS39E,KAAM,WACrC,GAGF,UAAWyjC,KAAKgwC,EACVA,EAAQx1E,OAAS,GACnB5J,KAAKumK,gBAAgBj/J,KACnB83E,EAAQhwC,GAAG+Q,QAAQt9C,UAAW4kK,IAC5BznK,KAAK0nK,SAAS,CAAEpN,SAAUl7E,EAAQhwC,GAAIgwC,QAASqoF,GAAU,GAKnE,CAEQC,SAASh+I,GACf,MAAM01D,EAAU11D,EAAM01D,QAChBo7E,EAAax6J,KAAKsmK,mBACrBrkJ,MACAvY,OAAQ2/B,GAAyBA,EAAO5lB,SAAWiG,EAAM4wI,SAAS72I,QAClE9C,OAAOy+D,GACVp/E,KAAKsmK,mBAAmBphJ,KAAKs1I,EAAWh4I,KAAKxiB,KAAK6hK,aACpD,CAMQyF,kBAAkB16H,GACxB5sC,KAAK8oG,aAEL,MAAMxf,EAAW,IAAI8oE,OACnBh5I,MAAUpZ,KAAKoyF,OAAQ,YAAapyF,KAAKi7H,gBAErCnwH,EAAU,IAAI6hF,IAAU,CAAErD,aAC1BsD,GAAc,IAAIC,KAAYC,oBAAoBxD,EAAU,CAChE5kC,kBAAmB1kD,KAAKi7H,cACxBx2E,eAAgBzkD,KAAKi7H,gBAgBvBj7H,KAAKkQ,MAAMw4F,iBAAiB,CAbT,CACjBllG,KAAMwpF,IACN1D,SAAUsD,EACV5qC,WAAYhiD,KAAKi7H,cACjB5jG,WAAY,CACVnlB,GAAIlS,KAAKwmK,8BACTmB,eAAgB/6H,GAElBvuB,KAAM,CACJnM,GAAIlS,KAAKwmK,+BAEXnlH,GAAIv2C,IAE2B+vF,IAAcj9E,KACjD,CAKQkrF,aACF9oG,KAAKkQ,OACPlQ,KAAKkQ,MAAM44F,YAEf,4CA7VWu9D,GAA6BjlK,MAAAuE,IAAA,GAAAvE,MAAAwE,KAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA,+BAA7BugK,EAA6B/3J,UAAA,oCAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAA7B1N,MAAA,+BAAA2N,EAAA43J,YAAY,gKAAZN,CAA6B,uDCxCpC,MAAOuB,EACS94E,QAApB/uF,YAAoB+uF,GAAA9uF,KAAA8uF,SAA0B,CAM9Cg2E,aACE,OAAO9kK,KAAK8uF,OACd,CAMAorE,oBACE,OAAOl6J,KAAK8kK,aAAap7J,OACtB+Z,IAA4C,IAAnBA,EAAOktB,QAErC,CAQA+xH,oBAAoBl/J,GAClBxD,KAAK8kK,aAAavqJ,QAASkJ,IAEvBA,EAAOktB,QADJltB,EAAO1jB,YAAoCyD,OAASA,CAGtC,EAGvB,CAOA+hK,oBAAoB9hJ,EAAsB4hJ,GACxC5hJ,EAAO8hJ,oBAAoBF,EAC7B,CAOAwC,cAAcpkJ,EAAsBqkJ,GAClCrkJ,EAAOokJ,cAAcC,EACvB,8EC1DK,MAAMpP,EAAe,CAAC1rE,IAAS6Z,wICgC/B,IAAMkhE,EAAa,MAApB,MAAOA,EAID7P,oBACAv6F,WACAxhB,eACA6rH,iBANVC,cAAqCC,OAAO,MAE5CnoK,YACUm4J,EACAv6F,EACAxhB,EACA6rH,EAGRG,GANQnoK,KAAAk4J,sBACAl4J,KAAA29D,aACA39D,KAAAm8C,iBACAn8C,KAAAgoK,mBAKJG,GACFnoK,KAAKooK,iBAET,CAEQA,mBACNC,SAAO,KACL,MAAMn6G,EAAOluD,KAAKioK,aACN,MAAR/5G,GACFluD,KAAKgoK,iBAAiBzmG,YAAYrT,EAAM,KAAI,EAGlD,CAOA+d,OAAO/d,EAAcruD,EAA6B,IAChD,IAAKG,KAAKsoK,YAAYp6G,GACpB,MAAO,GAGTluD,KAAKioK,WAAW5nK,IAAI6tD,GAEpB,MAAM3M,EAAOvhD,KAAK29D,WAAWS,UAAUpc,YAAc,YAC/CgwC,KAAWC,MAAe/jC,EAAM3M,EAAM,CAC1CsnF,QAAShpI,EAAQgpI,UAEnB,GAAI72C,EAASI,OACX,OAAOpyF,KAAKwnK,cAAcx1E,EAASI,OAAQ,CACzCh3B,SAAU42B,EAASqI,OACnBwsC,KAAM70C,EAAS60C,OAUnB,IAAI/3C,EAEJ,OAVWkD,EAASx5E,SAClB0qD,QAAQK,IAAIyuB,EAASx5E,SAGvB3Y,EAAQ2wE,OAASxwE,KAAK29D,WACnBS,UACClc,eAAe2hC,UAAU,aAK3BiL,EADEjvF,EAAQ0oK,qBAA6CvmK,IAA3BnC,EAAQ0oK,eAC1BvoK,KAAKk4J,oBAAoBgC,oBAEzBl6J,KAAKk4J,oBAAoB4M,aAGjCjlK,EAAQ+I,SACVkmF,EAAUA,EAAQplF,OAAQ+Z,GAAWA,EAAOm5D,UAAY/8E,EAAQ+I,UACvD/I,EAAQwyF,aACjBvD,EAAUA,EAAQplF,OACf+Z,GAAWA,EAAOw+E,YAAcpiG,EAAQwyF,aAI7CvD,EAAUA,EAAQplF,OAAOq7J,MAClB/kK,KAAKwoK,cAAc15E,EAAS5gC,EAAMruD,EAC3C,CAOA2nK,cACEp1E,EACAvyF,EACA4oK,GAA4B,GAE5B,MAAMC,EAAwBD,EAC1BrD,KACAF,KACEp2E,EAAU9uF,KAAKk4J,oBAClBgC,oBACAxwJ,OAAOg/J,GACJ5C,EACH9lK,KAAKm8C,eAAej8C,IACnB,sCACe,EAEnB,OAAOF,KAAKilK,qBACVn2E,EACAsD,EACAvyF,GAAW,GACXimK,EAEJ,CAQQ0C,cACN15E,EACA5gC,EACAruD,GAEA,OAAOivF,EAAQruE,IAAKgD,KAEhB08B,QAAU18B,EAA6BwoD,OAAO/d,EAAMruD,GACpDkgB,SAAS,EACT0D,WAGN,CAQQwhJ,qBACNn2E,EACAsD,EACAvyF,EACAimK,GAEA,OAAOh3E,EAAQruE,IAAKgD,KAEhB08B,QAAU18B,EAAgC+jJ,cACxCp1E,EACAvyF,EACAimK,GAEF/lJ,SAAS,EACT0D,WAGN,CAOQ6kJ,YAAYp6G,GAClB,MAAuB,iBAATA,GAA8B,KAATA,CACrC,4CA5JW65G,GAAa3mK,MAAAuE,KAAAvE,MAAAwE,KAAAxE,MAAAyE,MAAAzE,MAAA0E,KAAA1E,MAQd,kBAAiB,oCARhB2mK,EAAa1mK,QAAb0mK,EAAazmK,mBAAbymK,CAAa,qCCzBpB,SAAUhD,EAAgBthJ,GAC9B,YAAkCzhB,IAA1ByhB,EAAewoD,MACzB,CAOM,SAAUi5F,EAAuBzhJ,GACrC,YAAyCzhB,IAAjCyhB,EAAe+jJ,aACzB,CAOM,SAAUpC,EAAgC3hJ,GAC9C,YACoCzhB,IAAjCyhB,EAAe+jJ,gBACgB,IAAhC/jJ,EAAOklJ,oBAEX,CAuCM,SAAUC,EAASC,EAAcC,GACrC,IAAIr3E,EAAO,GACXq3E,SAAKx/J,MAAM,IAAIiR,QAAQ,CAACqhI,EAAKxsG,KACvBwsG,IAAQitB,EAAKn6H,OAAOU,KACtBqiD,GAAQmqD,KAGLnqD,CACT,CAUM,SAAUs3E,EACdrpJ,EACAwqD,EACA8+F,GAAyB,GAEzB,IAAKtpJ,IAASwqD,EACZ,OAAO,EAET,MAAM++F,EAAWD,EAAgBtpJ,EAAOA,EAAKy4C,WAAWhgC,cAClD+wI,EAASF,EAAgB9+F,EAAKA,EAAG/R,WAAWhgC,cAG5CgxI,EAFaP,EAASK,EAAUC,GACnBN,EAASM,EAAQD,GAGpC,IAAIG,EAAQ,EACZ,OAAID,EAAUv/J,SACZw/J,EAASD,EAAUv/J,OAASq/J,EAASr/J,OAAU,KAG1C,IAAMsiB,KAAKuN,MAAM2vI,EAC1B,wHChGO,IAAMC,EAAY,KAAnB,MAAOA,EAkLDltH,eA7KV1vB,UAAY,GAMZA,YAAc,GAMJ5sB,QAMV+8E,QACE,MAAM,IAAI56D,MAAM,4CAClB,CAKAigF,UACE,MAAM,IAAIjgF,MAAM,8CAClB,CAMUsnJ,oBACR,MAAM,IAAItnJ,MAAM,wDAClB,CAKA,SAAIpW,GACF,OAAO5L,KAAKH,QAAQ+L,KACtB,CAKA,aAAIoC,GACF,OAAkC,IAA3BhO,KAAKH,QAAQmO,SACtB,CAKA,WAAI2iC,CAAQjqC,GACV1G,KAAKH,QAAQ8wC,QAAUjqC,CACzB,CACA,WAAIiqC,GACF,OAAO3wC,KAAKgO,YAAsC,IAAzBhO,KAAKH,QAAQ8wC,OACxC,CAEA,wBAAIg4H,GAEF,OAD6B3oK,KAAKH,QAAQ8oK,uBACW,CACvD,CAEA,kBAAI3D,GACF,MAAMA,EAAiBhlK,KAAKH,QAAQmlK,eACpC,YAA0BhjK,IAAnBgjK,GAAsCA,CAC/C,CAKA,aAAIuE,GACF,OAAOvpK,KAAKH,QAAQ0pK,SACtB,CAKA,UAAIxiK,GACF,OAAO/G,KAAKH,QAAQkH,MACtB,CAKA,YAAIs9J,GACF,YAAiCriK,IAA1BhC,KAAKH,QAAQwkK,SAAyB,GAAKrkK,KAAKH,QAAQwkK,QACjE,CAEA,0BAAImF,CAAuBC,GACzBzpK,KAAK0pK,wBAA0BD,CACjC,CACA,0BAAID,GACF,OAAOxpK,KAAK0pK,uBACd,CACQA,wBAER7B,cAAcC,GAKV9nK,KAAKH,QAAQmO,UAHb85J,EAAWp+J,OAAQigK,GAAQA,EAAG1uH,YAA6BwsD,gBACxD79F,QAAU,EAMf,MAAM+R,EAAS,GACf3b,KAAKwpK,uBAAyB1B,EAC3Bp+J,OAAQigK,GAAQA,EAAG1uH,YAA6BwsD,gBAChDhnF,IAAKkpJ,IACJhuJ,EAAOrU,KAAK,CACVsE,MAAO+9J,EAAG/9J,MACVlF,MAAOijK,EAAG/9J,MACV+kC,SAAS,IAEJg5H,EAAG1uH,cAEd,MAAM2uH,EAAW5pK,KAAKH,QAAQwkK,SAASjiJ,KAAMxG,GAAkB,aAAZA,EAAEhQ,OACjDg+J,IACFA,EAASjuJ,OAASA,GAEpB3b,KAAKulK,oBAAoBqE,EAC3B,CAKArE,oBAAoBF,EAA+BwE,GAAgB,GACjE,OAAQxE,EAAQ7hK,MACd,IAAK,cACH6hK,EAAQ1pJ,OAAOpB,QAASssH,IAClBA,EAAKl2F,UACP3wC,KAAKH,QAAQkH,OAASP,OAAO6H,OAAOrO,KAAKH,QAAQkH,QAAU,GAAI,CAC7D,CAACs+J,EAAQr2I,MAAO63G,EAAKngI,QACtB,GAGL,MACF,IAAK,WACH,IAAIojK,EAAY,GAChBzE,EAAQ1pJ,OACLjS,OAAQkS,IAAsB,IAAhBA,EAAE5N,WAChBuM,QAASssH,IACJA,EAAKl2F,UACPm5H,GAAajjC,EAAKngI,MAAQ,OAGhCojK,EAAYA,EAAUjmJ,MAAM,GAAG,GAC/B7jB,KAAKH,QAAQkH,OAASP,OAAO6H,OAAOrO,KAAKH,QAAQkH,QAAU,GAAI,CAC7D,CAACs+J,EAAQr2I,MAAO86I,IAKlBD,GAAiB7pK,KAAKm8C,gBACxBn8C,KAAKm8C,eAAe97C,IAAIL,KAAK48E,QAAU,WAAY,CACjD71E,OAAQ/G,KAAKH,QAAQkH,QAG3B,CAKA,gBAAIi7J,GACF,YAA8BhgK,IAAvBhC,KAAKH,QAAQy0J,MAAsB,GAAKt0J,KAAKH,QAAQy0J,KAC9D,CAEAv0J,YACEF,EACQs8C,GAGR,GAHQn8C,KAAAm8C,iBAERn8C,KAAKH,QAAUA,EACXG,KAAKm8C,eAAgB,CACvB,MAAM4tH,EAAiB/pK,KAAKm8C,eAAej8C,IACzCF,KAAK48E,QAAU,YAEbmtF,IACF/pK,KAAKH,QAAU0c,KAAYsjC,UAAU7/C,KAAKH,QAASkqK,GAEvD,CAEA/pK,KAAKH,QAAU0c,KAAYsjC,UACzB7/C,KAAKspK,oBACLtpK,KAAKH,SAIPG,KAAKqkK,SAAS9pJ,QAAS8qJ,IACrBrlK,KAAKulK,oBAAoBF,GAAS,EAAK,EAE3C,CAMA2E,iBAAiB97G,EAAc+7G,GAC7B,MAAMrE,EAAW13G,EAAKhzB,MAAM,4BAC5B,IAAK0qI,EACH,OAGF,MAAMsE,EAAsBlqK,KAAKmqK,kBAAkBF,GAC7CG,EAAgB,GACtBxE,SAASrrJ,QAAS8vJ,IAChBH,EAAoBvuJ,OAAOpB,QAASssH,IAClC,MAAMyjC,EAAaD,EAAQ3d,UAAU,GACrC,GAA0B,iBAAf7lB,EAAKngI,MAAoB,CAClC,MAAMuzE,EAAQ4sD,EAAKngI,MAChByxB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAC5BpvB,MAAM,KACH2V,EAAQg7D,EAAMvxE,QAClB4hK,EACGnyI,cACAM,UAAU,OACVC,QAAQ,mBAAoB,MAEnB,IAAVzZ,GACFmrJ,EAAc9iK,KAAK2yE,EAAMh7D,GAE7B,CAEE4nH,EAAK++B,WAC+C,IAApD/+B,EAAK++B,SAASl9J,QAAQ4hK,EAAWnyI,gBAEjCiyI,EAAc9iK,KAAKu/H,EAAKngI,MAAK,EAEhC,GAGI0jK,EAAc1gK,OAAO,CAAC44C,EAAGC,IAAM6nH,EAAc1hK,QAAQ45C,KAAOC,EACrE,CAEA4nH,kBAAkBl+F,GAChB,OAAOjsE,KAAKspK,oBAAoBjF,SAASjiJ,KACtC1b,GACQA,EAAMsoB,OAASi9C,EAG5B,GA1PuB,+ICXnB,MAAOwG,EACJ83F,YACAC,WAEPzqK,cACEC,KAAKuqK,YAAc,GACnBvqK,KAAKuqK,YAAYE,QAAUh4F,EAAmBi4F,gBAC9C1qK,KAAKuqK,YAAYI,QAAUl4F,EAAmBm4F,gBAC9C5qK,KAAKuqK,YAAYM,QAAUp4F,EAAmBq4F,gBAC9C9qK,KAAKuqK,YAAYQ,QAAUt4F,EAAmBu4F,gBAC9ChrK,KAAKuqK,YAAYU,OAASx4F,EAAmBy4F,eAC7ClrK,KAAKwqK,WAAa,GAClBxqK,KAAKwqK,WAAWW,YAAcnrK,KAAKorK,mBACnCprK,KAAKwqK,WAAWa,OAASrrK,KAAKsrK,cAC9BtrK,KAAKwqK,WAAWe,YAAcvrK,KAAKwrK,kBACrC,CACA,2BAAOC,CAAqBliF,GAC1B,OAAOA,EAAQ,GACjB,CACA,sBAAOmiF,CAAgBngK,GAErB,MAAO,CAACA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAK,IACnD,CAEA,6BAAOogK,CAAuBrqF,EAAO3O,GAEnC,MAAMi5F,EAAMn7F,KAAuBkC,GAEnC,OAAOyrD,WAAW98C,IADK,QACKsqF,EAAuB7rF,GACrD,CAGA,qBAAOmrF,CAAehwF,GACpB,MAAMmyC,EAAW56C,EAAmBo5F,gBAAgB3wF,EAAO4wF,OACrDl/H,OAAuB5qC,IAAhBk5E,EAAOtuC,KAAqBsuC,EAAOtuC,UAAO5qC,EACvD,OAAO,IAAIkiG,KAAc,CACvBt3D,KAAM,IAAIs3D,IAAa,CACrB1oB,KAAM,IAAI0oB,IAAa,CACrB34F,MAAOknE,EAAmBi5F,gBAAgBxwF,EAAO3vE,SAEnD8nH,KACEn4C,EAAOm4C,KAAKl9G,MACZ,IACA+kE,EAAOm4C,KAAK04C,OACZ,IACA7wF,EAAOm4C,KAAK/zG,KACZ,OACA47D,EAAOm4C,KAAK24C,OACdrwC,aAAczgD,EAAO+wF,kBACrB/4C,UAAWh4C,EAAOgxF,oBAClB/4C,QAAS1gD,EAAmBg5F,qBAAqBvwF,EAAOixF,SACxD/4C,QAAS3gD,EAAmBg5F,qBAAqBvwF,EAAOkxF,SACxD/+C,WACAzgF,UAGN,CAEA,sBAAO89H,CAAgBxvF,GACrB,MAAM3yC,EAAM,QAAU2yC,EAAOH,YAAc,YAAcG,EAAOF,UAC1DqyC,EAAW56C,EAAmBo5F,gBAAgB3wF,EAAO4wF,OAE3D,OAAO,IAAI5nE,KAAc,CACvBnY,MAAO,IAAImY,IAAa,CACtB37D,MACA8kF,cAGN,CAEA,sBAAOu9C,CAAgB1vF,GAErB,MAAMM,EAAO,IAAI0oB,IAAa,CAC5B34F,MAAOknE,EAAmBi5F,gBAAgBxwF,EAAO3vE,SAE7C6vE,EAASF,EAAOK,QAClB9I,EAAmB45F,gBAAgBnxF,EAAOK,cAC1Cv5E,EACJ,OAAO,IAAIkiG,KAAc,CACvB1oB,OACAJ,UAEJ,CACA,sBAAOixF,CAAgB9wF,GACrB,IAAI2gE,EACJ,MAAM3wI,EAAQknE,EAAmBi5F,gBAAgBnwF,EAAQhwE,OACzD,MAAsB,gBAAlBgwE,EAAQplE,MACV+lI,EAAW,CAAC,GACe,mBAAlB3gE,EAAQplE,MACjB+lI,EAAW,CAAC,EAAG,EAAG,EAAG,GACM,sBAAlB3gE,EAAQplE,MACjB+lI,EAAW,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GACA,eAAlB3gE,EAAQplE,MACjB+lI,EAAW,CAAC,EAAG,GACY,gBAAlB3gE,EAAQplE,QAEjB5K,EAAM,GAAK,GAEN,IAAI24F,IAAe,CACxB34F,QACA2wI,WACAh9G,MAAOuzC,EAAmBg5F,qBAAqBlwF,EAAQr8C,QAE3D,CAEA,sBAAO4rI,CAAgB5vF,GACrB,OAAO,IAAIgpB,KAAc,CACvB9oB,OAAQ3I,EAAmB45F,gBAAgBnxF,IAE/C,CACA,sBAAO2wF,CAAgBC,GACrB,GAAc,IAAVA,QAAyB9pK,IAAV8pK,EACjB,OAGF,MAAMQ,GADaR,EAAQ5/I,KAAK4lG,GAAM,IACV5lG,KAAK4lG,GAAK,EACtC,OAAIw6C,EAAS,EACJ,EAAIpgJ,KAAK4lG,GAAKw6C,EAEdA,CAEX,CAEA,sBAAOtB,CAAgB9vF,GACrB,MAAMM,EAAO,IAAI0oB,IAAa,CAC5B34F,MAAOknE,EAAmBi5F,gBAAgBxwF,EAAO3vE,SAE7C6vE,EAASF,EAAOK,QAClB9I,EAAmB45F,gBAAgBnxF,EAAOK,cAC1Cv5E,EACEq4F,EAAS5nB,EAAmBg5F,qBAAqBvwF,EAAO57D,MAAQ,EAChE+tG,EAAW56C,EAAmBo5F,gBAAgB3wF,EAAO4wF,OAC3D,MAAqB,kBAAjB5wF,EAAO/kE,MACF,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAe,CACxB7J,SACA7e,OACAJ,aAGsB,iBAAjBF,EAAO/kE,MACT,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B1oB,OACAJ,SACAq4C,OAAQ,EACRp5B,SACAkyE,QAAS,EACTT,MAAO,EACPz+C,eAGsB,mBAAjBnyC,EAAO/kE,MACT,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B1oB,OACAJ,SACAq4C,OAAQ,EACRp5B,SACAgzB,eAGsB,kBAAjBnyC,EAAO/kE,MACT,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B1oB,OACAJ,SACAq4C,OAAQ,EACRp5B,SACAyxE,MAAO5/I,KAAK4lG,GAAK,EACjBzE,eAGsB,aAAjBnyC,EAAO/kE,MACT,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B1oB,OACAJ,SACAq4C,OAAQ,EACRp5B,SACAkyE,QAAS,EACTT,MAAO5/I,KAAK4lG,GAAK,EACjBzE,eAGsB,oBAAjBnyC,EAAO/kE,MACT,IAAI+tF,KAAc,CACvBnY,MAAO,IAAImY,IAAqB,CAC9B1oB,OACAJ,SACAq4C,OAAQ,EACRp5B,SACAyxE,MAAO,EACPz+C,oBARC,CAYT,CAEAm/C,qBAAqBC,EAAcC,GACjC,MAAM78J,EAAS,GACf,QAASu/B,EAAI,EAAGu9H,EAAKF,EAAa7iK,OAAQwlC,EAAIu9H,IAAMv9H,EAAG,CACrD,MAAMw9H,EAAkBH,EAAar9H,GAAGw9H,gBAElCptI,EAAQotI,EAAgBtiH,OAC5BsiH,EAAgBlkK,QAAQ,KAAO,EAC/BkkK,EAAgBlkK,QAAQ,KAAO,GAE3BwyE,EAASuxF,EAAar9H,GAAG8rC,OACzB1H,EAAWi5F,EAAar9H,GAAGokC,SAC3BC,GAAWg5F,EAAar9H,GAAGqkC,SACjC,IAAI7B,EAAgB,KACH,IAAb4B,IACF5B,EAAgBa,EAAmBk5F,uBACjCn4F,EACAk5F,IAGJ,IAAIj7F,EAAgB,KACH,IAAbgC,KACFhC,EAAgBgB,EAAmBk5F,uBACjCl4F,GACAi5F,IAGJ,MAAMv2J,EAAQnW,KAAKuqK,YAAYrvF,EAAO13E,MAAM4X,KAAKpb,KAAMk7E,GACvDrrE,EAAOvI,KAEI,SAAUwD,EAASwwD,GACxB,IAAIzkC,GAAU,EAUd,GAT2B,OAAvB72B,KAAK4xE,eAAiD,OAAvB5xE,KAAKyxE,cACtC56C,EACEykC,EAAat7D,KAAKyxE,eAClBnW,GAAct7D,KAAK4xE,cACW,OAAvB5xE,KAAK4xE,cACd/6C,EAAUykC,GAAct7D,KAAK4xE,cACG,OAAvB5xE,KAAKyxE,gBACd56C,EAAUykC,EAAat7D,KAAKyxE,eAE1B56C,EAAS,CACX,MAAMnwB,EAAQoE,EAAQ5K,IAAIF,KAAKw/B,OAC/B,OAAAx/B,KAAKmW,MAAM02J,UAAU9jD,QAAQriH,GACtB,CAAC1G,KAAKmW,MACf,CACF,EACGwkE,KAAK,CACR/I,gBACAH,gBACAjyC,QACArpB,UAGN,CACA,OAAOtG,CACT,CAEAy7J,cAAc30J,GACZ,MAAMR,EAAQnW,KAAKuqK,YAAY5zJ,EAASukE,OAAO13E,MAAM4X,KACnDpb,KACA2W,EAASukE,QAEX,MACS,IACE,CAAC/kE,EAGd,CACAq1J,mBAAmB70J,GACjB,MAAMm2J,EAAgBn2J,EAASm2J,cACzBC,EAAe/sK,KAAKuqK,YAAYuC,EAActpK,MAAM4X,KACxDpb,KACA8sK,GAEIttI,EAAQ7oB,EAAS6oB,MACjBmN,EAAU,GAChB,QAASyC,EAAI,EAAGu9H,EAAKh2J,EAASq2J,gBAAgBpjK,OAAQwlC,EAAIu9H,IAAMv9H,EAAG,CACjE,MAAM69H,EAAiBt2J,EAASq2J,gBAAgB59H,GAChD,IAAIhjB,EAMAA,EAJF6gJ,QAAeC,cAGL,IAAN99H,EACIz4B,EAASw2J,SAETx2J,EAASq2J,gBAAgB59H,EAAI,GAAGg+H,cAGlCH,EAAeC,cAEvB,MAAM/gJ,GAAM8gJ,EAAeG,cACrBlyF,EAAS+xF,EAAe/xF,OACxB/kE,EAAQnW,KAAKuqK,YAAYrvF,EAAO13E,MAAM4X,KAAKpb,KAAMk7E,GACvDvuC,EAAQrlC,KAAK,CAAE8kB,MAAKD,OAAKhW,SAC3B,CACA,OACUrL,IACN,MAAMpE,EAAQoE,EAAQ5K,IAAIs/B,GAC1B,QAAS4P,EAAI,EAAGu9H,EAAKhgI,EAAQ/iC,OAAQwlC,EAAIu9H,IAAMv9H,EAAG,CAChD,IAAI7C,GAMJ,GAJEA,GADQ,IAAN6C,EACU1oC,GAASimC,EAAQyC,GAAGhjB,KAAO1lB,GAASimC,EAAQyC,GAAGjjB,IAE/CzlB,EAAQimC,EAAQyC,GAAGhjB,KAAO1lB,GAASimC,EAAQyC,GAAGjjB,IAExDogB,GACF,MAAO,CAACI,EAAQyC,GAAGj5B,MAEvB,CACA,MAAO,CAAC42J,EAAY,CAG1B,CACA3B,mBAAmBz0J,GACjB,MAAMm2J,EAAgBn2J,EAASm2J,cAC/B,IAAIC,EAAe,GACfD,IACFC,EAAe,CACb/sK,KAAKuqK,YAAYuC,EAActpK,MAAM4X,KAAKpb,KAAM8sK,KAGpD,MAAMttI,EAAQ7oB,EAAS02J,OACjBC,EAAQ32J,EAASskE,iBACjBsyF,EAAKvtK,KACX,YACE,MAAMwtK,EAAO,GACb,QAASp+H,EAAI,EAAGu9H,EAAKW,EAAM1jK,OAAQwlC,EAAIu9H,IAAMv9H,EAAG,CAC9C,MAAM0vB,GAAOwuG,EAAMl+H,GACb8rC,EAASpc,GAAKoc,OACpBsyF,EAAK1uG,GAAKp4D,OAAS,CAAC6mK,EAAGhD,YAAYrvF,EAAO13E,MAAM4X,KAAKmyJ,EAAIryF,GAC3D,CAEA,OAAQpwE,GACQ0iK,EAAK1iK,EAAQ5K,IAAIs/B,KACRutI,CAE3B,EAZA,EAaF,CACAr6F,cAAc+6F,EAAWf,GACvB,MAAMl6F,EAAci7F,EAAUj7F,YAC9B,IAAIk7F,EAAiB,GACrB,MAAMC,EAAmB3tK,KAAKwqK,WAAWh4F,EAAY77D,SAASnT,MAAM4X,KAClEpb,KACAwyE,EAAY77D,UAKd,QAHyB3U,IAArB2rK,GACFD,EAAepmK,KAAKqmK,GAElBF,EAAUhB,aAAc,CAC1B,MAAMmB,EAA6B5tK,KAAKwsK,qBACtCiB,EAAUhB,aACVC,GAEFgB,EAAiBA,EAAe/sJ,OAAOitJ,EACzC,CACA,OAA8B,IAA1BF,EAAe9jK,OACV8jK,EAAe,GAGb,CAAC5iK,EAASwwD,KACf,IAAIzrD,EAAS,GACb,QAASu/B,EAAI,EAAGu9H,GAAKe,EAAe9jK,OAAQwlC,EAAIu9H,KAAMv9H,EAAG,CACvD,MAAM/F,EAASqkI,EAAet+H,GAAGh0B,KAAK,KAAMtQ,EAASwwD,GACjDjyB,IACFx5B,EAASA,EAAO8Q,OAAO0oB,GAE3B,CACA,OAAOx5B,EAIf,2KC7WI,SAAUysD,IAId,MAAM0M,EAAI98C,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpBpgB,EAAI70C,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpB5+B,EAAIr2B,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpB/F,EAAS,IAAIgf,IAAe,CAChC7uF,MAAO,CAACy9D,EAAGjI,EAAGxe,EAAG,GACjBrjB,MAAO,IAEHs8C,EAAO,IAAI4e,IAAa,CAC5B7uF,MAAO,CAACy9D,EAAGjI,EAAGxe,EAAG,MAEnB,MAAO,CAACoqC,EAAkCrxB,KACxC,MAAMuyG,GAAclhF,EAAUzsF,IAAI,UAClC,GAAI2tK,OAAeC,MAAYD,IAAc,CAC3C,GACEA,GAAYtmD,QACZ56B,EAAUzsF,IAAI,QACdysF,EAAUzsF,IAAI,cACdysF,EAAUzsF,IAAI,YACd,CACA,MAAMkyF,EAA2B,CAC/BzF,EAAUzsF,IAAI,aACdysF,EAAUzsF,IAAI,aAEVm6F,EACJ1N,EAAUzsF,IAAI,OACdgsB,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO1/B,EAAO,IAClC92B,EACFuyG,GAAYtmD,OAAOltB,OAASA,CAC9B,CAEA,OADqB,IAAI2zE,KACLtyG,YAAYmyG,QAAa7rK,EAAWs5D,EAC1D,CAqBA,OApBc,IAAI8+B,KAAc,CAC9Bhf,SACAI,OACAuQ,MAAO,IAAIqO,IAAe,CACxBC,OAAQ,EACRjf,SACAI,SAEF5uC,KAAM+/C,EAAUzsF,IAAI,aAChB,IAAIk6F,IAAa,CACfxtD,KAAM+/C,EAAUzsF,IAAI,aAAai4D,WACjCg7D,QAAS,EACTC,SAAS,EACTC,KAAM,0BACN73C,KAAM,IAAI4e,IAAa,CAAE7uF,MAAO,SAChC6vE,OAAQ,IAAIgf,IAAe,CAAE7uF,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,SAEZ/oH,GACL,CAGL,CAEM,SAAUu6D,IACd,MAAMyM,EAAI98C,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpBpgB,EAAI70C,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpB5+B,EAAIr2B,KAAKuN,MAAsB,IAAhBvN,KAAKi1D,UACpB/F,EAAS,IAAIgf,IAAe,CAChC7uF,MAAO,CAACy9D,EAAGjI,EAAGxe,EAAG,GACjBrjB,MAAO,IAEHs8C,EAAO,IAAI4e,IAAa,CAC5B7uF,MAAO,CAACy9D,EAAGjI,EAAGxe,EAAG,MAYnB,OATc,IAAI63C,KAAc,CAC9Bhf,SACAI,OACAuQ,MAAO,IAAIqO,IAAe,CACxBC,OAAQ,EACRjf,SACAI,UAIN,CAOM,SAAU4/C,EACdtwH,EACAwwD,GAqBA,MAAM2yG,EAAW,CAnBG,IAAI7zE,KAAc,CACpCxtD,KAAM,IAAIwtD,IAAa,CACrBxtD,KAAM9hC,EAAQ5K,IAAI,gBAClBgzH,UAAW,OACXyI,aAAc,MACdtI,KAAM,0BACN73C,KAAM,IAAI4e,IAAa,CAAE7uF,MAAO,SAChCqwH,eAAgB,IAAIxhC,IAAa,CAAE7uF,MAAO,6BAC1CswH,iBAAkB,IAAIzhC,IAAe,CACnC7uF,MAAO,4BACP2zB,MAAO,IAETk8C,OAAQ,IAAIgf,IAAe,CAAE7uF,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,EACVoI,QAAS,GACTC,QAAS,GACT/gF,QAAS,CAAC,IAAK,IAAK,IAAK,UAqC7B,MAhCO,UADCvnC,EAAQqiF,cAAc8U,UAE1BgsE,EAAS3mK,KACP,IAAI8yF,KAAc,CAChBrO,MAAO,IAAIqO,IAAe,CACxBC,OAAQ,GACRjf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,OACP2zB,MAAO,UAOf+uI,EAAS3mK,KACP,IAAI8yF,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,QACP2zB,MAAO,OAIb+uI,EAAS3mK,KACP,IAAI8yF,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,OACP2zB,MAAO,QAMV+uI,CACT,CAOM,SAAUrH,EACd97J,EACAwwD,GAEA,OAAO,IAAI8+B,KAAc,CACvBrO,MAAO,IAAIqO,IAAa,CACtB7xD,IAAK,iDAGPqE,KAAM,IAAIwtD,IAAa,CACrBxtD,KAAM9hC,EAAQ5K,IAAI,kBAClBgzH,UAAW,OACXyI,aAAc,SACdtI,KAAM,0BACN73C,KAAM,IAAI4e,IAAa,CAAE7uF,MAAO,SAChCqwH,eAAgB,IAAIxhC,IAAa,CAAE7uF,MAAO,6BAC1CswH,iBAAkB,IAAIzhC,IAAe,CACnC7uF,MAAO,4BACP2zB,MAAO,IAETk8C,OAAQ,IAAIgf,IAAe,CAAE7uF,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,EACVoI,QAAS,GACTC,SAAS,GACT/gF,QAAS,CAAC,IAAK,IAAK,IAAK,QAG/B,wHCvLM,SAAUkoD,GACd3tD,OACAgW,UAAU,EACV43C,cAAc,CAAC,EAAG,IAAK,KACvBC,qBAAqB,CAAC,IAAK,IAAK,MAM9B,IACF,IAAIppF,EACA68J,EACAC,EACApnI,EAEJ,MAAMuhF,KAAWC,MAAa/tB,GAAa32E,MAAM,GAC3CuqJ,KAAkB7lD,MAAa9tB,GAAoB52E,MAAM,GAE/D,OACsB,IAApBykG,EAAS1+G,SACe,iBAAhB4wF,GACN,kBAAkBtwF,KAAKswF,MAEzB53C,EAAU0lE,EAAS,IAGrB4lD,EAAe,SAAS5lD,EAAS,MAAMA,EAAS,MAAMA,EAAS,MAAM1lE,MACrEvxC,EAAYmpF,EAEZ2zE,EAAkB,QAAQC,EAAgB,MAAMA,EAAgB,MAAMA,EAAgB,OAEtFrnI,EACE,uIAEAmnI,EACA,WACAC,EACA,6tIAGK,IAAIjqE,KAAc,CACvBnY,MAAO,IAAImY,IAAa,CACtB37D,IAAKxB,EACL6b,UACAyrH,OAAQ,CAAC,GAAK,OAEhBzhI,KAAM,IAAIs3D,IAAa,CACrBt3D,OACAymF,KAAM,0BACN73C,KAAM,IAAI0oB,IAAa,CAAE34F,MAAO,SAChC6vE,OAAQ,IAAI8oB,IAAe,CAAE34F,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,KAGhB,sJCjDM,SAAUi2B,IAId,MAAM+rB,EAAeuB,IACfC,KAAch0E,OAEpB,IAAIpkF,EAEJ,MAAO,CAACw2E,EAAkCrxB,KACxC,GAA0B,kBAAtBqxB,EAAU/P,QACZzmE,SAkEN,SAASq4J,EACPC,EAA+C,CAAC,EAAG,IAAK,IAAK,GAC7DpzF,EAAsB,EACtBqzF,EAA6C,CAAC,EAAG,IAAK,IAAK,KAC3Dn7C,GAEA,MAAMn4C,EAAS,IAAI8oB,IAAe,CAChChlE,MAAOm8C,EACP9vE,MAAOkjK,IAGHjzF,EAAO,IAAI0oB,IAAa,CAC5B34F,MAAOmjK,IAGT,OAAO,IAAIxqE,KAAc,CACvB9oB,SACAI,OACAuQ,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,SACAI,SAEF5uC,KAAM,IAAIs3D,IAAa,CACrBmvB,KAAM,0BACNzmF,KAAM2mF,EACN/3C,KAAM,IAAI0oB,IAAa,CAAE34F,MAAO,SAChC6vE,OAAQ,IAAI8oB,IAAe,CAAE34F,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,KAGhB,CAjGcyjD,CACN7hF,EAAUzsF,IAAI,gBACd,EACAysF,EAAUzsF,IAAI,cACdysF,EAAUzsF,IAAI,eAETiW,EACF,CACL,MAAM03J,EAAclhF,EAAUzsF,IAAI,UAClC,OAAI2tK,GACmB,IAAIG,KACLtyG,YAAYmyG,EAAalhF,EAAWrxB,IAG1DnlD,EAAyB,UADJw2E,EAAUQ,cAAc8U,UACVssE,EAAcxB,EACjD52J,EAAM02J,UAAU9jD,QAAQp8B,EAAUzsF,IAAI,cAC/BiW,EACT,EAEJ,CAMM,SAAUm4J,GACd1hI,OACAyuC,cAAc,EACdszF,YAAY,CAAC,EAAG,IAAK,IAAK,IAC1BC,cAAc,CAAC,EAAG,IAAK,IAAK,KAM1B,IACF,MAAMC,KAAkBtmD,MAAaomD,GAAW9qJ,MAAM,GAChDirJ,KAAoBvmD,MAAaqmD,GAAa/qJ,MAAM,GAEpDu3D,EAAS,IAAI8oB,IAAe,CAChChlE,MAAOm8C,EACP9vE,MAAOujK,IAGHtzF,EAAO,IAAI0oB,IAAa,CAC5B34F,MAAOsjK,IAGT,OAAO,IAAI3qE,KAAc,CACvB9oB,SACAI,OACAuQ,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,SACAI,SAEF5uC,KAAM,IAAIs3D,IAAa,CACrBt3D,OACAymF,KAAM,0BACN73C,KAAM,IAAI0oB,IAAa,CAAE34F,MAAO,SAChC6vE,OAAQ,IAAI8oB,IAAe,CAAE34F,MAAO,OAAQ2zB,MAAO,IACnD6rF,UAAU,KAGhB,0LCzEO,IAAMijD,EAAY,MAAnB,MAAOA,EACJ73J,MAqCPulD,YACE77D,EACAiL,EACAwwD,GAEA,IAAKz7D,EACH,SAAO06F,OAET,GAAuB,mBAAZ16F,GAA0BA,aAAmBu6F,KACtD,OAAOv6F,EAET,MAAMkvK,EAAc/uK,KAAK0/G,WAAW,QAAS7/G,GAC7C,GAAIkvK,EAAYlC,UAAW,CACzB,IAAImC,GAAqB,EACrBC,EAAqB1qD,IACzB,GAAI1kH,EAAQ+sC,KAAM,CAChB,MAAMsiI,EAA8BrvK,EAAQ+sC,MAAMw4E,iBAC9C1zC,MAAuBv2C,OAAOt7B,EAAQ+sC,KAAKw4E,qBAC3CpjH,EACEmtK,EAA8BtvK,EAAQ+sC,MAAMu4E,iBAC9CzzC,MAAuBv2C,OAAOt7B,EAAQ+sC,KAAKu4E,qBAC3CnjH,EAQJgtK,GAAqBE,IAPCrvK,EAAQ+sC,MAAMglC,cAChC/xE,EAAQ+sC,KAAKglC,cACb,GAMJq9F,EAAqBE,IALCtvK,EAAQ+sC,MAAM6kC,cAChC5xE,EAAQ+sC,KAAK6kC,cACb8yC,IAIN,EAEE1kH,EAAQ+sC,MAAMw4E,eACdvlH,EAAQ+sC,MAAMu4E,eACdtlH,EAAQ+sC,MAAMglC,eACd/xE,EAAQ+sC,MAAM6kC,iBAGZ3mE,GACAwwD,GAAc0zG,IACd1zG,GAAc2zG,EAEVnkK,GAAWjL,EAAQ+sC,KAAKkzD,WAC1BivE,EACGlC,UACA9jD,QAAQ/oH,KAAKovK,SAAStkK,EAASjL,EAAQ+sC,KAAKkzD,YAGjDivE,EAAYhmD,UAGlB,CACA,OAAOgmD,CACT,CAEOrvD,WAAWn5G,EAAaG,GAC7B,MAAM2oK,EAAe,GACfC,EAAQtvK,KAAKuvK,SAAShpK,GAE5B,OAAI+oK,GAAS5oK,aAAiBF,QAC5BA,OAAOC,KAAKC,GAAO6T,QAASi1J,KAC1B,MAAMC,EAAQzvK,KAAK0vK,SAASF,IAC5BH,EAAaI,GAASzvK,KAAK0/G,WAAW8vD,GAAM9oK,EAAM8oK,IAAK,GAElD,IAAIF,EAAMD,IAEV3oK,CAEX,CAEQgpK,SAASnpK,GACf,IAAIkpK,EACJ,OAAQlpK,EAAI4xB,eACV,IAAK,SACL,IAAK,eACL,IAAK,OACHs3I,EAAQ,QAMZ,OAAOA,GAASlpK,CAClB,CAEQgpK,SAAShpK,GACf,IAAI+oK,EAAQl1E,EAAQ7zF,EAAImoC,OAAO,GAAG0gC,cAAgB7oE,EAAIsd,MAAM,IAC5D,MAAY,iBAARtd,IACF+oK,EAAQl1E,KAEE,mBAAR7zF,IACF+oK,EAAQl1E,KAEE,qBAAR7zF,IACF+oK,EAAQl1E,KAGHk1E,CACT,CAEA/zG,uBACEzwD,EACA24C,EACA6X,GAEA,IAAInlD,EACJ,MAAM3S,GAAOigD,EAAiBjgD,KAC1BigD,EAAiBjgD,KACjBxD,KAAK2vK,iBAAiB7kK,GACpBg1F,EAAYr8C,EAAiBq8C,UAC7B77F,EAAOw/C,EAAiBx/C,KACxBm3E,EAAS33B,EAAiB23B,OAC1Bl8C,EAAQukB,EAAiBvkB,MACzBs8C,EAAO/3B,EAAiB+3B,KACxB6yF,EAAS5qH,EAAiB4qH,OAC1Bh0E,EAAS52C,EAAiB42C,OAC1B1uF,EAAO83C,EAAiB93C,KACxB21E,EAAQ79B,EAAiB69B,MACzBhiE,EAAOrb,EAAOA,EAAK2F,OAAS,EAC5B4hB,EAAQi4B,EAAiBj4B,MAC3Bi4B,EAAiBj4B,MAAMs0E,eACvB99F,EACEktK,EAA8BzrH,EAAiBj4B,OAAO45F,iBACxD1zC,MAAuBv2C,OAAOsoB,EAAiBj4B,MAAM45F,qBACrDpjH,EACEmtK,EAA8B1rH,EAAiBj4B,OAAO25F,iBACxDzzC,MAAuBv2C,OAAOsoB,EAAiBj4B,MAAM25F,qBACrDnjH,EAQEgtK,EAAqBE,IAPLzrH,EAAiBj4B,OAAOomD,cAC1CnuB,EAAiBj4B,MAAMomD,cACvB,GAMEq9F,EAAqBE,IALL1rH,EAAiBj4B,OAAOimD,cAC1ChuB,EAAiBj4B,MAAMimD,cACvB8yC,KAKJ,IAAIqrD,EAAansH,EAAiBj4B,OAAOrV,MACrCnW,KAAK0/G,WAAW,OAAQj8D,EAAiBj4B,MAAMrV,YAC/CnU,GACC4tK,GAAcpkJ,IACjBokJ,EAAa,IAAIx1E,KAEnB,MAAM3+B,GAAYhY,EAAiBgY,UAanC,GAXIm0G,GAKAA,EAAW7mD,QAHXztD,GAAc0zG,GACd1zG,GAAc2zG,EAEKjvK,KAAKovK,SAAStkK,EAAS0gB,GAEvB,IAIV,WAAThoB,GAAmB,CACrB,QAAS4rC,GAAI,EAAGA,GAAI9vB,EAAM8vB,KAAK,CAC7B,MAAMwsG,UACG9wI,EAAQ5K,IAAI4/F,GAAe,KACP,OAA3Bh1F,EAAQ5K,IAAI4/F,GACRh1F,EAAQ5K,IAAI4/F,GACZ,GACN,GACE87C,KAAQ33I,EAAKmrC,KACbwsG,GAAIzjF,WAAWj9B,MAAM,IAAIlxB,OAAO/F,EAAKmrC,IAAI,QAEzC,OAAIzjC,GACFwK,EAAQ,CACN,IAAIikF,KAAc,CAChBrO,MAAO,IAAIqO,IAAa,CACtB7uF,MAAOiwE,EAAOA,EAAKpsC,SAAKptC,EACxBumC,IAAK58B,EAAKyjC,IACVkyC,MAAOA,EAAQA,EAAMlyC,IAAK,EAC1Bi/H,OAAQA,EAASA,EAAOj/H,IAAK,CAAC,GAAK,MAErCxC,KACEgjI,aAAsBx1E,IAAew1E,OAAa5tK,KAGjDmU,IAETA,EAAQ,CACN,IAAIikF,KAAc,CAChBrO,MAAO,IAAIqO,IAAe,CACxBC,OAAQA,EAASA,EAAOjrD,IAAK,EAC7BgsC,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO6vE,EAASA,EAAOhsC,IAAK,QAC5BlQ,MAAOA,EAAQA,EAAMkQ,IAAK,IAE5BosC,KAAM,IAAI4e,IAAa,CACrB7uF,MAAOiwE,EAAOA,EAAKpsC,IAAK,YAG5BxC,KAAMgjI,aAAsBx1E,IAAew1E,OAAa5tK,KAGrDmU,EAEX,CACA,IAAMrL,EAAkCslE,WACtC,OAAI3U,IACFtlD,EAAQnW,KAAK07D,YAAYD,GAAW3wD,EAASwwD,GACzCs0G,GACFz5J,EAAM4yG,QAAQ6mD,GAETz5J,IAETA,EAAQ,CACN,IAAIikF,KAAc,CAChBrO,MAAO,IAAIqO,IAAe,CACxBC,OAAQ,EACRjf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,UAETiwE,KAAM,IAAI4e,IAAa,CACrB7uF,MAAO,iBAKR4K,EAEX,SAAoB,YAAT3S,GAAoB,CAC7B,QAAS4rC,GAAI,EAAGA,GAAI9vB,EAAM8vB,KAAK,CAC7B,MAAMwsG,UACG9wI,EAAQ5K,IAAI4/F,GAAe,KACP,OAA3Bh1F,EAAQ5K,IAAI4/F,GACRh1F,EAAQ5K,IAAI4/F,GACZ,GACN,GACE87C,KAAQ33I,EAAKmrC,KACbwsG,GAAIzjF,WAAWj9B,MAAM,IAAIlxB,OAAO/F,EAAKmrC,IAAI,QAEzCj5B,SAAQ,CACN,IAAIikF,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO6vE,EAASA,EAAOhsC,IAAK,QAC5BlQ,MAAOA,EAAQA,EAAMkQ,IAAK,IAE5BosC,KAAM,IAAI4e,IAAa,CACrB7uF,MAAOiwE,EAAOA,EAAKpsC,IAAK,0BAE1BxC,KAAMgjI,aAAsBx1E,IAAew1E,OAAa5tK,KAGrDmU,CAEX,CACA,GAAIrL,aAAmBqwG,MAChBrwG,EAAQslE,WACX,OAAI3U,IACFtlD,EAAQnW,KAAK07D,YAAYD,GAAW3wD,EAASwwD,GACzCs0G,GACFz5J,EAAM4yG,QAAQ6mD,GAETz5J,IAETA,EAAQ,CACN,IAAIikF,KAAc,CAChBhf,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,UAETiwE,KAAM,IAAI4e,IAAa,CACrB7uF,MAAO,eAIN4K,EAGb,CACF,CAEAwlD,mBACE7wD,EACAwwD,EACAE,EAA6B,GAC7BjY,GAEA,IAAIptC,GACJ,MAAMmJ,EAAOxU,EAAQ5K,IAAI,YAAY0J,OACrC,GAAa,IAAT0V,EAAY,CACd,GAAIk8C,EAAaq0G,cACf,UAAW7mG,KAAKxN,EAAaq0G,cAC3B,KACI7mG,EAAE8mG,WAAa9mG,EAAE8mG,WAAaxwJ,MAC9B0pD,EAAE+mG,WAAa/mG,EAAE+mG,WAAazwJ,GAChC,CAGA,GAFAnJ,GAAQnW,KAAK07D,YAAYsN,EAAE7yD,OAEvB6yD,EAAEgnG,UAAW,CACf,MAAMpjI,EAAO,IAAIwtD,IAAa,CAC5BxtD,KAAMttB,EAAK64C,WACXqjB,KAAM,IAAI4e,IAAa,CACrB7uF,MAAO,WAGX4K,GAAM4yG,QAAQn8E,EAChB,CAEA,GAAIo8B,EAAEinG,cAAe,CACnB,IAAIC,EACJ,MAAMC,EAAYh6J,GAAMwyG,YACxBunD,EAAgB,EAAIhkJ,KAAKq3C,IAAIjkD,GACzB4wJ,EAAgBC,IAClBD,EAAgBC,GAElBh6J,GAAMi6J,OAAOxnD,UAAUsnD,EACzB,CACA,KACF,CAIJ,IAAK/5J,GAAO,CACV,IAAI+5J,EACA10G,EAAa60G,WACfH,EAAgB10G,EAAa60G,WAAW/wJ,IAGxC4wJ,EAAgB,EAAIhkJ,KAAKq3C,IAAIjkD,GACzB4wJ,EAAgBC,IAClBD,EAAgBC,IAIpBh6J,GAAQ,CACN,IAAIikF,KAAc,CAChBrO,MAAO,IAAIqO,IAAe,CACxBC,OAAQ61E,EACR90F,OAAQ,IAAIgf,IAAe,CACzB7uF,MAAO,UAETiwE,KAAM,IAAI4e,IAAa,CACrB7uF,MAAO,6BAGXqhC,KAAM,IAAIwtD,IAAa,CACrBxtD,KAAMttB,EAAK64C,WACXqjB,KAAM,IAAI4e,IAAa,CACrB7uF,MAAO,aAKjB,CACF,MACE4K,GAAQnW,KAAK07D,YAAYnY,EAAYz4C,EAASwwD,GAEhD,OAAOnlD,EACT,CAEAi5J,SAAStkK,EAASksJ,GAChB,IAAIxrI,EAAQwrI,EACZ,IAAKxrI,EACH,OAEF,MAAMyrI,EAAa17I,MAAMmE,KAAKs3I,EAAWE,SAAS,sBAElDD,SAAW18I,QAASlB,KAClBmS,EAAQA,EAAMkN,QAAQrf,GAAE,GAAIvO,EAAQ5K,IAAImZ,GAAE,IAAG,GAIrB,IAAtB49I,EAAWrtJ,QAAgB4hB,IAAUwrI,IACvCxrI,EAAQ1gB,EAAQ5K,IAAI82J,IAAeA,GAG9BxrI,CACT,CAEQmkJ,iBAAiB7kK,GACvB,OAAQA,EAAQqiF,cAAc8U,WAC5B,IAAK,QACL,IAAK,aACL,IAAK,SACH,MAAO,SACT,QACE,MAAO,UAEb,4CAraW+rE,EAAY,iCAAZA,EAAY3sK,QAAZ2sK,EAAY1sK,UAAAC,WAFX,gBAEDysK,CAAY,2FCCnB,SAAUv2F,EACd53E,GAeA,OAbmB,CACjB+sE,IAAK0jG,EACLzjG,KAAM0jG,EACNC,IAAKC,EACL3lK,QAAS4lK,EACTC,IAAKC,EACL9jG,WAAY+jG,EACZ9jG,gBAAiB8jG,EACjB7jG,eAAgB6jG,EAChBC,IAAMr4J,GAAmC,MACzCs4J,UAAYt4J,GAAmC,aAEpB5Y,EAAQ2D,OAAS6zE,GAC7Bx3E,EACnB,CAOM,SAAUywK,EAA+BzwK,GAC7C,MAAMigD,EAASjgD,EAAQkH,OAAO0vD,OAExBu6G,EAAQ,MADFC,EAAepxK,EAAQ0C,KACPu9C,EAC5B,OAAOh3C,KAAIC,QAAQioK,EACrB,CAOM,SAAUT,EACd1wK,GAEA,MAAM4iD,EAAQ5iD,EAAQ4iD,MAEhBuuH,EAAQ,OADFC,EAAepxK,EAAQ0C,KACNkgD,EAC7B,OAAO35C,KAAIC,QAAQioK,EACrB,CAOM,SAAUP,EAA+B5wK,GAE7C,MAAMmxK,EAAQ,MADFC,EAAepxK,EAAQ0C,KAEnC,OAAOuG,KAAIC,QAAQioK,EACrB,CAOM,SAAUN,EACd7wK,GAEA,IAAKA,EAAQ0C,IACX,OAAO80E,IAGT,MAAM25F,EAAQ,UADFC,EAAepxK,EAAQ0C,KAEnC,OAAOuG,KAAIC,QAAQioK,EACrB,CAOM,SAAUJ,EAA+B/wK,GAC7C,IAAKA,EAAQ0C,MAAQ1C,EAAQkH,OAC3B,OAAOswE,IAGT,MAAM25F,EAAQ,MADFC,EAAepxK,EAAQ0C,KACP1C,EAAQkH,OAAO47E,aAC3C,OAAO75E,KAAIC,QAAQioK,EACrB,CAMM,SAAUH,EACdhxK,GAEA,MAAMigD,EAASjgD,EAAQ4iD,MACjBlgD,EAAM0uK,EAAepxK,EAAQ0C,KAEnC,OAAOuG,KAAIC,SADIlJ,EAAQ2D,MAAQ,UAAYjB,EAAMu9C,EAEnD,CAMM,SAAUu3B,EAAW5+D,GACzB,SAAOkK,OACT,CAEM,SAAUsuJ,EAAe1uK,GAE7B,MAAM8G,GAD2B,MAAlB9G,EAAImsC,OAAO,GAAannC,OAAOC,SAAS6sD,OAAS9xD,EAAMA,GACzC+G,MAAM,QACnC,IAAI4nK,EAAkB7nK,EAAcG,QACpC,MAAMC,EAAeJ,EAAcK,OAChCC,GAAmB,IAAbA,EAAEC,QAAgC,MAAhBD,EAAE+kC,OAAO,IAEpC,OAAIjlC,EAAaG,SACfsnK,GAAmB,IAAMznK,EAAaI,KAAK,MAEtCqnK,CACT,63CCjHO,IAAMC,EAAmB,MAA1B,MAAOA,EAIX,cAAOp4J,GACL,MAAO,CACLC,SAAUm4J,EAEd,4CARWA,EAAmB,8BAAnBA,qCAZT3jF,IACA3E,IACApE,IACA2H,cASS+kF,CAAmB,4ICfzB,IAAMC,EAAiB,MAAxB,MAAOA,EACXrxK,cAAe,CAEfsxK,aACEpb,EACAj9H,GAEA,IAAIi6C,EACAq+F,EACAC,EACAC,EAEJ,GAAIj2J,MAAMC,QAAQwd,GAAO,CACvB,MAAMy4I,GAAQ,GACVz4I,EAAK,KACPu4I,EAAmBvxK,KAAK0xK,iBAAiB14I,EAAK,IAC9Cy4I,GAAMnqK,KAAK0xB,EAAK,KAEdA,EAAK,KACPw4I,EAAiBxxK,KAAK0xK,iBAAiB14I,EAAK,IAC5Cy4I,GAAMnqK,KAAK0xB,EAAK,KAEG,IAAjBy4I,GAAM7nK,QAAgB2nK,IAAqBC,IAE3Cv+F,EADEgjF,aAAsBj/E,IACjBu6F,EAAmB,IAAMC,EAEzBD,EAAmB,IAAMC,GAGhCD,IAAqBC,IACvBv+F,EAAOs+F,EAEX,MAAWv4I,IACTs4I,EAActxK,KAAK0xK,iBAAiB14I,GACpCi6C,EAAOq+F,GAITrb,EAAW50G,GAAG0/B,aADC,CAAEq0B,KAAMniC,IAEnBgjF,aAAsBz/E,KACFy/E,EACRh1E,cADQg1E,EACoBlmF,YAAY,EAE1D,CAEA4hG,aACE1b,EACA2b,GAEA,IAAI3+F,EACAs+F,EACAC,EAEJ,GAAIj2J,MAAMC,QAAQo2J,GAAO,CACvB,MAAMC,GAAQ,GACVD,EAAK,KACPL,EAAmBK,EAAK,GACxBC,GAAMvqK,KAAKsqK,EAAK,KAEdA,EAAK,KACPJ,EAAiBI,EAAK,GACtBC,GAAMvqK,KAAKsqK,EAAK,KAEG,IAAjBC,GAAMjoK,QAAgB2nK,IAAqBC,IAE3Cv+F,EADEgjF,aAAsBj/E,IACjBu6F,EAAmB,IAAMC,EAEzBD,EAAmB,IAAMC,GAGhCD,IAAqBC,IACvBv+F,EAAOs+F,EAEX,MAEEt+F,EAAO2+F,EAIT3b,EAAW50G,GAAG0/B,aADC,CAAEq0B,KAAMniC,IAEnBgjF,aAAsBz/E,KACFy/E,EACRh1E,cADQg1E,EACoBlmF,YAAY,EAE1D,CAEQ2hG,iBAAiBhrK,GACvB,MAAMkrK,EAAOlrK,EAAMorK,cACnB,IAAIC,EAAQrrK,EAAMsrK,WAAa,EAC3BC,EAAMvrK,EAAMwrK,aACZ91E,EAAO11F,EAAMyrK,cACb91E,EAAS31F,EAAM0rK,gBAEnB,OAAIj3I,OAAO42I,GAAS,KAClBA,EAAQ,IAAMA,GAGZ52I,OAAO82I,GAAO,KAChBA,EAAM,IAAMA,GAGV92I,OAAOihE,GAAQ,KACjBA,EAAO,IAAMA,GAGXjhE,OAAOkhE,GAAU,KACnBA,EAAS,IAAMA,GAGVu1E,EAAO,IAAMG,EAAQ,IAAME,EAAM,IAAM71E,EAAO,IAAMC,EAAS,MACtE,4CA9GW+0E,EAAiB,iCAAjBA,EAAiB/vK,QAAjB+vK,EAAiB9vK,mBAAjB8vK,CAAiB,gCCGvB,IAAMiB,EAAgB,MAAvB,MAAOA,EACXtyK,cAAe,CAERuyK,YAAYle,EAA8Bme,GAC/C,MAAM99D,GAAgB,IAAI/7B,KAAkBq7B,yBAC1Cw+D,EACAne,EAAcv0J,QAAQkH,OAAO0vD,QAE/B29F,EAAc/yG,GAAG0/B,aAAa,CAAED,OAAQ2zB,GAC1C,CAEO+9D,wBAAwBC,GAC7B,MAAM5yK,EAAe4yK,EAAc5yK,QAC7B44E,EAAkB,IAAIC,IAExB74E,EAAQu4E,WAAWznC,SAAW9wC,EAAQu4E,WAAW/0D,UACnDxjB,EAAQu4E,WAAW/0D,QAAUo1D,EAAgBi2B,0BAC3C7uG,EAAQu4E,WAAW/0D,QACnBxjB,EAAQ04E,UAAUD,kBAClB,IAAImxC,IAAa,CAAEC,KAAM7pH,EAAQ04E,UAAU4G,WAC3C,GAEGt/E,EAAQu4E,WAAW07B,sBACtBj0G,EAAQu4E,WAAW07B,oBACjBr7B,EAAgB44B,8BACdxxG,EAAQu4E,WAAW/0D,QACnBxjB,EAAQ04E,UAAUD,oBAI5B,CAEOo6F,wBAAwBte,GAC7B,MAAMv0J,EAAeu0J,EAAcv0J,QAC7B44E,EAAkB,IAAIC,IAExB74E,EAAQu4E,WAAWznC,SAAW9wC,EAAQu4E,WAAW/0D,SACnDxjB,EAAQu4E,WAAW/0D,QAAUo1D,EAAgBi2B,0BAC3C7uG,EAAQu4E,WAAW/0D,QACnBxjB,EAAQy4E,uBACRt2E,GACA,GAEGnC,EAAQu4E,WAAW07B,sBACtBj0G,EAAQu4E,WAAW07B,oBACjBr7B,EAAgB44B,8BAEdxxG,EAAQu4E,WAAW/0D,QACnBxjB,EAAQy4E,oBAGdt4E,KAAKsyK,YACHle,EACA37E,EAAgByJ,YACdriF,EAAQu4E,WAAW/0D,aACnBrhB,OACAA,OACAA,EACAoyJ,EAAcv0J,UAGlBA,EAAQ8yK,UAAW,IAEnB9yK,EAAQu4E,WAAW/0D,aAAUrhB,EAC7BnC,EAAQu4E,WAAW07B,oBAAsB,GACzCj0G,EAAQ8yK,UAAW,EAEvB,4CAnEWN,EAAgB,iCAAhBA,EAAgBhxK,QAAhBgxK,EAAgB/wK,mBAAhB+wK,CAAgB,KCTtB,IAWKO,EAAZ,SAAYA,GACVA,SAAAC,WAAA,aACAD,EAAAE,QAAA,UACAF,EAAAh8C,MAAA,QAHUg8C,CAIZ,CAJA,CAAYA,GAAiB,IAMjBG,EAAZ,SAAYA,GACVA,SAAAC,QAAA,UACAD,EAAAE,UAAA,YAFUF,CAGZ,CAHA,CAAYA,GAAqB,qCCG1B,IAAMG,EAAoB,MAA3B,MAAOA,EAqBDzxK,KACAE,gBACA6mC,cAtBHsU,QAAkB,8CAKlBq2H,cAAgB,CACrBC,UAAW,WACXC,OAAQ,kBACRC,QAAS,WACTC,SAAU,YACVC,OAAQ,UACRC,IAAK,MACLC,IAAK,gBACLC,QAAS,WACTC,OAAQ,cACRC,MAAO,QACPC,OAAQ,UAGV/zK,YACU0B,EACAE,EACA6mC,GAFAxoC,KAAAyB,OACAzB,KAAA2B,kBACA3B,KAAAwoC,gBAERxoC,KAAK88C,QACH98C,KAAKwoC,cAAcpoC,UAAU,sBAAwBJ,KAAK88C,OAC9D,CAEAi3H,cAAcx1D,EAAQ73G,GACpB,OAAOF,OAAOC,KAAK83G,GAAQn8F,KAAM7b,GAAQg4G,EAAOh4G,KAASG,EAC3D,CAKAstK,eAAexwK,GAEb,GADgBA,EAEd,OAAOxD,KAAKyB,KACTvB,IAEEF,KAAK88C,QAAU98C,KAAKmzK,cALX3vK,IAMXO,QACC0c,KAAKymC,GACHA,EAAkB38C,SAASkW,IAAK0lB,IAC9BA,EAAE9nB,KAAO,CACPnM,GAAIi0B,EAAE9O,WAAWqyF,MAEZvjF,KAKnB,CAKA8tI,oBACE,MACMrgI,EAAiC,GACvC,OAAO5zC,KAAKyB,KAAKvB,IAAIF,KAAK88C,QAFd,SAE6B/4C,QACvC0c,KAAKw5D,IACHA,EAAM1/D,QAAS/W,IACb,GAAIA,EAAKu9F,WAAW,SAAU,CAC5B,MAAMlpE,EAA8B,CAClC7I,UAAMhtB,EACNyhB,OAAQjgB,GAEV,IAAI8mD,EAAS9mD,EAAKkpJ,UAAU,EAAGlpJ,EAAKoG,QAChColB,GAAOs7B,EACX,GAAIA,EAAOtyB,SAAS,KAAM,CACxB,MAAM/Y,GAAQqrC,EAAO5hD,QAAQ,KAC7BsmB,GAAOs7B,EAAOoiG,UAAUztI,GAAQ,EAAGqrC,EAAO1gD,QAC1C0gD,EAASA,EAAOoiG,UAAU,EAAGztI,GAC/B,CACA,IACE4Y,EAAK7I,KAAOhvB,KAAK2B,gBAAgB4pB,UAAUshB,QACzC,mBAAqB7d,GAEzB,OACE6I,EAAK7I,KACHA,GAAK09H,UAAU,EAAG,GAAGt9E,cACrBpgD,GAAK09H,UAAU,EAAG19H,GAAKplB,OAAS,EACpC,CAEA,IACEiuB,EAAKoJ,MAAQjhC,KAAK2B,gBAAgB4pB,UAAUshB,QAC1C,+BAAiCyd,EAErC,OACEzyB,EAAKoJ,MACHqpB,EAAOoiG,UAAU,EAAG,GAAGt9E,cACvB9kB,EAAOoiG,UAAU,EAAG19H,GAAKplB,OAAS,EACtC,CAEAgqC,EAAMtsC,KAAKuwB,EACb,SACM73B,KAAK+zK,cAAc/zK,KAAKmzK,cAAe3vK,GAAO,CAChD,MAAMq0B,EAA8B,CAClC7I,UAAMhtB,EACNyhB,OAAQjgB,GAEJwrB,EAAOhvB,KAAK+zK,cAAc/zK,KAAKmzK,cAAe3vK,GACpD,IACEq0B,EAAK7I,KAAOhvB,KAAK2B,gBAAgB4pB,UAAUshB,QACzC,mBAAqB7d,EAEzB,OACE6I,EAAK7I,KACHA,EAAK09H,UAAU,EAAG,GAAGt9E,cACrBpgD,EAAK09H,UAAU,EAAG19H,EAAKplB,OAAS,EACpC,CACAiuB,EAAKpU,OAASjgB,EAEdowC,EAAMtsC,KAAKuwB,EACb,IAGG+b,IAGb,CAKAsgI,eACEppK,EACAqpK,EACA3wK,EACA4wK,EACAp5G,GAEA,GAAIx3D,EAAM,CAER,MACMjB,GAAMvC,KAAK88C,QAAU98C,KAAKmzK,cADhB3vK,GAEhB,IAAI6wK,GAAU,GACd,OAAIF,IAAapB,EAAsBC,SACrCqB,GAAU,WACHr0K,KAAKyB,KACTvB,IACCqC,GAAM,IAAMuI,EAAQusB,WAAWqyF,KAAO,IAAM2qD,GAC5C,CACEttK,OAAQ,CACNuiF,SAAU,OACV39E,KAAM,OACN2oK,YAAat5G,EAAO7C,WACpBo8G,WAAY,SAIjBxwK,QACC0c,KAAKymC,IACHA,GAAkB38C,SAASkW,IAAK0lB,KAC9BA,GAAE9nB,KAAO,CACPnM,GAAIi0B,GAAE9O,WAAWqyF,KACjB99G,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,iCAEFlhC,KAAOw6B,GAAUx6B,MAEZw6B,SAMfkuI,GAAUD,EAAS3wJ,OACZzjB,KAAKyB,KACTvB,IACCqC,GAAM,IAAMuI,EAAQusB,WAAWqyF,KAAO,IAAM2qD,GAC5C,CACEttK,OAAQ,CACNuiF,SAAU,OACV39E,KAAM,OACN2oK,YAAat5G,EAAO7C,WACpBo8G,WAAY,SAIjBxwK,QACC0c,KAAKymC,IACHA,GAAkB38C,SAASkW,IAAK0lB,KAC9BA,GAAE9nB,KAAO,CACPnM,GAAIi0B,GAAE9O,WAAWqyF,KACjB99G,MAAOwoK,EAASplJ,KAChBrjB,KAAOw6B,GAAUx6B,MAEZw6B,OAKnB,CAAO,CAEL,MAAM5jC,EAAMvC,KAAK88C,QAAU,SAC3B,OAAIq3H,IAAapB,EAAsBC,QAE9BhzK,KAAKyB,KACTqC,KAA8BvB,EAFjB,iBAEgC,CAC5C+mF,SAAU,OACV39E,KAAM,OACN6oK,IAAKv8I,KAAKouB,UAAUv7C,GACpBwpK,YAAat5G,EAAO7C,WACpBo8G,WAAY,QAEbxwK,QACC0c,KAAKymC,IACHA,GAAkB38C,SAASkW,IAAK0lB,KAC9BA,GAAE9nB,KAAO,CACPnM,GAAIi0B,GAAE9O,WAAWqyF,KACjB99G,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,iCAEFlhC,KAAOw6B,GAAUx6B,MAEZw6B,OAORnmC,KAAKyB,KACTqC,KAA8BvB,EAFjB,SAAW6xK,EAAS3wJ,OAEY,CAC5C6lE,SAAU,OACV39E,KAAM,OACN6oK,IAAKv8I,KAAKouB,UAAUv7C,GACpBwpK,YAAat5G,EAAO7C,WACpBo8G,WAAY,QAEbxwK,QACC0c,KAAKymC,IACHA,GAAkB38C,SAASkW,IAAK0lB,KAC9BA,GAAE9nB,KAAO,CACPnM,GAAIi0B,GAAE9O,WAAWqyF,KACjB99G,MAAOwoK,EAASplJ,KAChBrjB,KAAOw6B,GAAUx6B,MAEZw6B,MAKnB,CACF,CAKAsuI,aACE3pK,EACAtH,GAEA,MAAMkxK,EAAc10K,KAAKmzK,cAAc3vK,GACjCmxK,EAAc,IAAM7pK,EAAQusB,WAAWqyF,KAC7C,GAAIgrD,GAAeC,EACjB,OAAO30K,KAAKyB,KACTvB,IAAaF,KAAK88C,QAAU43H,EAAcC,EAAa,CACtD5tK,OAAQ,CACNuiF,SAAU,UAGbvlF,QACC0c,KAAK0lB,IACHA,EAAE9nB,KAAO,CACPnM,GAAIi0B,EAAE9O,WAAWqyF,KACjBhsC,MAAOv3C,EAAE9O,WAAW84H,IACpBvkJ,MAAOu6B,EAAE9O,WAAW84H,KAEfhqH,IAIjB,CAKAyuI,mBACE9pK,EACA+pK,EACA75G,EACAx3D,GAEA,GAAIqxK,IAAejC,EAAkBC,WAuBnC,OAAO7yK,KAAKyB,KACTqC,KAAc9D,KAAK88C,QAAU,qBAAsB,CAClDke,SACAw5G,IAAKv8I,KAAKouB,UAAUv7C,KAErB/G,QACC0c,KAAK0lB,GACIA,IA9BkC,CAC/C,MAAMuuI,EAAc10K,KAAKmzK,cAAc3vK,GACjCmxK,EAAc,IAAM7pK,EAAQusB,WAAWqyF,KAC7C,GAAIgrD,GAAeC,EACjB,OAAO30K,KAAKyB,KACTvB,IAAaF,KAAK88C,QAAU43H,EAAcC,EAAa,CACtD5tK,OAAQ,CACNuiF,SAAU,MACVwrF,aAAc95G,EAAO7C,cAGxBp0D,QACC0c,KAAK0lB,KACHA,GAAE9nB,KAAO,CACPnM,GAAIi0B,GAAE9O,WAAWqyF,KACjBhsC,MAAOv3C,GAAE9O,WAAW84H,IACpBvkJ,MAAOu6B,GAAE9O,WAAW84H,KAEfhqH,KAIjB,CAYF,4CAlUW+sI,GAAoB9xK,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,iCAApBqtK,EAAoB7xK,QAApB6xK,EAAoB5xK,UAAAC,WAFnB,gBAED2xK,CAAoB,KCHpB6B,EAAe,MAAtB,MAAOA,EACSnzK,eAApB7B,YAAoB6B,GAAA5B,KAAA4B,gBAAiC,CAErD2W,KAAKkqC,GACHziD,KAAK4B,eAAe6oD,QAClB,yBACA,0BAGF,MAAMuqH,EAA+BvyH,EAAMpsB,WAAWx2B,QACtD,GAAI2G,OAAOC,KAAKuuK,EAAU30F,UAAUz2E,OAAS,EAC3C,GACEorK,EAAU30F,SAASC,iBACQt+E,IAA3BgzK,EAAU30F,SAAS99E,IACnB,CACA,IAAI8gF,EACA4xF,EAAc,IAAIxrD,IAAa,CAAEC,KAAMjnE,EAAMhiC,IAAIuhC,aACrD,MAAMu2B,EAAa91B,EAAMpsB,WAAWx2B,QAAgB04E,UAChDA,GAAa/xE,OAAOC,KAAK8xE,GAAW3uE,OAAS,GAC/CqrK,EAAc18F,EAAU4G,QACpB,IAAIsqC,IAAa,CAAEC,KAAMnxC,EAAU4G,UACnC81F,EACJ5xF,EAAc5gC,EAAMpsB,WAAWx2B,QAAgB04E,WAE/C8K,EAAc5gC,EAAMpsB,WAAWx2B,QAAgBkH,OAGjD,MAAM4iH,EAAgBl5C,KACpBhuB,EAAMhiC,IAAIyhC,eAAe2hC,YACzB,IAAI4lC,IAAa,CAAEC,KAAMjnE,EAAMhiC,IAAIuhC,aACnCizH,GAEIC,QACgClzK,IAApCqhF,EAAW6xF,0BACqBlzK,IAA5BqhF,EAAWlF,aACT,GACA,gBAAkBkF,EAAWlF,aAC/B,gBAAkBkF,EAAW6xF,qBAE7BC,GAAUH,EAAU30F,SAASC,WAChC5nD,QAAQ,yBAA0B,IAClCA,QAAQ,mBAAoB,IAC5BA,QAAQ,iBAAkB,IAEvB0/C,GACJ31B,EAAMpsB,WAAWx2B,QACjBu4E,WAEF,IAAIwI,GACJA,IAAoB,IAAIlI,KAAkBmI,6BACxCp+B,EAAMpsB,WAAWx2B,QACjBu4E,GAAW+J,aACXwnC,EACAsrD,GAWAr0F,GATGA,GASiB,UAAYtqB,mBAAmBsqB,KAP/B,IAAIlI,KAAkBwJ,iBACxClgF,EACA2nH,EACAsrD,EACA78F,GAAW+J,cAKf56E,OAAOgR,KACL,GAAG48J,MAAWv0F,MAAqBs0F,KACnC,SAEJ,MAAWF,EAAU30F,UACnB94E,OAAOgR,KAAKy8J,EAAU30F,SAAS99E,IAAK,SAG1C,4CA1EWwyK,GAAe3zK,MAAAuE,MAAA,iCAAfovK,EAAe1zK,QAAf0zK,EAAezzK,UAAAC,WAFd,gBAEDwzK,CAAe,4DCjB5B3zK,MAAA,mCAWEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA8pK,aAAA9pK,EAAAm3C,OAAmB,GAE5BrhD,MAAA,cAAUA,MAAA,cACZA,kCAJEA,MADA,aAAAA,MAAA,+BACAA,CADoD,QAAAkK,EAAAC,QCiB/C,IAAM8pK,EAAuB,MAA9B,MAAOA,EAmBSC,gBAlBpB,SACI7yH,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,CAChB,CACQo/H,OAER,SACIv6H,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,GACR1G,KAAKmxC,OAASzqC,CAChB,CACQyqC,OAAS,UAEjBpxC,YAAoBu1K,GAAAt1K,KAAAs1K,iBAAmC,CAEvDF,aAAa3yH,GACXziD,KAAKs1K,gBAAgB/8J,KAAKkqC,EAC5B,CAEA,WAAI5iD,GACF,GAAKG,KAAKyiD,MAGV,OAAOziD,KAAKyiD,MAAMpsB,WAAWx2B,OAC/B,4CA9BWw1K,GAAuBj0K,MAAAuE,GAAA,+BAAvB0vK,EAAuB/mK,UAAA,0BAAAC,OAAA,CAAAk0C,MAAA,QAAAl3C,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qOAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD1BpC1N,MAAA,EAAAm0K,EAAA,qBACGn0K,MAAA,OAAA2N,EAAAlP,SAAAkP,EAAAlP,QAAAwgF,WAAAtxE,EAAAlP,QAAAwgF,SAAAC,YAAAvxE,EAAAlP,QAAAwgF,SAAA99E,qBCkBC4M,KACAI,KAAe3J,KACfyJ,KAAgBxJ,KAChB2J,KAAa1J,KACb6J,KAAiB5J,MAAA+J,gBAAA,WAGRulK,CAAuB,+SCrB1Bj0K,MADF,kBACEA,CADgC,gBAQ9BA,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAA2pK,EAAAp0K,MAAA,GAAAmP,UAAAmxB,EAAAtgC,MAAA,UAAAA,MAAUsgC,EAAA+zI,iBAAAh+J,EAAA+9J,GAA8B,GACvCp0K,MAAA,kBACHA,QACAA,MAAA,YAAuBA,MAAA,oBACzBA,0EANIA,QACAA,MADA,SAAAs0K,EACAt0K,CADiB,YAAAo0K,EAAA1kK,WAKI1P,MAAA,GAAAA,MAAA,GAAAA,MAAA,IAAAsgC,EAAAi0I,iBAAAH,IAAA,gCAgBjBp0K,MAAA,mBAA8DA,MAAA,GAE5DA,kCAFuCA,MAAA,QAAAw0K,EAAA5mJ,MAAqB5tB,cAAAw0K,EAAAhqK,iDAPhExK,MAFJ,QAEIA,CAFoC,mBAEpCA,CADc,wCAKZA,MAAA,yBAAAqW,GAAArW,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,MAAA,GAAAA,aAAAsgC,EAAAigD,aAAAlqE,KAAAiqB,EAAAigD,aAAAlqE,GAAArW,MAAAqW,EAAA,GACArW,MAAA,6BAAAA,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,MAAA,UAAAA,MAAmBsgC,EAAAm0I,gBAAe,GAElCz0K,MAAA,EAAA00K,GAAA,qBAKN10K,qCATMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCACAA,MAAA,UAAAsgC,EAAAigD,cAG8BvgF,MAAA,GAAAA,MAAA,UAAAsgC,EAAA7xB,kDAQhCzO,MAAA,mCAMEA,MAAA,kBAAAA,MAAA8P,GAAA,MAAAskK,EAAAp0K,MAAA,GAAAmP,UAAAmxB,EAAAtgC,MAAA,UAAAA,MAAQsgC,EAAAq0I,YAAAP,EAAA5pK,OAAuB,GANjCxK,2CAKEA,MAAA,KAAAo0K,EAAA5pK,OAGAxK,MAAA,MAAAA,MAAA,+CADAA,MAJA,eAIAA,CAJkB,MAAAo0K,EAAAQ,cAAA50K,+BAOpBA,MAAA,WACEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,0EAZJA,MAAA,SAWEA,MAVA,EAAA60K,GAAA,aAUA70K,CADE,EAAA80K,GAAA,eAIJ90K,oDAXKA,cAAA,OAAAo0K,EAAAQ,eAQK50K,cAAA,OAAAsgC,EAAAy0I,aAAAX,EAAA5pK,OAAA,+BAIVxK,MAAA,qEAEEA,MADA,UAAAo0K,EAAAr/J,MACA/U,CADsB,YAAAA,MAAA,IAAAo0K,EAAAvgK,MAAA7T,kCAjB1BA,MAAA,SAgBEA,MAfA,EAAAg1K,GAAA,YAeAh1K,CAfsB,EAAAi1K,GAAA,cAoBxBj1K,yCApBQA,cAAA,OAAAo0K,EAAAjzK,KAkBHnB,cAAA,OAAAo0K,EAAAvgK,iCArDT7T,MAAA,SACEA,MAAA,EAAAk1K,GAAA,uBAaAl1K,MAAA,aAoBEA,MAfA,EAAAm1K,GAAA,YAeAn1K,CAfwC,EAAAo1K,GAAA,aAsC5Cp1K,qDAxDkBA,cAAA,OAAAo0K,EAAA5pK,OAgBdxK,cAAA,UAAAA,MAAA,EAAA+zC,GAAAqgI,EAAA5pK,QAEMxK,MAAA,GAAAA,MAAA,YAAAY,IAAA0/B,EAAAigD,cAeAvgF,cAAA,QAAAo0K,EAAA1kK,sCAnCZ1P,MAAA,UACEA,MAAA,EAAAq1K,GAAA,+DAAMr1K,MAAA,GAAiBA,MAAjB,OAAAsgC,EAAAg2C,UAAiBt2E,CAAA,WAAAs1K,8BAF3Bt1K,MAAA,GACEA,MAAA,EAAAu1K,GAAA,yDAA+Bv1K,cAAA,UAAAw1K,EAAA/yJ,QAAA9D,mCA+D/B3e,MAAA,WACEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,yEAlENA,MAAA,GAgEEA,MA/DA,EAAAy1K,GAAA,qBA+DAz1K,CA/DiD,EAAA01K,GAAA,yBAAA11K,+CAAlCA,QAAoBA,MAApB,OAAAw1K,EAAAhtK,OAAoBxI,CAAA,WAAAs1K,ICiE9B,IAAMK,GAAoB,MAA3B,MAAOA,EAyDDriG,oBACA/yE,gBACA6mC,cACA/mC,KACAsQ,MA5DDilK,gCAA0C,EAKnDC,aAA0C,IAAIl1K,KAAgB,IAKtD8kB,QAKDhX,OAKA8xE,aAKCL,WAAgBt/E,EAKhBmO,UAA6BnO,EAILk1K,gBAKzBf,aAA6C,GAK3C1zH,MAKFi1B,WAAY,EAMnB33E,YACU20E,EACA/yE,EACA6mC,EACA/mC,EACAsQ,GAJA/R,KAAA00E,sBACA10E,KAAA2B,kBACA3B,KAAAwoC,gBACAxoC,KAAAyB,OACAzB,KAAA+R,OACP,CAKHxE,WACE,IAAI4pK,EAAcn3K,KAAKyiD,MAAMqsB,OAC7B9uE,KAAK6P,OAAS7P,KAAKo3K,aACnB,MAAMt0H,EAAgB9iD,KAAKyiD,MAAM5iD,QAAQ4jB,OAAO5jB,QA0BhD,GAzBIijD,GAAiBA,EAAc/7C,QAAU+7C,EAAc/7C,OAAOswK,OAEhEr3K,KAAK2hF,aAAe3hF,KAAK6P,OAAOuS,KAC7BjM,GAAUA,EAAM6Y,OAAS8zB,EAAc/7C,OAAOswK,QAC/CroJ,KACQmoJ,EAKDn3K,KAAK6P,QAAU7P,KAAK6P,OAAOjG,OAAS,IAC7C5J,KAAK2hF,aAAew1F,EAAY,GAAGx1F,cAJ/B3hF,KAAK6P,QAAU7P,KAAK6P,OAAOjG,OAAS,IACtC5J,KAAK2hF,aAAe3hF,KAAK6P,OAAO,GAAGmf,MASrCmoJ,SAHOn3K,KAAKyiD,MAAM5iD,QAAQqwE,cAAkB,MACC,IAA7ClwE,KAAKyiD,MAAM5iD,QAAQqwE,cAAcjiE,QAEnB,GAEAjO,KAAKyiD,MAAMpsB,WAAWqhD,UAClC13E,KAAK2hF,aACL3hF,KAAKmQ,MAKPnQ,KAAKg3K,gCACJl0H,EAAuC2+B,uBAGxCzhF,KAAK6mB,QADU7mB,KAAKyiD,MAAMhiC,IAAIyhC,eAAewX,OACvB72D,UAAU,IAAM7C,KAAKs3K,oCAC7C,GAAWH,GAAsC,IAAvBA,EAAYvtK,OAAc,CAClD5J,KAAKi3K,aAAat0K,KAAKw0K,GACvB,UAAWroG,KAAUqoG,EACnBn3K,KAAKu3K,iBAAiBzoG,EAE1B,CACF,CAKA5gE,mBACuBlM,IAAjBhC,KAAK6mB,SACP7mB,KAAK6mB,QAAQ1Y,aAEjB,CAEAopK,iBAAiB1/I,GACXA,EAAKt1B,KACW,IAAIi7B,MAAgBx9B,KAAKyB,KAAMzB,KAAKwoC,eAEnDpvB,UAAUye,EAAKt1B,KACfwB,QACCG,MAAYC,IACV,GAAIA,EAAIC,MACND,SAAIC,MAAMC,QAAS,EACnBrE,KAAK03E,WAAY,EACjB13E,KAAK+R,MAAM4K,gBACJxY,KAIZtB,UAAW20K,IACV,MAAMr5C,EAAMn+H,KAAKi3K,aAAavwK,MAAMsuC,UACjCyiI,GAAQA,EAAI7rK,QAAUisB,EAAKjsB,OAG9B5L,KAAKi3K,aAAavwK,MAAMy3H,GAAK63C,cADTwB,EAEpBx3K,KAAK+R,MAAM4K,eAAa,EAGhC,CAEA84J,iBAAiB3kK,EAAoB+mB,GACnCA,EAAK/mB,UAAYA,CACnB,CAEQ4mK,0BAA0BC,GAChC,MAAMC,EAAuBD,EACvBE,EAAc73K,KAAKyiD,MAAMqsB,OAC/B,QAAS1/B,EAAI,EAAGA,EAAIyoI,EAAYjuK,OAAQwlC,IACtCwoI,EAAWxoI,GAAGt+B,UAAY+mK,EAAYzoI,GAAGt+B,UAE3C,OAAO8mK,CACT,CAEAjC,iBAAiBmC,GACf,MAAMp1H,EAAe1iD,KAAKyiD,MAAMpsB,WAAWx2B,QAC3C,GAA0B,QAAtB6iD,EAAal/C,KACf,SAAOI,OAAGk0K,EAAYlsK,OAGxB,MAAMk0C,EAAS4C,EAAa37C,OAAO0vD,OAAOntD,MAAM,KAC1CyuK,EAAoB9/I,KAAKC,MAAMD,KAAKouB,UAAU3D,IACpDq1H,SAAkBhxK,OAAO0vD,OAAS3W,EAAO19B,KACtCqgC,GAAUA,IAAUq1H,EAAYlsK,OAE5B5L,KAAK00E,oBAAoB/G,cAAcoqG,GAAmBh0K,QAC/D0c,KAAKu3J,GACIA,EAAqBzmG,wBAAwB3lE,OAG1D,CAOQ0rK,8BACNt3K,KAAKmQ,KAAO,CACVmrD,WAAYt7D,KAAKyiD,MAAMhiC,IAAIyhC,eAAe4iD,gBAC1Ct0B,OAAQxwE,KAAKyiD,MAAMhiC,IAAIyhC,eAAe2hC,YACtC7hC,WAAYhiD,KAAKyiD,MAAMhiC,IAAIyhC,eAAe6hD,kBAAkBtiD,UAC5D6/B,MAAOthF,KAAKyiD,MAAMhiC,IAAIyhC,eAAe02E,WACrCt5G,KAAMtf,KAAKyiD,MAAMhiC,IAAI4gC,GAAGs3E,WAE1B34H,KAAKi4K,cACP,CAKQA,eACN,IAAIC,EAAcl4K,KAAKyiD,MAAMpsB,WAAWqhD,UACtC13E,KAAK2hF,aACL3hF,KAAKmQ,MAOP,GALInQ,KAAKyiD,MAAMqsB,QAAU9uE,KAAKyiD,MAAMqsB,OAAOllE,OAAS,IAClDsuK,EAAcl4K,KAAK03K,0BAA0BQ,IAE/Cl4K,KAAKyiD,MAAMqsB,OAASopG,EAEO,IAAvBA,EAAYtuK,QAAmD,IAAnC5J,KAAKi3K,aAAavwK,MAAMkD,OAGxD,CAAA5J,KAAKi3K,aAAat0K,KAAKu1K,GACvB,UAAWppG,KAAU9uE,KAAKi3K,aAAavwK,MACrC1G,KAAKu3K,iBAAiBzoG,EAAM,CAEhC,CAEQsoG,aACN,MAAM10H,EAAe1iD,KAAKyiD,MAAM5iD,QAChC,GAAI6iD,GAAgBA,EAAawtB,cAAe,CAG9C,IAAIoE,EAAkB,CAAC,CAAEtlD,KAAM,GAAIpjB,MAFjB5L,KAAK2B,gBAAgB4pB,UACfshB,QAAQ,kCAEhC,OAAI6V,EAAawtB,cAAcoE,kBAC7BA,EAAkBA,EAAgB3zD,OAChC+hC,EAAawtB,cAAcoE,gBAAgB5qE,OACxCyuK,GAEG,YADFA,EAAGnpJ,KAAKyJ,UAAU,OAAOC,QAAQ,oBAAqB,KAGpD,WADFy/I,EAAGnpJ,KAAKyJ,UAAU,OAAOC,QAAQ,oBAAqB,OAK9D47C,EACG5qE,OAAQ0uK,IAAQA,EAAGxsK,OACnB6U,IAAK23J,GAAQA,EAAGxsK,MAAQwsK,EAAGppJ,MAC9BslD,EAAgB7zD,IACb7E,GACEA,EAAEhQ,MACDgQ,EAAEhQ,MAAM8iC,OAAO,GAAG0gC,cAClBxzD,EAAEhQ,MAAMiY,MAAM,GAAG6U,QAAQ,KAAM,MAE9B47C,CACT,CAEF,CAEAuhG,gBACE71K,KAAKi4K,eACL,IAAIZ,EAAS,GACTr3K,KAAKyiD,MAAMpsB,sBAAsBmgD,MACnCx2E,KAAKyiD,MAAMpsB,WAAWgrB,GACnBy/E,YACArqE,OAAOntD,MAAM,KACbmX,IAAKgiC,GAAW40H,GAAUr3K,KAAK2hF,aAAe,KACjD01F,EAASA,EAAOxzJ,MAAM,GAAG,GACzB7jB,KAAKyiD,MAAMpsB,WAAWgrB,GAAG0/B,aAAa,CAAEs2F,WAE5C,CAEAtB,YAAY7jK,GACV,IAAImmK,EAEFA,EADkC,IAAhCr4K,KAAKk3K,gBAAgBttK,OACb5J,KAAKk3K,gBAAgB75H,MAAMpqC,cAE3BjT,KAAKk3K,gBAAgB90J,KAC5Bk2J,GAAmBA,EAAerlK,cAAcf,KAAOA,GACxDe,cAEJjT,KAAKm2K,aAAajkK,GAAMmmK,EAAQp5I,MAClC,4CA5QW83I,GAAoB31K,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,aAAA,+BAApB21K,EAAoBzoK,UAAA,uBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,o3BDlEjC1N,MAAA,EAAAm3K,GAAA,6CAAen3K,MAAA,OAAAA,MAAA,IAAA2N,EAAAkoK,8BCgDX9nK,KACAsF,KACArF,MAAarJ,kBACbyJ,KAAaxJ,KACb0Q,MACApH,KACA2a,MAAkBtV,MAClBuV,MAAerV,MAAAC,MACfzF,KAAgBytB,KAChBL,KAAWO,UACX7S,MACAuS,MACAY,KACA5tB,KACAC,KAAiButB,KACjBhkB,OAAgBrJ,OAAA,ujBAAAC,gBAAA,WAGPinK,CAAoB,6CC1D1B,IAAMyB,GAAU,MAAjB,MAAOA,EACXz4K,cAAe,CAER04K,aAAaC,EAAKC,EAASC,GAChC,OAAO,IAAIC,MAAQp8F,YAAYi8F,EAAK,CAClCj0H,eAAgBk0H,EAChBj0H,kBAAmBk0H,GAEvB,CACOE,YAAYC,EAAQvoG,EAAQwoG,GACjC,IAAIrvD,EAAgBl5C,KAAuBD,EAAQwoG,EAAYD,GAmB/D,OAlBApvD,EAAgB3pH,KAAKi5K,qBAAqBtvD,EAAeovD,EAAQ,GAkB1D,CACLjkB,QAlBc,oBACZtkF,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,OActB0oG,QAbc,sBACZ1oG,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,MAStB2oG,eARqB,wBACjB3oG,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,MAM5B,CAEQyoG,qBAAqBG,EAAiBp3H,EAAYunF,EAAU,GAElE,MAAM52D,EADQlC,KAAWzuB,GACL82E,WAEpB,OAA+B,IADf,CAAC,KAAM,IAAK,SAChBpwH,QAAQiqE,KAClBymG,EAAkBp5K,KAAKq5K,WAAWD,EAAiB7vC,IAE9C6vC,CACT,CAEQC,WAAWC,EAAO/vC,EAAU,GAClC,IAAIx1D,EAAI,EACR,KAAOA,EAAIulG,EAAM1vK,QACf0vK,EAAMvlG,GAAKulG,EAAMvlG,GAAG/d,QAAQuzE,GAC5Bx1D,IAEF,OAAOulG,CACT,CAEOC,UAAUC,EAAMT,GAErB,IAAIjkB,EADJ0kB,EAAOA,EAAKrhJ,cAEZ,MAAMshJ,EAAK,CACT,EAAG,CAAE/5J,MAAM,GAAKwqD,IAAI,IACpB,EAAG,CAAExqD,MAAM,GAAKwqD,IAAI,IACpB,EAAG,CAAExqD,MAAM,GAAKwqD,IAAI,IACpB,EAAG,CAAExqD,MAAM,GAAKwqD,IAAI,IACpB,EAAG,CAAExqD,MAAM,GAAKwqD,IAAI,IACpB,EAAG,CAAExqD,MAAM,GAAKwqD,IAAI,KACpB,EAAG,CAAExqD,MAAM,IAAMwqD,IAAI,KACrB,EAAG,CAAExqD,MAAM,IAAMwqD,IAAI,KACrB,EAAG,CAAExqD,MAAM,IAAMwqD,IAAI,KACrB,GAAI,CAAExqD,MAAM,IAAMwqD,IAAI,MAElBwvG,EAAK,CACT,EAAG,CAAEh6J,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,GAAI,IACnB,EAAG,CAAExqD,KAAM,GAAIwqD,IAAI,MAEfyvG,EAAgB,CACpB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,MAGZC,GAAe,CACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,OAMrB,IAAIC,IAAS,EACTC,IAAW,EACXC,IAAU,EAmBd,GAzBqB,2BAQJ7vK,KAAKsvK,GACpBO,IAAU,EARU,iBAUF7vK,KAAKsvK,GACrBM,IAAW,EAVK,YAYA5vK,KAAKsvK,KACnBK,IAAS,GAKXA,GACFL,GAAQ,MACCM,KACTN,GAAQ,MAEN,2BAA2BtvK,KAAKsvK,GAAO,CACzC,MACMQ,GAAOR,EAAKlwK,MADF,eAEV2wK,GAASD,GAAK,GACdE,GAAWF,GAAK,GAAG,GACnBG,GAAUH,GAAK,GAAG1wK,MAAM4wK,IAAU,GACxC,IAAIx4F,GAAY,EACM,IAAlBu4F,GAAOrwK,SACT83E,GAAY,GAEd,MAAM04F,GAASH,GAAOvtB,UAAU,EAAGhrE,IAC7B24F,GAASJ,GAAOvtB,UAAUhrE,IAC1B44F,GAAW,EACXC,GAAW,EACXC,GAAa,EACbC,GAAa,EACbC,GAAY,GACZC,GAAY,IAClB,IAAIC,GAAc,EACdC,GAAc,EACdC,GAAa,EACbC,GAAa,EACjBpB,EAAcp/J,QAASlS,MACa,IAA9BA,GAAQK,QAAQwxK,MAClBW,GAAclB,EAAcjxK,QAAQL,IACpCuyK,GAAcvyK,GAAQK,QAAQwxK,IAAQ,GAG1CN,GAAar/J,QAASlS,MACa,IAA7BA,GAAQK,QAAQyxK,MAClBY,GAAanB,GAAalxK,QAAQL,IAClCyyK,GAAazyK,GAAQK,QAAQyxK,IAAO,GAIxC,IAAIa,GAAkB,EAClBC,GAAkB,EAClBC,GAAiB,EACjBC,GAAiB,EACjBC,GAAgBd,GAChBe,GAAgBd,GAChBT,IACFkB,GAAkBJ,GAAcJ,GAChCS,GAAkBJ,GAAcJ,GAChCS,GAAiB,EACjBC,GAAiB,EACjBC,GAAgBZ,GAChBa,GAAgBZ,IACPV,KACTiB,GAAkBJ,GAAcJ,GAChCS,GAAkBJ,GAAcJ,GAChCS,GAAiBJ,GAAaJ,GAC9BS,GAAiBJ,GAAaJ,GAC9BS,GAAgBV,GAChBW,GAAgBV,IAGlB,MAAMpqG,GAAoD,CACxD+qG,GAAI,CACF7B,EAAGW,IAAQlwG,GAAK8wG,GAAkBE,GAClCxB,EAAGW,IAAQnwG,GAAK+wG,GAAkBE,KAiEtC,OA7DA5qG,GAAMgrG,GAAK,CAAChrG,GAAM+qG,GAAG,GAAKF,GAAe7qG,GAAM+qG,GAAG,GAAKD,IACvD9qG,GAAMirG,GAAK,CAACjrG,GAAM+qG,GAAG,GAAI/qG,GAAM+qG,GAAG,GAAKD,IACvC9qG,GAAMkrG,GAAK,CAAClrG,GAAM+qG,GAAG,GAAKF,GAAe7qG,GAAM+qG,GAAG,IAElD/qG,GAAM+qG,GAAK7qG,KACT,CAACF,GAAM+qG,GAAG,GAAI/qG,GAAM+qG,GAAG,IACvB,YACAvC,GAEFxoG,GAAMgrG,GAAK9qG,KACT,CAACF,GAAMgrG,GAAG,GAAIhrG,GAAMgrG,GAAG,IACvB,YACAxC,GAEFxoG,GAAMirG,GAAK/qG,KACT,CAACF,GAAMirG,GAAG,GAAIjrG,GAAMirG,GAAG,IACvB,YACAzC,GAEFxoG,GAAMkrG,GAAKhrG,KACT,CAACF,GAAMkrG,GAAG,GAAIlrG,GAAMkrG,GAAG,IACvB,YACA1C,GAIFxoG,GAAM+qG,GAAKt7K,KAAKi5K,qBAAqB1oG,GAAM+qG,GAAIvC,EAAQ,GACvDxoG,GAAMgrG,GAAKv7K,KAAKi5K,qBAAqB1oG,GAAMgrG,GAAIxC,EAAQ,GACvDxoG,GAAMirG,GAAKx7K,KAAKi5K,qBAAqB1oG,GAAMirG,GAAIzC,EAAQ,GACvDxoG,GAAMkrG,GAAKz7K,KAAKi5K,qBAAqB1oG,GAAMkrG,GAAI1C,EAAQ,GAEvDjkB,EACE,YACA,CACEvkF,GAAM+qG,GAAGzxK,KAAK,KACd0mE,GAAMirG,GAAG3xK,KAAK,KACd0mE,GAAMgrG,GAAG1xK,KAAK,KACd0mE,GAAMkrG,GAAG5xK,KAAK,KACd0mE,GAAM+qG,GAAGzxK,KAAK,MACdA,KAAK,KACP,KAqBK,CACLirJ,UACAokB,QArBA,cACA,CACE3oG,GAAM+qG,GAAGzxK,KAAK,KACd0mE,GAAMirG,GAAG3xK,KAAK,KACd0mE,GAAMgrG,GAAG1xK,KAAK,KACd0mE,GAAMkrG,GAAG5xK,KAAK,KACd0mE,GAAM+qG,GAAGzxK,KAAK,MACdA,KAAK,KACP,IAcAsvK,eAXA,cACA,CACE5oG,GAAM+qG,GAAGzxK,KAAK,KACd0mE,GAAMirG,GAAG3xK,KAAK,KACd0mE,GAAMgrG,GAAG1xK,KAAK,KACd0mE,GAAMkrG,GAAG5xK,KAAK,MACdA,KAAK,KACP,IAMJ,CACF,4CA1PW2uK,EAAU,iCAAVA,EAAUn3K,QAAVm3K,EAAUl3K,UAAAC,WAFT,gBAEDi3K,CAAU,mECDhB,IAAMkD,GAAoB,MAA3B,MAAOA,EACFC,uBAAyB,IAElC57K,cAAe,CAEfgxB,KAAKklI,EAAqC2lB,GACxC,OAAO3lB,EAAWp2J,QAAQqyE,SACtB+jF,EAAWp2J,QAAQqyE,SACnB0pG,EAAc7qJ,IACpB,CAEA8qJ,gBAAgBxlJ,EAAqCulJ,GACnD,MAAM7qJ,EAAO2G,cACD13B,KAAK+wB,KAAKsF,EAAYulJ,IAC/BE,iBACH,OAAgB,IAAT/qJ,EAAa/wB,KAAK27K,uBAAyB5qJ,CACpD,CAEAgrJ,mBAAmBhrJ,GACjB,MAAM6gJ,EAAOl6I,cAAgB3G,GAC7B,OACmB,IAAjB6gJ,EAAKC,SACa,IAAlBD,EAAKoK,UACY,IAAjBpK,EAAKqK,SACW,IAAhBrK,EAAKsK,QACY,IAAjBtK,EAAKuK,SACc,IAAnBvK,EAAK3oC,SAET,CAEAmzC,oBAAoBrrJ,GAClB,MAAMghJ,EAAQr6I,cAAgB3G,GAC9B,OACqB,IAAnBghJ,EAAMiK,UACY,IAAlBjK,EAAMkK,SACW,IAAjBlK,EAAMmK,QACY,IAAlBnK,EAAMoK,SACc,IAApBpK,EAAM9oC,SAEV,CAEAozC,mBAAmBtrJ,GACjB,MAAMurJ,EAAO5kJ,cAAgB3G,GAC7B,OACmB,IAAjBurJ,EAAKL,SACW,IAAhBK,EAAKJ,QACY,IAAjBI,EAAKH,SACc,IAAnBG,EAAKrzC,SAET,CAEAszC,kBAAkBxrJ,GAChB,MAAMkhJ,EAAMv6I,cAAgB3G,GAC5B,OAAsB,IAAfkhJ,EAAIiK,QAAgC,IAAhBjK,EAAIkK,SAAmC,IAAlBlK,EAAIhpC,SACtD,CAEAuzC,mBAAmBzrJ,GACjB,MAAMqrE,EAAO1kE,cAAgB3G,GAC7B,OAAwB,IAAjBqrE,EAAK+/E,SAAoC,IAAnB//E,EAAK6sC,SACpC,CAEAwzC,qBAAqB1rJ,GAEnB,OAA4B,IADb2G,cAAgB3G,GACjBk4G,SAChB,CAEAyzC,aAAa1jJ,GACX,IAAI2jJ,EAAU,IAAI17K,KAClB,OAAI+3B,IACF2jJ,EAAU,IAAI17K,KAAK+3B,IAEd2jJ,EAAQz7K,SACjB,CAEO07K,QAAQl2K,EAAOm1K,GACpB,OAAOnkJ,KAAOhxB,GAAOknC,IAAIiuI,EAAiB,gBAAgBgB,QAC5D,CAEOC,aAAap2K,EAAOm1K,GACzB,OAAOnkJ,KAAOhxB,GAAOwuG,SAAS2mE,EAAiB,gBAAgBgB,QACjE,4CAhFWnB,EAAoB,iCAApBA,EAAoBr6K,QAApBq6K,EAAoBp6K,mBAApBo6K,CAAoB,qBCkB1B,IAAMqB,GAA4B,MAAnC,MAAOA,EAmDQC,qBAlDVpB,cACA9qE,MACA3kF,IACA8pI,WACCgnB,eAIL,IAAI3vK,MACa4vK,OAEtBnoD,SACAooD,YAAsB,EACtBC,eAAyB,EAChBC,sBAAgC,qBAChCC,uBAAiC,IACnCC,SAAW,cACXC,UAAY,SAEnB,kBAAIC,GACF,YAA6Cz7K,IAAtChC,KAAK47K,cAAc6B,eACtBz9K,KAAKs9K,uBACLt9K,KAAK47K,cAAc6B,cACzB,CAEA,iBAAIC,GACF,OAAI19K,KAAK47K,cAAczpE,eAAeurE,cAC7B19K,KAAK47K,cAAczpE,cAAcurE,cAEtC19K,KAAK47K,cAAc8B,cACd19K,KAAK47K,cAAc8B,cAErB19K,KAAKq9K,qBACd,CAEA,oBAAIM,GACF,OAAO39K,KAAKg9K,qBAAqBN,aAAa18K,KAAK8wG,MACrD,CAEA,kBAAI8sE,GACF,OAAO59K,KAAKg9K,qBAAqBN,aAAa18K,KAAKmsB,IACrD,CAEA,mBAAI0vJ,GACF,OAAO77K,KAAKg9K,qBAAqBnB,gBAC/B77K,KAAKi2J,WACLj2J,KAAK47K,cAET,CAEA77K,YAAmBi9K,GAAAh9K,KAAAg9K,uBACjBh9K,KAAK69K,kBAAoB79K,KAAK69K,kBAAkBljG,KAAK36E,KACvD,CAEAuN,WACEvN,KAAK89K,gBACL99K,KAAK+9K,kBAAkB,CAAEr3K,MAAO,GAClC,CAEAm3K,kBAAkBn3K,GAChB,IAAIs3K,EAAU,IAAI/8K,KAChBjB,KAAK29K,kBAAoBj3K,EAAQ,GAAK1G,KAAK67K,iBAG7C,GACE77K,KAAKg9K,qBAAqBjB,mBACxB/7K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEvD,CACA,MAAMqC,EAAQvmJ,cAEV13B,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEtD/J,QACHmM,EAAUtmJ,KAAO13B,KAAK29K,kBACnB/vI,KAAKlnC,EAAQ,GAAKu3K,EAAO,QACzBpB,QACL,SACE78K,KAAKg9K,qBAAqBZ,oBACxBp8K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEvD,CACA,MAAMqC,EAAQvmJ,cAEV13B,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEtDI,SACHgC,EAAUtmJ,KAAO13B,KAAK29K,kBACnB/vI,KAAKlnC,EAAQ,GAAKu3K,EAAO,SACzBpB,QACL,CAEA,OAAOnlJ,KAAOsmJ,GAASrmJ,OAAO33B,KAAK09K,cACrC,CAEAQ,WAAWx0J,GACL1pB,KAAK+0H,SACP/0H,KAAKm+K,cAELn+K,KAAKu9K,SAAW,eAChBv9K,KAAK+0H,SAAW3nF,YACbkhH,IACC,GAAItuJ,KAAKk9K,OAAOnsJ,KAAO/wB,KAAKo9K,eAAgB,CAC1C,MACMgB,EAAkB,kBACxBp+K,KAAKk9K,OAAiB,WAAE,GACxBl9K,KAAKk9K,OAAOkB,IACd,MACEp+K,KAAKm+K,YAAU,EAGnBn+K,KAAKy9K,eACLz9K,MAGN,CAEAm+K,aACMn+K,KAAK+0H,UACPxnF,cAAcvtC,KAAK+0H,UAErB/0H,KAAK+0H,cAAW/yH,EAChBhC,KAAKu9K,SAAW,aAClB,CAEAc,YAAY30J,GACN1pB,KAAK+0H,UACPxnF,cAAcvtC,KAAK+0H,UAErB/0H,KAAK+0H,cAAW/yH,EAChBhC,KAAKu9K,SAAW,cAChBv9K,KAAKk9K,OAAOnsJ,KAAO,EAGnB/wB,KAAKk9K,OAAsB,iBAC7B,CAEAa,kBAAkBO,GAChB,GAAIA,EACF,GACEt+K,KAAKg9K,qBAAqBjB,mBACxB/7K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEvD,CACA,MAAMqC,EAAQvmJ,cAEV13B,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEtD/J,QACG0M,EAAe7mJ,KAAO13B,KAAK29K,kBAC9B/vI,KAAK0wI,EAAgB53K,MAAQ,GAAKu3K,EAAO,QACzCpB,SACG2B,EAAa9mJ,KAAO6mJ,GAAc3wI,IAAIqwI,EAAO,QAAQpB,SAC3D78K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOgxB,KAAO6mJ,GAAc1B,SAAS4B,cACrC73F,IAAK,EACL83F,eAAe,IAEjB1+K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOgxB,KAAO8mJ,GAAY3B,SAAS4B,cACnC73F,IAAK,EACL83F,eAAe,GAEnB,SACE1+K,KAAKg9K,qBAAqBZ,oBACxBp8K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEvD,CACA,MAAMqC,EAAQvmJ,cAEV13B,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEtDI,SACGuC,EAAe7mJ,KAAO13B,KAAK29K,kBAC9B/vI,KAAK0wI,EAAgB53K,MAAQ,GAAKu3K,EAAO,SACzCpB,SACG2B,EAAa9mJ,KAAO6mJ,GAAc3wI,IAAIqwI,EAAO,SAASpB,SAC5D78K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOgxB,KAAO6mJ,GAAcI,QAAQ,SAAS9B,SAAS4B,cACtD73F,IAAK,EACL83F,eAAe,IAEjB1+K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOgxB,KAAO8mJ,GAAY3B,SAAS4B,cACnC73F,IAAK,EACL83F,eAAe,GAEnB,SACE1+K,KAAKg9K,qBAAqBT,kBACxBv8K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,iBAEvD57K,KAAKg9K,qBAAqBR,mBACxBx8K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,iBAEvD57K,KAAKg9K,qBAAqBP,qBACxBz8K,KAAKg9K,qBAAqBjsJ,KAAK/wB,KAAKi2J,WAAYj2J,KAAK47K,gBAEvD,CACA,MAAMoC,EAAU,IAAI/8K,KAClBjB,KAAK29K,iBACH39K,KAAK67K,iBAAmByC,EAAgB53K,MAAQ,IAEpD1G,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOs3K,EAAQS,cACf73F,IAAK,EACL83F,eAAe,IAEjB1+K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAO,IAAIzF,KACTjB,KAAKg9K,qBAAqBJ,QACxBoB,EAAQS,cACRz+K,KAAK67K,kBAEP4C,cACF73F,IAAK,EACL83F,eAAe,GAEnB,CAEJ,CAEAZ,gBACE,QACM1uI,EAAI,EACRpvC,KAAK49K,gBACF59K,KAAK29K,iBAAmBvuI,EAAIpvC,KAAK67K,mBACpC,EACAzsI,IAEApvC,KAAKo9K,eAAiBhuI,CAE1B,4CAxOW2tI,GAA4B37K,MAAAuE,IAAA,+BAA5Bo3K,EAA4BzuK,UAAA,iCAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,SAU5B8vK,MAAS,oNAZT,CAAClD,KAAqBt6K,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,iQAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBCtBjC1N,MADF,UACEA,CAD4B,oBAM1BA,MAAA,yBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAouK,YAAA1lK,KAAA1I,EAAAouK,YAAA1lK,GAAArW,MAAAqW,EAAA,GAICrW,MAAA,eAECA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAgzK,EAAAz9K,MAAA,GAAA09K,GAAA19K,MAAA,UAAAA,MACW2N,EAAAgvK,kBACV,CAAAt6J,OAAAq7J,GAAA3lI,OAAA0lI,EAAAn4K,MAAAo4K,GAAAp4K,QAKP,GAEEtF,UACAA,MAAA,cAAwCA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAS2N,EAAAmvK,WAAAzmK,GAAkB,GACjErW,MAAA,cAAUA,MAAA,GACZA,UACAA,MAAA,cAAwCA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAS2N,EAAAsvK,YAAA5mK,GAAmB,GAClErW,MAAA,cAAUA,MAAA,IAEdA,kBAzBIA,QAEAA,MAFA,SAEAA,CAFU,QAEVA,CADS,MAAA2N,EAAAquK,gBAETh8K,MAAA,UAAA2N,EAAAouK,aACA/7K,MAAA,cAAA2N,EAAA8uK,mBAgBUz8K,MAAA,GAAAA,MAAA2N,EAAAwuK,UAGAn8K,MAAA,GAAAA,MAAA2N,EAAAyuK,2BDJFuB,MAAen5K,YAAE62B,KAAW52B,UAAE0J,KAAezJ,KAAE0J,KAAazJ,MAAA8J,OAAA,2qBAG3DktK,CAA4B,wIExBvC37K,MAAA,yBAEEA,MAAA,yBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,qBAAAkK,EAAA0zK,WAAAvnK,KAAAnM,EAAA0zK,WAAAvnK,GAAArW,MAAAqW,EAAA,GACArW,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAUkK,EAAA2zK,WAAAxnK,GAAkB,GAE5BrW,MAAA,wBACFA,gCAJEA,MAAA,UAAAkK,EAAA0zK,YAGA59K,cAAA,IAAAA,MAAA,qFAIAA,MADF,WACEA,CAD+C,mCAM7CA,MAAA,0BAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA4zK,qBAAAznK,GAA4B,GAGlDrW,kCAPIA,QAGAA,MAHA,QAAAkK,EAAA6zK,WAGA/9K,CAHoB,MAAAkK,EAAA8zK,mBAAA9zK,EAAA2mE,QAAA3mE,EAAA+zK,SAGpBj+K,CAF8D,gBAAAkK,EAAAswK,cAE9Dx6K,CAD+B,aAAAkK,EAAA2qJ,sDAY7B70J,MAJJ,WAIIA,CAJuD,sBAIvDA,CAD2D,eAChDA,MAAA,wBAAgDA,QAC3DA,MAAA,cAIEA,MAAA,kBAAAqW,GAAArW,MAAAkP,GAAA,MAAAgvK,EAAAl+K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAUkK,EAAAi0K,oBAAA9nK,EAAA6nK,EAA6C,SAAQ,GAJjEl+K,QAOAA,MAAA,8BAMAA,MAAA,yBAKEA,MAAA,wBAAAqW,GAAArW,MAAAkP,GAAA,MAAAgvK,EAAAl+K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAgBkK,EAAAk0K,aAAA/nK,EAAA6nK,EAAsC,SAAQ,GAEhEl+K,QAEAA,MAAA,gBAiBFA,QAGEA,MADF,uBACEA,CAD2D,gBAChDA,MAAA,0BAA8CA,QACzDA,MAAA,eAIEA,MAAA,kBAAAqW,GAAArW,MAAAkP,GAAA,MAAAmvK,EAAAr+K,MAAA,IAAAkK,EAAAlK,MAAA,UAAAA,MAAUkK,EAAAi0K,oBAAA9nK,EAAAgoK,EAA2C,OAAM,GAJ7Dr+K,QAOAA,MAAA,+BAKAA,MAAA,0BAKEA,MAAA,wBAAAqW,GAAArW,MAAAkP,GAAA,MAAAmvK,EAAAr+K,MAAA,IAAAkK,EAAAlK,MAAA,UAAAA,MAAgBkK,EAAAk0K,aAAA/nK,EAAAgoK,EAAoC,OAAM,GAE5Dr+K,QAEAA,MAAA,iBAaFA,QAEEA,MADF,YACEA,CAD6B,sCAK3BA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAASkK,EAAA+yK,cAAa,GAItBj9K,MAAA,eAAUA,MAAA,IACZA,UACAA,MAAA,gDAEEA,MAAA,oBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAUkK,EAAAo0K,oBAAmB,GAQnCt+K,4DApGeA,MAAA,GAAAA,YAAA,sCAITA,MAAA,GAAAA,MAAA,QAAAkK,EAAAq0K,eAEAv+K,MAAA,WAAAkK,EAAAs0K,oBAIAx+K,QACAA,MADA,MAAAk+K,EACAl+K,CADuB,WAAAkK,EAAAs0K,oBAOvBx+K,QACAA,MADA,YAAAkK,EAAAu0K,eACAz+K,CAD4B,UAAAkK,EAAA6zK,YAU5B/9K,MAAA,GAOAA,MAPA,gBAAAk+K,EAOAl+K,CAPiC,QAAAkK,EAAA6zK,WAAA7zK,EAAA6zK,WAAA7zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAOjC5wE,CAFC,MAAAkK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAED5wE,CAD8C,MAAAkK,EAAA+zK,WAAA/zK,EAAA8zK,mBAAA9zK,EAAA+zK,SAAA/zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,UAUrC7wE,MAAA,GAAAA,YAAA,qCAITA,MAAA,GAAAA,MAAA,QAAAkK,EAAAy0K,aAEA3+K,MAAA,WAAAkK,EAAAs0K,oBAIAx+K,QACAA,MADA,MAAAq+K,EACAr+K,CADqB,WAAAkK,EAAAs0K,oBAMrBx+K,QACAA,MADA,YAAAkK,EAAAu0K,eACAz+K,CAD4B,UAAAkK,EAAA+zK,UAU5Bj+K,MAAA,GAOAA,MAPA,gBAAAq+K,EAOAr+K,CAP+B,QAAAkK,EAAA+zK,SAAA/zK,EAAA+zK,SAAA/zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,SAO/B7wE,CAJsE,MAAAkK,EAAA6zK,WAAA7zK,EAAA6zK,WAAA7zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAItE5wE,CADC,MAAAkK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,UAUD7wE,MAAA,GACAA,MADA,aAAAA,MAAA,qCACAA,CADwD,WAAAkK,EAAAs0K,oBAG9Cx+K,MAAA,GAAAA,MAAAkK,EAAAkyK,WAKVp8K,QAGAA,MAHA,aAAAA,MAAA,0CAGAA,CAH6D,WAAAkK,EAAAs0K,+CAuDzDx+K,MAAA,mBAA2DA,MAAA,GAEzDA,kCAF0CA,MAAA,QAAA4+K,GAAe5+K,cAAA4+K,8BAY3D5+K,MAAA,mBAGGA,MAAA,GAAYA,kCADbA,MAAA,QAAA6+K,GACC7+K,cAAA6+K,6CArBL7+K,MAFJ,WAEIA,CAF0D,sBAE1DA,CAD2D,eAChDA,MAAA,wBAA2CA,QACtDA,MAAA,mBAGEA,MAAA,6BAAAA,MAAAsQ,GAAAtQ,QAAA,MAAA8+K,EAAA9+K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAA60K,uBAAAD,EAAAx5K,MAAoC,GAAE,GAEzDtF,MAAA,EAAAg/K,GAAA,qBAIJh/K,UAEEA,MADF,sBACEA,CAD6D,eAClDA,MAAA,yBAA6CA,QACxDA,MAAA,oBAGEA,MAAA,6BAAAA,MAAAsQ,GAAAtQ,QAAA,MAAA8+K,EAAA9+K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAA60K,uBAAAD,EAAAx5K,MAAoC,GAAE,GAEzDtF,MAAA,GAAAi/K,GAAA,qBAONj/K,qCAzBeA,MAAA,GAAAA,YAAA,gCAETA,MAAA,GAAAA,MAAA,cAAAkK,EAAAg1K,gEAI6Bl/K,cAAA,UAAAkK,EAAAi1K,YAMpBn/K,MAAA,GAAAA,YAAA,oCAETA,MAAA,GAAAA,MAAA,cAAAkK,EAAAk1K,kEAKqBp/K,cAAA,UAAAkK,EAAAm1K,yCAoDrBr/K,MAAA,mBAAyDA,MAAA,GAEvDA,kCAFwCA,MAAA,QAAAs/K,GAAet/K,cAAAs/K,8BAYzDt/K,MAAA,mBAA+DA,MAAA,GAE7DA,kCAF4CA,MAAA,QAAAu/K,GAAiBv/K,cAAAu/K,6CAlBjEv/K,MAFJ,WAEIA,CAF0D,sBAE1DA,CAD2D,eAChDA,MAAA,wBAA2CA,QACtDA,MAAA,mBAGEA,MAAA,6BAAAA,MAAAivB,GAAAjvB,QAAA,MAAAw/K,EAAAx/K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAA60K,uBAAAS,EAAAl6K,MAAkC,GAAE,GAEvDtF,MAAA,EAAAy/K,GAAA,qBAIJz/K,UAEEA,MADF,sBACEA,CAD6D,eAClDA,MAAA,yBAA6CA,QACxDA,MAAA,oBAGEA,MAAA,6BAAAA,MAAAivB,GAAAjvB,QAAA,MAAAw/K,EAAAx/K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAA60K,uBAAAS,EAAAl6K,MAAkC,GAAE,GAEvDtF,MAAA,GAAA0/K,GAAA,qBAKN1/K,qCAvBeA,MAAA,GAAAA,YAAA,gCAETA,MAAA,GAAAA,MAAA,cAAAkK,EAAAy1K,8DAI6B3/K,cAAA,UAAAkK,EAAA01K,UAMpB5/K,MAAA,GAAAA,YAAA,oCAETA,MAAA,GAAAA,MAAA,cAAAkK,EAAA21K,gEAI+B7/K,cAAA,UAAAkK,EAAA41K,sDAtDrC9/K,MADF,WACEA,CADsD,uBAEpDA,MAAA,8BAKAA,MAAA,qCAMEA,MAAA,wBAAAA,MAAA8tD,GAAA,MAAA0xH,EAAAx/K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAckK,EAAA60K,uBAAAS,EAAAl6K,MAAkC,GAAE,GANpDtF,QAiBAA,MAAA,aACAA,MAAA,yBAKEA,MADA,wBAAAqW,GAAArW,MAAA8tD,GAAA,MAAAiyH,EAAA//K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAgBkK,EAAAk0K,aAAA/nK,EAAA0pK,EAAoC,OAAM,EAC1D//K,CAD2D,yBAAAqW,GAAArW,MAAA8tD,GAAA,MAAAiyH,EAAA//K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAC1CkK,EAAA81K,cAAA3pK,EAAA0pK,EAAqC,OAAM,GAGhE//K,UAEAA,MAAA,EAAAigL,GAAA,gBA0BFjgL,4CAzDMA,MAAA,GACAA,MADA,MAAA+/K,EACA//K,CADqB,WAAAkK,EAAAs0K,oBAMrBx+K,QAYAA,MAZA,gBAAA+/K,EAYA//K,CAZ+B,cAAAA,MAAA,mCAY/BA,CAXwD,sBAAAkK,EAAAg2K,kBAWxDlgL,CARyC,QAAAkK,EAAA+zK,SAAA/zK,EAAA+zK,SAAA/zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,SAQzC7wE,CALC,MAAAkK,EAAA6zK,WAAA7zK,EAAA6zK,WAAA7zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAKD5wE,CAFC,MAAAkK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,SAED7wE,CAD8C,WAAAkK,EAAAs0K,8DAM9Cx+K,MAAA,GACAA,MADA,YAAAkK,EAAAu0K,eACAz+K,CAD4B,UAAAkK,EAAA+zK,UAQ1Bj+K,MAAA,GAAAA,MAAA,oBAAAkK,EAAAi2K,0DArGNngL,MAFJ,WAEIA,CAFoE,WAEpEA,CAD0B,uBAExBA,MAAA,8BAKAA,MAAA,qCAMEA,MAAA,wBAAAA,MAAA8P,GAAA,MAAAgvK,EAAA9+K,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAckK,EAAA60K,uBAAAD,EAAAx5K,MAAoC,GAAE,GANtDtF,QAmBAA,MAAA,aACAA,MAAA,yBAKEA,MADA,wBAAAqW,GAAArW,MAAA8P,GAAA,MAAAswK,EAAApgL,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAAgBkK,EAAAk0K,aAAA/nK,EAAA+pK,EAAsC,SAAQ,EAC9DpgL,CAD+D,yBAAAqW,GAAArW,MAAA8P,GAAA,MAAAswK,EAAApgL,MAAA,GAAAkK,EAAAlK,MAAA,UAAAA,MAC9CkK,EAAA81K,cAAA3pK,EAAA+pK,EAAuC,SAAQ,GAGpEpgL,UAEAA,MAAA,GAAAqgL,GAAA,gBA4BFrgL,QAEAA,MAAA,GAAAsgL,GAAA,gBAgEEtgL,MADF,YACEA,CAD6B,sCAK3BA,MAAA,mBAAAA,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAASkK,EAAA+yK,cAAa,GAItBj9K,MAAA,eAAUA,MAAA,IACZA,UACAA,MAAA,gDAEEA,MAAA,oBAAAA,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAAUkK,EAAAo0K,oBAAmB,GAQnCt+K,gDAnJQA,MAAA,GACAA,MADA,MAAAogL,EACApgL,CADuB,WAAAkK,EAAAs0K,oBAMvBx+K,QAcAA,MAdA,gBAAAogL,EAcApgL,CAdiC,cAAAA,MAAA,qCAcjCA,CAb0D,sBAAAkK,EAAAq2K,oBAa1DvgL,CAV2C,QAAAkK,EAAA6zK,WAAA7zK,EAAA6zK,WAAA7zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAU3C5wE,CAPC,MAAAkK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAmyE,SAOD5wE,CAN8C,MAAAkK,EAAA+zK,WAAA/zK,EAAA8zK,mBAAA9zK,EAAA+zK,SAAA/zK,EAAAw0K,WAAAx0K,EAAA2qJ,WAAAp2J,QAAAoyE,SAM9C7wE,CADC,WAAAkK,EAAAs0K,8DAMDx+K,MAAA,GACAA,MADA,YAAAkK,EAAAu0K,eACAz+K,CAD4B,UAAAkK,EAAA6zK,YAQ1B/9K,MAAA,GAAAA,MAAA,oBAAAkK,EAAAi2K,gBA8BFngL,cAAA,QAAAkK,EAAA8zK,oBAqEFh+K,MAAA,GACAA,MADA,aAAAA,MAAA,qCACAA,CADwD,WAAAkK,EAAAs0K,oBAG9Cx+K,MAAA,GAAAA,MAAAkK,EAAAkyK,WAOVp8K,QACAA,MADA,aAAAA,MAAA,0CACAA,CAD6D,WAAAkK,EAAAs0K,+CA9PrEx+K,MAAA,SA2GEA,MA1GA,EAAAwgL,GAAA,eA0GAxgL,CA1G2D,EAAAygL,GAAA,gBAmQ7DzgL,8BAnQqCA,cAAA,OAAAkK,EAAAw2K,kBA0GI1gL,cAAA,gBAAAkK,EAAAi2K,iBChEpC,IAAMQ,GAAsB,MAA7B,MAAOA,EA0FQ/E,qBAzFV/mB,WACA2lB,cACCqB,eAIL,IAAI3vK,MAETizK,WACAS,SACAP,aACAS,WACAZ,qBAAuB,IAAI5sH,KAC3B8sH,uBAAyB,IAAI9sH,KAC7BqtH,mBAAqB,IAAIrtH,KACzButH,qBAAuB,IAAIvtH,KAC3BsuH,YACAC,UACSC,YAAsB,aACtBC,YAAsB,aACtB9E,sBAAgC,qBAChC+E,2BAAqC,EAC9CC,kBAAoBv1E,KACbkyE,YAAa,EAEXrD,uBAAyB,IAC3B97K,QAEA8/K,cACAI,YACA+B,kBAAmB,EACnBtE,UAAY,SACZoC,mBAEyB0C,kBACEC,oBACVC,UACFC,QAEdC,mBAER,QAAI3xJ,GACF,OAAO/wB,KAAKi2J,WAAWp2J,QAAQqyE,SAC3BlyE,KAAKi2J,WAAWp2J,QAAQqyE,SACxBlyE,KAAK47K,cAAc7qJ,IACzB,CAEA,oBAAI4xJ,GACF,MAAM5xJ,EAAO2G,cAAgB13B,KAAK+wB,MAAM+qJ,iBACxC,OAAgB,IAAT/qJ,EAAa/wB,KAAK27K,uBAAyB5qJ,CACpD,CAEA,cAAIouJ,CAAWruE,GACb9wG,KAAKgiL,YAAclxE,CACrB,CAEA,cAAIquE,GACF,OAAOn/K,KAAKgiL,WACd,CAEA,YAAI3C,CAASruE,GACXhxG,KAAKiiL,UAAYjxE,CACnB,CAEA,YAAIquE,GACF,OAAOr/K,KAAKiiL,SACd,CAEA,kBAAIxE,GACF,YAA6Cz7K,IAAtChC,KAAK47K,cAAc6B,eACtB,IACAz9K,KAAK47K,cAAc6B,cACzB,CAEA,WAAIxrG,GACF,OAAOjyE,KAAKi2J,WAAWp2J,QAAQoyE,QAC3BjyE,KAAKi2J,WAAWp2J,QAAQoyE,QACxBjyE,KAAKmiL,WACX,CAEA,iBAAIzE,GACF,OAAO19K,KAAK47K,cAAc8B,cACtB19K,KAAK47K,cAAc8B,cACnB19K,KAAKq9K,qBACX,CAEOsE,oBACAL,kBAEPvhL,YAAmBi9K,GAAAh9K,KAAAg9K,sBAA6C,CAEhEzvK,WACEvN,KAAK0iL,mBAAqB1iL,KAAKi2J,WAAWp2J,QAAQu4E,WAC/C/0D,QACCrjB,KAAK47K,cAAczpE,gBACrBnyG,KAAK47K,cAAczpE,cAAcxhE,aACc3uC,IAA7ChC,KAAK47K,cAAczpE,cAAcxhE,QAC7B3wC,KAAK47K,cAAczpE,cAAcxhE,QACjC3wC,KAAKoiL,2BAEbpiL,KAAKm/K,WAAan/K,KAAK4iL,YAAY5iL,KAAK6iL,aACxC7iL,KAAKq/K,SAAWr/K,KAAK4iL,YAAY5iL,KAAK8iL,aAEtC9iL,KAAK2/K,cAAgB3/K,KAAKm/K,WAAW4D,iBACrC/iL,KAAK+/K,YAAc//K,KAAKq/K,SAAS0D,iBACjC/iL,KAAK8hL,iBAAmB9hL,KAAKgjL,qBAC7BhjL,KAAKijL,wBACLjjL,KAAKkjL,0BAELljL,KAAKmjL,eACLnjL,KAAKojL,WAAWpjL,KAAK2hL,oBAAqB,SAC1C3hL,KAAKojL,WAAWpjL,KAAKshL,kBAAmB,MAC1C,CAEAsB,YAAYl5K,GACV,IAAKA,EACH,OAAO,IAAIzI,KACN,GAAIoiL,MAAM,IAAIpiL,KAAKyI,GAAQxI,WAAY,CAC5C,GAAIwI,EAAOuiE,OAAO,QAAU,EAAG,CAC7B,MAAM8oD,EAAWrrH,EAAOwxB,MAAM,yCAC9B,GAAIxxB,EAAOwxB,MAAM,MAAO,CACtB,MAAMooJ,EAAchrJ,SAClB5uB,EAAOgjJ,UAAUhjJ,EAAOhB,QAAQ,KAAO,EAAGqsH,EAAS91G,OACnD,IAEF,OAAOyY,OAASkW,IAAI01I,EAAavuD,EAAS,IAAI8nD,QAChD,CACA,GAAInzK,EAAOwxB,MAAM,MAAO,CACtB,MAAMooJ,EAAchrJ,SAClB5uB,EAAOgjJ,UAAUhjJ,EAAOhB,QAAQ,KAAO,EAAGqsH,EAAS91G,OACnD,IAEF,OAAOyY,OAASw9E,SAASouE,EAAavuD,EAAS,IAAI8nD,QACrD,CACA,OAAO,IAAI57K,IACb,CACA,GAAIyI,EAAOuiE,OAAO,UAAY,EAAG,CAC/B,MAAMs3G,EAAO7rJ,OAASu9E,MAAM,OAAO4nE,SAC7B9nD,EAAWrrH,EAAOwxB,MAAM,yCAC9B,GAAIxxB,EAAOwxB,MAAM,MAAO,CACtB,MAAMooJ,EAAchrJ,SAClB5uB,EAAOgjJ,UAAUhjJ,EAAOhB,QAAQ,KAAO,EAAGqsH,EAAS91G,OACnD,IAEF,OAAOyY,KAAO6rJ,GAAM31I,IAAI01I,EAAavuD,EAAS,IAAI8nD,QACpD,CACA,GAAInzK,EAAOwxB,MAAM,MAAO,CACtB,MAAMooJ,EAAchrJ,SAClB5uB,EAAOgjJ,UAAUhjJ,EAAOhB,QAAQ,KAAO,EAAGqsH,EAAS91G,OACnD,IAEF,OAAOyY,KAAO6rJ,GAAMruE,SAASouE,EAAavuD,EAAS,IAAI8nD,QACzD,CACA,OAAO0G,CACT,CACA,OAAO,IAAItiL,IACb,CACA,OAAIjB,KAAK47K,cAAcj7F,iBACR3gF,KAAKwjL,6BAA6B95K,GAGxCA,EAAS,IAAIzI,KAAKyI,GAAU,IAAIzI,IAE3C,CAEAk/K,uBACEz5K,EACA2oC,EACAqvI,GAAgB,GAEK,iBAAVh4K,IACTA,EAAQ,IAAIzF,KAAKyF,IAEnB,IAAI+8K,EAAWzjL,KAAK0jL,YAAYh9K,EAAO2oC,GACvC,GAAIrvC,KAAKgjL,qBAAsB,CAC7B,IAAIW,EAgBJ,OAfiB,IAAbt0I,GACFrvC,KAAKm/K,WAAaz4K,EAClB1G,KAAK2/K,cAAgB3/K,KAAKm/K,WAAWrN,cACrC6R,EAA2B,GAAG3jL,KAAK2/K,wBAEnC3/K,KAAKq/K,SAAW34K,EAChB1G,KAAK+/K,YAAc//K,KAAKq/K,SAASvN,cACjC6R,EAA2B,GAAG3jL,KAAK+/K,0BAGrC//K,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAOi9K,EACP/8F,IAAKv3C,EACLqvI,iBAGJ,CACiB,IAAbrvI,GAA0C,SAAxBrvC,KAAKuhL,iBAA8BvhL,KAAKg/K,aAE5DyE,EAAW/rJ,KAAO+rJ,GAAUxuE,MAAM,OAAO4nE,UAG1B,IAAbxtI,GACFrvC,KAAKm/K,WAAasE,EACdzjL,KAAKo/K,oBACPp/K,KAAKmgL,uBACHngL,KAAKg9K,qBAAqBJ,QAAQ6G,EAAUzjL,KAAK2iL,kBACjD,EACAjE,IAIJ1+K,KAAKq/K,SAAWoE,EAElBzjL,KAAKkjL,0BACLljL,KAAKi9K,eAAet6K,KAAK,CACvB+D,MAAO+8K,EAAShF,cAChB73F,IAAKv3C,EACLqvI,iBAEJ,CAEAoB,WAAWp5K,GACT,GAAKA,GAAmB,KAAVA,EAGd,MAAqB,iBAAVA,GAAsB1G,KAAK47K,cAAcj7F,iBAC3C3gF,KAAKwjL,6BAA6B98K,GAEpC,IAAIzF,KAAKyF,EAClB,CAEA66K,eACE,OAAIvhL,KAAK47K,cAAcj7F,iBACd,OAEL3gF,KAAK2iL,iBAAmB,MACnB,WAEF,MACT,CAEAK,qBACE,MAA4B,SAAxBhjL,KAAKuhL,cAKX,CAEAhC,oBAAoBqE,EAAaC,EAAkB5lK,GACjD,MACM+a,EAAOh5B,KAAKwjL,6BADLI,EAAYhtK,OAAOlQ,OAEhC1G,KAAKw/K,aAAaxmJ,EAAM6qJ,EAAY5lK,EACtC,CAEAuhK,aACE5N,EACAiS,EACA5lK,EACAygK,GAAgB,GAEZ1+K,KAAKg9K,qBAAqBjB,mBAAmB/7K,KAAK+wB,QAChD8yJ,GACFA,EAAW5rK,QAEI,QAAbgG,EAEF2zJ,EAAOl6I,KAAOk6I,GAAM38D,MAAM,QAAQ4nE,SAErB,UAAb5+J,GACAje,KAAKo/K,qBACJp/K,KAAK8hL,kBAEN9hL,KAAKw/K,aAAa5N,OAAM5vK,EAAW,OAErChC,KAAKmgL,uBACHvO,EACa,UAAb3zJ,EAAuB,EAAI,EAC3BygK,GAGN,CAEA0C,cACErP,EACA8R,EACA5lK,EACAygK,GAAgB,GAEZ1+K,KAAKg9K,qBAAqBZ,oBAAoBp8K,KAAK+wB,QACjD8yJ,GACFA,EAAW5rK,QAEI,QAAbgG,EACF8zJ,EAAQr6I,KAAOq6I,GAAO98D,MAAM,SAAS4nE,SACf,UAAb5+J,GAAwBje,KAAKo/K,oBACtCp/K,KAAKohL,cAAcrP,OAAO/vK,EAAW,OAEvChC,KAAKmgL,uBACHpO,EACa,UAAb9zJ,EAAuB,EAAI,EAC3BygK,GAGN,CAEAmB,eACE,MAAM31K,EAAOlK,KAAK2iL,iBACZlxF,EAAOvlE,KAAK68G,IAChB/oI,KAAK4iL,YAAY5iL,KAAK47K,cAAc5qE,KAAK9vG,UACvClB,KAAK4iL,YAAY5iL,KAAK47K,cAAc9qE,OAAO5vG,WAE/C,OAAIlB,KAAKg9K,qBAAqBjB,mBAAmB/7K,KAAK+wB,MAC7C,aACE/wB,KAAKg9K,qBAAqBZ,oBAAoBp8K,KAAK+wB,MACrD,OACE7mB,EAAO,OAAYunF,EAAO,MAC5B,QAEA,OAEX,CAEA2xF,WAAW5/K,EAAcw1B,GACvB,MAAM8qJ,EAAY,IAAI7iL,KAAK+3B,GACrBy4D,EAAOqyF,EAAU5iL,UAAY,IAAID,KAAKjB,KAAK6iL,aAAa3hL,UAE9D,GAAIlB,KAAKg9K,qBAAqBjB,mBAAmB/7K,KAAK+wB,MAAO,CAC3D,MAAMgzJ,EAAYrsJ,KAAOosJ,GAAWryF,KAClC/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAEF,GAAa,QAATr/K,EAAgB,CAClB,MAAMwgL,EAAiBtsJ,KAAOosJ,GAAWl2I,IAAI,EAAG,KAC1Cq2I,GAAiBvsJ,KAAOssJ,GAAgBvyF,KAC5C/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAIF,YAFA7iL,KAAKshL,kBACH2C,GAAiBvsJ,cAAgB13B,KAAK+wB,MAAMmzJ,WAAc,EAE9D,IAAoB,UAAT1gL,EAGT,YAFAxD,KAAK2hL,oBACHoC,EAAYrsJ,cAAgB13B,KAAK+wB,MAAMmzJ,WAAc,EAG3D,SAAWlkL,KAAKg9K,qBAAqBZ,oBAAoBp8K,KAAK+wB,MAAO,CACnE,MAAMgzJ,EAAYrsJ,KAAOosJ,GAAWryF,KAClC/5D,KAAO13B,KAAK6iL,aACZ,UACA,GAEF,GAAa,QAATr/K,EAAgB,CAClB,MAAMwgL,EAAiBtsJ,KAAOosJ,GAAWl2I,IAAI,EAAG,KAC1Cq2I,GAAiBvsJ,KAAOssJ,GAAgBvyF,KAC5C/5D,KAAO13B,KAAK6iL,aACZ,UACA,GAIF,YAFA7iL,KAAKshL,kBACH2C,GAAiBvsJ,cAAgB13B,KAAK+wB,MAAMozJ,YAAe,EAE/D,IAAoB,UAAT3gL,EAGT,YAFAxD,KAAK2hL,oBACHoC,EAAYrsJ,cAAgB13B,KAAK+wB,MAAMozJ,YAAe,EAG5D,SAAWnkL,KAAKg9K,qBAAqBX,mBAAmBr8K,KAAK+wB,MAAO,CAClE,MAAMqzJ,EAAW1sJ,KAAOosJ,GAAWryF,KACjC/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAEF,GAAa,QAATr/K,EAAgB,CAClB,MAAMwgL,EAAiBtsJ,KAAOosJ,GAAWl2I,IAAI,EAAG,KAC1Cy2I,GAAgB3sJ,KAAOssJ,GAAgBvyF,KAC3C/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAIF,YAFA7iL,KAAKshL,kBACH+C,GAAgB3sJ,cAAgB13B,KAAK+wB,MAAMuzJ,WAAc,EAE7D,IAAoB,UAAT9gL,EAGT,YAFAxD,KAAK2hL,oBACHyC,EAAW1sJ,cAAgB13B,KAAK+wB,MAAMuzJ,WAAc,EAG1D,SAAWtkL,KAAKg9K,qBAAqBT,kBAAkBv8K,KAAK+wB,MAAO,CACjE,MAAMwzJ,EAAU7sJ,KAAOosJ,GAAWryF,KAChC/5D,KAAO13B,KAAK6iL,aACZ,QACA,GAEF,GAAa,QAATr/K,EAAgB,CAClB,MAAMwgL,EAAiBtsJ,KAAOosJ,GAAWl2I,IAAI,EAAG,KAM1C42I,GALe9sJ,KAAOssJ,GAAgBvyF,KAC1C/5D,KAAO13B,KAAK6iL,aACZ,QACA,GAE0BnrJ,cAAgB13B,KAAK+wB,MAAM0zJ,SAGvD,YAFAzkL,KAAKshL,kBACFkD,GAAO,MAAaA,IAAO,MAAwB,IAATA,GAE/C,IAAoB,UAAThhL,EAAkB,CAC3B,MAAMghL,EAAQD,EAAU7sJ,cAAgB13B,KAAK+wB,MAAM0zJ,SAAY,EAG/D,YAFAzkL,KAAK2hL,oBACF6C,EAAO,MAAaA,GAAO,MAAuB,IAATA,GAAwB,IAATA,EAE7D,CACF,SAAWxkL,KAAKg9K,qBAAqBR,mBAAmBx8K,KAAK+wB,MAAI,CAC/D,GAAa,QAATvtB,EAAgB,CAClB,MAAMkhL,EAAWhtJ,KAAOosJ,GAAWryF,KACjC/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAIF,YAFA7iL,KAAKshL,kBACHoD,EAAWhtJ,cAAgB13B,KAAK+wB,MAAM4zJ,WAAc,EAExD,IAAoB,UAATnhL,EAAkB,CAC3B,MAAMkhL,EAAWhtJ,KAAOosJ,GAAWryF,KACjC/5D,KAAO13B,KAAK6iL,aACZ,SACA,GAIF,YAFA7iL,KAAK2hL,oBACH+C,EAAWhtJ,cAAgB13B,KAAK+wB,MAAM4zJ,WAAc,EAExD,UACS3kL,KAAKg9K,qBAAqBP,qBAAqBz8K,KAAK+wB,MAAI,CACjE,GAAa,QAATvtB,EAEF,YADAxD,KAAKshL,mBAAoB,GAE3B,GAAoB,UAAT99K,EAET,YADAxD,KAAK2hL,qBAAsB,EAE7B,CAGF3hL,KAAKshL,kBAAoB7vF,EAAOzxF,KAAK2iL,kBAAqB,EAC1D3iL,KAAK2hL,oBAAsBlwF,EAAOzxF,KAAK2iL,kBAAqB,CAE9D,CAEAe,YAAY1qJ,EAAM4tD,GAChB,MAAMg+F,EAAW,IAAI3jL,KAAK+3B,GAC1B,IAAI6rJ,EACJ,IAAK7kL,KAAKg/K,WACR,OAAQp4F,GACN,KAAK,EACH,GAAI5mF,KAAK47K,cAAcj7F,iBAAkB,CACvCkkG,EAAYD,EAASE,SAAS,EAAG,GACjC,KACF,CACED,EAAYD,EAASE,SACnB9kL,KAAKsgL,qBAAqB55K,MAC1B1G,KAAKwgL,uBAAuB95K,OAE9B,MAGJ,KAAK,EACH,GAAI1G,KAAK47K,cAAcj7F,iBAAkB,CACvCkkG,EAAYD,EAASE,SAAS,EAAG,GACjC,KACF,CACED,EAAYD,EAASE,SACnB9kL,KAAK+gL,mBAAmBr6K,MACxB1G,KAAKihL,qBAAqBv6K,OAOpC,OAAO,IAAIzF,KAAK4jL,GAAwBD,EAC1C,CAEAG,wBACE,OAAI/kL,KAAKg9K,qBAAqBP,qBAAqBz8K,KAAK+wB,MAClD/wB,KAAK2iL,iBAAmB,KACnB3iL,KAAK2iL,iBAAmB,KAAS,GACpC,EACA3iL,KAAK2iL,iBAAmB,IAEpB3iL,KAAK2iL,iBAAmB,KAAW,GAEpC3iL,KAAKg9K,qBAAqBR,mBAAmBx8K,KAAK+wB,MACpD,GAEF,CACT,CAEAi0J,sBACE,OAAIhlL,KAAKg9K,qBAAqBR,mBAAmBx8K,KAAK+wB,MAC7C/wB,KAAK2iL,iBAAmB,IAAO,GAAK,GAEtC,CACT,CAEAsC,oBAAoBC,GAEhBllL,KAAKugL,WAAahlK,MAAMmE,KADtBwlK,EAEA,CACEt7K,QACG5J,KAAK+gL,mBAAmBr6K,MAAQ,GAAK1G,KAAKglL,sBAAwB,GAMvE,CAAEp7K,OAAS,GAAU5J,KAAKglL,sBAAwB,GAJlD,CAAC5iH,EAAGhzB,IAAM,EAAIA,EAAIpvC,KAAKglL,uBAQ3BhlL,KAAKsgL,qBAAqB/oJ,SAASv3B,KAAKm/K,WAAWgG,WACrD,CAEAC,kBAAkBF,GAEdllL,KAAKghL,SADHkE,EACc3pK,MAAMmE,KACpB,CACE9V,QACG,GAAK5J,KAAKsgL,qBAAqB55K,OAC9B1G,KAAKglL,sBACP,GAEJ,CAAC5iH,EAAGhzB,IACFpvC,KAAKsgL,qBAAqB55K,MAAQ0oC,EAAIpvC,KAAKglL,uBAG/BzpK,MAAMmE,KACpB,CAAE9V,OAAS,GAAU5J,KAAKglL,sBAAwB,GAClD,CAAC5iH,EAAGhzB,IAAM,EAAIA,EAAIpvC,KAAKglL,uBAG3BhlL,KAAK+gL,mBAAmBxpJ,SAASv3B,KAAKq/K,SAAS8F,WACjD,CAEAE,sBAAsBH,GAElBllL,KAAKygL,aAAellK,MAAMmE,KADxBwlK,EAEA,CACEt7K,QACG5J,KAAKihL,qBAAqBv6K,MAAQ,GACjC1G,KAAK+kL,wBACP,GAMJ,CAAEn7K,OAAS,GAAU5J,KAAK+kL,wBAA0B,GAJpD,CAAC3iH,EAAGhzB,IAAM,EAAIA,EAAIpvC,KAAK+kL,yBAQ3B/kL,KAAKwgL,uBAAuBjpJ,SAASv3B,KAAKm/K,WAAWmG,aACvD,CAEAC,oBAAoBL,GAEhBllL,KAAKkhL,WADHgE,EACgB3pK,MAAMmE,KACtB,CACE9V,QACG,GAAK5J,KAAKwgL,uBAAuB95K,OAChC1G,KAAK+kL,wBACP,GAEJ,CAAC3iH,EAAGhzB,IACFpvC,KAAKwgL,uBAAuB95K,MAAQ0oC,EAAIpvC,KAAK+kL,yBAG/BxpK,MAAMmE,KACtB,CAAE9V,OAAS,GAAU5J,KAAK+kL,wBAA0B,GACpD,CAAC3iH,EAAGhzB,IAAM,EAAIA,EAAIpvC,KAAK+kL,yBAG3B/kL,KAAKihL,qBAAqB1pJ,SAASv3B,KAAKq/K,SAASiG,aACnD,CAEApC,0BACE,MAAMsC,EAAW,IAAIvkL,KAAKjB,KAAKm/K,YACzBsG,EAAS,IAAIxkL,KAAKjB,KAAKq/K,UACzBmG,EAASV,SAAS,EAAG,KAAOW,EAAOX,SAAS,EAAG,IACjD9kL,KAAKilL,qBAAoB,GACzBjlL,KAAKolL,mBAAkB,GACnBplL,KAAKm/K,WAAWgG,aAAenlL,KAAKq/K,SAAS8F,aAC/CnlL,KAAKqlL,uBAAsB,GAC3BrlL,KAAKulL,qBAAoB,MAG3BvlL,KAAKilL,sBACLjlL,KAAKolL,oBACLplL,KAAKqlL,wBACLrlL,KAAKulL,sBAET,CAEQpC,eACNnjL,KAAKmgL,uBAAuBngL,KAAKm/K,WAAY,GAAG,GAChDn/K,KAAKmgL,uBAAuBngL,KAAKq/K,SAAU,GAAG,EAChD,CAEOD,mBACL,QAAOp/K,KAAK47K,cAAc8J,gBACtB1lL,KAAK47K,cAAc8J,cAEzB,CAEO7C,YACL,OAAO7iL,KAAK47K,cAAc9qE,MACtB9wG,KAAK47K,cAAc9qE,MACnB9wG,KAAKi2J,WAAWp2J,QAAQmyE,QACtBhyE,KAAKi2J,WAAWp2J,QAAQmyE,QACxBhyE,KAAKkiL,WACb,CAEOY,YACL,OAAO9iL,KAAK47K,cAAc5qE,IACtBhxG,KAAK47K,cAAc5qE,IACnBhxG,KAAKi2J,WAAWp2J,QAAQoyE,QACtBjyE,KAAKi2J,WAAWp2J,QAAQoyE,QACxBjyE,KAAKmiL,WACb,CAEAjD,qBAAqBx1J,GACnB1pB,KAAKi9K,eAAet6K,KAAK+mB,EAC3B,CAEAu1J,WAAWv1J,GACJA,EAAMmE,SACT7tB,KAAKmjL,cAET,CAEAF,wBAEIjjL,KAAK4/K,qBADH5/K,KAAK47K,gBACoB57K,KAAK47K,cAAcj0J,OAIpB,aAAxB3nB,KAAKuhL,kBACyB,IAA5BvhL,KAAK4/K,oBACP5/K,KAAKsgL,qBAAqBnnJ,UAC1Bn5B,KAAKwgL,uBAAuBrnJ,UAC5Bn5B,KAAK+gL,mBAAmB5nJ,UACxBn5B,KAAKihL,qBAAqB9nJ,YAE1Bn5B,KAAKsgL,qBAAqBl+I,SAC1BpiC,KAAKwgL,uBAAuBp+I,SAC5BpiC,KAAK+gL,mBAAmB3+I,SACxBpiC,KAAKihL,qBAAqB7+I,UAGhC,CACAohJ,6BAA6BmC,GAM3B,IAAI/T,EACAG,EAAQ,KACRE,EAAM,KACV,GAA0B,KAAtB0T,EAAW/7K,OAAe,CAC5B,MAAMg8K,EAAYD,EAAWr8K,MAAM,KACnC,GAAyB,IAArBs8K,EAAUh8K,OACZ,MAAM,IAAIoY,MACR,wGAGF4vJ,EAAOgU,EAAU,GACjB7T,EAAQ6T,EAAU,GAClB3T,EAAM2T,EAAU,EAEpB,SAAiC,IAAtBD,EAAW/7K,OAGpB,OAAO,IAAI3I,KAAK0kL,GAFhB/T,EAAO+T,CAEmB,CAE5B,OAAO,IAAI1kL,KAAK,GAAG2wK,KAAQG,KAASE,aACtC,CAEAoM,cACE,IAAIwH,EACAC,EACAC,EACAC,EAEAhmL,KAAK8hL,kBAGLkE,EAFkC,UAAhChmL,KAAK0iL,mBAAmB1xE,IAEJ,QADU/vG,MAAOihJ,mBAAmB,SACXwK,UAAU,EAAG,WAEtC,GAAG1sJ,KAAK0iL,mBAAmB1xE,IAAI07C,UAAU,EAAG,WAEpEq5B,EAAsB,GAAG/lL,KAAK0iL,mBAAmB5xE,MAAM47C,UAAU,EAAG,WACpEm5B,EAAiB7lL,KAAKwjL,6BAA6BuC,GACnDD,EAAiB9lL,KAAKwjL,6BAA6BwC,KAEnDH,EAAiB7lL,KAAK4iL,YAAY5iL,KAAK0iL,mBAAmB5xE,OAC1Dg1E,EAAiB9lL,KAAK4iL,YAAY5iL,KAAK0iL,mBAAmB1xE,KAC1D+0E,EAAsBF,EAAepH,cACrCuH,EAAsBF,EAAerH,gBAIrCz+K,KAAK47K,cAAc9qE,QAAUi1E,GAC7B/lL,KAAK47K,cAAc5qE,MAAQg1E,KAE3BhmL,KAAKm/K,WAAa0G,EAClB7lL,KAAKq/K,SAAWyG,EAChB9lL,KAAKmjL,eAET,CAEAzD,oBAEI1/K,KAAK47K,cAAcj0J,QADa,IAA9B3nB,KAAK47K,cAAcj0J,OAKvB3nB,KAAKijL,wBACLjjL,KAAKmjL,cACP,4CAttBWpB,GAAsB3gL,MAAAuE,IAAA,+BAAtBo8K,EAAsBzzK,UAAA,0BAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,yXAFtB,CAAC4sK,MAAsBx/I,WAA2B96B,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,giDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID7D/D1N,MAAA,WAoBEA,MAnBA,EAAA6kL,GAAA,yBAmBA7kL,CAfC,EAAA8kL,GAAA,YAeD9kL,CAXiD,EAAA+kL,GAAA,aAgRnD/kL,eAvRKA,cAAA,aAAA2N,EAAA6sK,cAAAzpE,cAAA,KAAApjG,EAAA6sK,cAAAzpE,cAAAxhE,SAO4BvvC,cAAA,OAAA2N,EAAAiwK,YAWzB59K,cAAA,QAAA2N,EAAAiwK,4BCyBJ7vK,KACAwkF,MAAoB/tF,MACpB62B,KAAW52B,UACXk3K,GACA9yJ,MAAkBnkB,kBAClB+2B,MAAc92B,MACd62B,MAAmB52B,kBACnBuJ,KAAeoF,KACftF,KAAgBwF,KAChBrF,KAAasF,KACboV,MAAe4S,MAAAE,MACfO,KAAmB13B,KACnB4O,KACA0V,MACAxa,KAAiButB,MAAArtB,OAAA,mzDAIRkyK,CAAsB,kNCqB7B3gL,MAAA,mBAOEA,MAAA,GACFA,kCAHEA,MAFA,QAAAglL,EAAA1oG,MAEAt8E,CAFqB,KAAAglL,EAAAp3J,KAErB5tB,CADiB,aAAAglL,EAAA1oG,OAGjBt8E,cAAA,IAAAglL,EAAA1oG,MAAA,+CAGJt8E,MAAA,eAUEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAASkK,EAAA+6K,qBAAoB,GAE7BjlL,MAAA,cAAUA,MAAA,WACZA,mCAJEA,MAAA,YAAAkK,EAAAswK,cAAAj0J,kDAlDJvmB,MAAA,uBASEA,MADA,wBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,eAA+B,cAAa,EAC5CllL,CAD6C,wBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,oBACdtkL,EAAS,GAGxCZ,MAAA,4HAaEA,MAAA,iBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAi7K,iBAAA9uK,EAAAb,OAAAlQ,OAA2C,GAbtDtF,QAeAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAAk7K,YAAA/uK,EAAA+f,OAAAtlB,IAA6B,GAE/C9Q,MAAA,GAAAqlL,GAAA,uCASFrlL,QACAA,MAAA,GAAAslL,GAAA,iBAcFtlL,2CA7CEA,MAAA,aAAAkK,EAAA0tJ,YAIE53J,QAMAA,MANA,cAAAA,MAAA,wCAMAA,CAN8D,YAAAkK,EAAAswK,cAAAj0J,OAM9DvmB,CALkC,kBAAAulL,EAKlCvlL,CAJqC,QAAAA,MAAA,KAAAkK,EAAAs7K,gBAAAxlL,MAAA,KAAAkK,EAAAs7K,gBAAAlpG,MAAA,GAIrCt8E,CAHwE,aAAAA,MAAA,KAAAkK,EAAAs7K,gBAAAxlL,MAAA,KAAAkK,EAAAs7K,gBAAAlpG,MAAAt8E,MAAA,0CAepDA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAAkK,EAAAu7K,kBAUnBzlL,MAAA,GAAAA,MAAA,OAAAkK,EAAAswK,cAAA59F,cAAA,gBAAA1yE,EAAAg7K,gBAAAh7K,EAAAswK,cAAAj0J,mCAkCDvmB,MAAA,uCAOEA,MAAA,wBACFA,kCAHEA,MADA,QAAA0lL,EAAAvgL,IACAnF,CADsB,aAAAA,MAAA,iCAAA0lL,EAAAvgL,MAGtBnF,MAAA,GAAAA,MAAA,IAAAA,MAAA,yBAAA0lL,EAAAvgL,KAAA,gCAcFnF,MAAA,mBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAA2lL,EAAAvjL,MAEApC,cAAA,IAAAA,MAAA,+BAAA2lL,EAAAvjL,MAAA,+CATJpC,MAJF,sBAIEA,CADD,mBAIGA,MAAA,2BAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,QAAA,OAAAA,MAAmBkK,EAAA07K,sBAAAvvK,EAAA/Q,OAAmC,GAEtDtF,MAAA,EAAA6lL,GAAA,qBAOJ7lL,kCAXIA,QACAA,MADA,YAAAkK,EAAAswK,cAAAj0J,OACAvmB,CADkC,QAAAkK,EAAAswK,cAAAxpE,oBAKDhxG,cAAA,UAAAkK,EAAA47K,gDAsCjC9lL,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MADA,QAAA+lL,EACA/lL,CADe,aAAA+lL,GAGf/lL,cAAA,IAAA+lL,EAAA,+CAGJ/lL,MAAA,eAUEA,MAAA,mBAAAA,MAAAwrD,GAAA,MAAAthD,EAAAlK,MAAA,UAAAA,MAASkK,EAAA87K,gBAAe,GAExBhmL,MAAA,cAAUA,MAAA,WACZA,mCAJEA,MAAA,YAAAkK,EAAAswK,cAAAj0J,kDAhDJvmB,MAAA,uBAIEA,MADA,wBAAAA,MAAAurD,GAAA,MAAArhD,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,eAA+B,iBAAgB,EAC/CllL,CADgD,wBAAAA,MAAAurD,GAAA,MAAArhD,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,oBACjBtkL,EAAS,GAGxCZ,MAAA,mCAiBEA,MAAA,iBAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+7K,iBAAA5vK,EAAAb,OAAAlQ,OAA2C,GAjBtDtF,QAmBAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA2xK,eAAAxlK,EAAA+f,OAAA9wB,OAAmC,GAErDtF,MAAA,EAAAkmL,GAAA,sCAQFlmL,QACAA,MAAA,EAAAmmL,GAAA,iBAcFnmL,2CAhDEA,MAAA,aAAAkK,EAAA0tJ,YAIE53J,QAUAA,MAVA,cAAAA,MAAA,kCAUAA,CAVwD,YAAAkK,EAAAswK,cAAAj0J,OAUxDvmB,CATkC,kBAAAomL,EASlCpmL,CARsC,uBAAAkK,EAAAm8K,iBAAAn8K,EAAAswK,cAAA1qE,WAAA5lG,EAAAswK,cAAAlsE,QAQtCtuG,CAHC,4BAAAkK,EAAAm8K,iBAAAn8K,EAAAswK,cAAA1qE,YAAA,GAAA5lG,EAAAswK,cAAAlsE,SAAA,IAemBtuG,MAAA,GAAAA,MAAA,UAAAA,MAAA,KAAAkK,EAAAo8K,kBASnBtmL,MAAA,GAAAA,MAAA,OAAAkK,EAAAq8K,eAAA,mBAAAr8K,EAAAg7K,gBAAAh7K,EAAAswK,cAAAj0J,kDAgDHvmB,MAAA,eAUEA,MAAA,mBAAAA,MAAAkjK,GAAA,MAAAh5J,EAAAlK,MAAA,UAAAA,MAAAkK,EAAAswK,cAAAvpE,QAAiC,GAAE,GAEnCjxG,MAAA,cAAUA,MAAA,WACZA,mCAREA,MAAA,YAAAkK,EAAAswK,cAAAj0J,QAAA,eAAArc,EAAAg7K,gBAAAh7K,EAAAswK,cAAAj0J,kDAxBJvmB,MAAA,uBAOEA,MADA,wBAAAA,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,eAA+B,aAAY,EAC3CllL,CAD4C,wBAAAA,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,oBACbtkL,EAAS,GAGxCZ,MAAA,mCAOEA,MAAA,iBAAAqW,GAAArW,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MAASkK,EAAAs8K,WAAAnwK,EAAAb,OAAAlQ,OAAqC,GAPhDtF,QASAA,MAAA,EAAAymL,GAAA,iBAcFzmL,gCAzBEA,MAAA,aAAAkK,EAAA0tJ,YAIE53J,QAIAA,MAJA,cAAAA,MAAA,sCAIAA,CAJ4D,QAAAkK,EAAAswK,cAAAvpE,QAI5DjxG,CAH+B,aAAAkK,EAAAswK,cAAAvpE,QAAA/mG,EAAAswK,cAAAvpE,QAAA,IAO9BjxG,MAAA,GAAAA,MAAA,OAAAkK,EAAAswK,cAAAvpE,mDAqBHjxG,MAAA,oCAMEA,MAAA,mBAAAA,MAAA+wB,GAAA,MAAA7mB,EAAAlK,MAAA,UAAAA,MAASkK,EAAAw8K,0BAAyB,GAKlC1mL,MAAA,cAAUA,MAAA,kBACZA,mCAHEA,MARA,YAAAkK,EAAAswK,cAAAj0J,OAQAvmB,CARkC,YAAAkK,EAAAswK,cAAAj0J,OAQlCvmB,CAJkC,aAAAA,MAAA,wEAXtCA,MAAA,GAMEA,MAAA,EAAA2mL,GAAA,+CAEG3mL,cAAA,uBAAAkK,EAAAswK,cAAAxpE,+CA0CDhxG,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MADA,QAAA4mL,EACA5mL,CADe,aAAA4mL,GAGf5mL,cAAA,IAAA4mL,EAAA,+CAGJ5mL,MAAA,eAUEA,MAAA,mBAAAA,MAAA6mL,GAAA,MAAA38K,EAAAlK,MAAA,UAAAA,MAASkK,EAAA87K,cAAc,GAAE,GAEzBhmL,MAAA,cAAUA,MAAA,WACZA,mCAJEA,MAAA,YAAAkK,EAAAswK,cAAAj0J,kDA7CJvmB,MAAA,uBAOEA,MADA,wBAAAA,MAAAivB,GAAA,MAAA/kB,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,eAA+B,kBAAiB,EAChDllL,CADiD,wBAAAA,MAAAivB,GAAA,MAAA/kB,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,oBAClBtkL,EAAS,GAGxCZ,MAAA,mCAWEA,MAAA,iBAAAqW,GAAArW,MAAAivB,GAAA,MAAA/kB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+7K,iBAAA5vK,EAAAb,OAAAlQ,MAA4C,GAAE,GAXzDtF,QAaAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,MAAAivB,GAAA,MAAA/kB,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA48K,sBAAAzwK,EAAA+f,OAAA9wB,MAA2C,GAAE,GAE/DtF,MAAA,EAAA+mL,GAAA,sCAQF/mL,QACAA,MAAA,EAAAgnL,GAAA,iBAcFhnL,2CA1CEA,MAAA,aAAAkK,EAAA0tJ,YAIE53J,QAIAA,MAJA,cAAAA,MAAA,kCAIAA,CAJwD,YAAAkK,EAAAswK,cAAAj0J,OAIxDvmB,CAHkC,kBAAAinL,EAGlCjnL,CAF0C,0BAAAkK,EAAAm8K,eAAA,GAAAn8K,EAAAswK,cAAAxrE,cAAA9kG,EAAAswK,cAAA9qE,OActB1vG,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAAkK,EAAAo8K,kBASnBtmL,MAAA,GAAAA,MAAA,OAAAkK,EAAAq8K,YAAA,wBAAAr8K,EAAAg7K,gBAAAh7K,EAAAswK,cAAAj0J,mCA0CDvmB,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MADA,QAAAknL,EACAlnL,CADe,aAAAknL,GAGflnL,cAAA,IAAAknL,EAAA,+CAGJlnL,MAAA,eAUEA,MAAA,mBAAAA,MAAA8vB,GAAA,MAAA5lB,EAAAlK,MAAA,UAAAA,MAASkK,EAAA87K,cAAc,GAAE,GAEzBhmL,MAAA,cAAUA,MAAA,WACZA,mCAJEA,MAAA,YAAAkK,EAAAswK,cAAAj0J,kDA7CJvmB,MAAA,uBAOEA,MADA,wBAAAA,MAAAyvB,GAAA,MAAAvlB,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,eAA+B,kBAAiB,EAChDllL,CADiD,wBAAAA,MAAAyvB,GAAA,MAAAvlB,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAg7K,oBAClBtkL,EAAS,GAGxCZ,MAAA,mCAWEA,MAAA,iBAAAqW,GAAArW,MAAAyvB,GAAA,MAAAvlB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+7K,iBAAA5vK,EAAAb,OAAAlQ,MAA4C,GAAE,GAXzDtF,QAaAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,MAAAyvB,GAAA,MAAAvlB,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA48K,sBAAAzwK,EAAA+f,OAAA9wB,MAA2C,GAAE,GAE/DtF,MAAA,EAAAmnL,GAAA,sCAQFnnL,QACAA,MAAA,EAAAonL,GAAA,iBAcFpnL,2CA1CEA,MAAA,aAAAkK,EAAA0tJ,YAIE53J,QAIAA,MAJA,cAAAA,MAAA,kCAIAA,CAJwD,YAAAkK,EAAAswK,cAAAj0J,OAIxDvmB,CAHkC,kBAAAqnL,EAGlCrnL,CAF0C,0BAAAkK,EAAAm8K,eAAA,GAAAn8K,EAAAswK,cAAAtrE,cAAAhlG,EAAAswK,cAAA5qE,KActB5vG,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAAkK,EAAAo8K,kBASnBtmL,MAAA,GAAAA,MAAA,OAAAkK,EAAAq8K,YAAA,wBAAAr8K,EAAAg7K,gBAAAh7K,EAAAswK,cAAAj0J,kDAgBPvmB,MAAA,4BAIEA,MAAA,0BAAAqW,GAAArW,MAAAsnL,GAAA,MAAAp9K,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA2xK,eAAAxlK,EAAA/Q,MAAA+Q,EAAAmvE,KAAwC,GAE5DxlF,gCAHEA,MADA,aAAAkK,EAAA2qJ,WACA70J,CADyB,gBAAAkK,EAAAswK,gBCnVpB,IAAM+M,GAAsB,MAA7B,MAAOA,EAiESC,WAhEpBvG,kBAAoBv1E,KACpB46E,gBACAb,gBACOgC,sBACAC,oBAAsB,IAAI/mL,UAC/BC,GAEKklL,oBACAxgL,MAAQ,GACRqiL,cACAnC,eAAiB,IAAI7kL,UAC1BC,GAEKgnL,QAAU,IAAIjnL,KAA6C,IAC3DwJ,MAAQ,UACR4B,SACA87K,wBAA0B,IAAIlnL,MAAyB,GACvD45K,uBAAyB,IACzB2K,eAEE4C,eAEAjzB,WAEAx1I,IAEAm7J,cAET,QAAIpC,CAAK9yK,IAGa,YAENwD,KAAKxD,IAHG,iBAINwD,KAAKxD,IALA,2BAMNwD,KAAKxD,MAElB1G,KAAKmpL,MAAQziL,EACb1G,KAAK47K,cAAcvpE,QAAU3rG,EAEjC,CAEA,QAAI8yK,GACF,OAAOx5K,KAAKmpL,KACd,CAEQA,MAAQ,GAEPnwB,WAET,iBAAIowB,GACF,OAAOppL,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoBpqG,OAC3Dy8B,IAAmB,IAAbA,EAAExe,OAEb,CAEA,oBAAI+pF,GACF,OAAO,IAAIh5B,KAAkB84B,wBAC3BxxG,KAAKgpL,QAAQtiL,MACb1G,KAAK47K,cAAc59F,aACnBh+E,KAAKi2J,WAAWp2J,QAAQu4E,WAAW25B,qBAEvC,CAEAhyG,YAAoB6oL,GAAA5oL,KAAA4oL,aAKlB5oL,KAAK6oL,uBAAwB,IAAInwG,KAAkBu1B,UACnDjuG,KAAK8oL,oBAAoBnmL,KAAK3C,KAAK6oL,uBACnC7oL,KAAKknL,oBAAsB,CACzB,CACE1jL,KAAM,eAER,CACEA,KAAM,QAIZ,CAEA+J,WACE,GAAIvN,KAAKi2J,WAAWp2J,QAAQ+zE,aAAc,CACxC,MAAMy1G,EAAUrpL,KAAKi2J,WAAWp2J,QAAQ+zE,aAAalqE,OAClDkvE,QAC8B52E,IAA7B42E,EAAG0wG,wBAAwC1wG,EAAG0wG,uBAElDD,EAAQ5oK,IAAK8oK,IACPA,EAAI5tK,QACN4tK,EAAI5tK,OAAO6G,MAAI,GAGnBxiB,KAAKgpL,QAAQrmL,KAAK0mL,EACpB,CAEArpL,KAAKumL,mBACLvmL,KAAK4mL,eAAejkL,KAClB3C,KAAKgpL,QAAQtiL,MAAM0b,KAAM+jB,GAAMA,EAAEnX,OAAShvB,KAAK47K,cAAc59F,eAE/Dh+E,KAAKqnL,mBACLrnL,KAAK4mL,eAAe/jL,UAAWsjC,IAC7BnmC,KAAK8oL,oBAAoBnmL,KAAK3C,KAAK0xG,mBAI3B,IAFNlrG,OAAOC,KAAKzG,KAAK0xG,kBAAkBhpG,QACjC1I,KAAK47K,cAAc/kH,YAGrB72D,KAAK47K,cAAc/kH,SAAWrwD,OAAOC,KAAKzG,KAAK0xG,kBAAkB,GACjE1xG,KAAK47K,cAAc/kH,SAAWrwD,OAAOC,KAAKzG,KAAK0xG,kBAAkB,IAEnE1xG,KAAKqnL,kBAAgB,GAEvBrnL,KAAKwpL,wBACP,CAEAjD,iBAAiB7/K,GACf1G,KAAK6mL,gBACHngL,GAASA,EAAMkD,OAAS,KAAIhG,OAAG5D,KAAKypL,cAAc/iL,IAAU1G,KAAKgpL,QAC/DhpL,KAAKgpL,QAAQtiL,MAAM0b,KAAM+jB,GAAMA,EAAEnX,OAAStoB,IAC5C1G,KAAKwmL,YAAY9/K,EAErB,CAEA2gL,iBAAiB3gL,EAAgBkgF,GAC/B5mF,KAAK0nL,iBACqB,EACpB9jL,OADJ8C,GAASA,EAAMkD,OAAS,EACjB5J,KAAK0pL,cAAchjL,GACtB1G,KAAK4mL,eAAelgL,MACf1G,KAAK4mL,eAAelgL,MAAMiV,OAC1B,IACPjV,GAASA,EAAMkD,QAAU,GAC3B5J,KAAKi9K,eAAev2K,EAAOkgF,EAE/B,CAEQ6iG,cAAc/iL,GACpB,MAAMijL,EAAe,IAAI3/K,OACvBtD,EAAM+xB,UAAU,OAAOC,QAAQ,mBAAoB,IACnD,MAEF,OAAO14B,KAAKgpL,QAAQtiL,MAAMgD,OAAQkyI,GAChC+tC,EAAaz/K,KACX0xI,EAAIl+D,MAAMjlD,UAAU,OAAOC,QAAQ,mBAAoB,KAG7D,CAEQgxJ,cAAchjL,GACpB,MAAMijL,EAAe,IAAI3/K,OACvBtD,EACGgyB,QAAQ,sBAAuB,IAC/By/B,WACA1/B,UAAU,OACVC,QAAQ,mBAAoB,IAC/B,MAGF,OAAO14B,KAAK4mL,eAAelgL,OAAOiV,QAAQjS,OACvCkyI,GACCA,GACA+tC,EAAaz/K,KACX0xI,EACGzjF,WACA1/B,UAAU,OACVC,QAAQ,mBAAoB,KAGvC,CAEA2tJ,qBACErmL,KAAK47K,cAAc59F,aAAe,GAClCh+E,KAAK4mL,eAAejkL,UAAKX,GACzBhC,KAAKonL,eACP,CAEAO,YAAY/gG,GACV,MAAMgjG,EAAmB5pL,KAAKynL,eAAe7gG,GAC7C,GAAIgjG,EACF,OAAO5pL,KAAK47K,cAAcgO,EAE9B,CACAxC,cAAcxgG,GAEZ,MAAMgjG,EAAmB5pL,KAAKynL,eAAe7gG,GAC7C,GAAIgjG,EACF,OAAQ5pL,KAAK47K,cAAcgO,GAAoB,EAEnD,CAEAlK,kBAAkBh2J,GAChB1pB,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB1xF,KACpD+jB,GAAMA,EAAE+rE,WAAalyG,KAAK47K,cAAc1pE,UACzCvqF,OAAS+B,EAAMmE,QACjB7tB,KAAKkpL,gBACP,CAEAW,eACE,MAAMzxG,EAAgCp4E,KAAKi2J,WAAWp2J,QAAQu4E,WAC9DA,EAAW07B,oBAAsB17B,EAAW07B,oBAAoBpqG,OAC7Dy8B,GAAMA,EAAE+rE,WAAalyG,KAAK47K,cAAc1pE,UAE3ClyG,KAAKkpL,gBACP,CAEAY,cAAcx6E,GACZtvG,KAAK47K,cAAc3pE,cAAgB3C,EACnCtvG,KAAKkpL,gBACP,CAEAa,eAAelzH,GACb72D,KAAK47K,cAAc/kH,SAAWA,EAC9B72D,KAAKwpL,yBAGHxpL,KAAKipL,wBAAwBviL,OACc,IAA3C1G,KAAK47K,cAAclrE,aAAa9mG,OAEhC5J,KAAKgnL,sBAAsBhnL,KAAK47K,cAAcxpE,oBAE9CpyG,KAAKkpL,gBAET,CAEA1C,YAAYhnJ,GACVx/B,KAAK47K,cAAc59F,aAAex+C,EAClCx/B,KAAK4mL,eAAejkL,KAClB3C,KAAKgpL,QAAQtiL,MAAM0b,KAAM+jB,GAAMA,EAAEnX,OAAShvB,KAAK47K,cAAc59F,eAE/Dh+E,KAAKkpL,gBACP,CAIAc,oBAAoBp6E,GAClB5vG,KAAK47K,cAAchsE,UAAYA,EAAU/hF,QACzC7tB,KAAKkpL,gBACP,CAEAjM,eAAev2K,EAAYkgF,EAAc83F,GAAgB,GACvD,MAAMkL,EAAmB5pL,KAAKynL,eAAe7gG,GACzCgjG,IACF5pL,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB1xF,KACpD+jB,GAAMA,EAAE+rE,WAAalyG,KAAK47K,cAAc1pE,UACzC03E,GAAoBljL,EAElBg4K,GACF1+K,KAAKkpL,iBAGX,CAEAhB,sBAAsBxhL,EAAOkgF,GAC3B5mF,KAAKi9K,eAAe7+C,WAAW13H,GAAQkgF,EACzC,CAEAogG,sBAAsBtgL,GACpB1G,KAAK47K,cAAcxpE,mBAAqB1rG,EAE1B,gBAAVA,GACF1G,KAAK8nL,yBAAwB,GAE/B9nL,KAAKwpL,yBACLxpL,KAAKkpL,gBACP,CAEAtB,WAAWlhL,GACT1G,KAAKw5K,KAAO9yK,EACZ1G,KAAKiqL,oBACP,CAEAA,qBAEIjqL,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB1xF,KACpD+jB,GAAMA,EAAE+rE,WAAalyG,KAAK47K,cAAc1pE,YAMzClyG,KAAKw5K,MAAkD,SAA1Cx5K,KAAK47K,cAAcxpE,qBAClCpyG,KAAK47K,cAAclrE,aAAe1wG,KAAK4oL,WAAWrP,UAChDv5K,KAAKw5K,KACLx5K,KAAKygB,IAAIuhC,YACT8yG,SAEJ90J,KAAKkpL,iBACP,CAEApB,wBAAwBjkL,GAAmB,GAEvC7D,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB1xF,KACpD+jB,GAAMA,EAAE+rE,WAAalyG,KAAK47K,cAAc1pE,YAMC,gBAA1ClyG,KAAK47K,cAAcxpE,qBACrBpyG,KAAK47K,cAAclrE,aAAe1wG,KAAK4oL,WAAW9P,YAChD94K,KAAKygB,IAAIuhC,WACThiD,KAAKygB,IAAIyhC,eAAe2hC,YACxB7jF,KAAKygB,IAAIuhC,YACT8yG,SAEAjxJ,GACF7D,KAAKkpL,iBAET,CAEAzB,eAAe7gG,GACb,OAAQ5mF,KAAK47K,cAAc/kH,UACzB,KAAKi2C,KAAkBa,qBACvB,KAAKb,KAAkBK,kBACvB,KAAKL,KAAkBM,sBACvB,KAAKN,KAAkBO,+BACvB,KAAKP,KAAkBU,mBACvB,KAAKV,KAAkBW,4BACrB,MAAO,aACT,KAAKX,KAAkBY,eACrB,MAAO,UACT,KAAKZ,KAAkBE,kBACrB,OAAOpmB,GAAe,IAARA,EACV,gBACAA,GAAe,IAARA,EACL,qBACA5kF,EACR,KAAK8qG,KAAkBI,OACrB,OAAOtmB,GAAe,IAARA,EACV,QACAA,GAAe,IAARA,EACL,WACA5kF,EACR,QACE,OAEN,CAEQwnL,yBACN,IAAIU,GAAY,EACZlqL,KAAK47K,gBACPsO,GAK6C,IAJ3C,CACEp9E,KAAkBG,SAClBH,KAAkBQ,WAClBR,KAAkBc,QAClBllG,QAAQ1I,KAAK47K,cAAc/kH,WAEjC72D,KAAKipL,wBAAwBtmL,KAAKunL,EACpC,CAEAC,qBACE,OACEnqL,KAAK47K,cAAc/kH,SAAS1+B,gBAC5Bn4B,KAAKqiL,kBAAkBn1E,OAAO/0E,aAElC,4CArWWwwJ,GAAsBvnL,MAAAuE,IAAA,+BAAtBgjL,EAAsBr6K,UAAA,0BAAAC,OAAA,CAAA26K,eAAA,iBAAAjzB,WAAA,aAAAx1I,IAAA,MAAAm7J,cAAA,gBAAA5iB,WAAA,cAAAvqJ,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0rFAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDrDjC1N,MADF,UACEA,CADqC,yCAMnCA,MADA,iBAAAqW,GAAA,OAASA,EAAAgX,iBAAwB,EACjCrtB,CADkC,kBAAAqW,GAAA,OACxB1I,EAAA2wK,kBAAAjoK,EAAyB,GAGrCrW,QAYEA,MAVF,qBAUEA,CADD,uCAYGA,MAAA,2BAAAqW,GAAA,OAAmB1I,EAAA+6K,cAAAryK,EAAA/Q,MAA2B,GAE9CtF,MAAA,uCAMEA,MAAA,wBACFA,QACAA,MAAA,yCAMEA,MAAA,0BAGNA,YAEAA,MAAA,GAAAgpL,GAAA,kGAyDAhpL,MAAA,4DAOEA,MAAA,gEAUEA,MAAA,2BAAAqW,GAAA,OAAmB1I,EAAAg7K,eAAAtyK,EAAA/Q,MAA4B,GAE/CtF,MAAA,GAAAipL,GAAA,4DAUJjpL,UAEAA,MAAA,GAAAkpL,GAAA,2CAkBAlpL,MAAA,GAAAmpL,GAAA,0BAwDEnpL,MADF,YACEA,CADkC,sCAQhCA,MAAA,0BAAS2N,EAAA86K,cAAc,GAEvBzoL,MAAA,eAAUA,MAAA,aAEdA,YAEAA,MAAA,GAAAopL,GAAA,2CAmCAppL,MAAA,GAAAqpL,GAAA,yCAoBFrpL,QAEAA,MAAA,YAqDEA,MApDA,GAAAspL,GAAA,yBAoDAtpL,CA3CC,GAAAupL,GAAA,0BA8FHvpL,QAEAA,MAAA,GAAAwpL,GAAA,qCAnYIxpL,QAGAA,MAHA,aAAAA,MAAA,yCAGAA,CAH6D,UAAA2N,EAAA6sK,cAAAj0J,QAQ7DvmB,MAAA,GAAAA,MAAA,UAAAA,MAAA,GAAAoW,GAAA,IAAAzI,EAAAq6K,cAAA1gL,QAAAqG,EAAA6sK,iBAAA,IAAA7sK,EAAA6sK,cAAAj0J,OAAA,IAAA5Y,EAAAq6K,cAAA1gL,QAAAqG,EAAA6sK,iBAAA,IAAA7sK,EAAA6sK,cAAAj0J,SAUEvmB,QAIAA,MAJA,YAAA2N,EAAA6sK,cAAAj0J,OAIAvmB,CAJkC,QAAA2N,EAAA6sK,cAAA3pE,cAIlC7wG,CAHqC,aAAA2N,EAAA6sK,cAAA3pE,cAAA7wG,MAAA,kCAAA2N,EAAA6sK,cAAA3pE,eAAA,IAYnC7wG,MAAA,GAGAA,MAHA,QAAA2N,EAAAszK,kBAAAx0E,IAGAzsG,CAH+B,aAAAA,MAAA,uCAK/BA,MAAA,GAAAA,MAAA,IAAAA,MAAA,mCAGAA,MAAA,GAGAA,MAHA,QAAA2N,EAAAszK,kBAAAv0E,GAGA1sG,CAH8B,aAAAA,MAAA,uCAK9BA,MAAA,GAAAA,MAAA,IAAAA,MAAA,mCAOHA,MAAA,GAAAA,MAAA,YAAAA,MAAA,MAAA2N,EAAAk6K,0BAAA7nL,MAAA,MAAA2N,EAAAi6K,UAAA5nL,MAAA,MAAA2N,EAAAi6K,SAAAp/K,OAAA,QAAAxI,MAAA,MAAA2N,EAAAi6K,SAAA,GAAAh6J,MAwDD5tB,MAAA,GAIAA,MAJA,UAAAA,MAAA,GAAA+zC,IAAA,IAAA/zC,MAAA,MAAA2N,EAAAk6K,yBAAA7nL,MAAA,MAAA2N,EAAAk6K,0BAIA7nL,CADE,aAAA2N,EAAAiqJ,YAMA53J,MAAA,GAMAA,MANA,aAAA2N,EAAA6sK,cAAA/kH,SAAAz1D,MAAA,mCAAA2N,EAAA6sK,cAAA/kH,UAAAz1D,MAAA,uCAMAA,CAFC,YAAA2N,EAAA6sK,cAAAj0J,OAEDvmB,CADkC,QAAA2N,EAAA6sK,cAAA/kH,UAKXz1D,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAAA,MAAA,MAAA2N,EAAA+5K,uBAaxB1nL,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAk6K,0BAkBA7nL,MAAA,GAAAA,MAAA,YAAAA,MAAA,GAAAg0C,IAAA1sC,QAAAqG,EAAA04K,mBA2DCrmL,MAAA,GAAAA,MAAA,aAAAA,MAAA,sCAUDA,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAk6K,0BAAA,SAAAl6K,EAAA6sK,cAAAxpE,oBAkCAhxG,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAk6K,0BAAA,gBAAAl6K,EAAA6sK,cAAAxpE,oBAwBAhxG,MAAA,GAAAA,MAAA,QAAA2N,EAAAo7K,uBAAA,IAAA/oL,MAAA,GAAA+/B,IAAAz4B,QAAAqG,EAAA04K,eAAA,KAoDArmL,cAAA,QAAA2N,EAAAo7K,uBAAA,IAAA/oL,MAAA,GAAAypL,IAAAniL,QAAAqG,EAAA04K,eAAA,KAoDFrmL,cAAA,OAAA2N,EAAAo7K,sCCpWC16K,MAAiB7J,MACjByJ,KAAgBxJ,KAChBokB,MAAkBnkB,YAClBwJ,KACA4a,MAAenkB,MAAAC,MACfmkB,MACAhb,KACA0tB,MAAcloB,MACdgoB,MAAqB9nB,YACrBJ,KACAlF,KAAeuF,KACftF,KAAastB,KACbilJ,GACAryK,KACAsiD,KACAriD,KAAiBqtB,MAAAntB,OAAA,+8DAGR84K,CAAsB,qEC3C5B,IAAMmC,GAAU,MAAjB,MAAOA,EACSrpL,KAApB1B,YAAoB0B,GAAAzB,KAAAyB,MAAmB,CAEjCspL,oBAAoBC,GAAsB,IAAAv2F,EAAAz0F,KAAA,SAAA01F,MAAA,YAC9C,MAAMnzF,EAAMyoL,EAAWzoL,IACvB,IAAI8mC,EAEJ,aAAMorD,EAAKhzF,KACRvB,IAASqC,GACTwB,QACC0c,KAAKuxE,IACH3oD,EAAS2oD,EACFA,KACR,EACD9tF,MAAYC,MACHq/D,MAAWr/D,KAGrB+hJ,YAEI78G,CAAO,EAjBgC,EAkBhD,4CArBWyhJ,GAAU1pL,MAAAuE,MAAA,iCAAVmlL,EAAUzpL,QAAVypL,EAAUxpL,UAAAC,WAFT,gBAEDupL,CAAU,uHCKX1pL,MAAA,mBAGGA,MAAA,GACHA,kCAFEA,MAAA,QAAA6pL,GACC7pL,cAAA,GAAA6pL,EAAAr/K,MAAA,+CAVLxK,MAFJ,WAEIA,CAFkE,mBAElEA,CADc,wCAMZA,MAAA,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,GAAAA,aAAAkK,EAAA4/K,wBAAAzzK,KAAAnM,EAAA4/K,wBAAAzzK,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAA+pL,GAAA,qBAON/pL,qCAZMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCAGAA,MAAA,QAAAkK,EAAA4/K,yBAG4B9pL,MAAA,GAAAA,MAAA,UAAAkK,EAAA8/K,kEAkB9BhqL,MAAA,0BAQEA,MAAA,0BAAAiqL,EAAAjqL,MAAAkP,GAAAC,UAAA+6K,EAAAlqL,MAAA,GAAAmP,UAAAjF,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAme,kBAAA4hK,EAAAC,EAAAvyG,cAAuD,GAEhE33E,MAAA,GACHA,+CAFEA,MAPA,aAAAkK,EAAAigL,WAAAF,GAOAjqL,CAPwC,UAAAkK,EAAAkgL,eAAAH,GAOxCjqL,CAHyC,UAAAiqL,EAAA16I,QAGzCvvC,CAFiC,QAAAiqL,GAGhCjqL,cAAA,GAAAiqL,EAAAz/K,MAAA,gCArBPxK,MAAA,GAGEA,MAAA,QAAIA,MAAA,GAAkBA,QACtBA,MAAA,gCAOEA,MAAA,EAAAqqL,GAAA,4BAYFrqL,qDApBIA,MAAA,GAAAA,MAAAsqL,EAAA9/K,OAKFxK,cAAA,WAAAkK,EAAAqgL,iBAAAD,IAI4BtqL,cAAA,UAAAsqL,EAAAp9K,sCAlClClN,MAAA,YAIEA,MAAA,iBAkBAA,MAjBA,EAAAwqL,GAAA,aAiBAxqL,CAjBsE,EAAAyqL,GAAA,sBA0CxEzqL,+BA1C+BA,MAAA,GAAAA,MAAA,OAAAkK,EAAA8/K,uBAAAxhL,OAAA,GAkBRxI,cAAA,UAAAkK,EAAA4/K,wBAAAn4E,8CAqCf3xG,MAAA,mBAGGA,MAAA,GACHA,kCAFEA,MAAA,QAAA0qL,GACC1qL,cAAA,GAAA0qL,EAAAlgL,MAAA,+CAVLxK,MAFJ,WAEIA,CAFiE,mBAEjEA,CADc,wCAMZA,MAAA,uBAAAqW,GAAArW,MAAA8tB,GAAA,MAAA5jB,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAygL,uBAAAt0K,KAAAnM,EAAAygL,uBAAAt0K,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAA4qL,GAAA,qBAON5qL,qCAZMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCAGAA,MAAA,QAAAkK,EAAAygL,wBAG4B3qL,MAAA,GAAAA,MAAA,UAAAkK,EAAA2gL,iEAY9B7qL,MAAA,qBAOEA,MAAA,0BAAA8qL,EAAA9qL,MAAAsQ,GAAAnB,UAAA+6K,EAAAlqL,MAAA,GAAAmP,UAAAjF,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAme,kBAAAyiK,EAAAZ,EAAAvyG,cAAqD,GAE9D33E,MAAA,GACHA,+CAFEA,MANA,aAAAkK,EAAAigL,WAAAW,GAMA9qL,CANsC,UAAA8qL,EAAAv7I,QAMtCvvC,CAF+B,QAAA8qL,GAG9B9qL,cAAA,GAAA8qL,EAAAtgL,MAAA,+CASHxK,MAAA,UAGEA,MAAA,mBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,MAAA,UAAAA,MAASkK,EAAA6gL,mBAAmB,YAAW,GACtC/qL,MAAA,wBACHA,cADGA,cAAA,GAAAA,MAAA,wFAEHA,MAAA,UAGEA,MAAA,mBAAAA,MAAA8tD,GAAA,MAAA5jD,EAAAlK,MAAA,UAAAA,MAASkK,EAAAyzJ,mBAAmB,YAAW,GACtC39J,MAAA,wBACHA,cADGA,cAAA,GAAAA,MAAA,yEAhBLA,MAAA,OAYEA,MANA,EAAAgrL,GAAA,WAMAhrL,CAFG,EAAAirL,GAAA,YAQLjrL,mDAXKA,cAAA,OAAAkK,EAAAghL,cAAAC,EAAA,aAMAnrL,cAAA,OAAAkK,EAAA6zJ,cAAAotB,EAAA,wCA9BPnrL,MAAA,GAGEA,MAAA,QAAIA,MAAA,GAAkBA,QACtBA,MAAA,YACEA,MAAA,EAAAorL,GAAA,uBAWFprL,QACAA,MAAA,EAAAqrL,GAAA,wDAdIrrL,MAAA,GAAAA,MAAAmrL,EAAA3gL,OAGwBxK,MAAA,GAAAA,MAAA,UAAAmrL,EAAAj+K,WAYzBlN,cAAA,OAAAkK,EAAAghL,cAAAC,EAAA,aAAAjhL,EAAA6zJ,cAAAotB,EAAA,wCArCPnrL,MAAA,YACEA,MAAA,iBAkBAA,MAjBA,EAAAsrL,GAAA,aAiBAtrL,CAjBqE,EAAAurL,GAAA,sBAsDvEvrL,+BAtD+BA,MAAA,GAAAA,MAAA,OAAAkK,EAAA2gL,sBAAAriL,OAAA,GAkBRxI,cAAA,UAAAkK,EAAAygL,uBAAAh5E,8CAoDf3xG,MAAA,mBAGGA,MAAA,GACHA,kCAFEA,MAAA,QAAAwrL,GACCxrL,cAAA,GAAAwrL,EAAAhhL,MAAA,+CAVLxK,MAFJ,WAEIA,CAFmE,mBAEnEA,CADc,wCAMZA,MAAA,uBAAAqW,GAAArW,MAAA+wB,GAAA,MAAA7mB,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAuhL,yBAAAp1K,KAAAnM,EAAAuhL,yBAAAp1K,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAA0rL,GAAA,qBAON1rL,qCAZMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCAGAA,MAAA,QAAAkK,EAAAuhL,0BAG4BzrL,MAAA,GAAAA,MAAA,UAAAkK,EAAAyhL,mEAY9B3rL,MAAA,8CAMEA,MAAA,oBAAAA,MAAAmuD,GAAA,MAAAjkD,EAAAlK,MAAA,UAAAA,MAAUkK,EAAA0hL,oBAAmB,GAC5B5rL,MAAA,wBACHA,cANEA,MAAA,aAAAA,MAAA,oCAKCA,MAAA,GAAAA,MAAA,GAAAA,MAAA,kFAEHA,MAAA,yBAOEA,MAAA,0BAAA6rL,EAAA7rL,MAAA6mL,GAAA13K,UAAA+6K,EAAAlqL,MAAA,GAAAmP,UAAAjF,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAme,kBAAAwjK,EAAA3B,EAAAvyG,cAAwD,GAEjE33E,MAAA,GACHA,+CAFEA,MANA,aAAAkK,EAAAigL,WAAA0B,GAMA7rL,CANyC,UAAA6rL,EAAAt8I,QAMzCvvC,CAFkC,QAAA6rL,GAGjC7rL,cAAA,GAAA6rL,EAAArhL,MAAA,+CAODxK,MAAA,UAGEA,MAAA,mBAAAA,MAAAyvB,GAAA,MAAAvlB,EAAAlK,MAAA,UAAAA,MAASkK,EAAA6gL,mBAAmB,SAAQ,GACnC/qL,MAAA,wBACHA,cADGA,cAAA,GAAAA,MAAA,wFAEHA,MAAA,UAGEA,MAAA,mBAAAA,MAAA6vB,GAAA,MAAA3lB,EAAAlK,MAAA,UAAAA,MAASkK,EAAAyzJ,mBAAmB,SAAQ,GACnC39J,MAAA,wBACHA,cADGA,cAAA,GAAAA,MAAA,yEAfLA,MAAA,OAWEA,MANA,EAAA8rL,GAAA,WAMA9rL,CAFG,EAAA+rL,GAAA,YAQL/rL,mDAXKA,cAAA,OAAAkK,EAAAghL,cAAAc,EAAA,UAMAhsL,cAAA,OAAAkK,EAAA6zJ,cAAAiuB,EAAA,qCArCThsL,MAAA,GAGEA,MAAA,QAAIA,MAAA,GAAkBA,QACtBA,MAAA,wBAqBEA,MApBA,EAAAisL,GAAA,0BAoBAjsL,CAbG,EAAAksL,GAAA,0BAaHlsL,CAFG,EAAAmsL,GAAA,WAoBLnsL,qDAxCIA,MAAA,GAAAA,MAAAgsL,EAAAxhL,OAGCxK,MAAA,GAAAA,MAAA,OAAAgsL,EAAAI,YAS0BpsL,cAAA,UAAAgsL,EAAA9+K,WAW1BlN,cAAA,OAAAkK,EAAAghL,cAAAc,EAAA,UAAA9hL,EAAA6zJ,cAAAiuB,EAAA,qCAhDThsL,MAAA,YAIEA,MAAA,iBAkBAA,MAjBA,EAAAqsL,GAAA,aAiBArsL,CAjBuE,EAAAssL,GAAA,sBA8DzEtsL,+BA9D+BA,MAAA,GAAAA,MAAA,OAAAkK,EAAAyhL,wBAAAnjL,OAAA,GAkBRxI,cAAA,UAAAkK,EAAAuhL,yBAAA95E,8CAyDf3xG,MAAA,mBAGGA,MAAA,GACHA,kCAFEA,MAAA,QAAAusL,GACCvsL,cAAA,GAAAusL,EAAA/hL,MAAA,+CAVLxK,MAFJ,WAEIA,CAF6D,mBAE7DA,CADc,wCAMZA,MAAA,uBAAAqW,GAAArW,MAAAiwB,GAAA,MAAA/lB,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAsiL,mBAAAn2K,KAAAnM,EAAAsiL,mBAAAn2K,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAAysL,GAAA,qBAONzsL,qCAZMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCAGAA,MAAA,QAAAkK,EAAAsiL,oBAG4BxsL,MAAA,GAAAA,MAAA,UAAAkK,EAAAwiL,6DAU9B1sL,MAAA,wCAQEA,MAAA,mBAAAA,MAAA2sL,GAAA,MAAAziL,EAAAlK,MAAA,UAAAA,MAASkK,EAAA0iL,cAAa,GAEtB5sL,MAAA,cAAUA,MAAA,oBACZA,eAPEA,MAAA,aAAAA,MAAA,6EAmBMA,MAAA,qBAEEA,MAAA,yBAAAqW,GAAArW,MAAA6sL,GAAA,MAAA3iL,EAAAlK,MAAA,GAAAA,aAAAkK,EAAA4iL,kBAAAz2K,KAAAnM,EAAA4iL,kBAAAz2K,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,oBAAAA,MAAA6sL,GAAA,MAAA3iL,EAAAlK,MAAA,UAAAA,MAAUkK,EAAA6iL,qBAAoB,GAC7B/sL,MAAA,WACHA,iCAJEA,MAAA,UAAAkK,EAAA4iL,mBACA9sL,MAAA,iBAAAA,MAAA,EAAA+zC,+CAKJ/zC,MAAA,mBAMEA,MAAA,6BAAAqW,GAAArW,MAAAoxB,GAAA,MAAA47J,EAAAhtL,MAAA,GAAAmP,UAAAjF,EAAAlK,MAAA,UAAAA,MACuBkK,EAAA+iL,kBAAA52K,EAAAgM,OAAA/c,MAAA0nL,EAAA32K,GAEzC,GACmBrW,MAAA,GACHA,+CAFEA,MAPA,aAAAkK,EAAAigL,WAAA+C,GAOAltL,CAPoC,QAAAktL,GAQnCltL,cAAA,GAAAktL,EAAA1iL,MAAA,gCAnBHxK,MAPJ,QAOIA,CAPwC,oBAOxCA,CADD,YAEGA,MAAA,EAAAmtL,GAAA,uBAOFntL,QACAA,MAAA,EAAAotL,GAAA,qBAaJptL,0CA1BIA,QACAA,MADA,WAAAgtL,EAAA58J,SACApwB,CAD4B,cAAAgtL,EAAAxiL,OAMvBxK,MAAA,GAAAA,MAAA,OAAAgtL,EAAA58J,UAQmBpwB,cAAA,UAAAgtL,EAAA9/K,qDAexBlN,MAAA,mBAOEA,MAAA,6BAAAqW,GAAArW,MAAAqtL,GAAA,MAAAL,EAAAhtL,MAAA,GAAAmP,UAAAjF,EAAAlK,MAAA,UAAAA,MACuBkK,EAAA+iL,kBAAA52K,EAAAgM,OAAA/c,MAAA0nL,GAEzC,GAAmBhtL,MAAA,GACHA,+CALEA,MAJA,aAAAkK,EAAAigL,WAAAmD,GAIAttL,CAJoC,QAAAstL,GAQnCttL,cAAA,GAAAstL,EAAA9iL,MAAA,gCAXLxK,MAAA,mBACEA,MAAA,EAAAutL,GAAA,qBAYFvtL,wCAbYA,MAAA,cAAAgtL,EAAAxiL,OAEcxK,cAAA,UAAAgtL,EAAA9/K,sCAnDlClN,MAAA,GACEA,MAAA,QAAIA,MAAA,GAAkBA,QACtBA,MAAA,YACEA,MAAA,EAAAwtL,GAAA,qBAYAxtL,MAAA,oBAiCEA,MA9BA,EAAAytL,GAAA,aA8BAztL,CA9B4C,EAAA0tL,GAAA,yBAAA1tL,OA+ChDA,uDAhEIA,MAAA,GAAAA,MAAAgtL,EAAAxiL,OAGCxK,MAAA,GAAAA,MAAA,OAAAgtL,EAAAZ,aAAAY,EAAA58J,UAYDpwB,cAAA,QAAAgtL,EAAAlvJ,MAAAkvJ,EAAAlvJ,WAAAl9B,EAAA,KAEMZ,QAAuBA,MAAvB,OAAAgtL,EAAA58J,SAAuBpwB,CAAA,WAAA2tL,8BArCrC3tL,MAAA,YACEA,MAAA,iBAkBAA,MAjBA,EAAA4tL,GAAA,aAiBA5tL,CAjBiE,EAAA6tL,GAAA,sBAoFnE7tL,+BApF+BA,MAAA,GAAAA,MAAA,OAAAkK,EAAAwiL,kBAAAlkL,OAAA,GAiBIxI,cAAA,UAAAkK,EAAAsiL,mBAAA76E,8CAmF3B3xG,MAAA,mBAGGA,MAAA,GACHA,kCAFEA,MAAA,QAAA8tL,GACC9tL,cAAA,GAAA8tL,EAAAtjL,MAAA,+CAVLxK,MAFJ,WAEIA,CAFmE,mBAEnEA,CADc,wCAMZA,MAAA,uBAAAqW,GAAArW,MAAAqyB,GAAA,MAAAnoB,EAAAlK,MAAA,GAAAA,aAAAkK,EAAA6jL,yBAAA13K,KAAAnM,EAAA6jL,yBAAA13K,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,EAAAguL,GAAA,qBAONhuL,qCAZMA,MAAA,GAAAA,MAAA,aAAAA,MAAA,yCAGAA,MAAA,QAAAkK,EAAA6jL,0BAGgC/tL,MAAA,GAAAA,MAAA,UAAAkK,EAAA+jL,mEAYlCjuL,MAAA,wCAQEA,MAAA,mBAAAA,MAAAkuL,GAAA,MAAAhkL,EAAAlK,MAAA,UAAAA,MAASkK,EAAAikL,oBAAmB,GAE5BnuL,MAAA,cAAUA,MAAA,oBACZA,eAPEA,MAAA,aAAAA,MAAA,6EAmBEA,MAAA,iBAEEA,MAAA,2BAAAouL,EAAApuL,MAAAquL,GAAAl/K,UAAAjF,EAAAlK,MAAA,UAAAA,MAAWkK,EAAAokL,gBAAAF,GAAoC,GAE/CpuL,MAAA,GACAA,MAAA,oCAIEA,MAAA,cAAUA,MAAA,YAEdA,wCAPEA,cAAA,IAAAouL,EAAA,KAGEpuL,cAAA,aAAAA,MAAA,+DAZNA,MAAA,kBAKEA,MAAA,EAAAuuL,GAAA,mBAYFvuL,+BAXoCA,cAAA,UAAAkK,EAAAskL,gEA6BhCxuL,MARF,kBAQEA,CADD,YAEGA,MAAA,iBAAAqW,GAAA,MAAAo4K,EAAAzuL,MAAA0uL,GAAAv/K,UAAAjF,EAAAlK,MAAA,UAAAA,MACuBkK,EAAAykL,yBAAAt4K,EAAAo4K,EAAAnpL,OAEzC,GACkBtF,MAAA,qBAIEA,MAAA,iBAAAqW,GAAA,MAAAo4K,EAAAzuL,MAAA0uL,GAAAv/K,UAAAjF,EAAAlK,MAAA,UAAAA,MACyBkK,EAAAykL,yBAAAt4K,EAAAo4K,EAAAnpL,OAE7C,GACkBtF,QACAA,MAAA,GAEJA,iDAlBEA,MAAA,aAAAkK,EAAAigL,WAAAsE,IAUIzuL,MAAA,GAAAA,MAAA,UAAAkK,EAAA0kL,cAAAH,EAAAnpL,QAMFtF,cAAA,IAAAyuL,EAAAnpL,MAAA,+CAlDNtF,MALF,sBAKEA,CADD,eACYA,MAAA,GAAkBA,QAC7BA,MAAA,EAAA6uL,GAAA,sBAkBA7uL,MAAA,gBAMEA,MAAA,mBAAAA,MAAAyyB,GAAA,MAAAvoB,EAAAlK,MAAA,UAAAA,MAASkK,EAAA4kL,gBAAe,GAN1B9uL,QAQAA,MAAA,2BACEA,MAAA,EAAA+uL,GAAA,sCA0BJ/uL,wEAxDEA,MAAA,QAAAgvL,EAAAlxJ,MAAAkxJ,EAAAlxJ,WAAAl9B,EAAA,KAEWZ,MAAA,GAAAA,MAAAgvL,EAAAxkL,OAERxK,cAAA,OAAAkK,EAAA+kL,wBAAAD,EAAAl+K,MAAA,QAAAo+K,EAAAF,EAAAG,iBAAAvuL,IAAAsuL,OAsBDlvL,cAAA,kBAAAovL,GAGwCpvL,MAAA,GAAAA,MAAA,cAAAkK,EAAAinD,WAGGnxD,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAAkK,EAAA+kL,wBAAAD,EAAAl+K,iCApDnD9Q,MAAA,GAGEA,MAAA,QAAIA,MAAA,GAAkBA,QACtBA,MAAA,YAaEA,MAZA,EAAAqvL,GAAA,oBAYArvL,CAHC,EAAAsvL,GAAA,0BA+DHtvL,qDA1EIA,MAAA,GAAAA,MAAAgvL,EAAAxkL,OAGCxK,MAAA,GAAAA,MAAA,OAAAgvL,EAAA5C,YAYApsL,cAAA,OAAAkK,EAAA+kL,wBAAAD,EAAAl+K,gCAxCT9Q,MAAA,YAIEA,MAAA,iBAkBAA,MAjBA,EAAAuvL,GAAA,aAiBAvvL,CAjBuE,EAAAwvL,GAAA,sBAgGzExvL,+BAhG+BA,MAAA,GAAAA,MAAA,OAAAkK,EAAA+jL,wBAAAzlL,OAAA,GAkBRxI,cAAA,UAAAkK,EAAA6jL,yBAAAp8E,8CAhSzB3xG,MAAA,SAyQEA,MAxQA,EAAAyvL,GAAA,YAwQAzvL,CArQC,EAAA0vL,GAAA,YAqQD1vL,CAvNyE,EAAA2vL,GAAA,YAuNzE3vL,CA1JC,EAAA4vL,GAAA,aA0JD5vL,CAxFqE,EAAA6vL,GAAA,cA8LvE7vL,kCA5WKA,cAAA,sBAAAkqL,EAAAvyG,cA+C0B33E,cAAA,oBAAAkqL,EAAAvyG,cA4D1B33E,cAAA,uBAAAkqL,EAAAvyG,cAmEwB33E,cAAA,kBAAAkqL,EAAAvyG,cA0FxB33E,cAAA,wBAAAkqL,EAAAvyG,sCAyGL33E,MAAA,QACEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,oEAEFA,MAAA,QAAgCA,MAAA,GAAyBA,+BAAzBA,cAAAkK,EAAAswK,cAAAhwK,iDALlCxK,MAAA,SACEA,MAAA,iBAIAA,MAHA,EAAA8vL,GAAA,WAGA9vL,CAHiC,EAAA+vL,GAAA,YAIjC/vL,MAAA,4BAGEA,MAAA,0BAAAqW,GAAArW,MAAAgwL,GAAA,MAAA9lL,EAAAlK,QAAA,OAAAA,MAAkBkK,EAAA2xK,eAAAxlK,EAAA/Q,MAAA+Q,EAAAmvE,KAAwC,GAG9DxlF,kCAVOA,MAAA,GAAAA,MAAA,QAAAkK,EAAAswK,cAAAhwK,OAGAxK,cAAA,OAAAkK,EAAAswK,cAAAhwK,OAEHxK,QACAA,MADA,aAAAkK,EAAA2qJ,WACA70J,CADyB,gBAAAkK,EAAAswK,gBCxStB,IAAMyV,GAA2B,MAAlC,MAAOA,EAiLDC,iBACA97J,YACA+7J,WACA/oJ,cACAz2B,MApLcy/K,IAExBC,gBAESvI,eAEAjzB,WAEAx1I,IAEAixK,gBAAkB,EAClBC,kBAAoB,EACpBC,UAAY,EAErB,iBACIhW,GACF,OAAO57K,KAAK6xL,cACd,CACA,iBAAIjW,CAAcl1K,GAChB1G,KAAK6xL,eAAiBnrL,EAClB1G,KAAK6xL,gBAAgB1/E,gBACvBnyG,KAAK6xL,eAAe1/E,cAAcxhE,SAAU,EAEhD,CACQkhJ,eACAC,wBAA0B,IAAI92I,KAE/BqnI,kBAAoBv1E,KAEpB3sE,KACCs4C,gBACDltE,MAAQ,UACR2iL,mBAAoB,EACpB6D,eAAiB,IAAIhwL,UAAgBC,GACrCgwL,gBAAkB,IAAIjwL,KAAgB,IACtCkwL,sBAAwB,IAAIlwL,KAA0B,IACtDsuL,wBAAgE,GAEhE6B,oBAEP,uBAAIC,GACF,MAAMC,EAAc,GACpB,OAAIpyL,KAAKi2J,YAAYp2J,SAASu4E,YAAYU,aACxCs5G,EAAY9qL,KAAKtH,KAAKi2J,YAAYp2J,SAASu4E,YAAYU,aAErD94E,KAAKi2J,YAAYp2J,SAASu4E,YAAYY,YACxCo5G,EAAY9qL,KAAKtH,KAAKi2J,YAAYp2J,SAASu4E,YAAYY,YAErDh5E,KAAKi2J,YAAYp2J,SAASu4E,YAAYa,cACxCm5G,EAAY9qL,KAAKtH,KAAKi2J,YAAYp2J,SAASu4E,YAAYa,cAErDj5E,KAAKi2J,YAAYp2J,SAASu4E,YAAYnrD,QACxCmlK,EAAY9qL,KAAKtH,KAAKi2J,YAAYp2J,SAASu4E,YAAYnrD,QAErDjtB,KAAKi2J,YAAYp2J,SAASu4E,YAAY/3C,cACxC+xJ,EAAY9qL,KAAKtH,KAAKi2J,YAAYp2J,SAASu4E,YAAY/3C,cAEzD+xJ,EAAY5vK,KAAK,CAAC8/B,EAAGC,IACfD,EAAEgyG,MAAQ/xG,EAAE+xG,OACP,EAELhyG,EAAEgyG,MAAQ/xG,EAAE+xG,MACP,EAEF,GAEF89B,CACT,CAEA,2BAAIlH,GACF,OAAOlrL,KAAKmgC,KAAKjgC,IAAI,oBAAoBwG,KAC3C,CACA,2BAAIwkL,CAAwBxkL,GAC1B1G,KAAKmgC,KAAKkyJ,WAAW,CAAEC,iBAAkB5rL,GAC3C,CAEA,0BAAIqlL,GACF,OAAO/rL,KAAKmgC,KAAKjgC,IAAI,mBAAmBwG,KAC1C,CACA,0BAAIqlL,CAAuBrlL,GACzB1G,KAAKmgC,KAAKkyJ,WAAW,CAAEE,gBAAiB7rL,GAC1C,CAEA,4BAAImmL,GACF,OAAO7sL,KAAKmgC,KAAKjgC,IAAI,qBAAqBwG,KAC5C,CACA,4BAAImmL,CAAyBnmL,GAC3B1G,KAAKmgC,KAAKkyJ,WAAW,CAAEG,kBAAmB9rL,GAC5C,CAEA,sBAAIknL,GACF,OAAO5tL,KAAKmgC,KAAKjgC,IAAI,eAAewG,KACtC,CACA,sBAAIknL,CAAmBlnL,GACrB1G,KAAKmgC,KAAKkyJ,WAAW,CAAEI,YAAa/rL,IACpC1G,KAAK+R,MAAM4K,eACb,CAEA,4BAAIwyK,GACF,OAAOnvL,KAAKmgC,KAAKjgC,IAAI,qBAAqBwG,KAC5C,CACA,4BAAIyoL,CAAyBzoL,GAC3B1G,KAAKmgC,KAAKkyJ,WAAW,CAAEK,kBAAmBhsL,IAC1C1G,KAAK+R,MAAM4K,eACb,CAEA,iBAAIg2K,GACF,OAAO3yL,KAAK+xL,eAAerrL,KAC7B,CAEA,iBAAIisL,CAAcjsL,GAChB1G,KAAK+xL,eAAepvL,KAAK+D,GACzBu8B,aAAajjC,KAAKkyL,qBAClBlyL,KAAK4tL,mBAAmB76E,kBAAkBx4F,QAASq4K,IACjDA,EAAWtkL,WAAWiM,QAASy4F,IAExBA,EAASriE,QADdjqC,IAAUssG,CAEc,EACzB,GAGHhzG,KAAKkyL,oBAAsBvzJ,WAAW,KACpC3+B,KAAK6yL,cAAY,EAChB,IACL,CAEA,kBAAIC,GACF,OAAO9yL,KAAKgyL,gBAAgBtrL,KAC9B,CAEA,kBAAIosL,CAAepsL,GACjB1G,KAAKgyL,gBAAgBrvL,KAAK+D,GAC1Bu8B,aAAajjC,KAAKkyL,qBAClBlyL,KAAK4tL,mBAAmB76E,kBAAkBx4F,QAASq4K,IACjDA,EAAWtkL,WAAWiM,QAASy4F,IAExBA,EAASriE,UADdjqC,EAAMsxB,SAASg7E,EAES,EACzB,GAGHhzG,KAAKkyL,oBAAsBvzJ,WAAW,KACpC3+B,KAAK6yL,cAAY,EAChB,IACL,CAEA,wBAAIjD,GACF,OAAO5vL,KAAKiyL,sBAAsBvrL,KACpC,CAGA,wBAAIkpL,CAAqBmD,GACvB/yL,KAAKiyL,sBAAsBtvL,KAAKowL,GAChC9vJ,aAAajjC,KAAKkyL,qBAClBlyL,KAAKmvL,yBAAyBp8E,kBAAkBx4F,QAASq4K,IACvDA,EAAWtkL,WAAWiM,QAASy4F,IAC7BA,EAASriE,SAAU,EACnB,UAAWjnC,KAAUqpL,EACfrpL,IAAWspG,EAASpnG,QACtBonG,EAASriE,SAAU,IAGxB,GAGH3wC,KAAKkyL,oBAAsBvzJ,WAAW,KACpC3+B,KAAK6yL,cAAY,EAChB,IACL,CAGA7C,cAAcgD,GACZ,OAAOhzL,KAAK4vL,qBAAqB53J,SAASg7J,EAC5C,CAEAjzL,YACUuxL,EACA97J,EACA+7J,EACA/oJ,EACAz2B,GAJA/R,KAAAsxL,mBACAtxL,KAAAw1B,cACAx1B,KAAAuxL,aACAvxL,KAAAwoC,gBACAxoC,KAAA+R,QAER/R,KAAKy4E,gBAAkB,IAAIC,IAC3B14E,KAAK0pD,WACP,CAEQA,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjC63C,YAAa,CAAC,IACdG,aAAc,CAAC,IACfq5G,iBAAkB,CAAC,GAAI,CAACvtJ,KAAW/C,WACnCuwJ,gBAAiB,CAAC,GAAI,CAACxtJ,KAAW/C,WAClCwwJ,kBAAmB,CAAC,GAAI,CAACztJ,KAAW/C,WACpCywJ,YAAa,CAAC,GAAI,CAAC1tJ,KAAW/C,WAC9B/U,OAAQ,CAAC,IACTgmK,YAAa,CAAC,IACdP,kBAAmB,CAAC,GAAI,CAAC3tJ,KAAW/C,WACpC3B,aAAc,CAAC,KAEnB,CAEA+qJ,uBACE,GAAIprL,KAAKi2J,YAAYp2J,SAASu4E,YAAYU,YACxC,OAAO94E,KAAKi2J,WAAWp2J,QAAQu4E,WAAWU,YAAY93C,MAE1D,CAEAirJ,sBACE,GAAIjsL,KAAKi2J,YAAYp2J,SAASu4E,YAAYY,WACxC,OAAOh5E,KAAKi2J,WAAWp2J,QAAQu4E,WAAWY,WAAWh4C,MAEzD,CAEA+rJ,wBACE,GAAI/sL,KAAKi2J,YAAYp2J,SAASu4E,YAAYa,aACxC,OAAOj5E,KAAKi2J,WAAWp2J,QAAQu4E,WAAWa,aAAaj4C,MAE3D,CAEA8sJ,kBACE,GAAI9tL,KAAKi2J,YAAYp2J,SAASu4E,YAAYnrD,OACxC,OAAOjtB,KAAKi2J,WAAWp2J,QAAQu4E,WAAWnrD,OAAO+T,MAErD,CAEAquJ,wBACE,GAAIrvL,KAAKi2J,YAAYp2J,SAASu4E,YAAY/3C,aACxC,OAAOrgC,KAAKi2J,WAAWp2J,QAAQu4E,WAAW/3C,aAAaW,MAE3D,CAEMzzB,WAAQ,IAAAknF,EAAAz0F,KAAA,SAAA01F,MAAA,YACRjB,EAAKwhE,WAAWp2J,QAAQu4E,aACtBqc,EAAKwhE,WAAWp2J,QAAQu4E,WAAWU,cACrC2b,EAAKy2F,wBACHz2F,EAAKwhE,WAAWp2J,QAAQu4E,WAAWU,YAAY93C,OAAO5e,KACnD6e,GAAUA,EAAM0P,UACd8jD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWU,YAAY93C,OAAO,IAE3DyzD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWY,aACrCyb,EAAKs3F,uBACHt3F,EAAKwhE,WAAWp2J,QAAQu4E,WAAWY,WAAWh4C,OAAO5e,KAClD6e,GAAUA,EAAM0P,UACd8jD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWY,WAAWh4C,OAAO,IAE1DyzD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWa,eACrCwb,EAAKo4F,yBACHp4F,EAAKwhE,WAAWp2J,QAAQu4E,WAAWa,aAAaj4C,OAAO5e,KACpD6e,GAAUA,EAAM0P,UACd8jD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWa,aAAaj4C,OAAO,IAE5DyzD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWnrD,SACrCwnE,EAAKm5F,mBACHn5F,EAAKwhE,WAAWp2J,QAAQu4E,WAAWnrD,OAAO+T,OAAO5e,KAC9C6e,GAAUA,EAAM0P,UACd8jD,EAAKwhE,WAAWp2J,QAAQu4E,WAAWnrD,OAAO+T,OAAO,GACxDyzD,EAAKy+F,0BACCz+F,EAAK0+F,sBAET1+F,EAAKwhE,WAAWp2J,QAAQu4E,WAAW/3C,eACrCo0D,EAAK06F,yBACH16F,EAAKwhE,WAAWp2J,QAAQu4E,WAAW/3C,aAAaW,OAAO5e,KACpD6e,GAAUA,EAAM0P,UACd8jD,EAAKwhE,WAAWp2J,QAAQu4E,WAAW/3C,aAAaW,OAAO,GAC9DyzD,EAAK2+F,iCACC3+F,EAAK4+F,4BAEb5+F,EAAKo+F,gBAGPp+F,EAAKt0D,KACFjgC,IAAI,oBACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAK6+F,2BACL7+F,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,mBACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAK8+F,0BACL9+F,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,qBACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAK++F,4BACL/+F,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,eACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAKg/F,sBACLh/F,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,qBACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAKi/F,4BACLj/F,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,eACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAKo+F,cAAY,GAErBp+F,EAAKt0D,KACFjgC,IAAI,gBACJq4B,aAAax0B,QAAKof,MAAa,MAC/BtgB,UAAU,KACT4xF,EAAKo+F,cAAY,GAIrBp+F,EAAKq9F,wBAAwB/tL,OAAOlB,UAAU,KAC5C4xF,EAAK4+F,0BAAwB,EAC5B,EA1FS,EA2Fd,CAEQH,oBACN,MAAMl/E,EAAW,GACjB,IAAIrjE,EACJ3wC,KAAK4tL,mBAAmB76E,kBAAkBx4F,QAASq4K,IAC7CA,EAAWphK,UACbohK,EAAWtkL,WAAWiM,QAASy4F,IACzBA,EAASriE,SACXqjE,EAAS1sG,KAAK0rG,EAAQ,GAG1BhzG,KAAK8yL,eAAiB9+E,EACtBh0G,KAAKmgC,KAAK7I,SAAS27J,YAAe17J,SAASy8E,KAE3C4+E,EAAWtkL,WAAWiM,QAASy4F,IACzBA,EAASriE,UACXA,EAAUqiE,KAGdhzG,KAAKmgC,KAAK7I,SAASrK,OAAUiU,MAAMyP,GACnC3wC,KAAK+xL,eAAelvL,UAAW6D,IACzB1G,KAAKmgC,KAAK7I,SAASrK,OAAUvmB,QAAUA,GACzC1G,KAAKmgC,KAAK7I,SAASrK,OAAUsK,SAAS7wB,EAAK,GAG/C1G,KAAK2yL,cAAgBhiJ,IAG3B,CAEQyiJ,2BACN,IAAIziJ,EAAU,GACd3wC,KAAKmvL,yBAAyBp8E,kBAAkBx4F,QAASq4K,IACvDA,EAAWtkL,WAAWiM,QAASy4F,IAC7B,GAAIA,EAASriE,QAAS,CACpB,MAAMgjJ,EAAM,CACVzhL,GAAI8gG,EAAS3vF,QAAQ6tF,WACrBxqG,MAAOssG,EAASpnG,OAElB+kC,EAAQrpC,KAAK0rG,EAASpnG,OACtB5L,KAAKmgC,KAAK7I,SAAS+I,aAAgB9I,SAASo8J,EAC9C,IAEF3zL,KAAK4vL,qBAAuBj/I,GAEhC,CAEA46I,WAAWv4E,GACT,IAAI4gF,EACJ,OAAI5gF,EAASnlG,UAET+lL,EADEr4K,MAAMC,QAAQw3F,EAASnlG,SACfmlG,EAASnlG,QAAQhE,KAAK,MAEtBmpG,EAASnlG,SAGhB+lL,GAAW,EACpB,CAEMT,qBAAkB,IAAA18F,EAAAz2F,KAAA,SAAA01F,MAAA,YACtB,UAAWwd,KAAUzc,EAAKw/D,WAAWp2J,QAAQu4E,WAAWnrD,OAAOgmF,QAC7D,GAAIC,EAAO2gF,aAAc,CACvB,IAAIC,EACJ,UAAWC,KAAe7gF,EAAO2gF,aAAc,CAC7C,IAAIG,EACJ,UAAWhJ,KAAcv0F,EAAKjuD,cAAcpoC,UAC1C,QAGE2zL,EAAY7hL,KAAO84K,EAAW94K,IAC9B6hL,EAAY/kK,OAASg8J,EAAWh8J,QAEhCglK,EAAY,CACV9hL,GAAI84K,EAAW94K,GACf3P,IAAKyoL,EAAWzoL,IAChBysB,KAAMg8J,EAAWh8J,KACjBrT,OAAQqvK,EAAWrvK,SAUzB,GALKm4K,EADLE,EAAUzxL,UACck0F,EAAK86F,WAAWxG,oBAClCiJ,GAEWA,EAAUr4K,OAEvBm4K,EAAW,CACb,IAEI9gF,GAFAihF,EAAY/gF,EAChB+gF,EAAU3lL,UAAY,GAEtB,UAAW5H,MAASotL,EAAW,CAC7B,GAAI5gF,EAAO1hF,SAAU,CACnB,IAAImf,GAECA,KADL8lD,EAAKq8F,gBAAgB1wK,KAAMovK,IAAQA,GAAI5lL,QAAUlF,GAAMA,OAGvDssG,GAAW,CACTpnG,MAAOlF,GAAMA,MACbiqC,WACAttB,QAAS,CACPwzC,SAAUk9H,EAAYl9H,SACtBmnB,aAAc+1G,EAAY/1G,aAC1BkzB,WAAYxqG,GAAMwL,IAGxB,MACE8gG,GAAW,CACTpnG,MAAOlF,GAAMA,MACbiqC,QACE8lD,EAAKk8F,eAAe/mL,QAAUlF,GAAMA,MACtC2c,QAAS,CACPwzC,SAAUk9H,EAAYl9H,SACtBmnB,aAAc+1G,EAAY/1G,aAC1BkzB,WAAYxqG,GAAMwL,KAIxB+hL,EAAU3lL,UAAUhH,KAAK0rG,GAC3B,CACAvc,EAAKq3F,kBACF1rK,KAAM6e,IAAUA,GAAMw/B,IAAIzoC,SAASi8J,EAAU/hL,KAC7C6gG,kBAAkB3wF,KAChB8xK,IAASA,GAAKtoL,QAAUqoL,EAAUroL,OACnC0C,UAAY2lL,EAAU3lL,SAC5B,CACF,CACAmoF,EAAKy8F,mBACP,CACD,EArEqB,EAsExB,CAGAhD,gBACElwL,KAAK8xL,wBAAwBnvL,MAC/B,CAEM0wL,2BAAwB,IAAAh8F,EAAAr3F,KAAA,SAAA01F,MAAA,YAC5B,UAAWwd,KAAU7b,EAAK4+D,WAAWp2J,QAAQu4E,WAAW/3C,aACrD4yE,QACD,GAAIC,EAAO2gF,aAAc,CACvB,IAAIC,EACJ,UAAWC,KAAe7gF,EAAO2gF,aAAc,CAC7C,IAAIG,EACJ,UAAWG,KAAa98F,EAAK7uD,cAAcpoC,UACzC,QAGE2zL,EAAY7hL,KAAOiiL,EAAUjiL,IAC7B6hL,EAAY/kK,OAASmlK,EAAUnlK,QAE/BglK,EAAY,CACV9hL,GAAIiiL,EAAUjiL,GACd3P,IAAK4xL,EAAU5xL,IACfysB,KAAMmlK,EAAUnlK,KAChBrT,OAAQw4K,EAAUx4K,SAUxB,GALKm4K,EADLE,EAAUzxL,UACc80F,EAAKk6F,WAAWxG,oBAClCiJ,GAEWA,EAAUr4K,OAEvBm4K,EAAW,CACb,IAEI9gF,GAFAihF,EAA+B/gF,EACnC+gF,EAAU3lL,UAAY,GAEtB,UAAW8lL,MAAYN,EACrB9gF,GAAW,CACTpnG,MAAOwoL,GAASliL,GAChBy+B,UAAS0mD,EAAKu4F,sBAAsB53J,SAASo8J,GAAS1tL,OAGtD2c,QAAS,CACPwzC,SAAUk9H,EAAYl9H,SACtBmnB,aAAc+1G,EAAY/1G,aAC1BkzB,WAAYkjF,GAAS1tL,QAGzButL,EAAU3lL,UAAUhH,KAAK0rG,IAE3B3b,EAAKg4F,wBACFjtK,KAAM6e,IAAyBA,GAAMw/B,IAAIzoC,SAASi8J,EAAU/hL,KAC5D6gG,kBAAkB3wF,KAChBiyK,IAAqBA,GAAiBzoL,QAAUqoL,EAAUroL,OAC3D0C,UAAY2lL,EAAU3lL,SAC5B,CACF,CAEA+oF,EAAKg5F,wBAAwBn9E,EAAOhhG,IAAM,IAAI0I,KAC9Cy8E,EAAKtlF,MAAM4K,gBACX06E,EAAKg5F,wBAAwBn9E,EAAOhhG,KAAE,EAAItO,OAAGkwL,EAC/C,CACD,EA1D2B,EA2D9B,CAkBAtI,eAAe8I,GACb,IAAIzkL,EACJ,OAAIykL,EAAW/oL,OAAS+oL,EAAW3jJ,UACjC9gC,EAAS,CACP,mBAAoB,QAAQykL,EAAW/oL,WAGpCsE,CACT,CAEA87K,iBAAiBz4E,GACf,QAAOA,EAAOqhF,UAAWrhF,EAAOqhF,QAClC,CAEQjB,2BACNtzL,KAAKorL,uBAAuB3qK,IAAKwgB,GAAWA,EAAM0P,SAAU,GAC5D3wC,KAAKorL,uBAAuBhpK,KACzB6e,GAAUA,IAAUjhC,KAAKkrL,yBAC1Bv6I,SAAU,CACd,CAEQ4iJ,0BACNvzL,KAAKisL,sBAAsBxrK,IAAKwgB,GAAWA,EAAM0P,SAAU,GAC3D3wC,KAAKisL,sBAAsB7pK,KACxB6e,GAAUA,IAAUjhC,KAAK+rL,wBAC1Bp7I,SAAU,CACd,CAEQ6iJ,4BACNxzL,KAAK+sL,wBAAwBtsK,IAAKwgB,GAAWA,EAAM0P,SAAU,GAC7D3wC,KAAK+sL,wBAAwB3qK,KAC1B6e,GAAUA,IAAUjhC,KAAK6sL,0BAC1Bl8I,SAAU,CACd,CAEQ8iJ,sBACNzzL,KAAK8tL,kBAAkBrtK,IAAKwgB,GAAWA,EAAM0P,SAAU,GACvD3wC,KAAK8tL,kBAAkB1rK,KACpB6e,GAAUA,IAAUjhC,KAAK4tL,oBAC1Bj9I,SAAU,CACd,CAEQ+iJ,4BACN1zL,KAAKqvL,wBAAwB5uK,IAAKwgB,GAAWA,EAAM0P,SAAU,GAC7D3wC,KAAKqvL,wBAAwBjtK,KAC1B6e,GAAUA,IAAUjhC,KAAKmvL,0BAC1Bx+I,SAAU,CACd,CAEAlnB,kBAAkB+qK,EAAsBz7G,GACtC91C,aAAajjC,KAAKkyL,qBACG,gBAAjBn5G,GACF/4E,KAAKgtL,oBAGHwH,IACFA,EAAoB7jJ,SAAW6jJ,EAAoB7jJ,SAErD3wC,KAAKkyL,oBAAsBvzJ,WAAW,KACpC3+B,KAAK6yL,cAAY,EAChB,IACL,CAEA7F,oBACEhtL,KAAK6sL,yBAAyB95E,kBAAkBx4F,QAASq4K,IACvDA,EAAWtkL,UAAUmS,IAAKuyF,GAAcA,EAASriE,SAAU,GAE3D3wC,KAAKkyL,oBAAsBvzJ,WAAW,KACpC3+B,KAAK6yL,cAAY,EAChB,IAAG,EAEV,CAEA7E,cACEhuL,KAAK2yL,mBAAgB3wL,CACvB,CAEAutL,oBACEvvL,KAAK4vL,qBAAuB,GAC5B5vL,KAAKmgC,KAAK7I,SAAS+I,aAAgB9I,SAAS,IAC5Cv3B,KAAKmgC,KAAK7I,SAAS+I,aAAgBo0J,iBACrC,CAEAtG,qBACE,GAAInuL,KAAKkuL,kBAAmB,CAC1B,MAAMl6E,EAAW,GACjBh0G,KAAK4tL,mBAAmB76E,kBAAkBx4F,QAASq4K,IACjDA,EAAWtkL,WAAWiM,QAASy4F,IAC7BgB,EAAS1sG,KAAK0rG,EAAQ,EACvB,GAEHhzG,KAAKwxL,IAAI3xL,QAAQ0a,QAASsd,GAAoBA,EAAK5K,UACnDjtB,KAAK8yL,eAAiB9+E,CACxB,MACEh0G,KAAKwxL,IAAI3xL,QAAQ0a,QAASsd,GAAoBA,EAAK68J,YACnD10L,KAAK8yL,eAAiB,EAE1B,CAEAzE,kBAAkB3nL,EAAOwsG,EAAQxpF,GAC/B,GAAIwpF,EAAO1hF,SAAU,CACnB,MAAMwiF,EAAWh0G,KAAK8yL,eACtB,IAAI6B,GAAY,EAOhB,GANA30L,KAAKwxL,IAAI3xL,QAAQ0a,QAASsd,IACnBA,EAAKrP,WACRmsK,GAAY,KAGhB30L,KAAKkuL,kBAAoByG,EACrBjrK,EAAMkrK,YACR,GAAI5gF,EAASpqG,QACX,UAAW+mC,KAAWqjE,EACpB,GAAIrjE,EAAQ/kC,QAAUlF,EAAMkF,OAC1B,GAAI+kC,EAAQA,SAAWjqC,EAAMiqC,QAAS,CACpCqjE,EAASnuF,OAAOmuF,EAAStrG,QAAQioC,GAAU,GAC3C3wC,KAAK8yL,eAAiB9+E,EACtB,KACF,UACSA,EAAStrG,QAAQioC,KAAaqjE,EAASpqG,OAAS,EAAG,CAC5DoqG,EAAS1sG,KAAKZ,GACd1G,KAAK8yL,eAAiB9+E,EACtB,KACF,OAGFA,EAAS1sG,KAAKZ,GACd1G,KAAK8yL,eAAiB9+E,CAG5B,MACEh0G,KAAK2yL,cAAgBjsL,CAEzB,CAEAqpL,yBAAyBrmK,EAAcmrK,GACrCnrK,EAAM+E,kBACNzuB,KAAK0vL,gBAAgBmF,EACvB,CAEAnF,gBAAgBmF,GAEZ70L,KAAK4vL,qBADH5vL,KAAK4vL,qBAAqB53J,SAAS68J,GACT70L,KAAK4vL,qBAAqBlmL,OACnDorL,GAAkBA,IAAkBD,GAGX,IAAI70L,KAAK4vL,qBAAsBiF,EAE/D,CAGAtiI,YACE,MAAO,EACT,CAGQsgI,eACN,IAAIjyG,EAAoB,GACxB,MAAMt0C,EAAa,GACbyoJ,EAAgB,CACpB/0L,KAAKkrL,wBACLlrL,KAAK+rL,uBACL/rL,KAAK6sL,yBACL7sL,KAAK4tL,mBACL5tL,KAAKmvL,0BAEP,UAAW6F,KAAgBD,EACrBC,EAAajiF,mBACfiiF,EAAajiF,kBAAkBtyF,IAAKyzF,IAClC,MAAMC,EAAkB,GACxBD,EAAe5lG,WACX5E,OAAQ0oL,KAAwC,IAAxBA,GAAYzhJ,SACrCp2B,QAAS+5F,IACRH,EAAgB7sG,KAAKgtG,GAAgBjxF,UAErC8wF,EAAgBvqG,QAAU,GAE1B0iC,EAAWhlC,KADkB,IAA3B6sG,EAAgBvqG,OACFuqG,EAAgB,GAEhB,CACd7E,QAAS4E,EAAe5E,QACxBjsF,QAAS8wF,GACV,GAMPn0G,KAAKmqL,sBAAwBnqL,KAAK6xL,eAAelqK,QACnD2kB,EAAWhlC,KACTtH,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB,IAGvDxnE,EAAW1iC,QAAU,IACvBg3E,EAAoB5gF,KAAKy4E,gBAAgByJ,YACjB,IAAtB51C,EAAW1iC,OACP0iC,EAAW,GACV,CAAEgjE,QAAS,MAAOjsF,QAASipB,KAGC,QAAjCtsC,KAAKi2J,WAAWp2J,QAAQ2D,MAC1BxD,KAAKsxL,iBAAiBhf,YACpBtyK,KAAKi2J,WACLr1E,GAGiC,QAAjC5gF,KAAKi2J,WAAWp2J,QAAQ2D,MAE1BxD,KAAKi2J,WAAW50G,GAAGx9C,UAErB7D,KAAKi2J,WAAW/8E,cAAcl5E,KAAKi2J,WAAWp2J,QAAQu4E,YAAY,EACpE,CAEA+mF,cAAcjsD,EAAQ1vG,GACpB,IAAIyxL,EAAkB,EACtB,UAAW3mL,KAAa4kG,EAAO5kG,UAC7B2mL,IAIF,OAAOA,GADI,UAATzxL,EAAmBxD,KAAK2xL,kBAAoB3xL,KAAK0xL,gBAErD,CAEA3yB,mBAAmBv7J,GACR,UAATA,EACKxD,KAAK2xL,mBAAqB,EAC1B3xL,KAAK0xL,iBAAmB,CAE/B,CAEApF,cAAcp5E,EAAQ1vG,GACpB,IAAIyxL,EAAkB,EACtB,UAAW3mL,KAAa4kG,EAAO5kG,UAC7B2mL,IAIF,OAAOj1L,KAAK4xL,aADD,UAATpuL,EAAmBxD,KAAK2xL,kBAAoB3xL,KAAK0xL,kBAChBuD,EAAkBj1L,KAAK4xL,SAC5D,CAEAzF,mBAAmB3oL,GACR,UAATA,EACKxD,KAAK2xL,kBAAoB3xL,KAAK4xL,UAC9B5xL,KAAK0xL,gBAAkB1xL,KAAK4xL,SAEnC,CAEAzH,qBACE,OACEnqL,KAAK47K,eAAe/kH,UAAU1+B,gBAC9Bn4B,KAAKqiL,kBAAkBn1E,OAAO/0E,aAElC,CAEA8kJ,eAAev2K,EAAYkgF,EAAc83F,GAAgB,GACvD,MAAMkL,EAAmB5pL,KAAKynL,eAAe7gG,GACzCgjG,IACF5pL,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB1xF,KACpD1Y,GAAWA,EAAOwoG,WAAalyG,KAAK47K,cAAc1pE,UACnD03E,GAAoBljL,EAElBg4K,GACF1+K,KAAK6yL,eAGX,CAEApL,eAAe7gG,GACb,OAAQ5mF,KAAK47K,cAAc/kH,UACzB,KAAKi2C,KAAkBa,qBACvB,KAAKb,KAAkBK,kBACvB,KAAKL,KAAkBM,sBACvB,KAAKN,KAAkBO,+BACvB,KAAKP,KAAkBU,mBACvB,KAAKV,KAAkBW,4BACrB,MAAO,aACT,KAAKX,KAAkBY,eACrB,MAAO,UACT,KAAKZ,KAAkBE,kBACrB,OAAOpmB,GAAe,IAARA,EACV,gBACAA,GAAe,IAARA,EACL,qBACA5kF,EACR,KAAK8qG,KAAkBI,OACrB,OAAOtmB,GAAe,IAARA,EACV,QACAA,GAAe,IAARA,EACL,WACA5kF,EACR,QACE,OAEN,4CA7zBWqvL,GAA2BjwL,MAAAuE,GAAAvE,MAAAwE,MAAAxE,MAAAyE,IAAAzE,MAAA0E,MAAA1E,aAAA,+BAA3BiwL,EAA2B/iL,UAAA,+BAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,sBAE3BomL,MAAsB,EAAUA,0UA3BhC,CAACpK,KAAW1pL,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kqHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDzDzB1N,MAAA,YACEA,MAAA,EAAA+zL,GAAA,aAgXF/zL,QAEAA,MAAA,EAAAg0L,GAAA,oBAnXMh0L,MAAA,YAAA2N,EAAAoxB,MACsB/+B,cAAA,UAAA2N,EAAAojL,qBAkXtB/wL,cAAA,OAAA2N,EAAAo7K,sCCvTF1tJ,KAAW72B,yBACX23B,KAAmB33B,UACnB6O,KACAtF,KACA+7C,KAAgBnlD,KAChBkkB,MAAkBjkB,YAClBkkB,MAAevV,MAAAE,MACfxF,KAAgByF,KAChBqV,MACA8gC,MAAqBnuB,YACrBQ,KACA7tB,MAAiButB,MACjB+2B,MAAc72B,YACd1tB,KAAa4tB,KACbP,MAAcQ,MACdV,MAAqBe,YACrBqkJ,GACAryK,KACAC,KAAiB0lL,KACjBC,MAAcC,mBAAA1lL,OAAA,0gDAGLwhL,CAA2B,8BClFxCjwL,MAAA,qDAMEA,MAHA,iBAAAqnB,EAAA+sK,YAGAp0L,CAH8B,aAAAqnB,EAAAwtI,WAG9B70J,CAFyB,MAAAqnB,EAAAhI,IAEzBrf,CADW,gBAAAqnB,EAAAmzJ,yCAWXx6K,MAAA,+DAIEA,MAHA,gBAAAq0L,EAGAr0L,CAH+B,iBAAAqnB,EAAA+sK,YAG/Bp0L,CAF8B,aAAAqnB,EAAAwtI,WAE9B70J,CADyB,MAAAqnB,EAAAhI,+BAT7Brf,MAAA,EAAAs0L,GAAA,0CAIEt0L,MAAA,UAAAqnB,EAAAwtI,WAAAp2J,QAAAu4E,WAAA07B,sBCqBK,IAAM6hF,GAA0B,MAAjC,MAAOA,EACF1/B,WAEAx1I,IAEAyoK,eAET,eAAIsM,GACF,OAAOx1L,KAAKkpL,cACd,CAEA,sBAAIxoG,GACF,GAAI1gF,KAAKi2J,WAAWp2J,QAAQu4E,WAC1B,OAAOp4E,KAAKi2J,WAAWp2J,QAAQu4E,WAAWsI,kBAG9C,CAEA,iBAAIk7F,GACF,OAAO57K,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBACtC9zG,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAoB,QACvD9xG,CACN,CAEOuJ,MAAQ,UAEfxL,cAAe,4CA1BJ41L,EAA0B,+BAA1BA,EAA0BrnL,UAAA,8BAAAC,OAAA,CAAA0nJ,WAAA,aAAAx1I,IAAA,MAAAyoK,eAAA,kBAAAz6K,YAAA,EAAAlE,SAAA,CAAAnJ,MAnB1B,CACT,CACEqJ,QAASmrL,MACT/xH,SAAU,CAAEgyH,kBAAmB,4BAEjC,CACEprL,QAASqrL,MACTjyH,SAAU,CAAEgyH,kBAAmB,8BAElCz0L,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,yPAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDfH1N,MAVA,EAAA20L,GAAA,iCAUA30L,CAHC,EAAA40L,GAAA,kBANE50L,MAAA,QAAA2N,EAAA2xE,oBAUAt/E,cAAA,OAAA2N,EAAA2xE,oBAAA3xE,EAAAknJ,WAAAp2J,QAAAu4E,WAAAjc,0BCiBChtD,KACAkiL,GACAngJ,KACAz8B,KACAk0K,IAAsB94K,OAAA,6KAGb8lL,CAA0B,wHCjCnCv0L,MAAA,iBAOEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA2qL,yBAAwB,GAChC70L,MAAA,kBACHA,2CAHEA,MADA,SAAA80L,EACA90L,CADqB,YAAAkK,EAAA6qL,4DAKvB/0L,MAAA,aAMEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,QAAA,OAAAA,MAASkK,EAAA8qL,sBAAqB,GAE9Bh1L,MAAA,GACFA,gCALEA,MADA,UAAAA,MAAA,EAAA+zC,GAAA7pC,EAAA6qL,iBAAA,qBACA/0L,CADgE,aAAAkK,EAAAm3C,MAAA72C,OAKhExK,cAAA,IAAAkK,EAAAm3C,MAAA72C,MAAA,+CAGAxK,MAAA,oCAQEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAAjhD,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+qL,sBAAqB,GAE9Bj1L,MAAA,cAAUA,MAAA,SACZA,kCAJEA,MALA,WAAAkK,EAAAgrL,oBAKAl1L,CALgC,aAAAA,MAAA,gCAKhCA,CADqD,QAAAkK,EAAAC,iDAMvDnK,MAAA,yDAYEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAAAkK,EAAAm3C,MAAA5rB,SAAAvrB,EAAAm3C,MAAA5rB,QAAA,GAEAz1B,MAAA,iCAEGA,MAAA,GAELA,kCAXEA,MAJA,QAAAkK,EAAAm3C,MAAA5rB,QAAA,oBAIAz1B,CAJ+C,aAAAkK,EAAAm3C,MAAA5rB,QAAAz1B,MAAA,+BAAAA,MAAA,gCAY7CA,MAAA,GAAAA,MAAA,UAAAA,MAAA,GAAAg0C,IAAA,IAAAh0C,MAAA,IAAAkK,EAAAirL,sBACCn1L,MAAA,GAAAA,MAAA,GAAAkK,EAAAm3C,MAAA5rB,QAAA,6DAQLz1B,MAAA,+CAA8CA,MAAA,QAAAkK,EAAAm3C,kCADhDrhD,MAAA,cACEA,MAAA,EAAAo1L,GAAA,4CAEFp1L,8BAFqBA,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAAkK,EAAAmrL,wDAUrBr1L,MAAA,gBAIEA,MAAA,iBACAA,MAAA,qBACEA,MAAA,kBAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAorL,oBAAAj/K,GAA2B,GACrCrW,MAAA,yBAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,qBAAAkK,EAAA2qJ,WAAAp2J,QAAAu4E,WAAAsI,mBAAAjpE,KAAAnM,EAAA2qJ,WAAAp2J,QAAAu4E,WAAAsI,mBAAAjpE,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,wBAEJA,kCAJIA,MAAA,GAAAA,MAAA,UAAAkK,EAAA2qJ,WAAAp2J,QAAAu4E,WAAAsI,oBAEAt/E,cAAA,IAAAA,MAAA,+CCxBD,IAAMu1L,GAA0B,MAAjC,MAAOA,EA2BSrF,iBA1Bb/lL,MAAQ,UACPqrL,iBACAC,qBAAuB/pF,KAAkBe,IAC1CipF,wBAAyB,EACzBC,oBAAqB,EACrBZ,kBAAmB,EACnBa,aAAuB,EAC9BP,YAAwC,IAAI10L,MAAgB,GAC5Dw0L,mBAA+C,IAAIx0L,MAAgB,GAC3D2iG,aACAjsB,gBAECh2B,MAEAhiC,IAEAotB,QAAkB,EAE3B,eAAI2nJ,GACF,OAAOx1L,KAAKkpL,eAAevuG,KAAK36E,KAClC,CAEA,cAAIi2J,GACF,OAAOj2J,KAAKyiD,MAAMpsB,UACpB,CAEAt2B,YAAoBuxL,GAAAtxL,KAAAsxL,mBAClBtxL,KAAKy4E,gBAAkB,IAAIC,GAC7B,CAEAnrE,WACMvN,KAAKyiD,MAAM5rB,UACb72B,KAAKm2L,kBAAmB,GAG1B,MAAM/9G,EAAap4E,KAAKi2J,WAAWp2J,QAAQu4E,WAc3C,QAZGA,EAAWU,aAAeV,EAAWU,YAAYm6B,QAAQrpG,OAAS,GAClEwuE,EAAWY,YAAcZ,EAAWY,WAAWi6B,QAAQrpG,OAAS,GAChEwuE,EAAWa,cAAgBb,EAAWa,aAAag6B,QAAQrpG,OAAS,GACpEwuE,EAAWnrD,QAAUmrD,EAAWnrD,OAAOgmF,QAAQrpG,OAAS,GACxDwuE,EAAW/3C,cAAgB+3C,EAAW/3C,aAAa4yE,QAAQrpG,OAAS,UAE/B5H,IAAlCo2E,EAAWsI,qBACbtI,EAAWsI,oBAAqB,GAElC1gF,KAAKg3L,aAAc,GAGbh3L,KAAKi2J,WAAWp2J,QAAQ2D,MAC9B,IAAK,MACHxD,KAAKsxL,iBAAiB5e,wBAAwB1yK,KAAKi2J,YACnD,MACF,IAAK,MACHj2J,KAAKsxL,iBAAiB9e,wBAAwBxyK,KAAKi2J,YAMnD79E,IACEA,EAAW07B,sBACb9zG,KAAK42L,iBAAmB3+J,KAAKC,MAC3BD,KAAKouB,UAAU+xB,EAAW07B,sBAG1B17B,EAAW07B,oBAAoBpqG,OAAQy8B,GAAMA,EAAEuqE,cAAc9mG,QAC7D,IAEA5J,KAAK82L,wBAAyB,IAIlC92L,KAAK+2L,qBAAqB3+G,EAAWjc,UACjCic,EAAWjc,UAKjBn8D,KAAK0kG,aADe1kG,KAAKyiD,MAAMhiC,IAAIyhC,eAAe+iD,YAClBpiG,UAAU,KACxC7C,KAAKu2L,mBAAmB5zL,KAAK3C,KAAKyiD,MAAM2hE,qBAAoB,EAEhE,CAEAl2G,cACElO,KAAK0kG,aAAav2F,aACpB,CAEAkoL,sBACEr2L,KAAKm2L,kBAAmB,EAGxB,MAAMc,EADJj3L,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,qBACF,GAC7BojF,EAA2B,IAAfD,EAAIrtL,OAAe,EAAIqtL,EAAIA,EAAIrtL,OAAS,GAAG0nG,MAC7D,IAAI6lF,EAAiB,GACrB,MAAMC,EAAiBp3L,KAAKi2J,WAAWp2J,QAAQ+zE,aAAalqE,OACzDy8B,KAAOA,GAAEmjJ,uBAMZ,IAAIhxG,EAJA8+G,EAAextL,OAAS,IAC1ButL,OAC6Bn1L,IAA3Bo1L,EAAe,GAAGpoK,KAAqB,GAAKooK,EAAe,GAAGpoK,MAGlE,MAAMwnC,GAAoBx2D,KAAKi2J,WAC5Bp2J,QACC22D,GAAkB8hB,kBACpBA,EAAoB9hB,GAAkB8hB,kBAErCt4E,KAAKi2J,WAAWp2J,QAAgB04E,WAChCv4E,KAAKi2J,WAAWp2J,QAAgB04E,UAAUD,oBAE3CA,EAAqBt4E,KAAKi2J,WAAWp2J,QAAgB04E,UAClDD,mBAEL,MAAMo5B,GAAmB1xG,KAAKy4E,gBAAgB+4B,wBAC5CxxG,KAAKi2J,WAAWp2J,QAAQ+zE,aACxBujH,EACAn3L,KAAKi2J,WAAWp2J,QAAQu4E,WAAW25B,sBAE/BslF,GAAoB7wL,OAAOC,KAAKirG,IAAkB,GAExDulF,EAAI3vL,KACFtH,KAAKy4E,gBAAgB84B,mBACnB,CACEvzB,aAAcm5G,EACdtgI,SAAUwgI,GACV1vK,QAAQ,EACRyqF,mBAAoB,cACpBjzB,QAASn/E,KAAKygB,IAAIuhC,YAEpBs2B,EACA4+G,EACAl3L,KAAK62L,uBAGT72L,KAAKi2J,WAAWp2J,QAAQu4E,WAAW07B,oBAAsBmjF,CAC3D,CAEA/N,eAAeoO,IACC,IAAVA,IACFt3L,KAAK42L,sBAAmB50L,GAE1B,MAAMo2E,EAAgCp4E,KAAKi2J,WAAWp2J,QAAQu4E,WACxDgxG,EAAgBhxG,EAAW07B,oBAC7B17B,EAAW07B,oBAAoBpqG,OAAQy8B,IAAmB,IAAbA,EAAExe,QAC/C,GAkBJ,GAjB6B,IAAzByhK,EAAcx/K,SAChBwuE,EAAW/0D,aAAUrhB,EACrBo2E,EAAWu6F,UAAW,GAEpByW,EAAcx/K,OAAS,IACzBw/K,EAAc,GAAGn3E,cAAgBm3E,EAAc,GAAGn3E,eAOlDjyG,KAAK82L,uBAFQ,IAFb1N,EAAc1/K,OACX6tL,IAAqE,IAA9D,CAAC,WAAY,aAAc,UAAU7uL,QAAQ6uL,EAAG1gI,WACxDjtD,OAQAquB,KAAKouB,UAAUrmD,KAAK42L,oBAAsB3+J,KAAKouB,UAAU+iI,GAC3D,CACA,GAA2C,QAAvCppL,KAAKyiD,MAAMpsB,WAAWx2B,QAAQ2D,KACLxD,KAAKyiD,MAAMpsB,WACYx2B,QAAQu4E,WACjD/0D,QACPrjB,KAAKy4E,gBAAgB+5B,sCACnB42E,GAEJppL,KAAKyiD,MAAMpsB,WAAWgrB,GAAGx9C,eAC3B,GACyC,QAAvC7D,KAAKyiD,MAAMpsB,WAAWx2B,QAAQ2D,MAC9B40E,EAAWznC,QACX,CACA,IAAI6mJ,EAAgB,GACpB,GAAIpO,EAAcx/K,QAAU,EAAG,CAC7B,MAAM6tL,EAAqBz3L,KAAKyiD,MAAMpsB,WAChCqhK,EAA8BD,EAAc53L,QAAQu4E,WAC1Ds/G,EAASr0K,QACPrjB,KAAKy4E,gBAAgB+5B,sCACnB42E,GAEJoO,EAAgBx3L,KAAKy4E,gBAAgByJ,YACnCw1G,EAASr0K,aACTrhB,OACAA,EACChC,KAAKyiD,MAAMpsB,WAAWx2B,QAAgBy4E,kBACvCm/G,EAAc53L,QAElB,CACAG,KAAKsxL,iBAAiBhf,YACpBtyK,KAAKi2J,WACLuhC,GAEFx3L,KAAKi2J,WAAWp2J,QAAQu4E,WAAWu6F,SACR,IAAzByW,EAAcx/K,MAClB,CAEA5J,KAAK42L,iBAAmB3+J,KAAKC,MAAMD,KAAKouB,UAAU+iI,GACpD,CAGCppL,KAAKyiD,MAAMpsB,WAAuC6iD,cACjDd,GACA,EAEJ,CAEOwsC,aACL5kH,KAAKyiD,MAAM5rB,SAAU,CACvB,CAEO8gK,uBACL,OAAO33L,KAAKi2J,WAAWp2J,QAAQu4E,WAAWsI,kBAC5C,CAEO41G,oBACL,OACGt2L,KAAKi2J,WAAWp2J,QAAQ+zE,cACuB,IAAhD5zE,KAAKi2J,WAAWp2J,QAAQ+zE,aAAahqE,MAEzC,CAEQguL,mCAAmClxL,GACzC1G,KAAKi2J,WAAWp2J,QAAQu4E,WAAWsI,mBAAqBh6E,CAC1D,CAEAgwL,oBAAoBiB,GAClB33L,KAAK43L,mCAAmCD,EAAqB9pK,SACzD8pK,EAAqB9pK,SACvB7tB,KAAKkpL,gBAAe,EAExB,CAEQ2O,aAAa/mL,GACnB9Q,KAAKyiD,MAAMohE,gBAAkB/yG,EAC7B9Q,KAAKy2L,YAAY9zL,MAAMmO,EACzB,CAEAslL,sBACOp2L,KAAKm2L,kBACRn2L,KAAK63L,aAAa73L,KAAKy2L,YAAY/vL,MAEvC,CAEAuvL,yBACEj2L,KAAKm2L,kBAAoBn2L,KAAKm2L,gBAChC,4CA5PWQ,GAA0Bv1L,MAAAuE,GAAA,+BAA1BgxL,EAA0BroL,UAAA,8BAAAC,OAAA,CAAAk0C,MAAA,QAAAhiC,IAAA,MAAAotB,OAAA,UAAAp/B,YAAA,EAAAlE,SAAA,CAAAnJ,MAF1B,CAACixK,IAAiBjxK,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,muCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDnD7B1N,MADF,UACEA,CADoD,mBAYlDA,MAVA,EAAA02L,GAAA,iBAUA12L,CAFG,EAAA22L,GAAA,cAYH32L,MAAA,WAaEA,MAZA,EAAA42L,GAAA,eAYA52L,CAHC,EAAA62L,GAAA,iBAuBL72L,UAEAA,MAAA,gBACEA,MAAA,EAAA82L,GAAA,aAIA92L,MAAA,gCAOAA,MAAA,GAAA+2L,GAAA,kBAaJ/2L,iBAlFKA,MAAA,UAAAA,MAAA,GAAAoW,IAAA,IAAAzI,EAAA8+B,SAGEzsC,MAAA,GAAAA,MAAA,OAAA2N,EAAA8+B,QAUAzsC,cAAA,OAAA2N,EAAA8+B,QAWEzsC,MAAA,GAAAA,MAAA,OAAA2N,EAAA4oL,wBAAA5oL,EAAAgoL,oBAYA31L,cAAA,OAAA2N,EAAA8+B,QAsBCzsC,MAAA,GAAAA,MAAA,OAAA2N,EAAA8+B,QAKJzsC,QAEAA,MAFA,aAAA2N,EAAAknJ,WAEA70J,CAFyB,MAAA2N,EAAA0R,IAEzBrf,CADW,iBAAA2N,EAAAymL,aAMVp0L,cAAA,OAAA2N,EAAAioL,aAAAjoL,EAAAgoL,oCClCHznL,KACAF,MAAaxJ,YAAAC,KAAAD,YACbuJ,KACAK,KAAa1J,KACb4Q,MACA4mB,KACAjuB,KAAgBtJ,KAChBwJ,KAAevJ,KACf+wK,GACA4e,GACAzqI,KACAz7C,MAAiBkF,MACjB8nB,KAAW5nB,UACXnF,KACAC,KAAiBmF,MAAAjF,OAAA,ooBAIR8mL,CAA0B,+BCtDvCv1L,MAAA,mCAmBEA,MAAA,gBAKGA,MAAA,gBAELA,gCATEA,MADA,aAAAA,MAAA,+BACAA,CADoD,QAAAqnB,EAAAld,OAKlDnK,MAAA,GAAAA,MAAA,WAAAqnB,EAAAzS,iCAqBF5U,MAAA,qDAKEA,MAFA,YAEAA,CAFgB,MAAAqnB,EAAAg6B,MAAAhiC,IAEhBrf,CADiB,QAAAqnB,EAAAg6B,kCAlBrBrhD,MAAA,aAcEA,MAAA,EAAAg3L,GAAA,iCAQFh3L,8BAPKA,MAAA,GAAAA,MAAA,OAAAqnB,EAAA4vK,mBAAA5vK,EAAA5oB,QAAAu4E,WAAAznC,UCHE,IAAM2nJ,GAAwB,MAA/B,MAAOA,EACJz4L,QAEP,SAAImW,GACF,MAAMtM,EAAS1J,KAAKH,QAAQu4E,WAC5B,IAAIyK,EAAM,EACV,GAAIn5E,IAAWA,EAAOg3E,mBAAoB,CACxC,GAAIh3E,EAAOovE,YAAa,CAEtB,MAAMy/G,EADc7uL,EAAOovE,YACgB93C,OAAO5e,KAC/Co2K,GAAOA,EAAG7nJ,SAEb,IAAI8nJ,EAAiB,EACjBF,GACFA,EAAuBxlF,mBAAmBtyF,IACvCi4K,GACED,GAAmBC,EAAGpqL,WAAmB5E,OACvCivL,IAAWA,GAAOhoJ,SACnB/mC,QAGRi5E,GAAO41G,CACT,CACA,GAAI/uL,EAAOsvE,WAAY,CAErB,MAAM4/G,EADalvL,EAAOsvE,WACch4C,OAAO5e,KAAMo2K,GAAOA,EAAG7nJ,SAC/D,IAAIkoJ,EAAgB,EAChBD,GACFA,EAAqB7lF,mBAAmBtyF,IACrCi4K,GACEG,GAAkBH,EAAGpqL,WAAmB5E,OACtCwF,IAAaA,GAASyhC,SACvB/mC,QAGRi5E,GAAOg2G,CACT,CACA,GAAInvL,EAAOuvE,aAAc,CAEvB,MAAM4zG,EADenjL,EAAOuvE,aACkBj4C,OAAO5e,KAClDo2K,GAAOA,EAAG7nJ,SAEb,IAAImoJ,EAAkB,EAClBjM,GACFA,EAAyB95E,mBAAmBtyF,IACzCi4K,GACEI,GAAoBJ,EAAGpqL,WAAmB5E,OACxCqvL,IAAUA,GAAMpoJ,SACjB/mC,QAGRi5E,GAAOi2G,CACT,CACA,GAAIpvL,EAAOujB,OAAQ,CAEjB,MAAM2gK,EADSlkL,EAAOujB,OACY+T,OAAO5e,KAAMo2K,GAAOA,EAAG7nJ,SACzD,IAAIqoJ,EAAY,EACZpL,GACFA,EAAmB76E,mBAAmBtyF,IACnCi4K,GACEM,GAAcN,EAAGpqL,WAAmB5E,OAClCkB,IAAUA,GAAM+lC,SACjB/mC,QAGRi5E,GAAOm2G,CACT,CACA,GAAItvL,EAAO22B,aAAc,CAEvB,MAAM8uJ,EADezlL,EAAO22B,aACkBW,OAAO5e,KAClDo2K,GAAOA,EAAG7nJ,SAEb,IAAIsoJ,EAAkB,EAClB9J,GACFA,EAAyBp8E,mBAAmBtyF,IACzCi4K,GACEO,GAAoBP,EAAGpqL,WAAmB5E,OACxC22B,IAAiBA,GAAasQ,SAC/B/mC,QAGRi5E,GAAOo2G,CACT,CACF,KAAO,IAAIvvL,GAAUA,EAAO2Z,UAAY3Z,EAAO2Z,QAAQA,QACrD,OAAO,EACF,GAAI3Z,GAAUA,EAAO2Z,SAAW3Z,EAAO2Z,QAAQA,QACpD,OAAO3Z,EAAO2Z,QAAQA,QAAQzZ,OAEhC,GACEF,EAAO2Z,SACqB,WAA5B3Z,EAAO2Z,QAAQwzC,UACfntD,EAAO2Z,QAAQsE,QACfje,EAAOoqG,qBACPpqG,EAAOoqG,oBAAoB,GAAGnsF,OAC9B,CACA,MAAMuxK,EAAoBxvL,EAAOoqG,oBAAoB,GACjDpqG,EAAO2Z,QAAQs9D,kBAGfu4G,EAAkBpoF,MAAM47C,UAAU,EAAG,KACnC1sJ,KAAKH,QAAQmyE,QAAQ06E,UAAU,EAAG,IACpCwsC,EAAkBloF,IAAI07C,UAAU,EAAG,KACjC1sJ,KAAKH,QAAQoyE,QAAQy6E,UAAU,EAAG,MAEpC7pE,GAAO,IAGTq2G,EAAkBpoF,QAAU9wG,KAAKH,QAAQmyE,SACzCknH,EAAkBloF,MAAQhxG,KAAKH,QAAQoyE,WAEvC4Q,GAAO,EAEX,CACA,OAAOA,EAAM,EAAIA,OAAM7gF,CACzB,CAEA,SACIygD,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,EACVA,IACF1G,KAAKH,QAAUG,KAAKyiD,MAAMpsB,WACvBx2B,QAEP,CACQimI,OAECrlH,IAEAlV,MAAgB,UAEhBsiC,OAEFwqJ,mBAAoB,EAE3Bt4L,cAAe,CAEfwN,WACEvN,KAAKH,QAAUG,KAAKyiD,MAAMpsB,WACvBx2B,OACL,4CA9IWy4L,EAAwB,+BAAxBA,EAAwBhqL,UAAA,4BAAAC,OAAA,CAAAk0C,MAAA,QAAAhiC,IAAA,MAAAlV,MAAA,QAAAsiC,OAAA,UAAAp/B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4hBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDZrC1N,MA5BA,EAAA+3L,GAAA,eA4BA/3L,CAVC,EAAAg4L,GAAA,mBAjBEh4L,MAAA,OAAA2N,EAAA8+B,QAAA9+B,EAAAlP,QAAAu4E,YAAArpE,EAAAlP,QAAAu4E,WAAAznC,UAAA5hC,EAAAlP,QAAAu4E,WAAAU,aAAA/pE,EAAAlP,QAAAu4E,WAAAY,YAAAjqE,EAAAlP,QAAAu4E,WAAAa,cAAAlqE,EAAAlP,QAAAu4E,WAAAnrD,QAAAle,EAAAlP,QAAAu4E,WAAA/3C,cAAAtxB,EAAAlP,QAAAu4E,WAAAjc,WA8BA/6D,cAAA,OAAA2N,EAAAlP,QAAAu4E,YAAArpE,EAAAlP,QAAAu4E,WAAAznC,UAAA5hC,EAAAlP,QAAAu4E,WAAAU,aAAA/pE,EAAAlP,QAAAu4E,WAAAY,YAAAjqE,EAAAlP,QAAAu4E,WAAAa,cAAAlqE,EAAAlP,QAAAu4E,WAAAnrD,QAAAle,EAAAlP,QAAAu4E,WAAA/3C,cAAAtxB,EAAAlP,QAAAu4E,WAAAjc,2BCDChtD,KACAI,KAAe5J,KACf0J,KAAgBzJ,KAChB4J,KAAa3J,KACbw3J,IAAcv3J,IACd6wL,GACAzlJ,KACAvhC,KAAiB5J,MAAA+J,gBAAA,WAGRwoL,CAAwB,KC9BxBe,GAAwB,MAA/B,MAAOA,EACXjgL,UAAU1S,EAAgB4yL,GACxB,IAAIx5I,EAEJ,MAAY,SAARw5I,IACFx5I,EAASp5C,EAAMgD,OAAQ+4C,IACrB,MAAMwzG,EAAaxzG,EAAMpsB,WACzB,OACEr2B,KAAKu5L,iBAAiBtjC,SACYj0J,IAAlCi0J,EAAWp2J,QAAQkwE,YACnBvpE,OAAOC,KAAKwvJ,EAAWp2J,QAAQkwE,YAAYnmE,UAIrC,QAAR0vL,IACFx5I,EAASp5C,EAAMgD,OAAQ+4C,GAEdziD,KAAKw5L,gBADO/2I,EAAMpsB,cAItBypB,CACT,CAEQy5I,iBAAiBljK,GACvB,MAAgC,QAA5BA,EAAWx2B,QAAQ2D,MAGhB6yB,EAAWx2B,QAAQowE,cAC5B,CAEQupH,gBAAgBnjK,GACtB,IAAImjK,GAAkB,EACtB,OACEnjK,EAAWx2B,QAAQu4E,YACnB/hD,EAAWx2B,QAAQu4E,WAAWznC,SAC9Bta,EAAWx2B,QAAQu4E,WAAWjc,WAE9Bq9H,GAAkB,GAGlBnjK,EAAWx2B,QAAQu4E,YACnB/hD,EAAWx2B,QAAQu4E,WAAWznC,UAC7Bta,EAAWx2B,QAAQu4E,WAAWU,aAC7BziD,EAAWx2B,QAAQu4E,WAAWY,YAC9B3iD,EAAWx2B,QAAQu4E,WAAWa,cAC9B5iD,EAAWx2B,QAAQu4E,WAAWnrD,QAC9BoJ,EAAWx2B,QAAQu4E,WAAW/3C,gBAEhCm5J,GAAkB,GAEbA,CACT,4CAnDWH,EAAwB,4DAAxBA,EAAwB9/K,MAAA,EAAA9K,YAAA,WAAxB4qL,CAAwB,4BCTnCj4L,MAAA,WAIEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,uEAGAA,MAAA,wDAIEA,MAFA,YAEAA,CAFe,QAAAq4L,EAEfr4L,CADe,MAAAq4L,EAAAh5K,MCgBd,IAAMi5K,GAA0B,MAAjC,MAAOA,EACF55I,OAEAr/B,IAET1gB,cAAe,4CALJ25L,EAA0B,+BAA1BA,EAA0BprL,UAAA,8BAAAC,OAAA,CAAAuxC,OAAA,SAAAr/B,IAAA,OAAAhS,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,iKAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID3BvC1N,MAAA,gBACEA,MAAA,EAAAu4L,GAAA,6CAMAv4L,MAAA,EAAAw4L,GAAA,qDAQFx4L,eAf+BA,MAArB,gBAAqBA,CAAD,gBAGzBA,cAAA,WAAAA,MAAA,IAAA2N,EAAA+wC,OAAA,OAAAl2C,QAI0BxI,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAA2N,EAAA+wC,OAAA,wBCW3BlN,KACAzjC,KACAsF,KACAkiL,GACAzlJ,KACAvhC,KAAiBhK,KACjB0zL,IAAwBxpL,OAAA,wGAAAC,gBAAA,WAGf4pL,CAA0B,qBChBhC,IAAMG,EAAiC,MAAxC,MAAOA,EAMDl8H,WALFvhD,UACAqtC,SAER1pD,YACUqc,EACAuhD,GAAA39D,KAAA29D,aAER39D,KAAKoc,UAAYA,CACnB,CAEA7O,WAEEvN,KAAKoc,UAAU0jC,OAAS,GAExB9/C,KAAKypD,SAAWzpD,KAAK29D,WAAWS,SAASjc,QAAQt/C,UAAWi9C,IAC1D9/C,KAAKoc,UAAU0jC,OAASA,EAAOp2C,OAAQ+4C,GAAUA,EAAMkH,gBAAe,EAE1E,CAEAz7C,cACElO,KAAKypD,SAASt7C,aAChB,4CAtBW0rL,GAAiCz4L,MAAAuE,GAAA,GAAAvE,MAAAwE,MAAA,+BAAjCi0L,EAAiCvrL,UAAA,wCAAAG,YAAA,WAAjCorL,CAAiC,sJCXlCC,GAAZ,SAAYA,GACVA,SAAAljE,MAAA,QACAkjE,EAAAC,WAAA,aACAD,EAAAhnB,QAAA,UACAgnB,EAAAl9B,OAAA,SAJUk9B,CAKZ,CALA,CAAYA,IAAY,IAOZE,GAAZ,SAAYA,GACVA,SAAAC,YAAA,cACAD,EAAAxmD,OAAA,SACAwmD,EAAA5mD,KAAA,OACA4mD,EAAAnnB,WAAA,aACAmnB,EAAAE,OAAA,SALUF,CAMZ,CANA,CAAYA,IAAS,IAQTG,GAAZ,SAAYA,GACVA,SAAAC,cAAA,KACAD,EAAAE,sBAAA,MAFUF,CAGZ,CAHA,CAAYA,IAAe,ICRpB,IAAMG,GAAe,MAAtB,MAAOA,EAGWr6L,OAFZs6L,MAEVx6L,YAAsBE,GAAAD,KAAAC,SACpBD,KAAKw6L,cACP,CAEAC,WACE,OAAOz6L,KAAKu6L,KACd,CAEAj7I,UACE,OAAOt/C,KAAKC,OAAOG,UAAU,sBAAwB,EACvD,CAEAo6L,eACEx6L,KAAKu6L,MAAQv6L,KAAKs/C,SACpB,4CAjBWg7I,GAAel5L,MAAAuE,MAAA,iCAAf20L,EAAej5L,QAAfi5L,EAAeh5L,UAAAC,WAFd,gBAED+4L,CAAe,iCCetB,SAAUI,GACd/rB,EACAC,EACAvzF,EACA7vD,GAEA,OAAO,IAAImvK,MAAc,CACvBv/G,OAAQ,IAAIu/G,KAAe,CACzBpvL,MAAOqjK,GAA4B,kBACnC1vI,MAAOm8C,GAA4B,IAErCG,KAAM,IAAIm/G,KAAa,CACrBpvL,MAAOojK,GAAwB,0BAEjC5iF,MAAO,IAAI4uG,KAAe,CACxBtgG,OAAQ,EACRjf,OAAQ,IAAIu/G,KAAe,CACzBpvL,MAAOqjK,GAA4B,kBACnC1vI,MAAOm8C,GAA4B,IAErCG,KAAM,IAAIm/G,KAAa,CACrBpvL,MAAOojK,GAAwB,6BAIvC,CAwEM,SAAUisB,GACdl0L,EACAouF,GAmBA,IAAI6mD,MAjByBz8H,IAAI,CAC/B,CACEi7K,GAAgBC,cACfx+C,IACC,GAAsB,iBAAXA,EAAI,GACb,SAAOtR,OAAmBsR,EAAK,GAC1B,CACL,MAAMi/C,EAA2B,CAAC1/J,OAAOygH,EAAI,IAAKzgH,OAAOygH,EAAI,KAC7D,SAAOtR,OAAmBuwD,EAAQ,EACpC,IAGJ,CACEV,GAAgBE,sBACfz+C,MAA0BvS,OAAeuS,EAAK,MAGjB17I,IAAI40F,GAEtC,OAAO6mD,EAAaA,EAAWj1I,QAAS1E,CAC1C,0NC/IY84L,GAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,WAAA,cACAF,EAAAG,QAAA,UACAH,EAAAI,OAAA,SACAJ,EAAAK,YAAA,eACAL,EAAAM,OAAA,SACAN,EAAAO,cAAA,kBACAP,EAAAQ,QAAA,UACAR,EAAAS,mBAAA,sBACAT,EAAAU,QAAA,UACAV,EAAAW,cAAA,iBACAX,EAAAY,cAAA,kBACAZ,EAAAa,YAAA,gBAbUb,CAcZ,CAdA,CAAYA,IAAQ,4FC4BhB15L,MADF,UACEA,CADkB,oBACJA,MAAA,oBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAAYsgC,EAAAk6J,aAAAnkL,GAAoB,GAC9CrW,QAEEA,MADF,UACEA,CADmB,cACqBA,MAAA,iBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAm6J,YAAApkL,GAAmB,GAClErW,MAAA,wBAGNA,oCAPkDA,cAAA,QAAAsgC,EAAAo6J,aAI5C16L,MAAA,GAAAA,MAAA,IAAAA,MAAA,+CCWD,IAAM26L,GAA6B,MAApC,MAAOA,EACXC,QAAkB,EAElB,SAAIt1L,CAAMA,GACR1G,KAAK4pB,OAAS5pB,KAAKi8L,YAAYv1L,GAAS,QACxC1G,KAAK87L,YAAc97L,KAAK4pB,OAExB5pB,KAAK2wB,SAAS3wB,KAAK0G,OACnB1G,KAAKk8L,QAAQl8L,KAAK0G,MACpB,CACA,SAAIA,GACF,OAAO1G,KAAK4pB,MACd,CACQA,OAECu0D,aAA4B,OAM3Bg+G,YAAoC,IAAI7uL,MAElDwuL,YAEAnrK,SAAgBA,OAChBurK,QAAeA,OAEfE,WAAW11L,GACT1G,KAAK0G,MAAQA,CACf,CAEA21L,iBAAiBC,GACft8L,KAAK2wB,SAAW2rK,CAClB,CAEAC,kBAAkBD,GAChBt8L,KAAKk8L,QAAUI,CACjB,CAEAT,YAAYnyK,GACVA,EAAM2E,iBACN3E,EAAM+E,kBACNzuB,KAAKg8L,QAAS,EACdh8L,KAAK0G,MAAQ1G,KAAK87L,WACpB,CAEAF,aAAankL,GACXzX,KAAK87L,YAAc97L,KAAKi8L,YAAYxkL,EAAOlM,MAAMixL,IAAK,QACtDx8L,KAAKm8L,YAAY/tL,KAAKpO,KAAKi8L,YAAYj8L,KAAK87L,aAC9C,CAEQG,YACN1wL,EACAosB,EAAsB33B,KAAKm+E,cAE3B,OAAQxmD,GACN,IAAK,MACHpsB,KAAQkxL,MAAUlxL,GAAOmxL,cACzB,MACF,IAAK,OAML,QACEnxL,KAAQkxL,MAAUlxL,GAAOoxL,cACzB,MALF,IAAK,OACHpxL,KAAQkxL,MAAUlxL,GAAOqxL,cAM7B,OAAOrxL,CACT,4CAvEWwwL,EAA6B,+BAA7BA,EAA6BztL,UAAA,kCAAAC,OAAA,CAAA4vE,aAAA,gBAAA3vE,QAAA,CAAA2tL,YAAA,eAAA1tL,YAAA,EAAAlE,SAAA,CAAAnJ,MAlB7B,CACT,CACEqJ,QAASoyL,KACT5gK,eAAa6gK,OAAW,IAAMf,GAC9BnxL,OAAO,KAEVxJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qhBAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBD/BH1N,MAAA,wBAQEA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAA2N,EAAAitL,QAAAjtL,EAAAitL,OAAA,GAEA56L,MAAA,eAAWA,MAAA,GAAiBA,QAC5BA,MAAA,aAMFA,QAEAA,MAAA,EAAA27L,GAAA,qBAKE37L,MAAA,2BAAAA,aAAAyK,GAAAzK,MAAA2N,EAAAitL,QAA0B,EAAK,4BAdpB56L,MAAA,GAAAA,MAAA2N,EAAA+sL,aAKT16L,cAAA,aAAA2N,EAAA+sL,aADA16L,MAAA,eAOFA,QAEAA,MAFA,4BAAA47L,EAEA57L,CAFqC,0BAAA2N,EAAAitL,OAErC56L,CADkC,qDCYhC6oB,MAAkBtkB,YAClBs3L,MACApgK,MAAcj3B,MACds3L,MACAC,MAAiBt3L,MACjB0J,KAAezJ,KACf6J,KAAiB5J,MAAA8J,OAAA,gYAGRksL,CAA6B,gCChCnC,IAAMqB,GAAgB,MAAvB,MAAOA,EACHzuB,UAAY,wBACZC,YAAc,kBACdvzF,YAAsB,EACtBgiH,gBAAiB,EACjB1xL,KACA8sF,SAAmB,KACnBiuD,UAAoBo0C,GAASC,MAAM5iI,WACnCg7D,QAAkB,EAClBC,QAAkB,EAE1BrzH,cAAe,CAEfu9L,eACE,OAAOt9L,KAAK2uK,SACd,CAEA4uB,aAAa5uB,GACX3uK,KAAK2uK,UAAYA,CACnB,CAEA6uB,iBACE,OAAOx9L,KAAK4uK,WACd,CAEA6uB,eAAe7uB,GACb5uK,KAAK4uK,YAAcA,CACrB,CAEA8uB,iBACE,OAAO19L,KAAKq7E,WACd,CAEAsiH,oBACE,OAAO39L,KAAKq9L,cACd,CAEAO,uBACE59L,KAAKq9L,gBAAkBr9L,KAAKq9L,cAC9B,CAEAQ,QAAQlyL,GACN3L,KAAK2L,KAAOA,CACd,CAEAmyL,UACE,OAAO99L,KAAK2L,IACd,CAGAoyL,cACE,OAAO/9L,KAAKy4F,QACd,CAEAlC,YAAYkC,GACVz4F,KAAKy4F,SAAWA,CAClB,CAEAulG,eACE,OAAOh+L,KAAK0mJ,SACd,CAEAu3C,aAAav3C,GACX1mJ,KAAK0mJ,UAAYA,CACnB,CAEAw3C,aACE,OAAOl+L,KAAKmzH,OACd,CAEAgrE,WAAWhrE,GACTnzH,KAAKmzH,QAAUA,CACjB,CAEAirE,aACE,OAAOp+L,KAAKozH,OACd,CAEAirE,WAAWjrE,GACTpzH,KAAKozH,QAAUA,CACjB,CAEAkrE,6BACExzL,EACAwwD,EACA+hI,EACAkB,EACA5vB,EACAC,EACAz7C,GACAC,GACA7xE,GACA51C,IAEA,IAAIwK,GACAqoL,IAA2B,EAClB1zL,EAAQqiF,wBAEDmV,OAClBk8F,IAAmBA,IAErB,MAAMC,GAAapB,EAAiBvyL,EAAQ5K,IAAI,QAAU,GAC1D4K,EAAQzK,IAAI,YAAao+L,IACzB,MAAMC,GAAqB,CACzB9xJ,KAAM6xJ,GACNrjH,OAAQ,CACN7vE,MAAO,QACP2zB,MAAO,KAETs8C,KAAM,CAAEjwE,MAAO,SACf8nH,KAAMkrE,EACNxzE,UAAU,EACVoI,QAASA,GACTC,QAASA,IAGX,IAAI7T,GAGJ,GAAIz0G,EAAQ5K,IAAI,OAAQ,CACtB,MAAMgmF,MAAc9sE,MAClBtO,EAAQqiF,cAAcwxG,gBACtBp9I,GACA,aAEI84C,GACJvvF,EAAQ5K,IAAI,OACZgsB,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,GAAY,IACvC5qB,EACFikD,UAAiB,CACf3yE,KAAM8xJ,GACNn3E,OAAQ,CACNltB,UACAjf,OAAQ,CACN7vE,MAAOqjK,GAA4B5uK,KAAK4uK,YACxC1vI,MAAOl/B,KAAKq7E,aAEdG,KAAM,CACJjwE,MAAOojK,KAIb7jK,EAAQzK,IAAI,SAAUk/G,IAEtBppG,GAAQ,IAAIqiI,MAAc,CACxB5rG,KAAM,IAAI4rG,KAAa,CACrB5rG,KAAM6xJ,GACNrjH,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAO,QACP2zB,MAAO,MAETs8C,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,UAGT8nH,KAAMkrE,EACNxzE,UAAU,EACVoI,QAASA,GACTC,QAASA,KAGXrnC,MAAO,IAAIysD,KAAe,CACxBn+C,UACAjf,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAOqjK,GAA4B5uK,KAAK4uK,YACxC1vI,MAAOl/B,KAAKq7E,cAEdG,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAOojK,QAINx4J,EAGT,QAAWxK,IACT3L,KAAKozH,SAAU,GACfsrE,GAAmBtrE,QAAUpzH,KAAKozH,QAclCtoH,EAAQzK,IAAI,SAbW,CACrBusC,KAAM8xJ,GACNtjH,OAAQ,CACN7vE,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,aAEdG,KAAM,CACJjwE,MAAOojK,GAEThjK,KAAM,CACJ48B,IAAK58B,MAKTwK,GAAQ,IAAIqiI,MAAc,CACxB5rG,KAAM,IAAI4rG,KAAa,CACrB5rG,KAAMywJ,EAAiBvyL,EAAQ5K,IAAI,QAAU,GAC7Ck7E,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAO,QACP2zB,MAAO,MAETs8C,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,UAET8nH,KAAMkrE,EACNxzE,UAAU,EACVoI,QAASA,GACTC,QAASA,KAGXh4C,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,cAGdG,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAOojK,IAGT5iF,MAAO,IAAIysD,KAAa,CACtBjwG,IAAK58B,OAGFwK,KAIPnW,KAAKozH,QAAUorE,IAAkB,GAAM,EAEvCE,GAAmBtrE,QAAUpzH,KAAKozH,QAqBlCtoH,EAAQzK,IAAI,SApBW,CACrBusC,KAAM8xJ,GACNtjH,OAAQ,CACN7vE,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,aAEdG,KAAM,CACJjwE,MAAOojK,GAETpnD,OAAQ,CACNltB,OAAQ,EACRjf,OAAQ,CACN7vE,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,aAEdG,KAAM,CACJjwE,MAAOojK,MAMbx4J,GAAQ,IAAIqiI,MAAc,CACxB5rG,KAAM,IAAI4rG,KAAa,CACrB5rG,KAAMywJ,EAAiBvyL,EAAQ5K,IAAI,QAAU,GAC7Ck7E,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAO,QACP2zB,MAAO,MAETs8C,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,UAET8nH,KAAMkrE,EACNxzE,UAAU,EAEVoI,QAASA,GACTC,QAASA,KAGXh4C,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,cAGdG,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAOojK,IAGT5iF,MAAO,IAAIysD,KAAe,CACxBn+C,OAAQ,EACRjf,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAOqjK,EACP1vI,MAAOl/B,KAAKq7E,cAEdG,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAOojK,QAINx4J,GAEX,4CAlSWinL,EAAgB,iCAAhBA,EAAgB/7L,QAAhB+7L,EAAgB97L,UAAAC,WAFf,gBAED67L,CAAgB,4BCDvBh8L,MAAA,GAEIA,MADF,SACEA,CADI,gBACkCA,MAAA,uBAAiBA,QACvDA,MAAA,wBACFA,QAEAA,MAAA,mDAHEA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0DAwCAA,MAAA,mBAIEA,MAAA,GACFA,kCAHEA,MAAA,QAAAw9L,GAEAx9L,cAAA,IAAAw9L,EAAA,MCFL,IAAMC,GAA0B,MAAjC,MAAOA,EASFjnL,UACC4d,YACAspK,iBACwB76L,KAXzB86L,aAAuB,EAEzB5+J,KAEA6+J,eACAC,eAEPl/L,YACS6X,EACC4d,EACAspK,EACwB76L,GAHzBjE,KAAA4X,YACC5X,KAAAw1B,cACAx1B,KAAA8+L,mBACwB9+L,KAAAiE,MAC/B,CAEHsJ,WACEvN,KAAKi/L,gBAAiB,EACtB,UAAWn0L,KAAW9K,KAAKiE,KAAKsG,SACA,eAA1BO,EAAQw+E,SAAS9lF,OACnBxD,KAAKi/L,gBAAiB,GAG1Bj/L,KAAKk/L,iBACLl/L,KAAK0pD,WACP,CAEQA,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCu6C,KAAM,CAACx7E,KAAKm/L,uBACZ/jH,OAAQ,CAACp7E,KAAKo/L,0BAElB,CAEQF,iBACNl/L,KAAKg/L,eAAiB,CACpBrwB,UACE3uK,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWgoK,aAAa7jH,KAC9C,wBACNozF,YACE5uK,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWgoK,aAAajkH,OAC9C,kBACNqd,SACEz4F,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAC9Bp9I,MAAM,KAAK,GACXovB,QAAQ,KAAM,IACjB,KACNguH,UACE1mJ,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAAUgG,UACzC1sJ,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAAUh+I,QAAQ,KAAO,GAE5DoyL,GAASC,MACf5nE,QACEnzH,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAW87F,QACjCnzH,KAAK8+L,iBAAiBZ,aAC5B9qE,QACEpzH,KAAKiE,KAAKsG,SAASX,OAAS,EACxB5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAW+7F,QACjCpzH,KAAK8+L,iBAAiBV,aAEhC,CAEA,iBAAIkB,GACF,OAAO94L,OAAOmV,OAAOm/K,GACvB,CAEAyE,qBACE,OAAKv/L,KAAKg/L,eAAevmG,SAOhBz4F,KAAKg/L,eAAevmG,SANpBz4F,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAC9Bp9I,MAAM,KAAK,GACXovB,QAAQ,KAAM,IACjB,IAIR,CAEA8mK,sBACE,OAAKx/L,KAAKg/L,eAAet4C,UAOhB1mJ,KAAKg/L,eAAet4C,UANpB1mJ,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAAUgG,UACzC1sJ,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWqvH,UAAUh+I,QAAQ,KAAO,GAE5DoyL,GAASC,KAIjB,CAEQoE,sBACN,OAAKn/L,KAAKg/L,eAAerwB,UAKhB3uK,KAAKg/L,eAAerwB,UAJpB3uK,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWgoK,aAAa7jH,KAC9C,uBAIR,CAEQ4jH,wBACN,OAAKp/L,KAAKg/L,eAAepwB,YAKhB5uK,KAAKg/L,eAAepwB,YAJpB5uK,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAWgoK,aAAajkH,OAC9C,iBAIR,CAEAqkH,oBACE,OAAKz/L,KAAKg/L,eAAe7rE,QAKhBnzH,KAAKg/L,eAAe7rE,QAJpBnzH,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAW87F,QACjCnzH,KAAK8+L,iBAAiBZ,YAI9B,CAEAwB,oBACE,OAAK1/L,KAAKg/L,eAAe5rE,QAKhBpzH,KAAKg/L,eAAe5rE,QAJpBpzH,KAAKiE,KAAKsG,SAASX,OAAS,EAC/B5J,KAAKiE,KAAKsG,SAAS,GAAG8sB,WAAW+7F,QACjCpzH,KAAK8+L,iBAAiBV,YAI9B,CAEAuB,gBACE3/L,KAAK4X,UAAUK,OACjB,CAEA4mD,UACE7+D,KAAK++L,aAAc,EACf/+L,KAAKmgC,KAAKjgC,IAAI,QAAQwG,QACxB1G,KAAKg/L,eAAerwB,UAAY3uK,KAAKmgC,KAAKjgC,IAAI,QAAQwG,OAGpD1G,KAAKmgC,KAAKjgC,IAAI,UAAUwG,QAC1B1G,KAAKg/L,eAAepwB,YAAc5uK,KAAKmgC,KAAKjgC,IAAI,UAAUwG,OAE5D1G,KAAK4X,UAAUK,MAAMjY,KAAKg/L,eAC5B,CAEAY,aACE5/L,KAAK4X,UAAUe,cAAe,CAChC,CAEAknL,cACE7/L,KAAK4X,UAAUe,cAAe,CAChC,4CA5JWkmL,GAA0Bz9L,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,IAAAzE,MAY3BglC,OAAe,+BAZdy4J,EAA0BvwL,UAAA,8BAAAC,OAAA,CAAAwwL,YAAA,eAAAtwL,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,uyBAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDvDvC1N,MAAA,UACEA,MAAA,wBACFA,QAOIA,MANJ,UAMIA,CAFH,WAEGA,CADwC,WAEtCA,MAAA,EAAA0+L,GAAA,sBAYE1+L,MADF,SACEA,CADI,gBACkCA,MAAA,mBAAaA,QACnDA,MAAA,0BACFA,QAEAA,MAAA,qCAGFA,QAIIA,MAFJ,YAEIA,CAF6B,uBAE7BA,CADmE,gBACxDA,MAAA,0BAA0CA,QACrDA,MAAA,iBAQEA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAiwL,eAAAvmG,SAAAhhF,EAAAb,OAAAlQ,MAAA,GARFtF,QAUAA,MAAA,cAAoBA,MAAA,SACtBA,UAEEA,MADF,uBACEA,CADmE,gBACxDA,MAAA,0BAA2CA,QACtDA,MAAA,sBAGEA,MAAA,2BAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAiwL,eAAAt4C,UAAAjvI,EAAA/Q,MAAA,GAEAtF,MAAA,GAAA2+L,GAAA,qBAOJ3+L,UAEEA,MADF,uBACEA,CADmE,gBACxDA,MAAA,0BAAyCA,QACpDA,MAAA,iBAMEA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAiwL,eAAA7rE,QAAA17G,EAAAb,OAAAlQ,MAAA,GAEJtF,UAEEA,MADF,uBACEA,CADmE,gBACxDA,MAAA,0BAAyCA,QACpDA,MAAA,iBAMEA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAiwL,eAAA5rE,QAAA37G,EAAAb,OAAAlQ,MAAA,GAKVtF,gBAEEA,MADF,YACEA,CADsB,gBACIA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAA4wL,gBAAe,GAChDv+L,MAAA,0BACFA,QACAA,MAAA,gBAA0CA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAA8vD,UAAS,GAAEz9D,MAAA,SAChEA,gBA1FEA,cAAA,IAAAA,MAAA,uCAKAA,MAAA,GAAAA,MAAA,aAAA2N,EAAA9K,KAAAsG,SAAAX,QAEuBxI,cAAA,YAAA2N,EAAAoxB,MAEJ/+B,MAAA,GAAAA,MAAA,YAAA2N,EAAAkwL,gBAab79L,MAAA,GAAAA,MAAA,IAAAA,MAAA,mCAUWA,MAAA,GAAAA,YAAA,iCAQTA,MAAA,GAAAA,MAAA,QAAA2N,EAAAwwL,sBAMSn+L,MAAA,GAAAA,YAAA,kCAGTA,MAAA,GAAAA,MAAA,QAAA2N,EAAAywL,uBAIyBp+L,MAAA,GAAAA,MAAA,UAAA2N,EAAAuwL,eAQhBl+L,MAAA,GAAAA,YAAA,gCAMTA,MAAA,GAAAA,MAAA,QAAA2N,EAAA0wL,qBAKSr+L,MAAA,GAAAA,YAAA,gCAMTA,MAAA,GAAAA,MAAA,QAAA2N,EAAA2wL,qBASNt+L,MAAA,GAAAA,MAAA,IAAAA,MAAA,mDClDA8W,MACAC,MACAskB,KAAW72B,eACX23B,KAAmB33B,UACnBuJ,KACAK,KAAa1J,KACbi2L,GACA9xK,MAAkBlkB,kBAClB82B,MAAc72B,MACdkkB,MAAevV,MAAAE,MACfJ,KACA0V,MACA/R,MACA7I,KAAeuF,KACfnF,KAAiBmtB,MAAAjtB,OAAA,86BAGRgvL,CAA0B,KCzB1BmB,GAAuB,MAA9B,MAAOA,EAGQpoL,UAFVmnL,aAAuB,EAEhCh/L,YAAmB6X,GAAA5X,KAAA4X,WAAmD,CAEtE+nL,gBACE3/L,KAAK4X,UAAUK,OACjB,CACA4mD,QAAQohI,GACNjgM,KAAK++L,aAAc,EACnB/+L,KAAK4X,UAAUK,MAAMgoL,EACvB,4CAXWD,GAAuB5+L,MAAAuE,OAAA,+BAAvBq6L,EAAuB1xL,UAAA,+BAAAC,OAAA,CAAAwwL,YAAA,eAAAtwL,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,yOAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBC7BlC1N,MADF,UACEA,CADsB,SAEpBA,MAAA,wBACFA,QACAA,MAAA,sBACEA,MAAA,oCAMJA,UAEEA,MADF,UACEA,CADsB,cACIA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAA4wL,gBAAe,GAChDv+L,MAAA,0BACFA,QACAA,MAAA,eAA0CA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAq0L,EAAA9+L,MAAA,UAAAA,MAAS2N,EAAA8vD,QAAAqhI,EAAAx5L,OAAoB,GACrEtF,MAAA,WAEJA,gBAjBIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,sDAMEA,MAAA,GAAAA,MAAA,cAAAA,MAAA,iCAMFA,MAAA,GAAAA,MAAA,IAAAA,MAAA,iDDQA+W,MACA8R,MAAkBrkB,MAClBi3B,MAAch3B,MACduS,MACA7I,KAAezJ,KACf6J,KAAiB5J,MAAA8J,OAAA,mFAGRmwL,CAAuB,8DEN5B5+L,MAAA,yBAIEA,MAAA,kBAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,EAAAlK,MAAA,UAAAA,MAAUkK,EAAA60L,kBAAA1oL,EAAA/Q,OAA+B,GAGzCtF,MAAA,GACFA,+CAHEA,MAHA,QAAAg/L,EAAA15L,MAGAtF,CAHsB,WAAAkK,EAAA+0L,gBAAAD,EAAA15L,OAGtBtF,CAF0C,UAAAg/L,EAAAvyK,SAI1CzsB,cAAA,IAAAkK,EAAAg1L,qBAAAF,EAAA15L,OAAA,gCARJtF,MAAA,qBACEA,MAAA,EAAAm/L,GAAA,2BASFn/L,+BARuBA,cAAA,UAAAkK,EAAAk1L,4DAUrBp/L,MAAA,qBAKEA,MAAA,kBAAAqW,GAAArW,MAAAmrD,GAAA,MAAAjhD,EAAAlK,MAAA,UAAAA,MACekK,EAAA60L,kBAAA1oL,EAAAgM,OAAA/c,MAAA+Q,EAAAoW,SAEzB,GAEUzsB,MAAA,GACFA,+CAHEA,MALA,QAAAq/L,EAAA/5L,MAKAtF,CALsB,WAAAkK,EAAA+0L,gBAAAI,EAAA/5L,OAKtBtF,CAJ0C,UAAAq/L,EAAA5yK,SAM1CzsB,cAAA,IAAAkK,EAAAg1L,qBAAAG,EAAA/5L,OAAA,gCAXJtF,MAAA,GACEA,MAAA,EAAAs/L,GAAA,sDACqBt/L,cAAA,UAAAkK,EAAAk1L,6CA4BjBp/L,MAAA,kBACEA,MAAA,GACFA,kCAFqDA,MAAA,QAAAu/L,GACnDv/L,cAAA,IAAAu/L,EAAA,+CAfJv/L,MAFJ,WAEIA,CAFsE,sBAEtEA,CADqC,eAC1BA,MAAA,2BAAqBA,QAChCA,MAAA,gBAOFA,QAEEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAAs1L,uBAAAnpL,EAAA/Q,OAAoC,GAEvDtF,MAAA,EAAAy/L,GAAA,qBAKNz/L,qCAdMA,MAAA,GAAAA,MAAA,QAAAkK,EAAAw1L,oBAMA1/L,MAAA,GAAAA,MAAA,QAAAkK,EAAAy1L,wBAG6B3/L,cAAA,UAAAkK,EAAA01L,gDAyB7B5/L,MAAA,kBACEA,MAAA,GACFA,6CAFgDA,MAAA,QAAA6/L,GAC9C7/L,cAAA,IAAAkK,EAAA41L,kBAAAD,GAAA,+CAfJ7/L,MALJ,WAKIA,CAFH,sBAEGA,CADqC,eAC1BA,MAAA,GAAkBA,QAC7BA,MAAA,gBAOFA,QAEEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAA61L,mBAAA1pL,EAAA/Q,OAAgC,GAEnDtF,MAAA,EAAAggM,GAAA,qBAKNhgM,qCAnBeA,MAAA,GAAAA,MAAAkK,EAAA+1L,cAITjgM,cAAA,cAAAkK,EAAA+1L,cACAjgM,MAAA,QAAAkK,EAAAg2L,eAMAlgM,MAAA,GAAAA,MAAA,QAAAkK,EAAAi2L,mBAG6BngM,cAAA,UAAAkK,EAAAk2L,2CAyB7BpgM,MAAA,kBACEA,MAAA,GACFA,6CAF8CA,MAAA,QAAAqgM,GAC5CrgM,cAAA,IAAAkK,EAAAo2L,gBAAAD,GAAA,+CAfJrgM,MALJ,WAKIA,CAFH,sBAEGA,CADqC,eAC1BA,MAAA,wBAA+CA,QAC1DA,MAAA,qCAOFA,QAEEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAAwrD,GAAA,MAAAthD,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAAq2L,iBAAAlqL,EAAA/Q,OAA8B,GAEjDtF,MAAA,GAAAwgM,GAAA,qBAKNxgM,qCAnBeA,MAAA,GAAAA,YAAA,oCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,oCACAA,MAAA,QAAAkK,EAAAu2L,aAMAzgM,MAAA,GAAAA,MAAA,QAAAkK,EAAAw2L,iBAG6B1gM,cAAA,UAAAkK,EAAAy2L,wDA9GzC3gM,MAAA,GAGMA,MAFJ,UAEIA,CAFiD,UAEjDA,CADmC,+BAEjCA,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAUkK,EAAA60L,kBAAA1oL,EAAA/Q,OAA+B,GAGzCtF,MAAA,yBACEA,MAAA,wBACFA,QACAA,MAAA,yBACEA,MAAA,wBAGNA,YAEEA,MADF,SACEA,CADG,QAEDA,MAAA,0BACFA,QAyEAA,MAxEA,GAAA4gM,GAAA,wBAwEA5gM,CAxEsD,GAAA6gM,GAAA,qBAwEtD7gM,CA7DmD,GAAA8gM,GAAA,YA6DnD9gM,CA/C0E,GAAA+gM,GAAA,YA+C1E/gM,CAtBC,GAAAghM,GAAA,cAgDLhhM,UAGEA,MADF,WACEA,CADsB,eACIA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAq0L,gBAAe,GAChDv+L,MAAA,0BACFA,QACAA,MAAA,gBAA0CA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAuzD,UAAS,GAC1Dz9D,MAAA,IAEJA,0CAzHMA,MAAA,GAAAA,MAAA,QAAAkK,EAAA+2L,oBAEmBjhM,cAAA,QAAAkK,EAAAg3L,UAAApI,QACjB94L,cAAA,IAAAA,MAAA,2CAEiBA,MAAA,GAAAA,MAAA,QAAAkK,EAAAg3L,UAAAzvB,YACjBzxK,cAAA,IAAAA,MAAA,+CAMFA,MAAA,GAAAA,MAAA,IAAAA,MAAA,+CAEgBA,MAAA,GAAAA,MAAA,mBAAAkK,EAAA6qG,gBAWH/0G,cAAA,mBAAAkK,EAAA6qG,gBAcT/0G,cAAA,OAAAkK,EAAAi3L,YAAAj3L,EAAAg3L,UAAArI,aAuBH74L,cAAA,OAAAkK,EAAAi3L,YAAAj3L,EAAAg3L,UAAA9uD,QAAA,IAAAloI,EAAAk3L,cAyBAphM,cAAA,OAAAkK,EAAAi3L,YAAAj3L,EAAAg3L,UAAAlvD,MAAA,IAAA9nI,EAAAk3L,cA6BHphM,MAAA,GAAAA,MAAA,IAAAA,MAAA,kCAGAA,MAAA,GAAAA,MAAA,IAAAkK,EAAAm3L,gBAAA,+CAKNrhM,MAAA,GAGMA,MAFJ,UAEIA,CAFiD,UAEjDA,CADmC,+BAEjCA,MAAA,kBAAAqW,GAAArW,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MAAUkK,EAAA60L,kBAAA1oL,EAAA/Q,OAA+B,GAGzCtF,MAAA,yBACEA,MAAA,wBACFA,QACAA,MAAA,yBACEA,MAAA,wBAGNA,YACAA,MAAA,QACEA,MAAA,0BACFA,QAEEA,MADF,uBACEA,CAD4B,gBACjBA,MAAA,0BAA4CA,QACvDA,MAAA,uCAIEA,MADA,oBAAAA,aAAA8tD,GAAA9tD,OAAW,EAAI,EACfA,CADiB,iBAAAqW,GAAArW,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MACRkK,EAAAo3L,eAAAjrL,EAAAb,OAAAlQ,OAAyC,GAMxDtF,YAGEA,MADF,WACEA,CADsB,eACIA,MAAA,mBAAAA,MAAA8tD,GAAA,MAAA5jD,EAAAlK,QAAA,OAAAA,MAASkK,EAAAq0L,gBAAe,GAChDv+L,MAAA,0BACFA,QACAA,MAAA,gBAA0CA,MAAA,mBAAAA,MAAA8tD,GAAA,MAAAyzI,EAAAvhM,MAAA,IAAAkK,EAAAlK,QAAA,OAAAA,MAASkK,EAAAuzD,QAAA8jI,EAAAj8L,OAAoB,GACrEtF,MAAA,IAEJA,0CAlCMA,MAAA,GAAAA,MAAA,QAAAkK,EAAA+2L,oBAEmBjhM,cAAA,QAAAkK,EAAAg3L,UAAApI,QACjB94L,cAAA,IAAAA,MAAA,2CAEiBA,MAAA,GAAAA,MAAA,QAAAkK,EAAAg3L,UAAAzvB,YACjBzxK,cAAA,IAAAA,MAAA,+CAKJA,MAAA,GAAAA,MAAA,IAAAA,MAAA,6CAGWA,MAAA,GAAAA,YAAA,mCAMTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,mCACAA,MAAA,QAAAkK,EAAAs3L,cAQFxhM,MAAA,GAAAA,MAAA,IAAAA,MAAA,kCAGAA,MAAA,GAAAA,MAAA,IAAAkK,EAAAm3L,gBAAA,MCzGC,IAAMI,GAAkB,MAAzB,MAAOA,EA4BDlhM,gBACDiW,UACyB3T,KA7BzB86L,aAAuB,EACvBwD,UAAgDvI,GAAUE,OAC1D6G,uBACAQ,kBACAO,gBAEF9/F,aAAe83F,GACfwI,UAAYtI,GACZwG,iBAA0B,GAE1BoC,aACA9B,mBACAe,YACAP,cAEAnrF,oBAA+Bn0G,EAC/B8gM,eACAC,mBACAC,gBACAC,uBAECC,UACAC,YAEDX,aAAe,EAEtBziM,YACU4B,EACDiW,EACyB3T,GAIhC,IAAIi/F,EANIljG,KAAA2B,kBACD3B,KAAA4X,YACyB5X,KAAAiE,OAEhCjE,KAAK4iM,aAAe5iM,KAAKiE,KAAKi/F,WAAWhjG,IAAI,QAC7CF,KAAKmjM,YAAcnjM,KAAK4iM,aAAe5iM,KAAK4iM,aAAah5L,OAAS,EAGlE,MAAMo4C,EAAahiD,KAAKiE,KAAKwc,IAAI4gC,GAAGC,UAAUE,gBAE9C,GAAIxhD,KAAKiE,KAAKi/F,sBAAsBiY,KAClC,GAAIn7G,KAAKiE,KAAKi/F,WAAWhjG,IAAI,OAAQ,CACnC,MAAMkjM,EAAoB,CACxBpjM,KAAKiE,KAAKi/F,WAAWhjG,IAAI,aACzBF,KAAKiE,KAAKi/F,WAAWhjG,IAAI,aAE3BF,KAAKm2G,eAAiB2jF,GAAal9B,OACnC15D,EAAa,IAAI05D,KACfwmC,EACApjM,KAAKiE,KAAKi/F,WAAWhjG,IAAI,OAE7B,MACEF,KAAKm2G,eAAiBn2G,KAAKiE,KAAKi/F,WAAW/V,cAAc8U,UACzDiB,EAAaljG,KAAKiE,KAAKi/F,WAAWhjG,IAAI,iBAGxCF,KAAKm2G,eAAiBn2G,KAAKiE,KAAKi/F,WAAWjB,UAC3CiB,EAAaljG,KAAKiE,KAAKi/F,WAGzB,GACEljG,KAAKm2G,iBAAmB2jF,GAAaljE,OACrC52H,KAAKm2G,iBAAmB2jF,GAAal9B,OACrC,CACA,GAAI58J,KAAKiE,KAAKi/F,sBAAsBiY,KAAW,CAC7C,IAAIkoF,EAAYrjM,KAAKiE,KAAKi/F,WAAWhjG,IAAI,aACrCojM,GAAWtjM,KAAKiE,KAAKi/F,WAAWhjG,IAAI,YACxCF,KAAKkjM,aAAYj9G,OAAa,CAACo9G,EAAWC,IAAW,GACrDtjM,KAAKgjM,gBAAkB,IAAMM,GAAW,KAAOD,EAAY,GAC7D,KAAO,CACL,IAAIE,KAAYnqL,MACdpZ,KAAKiE,KAAKi/F,WAAWb,qBACrBrgD,EACA,aAEFhiD,KAAKkjM,aAAYj9G,OAAa,CAACs9G,EAAU,GAAIA,EAAU,IAAK,GAC5DvjM,KAAKgjM,gBACH,IAAMhjM,KAAKkjM,UAAU,GAAK,KAAOljM,KAAKkjM,UAAU,GAAK,GACzD,CACAljM,KAAK8gM,mBAAqB9gM,KAAKgjM,eACjC,CACA,GAAIhjM,KAAKm2G,iBAAmB2jF,GAAaC,WACvC/5L,KAAK8iM,kBAAiB3mD,OACpBj5C,EACAlhD,EAAWP,WACXuU,QAAQ,GACVh2D,KAAKshM,cAAgBthM,KAAK8iM,uBACjB9iM,KAAKm2G,iBAAmB2jF,GAAahnB,QAC9C9yK,KAAK8iM,kBAAiB3mD,OACpBj5C,EACAlhD,EAAWP,WACXuU,QAAQ,GACVh2D,KAAKshM,cAAgBthM,KAAK8iM,eAC1B9iM,KAAK+iM,sBAAqB1mD,OACxBn5C,EACAlhD,EAAWP,WACXuU,QAAQ,GACVh2D,KAAK6hM,YAAc7hM,KAAK+iM,2BACf/iM,KAAKm2G,iBAAmB2jF,GAAal9B,OAAQ,CACtD,IAAI4mC,KAAkB1sE,OAAW5zB,EAAY,KAC7C,MAAM7I,GAASr6F,KAAK2oH,UAAU66E,GAC9BxjM,KAAK8iM,eAAiBzoG,GAAOrkC,QAAQ,GACrCh2D,KAAKshM,cAAgBthM,KAAK8iM,eAC1B9iM,KAAK+iM,sBAAqB1mD,OACxBmnD,EACAxhJ,EAAWP,WACXuU,QAAQ,GACVh2D,KAAK6hM,YAAc7hM,KAAK+iM,kBAC1B,CAEI9+L,EAAKi/F,WAAWhjG,IAAI,eAAiB85L,GAAUC,aACjDj6L,KAAKmgM,kBAAkBnG,GAAUnnB,YACjC7yK,KAAKmgM,kBAAkBnG,GAAUC,aAAa,GAC9Cj6L,KAAK+gM,uBAAyB98L,EAAKi/F,WAAWhjG,IAAI,gBACzC+D,EAAKi/F,WAAWhjG,IAAI,eAAiB85L,GAAUxmD,QACxDxzI,KAAKmgM,kBAAkBnG,GAAUnnB,YACjC7yK,KAAKmgM,kBAAkBnG,GAAUxmD,QAAQ,GACzCxzI,KAAKuhM,kBAAoBt9L,EAAKi/F,WAAWhjG,IAAI,gBACpC+D,EAAKi/F,WAAWhjG,IAAI,eAAiB85L,GAAU5mD,MACxDpzI,KAAKmgM,kBAAkBnG,GAAUnnB,YACjC7yK,KAAKmgM,kBAAkBnG,GAAU5mD,MAAM,GACvCpzI,KAAK8hM,gBAAkB79L,EAAKi/F,WAAWhjG,IAAI,gBACW,IAA7C+D,EAAKi/F,WAAWhjG,IAAI,cAAc0J,SAC3C5J,KAAKmgM,kBAAkBnG,GAAUnnB,YACjC7yK,KAAKmgM,kBAAkBnG,GAAUxmD,QAAQ,GACzCxzI,KAAKmgM,kBAAkBnG,GAAU5mD,MAAM,GACvCpzI,KAAKuhM,kBAAoBt9L,EAAKi/F,WAAWhjG,IAAI,eAAe,GAC5DF,KAAK8hM,gBAAkB79L,EAAKi/F,WAAWhjG,IAAI,eAAe,IAE5DF,KAAKyjM,gBACP,CAMA9D,gBACE3/L,KAAK4X,UAAUK,OACjB,CAEA4mD,QAAQ66F,GACN15J,KAAK++L,aAAc,EACf/+L,KAAKuiM,YAAcvI,GAAUnnB,WAC/B7yK,KAAK4X,UAAUK,QACNjY,KAAKuiM,YAAcvI,GAAUE,OACtCl6L,KAAK4X,UAAUK,MAAM,CACnBuT,MAAOkuI,IAEA15J,KAAKuiM,YAAcvI,GAAUC,YACtCj6L,KAAK4X,UAAUK,MAAM,CACnBuT,MAAOxrB,KAAK8gM,mBACZluD,YAAa5yI,KAAK+gM,yBAEX/gM,KAAKm2G,iBAAmB2jF,GAAahnB,QACpB,IAAtB9yK,KAAKwiM,cACPxiM,KAAKuiM,UAAY,CAACvI,GAAUxmD,OAAQwmD,GAAU5mD,MAC9CpzI,KAAK4X,UAAUK,MAAM,CACnBuT,MACE,MACAxrB,KAAKshM,cACL,IACAtmD,MAA8B7J,MAAkBI,QAChD,KACAvxI,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,4BACvC7sC,KAAK6hM,YACL,IACA3mD,MAA4BjK,MAAgBY,cAC9Ce,YAAa,CAAC5yI,KAAKuhM,kBAAmBvhM,KAAK8hM,oBAIzC9hM,KAAK4X,UAAUK,MADnBjY,KAAKuiM,YAAcvI,GAAUxmD,OACJ,CACnBhoH,MACE,MACAxrB,KAAKshM,cACL,IACAtmD,MAA8Bh7I,KAAKuhM,mBACrC3uD,YAAa5yI,KAAKuhM,mBAEC,CACnB/1K,MACExrB,KAAK6hM,YACL,IACA3mD,MAA4Bl7I,KAAK8hM,iBACnClvD,YAAa5yI,KAAK8hM,kBAGjB9hM,KAAKuiM,YAAcvI,GAAUxmD,OAClCxzI,KAAKm2G,iBAAmB2jF,GAAal9B,OACvC58J,KAAK4X,UAAUK,MAAM,CACnBuT,MACE,MACAxrB,KAAKshM,cACL,IACAtmD,MAA8Bh7I,KAAKuhM,mBACrC3uD,YAAa5yI,KAAKuhM,oBAEXvhM,KAAKm2G,iBAAmB2jF,GAAaC,YAC9C/5L,KAAK4X,UAAUK,MAAM,CACnBuT,MACExrB,KAAKshM,cACL,IACAtmD,MAA8Bh7I,KAAKuhM,mBACrC3uD,YAAa5yI,KAAKuhM,oBAGbvhM,KAAKuiM,YAAcvI,GAAU5mD,MACtCpzI,KAAK4X,UAAUK,MAAM,CACnBuT,MACExrB,KAAK6hM,YACL,IACA3mD,MAA4Bl7I,KAAK8hM,iBACnClvD,YAAa5yI,KAAK8hM,iBAGxB,CAEA3B,kBAAkBmC,EAAsBz0K,GAEpCy0K,IAActI,GAAUnnB,YACxByvB,IAActI,GAAUE,QACxBl6L,KAAKm2G,iBAAmB2jF,GAAahnB,SAErC9yK,KAAKwgM,iBAAiBp+K,KAAM5e,GAASA,EAAKkD,QAAU47L,GAC/CtiM,KAAKwgM,iBAAiBp+K,KACpB5e,GAASA,EAAKkD,QAAU47L,GACzBz0K,QAAUA,EACX7tB,KAAKuiM,eAAYvgM,EAEjBhC,KAAKuiM,UADV10K,EACsBy0K,EACAtiM,KAAKwgM,iBAAiBp+K,KACrC5e,GAASA,EAAKqqB,UACdnnB,OAEP1G,KAAKuiM,UAAYD,EAGfA,IAActI,GAAUnnB,WACtB7yK,KAAKm2G,iBAAmB2jF,GAAaljE,OACvC52H,KAAKuiM,UAAYvI,GAAUC,YAC3Bj6L,KAAK8gM,mBAAqB9gM,KAAKgjM,gBAC/BhjM,KAAK+gM,uBAAyB5G,GAAgBC,eACrCp6L,KAAKm2G,iBAAmB2jF,GAAaC,aAC9C/5L,KAAKuiM,UAAYvI,GAAUxmD,OAC3BxzI,KAAKshM,cAAgBthM,KAAK8iM,eAC1B9iM,KAAKuhM,kBAAoBpwD,MAAkBI,QAEpC+wD,IAActI,GAAU5mD,MACjCpzI,KAAK6hM,YAAc7hM,KAAK+iM,mBACxB/iM,KAAK8hM,gBAAkB7wD,MAAgBY,cAC9BywD,IAActI,GAAUxmD,QACjCxzI,KAAKshM,cAAgBthM,KAAK8iM,eAC1B9iM,KAAKuhM,kBAAoBpwD,MAAkBI,QAClCvxI,KAAKuiM,YAAcvI,GAAUC,cACtCj6L,KAAK8gM,mBAAqB9gM,KAAKgjM,gBAC/BhjM,KAAK+gM,uBAAyB5G,GAAgBC,eAK9Cp6L,KAAKm2G,iBAAmB2jF,GAAahnB,SAFpB,CAAC9yK,KAAKsiM,UAAU9uD,OAAQxzI,KAAKsiM,UAAUlvD,MAG7Cp7G,SAASsqK,GAEpBz0K,EAAW7tB,KAAKwiM,cAAgB,EAAMxiM,KAAKwiM,cAAgB,EAE3DxiM,KAAKwiM,aAAe,CAExB,CAEArB,mBAAmBuC,GACjB1jM,KAAKuhM,kBAAoBmC,EACzB1jM,KAAKshM,iBAAgBlwD,OACnBj2G,OAAOn7B,KAAK8iM,gBACZY,GACA1tI,QAAQ,EACZ,CAEA2rI,iBAAiBtnD,GACfr6I,KAAK8hM,gBAAkBznD,EACvBr6I,KAAK6hM,eAAc3wD,OACjB/1G,OAAOn7B,KAAK+iM,oBACZ1oD,GACArkF,QAAQ,EACZ,CAEA4qI,uBAAuB+C,GACrB3jM,KAAK+gM,uBAAyB4C,EAC9B,IAAIz9G,EAAc00G,GAAQ56L,KAAKkjM,UAAWS,GAC1C3jM,KAAK8gM,mBACH,IAAM56G,EAAY,GAAK,KAAOA,EAAY,GAAK,GACnD,CAEAu9G,iBACE,UAAWnB,KAAa97L,OAAOmV,OAAOq+K,IAElCsI,IAActI,GAAUE,QACxBoI,IAActI,GAAUnnB,YAExB7yK,KAAKwgM,iBAAiBl5L,KAAK,CACzBZ,MAAO47L,EACPz0K,QACE7tB,KAAK4jM,cAActB,IACnBtiM,KAAKuiM,YAAcD,GACI,IAAtBtiM,KAAKwiM,cAAsBF,IAActI,GAAUC,aAI9D,CAEAwI,gBACE,OACEziM,KAAKuiM,YAAcvI,GAAUnnB,YAC5B7yK,KAAKuiM,YAAcvI,GAAUE,QAA+B,IAArBl6L,KAAKmjM,YAEtCnjM,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,wBAGzC,IACT,CAEA,sBAAIw1J,GACF,OAAIriM,KAAKuiM,YAAcvI,GAAUE,OACxBF,GAAUE,OAEZF,GAAUnnB,UACnB,CAEAwtB,gBAAgBwD,GACd,OAAQ7jM,KAAKm2G,gBACX,KAAK2jF,GAAaljE,MAChB,OAAIitE,IAAkB7J,GAAUC,YAIlC,KAAKH,GAAaC,WAChB,OAAI8J,IAAkB7J,GAAUxmD,OAIlC,KAAKsmD,GAAahnB,QAChB,OAAI+wB,IAAkB7J,GAAUC,YAIlC,QACE,OAAO,EAEb,CAEA,kBAAIuH,GACF,OAAOh7L,OAAOmV,OAAOw1H,MACvB,CAEA+vD,kBAAkBwC,GAChB,OAAO1oD,MAA8B0oD,EACvC,CAEA,gBAAI3B,GACF,OAAOv7L,OAAOmV,OAAOs1H,MACvB,CAEA,uBAAI+vD,GACF,OAAOx6L,OAAOmV,OAAOw+K,GACvB,CAEAuH,gBAAgBrnD,GACd,OAAOa,MAA4Bb,EACrC,CAEQ1xB,UAAUzlB,GAChB,MAAMt5F,KAASinF,OAAUqS,GACzB,OAAO/nE,OAAOvxB,GAAU,EAAIsiB,KAAK4lG,IACnC,CAEA,gBAAIuvE,GACF,OACSrhM,KAAK2B,gBAAgB4pB,UAAUshB,QADpC7sC,KAAKm2G,iBAAmB2jF,GAAahnB,QAErC,4BAGA9yK,KAAKm2G,iBAAmB2jF,GAAal9B,OAErC,oCAIF,gCAEJ,CAEA8lC,eAAeh5K,GACb1pB,KAAKmjM,YAAcz5K,EAAM9f,MAC3B,CAEAg6L,cAAcpsK,GACZ,OAAIx3B,KAAKm2G,iBAAmB2jF,GAAaljE,MAChCp/F,IAAWwiK,GAAUC,YACnBj6L,KAAKm2G,iBAAmB2jF,GAAaC,WACvCviK,IAAWwiK,GAAUxmD,YADvB,CAGT,CAEA8sD,qBAAqB9oK,GACnB,OAEWx3B,KAAK2B,gBAAgB4pB,UAAUshB,QAFtCrV,IAAWwiK,GAAUxmD,OACnBxzI,KAAKm2G,iBAAmB2jF,GAAahnB,QAErC,4BAGA9yK,KAAKm2G,iBAAmB2jF,GAAal9B,OAErC,oCAIF,gCAIF,0BAA4BplI,EAEhC,4CAnaWqrK,GAAkBzhM,MAAAuE,MAAAvE,MAAAwE,OAAAxE,MA8BnBglC,OAAe,+BA9Bdy8J,EAAkBv0L,UAAA,+BAAAC,OAAA,CAAAwwL,YAAA,cAAAwD,UAAA,YAAAxB,uBAAA,yBAAAQ,kBAAA,oBAAAO,gBAAA,mBAAArzL,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,i5BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDjE/B1N,MAAA,UACEA,MAAA,wBACFA,QAmIAA,MAjIA,EAAA0iM,GAAA,uBAiIA1iM,CAjIqD,EAAA2iM,GAAA,+BAHnD3iM,cAAA,IAAAA,MAAA,qCAGaA,MAAA,GAAAA,MAAA,OAAA2N,EAAAwzL,YAAAxzL,EAAAuzL,UAAApI,QAiIA94L,cAAA,OAAA2N,EAAAwzL,YAAAxzL,EAAAuzL,UAAApI,wBCpFXhiL,MACA/I,KACAgJ,MACA8yC,MAAqBplD,YACrBkuD,MAAcjuD,YACd2O,KACAhF,MAAiB1J,MACjBkkB,MAAkBjkB,YAClB62B,MAAcloB,MACduV,MAAerV,MAAAC,MACfqV,MACA/R,MACA7I,KAAeutB,KACfntB,KAAiBqtB,MAAAntB,OAAA,grCAGRgzL,CAAkB,qBClCxB,IAAMmB,GAAqB,MAA5B,MAAOA,EACXC,QAAmBj9J,iDADRg9J,EAAqB,+BAArBA,EAAqB11L,UAAA,wBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,wJAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC5B5B1N,MAHN,uBAGMA,CAHc,QAGdA,CAFC,WAEDA,CADoC,gBACJA,MAAA,qBAAeA,QAC9CA,MAAA,wBAELA,UAGIA,MAFJ,QAEIA,CAFC,WAEDA,CADoC,gBACJA,MAAA,yBAAkBA,QACjDA,MAAA,0BAELA,UAEEA,MADF,SACEA,CADG,aAEDA,MAAA,iBACAA,MAAA,0BAEJA,UAGIA,MAFJ,SAEIA,CAFC,YAEDA,CADoC,iBACJA,MAAA,gBAASA,QACxCA,MAAA,0BAGPA,YAEEA,MADF,0BACEA,CAD0C,eACiBA,MAAA,SAC7DA,iBAxBOA,MAAA,GAAAA,YAAA,4BAMAA,MAAA,GAAAA,YAAA,2BAKSA,MAAA,GAAAA,MAAA,OAAA2N,EAAAk1L,SACV7iM,cAAA,IAAAA,MAAA,gCAMCA,MAAA,GAAAA,YAAA,4CDAH+W,MACA3I,KAAa7J,KACbyS,MACA7I,KAAe3J,KACfs+L,MACAv0L,KAAiB9J,KACjB+J,OAAgBC,OAAA,uMAGPm0L,CAAqB,yEEW9B5iM,MAAA,wBAIEA,MAAA,kBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAAUsgC,EAAAyiK,qBAAA1sL,GAA4B,GAEtCrW,MAAA,wBACFA,gCAJEA,MADA,UAAAsgC,EAAA0iK,aACAhjM,CADwB,0BAIxBA,cAAA,IAAAA,MAAA,iEAoBIA,MAAA,kBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAAijM,GAEAjjM,cAAA,IAAAA,MAAA,uBAAAijM,GAAA,+CApBNjjM,MADF,WACEA,CAD0C,uBAExCA,MAAA,mCAQFA,QAGEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAAkP,GAAA,MAAAoxB,EAAAtgC,QAAA,OAAAA,MAAmBsgC,EAAA2xG,oBAAA57H,EAAA/Q,OAAiC,GAEpDtF,MAAA,EAAAkjM,GAAA,qBAQNljM,oCAnBMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCAEAA,MADA,cAAAsgC,EAAA6iK,kBACAnjM,CADiC,WAAAsgC,EAAA0iK,cAOjChjM,MAAA,GAAAA,MAAA,QAAAsgC,EAAAkxG,aAI0BxxI,cAAA,UAAAsgC,EAAAwxG,yCAoB5B9xI,MAAA,kBACEA,MAAA,GACFA,kCAF4CA,MAAA,QAAAojM,GAC1CpjM,cAAA,IAAAojM,EAAA54L,MAAA,+CAONxK,MAAA,yDAYEA,MAAA,mBAAAA,MAAA8tB,GAAA,MAAAwS,EAAAtgC,QAAA,OAAAA,MAAAsgC,EAAA+iK,mBAAA5tK,SAAA6K,EAAA+iK,mBAAA5tK,QAAA,GAEAz1B,MAAA,cACEA,MAAA,GAEJA,kCAVEA,MAJA,QAAAsgC,EAAA+iK,mBAAA5tK,QAAA,oBAIAz1B,CAJ4D,aAAAsgC,EAAA+iK,mBAAA5tK,QAAAz1B,MAAA,+BAAAA,MAAA,gCAY1DA,MAAA,GAAAA,MAAA,IAAAsgC,EAAA+iK,mBAAA5tK,QAAA,6EAMJz1B,MAAA,qDASEA,MAAA,mBAAAA,MAAAurD,GAAA,MAAAjrB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAgjK,iBAAgB,GAEzBtjM,MAAA,cAAUA,MAAA,YACZA,kCAJEA,MADA,aAAAA,MAAA,2BACAA,CADgD,eAAAA,MAAA,IAAAsgC,EAAAugG,mBAAAr4H,mCAuB5CxI,MAAA,YACEA,MAAA,YACFA,+BADOA,cAAA,MAAAsgC,EAAA/1B,KAAAvK,iDAMTA,MAAA,mBAGEA,MAAA,yBAAAujM,EAAAvjM,MAAAwrD,GAAAr8C,UAAAmxB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAkjK,aAAAD,GAAuB,GAEhCvjM,MAAA,YACEA,MAAA,YAEJA,sCANEA,MAAA,QAAAujM,GAIOvjM,MAAA,GAAAA,MAAA,MAAAujM,EAAAvjM,iDAhBXA,MADF,mBACEA,CADwC,eAC7BA,MAAA,wBAAqCA,QAE9CA,MADF,eACEA,CADU,wBAERA,MAAA,EAAAyjM,GAAA,cAGFzjM,QACAA,MAAA,mBAAqBA,MAAA,mBAAAA,MAAAsQ,GAAA,MAAAgwB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAkjK,eAAc,GAAExjM,MAAA,wBAE5CA,QACFA,MAAA,GAAA0jM,GAAA,qBAUJ1jM,kCApBaA,MAAA,GAAAA,YAAA,0BAGDA,MAAA,GAAAA,MAAA,OAAAsgC,EAAA/1B,MAIsCvK,MAAA,GAAAA,YAAA,4BAItBA,MAAA,GAAAA,MAAA,UAAAsgC,EAAA64J,iDA4B5Bn5L,MAAA,oCAIEA,MAAA,mBAAAA,MAAA8tD,GAAA,MAAAxtB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAqjK,uBAAsB,GAG/B3jM,MAAA,wBACAA,MAAA,iBAOGA,MAAA,cAELA,kCAZEA,MAAA,aAAAA,MAAA,gDAEAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,qCAKEA,MAAA,GAAAA,MAAA,WAAAsgC,EAAAugG,kBAAAv7H,MAAAkD,SCjCD,IAAMo7L,GAAa,MAApB,MAAOA,EA8FDrjM,gBACA6zB,YACAspK,iBACAxmL,OACA2sL,gBA7FHpwD,cAEA7yC,aAAe83F,GACbr5K,IAET,UACIiH,GACF,OAAO1nB,KAAKklM,OACd,CACA,UAAIx9K,CAAOhhB,GACT1G,KAAKklM,QAAUx+L,CACjB,CACQw+L,QAA2C,GAEnD,gBACIC,GACF,OAAOnlM,KAAKolM,aACd,CACA,gBAAID,CAAaz+L,GACf1G,KAAKolM,cAAgB1+L,CACvB,CACQ0+L,cAAgB,GAExB,sBACIX,GACF,OAAOzkM,KAAKqlM,mBACd,CACA,sBAAIZ,CAAmB/9L,GACrB1G,KAAKqlM,oBAAsB3+L,CAC7B,CACQ2+L,oBAEEC,kBAAoB,IAAIh4L,MACxBi4L,kBAAoB,IAAIj4L,MACxBk4L,cAAgB,IAAIl4L,MAEpBqhK,UACAC,YACAvzF,YAEAod,SACAiuD,UAEHgW,YACCK,eAAyB,EAC1B0oC,MAA+B,IAAI1jM,KAAgB,IAClD2jM,yBAA2B,IAAIxtF,KAC/Bs9B,kBACAE,UACAiwD,aACD1jE,kBACL,IAAIlgI,KAAgB,IACf6jM,SACAC,WACA5wD,uBAAiC,EACjCmB,qBAA+B,EAC/BinD,eACA+G,cAAe,EACdzxE,gBAAkC,GAEnCtjF,SAAmB,SACnBlP,KACAo6J,MACA5uL,KAEA44L,kBAAoB,IAAI7wI,KAAmB,KAC3Ck/E,YAAiCzB,MAAkBI,OACnDu0D,0BAA0C,IAAIC,MAC9C/vF,kBAA6C,IAAIj0G,UACtDC,GAEKi0G,eAA0C,IAAIl0G,UACnDC,GAOF,gBAAIkxI,GACF,MAAO,CAAC/B,MAAkBI,OAAQJ,MAAkBK,WACtD,CACQw0D,iBACDC,oBAA8B,EAC7BC,iBAAmBlmM,KAAKgiG,aAAa40B,MAEjB3pG,OAE5BltB,YACU4B,EACA6zB,EACAspK,EACAxmL,EACA2sL,GAJAjlM,KAAA2B,kBACA3B,KAAAw1B,cACAx1B,KAAA8+L,mBACA9+L,KAAAsY,SACAtY,KAAAilM,kBAERjlM,KAAK60I,cAAgB,CACnBnoH,WAAW,EACXyB,YAAY,EACZ2I,mBAAmB,EACnBtU,MAAM,EACNwU,aAAa,EACbC,YAAa,OACbN,QAAS,CACP,CACE3H,KAAM,UACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,uBAC9CxoB,cAAgBvZ,GACPA,EAAQusB,WAAW8uK,MAG9B,CACEn3K,KAAM,UACNpjB,MAAO,GACP4W,MAAM,EACN6B,cAAgBvZ,GACP,CACL,CACEmpB,UAAU,EACVtoB,KAAM,OACNJ,MAAO,UACP2L,MAAOA,KACLlX,KAAKomM,iBAAiBt7L,EAAO,EAE/BqL,MAAO,oBAIbQ,SAAUqG,MAA0BM,eAI1Ctd,KAAK0pD,YACL1pD,KAAK2uK,UAAY3uK,KAAK8+L,iBAAiBxB,eACvCt9L,KAAK4uK,YAAc5uK,KAAK8+L,iBAAiBtB,iBACzCx9L,KAAKq7E,YAAcr7E,KAAK8+L,iBAAiBpB,iBACzC19L,KAAKq9L,eAAiBr9L,KAAK8+L,iBAAiBnB,oBAC5C39L,KAAKu6L,MAAQv6L,KAAKilM,gBAAgBxK,WAClCz6L,KAAK2L,KAAO3L,KAAK8+L,iBAAiBhB,UAElC99L,KAAKy4F,SAAWz4F,KAAK8+L,iBAAiBf,cACtC/9L,KAAK0mJ,UAAY1mJ,KAAK8+L,iBAAiBd,cACzC,CAGAzwL,WACOvN,KAAK0nB,OAAO9d,QAqBf5J,KAAK08J,YAAc18J,KAAK0nB,OAAOtF,KAC5BlS,GAAUA,EAAMuyC,MAAMvwC,KAAOlS,KAAKykM,mBAAmBvyL,IAExDlS,KAAKw1I,kBAAoBx1I,KAAKmlM,aAAa/iL,KACxCikL,GAAOA,EAAG,KAAOrmM,KAAKykM,mBAAmBvyL,IAC1C,GACFlS,KAAKg3I,wBACLh3I,KAAKm8J,UAAU5hJ,QAASkoC,IAClBA,EAAMvwC,KAAOlS,KAAKykM,mBAAmBvyL,KACvCuwC,EAAMG,QAAU,GAElB,IAAI1yC,EAAQlQ,KAAK0nB,OAAOtF,KAAMxG,GAAMA,EAAE6mC,MAAMvwC,KAAOuwC,EAAMvwC,IAEzDlS,KAAK2yH,gBAAgBrrH,KACnB4I,EAAMwU,UACHnC,QAASgE,IACyB,IAA1BA,EAAO/V,MAAMgY,UAErBzkB,QAAKs5C,SACLx6C,UAAW0mB,IACVA,EAAQhP,QAASgM,IACfA,EAAO/V,MAAMgY,UAAW,GACzB,IAIPxoB,KAAK2yH,gBAAgBrrH,KACnB4I,EAAMwU,UACHnC,QAASgE,IACyB,IAA1BA,EAAO/V,MAAMgY,UAErBzkB,QACCmf,MAAK,IAENrgB,UAAW0mB,IACVvpB,KAAKiiI,kBAAkBt/H,KACrB4mB,EAAQ9I,IAAK8F,GAAWA,EAAOvI,QAAO,IAK9Che,KAAK2yH,gBAAgBrrH,KACnB4I,EAAM0R,OAAO/e,UAAWggF,IAEjB7iF,KAAK08J,YAAYj6G,MAAM5iD,QAAQ8pD,gBADpCk5B,GAAO,CAE+C,GACtD,GAGN7iF,KAAKsmM,cAActmM,KAAKykM,sBArExBzkM,KAAK08J,YAAc,IAAIv/D,MAA8B,GAAI,CACvD18E,IAAKzgB,KAAKygB,MAEZzgB,KAAKw2C,YACLx2C,KAAKw1I,kBAAoBx1I,KAAKumM,kBAC5BvmM,KAAK2uK,UACL3uK,KAAK4uK,YACL5uK,KAAKq7E,aAEPr7E,KAAKw1I,kBAAkB19B,gBAAgB93G,KAAKgiG,aAAa40B,OACzD52H,KAAKy2I,oBACLz2I,KAAK0nB,OAAOpgB,KAAKtH,KAAK08J,aACtB18J,KAAKmlM,aAAa79L,KAAK,CACrBtH,KAAKykM,mBAAmBvyL,GACxBlS,KAAKw1I,oBAEPx1I,KAAKulM,kBAAkBn3L,KAAKpO,KAAKmlM,cACjCnlM,KAAKwlM,cAAcp3L,KAAKpO,KAAKykM,mBAAmBvyL,IAChDlS,KAAKsmM,cAActmM,KAAKykM,qBAsD1BzkM,KAAK8lM,0BACH9lM,KAAKukM,kBAAkBhsK,aAAa11B,UAAW6D,IACzC1G,KAAKw1I,kBAAkBz/B,oBAAoBp8E,YAC7C35B,KAAKwmM,aAAa9/L,EAAK,EAG/B,CAMAwH,cACElO,KAAKm8J,UAAU5hJ,QAASkoC,GAAWA,EAAMG,QAAU,GACnD5iD,KAAK08J,YAAYlsJ,MAAM8P,UAAU,CAAEkI,UAAU,IAC7CxoB,KAAKg3I,wBACLh3I,KAAK2yH,gBAAgBlyG,IAAK7E,GAAMA,EAAEzN,eAClCnO,KAAK8lM,0BAA0B33L,aACjC,CASAo4L,kBACE53B,EACAC,EACAvzF,GAYA,OAV0B,IAAIk6B,KAAY,CACxCvT,kBAAchgG,EACdi2G,mBAAoBj4G,KAAK0lM,yBACzBvtF,kBAAmB,IAAIqgC,MAAc,IACrCnhC,iBAAkBqjF,GAChB/rB,EACAC,EACAvzF,IAIN,CAMQ7kC,UAAUiwJ,EAAmBC,GACnC1mM,KAAK6+G,YAAY4nF,EAAUC,GAC3B1mM,KAAK2yH,gBAAgBrrH,KACnBtH,KAAK08J,YAAYh4I,UACdnC,QAASgE,IACyB,IAA1BA,EAAO/V,MAAMgY,UAErBzkB,QACCmf,MAAK,IAENrgB,UAAW0mB,IACVvpB,KAAKiiI,kBAAkBt/H,KAAK4mB,EAAQ9I,IAAK8F,GAAWA,EAAOvI,QAAO,IAIxEhe,KAAK2yH,gBAAgBrrH,KACnBtH,KAAK08J,YAAY96I,OAAO/e,UAAWggF,IAE5B7iF,KAAK08J,YAAYj6G,MAAM5iD,QAAQ8pD,gBADpCk5B,GAAO,CAE+C,GAG5D,CAKAkiH,uBACEpmK,WAAW,KAET,MAAM/mB,EAAY5X,KAAKsY,OAAOC,KAAKsmL,GAA4B,CAC7DlmL,cAAc,EACd1U,KAAM,CACJsG,SAAUvK,KAAKiiI,kBAAkBtoG,WACjC4gK,MAAOv6L,KAAKu6L,MACZ5uL,KAAM3L,KAAK2L,MAEbg7L,WAAW,IAIb/uL,EAAUiB,cAAchW,UAAWoB,IAE7B2T,EAAUgB,kBAAkBmmL,cAC9B/+L,KAAK4mM,aAAa5mM,KAAKq9L,eAAgBp5L,EAAKw0F,SAAUx0F,EAAKyiJ,WAC3D1mJ,KAAK6mM,cACH7mM,KAAKq9L,iBACLr9L,KAAK2L,KACL1H,EAAK0qK,UACL1qK,EAAK2qK,aAEP5uK,KAAK8mM,oBACH9mM,KAAKq9L,eACLp5L,EAAKkvH,QACLlvH,EAAKmvH,SAAO,EAGjB,EACA,IACL,CAOQ2zE,eAAe7jG,EAAY8jG,GACjCroK,WAAW,KAET,MAAM/mB,EAAY5X,KAAKsY,OAAOC,KAAKsqL,GAAoB,CACrDlqL,cAAc,EACd1U,KAAM,CAAEi/F,WAAYA,EAAYziF,IAAKzgB,KAAKygB,OAI5C7I,EAAUiB,cAAchW,UAAWwmC,IAE7BzxB,EAAUgB,kBAAkBmmL,aAC9B/+L,KAAKinM,wBAAwB/jG,EAAY75D,EAAO7d,OAChDxrB,KAAKknM,gBACHhkG,EACAtrF,EAAUgB,kBAAkB2pL,WAE9BviM,KAAKmnM,kBAAkBjkG,EAAY75D,EAAOupG,aAEpC1vC,aAAsBiY,OAC1Bn7G,KAAKonM,uBAAuBlkG,EAAY,KAAM43F,GAASC,OACvD/6L,KAAKqnM,yBACHnkG,EACA,wBACA,mBAEFljG,KAAKsnM,aACHpkG,EACA,EACAA,aAAsBZ,MAAU,GAAM,IAI1C0kG,EACIhnM,KAAK04G,UAAUxV,GACfljG,KAAKunM,aAAarkG,EAAY75D,EAAO7d,MAAO,CAC1C5T,EAAUgB,kBAAkB2pL,UAC5Bl5J,EAAOupG,cAEb5yI,KAAKwnM,qBAILxnM,KAAK0lM,yBACFvhJ,cACA5pC,QAASs9H,IACR,MAAMvuD,EAAWuuD,EAAoB1qD,cACjC+V,IAAe5Z,GACjBtpF,KAAK0lM,yBAAyB7oH,cAC5Bg7D,EAAmB,EAGxB,EAEN,EACA,IACL,CAMQn/B,UAAUxV,EAAwB7I,GACxCr6F,KAAK+4I,kBAAkB71C,EAAY7I,GACnCr6F,KAAKk9J,wBAAwBh6D,GAC7BljG,KAAK08J,YAAYj6G,MAAMpB,GAAGsC,YAAY9/C,SACxC,CAEQ4jM,aAAavkG,GACFljG,KAAK08J,YAAYz6I,MAEzB1H,QAASyD,IAIhB,GAHiBA,EAAOqZ,WAAWnlB,KACdgxF,EAAW05B,OAED,CAC7B,GAAI5+G,EAAOqZ,WAAWirK,YAActI,GAAUC,YAAa,CACzD,IAAIyN,EAAU9M,GACZ,CAAC58K,EAAOqZ,WAAWgsK,UAAWrlL,EAAOqZ,WAAWisK,UAChDtlL,EAAOqZ,WAAWu7G,aAEpB5yI,KAAKinM,wBACH/jG,EACA,IAAMwkG,EAAQ,GAAK,KAAOA,EAAQ,GAAK,IAE3C,SAAW1pL,EAAOqZ,WAAWirK,YAActI,GAAUxmD,OACnD,GAAItwC,aAAsB6zB,KAAU,CAClC,IAAIysE,KAAkB1sE,OAAW5zB,EAAY,KAC7C,MAAM7I,MAAS+2C,OACbpxI,KAAK2oH,UAAU66E,GACfxlL,EAAOqZ,WAAWu7G,aAEd99C,GACJkmD,MAA8Bh9H,EAAOqZ,WAAWu7G,aAC5C+0D,GACJ,MAAQttG,GAAOrkC,QAAQ,GAAGmC,WAAa,IAAM28B,GAC/C90F,KAAKinM,wBAAwB/jG,EAAYykG,GAC3C,KAAO,CACL,IAII/0D,GAJAg1D,KAAmBzrD,OACrBj5C,EACAljG,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAKxCmxF,GACEoI,MAA8Bh9H,EAAOqZ,WAAWu7G,aAClDg1D,KAAmBx2D,OAAaw2D,EAJA5pL,EAAOqZ,WACpCu7G,aAIH,IAAIi1D,GACF3kG,aAAsB4vE,MAClB,MACA80B,EAAiB5xI,QAAQ,GAAGmC,WAC5B,IACAy6E,GACAg1D,EAAiB5xI,QAAQ,GAAGmC,WAAa,IAAMy6E,GACrD5yI,KAAKinM,wBAAwB/jG,EAAY2kG,GAC3C,SACS7pL,EAAOqZ,WAAWirK,YAActI,GAAU5mD,KACnD,GAAIlwC,aAAsB6zB,KAAU,CAClC,IAAIysE,KAAkB1sE,OAAW5zB,EAAY,KACzC4kG,MAAazrD,OACfmnD,EACAxjM,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAExC,MAAMqzC,GACJomD,MAA4Bl9H,EAAOqZ,WAAWu7G,aAGhDk1D,MAAa52D,OAAmB42D,GAFF9pL,EAAOqZ,WAClCu7G,aAEH,MAAMm1D,GAAYD,GAAW9xI,QAAQ,GAAGmC,WAAa,IAAM28B,GAC3D90F,KAAKinM,wBAAwB/jG,EAAY6kG,GAC3C,KAAO,CACL,IAIIn1D,GAJAo1D,KAAiB3rD,OACnBn5C,EACAljG,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAKxCmxF,GACEsI,MAA4Bl9H,EAAOqZ,WAAWu7G,aAChDo1D,KAAiB92D,OAAmB82D,EAJNhqL,EAAOqZ,WAClCu7G,aAIH,MAAMi1D,GACJG,EAAehyI,QAAQ,GAAGmC,WAAa,IAAMy6E,GAC/C5yI,KAAKinM,wBAAwB/jG,EAAY2kG,GAC3C,MAEA7nM,KAAKinM,wBAAwB/jG,EAAYllF,EAAOqZ,WAAW8uK,MAG7DnmM,KAAKknM,gBAAgBhkG,EAAYllF,EAAOqZ,WAAWirK,WACnDtiM,KAAKmnM,kBAAkBjkG,EAAYllF,EAAOqZ,WAAWu7G,aACrD5yI,KAAKonM,uBACHlkG,EACAllF,EAAOqZ,WAAWqvH,UAAUp9I,MAAM,KAAK,GAAGovB,QAAQ,KAAM,IACxD1a,EAAOqZ,WAAWqvH,UAAUgG,UAC1B1uI,EAAOqZ,WAAWqvH,UAAUh+I,QAAQ,KAAO,IAG/C1I,KAAKqnM,yBACHnkG,EACAllF,EAAOqZ,WAAWgoK,aAAa7jH,KAC/Bx9D,EAAOqZ,WAAWgoK,aAAajkH,QAEjCp7E,KAAKsnM,aACHpkG,EACAllF,EAAOqZ,WAAW87F,QAClBn1G,EAAOqZ,WAAW+7F,SAEpBpzH,KAAKioM,sBAAsBjqL,EAAQklF,EACrC,GAEJ,CAEQqkG,aACN56G,EACAnhE,EACA08K,GAEA,MAAM1oL,EAAWxf,KAAK08J,YAAYz6I,MAE5BihF,EAAavW,EAAUQ,cAC7B+V,EAAW05B,OAASjwC,EAAUzsF,IAAI,MAElC,MAAMioM,EAAwBlwK,KAAKouB,UACjC68C,EAAWrhD,iBAAiB,IAG9BriC,EAASjF,QAASyD,KAChB,MAAMoqL,GAAoBnwK,KAAKouB,UAAUroC,GAAOsrE,SAASpD,YAAY,IACrE,GAAIiiH,IAA0BC,GAAmB,CAC/C,MAAM3vG,GAAW9L,EACdzsF,IAAI,aACJoJ,MAAM,KAAK,GACXovB,QAAQ,KAAM,IACXguH,GAAY/5D,EACfzsF,IAAI,aACJwsJ,UAAU//D,EAAUzsF,IAAI,aAAawI,QAAQ,KAAO,GAEjDimK,GAAYhiF,EAAUzsF,IAAI,gBAAgBs7E,KAC1CozF,GAAcjiF,EAAUzsF,IAAI,gBAAgBk7E,OAE5C+3C,GAAUxmC,EAAUzsF,IAAI,WACxBkzH,GAAUzmC,EAAUzsF,IAAI,WAExBmoM,GAAcrqL,GAAOqZ,WAAWgxK,IAClCrqL,GAAOqZ,WAAWgxK,SAClBrmM,EACJhC,KAAKinM,wBAAwB/jG,EAAY13E,GACzCxrB,KAAKonM,uBAAuBlkG,EAAYzK,GAAUiuD,IAClD1mJ,KAAKqnM,yBAAyBnkG,EAAYyrE,GAAWC,IACrD5uK,KAAKsnM,aAAapkG,EAAYiwB,GAASC,IACvCpzH,KAAKknM,gBAAgBhkG,EAAYglG,EAAiB,IAClDloM,KAAKmnM,kBAAkBjkG,EAAYglG,EAAiB,IACpDloM,KAAKioM,sBAAsBjqL,GAAQklF,EAAYmlG,GACjD,GAEJ,CAOQtvD,kBACN71C,EACA7I,EACAvvF,GAEA,IAAIu9L,EACAC,EACA/E,EACAgF,GACAC,GAEJ,MAAMrvD,GAAYruI,EAAUA,EAAQusB,WAAWnlB,GAAKgxF,EAAW05B,OACzD56E,GAAahiD,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAEnC8nC,IAAW,IAAIuD,MAAYC,oBAAoBoW,EAAY,CAC/Dx+C,kBAAmB1C,GACnByC,eAAgBzC,KAGlB,GAAIkhD,aAAsB6zB,MAAY18B,EACpC,GAAIA,EACFguG,EAAMhuG,MACD,CACL/Q,GAAS9lF,KAAO,QAChB8lF,GAASpD,YAAcgd,EAAWthD,YAClC,MAAM6mJ,MAAarvL,MACjB,CACE8pF,EAAWb,qBAAqB,GAChCa,EAAWb,qBAAqB,IAElCrgD,GACA,aAEFsmJ,KAAalvL,MACX,CACE8pF,EAAWb,qBAAqB,GAChCa,EAAWb,qBAAqB,IAElCrgD,GACA,aAEFumJ,GAAUD,EAAW,GACrBE,GAAUF,EAAW,GACrBD,KAAMK,OAAYJ,EAAYG,IAC9BzoM,KAAKukM,kBAAkBhtK,SAASrL,KAAKiwE,MAAMksG,GAC7C,CAEEroM,KAAKw1I,kBAAkBv/B,eAAet8E,aACxC0uK,EAAMroM,KAAKw1I,kBAAkBv/B,eAAet8E,YAG1CupE,aAAsBZ,OACxBihG,KAAYnqL,MACV8pF,EAAWb,qBACXrgD,GACA,aAEFumJ,GAAUhF,EAAU,GACpBiF,GAAUjF,EAAU,IAGtBvjM,KAAK08J,YAAY/8I,OAAO,CACtBnc,KAAMwpF,MACN1D,YACAtnC,WAAYA,GAAWP,UACvBpqB,WAAY,CACVnlB,GAAIinI,GACJgtD,KAAMjjG,EAAWhjG,IAAI,UACrBmjM,UAAWkF,IAAoB,KAC/BjF,SAAUkF,IAAoB,KAC9BH,IAAKA,GAAY,KACjB3hD,UAAWxjD,EAAWhjG,IAAI,cAC1Bm/L,aAAc,CACZ7jH,KAAM0nB,EAAWhjG,IAAI,cACrBk7E,OAAQ8nB,EAAWhjG,IAAI,iBAEzBizH,QAASjwB,EAAWhjG,IAAI,YACxBkzH,QAASlwB,EAAWhjG,IAAI,YACxBoiM,UAAWp/F,EAAWhjG,IAAI,cAC1B0yI,YAAa1vC,EAAWhjG,IAAI,iBAE9Bme,KAAM,CACJnM,GAAIinI,MAGRn5I,KAAK08J,YAAYxzD,iBACjBlpG,KAAKw1I,kBAAkBx/B,kBAAkBrzG,UAAKX,GAC9ChC,KAAKw1I,kBAAkBv/B,eAAetzG,UAAKX,EAC7C,CAEQ0nD,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCu6C,KAAM,CAAC,IACPJ,OAAQ,CAAC,KAEb,CAEOutH,WAAWjC,GAChB/nK,WAAW,KACT,MAAM/mB,EAAY5X,KAAKsY,OAAOC,KAAKynL,GAAyB,CAC1DrnL,cAAc,IAEhBf,EAAUiB,cAAchW,UAAW2oB,IAC7B5T,EAAUgB,kBAAkBmmL,aAC9B/+L,KAAK08J,YAAYlsJ,MAAM8P,UAAU,CAAEkI,UAAU,IAC7CxoB,KAAK08J,YAAc,IAAIv/D,MAA8B,GAAI,CACvD18E,IAAKzgB,KAAKygB,MAEZzgB,KAAK0lM,yBAA2B,IAAIxtF,KACpCl4G,KAAKykM,mBAAmB7hJ,QAAU,EAClC5iD,KAAKg3I,wBACLh3I,KAAKw2C,UAAUhrB,EAAOk7K,GACtB1mM,KAAKw1I,kBAAoBx1I,KAAKumM,kBAC5BvmM,KAAK2uK,UACL3uK,KAAK4uK,YACL5uK,KAAKq7E,aAEPr7E,KAAKw1I,kBAAkB19B,gBAAgB93G,KAAKkmM,kBAC5ClmM,KAAKy2I,oBACLz2I,KAAK0nB,OAAOpgB,KAAKtH,KAAK08J,aACtB18J,KAAKmlM,aAAa79L,KAAK,CACrBtH,KAAKykM,mBAAmBvyL,GACxBlS,KAAKw1I,oBAEPx1I,KAAKulM,kBAAkBn3L,KAAKpO,KAAKmlM,cACjCnlM,KAAKwlM,cAAcp3L,KAAKpO,KAAKykM,mBAAmBvyL,IAChDlS,KAAKimM,oBAAqB,EACrBjmM,KAAKq9L,gBACRr9L,KAAK4oM,iBAEP5oM,KAAKslM,kBAAkBl3L,KAAKpO,KAAKykM,sBAEjCzkM,KAAKitB,OAAOvmB,MAAQ1G,KAAKykM,mBACzBzkM,KAAKitB,OAAO47K,gBAAgBz6L,KAAKpO,KAAKykM,oBAAkB,EAE3D,EACA,IACL,CAOA2B,iBAAiBt7L,GACf,MAAMg+L,KAAoB1nG,OACxBt2F,EACA9K,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAExCzhD,KAAK+mM,eAAe+B,GAAmB,EACzC,CAEAC,qBACE/oM,KAAKsY,OAAOC,KAAKyrL,GACnB,CAEAU,iBACE1kM,KAAK08J,YAAYv2I,WAAWnmB,KAAKiiI,kBAAkBv7H,OACnD1G,KAAKiiI,kBAAkBv7H,MAAM6T,QAASq9H,IACpC53I,KAAK0lM,yBACFvhJ,cACA5pC,QAASs9H,IACR,MAAMvuD,EAAWuuD,EAAoB1qD,cACjCyqD,EAAgBvgH,WAAWnlB,KAAOo3E,EAASszC,QAC7C58H,KAAK0lM,yBAAyB7oH,cAAcg7D,EAAmB,EAElE,GAEL73I,KAAKwnM,oBACLxnM,KAAK08J,YAAYxzD,gBACnB,CAKA0/F,iBACE5oM,KAAK8+L,iBAAiBlB,uBACtB59L,KAAKq9L,gBAAkBr9L,KAAKq9L,eAExBr9L,KAAKgpM,aAAahpM,KAAKq9L,iBAD3Br9L,KAAK2L,MAGL3L,KAAKumM,mBACP,CAMAxvD,oBAAoBkyD,GAClBA,EAAkBjpM,KAAKy2I,oBAAsBz2I,KAAKg3I,uBACpD,CAEAmtD,qBAAqBz6K,GACf1pB,KAAKkpM,aAAex/K,EAAMmE,SAC5B7tB,KAAKw1I,kBAAkBz/B,oBAAoBpzG,MAAK,GAChD3C,KAAKwmM,aAAaxmM,KAAKukM,kBAAkB79L,SAEzC1G,KAAKw1I,kBAAkB39B,sBACrB6iF,GACE16L,KAAK2uK,UACL3uK,KAAK4uK,YACL5uK,KAAKq7E,cAGTr7E,KAAKw1I,kBAAkBz/B,oBAAoBpzG,MAAK,IAElD3C,KAAKokM,aAAe16K,EAAMmE,QAC1B7tB,KAAKw1I,kBAAkB1/B,UAAUnzG,KAAK+mB,EAAMmE,SAC5C7tB,KAAKy2I,mBACP,CAQO6vD,cAAc6C,GACfA,GACFnpM,KAAK08J,YAAYlsJ,MAAM8P,UAAU,CAAEkI,UAAU,IAC7CxoB,KAAKimM,oBAAqB,EAC1BjmM,KAAKykM,mBAAmB7hJ,QAAU,EAClC5iD,KAAKykM,mBAAqB0E,EAC1BnpM,KAAKykM,mBAAmB7hJ,QAAU,EAClC5iD,KAAKg3I,wBACAh3I,KAAKq9L,gBACRr9L,KAAK4oM,iBAEP5oM,KAAK08J,YAAc18J,KAAK0nB,OAAOtF,KAC5BlS,GAAUA,EAAMuyC,MAAMvwC,KAAOlS,KAAKykM,mBAAmBvyL,IAExDlS,KAAKw1I,kBAAoBx1I,KAAKmlM,aAAa/iL,KACxCikL,GAAOA,EAAG,KAAOrmM,KAAKykM,mBAAmBvyL,IAC1C,GACFlS,KAAK0lM,yBACH1lM,KAAKw1I,kBAAkBt+B,qBACzBl3G,KAAKw1I,kBAAkB19B,gBAAgB93G,KAAKkmM,kBAC5ClmM,KAAKy2I,qBAELz2I,KAAK2oM,YAAW,GAElB3oM,KAAKslM,kBAAkBl3L,KAAKpO,KAAKykM,mBACnC,CAEO5lF,YAAY4nF,EAAWC,GAC5B,UAAWjkJ,KAASziD,KAAKm8J,UAAW,CAClC,IAAIa,EAAW7hI,OAAOsnB,EAAMvwC,GAAGwmB,QAAQ,iBAAkB,KACzD14B,KAAK+8J,eAAiB7wI,KAAKC,IAAI6wI,EAAUh9J,KAAK+8J,eAChD,CACA/8J,KAAKykM,mBAAqB,IAAI1oI,KAAY,CACxC5G,oBAAoB,EACpBjjD,GAAI,oBAAqBlS,KAAK+8J,eAC9BnxJ,MAAO86L,EACHD,EACAzmM,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,wBAC3C2V,OAAQ,IACR/+B,OAAQ,IAAIq4C,KACZ3lD,MAAOA,CAACrL,EAASwwD,IACRt7D,KAAK8+L,iBAAiBR,6BAC3BxzL,EACAwwD,EACAt7D,KAAKq9L,eACLvyL,EAAQ5K,IAAI,aACZ4K,EAAQ5K,IAAI,gBAAgBs7E,KAC5B1wE,EAAQ5K,IAAI,gBAAgBk7E,OAC5BtwE,EAAQ5K,IAAI,WACZ4K,EAAQ5K,IAAI,WACZF,KAAKygB,IAAIuhC,WACThiD,KAAK2L,MAGTg+C,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,EACX5gD,UAAW,CACT9J,SAAS,MAEZ,EAED2qD,MAAkBt7F,KAAK08J,YAAa18J,KAAKykM,qBAAkB,EAE3DlpG,OACEv7F,KAAK08J,YACL,IAAI7sE,MAA4B,CAC9B+K,OAAQC,MAAcj9E,SACtB,EAGJyrF,OACErpG,KAAK08J,YACL,IAAIpzD,MAA8B,CAChC7oF,IAAKzgB,KAAKygB,IACVm6E,OAAQC,MAAcj9E,KACtBu6H,MAAM,KAGVn4I,KAAK08J,YAAYj6G,MAAM5rB,SAAU,EACjC72B,KAAK08J,YAAYj5I,OAAO49B,GAAG/R,GACzB,gBACC5lB,IACC,MAAMw5E,EAAax5E,EAAM5e,QAAQqiF,cACjCntF,KAAKk9J,wBAAwBh6D,EAAU,EAG7C,CASA2jG,cACExJ,EACA+L,EACAz6B,EACAC,GAEI5uK,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,IAAMw/L,GAC9CppM,KAAKiiI,kBAAkBv7H,MAAM6T,QAASzP,IACpC,IAAI6hF,KAAYyU,OACdt2F,EACA9K,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAExCzhD,KAAKqnM,yBAAyB16G,EAAWgiF,EAAWC,GAEpD,MAAM5wJ,GAAShe,KAAK08J,YACjBz6I,MACAG,KAAMupB,IAAMA,GAAEttB,KAAKnM,KAAOy6E,EAAU/P,SACvC5+D,GAAOqZ,WAAWgoK,aAAa7jH,KAAOmR,EAAUzsF,IAAI,cACpD8d,GAAOqZ,WAAWgoK,aAAajkH,OAASuR,EAAUzsF,IAAI,gBACtDF,KAAK08J,YAAY/8I,OAAO3B,GAAM,GAIlChe,KAAKgpM,aAAa3L,EAAgB+L,GAClCppM,KAAKumM,mBACP,CASAK,aAAavJ,EAAyB/9K,EAAcnJ,GAC9CnW,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,IACxC5J,KAAKiiI,kBAAkBv7H,MAAM6T,QAASzP,IACpC,IAAI6hF,KAAYyU,OACdt2F,EACA9K,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAExCzhD,KAAKonM,uBAAuBz6G,EAAWrtE,EAAMnJ,GAC7C,MAAM6H,EAAShe,KAAK08J,YACjBz6I,MACAG,KAAMupB,IAAMA,GAAEttB,KAAKnM,KAAOy6E,EAAU/P,SACvC5+D,EAAOqZ,WAAWqvH,UAAY/5D,EAAUzsF,IAAI,cAC5CF,KAAK08J,YAAY/8I,OAAO3B,GACxB2uE,EAAY3sF,KAAK08J,YAAYj6G,MAAMpB,GAChCsC,YACAQ,cACA/hC,KAAM+jB,IAAMA,GAAEy2C,UAAY5+D,EAAOK,KAAKnM,IACzCy6E,EAAUywC,cAAc,CAAEspB,UAAW1oI,EAAOqZ,WAAWqvH,YACvD/5D,EAAU+/B,SAAO,GAGnB1sH,KAAKy4F,SAAWn5E,EAChBtf,KAAK0mJ,UAAYvwI,EAEjBnW,KAAK8+L,iBAAiBvoG,YAAYj3E,GAClCtf,KAAK8+L,iBAAiBb,aAAa9nL,GAEnCnW,KAAKgpM,aAAa3L,GAEtB,CASAyJ,oBACEzJ,EACAlqE,EACAC,GAEIpzH,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,IACxC5J,KAAKiiI,kBAAkBv7H,MAAM6T,QAASzP,IACpC,IAAI6hF,KAAYyU,OACdt2F,EACA9K,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBAAgBC,WAExCzhD,KAAKsnM,aAAa36G,EAAWwmC,EAASC,GACtC,MAAMp1G,EAAShe,KAAK08J,YACjBz6I,MACAG,KAAMupB,IAAMA,GAAEttB,KAAKnM,KAAOy6E,EAAU/P,SACvC5+D,EAAOqZ,WAAW87F,QAAUxmC,EAAUzsF,IAAI,YAC1C8d,EAAOqZ,WAAW+7F,QAAUzmC,EAAUzsF,IAAI,YAC1CF,KAAK08J,YAAY/8I,OAAO3B,GACxB2uE,EAAY3sF,KAAK08J,YAAYj6G,MAAMpB,GAChCsC,YACAQ,cACA/hC,KAAM+jB,IAAMA,GAAEy2C,UAAY5+D,EAAOK,KAAKnM,IACzCy6E,EAAUywC,cAAc,CACtBjK,QAASn1G,EAAOqZ,WAAW87F,QAC3BC,QAASp1G,EAAOqZ,WAAW+7F,UAE7BzmC,EAAU+/B,SAAO,GAEnB1sH,KAAKgpM,aAAa3L,GAEtB,CAEAuH,aAAal7K,GACX1pB,KAAK2L,KAAO+d,EACZ1pB,KAAK8+L,iBAAiBjB,QAAQ79L,KAAK2L,MACnC3L,KAAKgpM,cAAa,EAAMhpM,KAAK2L,KAC/B,CAMA09L,qBAAqBrnG,GACnBhiG,KAAKkmM,iBAAmBlkG,EACxBhiG,KAAKw1I,kBAAkB19B,gBAAgB9V,GAEnChiG,KAAKmkM,qBADTnkM,KAAKokM,aACyB,CAAEv2K,SAAS,GACX,CAAEA,SAAS,IACzC7tB,KAAKy2I,mBACP,CASQwwD,wBAAwB9rF,EAAW3vF,GACzC2vF,EAAUiiB,cACR,CACEksE,OAAQ99K,IAEV,EAEJ,CAEQ47K,uBACNz6G,EACA8L,EACAiuD,GAEA/5D,EAAUywC,cACR,CACEmsE,WAAY,GAAG9wG,OAAciuD,MAE/B,EAEJ,CAEQ2gD,yBACN16G,EACAgiF,EACAC,GAEAjiF,EAAUywC,cACR,CACEosE,WAAY76B,EACZ86B,aAAc76B,IAEhB,EAEJ,CAEQ04B,aACN36G,EACAwmC,EACAC,GAEAzmC,EAAUywC,cACR,CACEssE,SAAUv2E,EACVw2E,SAAUv2E,IAEZ,EAEJ,CAEQ8zE,gBACNv6G,EACAi9G,GAEAj9G,EAAUywC,cACR,CACEysE,WAAYD,IAEd,EAEJ,CAEQzC,kBACNx6G,EACAimD,GAEAjmD,EAAUywC,cACR,CACE0sE,aAAcl3D,IAEhB,EAEJ,CAIA2sD,qBACE,OAAOv/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAWqvH,UACxCp9I,MAAM,KAAK,GACXovB,QAAQ,KAAM,IACjB,IACN,CAEA8mK,sBACE,OAAOx/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAWqvH,UAAUgG,UACnD1sJ,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAWqvH,UAAUh+I,QAAQ,KAAO,GAEtEoyL,GAASC,KACf,CAEAoE,sBACE,OAAOn/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAWgoK,aAAa7jH,KACxD,uBACN,CAEA4jH,wBACE,OAAOp/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAWgoK,aAAajkH,OACxD,iBACN,CAEAqkH,oBACE,OAAOz/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAW87F,QAC3CnzH,KAAK8+L,iBAAiBZ,YAC5B,CAEAwB,oBACE,OAAO1/L,KAAKiiI,kBAAkBv7H,MAAMkD,OAAS,EACzC5J,KAAKiiI,kBAAkBv7H,MAAM,GAAG2wB,WAAW+7F,QAC3C,GACN,CAEA,iBAAIksE,GACF,OAAO94L,OAAOmV,OAAOm/K,GACvB,CAEA,aAAI3+B,GACF,OAAOn8J,KAAKygB,IAAIq/B,OAAOp2C,OAAQ+4C,GAC7BhZ,OAAOgZ,EAAMvwC,IAAI8lB,SAAS,kBAE9B,CAEAwvK,oBAEExnM,KAAKgmM,iBAAmBhmM,KAAK08J,YAAY96I,OAAO+X,WAE3C35B,KAAK60I,cAAc59G,YADxBj3B,KAAKgmM,iBAAmB,GACc,OACA,MACxC,CAEA+D,oBAIE,OAHgB/pM,KAAKm8J,UAAU/5I,KAC5BqgC,GAAUA,EAAM72C,QAAU5L,KAAKykM,mBAAmB74L,QAEtB5L,KAAKm8J,UAAU,EAChD,CAOQ1lB,oBACNz2I,KAAKg3I,wBACLh3I,KAAKy4I,qBACP,CAMQykB,wBAAwBh6D,IAC9Bw2C,SAAwBx2C,GAAY3oF,QACjCo/H,IACKA,GAAaA,EAAUv7E,UACzBp+D,KAAKygB,IAAI4gC,GAAGy4F,cAAcH,EAAS,EAI3C,CAMQsuD,sBACNjqL,EACAklF,EACA7I,GAEAr6F,KAAK08J,YAAY1zJ,OAAOgV,GACxBhe,KAAK04G,UAAUxV,EAAY7I,EAC7B,CAKQ28C,wBACDh3I,KAAKw1I,oBAINx1I,KAAK01I,WACP11I,KAAK01I,UAAUvnI,cAGjBnO,KAAKw1I,kBAAkBl+B,cAASt1G,GAChChC,KAAKo2I,qBAAsB,EAC7B,CAKQqC,sBACNz4I,KAAKi1I,uBAAwB,EAC7Bj1I,KAAKo2I,qBAAsB,EAC3Bp2I,KAAK01I,UAAY11I,KAAKw1I,kBAAkB//B,KAAK5yG,UAC1CqgG,IACCljG,KAAK+mM,eAAe7jG,GAAY,EAAI,GAIxCljG,KAAKw1I,kBAAkB7/B,QAAQ9yG,UAAWqgG,IACxCljG,KAAKynM,aAAavkG,EAAU,GAGzBljG,KAAK2lM,eACR3lM,KAAK2lM,aAAe3lM,KAAKw1I,kBAAkB5/B,QAAQ/yG,UAChD8pF,IACC3sF,KAAK+mM,eAAep6G,GAAW,EAAK,IAI1C3sF,KAAKw1I,kBAAkBl+B,SAASt3G,KAAKygB,IAAI4gC,IAAI,EAC/C,CAOA2oJ,UACE,OAAOhqM,KAAKw1I,kBAAkBz9B,oBAAsB/3G,KAAKgiG,aAAa40B,KACxE,CAEAqzE,eACE,OACEjqM,KAAKw1I,kBAAkBz9B,oBAAsB/3G,KAAKgiG,aAAa+3F,UAEnE,CAEAmQ,YACE,OACElqM,KAAKw1I,kBAAkBz9B,oBAAsB/3G,KAAKgiG,aAAa8wE,OAEnE,CAEAo2B,WACE,OACElpM,KAAKw1I,kBAAkBz9B,oBAAsB/3G,KAAKgiG,aAAa46D,MAEnE,CAOA4pC,aAAansG,GACX,IAAI8vG,EAIGA,EAFH9vG,EACFr6F,KAAK4yI,cAAgBzB,MAAkBI,OACnBl3C,EACS,IAATA,OAELr4F,EA4BjBhC,KAAKw1I,kBAAkB39B,sBAzBJuyF,CAACt/L,EAAgCwwD,KAClD,MAAM+tB,EAAOv+E,EAAQqiF,cACfjH,GAAczV,KAClB4Y,EAAKxnC,iBACL7hD,KAAKygB,IAAIuhC,WACT,aAGIq4C,GACJ8vG,EAAej+K,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,GAAY,IAAM5qB,EAC9D,OAAAt7D,KAAKw1I,kBAAkBx/B,kBAAkBrzG,KAAKwnM,GACvC,IAAI3xD,MAAc,CACvBzsD,MAAO,IAAIysD,KAAe,CACxBn+C,OAAQA,GACRjf,OAAQ,IAAIo9D,KAAe,CACzBt5G,MAAO,EACP3zB,MAAO,oBAETiwE,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,6BAGZ,GAIHvL,KAAKy2I,mBACP,CAEApD,oBAAoBg3D,GACdA,IAAwBrqM,KAAK4yI,cAG/B5yI,KAAK4yI,YAAcy3D,EAEfrqM,KAAKukM,kBAAkBhtK,SAD3Bv3B,KAAK4yI,cAAgBzB,MAAkBI,OAC4B,IAA/BvxI,KAAKukM,kBAAkB79L,MACvB1G,KAAKukM,kBAAkB79L,MAAQ,KAEvE,CAKQsiM,aAAa3L,EAAyB+L,GAE1CppM,KAAK08J,YAAYj6G,MAAMpB,GAAG4iD,SADxBmlG,EACiC,CAACt+L,EAASwwD,IACpCt7D,KAAK8+L,iBAAiBR,6BAC3BxzL,EACAwwD,EACA+hI,EACAvyL,EAAQ5K,IAAI,aACZ4K,EAAQ5K,IAAI,gBAAgBs7E,KAC5B1wE,EAAQ5K,IAAI,gBAAgBk7E,OAC5BtwE,EAAQ5K,IAAI,WACZ4K,EAAQ5K,IAAI,WACZF,KAAKygB,IAAIuhC,WACThiD,KAAK2L,MAI0B,CAACb,EAASwwD,IACpCt7D,KAAK8+L,iBAAiBR,6BAC3BxzL,EACAwwD,EACA+hI,EACAvyL,EAAQ5K,IAAI,aACZ4K,EAAQ5K,IAAI,gBAAgBs7E,KAC5B1wE,EAAQ5K,IAAI,gBAAgBk7E,OAC5BtwE,EAAQ5K,IAAI,WACZ4K,EAAQ5K,IAAI,WACZF,KAAKygB,IAAIuhC,YAIjB,CAEQ2mE,UAAUzlB,GAChB,MAAMt5F,KAASinF,OAAUqS,GACzB,OAAO/nE,OAAOvxB,GAAU,EAAIsiB,KAAK4lG,IACnC,4CAn0CWkzE,GAAa5jM,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,IAAAzE,MAAA0E,OAAA1E,MAAA2E,IAAA,+BAAbi/L,EAAa12L,UAAA,eAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,8aATb,CACT,CACErE,QAAS6/L,MACTzmI,SAAU,CACR0mI,8BAA8B,MAGnCnpM,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,syDAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBD/JC1N,MAFJ,QAEIA,CAFC,UAEDA,CAD+C,+BAE7CA,MAAA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAAs6L,qBAAA5xL,EAAA/Q,OAAkC,GAG5CtF,MAAA,yBACEA,MAAA,wBACFA,QAEAA,MAAA,yBACEA,MAAA,wBACFA,QAEAA,MAAA,yBACEA,MAAA,0BACFA,QAEAA,MAAA,0BACEA,MAAA,0BAGNA,YAGEA,MADF,WACEA,CADuC,yBAKrCA,MAAA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAAgoI,oBAAAt/H,EAAAoW,SAAmC,GAE7CzsB,MAAA,0BACFA,QAEAA,MAAA,yBAGEA,MAAA,oBAAAA,aAAAyK,GAAAzK,MAAU2N,EAAA65L,iBAAgB,GAE1BxnM,MAAA,0BACFA,QAWAA,MATA,GAAAopM,GAAA,yBASAppM,CAJC,GAAAqpM,GAAA,aA8BHrpM,QAEAA,MAAA,kBAIIA,MAFJ,YAEIA,CAFgC,uBAEhCA,CAD6D,gBAClDA,MAAA,0BAA4CA,QACvDA,MAAA,sBAEEA,MAAA,6BAAAA,MAAAyK,GAAA,MAAA6+L,EAAAtpM,MAAA,WAAAA,MAAmB2N,EAAAu3L,cAAAoE,EAAAhkM,OAAkC,GAGrDtF,MAAA,GAAAupM,GAAA,qBAGAvpM,MAAA,oBACEA,MAAA,0BAGNA,YACAA,MAAA,GAAAwpM,GAAA,iBAkBFxpM,QACAA,MAAA,kBACAA,MAAA,UACEA,MAAA,GAAAypM,GAAA,iBAcAzpM,MAAA,UACEA,MAAA,4BAQJA,UAEAA,MAAA,aACEA,MAAA,GAAA0pM,GAAA,0BAsBF1pM,QAGEA,MADF,YACEA,CAD6B,gBAK3BA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAAg6L,qBAAoB,GAE7B3nM,MAAA,wCAKGA,MAAA,gBAELA,UAEAA,MAAA,GAAA2pM,GAAA,iBAmBJ3pM,gBAvMMA,MAAA,GAAAA,MAAA,QAAA2N,EAAAizF,aAAA40B,OAEmBx1H,cAAA,QAAA2N,EAAAizF,aAAA40B,OACjBx1H,cAAA,IAAAA,MAAA,qBAAA2N,EAAAizF,aAAA40B,OAAA,KAGiBx1H,MAAA,GAAAA,MAAA,QAAA2N,EAAAizF,aAAA+3F,YACjB34L,cAAA,IAAAA,MAAA,qBAAA2N,EAAAizF,aAAA+3F,YAAA,KAGiB34L,MAAA,GAAAA,MAAA,QAAA2N,EAAAizF,aAAA8wE,SACjB1xK,cAAA,IAAAA,MAAA,sBAAA2N,EAAAizF,aAAA8wE,SAAA,KAGiB1xK,MAAA,GAAAA,MAAA,QAAA2N,EAAAizF,aAAA46D,QACjBx7J,cAAA,IAAAA,MAAA,sBAAA2N,EAAAizF,aAAA46D,QAAA,KAOFx7J,MAAA,GAEAA,MAFA,WAAA2N,EAAAkmI,sBAEA7zI,CAFkC,UAAA2N,EAAAqnI,oBAElCh1I,CAD+B,0BAI/BA,cAAA,IAAAA,MAAA,uCAIAA,MAAA,GACAA,MADA,UAAA2N,EAAAsuL,eACAj8L,CAD0B,0BAI1BA,cAAA,IAAAA,MAAA,6CAICA,MAAA,GAAAA,MAAA,QAAA2N,EAAAi7L,WAQuB5oM,cAAA,OAAA2N,EAAAm6L,YAgCb9nM,MAAA,GAAAA,YAAA,mCAITA,MAAA,GAAAA,MAAA,QAAA2N,EAAAg7L,qBAE8B3oM,MAAA,GAAAA,MAAA,UAAA2N,EAAAotJ,WAI5B/6J,MAAA,GAAAA,MAAA,IAAAA,MAAA,gDAKHA,MAAA,GAAAA,MAAA,OAAA2N,EAAA01L,oBAqBArjM,MAAA,GAAAA,MAAA,OAAA2N,EAAA2tJ,YAAA96I,OAAA+X,WAAA,GAiBCv4B,MAAA,GACAA,MADA,QAAA2N,EAAA2tJ,YACAt7J,CADqB,WAAA2N,EAAA8lI,eAQRzzI,MAAA,GAAAA,MAAA,OAAA2N,EAAAwrL,MAAA3wL,QAAA,GAmCbxI,MAAA,GAAAA,MAAA,aAAAA,MAAA,iCAMDA,MAAA,GAAAA,MAAA,OAAA2N,EAAAkzH,kBAAAv7H,MAAAkD,wBClDHqhD,MAAqBjlD,YACrB2tF,MAAoBh/E,MACpBxF,KACA8a,MAAkBpV,YAClBgoB,MAAc/nB,MACd2nB,KAAW72B,oBACX23B,KAAmB33B,KACnBskB,MAAe4S,YAAAE,MACfvoB,KACA0V,MACA+gC,KAAgBhuB,KAChB3tB,KAAe6tB,UACf/tB,KAAgBguB,KAChB7tB,KAAakuB,KACbnI,MACA8nI,IAAcg4B,IACd3lL,KACAC,KAAiB4lL,MAAA1lL,OAAA,+kEAAA5L,KAAA,CAAAq1C,UAxCP,IACVjsC,OAAQ,YAAa,IACnBmD,OACE,UACA2F,OAAM,CACJysC,QAAS,MACT,EAEJpyC,OACE,YACA2F,OAAM,CACJysC,QAAS,MACT,EAEJlL,OAAW,iBAAkB,IAACC,OAAQ,iBAAc,EACpDD,OAAW,iBAAkB,IAACC,OAAQ,oBAEzC7nC,gBAAA,WAkCUk1L,CAAa,mFCpGnB,IAAMgG,EAA+B,MAAtC,MAAOA,EA+NDj5L,MACmB4jB,UA7NrB2jF,eACA2xF,UAAY,IAAIp+G,KAChB8R,OAAQ,EAER+5C,YACAtD,cACA81D,uBACAC,iBACAC,oBACAzxD,UAAY35I,KAAKqrM,uBAMlBC,cAKE7qL,IAKT,gBACIuhF,CAAat7F,GACf1G,KAAKurM,cAAgB7kM,GACF,IAAf1G,KAAK2+F,QAIT3+F,KAAKwrM,oBACLxrM,KAAKumM,oBACLvmM,KAAK04I,YAAY5iC,UAAUnzG,KAAK3C,KAAKyrM,sBACrCzrM,KAAK0rM,gBACP,CACA,gBAAI1pG,GACF,OAAOhiG,KAAKurM,aACd,CACQA,cAKCI,UAAoB,KAKpB94D,SAAmB,EAK5B,uBACIuD,GACF,OAAOp2I,KAAK4rM,oBACd,CACA,uBAAIx1D,CAAoB1vI,GAEtB,GADA1G,KAAK4rM,qBAAuBllM,GACT,IAAf1G,KAAK2+F,MAIT,IADA3+F,KAAKwrM,qBACAxrM,KAAK4rM,qBACR,OAEA5rM,KAAK0rM,eAFL,CAIJ,CACQE,sBAAgC,EAKxC,wBACIH,GACF,OAAOzrM,KAAK6rM,qBACd,CACA,wBAAIJ,CAAqB/kM,GACvB1G,KAAK6rM,sBAAwBnlM,EAC7B1G,KAAKwrM,oBAELxrM,KAAKumM,oBACLvmM,KAAKw2I,sBAELx2I,KAAK04I,YAAY5iC,UAAUnzG,KAAK3C,KAAKyrM,uBAElB,IAAfzrM,KAAK2+F,OAIJ3+F,KAAKo2I,qBAGVp2I,KAAK0rM,eACP,CACQG,sBAKR,oBACIC,GACF,OAAO9rM,KAAK+rM,iBACd,CACA,oBAAID,CAAiBplM,GACnB1G,KAAK+rM,kBAAoBrlM,EACzB1G,KAAK04I,YAAY3iC,oBAAoBpzG,KAAK+D,EAC5C,CACQqlM,kBAKCC,eAAyC,GAKlD,aACIxwF,CAAU90G,QACE1E,IAAV0E,IACFA,KAAQ22G,SAEVr9G,KAAKisM,WAAavlM,EAElB,MAAMwlM,EAAelsM,KAAKmsM,2BAA2BzlM,GAEnD1G,KAAKkrM,4BADclpM,IAAjBkqM,EAC4BA,EAAavjF,YAEb,MAGb,IAAf3oH,KAAK2+F,QAIT3+F,KAAKwrM,oBACLxrM,KAAKumM,oBACLvmM,KAAKw2I,sBAELx2I,KAAK04I,YAAY5iC,UAAUnzG,KAAK3C,KAAKyrM,sBACrCzrM,KAAK0rM,gBACP,CACA,aAAIlwF,GACF,OAAOx7G,KAAKisM,UACd,CACQA,WAMR,gBACIG,CAAa1lM,GACf1G,KAAKqsM,cAAgB3lM,CACvB,CACA,gBAAI0lM,GACF,OAAOpsM,KAAKqsM,aACd,CACQA,cAMR,SACI3lM,CAAMA,GACR1G,KAAK4pB,OAASljB,GACK,IAAf1G,KAAK2+F,QAILj4F,EACF1G,KAAKssM,oBAAoB5lM,GAEzB1G,KAAKs6G,gBAAgBxzG,OAAM,GAE7B9G,KAAK2wB,SAASjqB,GACd1G,KAAK0rM,gBACL1rM,KAAK+R,MAAM4K,gBACb,CACA,SAAIjW,GACF,OAAO1G,KAAK4pB,MACd,CACQA,OAMR,mBAAI0wF,GACF,OAAOt6G,KAAKs5G,eAAe31D,WAC7B,CAEA,UACI02C,CAAO3zF,GACT,IAAmB,IAAf1G,KAAK2+F,QAGL3+F,KAAKo1I,cAAczxF,aACrB3jD,KAAKo1I,cAAczxF,YAAY9/C,UAE7B7D,KAAKyrM,sBAAsB,CAC7B,IAAIc,EACJ5tK,WAAW,KACT4tK,EAAWvsM,KAAKo1I,cAAc3+B,oBAC1B81F,GACEA,EAASC,YACXD,EAASC,UAAU1lM,QACnB9G,KAAKssM,oBAAoBtsM,KAAK0G,OAAK,EAGtC,EACL,CACF,CAEA3G,YACUgS,EACmB4jB,GADnB31B,KAAA+R,QACmB/R,KAAA21B,iBAEJ3zB,IAAnBhC,KAAK21B,YAGP31B,KAAK21B,UAAUtR,cAAgBrkB,KAEnC,CAOAuN,gBACyBvL,IAAnBhC,KAAKw7G,YACPx7G,KAAKw7G,aAAY6B,cAGOr7G,IAAtBhC,KAAKosM,eACPpsM,KAAKosM,aAAepsM,KAAKw7G,WAG3Bx7G,KAAKysM,oBACLzsM,KAAKumM,oBACLvmM,KAAKw2I,sBAEDx2I,KAAK0G,OACP1G,KAAKssM,oBAAoBtsM,KAAK0G,OAEhC1G,KAAK0rM,gBAEL1rM,KAAK2+F,OAAQ,CACf,CAMAzwF,cAKElO,KAAK2+F,OAAQ,EAEb3+F,KAAKwrM,oBACLxrM,KAAKs6G,gBAAgBxzG,QACrB9G,KAAKygB,IAAI4gC,GAAGkrD,YAAYvsG,KAAKs5G,eAC/B,CAKA+iF,iBAAiBC,GACft8L,KAAK2wB,SAAW2rK,CAClB,CACQ3rK,SAAgBA,OAKxB4rK,kBAAkBD,GAChBt8L,KAAK0sM,UAAYpQ,CACnB,CACQoQ,UAAiBA,OAKzBtQ,WAAW11L,GACT1G,KAAK0G,MAAQA,CACf,CAKQ+lM,oBACNzsM,KAAKs5G,eAAiB,IAAItB,KAAc,CACtCv0F,OAAQ,IAAIy0F,KACZ11D,OAAQ,IACRrsC,MAAO,OAETnW,KAAKygB,IAAI4gC,GAAG2a,SAASh8D,KAAKs5G,eAC5B,CAKQitF,oBACN,MAAMyF,EAAiBxlM,OAAO6H,OAAO,GAAIrO,KAAKgsM,eAAgB,CAC5DhqG,aAAchiG,KAAKgiG,cAAgB,QACnCmV,aAAcn3G,KAAKs5G,eACnBjC,iBAC4B,mBAAnBr3G,KAAKw7G,UACRx7G,KAAKw7G,UACL,CAAC7uB,EAAkCrxB,KACjC,MAAMnlD,EAAQnW,KAAKw7G,UACnB,OAAAx7G,KAAK2sM,6BAA6Bx2L,EAAOmlD,GAClCnlD,KAGjBnW,KAAK04I,YAAc,IAAInjC,KAAYy2F,EACrC,CAKQx1D,sBACN,MAAMw1D,EAAiBxlM,OAAO6H,OAAO,GAAIrO,KAAKgsM,eAAgB,CAC5DvpJ,MAAOziD,KAAKs5G,eACZkC,UAC4B,mBAAnBx7G,KAAKw7G,UACRx7G,KAAKw7G,UACL,CAAC7uB,EAAkCrxB,KACjC,MAAMnlD,EAAQnW,KAAKw7G,UACnB,OAAAx7G,KAAK2sM,6BAA6Bx2L,EAAOmlD,GAClCnlD,KAGjBnW,KAAKo1I,cAAgB,IAAI/7B,KAAc2yF,EACzC,CAKQN,gBACN,IAAIjmL,EAEFA,GADGzlB,KAAK0G,OAAS1G,KAAKgiG,aACXhiG,KAAK04I,YAEL14I,KAAKo1I,cAOd3vH,IAAazlB,KAAKsrM,gBACpBtrM,KAAKwrM,oBACLxrM,KAAK4sM,gBAAgBnnL,GAEzB,CAMQmnL,gBAAgBv0K,GACtBr4B,KAAKsrM,cAAgBjzK,EACrBr4B,KAAKmrM,iBAAmB9yK,EAAQo9E,KAAK5yG,UAAWqgG,GAC9CljG,KAAK6sM,iBAAiB3pG,KAEH,IAAjBljG,KAAK6yI,SAAoBx6G,IAAYr4B,KAAK04I,cAC5C14I,KAAKorM,oBAAsB/yK,EAAQq9E,SAAS7yG,UACzCqgG,GACCljG,KAAK8sM,oBAAoB5pG,KAG/B7qE,EAAQi/E,SAASt3G,KAAKygB,IAAI4gC,IAAI,EAChC,CAKQmqJ,oBACNxrM,KAAK+sM,4BACsB/qM,IAAvBhC,KAAKsrM,eACPtrM,KAAKsrM,cAAch0F,cAASt1G,QAEAA,IAA1BhC,KAAKmrM,kBACPnrM,KAAKmrM,iBAAiBh9L,mBAESnM,IAA7BhC,KAAKorM,qBACPprM,KAAKorM,oBAAoBj9L,cAE3BnO,KAAKsrM,mBAAgBtpM,CACvB,CAMQ6qM,iBAAiB3pG,GACvBljG,KAAK+sM,uBACL/sM,KAAKk7G,cAAchY,EACrB,CAMQ4pG,oBACN5pG,GAE6B,UAAzBA,EAAWjB,WACbjiG,KAAKgtM,qBAAqB9pG,EAE9B,CAOQgY,cAAchY,GACpB,IAAIx8F,OACe1E,IAAfkhG,IAIyB,WAAzBA,EAAWjB,YAEbiB,EAAaljG,KAAKitM,cAAc/pG,IAGlCx8F,EAAQ1G,KAAKirM,UAAUn+G,oBAAoBoW,EAAY,CACrDx+C,kBAAmB1kD,KAAKygB,IAAIuhC,WAC5ByC,eAAgB,cAEdy+C,EAAWhjG,IAAI,YACjBwG,EAAM2zF,OAAS6I,EAAWhjG,IAAI,UAC9BgjG,EAAW7iG,IAAI,SAAUqG,EAAM2zF,SAEjCr6F,KAAKo8L,WAAW11L,GAClB,CAEQumM,cAAc/pG,GACpB,MAAMxhD,EAASwhD,EAAWthD,YACpBskC,EAAczV,KAClB/uB,EACA1hD,KAAKygB,IAAIuhC,WACT,aAEIq4C,EAASnuE,KAAKiwE,MAClB+G,EAAWylB,YAAcz8F,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,EAAY,KAIlEgd,SAAa,IAAI0zB,KAAMl1E,IACZrhD,IAAI,SAAUg6F,GAAQ,GAC1B6I,CACT,CAMQopG,oBAAoBhjH,GAC1B,MAAM4Z,EAAaljG,KAAKirM,UAAU75F,aAAa9nB,EAAU,CACvD7kC,eAAgB,YAChBC,kBAAmB1kD,KAAKygB,IAAIuhC,aAExB2qC,EAAY,IAAIwuB,KAAU,CAC9B7xB,SAAU4Z,IAEZvW,EAAUsX,SAASjkG,KAAKosM,cACxBpsM,KAAKs6G,gBAAgBxzG,QACrB9G,KAAKs6G,gBAAgBx9B,WAAW6P,EAClC,CAKQ0+G,uBACN,OAAO,IAAIttD,KAAU,CACnB11I,QAASC,SAASC,cAAc,OAChCmnC,OAAQ,EAAC,IAAK,IACd5Q,UAAW,CAAC,kBAAmB,2BAA2Bj1B,KAAK,KAC/Dm0I,WAAW,GAEf,CAMQgvD,qBACN9pG,GAGA,MAAMk2C,KADUJ,MAAkB91C,EAAYljG,KAAKygB,IAAIuhC,YAC/Bo3F,QAClB8zD,EACqB,YAAzBhqG,EAAWjB,UACPm3C,EAAQxvI,OAAS,EACjBwvI,EAAQxvI,OAAS,EACjBujM,EAAa/zD,EAAQ8zD,GAErBxwD,KAAcD,MAA0Bv5C,GACxCkqG,GAAiB1wD,EAAYwwD,GACnC,GAA2B,IAAvBxwD,EAAY9yI,aAAmC5H,IAAnBorM,GAE9B,YADAptM,KAAK+sM,uBAIP/sM,KAAK25I,UAAU0D,YAAY+vD,GAAe/qG,sBAE1C,MAAMgrG,MAAYh8D,MAAc87D,EAAY,CAC1C5jE,QAAS,EACTz0C,KAAMq8C,KAAkBI,OACxBR,UAAU,EACVvrI,OAAQ,OAEVxF,KAAK25I,UAAUlsG,aAAan3B,UAAY+2L,QACRrrM,IAA5BhC,KAAK25I,UAAUv7E,UACjBp+D,KAAKygB,IAAI4gC,GAAGw4F,WAAW75I,KAAK25I,UAEhC,CAKQozD,uBACF/sM,KAAK25I,UAAUv7E,aAAsCp8D,IAA5BhC,KAAK25I,UAAUv7E,WAC1Cp+D,KAAKygB,IAAI4gC,GAAGy4F,cAAc95I,KAAK25I,WAC/B35I,KAAK25I,UAAUx4B,YAAOn/G,GAE1B,CAOQ2qM,6BACNvyG,EACA9+B,GAEA,MAAM4wI,EAAelsM,KAAKmsM,2BAA2B/xG,GACrD,QAAqBp4F,IAAjBkqM,EACF,OAEF,MAAMP,EAAY3rM,KAAK2rM,UACvB,IAAItxG,EAEFA,GADGsxG,GAAaA,EAAY,EACnB3rM,KAAKkrM,uBAELS,EAAY,EAAIA,EAAYrwI,EAAaqwI,EAEpDO,EAAatjF,UAAUvuB,EACzB,CAMQ8xG,2BACN/xG,GAEA,IAAI3+B,EAWA6xI,EACJ,OAVE7xI,EADElgD,MAAMC,QAAQ4+E,GACJA,EAAQ,GAERA,EAG6B,mBAA/B3+B,EAAkB+lD,WAC5B/lD,EAAaA,EAAkB+lD,YAIW,mBAAhC/lD,EAAkBmtD,YAC5B0kF,EAAa7xI,GAGR6xI,CACT,4CA9kBWtC,GAA+B5pM,mBAAAuE,KAAA,mCAA/BqlM,EAA+B18L,UAAA,oCAAAC,OAAA,CAAAkS,IAAA,MAAAuhF,aAAA,eAAA2pG,UAAA,YAAA94D,QAAA,UAAAuD,oBAAA,sBAAAq1D,qBAAA,uBAAAK,iBAAA,mBAAAE,eAAA,iBAAAxwF,UAAA,YAAA4wF,aAAA,eAAA1lM,MAAA,QAAA2zF,OAAA,UAAA5rF,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAE,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GC/D5C1N,MAAA,EAAAmsM,EAAA,+DD+DavC,CAA+B,8DE/C1C5pM,MAAA,yBAIEA,MAAA,oBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAkiM,sBAAqB,GAE/BpsM,MAAA,wBACFA,gCAJEA,MADA,UAAAkK,EAAA8qI,oBACAh1I,CAD+B,0BAI/BA,cAAA,IAAAA,MAAA,wFAEFA,MAAA,yBAIEA,MAAA,oBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAmiM,0BAAyB,GAEnCrsM,MAAA,wBACFA,gCAJEA,MADA,UAAAkK,EAAAmgM,qBACArqM,CADgC,0BAIhCA,cAAA,IAAAA,MAAA,6EAqBEA,MAAA,kBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAAijM,GAEAjjM,cAAA,IAAAA,MAAA,uBAAAijM,GAAA,+CApBNjjM,MADF,WACEA,CAD2C,uBAEzCA,MAAA,mCAQFA,QAGEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,QAAA,OAAAA,MAAmBkK,EAAA+nI,oBAAA57H,EAAA/Q,OAAiC,GAEpDtF,MAAA,EAAAssM,GAAA,qBAQNtsM,oCApBMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCAGAA,MAFA,cAAAkK,EAAAqiM,kBAEAvsM,CAFiC,UAEjCA,CADW,kBAAAkK,EAAAy0B,YAAAr5B,OAOXtF,MAAA,GAAAA,MAAA,QAAAkK,EAAAsnI,aAI0BxxI,cAAA,UAAAkK,EAAA4nI,yCA2B1B9xI,MAAA,kBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAAwsM,GAEAxsM,cAAA,IAAAA,MAAA,uBAAAwsM,GAAA,+CApBJxsM,MAFJ,WAEIA,CAFuC,sBAEvCA,CAD6B,mCAO3BA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAASkK,EAAAq9G,YAAW,GAGxBvnH,UAGEA,MADF,sBACEA,CADiC,mBAG/BA,MAAA,2BAAAqW,GAAArW,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAAmBkK,EAAA+nI,oBAAA57H,EAAA/Q,OAAiC,GAEpDtF,MAAA,EAAAysM,GAAA,qBAQNzsM,oCArBMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCAIAA,MAHA,cAAAkK,EAAAi5L,kBAGAnjM,CAHiC,YAGjCA,CAFc,WAAAkK,EAAAmgM,sBAAA,OAAAngM,EAAAy0B,YAAAr5B,OAQdtF,MAAA,GAAAA,MAAA,QAAAkK,EAAAsnI,aAI0BxxI,cAAA,UAAAkK,EAAA4nI,wDAa9B9xI,MAAA,yBAGEA,MAAA,kBAAAqW,GAAArW,MAAA8tB,GAAA,MAAA5jB,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAwiM,iBAAAr2L,GAAwB,GAElCrW,MAAA,wBACFA,oCAJEA,MAAA,QAAA2sM,GAGA3sM,cAAA,IAAAA,MAAA,6BAAA2sM,GAAA,6BAcE3sM,MAAA,wBAA4DA,MAAA,wBAE1DA,eAF0DA,oBAAA,kFAQ1DA,MADF,uBACEA,CADuD,qBAErDA,MAAA,kBAAAqW,GAAArW,MAAAsQ,GAAA,MAAApG,EAAAlK,MAAA,UAAAA,MAAAqW,EAAmBnM,EAAA0iM,eAAiB,KAAI,GAK5C5sM,mCAJIA,QACAA,MADA,UAAAkK,EAAA2iM,gBACA7sM,CAD2B,gBAAAkK,EAAA4iM,kBAAAC,aAAA7iM,EAAA2iM,wCAOjC7sM,MAAA,0CACAA,MAAA,sDAMEA,MADF,qBACEA,CAD0D,WAGxDA,MAAA,eACAA,MAAA,GACAA,MAAA,qBAGEA,MADA,iBAAAqW,GAAArW,aAAAwrD,GAAAxrD,MAASqW,EAAAgX,kBAAwB,EACjCrtB,CADkC,kBAAAqW,GAAA,MAAA22L,EAAAhtM,MAAAwrD,GAAAr8C,UAAAjF,EAAAlK,MAAA,UAAAA,MAAAqW,EACfnM,EAAA+iM,eAAAD,GAAuB,KAAI,GAKpDhtM,mDATIA,MAAA,GAAAA,MAAA,IAAAgtM,EAAAp/K,KAAA,KAKE5tB,cAAA,UAAAkK,EAAA4iM,kBAAAI,WAAAF,8CASFhtM,MAFJ,yBAEIA,CAF6D,WAE7DA,CADyB,eACDA,MAAA,yBAAAmtM,EAAAntM,MAAA8tD,GAAA3+C,UAAAjF,EAAAlK,MAAA,UAAAA,MAASkK,EAAA8jH,cAAAm/E,GAAmB,GAClDntM,MAAA,cAAUA,MAAA,GAGZA,UACAA,MAAA,GACAA,MAAA,qBAEEA,MAAA,kBAAAqW,GAAA,MAAA82L,EAAAntM,MAAA8tD,GAAA3+C,UAAAjF,EAAAlK,MAAA,UAAAA,MAAAqW,EAAmBnM,EAAAkjM,gBAAAD,GAAwB,KAAI,GAKnDntM,UACAA,MAAA,WAIEA,MAAA,MAEJA,iDAnBgBA,MAAA,GAAAA,MAAAkK,EAAAmjM,YAAAC,WAAAH,GAAA,+BAIZntM,cAAA,IAAAmtM,EAAAv/K,KAAA,KAIE5tB,QACAA,MADA,UAAAkK,EAAA2iM,cAAAM,GACAntM,CAD+B,gBAAAkK,EAAAqjM,oBAAAJ,KAAAjjM,EAAA2iM,cAAAM,IAOjCntM,cAAA,0BAAAkK,EAAAmjM,YAAAC,WAAAH,+BA5DNntM,MAPF,WAOEA,CADD,eAGGA,MAAA,MACEA,MAAA,EAAAwtM,GAAA,kCAMFxtM,MAAA,MACEA,MAAA,EAAAytM,GAAA,kCAWFztM,MADA,EAAA0tM,GAAA,wBACA1tM,CADoD,EAAA2tM,GAAA,kBAEtD3tM,QAEAA,MAAA,iBAkBEA,MAhBA,EAAA4tM,GAAA,uBAgBA5tM,CAhB4D,GAAA6tM,GAAA,+BAwChE7tM,gCA9CqBA,MAAA,GAAAA,MAAA,kBAAAkK,EAAA4jM,kBACa9tM,cAAA,mBAAAkK,EAAA4jM,kBAGtB9tM,QAA0BA,MAA1B,aAAAkK,EAAA+qB,WAA0Bj1B,CAAD,cAAAkK,EAAAmjM,aAkBgBrtM,MAAA,GAAAA,MAAA,qBAAAkK,EAAA6jM,oDA2BnD/tM,MAAA,eAKEA,MAAA,mBAAAA,MAAA+wB,GAAA,MAAA7mB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA8jM,cAAa,GAEtBhuM,MAAA,wBACFA,gCAJEA,MAAA,WAAAkK,EAAA+jM,uBAGAjuM,cAAA,IAAAA,MAAA,wFAGFA,MAAA,eAKEA,MAAA,mBAAAA,MAAAivB,GAAA,MAAA/kB,EAAAlK,QAAA,OAAAA,MAASkK,EAAAgkM,gBAAe,GAExBluM,MAAA,wBACFA,gCAJEA,MAAA,kBAAAkK,EAAAy0B,YAAAr5B,OAGAtF,cAAA,IAAAA,MAAA,sFAgCJA,MAAA,oCAMEA,MAAA,mBAAAA,MAAAmuD,GAAA,MAAAjkD,EAAAlK,QAAA,OAAAA,MAASkK,EAAAikM,oBAAmB,GAE5BnuM,MAAA,cAAUA,MAAA,iBACZA,eAJEA,MAAA,aAAAA,MAAA,yFAUAA,MAAA,oCAKEA,MAAA,mBAAAA,MAAAqvB,GAAA,MAAAnlB,EAAAlK,MAAA,UAAAA,MAASkK,EAAAikM,oBAAmB,GAE5BnuM,MAAA,cAAUA,MAAA,iBACZA,eAJEA,MAAA,aAAAA,MAAA,yFARJA,MAAA,YAIEA,MAAA,EAAAouM,GAAA,iBASApuM,MAAA,yBAIEA,MAAA,8BAAAqW,GAAArW,MAAA6mL,GAAA,MAAA38K,EAAAlK,QAAA,OAAAA,MAAsBkK,EAAAmkM,aAAArhM,KAAAqJ,GAAyB,GAGnDrW,kCAfKA,cAAA,OAAAkK,EAAAokM,eAUDtuM,QACAA,MADA,WAAAkK,EAAAupI,cACAzzI,CAD0B,QAAAkK,EAAA4E,QCzJvB,IAAMy/L,GAA0B,MAAjC,MAAOA,EAyOD59L,MACA69L,qBACAhuM,eACAD,gBA3OD8e,IAET,QACIjd,GACF,OAAOxD,KAAKk6I,KACd,CACA,QAAI12I,CAAKA,GACPxD,KAAKk6I,MAAQ12I,EACb,MAAMyb,EAAQjf,KAAK6vM,cAAc76J,UAC9Bq0C,GAASA,IAAUrpF,KAAKwD,MAkB3B,GAhBAxD,KAAKgiG,aAAehiG,KAAK6vM,cAAc5wL,GACvCjf,KAAK+/B,YAAYmB,QACjBlhC,KAAKq6F,YAASr4F,EACdhC,KAAK8vM,WAAWntM,KAAK,MACrB3C,KAAK+vM,WAAWptM,UAAKX,GAGjBhC,KAAKwD,OAASovK,EAAkBC,YAKlC7yK,KAAK+/B,YAAYxI,SAJgB,CAC/B/zB,KAAM,QACN0iF,YAAa,KAMblmF,KAAKwD,OAASovK,EAAkBh8C,MAClC52H,KAAKq6F,OAAS,IACdr6F,KAAKukM,kBAAkBhtK,SAASv3B,KAAKq6F,QACrCr6F,KAAKgwM,WAAa,CAChBllM,EACAwwD,KAEA,MAAM+tB,EAAOv+E,EAAQqiF,cACfjH,EAAczV,KAClB4Y,EAAKxnC,iBACL7hD,KAAKygB,IAAIuhC,WACT,aAEF,OAAO,IAAIo4C,MAAc,CACvBrO,MAAO,IAAIqO,KAAe,CACxBC,OACEr6F,KAAKq6F,OACLnuE,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,EAAY,IACvC5qB,EACF8f,OAAQ,IAAIgf,KAAe,CACzBl7D,MAAO,EACP3zB,MAAO,sBAETiwE,KAAM,IAAI4e,KAAa,CACrB7uF,MAAO,8BAGZ,EAEHvL,KAAKosM,aAAepsM,KAAKgwM,WACzBhwM,KAAK+vM,WAAWptM,KAAK3C,KAAKosM,kBACrB,CAELpsM,KAAKq6F,YAASr4F,EACdhC,KAAKiwM,UAAY,IACR,IAAI71G,MAAc,CACvBhf,OAAQ,IAAIgf,KAAe,CACzBl7D,MAAO,EACP3zB,MAAO,sBAETiwE,KAAM,IAAI4e,KAAa,CACrB7uF,MAAO,6BAIb,MAAMA,EAAQ,CAAC,EAAG,IAAK,KACjBiwG,EAAYA,IACT,IAAIphB,MAAc,CACvBrO,MAAO,IAAIqO,KAAe,CACxBC,OAAQ,EACRjf,OAAQ,IAAIgf,KAAe,CACzBl7D,MAAO,EACP3zB,MAAO,sBAETiwE,KAAM,IAAI4e,KAAa,CACrB7uF,MAAO,6BAGX6vE,OAAQ,IAAIgf,KAAe,CACzB7uF,MAAOA,EAAMoV,OAAO,CAAC,IACrBue,MAAO,IAETs8C,KAAM,IAAI4e,KAAa,CACrB7uF,MAAOA,EAAMoV,OAAO,CAAC,SAI3B3gB,KAAKosM,aAAepsM,KAAKiwM,UACzBjwM,KAAK+vM,WAAWptM,KAAK64G,EACvB,CACAx7G,KAAKkwM,cAAcvtM,KAAK3C,KAAKosM,aAC/B,CACQlyD,MAECi2D,UAEAvpE,KAEAxc,QAET,SACIl6G,GACF,OAAOlQ,KAAKowM,MACd,CACA,SAAIlgM,CAAMA,GACRlQ,KAAKowM,OAASlgM,EACdlQ,KAAKowM,OAAO3rL,UAAU5hB,UAAU,KAC9B7C,KAAK+R,MAAM4K,eAAa,EAE5B,CACQyzL,OAMR,gBAAIl9D,GACF,MAAO,CAAC/B,KAAkBI,OAAQJ,KAAkBK,WACtD,CAES1xF,OAAkB,GAElBq8G,UAAqB,GAE9B,kBACIk0C,GACF,OAAOrwM,KAAKswM,eACd,CACA,kBAAID,CAAe3pM,GACjB1G,KAAKswM,gBAAkB5pM,CACzB,CACQ4pM,gBAEEC,aAAe,IAAIjjM,MAEnBkjM,eAAiB,IAAIljM,MAErBmjM,eAAiB,IAAInjM,MAErBojM,cAAgB,IAAIpjM,MAEpBqjM,YAAc,IAAIrjM,MAClBsjM,qBAAuB,IAAItjM,MAC3B2lI,kBAAoB,IAAI3lI,MAExBujM,YAAc,IAAIvjM,MAClBwjM,gBAAkB,IAAIxjM,MACtBw+L,iBAAmB,IAAIx+L,MAEvByjM,iBAAmB,IAAIzjM,MAEvB0jM,iBAAmB,IAAI1jM,MAEvB24C,OAAS,IAAI34C,MAEb2jM,cAAgB,IAAI3jM,MACpBmiM,aAAe,IAAIniM,MAEtB6mK,SAAoC,CACzCpB,EAAsBC,QACtBD,EAAsBE,WAEjBi+B,iBACLn+B,EAAsBC,QACjBm+B,sBAEP1C,YACE,IAAI2C,KAA0CC,GAASA,EAAK5wK,UAGvDyuK,iBAA6B,CAAC,OAAQ,UACtCoC,UAAqC,GACrCtwK,OAAmB,GACnBuwK,UAAqC,GACrCl7K,WAAa,IAAIm7K,MACjBtD,kBAAoB,IAAIuD,MAC7B,EACA,IAIFC,OAA2C,IAAI3vM,UAAgBC,GAC/D8tM,WAAsC,IAAI/tM,KAAgB,MAC1DmuM,cAEI,IAAInuM,UAAgBC,GACxB+tM,WAEI,IAAIhuM,UAAgBC,GAEhB2vM,QACAC,gBACAC,gBAED9xK,YAAc,IAAI2zB,KAClBsuC,aACA8vG,mBAAoB,EACpBjC,cAAgC,CACrC/V,GAAaljE,MACbkjE,GAAahnB,SAERi/B,gBAAiB,EACjBpG,UAAoB,KACpBqG,qBAAuB,GACvBn/D,SAAU,EACVuD,qBAAsB,EACtBq1D,sBAAuB,EACvBjwF,UACAy2F,SACA7F,aACA4D,WACAC,UAEA51G,OACAr/B,OAAiB,EACjBupI,kBAAoB,IAAI7wI,KACxBi6I,kBAAoB,IAAIj6I,KAExBk/E,YAAiCzB,KAAkBI,OACnD2gE,eAEAxC,eAAgB,EAChB76D,cAEP90I,YACUgS,EACA69L,EACAhuM,EACAD,GAHA3B,KAAA+R,QACA/R,KAAA4vM,uBACA5vM,KAAA4B,iBACA5B,KAAA2B,iBACP,CAEH4L,WACEvN,KAAK4vM,qBACF37B,oBACApxK,UAAW+wC,IACV,UAAW/b,KAAQ+b,EACjB5zC,KAAKsxM,UAAUhqM,KAAKuwB,GACpB73B,KAAKsxM,UAAU9uL,KAAK,CAAC8/B,EAAGC,KACfD,EAAEtzB,KAAKmjL,cAAc5vJ,GAAEvzB,OAGlChvB,KAAKghC,OAAO15B,KACVtH,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,4BAEzC,MAAMulK,EAAgC,CACpCpjL,KAAMhvB,KAAKghC,OAAO,GAClBP,SAAU,IAEZzgC,KAAKuxM,UAAUjqM,KAAK8qM,GACpBpyM,KAAKsxM,UAAU/2L,QAAS83L,IAClBA,EAAMpxK,QAA8C,IAArCjhC,KAAKghC,OAAOt4B,QAAQ2pM,EAAMpxK,SAC3CjhC,KAAKghC,OAAO15B,KAAK+qM,EAAMpxK,OAKvBjhC,KAAKuxM,UAAUjqM,KAJyB,CACtC0nB,KAAMqjL,EAAMpxK,MACZR,SAAU,MAKT4xK,EAAMpxK,QAEPoxK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,8BAEJwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,wBACzCwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,2BAEJwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,4BAEJwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,6BAEJwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,2BAEJwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,wBACzCwlK,EAAMrjL,OACJhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,2BAGJwlK,EAAMpxK,MAAQmxK,EAAOpjL,KAErBqjL,EAAMrjL,OACNhvB,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,0BAEvCwlK,EAAMpxK,MAAQjhC,KAAK2B,gBAAgB4pB,UAAUshB,QAC3C,yCAQF7sC,KAAKuxM,UAAUjqM,KALyB,CACtC0nB,KAAMqjL,EAAMrjL,KACZyR,SAAU,GACVhd,OAAQ4uL,EAAM5uL,UAKpBzjB,KAAKuxM,UAAU/uL,KAAK,CAAC8/B,EAAGC,KACfD,EAAEtzB,KAAKmjL,cAAc5vJ,GAAEvzB,MAC/B,GAEHhvB,KAAKuxM,UAAUh3L,QAAS65J,IACtB,UAAWi+B,KAASryM,KAAKsxM,UACnBe,EAAMpxK,QAAUmzI,EAASplJ,MAC3BolJ,EAAS3zI,SAASn5B,KAAK+qM,EAAK,EAGjC,GAGLryM,KAAKq2B,WAAWpyB,KAAOjE,KAAKuxM,UAE5BvxM,KAAK8vM,WAAWntM,KAAK,MACrB3C,KAAK0xM,OAAO/uM,KACV3C,KAAK+/B,YAAYr5B,MAAQ1G,KAAK+/B,YAAYr5B,WAAQ1E,GAEpDhC,KAAK2xM,QAAU3xM,KAAK+/B,YAAYxH,aAAa11B,UAC1C6D,IACKA,GACF1G,KAAK0xM,OAAO/uM,KAAK+D,GACjB1G,KAAKiyM,SAAWjyM,KAAK+/B,YAAYr5B,MACb,IAAhB1G,KAAKg7D,SACPh7D,KAAK0wM,cAActiM,KAAKpO,KAAKiyM,UAC7BjyM,KAAK2tM,kBAAkBp2K,SAASv3B,KAAKg7D,WAGvCh7D,KAAK0xM,OAAO/uM,UAAKX,GACjBhC,KAAKiyM,cAAWjwM,KAKtBhC,KAAK0xM,OAAO7uM,UAAU,KACpB7C,KAAK2oH,YACL3oH,KAAK+R,MAAM4K,eAAa,GAG1B3c,KAAK4xM,gBAAkB5xM,KAAKukM,kBAAkBhsK,aAAa11B,UAAU,KACnE7C,KAAK2oH,YACL3oH,KAAK+R,MAAM4K,eAAa,GAG1B3c,KAAK6xM,gBAAkB7xM,KAAK2tM,kBAAkBp1K,aAC3Cx0B,QAAKof,MAAa,MAClBtgB,UAAW6D,IAER1G,KAAK4yI,cAAgBzB,KAAkBI,QACvC7qI,EAAQ,GACRA,GAAS,KAET1G,KAAKg7D,OAASt0D,EACd1G,KAAK2wM,YAAYviM,KAAK1H,GACtB1G,KAAK4vM,qBACFh7B,mBAAmB50K,KAAKiyM,SAAUr/B,EAAkBE,QAASpsK,GAC7D7D,UAAWyvM,IACVtyM,KAAKkyM,eAAiBI,EACtBtyM,KAAK4wM,qBAAqBxiM,KAAKpO,KAAKkyM,eAAc,IAGtDlyM,KAAK4yI,cAAgBzB,KAAkBK,YACvC9qI,EAAQ,GACRA,GAAS,KAET1G,KAAKg7D,OAASt0D,EACd1G,KAAK2wM,YAAYviM,KAAK1H,GACtB1G,KAAK4vM,qBACFh7B,mBACC50K,KAAKiyM,SACLr/B,EAAkBE,QACV,IAARpsK,GAED7D,UAAWyvM,IACVtyM,KAAKkyM,eAAiBI,EACtBtyM,KAAK4wM,qBAAqBxiM,KAAKpO,KAAKkyM,eAAc,IAEnC,IAAVxrM,GACT1G,KAAKg7D,OAASt0D,EACd1G,KAAK2wM,YAAYviM,KAAK1H,GACtB1G,KAAK0wM,cAActiM,KAAKpO,KAAKiyM,YAE7BvrM,EAAQ,GACP1G,KAAK4yI,cAAgBzB,KAAkBI,QAAU7qI,EAAQ,KACzD1G,KAAK4yI,cAAgBzB,KAAkBK,YAAc9qI,EAAQ,OAE9D1G,KAAK2tM,kBAAkBp2K,SAAS,GAChCv3B,KAAKg7D,OAAS,EACdh7D,KAAK4B,eAAe8D,MAClB,oCACA,iCAA+B,GAKvC,MAAM6sM,EAAyB,IAAIjqL,MAAmC,IAChEkqL,EAAoB,IAAIlpG,MAA8B,CAC1D7mD,MAAO,IAAIsZ,MAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,MACZ3lD,WAAOnU,EACP2nD,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,IAEb56E,IAAKzgB,KAAKygB,IACV0vE,aAAc,GACdyK,OAAQC,MAAc59E,QACtBk7H,MAAM,EACNptC,SAAS,IAGX/qG,KAAKkQ,MAAMqV,YAAYitL,GAAmB,GAC1CxyM,KAAKkQ,MAAMqV,YAAYgtL,GAAwB,EACjD,CAMArkM,cACElO,KAAK2xM,QAAQxjM,cACbnO,KAAK4xM,gBAAgBzjM,cACrBnO,KAAK6xM,gBAAgB1jM,cACrBnO,KAAK+R,MAAM0gM,SACPzyM,KAAK4xM,iBACP5xM,KAAK4xM,gBAAgBzjM,cAEnBnO,KAAK2xM,SACP3xM,KAAK2xM,QAAQxjM,aAEjB,CAEA2/L,iBAAiBpkL,GACf1pB,KAAKkxM,iBAAmBxnL,EAAMhjB,MAC9B1G,KAAKwwM,eAAepiM,KAAKpO,KAAKkxM,iBAChC,CAMA79D,oBAAoBv+C,GACdA,IAAS90F,KAAK4yI,cAGhB5yI,KAAK4yI,YAAc99C,EACnB90F,KAAKizI,kBAAkB7kI,KAAKpO,KAAK4yI,aAC7B5yI,KAAKkqM,YAEHlqM,KAAK2tM,kBAAkBp2K,SAD3Bv3B,KAAK4yI,cAAgBzB,KAAkBI,OAC4B,IAA/BvxI,KAAK2tM,kBAAkBjnM,MAErD1G,KAAK2tM,kBAAkBjnM,MAAQ,KAE5B1G,KAAKgqM,WAEVhqM,KAAKukM,kBAAkBhtK,SAD3Bv3B,KAAK4yI,cAAgBzB,KAAkBI,OAC4B,IAA/BvxI,KAAKukM,kBAAkB79L,MAErD1G,KAAKukM,kBAAkB79L,MAAQ,KAI3C,CAEAgsM,eACE,OAAO1yM,KAAKwD,OAASovK,EAAkBC,UACzC,CAEAq3B,YACE,OAAOlqM,KAAKwD,OAASovK,EAAkBE,OACzC,CAEAk3B,UACE,OAAOhqM,KAAKwD,OAASovK,EAAkBh8C,KACzC,CAEAu4E,SAAS/sI,EAAWivI,GAClB,QAAIA,EAAK5wK,UACA4wK,EAAK5wK,SAAS72B,MAGzB,CAEAwlH,cAAciiF,GACZrxM,KAAKyuM,YAAYC,WAAW2C,GACxBrxM,KAAKyuM,YAAYkE,SAAStB,GAC1BrxM,KAAKyuM,YAAYvjF,OAAOmmF,EAC9B,CAEApD,cAAcoD,GACZ,IAAIuB,EACAC,EAAW,EA8Bf,OA7BKxB,GAiBHuB,EAAcvB,EAAK5wK,SAAS72B,OAC5BynM,EAAK5wK,SAASlmB,QAASkmB,IAEnBzgC,KAAKkuM,kBAAkB1lL,SAASpG,KAC7BgyJ,GAAaA,IAAa3zI,IAG7BoyK,QAvBJD,EAAc5yM,KAAKkuM,kBAAkB1lL,SAAS5e,OAC9C5J,KAAKuxM,UAAUh3L,QAAS65J,KACqB,IAAvCp0K,KAAKghC,OAAOt4B,QAAQ0rK,EAASplJ,OAC/B6jL,MAGJ7yM,KAAKsxM,UAAU/2L,QAASkmB,IAEnBzgC,KAAKuxM,UAAUnvL,KACbgyJ,GAAaA,EAAS3wJ,SAAWgd,EAAShd,SAG7CovL,OAgBFA,GAAY,GACPD,IAAgBC,CAI3B,CAEAlE,oBAAoB0C,GAClB,IAAIyB,GAAO,EACXzB,SAAK5wK,SAASlmB,QAAS83L,IAEnBryM,KAAKkuM,kBAAkB1lL,SAASpG,KAC7BgyJ,GAAaA,EAAS3wJ,SAAW4uL,EAAM5uL,UAG1CqvL,GAAO,KAGJA,CACT,CAKA9E,eACEhuM,KAAKiuM,gBAAkBjuM,KAAKkuM,kBAAkBpnM,QAAU9G,KAAK6oD,YAE7D,MAAMkqJ,EAAiD,GACvD,UAAW3+B,KAAYp0K,KAAKkuM,kBAAkB1lL,SAC5CuqL,EAAsBzrM,KAAK8sK,GAGzBp0K,KAAKiuM,gBACPjuM,KAAKuxM,UAAUh3L,QAAS65J,IAClBp0K,KAAKmvM,SAAS,EAAG/6B,IACnBp0K,KAAKyuM,YAAYvjF,OAAOkpD,EAAQ,GAIpCp0K,KAAKuxM,UAAUh3L,QAAS65J,IAClBp0K,KAAKmvM,SAAS,EAAG/6B,IACnBp0K,KAAKyuM,YAAYkE,SAASv+B,EAAQ,GAIxCp0K,KAAKywM,eAAeriM,KAAK2kM,EAC3B,CAEAlqJ,UAAUwoJ,GACHA,EAgBCrxM,KAAKmvM,SAAS,EAAGkC,IACnBA,EAAK5wK,SAASlmB,QAASkmB,GACrBzgC,KAAKkuM,kBAAkBjhL,OAAOwT,KAjBlCzgC,KAAKuxM,UAAUh3L,QAAS65J,KACqB,IAAvCp0K,KAAKghC,OAAOt4B,QAAQ0rK,EAASplJ,OAC/BhvB,KAAKkuM,kBAAkBjhL,OAAOmnJ,EAAQ,GAG1Cp0K,KAAKsxM,UAAU/2L,QAASkmB,IAEnBzgC,KAAKkuM,kBAAkB1lL,SAASpG,KAC9BgyJ,GAAaA,EAAS3wJ,SAAWgd,EAAShd,SAG7CzjB,KAAKkuM,kBAAkBjhL,OAAOwT,EAAQ,GAU9C,CAEA+tK,gBAAgB6C,GACdrxM,KAAKiuM,cAAcoD,GACfA,EAAK5wK,SAASlmB,QAAS83L,GAAUryM,KAAKkuM,kBAAkBxZ,SAAS2d,IACjEryM,KAAK6oD,UAAUwoJ,GAEnB,MAAM0B,EAAiD,GACvD,UAAW3+B,KAAYp0K,KAAKkuM,kBAAkB1lL,SAC5CuqL,EAAsBzrM,KAAK8sK,GAE7Bp0K,KAAKyuM,YAAYvjF,OAAOmmF,GACxBrxM,KAAKywM,eAAeriM,KAAK2kM,EAC3B,CAKA1E,eAAe2E,GACb,IAAIxqL,GAAW,OAIPxmB,IAFNhC,KAAKkuM,kBAAkB1lL,SAASpG,KAC7BgyJ,GAAaA,EAAS3wJ,SAAWuvL,EAAavvL,UAGjD+E,GAAW,GAGbxoB,KAAKsxM,UAAU/2L,QAASkmB,IAClBA,IAAauyK,IAA6B,IAAbxqL,GAC/BxoB,KAAKkuM,kBAAkBjhL,OAAOwT,GAE5BA,IAAauyK,IAA6B,IAAbxqL,GAC/BxoB,KAAKkuM,kBAAkBxZ,SAASj0J,EAAQ,GAG5CzgC,KAAKuxM,UAAUh3L,QAAS65J,IAClBA,IAAa4+B,IAA6B,IAAbxqL,GAC/BxoB,KAAKkuM,kBAAkBjhL,OAAOmnJ,GAE5BA,IAAa4+B,IAA6B,IAAbxqL,GAC/BxoB,KAAKkuM,kBAAkBxZ,SAAStgB,EAAQ,GAI5C,MAAM2+B,EAAiD,GACvD,UAAW3+B,KAAYp0K,KAAKkuM,kBAAkB1lL,SAC5CuqL,EAAsBzrM,KAAK8sK,GAE7Bp0K,KAAKywM,eAAeriM,KAAK2kM,EAC3B,CAEAvF,sBACExtM,KAAKo2I,qBAAuBp2I,KAAKo2I,mBACnC,CAEAq3D,0BACEztM,KAAKyrM,sBAAwBzrM,KAAKyrM,qBAClCzrM,KAAK8wM,gBAAgB1iM,KAAKpO,KAAKyrM,sBAC3BzrM,KAAKgqM,WACPhqM,KAAK8rM,iBAAiB19L,MAAMpO,KAAKyrM,sBAC7BzrM,KAAKyrM,uBACPzrM,KAAKkwM,cAAcvtM,UAAKX,GACxBhC,KAAK+vM,WAAWptM,UAAKX,KAGvBhC,KAAK8rM,iBAAiB19L,MAAK,EAE/B,CAKA6kM,qBACOjzM,KAAK0yM,iBACJ1yM,KAAKg7D,OAAS,GAChBh7D,KAAKkyM,eAAe7zL,KAAO,CACzBnM,QAAIlQ,EACJ4J,MAAO,QAET5L,KAAKkyM,eAAe76K,WAAa,CAC/B84H,IAAK,OACL3sJ,KAAMxD,KAAKwD,MAEbxD,KAAK0wM,cAActiM,KAAKpO,KAAKkyM,kBAE7BlyM,KAAKiyM,SAAS5zL,KAAO,CACnBnM,QAAIlQ,EACJ4J,MAAO,QAET5L,KAAKiyM,SAAS56K,WAAa,CACzB84H,IAAK,OACL3sJ,KAAMxD,KAAKwD,MAEbxD,KAAK0wM,cAActiM,KAAKpO,KAAKiyM,YAG7BjyM,KAAKgqM,UACPhqM,KAAK6wM,YAAYziM,KAAKpO,KAAKq6F,QAClBr6F,KAAKkqM,aACdlqM,KAAK2wM,YAAYviM,KAAKpO,KAAKg7D,QAE7Bh7D,KAAKuwM,aAAaniM,OAClBpO,KAAKkQ,MAAMuU,UAAU1gB,QAAKof,MAAa,MAAMtgB,UAAW6D,IAClDA,EAAMkD,QAAU5J,KAAK8/C,OAAOl2C,SAAW5J,KAAKqwM,eAAiB,IAC/DrwM,KAAKixM,cAAc7iM,OACnBpO,KAAKkzM,sBAAmB,EAG9B,CAKAC,cACEnzM,KAAKoqH,SAAU,EACXpqH,KAAKkQ,OACPlQ,KAAKkQ,MAAMpJ,SAET9G,KAAKgqM,WAAahqM,KAAKkqM,eACzBlqM,KAAKiyM,cAAWjwM,EAChBhC,KAAK+/B,YAAYmB,SAEnBlhC,KAAK2tM,kBAAkBp2K,SAAS,GAChCv3B,KAAKg7D,OAAS,EACdh7D,KAAK2wM,YAAYviM,KAAK,GACtBpO,KAAK+wM,iBAAiB3iM,OACtBpO,KAAKoqH,SAAU,EACfpqH,KAAK60I,mBAAgB7yI,CACvB,CAEAstM,gBACEtvM,KAAK+/B,YAAYmB,QACjBlhC,KAAK2tM,kBAAkBp2K,SAAS,GAChCv3B,KAAKg7D,OAAS,CAChB,CAKAo0I,cACEpvM,KAAKkuM,kBAAkBpnM,QACvB9G,KAAK2tM,kBAAkBp2K,SAAS,GAChCv3B,KAAKg7D,OAAS,EACdh7D,KAAK2wM,YAAYviM,KAAK,GACtBpO,KAAKywM,eAAeriM,KAAK,IACzBpO,KAAKgxM,iBAAiB5iM,MACxB,CAKAglM,sBACE,GAAIpzM,KAAKwD,OAASovK,EAAkBC,WAAY,CAC9C,GAAI7yK,KAAKkxM,mBAAqBn+B,EAAsBC,cAC3BhxK,IAAnBhC,KAAKmwM,gBAAyCnuM,IAAdhC,KAAK4mI,KACvC,OAAO5mI,KAAKoqH,QAGhB,GAAIpqH,KAAKkxM,mBAAqBn+B,EAAsBE,gBAE7BjxK,IAAnBhC,KAAKmwM,gBACSnuM,IAAdhC,KAAK4mI,MACL5mI,KAAKkuM,kBAAkB1lL,SAAS5e,OAAS,EAEzC,OAAO5J,KAAKoqH,OAGlB,CACA,GACEpqH,KAAKwD,OAASovK,EAAkBE,SAChC9yK,KAAKwD,OAASovK,EAAkBh8C,MAChC,CACA,GACE52H,KAAKkxM,mBAAqBn+B,EAAsBC,SACrB,OAA3BhzK,KAAK+/B,YAAYr5B,MAEjB,OAAO1G,KAAKoqH,QAEd,GAAIpqH,KAAKkxM,mBAAqBn+B,EAAsBE,WAEhDjzK,KAAKkuM,kBAAkB1lL,SAAS5e,OAAS,GACd,OAA3B5J,KAAK+/B,YAAYr5B,MAEjB,OAAO1G,KAAKoqH,OAGlB,CACA,OAAO,CACT,CAEAilF,sBACE,IAAIl2K,GAAU,EACd,OACKA,EADLn5B,KAAKkxM,mBAAqBn+B,EAAsBC,aACdhxK,IAAnBhC,KAAKmwM,eAEKnuM,IAAnBhC,KAAKmwM,WACsC,IAA3CnwM,KAAKkuM,kBAAkB1lL,SAAS5e,OAE/BuvB,CACT,CAKAwvF,YACE,IAAI0qF,EASJ,GANOA,EAFwB,OAA3BrzM,KAAK+/B,YAAYr5B,MACnB1G,KAAK4yI,cAAgBzB,KAAkBI,OACtBvxI,KAAK+/B,YAAYr5B,MAAM2zF,OACvBr6F,KAAK+/B,YAAYr5B,MAAM2zF,OAAS,SAErCr4F,EAGVhC,KAAKwD,OAASovK,EAAkBh8C,MAAO,CACzC,GAAK52H,KAAKyrM,sBAoBR,GAAI4H,EAAW,CACb,GAAIA,GAAa,IAMf,OALArzM,KAAK4B,eAAe8D,MAClB,oCACA,sCAEF1F,KAAK+/B,YAAYmB,QAGnB,GAAImyK,IAAcrzM,KAAKukM,kBAAkB79L,MAEvC,YADA1G,KAAKukM,kBAAkBhtK,SAAS87K,EAGpC,UA/BErzM,KAAKukM,kBAAkB79L,MAAQ,GAC9B1G,KAAK4yI,cAAgBzB,KAAkBI,QACtCvxI,KAAKukM,kBAAkB79L,OAAS,KACjC1G,KAAK4yI,cAAgBzB,KAAkBK,YACtCxxI,KAAKukM,kBAAkB79L,OAAS,IAWlC,OATA1G,KAAK4B,eAAe8D,MAClB,oCACA,iCAEF1F,KAAKq6F,OAAS,IAEVr6F,KAAKukM,kBAAkBhtK,SAD3Bv3B,KAAK4yI,cAAgBzB,KAAkBI,OACHvxI,KAAKq6F,OACLr6F,KAAKq6F,OAAS,UAClDr6F,KAAK8vM,WAAWntM,KAAK3C,KAAKq6F,QAmB1Br6F,KAAK4yI,cAAgBzB,KAAkBI,QACzCvxI,KAAKq6F,OAASr6F,KAAKukM,kBAAkB79L,MACrC1G,KAAK8vM,WAAWntM,KAAK3C,KAAKq6F,UAE1Br6F,KAAKq6F,OAAwC,IAA/Br6F,KAAKukM,kBAAkB79L,MACrC1G,KAAK8vM,WAAWntM,KAAmB,IAAd3C,KAAKq6F,SAE5Br6F,KAAKkwM,cAAcvtM,KAAK3C,KAAKgwM,YAC7BhwM,KAAK+vM,WAAWptM,KAAK3C,KAAKgwM,WAC5B,CACF,CAEAT,oBACEvvM,KAAK0vM,eAAiB1vM,KAAK0vM,aAC7B,CAEQwD,sBACN,MAAMI,EAAa,CACjBtkL,KAAM,aACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,8BAEFl2B,SAAUqG,MAA0BG,iBAEhCo2L,EAAa,CACjBvkL,KAAM,iBACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,uCAEFl2B,SAAUqG,MAA0BG,iBAItCnd,KAAK60I,cAAgB,CACnBnoH,WAAW,EACXlK,MAAM,EACNmU,QALc,CAAC28K,EAAYC,GAO/B,4CAj4BW5D,GAA0BvuM,mBAAAuE,GAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,+BAA1B8pM,EAA0BrhM,UAAA,8BAAAC,OAAA,CAAAkS,IAAA,MAAAjd,KAAA,OAAA2sM,UAAA,YAAAvpE,KAAA,OAAAxc,QAAA,UAAAl6G,MAAA,QAAA4vC,OAAA,SAAAq8G,UAAA,YAAAk0C,eAAA,kBAAA7hM,QAAA,CAAA+hM,aAAA,eAAAC,eAAA,iBAAAC,eAAA,iBAAAC,cAAA,gBAAAC,YAAA,cAAAC,qBAAA,uBAAA39D,kBAAA,oBAAA49D,YAAA,cAAAC,gBAAA,kBAAAhF,iBAAA,mBAAAiF,iBAAA,mBAAAC,iBAAA,mBAAA/qJ,OAAA,SAAAgrJ,cAAA,gBAAAxB,aAAA,gBAAAhhM,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,m4EAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDpGvC1N,MAAA,wFAeAA,MAAA,WASEA,MARA,EAAAoyM,GAAA,yBAQApyM,CAHC,EAAAqyM,GAAA,0BAWHryM,QA6BAA,MA3BA,EAAAsyM,GAAA,YA2BAtyM,CA3B6C,EAAAuyM,GAAA,aAuD7CvyM,MAAA,iBACGA,MAAA,0BACHA,QACAA,MAAA,wBACEA,MAAA,GAAAwyM,GAAA,0BAOFxyM,QAEAA,MAAA,GAAAyyM,GAAA,cA2EAzyM,MAAA,YAWEA,MAVA,GAAA0yM,GAAA,gBAUA1yM,CAJC,GAAA2yM,GAAA,iBAcD3yM,MAAA,gBAKEA,MAAA,0BAAS2N,EAAAkkM,oBAAoB,GAE7B7xM,MAAA,0BACFA,QAEAA,MAAA,gBAIEA,MAAA,0BAAS2N,EAAAokM,aAAa,GAEtB/xM,MAAA,0BACFA,QAEAA,MAAA,gBAIEA,MAAA,0BAAS2N,EAAAk3C,OAAA73C,MAAa,GAEtBhN,MAAA,0BAEJA,UAaAA,MAXA,GAAA4yM,GAAA,gBAWA5yM,CAJC,GAAA6yM,GAAA,qBA/NC7yM,MAVA,cAAA2N,EAAAgxB,YAUA3+B,CAV2B,MAAA2N,EAAA0R,IAU3Brf,CATW,eAAA2N,EAAAizF,aASX5gG,CAR6B,YAAAA,MAAA,KAAA2N,EAAA+gM,YAQ7B1uM,CAPgC,UAAA2N,EAAA8jI,QAOhCzxI,CANmB,sBAAA2N,EAAAqnI,oBAMnBh1I,CAL2C,uBAAA2N,EAAA08L,qBAK3CrqM,CAJ6C,YAAAA,MAAA,KAAA2N,EAAAghM,YAI7C3uM,CAHgC,eAAAA,MAAA,KAAA2N,EAAAmhM,eAGhC9uM,CAFsC,SAAA2N,EAAAsrF,OAEtCj5F,CADiB,mBAAA2N,EAAA+8L,kBAOd1qM,MAAA,GAAAA,MAAA,QAAA2N,EAAA2jM,gBAQAtxM,cAAA,QAAA2N,EAAA2jM,gBASqBtxM,cAAA,OAAA2N,EAAAm7L,aA2BA9oM,cAAA,OAAA2N,EAAAi7L,WA6BvB5oM,MAAA,GAAAA,MAAA,GAAAA,MAAA,8CAEcA,MAAA,GAAAA,MAAA,QAAA2N,EAAAmiM,kBAEI9vM,cAAA,UAAA2N,EAAAolK,UAUlB/yK,cAAA,qBAAA2N,EAAAmiM,mBAAAniM,EAAA8lI,eAAA,cAAA9lI,EAAAmiM,kBAAAniM,EAAA8lI,gBAAA9lI,EAAA2gM,eA2EEtuM,MAAA,GAAAA,MAAA,OAAA2N,EAAA2jM,gBAUAtxM,cAAA,OAAA2N,EAAAm7L,aAAAn7L,EAAAi7L,WAYD5oM,cAAA,WAAA2N,EAAAqkM,uBAIAhyM,cAAA,IAAAA,MAAA,6CAMAA,MAAA,GAAAA,MAAA,eAAA2N,EAAAotJ,UAAAvyJ,QAGAxI,cAAA,IAAAA,MAAA,gDAMAA,MAAA,GAAAA,MAAA,YAAA2N,EAAAmB,MAAAuU,UAAAkV,WAAA/vB,QAGAxI,cAAA,IAAAA,MAAA,gDAMDA,MAAA,GAAAA,MAAA,OAAA2N,EAAAmB,MAAA+R,MAAArY,QAAAmF,EAAA8lI,gBAAA9lI,EAAA2gM,eAWAtuM,cAAA,OAAA2N,EAAAmB,MAAA+R,MAAArY,QAAAmF,EAAA8lI,eAAA9lI,EAAA2gM,+BClKC1E,EACAvuK,KAAW32B,eACXy3B,KAAmBz3B,KACnBqJ,KACAwkF,MAAoB5tF,MACpBkkB,MAAkBjkB,YAClB62B,MAAcloB,MACduV,MAAerV,MAAAC,MACfL,KACA0V,MACA4pC,MAAcj3B,YACdK,MAAcH,gDACdvtB,MAAiBytB,MACjBg3K,MAAa92K,oCACb7tB,KAAe8tB,UACf7tB,KAAakuB,KACbruB,KAAgBgmL,KAChB9/J,MACA7lB,KACAC,KAAiB4lL,MAAA1lL,OAAA,q8EAAAC,gBAAA,WAGR6/L,CAA0B,2DCpFjCvuM,MAAA,mBAIEA,MAAA,GACFA,kCAHEA,MAAA,QAAA+yM,GAEA/yM,cAAA,IAAA+yM,EAAA98K,WAAA84H,IAAA,gCAuBE/uJ,MAAA,mBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAAgzM,GAEAhzM,cAAA,IAAAA,MAAA,uBAAAgzM,GAAA,MCSL,IAAMC,GAA0B,MAAjC,MAAOA,EA6DDzE,qBACAhuM,eA7DV,SACIsO,GACF,OAAOlQ,KAAKowM,MACd,CACA,SAAIlgM,CAAMA,GACRlQ,KAAKowM,OAASlgM,CAChB,CACQkgM,OAER,aACID,GACF,OAAOnwM,KAAKs0M,UACd,CACA,aAAInE,CAAUA,GACZnwM,KAAK+/B,YAAYxI,SAAS,IAC1Bv3B,KAAKs0M,WAAanE,CACpB,CACQmE,WAER,QACI1tE,GACF,OAAO5mI,KAAKu0M,KACd,CACA,QAAI3tE,CAAKlgI,GACP1G,KAAKu0M,MAAQ7tM,EACRA,IACH1G,KAAKkyM,oBAAiBlwM,EACtBhC,KAAK2tM,kBAAkBp2K,SAAS,GAEpC,CACQg9K,MAECz0J,OAAkB,GAEpBoyJ,eACAsC,aAEA5hE,YAAiCzB,MAAkBI,OAEnDxxG,YAAc,IAAI2zB,KAElBi6I,kBAAoB,IAAIj6I,KAM/B,gBAAIw/E,GACF,MAAO,CAAC/B,MAAkBI,OAAQJ,MAAkBK,WACtD,CAEUijE,WAAa,IAAInnM,MACjBsjM,qBAAuB,IAAItjM,MAC3BonM,aAAe,IAAIpnM,MACnB2lI,kBAAoB,IAAI3lI,MAElCqmD,mBACAghJ,qBAEA50M,YACU6vM,EACAhuM,GADA5B,KAAA4vM,uBACA5vM,KAAA4B,gBACP,CAEH2L,WACEvN,KAAK2zD,mBAAqB3zD,KAAK+/B,YAAYxH,aAAa11B,UACrD6D,IACKA,EAAMkD,QACR5J,KAAKkQ,MAAMC,KAAKzG,OAAQoB,IACtB,MAAM0tB,EAAmB9xB,EACtByxB,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAK/B,OAJ8B5tB,EAAQusB,WAAW84H,IAC9Ch4H,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IACFV,SAASQ,EAAgB,EACvD,GAKPx4B,KAAK20M,qBAAuB30M,KAAK2tM,kBAAkBp1K,aAChDx0B,QAAKof,MAAa,MAAG,EAAG+tE,SACxBruF,UAAW6D,IAER1G,KAAK4yI,cAAgBzB,MAAkBI,QACvC7qI,EAAQ,GACRA,GAAS,KAET1G,KAAK00M,aAAatmM,KAAK1H,GACvB1G,KAAK4vM,qBACFh7B,mBACC50K,KAAKw0M,aACL5hC,EAAkBC,WAClBnsK,EACA1G,KAAKmwM,WAENttM,UAAWyvM,IACVtyM,KAAKkyM,eAAiBI,EACtBtyM,KAAK4wM,qBAAqBxiM,KAAKpO,KAAKkyM,eAAc,IAGtDlyM,KAAK4yI,cAAgBzB,MAAkBK,YACvC9qI,EAAQ,GACRA,GAAS,KAET1G,KAAK00M,aAAatmM,KAAK1H,GACvB1G,KAAK4vM,qBACFh7B,mBACC50K,KAAKw0M,aACL5hC,EAAkBC,WACV,IAARnsK,EACA1G,KAAKmwM,WAENttM,UAAWyvM,IACVtyM,KAAKkyM,eAAiBI,EACtBtyM,KAAK4wM,qBAAqBxiM,KAAKpO,KAAKkyM,eAAc,IAEnC,IAAVxrM,GAAe1G,KAAK8/C,OAAOl2C,OAAS,GAC7C5J,KAAK00M,aAAatmM,KAAK1H,GACvB1G,KAAK4wM,qBAAqBxiM,KAAKpO,KAAKw0M,gBAEpC9tM,EAAQ,GACP1G,KAAK4yI,cAAgBzB,MAAkBI,QAAU7qI,EAAQ,KACzD1G,KAAK4yI,cAAgBzB,MAAkBK,YAAc9qI,EAAQ,OAE9D1G,KAAK2tM,kBAAkBp2K,SAAS,GAChCv3B,KAAK4B,eAAe8D,MAClB,oCACA,iCAA+B,EAIzC,CAEAwI,cACElO,KAAK2zD,mBAAmBxlD,aAC1B,CAEAokD,UAAUznD,GACR,OAAOA,EAAUA,EAAQusB,WAAW84H,SAAMnuJ,CAC5C,CAEA4yM,aAAa9pM,GACPA,GAAW9K,KAAKmwM,WAClBnwM,KAAK4vM,qBACFn7B,aAAa3pK,EAAS9K,KAAKmwM,WAC3BttM,UAAWyvM,IACVtyM,KAAKw0M,aAAelC,EACpBtyM,KAAKy0M,WAAWrmM,KAAKkkM,EAAW,EAGxC,CAMAj/D,oBAAoBv+C,GACdA,IAAS90F,KAAK4yI,cAGhB5yI,KAAK4yI,YAAc99C,EACnB90F,KAAKizI,kBAAkB7kI,KAAKpO,KAAK4yI,aAE7B5yI,KAAK2tM,kBAAkBp2K,SAD3Bv3B,KAAK4yI,cAAgBzB,MAAkBI,OAC4B,IAA/BvxI,KAAK2tM,kBAAkBjnM,MACvB1G,KAAK2tM,kBAAkBjnM,MAAQ,KAEvE,4CA3KW2tM,GAA0BjzM,MAAAuE,GAAAvE,MAAAwE,MAAA,+BAA1ByuM,EAA0B/lM,UAAA,8BAAAC,OAAA,CAAA2B,MAAA,QAAAigM,UAAA,YAAAvpE,KAAA,OAAA9mF,OAAA,UAAAtxC,QAAA,CAAAimM,WAAA,aAAA7D,qBAAA,uBAAA8D,aAAA,eAAAzhE,kBAAA,qBAAAxkI,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,qYAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDtDnC1N,MAFJ,UAEIA,CAFmB,qBAEnBA,CADgC,eACrBA,MAAA,wBAAmDA,QAC9DA,MAAA,oCAQAA,MAAA,0BAEEA,MAAA,0BAAAqW,GAAArW,aAAAyK,GAAAzK,MAAkB2N,EAAA6lM,aAAAn9L,EAAA+f,OAAA9wB,OAAiC,GAGnDtF,MAAA,GAAAyzM,GAAA,sCAOJzzM,UAIMA,MAHN,SAGMA,CAHD,WAGCA,CAFoB,sBAEpBA,CAD6B,gBAClBA,MAAA,0BAAgDA,QAC3DA,MAAA,oCAQFA,QAGEA,MADF,uBACEA,CADiC,oBAG/BA,MAAA,2BAAAqW,GAAArW,aAAAyK,GAAAzK,MAAmB2N,EAAAskI,oBAAA57H,EAAA/Q,OAAiC,GAEpDtF,MAAA,GAAA0zM,GAAA,oBAUV1zM,yCAnDeA,MAAA,GAAAA,YAAA,yCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,yCAGAA,MADA,cAAA2N,EAAAgxB,YACA3+B,CAD2B,kBAAA2zM,GAM3B3zM,MAAA,GAAAA,MAAA,cAAA2N,EAAAwjD,WAGuBnxD,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAmB,MAAAC,KAAAO,SAUVtP,MAAA,GAAAA,YAAA,uCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,uCAGAA,MAFA,cAAA2N,EAAA4+L,kBAEAvsM,CAFiC,UAEjCA,CADW,YAAA2N,EAAA63H,MAOXxlI,MAAA,GAAAA,MAAA,QAAA2N,EAAA6jI,aAI0BxxI,cAAA,UAAA2N,EAAAmkI,8BCAhCjpH,MAAkBpkB,YAClBg3B,MAAc/2B,MACd22B,KAAW12B,eACX42B,MAAqB32B,MAAA2O,MAAA3O,MACrBu3B,KAAmBx3B,KACnB0O,KACA0V,MACAD,MAAerV,MACfnF,KACAC,KAAiBmF,MAAAjF,OAAA,wSAAAC,gBAAA,WAGRukM,CAA0B,+CC1C/BjzM,MAAA,kBACEA,MAAA,wBACFA,kCAFgDA,MAAA,QAAA4zM,GAC9C5zM,cAAA,IAAAA,MAAA,uBAAA4zM,GAAA,MCqCH,IAAMC,GAA0B,MAAjC,MAAOA,EACX,SACI/kM,GACF,OAAOlQ,KAAKowM,MACd,CACA,SAAIlgM,CAAMA,GACRlQ,KAAKowM,OAASlgM,CAChB,CACQkgM,OAEDD,UAAsB,CAC3B,SACA,UACA,WACA,SACA,MACA,MACA,YACA,WAEK+E,kBAAoB,IAAIxhJ,KAAmB,GAM3CyhJ,YAAcviC,EAEdwiC,eAAoCp1M,KAAKm1M,YAAYriC,QAEnDuiC,kBAEAzuE,KAEA9mF,OAAkB,GAEpBt8C,KAEG8xM,UAAY,IAAIhoM,MAEhBioM,eAAiB,IAAIjoM,MAErBmnM,WAAa,IAAInnM,MACjBsjM,qBAAuB,IAAItjM,MAE3BonM,aAAe,IAAIpnM,MACnB2lI,kBAAoB,IAAI3lI,MAElCvN,cAAe,CAEfwN,WACuC,IAAjCvN,KAAKk1M,kBAAkBxuM,QACzB1G,KAAKwD,KAAOxD,KAAKm1M,YAAYtiC,YAEM,IAAjC7yK,KAAKk1M,kBAAkBxuM,QACzB1G,KAAKwD,KAAOxD,KAAKo1M,gBAEnBp1M,KAAKs1M,UAAUlnM,KAAKpO,KAAKwD,KAC3B,CAEAgyM,aAAa9rL,GAC0B,IAAjC1pB,KAAKk1M,kBAAkBxuM,QACzB1G,KAAKwD,KAAOovK,EAAkBC,YAEK,IAAjC7yK,KAAKk1M,kBAAkBxuM,QACzB1G,KAAKwD,KAAOxD,KAAKo1M,gBAEnBp1M,KAAKs1M,UAAUlnM,KAAKpO,KAAKwD,KAC3B,CAEAiyM,iBAAiBN,GACfn1M,KAAKo1M,eAAiBD,EACtBn1M,KAAKs1M,UAAUlnM,KAAKpO,KAAKo1M,eAC3B,CAEA3rL,oBACEzpB,KAAKu1M,eAAennM,KAAKpO,KAAKq1M,mBAC9Br1M,KAAKy0M,WAAWrmM,UAAKpM,EACvB,4CA9EWizM,EAA0B,+BAA1BA,EAA0B3mM,UAAA,8BAAAC,OAAA,CAAA2B,MAAA,QAAAmlM,kBAAA,oBAAAzuE,KAAA,OAAA9mF,OAAA,UAAAtxC,QAAA,CAAA8mM,UAAA,YAAAC,eAAA,iBAAAd,WAAA,aAAA7D,qBAAA,uBAAA8D,aAAA,eAAAzhE,kBAAA,qBAAAxkI,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,2VAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDpDvC1N,MAAA,qBAGEA,MADA,+BAAAqW,GAAA,OAAuB1I,EAAAmmM,kBAAA39K,SAAA9f,EAAkC,EACzDrW,CAD0D,6BAAAqW,GAAA,OACrC1I,EAAAymM,aAAA/9L,EAAoB,GAEzCrW,MAAA,oCAEIA,MADF,mBACEA,CADc,eACHA,MAAA,wBAETA,QACFA,MAAA,kBACEA,MAAA,oCAAmB2N,EAAA0a,mBAAmB,GACtCroB,MAAA,uBAAAqW,GAAArW,aAAA2N,EAAAsmM,kBAAA59L,KAAA1I,EAAAsmM,kBAAA59L,IAAA,GAEArW,MAAA,EAAAs0M,GAAA,oBAIJt0M,UACAA,MAAA,+BAQEA,MAHA,sBAAAqW,GAAA,OAAc1I,EAAA0lM,WAAArmM,KAAAqJ,EAAuB,EAGrCrW,CAHsC,gCAAAqW,GAAA,OACd1I,EAAA6hM,qBAAAxiM,KAAAqJ,EAAiC,EAEzDrW,CAF0D,wBAAAqW,GAAA,OAC1C1I,EAAA2lM,aAAAtmM,KAAAqJ,EAAyB,EACzCrW,CAD0C,6BAAAqW,GAAA,OACrB1I,EAAAkkI,kBAAA7kI,KAAAqJ,EAA8B,GAGvDrW,UAEAA,MAAA,sCAEIA,MADF,WACEA,CAD+B,gCAG7BA,MAAA,kBAAAqW,GAAA,OAAU1I,EAAA0mM,iBAAAh+L,EAAA/Q,MAA8B,GAExCtF,MAAA,gDAIEA,MAAA,eAAUA,MAAA,eACZA,UACAA,MAAA,gDAIEA,MAAA,eAAUA,MAAA,aAKpBA,yBApDEA,MAAA,gBAAA2N,EAAAmmM,kBAAAxuM,OAIStF,cAAA,QAAAA,MAAA,0CAEMA,MAAA,GAAAA,YAAA,2CAKTA,MAAA,GAAAA,MAAA,QAAA2N,EAAAsmM,mBAEkCj0M,cAAA,UAAA2N,EAAAohM,WAMpC/uM,QAGAA,MAHA,QAAA2N,EAAAmB,MAGA9O,CAHe,YAAA2N,EAAAsmM,kBAGfj0M,CAF+B,OAAA2N,EAAA63H,KAE/BxlI,CADa,SAAA2N,EAAA+wC,QAUR1+C,cAAA,QAAAA,MAAA,qCAGHA,MAAA,GAAAA,MAAA,QAAA2N,EAAAqmM,gBAIEh0M,QACAA,MADA,QAAA2N,EAAAomM,YAAAriC,QACA1xK,CAD6B,aAAAA,MAAA,4CAM7BA,MAAA,GACAA,MADA,QAAA2N,EAAAomM,YAAAv+E,MACAx1H,CAD2B,aAAAA,MAAA,2DCLjC+4D,MAAax0D,YACbskB,MAAkBrkB,YAClBskB,MAAerkB,MAAAC,MACf2O,KACA0V,MACAkqL,GACAppJ,MAAqBllD,YACrBsJ,KAAgBrJ,KAChBwJ,KAAamF,KACbhF,KAAiBkF,MAAAhF,OAAA,ytBAAAC,gBAAA,WAGRmlM,CAA0B,8DClDnC7zM,MADF,UACEA,CAD8D,oBAO5DA,MALA,iCAKAA,CAD6B,6BAO7BA,MAAA,mCAKEA,MAAA,yBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,GAAAA,aAAAkK,EAAA0tB,KAAAvhB,KAAAnM,EAAA0tB,KAAAvhB,GAAArW,MAAAqW,EAAA,GAIArW,MAAA,sBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,UAAAA,MAAckK,EAAAqqM,iBAAAl+L,GAAwB,GAG5CrW,gDArBMA,MAAA,GAAAA,MAAA,MAAAw0M,GAKAx0M,QAEAA,MAFA,OAAAkK,EAAA9H,KAEApC,CAFa,iBAEbA,CADoB,kBAMpBA,MAAA,GAAAA,MAAA,cAAAA,MAAA,gCACAA,MAAA,oBAAAw0M,GACAx0M,MAAA,UAAAkK,EAAA0tB,MAEA53B,MADA,MAAAkK,EAAA8gB,IACAhrB,CADW,MAAAkK,EAAA6gB,+CAUb/qB,MAFJ,QAEIA,CAFiB,WAEjBA,CAD+B,oBAO7BA,MALA,iCAKAA,CAD6B,6BAO7BA,MAAA,mCAKEA,MAAA,yBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAuqM,UAAAp+L,KAAAnM,EAAAuqM,UAAAp+L,GAAArW,MAAAqW,EAAA,GAKArW,MADA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAAkK,EAAAuqM,UAAA,EACAz0M,CADqB,sBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MACPkK,EAAAqqM,iBAAAl+L,GAAwB,GAG5CrW,YAGEA,MADF,WACEA,CAD+B,oBAO7BA,MALA,kCAKAA,CAD6B,8BAO7BA,MAAA,qCAKEA,MAAA,yBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAwqM,QAAAr+L,KAAAnM,EAAAwqM,QAAAr+L,GAAArW,MAAAqW,EAAA,GAIArW,MAAA,sBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAckK,EAAAqqM,iBAAAl+L,GAAwB,GAI9CrW,8DAlDQA,MAAA,GAAAA,MAAA,MAAA20M,GAKA30M,QAEAA,MAFA,OAAAkK,EAAA9H,KAEApC,CAFa,iBAEbA,CADoB,kBAMpBA,MAAA,GAAAA,MAAA,cAAAA,MAAA,sCACAA,MAAA,oBAAA20M,GACA30M,MAAA,UAAAkK,EAAAuqM,WAEAz0M,MADA,MAAAkK,EAAA8gB,IACAhrB,CADW,MAAAkK,EAAA0qM,mBAaX50M,MAAA,GAAAA,MAAA,MAAA60M,GAKA70M,QAEAA,MAFA,OAAAkK,EAAA9H,KAEApC,CAFa,iBAEbA,CADoB,kBAMpBA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCACAA,MAAA,oBAAA60M,GACA70M,MAAA,UAAAkK,EAAAwqM,SAEA10M,MADA,MAAAkK,EAAA4qM,kBACA90M,CADyB,MAAAkK,EAAA6gB,gCA5EnC/qB,MAAA,SA4BEA,MA3BA,EAAA+0M,GAAA,aA2BA/0M,CA3BgE,EAAAg1M,GAAA,eAmFlEh1M,8BAnFQA,cAAA,QAAAkK,EAAA+qM,SA2BAj1M,cAAA,OAAAkK,EAAA+qM,oCAkEAj1M,MAAA,mBAA0DA,MAAA,GAExDA,kCAFUA,MAAA,QAAAk1M,GAA8Cl1M,cAAAk1M,6CAL5Dl1M,MAFJ,UAEIA,CAF4D,mBAE5DA,CADc,wCAGZA,MAAA,yBAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAsmK,KAAAn6J,KAAAnM,EAAAsmK,KAAAn6J,GAAArW,MAAAqW,EAAA,GACArW,MAAA,2BAAAqW,GAAArW,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAAirM,iBAAA9+L,GAAwB,GAE3CrW,MAAA,EAAAo1M,GAAA,qBAKNp1M,qCATMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,gCACAA,MAAA,UAAAkK,EAAAsmK,MAG4CxwK,MAAA,GAAAA,MAAA,UAAAkK,EAAAmrM,sCAe1Cr1M,MAAA,mBAGGA,MAAA,GAAeA,kCAFhBA,MAAA,QAAAs1M,GAECt1M,cAAAs1M,8BAaHt1M,MAAA,mBAAmEA,MAAA,GAEjEA,kCAFUA,MAAA,QAAAu1M,GAAuDv1M,cAAAu1M,6CArBrEv1M,MAHN,QAGMA,CAHe,WAGfA,CAF6B,mBAE7BA,CADc,wCAGZA,MAAA,yBAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAsrM,UAAAn/L,KAAAnM,EAAAsrM,UAAAn/L,GAAArW,MAAAqW,EAAA,GACArW,MAAA,2BAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAAirM,iBAAA9+L,GAAwB,GAE3CrW,MAAA,EAAAy1M,GAAA,qBAONz1M,YAIIA,MAFJ,WAEIA,CAF6B,mBAE7BA,CADc,wCAGZA,MAAA,yBAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAwrM,QAAAr/L,KAAAnM,EAAAwrM,QAAAr/L,GAAArW,MAAAqW,EAAA,GACArW,MAAA,2BAAAqW,GAAArW,MAAAurD,GAAA,MAAArhD,EAAAlK,MAAA,UAAAA,MAAmBkK,EAAAirM,iBAAA9+L,GAAwB,GAE3CrW,MAAA,GAAA21M,GAAA,qBAMR31M,uCA1BQA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCACAA,MAAA,UAAAkK,EAAAsrM,WAKwBx1M,MAAA,GAAAA,MAAA,UAAAkK,EAAA0rM,gBAUxB51M,MAAA,GAAAA,MAAA,cAAAA,MAAA,mCACAA,MAAA,UAAAkK,EAAAwrM,SAGkD11M,MAAA,GAAAA,MAAA,UAAAkK,EAAA2rM,yCAvC5D71M,MAAA,SAeEA,MAdA,EAAA81M,GAAA,YAcA91M,CAdgE,EAAA+1M,GAAA,eA6ClE/1M,8BA7CQA,cAAA,QAAAkK,EAAA+qM,SAcAj1M,cAAA,OAAAkK,EAAA+qM,oCAsENj1M,MAAA,UAA8CA,MAAA,GAAUA,+BAAVA,cAAAkK,EAAAsmK,gDAhC9CxwK,MAJF,WAIEA,CADD,UACOA,MAAA,GAAeA,QAWlBA,MATH,oBASGA,CAAA,gBAWCA,MARA,mBAAAA,MAAAyuB,GAAA,MAAAunL,EAAAh2M,MAAA,GAAAi2M,EAAAj2M,MAAA,GAAAkK,EAAAlK,QAAA,OAAAA,MACWkK,EAAAgsM,uBACV,CAAA7zL,OAAA4zL,EAAAl+J,OAAAi+J,EAAA1wM,MAAA2wM,EAAA3wM,QAKP,EACMtF,CAFC,oBAAAA,MAAAyuB,GAAA,MAAAunL,EAAAh2M,MAAA,GAAAi2M,EAAAj2M,MAAA,GAAAkK,EAAAlK,QAAA,OAAAA,MAGUkK,EAAAgsM,uBACV,CAAA7zL,OAAA4zL,EAAAl+J,OAAAi+J,EAAA1wM,MAAA2wM,EAAA3wM,QAKP,GACEtF,UACAA,MAAA,UAAMA,MAAA,GAAaA,QACnBA,MAAA,EAAAm2M,GAAA,YAEEn2M,MADF,cACEA,CADgD,gDAE9CA,MAAA,oBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAo0K,oBAAmB,GAQ/Bt+K,QACAA,MAAA,gBAIEA,MAAA,iBAAAqW,GAAArW,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAAksM,SAAA//L,GAAgB,GAEzBrW,MAAA,eAAUA,MAAA,IACZA,UACAA,MAAA,gBAIEA,MAAA,iBAAAqW,GAAArW,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+yK,YAAA5mK,GAAmB,GAE5BrW,MAAA,eAAUA,MAAA,IAGhBA,sCA7DQA,MAAA,GAAAA,MAAAkK,EAAAsrM,WAIJx1M,cAAA,OAAAkK,EAAAylB,MAKA3vB,MAJA,MAAAkK,EAAAsrM,UAIAx1M,CAJiB,MAAAkK,EAAAwrM,QAIjB11M,CAHe,QAAAkK,EAAAC,MAGfnK,CAFe,YAAAkK,EAAAzL,QAAA8wC,UAAArlC,EAAAm3C,MAAA5rB,SAMbz1B,MAAA,GAAAA,MAAA,QAAAkK,EAAAmsM,qBAkBEr2M,MAAA,GAAAA,MAAAkK,EAAAwrM,SACF11M,cAAA,OAAAkK,EAAAzL,QAAA8wC,SAMAvvC,MAAA,GAGAA,MAHA,aAAAA,MAAA,0CAGAA,CAH6D,QAAAkK,EAAAC,MAG7DnK,CAFe,UAAAkK,EAAAzL,QAAA8wC,QAEfvvC,CAD2B,YAAAkK,EAAAm3C,MAAA5rB,SAK3Bz1B,MAAA,GAAAA,MAAA,YAAAkK,EAAAzL,QAAA8wC,UAAArlC,EAAAm3C,MAAA5rB,SAKUz1B,MAAA,GAAAA,MAAAkK,EAAAiyK,UAGVn8K,cAAA,YAAAkK,EAAAzL,QAAA8wC,UAAArlC,EAAAm3C,MAAA5rB,SAKUz1B,MAAA,GAAAA,MAAAkK,EAAAkyK,qDAUdp8K,MALF,UAKEA,CAFD,qBAQGA,MAAA,2BAAAqW,GAAArW,MAAA+wB,GAAA,MAAA7mB,EAAAlK,QAAA,OAAAA,MAAmBkK,EAAAosM,uBAAAjgM,GAA8B,GAEhDrW,MAAA,gBAGCA,MAAA,mBAAAA,MAAA+wB,GAAA,MAAAwlL,EAAAv2M,MAAA,GAAAw2M,EAAAx2M,MAAA,GAAAkK,EAAAlK,QAAA,OAAAA,MACWkK,EAAAosM,uBACV,CAAAj0L,OAAAm0L,EAAAz+J,OAAAw+J,EAAAjxM,MAAAkxM,EAAAlxM,QAKP,GAEEtF,UACAA,MAAA,UAAsBA,MAAA,GAA2BA,QACjDA,MAAA,eAAwCA,MAAA,iBAAAqW,GAAArW,MAAA+wB,GAAA,MAAA7mB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA4yK,WAAAzmK,GAAkB,GACjErW,MAAA,cAAUA,MAAA,GAEdA,oCAvBIA,cAAA,OAAAkK,EAAAylB,MAEA3vB,MADA,MAAAkK,EAAAoxK,aAAApxK,EAAA8gB,KACAhrB,CADyB,MAAAkK,EAAAoxK,aAAApxK,EAAA6gB,MAOvB/qB,MAAA,GAAAA,MAAA,QAAAkK,EAAAmsM,qBAWkBr2M,MAAA,GAAAA,MAAAkK,EAAAusM,uBAEVz2M,MAAA,GAAAA,MAAAkK,EAAAiyK,WC3KP,IAAMu6B,GAAuB,MAA9B,MAAOA,EAqHS/hL,YApHX0sB,MAEA5iD,QAEF0L,MAAsB,UACtBytB,KACA68K,UACAC,QACAlkC,KACAglC,UACAE,QACAiB,cACAC,YACAvB,UAA2B,GAC3BO,eAAgC,GAChCC,aAA8B,GAErC,gBACIpjM,CAAanN,GACf,GAAIA,GACE1G,KAAKwD,OAAS4vE,IAAeiiC,KAAM,CACrC,MAAM4iG,EAAavxM,EAAM4C,MAAM,KAC/B,GAAI2uM,EAAWruM,OAAS,EAAG,CACzB,MAAMisM,EAAY,IAAI50M,KAAKg3M,EAAW,IAChCnC,EAAU,IAAI70M,KAAKg3M,EAAW,IAC/B50B,MAAMwyB,EAAUqC,aACnBl4M,KAAK61M,UAAYA,GAEdxyB,MAAMyyB,EAAQoC,aACjBl4M,KAAK81M,QAAUA,EAEnB,CACF,CAEJ,CAEO/gF,SACAwoD,SAAW,cACXC,UAAY,SAETziI,OAA4C,IAAIztC,MAE1D6qM,WAAsD,IAAI7qM,MACpC8qM,SAEtB,QAAI50M,GACF,YAA6BxB,IAAtBhC,KAAKH,QAAQ2D,KAChB4vE,IAAe+hC,KACfn1G,KAAKH,QAAQ2D,IACnB,CAEA,WAAI6yM,GACF,YAA8Br0M,IAAvBhC,KAAKH,QAAQq6B,OAClBl6B,KAAKH,QAAQsW,QAAUm9D,IAAgBgiC,QAErCt1G,KAAKH,QAAQq6B,KACnB,CAEA,SAAI/jB,GACF,YAA8BnU,IAAvBhC,KAAKH,QAAQsW,MAChBm9D,IAAgBgiC,OAChBt1G,KAAKH,QAAQsW,KACnB,CAEA,QAAI4a,GACF,IAAIA,EAAO,MACX,QAA0B/uB,IAAtBhC,KAAKH,QAAQkxB,KACf,OAAQ/wB,KAAKwD,MACX,KAAK4vE,IAAe+hC,KACpB,KAAK/hC,IAAeC,SAClBtiD,EAAO,MACP,MACF,KAAKqiD,IAAegiC,KAClBrkF,EAAO,KACP,MACF,KAAKqiD,IAAeiiC,KAClBtkF,EAAO,QACP,MACF,QACEA,EAAO,WAGXA,EAAO/wB,KAAKq4M,kBAAkBr4M,KAAKH,QAAQkxB,MAG7C,OAAOA,CACT,CAEA,gBAAIunL,GACF,YAAqCt2M,IAA9BhC,KAAKH,QAAQy4M,aAChB,IACAt4M,KAAKH,QAAQy4M,YACnB,CAEA,OAAIlsL,GACF,GAAIpsB,KAAKH,QAAQusB,IAAK,CACpB,MAAMA,EAAM,IAAInrB,KAAKjB,KAAKH,QAAQusB,KAClC,OAAO,IAAInrB,KAAKmrB,EAAIlrB,UAAsC,IAA1BkrB,EAAImsL,oBACtC,CAGF,CAEA,OAAIpsL,GACF,GAAInsB,KAAKH,QAAQssB,IAAK,CACpB,MAAMA,EAAM,IAAIlrB,KAAKjB,KAAKH,QAAQssB,KAClC,OAAO,IAAIlrB,KAAKkrB,EAAIjrB,UAAsC,IAA1BirB,EAAIosL,oBACtC,CAGF,CAEA,MAAIC,GACF,YAA8Bx2M,IAAvBhC,KAAKH,QAAQq6B,OAA8Bl6B,KAAKH,QAAQq6B,KACjE,CAEAn6B,YAAoBg2B,GAAA/1B,KAAA+1B,cAClB/1B,KAAK+1B,YAAYmB,UAAU,KAC7B,CAEA3pB,WAgBE,QAfuBvL,IAAnBhC,KAAK61M,YACP71M,KAAK61M,UAAY,IAAI50M,KAAKjB,KAAKosB,WAEZpqB,IAAjBhC,KAAK81M,UACP91M,KAAK81M,QAAU,IAAI70M,KAAKjB,KAAKmsB,WAERnqB,IAAnBhC,KAAK42M,YACP52M,KAAK42M,UAAY,IAAI31M,KAAKjB,KAAK61M,WAAW/jC,cAC1C9xK,KAAK+3M,cAAgB/3M,KAAK42M,gBAEP50M,IAAjBhC,KAAK82M,UACP92M,KAAK82M,QAAU,IAAI71M,KAAKjB,KAAK81M,SAAShkC,cACtC9xK,KAAKg4M,YAAch4M,KAAK82M,SAGrB92M,KAAKq2M,QAIH,CACL,QAASjnK,EAAIpvC,KAAK42M,UAAWxnK,EAAIpvC,KAAK82M,QAAS1nK,IAC7CpvC,KAAKg3M,eAAe1vM,KAAK8nC,GAE3B,QAASA,EAAIpvC,KAAK42M,UAAY,EAAGxnK,GAAKpvC,KAAK82M,QAAS1nK,IAClDpvC,KAAKi3M,aAAa3vM,KAAK8nC,EAE3B,MAVE,QAASA,EAAIpvC,KAAK42M,UAAWxnK,GAAKpvC,KAAK82M,QAAU,EAAG1nK,IAClDpvC,KAAKy2M,UAAUnvM,KAAK8nC,GAUxBpvC,KAAKH,QAAQ8wC,aACc3uC,IAAzBhC,KAAKH,QAAQ8wC,SAA+B3wC,KAAKH,QAAQ8wC,QAC3D3wC,KAAKy4M,mBACDz4M,KAAKH,QAAQ8wC,SACV3wC,KAAKq2M,SAA0B,WAAfr2M,KAAKmW,OAAoC,SAAdnW,KAAKwD,MACnDxD,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,OAG5B5xK,KAAK04M,0BACL14M,KAAKm4M,WAAW/pM,UAAKpM,GAEzB,CAEA02M,2BAGK14M,KAAKq2M,SACNr2M,KAAKmW,QAAUm9D,IAAgBgiC,QAC/Bt1G,KAAKwD,OAAS4vE,IAAeiiC,OAE7Br1G,KAAKH,QAAQ6G,MAAQ1G,KAAK4xK,KAAKz5G,WAEnC,CAEAsgJ,mBAEE,MAAME,EADW34M,KAAKyiD,MAAMpsB,WAAWgrB,GACVy/E,YAAY1rB,KACzC,GACGp1G,KAAKq2M,SACNr2M,KAAKmW,QAAUm9D,IAAgBgiC,QAC/Bt1G,KAAKwD,OAAS4vE,IAAeiiC,MAOoB,GAGjDr1G,KAAKq2M,SACLr2M,KAAKmW,QAAUm9D,IAAgBC,UAC/BvzE,KAAKwD,OAAS4vE,IAAeiiC,MAEzBsjG,EAAa,CACf34M,KAAK42M,UAAYt+K,SAASqgL,EAAYruJ,OAAO,EAAG,GAAI,IACpDtqD,KAAK82M,QAAUx+K,SAASqgL,EAAYruJ,OAAO,EAAG,GAAI,IAClD,MAAMsuJ,EAA2B,GAC3BC,EAAyB,GAC/B,QAASzpK,EAAIpvC,KAAK+3M,cAAe3oK,EAAIpvC,KAAK82M,QAAS1nK,IACjDwpK,EAAkBtxM,KAAK8nC,GAEzB,QAASA,EAAIpvC,KAAK42M,UAAY,EAAGxnK,GAAKpvC,KAAKg4M,YAAa5oK,IACtDypK,EAAgBvxM,KAAK8nC,GAEvBpvC,KAAKg3M,eAAiB4B,EACtB54M,KAAKi3M,aAAe4B,CACtB,OAxBE74M,KAAK4xK,KADH+mC,EACU,IAAI13M,KAAK03M,EAAYxgJ,YAAY25G,cAAgB,EACpD9xK,KAAKH,QAAQ6G,MACV,IAAIzF,KAAKjB,KAAKH,QAAQ6G,MAAMyxD,YAAY25G,cAAgB,EAExD,IAAI7wK,KAAKjB,KAAKosB,KAAK0lJ,cAAgB,CAuBrD,CAEA6jC,iBAAiBjsL,GACf1pB,KAAK84M,kBACL94M,KAAK+4M,kBAIH/4M,KAAK+6C,OAAO3sC,KADVpO,KAAKq2M,QACU,CAACr2M,KAAK61M,UAAW71M,KAAK81M,SAEtB91M,KAAK61M,UAE1B,CAEAU,iBAAiB7sL,GACf,GAAI1pB,KAAKq2M,QAAS,CAChBr2M,KAAKi3M,aAAe,GACpB,QAAS7nK,EAAIpvC,KAAK42M,UAAY,EAAGxnK,GAAKpvC,KAAKg4M,YAAa5oK,IACtDpvC,KAAKi3M,aAAa3vM,KAAK8nC,GAEzBpvC,KAAKg3M,eAAiB,GACtB,QAAS5nK,EAAIpvC,KAAK+3M,cAAgB,EAAG3oK,EAAIpvC,KAAK82M,QAAS1nK,IACrDpvC,KAAKg3M,eAAe1vM,KAAK8nC,GAE3BpvC,KAAKm4M,WAAW/pM,KAAK,CAACpO,KAAK42M,UAAW52M,KAAK82M,SAC7C,MACE92M,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,KAE9B,CAEAonC,qBAAqBtvL,GACnB1pB,KAAKu2M,iBAAiB,CAACv2M,KAAK42M,UAAW52M,KAAK82M,SAC9C,CAEAmC,0BAA0BvvL,GACxB1pB,KAAK+6C,OAAO3sC,KAAK,CAACpO,KAAK61M,UAAW71M,KAAK81M,SACzC,CAEAp5B,aAAa1jJ,GACX,IAAI2jJ,EACJ,OACEA,EADE3jJ,EACQ,IAAI/3B,KAAK+3B,GAET,IAAI/3B,KAAKjB,KAAKosB,KAGnBuwJ,EAAQz7K,SACjB,CAEAg4M,oBAAoB1tL,GAClB,MAAM2tL,EAAan5M,KAAKo5M,eACtBp5M,KAAKo4M,SAAS1iL,YAAYziB,cAAcomM,YAEtCF,IACFA,EAAWG,YAAc9tL,EAE7B,CAEA4tL,eAAelvM,GACb,IAAIivM,EAEJjvM,SAAKqQ,QAAS7T,IACY,gCAApBA,EAAMo4B,YACRq6K,EAAazyM,GAGXA,EAAM+5B,SAAS72B,OAAS,IAAMuvM,IAChCA,EAAan5M,KAAKo5M,eAAe1yM,EAAM2yM,YAAU,EAElDr5M,MACIm5M,CACT,CAEAz5B,oBACE1/K,KAAKH,QAAQ8wC,SAAW3wC,KAAKH,QAAQ8wC,QAEjC3wC,KAAKH,QAAQ8wC,SAEZ3wC,KAAKq2M,SACN/iI,IAAgBgiC,QAChBt1G,KAAKwD,OAAS4vE,IAAeiiC,MAE7Br1G,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,OAG5B5xK,KAAKm+K,aACLn+K,KAAK04M,0BACL14M,KAAK+6C,OAAO3sC,UAAKpM,GAErB,CAEAq8K,YAAY30J,GACV1pB,KAAKg5B,KAAO,IAAI/3B,KAAKjB,KAAKosB,KAC1BpsB,KAAK4xK,KAAO5xK,KAAKg5B,KAAK84I,eAEnB9xK,KAAKq2M,SACN/iI,IAAgBgiC,QAChBt1G,KAAKwD,OAAS4vE,IAAeiiC,KAE7Br1G,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,OAE1B5xK,KAAK84M,kBACL94M,KAAK+6C,OAAO3sC,UAAKpM,GAErB,CAEAk8K,WAAWx0J,GACL1pB,KAAK+0H,SACP/0H,KAAKm+K,cAELn+K,KAAKu9K,SAAW,eAChBv9K,KAAK+0H,SAAW3nF,YACbkhH,IACC,IAAIirD,EACJ,MAAMC,EAAgB,IAAIv4M,KAAKqtJ,EAAKniI,KAEpCotL,OACgBv3M,IAAdssJ,EAAKt1H,KAAqBs1H,EAAKliI,IAAIlrB,UAAYotJ,EAAKt1H,KAAK93B,UAC3Dq4M,GAAoBjrD,EAAK8pD,SAASrnL,KAClCu9H,EAAKt1H,KAAO,IAAI/3B,KAAKs4M,GAEjBA,EAAmBC,EAAct4M,WACnCotJ,EAAK6vB,aAGP7vB,EAAKqnD,iBAAiB,CAAEjvM,MAAO4nJ,EAAKt1H,KAAMA,KAAMs1H,EAAKt1H,MAAM,EAE7Dh5B,KAAKs4M,aACLt4M,MAGN,CAEAw3M,SAAS9tL,GAEL1pB,KAAK4xK,KAAO5xK,KAAKo4M,SAASrnL,KAC1B/wB,KAAKmsB,IAAI2lJ,cAAgB9xK,KAAKo4M,SAASrnL,OAEvC/wB,KAAKm+K,aACLn+K,KAAKq+K,YAAY30J,IAEf1pB,KAAK+0H,SACP/0H,KAAKm+K,cAELn+K,KAAKu9K,SAAW,eAChBv9K,KAAK+0H,SAAW3nF,YACd,KACMptC,KAAK4xK,KAAO5xK,KAAKo4M,SAASrnL,KAAO/wB,KAAKmsB,IAAI2lJ,cAC5C9xK,KAAKm+K,aAELn+K,KAAK4xK,KAAO5xK,KAAK4xK,KAAO5xK,KAAKo4M,SAASrnL,KAExC/wB,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,KAAI,EAEhC5xK,KAAKs4M,aACLt4M,MAGN,CAEAm+K,aACMn+K,KAAK+0H,UACPxnF,cAAcvtC,KAAK+0H,UAErB/0H,KAAK+0H,cAAW/yH,EAChBhC,KAAKu9K,SAAW,aAClB,CAEAm6B,uBAAuBhuL,GACrB1pB,KAAKg5B,KAAO,IAAI/3B,KAAKyoB,EAAMhjB,OAC3B1G,KAAKk5M,oBAAoBl5M,KAAK63M,uBAC9B73M,KAAK21M,iBAAiBjsL,EACxB,CAEA4tL,uBAAuB5tL,GACrB1pB,KAAK4xK,KAAOloJ,EAAMhjB,MAClB1G,KAAKm4M,WAAW/pM,KAAKpO,KAAK4xK,KAC5B,CAEA6lC,oBAKE,OAJ6B,IAAzBz3M,KAAKH,QAAQq3C,SAAqBl3C,KAAKosB,MAEzCpsB,KAAKg5B,KAAOh5B,KAAKy5M,eADG,IAAIx4M,OAGtBjB,KAAKwD,OAAS4vE,IAAeiiC,KACxBr1G,KAAK4xK,UAES5vK,IAAdhC,KAAKg5B,KAAqBh5B,KAAKosB,IAAIlrB,UAAYlB,KAAKg5B,KAAK93B,SAEpE,CAEA22M,sBACE,IAAIrsL,EAEJ,OAAQxrB,KAAKwD,MACX,KAAK4vE,IAAe+hC,KAClB3pF,OACgBxpB,IAAdhC,KAAKg5B,KACDh5B,KAAKosB,IAAIstL,eACT15M,KAAKg5B,KAAK0gL,eAChB,MACF,KAAKtmI,IAAegiC,KAClB5pF,OACgBxpB,IAAdhC,KAAKg5B,KACDh5B,KAAKosB,IAAIutL,eACT35M,KAAKg5B,KAAK2gL,eAChB,MAEF,QACEnuL,OACgBxpB,IAAdhC,KAAKg5B,KACDh5B,KAAKosB,IAAI+mD,cACTnzE,KAAKg5B,KAAKm6C,cAIpB,OAAO3nD,CACT,CAEAstL,kBACM94M,KAAKmW,QAAUm9D,IAAgBgiC,QACjCt1G,KAAK61M,UAAY,IAAI50M,KAAKjB,KAAKg5B,MAC/Bh5B,KAAK61M,UAAU+D,YAAa55M,KAAK+wB,KAAO,KACxC/wB,KAAK81M,QAAU,IAAI70M,KAAKjB,KAAK61M,WAC7B71M,KAAK81M,QAAQ8D,WAAW55M,KAAK+wB,KAAO,OAC1B/wB,KAAKq2M,SAAar2M,KAAKg5B,MACjCh5B,KAAK81M,QAAU,IAAI70M,KAAKjB,KAAKg5B,MAC7Bh5B,KAAK61M,UAAY,IAAI50M,KAAKjB,KAAKg5B,SACtBh5B,KAAKq2M,UAAcr2M,KAAKg5B,MAASh5B,KAAKg5B,OAKrCh5B,KAAKg5B,OAJfh5B,KAAK61M,eACgB7zM,IAAnBhC,KAAK61M,UAA0B,IAAI50M,KAAKjB,KAAKosB,KAAOpsB,KAAK61M,UAC3D71M,KAAK81M,aACc9zM,IAAjBhC,KAAK81M,QAAwB,IAAI70M,KAAKjB,KAAKmsB,KAAOnsB,KAAK81M,QAO7D,CAEAiD,kBACE,OAAQ/4M,KAAKwD,MACX,KAAK4vE,IAAe+hC,WACKnzG,IAAnBhC,KAAK61M,gBAA4C7zM,IAAjBhC,KAAK81M,WACvC91M,KAAK61M,UAAU/wB,SAAS,GACxB9kL,KAAK61M,UAAUgE,WAAW,GAC1B75M,KAAK61M,UAAU+D,WAAW,GAC1B55M,KAAK81M,QAAQhxB,SAAS,IACtB9kL,KAAK81M,QAAQ+D,WAAW,IACxB75M,KAAK81M,QAAQ8D,WAAW,KAE1B,MACF,KAAKxmI,IAAegiC,KAClB,GAAIp1G,KAAKmW,QAAUm9D,IAAgBC,SAAU,CAC3C,GAAIvzE,KAAK61M,UAAUiE,WAAa95M,KAAKosB,IAAI0tL,SAAU,CACjD,MAAMC,EAAe/5M,KAAK61M,UAAU1wB,WAC9B60B,EAAiBh6M,KAAK61M,UAAUvwB,aACtCtlL,KAAK61M,UAAY71M,KAAKosB,IACtBpsB,KAAK61M,UAAU/wB,SAASi1B,GACxB/5M,KAAK61M,UAAUgE,WAAWG,EAC5B,CAEA,GAAIh6M,KAAK81M,QAAQgE,WAAa95M,KAAKosB,IAAI0tL,SAAU,CAC/C,MAAMC,EAAe/5M,KAAK81M,QAAQ3wB,WAC5B60B,EAAiBh6M,KAAK81M,QAAQxwB,aACpCtlL,KAAK81M,QAAU91M,KAAKosB,IACpBpsB,KAAK81M,QAAQhxB,SAASi1B,GACtB/5M,KAAK81M,QAAQ+D,WAAWG,EAC1B,CACF,EAEKh6M,KAAKq2M,SAAWr2M,KAAK+wB,KAAO,OAC/B/wB,KAAK61M,UAAUgE,WAAW,GAC1B75M,KAAK61M,UAAU+D,WAAW,GAC1B55M,KAAK81M,QAAQ+D,WAAW,IACxB75M,KAAK81M,QAAQ8D,WAAW,KAOhC,CAEA1D,kBACE,YAA0Bl0M,IAAnBhC,KAAK61M,UAA0B71M,KAAKosB,IAAMpsB,KAAK61M,SACxD,CAEAG,kBACE,YAAwBh0M,IAAjBhC,KAAK81M,QAAwB91M,KAAKmsB,IAAMnsB,KAAK81M,OACtD,CAQA2D,eAAezgL,EAAMihL,EAAW,IAC9B,MAAMC,EAAQ,IAAYD,EAC1B,OAAO,IAAIh5M,KAAKirB,KAAKiwE,MAAMnjE,EAAK93B,UAAYg5M,GAASA,EACvD,CAOA7B,kBAAkBtnL,GAChB,OAAO2G,cAAgB3G,GAAM+qJ,gBAC/B,4CAxgBWg8B,GAAuB12M,MAAAuE,OAAA,+BAAvBmyM,EAAuBxpM,UAAA,2BAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,SA4CvB8vK,MAAS,ksDDjBtBx9K,MAtFA,EAAA+4M,GAAA,YAsFA/4M,CAtFqD,EAAAg5M,GAAA,aAsIrDh5M,MAAA,QAoEAA,MAnEA,EAAAi5M,GAAA,cAmEAj5M,CAhEC,EAAAk5M,GAAA,qBA1IKl5M,MAAA,oBAAA2N,EAAAoH,OAAA,SAAApH,EAAAvL,MAsFApC,cAAA,oBAAA2N,EAAAoH,OAAA,SAAApH,EAAAvL,MAkDHpC,MAAA,GAAAA,MAAA,QAAA2N,EAAAsnM,SAAA,WAAAtnM,EAAAoH,OAAA,SAAApH,EAAAvL,MAmEApC,cAAA,kBAAA2N,EAAAoH,OAAA,SAAApH,EAAAvL,sBCjKC2L,KACA8a,MAAkBrkB,YAClB20M,MAAuB10M,kBACvBk3B,MACAF,MAAc/2B,MACd22B,KAAW12B,eACXmkB,MAAelkB,MAAAL,MACf8O,KACA0V,MACA40J,MAAepqK,YACfg/E,MAAoB9+E,MACpBxF,KAAgByF,KAChBvF,KAAeutB,KACfttB,KAAawtB,KACbrtB,KAAiButB,MAAArtB,OAAA,shBAGRioM,CAAuB,4FCxClC12M,MAAA,yDAaEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAoxB,EAAAtgC,MAAA,UAAAA,MAAAsgC,EAAA+gB,MAAA5rB,SAAA6K,EAAA+gB,MAAA5rB,QAAA,GAEAz1B,MAAA,kCACGA,MAAA,GAELA,mCAVEA,MAJA,QAAAsgC,EAAA+gB,MAAA5rB,QAAA,oBAIAz1B,CAJ+C,aAAAsgC,EAAA+gB,MAAA5rB,QAAAz1B,MAAA,+BAAAA,MAAA,gCAWrCA,MAAA,GAAAA,MAAA,UAAAA,MAAA,GAAA+zC,IAAA,IAAA/zC,MAAA,IAAAsgC,EAAA60J,sBACPn1L,MAAA,GAAAA,MAAA,GAAAsgC,EAAA+gB,MAAA5rB,QAAA,6EAlCLz1B,MADF,kBACEA,CAD4B,gBAO1BA,MAAA,mBAAAA,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAu0J,yBAAwB,GAEjC70L,MAAA,mBACFA,QAEAA,MAAA,YAEEA,MAAA,mBAAAA,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA00J,sBAAqB,GAE7Bh1L,MAAA,GAAiBA,QAGpBA,MAAA,EAAAo5M,GAAA,iBAmBFp5M,2CAjCIA,QACAA,MADA,SAAAq5M,EACAr5M,CADkB,YAAAsgC,EAAAy0J,kBAUlB/0L,MAAA,GAAAA,MAAA,UAAAA,MAAA,EAAAoW,GAAAkqB,EAAAy0J,iBAAA,sBACC/0L,cAAAsgC,EAAA+gB,MAAA72C,OAIAxK,cAAA,OAAAsgC,EAAAmM,kCAsBDzsC,MAAA,8CAA8CA,MAAA,QAAAsgC,EAAA+gB,QCH3C,IAAMi4J,GAAuB,MAA9B,MAAOA,EAeSC,kBAdbpvM,MAAQ,UACfkrL,YAAwC,IAAI10L,MAAgB,GAC5Dw0L,mBAA+C,IAAIx0L,MAAgB,GAC3D2iG,aAERyxF,kBAA4B,EAEnBtoJ,QAAkB,EAElB4U,MAET,cAAIwzG,GACF,OAAOj2J,KAAKyiD,MAAMpsB,UACpB,CACAt2B,YAAoB46M,GAAA36M,KAAA26M,mBAAuC,CAE3DptM,WAEEvN,KAAK0kG,aADe1kG,KAAKyiD,MAAMhiC,IAAIyhC,eAAe+iD,YAClBpiG,UAAU,KACxC7C,KAAKu2L,mBAAmB5zL,KAAK3C,KAAKyiD,MAAM2hE,qBAAoB,EAEhE,CAEAl2G,cACElO,KAAK0kG,aAAav2F,aACpB,CAEAooM,iBAAiB3kC,GACf5xK,KAAK26M,kBAAkBhpC,aAAa3xK,KAAKi2J,WAAY2b,EACvD,CAEA+jC,iBAAiB38K,GACfh5B,KAAK26M,kBAAkBtpC,aAAarxK,KAAKi2J,WAAYj9H,EACvD,CAEQ6+J,aAAa/mL,GACnB9Q,KAAKyiD,MAAMohE,gBAAkB/yG,EAC7B9Q,KAAKy2L,YAAY9zL,MAAMmO,EACzB,CAEAslL,sBACOp2L,KAAKm2L,kBACRn2L,KAAK63L,aAAa73L,KAAKy2L,YAAY/vL,MAEvC,CAEOk+G,aACL5kH,KAAKyiD,MAAM5rB,SAAU,CACvB,CAEAo/J,yBACEj2L,KAAKm2L,kBAAoBn2L,KAAKm2L,gBAChC,4CArDWukB,GAAuBt5M,MAAAuE,GAAA,+BAAvB+0M,EAAuBpsM,UAAA,2BAAAC,OAAA,CAAAs/B,OAAA,SAAA4U,MAAA,SAAAh0C,YAAA,EAAAlE,SAAA,CAAAnJ,MAFvB,CAACgwK,IAAkBhwK,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,0pBAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDrChC1N,MAAA,EAAAw5M,GAAA,uBAyCEx5M,MADF,YACEA,CADqD,aAEnDA,MAAA,EAAAy5M,GAAA,2CAEFz5M,QACAA,MAAA,4BAKEA,MADA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAA4mM,iBAAAl+L,GAAwB,EAClCrW,CADmC,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MACrB2N,EAAAwnM,iBAAA9+L,GAAwB,GAG1CrW,gBArDgBA,MAAA,OAAA2N,EAAA8+B,QA0COzsC,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,EAAA0nL,cAInBr1L,MAAA,GAEAA,MAFA,QAAA2N,EAAA0zC,MAEArhD,CAFe,UAAA2N,EAAAknJ,WAAAp2J,QAAAkwE,WAEf3uE,CADyC,eAAA2N,EAAAknJ,WAAAp2J,QAAAkH,OAAAquG,sBCvBzCjmG,KACAC,MAAaxJ,wBACb4J,KAAa3J,KACb6Q,MACA4mB,KACA/tB,KAAezJ,KACfuJ,KAAgBtJ,KAChBuJ,KACAynK,GACA+gC,GACApoM,KACAC,KAAiB3J,MAAA6J,OAAA,wSAIR6qM,CAAuB,+BCvCpCt5M,MAAA,mCASEA,MAAA,gBAKGA,MAAA,aAELA,gCATEA,MADA,aAAAA,MAAA,+BACAA,CADoD,QAAAqnB,EAAAld,OAKlDnK,MAAA,GAAAA,MAAA,WAAAqnB,EAAAzS,iCAYF5U,MAAA,kDAIEA,MADA,YACAA,CADgB,QAAAqnB,EAAAg6B,kCARpBrhD,MAAA,aAKEA,MAAA,EAAA05M,GAAA,8BAOF15M,8BANKA,MAAA,GAAAA,MAAA,OAAAqnB,EAAAsyL,oBAAAtyL,EAAA5oB,QAAAkwE,aCcE,IAAMirI,GAAyB,MAAhC,MAAOA,EACJn7M,QAEP,SAAImW,GACF,MAAMtM,EAAS1J,KAAKH,QAAQkwE,WAC5B,GAAIrmE,GAAUA,EAAOinC,QACnB,OAAO,CAIX,CAEA,SACI8R,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,EACVA,IACF1G,KAAKH,QAAUG,KAAKyiD,MAAMpsB,WAAWx2B,QAEzC,CACQimI,OAECrlH,IAEAlV,MAAgB,UAEhBsiC,QAAkB,EAEpBktK,oBAAqB,EAE5Bh7M,cAAe,CAEfwN,WACEvN,KAAKH,QAAUG,KAAKyiD,MAAMpsB,WAAWx2B,OACvC,4CApCWm7M,EAAyB,+BAAzBA,EAAyB1sM,UAAA,6BAAAC,OAAA,CAAAk0C,MAAA,QAAAhiC,IAAA,MAAAlV,MAAA,QAAAsiC,OAAA,UAAAp/B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,ghBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDpBtC1N,MAlBA,EAAA65M,GAAA,eAkBA75M,CAVC,EAAA85M,GAAA,mBAPE95M,MAAA,OAAA2N,EAAA8+B,QAAA9+B,EAAAlP,QAAAowE,gBAAAlhE,EAAAlP,QAAAkwE,YAoBA3uE,cAAA,OAAA2N,EAAA8+B,QAAA9+B,EAAAlP,QAAAowE,gBAAAlhE,EAAAlP,QAAAkwE,4BCOC5gE,KACAI,KAAe5J,KACf0J,KAAgBzJ,KAChB4J,KAAa3J,KACbw3J,IAAcv3J,IACd40M,GACAxpK,KACAvhC,KAAiB5J,MAAA+J,gBAAA,WAGRkrM,CAAyB,8BChClC55M,MAAA,qDAGEA,MAFA,YAEAA,CAFe,QAAAq4L,ICoBd,IAAM0hB,GAAuB,MAA9B,MAAOA,EAWSppM,MAVpB,UACI+tC,GACF,OAAO9/C,KAAKo7M,OACd,CACA,UAAIt7J,CAAOp5C,GACT1G,KAAKo7M,QAAU10M,EACf1G,KAAK+R,MAAM4K,eACb,CACQy+L,QAAmB,GAE3Br7M,YAAoBgS,GAAA/R,KAAA+R,OAA2B,4CAXpCopM,GAAuB/5M,aAAA,+BAAvB+5M,EAAuB7sM,UAAA,2BAAAC,OAAA,CAAAuxC,OAAA,UAAArxC,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,8FAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID3BpC1N,MAAA,gBACEA,MAAA,EAAAi6M,GAAA,qDAWFj6M,eAZ+BA,MAArB,gBAAqBA,CAAD,gBAI1BA,cAAA,UAAAA,MAAA,IAAA2N,EAAA+wC,OAAA,yBCgBAlN,KACAn+B,KACAimM,GACAxpK,KACAmoJ,IAAwB72J,cAAA,EAAA1yB,gBAAA,WAGfqrM,CAAuB,KChBvBG,GAA8B,MAArC,MAAOA,EAMD39I,WALFvhD,UACAqtC,SAER1pD,YACUqc,EACAuhD,GAAA39D,KAAA29D,aAER39D,KAAKoc,UAAYA,CACnB,CAEA7O,WAEEvN,KAAKoc,UAAU0jC,OAAS,GAExB9/C,KAAKypD,SAAWzpD,KAAK29D,WAAWS,SAASjc,QAAQt/C,UAAWi9C,IAC1D9/C,KAAKoc,UAAU0jC,OAASA,GAE5B,CAEA5xC,cACElO,KAAKypD,SAASt7C,aAChB,4CAtBWmtM,GAA8Bl6M,MAAAuE,GAAA,GAAAvE,MAAAwE,MAAA,+BAA9B01M,EAA8BhtM,UAAA,qCAAAG,YAAA,WAA9B6sM,CAA8B,+BCX3Cl6M,MAAA,mCAQEA,MAAA,cAAUA,MAAA,eACZA,gCAHEA,MADA,aAAAA,MAAA,+BACAA,CADoD,QAAAqnB,EAAAld,QCqB/C,IAAMgwM,GAAqB,MAA5B,MAAOA,EACX,SACI94J,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,CAChB,CACQo/H,OAER,SACIv6H,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,GACR1G,KAAKmxC,OAASzqC,CAChB,CACQyqC,OAAS,UAEjBpxC,cAAe,CAEf,WAAIF,GACF,GAAKG,KAAKyiD,MAGV,OAAOziD,KAAKyiD,MAAMpsB,WAAWx2B,OAC/B,CAEA27M,oBACE,SACGx7M,KAAKyiD,iBAAiBsZ,QAAyC,IAA1B/7D,KAAKyiD,MAAM24C,YAChDp7F,KAAKyiD,MAAMpsB,WAAWx2B,QAAQwgF,UAC7BrgF,KAAKyiD,MAAMpsB,WAAWx2B,QAAQwgF,SAAS99E,KACxCvC,KAAKyiD,MAAM5iD,QAAQ46C,WAAW9J,SAC7B3wC,KAAKyiD,MAAM5iD,QAAQ46C,WAAWghK,cAAgBz7M,KAAKyiD,MAAMvwC,GAK/D,4CAvCWqpM,EAAqB,+BAArBA,EAAqBjtM,UAAA,wBAAAC,OAAA,CAAAk0C,MAAA,QAAAl3C,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qNAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD1BlC1N,MAAA,EAAAs6M,GAAA,qBACGt6M,MAAA,OAAA2N,EAAAysM,oCCkBCrsM,KACAI,KAAe5J,KACf0J,KAAgBzJ,KAChB4J,KAAa3J,KACb8J,KAAiB7J,MAAAgK,gBAAA,WAGRyrM,CAAqB,6FCb3B,IAAMI,GAAgB,MAAvB,MAAOA,EACHC,UAAoB,GACpBp5I,WAERziE,YAAYwM,GACVvM,KAAKwiE,WAAa,IAAIK,KAAWt2D,EACnC,CAKO8uD,aAAa90D,GAClB,OAAOgW,MAAYsyB,QAAQ7uC,KAAK47M,UAAWr1M,EAC7C,CAKO2e,KAAKrlB,GACV,MAAMg8M,EAAgBh8M,EAAQysD,SAAW,GACzC,OAAKzsD,EAAQwjE,KAKN,IAAIz0B,QAAQ,CAACC,EAASy0B,KAC3BtjE,KAAKwiE,WACFtiE,IAAIL,EAAQwjE,MACZt/D,QACCG,MAAYE,IACV8+D,QAAQK,IAAI,kBAAkB1jE,EAAQwjE,0BACtCx0B,GAAQ,IAAI,EACL20B,MAAWp/D,EAAMA,OAAS,mBAGpCvB,UAAWi5M,IACV97M,KAAK47M,UAAYr/L,MAAYsjC,UAC3Bg8J,EACAC,GAEFjtK,GAAQ,EAAI,EACb,IApBH7uC,KAAK47M,UAAYC,GACV,EAqBX,4CA3CWF,GAAgBv6M,MAAAuE,MAAA,iCAAhBg2M,EAAgBt6M,QAAhBs6M,EAAgBr6M,UAAAC,WAFf,gBAEDo6M,CAAgB,6CCbvB,MAAO91J,WAAoB7jC,OAE3B,MAAO+5L,WAA+Bl2J,GAC1C9lD,cACEqG,MAAM,gBACNI,OAAOu/C,eAAe/lD,KAAM+7M,GAAuB/gM,UACrD,EAGI,MAAO8qC,WAAmCD,GAC9C9lD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM8lD,GAA2B9qC,UACzD,ECXK,MAAMghM,MAAeltD,OAAQ,CAClC,MACA,UACA,MACA,MACA,MACA,YACA,WACA,iBAIWmtD,MAAiBntD,OAAQ,CAAC,OAAQ,WCSxC,IAAMotD,GAAa,MAApB,MAAOA,EAeSj8M,OAdpBwsB,mBAAqB,CACnB0vL,IAAK,MACLC,IAAK,MACLC,IAAK,MACLC,UAAW,iBACXC,SAAU,WACVC,aAAc,gBAGhB/vL,uBAAyB,CAAC,MAAO,MAAO,OAEhCgwL,QACAC,oBAA8B,EAEtC38M,YAAoBE,GAAAD,KAAAC,SAClBD,KAAKy8M,QAAUz8M,KAAKC,OAAOG,UAAU,oBACrC,MAAMu8M,EAAwB38M,KAAKC,OAAOG,UACxC,2CAE4B4B,IAA1B26M,IACF38M,KAAK08M,mBAAqBC,EAE9B,CAEA12J,OACEhC,EACAtsB,EACA/rB,EACAgxM,EACAj7G,EAAe,YACfN,EAAgB,aAEhB,MAAMw7G,GAAmB78M,KAAKukD,gBAC5BN,EACAtsB,EACA,iBAGF,OAAO33B,KAAKkmD,YACV22J,GACAllL,EACA/rB,EACAgxM,EACAj7G,EACAN,EAEJ,CAEO98C,gBACLN,EACAtsB,EACAmlL,EAAwB,KAExB,OAAInlL,IAAWqkL,GAAaI,KAAOp8M,KAAK08M,mBAC/B18M,KAAK+8M,0BAA0B94J,GAGjCA,EAAWxjC,IAAKksE,IACrB,IAAIlmF,EAAOkmF,EACRtwB,UACA3yD,OAAQnD,KAAiBA,GAAIw6F,WAAW+7G,IAEvCnlL,IAAWqkL,GAAaM,WAAa3vH,EAAUzsF,IAAI,WACvC+3B,KAAKouB,UAAUsmC,EAAUzsF,IAAI,WACjC0J,OAtEiB,MAuEzBnD,EAAOA,EAAKiD,OAAQnD,IAAgB,WAARA,KAGhC,MAAM8wB,EAAa5wB,EAAKyZ,OACtB,CAACC,GAAa5Z,MACZ4Z,GAAI5Z,IAAOomF,EAAUzsF,IAAIqG,IAClB4Z,IAET,CAAEmpE,SAAUqD,EAAUQ,gBAExB,OAAO,IAAIguB,KAAU9jF,EAAU,EAEnC,CAEQ0lL,0BACN94J,GAEA,OAAOA,EAAWxjC,IAAKksE,IACrB,MAAMlmF,EAAOkmF,EACVtwB,UACA3yD,OAAQnD,KAAiBA,GAAIw6F,WAAW,MAC3C,IAAIojD,EAAkB,GACtB,MAAM9sH,EAAa5wB,EAAKyZ,OACtB,CAACC,GAAa5Z,MACRA,IAAe,aAARA,KACD,OAARA,IAAgBomF,EAAUzsF,IAAI,QACzBikJ,GAAW59I,GAAM,IAAMomF,EAAUzsF,IAAI,QAAU,UAC/CikJ,GAAW59I,GAAM,IAAMomF,EAAUzsF,IAAIqG,IAAO,WAEnD4Z,GAAI5Z,IAAOomF,EAAUzsF,IAAIqG,IAClB4Z,IAET,CACEmpE,SAAUqD,EAAUQ,gBAGlB+iE,EAAa,IAAI/0C,KAAU9jF,GACjC64H,SAAW7vJ,IAAI,OAAQssF,EAAU/P,SACjCszE,EAAW7vJ,IAAI,MAAO8jJ,GAEf+L,GAEX,CAEQhqG,YACNjC,EACAtsB,EACA/rB,EACAgxM,EACAj7G,EACAN,GA+CA,OAAO,IAAIzmF,KA7COouB,KAEhB,GADwBhpC,KAAKmmD,gBAAgBlC,EAAYtsB,GAEvDqR,GAAS5kC,MAAM,IAAI0hD,SAKrB,GADoBt/C,OAAOC,KAAKy1M,EAAcc,aAC9Bt0M,QAAQivB,IAAW,EAAG,CACpC,IAAK33B,KAAKy8M,QAaR,YAZIP,EAAce,gBAAgBv0M,QAAQivB,IAAW,EACnD33B,KAAKk9M,aACHj5J,EACAjb,GACArR,EACA/rB,EACA+1F,EACAN,GAGFr4D,GAAS5kC,MAAM,IAAI23M,KAIvB/7M,KAAKm9M,eACHl5J,EACAjb,GACArR,EACA/rB,EACAgxM,EACAj7G,EACAN,EAEJ,MACErhG,KAAKk9M,aACHj5J,EACAjb,GACArR,EACA/rB,EACA+1F,EACAN,EAAa,EAMrB,CAEU67G,aACRj5J,EACAjb,EACArR,EACA/rB,EACA+1F,EACAN,GAGA,MAAM+7G,IADW,IAAIrlI,GAASpgD,IACA6sB,cAAcP,EAAY,CACtDQ,eAAgB48C,EAChB38C,kBAAmBi9C,EACnB+yE,YAAa,UACb9lE,UAAW,+BAGPyuG,GAAW,GAAGzxM,KAAS+rB,EAAOQ,iBAEpCmuB,SAAgB82J,GAAc,iCAAkCC,IAChEr0K,EAASM,UACX,CAEQ6zK,eACNl5J,EACAjb,EACArR,EACA/rB,EACA0xM,EACA37G,EACAN,IAEA,IAAI+7G,IAAuB,IAAIrlI,MAAmBvzB,cAChDP,EACA,CACEQ,eAAgB48C,GAChB38C,kBAAmBi9C,IAIvB,MAAMp/F,GAAM,GAAGvC,KAAKy8M,sBACdt8K,GAAO73B,SAASC,cAAc,QAOpC,GANA43B,GAAKhqB,MAAMlI,QAAU,OACrB3F,SAASlF,KAAK6zF,YAAY92D,IAC1BA,GAAK29H,aAAa,SAAU,QAC5B39H,GAAK29H,aAAa,SAAU,UAC5B39H,GAAK29H,aAAa,SAAUv7J,IAExB+6M,IAAiBrB,GAAesB,KAClCp9K,GAAKq9K,cAAgB,QACrBr9K,GAAKs9K,QAAU,4DACNH,IAAiBrB,GAAeyB,OAAQ,CACjD,MAAMD,GAAU,aACVE,GAAe1lL,KAAKC,MAAMklL,IAChCO,GAAapzM,SAASkW,IAAK0lB,KACzB,MAAMy3K,GAAoBn0K,OAAOo0K,aAAa3nH,MAC5C,QACAhxF,OAAO+yB,KAAKouB,UAAUlgB,GAAE9O,YAAa,CAAE9kB,KAAM,iBAE/C4zB,GAAE9O,WAAaY,KAAKC,MAAM0lL,GAAiB,GAE7CR,GAAenlL,KAAKouB,UAAUs3J,IAC9B,MAAMf,GAAWt0M,SAASC,cAAc,SACxCq0M,GAAS9+C,aAAa,OAAQ,UAC9B8+C,GAAS9+C,aAAa,OAAQ,YAC9B8+C,GAAS9+C,aAAa,QAAS2/C,IAC/Bt9K,GAAK82D,YAAY2lH,GACnB,CAEA,GAAe,iBAAXjlL,EAA2B,CAC7B,MAAM93B,GAAUyI,SAASC,cAAc,SACvC1I,GAAQi+J,aAAa,OAAQ,UAC7Bj+J,GAAQi+J,aAAa,OAAQ,OAC7Bj+J,GAAQi+J,aAAa,QAAS,uBAC9B39H,GAAK82D,YAAYp3F,GACnB,CAEA,MAAMi+M,GAAex1M,SAASC,cAAc,SAC5Cu1M,GAAahgD,aAAa,OAAQ,UAClCggD,GAAahgD,aAAa,OAAQ,QAClCggD,GAAahgD,aAAa,QAASs/C,IACnCj9K,GAAK82D,YAAY6mH,IAEjB,MAAMC,GAAkBz1M,SAASC,cAAc,SAC/C,IAAIy1M,GACS,cAAXrmL,EACI,GAAG/rB,QACH,GAAGA,KAAS+rB,EAAOQ,iBACV,aAAXR,GAAoC,iBAAXA,KAC3BqmL,GAAa,GAAGpyM,SAElBoyM,GAAaA,GAAWtlL,QAAQ,IAAK,KACrCslL,GAAaA,GACVvlL,UAAU,OACVC,QAAQ,mBAAoB,IAC5BA,QAAQ,UAAM,KACjBqlL,GAAgBjgD,aAAa,OAAQ,UACrCigD,GAAgBjgD,aAAa,OAAQ,cACrCigD,GAAgBjgD,aAAa,QAASkgD,IACtC79K,GAAK82D,YAAY8mH,IAEjB,IAAIE,GAAa/B,EAAcc,YAAYrlL,IAC5B,aAAXA,GAAoC,iBAAXA,KAC3BsmL,GAAa,OAEf,MAAMC,GAAoB51M,SAASC,cAAc,SACjD21M,GAAkBpgD,aAAa,OAAQ,UACvCogD,GAAkBpgD,aAAa,OAAQ,UACvCogD,GAAkBpgD,aAAa,QAASmgD,IACxC99K,GAAK82D,YAAYinH,IAEjB/9K,GAAKg+K,SACL71M,SAASlF,KAAKqjJ,YAAYtmH,IAE1B6I,EAASM,UACX,CAEQ6c,gBACNlC,EACAtsB,GAEA,OAA0B,IAAtBssB,EAAWr6C,QAGA,QAAX+tB,QAQqB31B,IAPHiiD,EAAW7hC,KAAMuqE,GAEjC,CAAC,QAAS,aAAc,mBAAmBjkF,QACzCikF,EAAUQ,cAAc8U,YACrB,EAMb,4CA5SWi6G,GAAa96M,MAAAuE,MAAA,iCAAbu2M,EAAa76M,QAAb66M,EAAa56M,UAAAC,WAFZ,gBAED26M,CAAa,6CCvBpB,MAAO31J,WAAoBvkC,OAE3B,MAAOwkC,WAA+BD,GAC1CxmD,cACEqG,MAAM,gBACNI,OAAOu/C,eAAe/lD,KAAMwmD,GAAuBxrC,UACrD,EAGI,MAAOyrC,WAAkCF,GAC7CxmD,cACEqG,MAAM,uBACNI,OAAOu/C,eAAe/lD,KAAMymD,GAA0BzrC,UACxD,EAGI,MAAO0rC,WAAmCH,GAC9CxmD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM0mD,GAA2B1rC,UACzD,EAGI,MAAO2rC,WAAwBJ,GACnCxmD,cACEqG,MAAM,qBACNI,OAAOu/C,eAAe/lD,KAAM0mD,GAA2B1rC,UACzD,EAGI,MAAOojM,WAAuB73J,GAClCxmD,cACEqG,MAAM,0BACNI,OAAOu/C,eAAe/lD,KAAM0mD,GAA2B1rC,UACzD,EAGI,MAAOqjM,WAA8B93J,GACzCxmD,cACEqG,MAAM,uBACNI,OAAOu/C,eAAe/lD,KAAMq+M,GAAsBrjM,UACpD,8BCmMF,SAASsjM,GAAaC,GACpB,OAAOA,EAAIpmJ,WAAWqmJ,SAAS,EAAG,IACpC,CAEM,SAAUt0J,GACdhF,EACA36C,EACAkW,EACAokE,EACAjjF,EACAy4D,EACAuD,EACAtD,EACAC,IAEA,GAAwB,IAApBhwD,EAASX,OAEX,YAgHE,SAAUugD,GACdjF,EACAtjD,GAEAA,EAAewC,MACb,iCACA,uCACApC,EACA,CACE0E,MAAOw+C,EAAKl2B,KACZ63B,SAAU3B,EAAK1hD,MAGrB,CA9HI2mD,CAA2BjF,EAAMtjD,GAInC,IAAI+6J,GAAatyG,GAA0BnF,IAE9B0Y,EACTA,EAAqBrlD,KAAK,oCAAiC,EAC3D3U,QAAG,IAEFG,QAAKs5C,SAASx6C,UAAWg8D,KAC5B,MAAMoX,GAAI,IAAIh1E,KACRw9M,GACJ,CACExoI,GAAE67F,cACFwsC,GAAaroI,GAAE+7F,WAAa,GAC5BssC,GAAaroI,GAAEyoI,YACf70M,KAAK,KACP,IACA,CAACy0M,GAAaroI,GAAEkvG,YAAam5B,GAAaroI,GAAEqvG,eAAez7K,KAAK,KAElE8yJ,GAAa99F,GAAU,GAAG89F,OAAe8hD,MAAa9hD,GACjDriG,EArMH,SAAUqkJ,GACdp0M,EACAkW,EACAk8I,EACAriG,EACAC,EACAqhB,EACAgjI,EACAC,EACAxvF,IAAkB,GAElB,MAAMprE,GAAa15C,EAASkW,IAAK3V,OAC/Bs2F,OAAYt2F,GAAS2V,EAAIuhC,aAE3B,IAAI7rC,GACAilD,GA6EA33C,GA3EJ,GACE62C,EAAiBe,aAAashG,EAAWxkG,WAAa,qBACtD,CACA,MAAM1U,GAAqC6W,EAAiBe,aAC1DshG,EAAWxkG,WAAa,qBAG1BhiD,GAAQA,CAACrL,GAASwwD,KACTf,EAAagB,uBAClBzwD,GACA24C,GACA6X,GAGN,SACEhB,EAAiBe,aAAashG,EAAWxkG,WAAa,iBACtD,CACA,MAAMqD,GAA6BlB,EAAiBe,aAClDshG,EAAWxkG,WAAa,iBAE1BiD,GAAWd,EAAiBe,aAC1BshG,EAAWxkG,WAAa,aAG1BhiD,GAAQA,CAACrL,GAASwwD,MAChB,MAAMG,GAAYlB,EAAamB,YAC7BpB,EAAiBe,aAAashG,EAAWxkG,WAAa,iBACtDrtD,GACAwwD,IAEF,OAAOf,EAAaoB,mBAClB7wD,GACAwwD,GACAE,GACAC,GAAS,CAGf,SAAWnB,EAAiBe,aAAashG,EAAWxkG,WAAa,UAC/DhiD,GAAQA,CAACrL,GAASwwD,KAChBf,EAAamB,YACXpB,EAAiBe,aAAashG,EAAWxkG,WAAa,UACtDrtD,GACAwwD,SAAU,GAGdhB,EAAiBe,aAAa,yBACA,UAA9B9wD,EAAS,GAAG++E,SAAS9lF,KACrB,CACA,MAAMg4D,GAA6BlB,EAAiBe,aAClD,wBAEFD,GAAWd,EAAiBe,aAAa,oBAEzCllD,GAAQA,CAACrL,GAASwwD,MAChB,MAAMG,GAAYlB,EAAamB,YAC7BpB,EAAiBe,aAAa,wBAC9BvwD,GACAwwD,IAEF,OAAOf,EAAaoB,mBAClB7wD,GACAwwD,GACAE,GACAC,GAAS,CAGf,MACEtlD,GAAQA,CAACrL,GAASwwD,KAChBf,EAAamB,YACXpB,EAAiBe,aAAa,iBAC9BvwD,GACAwwD,IAKFhB,EAAiBe,aAAashG,EAAWxkG,WAAa,kBAOxD10C,GAAS,IAAIm4C,KACXp1D,OAAO6H,OANP,CACE+sD,YACA53D,KAAM,UACNu/C,WAAW,GAGgB67J,IAE/Bn7L,GAAO49B,GAAG59B,OAAOo4C,YAAY5X,KACpBqW,EAAiBe,aAAashG,EAAWxkG,aAMlD10C,GAAS,IAAIq4C,KACXt1D,OAAO6H,OALP,CACE7K,KAAM,SACNu/C,WAAW,GAGgB67J,IAE/Bn7L,GAAO49B,GAAGwa,YAAY5X,KAEtBqW,EAAiBe,aAAa,yBACA,UAA9B9wD,EAAS,GAAG++E,SAAS9lF,MAQrBigB,GAAS,IAAIm4C,KACXp1D,OAAO6H,OANP,CACE+sD,YACA53D,KAAM,UACNu/C,WAAW,GAGgB67J,IAE/Bn7L,GAAO49B,GAAG59B,OAAOo4C,YAAY5X,MAO7BxgC,GAAS,IAAIq4C,KACXt1D,OAAO6H,OALP,CACE7K,KAAM,SACNu/C,WAAW,GAGgB67J,IAE/Bn7L,GAAO49B,GAAGwa,YAAY5X,KAGxB,MAAMxB,GAAQ,IAAIsZ,KAChBv1D,OAAO6H,OACL,CACEzC,MAAO+wJ,EACPzqJ,GAAI0pE,MAAWj5D,SACfwyC,oBAAoB,EACpB1xC,UACAtN,UAEF0oM,IAGJp+L,EAAIu7C,SAASvZ,IACT4sE,OACFvrB,OAAiBrjF,EAAIyhC,eAAgB+B,GAGzC,CAkDM06J,CACEp0M,EACAkW,EACAk8I,GACAriG,EACAC,IApQF,SAAUukJ,GACdv0M,EACAkW,EACAokE,EACA83E,EACAtiG,EACAolD,GAAsB,GAEtB,MAAMx7D,EAAa15C,EAASkW,IAAK3V,OAC/Bs2F,OAAYt2F,GAAS2V,EAAIuhC,aAGrB9vC,KAAKyQ,SAMLc,GAAS,IAAIq4C,KAL0D,CAC3E5pD,KACA1O,KAAM,SACNu/C,WAAW,IAGbt/B,GAAO49B,GAAGwa,YAAY5X,GACtB,IAAIiY,GACAC,IAAoB,EAEtBlY,EAAW,GAAGoY,UAAUrkC,SAAS,WACjCisB,EAAW,GAAGoY,UAAUrkC,SAAS,aAEjCkkC,MAAcI,UAEdJ,MAAcK,SACdJ,IAAW,GAEb,MAAM1Z,GAAQ4X,EAAawkD,YAAY,CACrC3sG,KACAtG,MAAO+wJ,EACPliH,UAAW,CAAE9J,SAAS,EAAMouK,oBAAoB,GAChD5pJ,oBAAoB,EACpB1xC,UACA+/B,SAAU,CAAE2Y,aACZqjD,QAAS,CAAE6G,WAAW,EAAM5G,aAAY56B,WAAYA,GAAc,KAClE1uE,MAAO+lD,KAETzZ,GAAM2mD,aAAUzG,OAAwB1+C,EAAYxjC,EAAI0oF,iBACxD1oF,EAAIu7C,SAASvZ,KAAK,EAClBqhD,OAAiBrjF,EAAIyhC,eAAgB+B,EAGvC,CAwMM66J,CACEv0M,EACAkW,EACAokE,EACA83E,GACAtiG,EACAwE,IAYJj9D,EAAe6oD,QACb,mCACA,yCACAzoD,EACA,CAAE0E,MAAOi2J,IAAY,EAG3B,CAmBM,SAAU/1G,GACd1B,EACA9gD,EACAxC,GAEAA,EAAewC,MACb,mCACA,yCACApC,EACA,CACE0E,MAAOw+C,EAAKl2B,KACZ63B,SAAU3B,EAAK1hD,MAGrB,CAEM,SAAUwjD,GACd9B,EACA9gD,EACAxC,GAEAA,EAAewC,MACb,sCACA,4CACApC,EACA,CAAE0E,MAAOw+C,EAAKl2B,MAElB,CAEM,SAAU83B,GACd5B,EACA9gD,EACAxC,EACAmlD,GAEAnlD,EAAewC,MACb,oCACA,0CACApC,EACA,CACE0E,MAAOw+C,EAAKl2B,KACZ1P,KAAMynC,GAGZ,CAiBM,SAAUi4J,GACd95J,EACAtjD,GAEAA,EAAewC,MACb,sCACA,4CACApC,EACA,CACE0E,MAAOw+C,EAAKl2B,KACZ63B,SAAU3B,EAAK1hD,MAGrB,CAEM,SAAUy7M,GACd/5J,EACA9gD,EACAxC,GAEAA,EAAewC,MACb,sCACA,uCAEJ,CAEM,SAAUwjD,GAAiB1C,GAC/B,OAAOA,EAAKl2B,KAAK1lB,MAAM,KAAK0xB,MAAM7C,aACpC,CAEM,SAAUkyB,GAA0BnF,GACxC,OAAOA,EAAKl2B,KAAKs7B,OAAO,EAAGpF,EAAKl2B,KAAKu7B,YAAY,KACnD,CClYO,IAAM20J,GAAa,MAApB,MAAOA,EA4BDz9M,KACAxB,OA5BVwsB,kCAAoC,CAClCu3B,QAAS,UACTm4J,IAAK,MACLC,IAAK,MACLC,IAAK,MACLC,UAAW,OAGb7vL,wBAA0B,CACxB,sBACA,uCACA,sBACA,oBAGFA,2BAA6B,CAC3B,kBACA,+BACA,qBAGFA,yBAA2B,CAAC,UAAW,MAAO,MAAO,OAAQ,MAAO,OAE5DgwL,QACAp1J,sBAERtnD,YACU0B,EACAxB,GADAD,KAAAyB,OACAzB,KAAAC,SAER,MAAMk/M,EAAen/M,KAAKC,OAAOG,UAC/B,gBAEFJ,KAAKy8M,QAAU0C,EAAa58M,IAE5BvC,KAAKqnD,uBADoB83J,EAAaC,yBAEG,IAAMlzL,KAAKq7B,IAAI,KAAM,GAC1D43J,EAAaE,UACfH,EAAcp3J,kBAAoBq3J,EAAaE,QAC5C5+L,IAAKkX,GAAWunL,EAAcI,2BAA2B3nL,IACzDjuB,OAAQiiC,GAAMA,GACbuzK,EAAcp3J,kBAAkB9vB,SAAS,YAC3CknL,EAAcp3J,kBAAkBxgD,KAAK,QAG3C,CAEAkgD,OACEtC,EACAy8C,EAAe,YACfN,EAAgB,aAEhB,OAAOrhG,KAAKynD,YAAYvC,EAAMy8C,EAAcN,EAC9C,CAEQ35C,gBACNxC,GAOA,MAAMyC,EAAYC,GAAiB1C,GAC7B4C,EAAoBo3J,EAAcp3J,kBACxC,IAAIy3J,EAAe,GACfz3J,EAAkB9vB,SAAS,SAC7BunL,EAAeL,EAAcM,qBAE/B,MAAM34J,EAAW3B,EAAK1hD,KAMtB,KALyB,IACpB07M,EAAcr3J,oBACd03J,GAIc72M,QAAQm+C,GAAY,GACrCiB,EAAkBp/C,QAAQi/C,GAAa,GAGlC,IACQ,qBAAbd,GACA,CAAC,OAAQ,UAAW,MAAO,OAAOn+C,QAAQi/C,IAAc,EAExD,OAAO3nD,KAAK+nD,WACP,QAAqB/lD,IAAjBhC,KAAKy8M,QACd,OAAOz8M,KAAKy/M,mBAIhB,CAEQh4J,YACNvC,EACAy8C,EACAN,GAgBA,OAAO,IAAIzmF,KAdOouB,IAChB,GAAIkc,EAAK5lC,MAAQtf,KAAKqnD,sBAEpB,YADAre,EAAS5kC,MAAM,IAAIuiD,IAGrB,MAAMqB,EAAWhoD,KAAK0nD,gBAAgBxC,QACrBljD,IAAbgmD,EAKJA,EAAS5sC,KAAKpb,KAAMklD,EAAMlc,EAAU24D,EAAcN,GAJhDr4D,EAAS5kC,MAAM,IAAIoiD,GAI0C,EAInE,CAEQuB,WACN7C,EACAlc,EACA24D,EACAN,GAEA,MAAMp4D,EAAS,IAAIC,WAEnBD,EAAOgf,OAAUv+B,IACf,IACE,MAAMnf,GAAWvK,KAAK0/M,sBACpBx6J,EACAx7B,EAAM9S,OAAOyyB,OACbs4D,EACAN,GAEFr4D,EAASrmC,KAAK4H,GAChB,OACEy+B,EAAS5kC,MAAM,IAAIqiD,GACrB,CAEAzd,EAASM,UAAQ,EAGnBL,EAAOkf,QAAWC,IAChBpf,EAAS5kC,MAAM,IAAIqiD,GAA2B,EAGhDxd,EAAOof,WAAWnD,EAAM,QAC1B,CAEQu6J,mBACNv6J,EACAlc,EACA24D,EACAN,GAEA,MAAM9+F,EAAM,GAAGvC,KAAKy8M,kBACdr8K,EAAW,IAAIu/K,SACrBv/K,EAASg3D,OAAO,SAAUlyC,GAC1B9kB,EAASg3D,OAAO,YAAauK,GAC7BvhE,EAASg3D,OAAO,YAAaiK,GAC7BjhE,EAASg3D,OAAO,eAAgB,WAChCh3D,EAASg3D,OAAO,eAAgB,IAEhCp3F,KAAKyB,KAAKqC,KAAKvB,EAAK69B,EAAU,CAAE96B,QAAS,IAAInC,OAAiBN,UAC3DmvF,KACC,GAAiB,OAAbA,GAMJ,IADgBA,GAAiBnyD,QAAU,IAChCj2B,OAAS,EAClBo/B,EAAS5kC,MAAM,IAAIqiD,QACd,CACL,MAAMl8C,GAAWvK,KAAK4/M,yBACpB16J,EACA8sC,GACAqP,GAEFr4D,EAASrmC,KAAK4H,IACdy+B,EAASM,UACX,MAfEN,EAAS5kC,MAAM,IAAIqiD,GAerB,EAEDriD,KACCA,GAAMA,MAAMC,QAAS,EACrB,MAAMw7M,GAASz7M,GAAMA,MAAM07M,KAAO,GACnB,yBAAXD,GACF72K,EAAS5kC,MAAM,IAAIoiD,IAEnBq5J,IACAA,GAAOr0I,UAAU,6CAEjBxiC,EAAS5kC,MAAM,IAAIg6M,IAEnBp1K,EAAS5kC,MADiB,MAAjBA,GAAMuxF,OACA,IAAI0oH,GAEJ,IAAI53J,GAA2B,EAItD,CAEQi5J,sBACNx6J,EACAjhD,EACA09F,EACAN,GAEA,MAAM15C,EAAYC,GAAiB1C,GAC7B2B,EAAW3B,EAAK1hD,KAEhBwgD,GAAU,IAAI+zB,KAEpB,IAAIpgD,GACJ,GAAiB,yCAAbkvB,EACFlvB,GAAS,IAAIogD,WAAY,GACH,wBAAblxB,EACTlvB,GAAS,IAAIogD,UAAY,GACH,wBAAblxB,EACTlvB,GAAS,IAAIogD,UAEb,OAAQpwB,GACN,IAAK,MACHhwB,GAAS,IAAIogD,MACb,MACF,IAAK,MACHpgD,GAAS,IAAIogD,KACb,MACF,IAAK,MACHpgD,GAAS,IAAIogD,KACb,MACF,QACEpgD,GAASqsB,GAmBf,OAdmBrsB,GAAOwvB,aAAaljD,EAAM,CAC3CwgD,eAAgBk9C,EAChBj9C,kBAAmB28C,IAEO5gF,IAAKksE,IACxBnmF,OAAO6H,OAAO21C,GAAQ+7J,mBAAmBpzH,IAAY,CAC1D3qC,WAAYq/C,EACZhjF,KAAM,CACJnM,MAAIyQ,SACJ/W,MAAOy+C,GAA0BnF,MAMzC,CAEQ06J,yBACN16J,EACAjhD,EACAo9F,GAEA,MAAMU,EAAW,IAAIhqB,KAYrB,OAXmBgqB,EAAS56C,aAAaljD,GACbwc,IAAKksE,IACxBnmF,OAAO6H,OAAO0zF,EAASg+G,mBAAmBpzH,IAAY,CAC3D3qC,WAAYq/C,EACZhjF,KAAM,CACJnM,MAAIyQ,SACJ/W,MAAOy+C,GAA0BnF,MAMzC,4CA7QWg6J,GAAa99M,MAAAuE,MAAAvE,MAAAwE,MAAA,iCAAbs5M,EAAa79M,QAAb69M,EAAa59M,UAAAC,WAFZ,gBAED29M,CAAa,gGCIhB99M,MAAA,UACEA,MAAA,wBAIFA,wCAJEA,cAAA,IAAAA,MAAA,4CAAA4+M,EAAAC,aAAAD,GAAA,gCAKF5+M,MAAA,UACEA,MAAA,GACFA,wCADEA,cAAA,IAAA4+M,EAAAtiI,MAAA,+CAZJt8E,MAAA,mBAGEA,MAAA,iBAAAqW,GAAArW,aAAAkL,GAAAlL,MAASqW,EAAAgX,kBAAwB,GAQjCrtB,MANA,EAAA8+M,GAAA,WAMA9+M,CANoD,EAAA++M,GAAA,YAStD/+M,oCAZEA,MAAA,QAAA4+M,GAGqB5+M,cAAA,OAAA4+M,EAAAC,cAMA7+M,cAAA,QAAA4+M,EAAAC,wDAfzB7+M,MAPN,WAOMA,CAHL,UAGKA,CAF6B,mBAE7BA,CADc,eACHA,MAAA,wBAETA,QACFA,MAAA,kBAAYA,MAAA,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,qBAAAkK,EAAA+9C,UAAA5xC,KAAAnM,EAAA+9C,UAAA5xC,GAAArW,MAAAqW,EAAA,GACVrW,MAAA,EAAAg/M,GAAA,qCAiBNh/M,YAEAA,MAAA,wDAUEA,MAAA,kCAIEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAw0M,EAAAj/M,MAAA,WAAAA,MAASi/M,EAAAnpM,QAAiB,GAE1B9V,MAAA,0BACFA,QACAA,MAAA,uCACAA,MAAA,iBAMEA,MADA,mBAAAA,MAAAyK,GAAA,MAAAw0M,EAAAj/M,MAAA,WAAAA,MAAAi/M,EAAA35M,MAA2B,KAAI,EAC/BtF,CADgC,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MACtBkK,EAAAi9C,YAAA9wC,EAAAb,OAAA4xC,OAAsC,GAGtDpnD,oCAxDEA,MAAA,YAAAkK,EAAAg1M,YAKel/M,MAAA,GAAAA,YAAA,wDAGCA,MAAA,GAAAA,MAAA,QAAAkK,EAAA+9C,WAEejoD,cAAA,UAAAA,MAAA,KAAAkK,EAAAi1M,eAqB7Bn/M,MAAA,GAAAA,MAAA,aAAAkK,EAAAg1M,WAAAE,QAAAp/M,MAAA,qDAAAA,MAAA,gDAQEA,MAAA,GAAAA,MAAA,WAAAkK,EAAAg1M,WAAAE,SAAAp/M,MAAA,MAAAkK,EAAAm9C,WAKArnD,MAAA,GAAAA,MAAA,IAAAA,MAAA,oDAEWA,MAAA,GAAAA,MAAA,QAAAA,MAAA,MAAAkK,EAAAm9C,WAKXrnD,MAAA,GAAAA,MAAA,6CAQFA,MADF,QACEA,CAD2C,QACvCA,MAAA,wBAAiEA,QAEnEA,MADF,OACEA,CADE,QAEAA,MAAA,wBAIFA,QACAA,MAAA,QACEA,MAAA,yBACFA,QACAA,MAAA,SAAIA,MAAA,0BAERA,mCAbMA,MAAA,GAAAA,YAAA,sDAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,6CAAAA,MAAA,GAAAoW,GAAAlM,EAAAo9C,aAAA,KAMAtnD,MAAA,GAAAA,MAAA,IAAAA,MAAA,6DAEEA,MAAA,GAAAA,YAAA,0EAGRA,MAAA,8CAGEA,MAAA,OAAAkK,EAAAm1M,qDAnBJr/M,MAAA,gBAgBEA,MAfA,EAAAs/M,GAAA,eAeAt/M,CAf6C,EAAAu/M,GAAA,0BAqB/Cv/M,8BArBQA,cAAA,YAAAkK,EAAAm1M,0BAgBHr/M,cAAA,YAAAkK,EAAAm1M,kDAWHr/M,MAJF,eAIEA,CADD,QACKA,MAAA,wBACNA,iBADMA,MAAA,GAAAA,YAAA,qFAgBIA,MAAA,aACEA,MAAA,wBAOFA,+BAPEA,cAAA,MAAAkK,EAAAw0C,OAAAl2C,OAAA,MAAAxI,MAAA,eAAAkK,EAAAw0C,OAAA,KAAAx0C,EAAAw0C,OAAAl2C,QAAA,oHAmBAxI,MAAA,yBAIEA,MAFA,iBAAAqW,GAAArW,MAAA8tB,GAAA,MAAA0xL,EAAAx/M,QAAAmP,UAAAjF,EAAAlK,MAAA,UAAAA,MAASkK,EAAAu1M,kBAAAppM,EAAAmpM,EAAA1uM,IAAmC,EAE5C9Q,CAF6C,qBAAAA,MAAA8tB,GAAA,MAAA0xL,EAAAx/M,QAAAmP,UAAAjF,EAAAlK,MAAA,UAAAA,MAClCkK,EAAAw1M,gCAAAF,GAAsC,EACjDx/M,CADkD,kBAAAqW,GAAArW,MAAA8tB,GAAA,MAAA0xL,EAAAx/M,QAAAmP,UAAAjF,EAAAlK,MAAA,UAAAA,MACxCkK,EAAAy1M,aAAAtpM,EAAAmpM,EAAA1uM,IAA8B,GAExC9Q,MAAA,WAAOA,MAAA,wBAGTA,gBAHSA,MAAA,GAAAA,YAAA,iGAhBbA,MAAA,mBAMEA,MAAA,iBAAAqW,GAAArW,aAAA8P,GAAA9P,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,UAAoBA,MAAA,GAAiBA,QACrCA,MAAA,UACEA,MAAA,EAAA4/M,GAAA,2BAWJ5/M,iDAhBEA,MAHA,UAAAA,MAAA,EAAA+zC,GAAA7pC,EAAA21M,yBAAAL,IAGAx/M,CADE,QAAAw/M,EAAA1uM,IAIkB9Q,MAAA,GAAAA,MAAAw/M,EAAAh1M,OAGfxK,MAAA,GAAAA,MAAA,OAAAkK,EAAA21M,yBAAAL,+BAsBLx/M,MAAA,kBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAA8/M,EAAA36M,KAEAnF,cAAA,IAAAA,MAAA,6BAAA8/M,EAAAx6M,OAAA,gCALJtF,MAAA,GACEA,MAAA,EAAA+/M,GAAA,yFACqB//M,cAAA,UAAAA,MAAA,IAAAA,MAAA,IAAAkK,EAAA81M,oCAMvBhgN,MAAA,mBACEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,kEAUNA,MAJF,UAIEA,CADD,oBAEGA,MAAA,mCAQJA,iBALMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,sFAmBEA,MAAA,kBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAAigN,EAAA96M,KAEAnF,cAAA,IAAAA,MAAA,+BAAAigN,EAAA36M,OAAA,gCALJtF,MAAA,GACEA,MAAA,EAAAkgN,GAAA,yFACuBlgN,cAAA,UAAAA,MAAA,IAAAA,MAAA,IAAAkK,EAAAi2M,yCAN3BngN,MAPJ,UAOIA,CAFH,mBAEGA,CADc,eACHA,MAAA,wBAETA,QACFA,MAAA,mBACEA,MAAA,EAAAogN,GAAA,wCAUNpgN,mCAdeA,MAAA,GAAAA,YAAA,qDAIMA,MAAA,GAAAA,MAAA,WAAAA,MAAA,IAAAkK,EAAAi2M,YAAA33M,gCAmBnBxI,MAPF,WAOEA,CADD,yBAKGA,MAAA,wBAEJA,iBAJIA,cAAA,0BAEAA,cAAA,IAAAA,MAAA,kFAaFA,MATF,WASEA,CADD,yBAEGA,MAAA,wBAEJA,iBAHgDA,cAAA,0BAC5CA,cAAA,IAAAA,MAAA,6EAQFA,MAJF,WAIEA,CADD,yBAKGA,MAAA,wBAEJA,iBAJIA,cAAA,0BAEAA,cAAA,IAAAA,MAAA,qFAsBJA,MAAA,8CAGEA,MAAA,OAAAkK,EAAAm2M,oEAnKErgN,MAPN,WAOMA,CAHL,UAGKA,CAF6B,mBAE7BA,CADc,eACHA,MAAA,wBAETA,QACFA,MAAA,mBAAYA,MAAA,uBAAAqW,GAAArW,MAAA2P,GAAA,MAAAzF,EAAAlK,qBAAAkK,EAAAw0C,OAAAroC,KAAAnM,EAAAw0C,OAAAroC,GAAArW,MAAAqW,EAAA,GACVrW,MAAA,wBACEA,MAAA,GACAA,MAAA,EAAAsgN,GAAA,eASFtgN,QACAA,MAAA,GAAAugN,GAAA,uCAwBNvgN,YAIIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,gBACHA,MAAA,0BAETA,QACFA,MAAA,oBACEA,MAAA,GAAAwgN,GAAA,yCAQAxgN,MAAA,GAAAygN,GAAA,uCAKNzgN,YAqEAA,MAnEA,GAAA0gN,GAAA,aAmEA1gN,CAhEC,GAAA2gN,GAAA,aAgED3gN,CA/CC,GAAA4gN,GAAA,aA+CD5gN,CAvBC,GAAA6gN,GAAA,aAuBD7gN,CANC,GAAA8gN,GAAA,cAmBC9gN,MADF,YACEA,CADiC,kCAK/BA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAASkK,EAAAy9C,uBAAAz9C,EAAA60B,KAAAz5B,OAAkC,GAE3CtF,MAAA,sEAOFA,QACAA,MAAA,uCACFA,QAEAA,MAAA,GAAA+gN,GAAA,0BAMF/gN,gCA3KEA,MAAA,YAAAkK,EAAA60B,MAKe/+B,MAAA,GAAAA,YAAA,yDAGCA,MAAA,GAAAA,MAAA,QAAAkK,EAAAw0C,QAER1+C,MAAA,GAAAA,MAAA,IAAAkK,EAAAw0C,OAAAl2C,OAAA0B,EAAA82M,kBAAA92M,EAAAw0C,OAAA,YACO1+C,cAAA,OAAAkK,EAAAw0C,OAAAl2C,OAAA,GAWWxI,cAAA,UAAAA,MAAA,MAAAkK,EAAA+2M,oBA2BXjhN,MAAA,GAAAA,YAAA,2DAIMA,MAAA,GAAAA,MAAA,WAAAA,MAAA,MAAAkK,EAAA81M,UAAAx3M,QAQFxI,MAAA,GAAAA,MAAA,WAAAA,MAAA,MAAAkK,EAAA81M,UAAAx3M,QAShBxI,MAAA,GAAAA,MAAA,OAAAkK,EAAAg+C,aAAA,QAAAh+C,EAAA60B,KAAAz5B,MAAAixB,QAeAv2B,cAAA,oBAAAkK,EAAA60B,KAAAz5B,MAAAixB,QAAA,iBAAArsB,EAAA60B,KAAAz5B,MAAAixB,QAuBAv2B,cAAA,OAAAkK,EAAAw0C,OAAAl2C,OAAA,iBAAA0B,EAAA60B,KAAAz5B,MAAAixB,QAAA,iBAAArsB,EAAA60B,KAAAz5B,MAAAixB,SAeAv2B,cAAA,OAAAkK,EAAAw0C,OAAAl2C,OAAA,iBAAA0B,EAAA60B,KAAAz5B,MAAAixB,QAAA,iBAAArsB,EAAA60B,KAAAz5B,MAAAixB,SAAArsB,EAAA60B,KAAAz5B,MAAA47M,eAcAlhN,cAAA,eAAAkK,EAAA60B,KAAAz5B,MAAAixB,QAcCv2B,MAAA,GAAAA,MAAA,YAAAkK,EAAA60B,KAAA4F,OAAA3kC,MAAA,MAAAkK,EAAAm9C,WAGArnD,MAAA,GAAAA,MAAA,YAAAkK,EAAA60B,KAAAz5B,MAAAixB,OAAAv2B,MAAA,+CAAAkK,EAAA60B,KAAAz5B,MAAAo5C,OAAAl2C,OAAA,EAAAxI,MAAA,oDAAAA,MAAA,wDAQWA,MAAA,GAAAA,MAAA,QAAAA,MAAA,MAAAkK,EAAAm9C,WAIZrnD,MAAA,GAAAA,MAAA,YAAAkK,EAAAm2M,2BCrKE,IAAMc,GAAqB,MAA5B,MAAOA,EAiGDC,cACApmK,cACAz6C,gBACAC,eACA04D,iBACAC,aACA/kC,YACAv1B,OACA8R,MACAoqC,eACAm5H,gBACAj7G,aACAuD,qBA5GHz9B,KACAmgL,WACAc,SAAW,IAAIr/M,UAAgBC,GAC/Bu/M,WAAa,IAAIx/M,UAAgBC,GACjCqgN,kBAAiD,IAAItgN,KAC1D,IAEK0mD,SAAW,IAAI1mD,MAAgB,GAC/BunD,aAAc,EACdm5J,cAAgB,SAEfh5J,SACAi5J,mBACAC,UACAC,YACAC,YACAC,gBAEDrC,yBACAgB,yBAECsB,cAAgB,IAAI/4M,OAAO,aAC3Bq9C,sBACDqB,WAEA63J,aACL,IAAIx+M,KAAgB,IACdihN,uBAEDC,cAAwB,EAEvBC,oBAOJ,IAAInhN,UAAgBC,GAEfmhN,iBAA2B,EAE3B1iM,IAEAokE,WAEDu+H,wBAAyD,GACjE,0BACI12E,CAAuBhmI,GACzB1G,KAAKojN,wBAA0B18M,EAC/B1G,KAAKqjN,oBACP,CACA,0BAAI32E,GACF,OAAO1sI,KAAKojN,yBAA2B,EACzC,CAKSlzM,MAEAozM,aAAe,SAEdC,WAAa,IAAIj2M,MAElBk2M,eAAiD,IAAIzhN,UAC5DC,GAGQyhN,oBAAsB,IAAIn2M,MAEpC,UAAIwyC,GACF,OAAO9/C,KAAKmgC,KAAKjgC,IAAI,UAAUwG,KACjC,CACA,UAAIo5C,CAAOp5C,GACT1G,KAAKmgC,KAAKkyJ,WAAW,CAAEvyI,OAAQp5C,GACjC,CAEA,aAAI2iD,GACF,OAAOrpD,KAAKsgN,WAAWpgN,IAAI,aAAawG,KAC1C,CACA,aAAI2iD,CAAU3iD,GACZ1G,KAAKsgN,WAAWjuB,WAAW,CAAEhpI,UAAW3iD,GAC1C,CAEA,gBAAIg9M,GACF,OACG1jN,KAAKm8C,eAAej8C,IAAI,8BAA2C,CAExE,CAEA,gBAAIwjN,CAAah9M,GACf1G,KAAKm8C,eAAe97C,IAAI,2BAA4BqG,EACtD,CAEA3G,YACUyiN,EACApmK,EACAz6C,EACAC,EACA04D,EACAC,EACA/kC,GACAv1B,GACA8R,GACAoqC,GACAm5H,GACAj7G,GACAuD,IAZA59D,KAAAwiN,gBACAxiN,KAAAo8C,gBACAp8C,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAAs6D,mBACAt6D,KAAAu6D,eACAv6D,KAAAw1B,eACAx1B,KAAAC,UACAD,KAAA+R,SACA/R,KAAAm8C,kBACAn8C,KAAAs1K,mBACAt1K,KAAAq6D,gBACAr6D,KAAA49D,wBAER59D,KAAK2jN,aACL3jN,KAAK0pD,YACL1pD,KAAKqjN,qBACLrjN,KAAKygN,yBAA2BzgN,KAAK2B,gBAAgB4pB,UAAUshB,QAC7D,qDAEF7sC,KAAKyhN,yBAA2BzhN,KAAK2B,gBAAgB4pB,UAAUshB,QAC7D,oDAEJ,CAEAt/B,WACEvN,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAWi9C,IAC1C9/C,KAAKqiN,kBAAkB1/M,KACrBm9C,EAAOp2C,OAAQ+4C,GAEVA,aAAiBsZ,OAAoC,IAArBtZ,EAAM24C,YACtC34C,EAAMpsB,WAAWx2B,QAAQwgF,UACxB59B,EAAMpsB,WAAWx2B,QAAQwgF,SAAS99E,KAExB,GAGpB,MAAM+kD,EAAmBtnD,KAAKC,OAAOG,UACnC,wCAEFJ,KAAKqnD,uBACFC,GAAsC,IAAMp7B,KAAKq7B,IAAI,KAAM,GAC9DvnD,KAAK0oD,WAAa1oD,KAAKqnD,sBAAwBn7B,KAAKq7B,IAAI,KAAM,GAE9DvnD,KAAK8iN,gBAAkB9iN,KAAKwjN,eACzBz/M,QAAK6jG,MAAWg8G,IAAmBA,IACnC/gN,UAAW+gN,IACV5jN,KAAKmgC,KAAKkyJ,WAAWuxB,EAAe,CAAEt4I,WAAW,IAC7Cs4I,EAAc9jK,QAChB9/C,KAAK6jN,eACHD,EAAc9jK,OAAOr/B,IAAKs/B,GAAM//C,KAAKygB,IAAIqjH,aAAa/jF,IAAG,GAIjE//C,KAAK6iN,YAAc7iN,KAAKmgC,KACrBjgC,IAAI,UACJq4B,aAAa11B,UAAW80B,IACvB,MAAMqlL,EAAcx2M,OAAOC,KAAKy1M,GAAcc,cAE3Ch9M,KAAKijN,cACNjjN,KAAKmgC,KAAKjgC,IAAI,UAAUwG,OAAOkD,OAAS,IACvCozM,EAAYt0M,QAAQivB,IAAW,GAAKA,IAAWqkL,GAAa58G,OAExDp/F,KAAK8jN,aAAY,IACpB9jN,KAAKmgC,KAAKkyJ,WAAW,CAAE16J,YAAQ31B,GAAa,CAAEspE,WAAW,IAAO,GAKxEtrE,KAAK6iN,YAAc7iN,KAAKmgC,KACrBjgC,IAAI,UACJq4B,aAAa11B,UAAW8iG,IACvB3lG,KAAK+jN,2BACL,MAAMC,EACJr+G,aAAoBpqF,MAAQoqF,EAAW,CAACA,GAC1C3lG,KAAKmgC,KAAKkyJ,WAAW,CAAEvyI,OAAQkkK,GAAkB,CAAE14I,WAAW,IAC9D,MAAMxrB,EAASkkK,EAAevjM,IAAKs/B,GAAM//C,KAAKygB,IAAIqjH,aAAa/jF,IAC/D//C,KAAK6jN,eAAe/jK,IAIlB,IADAt5C,OAAOC,KAAKzG,KAAKohN,SAAS16M,OAAOgC,QAAQ1I,KAAKmgC,KAAKz5B,MAAMixB,SAGzD33B,KAAKmgC,KAAKkyJ,WAAW,CAAE16J,YAAQ31B,IAGjChC,KAAKyoD,SAAS9lD,MAAK,GACnB,MAAMshN,EAKA,GACNnkK,EAAOvlC,QAASkoC,IAEZA,aAAiBsZ,MAC4B,IAA7CtZ,EAAMpsB,WAAWgrB,GAAG8C,cAAcv6C,SAElCq6M,EAAc38M,KAAK,CACjB4K,GAAIuwC,EAAMvwC,GACV2kB,QAAS4rB,EAAM5rB,QACf+rB,QAASH,EAAMG,QACfG,UAAYN,EAAcM,YAE5BN,EAAMG,QAAU,EAChBH,EAAM5rB,SAAU,KAIpB72B,KAAKkjN,oBAAoBvgN,KAAKshN,GAC9BtlL,WAAW,KACT3+B,KAAKyoD,SAAS9lD,MAAK,EAAK,EACvB,IAAG,GAGV3C,KAAK2iN,UAAY3iN,KAAKohN,SACnBr9M,QAAK6jG,MAAWy3G,IAAaA,IAC7Bx8M,UAAWw8M,IAC0B,IAAhC74M,OAAOC,KAAK44M,GAASz1M,QACvB5J,KAAKmgC,KAAKkyJ,WAAW,CAAE16J,OAAQ0nL,EAAQ74M,OAAOC,KAAK44M,GAAS,KAAK,GAIvEr/M,KAAK4iN,YAAc5iN,KAAKuhN,WACrBx9M,QAAK6jG,MAAWs8G,IAAeA,IAC/BrhN,UAAWqhN,IAC4B,IAAlC19M,OAAOC,KAAKy9M,GAAWt6M,QACzB5J,KAAKmgC,KAAKkyJ,WAAW,CACnBuqB,SAAUsH,EAAU19M,OAAOC,KAAKy9M,GAAW,KAC5C,GAIPlkN,KAAK0iN,mBAAqB1iN,KAAKqiN,kBAC5Bt+M,QAAK6jG,MAAW9nD,IAAYA,IAC5Bj9C,UAAWi9C,IACY,IAAlBA,EAAOl2C,QACT5J,KAAKmgC,KAAKkyJ,WAAW,CAAEvyI,OAAQA,EAAO,GAAG5tC,IAAI,GAInDlS,KAAKmgC,KAAK7I,SAASt3B,KAAKyiN,eAAelqL,aAAa11B,UAAW80B,IAK3D33B,KAAKmgC,KAAKkyJ,WAHV16J,IAAWqkL,GAAaO,UACxB5kL,IAAWqkL,GAAaQ,aAEH,CAAEI,SAAUX,GAAeyB,QAE3B,CAAEd,SAAUX,GAAesB,OAElDv9M,KAAK+R,MAAM4K,eAAa,GAKtB3c,KAAKsgN,WAAWjuB,WAFhBryL,KAAKmjN,gBACgC,IAAnCnjN,KAAKugN,aAAa75M,MAAMkD,OACC,CACzBy/C,UAAW,CACT42J,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,KAIiB,CAAEv9E,UAAWrpD,KAAKugN,aAAa75M,MAAM,IAGvC,CAAE2iD,eAAWrnD,GAE5C,CAEQqhN,qBACNrjN,KAAKgjN,0BAAyBv2E,OAC5BzsI,KAAK0sI,wBAEP,MAAMlC,EAAkC,GAiCxC,GA/BIxqI,KAAKgjN,uBAAuBp2E,OAC9BpC,EAAYljI,KAAK,CACf24M,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,GACNp2D,YAAQxuE,EACRkqI,SAAKlqI,IAGLhC,KAAKgjN,uBAAuBn2E,OAC9BrC,EAAYljI,KAAK,CACf24M,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,GACNp2D,YAAQxuE,EACRkqI,SAAKlqI,IAGLhC,KAAKgjN,uBAAuBl2E,aAC9BtC,EAAYljI,KAAK,CACf24M,aAAc,cACdviI,MAAO,eACPgsC,KAAM,YACNkd,KAAM,GACNp2D,YAAQxuE,EACRkqI,SAAKlqI,IAILhC,KAAKgjN,uBAAuBh2E,IAAK,CAEnC,MACME,EAAUltI,KAAKgjN,uBAAuBh4E,QAAQkC,QAEpD,QAASlC,EAHOhrI,KAAKgjN,uBAAuBh4E,QAAQiC,QAGxBjC,GAAWkC,EAASlC,IAG9CR,EAAYljI,KAAK,CACf24M,aAAc,MACdviI,MAAO,OAAOstD,IACdthB,KAJAshB,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IAKvDpE,KAAM,GAAGoE,IACTx6D,YAAQxuE,EACRkqI,SAAKlqI,GAGX,CAEA,GAAIhC,KAAKgjN,uBAAuBj2E,IAAK,CAEnC,MACMG,EAAUltI,KAAKgjN,uBAAuBp4E,QAAQsC,QAEpD,QAAStC,EAHO5qI,KAAKgjN,uBAAuBp4E,QAAQqC,QAGxBrC,GAAWsC,EAAStC,IAG9CJ,EAAYljI,KAAK,CACf24M,aAAc,MACdviI,MAAO,OAAOktD,IACdlhB,KAJAkhB,EAAU,GAAK,YAAYA,IAAY,WAAWA,IAKlDhE,KAAM,GAAGgE,IACTp6D,YAAQxuE,EACRkqI,SAAKlqI,GAGX,CAEA,IAAImiN,EAAuC,GACvCnkN,KAAKgjN,uBAAuBr2E,iBAC9Bw3E,EAAoBnkN,KAAKC,OAAOG,UAAU,gBACxC,IAGJJ,KAAKugN,aAAa59M,KAAKwhN,EAAiBxjM,OAAO6pH,GACjD,CAEQ45E,sBAAsBlyM,GAC5B,MAAMmyM,EAAiBrkN,KAAKkQ,MACzB+R,MACAG,KACEq4B,GACEA,EACEgI,MAAMvwC,KAAOA,GAEtB,GAAImyM,EACF,OAAOA,CAGX,CAEOjC,kBAAkBlwM,GACvB,OAAOlS,KAAKygB,IAAIqjH,aAAa5xH,IAAKtG,KACpC,CAEAq1M,yBAAyBx+J,GACvB,MAAM6hK,EAAetkN,KAAKokN,sBAAsB3hK,EAAMvwC,IACtD,GAAIoyM,EAMF,QALaA,EAAarpK,YAAYv2B,UAAUxC,QAC7CqE,IACkC,IAA1BA,EAAO/V,MAAMgY,SAK5B,CAEOu4L,aAAar3L,EAA6BxX,GAC/C,IAAIqyM,EAAsBvkN,KAAKmgC,KAAKz5B,MAAM69M,oBACtC76L,EAAMmE,QACR02L,EAAoBj9M,KAAK4K,GAEzBqyM,EAAsBA,EAAoB76M,OACvCkyE,GAAYA,IAAY1pE,GAG7BlS,KAAKmgC,KAAKkyJ,WAAW,CAAEkyB,uBACzB,CAEO1D,kBAAkBn3L,EAAOxX,GAC1BlS,KAAKmgC,KAAKz5B,MAAMo5C,OAAO19B,KAAMw5D,GAAYA,IAAY1pE,IACvDwX,EAAM+E,iBAEV,CAEOqyL,gCAAgCr+J,GACrC,QAAOziD,KAAKmgC,KAAKz5B,MAAM69M,oBAAoBniM,KACxCw5D,GAAYA,IAAYn5B,EAAMvwC,GAInC,CAEAhE,cACElO,KAAKypD,SAASt7C,cACdnO,KAAK0iN,mBAAmBv0M,cACxBnO,KAAK2iN,UAAUx0M,cACfnO,KAAK4iN,YAAYz0M,cACjBnO,KAAK6iN,YAAY10M,cACbnO,KAAK8iN,iBACP9iN,KAAK8iN,gBAAgB30M,cAEvBnO,KAAKyjN,oBAAoBr1M,KAAKpO,KAAKmgC,KAAKz5B,OACxC1G,KAAK+jN,0BACP,CAEQA,2BACN,MAAME,EAAgBjkN,KAAKkjN,oBAAoBx8M,MAC3Cu9M,GAAiBA,EAAcr6M,QACjCq6M,EAAc1pM,QAASiqM,IACrB,MAAMC,EAAgBzkN,KAAKygB,IAAIqjH,aAAa0gF,EAAMtyM,IAClDuyM,EAAc5tL,QAAU2tL,EAAM3tL,QAC9B4tL,EAAc7hK,QAAU4hK,EAAM5hK,QAC7B6hK,EAAsB1hK,UAAYyhK,EAAMzhK,YAG7C/iD,KAAKkjN,oBAAoBvgN,UAAKX,EAChC,CAEAumD,YAAYC,GACV,IAAIa,EAAYrpD,KAAKqpD,UAAUqgE,KAC3B1pH,KAAK+iN,cAAc74M,KAAKm/C,KAC1BA,EAAY,QAAQA,KAGtBrpD,KAAKyoD,SAAS9lD,MAAK,GACnB,UAAWuiD,KAAQsD,EACjBxoD,KAAKwiN,cAAch7J,OAAOtC,EAAMmE,GAAWxmD,UACxC0H,GAAwBvK,KAAK6pD,oBAAoB3E,EAAM36C,GACvDnG,GAAiBpE,KAAK8pD,kBAAkB5E,EAAM9gD,GAC/C,KACEpE,KAAKyoD,SAAS9lD,MAAK,EAAK,EAIhC,CAEAmhN,YAAYY,GAAoB,GACnBn9M,OAAOgR,KAAK,GAAI,QAAS,qBACjCN,QACH,MAAM0sM,EAAKp9M,OAAOgR,KAAK,GAAI,QAAS,qBACpC,OAAKosM,GAAMA,EAAGC,eAAiBD,EAAGC,OAAW,KAAsB,OAAPD,GAC1D3kN,KAAK6kN,oBAAoBH,GACzB1kN,KAAK0jN,cAAe,IAEpBiB,EAAG1sM,QACHjY,KAAK0jN,cAAe,EACpB1jN,KAAKijN,cAAe,GAEfjjN,KAAK0jN,YACd,CAEA36J,uBAAuB9kD,GACrBjE,KAAKyoD,SAAS9lD,MAAK,GAEnB,MAAMq6M,EAAcx2M,OAAOC,KAAKy1M,GAAcc,cAE3Ch9M,KAAKijN,cACNh/M,EAAK67C,OAAOl2C,OAAS,IACpBozM,EAAYt0M,QAAQzE,EAAK0zB,SAAW,GACnC1zB,EAAK0zB,SAAWqkL,GAAa58G,OAC9Bp/F,KAAK0jN,cAEN1jN,KAAK8jN,cAGP,IAAIgB,EAA4D,GAC5DC,EAAqB,GACrBC,EAAmB,GAEvB,UAAYC,EAAYxiK,MAAUx+C,EAAK67C,OAAOh/B,UAAW,CACvD,MAAMshC,GAAMpiD,KAAKygB,IAAIqjH,aAAarhF,IAG9Bx+C,EAAK0zB,SAAWqkL,GAAaQ,cAC7Bv4M,EAAK0zB,SAAWqkL,GAAaO,WAE9Bt4M,EAAKq+M,eACiB,IAAvBr+M,EAAK67C,OAAOl2C,QAEZo7M,EAAW5iK,GAAIx2C,MACX3H,EAAK+qB,OACPg2L,EAAW/gN,EAAK+qB,OAGlBg2L,EAAWhlN,KAAK2B,gBAAgB4pB,UAAUshB,QACxC,iCAGJ,MAAMq4K,GAA+B9iK,GAAI/rB,WAAWx2B,QACpD,GACEoE,EAAK0zB,SAAWqkL,GAAa58G,KAC7B8lH,GAAU7kI,WACT6kI,GAAU7kI,SAAS99E,KAAO2iN,GAAU7kI,SAASC,YAU9C,YARA3hD,WAAW,KAET,MAAMp8B,GAAM2iN,GAAU7kI,SAAS99E,KAAO2iN,GAAU7kI,SAASC,WACzD/9E,GAAI24B,MAAM,iBACNl7B,KAAKs1K,gBAAgB/8J,KAAK6pC,IAC1B76C,OAAOgR,KAAKhW,GAAK,UACrBvC,KAAKyoD,SAAS9lD,MAAK,EAAK,EACvB,KAGL,MAAMwiN,GAAMnlN,KAAKokN,sBAAsB3hK,IACvC,IAAIwB,GACJ,GAAIkhK,IAAOA,GAAIlqK,aAAekqK,GAAIlqK,YAAYv2B,UAAUzC,MAAMrY,OAM1Dq6C,IAJ4C,IAA5ChgD,EAAKsgN,oBAAoB77M,QAAQ+5C,KACjCx+C,EAAKmhN,mBAGQD,GAAIlqK,YAAYv2B,UAC1BzC,MACAvY,OACEiiC,IACCA,GAAEn7B,MAAMi5F,aAAe99D,GAAEn7B,MAAMgY,UAElC/H,IAAKkrB,IAAOA,GAAE3tB,OAAmBqjC,KAEQ,IAA5Cp9C,EAAKsgN,oBAAoB77M,QAAQ+5C,KAChCx+C,EAAKmhN,mBAOGnhN,EAAKmhN,mBAEDD,GAAIlqK,YAAYv2B,UAC1BzC,MACAvY,OAAQiiC,IAA4BA,GAAEn7B,MAAMi5F,aAC5ChpF,IAAKkrB,IAAOA,GAAE3tB,OAAmBqjC,IAGvB8jK,GAAIlqK,YAAYv2B,UAC1BzC,MACAxB,IAAKkrB,IAAOA,GAAE3tB,OAAmBqjC,IAdvB8jK,GAAIlqK,YAAYv2B,UAC1BzC,MACAvY,OAAQiiC,IAA4BA,GAAEn7B,MAAMgY,UAC5C/H,IAAKkrB,IAAOA,GAAE3tB,OAAmBqjC,QAajC,CACL,MAAMA,GAAKe,GAAI/rB,WAAWgrB,GAExB4C,GADEhgD,EAAKmhN,mBACM/jK,GAAGsoD,oBACdvnD,GAAI3hC,IAAIyhC,eAAe2hC,aAGZxiC,GAAG8C,cAEd/B,GAAI/rB,sBAAsBulC,OAC5B3X,GAAaA,GAAWG,QAASC,IAC/BA,GAAQnkD,IAAI,aAGlB,CAEA,IAAImlN,GAAyD,GAsC7D,GApCEphN,EAAK0zB,SAAWqkL,GAAaM,WAC7Br4M,EAAK0zB,SAAWqkL,GAAaI,IAE7Bn4J,GAAW1pC,QAASoyE,KAClB,MAAM24H,GAAkB34H,GAAUQ,cAAc8U,UAC1CsjH,GAAkBF,GAAUjjM,KAC/BojM,IAAaA,GAASxjH,eAAiBsjH,IAEtCC,GACFA,GAAgBh7M,SAASjD,KAAKqlF,IAE9B04H,GAAU/9M,KAAK,CACb06F,aAAcsjH,GACd/6M,SAAU,CAACoiF,KACZ,GAIL04H,GAAY,CAAC,CAAErjH,aAAc,GAAIz3F,SAAU05C,KAG7CohK,GAAU9qM,QAASirM,KACjBA,GAASj7M,SAASgQ,QAASzP,KACzB,MAAMuvF,GAAiBvvF,GAAQ5K,IAAI,OACnC,GAAIm6F,GAAQ,CACV,MAAMiuG,GAA4B,CAChCx9L,GAAQ5K,IAAI,aACZ4K,GAAQ5K,IAAI,aAERqnH,MAASk+F,OAASnd,GAAYjuG,GAAQ,KAC5CktB,GAAOnuG,UAAU,YAAatO,GAAQ5K,IAAI,gBAC1C4K,GAAQwsH,YAAY/P,GACtB,GACD,GAGCtjH,EAAK0zB,SAAWqkL,GAAaI,IAAK,CACpC,MAAMsJ,GAAgBL,GAAUz7M,OAChCy7M,GAAYA,GAAU37M,OAAQ87M,IAC5B,CAAC,aAAc,SAASxtL,SAASwtL,GAASxjH,eAGxC0jH,GAD6BL,GAAUz7M,QAEzC5J,KAAK4B,eAAewC,MAClB,qCACA,sCACA,CAAEkjE,QAAS,KAGjB,UACGrjE,EAAK0zB,SAAWqkL,GAAaQ,cAC5Bv4M,EAAK0zB,SAAWqkL,GAAaO,WAC/Bt4M,EAAKq+M,cACL,CAGA,GAFA+C,GAAU9qM,QAASirM,IAAaV,EAAax9M,KAAKk+M,KAE9CP,IAAehhN,EAAK67C,OAAOl2C,OAAS,EACtC,SACK,CACL,IAAI+7M,GACJb,EAAavqM,QAASirM,KACpBA,GAASj7M,SAASgQ,QAASqrM,KACzB,GAAI3hN,EAAKy9E,UACP,GAAIikI,IACF,GACEC,GAAe1lN,IAAI,iBAAiBuiD,MAAM5iD,QAAQ+L,QAClD+5M,GAAgBzlN,IAAI,iBAAiBuiD,MAAM5iD,QAAQ+L,MACnD,CACA,MAAMi6M,GAAiB7lN,KAAK8lN,qBAC1BH,GACAC,IAEFb,EAAYz9M,KAAKu+M,GAAe,IAChCd,EAAYz9M,KAAKu+M,GAAe,IAChCd,EAAYz9M,KAAKu+M,GAAe,GAClC,MACK,CACL,MAAMA,GAAiB7lN,KAAK8lN,qBAC1BF,GACAA,IAEFb,EAAYz9M,KAAKu+M,GAAe,GAClC,CAEFd,EAAYz9M,KAAKs+M,IACjBD,GAAkBC,IACnB,EAEL,CACF,CAEyB,IAArBP,GAAUz7M,QACZ5J,KAAKyoD,SAAS9lD,MAAK,GACnB3C,KAAK4B,eAAewC,MAClB,8BACA,+BACA,CAAEkjE,QAAS,QAKTrjE,EAAK0zB,SAAWqkL,GAAaQ,cAC7Bv4M,EAAK0zB,SAAWqkL,GAAaO,WAE9Bt4M,EAAKq+M,gBAEN+C,GAAU5kM,IAAK+kM,IACbxlN,KAAKo8C,cACF6J,OACCu/J,GAASj7M,SACTtG,EAAK0zB,OACLqtL,EAAWQ,GAASxjH,aACpB/9F,EAAK24M,SACL58M,KAAKygB,IAAIuhC,YAEVn/C,UACC,OACCuB,IAAiBpE,KAAKgqD,kBAAkB5lD,IACzC,KACEpE,KAAKiqD,sBAELu7J,GAASj7M,SAASgQ,QAASzP,KACzB9K,KAAKitM,cAAcniM,GAAO,GAG5B9K,KAAKyoD,SAAS9lD,MAAK,EAAK,GAMtC,EAEGsB,EAAK0zB,SAAWqkL,GAAaQ,cAC5Bv4M,EAAK0zB,SAAWqkL,GAAaO,WAC/Bt4M,EAAKq+M,eAELtiN,KAAKo8C,cACF6J,OACC8+J,EACA9gN,EAAK0zB,OACLqtL,EACA/gN,EAAK24M,SACL58M,KAAKygB,IAAIuhC,YAEVn/C,UACC,OACCuB,GAAiBpE,KAAKgqD,kBAAkB5lD,GACzC,KACEpE,KAAKiqD,sBAEL86J,EAAYxqM,QAASzP,IACnB9K,KAAKitM,cAAcniM,EAAO,GAG5B9K,KAAKyoD,SAAS9lD,MAAK,EAAK,EAIlC,CAEQmjN,qBAAqBH,EAAiBC,GAC5C,MAAMG,EAAWH,EAAe59M,QAC1Bg+M,EAAYJ,EAAe59M,QAC3Bi+M,EAAWL,EAAe59M,QAC1Bk+M,EAAqCP,EAAgBtpJ,UAC3D,IAAI8pJ,GAA2B,GAC/B,UAAW5/M,MAAO2/M,EAChB,GAAiC,aAA7BA,EAAoB3/M,IAAqB,CAC3C4/M,GAAmBD,EAAoB3/M,IACvC,KACF,CAGF,MAAM6/M,GAAoCR,EAAevpJ,UACzD,IAAIgqJ,GAA0B,GAC9B,UAAW9/M,MAAO6/M,GAChB,GAAgC,aAA5BA,GAAmB7/M,IAAqB,CAC1C8/M,GAAkBD,GAAmB7/M,IACrC,KACF,CAEF,MAAMga,GAAyBqlM,EAAevpJ,UAC9C6pJ,EAAoB3rM,QAAS+rM,KACvB/lM,GAAQyX,SAASsuL,KAAgBA,KAAgBH,IACnD5lM,GAAQjZ,KAAKg/M,GAAW,GAG5B/lM,GAAQk+B,QAAQ0nK,IAEhB,IAAII,GAAsB,GAC1B,UAAWhgN,MAAOga,GAChB,GAAqB,aAAjBA,GAAQha,IAAqB,CAC/BggN,GAAchmM,GAAQha,IACtB,KACF,CAEFga,UAAQhG,QAAShU,KACf,MAAMigN,GACJN,EAAoBt8M,SAAWw8M,GAAmBx8M,QAClDs8M,EAAoBjiM,MAClB,CAACvd,GAAOuY,KAAUvY,KAAU0/M,GAAmBnnM,KAE/C1Y,KAAQggN,IAAgBC,GASjBjgN,KAAQggN,IAAeC,IAQvBjgN,KAAQ8/M,IAPjBN,EAAS1lN,IACPkG,GACAq/M,EAAe1lN,IAAI,iBAAiBuiD,MAAM5iD,QAAQ+L,OAClD,GAEFo6M,EAAU3lN,IAAIkG,GAAKA,IAAK,GACxB0/M,EAASQ,MAAMlgN,IAAK,IASH,aAARA,IACTw/M,EAASU,MAAMlgN,IAAK,GACpBy/M,EAAU3lN,IAAIkG,GAAKA,IAAK,GACxB0/M,EAASQ,MAAMlgN,IAAK,KAEpBw/M,EAASU,MAAMlgN,IAAK,GACpB0/M,EAASQ,MAAMlgN,IAAK,KA9BpBw/M,EAAS1lN,IACPkG,GACAq/M,EAAe1lN,IAAI,iBAAiBuiD,MAAM5iD,QAAQ+L,MAChD,qBACF,GAEFo6M,EAAU3lN,IAAIkG,GAAKA,IAAK,GACxB0/M,EAASQ,MAAMlgN,IAAK,IA0BjB6/M,GAAmBpuL,SAASzxB,KAC/By/M,EAAUS,MAAMlgN,IAAK,EAAI,GAGN,CAACw/M,EAAUC,EAAWC,EAE/C,CAEQhZ,cAAcniM,GAGpB,GAFuBA,EAAQ5K,IAAI,OAEvB,CACV,MAAMqpF,EAAQ,IAAI5nC,KAAQ,CACxB72C,EAAQ5K,IAAI,aACZ4K,EAAQ5K,IAAI,cAEdqpF,EAAMnwE,UAAU,YAAatO,EAAQ5K,IAAI,gBACzC4K,EAAQwsH,YAAY/tC,EACtB,CACF,CAEQ7/B,YACN1pD,KAAKsgN,WAAatgN,KAAKw1B,YAAYyL,MAAM,CACvCooB,UAAW,CAAC,GAAI,CAACtkB,KAAW/C,aAI5BhiC,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAD3BjhC,KAAKspD,YAC4B,CACjC3xB,OAAQ,CAAC,GAAI,CAACoN,KAAW/C,WACzB8d,OAAQ,CAAC,GAAI,CAAC/a,KAAW/C,WACzBuiL,oBAAqB,CAAC,IACtB3H,SAAU,CAACX,GAAesB,KAAM,CAACx4K,KAAW/C,WAC5CsgL,cAAe,EAAC,EAAM,CAACv9K,KAAW/C,WAClC0/C,UAAW,EAAC,EAAO,CAAC38C,KAAW/C,WAC/BojL,mBAAoB,EAAC,EAAO,CAACrgL,KAAW/C,WACxChT,KAAM,CAAC,GAAI,CAAC+V,KAAW/C,YAGU,CACjCrK,OAAQ,CAAC,GAAI,CAACoN,KAAW/C,WACzB8d,OAAQ,CAAC,GAAI,CAAC/a,KAAW/C,WACzBuiL,oBAAqB,CAAC,IACtB3H,SAAU,CAACX,GAAesB,KAAM,CAACx4K,KAAW/C,WAC5CsgL,cAAe,EAAC,EAAM,CAACv9K,KAAW/C,WAClC0/C,UAAW,EAAC,EAAO,CAAC38C,KAAW/C,WAC/BojL,mBAAoB,EAAC,EAAO,CAACrgL,KAAW/C,YAG9C,CAEQ6nB,oBAAoB3E,EAAY36C,GACtC,MAAMm8M,EAAsB1mN,KAAKC,OAAOG,UACtC,gBAEIw9D,EAAuB8oJ,GAAqBC,kBAC9C3mN,KAAK49D,0BACL57D,EACC0kN,GAAqBxrJ,gBAWxBhR,GACEhF,EACA36C,EACAvK,KAAKygB,IACLzgB,KAAK6kF,WACL7kF,KAAK4B,eACL5B,KAAKq6D,aACLuD,EACA59D,KAAKs6D,iBACLt6D,KAAKu6D,cAnBPrQ,GACEhF,EACA36C,EACAvK,KAAKygB,IACLzgB,KAAK6kF,WACL7kF,KAAK4B,eACL5B,KAAKq6D,aACLuD,EAeN,CAEQ9T,kBAAkB5E,EAAY9gD,GACpCpE,KAAKyoD,SAAS9lD,MAAK,GH3rBjB,SAAU+nD,GACdxF,EACA9gD,EACAxC,EACAmlD,IAGmB,CACjB,eAAgBH,GAChB,oBAAqBE,GACrB,sBAAuBE,GACvB,yBAA0Bg4J,GAC1B,sBAAuBC,KAEd76M,EAAMoU,SAAS0sC,EAAM9gD,EAAOxC,EARvCmlD,EAASA,GAAkB,GAS7B,CG6qBI2D,CAAsBxF,EAAM9gD,EAAOpE,KAAK4B,eAAgB5B,KAAK0oD,WAC/D,CAEQm8J,oBAAoBH,GAAoB,GAC9C1kN,KAAKyoD,SAAS9lD,MAAK,GAInB3C,KAAK4B,eAAewC,MAClB,mCACA,oCACA,CAAEkjE,QAAS,KACX,CAAEs/I,aAPiBlC,EACjB,0CACA,qCAON,CAEQ16J,kBAAkB5lD,GACxBpE,KAAKyoD,SAAS9lD,MAAK,GCj/BjB,SAAUgoD,GACdvmD,EACAxC,GAEIwC,aAAiB0hD,GAiBjB,SAAU8E,GAA2BhpD,GACzCA,EAAewC,MACb,8BACA,+BAEJ,CArBIwmD,CAA2BhpD,GAG7BA,EAAewC,MACb,6BACA,8BAEJ,CDs+BIumD,CAAsBvmD,EAAOpE,KAAK4B,eACpC,CAEQ+hN,aACN,MAAMkD,EAAoB7mN,KAAKC,OAAOG,UAAU,4BAChDJ,KAAKspD,iBACmBtnD,IAAtB6kN,GAAkCA,EAEpC7mN,KAAK6jN,iBACL7jN,KAAK8mN,eACP,CAEOC,qBAAqBpvL,GAC1B,OACEA,IAAWqkL,GAAaO,UACxB5kL,IAAWqkL,GAAaQ,cAExBx8M,KAAKmgC,KAAKkyJ,WAAW,CAAEuqB,SAAUX,GAAeyB,SACzCzB,GAAeyB,SAEtB19M,KAAKmgC,KAAKkyJ,WAAW,CAAEuqB,SAAUX,GAAesB,OACzCtB,GAAesB,KAE1B,CAEQuJ,gBACN9mN,KAAKuhN,WAAW5+M,KAAKs5M,GACvB,CAEQ4H,eAAe/jK,GACrB,IAAIknK,EAA2BxgN,OAAOC,KAAKu1M,IAC3C,MAAMiL,EAAc,CAClBC,SAAS,EACTC,YAAY,EACZC,cAAc,EACdC,YAAY,GAERA,EAAa,GACnB,GAAIvnK,GAAUA,EAAOl2C,OA8BnB,GA7BAk2C,EAAOvlC,QAASkoC,IACTA,IAGDA,EAAMpsB,WAAWx2B,QAAQwgF,UAAUinI,gBACrCL,EAAYI,YAAa,EACzBA,EAAW//M,KAAK,CACdm7C,MAAOA,EAAM72C,MACbyzM,QAASr/M,KAAKunN,mBACZ9kK,EAAMpsB,WAAWx2B,QAAQwgF,SAASinI,mBAIpC7kK,aAAiBsZ,OACnBtZ,EAAMpsB,WAAWx2B,QAAQwgF,WACzB59B,EAAMpsB,WAAWx2B,QAAQwgF,SAAS99E,IAIlCkgD,EAAMpsB,WAAWx2B,QAAQwgF,WACxB59B,EAAMpsB,WAAWx2B,QAAQwgF,SAAS99E,KACjCkgD,EAAMpsB,WAAWx2B,QAAQwgF,SAASC,YAEpC2mI,EAAYG,cAAe,EAClB3kK,aAAiBsZ,OAC1BkrJ,EAAYE,YAAa,GARzBF,EAAYC,SAAU,EAQG,IAID,IAAxBD,EAAYC,UAA+C,IAA3BD,EAAYE,WAC9CH,EAAiB,CAAC,YAAK,IAEI,IAA3BC,EAAYE,aACY,IAAxBF,EAAYC,QAEZlnN,KAAK6jN,iBACD7H,GAAa58G,OAAOp/F,KAAKohN,SAAS16M,QAIpCsgN,EAHaxgN,OAAOC,KAAKzG,KAAKohN,SAAS16M,OAAOgD,OAC3CnD,IAAgB,QAARA,UAAa,IAKG,IAA7B0gN,EAAYG,eACY,IAAxBH,EAAYC,UACe,IAA3BD,EAAYE,aAEZnnN,KAAK6jN,mBACC7H,GAAa58G,OAAOp/F,KAAKohN,SAAS16M,QAAQ,CAC9C,MAAMD,EAAOD,OAAOC,KAAKzG,KAAKohN,SAAS16M,OACvCD,EAAKa,KAAK,OACV0/M,EAAiBvgN,CACnB,CAGJ,MAAM+gN,EAA4BxnN,KAAKC,OAAOG,UAC5C,wBAEF,GAAIonN,EAA2B,CAC7B,MAAMC,EAAsBznN,KAAKunN,mBAC/BC,GAEFR,EAAiBA,EAAet9M,OAAQ6tL,IACtCkwB,EAAoBzvL,SAASu/J,IAEjC,CACA,GAAI0vB,EAAYI,WAAhB,CACE,IAAIK,EACJ,MAAMC,GAA0B,GAChC,IAAIC,GAA4BP,EAAW,GAAGhI,QAC9CgI,EAAW5mM,IAAKwzF,KACd0zG,GAAwBrgN,KAAK2sG,GAAKxxD,OAClCilK,EAAgBzzG,GAAKorG,QAAQ31M,OAAQhD,IACnCkhN,GAA0B5vL,SAAStxB,KAErCkhN,GAA4B3zG,GAAKorG,UAEnC,MAAMwI,GAAeH,EAAch+M,OAAQhD,IACzCsgN,EAAehvL,SAAStxB,KAEtBmhN,GAAaj+M,OAAS,GACxB5J,KAAKohN,SAASz+M,QAAKmsJ,OAAQ+4D,KAEvB/nK,GAAUA,EAAOl2C,QACfk2C,EAAOl2C,OAAS,GAClB5J,KAAK4B,eAAe8D,MAClB,iCACA,uCACA1D,EACA,CAAE0E,MAAOihN,GAAwB99M,WAKvC7J,KAAKohN,SAASz+M,KAAK,IACnB3C,KAAK4B,eAAe8D,MAClB,+BACA,iCAKsC,MAA1C1F,KAAKohN,SAASz+M,QAAKmsJ,OAAQk4D,GAE/B,CAEQO,mBAAmBlI,GACzB,OAAOA,EACJ31M,OAAQiuB,IACP,GACEA,EAAOy3C,gBAAkB4sI,GAAaO,SAASntI,eAC/Cz3C,EAAOy3C,gBAAkB4sI,GAAaQ,aAAaptI,eACnDz3C,EAAOy3C,gBAAkB4sI,GAAaG,IAAI/sI,eAC1Cz3C,EAAOy3C,gBAAkB4sI,GAAaI,IAAIhtI,eAC1Cz3C,EAAOy3C,gBAAkB4sI,GAAah4J,QAAQorB,eAC9Cz3C,EAAOy3C,gBAAkB4sI,GAAaK,IAAIjtI,eAC1Cz3C,EAAOy3C,gBAAkB4sI,GAAaM,UAAUltI,eAChDz3C,EAAOy3C,gBAAkB4sI,GAAa58G,IAAIhwB,cAE1C,OAAOz3C,IAGVlX,IAAKkX,GACAA,EAAOy3C,gBAAkB4sI,GAAaO,SAASntI,cACjDz3C,EAASqkL,GAAaO,SAGpB5kL,EAAOy3C,gBAAkB4sI,GAAaQ,aAAaptI,cACrDz3C,EAASqkL,GAAaQ,aAGpB7kL,EAAOy3C,gBAAkB4sI,GAAaG,IAAI/sI,cAC5Cz3C,EAASqkL,GAAaG,IAGpBxkL,EAAOy3C,gBAAkB4sI,GAAaI,IAAIhtI,cAC5Cz3C,EAASqkL,GAAaI,IAGpBzkL,EAAOy3C,gBAAkB4sI,GAAah4J,QAAQorB,cAChDz3C,EAASqkL,GAAah4J,QAGpBrsB,EAAOy3C,gBAAkB4sI,GAAaK,IAAIjtI,cAC5Cz3C,EAASqkL,GAAaK,IAGpB1kL,EAAOy3C,gBAAkB4sI,GAAaM,UAAUltI,cAClDz3C,EAASqkL,GAAaM,UAIpB3kL,EAAOy3C,gBAAkB4sI,GAAa58G,IAAIhwB,cAC5Cz3C,EAASqkL,GAAa58G,SADxB,EAKN,CAEO0oH,YAAYv1M,GACjBvS,KAAKujN,WAAWn1M,KAAKmE,EACvB,CAEQ03C,uBC9qCJ,SAAUY,GAAwBjpD,GACtCA,EAAe6oD,QACb,8BACA,+BAEJ,CD0qCII,CAAwB7qD,KAAK4B,eAC/B,CAEAkpD,qBAAqBphC,GACnB1pB,KAAKsjN,aAAe55L,EAAMhjB,KAC5B,4CAjmCW67M,GAAqBnhN,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,IAAA3E,MAAA4E,MAAA5E,MAAAuT,MAAAvT,MAAAyT,MAAAzT,mBAAA0T,OAAA1T,MAAA07B,GAAA17B,MAAA47B,MAAA57B,MAAA87B,OAAA,+BAArBqlL,EAAqBj0M,UAAA,wBAAAC,OAAA,CAAA40M,gBAAA,kBAAA1iM,IAAA,MAAAokE,WAAA,aAAA6nD,uBAAA,yBAAAx8H,MAAA,QAAAozM,aAAA,eAAAE,eAAA,kBAAAh1M,QAAA,CAAA+0M,WAAA,aAAAE,oBAAA,uBAAAh1M,YAAA,EAAAlE,SAAA,CAAAnJ,MAFrB,CAACiX,QAAqBjX,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,6oDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDxGjC1N,MADF,UACEA,CAD+C,+BAG7CA,MAAA,kBAAAqW,GAAA,OAAU1I,EAAA+7C,qBAAArzC,EAA4B,GAEtCrW,MAAA,yBACEA,MAAA,wBACFA,QACAA,MAAA,yBACEA,MAAA,wBAGNA,YAqFAA,MAnFA,EAAA2mN,GAAA,eAmFA3mN,CA/EC,EAAA4mN,GAAA,gBA+ED5mN,CAxBkE,GAAA6mN,GAAA,mCA+BlE7mN,MAAA,GAAA8mN,GAAA,yCAtGI9mN,cAAA,QAAA2N,EAAAu0M,cAGmBliN,cAAA,kBACjBA,cAAA,IAAAA,MAAA,oDAEiBA,MAAA,GAAAA,MAAA,kBACjBA,cAAA,IAAAA,MAAA,qDAQHA,MAAA,GAAAA,MAAA,kBAAA2N,EAAAu0M,cAwD8BliN,cAAA,kBAAA2N,EAAAu0M,cA0B9BliN,cAAA,WAAAA,MAAA,MAAA2N,EAAAszM,mBAAAz4M,QAAA,WAAAmF,EAAAu0M,cAQAliN,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAszM,mBAAAz4M,OAAA,cAAAmF,EAAAu0M,8BCrBCr4J,MAAqB7tB,YACrBjuB,KACAstB,KAAW9nB,oBACX4oB,KAAmB5oB,UACnBsV,MAAkBoT,YAClBnT,MAAewT,YAAA23J,MACf5gL,KACA0V,MACA9a,KAAgBkmL,KAChBhmL,KAAe44M,KACfzyK,MACAl8B,MACAlK,KACAqkF,MAAoBy0H,MACpBvrL,MAAcwrL,MACd34M,KACAsiD,KACAriD,KAAiB24M,MAAAz4M,OAAA,+9DAIR0yM,CAAqB,mJE1GhCnhN,MAAA,qBAIEA,MAAA,oBAAAA,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAAUsgC,EAAA6mL,QAAO,GAGnBnnN,gCAFEA,MAAA,UAAAsgC,EAAA8mL,sDAcApnN,MAAA,oCAQEA,MAAA,iBAAAqW,GAAArW,MAAAkP,GAAA,MAAAoxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA+mL,iBAAAhxM,GAAwB,GAEjCrW,MAAA,mDAQGA,MAAA,oBAELA,kCAbEA,MAJA,QAAAsgC,EAAA+gB,MAAA5rB,QAAA,oBAIAz1B,CAJ+C,aAAAA,MAAA,IAAAsgC,EAAAgnL,aAa7CtnN,MAAA,GACAA,MADA,iBAAAA,MAAA,IAAAsgC,EAAAinL,mBACAvnN,CAD4C,UAAAA,MAAA,GAAAoW,IAAA,IAAApW,MAAA,IAAAsgC,EAAA60J,sBAE3Cn1L,MAAA,GAAAA,MAAA,GAAAA,MAAA,KAAAsgC,EAAA+gB,MAAAoiE,UAAA,6EAILzjH,MAAA,yDAaEA,MAAA,iBAAAqW,GAAArW,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA+mL,iBAAAhxM,GAAwB,GAEjCrW,MAAA,mDAQGA,MAAA,GAELA,kCAjBEA,MAJA,QAAAsgC,EAAA+gB,MAAA5rB,QAAA,oBAIAz1B,CAJ+C,aAAAsgC,EAAA+gB,MAAA5rB,QAAAz1B,MAAA,+BAAAA,MAAA,gCAiB7CA,MAAA,GACAA,MADA,iBAAAA,MAAA,IAAAsgC,EAAAinL,mBACAvnN,CAD4C,UAAAA,MAAA,GAAAoW,IAAA,IAAApW,MAAA,KAAAsgC,EAAA60J,sBAE3Cn1L,MAAA,GAAAA,MAAA,GAAAsgC,EAAA+gB,MAAA5rB,QAAA,6EAILz1B,MAAA,oCAQEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAknL,kBAAiB,GAE1BxnN,MAAA,cAAUA,MAAA,gBACZA,eANEA,MAAA,aAAAA,MAAA,2DAWJA,MAAA,8CAGEA,MADA,QAAAsgC,EAAA+gB,MACArhD,CADe,iCAAAsgC,EAAAs1I,iCCpCZ,IAAM6xC,GAAkB,MAAzB,MAAOA,EA0GDpqH,eACA9nF,SACA7E,MACAC,MA5GHugC,WAAa,yBAEpB,eACIw2K,GACF,OAAO9oN,KAAK+oN,YACd,CACA,eAAID,CAAYpiN,GAEZA,GACA1G,KAAKyiD,OACL/7C,EAAMwL,KAAOlS,KAAKyiD,MAAMvwC,KACvBlS,KAAKgpN,eAENhpN,KAAKipN,WAAWtmN,MAAK,GACrB3C,KAAK2W,SAASQ,SAASnX,KAAK8R,MAAMmB,cAAejT,KAAKsyC,aAEtDtyC,KAAK2W,SAASS,YAAYpX,KAAK8R,MAAMmB,cAAejT,KAAKsyC,WAE7D,CACQy2K,aAERE,WAAuC,IAAIlnN,MAAgB,GAE3D00L,YAAwC,IAAI10L,MAAgB,GAE5Dw0L,mBAA+C,IAAIx0L,MAAgB,GAEnE4mN,kBAA8C,IAAI5mN,MAAgB,GAElEmnN,YAEA14M,MAEA,aACIq4C,GACF,OAAO7oD,KAAKmpN,UACd,CACA,aAAItgK,CAAUniD,GACZ1G,KAAKmpN,WAAaziN,GACJ,IAAVA,IACF1G,KAAKwoN,YAAa,EAEtB,CACQW,YAAa,EAEZX,WAED9jH,aACA0kH,UACA3/J,SAERtH,QAAkC,IAAIpgD,UAAuBC,GAE7D,SACIygD,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,EACd1G,KAAKmiD,QAAQx/C,KAAK+D,EACpB,CACQo/H,OAECujF,gCAA0C,EAE1CC,uBAAiC,EAEjCtyC,gCAA0C,EAE1CuyC,WAAqB,EAErBC,eAAyB,EAEzBC,eAAyB,EAEzBC,YAAsB,EAEtBV,cAEAl5M,gBAET,WAAI8yC,GACF,OAA4B,IAArB5iD,KAAKyiD,MAAMG,OACpB,CACA,WAAIA,CAAQA,GACV5iD,KAAKyiD,MAAMG,QAAUA,EAAU,GACjC,CAEA,cAAI8lK,GACF,OAA2C,IAAvC1oN,KAAKu2L,mBAAmB58J,WACnB,gCAEA35B,KAAKyiD,MAAM5rB,QACd,0BACA,yBAER,CAEUnrB,OAA8B,IAAI4B,WAAoBtL,GACtDkN,SAAW,IAAI5B,MAKzBvN,YACU0+F,EACA9nF,EACA7E,EACAC,GAHA/R,KAAAy+F,iBACAz+F,KAAA2W,WACA3W,KAAA8R,QACA9R,KAAA+R,OACP,CAEHxE,WAEIvN,KAAKyiD,MAAM5rB,SACX72B,KAAKspN,wBAC6B,IAAlCtpN,KAAKyiD,MAAMqhE,qBAEX9jH,KAAKyiD,MAAMqhE,oBAAqB,EAChC9jH,KAAKyiD,MAAMohE,iBAAkB,GAE/B7jH,KAAK63L,aAAa73L,KAAKyiD,MAAMohE,iBAC7B7jH,KAAK2pN,mBAGL3pN,KAAK0kG,aADe1kG,KAAKyiD,MAAMhiC,IAAIyhC,eAAe+iD,YAClBpiG,UAAU,KACxC7C,KAAK4pN,oBAAkB,GAEzB5pN,KAAKkpN,YAAclpN,KAAKw7J,iBAExBx7J,KAAKopN,UAAYppN,KAAKy+F,eACnBx+E,eACApd,UAAW2N,IACVxQ,KAAKwQ,MAAQA,EACbxQ,KAAK4pN,oBAAkB,GAG3B5pN,KAAKypD,SAAWzpD,KAAKmiD,QAAQt/C,UAAU,KACjC7C,KAAKyiD,OAASziD,KAAKyiD,MAAM5iD,QAAQ8nB,SACnC3nB,KAAKipN,WAAWtmN,MAAK,GACrB3C,KAAK2W,SAASQ,SAASnX,KAAK8R,MAAMmB,cAAejT,KAAKsyC,YAAU,GAIhEtyC,KAAK8P,iBACP9P,KAAK8P,gBAAgBjN,UAAU,IAAM7C,KAAK+R,MAAM4K,gBAEpD,CAEAzO,cACElO,KAAK0kG,aAAav2F,cAClBnO,KAAKopN,UAAUj7M,cACfnO,KAAKypD,SAASt7C,aAChB,CAEA0pL,aAAa/mL,GACX9Q,KAAKyiD,MAAMohE,gBAAkB/yG,EAC7B9Q,KAAKy2L,YAAY9zL,MAAMmO,EACzB,CAEAslL,sBACEp2L,KAAK63L,aAAa73L,KAAKy2L,YAAY/vL,MACrC,CAEA+hN,iBAAiB/+L,GACfA,EAAM+E,kBACNzuB,KAAKyiD,MAAM5rB,SAAW72B,KAAKyiD,MAAM5rB,QAC7B72B,KAAKqpN,gCACPrpN,KAAK63L,cAAc73L,KAAKyiD,MAAM5rB,SAEhC72B,KAAK2pN,kBACP,CAEAnuD,iBACE,MAAM94G,EAAe1iD,KAAKyiD,MAAM5iD,QAChC,IAAK6iD,EAAa70C,QAChB,OAAO7N,KAAKyiD,MAAM72C,MAEpB,MAAMi+M,EAAennK,EAAa70C,QAC5Bi8M,EAAiBpnK,EAAsC+sB,SAC7D,OAAQ/sB,EAAa70C,QAAQrK,MAC3B,KAAKigH,KAAYC,MACf,OAAO1jH,KAAKyiD,MAAM72C,MACpB,KAAK63G,KAAYE,SACf,OAAImmG,GAAiBA,EAAcn6I,SAC1Bm6I,EAAcn6I,SAEd3vE,KAAKyiD,MAAM72C,MAEtB,KAAK63G,KAAYG,OACf,OAAIimG,GAAgBA,EAAaj9K,KACxBi9K,EAAaj9K,KAEb5sC,KAAKyiD,MAAM72C,MAEtB,QACE,OAAO5L,KAAKyiD,MAAM72C,MAExB,CAEQg+M,qBACN,MAAMG,EAAoB/pN,KAAKyiD,MAAM2hE,sBAEb,IAAtB2lG,IACwC,IAAxC/pN,KAAKg3K,gCAELh3K,KAAK63L,cAAa,GAEpB73L,KAAKu2L,mBAAmB5zL,KAAKonN,EAC/B,CAEQJ,mBACN,MAAMv0M,GACgB,IAApBpV,KAAK0pN,aACkB,IAAvB1pN,KAAKyiD,MAAM5rB,WACX,EAAC+4H,OAAiB5vJ,KAAKyiD,OACzBziD,KAAK2oN,kBAAkBhmN,KAAKyS,EAC9B,CAEAwzM,kBACE5oN,KAAKipN,WAAWtmN,MAAM3C,KAAKipN,WAAWtvL,aACH,IAA/B35B,KAAKipN,WAAWtvL,WAClB35B,KAAK2W,SAASQ,SAASnX,KAAK8R,MAAMmB,cAAejT,KAAKsyC,YAEtDtyC,KAAK2W,SAASS,YAAYpX,KAAK8R,MAAMmB,cAAejT,KAAKsyC,YAE3DtyC,KAAK0L,OAAO0C,KAAKpO,KAAKyiD,MACxB,CAEO8lK,QACLvoN,KAAKwoN,YAAcxoN,KAAKwoN,WACxBxoN,KAAKkP,SAASd,KAAK,CAAEq0C,MAAOziD,KAAKyiD,MAAO8lK,MAAOvoN,KAAKwoN,YACtD,4CAxOWK,GAAkBznN,MAAAuE,MAAAvE,uCAAA,+BAAlBynN,EAAkBv6M,UAAA,qBAAAC,OAAA,CAAAu6M,YAAA,cAAAjgK,UAAA,YAAA2/J,WAAA,aAAA/lK,MAAA,QAAA4mK,+BAAA,iCAAAC,sBAAA,wBAAAtyC,+BAAA,iCAAAuyC,UAAA,YAAAC,cAAA,gBAAAC,cAAA,gBAAAC,WAAA,aAAAV,cAAA,gBAAAl5M,gBAAA,mBAAAtB,QAAA,CAAA9C,OAAA,SAAAwD,SAAA,YAAAT,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,u6CAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDnD/B1N,MAAA,qBACEA,MAAA,EAAA4oN,GAAA,sBAQA5oN,MAAA,YAKEA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAAqnL,sBAAqB,GAE9Bh1L,MAAA,GACFA,QAEAA,MAAA,WAkDEA,MAjDA,EAAA6oN,GAAA,gBAiDA7oN,CAxCC,EAAA8oN,GAAA,gBAwCD9oN,CAbC,EAAA+oN,GAAA,gBA0BL/oN,UAEAA,MAAA,aACEA,MAAA,GAAAgpN,GAAA,4CAMFhpN,cAzFKA,cAAA,OAAA2N,EAAAi6M,eAUD5nN,cAAA,aAAA2N,EAAAm6M,aAIA9nN,cAAA,IAAA2N,EAAA0zC,MAAA72C,MAAA,KAKGxK,MAAA,GAAAA,MAAA,QAAA2N,EAAAi6M,eAsBA5nN,cAAA,OAAA2N,EAAAi6M,eA2BA5nN,cAAA,QAAA2N,EAAAi6M,eAgBF5nN,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAA0nL,8BChDDrnL,MAAaxJ,wBACbuJ,KACAM,MAAiB5J,MACjBwJ,KAAgBvJ,KAChByJ,KAAexJ,KACfyJ,KAAaxJ,KACbq3J,IAAc1oJ,IACdrF,KACAynK,GACArnK,KACAC,KAAiBkF,MAAAhF,OAAA,gaAAAC,gBAAA,WAGR+4M,CAAkB,KCxBlBwB,GAAwB,MAA/B,MAAOA,EAcS5rH,eAbpB83F,mBAA+C,IAAIx0L,MAAgB,GAEnEmnN,YAEA14M,MAEQk0F,aACA0kH,UAEC3mK,MAEAu0H,gCAA0C,EAEnDj3K,YAAoB0+F,GAAAz+F,KAAAy+F,gBAAiC,CAErDlxF,WAEEvN,KAAK0kG,aADe1kG,KAAKyiD,MAAMhiC,IAAIyhC,eAAe+iD,YAClBpiG,UAAU,KACxC7C,KAAK4pN,oBAAkB,GAEzB5pN,KAAKkpN,YAAclpN,KAAKw7J,iBAExBx7J,KAAKopN,UAAYppN,KAAKy+F,eACnBx+E,eACApd,UAAW2N,IACVxQ,KAAKwQ,MAAQA,EACbxQ,KAAK4pN,oBAAkB,EAE7B,CAEA17M,cACElO,KAAK0kG,aAAav2F,cAClBnO,KAAKopN,UAAUj7M,aACjB,CAEAqtJ,iBACE,MAAM94G,EAAe1iD,KAAKyiD,MAAM5iD,QAChC,IAAK6iD,EAAa70C,QAChB,OAAO7N,KAAKyiD,MAAM72C,MAEpB,MAAMi+M,EAAennK,EAAa70C,QAC5Bi8M,EAAiBpnK,EAAsC+sB,SAC7D,OAAQ/sB,EAAa70C,QAAQrK,MAC3B,KAAKigH,KAAYC,MACf,OAAO1jH,KAAKyiD,MAAM72C,MACpB,KAAK63G,KAAYE,SACf,OAAImmG,GAAiBA,EAAcn6I,SAC1Bm6I,EAAcn6I,SAEd3vE,KAAKyiD,MAAM72C,MAEtB,KAAK63G,KAAYG,OACf,OAAIimG,GAAgBA,EAAaj9K,KACxBi9K,EAAaj9K,KAEb5sC,KAAKyiD,MAAM72C,MAEtB,QACE,OAAO5L,KAAKyiD,MAAM72C,MAExB,CAEQg+M,qBAEN5pN,KAAKu2L,mBAAmB5zL,KADE3C,KAAKyiD,MAAM2hE,qBAEvC,4CAlEWimG,GAAwBjpN,MAAAuE,MAAA,+BAAxB0kN,EAAwB/7M,UAAA,4BAAAC,OAAA,CAAAk0C,MAAA,QAAAu0H,+BAAA,kCAAAvoK,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,+MAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC1BnC1N,MADF,oBACEA,CADyC,YAMtCA,MAAA,GAELA,UAEAA,MAAA,aACEA,MAAA,wBAKFA,eAZIA,cAAA,aAAA2N,EAAAm6M,aAEC9nN,cAAA2N,EAAA0zC,MAAA72C,OAMDxK,MAAA,GACAA,MADA,QAAA2N,EAAA0zC,MACArhD,CADe,iCAAA2N,EAAAioK,gDDaP5nK,MAAaxJ,YAAEyJ,KAAgBxJ,KAAEkxK,IAAoBlnK,OAAA,oOAAAC,gBAAA,WAEpDu6M,CAAwB,6GE1BnCjpN,MAAA,6CAQEA,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAg/M,qBAAA7yM,EAAAoW,SAAoC,GAE9CzsB,MAAA,wBACFA,gCAJEA,MAJA,aAAAA,MAAA,oCAIAA,CAJyD,UAAAkK,EAAAi/M,oBAIzDnpN,CAH+B,0BAM/BA,MAAA,GAAAA,MAAA,IAAAA,MAAA,gEAEFA,MAAA,0CAKIA,MAAA,sEAIEA,MADA,QAAAopN,EACAppN,CADe,iCAAAkK,EAAA0rK,0DAHjB51K,MAAA,EAAAqpN,GAAA,kEACGrpN,MAAA,SAAAkK,EAAAo/M,mBAAAF,EAAAnoK,oCAQPjhD,MAAA,SAUEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,0FAEFA,MAAA,SAUEA,MAAA,wBAGFA,eAHEA,cAAA,IAAAA,MAAA,iGAIFA,MAAA,SASEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,yEAEFA,MAAA,SASEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,yDCzBG,IAAMupN,GAAwB,MAA/B,MAAOA,EACXpB,WAAY,EAEZqB,2BAAuD,IAAI7oN,MACzD,GAEF8oN,+BACE,IAAI9oN,MAAgB,GACtB+oN,YAAwC,IAAI/oN,KAAgB,IAC5DogD,QAAoC,IAAIpgD,KAAgB,IACxDgpN,eAAyB,EAClB5rM,QAAU,IAAIC,KAAoB,GACjC0wC,SACR,UACIhQ,CAAOp5C,GACT1G,KAAKo7M,QAAU10M,EACf1G,KAAK2C,MACP,CACA,UAAIm9C,GACF,OAAO9/C,KAAKo7M,OACd,CACQA,QACCsP,mBAA6B,EAE7B1zC,gCAA0C,EAE1Cg0C,qBAA+B,EAE/BT,qBAA+B,EAE9BU,gBAAkB,IAAI39M,OAAsB,GAEtDvN,cAAe,CACfwN,WACEvN,KAAK8vD,SAAW9vD,KAAKmf,QAClBpb,QACC6sD,MAAS,IACuB,IAAvB5wD,KAAK8/C,OAAOl2C,OAAe+3J,QAAQ9wG,MAAM,MAGnDhuD,UAAU,KACT,MAAMi9C,EAAS9/C,KAAKkrN,mBAAmBlrN,KAAK8/C,OAAOj8B,MAAM,IACzD7jB,KAAKmiD,QAAQx/C,KAAKm9C,GAClB9/C,KAAK4qN,2BAA2BjoN,KAC9B3C,KAAK8/C,OACFj8B,MAAM,GACNna,OAAQ+4C,IAA8B,IAApBA,EAAMJ,WACxB34C,OACE+4C,GACCA,EAAMoiE,SAASn+G,OAAS+7C,EAAM4hE,sBAAsB39G,OACtDkD,OAAS,GAEf5J,KAAK6qN,+BAA+BloN,KAClC3C,KAAK8/C,OACFj8B,MAAM,GACNna,OAAQ+4C,IAA8B,IAApBA,EAAMJ,WACxB34C,OACE+4C,GACCA,EAAMoiE,SAASn+G,QAAU+7C,EAAM4hE,sBAAsB39G,OACvDkD,OAAS,GAGf5J,KAAK8qN,YAAYnoN,KACf3C,KAAK8/C,OACFj8B,MAAM,GACNna,OACE+4C,MAC2B,IAA1BA,EAAMkH,iBACJ3pD,KAAK0qN,mBAAsBjoK,EAAMJ,YACtC,EAGX,CAEAn0C,cACElO,KAAK8vD,SAAS3hD,aAChB,CACQxL,OACN3C,KAAKmf,QAAQxc,MACf,CACQuoN,mBAAmBprK,GACzB,IAAIqrK,EAAcrrK,EAAOp2C,OACtB+4C,GAAiBA,EAAM5rB,SAAW4rB,EAAM2hE,sBAE3C,OAAIpkH,KAAKuqN,sBACPY,EAAcrrK,GAET9/C,KAAKorN,mBAAmBD,EACjC,CACQC,mBAAmBtrK,GACzB,OAAOA,EAAOt9B,KAAK,CAACojH,EAAQC,IAAWA,EAAOrjF,OAASojF,EAAOpjF,OAChE,CAEA8nK,qBAAqBrzM,GACnBjX,KAAKuqN,oBAAsBtzM,EAC3BjX,KAAK2C,OACL3C,KAAKirN,gBAAgB78M,KAAK6I,EAC5B,4CAjGW0zM,EAAwB,+BAAxBA,EAAwBr8M,UAAA,4BAAAC,OAAA,CAAAuxC,OAAA,SAAA4qK,kBAAA,oBAAA1zC,+BAAA,iCAAAg0C,oBAAA,sBAAAT,oBAAA,uBAAA/7M,QAAA,CAAAy8M,gBAAA,mBAAAx8M,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0kBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDhDrC1N,MAAA,WACEA,MAAA,EAAAiqN,GAAA,2CAYAjqN,MAAA,EAAAkqN,GAAA,sCAGAlqN,MAAA,gBACEA,MAAA,EAAAmqN,GAAA,sCASFnqN,QACAA,MAAA,EAAAoqN,GAAA,gEAYApqN,MAAA,GAAAqqN,GAAA,iEAcArqN,MAAA,GAAAsqN,GAAA,iEAWAtqN,MAAA,GAAAuqN,GAAA,iEAWFvqN,eApEKA,cAAA,OAAAA,MAAA,IAAA2N,EAAA+7M,aAAAlhN,QAAAmF,EAAAi8M,qBAOA5pN,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAA+7M,aAAAlhN,QAAAmF,EAAAi8M,qBAEO5pN,MAAA,GAAqBA,MAArB,gBAAqBA,CAAD,gBACeA,cAAA,UAAAA,MAAA,KAAA2N,EAAAozC,UAY1C/gD,MAAA,GAAAA,MAAA,QAAA2N,EAAAw7M,qBAAAnpN,MAAA,KAAA2N,EAAA+7M,aAAAlhN,SAAA,IAAAxI,MAAA,MAAA2N,EAAA67M,8BAAA,IAAAxpN,MAAA,MAAA2N,EAAA87M,iCAAA97M,EAAAi8M,qBAYA5pN,MAAA,GAAAA,MAAA,QAAA2N,EAAAw7M,qBAAAnpN,MAAA,MAAA2N,EAAA+7M,aAAAlhN,SAAA,IAAAxI,MAAA,MAAA2N,EAAA67M,6BAAAxpN,MAAA,MAAA2N,EAAA87M,iCAAA97M,EAAAi8M,qBAcA5pN,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAA+7M,aAAAlhN,SAAA,IAAAxI,MAAA,MAAA2N,EAAA67M,8BAAA,IAAAxpN,MAAA,MAAA2N,EAAA87M,kCAAA97M,EAAAi8M,qBAWA5pN,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAA+7M,aAAAlhN,SAAA,IAAAxI,MAAA,MAAA2N,EAAA67M,6BAAAxpN,MAAA,MAAA2N,EAAA87M,kCAAA97M,EAAAi8M,qCC9BD77M,KACAwkF,MAAoBhuF,MACpB0J,KAAgBzJ,KAChBslD,KAAgBrlD,KAChB+sC,KACAn+B,KACA41M,GACAn5K,KACAxhC,KACAC,KAAiB7J,MAAA+J,OAAA,0gBAAAC,gBAAA,WAGR66M,CAAwB,KCnCxBiB,GAA+B,MAAtC,MAAOA,EAODjuJ,WANFvhD,UACAyvM,2BACRC,mBAEA/rN,YACUqc,EACAuhD,GAAA39D,KAAA29D,aAER39D,KAAKoc,UAAYA,CACnB,CAEA7O,WAEEvN,KAAKoc,UAAU0jC,OAAS,GACxB9/C,KAAK6rN,8BAA6B5oM,MAAc,CAC9CjjB,KAAK29D,WAAWS,SAASjc,QACzBniD,KAAK29D,WAAWS,SAASlc,eAAe+iD,cAEvClhG,QAAKof,MAAa,KAClBtgB,UAAWke,IACV,MAAMoqM,EAAcpqM,EAAM,GAAGrX,OAAQ+4C,IACF,IAA1BA,EAAMkH,iBAEf3pD,KAAKoc,UAAU0jC,OAASqrK,EAExBnrN,KAAK8rN,sBAAqB7oM,MACxBkoM,EAAY1qM,IAAKgiC,GAAiBA,EAAMoiE,WACxChiH,UAAWmmE,IACXhpE,KAAKoc,UAAU+C,QAAQxc,MAAI,EAC5B,EAEP,CAEAuL,cACElO,KAAK6rN,2BAA2B19M,mBACAnM,IAA5BhC,KAAK8rN,qBACP9rN,KAAK8rN,mBAAmB39M,cACxBnO,KAAK8rN,wBAAqB9pN,EAE9B,4CAxCW4pN,GAA+BxqN,MAAAuE,GAAA,GAAAvE,MAAAwE,MAAA,+BAA/BgmN,EAA+Bt9M,UAAA,sCAAAG,YAAA,WAA/Bm9M,CAA+B,8DCJ1CxqN,MAAA,cAMEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAygN,YAAW,GAEpB3qN,MAAA,cAAUA,MAAA,WACZA,WC6BK,IAAM4qN,GAAsB,MAA7B,MAAOA,EACJC,aAAyC,IAAIlqN,MAAgB,GAC7DmqN,WAAuC,IAAInqN,MAAgB,GAC3D+2J,MAAiC,IAAI/2J,UAAgBC,GAC5DmqN,cACAC,YACAh0D,OAESi0D,qBAA+B,EAE/BrzD,WAA6B,OAEtC,eACIszD,CAAY5lN,GACd1G,KAAKisN,aAAatpN,KAAK+D,EACzB,CACA,eAAI4lN,GACF,OAAOtsN,KAAKisN,aAAavlN,KAC3B,CAEA,aACI6lN,CAAU7lN,GACZ1G,KAAKksN,WAAWvpN,KAAK+D,EACvB,CACA,aAAI6lN,GACF,OAAOvsN,KAAKksN,WAAWxlN,KACzB,CAEA,QACIwnD,CAAKxnD,GACP1G,KAAK84J,MAAMn2J,KAAK+D,EAClB,CACA,QAAIwnD,GACF,OAAOluD,KAAK84J,MAAMpyJ,KACpB,CAEOsiN,eAAgB,EAEbwD,qBAAuB,IAAIl/M,MAC3Bof,UAAY,IAAIpf,MAE1BC,WACEvN,KAAKo4J,OAASp4J,KAAK84J,MAAMj2J,UAAW4pN,IAClCzsN,KAAKwsN,qBAAqBp+M,KAAK,CAC7Bq+M,UACAH,YAAatsN,KAAKssN,YAClBC,UAAWvsN,KAAKusN,WACjB,GAGHvsN,KAAKmsN,cAAgBnsN,KAAKisN,aAAappN,UAAWypN,IAChDtsN,KAAKwsN,qBAAqBp+M,KAAK,CAC7Bq+M,QAASzsN,KAAKkuD,KACdo+J,cACAC,UAAWvsN,KAAKusN,WACjB,GAEHvsN,KAAKosN,YAAcpsN,KAAKksN,WAAWrpN,UAAW0pN,IAC5CvsN,KAAKwsN,qBAAqBp+M,KAAK,CAC7Bq+M,QAASzsN,KAAKkuD,KACdo+J,YAAatsN,KAAKssN,YAClBC,aACD,EAEL,CAEAr+M,cACElO,KAAKmsN,cAAch+M,cACnBnO,KAAKosN,YAAYj+M,cACjBnO,KAAKo4J,OAAOjqJ,aACd,CAEA49M,YACE/rN,KAAKkuD,UAAOlsD,CACd,CACA0qN,kBACE1sN,KAAKusN,WAAavsN,KAAKusN,SACzB,CAEAI,oBACE3sN,KAAKssN,aAAetsN,KAAKssN,WAC3B,CAEAM,sBACE5sN,KAAKgpN,eAAiBhpN,KAAKgpN,cAC3BhpN,KAAK0sB,UAAUte,KAAKpO,KAAKgpN,cAC3B,4CAtFWgD,EAAsB,+BAAtBA,EAAsB19M,UAAA,0BAAAC,OAAA,CAAA89M,oBAAA,sBAAArzD,WAAA,aAAAszD,YAAA,cAAAC,UAAA,YAAAr+J,KAAA,QAAA1/C,QAAA,CAAAg+M,qBAAA,uBAAA9/L,UAAA,aAAAje,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0xBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID9CjC1N,MADF,qBACEA,CAD4D,uDAO1DA,MAAA,yBAAAqW,GAAArW,aAAA2N,EAAAm/C,KAAAz2C,KAAA1I,EAAAm/C,KAAAz2C,IAAA,GANFrW,QAQAA,MAAA,EAAAyrN,GAAA,gBAUFzrN,QAGEA,MADF,UACEA,CAD6B,wDAY3BA,MAAA,0BAAS2N,EAAA29M,iBAAiB,GAE1BtrN,MAAA,cAAUA,MAAA,oBACZA,UACAA,MAAA,2DAWEA,MAAA,0BAAS2N,EAAA49M,mBAAmB,GAE5BvrN,MAAA,iBAOEA,MAAA,IAEJA,UAEAA,MAAA,2DAUEA,MAAA,0BAAS2N,EAAA69M,qBAAqB,GAE9BxrN,MAAA,eAAUA,MAAA,IAIdA,mBA7EoCA,MAAA,aAAA2N,EAAAiqJ,YAGhC53J,QACAA,MADA,cAAAA,MAAA,wCACAA,CAD6D,aAAAA,MAAA,+CAI7DA,MAAA,UAAA2N,EAAAm/C,MAGC9sD,MAAA,GAAAA,MAAA,OAAA2N,EAAAm/C,MAcD9sD,MAAA,GAAAA,MAAA,WAAA2N,EAAAw9M,WAGAnrN,MAFA,QAAA2N,EAAAw9M,UAAA,iBAEAnrN,CAFwC,aAAA2N,EAAAw9M,UAAAnrN,MAAA,mCAAAA,MAAA,0CAexCA,MAAA,GAEAA,MAFA,WAAA2N,EAAAs9M,sBAAAt9M,EAAAu9M,YAEAlrN,CAFgD,QAAA2N,EAAAu9M,YAAA,iBAEhDlrN,CAD0C,aAAA2N,EAAAu9M,YAAAlrN,MAAA,uCAAAA,MAAA,oDAaxCA,MAAA,GACAA,MADA,6BACAA,CADgC,8BAGhCA,cAAA,IAAA2N,EAAAu9M,YAAA,mCAQFlrN,cAAA,aAAA2N,EAAAi6M,cAAA5nN,MAAA,+CAAAA,MAAA,8CAQUA,MAAA,GAAAA,MAAA2N,EAAAi6M,cAAA,mDCtCV/+L,MAAkBtkB,YAClBk3B,MAAcj3B,MACd62B,KAAW52B,eACXwJ,KAAgBvJ,KAChBqJ,KACAI,KAAexJ,KACfyJ,KAAaxJ,KACbq3J,IAAc1oJ,IACdI,KACApF,KAAiBkF,MAAAhF,OAAA,0iBAAAC,gBAAA,WAGRk8M,CAAsB,gFC/CvBc,GAAZ,SAAYA,GACVA,SAAA/+J,OAAA,SACA++J,EAAA9+J,MAAA,QACA8+J,EAAAxgK,QAAA,UAHUwgK,CAIZ,CAJA,CAAYA,IAAqB,IAKrBC,GAAZ,SAAYA,GACVA,SAAAC,YAAA,cACAD,EAAAE,WAAA,aACAF,EAAAG,MAAA,QACAH,EAAAI,KAAA,OAJUJ,CAKZ,CALA,CAAYA,IAA0B,IAO1BK,GAAZ,SAAYA,GACVA,SAAAC,MAAA,QACAD,EAAAE,MAAA,QAFUF,CAGZ,CAHA,CAAYA,IAAqB,kKCZjChsN,MAAA,2BAQEA,MADA,gCAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAwBkK,EAAAiiN,6BAAA91M,GAAoC,EAC5DrW,CAD6D,qBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAChDkK,EAAAshN,oBAAAn1M,GAA2B,GAE1CrW,gCAJEA,MAHA,sBAAAkK,EAAA+gN,oBAGAjrN,CAH2C,OAAAkK,EAAAkiN,0BAAAf,QAG3CrrN,CAF0C,cAAAkK,EAAAkiN,0BAAAlB,YAE1ClrN,CADqD,YAAAkK,EAAAkiN,0BAAAjB,qDAQrDnrN,MADF,WACEA,CADwC,qBAItCA,MAAA,oBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,QAAA,OAAAA,MAAUkK,EAAAu9C,YAAW,GAIrBznD,MAAA,6CAMJA,kCAXIA,QAGAA,MAHA,SAAAkK,EAAAmiN,gBAAAniN,EAAAoiN,cAAA9jN,OAAA,qBAGAxI,CAH4E,UAAAkK,EAAAmiN,eAG5ErsN,CAD0B,iBAAAkK,EAAAmiN,gBAAAniN,EAAAoiN,cAAA9jN,OAAA,GAG1BxI,cAAA,IAAAkK,EAAAmiN,eAAArsN,MAAA,iCAAAA,MAAA,8EAWAA,MAAA,uBAiBEA,MADA,kBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAUkK,EAAAs9M,gBAAAnxM,GAAuB,EACjCrW,CADkC,oBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MACtBkK,EAAAqiN,YAAAl2M,GAAmB,GAEjCrW,oDAJEA,MAZA,QAAAwsN,EAYAxsN,CAZe,cAAAkK,EAAAw9M,YAYf1nN,CAX2B,YAAAkK,EAAAi+M,YAAAqE,EAAAvrK,UAW3BjhD,CAV2C,gBAAAkK,EAAAuiN,gBAAA37M,KAAA07M,EAAA17M,GAU3C9Q,CATiD,gBAAAkK,EAAAwiN,gBAAA57M,KAAA07M,EAAA17M,GASjD9Q,CARiD,aAAAkK,EAAAo+M,WAQjDtoN,CAPyB,wBAAAkK,EAAAyiN,4BAOzB3sN,CANqD,iCAAAkK,EAAA0rK,+BAMrD51K,CALiE,iCAAAkK,EAAA+9M,+BAKjEjoN,CAJiE,gBAAAkK,EAAAohB,UAIjEtrB,CAH2B,YAAAkK,EAAAmiN,eAG3BrsN,CAF4B,aAAAwsN,EAAA/tN,QAAA0oN,MAE5BnnN,CADkC,kBAAAkK,EAAA0iN,qDAdpC5sN,MAAA,EAAA6sN,GAAA,6DACG7sN,MAAA,SAAAkK,EAAAo/M,mBAAAkD,EAAAvrK,sDA4BHjhD,MAAA,oCAQEA,MAAA,mBAAAA,MAAA8P,GAAA,MAAA5F,EAAAlK,MAAA,UAAAA,MAASkK,EAAAsvD,eAAc,GAEvBx5D,MAAA,cAAUA,MAAA,YACZA,eAJEA,MAAA,aAAAA,MAAA,2EAqGFA,MAAA,oCAQEA,MAAA,mBAAAA,MAAAsQ,GAAA,MAAApG,EAAAlK,MAAA,UAAAA,MAASkK,EAAA4iN,iBAAA5iN,EAAAw9M,aAA6B,GAEtC1nN,MAAA,iBACGA,MAAA,mBAELA,eANEA,MAAA,aAAAA,MAAA,yEApHJA,MALF,iBAKEA,CADD,YAEGA,MAAA,EAAA+sN,GAAA,iBAaA/sN,MAAA,yDAYEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAASkK,EAAA8iN,gBAAA9iN,EAAAw9M,YAAAx9M,EAAA+iN,sBAAAf,OAA0D,GAAK,GAExElsN,MAAA,iBAMGA,MAAA,oBAELA,UAEAA,MAAA,0DAYEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAzF,EAAAlK,QAAA,OAAAA,MAASkK,EAAA8iN,gBAAA9iN,EAAAw9M,YAAAx9M,EAAA+iN,sBAAAhB,OAA0D,GAAK,GAExEjsN,MAAA,kBAMGA,MAAA,mBAELA,UAGAA,MAAA,sCASEA,MAAA,kBAKGA,MAAA,cAELA,UAGEA,MADF,mBACEA,CAD0D,4CASxDA,MAAA,iBAAAqW,GAAArW,aAAA2P,GAAA3P,MAASqW,EAAAgX,kBAAwB,GAIhCrtB,MAAA,iBAGCA,MAAA,mBAAAA,MAAA2P,GAAA,MAAAu9M,EAAAltN,MAAA,IAAAmtN,EAAAntN,MAAA,IAAAkK,EAAAlK,QAAA,OAAAA,MACekK,EAAAkjN,cACd,CAAA/qM,OAAA8qM,EAAAp1K,OAAAm1K,EAAA5nN,MAAA6nN,EAAA7nN,QAKX,GAGItF,YAEAA,MAAA,GAAAqtN,GAAA,iBAeArtN,MAAA,OAOAA,MAAA,IAEJA,8CAvIEA,MAAA,QAAAkK,EAAAw9M,YAAAl9M,OAIKxK,MAAA,GAAAA,MAAA,OAAAkK,EAAAojN,iBAAApjN,EAAAw9M,cAkBD1nN,QAKAA,MALA,aAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAArrN,MAAA,uCAAAA,MAAA,iCAKAA,CADC,WAAAkK,EAAAk+M,eAMCpoN,MAAA,GAGAA,MAHA,WAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAA,OAGArrN,CAH2D,iBAAAkK,EAAAk+M,eAc7DpoN,MAAA,GAKAA,MALA,aAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAArrN,MAAA,uCAAAA,MAAA,kCAKAA,CADC,WAAAkK,EAAAm+M,eAMCroN,MAAA,GAGAA,MAHA,WAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAA,OAGArrN,CAH2D,iBAAAkK,EAAAm+M,eAe7DroN,MAAA,GACAA,MADA,oBAAAutN,EACAvtN,CADiC,aAAAA,MAAA,gCAK/BA,MAAA,GAAAA,MAAA,WAAAkK,EAAAsjN,cAaAxtN,MAAA,GAEAA,MAFA,QAEAA,CAFS,UAETA,CADW,aAAAA,MAAA,gCAQTA,MAAA,GAAAA,MAAA,QAAAkK,EAAAs3C,SAcHxhD,MAAA,GAAAA,MAAA,OAAAkK,EAAAujN,yBAAAvjN,EAAAw9M,cAgBD1nN,QACAA,MADA,mBAAAkK,EAAAwjN,qBACA1tN,CADyC,0BAAAA,MAAA,GAAA+/B,GAAA71B,EAAAw9M,wDA4HvC1nN,MAAA,wCASEA,MAAA,yBAAAqW,GAAArW,MAAA8tD,GAAA,MAAA5jD,EAAAlK,MAAA,GAAAA,aAAAkK,EAAAyjN,aAAAt3M,KAAAnM,EAAAyjN,aAAAt3M,GAAArW,MAAAqW,EAAA,GAIArW,MAAA,iBAAAqW,GAAArW,aAAA8tD,GAAA9tD,MAASqW,EAAAgX,kBAAwB,GAChCrtB,MAAA,cACHA,iCAPEA,MADA,QACAA,CADS,WAETA,MAAA,UAAAkK,EAAAyjN,cACA3tN,MAAA,aAAAA,MAAA,wEASNA,MAAA,oCAUEA,MAAA,mBAAAA,MAAAkjK,GAAA,MAAAh5J,EAAAlK,MAAA,UAAAA,MAASkK,EAAA0jN,kBAAA1jN,EAAAoiN,eAAgC,GAEzCtsN,MAAA,cAAUA,MAAA,mBACZA,eAJEA,MAAA,aAAAA,MAAA,0EA/INA,MAAA,uCAMIA,MADF,WACEA,CADiC,yDAa/BA,MAAA,mBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAAsvD,aAAAtvD,EAAAoiN,eAA2B,GAEpCtsN,MAAA,iBAMGA,MAAA,YAELA,UAEAA,MAAA,0DAYEA,MAAA,mBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAAm9M,iBAAAn9M,EAAAoiN,eAA+B,GAExCtsN,MAAA,eAAUA,MAAA,IAKZA,UAEAA,MAAA,4DAYEA,MAAA,mBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+5H,YAAA/5H,EAAAoiN,eAA0B,GAEnCtsN,MAAA,kBAMGA,MAAA,qBAELA,UAEAA,MAAA,4DAYEA,MAAA,mBAAAA,MAAAyuB,GAAA,MAAAvkB,EAAAlK,QAAA,OAAAA,MAASkK,EAAA65H,YAAA75H,EAAAoiN,eAA0B,GAEnCtsN,MAAA,kBAMGA,MAAA,mBAELA,UAEAA,MAAA,sCAUEA,MAAA,eAAUA,MAAA,cACZA,UAGEA,MADF,mBACEA,CAD+D,aAG7DA,MAAA,GAAA6tN,GAAA,qBAiBJ7tN,UAEAA,MAAA,GAAA8tN,GAAA,iBAeJ9tN,8CAlJEA,MAAA,QAAAA,MAAA,6BASIA,MAAA,GACAA,MADA,eAAAkK,EAAAoiN,cAAA9jN,OACAxI,CADuC,aAAAkK,EAAA6jN,qBAAA7jN,EAAAoiN,eAAAtsN,MAAA,2CAAAA,MAAA,uDAUrCA,MAAA,GAGAA,MAHA,eAGAA,CAHgB,iBAAAkK,EAAA6jN,qBAAA7jN,EAAAoiN,gBAclBtsN,MAAA,GACAA,MADA,eAAAkK,EAAAoiN,cAAA9jN,OACAxI,CADuC,4BAAAkK,EAAA8jN,0BAAAhuN,MAAA,yCAAAA,MAAA,2CAQ7BA,MAAA,GAAAA,MAAA,eAAAkK,EAAA8jN,0BAAA,+BAaVhuN,QAKAA,MALA,aAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAArrN,MAAA,wCAAAA,MAAA,kCAKAA,CADC,WAAAkK,EAAA+jN,wBAMCjuN,MAAA,GAGAA,MAHA,WAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAA,OAGArrN,CAH2D,iBAAAkK,EAAA+jN,wBAc7DjuN,MAAA,GAKAA,MALA,aAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAArrN,MAAA,wCAAAA,MAAA,kCAKAA,CADC,WAAAkK,EAAAgkN,wBAMCluN,MAAA,GAGAA,MAHA,WAAAkK,EAAAihN,WAAAjhN,EAAAghN,aAAAhhN,EAAAmhN,QAAA,OAGArrN,CAH2D,iBAAAkK,EAAAgkN,wBAc7DluN,MAAA,GAEAA,MAFA,eAAAkK,EAAAoiN,cAAA9jN,OAEAxI,CAFuC,oBAAAmuN,EAEvCnuN,CADiC,aAAAA,MAAA,gCAU5BA,MAAA,GAAAA,MAAA,OAAAkK,EAAAoiN,cAAA9jN,QAmBJxI,cAAA,WAAAkK,EAAAoiN,cAAA9jN,QAAA0B,EAAAkkN,2BAAAlkN,EAAAoiN,iBChPA,IAAM+B,GAAkB,MAAzB,MAAOA,EAuLS39M,MAtLpBy3M,WAAY,EACZmG,yBAA2B,EAE3BvtK,QAAoC,IAAIpgD,KAAgB,IAExDod,QAAU,IAAIC,KAAoB,GAElCuwM,aAAyC,IAAI5tN,MAAgB,GAEtD6tN,UAEAC,oBAA8B,EACrCC,aAAuC,IAAI/tN,UAAgBC,GAE3D0rN,cAAyB,GAClBhhM,UAECojC,SACArG,SACDukK,0BAA4B,IAAIjsN,UAAgBC,GAGvD8sN,qBAESzC,qBAA+B,EAE/B0D,WAAqB,EAErBC,YAAsB,EAE/B,OACIvvM,GACF,OAAOzgB,KAAKouH,IACd,CACA,OAAI3tG,CAAI/Z,GACN1G,KAAKouH,KAAO1nH,CACd,CACQ0nH,KAER,UACItuE,CAAOp5C,GACT1G,KAAKo7M,QAAUp7M,KAAKiwN,yBAAyBvpN,GAC7C1G,KAAK2C,MACP,CACA,UAAIm9C,GACF,OAAO9/C,KAAKo7M,OACd,CACQA,QAER,eAAI0N,CAAYpiN,GACd1G,KAAK+oN,aAAeriN,EACpB1G,KAAK8vN,aAAantN,KAAK+D,EACzB,CACA,eAAIoiN,GACF,OAAO9oN,KAAK+oN,YACd,CACQA,aAEC/vD,WAA6B,OAE7Bw0D,0BAAsD,GAEtD9C,mBAA6B,EAE7BrB,gCAA0C,EAE1C0E,6BAAuC,EAEvC/2C,gCAA0C,EAE1C0yC,YAAsB,EAErB8C,qBAAuB,IAAIl/M,MAErC,WAAIm/M,GACF,OAAOzsN,KAAKkwN,QACd,CACA,WAAIzD,CAAQ/lN,GACV1G,KAAKkwN,SAAWxpN,EAChB1G,KAAK2C,MACP,CACQutN,cAAWluN,EAEnB,eAAIsqN,GACF,OAAOtsN,KAAKmwN,YACd,CACA,eAAI7D,CAAY5lN,GACd1G,KAAKmwN,aAAezpN,EACpB1G,KAAK2C,MACP,CACQwtN,cAAe,EAEvB,aAAI5D,GACF,OAAOvsN,KAAKwwD,YACd,CACA,aAAI+7J,CAAU7lN,GACZ1G,KAAKwwD,aAAe9pD,EACpB1G,KAAK2C,MACP,CACQ6tD,cAAe,EAEvB,WAAI5N,GACF,OAAO12B,KAAKiwE,MAA6C,IAAvCn8F,KAAK8vN,aAAan2L,WAAWipB,QACjD,CACA,WAAIA,CAAQA,GACV5iD,KAAK8vN,aAAan2L,WAAWipB,QAAUA,EAAU,GACnD,CAEA,gBAAIgsK,GACF,GAAqB,MAAjB5uN,KAAK4iD,QAGT,OAAO5iD,KAAK4iD,OACd,CAEA,iBAAI6mK,GACF,QACGzpN,KAAKupN,YACNvpN,KAAK8oN,YAAYzmK,WACjBriD,KAAK8tN,gBAAgB57M,KAAOlS,KAAK8oN,YAAY52M,KAC7ClS,KAAKowN,iBAAiBpwN,KAAK8oN,aAK/B,CAEA,iBAAIU,GACF,QACGxpN,KAAKupN,YACNvpN,KAAK8oN,YAAYzmK,WACjBriD,KAAK6tN,gBAAgB37M,KAAOlS,KAAK8oN,YAAY52M,KAC7ClS,KAAKqwN,iBAAiBrwN,KAAK8oN,aAK/B,CAEA,0BAAIwG,GACF,OACgC,IAA9BtvN,KAAK0tN,cAAc9jN,SAClB5J,KAAKupN,YACLvpN,KAAKswN,eAAetwN,KAAK0tN,iBACF,IAAxB1tN,KAAKytN,cAKT,CAEA,0BAAI4B,GACF,OACgC,IAA9BrvN,KAAK0tN,cAAc9jN,SAClB5J,KAAKupN,YACLvpN,KAAKuwN,gBAAgBvwN,KAAK0tN,iBACH,IAAxB1tN,KAAKytN,cAKT,CAEA,gBAAIsB,GACF,OAAqC,IAA9B/uN,KAAKwwN,sBACd,CACA,gBAAIzB,CAAansK,GACf,UAAWH,KAASziD,KAAK0tN,cACvBjrK,EAAMG,QAAUA,EAAU,GAE9B,CAEA,yBAAIyrK,GACF,OAAOjB,EACT,CAEOqD,eAAgB,EAEhBhD,eACAiD,gBAAkB,IAAI3uN,UAAyBC,GAC9C2uN,iBAER5wN,YAAoB+R,GAAA9R,KAAA8R,OAAoB,CAMxCvE,WACEvN,KAAK8vD,SAAW9vD,KAAKmf,QAClBpb,QACC6sD,MAAS,IACuB,IAAvB5wD,KAAK8/C,OAAOl2C,OAAe+3J,QAAQ9wG,MAAM,MAGnDhuD,UAAU,KACT7C,KAAK2vN,aAAahtN,KAAK3C,KAAK4wN,sBAC5B5wN,KAAKmiD,QAAQx/C,KAAK3C,KAAK6wN,cAAc7wN,KAAK8/C,OAAOj8B,MAAM,KACvD7jB,KAAKwsN,qBAAqBp+M,KAAK,CAC7Bq+M,QAASzsN,KAAKysN,QACdF,UAAWvsN,KAAKusN,UAChBD,YAAatsN,KAAKssN,aACnB,GAGLtsN,KAAK2wN,iBAAmB3wN,KAAK0wN,gBAAgB7tN,UAAW6D,IACtD1G,KAAKytN,eAAiB/mN,IAGxB1G,KAAKypD,SAAWzpD,KAAKmiD,QAAQt/C,UAAU,KACrC,GAAI7C,KAAK8/C,OAAQ,CACf,IAAIgxK,EAAS,EACb,UAAWruK,KAASziD,KAAK8/C,OACvB2C,EAAMkX,QAAQ92D,UAAW89G,IACL,IAAdA,GACF3gH,KAAKygB,IAAI8rF,YAAY9pD,EAAK,GAG1BA,EAAM5iD,QAAQ8nB,SAChB3nB,KAAK8oN,YAAcrmK,EACnBziD,KAAK4vN,WAAY,GAEfntK,EAAM5iD,QAAQ0oN,QAChBuI,GAAU,GAIZ9wN,KAAKytN,eADHztN,KAAK0qN,kBAELoG,IACA9wN,KAAK8/C,OAAOp2C,OACT04C,IAA0B,IAAlBA,EAAIC,WAAsBD,EAAIuH,iBACvC//C,OAKFknN,IAAW9wN,KAAK8/C,OAAOp2C,OAAQ04C,GAAQA,EAAIuH,iBAAiB//C,MAIlE,GAEJ,CAEAsE,cACElO,KAAK8vD,SAAS3hD,cACdnO,KAAK2wN,iBAAiBxiN,cACtBnO,KAAKypD,SAASt7C,aAChB,CAEA0gN,yBAAyBpsK,GACvB,IAAI1c,GAAQ,EACZ,IAA6C,IAAzC0c,EAAM5iD,QAAQkxN,uBAChB,OAAO,EAET,MAAMC,EAAcvuK,EAAM5iD,QAAQ2wE,OAC5BsnD,EAAqB93H,KAAKygB,IAAIyhC,eAAe41E,mBAEnD,OAAIk5F,IAEAjrL,GADE+xF,GACMl1B,MAAwBk1B,EAAoBk5F,IAKjDjrL,CACT,CAEAypL,2BAA2B1vK,GACzB,IAAI/Z,GAAQ,EACZ,MAAMkrL,EAAeruH,QACfk1B,EAAqB93H,KAAKygB,IAAIyhC,eAAe41E,mBAEnD,UAAWr1E,KAAS3C,EAAQ,CAC1B,MAAMkxK,EAAcvuK,EAAM5iD,QAAQ2wE,OAE9BwgJ,IAAgBA,EAAYh5L,SAASusF,MACvC3hB,MAAgBquH,EAAcD,EAElC,CAEA,OAAKpuH,MAAiBquH,KAElBlrL,GADE+xF,GACMl1B,MAAwBk1B,EAAoBm5F,IAKjDlrL,CACT,CAEAmoL,iBAAiBzrK,GACfziD,KAAKygB,IAAIyhC,eAAeoqC,aAAa7pC,EAAM5iD,QAAQ2wE,OACrD,CAEAw+I,kBAAkBlvK,GAChB,MAAMmxK,EAAeruH,QAOrB,UAAWngD,KAAS3C,EAAQ,CAC1B,MAAMkxK,EAAcvuK,EAAM5iD,QAAQ2wE,OAE9BwgJ,GACFpuH,MAAgBquH,EAAcD,EAElC,CACAhxN,KAAKygB,IAAIyhC,eAAeoqC,aAAa2kI,EACvC,CAEAzC,cAAc9kM,GACZ1pB,KAAK4iD,QAAUl5B,EAAMhjB,KACvB,CAEAwqN,eACElxN,KAAKysN,aAAUzqN,CACjB,CAEA6rN,gBACE,OAAO7tN,KAAK8/C,OACTp2C,OAAQq2C,IAAOA,EAAEsC,WACjBniC,OACC,CAACixM,EAAMj6K,IACEi6K,EAAK3uK,OAAStL,EAAQsL,OAAS2uK,EAAOj6K,EAE/C,CAAEsL,YAAQxgD,EAAWkQ,QAAIlQ,GAE/B,CAEAquN,iBAAiB5tK,GACf,MAAMxjC,EAAQjf,KAAK8/C,OAAO9K,UAAWoN,GAAQK,EAAMvwC,KAAOkwC,EAAIlwC,IAC9D,SACElS,KAAK8/C,SACL9/C,KAAK8/C,OAAO7gC,EAAQ,KACiB,IAArCjf,KAAK8/C,OAAO7gC,EAAQ,GAAGojC,UAK3B,CAEAyrK,gBACE,OAAO9tN,KAAK8/C,OACTp2C,OAAQq2C,IAAOA,EAAEsC,WACjBniC,OACC,CAACixM,EAAMj6K,IACEi6K,EAAK3uK,OAAStL,EAAQsL,OAAS2uK,EAAOj6K,EAE/C,CAAEsL,YAAQxgD,EAAWkQ,QAAIlQ,GAE/B,CAEAouN,iBAAiB3tK,GACf,MAAMxjC,EAAQjf,KAAK8/C,OAAO9K,UAAWoN,GAAQK,EAAMvwC,KAAOkwC,EAAIlwC,IAC9D,SACElS,KAAK8/C,SACL9/C,KAAK8/C,OAAO7gC,EAAQ,KACiB,IAArCjf,KAAK8/C,OAAO7gC,EAAQ,GAAGojC,UAK3B,CAEA+rK,gBACEtF,EACAsI,EACAC,GAAkB,GAElB,MAAMC,EAAqB,IAC3B/yF,SAAwBv+H,KAAKygB,IAAKqoM,EAAa7lG,KAAiBM,QAChE,IAAI+c,KAAuB/B,OACzBv+H,KAAKygB,IACLqoM,EACA7lG,KAAiBM,QAEd+c,IACHA,EAAuBwoF,GAEzB,MAAMyI,EAAe,CAACjxF,IACtBlB,SACEp/H,KAAKygB,IACL6/G,EACAixF,EACAtuG,KAAiBM,QAGnBvjH,KAAK8/C,OAAOr/B,IAAKgiC,MACqB,IAAhC8uK,EAAa7oN,QAAQ+5C,KACvB6uK,EAAmBhqN,KAAKm7C,GAAK,GAI7B2uK,IAAehE,GAAsBC,MACvCrtN,KAAKmlI,YAAYmsF,EAAoBD,GAC5BD,IAAehE,GAAsBE,OAC9CttN,KAAKqlI,YAAYisF,EAAoBD,EAEzC,CAKAf,eAAexwK,GACb,IAAIkyC,GAAW,EACXvyC,EAAO,EACX,UAAWgD,KAAS3C,EAAQ,CAC1B,MAAM0xK,EAAWxxN,KAAK8/C,OAAO9K,UAAWoN,IAAQK,EAAMvwC,KAAOkwC,GAAIlwC,IAC3Du/M,EAAezxN,KAAK8/C,OAAO0xK,GAC7BC,EAAapvK,YACf5C,GAAQ,GAGV,MAAMglK,GAAgBzkN,KAAK8/C,OAAO0xK,EAAW,GAE3C/M,KAC4B,IAA5BA,GAAcpiK,YACbvC,EAAO19B,KAAMggC,IAAQqiK,GAAcvyM,KAAOkwC,GAAIlwC,MACpB,IAA3Bu/M,EAAapvK,YAEb2vC,GAAW,EAEf,CAEA,OACiC,IAA9BhyF,KAAK0tN,cAAc9jN,QAAgB5J,KAAK0tN,cAAc,GAAGrrK,WAC1D5C,IAASz/C,KAAK0tN,cAAc9jN,UAE5BooF,GAAW,GAENA,CACT,CAKA0/H,cAAczyM,GACZ,QAAIA,EAAQ,MAIRjf,KAAK8/C,OAAO7gC,EAAQ,GAAGpf,QAAQ0oN,OAC1BvoN,KAAK0xN,cAAczyM,EAAQ,GAGtC,CAEAkmH,YAAYrlF,EAAiBuxK,GAAkB,GAC7C,MAAMM,EAAgB,GACtB,UAAWlvK,KAAS3C,EAAQ,CAC1B,MAAM7gC,EAAQjf,KAAK8/C,OAAO9K,UAAWoN,GAAQA,EAAIlwC,KAAOuwC,EAAMvwC,IAC1DlS,KAAK0xN,cAAczyM,IACrB0yM,EAAcrqN,KAAKm7C,EAEvB,CACAziD,KAAKygB,IAAI0kH,YAAYwsF,GACjBN,GACF1yL,WAAW,KACT,MAAMizL,EAAa5xN,KAAK8R,MAAMmB,cAAcqkI,uBAC1C,wBAEIu6E,EAAc7xN,KAAK8R,MAAMmB,cAAcqkI,uBAC3C,0BAEF,IAAIw6E,EACAF,EAAWhoN,SACbkoN,EAAiBF,EAAW,IAE1BC,EAAYjoN,SACdkoN,EAAiBD,EAAY,IAE3BC,MACFxkM,MAAewkM,EAAgB,CAC7BvkM,WAAY,YACZC,SAAU,SACVC,MAAO,MACPC,OAAQ,WACT,EAEF,IAEP,CAIA6iM,gBAAgBzwK,GACd,IAAIkyC,GAAW,EACXvyC,EAAO,EACX,UAAWgD,KAAS3C,EAAQ,CAC1B,MAAM0xK,EAAWxxN,KAAK8/C,OAAO9K,UAAWoN,IAAQK,EAAMvwC,KAAOkwC,GAAIlwC,IAC5ClS,KAAK8/C,OAAO0xK,GAChBnvK,YACf5C,GAAQ,GAGV,MAAMsyK,GAAY/xN,KAAK8/C,OAAO0xK,EAAW,GAEvCO,KACwB,IAAxBA,GAAU1vK,YACTvC,EAAO19B,KAAMggC,IAAQ2vK,GAAU7/M,KAAOkwC,GAAIlwC,MAE3C8/E,GAAW,EAEf,CAEA,OACiC,IAA9BhyF,KAAK0tN,cAAc9jN,QAAgB5J,KAAK0tN,cAAc,GAAGrrK,WAC1D5C,IAASz/C,KAAK0tN,cAAc9jN,UAE5BooF,GAAW,GAENA,CACT,CAKAggI,eAAe/yM,GACb,QACEA,EACAjf,KAAK8/C,OAAOp2C,OAAQ04C,IAA0B,IAAlBA,EAAIC,WAAoBz4C,OAAS,MAK3D5J,KAAK8/C,OAAO7gC,EAAQ,GAAGpf,QAAQ0oN,OAC1BvoN,KAAKgyN,eAAe/yM,EAAQ,GAGvC,CAEAomH,YAAYvlF,EAAiBuxK,GAAkB,GAC7C,MAAMY,EAAgB,GACtB,UAAWxvK,KAAS3C,EAAQ,CAC1B,MAAM7gC,EAAQjf,KAAK8/C,OAAO9K,UAAWoN,GAAQA,EAAIlwC,KAAOuwC,EAAMvwC,IAC1DlS,KAAKgyN,eAAe/yM,IACtBgzM,EAAc3qN,KAAKm7C,EAEvB,CACAziD,KAAKygB,IAAI4kH,YAAY4sF,GACjBZ,GACF1yL,WAAW,KACT,MAAMizL,EAAa5xN,KAAK8R,MAAMmB,cAAcqkI,uBAC1C,wBAEIu6E,EAAc7xN,KAAK8R,MAAMmB,cAAcqkI,uBAC3C,0BAEF,IAAIw6E,EACAF,EAAWhoN,SACbkoN,EAAiBF,EAAWA,EAAWhoN,OAAS,IAE9CioN,EAAYjoN,SACdkoN,EAAiBD,EAAY,IAE3BC,MACFxkM,MAAewkM,EAAgB,CAC7BvkM,WAAY,YACZC,SAAU,SACVC,MAAO,MACPC,OAAQ,WACT,EAEF,IAEP,CACQ/qB,OACN3C,KAAKmf,QAAQxc,MACf,CAEQkuN,cAAc/wK,GACpB,IAAIoyK,EAAYlyN,KAAKmyN,aAAaryK,GAClC,OACEoyK,EADElyN,KAAKusN,UACKvsN,KAAKoyN,kBAAkBF,GAEvBlyN,KAAKorN,mBAAmB8G,GAE/BA,CACT,CAEAG,gBAAgBnkK,GACdluD,KAAKysN,QAAUv+J,CACjB,CAEAq/J,6BAA6B94G,GAC3Bz0G,KAAKysN,QAAUh4G,EAAcg4G,QAC7BzsN,KAAKssN,YAAc73G,EAAc63G,YACjCtsN,KAAKusN,UAAY93G,EAAc83G,SACjC,CAEQ4F,aAAaryK,GAMnB,GAJE9/C,KAAKwtN,0BAA0B8E,cAAgBxF,GAAsB9+J,QAIlEhuD,KAAKysN,UAAYzsN,KAAKssN,YACzB,OAAOxsK,EAGT,MAAMyyK,EAAezyK,EAAOr/B,IAAKgiC,GAAiBA,EAAMvwC,IAExD4tC,SAAOvlC,QAASkoC,IACd,MACM66B,EAAoB76B,EAAMpsB,WAAWx2B,SAAW,GAGhD2yN,MAJgB/vK,EAAM5iD,SAAoC,IAElC4vE,UAAa,IACjBI,aAAe,IACVpvD,IAAKgyM,IAC3BA,GAAGh6L,UAAU,OAAOC,QAAQ,mBAAoB,KAGzD,GAAI14B,KAAKysN,SAAWhqK,EAAM72C,MAAO,CAC/B,MAAM8mN,GAAe1yN,KAAKysN,QACvBh0L,UAAU,OACVC,QAAQ,mBAAoB,IACzBikI,GAAal6G,EAAM72C,MACtB6sB,UAAU,OACVC,QAAQ,mBAAoB,IACzBi6L,GAAiBr1I,EAAkB95E,MAAQ,GAC3CmmL,GAAe,IAAI3/K,OAAO0oN,GAAc,MACxCE,QAEJ5wN,IADAwwN,GAAcpwM,KAAMqwM,IAAe9oC,GAAaz/K,KAAKuoN,KAEvD,IACG9oC,GAAaz/K,KAAKyyJ,KACjB38J,KAAKysN,QAAQt0L,gBAAkBw6L,GAAex6L,gBAC/Cy6L,GACD,CACA,MAAM3zM,GAAQszM,EAAa7pN,QAAQ+5C,EAAMvwC,IACrC+M,IAAQ,GACVszM,EAAa1sM,OAAO5G,GAAO,EAE/B,CACF,CAEA,GAAIjf,KAAKssN,cAAiC,IAAlB7pK,EAAM5rB,QAAmB,CAC/C,MAAM5X,GAAQszM,EAAa7pN,QAAQ+5C,EAAMvwC,IACrC+M,IAAQ,GACVszM,EAAa1sM,OAAO5G,GAAO,EAE/B,IAGK6gC,EAAOp2C,OACX+4C,IAAoD,IAAnC8vK,EAAa7pN,QAAQ+5C,EAAMvwC,IAEjD,CAEQk5M,mBAAmBtrK,GACzB,OAAOA,EAAOt9B,KAAK,CAACojH,EAAQC,IAAWA,EAAOrjF,OAASojF,EAAOpjF,OAChE,CAEQ4vK,kBAAkBtyK,GACxB,OAAOA,EAAOt9B,KAAK,CAAC8/B,EAAGC,IACjBviD,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,EAAE32C,QACtC,EAEL5L,KAAKy4B,UAAU6pB,EAAE12C,OAAS5L,KAAKy4B,UAAU8pB,EAAE32C,OACtC,EAEF,EAEX,CAEQ6sB,UAAU64B,GAChB,OAAOA,EACJ74B,UAAU,OACVC,QAAQ,mBAAoB,IAC5BP,aACL,CAEQy4L,qBACN,OAAQ5wN,KAAKwtN,0BAA0B8E,aACrC,KAAKxF,GAAsB/+J,OACzB,OAAO,EACT,KAAK++J,GAAsB9+J,MACzB,OAAO,EACT,QACE,SACEhuD,KAAK8/C,OAAOl2C,QAAU5J,KAAK0vN,0BAC3B1vN,KAAKysN,SACLzsN,KAAKssN,aAMb,CAEA1D,gBAAgBnmK,GACdziD,KAAKywN,eAAgB,EAEnBzwN,KAAK4vN,WADH5vN,KAAK4vN,WAAantK,IAAUziD,KAAK8oN,YAMrC,UAAW1mK,KAAOpiD,KAAK8/C,OACrBsC,EAAIviD,QAAQ8nB,QAAS,EAEvB86B,EAAM5iD,QAAQ8nB,QAAS,EACvB3nB,KAAK8oN,YAAcrmK,CACrB,CAEAmY,aAAa9a,GACX,GAAIA,GAAUA,EAAOl2C,OAAS,EAAG,CAC/B5J,KAAK0tN,cAAgB,GACrB,UAAWjrK,KAAS3C,GACc,IAA5B2C,EAAM5iD,QAAQgzN,UAChBpwK,EAAMhiC,IAAI8rF,YAAY9pD,GAEtBziD,KAAK0tN,cAAcpmN,KAAKm7C,EAG9B,MAAY3C,IAAiD,IAAvC9/C,KAAK8oN,YAAYjpN,QAAQgzN,YAC7C7yN,KAAK8oN,YAAYroM,IAAI8rF,YAAYvsG,KAAK8oN,aACtC9oN,KAAK4vN,WAAY,EAErB,CAEAnH,iBAAiB3oK,GACf,GAAIA,GAAUA,EAAOl2C,OAAS,EAC5B,UAAW64C,KAAS3C,EAClB2C,EAAM5rB,QAAU72B,KAAK6vN,mBAGzB7vN,KAAKguN,0BAA0BrrN,MAAK,EACtC,CAEA+rN,iBAAiBjsK,GACf,OAAmC,IAA5BA,EAAM5iD,QAAQgzN,SACvB,CAEA1D,qBAAqBrvK,GACnB,OAAOA,EAAO77B,MAAO87B,GAAM//C,KAAK0uN,iBAAiB3uK,GACnD,CAEA,6BAAIqvK,GACF,IAAI0D,EACF/F,GAA2BI,KACzB4F,GAAoB,EACpBC,GAAqB,EAEzB,GAAkC,IAA9BhzN,KAAK0tN,cAAc9jN,OACrBkpN,EAAuB/F,GAA2BI,SAC7C,CACL2F,EAAuB/F,GAA2BG,MAClDltN,KAAK6vN,oBAAqB,EAE1B,UAAWhqF,KAAU7lI,KAAK0tN,eACD,IAAnB7nF,EAAOhvG,UACTk8L,GAAW,IAEU,IAAnBltF,EAAOhvG,UACTm8L,GAAY,IAIC,IAAbD,IAAmC,IAAdC,IACvBF,EAAuB/F,GAA2BC,cAEnC,IAAb+F,IAAoC,IAAdC,IACxBF,EAAuB/F,GAA2BE,WAClDjtN,KAAK6vN,oBAAqB,EAE9B,CAEA,OAAOiD,CACT,CAEAnF,YAAYjkM,GAEV,GADAA,EAAM+4B,MAAM5iD,QAAQ0oN,MAAQ7+L,EAAM6+L,OACd,IAAhB7+L,EAAM6+L,MAAgB,CACxB,MAAM0K,EAAgBjzN,KAAK8/C,OAAO9K,UAC/ByN,GAAU/4B,EAAM+4B,MAAMvwC,KAAOuwC,EAAMvwC,IAEtC,UAAWuwC,KAASziD,KAAK0tN,cAEvB,GAAIuF,EADajzN,KAAK8/C,OAAO9K,UAAWoN,GAAQK,EAAMvwC,KAAOkwC,EAAIlwC,IA6B/D,OA3BAlS,KAAK0tN,cAAc7nM,OACjB7lB,KAAK0tN,cAAc14K,UAAWoN,GAAQK,EAAMvwC,KAAOkwC,EAAIlwC,IACvD,EACAwX,EAAM+4B,YAGJziD,KAAK0qN,kBAOL1qN,KAAKytN,eALLztN,KAAK0tN,cAAc9jN,SACnB5J,KAAK8/C,OAAOp2C,OACT04C,IAA0B,IAAlBA,EAAIC,WAAsBD,EAAIuH,iBACvC//C,OAMM5J,KAAK0qN,oBAKb1qN,KAAKytN,eAHLztN,KAAK0tN,cAAc9jN,SACnB5J,KAAK8/C,OAAOp2C,OAAQ04C,GAAQA,EAAIuH,iBAAiB//C,SAUzD5J,KAAK0tN,cAAcpmN,KAAKoiB,EAAM+4B,MAChC,KAAO,CACL,MAAMxjC,EAAQjf,KAAK0tN,cAAc14K,UAC9ByN,GAAU/4B,EAAM+4B,MAAMvwC,KAAOuwC,EAAMvwC,IAEtClS,KAAK0tN,cAAc7nM,OAAO5G,EAAO,EACnC,CAEIjf,KAAK0qN,kBAOL1qN,KAAKytN,eALLztN,KAAK0tN,cAAc9jN,SACnB5J,KAAK8/C,OAAOp2C,OACT04C,IAA0B,IAAlBA,EAAIC,WAAsBD,EAAIuH,iBACvC//C,OAMM5J,KAAK0qN,oBAKb1qN,KAAKytN,eAHLztN,KAAK0tN,cAAc9jN,SACnB5J,KAAK8/C,OAAOp2C,OAAQ04C,GAAQA,EAAIuH,iBAAiB//C,OAOvD,CAEAgjN,oBAAoBlmN,GAGlB,GAFA1G,KAAK0sB,UAAYhmB,EACjB1G,KAAK8oN,iBAAc9mN,GACL,IAAV0E,EAAgB,CAClB1G,KAAK4vN,WAAY,EACjB,UAAWntK,KAASziD,KAAK8/C,OACnB2C,EAAM5iD,QAAQ0oN,OAChBvoN,KAAK0tN,cAAcpmN,KAAKm7C,EAG9B,CACF,CAEA+tK,uBACE,GAAIxwN,KAAK0tN,cAAc9jN,OAAS,EAC9B,OAAO,EACF,CACL,MAAMg5C,EAAU,GAChB,UAAWH,KAASziD,KAAK0tN,cACvB9qK,EAAQt7C,KAAKm7C,EAAMG,SAErB,OAAOA,CACT,CACF,CAEAiG,YACE,GAAK7oD,KAAKytN,eAeH,CACL,UAAWhrK,KAASziD,KAAK8/C,OACvB2C,EAAM5iD,QAAQ0oN,OAAQ,EAExBvoN,KAAK0tN,cAAgB,GACrB1tN,KAAK0wN,gBAAgB/tN,MAAK,EAC5B,KArB0B,CACxB,UAAW8/C,KAASziD,KAAK8/C,QAErB9/C,KAAK0qN,oBACe,IAApBjoK,EAAMJ,WACNI,EAAMkH,kBAII3pD,KAAK0qN,mBAAqBjoK,EAAMkH,mBAF1ClH,EAAM5iD,QAAQ0oN,OAAQ,EACtBvoN,KAAK0tN,cAAcpmN,KAAKm7C,IAM5BziD,KAAK0wN,gBAAgB/tN,MAAK,EAC5B,CAOF,CAEAsxC,mBAAmBi/K,EAAY5+K,GAC7B,MAAMC,EAAa2+K,EAAW7/M,UAGxBmhC,EAAUF,EAAKlC,UAErB,OADmBoC,EAAUF,EAAKphC,cAHZqhC,EAAa2+K,EAAWhgN,cAIRshC,GAAWD,CACnD,CAEA07K,yBAAyBkD,GACvB,UAAW1wK,KAAS0wK,GACa,IAA3B1wK,EAAMm+D,kBACR5gH,KAAKygB,IAAI8rF,YAAY9pD,GAGzB,OAAO0wK,CACT,4CA94BW1D,GAAkBruN,aAAA,+BAAlBquN,EAAkBnhN,UAAA,qBAAA2mC,eAAA,SAAAnmC,EAAAC,EAAAmmC,MAAA,EAAApmC,wzIDzF/B1N,MAAA,EAAAgyN,GAAA,8CAYAhyN,MAAA,EAAAiyN,GAAA,aAeAjyN,MAAA,iBAEAA,MAAA,kBACEA,MAAA,EAAAkyN,GAAA,sCAsBFlyN,QA8IAA,MA5IA,EAAAmyN,GAAA,oBA4IAnyN,CAxIC,EAAAoyN,GAAA,4BAzDEpyN,MAAA,OAAAA,MAAA,IAAA2N,EAAA4gN,eAWGvuN,MAAA,GAAAA,MAAA,OAAA2N,EAAA2d,WAiBatrB,MAAA,GAAqBA,MAArB,gBAAqBA,CAAD,gBACMA,MAAA,GAAAA,MAAA,UAAAA,MAAA,IAAA2N,EAAAozC,UAyB1C/gD,MAAA,GAAAA,MAAA,QAAA2N,EAAA2d,WAAA3d,EAAA6gN,WAAA7gN,EAAA+5M,aA4IA1nN,cAAA,OAAA2N,EAAA2d,WAAA3d,EAAA+wC,OAAAl2C,OAAA,mBC/HCuF,KACA68M,GACAv8M,MAAiB9J,MACjBulD,KAAgBtlD,KAChBgtC,KACAn+B,KACAo0M,GACA33K,KACAoE,KACA/lC,KAAe1J,KACfwJ,KAAgBvJ,KAChB0J,KAAazJ,KACbs3J,IAAcr3J,IACd0O,MAAaC,YACboqK,MAAelqK,YACf0tJ,KACA9lI,KAAW3nB,UACXpF,KACAC,KAAiBmtB,MAAAjtB,OAAA,y0DAAAC,gBAAA,WAGR2/M,CAAkB,KC1ElBgE,GAAyB,MAAhC,MAAOA,EAOD91J,WACYthB,MAPdjgC,UACAyvM,2BACRC,mBAEA/rN,YACUqc,EACAuhD,EACYthB,GADZr8C,KAAA29D,aACY39D,KAAAq8C,QAEpBr8C,KAAKoc,UAAYA,CACnB,CAEA7O,WAGEvN,KAAK6rN,8BAA6B5oM,MAAc,CAC9CjjB,KAAK29D,WAAWS,SAASjc,QACzBniD,KAAK29D,WAAWS,SAASlc,eAAe+iD,cAEvClhG,QAAKof,MAAa,KAClBtgB,UAAWke,IACV,MAAMoqM,EAAcpqM,EAAM,GAAGrX,OAAQ+4C,IACF,IAA1BA,EAAMkH,iBAEf3pD,KAAKoc,UAAU0jC,OAASqrK,EACxBnrN,KAAK0zN,0BACHvI,EACAnrN,KAAKoc,UAAUsuM,kBAAiB,EAGxC,CAEQgJ,0BACN5zK,EACA4qK,QAEgC1oN,IAA5BhC,KAAK8rN,qBACP9rN,KAAK8rN,mBAAmB39M,cACxBnO,KAAK8rN,wBAAqB9pN,GAE5BhC,KAAK8rN,sBAAqB7oM,MACxB68B,EACGp2C,OAAQ+4C,GAAUA,EAAMJ,YAAcqoK,GACtCjqM,IAAKgiC,GAAiBA,EAAMoiE,WAE9B9gH,QAAK0c,KAAKkzM,GAAwBA,EAAS1vM,MAAM2rB,WACjD/sC,UACE+wN,GACE5zN,KAAKoc,UAAUiwM,oBAAsBuH,EAE9C,CAEA1lN,cACElO,KAAK6rN,2BAA2B19M,mBACAnM,IAA5BhC,KAAK8rN,qBACP9rN,KAAK8rN,mBAAmB39M,cACxBnO,KAAK8rN,wBAAqB9pN,EAE9B,4CA3DWyxN,GAAyBryN,MAAAuE,GAAA,GAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,kCAAzB4tN,EAAyBnlN,UAAA,gCAAAG,YAAA,WAAzBglN,CAAyB,8CCftCryN,MAAA,mCAQEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAuoN,qBAAoB,GAE7BzyN,MAAA,cAAUA,MAAA,iBACZA,kCAJEA,MADA,aAAAA,MAAA,kCACAA,CADuD,QAAAkK,EAAAC,QCwBlD,IAAMuoN,GAA2B,MAAlC,MAAOA,EACFrxK,MAEA8jE,cAAe,EAExB,WAAI1mH,GACF,GAAKG,KAAKyiD,MAGV,OAAOziD,KAAKyiD,MAAM5iD,OACpB,CAEO0L,MAAgB,UAEvBxL,cAAe,CAEfwN,WACEvN,KAAKuL,MAAQvL,KAAKumH,aAAe,UAAY,OAC/C,CAEAstG,qBACM7zN,KAAKumH,cACPvmH,KAAKyiD,MAAM8mE,oBAAoBvpH,KAAKyiD,MAAM5iD,QAAQ0mH,cAClDvmH,KAAKuL,MAAQ,UAEbvL,KAAKyiD,MAAM+jE,mBAAmBxmH,KAAKyiD,MAAM5iD,QAAQ0mH,cACjDvmH,KAAKuL,MAAQ,WAEfvL,KAAKumH,cAAgBvmH,KAAKumH,YAC5B,4CA7BWutG,EAA2B,+BAA3BA,EAA2BxlN,UAAA,+BAAAC,OAAA,CAAAk0C,MAAA,QAAA8jE,aAAA,gBAAA93G,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mRAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GD9BxC1N,MAAA,EAAA2yN,GAAA,qBACG3yN,MAAA,OAAA2N,EAAAlP,QAAA0mH,6BCsBCp3G,KACAI,KAAe5J,KACf0J,KAAgBzJ,KAChB4J,KAAa3J,KACb8J,KAAiB7J,MAAAgK,gBAAA,WAGRgkN,CAA2B,KCvB3BE,GAAe,MAAtB,MAAOA,EACXj0N,cAAe,CAEfwY,KAAKk3D,GACCA,EAASsC,QACXxqE,OAAOgR,KAAKk3D,EAASltE,IAAK,SAE9B,4CAPWyxN,EAAe,iCAAfA,EAAe3yN,QAAf2yN,EAAe1yN,UAAAC,WAFd,gBAEDyyN,CAAe,8CCP5B5yN,MAAA,mCAUEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA2oN,aAAA3oN,EAAAzL,QAAA4vE,UAA8B,GAEvCruE,MAAA,cAAUA,MAAA,UACZA,kCAJEA,MADA,aAAAA,MAAA,6BACAA,CADkD,QAAAkK,EAAAC,kCCLlDnK,MADF,yBACEA,CAD4E,QACxEA,MAAA,GACNA,gCADMA,MAAA,GAAAA,MAAAqnB,EAAAxkB,KAAA0rE,qCAENvuE,MAAA,0BACEA,MAAA,UACFA,8BADMA,cAAA,YAAAqnB,EAAAxkB,KAAA0rE,SAAAvuE,QCsCC,IAAM8yN,GAAuB,MAA9B,MAAOA,EAoBDC,gBACA77M,OApBV,SACImqC,GACF,OAAOziD,KAAK8lI,MACd,CACA,SAAIrjF,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,CAChB,CACQo/H,OAER,SACIv6H,GACF,OAAOvL,KAAKmxC,MACd,CACA,SAAI5lC,CAAM7E,GACR1G,KAAKmxC,OAASzqC,CAChB,CACQyqC,OAAS,UAEjBpxC,YACUo0N,EACA77M,GADAtY,KAAAm0N,kBACAn0N,KAAAsY,QACP,CAEH27M,aAAaxkJ,GACPA,EAASsC,QACNtC,EAASltE,KAAOktE,EAASE,SAC5B3vE,KAAKsY,OAAOC,KAAK67M,GAA2B,CAC1CnwN,KAAM,CACJ04J,WAAY38J,KAAKyiD,MAAM72C,MACvB+jE,SAAUF,EAASE,SACnBnsE,KAAMisE,EAASjsE,QAGVisE,EAASltE,KAClBvC,KAAKm0N,gBAAgB57M,KAAKk3D,IAElBA,EAASsC,QAAUtC,EAASE,UACtC3vE,KAAKsY,OAAOC,KAAK67M,GAA2B,CAC1CnwN,KAAM,CACJ04J,WAAY38J,KAAKyiD,MAAM72C,MACvB+jE,SAAUF,EAASE,SACnBnsE,KAAMisE,EAASjsE,OAIvB,CAEA,WAAI3D,GACF,GAAKG,KAAKyiD,MAGV,OAAOziD,KAAKyiD,MAAM5iD,OACpB,4CArDWq0N,GAAuB9yN,MAAAuE,IAAAvE,MAAAwE,OAAA,+BAAvBsuN,EAAuB5lN,UAAA,0BAAAC,OAAA,CAAAk0C,MAAA,QAAAl3C,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qOAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GF5CpC1N,MAAA,EAAAizN,GAAA,qBACGjzN,MAAA,OAAA2N,EAAAlP,SAAAkP,EAAAlP,QAAA4vE,UAAA1gE,EAAAlP,QAAA4vE,SAAAltE,KAAAwM,EAAAlP,SAAAkP,EAAAlP,QAAA4vE,UAAA1gE,EAAAlP,QAAA4vE,SAAAE,yBEmCCxgE,KACAI,KAAe1J,KACfwJ,KAAgBvJ,KAChB0J,KAAazJ,KACb4J,KAAiB3J,KACjB0gC,OAAe52B,gBAAA,WAGNokN,CAAuB,KAsEvBE,GAAyB,MAAhC,MAAOA,EACiCnwN,KAA5ClE,YAA4CkE,GAAAjE,KAAAiE,MAAwB,4CADzDmwN,GAAyBhzN,MAChBglC,OAAe,+BADxBguL,EAAyB9lN,UAAA,4BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4JAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDlHtC1N,MAAA,UAAqBA,MAAA,GAAqBA,QAC1CA,MAAA,cAAyDA,MAAA,OAACA,QAI1DA,MAHA,EAAAkzN,GAAA,2BAGAlzN,CAH8E,EAAAmzN,GAAA,mCAFzDnzN,cAAA2N,EAAA9K,KAAA04J,YAEAv7J,MAAA,GAAAA,MAAA,sBAAA2N,EAAA9K,KAAAT,MAGApC,cAAA,sBAAA2N,EAAA9K,KAAAT,sBCsGjB0U,MACA3I,KAAe1J,KACfq+L,MACA/0L,KACAgJ,OAAgBtI,OAAA,2JAAA2yB,cAAA,WAGP4xL,CAAyB,gCCvG/B,IAAMI,GAAkB,MAAzB,MAAOA,UAA0BnrD,KACrC58I,UAAY,MACZA,YAAcugE,KAEdjtF,YAA+BF,GAC7BuG,MAAMvG,EACR,CAEA+8E,QACE,OAAO43I,EAAkBtiN,EAC3B,CAEA+vF,UACE,OAAOuyH,EAAkBhxN,IAC3B,CAEU8lK,oBACR,MAAO,CACL19J,MAAO,QAEX,4CApBW4oN,GAAiBpzN,MAIR,WAAS,iCAJlBozN,EAAiBnzN,QAAjBmzN,EAAiBlzN,mBAAjBkzN,CAAkB,KCFzB,SAAUC,GAAyBx0N,GACvC,OAAO,IAAIu0N,GACTv0N,EAAOG,UAAU,iBAAiBo0N,GAAkBtiN,OAAS,GAEjE,iBCCO,IAAMwiN,GAAc,MAArB,MAAOA,EACX,cAAO37M,GACL,MAAO,CACLC,SAAU07M,EACVlqN,UAAW,CDCR,CACLC,QAAS4+J,KACT1hI,WAAY8sL,GACZ7pN,OAAO,EACPi9B,KAAM,CAAC1nC,QCHT,4CANWu0N,EAAc,8BAAdA,sCAFA,CAACzjE,MAAah4I,QAAA,CAFfy6E,KAAcrrB,eAIbqsJ,CAAc,qBCHpB,IAAMC,GAAkB,MAAzB,MAAOA,+CAAkB,8BAAlBA,qCAHD18D,eAGC08D,CAAkB,iCCCxB,IAAMC,GAAsB,MAA7B,MAAOA,+CAAsB,8BAAtBA,qCAHD7zD,KAAwBhF,eAGvB64D,CAAsB,qBCD5B,IAAMC,GAAuB,MAA9B,MAAOA,+CAAuB,8BAAvBA,qCAHD95D,eAGC85D,CAAuB,qBCA7B,IAAMC,GAAuB,MAA9B,MAAOA,+CAAuB,8BAAvBA,qCAHD95D,eAGC85D,CAAuB,8BCJ9B,SAAUC,GAA2BjmI,GACzC,OAAO,IAAI84E,KAAoB94E,EACjC,CAKM,SAAUkmI,KACd,MAAO,CACLvqN,QAASm9J,KACTjgI,WAAYotL,GACZltL,KAAM,CAACwhI,MAEX,mDCpBM,MAAO4rD,GACX,6BAAOC,CAAuBpuF,EAAKC,GACjC,MAAO,mDAAmDA,OAASD,GACrE,CAEA,8BAAOquF,CAAwBruF,EAAKC,GAClC,MAAO,iEAAiEA,OAASD,GACnF,CAEA,4BAAOsuF,CAAsBpmM,GAE3B,MAAO,mDADaqmM,UAAUrmM,IAEhC,ECZI,MAAOsmM,GACX,2BAAOC,CAAqBzuF,EAAKC,EAAKjlF,EAAe,IACnD,MAAO,uCAAuCilF,UAAYD,SAAWhlF,KAAQilF,KAAOD,GACtF,CAEA,2BAAO0uF,CAAqB1uF,EAAKC,EAAKjlF,EAAe,IACnD,MAAO,kCAAkCilF,KAAOD,KAAOhlF,IACzD,ECwBK,IAAM2zK,GAAgC,MAAvC,MAAOA,EACS9zN,gBAApB5B,YAAoB4B,GAAA3B,KAAA2B,iBAAmC,CAEvD+zN,aAAarsL,GACX,OAAOA,CACT,4CALWosL,GAAgCr0N,MAAAuE,MAAA,iCAAhC8vN,EAAgCp0N,QAAhCo0N,EAAgCn0N,mBAAhCm0N,CAAgC,KAWvC,MAAOE,WACHtsD,KAgBE1nK,gBAbV8qB,UAAY,qBACZA,YAAcugE,KAENw9C,YAERorF,OAAkC,IAAI7zN,KAAwB,IAE9D,SAAI6J,GACF,OAAO5L,KAAK41N,OAAOj8L,UACrB,CAEA55B,YACqBF,EACX8B,EACRw6C,EACuBquF,GAEvBpkI,MAAMvG,EAASs8C,GAJPn8C,KAAA2B,kBAKR3B,KAAKwqI,YAAcA,EACnBxqI,KAAK2B,gBAAgB8iE,UAAU5hE,UAAU,KACvC7C,KAAK41N,OAAOjzN,KACV3C,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ7sC,KAAKH,QAAQ+L,OAAM,EAGhE,CAEAgxE,QACE,OAAO+4I,GAA+BzjN,EACxC,CAEA+vF,UACE,OAAO0zH,GAA+BnyN,IACxC,CAEU8lK,oBACR,MAAO,CACL19J,MAAO,kCACP0oJ,MAAO,EACP0Q,gBAAgB,EAEpB,CAWAwC,cACEp1E,EACAvyF,EACAm4J,GAEA,SAAOp0J,OAAG,CACR5D,KAAK61N,aAAazjI,EAAQvyF,EAASm4J,IAEvC,CAEQ69D,aACN5xN,EACApE,EACAm4J,GAEA,MAAM89D,KAAUzsF,OAAeplI,GAEzBg6H,KADiBsM,OAAiBtmI,EAAMjE,KAAKwqI,aACrBtqH,OAC5B,CAACklC,GAAKvtB,MAAWutB,GAAIvtB,GAAK6lD,OAAS7lD,GAAK8yG,gBAAkBvlF,IAC1D,IAGI2wK,EAAsB/9D,KAExB/xE,OAAahiF,EAAM,GAAG8b,UAAUlW,KAAK,OAAI,EADzCo8E,OAAahiF,EAAM,GAAG4F,KAAK,MAGzBmsN,GAAyBh+D,EAE3B89D,EAAQ/1M,UAAUlW,KAAK,MADvBisN,EAAQjsN,KAAK,MAGjB,IAAIy/E,GAA4B,CAC9B9lF,KAAM,QACN0iF,YAAa,CAACjiF,EAAK,GAAIA,EAAK,KAG9B,MAAMozB,GAAa,GACnB,IAAI4+L,GAAe,GACnB,GAAIp2N,EAAQu7D,SAAU,CAIpB/jC,GAHkBr3B,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,sCAEsBhtC,EAAQu7D,SAChC66J,GAAe,qBAAuBp2N,EAAQu7D,SAAW,aAGzD,MAAM1Z,GAAS+uB,KACb,CAACxsE,EAAK,GAAIA,EAAK,IACf,YACA,aAEIiyN,GAAiB,IAAIn/F,KAASr1E,GAAQ7hD,EAAQu7D,UAC9C+6J,MAAkBr/F,OAAWo/F,IAC7BnyK,GAAS,IAAIg0B,KACnBuR,GAAWrxD,KAAKC,MACd6rB,GAAOqyK,cACLD,GAAgB/8M,UAAU,YAAa,cAG7C,CA2BAie,OAzBIx3B,EAAQgnI,OAIVxvG,GAHgBr3B,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,oCAEoBhtC,EAAQgnI,KAC9BovF,IAAiC,KAAjBA,GAAsB,OAAS,qBAC/CA,IAAgB,qBAAuBp2N,EAAQgnI,KAAO,aAUxDxvG,GAHIr3B,KAAK2B,gBAAgB4pB,UAAUshB,QAJjBmrH,EAKZ,2CAHA,qCAKiB+9D,EASvB1+L,GAHIr3B,KAAK2B,gBAAgB4pB,UAAUshB,QAJdmrH,EAKf,8CAHA,wCAKoBg+D,GAEnB,CACLvyM,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,YACA9Y,YAAQxuE,EACRq1B,WAAY7wB,OAAO6H,OAAOgpB,GAAY4mG,EAAQ,CAC5Co4F,WAAYpB,GAAYC,uBAAuBjxN,EAAK,GAAIA,EAAK,IAC7DqyN,iBAAkBrB,GAAYE,wBAC5BlxN,EAAK,GACLA,EAAK,IAEPsyN,cAAejB,GAASC,qBAAqBtxN,EAAK,GAAIA,EAAK,GAAI,IAC/DssF,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,iBAEJxuB,KAAM,CACJnM,GAAIjO,EAAK,GAAGk0D,WAAa,IAAMl0D,EAAK,GAAGk0D,WACvCvsD,MAAOmqN,IAGX13M,KAAM,CACJ+9I,SAAUpvE,KACV96E,GAAIjO,EAAK,GAAGk0D,WAAa,IAAMl0D,EAAK,GAAGk0D,WACvCvsD,MAAOmqN,EACPr3M,UAAWq3M,EAAqBE,GAChCtqN,KAAM,cACN6qN,MAAO,KAGb,4CA/KWb,IAA8Bv0N,MAgB/B,WAASA,MAAAuE,MAAAvE,MAAAwE,OAAAxE,MAGT,eAAa,iCAnBZu0N,GAA8Bt0N,QAA9Bs0N,GAA8Br0N,aAuDzCmhC,SAAA,IAHC8G,MAAU,CACTC,cAAe,MAChB,EAACnG,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAA/nB,MAAA/U,OAAAopC,WAAA,EAAAvM,GAAAC,IAAA,oBAKC1oB,OAAU67M,GAAAz7M,UAAA,sBCvCR,IAAK07M,GAAZ,SAAYA,GACVA,WAAAC,SAAA,cACAD,IAAAE,gBAAA,qBACAF,IAAAG,SAAA,cACAH,IAAAI,mBAAA,wBACAJ,IAAAK,OAAA,YACAL,IAAAM,UAAA,eACAN,IAAAO,cAAA,mBACAP,IAAAQ,qBAAA,0BACAR,IAAA/7K,UAAA,eATU+7K,CAUZ,CAVA,CAAYA,IAAgB,IC7CtB,SAAUS,GACdx1N,GAEA,OAAO,IAAI8zN,GAAiC9zN,EAC9C,yCChBO,MAAMy1N,GAET,CACF,aAAc,cACdC,KAAM,gBACN,gBAAiB,OACjB,mBAAoB,UACpB,oBAAqB,WACrB,sBAAuB,oBACvB,aAAc,MACdC,KAAM,kBACN,aAAc,kBACd,oBAAqB,YACrB,kBAAmB,YACnB,eAAgB,mBAChBlxG,MAAO,WACPmxG,OAAQtwL,MACR,eAAgB,WAChB,oBAAqB,aACrB,eAAgB,gBAChBuwL,SAAU,iBACVC,SAAU,iBACV,uBAAwB,eACxBC,QAAS,gBACTC,KAAM,SACN,YAAa,YACbC,QAAS,YACT,sBAAuB,uBCOlB,IAAMC,GAA6B,MAApC,MAAOA,EACSl2N,gBAApB5B,YAAoB4B,GAAA3B,KAAA2B,iBAAmC,CAEvD+zN,aAAarsL,GACX,OAAOA,CACT,4CALWwuL,GAA6Bz2N,MAAAuE,MAAA,iCAA7BkyN,EAA6Bx2N,QAA7Bw2N,EAA6Bv2N,mBAA7Bu2N,CAA6B,KAUpC,MAAOC,GACXC,UAAUxxN,GACR,OAAO+vD,mBAAmB/vD,EAC5B,CAEAyxN,YAAYtxN,GACV,OAAO4vD,mBAAmB5vD,EAC5B,CAEAuxN,UAAU1xN,GACR,OAAOylE,mBAAmBzlE,EAC5B,CAEA2xN,YAAYxxN,GACV,OAAOslE,mBAAmBtlE,EAC5B,EAOI,MAAOyxN,WAA6B9uD,KAa9B5nK,KACAE,gBAIAy2N,UAjBV3rM,UAAY,WACZA,YAAcugE,KACdvgE,2BAAuC,GACvCmpM,OAAkC,IAAI7zN,KAAwB,IAEtDs2N,oBAAsB,GAE9B,SAAIzsN,GACF,OAAO5L,KAAK41N,OAAOj8L,UACrB,CAEA55B,YACU0B,EACAE,EACRw6C,EACmBt8C,EAEXu4N,EACRx4N,GAEAwG,MAAMvG,EAASs8C,GARPn8C,KAAAyB,OACAzB,KAAA2B,kBAIA3B,KAAAo4N,YAKR,MAAMjyN,EAAcvG,EAASM,IAAIsB,OAC7BxB,KAAKqkK,SAASz6J,SACXzD,EAGHA,EAAYrE,cAAce,UAAU,KAClC7C,KAAKs4N,iBAAe,GAHtBt4N,KAAKs4N,mBAQTt4N,KAAK2B,gBAAgB8iE,UAAU5hE,UAAU,KACvC7C,KAAK41N,OAAOjzN,KACV3C,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ7sC,KAAKH,QAAQ+L,OAAM,EAGhE,CAEAgxE,QACE,OAAOu7I,GAAqBjmN,EAC9B,CAEA+vF,UACE,OAAOk2H,GAAqB30N,IAC9B,CAEU8lK,oBACR,MAAMnH,EACJniK,KAAKH,QAAQkH,QAAU/G,KAAKH,QAAQkH,OAAOo7J,MACvChnI,OAAOn7B,KAAKH,QAAQkH,OAAOo7J,YAC3BngK,EACAu2N,EACJv4N,KAAKH,QAAQkH,QAAU/G,KAAKH,QAAQkH,OAAOwxN,MACvCp9L,OAAOn7B,KAAKH,QAAQkH,OAAOwxN,YAC3Bv2N,EAEAi4E,EAAQj6E,KAAKH,QAAQkH,QAAQvD,KAC/BxD,KAAKH,QAAQkH,OAAOvD,KAAKk1B,QAAQ,MAAO,IAAIP,cAAc7uB,MAAM,KAChE,CACE,WACA,gBACA,SACA,gBACA,gBACA,MACA,WACA,SAGAkvN,EAAqBx4N,KAAKH,QAAQ44N,qBAExC,MAAO,CACL7sN,MAAO,+BACP29J,UAAW,8CACXlF,SAAU,CACR,CACE7gK,KAAM,WACNoI,MAAO,eACPojB,KAAM,OACNrT,OAAQ,CACN,CACE/P,MAAO,uCACPlF,MAAO,WACPiqC,SAAuC,IAA9BspC,EAAMvxE,QAAQ,YACvBk9J,SAAU,CAAC,YAEb,CACEh6J,MAAO,0CACPlF,MAAO,qBACPiqC,SAAiD,IAAxCspC,EAAMvxE,QAAQ,sBACvBk9J,SAAU,CAAC,uBAEb,CACEh6J,MAAO,uCACPlF,MAAO,0BACPiqC,SAAsD,IAA7CspC,EAAMvxE,QAAQ,2BACvBk9J,SAAU,CAAC,4BAEb,CACEh6J,MAAO,kCACPlF,MAAO,YACPiqC,SAAwC,IAA/BspC,EAAMvxE,QAAQ,aACvBk9J,SAAU,CAAC,QAAS,SAAU,OAEhC,CACEh6J,MAAO,oCACPlF,MAAO,cACPiqC,SAA0C,IAAjCspC,EAAMvxE,QAAQ,eACvBk9J,SAAU,CAAC,QAAS,SAAU,SAEhC,CACEh6J,MAAO,wCACPlF,MAAO,WACPiqC,SAAuC,IAA9BspC,EAAMvxE,QAAQ,YACvBk9J,SAAU,CAAC,aAEb,CACEh6J,MAAO,0CACPlF,MAAO,gBACPiqC,SAA4C,IAAnCspC,EAAMvxE,QAAQ,iBACvBk9J,SAAU,CAAC,gBAEb,CACEh6J,MAAO,0CACPlF,MAAO,cACPiqC,SAA0C,IAAjCspC,EAAMvxE,QAAQ,eACvBsF,WAAW,EACX43J,SAAU,CAAC,eAEb,CACEh6J,MAAO,yCACPlF,MAAO,mBACPiqC,SAA+C,IAAtCspC,EAAMvxE,QAAQ,oBACvBk9J,SAAU,CAAC,YAAa,qBAE1B,CACEh6J,MAAO,wCACPlF,MAAO,mBACPiqC,SAA+C,IAAtCspC,EAAMvxE,QAAQ,oBACvBk9J,SAAU,CAAC,aAAc,qBAE3B,CACEh6J,MAAO,kCACPlF,MAAO,KACPiqC,SAAiC,IAAxBspC,EAAMvxE,QAAQ,MACvBk9J,SAAU,CAAC,OAEb,CACEh6J,MAAO,4CACPlF,MAAO,gBACPiqC,SAA4C,IAAnCspC,EAAMvxE,QAAQ,iBACvBk9J,SAAU,CAAC,eAAgB,MAE7B,CACEh6J,MAAO,qCACPlF,MAAO,QACPiqC,SAAoC,IAA3BspC,EAAMvxE,QAAQ,SACvBk9J,SAAU,CAAC,SAEb,CACEh6J,MAAO,mCACPlF,MAAO,MACPiqC,SAAkC,IAAzBspC,EAAMvxE,QAAQ,OACvBk9J,SAAU,CAAC,QAEb,CACEh6J,MAAO,oCACPlF,MAAO,gBACPiqC,SAA4C,IAAnCspC,EAAMvxE,QAAQ,iBACvBk9J,SAAU,CAAC,kBAAgB,QAE7B,CACEh6J,MAAO,wCACPlF,MAAO,WACPiqC,SAAuC,IAA9BspC,EAAMvxE,QAAQ,YACvBk9J,SAAU,CAAC,2BAAyB,aAEtC,CACEh6J,MAAO,mCACPlF,MAAO,aACPiqC,SAAyC,IAAhCspC,EAAMvxE,QAAQ,cACvBk9J,SAAU,CAAC,QAAS,SAAU,YAAU,MAAO,QAEjD,CACEh6J,MAAO,kCACPlF,MAAO,YACPiqC,SAAwC,IAA/BspC,EAAMvxE,QAAQ,aACvBk9J,SAAU,CAAC,QAAS,SAAU,YAAU,OAE1C,CACEh6J,MAAO,oCACPlF,MAAO,SACPiqC,SAAqC,IAA5BspC,EAAMvxE,QAAQ,UACvBk9J,SAAU,CAAC,UAEb,CACEh6J,MAAO,oCACPlF,MAAO,oBACPiqC,SAAgD,IAAvCspC,EAAMvxE,QAAQ,qBACvBk9J,SAAU,CAAC,SAAU,UAAW,SAElC,CACEh6J,MAAO,yCACPlF,MAAO,UACPiqC,SAAsC,IAA7BspC,EAAMvxE,QAAQ,WACvBk9J,SAAU,CAAC,SAAU,YAEvB,CACEh6J,MAAO,sCACPlF,MAAO,SACPiqC,SAAqC,IAA5BspC,EAAMvxE,QAAQ,UACvBk9J,SAAU,CAAC,SAAU,cAI3B,CACEpiK,KAAM,cACNoI,MAAO,gBACPojB,KAAM,QACNrT,OAAQ,CACN,CACE/P,MAAO,IACPlF,MAAO,EACPiqC,QAAmB,IAAVwxH,GAEX,CACEv2J,MAAO,IACPlF,MAAO,EACPiqC,QAAmB,IAAVwxH,IAAgBA,GAE3B,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,GAEX,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,GAEX,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,KAIfq2D,GACG,CACCh1N,KAAM,cACNoI,MAAO,QACPojB,KAAM,QACNrT,OAAQ,CACN,CACE/P,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,IAAiBA,GAE5B,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,QACPlF,MAAO,IACPiqC,QAAmB,MAAV4nL,KAIjB,CACE/0N,KAAM,cACNoI,MAAO,iBACPojB,KAAM,MACNrT,OAAQ,CACN,CACE/P,MAAO,6CACPlF,MAAO,OACPiqC,SAAS,GAEX,CACE/kC,MAAO,gDACPlF,MAAO,QACPiqC,SAAS,MAIfjnC,OAAOkmC,SAEb,CAOAq8B,OACE/d,EACAruD,GAEA,MAAMkH,EAAS/G,KAAK04N,qBAAqBxqK,EAAMruD,GAAW,IAC1D,OAAKkH,EAAO7G,IAAI,QAAQ0J,QAGxB5J,KAAKH,QAAQkH,OAAOgkB,KAAOhkB,EAAO7G,IAAI,SAAW,IAE1CF,KAAK24N,UAAUzqK,EAAMnnD,KAAM,EAJzBnD,OAAG,GAKd,CAMQ+0N,UACNzqK,EACAnnD,GAEA,OAAO/G,KAAKyB,KAAKvB,IAAI,GAAGF,KAAKupK,oBAAqB,CAAExiK,WAAUhD,QAC5D0c,KAAKuxE,GAA+BhyF,KAAK44N,eAAe5mI,EAAU9jC,KAAK,EACvEhqD,MAAYC,IACVA,QAAIC,MAAMykC,WAAY,EACtB1kC,EAAIC,MAAMwH,MAAQ5L,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C7sC,KAAKspK,oBAAoB19J,OAErBzH,IAGZ,CACQm0N,kBACN,OAAOt4N,KAAKyB,KACTvB,IAAI,GAAGF,KAAKupK,mBACZ1mK,UAAWo3E,IACV,MAAM4+I,EAAc74N,KAAKqkK,SAASjiJ,KAAMxG,GAAiB,SAAXA,EAAEoT,MAChD6pM,EAAYl9M,OAAOpB,QAASlB,IAC1B,MAAMy/M,EAAQ,IAAI9uN,OAAO,IAAIqP,EAAE3S,gBACzBqyN,EAAe9+I,EAAMvwE,OAAQhD,GAAUoyN,EAAM5uN,KAAKxD,IACxD2S,EAAErL,UAAY+qN,EAAanvN,OAAS,EACpB,UAAZyP,EAAE3S,QACJ1G,KAAKq4N,oBAAsB,IACrB,IAAI33M,IACNq4M,EACGt4M,IAAKvC,GAAMA,EAAE5U,MAAM,MACnB4W,OAAO,CAACoiC,EAAGC,IAAMD,EAAE3hC,OAAO4hC,IAC1B74C,OAAQwU,GAAY,UAANA,KACV,GAIfle,KAAKulK,oBAAoBszD,GAAa,EAAK,EAEjD,CAEQH,qBACNxqK,EACAruD,GAEA,MAAM+gD,EAAmBp6C,OAAO6H,OAC9B,CACEi7E,UAAU,EACVg4D,MAAM,EACN31I,MAAM,EACNnI,KAAM,mFAERxD,KAAK+G,OACL/G,KAAKg5N,oBAAoB9qK,EAAMruD,GAAW,IAAIkH,OAC9C,CACEkyN,EAAGj5N,KAAKk5N,YAAYhrK,GACpBnjC,KAAMlrB,EAAQkrB,OAIlB,GAAwB,SAApB61B,EAAY4zH,IAAgB,CAC9B,MAAO2kD,EAAMC,EAAMC,EAAMC,GAAQz5N,EAAQ2wE,OACzC5vB,EAAY4zH,IAAM,GAAG2kD,KAAQC,KAAQC,KAAQD,KAAQC,KAAQC,KAAQH,KAAQG,KAAQH,KAAQC,GAC/F,KAA+B,UAApBx4K,EAAY4zH,YACd5zH,EAAY4zH,IAGrB,MAAI,aAAatqK,KAAK02C,EAAYq4K,KAChCr4K,EAAYp9C,KAAO,SAGd,IAAI0rE,KAAW,CACpBC,WAAY5yD,MAAY+0D,gBAAgB1wB,GACxC24K,QAAS,IAAIzB,IAEjB,CAEQc,eACN5mI,EACA9jC,GAEA,OAAO8jC,EAASznF,SAASkW,IAAKxc,GACrBjE,KAAKo4N,UAAU1C,aACpB11N,KAAK61N,aAAa5xN,EAAMiqD,EAAM8jC,IAGpC,CAEQ6jI,aACN5xN,EACAiqD,EACA8jC,GAEA,MAAM36D,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCiO,EAAK,CAAClS,KAAK48E,QAASvlD,EAAW7zB,KAAM6zB,EAAWqyF,MAAM7/G,KAAK,KAE3D6U,EAAYza,EAAKw1N,UAAU7tN,OAAS3H,EAAKozB,WAAW84H,IACpD8lE,EAAehyN,EAAKw1N,UAAUC,OAChC,YAAcz1N,EAAKw1N,UAAUC,OAAS,WACtC,GACEC,GAAgB11N,EAAKw1N,UAAUG,OACjC,eAAiB31N,EAAKw1N,UAAUG,OAAS,WACzC,GAEJ,IAAIjuN,GAAyB1H,EAAK0H,KAClC,MAAmB,iBAARA,IAAoBnF,OAAOC,KAAK2wN,IAAgBp/L,SAASrsB,MAClEA,GAAOyrN,GAAezrN,KAGjB,CACL8X,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,SAAUrlF,EAAKqlF,SACf9Y,OAAQvsE,EAAKq9I,KACbjqH,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAKozB,WAAW84H,MAG3B9xI,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAKozB,WAAW84H,IACvBzxI,UAAWA,EAAYu3M,EAAe0D,GACtChuN,KAAMA,IAAQ,cACd6qN,MACEvyN,EAAKuyN,UAASztD,OAAsB76G,EAAKu6E,OAAQxkI,EAAKozB,WAAW84H,KACnEiS,SACEpwE,EAASznF,SAASX,QAAU5J,KAAKH,QAAQkH,OAAOo7J,OAAU,IACzDniK,KAAKH,QAAQkH,OAAOgkB,KAAO,IAGpC,CAEQyuM,kBAAkBv1N,GACxB,MAAMozB,EAAa9a,MAAYs9M,WAC7B51N,EAAKozB,WACL8gM,GAAqB2B,qBAGvB,IAAK71N,EAAKqlF,SACR,OAAO9iF,OAAO6H,OAAO,CAAE7K,KAAMS,EAAKgb,OAASoY,GAG7C,MAAM0iM,EAGF,CACF1D,WAAY,IAGd,IAAI2D,EAcAC,EAbJ,GAA2B,UAAvBh2N,EAAKqlF,SAAS9lF,KAChBw2N,EAAa/E,GAAYC,uBACvBjxN,EAAKqlF,SAASpD,YAAY,GAC1BjiF,EAAKqlF,SAASpD,YAAY,QAEvB,CACL,MAAMqD,KAAQC,MAAevlF,EAAKqlF,UAClC0wI,EAAa/E,GAAYC,uBACvB3rI,EAAMD,SAASpD,YAAY,GAC3BqD,EAAMD,SAASpD,YAAY,GAE/B,CAIE+zI,EAAgBhF,GAAYG,sBADX,WAAfnxN,EAAKgb,MAELhb,EAAKozB,WAAW84H,IAAM,KAAOlsJ,EAAKozB,WAAW6iM,aAEvB,kBAAfj2N,EAAKgb,MAEZhb,EAAKozB,WAAW84H,IAAM,UAEA,QAAflsJ,EAAKgb,MAEZ,OAAShb,EAAKozB,WAAW84H,IAEH,aAAflsJ,EAAKgb,MAEZhb,EAAKozB,WAAW84H,IAAM,OAItBlsJ,EAAKozB,WAAW84H,KAAOlsJ,EAAKw1N,UAAU7tN,OAI1CmuN,EAAsB1D,WACpB,WACA2D,EACA,oBACAh6N,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,yBACvC,uBACAotL,EACA,oBACAj6N,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,wBACvC,OAEyB,UAAvB5oC,EAAKqlF,SAAS9lF,OAChBu2N,EAAsBzD,iBACpBrB,GAAYE,wBACVlxN,EAAKqlF,SAASpD,YAAY,GAC1BjiF,EAAKqlF,SAASpD,YAAY,KAIhC,MAAMi0I,EAEF,CACF5pI,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAGJ,OAAOrmC,OAAO6H,OACZ,CAAE7K,KAAMS,EAAKgb,OACboY,EACA0iM,EACAI,EAEJ,CAMQjB,YAAYhrK,GAGlB,IAAIksK,GAAO,EACXA,UAFiBlsK,EAAKhzB,MAAM,kBAAoB,IAEhCta,KAAMypJ,IACpB,MAAMC,EAAa7gI,OAAO4gI,GAAS3d,UAAU,GAC7C,OAAO1sJ,KAAKq4N,oBAAoBz3M,KAC7BomI,GACCA,EACG7uH,cACAM,UAAU,OACVC,QAAQ,mBAAoB,MAC/B4xI,EACGnyI,cACAM,UAAU,OACVC,QAAQ,mBAAoB,IAAG,GAInC0hM,IACHlsK,EAAOA,EAAKx1B,QAAQ,gBAAiB,KAGhCw1B,EAAKx1B,QAAQ,gDAAkC,GACxD,CAOQsgM,oBACN9qK,EACAruD,GAEA,MAAM+lK,EAAWx/J,MAAM4jK,iBAAiB97G,EAAM,QAC9C,OAAI03G,IACF/lK,EAAQkH,OAASP,OAAO6H,OAAOxO,EAAQkH,QAAU,GAAI,CACnDvD,KAAMoiK,EAAS/7J,KAAK,QAIjBhK,CACT,4CAtlBWs4N,IAAoB/2N,MAAAwE,MAAAxE,MAAAuE,MAAAvE,MAAAyE,OAAAzE,MAgBrB,WAASA,MACTy2N,IAA6Bz2N,aAAA,iCAjB5B+2N,GAAoB92N,QAApB82N,GAAoB72N,aAsUvBmhC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAAmG,OAGQylC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAUu9M,GAAAn9M,UAAA,kBAoRT,MAAOu/M,WACHlxD,KAcE5nK,KACAE,gBAZV8qB,UAAY,kBACZA,YAAcugE,KACdvgE,2BAAuC,GAEvCmpM,OAAkC,IAAI7zN,KAAwB,IAE9D,SAAI6J,GACF,OAAO5L,KAAK41N,OAAOj8L,UACrB,CAEA55B,YACU0B,EACAE,EACRw6C,EACmBt8C,EACnBD,GAEAwG,MAAMvG,EAASs8C,GANPn8C,KAAAyB,OACAzB,KAAA2B,kBAOR3B,KAAK2B,gBAAgB8iE,UAAU5hE,UAAU,KACvC7C,KAAK41N,OAAOjzN,KACV3C,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ7sC,KAAKH,QAAQ+L,OAAM,GAI9D,MAAMzF,EAAcvG,EAASM,IAAIsB,OAC7BxB,KAAKqkK,SAASz6J,SACXzD,EAGHA,EAAYrE,cAAce,UAAU,KAClC7C,KAAKs4N,iBAAe,GAHtBt4N,KAAKs4N,kBAOX,CAEA17I,QACE,OAAO29I,GAA4BroN,EACrC,CAEA+vF,UACE,OAAOs4H,GAA4B/2N,IACrC,CAEU8lK,oBACR,MAAMrvF,EACJj6E,KAAKH,QAAQkH,QAAU/G,KAAKH,QAAQkH,OAAOvD,KACvCxD,KAAKH,QAAQkH,OAAOvD,KAAKk1B,QAAQ,MAAO,IAAIP,cAAc7uB,MAAM,KAChE,CAAC,WAAY,gBAAiB,MAAO,YAE3C,MAAO,CACLsC,MAAO,sCACP29J,UAAW,6CACXlF,SAAU,CACR,CACE7gK,KAAM,WACNoI,MAAO,eACPojB,KAAM,OACNrT,OAAQ,CACN,CACE/P,MAAO,uCACPlF,MAAO,WACPiqC,SAAuC,IAA9BspC,EAAMvxE,QAAQ,aAEzB,CACEkD,MAAO,oCACPlF,MAAO,SACPiqC,SAAqC,IAA5BspC,EAAMvxE,QAAQ,UACvBsF,WAAW,GAEb,CACEpC,MAAO,wCACPlF,MAAO,kBACPiqC,SAA8C,IAArCspC,EAAMvxE,QAAQ,oBAEzB,CACEkD,MAAO,oCACPlF,MAAO,gBACPiqC,SAA4C,IAAnCspC,EAAMvxE,QAAQ,kBAEzB,CACEkD,MAAO,mCACPlF,MAAO,MACPiqC,SAAkC,IAAzBspC,EAAMvxE,QAAQ,QAEzB,CACEkD,MAAO,wCACPlF,MAAO,WACPiqC,SAAuC,IAA9BspC,EAAMvxE,QAAQ,aAEzB,CACEkD,MAAO,sCACPlF,MAAO,SACPiqC,SAAqC,IAA5BspC,EAAMvxE,QAAQ,aAI7B,CACElF,KAAM,cACNoI,MAAO,SACPojB,KAAM,cACNrT,OAAQ,CACN,CACE/P,MAAO,QACPlF,MAAO,IACPiqC,SAAU3wC,KAAKH,QAAQu7D,UAAsC,MAA1Bp7D,KAAKH,QAAQu7D,UAElD,CACExvD,MAAO,QACPlF,MAAO,IACPiqC,QAAmC,MAA1B3wC,KAAKH,QAAQu7D,UAExB,CACExvD,MAAO,OACPlF,MAAO,IACPiqC,QAAmC,MAA1B3wC,KAAKH,QAAQu7D,UAExB,CACExvD,MAAO,OACPlF,MAAO,IACPiqC,QAAmC,MAA1B3wC,KAAKH,QAAQu7D,UAExB,CACExvD,MAAO,OACPlF,MAAO,IACPiqC,QAAmC,MAA1B3wC,KAAKH,QAAQu7D,aAMlC,CAQAosG,cACEp1E,EACAvyF,GAEA,MAAMkH,EAAS/G,KAAK04N,qBAAqBtmI,EAAQvyF,GAAW,IAC5D,OAAKkH,EAAO7G,IAAI,QAAQ0J,OAGjB5J,KAAKw6N,iBAAiBzzN,IAAM,EAF1BnD,OAAG,GAGd,CAMQ42N,iBACNzzN,GAEA,OAAO/G,KAAKyB,KAAKvB,IAAI,GAAGF,KAAKupK,mBAAoB,CAAExiK,WAAUhD,QAC3D0c,KAAKuxE,GACIhyF,KAAK44N,eAAe5mI,IAGjC,CAEQsmI,kBACN,OAAOt4N,KAAKyB,KACTvB,IAAI,GAAGF,KAAKupK,mBACZ1mK,UAAWo3E,IACV,MAAM4+I,EAAc74N,KAAKqkK,SAASjiJ,KAAMxG,GAAiB,SAAXA,EAAEoT,MAChD6pM,EAAYl9M,OAAOpB,QAASlB,IAC1BA,EAAErL,UAAYisE,EAAMvxE,QAAQ2Q,EAAE3S,QAAmB,IAEnD1G,KAAKulK,oBAAoBszD,GAAa,EAAK,EAEjD,CAEQH,qBACNtmI,EACAvyF,GAEA,OAAIA,EAAQu7D,UAAYp7D,KAAKH,QAAQu7D,YACnCv7D,EAAQkH,OAASP,OAAO6H,OAAOxO,EAAQkH,QAAU,GAAI,CACnDutK,YAAaz0K,EAAQu7D,UAAYp7D,KAAKH,QAAQu7D,YAI3C,IAAI8T,KAAW,CACpBC,WAAY3oE,OAAO6H,OACjB,CACEmmK,IAAKpiF,EAAOvoF,KAAK,KACjB2Y,KAAM,WACN8mE,UAAU,EACV39E,MAAM,GAER9L,EAAQkH,QAAU,GAClB/G,KAAK+G,SAGX,CAEQ6xN,eACN5mI,GAEA,OAAOA,EAASznF,SAASkW,IAAKxc,GACrBjE,KAAK61N,aAAa5xN,GAE7B,CAEQw2N,YAAYx2N,GAClB,IAAKjE,KAAKqkK,SAASz6J,OACjB,MAAO,GAET,IAAI+5I,EAAW,GACf,GACO,oBADC1/I,EAAKozB,WAAW7zB,KAEpBmgJ,EAAW1/I,EAAKozB,WAAW6iM,aAAe,wBAE5C,CAEE,MAAM12N,EADcxD,KAAKqkK,SAASjiJ,KAAMxG,GAAiB,SAAXA,EAAEoT,MACvBrT,OAAOyG,KAC7BlE,GAAMA,EAAExX,QAAUzC,EAAKozB,WAAW7zB,MAEjCA,IACFmgJ,EAAW3jJ,KAAK2B,gBAAgB4pB,UAAUshB,QAAQrpC,EAAKoI,OAAK,CAGlE,OAAO+3I,CACT,CAEQkyE,aAAa5xN,GACnB,MAAMozB,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCusE,EAASxwE,KAAK06N,cAAcz2N,GAC5BiO,EAAK,CAAClS,KAAK48E,QAASvlD,EAAW7zB,KAAM6zB,EAAWqyF,MAAM7/G,KAAK,KAE3D6U,EAAYza,EAAKozB,WAAW84H,IAC5B8lE,EAAe,YAAcj2N,KAAKy6N,YAAYx2N,GAAQ,WAE5D,MAAO,CACLwf,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,SAAUrlF,EAAKqlF,SACf9Y,SACAn5C,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAKozB,WAAW84H,MAG3B9xI,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAKozB,WAAW84H,IACvBzxI,UAAWA,EAAYu3M,EACvBtqN,KAAM1H,EAAK0H,MAAQ,cACnBu7J,oBAAqBlnK,KAAKy6N,YAAYx2N,GAAQ,KAAOA,EAAKozB,WAAW84H,KAG3E,CAEQqpE,kBAAkBv1N,GACxB,MAAMozB,EAAa9a,MAAYs9M,WAC7B51N,EAAKozB,WACLkjM,GAA4BT,qBAGxBK,EAEF,CACF5pI,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAGJ,OAAOrmC,OAAO6H,OAAOgpB,EAAY8iM,EACnC,CAEQO,cACNz2N,GAEA,OAAOA,EAAKq9I,KACR,CAACr9I,EAAKq9I,KAAK,GAAIr9I,EAAKq9I,KAAK,GAAIr9I,EAAKq9I,KAAK,GAAIr9I,EAAKq9I,KAAK,SACrDt/I,CACN,4CAlSWu4N,IAA2Bn5N,MAAAwE,MAAAxE,MAAAuE,MAAAvE,MAAAyE,OAAAzE,MAkB5B,WAASA,aAAA,iCAlBRm5N,GAA2Bl5N,QAA3Bk5N,GAA2Bj5N,YCjpBlC,SAAUq5N,GACdh5N,GAEA,OAAO,IAAIk2N,GAA8Bl2N,EAC3C,CAKM,SAAUi5N,KACd,MAAO,CACLnwN,QAASotN,GACTlwL,WAAYgzL,GACZ9yL,KAAM,CAAC28B,MAEX,CAMM,SAAUq2J,GACdp5N,EACAE,EACAw6C,EACAl8C,EACAm4N,EACAx4N,GAEA,OAAO,IAAIu4N,GACT12N,EACAE,EACAw6C,EACAl8C,EAAOG,UAAU,iBAAiB+3N,GAAqBjmN,MACvDkmN,EACAx4N,EAEJ,CAqBM,SAAUk7N,KACd,MAAO,CACLC,KAAMrE,GAAiBC,SACvBnsN,UAAW,CAlBN,CACLC,QAAS4+J,KACT1hI,WAAYkzL,GACZjwN,OAAO,EACPi9B,KAAM,CACJg7B,KACA2B,KACA35D,MACA1K,KACA03N,GACAjtJ,QAUAgwJ,MAGN,ED8uBUn4L,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAEQ4rC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAUogN,GAAAhgN,UAAA,qDEtyBR,IAAMigN,GAA2B,MAAlC,MAAOA,EACSt5N,gBAApB5B,YAAoB4B,GAAA3B,KAAA2B,iBAAmC,CAEvD+zN,aAAazxN,GACX,MAAMi3N,EAAa,CACjB,QACA,WACA,aACA,cACA,cACA,UACA,QAGIj9M,EAAWzX,OAAOsa,QAAQ7c,EAAKozB,YAClC3tB,OAAO,EAAEnD,MAAqC,IAA5B20N,EAAWxyN,QAAQnC,IACrC2Z,OAAO,CAAC8wH,EAA6BlwH,KACpC,MAAOva,GAAKG,IAASoa,EACrB,IAAIoY,GACJ,IACEA,GAASl5B,KAAK2B,gBAAgB4pB,UAAUshB,QACtC,oCAAsCtmC,GAE1C,OACE2yB,GAAS3yB,EACX,CACAyqI,SAAI93G,IAAUxyB,IAAgB,GACvBsqI,GACN,IAECmqF,EAAQ30N,OAAO6H,OAAO,GAAIpK,GAChCk3N,SAAM9jM,WAAapZ,EAEZk9M,CACT,4CAlCWF,GAA2B75N,MAAAuE,MAAA,iCAA3Bs1N,EAA2B55N,QAA3B45N,EAA2B35N,mBAA3B25N,CAA2B,KAyClC,MAAOG,WAA2B/xD,KAW5B5nK,KACAE,gBAIAy2N,UAfV3rM,UAAY,SACZA,YAAco6E,KAEd+uH,OAAkC,IAAI7zN,KAAwB,IAE9D,SAAI6J,GACF,OAAO5L,KAAK41N,OAAOj8L,UACrB,CAEA55B,YACU0B,EACAE,EACRw6C,EACmBt8C,EAEXu4N,GAERhyN,MAAMvG,EAASs8C,GAPPn8C,KAAAyB,OACAzB,KAAA2B,kBAIA3B,KAAAo4N,YAGRp4N,KAAK2B,gBAAgB8iE,UAAU5hE,UAAU,KACvC7C,KAAK41N,OAAOjzN,KACV3C,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ7sC,KAAKH,QAAQ+L,OAAM,EAGhE,CAEAgxE,QACE,OAAOw+I,GAAmBlpN,EAC5B,CAEA+vF,UACE,OAAOm5H,GAAmB53N,IAC5B,CAEU8lK,oBACR,MAAMnH,EACJniK,KAAKH,QAAQkH,QAAU/G,KAAKH,QAAQkH,OAAOo7J,MACvChnI,OAAOn7B,KAAKH,QAAQkH,OAAOo7J,YAC3BngK,EACAu2N,EACJv4N,KAAKH,QAAQkH,QAAU/G,KAAKH,QAAQkH,OAAOwxN,MACvCp9L,OAAOn7B,KAAKH,QAAQkH,OAAOwxN,YAC3Bv2N,EAIN,MAAO,CACL4J,MAAO,6BACP29J,UAAW,mDACXlF,SAAU,CACR,CACE7gK,KAAM,WACNoI,MAAO,eACPojB,KAAM,OACNrT,OAAQ,CACN,CACE/P,MAAO,mCACPlF,MAAO,QACPiqC,SAAS,EACTi1H,SAAU,CAAC,QAAS,SAAU,SAAU,YAE1C,CACEh6J,MAAO,wCACPlF,MAAO,QACPiqC,SAAS,EACTi1H,SAAU,CAAC,WAAY,YAAa,YAAa,iBAIvD,CACEpiK,KAAM,cACNoI,MAAO,gBACPojB,KAAM,QACNrT,OAAQ,CACN,CACE/P,MAAO,IACPlF,MAAO,EACPiqC,QAAmB,IAAVwxH,GAEX,CACEv2J,MAAO,IACPlF,MAAO,EACPiqC,QAAmB,IAAVwxH,IAAgBA,GAE3B,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,GAEX,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,GAEX,CACEv2J,MAAO,KACPlF,MAAO,GACPiqC,QAAmB,KAAVwxH,KArDQniK,KAAKH,QAAQ44N,sBA0DjC,CACCj1N,KAAM,cACNoI,MAAO,QACPojB,KAAM,QACNrT,OAAQ,CACN,CACE/P,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,IAAiBA,GAE5B,CACE3sN,MAAO,OACPlF,MAAO,GACPiqC,QAAmB,KAAV4nL,GAEX,CACE3sN,MAAO,QACPlF,MAAO,IACPiqC,QAAmB,MAAV4nL,MAIjB7uN,OAAOkmC,SAEb,CAOAq8B,OACE/d,EACAruD,GAEA,MAAMkH,EAAS/G,KAAKq7N,2BAA2BntK,EAAMruD,GAAW,IAChE,OAAKkH,EAAO7G,IAAI,MAAS6G,EAAO7G,IAAI,SAGpCF,KAAKH,QAAQkH,OAAOgkB,KAAOhkB,EAAO7G,IAAI,SAAW,IAC1CF,KAAK24N,UAAUzqK,EAAMnnD,KAJc,EACjCnD,OAAG,GAId,CAMQ+0N,UACNzqK,EACAnnD,GAEA,OAAO/G,KAAKyB,KACTvB,IAAIF,KAAKupK,UAAW,CAAExiK,WACtBhD,QACC0c,KAAKuxE,GACHhyF,KAAK44N,eAAe5mI,EAAU9jC,IAGtC,CAEQmtK,2BACNntK,EACAruD,GAEA,OAAO,IAAIqvE,KAAW,CACpBC,WAAY5yD,MAAY+0D,gBACtB9qE,OAAO6H,OACL,CACE4qN,EAAGj5N,KAAKk5N,YAAYhrK,IAEtBluD,KAAK+G,OACL/G,KAAKg5N,oBAAoB9qK,EAAMruD,GAAW,IAAIkH,OAC9C,CACEgkB,KAAMlrB,EAAQkrB,SAKxB,CAMQmuM,YAAYhrK,GAClB,OAAOA,EAAKx1B,QAAQ,aAAc,IAAIA,QAAQ,8BAAyB,GACzE,CAOQsgM,oBACN9qK,EACAruD,GAEA,MAAM+lK,EAAWx/J,MAAM4jK,iBAAiB97G,EAAM,QAC9C,OAAI03G,IACF/lK,EAAQkH,OAASP,OAAO6H,OAAOxO,EAAQkH,QAAU,GAAI,CACnDvD,KAAMoiK,EAAS/7J,KAAK,QAIjBhK,CACT,CAEQ+4N,eACN5mI,EACA9jC,GAEA,OAAO8jC,EAASp+C,MAAMnzB,IAAKxc,GACzBjE,KAAK61N,aAAa5xN,EAAMiqD,EAAM8jC,GAElC,CAEQ6jI,aACN5xN,EACAiqD,EACA8jC,GAEA,MAAMtvC,EAAe1iD,KAAKs7N,oBAAoBr3N,GAExCya,EAAYza,EAAKw1N,UAAU7tN,OAAS3H,EAAKozB,WAAWzrB,MACpD2vN,EAAat3N,EAAKw1N,UAAU8B,YAAct3N,EAAKozB,WAAWkkM,WAC1DtF,EAAesF,EACjB,mCAAqCA,EAAa,WAClD,GAEJ,MAAO,CACL93M,OAAQzjB,KACRqe,KAAM,CACJ+9I,SAAUv1D,KACV30F,GAAI,CAAClS,KAAK48E,QAAS34E,EAAKozB,WAAWnlB,IAAIrI,KAAK,KAC5C+B,MAAO3H,EAAKozB,WAAWzrB,MACvB8S,UAAWA,EAAYu3M,EACvBtqN,KAA+B,UAAzB1H,EAAKozB,WAAW7zB,KAAmB,SAAW,MACpDgzN,MACEvyN,EAAKuyN,UACLztD,OAAsB76G,EAAKu6E,OAAQxkI,EAAKozB,WAAWrI,MACrDozI,SACEpwE,EAASp+C,MAAMhqC,QAAU5J,KAAKH,QAAQkH,OAAOo7J,OAAU,IACtDniK,KAAKH,QAAQkH,OAAOgkB,KAAO,IAEhC9mB,KAAMy+C,EAEV,CAEQ44K,oBAAoBr3N,GAC1B,MAAM1B,EAAM0B,EAAKozB,WAAW90B,IACtBq+C,EACJ5gD,KAAKw7N,gCAAgCj5N,GACvC,OAAOga,MAAY+0D,gBAAgB,CACjCxuB,cAAe,CACb5wC,GAAIjO,EAAKozB,WAAWnlB,GACpB1O,KAAMS,EAAKozB,WAAWM,OACtBp1B,MACAmuE,YAAa9vB,EAAY8vB,YACzBiJ,gBAAiB/4B,EAAY+4B,gBAC7B5yE,OAC6B,QAA3B9C,EAAKozB,WAAWM,OACZ,CAAE8+B,OAAQxyD,EAAKozB,WAAWrI,WAC1BhtB,EACNygD,MAC6B,QAA3Bx+C,EAAKozB,WAAWM,YAAmB31B,EAAYiC,EAAKozB,WAAWrI,KACjEqjD,yBAAyB,EACzByH,YAAa,aAEfluE,MAAO3H,EAAKozB,WAAWzrB,MACvB6lE,iBAAeC,OACbv2C,OAAOl3B,EAAKozB,WAAW8tF,gBAEzBvzC,iBAAeF,OACbv2C,OAAOl3B,EAAKozB,WAAW+tF,gBAEzB31C,SAAU,CACRltE,IAAK0B,EAAKozB,WAAWokM,YACrB1pJ,SAAQ9tE,EAAKozB,WAAWokM,kBAAqBz5N,EAC7C2tE,SAAU1rE,EAAKozB,WAAWs4C,eAAY3tE,GAExCq1B,WAAYr3B,KAAKo4N,UAAU1C,aAAazxN,GAAMozB,YAElD,CAEQmkM,gCAAgCj5N,GAItC,IAAImuE,EACAiJ,EACJ,MAAM+hJ,EAAa17N,KAAKH,QAAsC6wE,YAC9D,GAAIgrJ,EAAW,CACb,UAAWn1N,KAAOC,OAAOC,KAAKi1N,GAAY,CACxC,MAAMh1N,EAAQg1N,EAAUn1N,GACxB,GAAc,MAAVG,EAAe,CACjBgqE,EAAcW,MAAY9qE,EAAI6oE,eAC9B,KACF,CAEA,MAAMusJ,EAAQj1N,EAAoCi1N,KAClD,GAAIpgN,MAAMC,QAAQmgN,GAAO,CACvBA,EAAKphN,QAASqhN,MACgB,IAAxBr5N,EAAImG,QAAQkzN,MACdlrJ,EAAcW,MAAY9qE,EAAI6oE,eAAa,GAG/C,KACF,CACF,EAGEsB,IAAgBW,MAAYn0D,MAC5BwzD,IAAgBW,MAAY0/E,YAE5Bp3E,EAAkB,SAEtB,CAEA,MAAO,CACLjJ,cACAiJ,kBAEJ,4CA9UWyhJ,IAAkBh6N,MAAAwE,MAAAxE,MAAAuE,MAAAvE,MAAAyE,OAAAzE,MAcnB,WAASA,MACT65N,IAA2B,iCAf1BG,GAAkB/5N,QAAlB+5N,GAAkB95N,YC1DzB,SAAUu6N,GACdl6N,GAEA,OAAO,IAAIs5N,GAA4Bt5N,EACzC,EDqNU8gC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAAmG,OAGQylC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAUkhN,GAAA9gN,UAAA,kBEjMR,IAAM+gN,GAAe,MAAtB,MAAOA,EAIX,cAAOhjN,GACL,MAAO,CACLC,SAAU+iN,EACVvxN,UAAW,CACTu9J,KACAitD,KACA4F,KNxBC,CACLnwN,QAASgrN,GACT9tL,WAAYwvL,GACZtvL,KAAM,CAAC28B,OKNF,CACL/5D,QAASwwN,GACTtzL,WAAYk0L,GACZh0L,KAAM,CAAC28B,QC6BT,4CAfWu3J,EAAe,8BAAfA,qCAdTpH,GACAE,GACAD,GACAE,GAIAH,GACAE,GACAD,GACAE,aAISiH,CAAe,KCpCG,IAAIp4J,MACjC,6ECCMviE,MAAA,GAEIA,MADF,SACEA,CADI,gBACkCA,MAAA,uBAAiBA,QACvDA,MAAA,wBACFA,QAEAA,MAAA,oCAEEA,MAAA,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAAekK,EAAA0wN,kBAAAvkN,GAAyB,GACzCrW,sBANCA,MAAA,GAAAA,MAAA,IAAAA,MAAA,gCCqCL,IAAM66N,GAAwB,MAA/B,MAAOA,EAqBFrkN,UACC4d,YACwBvxB,KAtBzB86L,aAAuB,EAEzB5+J,KAEA6+J,eACAC,eAECi9B,cAEAC,cAAgC,CACtCxtD,UAAW,wBACXC,YAAa,mBAGf,gBAAIznD,GACF,MAAMhxG,EAAQnW,KAAKiE,KAAKw+C,MAAMpB,GAAG+uB,WACjC,OAAOj6D,aAAiBulB,cAAW15B,EAAamU,EAAkBnO,OACpE,CAEAjI,YACS6X,EACC4d,EACwBvxB,GAFzBjE,KAAA4X,YACC5X,KAAAw1B,cACwBx1B,KAAAiE,MAC/B,CAEHsJ,WACEvN,KAAKi/L,gBAAiB,EACtB,UAAWn0L,KAAW9K,KAAKiE,KAAKw+C,MAAMpB,GAAGsC,YAAYQ,cACV,eAArCr5C,EAAQqiF,eAAe8U,YACzBjiG,KAAKi/L,gBAAiB,GAG1Bj/L,KAAKk/L,iBACLl/L,KAAK0pD,WACP,CAEQA,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCu6C,KAAM,CAACx7E,KAAKo8N,qBACZhhJ,OAAQ,CAACp7E,KAAKq8N,wBAElB,CAEQn9B,iBACNl/L,KAAKg/L,eAAiB,CACpBrwB,UAAW3uK,KAAKo8N,oBAChBxtD,YAAa5uK,KAAKq8N,uBAEpBr8N,KAAKk8N,cAAgB,CACnBvtD,UAAW3uK,KAAKo8N,oBAChBxtD,YAAa5uK,KAAKq8N,sBAEtB,CAEQD,oBACN,IAAIztD,EAAY3uK,KAAKm8N,cAAcxtD,UACnC,MAAMx4J,EAAQnW,KAAKmnH,aACnB,GAAIhxG,GAAOixG,WAAWC,WAAY,CAChC,MAAMi1G,EAAanmN,EAAMixG,UAAUC,WACnCsnD,EAAY,QAAQ2tD,EAAW,MAAMA,EAAW,MAAMA,EAAW,MAC/DA,EAAW,IAAM,KAErB,CACA,OAAO3tD,CACT,CAEQ0tD,sBACN,IAAIztD,EAAc5uK,KAAKm8N,cAAcvtD,YACrC,MAAMz4J,EAAQnW,KAAKmnH,aACnB,GAAIhxG,GAAOmxG,aAAaD,WAAY,CAClC,MAAMi1G,EAAanmN,EAAMmxG,YAAYD,WACrCunD,EAAc,QAAQ0tD,EAAW,MAAMA,EAAW,MAAMA,EAAW,MACjEA,EAAW,IAAM,IAErB,CACA,OAAO1tD,CACT,CAEAotD,kBAAkBtyM,GAChB,MAAM6yM,KAAMh0G,OAAa7+F,GACnB9N,EAAI5b,KAAKmnH,aAAan/G,QAC3B4T,EAAE4lG,WAAmB4F,UAAUyB,SAAS0zG,GACzC3gN,EAAEwrG,UAAUyB,SAAS0zG,GACrBv8N,KAAKiE,KAAKw+C,MAAMpB,GAAG4iD,SAASroF,GAC5B5b,KAAKg/L,eAAerwB,UAAYjlJ,CAClC,CAEA8yM,oBAAoB9yM,GAClB,MAAM6yM,KAAMh0G,OAAa7+F,GACnB9N,EAAI5b,KAAKmnH,aAAan/G,QAC3B4T,EAAE4lG,WAAmB8F,YAAYuB,SAAS0zG,GAC3C3gN,EAAE0rG,YAAYuB,SAAS0zG,GACvBv8N,KAAKiE,KAAKw+C,MAAMpB,GAAG4iD,SAASroF,GAC5B5b,KAAKg/L,eAAepwB,YAAcllJ,CACpC,CAEA0b,SACEplC,KAAK4X,UAAUK,QACfjY,KAAKg8N,kBAAkBh8N,KAAKk8N,cAAcvtD,WAC1C3uK,KAAKw8N,oBAAoBx8N,KAAKk8N,cAActtD,YAC9C,CAEA/vG,UACE7+D,KAAK++L,aAAc,EACf/+L,KAAKmgC,KAAKjgC,IAAI,QAAQwG,QACxB1G,KAAKg/L,eAAerwB,UAAY3uK,KAAKmgC,KAAKjgC,IAAI,QAAQwG,OAGpD1G,KAAKmgC,KAAKjgC,IAAI,UAAUwG,QAC1B1G,KAAKg/L,eAAepwB,YAAc5uK,KAAKmgC,KAAKjgC,IAAI,UAAUwG,OAE5D1G,KAAK4X,UAAUK,MAAMjY,KAAKg/L,eAC5B,CAEAY,aACE5/L,KAAK4X,UAAUe,cAAe,CAChC,CAEAknL,cACE7/L,KAAK4X,UAAUe,cAAe,CAChC,4CAzHWsjN,GAAwB76N,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAuBzBglC,OAAe,+BAvBd61L,EAAwB3tN,UAAA,4BAAAC,OAAA,CAAAwwL,YAAA,eAAAtwL,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0WAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID/CrC1N,MAAA,UACEA,MAAA,wBACFA,QAIMA,MAHN,UAGMA,CAHkB,UAGlBA,CAF0B,WAE1BA,CADwC,WAEtCA,MAAA,EAAAq7N,GAAA,sBAaEr7N,MADF,SACEA,CADI,gBACkCA,MAAA,mBAAYA,QAClDA,MAAA,0BACFA,QACAA,MAAA,oCAEEA,MAAA,uBAAAqW,GAAA,OAAe1I,EAAAytN,oBAAA/kN,EAA2B,GAKpDrW,gBAEEA,MADF,WACEA,CADsB,eACIA,MAAA,0BAAS2N,EAAAq2B,QAAQ,GACzChkC,MAAA,0BACFA,QACAA,MAAA,gBAA0CA,MAAA,0BAAS2N,EAAA8vD,SAAS,GAAEz9D,MAAA,SAChEA,iBAnCEA,cAAA,IAAAA,MAAA,sCAIyBA,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,MAEJ/+B,MAAA,GAAAA,MAAA,YAAA2N,EAAAkwL,gBAcb79L,MAAA,GAAAA,MAAA,IAAAA,MAAA,kCAYNA,MAAA,GAAAA,MAAA,IAAAA,MAAA,kDCEA8W,MACAC,MACAskB,KAAW72B,eACX23B,KAAmB33B,UACnBuJ,KACAK,KAAa3J,KACbk2L,GACA3jL,MACA7I,KAAezJ,KACf6J,KAAiB5J,MAAA8J,OAAA,mhBAGRosN,CAAwB,KC3BxBS,GAA8B,MAArC,MAAOA,EAESpkN,OADXmqC,MACT1iD,YAAoBuY,GAAAtY,KAAAsY,QAAoB,CAKxCysL,uBACEpmK,WAAW,KAGS3+B,KAAKsY,OAAOC,KAAK0jN,GAA0B,CAC3DtjN,cAAc,EACd1U,KAH+B,CAAEw+C,MAAOziD,KAAKyiD,OAI7CkkJ,WAAW,GACZ,EACA,IACL,4CAjBW+1B,GAA8Bt7N,MAAAuE,OAAA,+BAA9B+2N,EAA8BpuN,UAAA,mCAAAC,OAAA,CAAAk0C,MAAA,SAAAh0C,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mFAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICpB3C1N,MAAA,mCAGEA,MAAA,0BAAS2N,EAAAg2L,sBAAsB,GAG/B3jM,MAAA,gBAA6BA,MAAA,cAC/BA,gBAHEA,MAAA,aAAAA,MAAA,4DDcUmO,KAAe3J,KAAEyJ,KAAgBxJ,KAAE2J,KAAa1J,KAAE6J,KAAiB5J,MAAA+J,gBAAA,WAElE4sN,CAA8B,uCEIpC,IAAMC,GAAkB,MAAzB,MAAOA,EAeS5qN,MAdX0wC,MAEAhiC,IAKC6oB,SAAW,IAAIh8B,MAKf83B,OAAS,IAAI93B,MAEvBvN,YAAoBgS,GAAA/R,KAAA+R,OAA2B,CAK/CgJ,iBACE/a,KAAK+R,MAAM4K,eACb,CAKA0/D,UACEr8E,KAAKolC,OAAOh3B,MACd,4CA7BWuuN,GAAkBv7N,aAAA,+BAAlBu7N,EAAkBruN,UAAA,qBAAAC,OAAA,CAAAk0C,MAAA,QAAAhiC,IAAA,OAAAjS,QAAA,CAAA86B,SAAA,WAAAlE,OAAA,UAAA32B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,8CAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCxB/B1N,MAAA,oCAIEA,MAFA,QAAA2N,EAAA0zC,MAEArhD,CAFe,YAEfA,CADgB,MAAA2N,EAAA0R,oBDmBNk2K,IAA0B7mL,gBAAA,WAEzB6sN,CAAkB,KEblBC,GAAkB,MAAzB,MAAOA,+CAAkB,8BAAlBA,qCAHDD,aAGCC,CAAkB,KCLxB,MAAMC,GAAkB,IAAIl5J,MAAuB,mBAEpD,SAAUm5J,GAAuBC,GACrC,OAAOA,EAAchhN,OAAO4gN,GAC9B,CAEM,SAAUK,KACd,MAAO,CACLvyN,QAASoyN,GACTl1L,WAAYm1L,GACZj1L,KAAM,CAAC4R,OAEX,CCPO,IAAMwjL,GAA0B,MAAjC,MAAOA,+CAA0B,8BAA1BA,uCAA0B,KCQ1BC,GAAqB,MAA5B,MAAOA,+CAAqB,8BAArBA,sCAFA,CAACF,MAAyB/jN,QAAA,CANnC2gC,MACAgjL,GACAK,GACAv2L,MAEQk2L,aAGCM,CAAqB,iCCbtBC,GAAZ,SAAYA,GACVA,SAAA3tJ,MAAA,QACA2tJ,EAAAC,MAAA,QAFUD,CAGZ,CAHA,CAAYA,IAAe,IAKfE,GAAZ,SAAYA,GACVA,WAAAzwJ,IAAA,SACAywJ,IAAAxwJ,KAAA,UACAwwJ,IAAAC,WAAA,gBACAD,IAAAvwJ,WAAA,gBACAuwJ,IAAArwJ,eAAA,oBACAqwJ,IAAAtwJ,gBAAA,qBACAswJ,IAAAE,UAAA,eAPUF,CAQZ,CARA,CAAYA,IAAW,ICHjB,MAAgBG,GACpBtrN,GACAtG,MACArJ,IACAswN,UACA4K,iBACA9tJ,SACA+tJ,iBACA9pL,MACApwC,KACAozD,QACA+mK,UACAC,gBACAC,WACAC,YACAC,eACAhuJ,WACAW,YACAiJ,gBACA/4B,YACAkC,cACAjhC,MACAm8M,YACAC,cACAC,wBACAC,WACA3rK,QAEAzyD,YAAYF,GACV2G,OAAO6H,OAAOrO,KAAMH,EACtB,EC3BI,MAAOu+N,WAAmBZ,GAGpBa,oBAFVt+N,YACEF,EACQw+N,GAERj4N,MAAMvG,GAFEG,KAAAq+N,sBAIRr+N,KAAKwD,KAAO65N,GADUA,GAAYA,GAAYzwJ,KAEhD,CAEO0xJ,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,EAGI,MAAOu+N,WAAoBf,GAGrBa,oBAFVt+N,YACEF,EACQw+N,GAERj4N,MAAMvG,GAFEG,KAAAq+N,sBAIRr+N,KAAKwD,KAAO65N,GADUA,GAAYA,GAAYxwJ,MAEhD,CAEOyxJ,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,EAGI,MAAOw+N,WAA0BhB,GAG3Ba,oBAFVt+N,YACEF,EACQw+N,GAERj4N,MAAMvG,GAFEG,KAAAq+N,sBAIRr+N,KAAKwD,KAAO65N,GADUA,GAAYA,GAAYC,YAEhD,CAEOgB,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,EAGI,MAAOy+N,WAA0BjB,GAG3Ba,oBAFVt+N,YACEF,EACQw+N,GAERj4N,MAAMvG,GAFEG,KAAAq+N,sBAIRr+N,KAAKwD,KAAO65N,GADUA,GAAYA,GAAYvwJ,YAEhD,CAEOwxJ,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,EAGI,MAAO0+N,WAAqClB,GAGvCa,oBAFTt+N,YACEF,EACOw+N,EACPM,GAEAv4N,MAAMvG,GAHCG,KAAAq+N,sBAIPr+N,KAAKwD,KAAO65N,GAAYA,GAAYsB,GACtC,CAEOL,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,EAGI,MAAO4+N,WAAyBpB,GAK1Ba,oBAFVt+N,YACEF,EACQw+N,GAERj4N,MAAMvG,GAFEG,KAAAq+N,sBAIRr+N,KAAKwD,KAAO65N,GADUA,GAAYA,GAAYE,YAE9Cv9N,KAAKuC,IAAM,IACb,CAEO+7N,sBACL,OAAOt+N,KAAKq+N,oBAAoBr+N,KAClC,ECrDK,IAAM6+N,GAAc,MAArB,MAAOA,EAEDp9N,KACAxB,OACA0B,gBACAC,eACA8yE,oBALV30E,YACU0B,EACAxB,EACA0B,EACAC,EACA8yE,GAJA10E,KAAAyB,OACAzB,KAAAC,SACAD,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAA00E,qBACP,CAEHoqJ,eACE,MAAMC,EAAgB/+N,KAAKC,OAAOG,UAAU,YAAc,GAEpD4+N,EACJh/N,KAAKC,OAAOG,UAAU,YAAc,GAChC6+N,EAASD,EAAcz8N,KAAOw8N,EAAcx8N,IAC5C28N,EAAqBF,EAAclwI,SAAW,GAE9ChsE,EAAe,GAErB,GAAIm8M,EAAQ,CACV,GAAID,EAAc1B,WAAY,CAG5B,MAAM6B,GAAoB,CACxB,CACEjtN,GAAI,qBACJtG,MALc5L,KAAK2B,gBAAgB4pB,UACfshB,QAAQ,8BAK5BtqC,IAAK,GAAG08N,eACRz7N,KAAM,eAGVsf,EAAaxb,QAAK1D,OAAGu7N,IACvB,CAGA,MAAMC,EAAmBp/N,KAAKyB,KAC3BvB,IAAe,GAAG++N,cAClBl7N,QACC0c,KAAK4+M,IACHA,GAAS5+M,IAAKuZ,IAAWxzB,OAAO6H,OAAO2rB,GAAGA,GAAEn6B,YAAS,EAEvDqE,MAAYo7N,IAAiC39D,OAEjD7+I,EAAaxb,KAAK83N,EACpB,CAGA,OAAIF,EAAmBt1N,OAAS,GAC9BkZ,EAAaxb,QACX1D,OAAGs7N,GAAoBn7N,QACrB0c,KAAK4+M,GACHA,EAAS5+M,IAAKuZ,KACPA,GAAE9nB,KACL8nB,GAAE9nB,MAAKyQ,UAEFqX,SAGZ,EAIEitF,SAAOnkG,GAAc/e,QAC1B0c,KAAK4+M,GAA0B,GAAG1+M,OAAOu1E,MAAM,GAAImpI,IAEvD,CAEAE,iBAAiBC,GACf,IAAIC,EACJA,SAAaC,GAAeC,sBAAsBH,EAASx/N,MACpDy/N,EAAWnB,qBACpB,CAEAsB,0BAA0BJ,GACxB,OAAOx/N,KAAK6/N,4BAA4BL,GAASz7N,QAC/C0c,KAAK+/F,IACH,MAAM5sE,EAAQ4sE,EAAc//F,IAAKiiC,KAE7BxwC,MAAIulE,OAA4B/0B,EAAaI,eAC7Cl3C,MAAO82C,EAAa92C,MACpBpI,KAAM25N,GAAgB3tJ,MACtBiuJ,iBAAkB+B,EAAQ/B,iBAC1B59N,QAAS6iD,KAGb,MAAO,CACL,CACExwC,GAAI,2BACJ1O,KAAM25N,GAAgBC,MACtBK,iBAAkB+B,EAAQ/B,iBAC1B7xN,MAAO4zN,EAAQ5zN,MACfgoC,SACD,GAIT,CAEQisL,4BACNL,GAEA,OAAOx/N,KAAKyB,KAAKvB,IAAoBs/N,EAAQj9N,IAC/C,CAEAu9N,yBAAyBN,GACvB,OAAOx/N,KAAK+/N,uBAAuBP,GAASz7N,QAC1C0c,KAAKqtD,IACH,MAAMl6B,EAAuB,GAC7B,IAAKk6B,EACH,OAAOl6B,EAGPk6B,EAAakyJ,SACblyJ,EAAakyJ,QAAQpwJ,UACrB9B,EAAakyJ,QAAQpwJ,SAAShmE,SAE9B41N,EAAQ7vJ,SAAW7B,EAAakyJ,QAAQpwJ,UAE1C,MAAMqwJ,EAAc,GACpBjgO,KAAKkgO,uBACHpyJ,EAAayB,WAAWC,MACxB,EACAywJ,EACAT,EAAQzB,gBAEV,MAAMoC,EAA8B35N,OAAO6H,OACzC,GACAy/D,EAAayB,WAAWC,OAE1B2wJ,SAA4B3wJ,MAAQywJ,EAAYv2N,OAC7Cy8B,GAAyB,IAAnBA,EAAEqpC,MAAM5lE,QAEjB5J,KAAKogO,sBAAsBZ,EAASW,EAA6BvsL,GAC1DA,KACR,EACD1vC,MAAW,KACTlE,KAAK4B,eAAewC,MAClB,8BACA,wCACApC,EACA,CAAE0E,MAAO84N,EAAQ5zN,QAEZ+1J,OAGb,CAEAu+D,uBAAuB/mL,EAAQm4D,EAAQ,EAAG2uH,EAAav+I,EAAY,OACjE,IAAKu+I,EAAYjoM,SAASmhB,EAAOq4B,OAAQ,CACvC,MAAM6uJ,EAAiB75N,OAAO6H,OAAO,GAAI8qC,GACzCknL,EAAe7wJ,MAAQ,GACvBywJ,EAAY34N,KAAK+4N,EACnB,CACA,UAAW59K,KAAStJ,EAAOq2B,MAAO,CAChC,MAAM8wJ,EAAgB95N,OAAO6H,OAAO,GAAIo0C,GACpC6uD,EAAQ,IACVgvH,EAAc9uJ,MAAQr4B,EAAOq4B,MAAQkQ,EAAYj/B,EAAM+uB,OAErD/uB,EAAM+sB,MACRxvE,KAAKkgO,uBACHI,EACAhvH,EAAQ,EACR2uH,EACAv+I,GAGFu+I,EAAY79M,KAAMm+M,IAAOA,GAAG/uJ,QAAUr4B,EAAOq4B,OAAOhC,MAAMloE,KAAKm7C,EAEnE,CACF,CAEA+9K,0BAA0BhB,GACxB,OAAOx/N,KAAK+/N,uBAAuBP,GAASz7N,QAC1C0c,KAAKqtD,GAAsB9tE,KAAKygO,aAAajB,EAAS1xJ,IAE1D,CAEA4yJ,2BAA2BlB,GACzB,OAAOx/N,KAAK+/N,uBAAuBP,GAASz7N,QAC1C0c,KAAKqtD,GACI9tE,KAAK2gO,mBAAmBnB,EAAS1xJ,IAG9C,CAEA8yJ,+BAA+BpB,GAC7B,MAAMqB,EAAoBrB,EAA6BjC,UAEjDuD,EAAuB,GAC7BD,EAAiBpgN,IAAKrE,KACpBA,GAAU6hN,cAAgBuB,EAAQvB,cAClC6C,EAAqBx5N,KACnBo4N,GAAeC,sBAAsBvjN,GAAWpc,MAAK,GAKzD,MAAM+gO,EAAY,GAClBD,EAAqBrgN,IAAKrE,IACxB2kN,EAAUz5N,KAAK8U,GAAUkiN,wBAI3B,IAAI0C,EAAY,GAEhB,SAASC,EAAchqC,IACrB,OAAOA,GAAI/2K,OACT,CAACC,GAAKy7H,KACJz7H,GAAIQ,OACFi7H,GAAIp4I,OAAS25N,GAAgBC,MAAQ6D,EAAcrlF,GAAIhoG,OAASgoG,IAEpE,GAEJ,CAEA,GACEp1I,OAAOC,KAAKo6N,GAAkBz+M,KAAM4jB,IAAM66L,EAAiB76L,IAAG83L,aAC9D,CACA,MAAMoD,GAAkBA,CAACrpM,GAAM5Y,MAC7B,MAAM+a,GAAI8mM,EAAqB7hN,IACzBkiN,GAAiB36N,OAAO6H,OAAO,GAAI2rB,GAAE8jM,aAC3CqD,GAAeC,QAAUpnM,GAAE9nB,GAC3BivN,GAAe39N,KAAO25N,GAAgBC,MACtC+D,GAAe1D,iBAAmBzjM,GAAEyjM,sBACCz7N,IAAjCm/N,GAAelD,gBACjBkD,GAAelD,cAAgBjkM,GAAEikM,eAEnCkD,GAAevtL,MAAQ,GAEvB,MAAMytL,GAAYJ,EAAcppM,IAChCwpM,UAAU5gN,IACPpH,IAAOA,GAAE+nN,QAAU,GAAGD,GAAeC,WAAWD,GAAejvN,MAElEivN,GAAevtL,MAAQytL,GAEhBF,IAGTH,EAAYD,EAAUtgN,IAAI,CAAC6gN,GAAKnjG,KAC9BmjG,GAAIv9N,QACF0c,KAAKmzB,IACHitL,EAAiB1iG,IAAK2/F,YAClBoD,GAAgBttL,GAAOuqF,IACvBvqF,KAIZ,MACEotL,EAAYD,EAId,MAAMQ,MAAYt6G,SAAO+5G,GAAWj9N,QAClC0c,KACG+gN,IAA0B,GAAG7gN,UAAU6gN,MAuBtCC,GAA+BA,CAAC7tL,GAAO8tL,KAC3C9tL,GAAM1zB,OAAO,CAACC,GAAK0X,GAAMsmG,GAAK84D,MAC5B,MAAMt6B,GAAa+kE,GAAM7pM,IACnB8pM,GAAUn7N,OAAO6H,OAAO,GAAIwpB,IAElC,GAAIA,GAAKr0B,OAAS25N,GAAgB3tJ,MAAO,CAIvC,MAAMoyJ,GAAoB,GACpBC,GAA6B,GAYnC,GAXoB5qC,GAAIvtL,OAAO,CAACqqE,GAAG3kC,MACjC,IAAI0yL,IAAO,EACX,OAAI/tJ,GAAEnoE,QAAU+wJ,IAAc5oF,GAAEvwE,OAAS25N,GAAgB3tJ,QACnDpgC,KAAM+uF,IAAOpqD,GAAEqtJ,UAAYvpM,GAAKupM,UAClCU,IAAO,GAETF,GAAkBt6N,KAAK8nC,KAElB0yL,KAGOl4N,OAAS,EAAG,CAC1B,IAAIm4N,GAAYH,GAAkB5sL,UAAW++B,IAAMA,KAAMoqD,IAAO,EAChEwjG,GAAQ/1N,MAAQ,GAAGisB,GAAKjsB,UAAUm2N,MAClCA,GACEF,GAA2B7sL,UAAW++B,IAAMA,KAAMoqD,IAAO,EAC3DwjG,GAAQK,eAAiB,GAAGnqM,GAAKmqM,mBAAmBD,KACtD,CAEc5hN,GAAIiC,KACf2xD,IAAMA,GAAEnoE,QAAU+1N,GAAQ/1N,OAASmoE,GAAEvwE,OAAS25N,GAAgB3tJ,SAG/DrvD,GAAIA,GAAIvW,QAAU+3N,GAEtB,MAAW9pM,GAAKr0B,OAAS25N,GAAgBC,QACvCuE,GAAQ/tL,MAAQ6tL,GACd5pM,GAAK+b,MACJ6O,IAAUA,GAAM72C,OAEnBuU,GAAIA,GAAIvW,QAAU+3N,IAGpB,OAAOxhN,IACN,IAQL,OANkBohN,GAAUx9N,QAC1B0c,KAAK+gN,IAlEgBS,EAACh+N,GAAMy9N,KAC5Bz9N,GAAKic,OAAO,CAACC,GAAK8gB,MAChB,MAAMihM,GAgEgCjhM,KAAUA,GAAM/uB,GAhEtCwvN,CAAMzgM,IAChBkhM,GAAMhiN,GAAIiC,KAAM2xD,IAAMA,GAAE7hE,KAAOgwN,IAErC,GAAKC,GAEE,CACL,MAAMC,GAAKjiN,GAAIzX,QAAQy5N,KACmC,IAAtDhiN,GAAIiiN,IAAIhB,QAAQ93N,MAAM,KAAKZ,QAAQu4B,GAAMmgM,WAC3CjhN,GAAIiiN,IAAIhB,QAAU,GAAGjhN,GAAIiiN,IAAIhB,WAAWngM,GAAMmgM,WAEhDjhN,GAAIiiN,IAAIxuL,MAAMtsC,QAAQ25B,GAAM2S,MAC9B,MAPEzzB,GAAIA,GAAIvW,QAAUq3B,GAQpB,OAAO9gB,IACN,IAmDa8hN,CAAeT,MAA4B,EAC3D/gN,KAAK+gN,IAAW,GAAG7gN,UAAU6gN,MAAO,EACpC/gN,KAAKxc,IAASw9N,GAA6Bx9N,GAAOw+C,IAAUA,GAAM72C,QAItE,CAEQm0N,uBAAuBP,GAE7B,OAAOx/N,KAAK00E,oBACT7G,gBAFmBwvJ,GAAYmC,EAAQh8N,MAETg8N,EAAQj9N,IAAKi9N,EAAQ5oK,SACnD7yD,QACCG,MAAYynC,IACV3rC,KAAK4B,eAAewC,MAClBo7N,EAAQ5zN,MACJ,8BACA,kCACJ,wCACA5J,EACAw9N,EAAQ5zN,MAAQ,CAAElF,MAAO84N,EAAQ5zN,YAAU5J,GAE7CkhE,QAAQ9+D,MAAMunC,IAAC,EACR/nC,YAAG5B,KAGlB,CAEQqgO,wBACNC,EACA5E,GAEA,IAAKA,GAAgD,IAA5BA,EAAiB9zN,OACxC,OAEF,MAAM24N,EAAiC,CACrCvuJ,UAAWsuJ,EACX12N,WAAO5J,EACPy5N,iBAAaz5N,EACbwgO,sBAAkBxgO,EAClBygO,yBAAqBzgO,EACrB0gO,oBAAgB1gO,GAIZ2gO,EAA+BjF,EAAiBt7M,KACnD+jB,GAAsB,MAAhBA,EAAE6tC,WAEX,OAAI2uJ,IAEEA,EAA6BF,sBAC/BF,EAAeE,oBACbE,EAA6BF,qBAG7BE,EAA6BD,iBAC/BH,EAAeG,eACbC,EAA6BD,iBAGnChF,EAAiBj9M,IAAKmiN,IAEhBN,IAAyBM,EAAe5uJ,YAEtC4uJ,EAAeh3N,QACjB22N,EAAe32N,MAAQg3N,EAAeh3N,OAGpCg3N,EAAenH,cACjB8G,EAAe9G,YAAcmH,EAAenH,aAG1CmH,EAAeJ,mBACjBD,EAAeC,iBAAmBI,EAAeJ,qBAIhDD,CACT,CAIQM,wBAAwBpgL,EAAOqgL,EAAUC,EAAmBvD,GAClE,MAAMwD,EAAwBhjO,KAAKijO,wBACjCxgL,EAAMyxB,KACN6uJ,GAGI7yJ,EACJsvJ,EAAQrB,YAAc17K,EAAM0tB,MACxBnwE,KAAK00E,oBAAoBtE,SAAS3tB,EAAM0tB,YACxCnuE,EAEA+E,GAASP,OAAO6H,OAAO,GAAImxN,EAAQ5+K,YAAa,CACpD6V,OAAQhU,EAAMyxB,KACdxd,QAAS8oK,EAAQ5oK,UAGbssK,GAAoB,CACxB1/N,KAAM,MACNjB,IAAKi9N,EAAQj9N,IACbu3E,YAAa0lJ,EAAQtB,wBAA0B,iBAAcl8N,EAC7D0uE,YAAasyJ,EACbrpJ,gBACEqpJ,IAA0B3xJ,MAAYn0D,MACtC8lN,IAA0B3xJ,MAAY0/E,SAClC,cACA/uJ,EACNqwE,yBAAyB,GAGrBvvB,GAAgBt8C,OAAO6H,OAC3B,GACA60N,GACA1D,EAAQ18K,cACR,CAAE/7C,YAGEo8N,GAAoBnjO,KAAKqiO,wBAC7B5/K,EAAMyxB,KACNsrJ,EAAQ9B,kBAEV,IAAI0F,GACArxJ,IAAS,EACTtvB,EAAMmtB,SACRwzJ,GAAe3gL,EAAMmtB,UACXntB,EAAMmtB,UAAY4vJ,EAAQ7vJ,WACpCyzJ,GAAe5D,EAAQ7vJ,UAEzB,MAAM0zJ,GACJ5gL,GAAOitB,SAAWjtB,GAAOitB,QAAQ9lE,OAAS,EACtC64C,GAAOitB,QAAQ,GAAGoC,oBAClB9vE,EAEN,IAAIy5N,GACF0H,IAAmB1H,aACnB0H,IAAmBT,gBACnBW,GACEb,GACFW,IAAmBX,kBACnBW,IAAmBV,qBACnBW,IAGCD,IAAmB1H,cACnB0H,IAAmBT,iBACnBS,IAAmBX,kBAClBW,IAAmBV,uBAErB1wJ,IAAS,GAGToxJ,IAAmBX,kBACnBW,IAAmBT,iBAEnB3wJ,IAAS,GAGX,MAAMuxJ,GAAe,CACnBpxN,MAAIulE,OAA4B30B,IAChCt/C,KAAM25N,GAAgB3tJ,MACtB5jE,MAAOu3N,IAAmBv3N,MAAQu3N,GAAkBv3N,MAAQ62C,EAAM+uB,MAClE4vJ,QAAS0B,EACTrF,iBAAkB+B,EAAQ/B,mBAAoB,EAC9C59N,QAAS,CACP4xE,iBAAeC,OAAuBjvB,EAAMkvB,qBAC5CC,iBAAeF,OAAuBjvB,EAAMovB,qBAC5CpC,SAAU,CACRltE,IAAKk5N,GACL1pJ,UACApC,SAAU6yJ,GACVh/N,KAAM0/N,GAAkB1/N,MAE1B0sE,gBACAriE,QAAS,CAAErK,KAAMg8N,EAAQxB,aACzBl7K,mBAIJ,OAAOvmC,MAAY+0D,gBAAgBgyJ,GACrC,CAEQC,wBACNC,EACAC,EACAC,EACAX,EACAvD,GAyCA,MAvCqB,CACnBttN,GAAIwxN,EACJlgO,KAAM25N,GAAgBC,MACtBxxN,MAAO43N,EAAWhyJ,MAClB4vJ,QAAS5B,EAAQttN,GACjBurN,iBAAkB+B,EAAQ/B,mBAAoB,EAC9CQ,cAAeuB,EAAQvB,cACvBrqL,MAAO4vL,EAAWh0J,MAAMtvD,OAAO,CAAC0zB,GAAsB6O,MACpD,QAAoBzgD,IAAhBygD,GAAM+sB,MAAqB,CAE7B,MAEMm0J,GAA8B3jO,KAAKujO,wBACvC9gL,GACAghL,EAHAC,EAAU,UAAUjhL,GAAMyxB,MAAQzxB,GAAM+sB,MAAM,GAAG0E,OAKjD6uJ,EACAvD,GAGF5rL,GAAMtsC,KAAKq8N,GACb,KAAO,CACL,IAAmD,IAA/C3jO,KAAK4jO,iBAAiBnhL,GAAMyxB,KAAMuvJ,GACpC,OAAO7vL,GAGT,MAAMiwL,GACJ7jO,KAAK6iO,wBACHpgL,GACAihL,EACAX,EACAvD,GAGJ5rL,GAAMtsC,KAAKu8N,GACb,CACA,OAAOjwL,IACN,IAGP,CAEQwsL,sBACNZ,EACAgE,EACAM,EACAC,EAAoB,GAGpB,MAAMN,GAAWjE,EAAQ3B,YAAc,IAAIp9M,IACxCivF,GAAoB,IAAI1lG,OAAO0lG,IAElC,GAAK8zH,EAAWh0J,MAIhB,UAAW33C,KAAQ2rM,EAAWh0J,MAAO,CACnC,QAAmBxtE,IAAf61B,EAAK23C,MAAqB,CAE5BxvE,KAAKogO,sBAAsBZ,EAAS3nM,EAAMisM,EAAcC,EAAY,GACpE,QACF,CAEA,MAAMhB,GAAoB/iO,KAAKgkO,sBAAsBxE,GAGrD,GAAkB,IAAduE,EAAiB,CAGnB,MACMJ,GAAY3jO,KAAKujO,wBACrBC,EACAC,EAHkB,iBAAiBD,EAAWtvJ,MAAQr8C,EAAKq8C,OAK3D6uJ,GACAvD,GAG6B,IAA3BmE,GAAU/vL,MAAMhqC,QAClBk6N,EAAax8N,KAAKq8N,IAIpB,KACF,KAEoD,IAA9C3jO,KAAK4jO,iBAAiB/rM,EAAKq8C,KAAMuvJ,GAAoB,CACvD,MAAMI,GAAY7jO,KAAK6iO,wBACrBhrM,EACA2nM,EAAQttN,GACR6wN,GACAvD,GAEFsE,EAAax8N,KAAKu8N,GACpB,CAEJ,CACF,CAIQpD,aACNjB,EACA1xJ,GAEA,IAAKA,EACH,MAAO,GAET,MAAMhuB,EAASguB,EAAaqE,SAAS3C,MAC/Bi0J,GAAWjE,EAAQ3B,YAAc,IAAIp9M,IACxCivF,GAAoB,IAAI1lG,OAAO0lG,IAGlC,OACE5hC,EAAam2J,uBACbn2J,EAAam2J,sBAAsBr0J,UACnC9B,EAAam2J,sBAAsBr0J,SAAShmE,SAE5C41N,EAAQ7vJ,SAAW7B,EAAam2J,sBAAsBr0J,UAGjD9vB,EACJr/B,IAAKgiC,IACJ,MAAM0gL,EAAoBnjO,KAAKqiO,wBAC7B5/K,EAAM+uB,MACNguJ,EAAQ9B,kBAEV,IAAI3rJ,IAAS,EAET0pJ,GACF0H,GAAmB1H,aAAe0H,GAAmBT,eACnDF,GACFW,GAAmBX,kBACnBW,GAAmBV,qBACnBjD,EAAQ7vJ,SAiBV,IAdGwzJ,GAAmB1H,cACnB0H,GAAmBT,iBACnBS,GAAmBX,kBAClBW,GAAmBV,uBAErB1wJ,IAAS,GAGToxJ,GAAmBX,kBACnBW,GAAmBT,iBAEnB3wJ,IAAS,IAG8C,IAArD/xE,KAAK4jO,iBAAiBnhL,EAAM2vB,WAAYqxJ,GAC1C,OAEF,MAAM18N,GAASP,OAAO6H,OAAO,GAAImxN,EAAQ5+K,YAAa,CACpDgW,QAAS,UAELssK,GAAoB,CACxB1/N,KAAM,OACNjB,IAAKi9N,EAAQj9N,IACbu3E,YAAa0lJ,EAAQtB,wBACjB,iBACAl8N,EACJygD,MAAOA,EAAM2vB,WACburJ,UAAW6B,EAAQ7B,UACnBtrJ,yBAAyB,EACzBurJ,gBAAiB4B,EAAQ5B,iBAAmB,MAC5CznN,MAAO,WAEH2sC,GAAgBt8C,OAAO6H,OAC3B,GACA60N,GACA1D,EAAQ18K,cACR,CAAE/7C,YAGJ,OAAOwV,MAAY+0D,gBAAgB,CACjCp/D,MAAIulE,OAA4B30B,IAChCt/C,KAAM25N,GAAgB3tJ,MACtB5jE,MAAOu3N,GAAmBv3N,MACtBu3N,EAAkBv3N,MAClB62C,EAAM+uB,MACV4vJ,QAAS5B,EAAQttN,GACjBurN,iBAAkB+B,EAAQ/B,iBAC1B59N,QAAS,CACPijD,iBACA2sB,SAAU,CACRltE,IAAKk5N,GACL1pJ,UACApC,SAAU6yJ,GACVh/N,KAAM0/N,GAAkB1/N,QAGd,GAEjBkG,OAAQmuB,QAAgD71B,IAAT61B,EACpD,CAEQ8oM,mBACNnB,EACA1xJ,GAEA,IAAKA,IAAiBA,EAAahuB,OACjC,OAAA9/C,KAAK4B,eAAewC,MAClB,kCACA,oCAEK,GAET,MAAM48B,EAAyC8sC,EAAahuB,OAExDguB,EAAahuB,OAAOp2C,OAAQ+4C,IAAUA,GAAMyhL,aAD5C,GAEEpkL,EAAyCguB,EAAahuB,OAExDguB,EAAahuB,OAAOp2C,OACjB+4C,KACEA,GAAMj/C,MACPi/C,GAAMj/C,OAASypE,KAAiCC,cAChDzqB,GAAMj/C,OAASypE,KAAiCE,aALpD,GAQEs2J,GAAWjE,EAAQ3B,YAAc,IAAIp9M,IACxCivF,IAAoB,IAAI1lG,OAAO0lG,KAGlC,IAAI//B,EAEF7B,EAAa6F,oBACb7F,EAAa6F,mBAAmB/pE,SAGhC+lE,EAAW7B,EAAa6F,mBAAmBj7C,QAD7B,gBAC4C,KAG5D,MAAMkb,GAA4BkM,EAC/Br/B,IAAKgiC,KACJ,MAAM0gL,GAAoBnjO,KAAKqiO,wBAC7B5/K,GAAMzzB,KACNwwM,EAAQ9B,kBAEV,IAAI0F,GAAe5D,EAAQ7vJ,SACvBoC,IAAS,EAET0pJ,GACF0H,IAAmB1H,aAAe0H,IAAmBT,eACnDF,GACFW,IAAmBX,kBACnBW,IAAmBV,qBACnBW,GAiBF,IAdGD,IAAmB1H,cACnB0H,IAAmBT,iBACnBS,IAAmBX,kBAClBW,IAAmBV,uBAErB1wJ,IAAS,GAGToxJ,IAAmBX,kBACnBW,IAAmBT,iBAEnB3wJ,IAAS,IAGiD,IAAxD/xE,KAAK4jO,iBAAiBnhL,GAAMvwC,GAAGimD,WAAYsrK,GAC7C,OAEF,MAAMP,GACyB,CAC7B1/N,KAAM65N,GAAYmC,EAAQh8N,MAC1BjB,IAAKi9N,EAAQj9N,IACbkgD,MAAOA,GAAMvwC,GAAGimD,WAChBpV,WAAW,EACX2tB,YAAaW,MAAYw/E,SACzBx+E,yBAAyB,GAErBvvB,GAA6Ct8C,OAAO6H,OACxD,GACA60N,GACA1D,EAAQ18K,eAEV,OAAOvmC,MAAY+0D,gBAAgB,CACjCp/D,MAAIulE,OAA4B30B,IAChCt/C,KAAM25N,GAAgB3tJ,MACtB5jE,MAAOu3N,IAAmBv3N,MACtBu3N,GAAkBv3N,MAClB62C,GAAMzzB,KACVyuM,iBAAkB+B,EAAQ/B,iBAC1B59N,QAAS,CACPijD,iBACA8uB,iBAAeF,OAAuBjvB,GAAM+wB,UAC5C/B,iBAAeC,OAAuBjvB,GAAMgxB,UAC5ChE,SAAU,CACRltE,IAAKk5N,GACL1pJ,UACApC,SAAU6yJ,GACVh/N,KAAMg8N,EAAQh8N,QAGJ,GAEjBkG,OAAQmuB,SAAgD71B,IAAT61B,IAC5CssM,GAAkC,GAClCC,GAAmCpjM,EACtCvgB,IAAKwgB,MAEFphC,aAASmC,EACTo/N,QAAS,iBAAiBngM,GAAMjS,OAChC9c,GAAI,iBAAiB+uB,GAAMjS,OAC3BxrB,KAAM25N,GAAgBC,MACtBK,iBAAkB+B,EAAQ/B,iBAC1BQ,cAAeuB,EAAQvB,cACvBryN,MAAOq1B,GAAMjS,KACb4kB,MAAOA,GACJlqC,OAAQ0lC,IACgBnO,GAAMijM,YAAYzjN,IAAKuoD,IAAMA,GAAE7Q,YAChCngC,SACnBoX,GAAEvvC,QAAQijD,cAA8CL,QAG5DhiC,IAAK2uB,KACJ+0L,GAAsB78N,KAAK8nC,GAAEl9B,IACtB1L,OAAO6H,OAAO,GAAI+gC,GAAG,CAC1BgyL,QAAS,iBAAiBngM,GAAMjS,cAKzCtlB,OAAQq3D,IAAMA,GAAEntB,MAAMhqC,QAEzB,GAAIo3B,EAAQ,CACV,MAAMqjM,GAAY7E,EAAQ5zN,OAAS4zN,EAAQttN,GACrCoyN,GAAmB1wL,GACtBlqC,OAAQ0lC,KAAO+0L,GAAsBnsM,SAASoX,GAAEl9B,KAChDuO,IAAK2uB,IACJ5oC,OAAO6H,OAAO,GAAI+gC,GAAG,CACnBgyL,QAAS,iBAAiBiD,QAG5BC,GAAiB16N,QAWnBw6N,GAAa98N,KAVW,CACtBzH,aAASmC,EACTo/N,QAAS,iBAAiBiD,KAC1BnyN,GAAI,iBAAiBmyN,KACrB7gO,KAAM25N,GAAgBC,MACtBK,iBAAkB+B,EAAQ/B,iBAC1BQ,cAAeuB,EAAQvB,cACvBryN,MAAOy4N,GACPzwL,MAAO0wL,IAIb,CAEA,OAAOtjM,EAASojM,GAAexwL,EACjC,CAEQgwL,iBAAiB5vJ,EAAmByvJ,GAC1C,OAAuB,IAAnBA,EAAQ75N,aAGsD5H,IAA3DyhO,EAAQrhN,KAAM02M,GAAkBA,EAAM5uN,KAAK8pE,GACpD,CAEQivJ,wBACNX,EACAS,GAEA,MAAMwB,EAAyBxB,EAAkB3gN,KAC9C+jB,GAAMA,EAAEsc,QAAU6/K,GAEfkC,EAAiBzB,EAAkB3gN,KAAM+jB,GAAkB,MAAZA,EAAEsc,OACvD,IAAIiuB,EACJ,OAAI6zJ,EACF7zJ,EAAc6zJ,EAAuB7zJ,YAC5B8zJ,IACT9zJ,EAAc8zJ,EAAe9zJ,aAExBA,CACT,CAEQszJ,sBACNxE,GAEA,MAAMuD,EAAmE,GACzE,OAAKvD,EAAQ9uJ,aAGblqE,OAAOC,KAAK+4N,EAAQ9uJ,aAAan2D,QAASkqN,IACpCjF,EAAQ9uJ,YAAY+zJ,aAAiClpN,MACvDikN,EAAQ9uJ,YAAY+zJ,GAAsBlqN,QAASy5D,IAE9C+uJ,EAAkB3gN,KAAMsiN,GAAaA,EAASjiL,QAAUuxB,IAEzD+uJ,EAAkBz7N,KAAK,CACrBm7C,MAAOuxB,EACPtD,YAAa+zJ,GACd,GAKF1B,EAAkB3gN,KAChBsiN,GACCA,EAASjiL,QAAU+8K,EAAQ9uJ,YAAY+zJ,KAG3C1B,EAAkBz7N,KAAK,CACrBm7C,MAAO+8K,EAAQ9uJ,YAAY+zJ,GAC3B/zJ,YAAa+zJ,GACd,GAIA1B,CACT,4CAl6BWlE,GAAcz9N,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA,iCAAd84N,EAAcx9N,QAAdw9N,EAAcv9N,UAAAC,WAFb,gBAEDs9N,CAAc,KAq6B3B,MAAMa,GACG,4BAAOC,CACZ9/N,EACA8kO,GAEA,IAAInF,EACJ,OACEA,EADE3/N,EAAQ8a,eAAe,aACf,IAAIikN,GAAiB/+N,EAAU2/N,GACvCmF,EAAe/D,+BAA+BpB,IAEvC3/N,EAAQ2D,OAAS65N,GAAYA,GAAYC,YACxC,IAAIkB,GAAkB3+N,EAAU2/N,GACxCmF,EAAe/E,0BAA0BJ,IAElC3/N,EAAQ2D,OAAS65N,GAAYA,GAAYvwJ,YACxC,IAAI2xJ,GAAkB5+N,EAAU2/N,GACxCmF,EAAejE,2BAA2BlB,IAEnC3/N,EAAQ2D,OAAS65N,GAAYA,GAAYrwJ,gBACxC,IAAI0xJ,GACZ7+N,EACC2/N,GACCmF,EAAejE,2BAA2BlB,GAC5CnC,GAAYrwJ,gBAELntE,EAAQ2D,OAAS65N,GAAYA,GAAYtwJ,iBACxC,IAAI2xJ,GACZ7+N,EACC2/N,GACCmF,EAAejE,2BAA2BlB,GAC5CnC,GAAYtwJ,iBAELltE,EAAQ2D,OAAS65N,GAAYA,GAAYxwJ,MACxC,IAAI0xJ,GAAY1+N,EAAU2/N,GAClCmF,EAAenE,0BAA0BhB,IAGjC,IAAIpB,GAAWv+N,EAAU2/N,GACjCmF,EAAe7E,yBAAyBN,IAIrCA,CACT,wCC//BAp+N,MAAA,0DAiBIA,MADF,cACEA,CADqE,sCAOnEA,MAAA,iBAAAqW,GAAArW,aAAAqgC,GAAArgC,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,cAEJA,gBANIA,cAAA,aAAAA,MAAA,0EA0CNA,MAAA,+DAIEA,MAAA,QAAAA,MAAA,IAAAsgC,EAAAkjM,aCbG,IAAMC,GAA4B,MAAnC,MAAOA,EAqDSxqK,aApDbshG,SAAqC,IAAI55J,MAAgB,GACzD05J,WAAuC,IAAI15J,MAAgB,GAC3D65J,WAAuC,IAAI75J,MAAgB,GAC1D+iO,YACApgI,aACAj7C,SACA5mB,mBAEDkiM,kBAA8C,IAAIhjO,MACvD,GAEK6iO,UAAY,IAAI7iO,UAAuBC,GAEtCi6J,gBAA0B,EAEzB3gG,WAEA0pK,oBAAqB,EAKrBviL,MAEAhiC,IAKAwZ,OAAQ,EAKPgrM,YAAc,IAAI33N,MAElB43N,oBAAsB,IAAI53N,MAKpC,SAAI1B,GACF,SAAO2S,OAAeve,KAAKyiD,MAC7B,CAKA,QAAI92C,GACF,SAAOiT,OAAc5e,KAAKyiD,QAAU,QACtC,CAEA1iD,YAAoBs6D,GAAAr6D,KAAAq6D,cAA6B,CAEjD9sD,WACEvN,KAAK8kO,YAAc9kO,KAAKy7J,WAAW54J,UAAW6D,GAC5C1G,KAAKklO,oBAAoB92N,KAAK1H,IAGhC1G,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QAAQt/C,UAAU,KACzC7C,KAAKq8J,WAAS,GAGhBr8J,KAAK0kG,aAAe1kG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UACrDy4D,IACCt7D,KAAKokH,qBAAqB9oD,GAC1Bt7D,KAAKq8J,WAAS,EAGpB,CAEAnuJ,cACElO,KAAK8kO,YAAY32N,cACjBnO,KAAK0kG,aAAav2F,cAClBnO,KAAKypD,SAASt7C,aAChB,CAEAg3N,sBACE,MAAMziL,EAAe1iD,KAAKyiD,MAAM5iD,QAChC,IAAK6iD,EAAa70C,QAChB,SAAO0Q,OAAeve,KAAKyiD,OAE7B,MAAMonK,EAAennK,EAAa70C,QAC5Bi8M,EAAiBpnK,EAAsC+sB,SAC7D,OAAQ/sB,EAAa70C,QAAQrK,MAC3B,KAAKigH,MAAYC,MACf,OAAO1jH,KAAKyiD,MAAM72C,MACpB,KAAK63G,MAAYE,SACf,OAAImmG,GAAiBA,EAAcn6I,SAC1Bm6I,EAAcn6I,SAEd3vE,KAAKyiD,MAAM72C,MAEtB,KAAK63G,MAAYG,OACf,OAAIimG,GAAgBA,EAAaj9K,KACxBi9K,EAAaj9K,KAEb5sC,KAAKyiD,MAAM72C,MAEtB,QACE,OAAO5L,KAAKyiD,MAAM72C,MAExB,CAMA2vJ,aAAa7xI,GACX1pB,KAAKovH,cAAc1lG,EACrB,CAEA07M,aAAa17M,GACX1pB,KAAK+kO,kBAAkBpiO,MAAM3C,KAAK+kO,kBAAkBr+N,OACpD1G,KAAKq6D,aACFU,iBAAiB/6D,KAAKyiD,MAAM5iD,SAC5BkE,QAAKs5C,SACLx6C,UAAW4/C,GAAUziD,KAAK4kO,UAAUjiO,KAAK8/C,GAC9C,CAMA2sE,cAAc1lG,GAIZ,UAHW1pB,KAAK6iC,mBAAuB,KACrCI,aAAajjC,KAAK6iC,oBAED,eAAfnZ,EAAMlmB,OAAyBxD,KAAKi8J,eAGxC,OAAQvyI,EAAMlmB,MACZ,IAAK,QACExD,KAAKy7J,WAAW/0J,QACf1G,KAAKi6B,MACPj6B,KAAKS,OAAOipB,GAEZ1pB,KAAK4tC,IAAIlkB,IAGb1pB,KAAKy7J,WAAW94J,MAAK,GACrB,MACF,IAAK,cACE3C,KAAKy7J,WAAW/0J,QAAU1G,KAAKi6B,QAClCj6B,KAAK6iC,mBAAqBlE,WAAW,KACnC3+B,KAAK4tC,IAAIlkB,GACT1pB,KAAKy7J,WAAW94J,MAAK,EAAI,EACxB,MAEL3C,KAAKi8J,gBAAiB,EACtB,MACF,IAAK,aACCj8J,KAAKy7J,WAAW/0J,QAClB1G,KAAKS,OAAOipB,GACZ1pB,KAAKy7J,WAAW94J,MAAK,IAEvB3C,KAAKi8J,gBAAiB,EAK5B,CAKQruH,IAAIlkB,GACL1pB,KAAKi6B,QACRj6B,KAAKi6B,OAAQ,EACbj6B,KAAKilO,YAAY72N,KAAK,CAAE6rB,OAAO,EAAMwoB,MAAOziD,KAAKyiD,MAAO/4B,UAE5D,CAKQjpB,OAAOipB,GACT1pB,KAAKi6B,QACPj6B,KAAKi6B,OAAQ,EACbj6B,KAAKilO,YAAY72N,KAAK,CAAE6rB,OAAO,EAAOwoB,MAAOziD,KAAKyiD,MAAO/4B,UAE7D,CAEA27M,YACE,SAAUrlO,KAAKyiD,MAAM2+K,SAAoD,IAAzCphO,KAAKyiD,MAAM2+K,QAAQ93N,MAAM,KAAKM,OAChE,CAEAw6G,qBAAqB9oD,GACnB,MAAMsW,GACH5xE,KAAKyiD,MAAM5iD,QAAQ+xE,eACpBz2C,OAAOkoJ,MAAMrjL,KAAKyiD,MAAM5iD,QAAQ+xE,eAC5B,EACA5xE,KAAKyiD,MAAM5iD,QAAQ+xE,cACnBH,GACHzxE,KAAKyiD,MAAM5iD,QAAQ4xE,eACpBt2C,OAAOkoJ,MAAMrjL,KAAKyiD,MAAM5iD,QAAQ4xE,eAC5B8yC,IACAvkH,KAAKyiD,MAAM5iD,QAAQ4xE,cACzBzxE,KAAK27J,SAASh5J,KACZ24D,GAAcsW,GAAiBtW,GAAcmW,EAEjD,CAEA4qF,YACE,GAAIr8J,KAAKyiD,OAAOvwC,GAAI,CAClB,MAAMuqJ,EAASz8J,KAAKygB,IAAIqjH,aAAa9jI,KAAKyiD,OAAOvwC,IAE7ClS,KAAK47J,WAAWj5J,OADpB85J,GACyBA,EAAO5lI,QAElC,CACF,CAEA6kI,eACE,OAAI17J,KAAK27J,SAAShiI,YACT35B,KAAK47J,WAAWjiI,WAAa,GAE7B,gBAEX,CAEA6hI,iBACE,OAAIx7J,KAAKi6B,MACHj6B,KAAKy7J,WAAW/0J,MACX,iCACE1G,KAAK27J,SAASj1J,MAChB1G,KAAK47J,WAAWl1J,MACnB,sCACA,gDAEG,8CAGF1G,KAAK27J,SAASj1J,MACjB,iCACA,wCAER,4CA7OWm+N,GAA4BzjO,MAAAuE,MAAA,+BAA5Bk/N,EAA4Bv2N,UAAA,gCAAAC,OAAA,CAAA+sD,WAAA,aAAA0pK,mBAAA,qBAAAviL,MAAA,QAAAhiC,IAAA,MAAAwZ,MAAA,SAAAzrB,QAAA,CAAAy2N,YAAA,cAAAC,oBAAA,uBAAAz2N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,m6BAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDvDzC1N,MAAA,mBACEA,MAAA,EAAAkkO,GAAA,kBAKAlkO,MAAA,YAIEA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAS2N,EAAAq2N,aAAA3tN,GAAoB,GAG7BrW,MAAA,GACFA,QAEAA,MAAA,WACEA,MAAA,EAAAmkO,GAAA,gBAYAnkO,MAAA,2BAEAA,MAAA,oDAQEA,MAPA,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAc2N,EAAAwsJ,aAAA9jJ,GAAoB,EAOlCrW,CAPmC,sBAAAqW,GAAArW,aAAAyK,GAAAzK,MACrB2N,EAAAwsJ,aAAA9jJ,GAAoB,EAMlCrW,CANmC,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAM1B2N,EAAAqgH,cAAA33G,GAAqB,GAE9BrW,MAAA,6HAgBEA,MAAA,sBAIRA,cAEAA,MAAA,cACEA,MAAA,GAAAokO,GAAA,8DAOFpkO,cArEKA,cAAA,OAAA2N,EAAAs2N,aAODjkO,QAEAA,MAFA,UAAA2N,EAAAi2N,mBAAA,4BAEA5jO,CAF8D,aAAA2N,EAAAo2N,uBAI9D/jO,cAAA,IAAA2N,EAAAnD,MAAA,KAISxK,MAAA,GAAAA,MAAA,OAAA2N,EAAA0zC,MAAAg7K,kBAYYr8N,cAAA,QAAA2N,EAAA0zC,OAQnBrhD,QACAA,MADA,aAAAA,MAAA,KAAA2N,EAAAysJ,kBACAp6J,CAD2C,QAAAA,MAAA,KAAA2N,EAAA0sJ,YAAA,GAAA1sJ,EAAAkrB,MAAA,WAOzC74B,MAAA,GASAA,MATA,kBAAA2N,EAAA2sJ,eASAt6J,CATkC,6BASlCA,CANgC,iBAAAA,MAAA,MAAA2N,EAAA4sJ,YAAA,IAAAv6J,MAAA,MAAA2N,EAAA6sJ,aAAAx6J,MAAA,MAAA2N,EAAA4sJ,YAAA5sJ,EAAAkrB,OAAA74B,MAAA,MAAA2N,EAAA4sJ,WAAAv6J,MAAA,MAAA2N,EAAA0sJ,YAMhCr6J,CADC,wBAAAA,MAAA,MAAA2N,EAAA4sJ,WAKDv6J,MAAA,GAAAA,MAAA,IAAAA,MAAA,MAAA2N,EAAA0sJ,YAAA,OAAA1sJ,EAAAkrB,MAAA,oBAQH74B,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAg2N,oBAAA3jO,MAAA,MAAA2N,EAAA61N,YAAA71N,EAAAi2N,oCCxBD51N,MAAaxJ,wBACbuJ,KACAK,KAAa3J,KACbyJ,KACAD,KAAgBvJ,KAChByJ,KAAexJ,KACfmuN,GACA72D,IAAcr3J,IACd+O,KACAgiK,GACArnK,KACAC,KAAiBgF,MAAA9E,OAAA,obAAAC,gBAAA,WAGR+0N,CAA4B,8CChCnCzjO,MAAA,sCAOEA,MAAA,iBAAAqW,GAAArW,aAAAqgC,GAAArgC,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,cACFA,aALEA,MAAA,aAAAA,MAAA,yEANJA,MAAA,cACEA,MAAA,EAAAqkO,GAAA,kBAWFrkO,8BATKA,cAAA,OAAAsgC,EAAAT,MAAAw8L,4DAWLr8N,MAAA,GAGEA,MAAA,qDAOEA,MAAA,iBAAAqW,GAAArW,MAAAkP,GAAA,MAAAoxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA0tF,cAAA33G,GAAqB,GAE9BrW,MAAA,cAAUA,MAAA,YACZA,0CANEA,QAEAA,MAFA,aAAAA,MAAA,2CAEAA,CAFgE,WAAAA,MAAA,IAAAsgC,EAAAl2B,sDAUlEpK,MAAA,qDAMEA,MAAA,iBAAAqW,GAAArW,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA0tF,cAAA33G,GAAqB,GAE9BrW,MAAA,cAAUA,MAAA,SACZA,kCAJEA,MADA,aAAAA,MAAA,sCACAA,CAD2D,WAAAA,MAAA,IAAAsgC,EAAAl2B,mCAY/DpK,MAAA,4CAGAA,MAAA,GACEA,MAAA,kCAQEA,MADA,+BAAAqW,GAAArW,MAAA2P,GAAA,MAAA2wB,EAAAtgC,MAAA,UAAAA,MAAuBsgC,EAAAgkM,eAAAjuN,GAAsB,EAC7CrW,CAD8C,uBAAAqW,GAAArW,MAAA2P,GAAA,MAAA2wB,EAAAtgC,MAAA,UAAAA,MAC/BsgC,EAAAikM,mBAAAluN,GAA0B,GAE3CrW,4DAREA,QAIAA,MAJA,QAAAwkO,EAIAxkO,CAJoB,aAAAsgC,EAAA45B,WAIpBl6D,CAHyB,MAAAsgC,EAAAjhB,IAGzBrf,CAFW,qBAAAsgC,EAAAsjM,mBAEX5jO,CADyC,QAAAsgC,EAAAlxB,MAAAtQ,IAAA0lO,GAAA3rM,iCAN7C74B,MAHA,EAAAykO,GAAA,sBAGAzkO,CAHoC,EAAA0kO,GAAA,0DAArB1kO,MAAA,OAAAsgC,EAAAqkM,QAAAH,IAGAxkO,cAAA,OAAAsgC,EAAAskM,QAAAJ,KCdZ,IAAMK,GAA4B,MAAnC,MAAOA,EAKX/1N,MAAQ,IAAI7E,MAA2C,IAMvD66N,OAAmC,IAAInkO,MAAgB,GACvDokO,SAAqC,IAAIpkO,MAAgB,GAKzDyJ,UAAsC,IAAIzJ,MAAgB,GAKjDy9N,QAKAv+L,MAEAxgB,IAKA3P,WAAqB,EAErBwqD,WAEA0pK,oBAAqB,EAKrBoB,iBAA2B,EAS3B51N,MAKCy0N,YAAc,IAAI33N,MAKlB+4N,iBAAmB,IAAI/4N,MAKjC,SAAI1B,GACF,OAAO5L,KAAKihC,MAAMr1B,KACpB,CAKA2B,WACEvN,KAAKkQ,MAAMgV,KAAKllB,KAAKihC,MAAM2S,OAC3B5zC,KAAKsmO,gBACLtmO,KAAKumO,iBAAiBvmO,KAAK8Q,gBACM9O,IAA7BhC,KAAKihC,MAAMg9L,eACbj+N,KAAKkQ,MAAMC,KAAKqS,KAAK,CACnB8B,UAAWtkB,KAAKihC,MAAMg9L,cACtB55M,cAAgBwT,GAAsBA,EAAKjsB,OAGjD,CAEAsC,cACElO,KAAKkQ,MAAM6D,SACb,CAKAgyN,QAAQluM,GACN,OAAOA,EAAKr0B,OAAS25N,GAAgBC,KACvC,CAKA4I,QAAQnuM,GACN,OAAOA,EAAKr0B,OAAS25N,GAAgB3tJ,KACvC,CAMA4/C,cAAc1lG,GACZ1pB,KAAKkmO,OAAOx/N,MAAQ1G,KAAKS,OAAOipB,GAAS1pB,KAAK4tC,IAAIlkB,EACpD,CAMA88M,kBAAkB11N,GAChB9Q,KAAKumO,iBAAiBz1N,EACxB,CASA60N,mBAAmBj8M,GACjB1pB,KAAKqmO,iBAAiBj4N,KAAKsb,GAC3B1pB,KAAKymO,eAAe/8M,EACtB,CAKQkkB,IAAIlkB,GACV1pB,KAAKkmO,OAAOvjO,MAAK,GACjB3C,KAAKilO,YAAY72N,KAAK,CACpB6rB,OAAO,EACPgH,MAAOjhC,KAAKihC,MACZvX,SAEJ,CAKQjpB,OAAOipB,GACb1pB,KAAKkmO,OAAOvjO,MAAK,GACjB3C,KAAKilO,YAAY72N,KAAK,CACpB6rB,OAAO,EACPgH,MAAOjhC,KAAKihC,MACZvX,SAEJ,CAEAg8M,eAAeh8M,GACb1pB,KAAKmmO,SAASxjO,KAAK+mB,EACrB,CAMQ+8M,eAAe/8M,GACrB,MAAMuQ,EAAQvQ,EAAMuQ,MACdwoB,EAAQ/4B,EAAM+4B,MAEAziD,KAAKkQ,MAAMC,KAC5B8R,MACAvY,OAAQmuB,GAAsBA,EAAK3lB,KAAOuwC,EAAMvwC,IAChDuO,IAAKoX,GAAsB73B,KAAKwQ,MAAMtQ,IAAI23B,GAAMoC,QAAS,GAE5ChW,MAAOvd,GAAUA,IAAUuzB,GACzCA,EAAQj6B,KAAK4tC,IAAIlkB,EAAMA,OAAS1pB,KAAKS,OAAOipB,EAAMA,QACnB,IAAtB1pB,KAAKkmO,OAAOx/N,OACrB1G,KAAKkmO,OAAOvjO,MAAK,EAErB,CAEQ2jO,gBACN,MAAMrsM,EAAQj6B,KAAKkQ,MAAM+R,MAAMgC,MAAO4T,IACa,KAAzC73B,KAAKwQ,MAAMtQ,IAAI23B,GAAMoC,QAAS,IAExCj6B,KAAKkmO,OAAOvjO,KAAKs3B,EACnB,CAEQssM,iBAAiBz1N,GACvB,IAAI3D,GAAW,GACc,IAAzBnN,KAAKomO,kBACPj5N,EAAW2D,GAEb9Q,KAAKwL,UAAU7I,KAAKwK,EACtB,CAEAu5N,eACE1mO,KAAK8Q,WAAa9Q,KAAK8Q,SACzB,4CArMWm1N,EAA4B,+BAA5BA,EAA4B33N,UAAA,gCAAAC,OAAA,CAAAixN,QAAA,UAAAv+L,MAAA,QAAAxgB,IAAA,MAAA3P,UAAA,YAAAwqD,WAAA,aAAA0pK,mBAAA,qBAAAoB,gBAAA,kBAAA51N,MAAA,SAAAhC,QAAA,CAAAy2N,YAAA,cAAAoB,iBAAA,oBAAA53N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,kiCAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBDzDvC1N,MADF,kBACEA,CADa,gBAOXA,MAAA,kBAAAqW,GAAArW,aAAAyK,GAAAzK,MAAU2N,EAAAy3N,kBAAA/uN,GAAyB,GAEnCrW,MAAA,mBACFA,QAEAA,MAAA,YAKEA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAA23N,eAAc,GACtBtlO,MAAA,GAAWA,QAGdA,MAAA,WAeEA,MAdA,EAAAulO,GAAA,eAcAvlO,CAduE,EAAAwlO,GAAA,wDA8BvExlO,MAAA,GAAAylO,GAAA,yBAAAzlO,OAaJA,UAEAA,MAAA,iBACEA,MAAA,GAAA0lO,GAAA,uCAkBF1lO,8CAjFIA,QACAA,MADA,SAAAw1K,EACAx1K,CADgB,YAAA2N,EAAA+B,WAWhB1P,MAAA,GAAAA,MAAA,aAAA2N,EAAAnD,OAECxK,cAAA2N,EAAAnD,OAIQxK,MAAA,GAAAA,MAAA,OAAA2N,EAAAkyB,MAAAw8L,kBAeNr8N,QAAwDA,MAAxD,OAAAA,MAAA,IAAA2N,EAAAm3N,UAAA,IAAA9kO,MAAA,KAAA2N,EAAAo3N,UAAwD/kO,CAAA,WAAA2lO,GA+BjC3lO,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAmB,MAAAC,KAAAO,yBCvB1BtB,MAAazJ,wBACb6J,KAAa5J,KACb8Q,MACArH,KAAgBxJ,KAChBsJ,KACAI,KAAezJ,KACf2O,KACAowN,GACA3zL,KACAxhC,KACAC,KAAiB5J,MAAA8J,OAAA,gYAAAC,gBAAA,WAGRm2N,CAA4B,8CCxDrC7kO,MAAA,GACEA,MAAA,kDAUEA,MADA,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,UAAAA,MAAekK,EAAA07N,mBAAAvvN,GAA0B,EACzCrW,CAD0C,4BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,MAAA,UAAAA,MACtBkK,EAAAq6N,mBAAAluN,GAA0B,GAEhDrW,4DAXEA,QAOAA,MAPA,UAAAkK,EAAAk0N,QAOAp+N,CAPmB,QAAA6lO,EAOnB7lO,CANc,MAAAkK,EAAAmV,IAMdrf,CALW,QAAAkK,EAAA4E,MAAAM,MAKXpP,CAJqB,aAAAA,MAAA,IAAAkK,EAAA25F,aAIrB7jG,CAHkC,qBAAAkK,EAAA05N,mBAGlC5jO,CAFyC,gBAAAkK,EAAA4E,MAAA2R,MAEzCzgB,CAD8C,kBAAAkK,EAAA47N,gEAQlD9lO,MAAA,GACEA,MAAA,kDAOEA,MAAA,uBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAekK,EAAAq6N,mBAAAluN,GAA0B,GAE3CrW,4DAPEA,QAIAA,MAJA,QAAA6lO,EAIA7lO,CAJoB,MAAAkK,EAAAmV,IAIpBrf,CAHW,aAAAA,MAAA,IAAAkK,EAAA25F,aAGX7jG,CAFkC,qBAAAkK,EAAA05N,mBAElC5jO,CADyC,QAAAkK,EAAA4E,MAAAM,MAAAtQ,IAAA+mO,GAAAhtM,iCAN7C74B,MAhBA,EAAA+lO,GAAA,sBAgBA/lO,CAhBoC,EAAAgmO,GAAA,yDAArBhmO,MAAA,OAAAkK,EAAAy6N,QAAAkB,IAgBA7lO,cAAA,OAAAkK,EAAA06N,QAAAiB,KC+BZ,IAAMI,GAAuB,MAA9B,MAAOA,EAmCDhtK,aACAtoD,MAhCFI,QAIR,eAAI8yF,GACF,OAAOjlG,KAAKygB,IAAIyhC,eAAe+iD,WACjC,CAES+/H,oBAAqB,EAKrBxF,QAKAtvN,MAKAuQ,IAKAymN,sBAAgC,EAEzCnnO,YACUs6D,EACAtoD,GADA/R,KAAAq6D,eACAr6D,KAAA+R,OACP,CAKHxE,WACE,MAAM+5N,EAAetnO,KAAKygB,IAAIq/B,OAAOr/B,IAAKgiC,KAEtCvwC,GAAIuwC,EAAM5iD,QAAQ4jB,OAAOvR,GACzBtG,MAAO62C,EAAM72C,MACbpI,KAAM25N,GAAgB3tJ,SAG1BxvE,KAAKkQ,MAAMM,MAAMqP,WAAWynN,EAAc,CAAErtM,OAAO,IAAQ,GACvDj6B,KAAKw/N,cAA0Cx9N,IAA/BhC,KAAKw/N,QAAQvB,eAC/Bj+N,KAAKkQ,MAAMC,KAAKqS,KAAK,CACnB8B,UAAWtkB,KAAKw/N,QAAQvB,cACxB55M,cAAgBwT,GAAsBA,EAAKjsB,QAK/C5L,KAAKglO,qBADqBhlO,KAAKw/N,SAAUx/N,KAAKw/N,QAAQrB,YAGlDn+N,KAAKglO,mBAEThlO,KAAKmS,QAAU,IAAI6B,MAAmBhU,KAAKkQ,MAAOlQ,KAAK+R,MACzD,CAEA7D,cACElO,KAAKmS,QAAQ4B,SACf,CAKAgyN,QAAQluM,GACN,OAAOA,EAAKr0B,OAAS25N,GAAgBC,KACvC,CAKA4I,QAAQnuM,GACN,OAAOA,EAAKr0B,OAAS25N,GAAgB3tJ,KACvC,CAOAm2J,mBAAmBj8M,GACjB,MAAM+4B,EAAQ/4B,EAAM+4B,MACpBziD,KAAKkQ,MAAMM,MAAMmP,OAAO8iC,EAAO,CAAExoB,MAAOvQ,EAAMuQ,QAAS,GACvDvQ,EAAMuQ,MACFj6B,KAAKu8J,cAAc95G,EAAO/4B,GAC1B1pB,KAAKw8J,mBAAmB/5G,EAC9B,CAOAukL,mBAAmBt9M,GACjB,MAAMuX,EAAQvX,EAAMuX,MACpBjhC,KAAKkQ,MAAMM,MAAMmP,OAAOshB,EAAO,CAAEhH,MAAOvQ,EAAMuQ,QAAS,GACvDvQ,EAAMuQ,MACFj6B,KAAKunO,cAActmM,EAAOvX,GAC1B1pB,KAAKwnO,mBAAmBvmM,EAC9B,CAMQs7H,cAAc95G,EAAyB/4B,GAC7C1pB,KAAKynO,eAAe,CAAChlL,GAAQ/4B,EAC/B,CAMQ8yI,mBAAmB/5G,GACzBziD,KAAK0nO,oBAAoB,CAACjlL,GAC5B,CAMQglL,eACN3nL,EACAp2B,GAEA,MAAMy4B,EAAUrC,EAAOr/B,IAAKgiC,IACrBA,EAAM5iD,QAAQijD,cAAcwzB,iBAC/B7zB,EAAM5iD,QAAQijD,cAAcwzB,gBAAiB,GAE3Ct2E,KAAKw/N,QAAQhtK,SAAS5oD,SACxB64C,EAAM5iD,QAAQ8iD,SAAW,CAAE6P,QAASxyD,KAAKw/N,QAAQhtK,UAE5CxyD,KAAKq6D,aAAaU,iBAAiBtY,EAAM5iD,YAElDonH,WAAO9kE,GAASt/C,UAAWi9C,IACA,UAArBp2B,EAAMA,MAAMlmB,MAAoBkmB,EAAMuQ,OACxCj6B,KAAKygB,IAAIohH,oBAAoBl/H,KAAKm9C,GAEpC9/C,KAAKkQ,MAAMM,MAAMqP,WAAWigC,EAAQ,CAAE7lB,OAAO,IAC7Cj6B,KAAKygB,IAAIi8C,UAAU5c,EAAM,EAE7B,CAMQ4nL,oBAAoB5nL,GAC1BA,EAAOvlC,QAASkoC,IAEd,GADAziD,KAAKkQ,MAAMM,MAAMmP,OAAO8iC,EAAO,CAAExoB,OAAO,KACR,IAA5BwoB,EAAM5iD,QAAQwiD,UAAoB,CACpC,MAAM8mJ,EAAYnpM,KAAKygB,IAAIqjH,aAAarhF,EAAM5iD,QAAQqS,SACpClQ,IAAdmnM,GACFnpM,KAAKygB,IAAI8rF,YAAY48F,EAEzB,KAAO,CACL,MAAMA,EAAYnpM,KAAKygB,IAAIqjH,aAAarhF,EAAMvwC,SAC5BlQ,IAAdmnM,GACFnpM,KAAKygB,IAAI8rF,YAAY48F,EAEzB,GAEJ,CAMQw+B,wBAAwB/zL,EAAsBtvB,GACpD,MAAMsjN,EAAah0L,EAAMpxB,KAAK,CAAC8/B,EAAGC,KAChC,MAAMslL,EAASvlL,EAAE12C,MAAM6sB,UAAU,OAAOC,QAAQ,mBAAoB,IAC9DovM,GAASvlL,EAAE32C,MAAM6sB,UAAU,OAAOC,QAAQ,mBAAoB,IAEpE,OAAImvM,EAASC,IACJ,EAELD,EAASC,GACJ,EAEF,IAET,OAAQxjN,GACN,IAAK,MACH,OAAOsjN,EACT,IAAK,OACH,OAAOA,EAAW7nN,UACpB,QACE,OAAO6zB,EAEb,CAMQ2zL,cACNtmM,EACAvX,GAEA,IAAIo2B,EAAS7e,EAAM2S,MAAMlqC,OAAQmuB,IAC/B,MAAMoC,EAAQj6B,KAAKkQ,MAAMM,MAAMtQ,IAAI23B,GAAMoC,QAAS,EAClD,OAAOj6B,KAAKgmO,QAAQnuM,KAAmB,IAAVoC,CAAU,QAEbj4B,IAAxBi/B,EAAMg9L,gBACRn+K,EAAS9/C,KAAK2nO,wBAAwB7nL,EAAQ7e,EAAMg9L,gBAEtDj+N,KAAKynO,eAAe3nL,EAAO//B,UAAiC2J,EAC9D,CAMQ89M,mBAAmBvmM,GACzB,MAAM6e,EAAS7e,EAAM2S,MAAMlqC,OAAQmuB,IACjC,MAAMoC,EAAQj6B,KAAKkQ,MAAMM,MAAMtQ,IAAI23B,GAAMoC,QAAS,EAClD,OAAOj6B,KAAKgmO,QAAQnuM,KAAmB,IAAVoC,CAAU,GAEzCj6B,KAAK0nO,oBAAoB5nL,EAC3B,4CApOWunL,GAAuBjmO,MAAAuE,MAAAvE,aAAA,+BAAvBimO,EAAuB/4N,UAAA,0BAAAC,OAAA,CAAAy2N,mBAAA,qBAAAxF,QAAA,UAAAtvN,MAAA,QAAAuQ,IAAA,MAAAymN,qBAAA,wBAAAz4N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mSAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDjDpC1N,MAAA,gBACEA,MAAA,EAAA2mO,GAAA,sCA8BF3mO,eA/B+BA,MAArB,gBAAqBA,CAAD,gBACAA,cAAA,UAAAA,MAAA,IAAA2N,EAAAmB,MAAAC,KAAAO,yBCuC1BkiC,KACAn+B,KACAtF,KACA82N,GACApB,GACA3zL,KACAxhC,MAAS8yB,cAAA,EAAA1yB,gBAAA,WAGAu3N,CAAuB,qFC/B1BjmO,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MADA,aAAA4mO,EAAAp8N,MACAxK,CADsC,QAAA4mO,GAGtC5mO,cAAA,IAAA4mO,EAAAp8N,MAAA,gCAkBFxK,MAAA,mBAMEA,MAAA,GACFA,kCAHEA,MADA,aAAA6mO,EAAA1lO,IACAnB,CADoC,QAAA6mO,GAGpC7mO,cAAA,IAAA6mO,EAAA1lO,IAAA,+CAQFnB,MAAA,mBAGEA,MAAA,iBAAAqW,GAAArW,aAAAkP,GAAAlP,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,UAAoBA,MAAA,GACtBA,sCAJEA,MAAA,QAAA8mO,GAGoB9mO,MAAA,GAAAA,MAAA8mO,8BAO5B9mO,MADF,SACEA,CADkD,UAEhDA,MAAA,GAOJA,gCAPIA,MAAA,GAAAA,MAAA,IAAA+mO,EAAAxmO,gBAAA4pB,UAAAshB,QAAA,wDAAAzrC,MAAA,EAAAoW,GAAA2wN,EAAAC,aAAA7lO,IAAA4lO,EAAAE,eAAA,gCASFjnO,MADF,SACEA,CADmD,UAEjDA,MAAA,GAMJA,gCANIA,MAAA,GAAAA,MAAA,IAAA+mO,EAAAxmO,gBAAA4pB,UAAAshB,QAAA,8BAAAzrC,MAAA,EAAA+zC,GAAAgzL,EAAAC,aAAA7lO,MAAA,MCnBC,IAAM+lO,GAAyB,MAAhC,MAAOA,EAcD9yM,YACD7zB,gBACC6mC,cACD5wB,UAGA3T,KAnBFk8B,KACCooM,wBAA0B,MAC1BC,mBACDC,wBAA0B,IAAI1mO,KAA2B,IAChE2mO,iBACAC,mBAAgC,GAChCz4N,MACA9L,OAAQ,EACRgkO,aACAC,aACQO,eAER7oO,YACUy1B,EACD7zB,EACC6mC,EACD5wB,EAGA3T,GANCjE,KAAAw1B,cACDx1B,KAAA2B,kBACC3B,KAAAwoC,gBACDxoC,KAAA4X,YAGA5X,KAAAiE,OAOPjE,KAAKkQ,MAAQjM,EAAKiM,MAClBlQ,KAAK2oO,mBAAqB1kO,EAAK0kO,mBAC/B3oO,KAAKoE,MAAQH,EAAKG,MAClBpE,KAAKooO,aAAenkO,EAAKmkO,aACzBpoO,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjC/uB,GAAI,CAAC,GAAI,IACTtG,MAAO,CAAC,GAAI,IACZrJ,IAAK,CAAC,GAAI,CAACwiC,KAAW/C,WACtBx+B,KAAM,CAACxD,KAAKuoO,wBAAyB,CAACxjM,KAAW/C,YAErD,CAEAz0B,WACEvN,KAAKkQ,MAAMM,MAAM1J,QACjB9G,KAAK0oO,iBAAmBliO,OAAOC,KAAKkmE,MAEpC3sE,KAAKwoO,mBAAqBxoO,KAAKmgC,KAC5BjgC,IAAI,QACJq4B,aAAa11B,UAAW6D,IACT,SAAVA,EACF1G,KAAKmgC,KAAKjgC,IAAI,SAASukC,cAAcM,KAAW/C,UAEhDhiC,KAAKmgC,KAAKjgC,IAAI,SAASukC,cAAc,IAEvCzkC,KAAKmgC,KAAKjgC,IAAI,SAASgmC,wBAAsB,GAGjDlmC,KAAK6oO,+BACL7oO,KAAK4oO,eAAiB5oO,KAAKkQ,MAAMC,KAC9BO,OACA7N,UAAU,IAAM7C,KAAK6oO,gCAExB7oO,KAAKqoO,aAAeroO,KAAKwoC,cAAcpoC,UAAU,eACnD,CAEA8N,cACElO,KAAKwoO,mBAAmBr6N,cACxBnO,KAAK4oO,eAAez6N,aACtB,CAEA26N,iBAAiBtJ,GACfx/N,KAAKmgC,KAAKkyJ,WAAWmtC,GACrBx/N,KAAKoE,OAAQ,EACbpE,KAAK6oO,8BACP,CAEAA,+BACE7oO,KAAKyoO,wBAAwB9lO,KAC3B3C,KAAK2oO,mBAAmBj/N,OAAQswB,IAAOh6B,KAAKkQ,MAAMhQ,IAAI85B,EAAE9nB,KAE5D,CAEA62N,WAAWX,GACTpoO,KAAKoE,OAAQ,EACbpE,KAAK4X,UAAUK,MAAMmwN,EACvB,CAEAhjM,SACEplC,KAAKoE,OAAQ,EACbpE,KAAK4X,UAAUK,OACjB,4CAvFWqwN,GAAyBlnO,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MAAA0E,OAAA1E,MAmB1BglC,MAAe,kCAnBdkiM,EAAyBh6N,UAAA,6BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,g8BAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,iBD5DtC1N,MAAA,UACEA,MAAA,wBACFA,QAIMA,MAHN,UAGMA,CAHyC,WAGzCA,CAFsC,UAEtCA,CAD+B,oBAE7BA,MAAA,kCAOAA,MAAA,0BAEEA,MAAA,0BAAAqW,GAAArW,aAAAyK,GAAAzK,MAAkB2N,EAAA+5N,iBAAArxN,EAAA+f,OAAA9wB,OAAqC,GAEvDtF,MAAA,GAAA4nO,GAAA,sCAUN5nO,YAEEA,MADF,WACEA,CAD+B,qBAE7BA,MAAA,cAOAA,MAAA,2BAEEA,MAAA,0BAAAqW,GAAArW,aAAAyK,GAAAzK,MAAkB2N,EAAA+5N,iBAAArxN,EAAA+f,OAAA9wB,OAAqC,GAEvDtF,MAAA,GAAA6nO,GAAA,sCAUN7nO,YAGIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,oBAEZA,MAAA,GAAA8nO,GAAA,qBAUR9nO,cAWAA,MAVA,GAAA+nO,GAAA,cAUA/nO,CAVoD,GAAAgoO,GAAA,eAmBtDhoO,QAGIA,MAFJ,YAEIA,CAFoD,YAEpDA,CADgE,gBACxBA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAAq2B,SAAQ,GACvDhkC,MAAA,0BACFA,QACAA,MAAA,gBAMEA,MAAA,mBAAAA,aAAAyK,GAAAzK,MAAS2N,EAAAg6N,WAAAh6N,EAAAoxB,KAAAz5B,OAAsB,GAE/BtF,MAAA,0BAGNA,kDAtGEA,cAAA,IAAAA,MAAA,+CAGuBA,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,MAMf/+B,MAAA,GAAAA,MAAA,cAAAA,MAAA,iCAEAA,MAAA,kBAAAioO,GAOgCjoO,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAA05N,0BAiBhCrnO,MAAA,GAAAA,MAAA,kBAAAqnF,GAOgCrnF,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAA05N,0BAcbrnO,MAAA,GAAAA,MAAA,UAAA2N,EAAA25N,kBAUpBtnO,cAAA,OAAA2N,EAAA3K,OAAA2K,EAAAq5N,cAAAr5N,EAAAs5N,cAUAjnO,cAAA,OAAA2N,EAAA3K,OAAA2K,EAAAq5N,eAAAr5N,EAAAs5N,cAaHjnO,MAAA,GAAAA,MAAA,IAAAA,MAAA,6CAOAA,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,KAAA4F,OAGA3kC,cAAA,IAAAA,MAAA,0DC3DF8W,MACAC,MACAskB,KAAW92B,oBACX43B,KAAmB53B,UACnBskB,MAAkBlkB,MAClB82B,MAAc72B,MACd22B,MAAqBhoB,MAAAE,MAAAF,MACrBF,KACA0V,MACA9a,KAAgByF,KAChBoV,MAAe4S,MACf1tB,MAAa4tB,MACb7tB,KACAiJ,MACA7I,KAAe2tB,KACfxtB,KACAC,KAAiBytB,MAAAvtB,OAAA,ibAGRy4N,CAAyB,8DCvDlClnO,MAAA,qCAQEA,MAAA,iBAAAqW,GAAArW,aAAAyK,GAAAzK,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,cACFA,aALEA,MAAA,aAAAA,MAAA,0FAMFA,MAAA,mCAOEA,MAAA,iBAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAA4nM,yBAAA7xN,GAAgC,GAEzCrW,MAAA,cAAUA,MAAA,YACZA,eALEA,MAAA,aAAAA,MAAA,8DAOFA,MAAA,cAMEA,MAAA,cACFA,SCCG,IAAMmoO,GAA0B,MAAjC,MAAOA,EAIF/J,QAKA/+M,IAEC+oN,cAAgB,IAAIl8N,MAK9B,SAAI1B,GACF,SAAO2S,OAAeve,KAAKw/N,QAC7B,CAEA8J,yBAAyB5/M,GACvBA,EAAM+E,kBACNzuB,KAAKwpO,cAAcp7N,MACrB,4CAvBWm7N,EAA0B,+BAA1BA,EAA0Bj7N,UAAA,+BAAAC,OAAA,CAAAixN,QAAA,UAAA/+M,IAAA,OAAAjS,QAAA,CAAAg7N,cAAA,iBAAA/6N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,gtBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDpCrC1N,MADF,kBACEA,CADa,YAEXA,MAAA,GACFA,QACAA,MAAA,WAyBEA,MAxBA,EAAAqoO,GAAA,iBAwBAroO,CAfC,EAAAsoO,GAAA,eAeDtoO,CAJC,EAAAuoO,GAAA,gBAaLvoO,iBApCIA,MAAA,GAAAA,MAAA,IAAA2N,EAAAnD,MAAA,KAIGxK,MAAA,GAAAA,MAAA,OAAA2N,EAAAywN,QAAA/B,kBAYAr8N,cAAA,OAAA2N,EAAAywN,QAAA3M,WAaAzxN,cAAA,QAAA2N,EAAAywN,QAAA3M,2BCFHzjN,MAAazJ,wBACbwJ,KACAK,KAAa5J,KACbyJ,KAAgBxJ,KAChB0J,KAAezJ,KACf6J,KAAiB5J,MAAA8J,OAAA,wGAAAC,gBAAA,WAGRy5N,CAA0B,8CCnCnCnoO,MAAA,gCAMEA,MADA,iCAAAwoO,EAAAxoO,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAAiBsgC,EAAAmoM,gBAAAD,GAAwB,EACzCxoO,CAD0C,0BAAAwoO,EAAAxoO,MAAAyK,GAAA0E,UAAAmxB,EAAAtgC,QAAA,OAAAA,MAChCsgC,EAAAooM,gBAAAF,GAAwB,GAEpCxoO,8CAJEA,MADA,MAAAsgC,EAAAjhB,IACArf,CADW,UAAAwoO,6CAUfxoO,MADF,UACEA,CADmD,mCAMjDA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAoxB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAqoM,mBAAkB,GAE3B3oO,MAAA,wBACAA,MAAA,cAAUA,MAAA,iBAEdA,kBARIA,cAAA,aAAAA,MAAA,uCAKAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,4CCiCG,IAAM4oO,GAAsB,MAA7B,MAAOA,EAgDDt1J,oBACA9yE,eACAu6C,eACA7jC,OA/CDpI,MAKAuQ,IAKAwpN,mBAA6B,EAK7BtB,mBAAgC,GAK/BuB,oBAAsB,IAAI58N,MAKpC68N,gBAAiB,EAETC,gBAER,iBAAIC,GACF,OAAQrqO,KAAKm8C,eAAej8C,IAAI,kBAAoB,EACtD,CACA,iBAAImqO,CAAchL,GAChBr/N,KAAKm8C,eAAe97C,IAAI,gBAAiBg/N,EAC3C,CAEA,qBAAIiL,GACF,OAAOtqO,KAAKm8C,eAAej8C,IAAI,oBAAqB0G,MAAaulE,QACnE,CACA,qBAAIm+J,CAAkBp4N,GACpBlS,KAAKm8C,eAAe97C,IAAI,oBAAqB6R,EAAItL,MAAaulE,QAChE,CAEApsE,YACU20E,EACA9yE,EACAu6C,EACA7jC,GAHAtY,KAAA00E,sBACA10E,KAAA4B,iBACA5B,KAAAm8C,iBACAn8C,KAAAsY,QACP,CAKH/K,WAGE,GAFAvN,KAAKkQ,MAAMM,MAAM1J,QAEb9G,KAAKsqO,kBAAmB,CAC1B,MAAMC,EAAkBvqO,KAAKkQ,MAC1B+R,MACAG,KAAMyV,GAASA,EAAK3lB,KAAOlS,KAAKsqO,mBAC/BC,GACFvqO,KAAK8pO,gBAAgBS,EAEzB,CACAvqO,KAAK2oO,mBAAqB3oO,KAAK2oO,mBAAmBloN,IAAKuZ,IACrDA,EAAE9nB,GAAKpJ,MAAIC,SAASixB,EAAEx2B,MAAQ,UAASytK,OAAej3I,EAAEz3B,MACxDy3B,EAAEpuB,MAAoB,KAAZouB,EAAEpuB,OAAiBouB,EAAEpuB,MAAgBouB,EAAEpuB,MAAVouB,EAAEz3B,IAClCy3B,GAEX,CAEAwwM,cACE,OAAOxqO,KAAKkQ,MAAMC,KAAKO,MACzB,CAOAo5N,gBAAgBtK,GACdx/N,KAAKkQ,MAAMM,MAAMmP,OACf6/M,EACA,CACEh3M,UAAU,EACV4oB,SAAS,IAEX,GAEFpxC,KAAKsqO,kBAAoB9K,EAAQttN,GACjClS,KAAKkqO,oBAAoB97N,KAAK,CAAEoa,UAAU,EAAMg3M,WAClD,CAEQiL,2BACFzqO,KAAKoqO,iBACPpqO,KAAKoqO,gBAAgBj8N,aAEzB,CAEA46N,WAAWX,GACT,IAAKA,EACH,OAEF,IAAIl2N,EAAKpJ,MAAIC,QACXq/N,EAAa5kO,QAAOytK,OAAem3D,EAAa7lO,MAElD,MAAMmoO,EAAoB1qO,KAAK2oO,mBAAmBvmN,KAC/C4X,GAAMA,EAAE9nB,KAAOk2N,EAAal2N,IAG3Bw4N,IACFtC,EAAaxxK,QAAU8zK,EAAkB9zK,QACzCwxK,EAAa3K,iBAAmBiN,EAAkBjN,iBAClDvrN,EAAKw4N,EAAkBx4N,IAGrBlS,KAAKkQ,MAAMhQ,IAAIgS,GACjBlS,KAAK4B,eAAe8D,MAClB,yCACA,yCAIJ1F,KAAKyqO,2BAELzqO,KAAKoqO,gBAAkBpqO,KAAK00E,oBACzB7G,gBACCu6J,EAAa5kO,KACb4kO,EAAa7lO,IACb6lO,EAAaxxK,SAEd7yD,QACCG,MAAYynC,IACV,GAAIA,EAAEvnC,MACJ,OAAApE,KAAK+pO,kBAAiB,EAAM3B,GAC5Bz8L,EAAEvnC,MAAMC,QAAS,EACVsnC,EAET,MAAA3rC,KAAK4B,eAAewC,MAClB,8BACA,wCACApC,EACA,CAAE0E,MAAO0hO,EAAa7lO,MAElBopC,KAGT9oC,UAAWirE,IACV,IAAIliE,EACAgrD,EACJ,OAAQwxK,EAAa5kO,MACnB,IAAK,MACHoI,EAAQw8N,EAAax8N,OAASkiE,EAAakyJ,QAAQxuJ,MACnD5a,EAAUwxK,EAAaxxK,SAAWkX,EAAalX,QAC/C,MACF,IAAK,aACL,IAAK,kBACL,IAAK,iBACHhrD,EAAQw8N,EAAax8N,OAASkiE,EAAa68J,QAC3C,MACF,IAAK,OACH/+N,EACEw8N,EAAax8N,OACbkiE,EAAam2J,sBAAsB2G,YACrC,MACF,QACEh/N,EAAQw8N,EAAax8N,MAGzB,MAAMi/N,GAAetuN,MAAY+0D,gBAC/B9qE,OAAO6H,OACL,GACAq8N,EACAnuN,MAAY+0D,gBAAgB,CAC1Bp/D,KACAtG,QACArJ,IAAK6lO,EAAa7lO,IAClBiB,KAAM4kO,EAAa5kO,MAAQ,MAC3Bi6N,iBAAkB2K,EAAa3K,mBAAoB,EACnD5K,WAAW,EACXj8J,cAIN52D,KAAKkQ,MAAMmV,OAAOwlN,IAClB,MAAMC,GAAc9qO,KAAKqqO,cAAcxmN,MAAM,GAC7CinN,GAAYxjO,KAAKujO,IACjB7qO,KAAKqqO,cAAgBS,GACrB9qO,KAAKyqO,0BAAwB,GAEnC,CAEAv8N,cACElO,KAAKyqO,0BACP,CAEAZ,gBAAgBrK,GACdx/N,KAAKkQ,MAAMlH,OAAOw2N,GAClBx/N,KAAKqqO,cAAgBrqO,KAAKqqO,cACvBxmN,MAAM,GACNna,OAAQswB,GAAMA,EAAE9nB,KAAOstN,EAAQttN,GACpC,CAEA63N,iBAAiB3lO,EAAQgkO,GACLpoO,KAAKsY,OAAOC,KAAK+vN,GAA2B,CAC5DppM,MAAO,QACPj7B,KAAM,CACJ0kO,mBAAoB3oO,KAAK2oO,mBACzBz4N,MAAOlQ,KAAKkQ,MACZ9L,QACAgkO,kBAIMvvN,cAAchW,UAAW28N,IACjCx/N,KAAK+oO,WAAWvJ,EAAO,EAE3B,4CA7NWwK,GAAsB5oO,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAAA0E,OAAA,+BAAtBkkO,EAAsB17N,UAAA,0BAAAC,OAAA,CAAA2B,MAAA,QAAAuQ,IAAA,MAAAwpN,kBAAA,oBAAAtB,mBAAA,sBAAAn6N,QAAA,CAAA07N,oBAAA,uBAAAz7N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,iRAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDvDnC1N,MAAA,gBACEA,MAAA,EAAA2pO,GAAA,sCAWF3pO,QAEAA,MAAA,EAAA4pO,GAAA,oBAdU5pO,MAAA,iBACuBA,cAAA,UAAAA,MAAA,IAAA2N,EAAAy7N,gBAa3BppO,MAAA,GAAAA,MAAA,OAAA2N,EAAAk7N,mCC6BFr3L,KACAn+B,KACA80N,GACAr4L,KACA/hC,KACAI,KAAexJ,KACfsJ,KAAgBrJ,KAChBwJ,KAAamF,KACbjF,KACAC,KAAiBkF,MAAAhF,OAAA,uKAAAC,gBAAA,WAGRk6N,CAAsB,iGCxCjC5oO,MADF,UACEA,CAD0D,gDAGxDA,MAAA,yBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,EAAAlK,qBAAAkK,EAAA02F,aAAAvqF,KAAAnM,EAAA02F,aAAAvqF,GAAArW,MAAAqW,EAAA,GAEArW,MAAA,yBAIEA,MAAA,wBACFA,QACAA,MAAA,yBAIEA,MAAA,wBACFA,QACAA,MAAA,yBAIEA,MAAA,0BAGNA,oCAtBIA,cAAA,gBAAAY,IAAAZ,MAAA,IAAAkK,EAAAomM,SACAtwM,MAAA,UAAAkK,EAAA02F,cAIE5gG,MAAA,GAAAA,MAAA,WAAAkK,EAAAukM,cAAAnnM,QAAA,YAEAtH,cAAA,IAAAA,MAAA,oCAIAA,MAAA,GAAAA,MAAA,WAAAkK,EAAAukM,cAAAnnM,QAAA,iBAEAtH,cAAA,IAAAA,MAAA,mCAIAA,MAAA,GAAAA,MAAA,WAAAkK,EAAAukM,cAAAnnM,QAAA,cAEAtH,cAAA,IAAAA,MAAA,iFAMJA,MADF,qBACEA,CAD8D,aAK5DA,MAAA,yBAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,EAAAlK,qBAAAkK,EAAAqgM,UAAAl0L,KAAAnM,EAAAqgM,UAAAl0L,GAAArW,MAAAqW,EAAA,GAJFrW,QAMAA,MAAA,iBAAwCA,MAAA,aAAOA,QAC/CA,MAAA,aAAyCA,MAAA,wBAG3CA,kCAPIA,cAAA,cAAAkK,EAAA0mM,sBACA5wM,MAAA,UAAAkK,EAAAqgM,WAEkBvqM,cAAA,mBACqBA,MAAA,GAAAA,YAAA,gCCOpC,IAAM6pO,GAAN,MAAMA,GAqGSl5N,MApGX2/L,OAA2C,IAAI3vM,UACtDC,GAGM2vM,QAER,uBAAIv7D,CAAoB1vI,GACtB1G,KAAK4rM,qBAAuBllM,EAC5B1G,KAAK+R,MAAM4K,eACb,CAEA,uBAAIy5H,GACF,OAAOp2I,KAAK4rM,oBACd,CACQA,sBAAuB,EAE/B,wBAAIH,CAAqB/kM,GACvB1G,KAAK6rM,sBAAwBnlM,EAC7B1G,KAAK+R,MAAM4K,eACb,CAEA,wBAAI8uL,GACF,OAAOzrM,KAAK6rM,qBACd,CACQA,uBAAwB,EAKvB9rK,YAKAtf,IAET,gBACIuhF,CAAat7F,GACf1G,KAAKkrO,cAAcvoO,KAAK+D,EAC1B,CACA,gBAAIs7F,GACF,OAAOhiG,KAAKkrO,cAAcxkO,KAC5B,CACSwkO,cAAuC,IAAInpO,UAClDC,GAMO8vM,mBAA6B,EAK7BjC,cAA0B,CAAC,QAAS,aAAc,WAKlDkC,gBAA0B,EAKnC,aACIpG,CAAUjlM,GACZ1G,KAAK8vM,WAAWntM,KAAK+D,EACvB,CACA,aAAIilM,GACF,OAAO3rM,KAAK8vM,WAAWppM,KACzB,CACSopM,WAAsC,IAAI/tM,KAAgB,GAK1DiwM,qBAA+B,GAK/Bn/D,SAAmB,EAKnBm5D,eAAyC,GAKzCxwF,UAMA4wF,aAETrsM,YAAoBgS,GAAA/R,KAAA+R,OAA2B,CAM/CxE,WACEvN,KAAK0xM,OAAO/uM,KACV3C,KAAK+/B,YAAYr5B,MAAQ1G,KAAK+/B,YAAYr5B,WAAQ1E,GAEpDhC,KAAK2xM,QAAU3xM,KAAK+/B,YAAYxH,aAAa11B,UAC1C6D,IACC1G,KAAK0xM,OAAO/uM,KAAK+D,QAAgB1E,EAAS,EAGhD,CAMAkM,cACElO,KAAK2xM,QAAQxjM,aACf,4CA5HW88N,IAA0B7pO,aAAA,+BAA1B6pO,GAA0B38N,UAAA,8BAAAC,OAAA,CAAAwxB,YAAA,cAAAtf,IAAA,MAAAuhF,aAAA,eAAA8vG,kBAAA,oBAAAjC,cAAA,gBAAAkC,eAAA,iBAAApG,UAAA,YAAAqG,qBAAA,uBAAAn/D,QAAA,UAAAm5D,eAAA,iBAAAxwF,UAAA,YAAA4wF,aAAA,gBAAA39L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,kjBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDvDvC1N,MAAA,uEAwCAA,MA1BA,EAAA+pO,GAAA,cA0BA/pO,CA1B4D,EAAAgqO,GAAA,+BAJ1DhqO,MATA,cAAA2N,EAAAgxB,YASA3+B,CAT2B,MAAA2N,EAAA0R,IAS3Brf,CARW,eAAAA,MAAA,KAAA2N,EAAAm8N,eAQX9pO,CAPsC,YAAAA,MAAA,KAAA2N,EAAA+gM,YAOtC1uM,CANgC,UAAA2N,EAAA8jI,QAMhCzxI,CALmB,sBAAA2N,EAAAqnI,oBAKnBh1I,CAJ2C,uBAAA2N,EAAA08L,qBAI3CrqM,CAH6C,iBAAA2N,EAAAi9L,eAG7C5qM,CAFiC,YAAA2N,EAAAysG,UAEjCp6G,CADuB,eAAA2N,EAAAq9L,cAKnBhrM,MAAA,GAAAA,MAAA,OAAA2N,EAAA+iM,mBA0BW1wM,cAAA,OAAA2N,EAAAgjM,gCCGb/G,EACAvuK,KAAW92B,oBACX43B,KAAmB53B,KACnBwJ,KACA87C,MAAqBrlD,YACrBqkB,MAAkBpkB,kBAClBg3B,MAAc/2B,MACd0J,KAAazJ,KACb2J,KACAC,KAAiB3J,MAAA6J,OAAA,oVAAAC,gBAAA,KAGRm7N,MAA0BxoM,OAAA,IApBtCrB,OAAsB,aAAU,EAACiC,GAAAC,IAAA,qBAyHLC,SArGhB0nM,4KCVN,IAAMI,GAAY,MAAnB,MAAOA,+CAAY,8BAAZA,qCAzBX1/G,KACAuC,KACAM,KAMAgC,KAEAS,KAEAQ,KAEAoe,KACAc,eAUW06F,CAAY,6LCpCnBjqO,MAAA,eAAgDA,MAAA,6CAO9CA,eAP8CA,oBAAA,uCAAAA,MAAA,EAAAoW,GAAApW,MAAA,0DAkBhDA,MAAA,eAAmDA,MAAA,6CAOjDA,eAPiDA,oBAAA,uCAAAA,MAAA,EAAA+zC,GAAA/zC,MAAA,gEAkBnDA,MAAA,eAAkDA,MAAA,6CAOhDA,8BAPgDA,oBAAA,uCAAAA,MAAA,EAAAg0C,GAAAh0C,MAAA,iCAAAqnB,EAAA6iN,wCA0D9ClqO,MAAA,GAGEA,MAAA,gEAAAA,cAAA,IAAAA,MAAA,yCAAAmqO,EAAA7kO,OAAA,gCAMFtF,MAAA,GAGEA,MAAA,uDAAAA,cAAA,IAAAA,MAAA,YAAAqnB,EAAA01D,aAAA,0HAhBJ/8E,MAAA,mBAaEA,MATA,EAAAoqO,GAAA,qBASApqO,CAPC,EAAAqqO,GAAA,sBAiBHrqO,kCArBEA,MAAA,QAAAmqO,EAAAhlO,KAGGnF,cAAA,QAAAA,MAAA,EAAA+/B,IAAAnJ,SAAAuzM,EAAA7kO,QASAtF,cAAA,OAAAA,MAAA,EAAA+/B,IAAAnJ,SAAAuzM,EAAA7kO,mCAsBLtF,MAAA,mBAIEA,MAAA,GACFA,kCAHEA,MAAA,QAAAsqO,EAAAnlO,KAEAnF,cAAA,IAAAsqO,EAAAhlO,MAAA,gCAiBFtF,MAAA,mBAIEA,MAAA,wBAGFA,kCALEA,MAAA,QAAAuqO,EAAAplO,KAEAnF,cAAA,IAAAA,MAAA,sCAAAuqO,EAAAjlO,OAAA,gCAkBFtF,MAAA,mBAIEA,MAAA,GACFA,kCAHEA,MAAA,QAAAwqO,EAAArlO,KAEAnF,cAAA,IAAAwqO,EAAAllO,MAAA,gCAiBFtF,MAAA,mBACEA,MAAA,GACFA,kCAFmDA,MAAA,QAAAyqO,GACjDzqO,cAAA,IAAAyqO,EAAA,gCAiBFzqO,MAAA,mBAIEA,MAAA,wBACFA,kCAHEA,MAAA,QAAA0qO,EAAAvlO,KAEAnF,cAAA,IAAAA,MAAA,yBAAA0qO,EAAAplO,OAAA,MCxKH,IAAMqlO,GAAkB,MAAzB,MAAOA,EAgMDv2M,YACAxjB,aAhMHmuB,KACA6rM,cAAgBn9E,MAChBo9E,aAAeroF,MACfsoF,aAAen9E,MACfhrE,YAAc,IAAIirE,OAClBm9E,aAAel9E,MACfm9E,gBAAkB72I,MAClB82I,gBAAiB,EAEf7gO,UAET,eACI8gO,GACF,OAAOtsO,KAAKusO,iBAAiB7lO,KAC/B,CACA,eAAI4lO,CAAY5lO,GACd1G,KAAKusO,iBAAiBh1M,SAAS7wB,GAASuoJ,MAAqBu9E,KAAM,CACjEC,UAAU,GAEd,CAEA,gBACItuJ,GACF,OAAOn+E,KAAKk+M,kBAAkBx3M,KAChC,CACA,gBAAIy3E,CAAaz3E,GACf1G,KAAKk+M,kBAAkB3mL,SAAS7wB,GAASmoJ,MAAkB69E,IAAK,CAC9DD,UAAU,GAEd,CAEA,eACItpF,GACF,OAAOnjJ,KAAK2sO,iBAAiBjmO,KAC/B,CACA,eAAIy8I,CAAYz8I,GACd1G,KAAK2sO,iBAAiBp1M,SAAS7wB,GAASk9I,MAAiBgpF,OAAQ,CAC/DH,UAAU,GAEd,CAEA,eACI53I,GACF,OAAO70F,KAAK6sO,iBAAiBnmO,KAC/B,CACA,eAAImuF,CAAYnuF,GACd1G,KAAK6sO,iBAAiBt1M,SAAS7wB,GAASqoJ,MAAiB+9E,UAAW,CAClEL,UAAU,GAEd,CAEA,cACInxK,GACF,OAAOt7D,KAAK+sO,gBAAgBrmO,KAC9B,CACA,cAAI40D,CAAW50D,GACb1G,KAAK+sO,gBAAgBx1M,SAAS7wB,GAAU,KAAiC,CACvE+lO,UAAU,GAEd,CAEA,kBACIppF,GACF,OAAOrjJ,KAAKgtO,oBAAoBtmO,KAClC,CACA,kBAAI28I,CAAe38I,GACjB1G,KAAKgtO,oBAAoBz1M,SAAS7wB,GAAS6uF,MAAoBC,KAAM,CACnEi3I,UAAU,GAEd,CAEA,SACI7gO,GACF,OAAO5L,KAAKitO,WAAWvmO,KACzB,CACA,SAAIkF,CAAMlF,GACR1G,KAAKitO,WAAW11M,SAAS7wB,EAAO,CAAE+lO,UAAU,GAC9C,CACA,YACI9oF,GACF,OAAO3jJ,KAAKktO,cAAcxmO,KAC5B,CACA,YAAIi9I,CAASj9I,GACX1G,KAAKktO,cAAc31M,SAAS7wB,EAAO,CAAE+lO,UAAU,GACjD,CACA,WACItoF,GACF,OAAOnkJ,KAAKmtO,aAAazmO,KAC3B,CACA,WAAIy9I,CAAQz9I,GACV1G,KAAKmtO,aAAa51M,SAAS7wB,EAAO,CAAE+lO,UAAU,GAChD,CACA,kBACIjlF,GACF,OAAOxnJ,KAAKotO,oBAAoB1mO,KAClC,CACA,kBAAI8gJ,CAAe9gJ,GACjB1G,KAAKotO,oBAAoB71M,SAAS7wB,EAAO,CAAE+lO,UAAU,GACvD,CACA,aACIhlF,GACF,OAAOznJ,KAAKqtO,eAAe3mO,KAC7B,CACA,aAAI+gJ,CAAU/gJ,GACZ1G,KAAKqtO,eAAe91M,SAAS7wB,EAAO,CAAE+lO,UAAU,GAClD,CACA,cACItO,GACF,OAAOn+N,KAAKstO,gBAAgB5mO,KAC9B,CACA,cAAIy3N,CAAWz3N,GACb1G,KAAKstO,gBAAgB/1M,SAAS7wB,EAAO,CAAE+lO,UAAU,GACnD,CAEA,aACIxmF,GACF,OAAOjmJ,KAAKutO,eAAe7mO,KAC7B,CACA,aAAIu/I,CAAUv/I,GACZ1G,KAAKutO,eAAeh2M,SAAS7wB,EAAO,CAAE+lO,UAAU,GAClD,CAEA,aACIe,GACF,OAAOxtO,KAAKytO,oBAAoB/mO,KAClC,CACA,aAAI8mO,CAAU9mO,GACZ1G,KAAKytO,oBAAoBl2M,SAAS7wB,EAAO,CAAE+lO,UAAU,GACvD,CAEA,qBAAIvuB,GACF,OAAQl+M,KAAKmgC,KAAK7I,SAAiB6mD,YACrC,CAEA,oBAAIwuJ,GACF,OAAQ3sO,KAAKmgC,KAAK7I,SAAiB6rH,WACrC,CAEA,oBAAIopF,GACF,OAAQvsO,KAAKmgC,KAAK7I,SAAiBg1M,WACrC,CAEA,oBAAIO,GACF,OAAQ7sO,KAAKmgC,KAAK7I,SAAiBu9D,WACrC,CAEA,mBAAIk4I,GACF,OAAQ/sO,KAAKmgC,KAAK7I,SAAiBgkC,UACrC,CAEA,gBAAI6xK,GACF,OAAQntO,KAAKmgC,KAAK7I,SAAiB6sH,OACrC,CAEA,uBAAIipF,GACF,OAAQptO,KAAKmgC,KAAK7I,SAAiBkwH,cACrC,CAEA,kBAAI6lF,GACF,OAAQrtO,KAAKmgC,KAAK7I,SAAiBmwH,SACrC,CAEA,mBAAI6lF,GACF,OAAQttO,KAAKmgC,KAAK7I,SAAiB6mM,UACrC,CAEA,kBAAIoP,GACF,OAAQvtO,KAAKmgC,KAAK7I,SAAiB2uH,SACrC,CAEA,uBAAIwnF,GACF,OAAQztO,KAAKmgC,KAAK7I,SAAiBk2M,SACrC,CAEA,cAAIP,GACF,OAAQjtO,KAAKmgC,KAAK7I,SAAiB1rB,KACrC,CAEA,iBAAIshO,GACF,OAAQltO,KAAKmgC,KAAK7I,SAAiBqsH,QACrC,CAEA,uBAAIqpF,GACF,OAAQhtO,KAAKmgC,KAAK7I,SAAiB+rH,cACrC,CAEU86D,OAAqC,IAAI7wM,MAEnDg+N,UAAoB,IAEpBvrO,YACUy1B,EACAxjB,GADAhS,KAAAw1B,cACAx1B,KAAAgS,eAERhS,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCr1B,MAAO,CAAC,GAAI,CAACm5B,KAAWo0H,UAAU,GAAIp0H,KAAWumM,UAAU,OAC3D3nF,SAAU,CAAC,GAAI,CAAC5+G,KAAWo0H,UAAU,GAAIp0H,KAAWumM,UAAU,OAC9DnnF,QAAS,CACP,GACA,CAACp/G,KAAWo0H,UAAU,GAAIp0H,KAAWumM,UAAUtrO,KAAKsrO,aAEtDntJ,aAAc,CAAC,GAAI,CAACp5C,KAAW/C,WAC/BmhH,YAAa,CAAC,GAAI,CAACp+G,KAAW/C,WAC9BsqM,YAAa,CAAC,GAAI,CAACvnM,KAAW/C,WAC9Bs5B,WAAY,CAAC,GAAI,CAACv2B,KAAW/C,WAC7B6yD,YAAa,CAAC,GAAI,CAAC9vD,KAAW/C,WAC9BqhH,eAAgB,CAAC,GAAI,CAACt+G,KAAW/C,WACjCwlH,gBAAgB,EAChBC,WAAW,EACX02E,YAAY,EACZl4E,UAAW,CAAC,CAAE7wI,OAAQpV,KAAKqsO,iBAC3B7nF,gBAAgB,GAEpB,CAEAj3I,WACEvN,KAAKutO,eAAeh2M,UAAS,GACzBv3B,KAAKgS,aAAasZ,aACpBtrB,KAAK+jF,YAAc/jF,KAAK+jF,YAAYr6E,OACjC4xD,GAA8B,QAAfA,GAGtB,CAEA/P,iBAAiBtnD,EAAoB2wG,GACnC3wG,EAAKooO,eAAiBrsO,KAAKqsO,eACvBz3H,GACF50G,KAAKm+M,OAAO/vM,KAAKnK,EAErB,CAEAypO,sBACuC,UAAjC1tO,KAAKk+M,kBAAkBx3M,OACzB1G,KAAKqsO,gBAAiB,EACtBrsO,KAAKmtO,aAAaQ,kBAClB3tO,KAAKmtO,aAAajnM,0BAElBlmC,KAAKqsO,gBAAiB,CAE1B,CAEAuB,sBACE,OAAQ5tO,KAAKmjJ,aACX,KAAKS,MAAiBE,GAEpB9jJ,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,KAAKlpF,MAAiBC,GAEpB7jJ,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,KAAKlpF,MAAiBiqF,GAEpB7tO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,KAAKlpF,MAAiBkqF,GAEpB9tO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,KAAKlpF,MAAiBmqF,GAEpB/tO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,KAAKlpF,MAAiBoqF,GAEpBhuO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,GAC1D,MACF,KAAKlpF,MAAiBgpF,OAEpB5sO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAC1D,MACF,QAEE9sO,KAAKsrO,UACHtrO,KAAK60F,cAAgBk6D,MAAiB+9E,UAAY,IAAM,IAI9D9sO,KAAKmtO,aAAa1oM,cAAc,CAACM,KAAWumM,UAAUtrO,KAAKsrO,aAC3DtrO,KAAKmtO,aAAajnM,wBACpB,4CAhSW6lM,GAAkB3qO,MAAAuE,MAAAvE,MAAAwE,OAAA,+BAAlBmmO,EAAkBz9N,UAAA,qBAAAC,OAAA,CAAA/C,UAAA,YAAA8gO,YAAA,cAAAnuJ,aAAA,eAAAglE,YAAA,cAAAtuD,YAAA,cAAAv5B,WAAA,aAAA+nF,eAAA,iBAAAz3I,MAAA,QAAA+3I,SAAA,WAAAQ,QAAA,UAAAqD,eAAA,iBAAAC,UAAA,YAAA02E,WAAA,aAAAl4E,UAAA,YAAAunF,UAAA,aAAAh/N,QAAA,CAAA2vM,OAAA,UAAA1vM,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,IAAAC,OAAA,ymCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDlDzB1N,MAHN,WAGMA,CAHoC,UAGpCA,CAF6B,mBAE7BA,CADc,eACHA,MAAA,wBAA2CA,QACtDA,MAAA,kCAKAA,MAAA,EAAA6sO,GAAA,mBASJ7sO,UAGIA,MAFJ,UAEIA,CAF6B,oBAE7BA,CADc,gBACHA,MAAA,0BAA8CA,QACzDA,MAAA,oCAKAA,MAAA,GAAA8sO,GAAA,mBASJ9sO,UAGIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,gBACHA,MAAA,0BAA6CA,QACxDA,MAAA,oCAKAA,MAAA,GAAA+sO,GAAA,mBASJ/sO,UAIIA,MAFJ,WAEIA,CAFoD,WAEpDA,CADwC,yBAMtCA,MAAA,0BACFA,QACAA,MAAA,yBAKEA,MAAA,0BACFA,QACAA,MAAA,0BAMEA,MAAA,0BACFA,QACAA,MAAA,0BAKEA,MAAA,0BAGNA,YAIIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,gBACHA,MAAA,0BAETA,QACFA,MAAA,0CAIEA,MAAA,GAAAgtO,GAAA,0CA0BNhtO,YAIIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,gBACHA,MAAA,0BAAkDA,QAC7DA,MAAA,0CACEA,MAAA,oCAAmB2N,EAAA2+N,qBAAqB,GAIxCtsO,MAAA,GAAAitO,GAAA,0CAQNjtO,YAOIA,MALJ,WAKIA,CAFH,oBAEGA,CADc,gBACHA,MAAA,0BAAiDA,QAC5DA,MAAA,0CACEA,MAAA,oCAAmB2N,EAAA6+N,qBAAqB,GAIxCxsO,MAAA,GAAAktO,GAAA,0CAUNltO,YAOIA,MALJ,WAKIA,CAFH,oBAEGA,CADc,gBACHA,MAAA,0BAAiDA,QAC5DA,MAAA,0CAIEA,MAAA,GAAAmtO,GAAA,0CAQNntO,YAIIA,MAFJ,WAEIA,CAF6B,oBAE7BA,CADc,gBAEXA,MAAA,gDAEEA,QAELA,MAAA,0CAIEA,MAAA,GAAAotO,GAAA,qBAKNptO,YAOIA,MALJ,WAKIA,CAFH,oBAEGA,CADc,gBACHA,MAAA,0BAAiDA,QAC5DA,MAAA,0CACEA,MAAA,oCAAmB2N,EAAA6+N,qBAAqB,GAIxCxsO,MAAA,GAAAqtO,GAAA,0CAQNrtO,YAGEA,MADF,YACEA,CAD0D,kCAKxDA,MAAA,0BAAS2N,EAAAw8C,iBAAAx8C,EAAAoxB,KAAAz5B,MAAAqI,EAAAoxB,KAAA4F,MAAwC,GAEjD3kC,MAAA,0BAGNA,mBA7OuBA,MAAA,YAAA2N,EAAAoxB,MAGN/+B,MAAA,GAAAA,YAAA,iCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,iCAEUA,MAAA,GAAAA,MAAA,aAAA2N,EAAAk+N,WAAAptM,OAAA,KAAA9wB,EAAAk+N,WAAAptM,OAAA6uM,WAYDttO,MAAA,GAAAA,YAAA,qCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qCAEUA,MAAA,GAAAA,MAAA,aAAA2N,EAAAm+N,cAAArtM,OAAA,KAAA9wB,EAAAm+N,cAAArtM,OAAA6uM,WAYDttO,MAAA,GAAAA,YAAA,oCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,oCAEUA,MAAA,GAAAA,MAAA,aAAA2N,EAAAo+N,aAAAttM,OAAA,KAAA9wB,EAAAo+N,aAAAttM,OAAA6uM,WAgBVttO,MAAA,GAAAA,MAAA,0BAEAA,cAAA,IAAAA,MAAA,+CAKAA,MAAA,GAAAA,MAAA,0BAEAA,cAAA,IAAAA,MAAA,0CAMAA,MAAA,GAAAA,MAAA,UAAA2N,EAAAs9N,eAAA,WADAjrO,MAAA,0BAGAA,cAAA,IAAAA,MAAA,0CAKAA,MAAA,GAAAA,MAAA,0BAEAA,cAAA,IAAAA,MAAA,+CAOSA,MAAA,GAAAA,YAAA,2CAKTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,2CAG6BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAq9N,kBA6BpBhrO,MAAA,GAAAA,YAAA,yCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,yCAG2BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAi9N,gBAW/B5qO,MAAA,GAAAA,MAAA,UAAA2N,EAAAs9N,eAAA,gBAGajrO,MAAA,GAAAA,YAAA,wCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,wCAG0BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAk9N,eAa9B7qO,MAAA,GAAAA,MAAA,UAAA2N,EAAAs9N,eAAA,gBAGajrO,MAAA,GAAAA,YAAA,wCAGTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,wCAG0BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,MAAA2N,EAAAo9N,eAYzB/qO,MAAA,GAAAA,MAAA,GAAAA,MAAA,2CAAAA,MAAA,+CAMDA,MAAA,GAAAA,MAAA,cAAAA,MAAA,uCAEmCA,MAAA,GAAAA,MAAA,UAAA2N,EAAAg1E,aASvC3iF,cAAA,UAAA2N,EAAAs9N,eAAA,gBAGajrO,MAAA,GAAAA,YAAA,wCAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,wCAG0BA,MAAA,GAAAA,MAAA,UAAAA,MAAA,OAAA2N,EAAAm9N,eAa5B9qO,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,KAAA4F,OAAA3kC,MAAA,OAAA2N,EAAAvD,YAGApK,MAAA,GAAAA,MAAA,IAAAA,MAAA,yDCpMFq7B,KAAW92B,oBACX43B,KAAmB53B,UACnBskB,MAAkBpkB,kBAClBg3B,MAAc/2B,MACdqJ,KACAwkF,MAAoB5tF,MACpBmkB,MAAelkB,MAAA2O,MACfF,KACA0V,MACA5a,KAAesF,KACfnF,KACAsiD,KACAriD,KAAiBmF,MAAAjF,OAAA,mzBAGRk8N,CAAkB,gCC7BxB,IAAM4C,GAAc,MAArB,MAAOA,EAkESr6I,aAjEb9oF,UAAY,IAAIzJ,MAAgB,GAEvC,OACI0e,GACF,OAAOzgB,KAAKouH,IACd,CACA,OAAI3tG,CAAI/Z,GACN1G,KAAKouH,KAAO1nH,CACd,CACQ0nH,KAER,gBACIjwC,GACF,OAAOn+E,KAAK4uO,aACd,CACA,gBAAIzwJ,CAAaz3E,GACf1G,KAAK4uO,cAAgBloO,CACvB,CACQkoO,cAER,eACIzrF,GACF,OAAOnjJ,KAAK6uO,YACd,CACA,eAAI1rF,CAAYz8I,GACd1G,KAAK6uO,aAAenoO,CACtB,CACQmoO,aAER,eACIh6I,GACF,OAAO70F,KAAK8uO,YACd,CACA,eAAIj6I,CAAYnuF,GACd1G,KAAK8uO,aAAepoO,CACtB,CACQooO,aAER,eACIxC,GACF,OAAOtsO,KAAK+uO,YACd,CACA,eAAIzC,CAAY5lO,GACd1G,KAAK+uO,aAAeroO,CACtB,CACQqoO,aAER,kBACI1rF,GACF,OAAOrjJ,KAAKgvO,eACd,CACA,kBAAI3rF,CAAe38I,GACjB1G,KAAKgvO,gBAAkBtoO,CACzB,CACQsoO,gBAER,cACI1zK,GACF,OAAOt7D,KAAKivO,WACd,CACA,cAAI3zK,CAAW50D,GACb1G,KAAKivO,YAAcvoO,CACrB,CACQuoO,YAERlvO,YAAoBu0F,GAAAt0F,KAAAs0F,cAA6B,CAEjD/oC,iBAAiBtnD,GAGf,GAFAjE,KAAKwL,UAAU7I,MAAK,IAEQ,IAAxBsB,EAAKooO,eACPrsO,KAAKs0F,aACF4uD,MAAMljJ,KAAKygB,IAAKxc,GAChBF,QAAK6lD,MAAK,IACV/mD,UAAU,KACT7C,KAAKwL,UAAU7I,MAAK,EAAK,OAExB,CACL,IAAI4/I,EAAkB,EAElBt+I,EAAKk6N,YACP57E,IAEqC,SAAnCt+I,EAAKqoO,YAAYn0M,eACnBoqH,IAG0B,YAAxBt+I,EAAKo/I,gBACPd,IAGFviJ,KAAKs0F,aAAai0D,sBAAsBhG,GAExCviJ,KAAKs0F,aACF+2D,iBACCrrJ,KAAKygB,IACLxc,EAAKq3D,WACLr3D,EAAKqoO,YACLroO,EAAKujJ,eACLvjJ,EAAKwjJ,UACLxjJ,EAAK2H,MACL3H,EAAK0/I,SACL1/I,EAAKkgJ,QACLlgJ,EAAKgiJ,UACLhiJ,EAAKo/I,eACLp/I,EAAKugJ,gBAENzgJ,QAAK6lD,MAAK,IACV/mD,UAAU,KACT7C,KAAKwL,UAAU7I,MAAK,EAAK,EAE/B,CACF,4CAjHWgsO,GAAcvtO,MAAAuE,MAAA,+BAAdgpO,EAAcrgO,UAAA,gBAAAC,OAAA,CAAAkS,IAAA,MAAA09D,aAAA,eAAAglE,YAAA,cAAAtuD,YAAA,cAAAy3I,YAAA,cAAAjpF,eAAA,iBAAA/nF,WAAA,cAAA7sD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICxB3B1N,MAAA,sBAQEA,MAAA,kBAAAqW,GAAA,OAAU1I,EAAAw8C,iBAAA9zC,EAAwB,GAEpCrW,cAHEA,MANA,eAAA2N,EAAAovE,aAMA/8E,CAN6B,cAAA2N,EAAAo0I,YAM7B/hJ,CAL2B,cAAA2N,EAAA8lF,YAK3BzzF,CAJ2B,cAAA2N,EAAAu9N,YAI3BlrO,CAH2B,aAAA2N,EAAAusD,WAG3Bl6D,CAFyB,iBAAA2N,EAAAs0I,eAEzBjiJ,CADiC,YAAA2N,EAAAvD,0BDgBvBugO,IAAkBvpM,cAAA,WAEjBmsM,CAAc,0CEfrB,SAAUO,MACXpgJ,GAEH,MAAMtkF,EAAwB,CAC5B,CACEC,QAAS4pF,MACT1pF,SAAU0pF,UAEZP,UAGF,UAAWrwE,KAAUqrE,EACnBtkF,EAAUlD,QAAQmc,EAAOjZ,WAG3B,OAAOA,CACT,CCMO,IAAK2kO,GAAZ,SAAYA,GACVA,WAAAC,KAAA,UADUD,CAEZ,CAFA,CAAYA,IAAmB,2BCTxB,IAAME,GAAqB,MAA5B,MAAOA,UAA6BhiJ,KAwC9BiiJ,MACAC,QAxCV,WAAI1vO,GACF,OAAOG,KAAKyY,QACd,CAEA,WAAI5Y,CAAQ6G,GACV1G,KAAKyY,SAAW/R,CAClB,CAEA,cAAI8oO,GACF,OAAOxvO,KAAKyY,SAASuW,IACvB,CAEA,cAAIwgN,CAAW9oO,GACb1G,KAAKyY,SAASuW,KAAOtoB,CACvB,CAEA,WAAIo2C,GACF,OAAO98C,KAAKyY,SAASqkC,OACvB,CAEA,WAAIA,CAAQp2C,GACV1G,KAAKyY,SAASqkC,QAAUp2C,CAC1B,CAEA,OAAInE,GACF,MAAO,GAAGvC,KAAK88C,UAAU98C,KAAK+uF,oBAAoB//D,OACpD,CAEA,YAAImgE,GACF,OAAOnvF,KAAKyY,SAAS02E,QACvB,CAEA,YAAIA,CAASzoF,GACX1G,KAAKyY,SAAS02E,SAAWzoF,CAC3B,CAEQ+R,SAER1Y,YACUuvO,EACAC,GAERnpO,QAHQpG,KAAAsvO,QACAtvO,KAAAuvO,UAGRvvO,KAAKyY,SAAWzY,KAAKuvO,QAAQnvO,UAAU,0BAClCJ,KAAK88C,UACR98C,KAAK88C,QAAU,8BAGZ98C,KAAKwvO,aACRxvO,KAAKwvO,WAAa,kBAGfxvO,KAAKmvF,SAOHnvF,KAAKmvF,SAAS/sE,KAAMoxE,GAAYA,EAAQ7iD,WAC3C3wC,KAAKmvF,SAAS,GAAGx+C,SAAU,GAH7B3wC,KAAKmvF,SAAW,CAJoC,CAClDx+C,SAAS,EACT3hB,KAAM,WAQZ,CAEAygN,gBACE,OAAOzvO,KAAKwvO,UACd,CAEAzgJ,oBACE,OAAO/uF,KAAKmvF,SAAS/sE,KAAMoxE,GAAYA,EAAQ7iD,QACjD,CAEAu+C,8BACE,OAAOlvF,KAAKmvF,SAAS/sE,KAAMoxE,GAAYA,EAAQxE,cACjD,CAEA3yC,MACE6pC,EACAqO,EAAsC,IAEtC,MAAMm7I,EAAmB1vO,KAAK2vO,eAAep7I,GAC7C,OAAOv0F,KAAK4vO,SAAS1pJ,EAAawpJ,EACpC,CAEQE,SACN1pJ,EACAn/E,GAGA,OAAO/G,KAAKsvO,MACTpvO,IAFiBF,KAAKuC,IAEJ2jF,EAAYr8E,KAAK,KAAM,CACxC9C,WAEDhD,QAAK0c,KAAKk9B,GAAQ39C,KAAK6vO,kBAAkBlyL,IAC9C,CAEQkyL,kBAAkB79I,GACxB,MAAMiB,EAAgB,GACtBjB,SAAS8hF,OAAOv5J,QAAS8hC,IACvB42C,EAAc3rF,KAAKtH,KAAK8vO,YAAYzzL,EAAO21C,EAAS+9I,WAAU,GAEzD98I,CACT,CAEQ08I,eAAep7I,EAAsC,IAC3DA,SAAkBpB,kBACmBnxF,IAAnCuyF,EAAkBpB,cACdoB,EAAkBpB,aAExBoB,EAAkBxmD,WACY/rC,IAA5BuyF,EAAkBxmD,OAAsBwmD,EAAkBxmD,MAC5DwmD,EAAkBy7I,gBACiBhuO,IAAjCuyF,EAAkBy7I,WACdz7I,EAAkBy7I,WAClB,UACNz7I,EAAkBrB,cACelxF,IAA/BuyF,EAAkBrB,UACdqB,EAAkBrB,SAExBqB,EAAkBnB,uBACwBpxF,IAAxCuyF,EAAkBnB,mBACdmB,EAAkBnB,kBAGjB,IAAIlkB,KAAW,CACpBC,WAAY,CACVgkB,aAAcoB,EAAkBpB,aAAe,OAAS,QACxDD,SAAUqB,EAAkBrB,SAAW,aAAe,OACtDnlD,MAAOwmD,EAAkBxmD,MAAQ,OAAS,QAC1CiiM,WAAYz7I,EAAkBy7I,WAC1Bz7I,EAAkBy7I,WAClB,UACJ58I,kBAAmBmB,EAAkBnB,kBACjC,OACA,UAGV,CAEQ08I,YAAYG,EAAuBF,GACzC,MAAMG,EAAU,GAChBD,SAAiBE,KAAK51N,QAASk9J,IAC7BA,EAAI1pI,MAAMxzB,QAASwW,IACjBm/M,EAAQ5oO,KAAKypB,EAAI,EAClB,GAEI,CACL7e,MAAIyQ,SACJ/W,MAAOqkO,EAAiBE,KAAK,GAAGzqJ,QAChCjiE,OAAQzjB,KAAKuC,IACb6tO,WAAYp8I,MAAqBzD,MACjC+jE,MAAO,EACP38H,OAAQo8D,MAAiB/vC,QACzBr4C,KAAM,aACNq2C,WAAY,YACZ+tL,YACA30K,SAAU60K,EAAiB70K,SAC3ByqB,SAAUoqJ,EAAiBpqJ,SAC3ByD,SAAU2mJ,EAAiB3mJ,SAC3B6mJ,KAAMF,EAAiBE,KACvBpiM,MAAOmiM,EACPnkE,OAAQkkE,EAAiBlkE,OACzBskE,YAAaJ,EAAiBI,YAElC,4CAtKWhB,GAAoBjuO,MAAAuE,MAAAvE,MAAAwE,MAAA,iCAApBypO,EAAoBhuO,QAApBguO,EAAoB/tO,mBAApB+tO,CAAqB,KCX5B,SAAUiB,GACd7uO,EACAxB,GAEA,OAAO,IAAIovO,GAAqB5tO,EAAMxB,EACxC,CAWM,SAAUswO,KACd,MAAO,CACLxV,KAAMoU,GAAoBC,KAC1B5kO,UAAW,CAXN,CACLC,QAAS4iF,KACT1lD,WAAY2oM,GACZ1lO,OAAO,EACPi9B,KAAM,CAACg7B,KAAY1iE,QASvB,4FChCYqwO,GAAZ,SAAYA,GACVA,WAAA5yN,KAAA,UACA4yN,IAAAtvI,KAAA,UACAsvI,IAAArvI,KAAA,UACAqvI,IAAAC,mBAAA,wBAJUD,CAKZ,CALA,CAAYA,IAAa,ICUlB,IAAME,GAAc,MAArB,MAAOA,EACJC,UAAY,IAAI5uO,KAA4C,CACjE,QACAC,IAGFjC,cAAe,CAEf4gJ,YAAYp2I,EAAqBmB,EAAwB8kO,GAAc5yN,MACrE5d,KAAK2wO,UAAUhuO,KAAK,CAAC4H,EAAUmB,GACjC,CAEA5E,QACE9G,KAAK2wO,UAAUhuO,KAAK,CAAC,GAAI6tO,GAAc5yN,MACzC,4CAdW8yN,EAAc,iCAAdA,EAAcrvO,QAAdqvO,EAAcpvO,UAAAC,WAFb,gBAEDmvO,CAAc,KCMdE,GAAgB,MAAvB,MAAOA,EASOx0N,UACRy0N,eATFC,WACAn5M,OAAS,IAAIimI,KAErB,OAAIn9I,GACF,OAAOzgB,KAAKoc,UAAUqE,GACxB,CAEA1gB,YACkBqc,EACRy0N,GADQ7wO,KAAAoc,YACRpc,KAAA6wO,gBACP,CAEHtjO,WACEvN,KAAK8wO,WAAa9wO,KAAK6wO,eAAeF,UAAU9tO,UAAW86C,GACzD39C,KAAK+wO,eAAepzL,EAAI,GAAIA,EAAI,IAEpC,CAEAzvC,cACElO,KAAK8wO,WAAW3iO,aAClB,CAEQ4iO,eAAexmO,EAAqBmB,GAAwB,4CAvBzDklO,GAAgBxvO,MAAAuE,KAAA,GAAAvE,MAAAwE,IAAA,+BAAhBgrO,EAAgBtiO,UAAA,uBAAAG,YAAA,WAAhBmiO,CAAgB,KCFvB,SAAUI,GACdliJ,EACAjvF,GAEA,MAAM2K,EAAwB,CAC5B3K,GAASsoK,WAAa,CACpB19J,QAAS,kBACTo5D,SAAUhkE,EAAQsoK,WAEpB,CACE19J,QAASs9J,KACTp9J,SAAUo9J,MAEZitD,MACAtrN,OAAOkmC,SAET,UAAWnsB,KAAUqrE,EACnBtkF,EAAUlD,QAAQmc,EAAOjZ,WAG3B,OAAOA,CACT,2BCPM,MAAOymO,WAA6B5nE,KAK9B5nK,KACAE,gBALV8qB,UAAY,WACZA,YAAcugE,KAEdjtF,YACU0B,EACAE,EACRw6C,EACmBt8C,GAEnBuG,MAAMvG,EAASs8C,GALPn8C,KAAAyB,OACAzB,KAAA2B,iBAKV,CAEAi7E,QACE,OAAOq0J,GAAqB/+N,EAC9B,CAEA+vF,UACE,OAAOgvI,GAAqBztO,IAC9B,CAKU8lK,oBACR,MAAO,CACL19J,MAAO,uBACP29J,UAAW,sDAEf,CAOAt9F,OACE/d,EACAruD,GAKAquD,GADAA,GADAA,GADAA,EAAOA,EAAKx1B,QAAQ,KAAM,KACdA,QAAQ,MAAO,MACfu9B,SAAS,KAAO/H,EAAKrqC,MAAM,GAAG,GAAMqqC,GACpC6yC,WAAW,KAAO7yC,EAAK5D,OAAO,GAAK4D,EAE/C,MAAMnnD,EAAS/G,KAAKq7N,2BAA2BntK,EAAMruD,GAAW,IAChE,OAAKkH,EAAO7G,IAAI,WAAc6G,EAAO7G,IAAI,UAAUg7B,MAAM,cAGlDl7B,KAAKkxO,YAAYhjL,EAAMnnD,IAHuC,EAC5DnD,OAAG,GAGd,CAMQstO,YACNhjL,EACAnnD,GAEA,OAAO/G,KAAKyB,KACTvB,IAAIF,KAAKupK,UAAW,CAAExiK,SAAQ6hC,aAAc,SAC5C7kC,QAAK0c,KAAKuxE,GAAqBhyF,KAAK44N,eAAe5mI,EAAU9jC,IAClE,CAEQmtK,2BACNntK,EACAruD,GAEA,OAAO,IAAIqvE,KAAW,CACpBC,WAAY3oE,OAAO6H,OACjB,CACE8iO,OAAQjjL,EACRo0B,KAAM,QAERtiF,KAAK+G,OACLlH,EAAQkH,QAAU,KAGxB,CAEQ6xN,eACN5mI,EACA9jC,GAEA,OAAO8jC,EACJ1oF,MAAM,UACNI,OAAQ0nO,GAAgBA,EAAIxnO,OAAS,GACrC6W,IAAK2wN,GAAgBpxO,KAAK61N,aAAaub,EAAKljL,GACjD,CAEQ2nK,aAAa5xN,EAAciqD,GACjC,MAAMkjL,EAAMntO,EAAKqF,MAAM,KACjB6nO,EAASC,EAAI,GAEb9nJ,EAAWtpF,KAAKqxO,gBADVD,EAAI,IAGV/5M,EAAa,CACjBi6M,MAAOH,EACP5gJ,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAEE36B,GAAK,CAAClS,KAAK48E,QAAS,WAAYu0J,GAAQtnO,KAAK,KAEnD,MAAO,CACL4Z,OAAQzjB,KACRqe,KAAM,CACJ+9I,SAAUpvE,KACV96E,MACAtG,MAAOulO,EACP3a,SAAOztD,OAAsB76G,EAAKu6E,OAAQ0oG,GAC1CxlO,KAAM,eAER1H,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,WACAjyD,aACAhZ,KAAM,CACJnM,MACAtG,MAAOulO,IAIf,CAEQE,gBAAgB34D,GACtB,MAAM5tK,GAAU,IAAI+tK,MAAQp8F,YAAYi8F,EAAK,CAC3Cj0H,eAAgB,YAChBC,kBAAmB,cAErB,MAAO,CACLlhD,KAAMsH,EAAQqiF,cAAc8U,UAC5B/b,YAAcp7E,EAAQqiF,cAAsBtrC,iBAEhD,4CAzIWovL,IAAoB7vO,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAQrB,WAAS,iCARR6vO,GAAoB5vO,QAApB4vO,GAAoB3vO,aAwDvBmhC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAAmG,OAGQylC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAU22N,GAAAv2N,UAAA,oBC9DT,MAAOw2N,WAA8BnoE,KAK/B5nK,KAJVgrB,UAAY,YACZA,YAAcugE,KAEdjtF,YACU0B,EACW5B,EACnBs8C,GAEA/1C,MAAMvG,EAASs8C,GAJPn8C,KAAAyB,MAKV,CAEAm7E,QACE,OAAO40J,GAAsBt/N,EAC/B,CAEA+vF,UACE,OAAOuvI,GAAsBhuO,IAC/B,CAKU8lK,oBACR,MAAO,CACL19J,MAAO,kBACP29J,UAAW,6CACXlF,SAAU,CACR,CACE7gK,KAAM,WACNoI,MAAO,eACPojB,KAAM,UACNrT,OAAQ,CACN,CACE/P,MAAO,qCACPlF,MACE,sFACFiqC,SAAS,GAEX,CACE/kC,MAAO,uCACPlF,MACE,8FACFiqC,SAAS,GAEX,CACE/kC,MAAO,8CACPlF,MACE,yMAEFiqC,SAAS,GAEX,CACE/kC,MAAO,wCACPlF,MAAO,4BACPiqC,SAAS,KAIf,CACEntC,KAAM,cACNoI,MAAO,gBACPojB,KAAM,QACNrT,OAAQ,CACN,CACE/P,MAAO,KACPlF,MAAO,GACPiqC,SAAS,GAEX,CACE/kC,MAAO,KACPlF,MAAO,GACPiqC,SAAS,GAEX,CACE/kC,MAAO,KACPlF,MAAO,GACPiqC,SAAS,KAIf,CACEntC,KAAM,cACNoI,MAAO,iBACPojB,KAAM,eACNrT,OAAQ,CACN,CACE/P,MAAO,0CACPlF,MAAO,KACPiqC,SAAS,GAEX,CACE/kC,MAAO,uCACPlF,MAAO,KACPiqC,SAAS,KAIf,CACEntC,KAAM,cACNoI,MAAO,kBACPojB,KAAM,SACNrT,OAAQ,CACN,CACE/P,MAAO,6CACPlF,MAAO,EACPiqC,SAAS,GAEX,CACE/kC,MAAO,8CACPlF,MAAO,EACPiqC,SAAS,MAMrB,CAOAs7B,OACE/d,EACAruD,GAEA,MAAMkH,EAAS/G,KAAKq7N,2BAA2BntK,EAAMruD,GAAW,IAChE,OAAKkH,EAAO7G,IAAI,KAGTF,KAAK24N,UAAUzqK,EAAMnnD,IAAM,EAFzBnD,OAAG,GAGd,CAMQ+0N,UACNzqK,EACAnnD,GAEA,OAAO/G,KAAKyB,KACTvB,IAAIF,KAAKupK,UAAW,CAAExiK,WACtBhD,QACC0c,KAAKuxE,GAA8BhyF,KAAK44N,eAAe5mI,EAAU9jC,IAEvE,CAEQmtK,2BACNntK,EACAruD,GAEA,OAAO,IAAIqvE,KAAW,CACpBC,WAAY3oE,OAAO6H,OACjB,CACE4qN,EAAGj5N,KAAKk5N,YAAYhrK,GACpBv2B,OAAQ,QAEV33B,KAAK+G,OACLlH,EAAQkH,QAAU,KAGxB,CAEQ6xN,eACN5mI,EACA9jC,GAEA,OAAO8jC,EAASvxE,IAAKxc,GAAwBjE,KAAK61N,aAAa5xN,EAAMiqD,GACvE,CAEQ2nK,aACN5xN,EACAiqD,GAEA,MAAM72B,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCqlF,EAAWtpF,KAAKqxO,gBAAgBptO,GAChCusE,EAASxwE,KAAK06N,cAAcz2N,GAC5BiO,EAAK,CAAClS,KAAK48E,QAAS,QAAS34E,EAAKwtO,UAAU5nO,KAAK,KAEvD,MAAO,CACL4Z,OAAQzjB,KACRqe,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAKytO,aACZ/lO,KAAM,cACN6qN,SAAOztD,OAAsB76G,EAAKu6E,OAAQxkI,EAAKytO,eAEjDztO,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,WACA9Y,SACAn5C,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAKytO,eAIpB,CAEQlY,kBAAkBv1N,GACxB,MAAO,CACLytO,aAAcztO,EAAKytO,aACnBD,SAAUxtO,EAAKwtO,SACfE,SAAU1tO,EAAK0tO,SACf1iN,MAAOhrB,EAAKgrB,MACZzrB,KAAMS,EAAKT,KAEf,CAEQ6tO,gBAAgBptO,GACtB,MAAO,CACLT,KAAM,QACN0iF,YAAa,CAACk4C,WAAWn6H,EAAK6iI,KAAM1I,WAAWn6H,EAAK8iI,MAExD,CAEQ2zF,cAAcz2N,GACpB,MAAO,CACLm6H,WAAWn6H,EAAK2tO,YAAY,IAC5BxzG,WAAWn6H,EAAK2tO,YAAY,IAC5BxzG,WAAWn6H,EAAK2tO,YAAY,IAC5BxzG,WAAWn6H,EAAK2tO,YAAY,IAEhC,CAEQ1Y,YAAYhrK,GAClB,OAAOluD,KAAK6xO,gBAAgB3jL,EAC9B,CAMQ2jL,gBAAgB3jL,GACtB,MAAM03G,EAAWx/J,MAAM4jK,iBAAiB97G,EAAM,WAC9C,OAAK03G,EAIAA,EAASh8J,QAIdskD,EAAOA,EAAKx1B,QAAQ,aAAc,IAClCktI,EAASrrJ,QAASu3N,IAChB5jL,GAAQ,KAAO4jL,EAAM,MAGhB5jL,GARE,KAJAluD,KAAK+xO,oBAAoB7jL,EAapC,CAMQ6jL,oBAAoB7jL,GAC1B,OAAAluD,KAAKH,QAAQwkK,SAAS9pJ,QAAS8pJ,IACP,YAAlBA,EAASr1I,MACXq1I,EAAS1oJ,OAAOpB,QAASssH,IACnBA,EAAKl2F,SAAiC,iBAAfk2F,EAAKngI,OACbmgI,EAAKngI,MAAM4C,MAAM,KACzBiR,QAAS7T,IAChBwnD,GAAQ,KAAOxnD,EAAQ,KACxB,EAEJ,GAGEwnD,CACT,4CAnRWsjL,IAAqBpwO,MAAAuE,MAAAvE,MAMtB,WAASA,MAAAwE,OAAA,iCANR4rO,GAAqBnwO,QAArBmwO,GAAqBlwO,aA2IxBmhC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAAmG,OAGQylC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAUo3N,GAAAh3N,UAAA,iCClIT,MAAOi3N,WACH5oE,KAgBE5nK,KACAE,gBAdV8qB,UAAY,gBACZA,YAAcugE,KACdvgE,2BAAuC,CACrC,YACA,KACA,UACA,WAEKylN,YACAC,qBACAC,oBAEPryO,YACU0B,EACAE,EACRw6C,EACmBt8C,GAInB,GAFAuG,MAAMvG,EAASs8C,GALPn8C,KAAAyB,OACAzB,KAAA2B,kBAKR3B,KAAKmyO,qBAAuBtyO,GACxBG,KAAKmyO,sBAAyBnyO,KAAKmyO,qBAAqBnkO,UAA5D,CA4BA,GAfKhO,KAAKmyO,uBACRjvK,QAAQK,IACN,6FAEFvjE,KAAKmyO,qBAAuB,CAC1BE,eAdyB,OAezBtxM,OAdgD,CAClD,CAAE/R,KAAM,OAAQg0C,aAAc,OAC9B,CAAEh0C,KAAM,WAAYg0C,aAAc,IAAKsvK,YAAa,QAalDC,aAXwB,8BAYxBC,QAXmB,YAYnBN,YAXuB,SAazBlyO,KAAKkyO,YAboB,QAczBhvK,QAAQK,IAAI,iBAAkBvjE,KAAKmyO,wBAGhCnyO,KAAKmyO,qBAAqBE,eAG7B,MAAM,IAAIrwN,MADR,yHAGJ,IAAKhiB,KAAKmyO,qBAAqBpxM,OAC7B,MAAM,IAAI/e,MACR,8GAWJ,GAPAhiB,KAAKmyO,qBAAqBI,aACxBvyO,KAAKmyO,qBAAqBI,cAAgB,8BAC5CvyO,KAAKmyO,qBAAqBK,QACxBxyO,KAAKmyO,qBAAqBK,SAAW,YAGrCxyO,KAAKmyO,qBAAqBE,eAAel6M,cAE3BH,SAAS,mBACvBh4B,KAAKmyO,qBAAqBI,aACvBp6M,cACAH,SAAS,kBACZ,CACA,IAAI7zB,GACF,2FACFA,UAAO,sCACD,IAAI6d,MAAM7d,GAClB,CAEMnE,KAAKmyO,qBAAqBpxM,kBAAkBxlB,QAChDvb,KAAKmyO,qBAAqBpxM,OAAS,CAAC/gC,KAAKmyO,qBAAqBpxM,SAGhE/gC,KAAKoyO,oBACHpyO,KAAKmyO,qBAAqBpxM,OAAOn3B,OAAS,EAE5C5J,KAAKmyO,qBAAqBpxM,OAAOxmB,QAAQ,CAACilB,GAAOvgB,MAC/C,GAAIjf,KAAKoyO,sBAAwB5yM,GAAM8yM,aAAyB,IAAVrzN,GACpD,MAAM,IAAI+C,MACR,yGAGJ,IAAKwd,GAAMwjC,aACT,MAAM,IAAIhhD,MACR,gFAA+E,GAKrFhiB,KAAKmyO,qBAAqBD,YACxBlyO,KAAKmyO,qBAAqBD,aAAelyO,KAAKkyO,WA9E9C,CA+EJ,CAEAt1J,QACE,OAAOq1J,GAA0B//N,EACnC,CAEA+vF,UACE,OAAOgwI,GAA0BzuO,IACnC,CAEU8lK,oBACR,MAAO,CACL19J,MAAO,iBACP29J,UAAW,kDAEf,CAeAt9F,OACE/d,EACAruD,GAEA,MAAM4yO,EAAsBzyO,KAAKk5J,aAC/BhrG,EACAluD,KAAKmyO,qBAAqBpxM,QAEtBh6B,EAAS/G,KAAK04N,qBAClB74N,GAAW,GACX4yO,GAEF,OAAAzyO,KAAKH,QAAQkH,OAAS/G,KAAKH,QAAQkH,OAAS/G,KAAKH,QAAQkH,OAAS,GAClE/G,KAAKH,QAAQkH,OAAOgkB,KAAOlrB,EAAQkrB,KAAO0e,OAAO5pC,EAAQkrB,MAAQ,IAE1D/qB,KAAK24N,UAAUzqK,EAAMnnD,EAC9B,CAMQ4xN,UACNzqK,EACAnnD,GAEA,OAAO,IAAIiD,OAAO,YAAa,KAAKE,KAClClK,KAAKmyO,qBAAqBI,cAExBvyO,KAAKyB,KAAKvB,IAAIF,KAAKupK,UAAW,CAAExiK,SAAQ6hC,aAAc,SAAU7kC,QAC9D0c,KAAKuxE,IACH,IAAI0gJ,EAAc1yO,KAAK44N,eACrB54N,KAAK2yO,eAAe3gJ,GACpB9jC,GAYF,GAVAwkL,EAAYlwN,KAAK,CAAC8/B,EAAGC,IACnBD,EAAEjkC,KAAKm4M,MAAQj0K,EAAElkC,KAAKm4M,OAElBl0K,EAAEjkC,KAAKm4M,QAAUj0K,EAAElkC,KAAKm4M,OACtBl0K,EAAEjkC,KAAKK,UAAY6jC,EAAElkC,KAAKK,UAF5B,GAKE,GAERg0N,EAAY3yN,UACR2yN,EAAY9oO,OAASuxB,OAAOn7B,KAAKH,QAAQkH,OAAOo7J,OAAQ,CAC1D,MAAMywE,EACJz3M,OAAOn7B,KAAKH,QAAQkH,OAAOo7J,OAC3BhnI,OAAOn7B,KAAKH,QAAQkH,OAAOgkB,MACvB8nN,EAAkBH,EAAY9oO,OACpC8oO,EAAcA,EAAY7uN,MAAM,EAAG+uN,GAEjCF,EAAYA,EAAY9oO,OAAS,GAAGyU,KAAK+jJ,SADvCwwE,EAASC,CAKf,CACA,OAAOH,KAGX1yO,KAAKyB,KAAKvB,IAAIF,KAAKupK,UAAW,CAAExiK,WAAUhD,QACxC0c,KAAKuxE,GACIhyF,KAAK44N,eAAe54N,KAAK2yO,eAAe3gJ,GAAW9jC,IAGpE,CAEQirB,uBACN,IAAItB,EAEJ,MAAMsG,EAAen+E,KAAKmyO,qBAAqBI,aACzCO,EAAc,IAAI9oO,OAAO,YAAa,KAG5C,OAFuB,IAAIA,OAAO,aAAc,KAE7BE,KAAKi0E,KACtBtG,EAAcE,MAEZ+6J,EAAY5oO,KAAKi0E,KACnBtG,EAAcE,MAGT,IAAIF,CACb,CAEQ86J,eAAeh1L,GACrB,MAAMokD,EAAW/hG,KAAKm5E,uBAChBk0D,EAAUt1D,KACVg7J,EAAchxI,EAAS56C,aAAaxJ,GAE1C,OADiB1lB,KAAKC,OAAM,IAAIm1G,GAAU7oF,cAAcuuL,GAE1D,CAEQ75E,aAAahrG,EAAcntB,GACjC,MAAMiyM,EAAe,GACrB,IAAIC,EAAgB/kL,EAChB20B,EAAM,EAWV,OARA9hD,EAAOxmB,QAASilB,IACdwzM,EAAaxzM,EAAMxQ,MAAQwQ,EAAMwjC,aACjC,MAAMkwK,GAAgB,IAAIlpO,OAAOw1B,EAAM8yM,YAAc,OAAQ,KACzDY,GAAchpO,KAAK+oO,KACrBpwJ,EAAMrjD,EAAM8yM,YAAezvJ,GAAO,EAAKA,EACvCowJ,EAAgBA,EAAc3pO,MAAM4pO,IAAe,GAAC,GAG5C,IAARrwJ,GACFmwJ,EAAajyM,EAAO,GAAG/R,MAAQk/B,EACxB8kL,IAETC,EAAgB/kL,EACI,IAAIntB,GAAQhhB,UACpBxF,QAASilB,IACnB,MAAM0zM,GAAgB,IAAIlpO,OAAOw1B,EAAM8yM,aAAe,OAAa,KACnE,GAAIW,GAAmC,KAAlBA,EAAsB,CACzC,MAAMt3N,GAASs3N,EAAc3pO,MAAM4pO,IACnCD,EAAgBt3N,GAAO,GACnBA,GAAO,KACTq3N,EAAaxzM,EAAMxQ,MAAQrT,GAAO,GAAG8sH,OAEzC,IAEKuqG,EACT,CAEQta,qBACN74N,EACA+gD,GAEA,MAAMuyL,EAAanzO,KAAKmyO,qBAAqBE,eAC1Cl6M,cACAH,SAAS,kBACR,QACA,QACJ,OAAO,IAAIk3C,KAAW,CACpBC,WAAY3oE,OAAO6H,OACjB,CACE+/B,QAAS,MACTwoB,QAASu8K,EACThzL,QAAS,aACTkyL,eAAgBryO,KAAKmyO,qBAAqBE,eAC1CG,QAASxyO,KAAKmyO,qBAAqBK,QACnCD,aAAcvyO,KAAKmyO,qBAAqBI,cAE1C3xL,EACA5gD,KAAK+G,OACLlH,EAAQkH,QAAU,KAGxB,CAEQ6xN,eACN5mI,EACA9jC,GAEA,OAAO8jC,EAASznF,SAASkW,IAAKxc,GACrBjE,KAAK61N,aAAa5xN,EAAMiqD,GAEnC,CAEQ2nK,aACN5xN,EACAiqD,GAEA,MAAM72B,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCiO,EAAK,CAAClS,KAAK48E,QAASvlD,EAAW7zB,KAAMS,EAAKiO,IAAIrI,KAAK,KACnD+B,EAAQ3H,EAAKozB,WAAWr3B,KAAKmyO,qBAAqBD,aACpDlyO,KAAKmyO,qBAAqBD,YAC1BlyO,KAAKkyO,YACT,MAAO,CACLzuN,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,SAAUrlF,EAAKqlF,SAEfjyD,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAKozB,WAAWzrB,KAG3ByS,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAKozB,WAAWzrB,MACvB8S,UAAWza,EAAKozB,WAAWzrB,GAC3BD,KAAM,cACN6qN,OAAuB5qN,EACnBm9J,OAAsB76G,EAAKu6E,OADxBxkI,EAAKozB,WAAWzrB,MACgB3H,EAAKozB,WAAWzrB,MAChB3H,EAAKozB,WAAWzrB,KAG7D,CAEQ4tN,kBAAkBv1N,GAcxB,OAbmBuC,OAAO6H,OACxB,GACAkO,MAAYs9M,WACV51N,EAAKozB,WACL46M,GAA0BnY,qBAE5B,CACEvpI,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAIR,4CAxVWolM,IAAyB7wO,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAoB1B,WAAS,iCApBR6wO,GAAyB5wO,QAAzB4wO,GAAyB3wO,aA4J5BmhC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAAAmG,OAGQylC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAUw4N,GAAAp4N,UAAA,kBAsMT,MAAOq4N,WACHhqE,KAWE5nK,KACAE,gBATV8qB,UAAY,uBACZA,YAAcugE,KACdvgE,2BAAuC,GAChCylN,YACAC,qBACAC,oBAEPryO,YACU0B,EACAE,EACRw6C,EACmBt8C,GAMnB,GAJAuG,MAAMvG,EAASs8C,GALPn8C,KAAAyB,OACAzB,KAAA2B,kBAKR3B,KAAKmyO,qBACHtyO,EAGCG,KAAKmyO,wBACLnyO,KAAKmyO,sBAAyBnyO,KAAKmyO,qBAAqBnkO,WAK3D,KAAKhO,KAAKmyO,qBAAqBE,eAG7B,MAAM,IAAIrwN,MADR,yHAGJ,IAAKhiB,KAAKmyO,qBAAqBmB,UAC7B,MAAM,IAAItxN,MACR,oGAGJ,IAAKhiB,KAAKmyO,qBAAqBoB,SAC7B,MAAM,IAAIvxN,MACR,kGAIJhiB,KAAKmyO,qBAAqBI,aACxBvyO,KAAKmyO,qBAAqBI,cAAgB,8BAC5CvyO,KAAKmyO,qBAAqBK,QACxBxyO,KAAKmyO,qBAAqBK,SAAW,YACvCxyO,KAAKmyO,qBAAqBD,YACxBlyO,KAAKmyO,qBAAqBD,aAAelyO,KAAKkyO,YAClD,CAEAt1J,QACE,OAAOy2J,GAAiCnhO,EAC1C,CAEA+vF,UACE,OAAOoxI,GAAiC7vO,IAC1C,CAEU8lK,oBACR,MAAO,CACL19J,MAAO,2BACP29J,UAAW,kDAEf,CAQA/B,cACEp1E,EACAvyF,GAEA,MAAMkH,EAAS/G,KAAK04N,qBAAqBtmI,EAAQvyF,GAAW,IAC5D,OAAOG,KAAKw6N,iBAAiBzzN,EAC/B,CAMQyzN,iBACNzzN,GAQA,OANc,IAAIiD,OAAO,YAAa,KAAKE,KACzClK,KAAKmyO,qBAAqBI,cAGxBvyO,KAAKyB,KAAKvB,IAAIF,KAAKupK,UAAW,CAAExiK,SAAQ6hC,aAAc,SACtD5oC,KAAKyB,KAAKvB,IAAIF,KAAKupK,UAAW,CAAExiK,YACpBhD,QACd0c,KAAKuxE,GACIhyF,KAAK44N,eAAe54N,KAAK2yO,eAAe3gJ,KAGrD,CAEQ7Y,uBACN,IAAItB,EAEJ,MAAMsG,EAAen+E,KAAKmyO,qBAAqBI,aACzCO,EAAc,IAAI9oO,OAAO,YAAa,KAG5C,OAFuB,IAAIA,OAAO,aAAc,KAE7BE,KAAKi0E,KACtBtG,EAAcE,MAEZ+6J,EAAY5oO,KAAKi0E,KACnBtG,EAAcE,MAGT,IAAIF,CACb,CAEQ86J,eAAeh1L,GACrB,MAAMokD,EAAW/hG,KAAKm5E,uBAChBk0D,EAAUt1D,KACVg7J,EAAchxI,EAAS56C,aAAaxJ,GAE1C,OADiB1lB,KAAKC,OAAM,IAAIm1G,GAAU7oF,cAAcuuL,GAE1D,CAEQra,qBACNtmI,EACAvyF,GAEA,MAAM2zO,EAAgB,GACtBA,SAAcxzO,KAAKmyO,qBAAqBmB,WAAalhJ,EAAO,GAC5DohJ,EAAcxzO,KAAKmyO,qBAAqBoB,UAAYnhJ,EAAO,GAEpD,IAAIljB,KAAW,CACpBC,WAAY3oE,OAAO6H,OACjB,CACE+/B,QAAS,MACTwoB,QAAS,QACTzW,QAAS,aACTkyL,eAAgBryO,KAAKmyO,qBAAqBE,eAC1CG,QAASxyO,KAAKmyO,qBAAqBK,QACnCD,aAAcvyO,KAAKmyO,qBAAqBI,cAE1CiB,EACAxzO,KAAK+G,OACLlH,EAAQkH,QAAU,KAGxB,CAEQ6xN,eACN5mI,GAEA,OAAOA,EAASznF,SAASkW,IAAKxc,GACrBjE,KAAK61N,aAAa5xN,GAE7B,CAEQ4xN,aAAa5xN,GACnB,MAAMozB,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCiO,EAAK,CAAClS,KAAK48E,QAASvlD,EAAW7zB,KAAMS,EAAKiO,IAAIrI,KAAK,KACnD+B,EAAQ3H,EAAKozB,WAAWr3B,KAAKmyO,qBAAqBD,aACpDlyO,KAAKmyO,qBAAqBD,YAC1BlyO,KAAKkyO,YAET,MAAO,CACLzuN,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,SAAUrlF,EAAKqlF,SACfjyD,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAKozB,WAAWzrB,KAG3ByS,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAKozB,WAAWzrB,GACvBD,KAAM,eAGZ,CAEQ6tN,kBAAkBv1N,GAGxB,MAAMozB,EAAa9a,MAAYs9M,WAC7B51N,EAAKozB,WACLg8M,GAAiCvZ,qBAE7BK,EAAU,CACd5pI,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAEJ,OAAOrmC,OAAO6H,OACZgpB,EACA,CAAE7zB,KAAMS,EAAKozB,WAAWo8M,UACxBtZ,EAEJ,4CA7MWkZ,IAAgCjyO,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAejC,WAAS,iCAfRiyO,GAAgChyO,QAAhCgyO,GAAgC/xO,aAqFnCmhC,SAAA,IAJP8G,MAAU,CACTC,cAAe,GACf6wL,YAAaC,SACd,EAACj3L,GAAAC,IAAA,cAAA5H,WAAA,EAAA2H,GAAAC,IAAA,qBAEQ4rC,QAAU,EAAA7rC,GAAAC,IAAA,oBACjB1oB,OAAU84N,GAAA14N,UAAA,yBC3cR,IAAM24N,GAAsB,MAA7B,MAAOA,UAA8BtqE,KAU/B1nK,gBATV8qB,UAAY,YACZA,YAAcugE,KACd4oI,OAAkC,IAAI7zN,KAAwB,IAE9D,SAAI6J,GACF,OAAO5L,KAAK41N,OAAOj8L,UACrB,CAEA55B,YACU4B,EACRw6C,EACmBt8C,GAEnBuG,MAAMvG,EAASs8C,GAJPn8C,KAAA2B,kBAMR3B,KAAK2B,gBAAgB4pB,UAClBrrB,IAAIF,KAAKH,QAAQ+L,OACjB/I,UAAW+I,GAAU5L,KAAK41N,OAAOjzN,KAAKiJ,GAC3C,CAEAgxE,QACE,OAAO+2J,EAAsBzhO,EAC/B,CAEA+vF,UACE,OAAO0xI,EAAsBnwO,IAC/B,CAEU8lK,oBAGR,MAAO,CACL19J,MAAO,gCACP29J,eAAWvnK,EACXqiK,SAAU,CACR,CACE7gK,KAAM,WACNoI,MAAO,WACPojB,KAAM,WACNrT,OAAQ,IAEV,CACEnY,KAAM,cACNoI,MAAO,gBACPojB,KAAM,QACNrT,OAAQ,CACN,CAAE/P,MAAO,IAAKlF,MAAO,EAAGiqC,SAASwxH,GACjC,CAAEv2J,MAAO,IAAKlF,MAAO,EAAGiqC,SAASwxH,GACjC,CAAEv2J,MAAO,KAAMlF,MAAO,GAAIiqC,SAASwxH,GACnC,CAAEv2J,MAAO,KAAMlF,MAAO,GAAIiqC,SAASwxH,GACnC,CAAEv2J,MAAO,KAAMlF,MAAO,GAAIiqC,SAASwxH,MAK7C,CAOAl2F,OACE/d,EACAruD,GAGA,MAAM+zO,EADe5zO,KAAKqkK,SAASjiJ,KAAMxG,IAAiB,UAAXA,GAAEoT,MAEjCrT,OAAOyG,KAAM/I,IAAMA,GAAEs3B,SAASjqC,OAAoB,EAClE1G,KAAKH,QAAQkH,OAAOo7J,MAAQyxE,EAAWztJ,iBACvC,MAAM/G,EAA2B,GACjCp/E,KAAKH,QAAQkH,OAAOgkB,MAAQlrB,EAAQkrB,MAAQ,GAAGo7D,iBAC/C,MAAMp7D,EAAOlrB,EAAQkrB,MAAQ,EACvB6+I,GAAW5pK,KAAKH,QAAQkH,OAAO6iK,SAAStgK,MAAM,KACpDtJ,KAAKwpK,uBACF9/J,OACEmqO,IAASA,GAAKpsI,gBAAkBmiE,GAAS5xI,SAAS67M,GAAKpxL,MAAM72C,QAE/D6U,IAAKozN,KACJ,MAAMC,GAAY5lL,EAClB2lL,GAAKpsI,eACFx7B,OAAO6nK,GAAW,CAAE3xE,MAAOp3I,EAAO6oN,IAClCnzN,IAAKszN,KACJ,MAAMv0M,GAAQu0M,GAAQv0M,MACtBu0M,GAAQ1qM,OAAO5oB,IAAKxB,KAClB,MAAMnU,GAAU+oO,GAAK50N,MAAM/e,IAAI+e,IACzBu3M,MAAQztD,OACZ+qE,GAAUrrG,OACV39H,GAAQusB,WAAWmI,KAErB4/C,EAAQ93E,KAAK,CAAE2X,SAAOnU,WAAS23C,MAAOoxL,GAAKpxL,MAAOjjB,SAAOg3L,UAAO,EACjE,EACF,GAGPp3I,EAAQ58D,KAAK,CAAC8/B,GAAGC,KAAOD,GAAEk0K,MAAQj0K,GAAEi0K,OAAQ,EAAK,GACjD,MAAMwd,GAAc,GACdC,GAAyC,GAC/C70J,SAAQ3+D,IAAKuoD,KACNgrK,GAAYh8M,SAASgxC,GAAE/pD,SAC1B+0N,GAAY1sO,KAAK0hE,GAAE/pD,OACnBg1N,GAAsB3sO,KAAK0hE,IAAC,IAE/B,EAEMplE,OACL5D,KAAK44N,eACHqb,GACGzxN,KAAK,CAAC8/B,GAAGC,KAAOD,GAAEk0K,MAAQj0K,GAAEi0K,OAAQ,EAAK,GACzC3yM,MAAM,EAAGkH,EAAO6oN,IAGzB,CAEQhb,eAAex5I,GACrB,OAAOA,EAAQ3+D,IAAK4oB,GAAWrpC,KAAK61N,aAAaxsL,EAAQ+1C,EAAQx1E,QACnE,CAEQisN,aACN5xN,EACAiwO,GAEA,MAAM78M,EAAar3B,KAAKw5N,kBAAkBv1N,GACpCiO,EAAK,CAAClS,KAAK48E,QAASvlD,EAAW7zB,KAAMS,EAAKgb,OAAOpV,KAAK,KACtD6U,EAAYza,EAAK6G,QAAQusB,WAAWpzB,EAAKu7B,OACzCm6L,EAAgB,eAAiB11N,EAAKw+C,MAAM72C,MAAQ,WAE1D,MAAO,CACL6X,OAAQzjB,KACRiE,KAAM,CACJT,KAAMwpF,KACNhrC,WAAY,YACZsnC,SAAUrlF,EAAK6G,QAAQw+E,SACvB9Y,OAAQvsE,EAAK6G,QAAQ0lE,OACrBn5C,aACAhZ,KAAM,CACJnM,KACAtG,MAAO3H,EAAK6G,QAAQusB,WAAWpzB,EAAKu7B,OACpCk+C,MAAO19E,KAAKswJ,yBAAyBrsJ,EAAKw+C,SAG9CpkC,KAAM,CACJ+9I,SAAUpvE,KACV96E,KACAtG,MAAO3H,EAAK6G,QAAQuT,KAAKzS,MACzB8S,UAAWA,EAAYi7M,EACvBhuN,KAAM,cACN6qN,MAAOvyN,EAAKuyN,MACZp0D,SACE8xE,GAAcl0O,KAAKH,QAAQkH,OAAOo7J,OAAU,IAC3CniK,KAAKH,QAAQkH,OAAOgkB,KAAO,IAGpC,CAEQulI,yBAAyB7tG,GAC/B,IAAIi9C,EACJ,OACEj9C,EAAM5iD,SAAS4jB,QAAQ5jB,SAAS+zE,cAChCnxB,EAAM5iD,QAAQ4jB,OAAO5jB,QAAQ+zE,aAAahqE,QAAU,IAEpD81F,EAAwB,GACxBj9C,EAAM5iD,QAAQ4jB,OAAO5jB,QAAQ+zE,aAAar5D,QAASimE,IAEjDkf,EAAsBlf,EAAYxxD,MADpBwxD,EAAY9C,MAAQ8C,EAAY9C,MAAQ8C,EAAYxxD,IACxB0uD,IAGvCgiB,CACT,CAEQ85H,kBAAkBv1N,GACxB,IAAKA,EAAK6G,QAAQw+E,SAChB,OAAO9iF,OAAO6H,OACZ,CAAE7K,KAAMS,EAAKw+C,MAAM72C,MAAQ,IAAM3H,EAAKu7B,OACtCv7B,EAAK6G,QAAQusB,YAGjB,MAAM0iM,EAGF,CACF1D,WAAY,IAEd,IAAI2D,EACJ,GAAmC,UAA/B/1N,EAAK6G,QAAQw+E,SAAS9lF,KACxBw2N,EAAa/E,GAAYC,uBACvBjxN,EAAK6G,QAAQw+E,SAASpD,YAAY,GAClCjiF,EAAK6G,QAAQw+E,SAASpD,YAAY,QAE/B,CACL,MAAMqD,KAAQC,MAAevlF,EAAK6G,QAAQw+E,UAC1C0wI,EAAa/E,GAAYC,uBACvB3rI,EAAMD,SAASpD,YAAY,GAC3BqD,EAAMD,SAASpD,YAAY,GAE/B,CACA6zI,EAAsB1D,WACpB,WACA2D,EACA,oBACAh6N,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,yBACvC,OACiC,UAA/B5oC,EAAK6G,QAAQw+E,SAAS9lF,OACxBu2N,EAAsBzD,iBACpBrB,GAAYE,wBACVlxN,EAAK6G,QAAQw+E,SAASpD,YAAY,GAClCjiF,EAAK6G,QAAQw+E,SAASpD,YAAY,KAGxC,MAAMi0I,EAEF,CACF5pI,MACE,6BACAvwF,KAAK2B,gBAAgB4pB,UAAUshB,QAAQ,sBACvC,gBAEJ,OAAOrmC,OAAO6H,OACZ,CAAE7K,KAAMS,EAAK6G,QAAQlC,UACrB3E,EAAK6G,QAAQusB,WACb0iM,EACAI,EAEJ,4CAhOWwZ,GAAqBvyO,MAAAuE,MAAAvE,MAAAwE,OAAAxE,MAYtB,WAAS,iCAZRuyO,EAAqBtyO,QAArBsyO,EAAqBryO,mBAArBqyO,CAAsB,KCV7B,SAAUQ,GACdxyO,EACAw6C,EACAl8C,GAEA,OAAO,IAAI0zO,GACThyO,EACAw6C,EACAl8C,EAAOG,UAAU,iBAAiBuzO,GAAsBzhO,MAE5D,CAcM,SAAUkiO,KACd,MAAO,CACLrZ,KAAMrE,GAAiB/7K,UACvBnwC,UAAW,CAXN,CACLC,QAAS4+J,KACT1hI,WAAYwsM,GACZvpO,OAAO,EACPi9B,KAAM,CAAC28B,KAAiB35D,MAAgB1K,QAS5C,sCC1BM,SAAUk0O,IACdvpO,UACA0vF,cAAc,CAAC,EAAG,IAAK,KACvB85I,gBAAgB,EAChB75I,qBAAqB,CAAC,EAAG,IAAK,KAC9Bk0E,YACA4lE,cAAc,IACd3lE,cAAc,CAAC,EAAG,IAAK,KACvB4lE,gBAAgB,GAChBn5J,eAAc,IAEd,OAAOo5J,GAAqB,CAC1B3pO,UACA0vF,cACA85I,gBACA75I,qBACAk0E,YACA4lE,cACA3lE,cACA4lE,gBACAn5J,gBAEJ,CAOM,SAAUo5J,IACd3pO,UACA0vF,cAAc,CAAC,EAAG,IAAK,KACvB85I,gBAAgB,GAChB75I,qBACAk0E,YAAY,CAAC,EAAG,IAAK,KACrB4lE,cAAc,IACd3lE,cAAc,CAAC,EAAG,IAAK,KACvB4lE,gBAAgB,GAChBn5J,eAAc,IAEd,MAAMq5J,GAAc5pO,aAAmB6hF,KACvC,IAAIrD,GACA18C,GACA8nM,GAEFprJ,GAAWx+E,EAAQqiF,eAGnB7D,GAAWx+E,EAAQw+E,SACnB18C,GAAO9hC,EAAQuT,KAAKmjF,UAEtB,MAAMQ,GAAe0yI,GAAcprJ,GAAS2Y,UAAY3Y,GAAS9lF,KAEjE,GAAK8lF,IAA6B,UAAjB0Y,GAkBV,CACL,MAAM6sE,MAAkBtmD,OAAaomD,GAAW9qJ,MAAM,GAChDirJ,MAAoBvmD,OAAaqmD,GAAa/qJ,MAAM,GAE1D,OAE+B,IAA3BgrJ,GAAgBjlK,SACM,iBAAd+kK,GACN,kBAAkBzkK,KAAKykK,MAG3BE,GAAgB,GAAK0lE,GAKU,IAA7BzlE,GAAkBllK,SACM,iBAAhBglK,GACN,kBAAkB1kK,KAAK0kK,MAG3BE,GAAkB,GAAK0lE,MAGlBlmE,MAA0B,CAC/B1hI,QACAyuC,eACAuzF,YAAaE,GACbH,UAAWE,IAEf,CAhD2C,CACzC,MAAM8lE,MAAqBpsH,OAAa/tB,GAAa32E,MAAM,GACrD+wN,GAAiBD,GAAmB9wN,MAAM,EAAG,GAEnD,OACgC,IAA9B8wN,GAAmB/qO,SACK,iBAAhB4wF,GACN,kBAAkBtwF,KAAKswF,MAEzB85I,EAAgBK,GAAmB,KAAC,EAG/Bp6I,MAAyB,CAC9B3tD,QACAgW,QAAS0xL,EACT75I,qBACAD,YAAao6I,IAEjB,CA+BF,CC5GO,IAAMC,GAAY,MAAnB,MAAOA,EAGS50O,OAFVJ,QAEVE,YAAoBE,GAAAD,KAAAC,SAClBD,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,QACvC,CAEAo+G,SACE,OAAOx+G,KAAKH,OACd,CAEAK,IAAIqG,GACF,GAAIvG,KAAKH,QACP,OAAOG,KAAKH,QAAQ0G,EAGxB,4CAhBWsuO,GAAYzzO,MAAAuE,MAAA,iCAAZkvO,EAAYxzO,QAAZwzO,EAAYvzO,UAAAC,WAFX,gBAEDszO,CAAY,KCAZC,GAA2B,MAAlC,MAAOA,EAGSC,aAFbC,kBAA4C,GAEnDj1O,YAAoBg1O,GAAA/0O,KAAA+0O,eAClB/0O,KAAKg1O,kBAAoBh1O,KAAKi1O,sBAChC,CAEAC,gBAAgBxuO,GACd,cAAcA,CAChB,CAEQ+oB,MAAM/oB,GAEZ,MADc,eACDwD,KAAKxD,EAAMyxD,WAC1B,CAEA8tC,aAAav/F,GACX,IAAIu/F,GAAe,EACnB,GAAKjmG,KAAKyvB,MAGV,WAAW0lN,KAAmBn1O,KAAKg1O,kBAEjC,GADoB,IAAIhrO,OAAOmrO,EAAgB5yO,KAC/B2H,KAAKxD,GAAQ,CAC3Bu/F,GAAe,EACf,KACF,CAEF,OAAOA,EACT,CAEAE,cACE5jG,EACA6yO,GAEA,IAAKp1O,KAAKimG,aAAa1jG,GACrB,OAEF,IAAI8yO,EACJ,UAAWF,KAAmBn1O,KAAKg1O,kBAEjC,GADoB,IAAIhrO,OAAOmrO,EAAgB5yO,KAC/B2H,KAAK3H,KAKnB8yO,EAH2BD,EAAoB1rO,OAAQC,IACrDwrO,EAAgB/uI,uBAAuBpuE,SAASruB,KAERwrO,OAAkBnzO,EACxDqzO,GACF,MAIN,OAAOA,CACT,CAEQJ,uBACN,OAAQj1O,KAAK+0O,aAAa70O,IAAI,eAC5B,EACJ,4CA1DW40O,GAA2B1zO,MAAAuE,IAAA,iCAA3BmvO,EAA2BzzO,QAA3ByzO,EAA2BxzO,UAAAC,WAF1B,gBAEDuzO,CAA2B,qBCGlC,MAAOQ,WAAqB36L,MAaV96C,QAZb02L,mBAA+C,IAAIx0L,MAC1D,GAGF,SAAI0gD,GACF,OAAOziD,KAAKH,QAAQ4iD,KACtB,CAEA,OAAIhiC,GACF,OAAOzgB,KAAKH,QAAQ4gB,GACtB,CAEA1gB,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,UAEpBG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UAAWqiG,IAK3CllG,KAAKu2L,mBAAmB5zL,KAHxBuiG,EAAgBllG,KAAKyiD,MAAMmvB,eAC3BszB,EAAgBllG,KAAKyiD,MAAMgvB,cAIO,EAGxC,CAEO8jK,4BACL,YAA4DvzO,IAAxDhC,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,cAAcC,UACtCz1O,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,aAAaC,QAGrD,CAEOC,4BACL,YACmE1zO,IAAjEhC,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,cAAcG,mBAEpC31O,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,aAAaG,iBAGrD,CAEQC,uBACN,OAAO51O,KAAKu2L,mBAAmB7vL,KACjC,8BCGI,SAAUmvO,GACd95J,GAEA,OAAOA,EAAG9gC,YACPl1B,kBAAkBgC,OAClBH,QAAQ7jB,QACP0c,KAAKkH,GACHA,EACI,+CACA,kDAGZ,CAEM,SAAUmuN,GAAkB/5J,GAChC,OAAOA,EAAG9gC,YAAYv2B,UACnBnC,QAASgE,IACyB,IAA1BA,EAAO/V,MAAMgY,UAErBzkB,QAAK0c,KAAKjB,GAAsCA,EAAS5V,QAAU,GACxE,CAEM,SAAUmsO,GACdrqO,EACA+U,EACAle,EACAiB,EACAwwE,EACA3Z,GAEA,MAAMusC,EAAKrqF,MAAY+0D,gBAAgB,CACrCxuB,cAAe,CACbt/C,KAAMA,EACNjB,MACA8vE,yBAAyB,EACzBiE,gBAAgB,EAChBvvE,OAAQ,CACN0vD,OAAiB,QAATjzD,EAAiBwwE,OAAYhyE,EACrC6kG,MAAgB,QAATrjG,OAAiBxB,EAAYgyE,MAI1C,GAAe,QAAXtoE,EACF2uD,EAAaU,iBAAiB6rC,GAAI/jG,UAAW4/C,IAC3ChiC,EAAIohH,oBAAoBl/H,KAAK,CAAC8/C,IAC9BhiC,EAAIu7C,SAASvZ,EAAK,QACnB,GACmB,WAAX/2C,EAAqB,CAC9B,MAAMsqO,KAAev+J,OAA4BmvB,EAAG9jD,eACpDriC,EAAI8rF,YAAY9rF,EAAIq/B,OAAO19B,KAAM29B,IAAMA,GAAE7tC,KAAO8jO,GAClD,CACF,CAkEM,SAAU9iC,GACdz4J,EACAgI,EACA4X,EACA47K,GAEA,MAAMC,EAtEF,SAAUC,GACd17L,EACA4f,GA2DA,MAzDyB,CACvB,CACErrC,KAAM,mBACNpjB,WAAO5J,EACP6L,QAAS,GACT8I,SAAUqG,MAA0BM,YACpC+G,cAAeA,CAACrG,EAAiBuI,KAC/B,IAAI6vN,EAAuB7vN,EAAO/V,MAAMo1F,WACxC,OACEwwI,GACAA,EAAqBrvI,0BACrBqvI,EAAqB7zO,KACrB6zO,EAAqBpiK,UAEjBoiK,EAAqBn8M,MAChB,CACL,CACEtuB,KAAM,SACNJ,MAAO,OACP2L,MAAOA,CAAC4iB,EAAKvT,KACXwvN,GACE,SACAt7L,EAAUh6B,IACV8F,EAAO/V,MAAMo1F,WAAWrjG,IACxBgkB,EAAO/V,MAAMo1F,WAAWpiG,KACxB+iB,EAAO/V,MAAMo1F,WAAW5xB,UACxB3Z,GAEF+7K,EAAqBn8M,OAAQ,KAK5B,CACL,CACEtuB,KAAM,MACNJ,MAAO,UACP2L,MAAOA,CAAC4iB,EAAKvT,KACXwvN,GACE,MACAt7L,EAAUh6B,IACV8F,EAAO/V,MAAMo1F,WAAWrjG,IACxBgkB,EAAO/V,MAAMo1F,WAAWpiG,KACxB+iB,EAAO/V,MAAMo1F,WAAW5xB,UACxB3Z,GAEF+7K,EAAqBn8M,OAAQ,KAM9B,KAMjB,CAQ2Bk8M,CAAoB17L,EAAW4f,GAClDt5B,EAAS0hB,EAAMpsB,WAAWx2B,QAAQ+zE,cAAgB,GAElDyiK,EAAY5zL,EAAMpsB,WAAWx2B,QAAQw2O,WAAa,GAExD,GAAsB,IAAlBt1M,EAAOn3B,OAgCT,YA/BA6wC,EAAUQ,YAAYx2B,UACnB1gB,QACC6jG,MAAWg0C,IAAuB,IAAfA,GAAIhyI,SAAY,EACnCggD,MAAK,IAEN/mD,UAAW2c,KACV,MAAM6hC,GAAM7hC,GAAS,GAAe6hC,GAC9Bi1L,GAAsBj1L,GACzBgb,UACA3yD,OACE6sO,KACEA,GAAIx1I,WAAW,MACR,aAARw1I,IACAA,KAAQl1L,GAAG09B,oBACVw3J,GAAIr7M,MAAM,gBAEdza,IAAKla,MAEFyoB,KAAM,cAAczoB,KACpBqF,MAAOrF,GACPoQ,SAAUqG,MAA0BG,mBAG1Cm5N,GAAoB73L,WAAWy3L,GAC/Bz7L,EAAUp8B,KAAKw2H,cAAgB,CAC7BnoH,WAAW,EACXlK,MAAM,EACNmU,QAAS2/M,GACTr/M,YAAa,UAKrB,MAAMN,EAAUoK,EAAOtgB,IAAK+e,MAExBxQ,KAAM,cAAcwQ,GAAMxQ,OAC1BpjB,MAAO4zB,GAAMk+C,MAAQl+C,GAAMk+C,MAAQl+C,GAAMxQ,KACzCrY,SAAUqG,MAA0BG,gBACpCtP,QAAS2xB,GAAM3xB,QACfguB,cAAeA,KACb,MAAM26M,GAAY,GAClB,GAAIh3M,GAAMh8B,KACRgzO,UAAU,SAASh3M,GAAMh8B,SAAU,EAC5BgzO,OAMTC,GAAkBJ,EAAU51N,IAAKi2N,MAEnC1nN,KAAM,cAAc0nN,GAAS1nN,OAC7BpjB,MAAO8qO,GAASh5J,MAAQg5J,GAASh5J,MAAQg5J,GAAS1nN,KAClDrY,SAAUqG,MAA0BK,KACpC1R,KAAM+qO,GAAS/qO,KACfwtC,OAAQu9L,GAASv9L,OACjB31C,KAAM,WACNqK,QAAS6oO,GAAS7oO,QAClB/B,QAASA,KACPmqO,EAAItzO,KAAK+zO,GAAS9qO,MAAK,EAEzBiwB,cAAeA,MACJ86M,YAAY,OAK3BhgN,EAAQrvB,QAAQmvO,IAChB9/M,EAAQ8nB,WAAWy3L,GACnBz7L,EAAUp8B,KAAKw2H,cAAgB,CAC7BnoH,WAAW,EACXlK,MAAM,EACNmU,UACAM,YAAa,OAEjB,CAEM,SAAU2/M,KAMd,OAAO,IAAI7uN,MAAoC,CAC7CK,iBANwB7B,IAEO,IAA7BA,EAAO/V,MAAMi5F,cAAyD,IAAjCljF,EAAO/V,MAAM20F,iBAMxD,CC1OO,IAAM0xI,GAAmB,MAA1B,MAAOA,EAQD16L,eACA3T,cACA6xB,aACAgrC,4BACA3wB,oBAXV,YAAIoiK,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEO+1O,IAAM,IAAIl0O,UAAwBC,GAEzCjC,YACUo8C,EACA3T,EACA6xB,EACAgrC,EACA3wB,GAJA10E,KAAAm8C,iBACAn8C,KAAAwoC,gBACAxoC,KAAAq6D,eACAr6D,KAAAqlG,8BACArlG,KAAA00E,qBACP,CAEHqiK,gBAAgBt0L,EAAoBhiC,GAClC,IACuC,IAArCgiC,EAAM5iD,QAAQ46C,WAAW9J,SACzB8R,EAAMpsB,WAAWx2B,QAAQw7B,QAEzB,OAGFonB,EAAM5iD,QAAQ46C,UAAYj0C,OAAO6H,OAAO,GAAIo0C,EAAM5iD,QAAQ46C,UAAW,CACnEu8L,MAAOv0L,EAAMvwC,GACbupM,YAAah5J,EAAMvwC,GACnBy+B,SAAS,IAGX,MAAMw0K,EAAM,IAAImwB,GAAa,CAC3BpjO,GAAIuwC,EAAMvwC,GACVtG,MAAO62C,EAAM72C,MACb62C,QACAhiC,MACAw6B,YAAaj7C,KAAKi3O,mBAAmBx0L,EAAOhiC,GAC5Cm3B,YAAa,IAAIxsC,MAAY,IAC7BiT,KAAM,CACJw2H,mBAAe7yI,KAGnBkxM,UAAoBiS,EAAK1iK,EAAOziD,KAAKq6D,aAAcr6D,KAAKi2O,KACjD9wB,CACT,CAEQ8xB,mBAAmBx0L,EAAoBhiC,GAC7C,MAAMvQ,EAAQ,IAAIitF,MAAa,GAAI,CAAE18E,QACrCvQ,EAAM+wF,UAAUx+C,GAEhB,MAAMk4C,EAAkB,IAAIyM,MAAiC,IACvD8vI,EAAsB,IAAI3tI,MAAgC,IAC1D4tI,EAAwB,IAAI/xI,MAChC,CAAE3kF,OACFzgB,KAAKqlG,4BACLrlG,KAAK00E,qBAED0iK,GAA0B,IAAI5yI,MAAoC,IAClE+tG,GAAyB,IAAIjqL,MAAmC,IAChE+uN,GACJr3O,KAAKwoC,cAAcpoC,UAAU,qBAEzBoyM,GAAoB,IAAIlpG,MAA8B,CAC1D7mD,MAAO,IAAIsZ,MAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,MACZ3lD,MAAQrL,IACCupO,GACL7tO,OAAO6H,OACL,GACA,CAAEvD,YACFusO,IAAuB3qN,WAAa,KAI1Ci9B,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,IAEb56E,MACA0vE,aAAc,GACdyK,OAAQ56F,KAAK82O,SAAWj8I,MAAc59E,QAAU49E,MAAcj9E,KAC9Du6H,MAAM,EACNptC,SAAS,IAEX76F,SAAMqV,YAAYo1E,GAAiB,GACnCzqF,EAAMqV,YAAY2xN,GAAqB,GACvChnO,EAAMqV,YAAY4xN,GAAuB,GACzCjnO,EAAMqV,YAAY6xN,IAAyB,GAC3ClnO,EAAMqV,YAAYitL,IAAmB,GACrCtiM,EAAMqV,YAAYgtL,IAAwB,GAC1CriM,EAAMqV,YAAYqxN,MAA+C,GAC1D1mO,CACT,4CA3FW2mO,GAAmBz1O,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAAA0E,IAAA1E,MAAA2E,MAAA,iCAAnB8wO,EAAmBx1O,QAAnBw1O,EAAmBv1O,UAAAC,WAFlB,gBAEDs1O,CAAmB,KC7B1B,MAAOS,WAAyB38L,MAad96C,QAZb02L,mBAA+C,IAAIx0L,MAC1D,GAGF,SAAI0gD,GACF,OAAOziD,KAAKH,QAAQ4iD,KACtB,CAEA,OAAIhiC,GACF,OAAOzgB,KAAKH,QAAQ4gB,GACtB,CAEA1gB,YAAsBF,GACpBuG,MAAMvG,GADcG,KAAAH,UAEpBG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UAAWqiG,IAK3CllG,KAAKu2L,mBAAmB5zL,KAHxBuiG,EAAgBllG,KAAKyiD,MAAMmvB,eAC3BszB,EAAgBllG,KAAKyiD,MAAMgvB,cAIO,EAGxC,CAEO8jK,4BACL,YAA4DvzO,IAAxDhC,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,cAAcC,UACtCz1O,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,aAAaC,QAGrD,CAEOC,4BACL,YACmE1zO,IAAjEhC,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,cAAcG,mBAEpC31O,KAAKyiD,MAAM5iD,QAAQ46C,UAAU+6L,aAAaG,iBAGrD,CAEQC,uBACN,OAAO51O,KAAKu2L,mBAAmB7vL,KACjC,EClBK,IAAM6wO,GAAuB,MAA9B,MAAOA,EAQDp7L,eACA3T,cACA6xB,aACAgrC,4BACA3wB,oBAXV,YAAIoiK,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEO+1O,IAAM,IAAIl0O,UAAwBC,GAEzCjC,YACUo8C,EACA3T,EACA6xB,EACAgrC,EACA3wB,GAJA10E,KAAAm8C,iBACAn8C,KAAAwoC,gBACAxoC,KAAAq6D,eACAr6D,KAAAqlG,8BACArlG,KAAA00E,qBACP,CAEHqiK,gBAAgBt0L,EAAoBhiC,GAClC,IACuC,IAArCgiC,EAAM5iD,QAAQ46C,WAAW9J,SACzB8R,EAAMpsB,WAAWx2B,QAAQw7B,QAEzB,OAGFonB,EAAM5iD,QAAQ46C,UAAYj0C,OAAO6H,OAAO,GAAIo0C,EAAM5iD,QAAQ46C,UAAW,CACnEu8L,MAAOv0L,EAAMvwC,GACbupM,YAAah5J,EAAMvwC,GACnBy+B,SAAS,IAGX,MAAMw0K,EAAM,IAAImyB,GAAiB,CAC/BplO,GAAIuwC,EAAMvwC,GACVtG,MAAO62C,EAAM72C,MACb62C,QACAhiC,MACAw6B,YAAaj7C,KAAKi3O,mBAAmBx0L,EAAOhiC,GAC5Cm3B,YAAa,IAAIxsC,MAAY,IAC7BiT,KAAM,CACJw2H,mBAAe7yI,KAGnBkxM,UAAoBiS,EAAK1iK,EAAOziD,KAAKq6D,aAAcr6D,KAAKi2O,KACjD9wB,CACT,CAEQ8xB,mBAAmBx0L,EAAoBhiC,GAC7C,MAAMvQ,EAAQ,IAAIitF,MAAa,GAAI,CAAE18E,QACrCvQ,EAAM+wF,UAAUx+C,GAEhB,MAAMk4C,EAAkB,IAAIyM,MAAiC,IACvDowI,EAAiB,IAAIjwI,MAAgC,CACzDO,0BAA2B,EAC3Bl0B,aAAcnxB,EAAMpsB,WAAWx2B,QAAQ+zE,eAEnCsjK,EAAsB,IAAI3tI,MAAgC,IAC1D4tI,GAAwB,IAAI/xI,MAChC,CAAE3kF,OACFzgB,KAAKqlG,4BACLrlG,KAAK00E,qBAED0iK,GAA0B,IAAI5yI,MAAoC,IAClE+tG,GAAyB,IAAIjqL,MAAmC,IAChE+uN,GACJr3O,KAAKwoC,cAAcpoC,UAAU,qBAEzBoyM,GAAoB,IAAIlpG,MAA8B,CAC1D7mD,MAAO,IAAIsZ,MAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,MACZ3lD,MAAQrL,IACCupO,GACL7tO,OAAO6H,OACL,GACA,CAAEvD,YACFusO,IAAuB3qN,WAAa,KAI1Ci9B,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,IAEb56E,MACA0vE,aAAc,GACdyK,OAAQ56F,KAAK82O,SAAWj8I,MAAc59E,QAAU49E,MAAcj9E,KAC9Du6H,MAAM,EACNptC,SAAS,IAEX,OAAItoD,EAAM5iD,QAAQ46C,WAAWskK,oBAC3B7uM,EAAMqV,YAAYiyN,GAAgB,GAEpCtnO,EAAMqV,YAAYo1E,GAAiB,GACnCzqF,EAAMqV,YAAY2xN,GAAqB,GACvChnO,EAAMqV,YAAY4xN,IAAuB,GACzCjnO,EAAMqV,YAAY6xN,IAAyB,GAC3ClnO,EAAMqV,YAAYitL,IAAmB,GACrCtiM,EAAMqV,YAAYgtL,IAAwB,GAC1CriM,EAAMqV,YAAYqxN,MAA+C,GAC1D1mO,CACT,4CAlGWqnO,GAAuBn2O,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAAA0E,IAAA1E,MAAA2E,MAAA,iCAAvBwxO,EAAuBl2O,QAAvBk2O,EAAuBj2O,UAAAC,WAFtB,gBAEDg2O,CAAuB,iCChB7B,IAAME,GAA0B,MAAjC,MAAOA,EAEF7/N,UACAjW,gBACyBsC,KAHlClE,YACS6X,EACAjW,EACyBsC,GAFzBjE,KAAA4X,YACA5X,KAAA2B,kBACyB3B,KAAAiE,MAC/B,CAEHyzO,eACE13O,KAAKiE,KAAKmhC,QAAS,EACnBplC,KAAK4X,UAAUK,MAAMjY,KAAKiE,KAAKmhC,OACjC,CAEAuyM,kBACE33O,KAAKiE,KAAKmhC,QAAS,EACnBplC,KAAK4X,UAAUK,MAAMjY,KAAKiE,KAAKmhC,OACjC,4CAfWqyM,GAA0Br2O,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAI3BglC,OAAe,+BAJdqxM,EAA0BnpO,UAAA,uCAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mKAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICtBrC1N,MADF,UACEA,CADsB,SAEpBA,MAAA,GAQJA,UAEEA,MADF,UACEA,CADsB,cACoBA,MAAA,0BAAS2N,EAAA4oO,iBAAiB,GAClEv2O,MAAA,UACFA,QACAA,MAAA,cAA0BA,MAAA,0BAAS2N,EAAA2oO,cAAc,GAC/Ct2O,MAAA,GAEJA,iBAhBIA,MAAA,GAAAA,MAAA,IAAA2N,EAAApN,gBAAA4pB,UAAAshB,QAAA,QAAA99B,EAAA9K,KAAAT,KAAA,iFAcApC,MAAA,GAAAA,MAAA,IAAA2N,EAAApN,gBAAA4pB,UAAAshB,QAAA,iDDKQ10B,MAAkBC,MAAkB7I,KAAe1J,MAAAgK,OAAA,mFAElD4nO,CAA0B,KEOjC,MAAOG,WAAyBj9L,MAqD1BriC,OACAkwB,cACAqvM,QACAC,gBACEj4O,QAxDH02L,mBAA+C,IAAIx0L,MAC1D,GAGF,SAAI0gD,GACF,OAAOziD,KAAKH,QAAQ4iD,KACtB,CAEA,OAAIhiC,GACF,OAAOzgB,KAAKH,QAAQ4gB,GACtB,CAEQi4H,YACAhD,UACAx+B,qBAAuB,IAAIgB,KAC3B5B,eACDtU,aAAe83F,GACft/E,OAEAu9H,YAAc,IAAIv/F,MAAc,CACrCp9D,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAO,sBACP2zB,MAAO,IAETs8C,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,sBAETwgF,MAAO,IAAIysD,KAAe,CACxBn+C,OAAQ,EACRjf,OAAQ,IAAIo9D,KAAe,CACzBjtI,MAAO,sBACP2zB,MAAO,IAETs8C,KAAM,IAAIg9D,KAAa,CACrBjtI,MAAO,0BAKLysO,2BAA8BzxN,IACD,IAA5BA,EAAO/V,MAAM0/I,WAGd+nF,4BAA+B1xN,IACR,IAAtBA,EAAO/V,MAAMk8C,KAGfiiH,UACAC,YACAvzF,YAEPt7E,YACUuY,EACAkwB,EACAqvM,EACAC,EACEj4O,GAEVuG,MAAMvG,GANEG,KAAAsY,SACAtY,KAAAwoC,gBACAxoC,KAAA63O,UACA73O,KAAA83O,kBACE93O,KAAAH,UAGVG,KAAKygB,IAAIyhC,eAAe+iD,YAAYpiG,UAAWqiG,IAK3CllG,KAAKu2L,mBAAmB5zL,KAHxBuiG,EAAgBllG,KAAKyiD,MAAMmvB,eAC3BszB,EAAgBllG,KAAKyiD,MAAMgvB,cAIO,GAItCzxE,KAAK04I,YAAc14I,KAAKumM,oBACxBvmM,KAAK04I,YAAY5gC,gBAAgB93G,KAAKgiG,aAAa40B,OAEnD52H,KAAKygB,IAAI8rF,YAAYvsG,KAAKs2G,gBAE1Bt2G,KAAKs2G,eAAiB,IAAIv6C,MAAY,CACpC7pD,GAAI,iBACJtG,MAAO,UACP42C,OAAQ,IACR/+B,OAAQ,IAAIq4C,MACZnS,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,EACX5gD,UAAW,CACT9J,SAAS,IAGf,CAEAunM,cAAcptO,EAAS2vC,GACrB9b,WAAW,KACS3+B,KAAKsY,OAAOC,KAAKk/N,GAA4B,CAC7D9+N,cAAc,EACd1U,KAAM,CAAET,KAAM,YAGNqV,cAAchW,UAAWwmC,IACjC,IAAe,IAAXA,EAAkB,CACpB,IAAIn3B,EAAI3P,EACR,MAAMu6C,EAAUrC,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQyhB,QACrDq7L,GACJ19L,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQ88M,UAE3C51O,EADEu6C,EAAQlzC,OACJ5J,KAAKwoC,cAAcpoC,UAAU,eAC/BJ,KAAKwoC,cAAcpoC,UAAU,eAC7B08C,EACA,IACAq7L,GACAr7L,EAAU,IAAMq7L,GAEdn4O,KAAKwoC,cAAcpoC,UAAU,eAC/BJ,KAAKwoC,cAAcpoC,UAAU,eAAiB+3O,GAC9CA,GAGN,UAAWvhN,MAAU6jB,EAAUp8B,KAAKw2H,cAAcl+G,QAChD,UAAW1Y,MAAYnT,EAAQusB,WAAY,CACzC,IAAI+gN,GAAaxhN,GAAO5H,KACpBopN,GAAWpgN,SAAS,iBACtBogN,GAAaA,GAAW9uO,MAAM,KAAK,IAEjC8uO,KAAen6N,KAA+B,IAAnB2Y,GAAOyhN,UACpCnmO,EAAKpH,EAAQusB,WAAWpZ,IAE5B,CAEE1b,IACFA,GAAO2P,EACPlS,KAAKk4O,cAAcz9L,EAAWl4C,GAElC,GACD,EACA,IACL,CAEA+1O,YAAYxtO,EAAS2vC,GACnB3vC,EAAQuwB,SAAU,EAClB,IAAInpB,EACAkQ,GAAO,EACX,MAAMm2N,EAAa99L,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QACtD,UAAWzE,KAAU6jB,EAAUp8B,KAAKw2H,cAAcl+G,QAOhD,IALoB,SAAhBC,EAAOpzB,MAAmC,iBAAhBozB,EAAOpzB,OACnCxD,KAAK83O,gBAAgBlhN,EAAO8/M,UAAU7zO,UAAWwmC,IAC/CzS,EAAOnF,aAAe4X,KAGb,IAATjnB,EACF,UAAWnE,KAAYnT,EAAQusB,WAAY,CACzC,IAAI+gN,GAAaxhN,EAAO5H,KAIxB,GAHIopN,GAAWpgN,SAAS,iBACtBogN,GAAaA,GAAW9uO,MAAM,KAAK,IAEjC8uO,KAAen6N,IAA+B,IAAnB2Y,EAAOyhN,QAAkB,CACtDnmO,EAAKpH,EAAQusB,WAAWpZ,GACxBmE,GAAO,EACP,KACF,CACF,CAGAlQ,GACFpH,EAAQ0tO,oBAAsBvgN,KAAKC,MACjCD,KAAKouB,UAAUv7C,EAAQusB,aAEzBvsB,EAAQ2tO,kBAAoB3tO,EAAQw+E,SACpCx+E,EAAQ4tO,MAAQxmO,EAChBuoC,EAAUQ,YAAYzqC,MAAM8P,UAAU,CAAEosC,MAAM,IAC9CjS,EAAUQ,YAAYv2B,UAAUhb,OAAO1J,KAAKi4O,6BAC5Cj4O,KAAK+4I,kBAAkBjuI,EAAS2vC,KAG3B3vC,EAAQolJ,YAAcqoF,EAAW/yB,WACpC16M,EAAQolJ,YAAa,EACrBlwJ,KAAK63O,QAAQl1O,MAAK,GAClB83C,EAAUQ,YAAYzqC,MAAM8P,UAAU,CAAE4vI,YAAY,IACpDz1G,EAAUQ,YAAYv2B,UAAUhb,OAAO1J,KAAKg4O,4BACxCO,EAAWI,YAEb34O,KAAKqpM,qBADgBkvC,EAAW/yB,SACQ16M,EAAS2vC,IAEjDA,EAAUQ,YAAY51B,OAAOva,GAC7B2vC,EAAUQ,YAAYzqC,MAAMmP,OAC1B7U,EACA,CAAEolJ,YAAY,IACd,IAKV,CASAq2C,kBACE53B,EACAC,EACAvzF,GAaA,OAXoB,IAAIk6B,MAAY,CAClCvT,kBAAchgG,EACdi2G,mBAAoBj4G,KAAKk3G,qBACzBiB,kBAAmB,IAAIqgC,MAAc,IACrCnhC,iBAAkBqjF,GAChB/rB,EACAC,EACAvzF,IAKN,CAMAguH,qBACErnG,EACAl3F,EACA2vC,GAEAz6C,KAAK04I,YAAY5gC,gBAAgB9V,GACjChiG,KAAKy2I,kBAAkB3rI,EAAS2vC,EAClC,CAKQg8F,kBAAkB3rI,EAAS2vC,GACjCz6C,KAAKg3I,wBACLh3I,KAAKy4I,oBAAoB3tI,EAAS2vC,EACpC,CAKOu8F,wBACAh3I,KAAK04I,cAIN14I,KAAK01I,WACP11I,KAAK01I,UAAUvnI,cAGjBnO,KAAK04I,YAAYphC,cAASt1G,GAC5B,CAKQy2I,oBAAoB3tI,EAAS2vC,GACnCz6C,KAAK01I,UAAY11I,KAAK04I,YAAYjjC,KAAK5yG,UACpCqgG,IACCljG,KAAK+4I,kBAAkBjuI,EAAS2vC,EAAWyoD,EAAU,GAIzDljG,KAAK04I,YAAYphC,SAASt3G,KAAKygB,IAAI4gC,IAAI,EACzC,CAOQ03F,kBACNjuI,EACA2vC,EACAyoD,GAEA,MAAMlhD,EAAahiD,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBACzC,IAAI8nC,EAAWx+E,EAAQw+E,SAGnB4Z,GACFzoD,EAAUQ,YAAY51B,OAAOva,GAC7B2vC,EAAUQ,YAAYzqC,MAAMmP,OAAO7U,EAAS,CAAEolJ,YAAY,IAAQ,GAClE5mE,GAAW,IAAIuD,MAAYC,oBAAoBoW,EAAY,CACzDx+C,kBAAmB1C,EACnByC,eAAgB,cAGlB35C,EAAQw+E,SAAWA,GAEnB7uC,EAAUQ,YAAYzqC,MAAMmP,OAAO7U,EAAS,CAAE4hD,MAAM,IAAQ,GAG9D5hD,EAAQk3C,WAAa,YAErB,MAAM42L,KAAYx3I,OAAYt2F,EAASk3C,EAAWP,WAElDzhD,KAAKs2G,eAAejgF,WAAWgrB,GAAGv6C,QAClC9G,KAAKs2G,eAAejgF,WAAWgrB,GAAGy7B,WAAW87J,GAC7C54O,KAAKygB,IAAIu7C,SAASh8D,KAAKs2G,gBAEvBt2G,KAAKg3I,wBACLh3I,KAAK64O,wBAAwBD,EAAW9tO,EAAS2vC,EACnD,CAMAiqJ,iBACE1kM,KAAKygB,IAAI8rF,YAAYvsG,KAAKs2G,gBAC1Bt2G,KAAKk3G,qBAAqBpwG,QAC1B9G,KAAKygB,IAAI4gC,GAAGuuC,kBAAkB5vF,KAAKw6G,OACrC,CAKAq+H,wBACElsJ,EACA7hF,EACA2vC,GAEAz6C,KAAKygB,IAAI4gC,GAAGuuC,kBAAkB5vF,KAAKw6G,QACnC,MAAMs+H,EAAe,IAAIC,KAAW,CAACpsJ,GAAY,CAAEqsJ,QAAQ,IAC3Dh5O,KAAKw6G,OAAS,IAAI7B,KAAS,CACzBpuG,SAAUuuO,IAGZ94O,KAAKygB,IAAI4gC,GAAGsvC,eAAe3wF,KAAKw6G,QAChCs+H,EAAav+N,QAASzP,IACpBA,EAAQm5F,SAASjkG,KAAK+3O,YAAW,GAGnC/3O,KAAKw6G,OAAOlrE,GAAG,YAAc5lB,IAC3B,MAAMw5E,EAAax5E,EAAMnf,SAASumF,WAAW,IAAI3D,cAC7C+V,GACFljG,KAAK+4I,kBAAkBjuI,EAAS2vC,EAAWyoD,EAAU,EAG3D,ECpTK,IAAM+1I,GAAuB,MAA9B,MAAOA,EAgBD5+K,aACAle,eACA3T,cACA5mC,eACAH,KACA6W,OACAiiD,aACDsa,gBAtBFohK,IAAM,IAAIl0O,UAAwBC,GAClC61O,QAAU,IAAI91O,MAAyB,GACvCm3O,gBAAkB,IAAIn3O,UAC3BC,GAEKm3O,+BAAiC,IAAIp3O,MAAyB,GAC9DqoH,SAAU,EACVgvH,UAAY,IAAIC,KAChBC,cAAgB,IAAIt1L,KAE3B,YAAI8yL,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEAH,YACUs6D,EACAle,EACA3T,EACA5mC,EACAH,EACA6W,EACAiiD,GACDsa,IAPC70E,KAAAq6D,eACAr6D,KAAAm8C,iBACAn8C,KAAAwoC,gBACAxoC,KAAA4B,iBACA5B,KAAAyB,OACAzB,KAAAsY,SACAtY,KAAAu6D,gBACDv6D,KAAA60E,kBACN,CAEHkiK,gBAAgBt0L,EAAmBhiC,GACjC,IACuC,IAArCgiC,EAAM5iD,QAAQ46C,WAAW9J,UACoB,IAA7C8R,EAAMpsB,WAAWx2B,QAAQw7B,QAAQsV,QAEjC,OAEF,IAAI4oM,EAEFA,EADE92L,EAAM5iD,QAAQ46C,UACJgI,EAAM5iD,QAAQ46C,UAEd,GAEd8+L,EAAUvC,MAAQv0L,EAAMvwC,GACxBqnO,EAAU99B,YAAch5J,EAAMvwC,GAC9BqnO,EAAU5oM,SAAU,EACpB4oM,EAAUhvN,SAAWk4B,EAAM5iD,QAAQ46C,WAAWlwB,SAC9CgvN,EAAU/uN,gBAAkBi4B,EAAM5iD,QAAQ46C,WAAWjwB,gBAErD,MAAM6L,EAA4BosB,EAAMpsB,WAClCmjN,EAAY/2L,EAAMvwC,GAAK,wBACvBunO,EAAYh3L,EAAMvwC,GAAK,yBACxBuwC,EAAM5iD,QAAQk7F,eACjBt4C,EAAM5iD,QAAQk7F,aAAe,CAAEC,OAAQw+I,EAAWv+I,MAAO,KAE3D,MAAMy+I,GAAiB,CACrBx+I,cAAc,EACdC,UAAW,CAACs+I,GACZpiN,WAAY,CAAC4rF,MAAiBM,OAAQN,MAAiBE,UAGpD1gE,EAAM5iD,QAAQ46C,WAAWm3B,eAC5B8nK,GAAeriN,WAAW/vB,KAAK27G,MAAiBI,eAElD,IAAIs2H,IAAgB,EAEjBtjN,EAAWx2B,QAA2Cu4E,YAAYznC,UAEnE+oM,GAAeriN,WAAW/vB,KAAK27G,MAAiBG,YAChDu2H,IAAgB,GAEbl3L,EAAM5iD,QAAQ46C,WAAWg3B,eAC5BioK,GAAeriN,WAAW/vB,KAAK27G,MAAiBK,eAGlD,IAeI6hG,GAfAy0B,GAAsC,GAgB1C,OAfIn3L,EAAM5iD,QAAQk7F,aAAaE,QAC7B2+I,GAAc3hN,KAAKC,MACjBD,KAAKouB,UAAU5D,EAAM5iD,QAAQk7F,aAAaE,SAG9C2+I,GAAYtyO,KAAKoyO,IAEhBj3L,EAAM5iD,QAAQk7F,aAAaC,OAASv4C,EAAM5iD,QAAQk7F,aAAaC,OAC5Dv4C,EAAM5iD,QAAQk7F,aAAaC,OAC3Bw+I,EACD/2L,EAAM5iD,QAAQk7F,aAAaE,MAAQ2+I,GAKtC55O,KAAKq6D,aACFU,iBAAiB,CAChB7oD,GAAIunO,EACJ1+I,aAAc,CACZC,OAAQy+I,GAEVh/L,UAAW,CACTu8L,MAAOv0L,EAAMvwC,GACbupM,iBAAaz5M,EACb2uC,SAAS,EACT6kM,aAAc,CACZG,kBACElzL,EAAM5iD,QAAQ46C,WAAW+6L,cAAcG,kBACzCF,UAAU,GAEZlrN,SAAUk4B,EAAM5iD,QAAQ46C,WAAWlwB,SACnCC,gBAAiBi4B,EAAM5iD,QAAQ46C,WAAWjwB,iBAE5Cm/B,iBAAiB,EACjB/G,QAAS,EACTh3C,MAAO62C,EAAM72C,MACbgmE,cACEnvB,EAAM5iD,QAAQ46C,WAAWm3B,eAAiBnvB,EAAMmvB,eAAiB,EACnEH,cACEhvB,EAAM5iD,QAAQ46C,WAAWg3B,eACzBhvB,EAAMgvB,eACN8yC,IACFpuG,MAAOnW,KAAKu6D,aAAamB,YAAY,CACnC8f,KAAM,CACJjwE,MAAO,6BAET6vE,OAAQ,CACN7vE,MAAO,6BAETg8G,OAAQ,CACN/rC,KAAM,CACJjwE,MAAO,6BAET6vE,OAAQ,CACN7vE,MAAO,6BAET8uF,OAAQ,KAGZv3C,cAAe,CACbu9B,SAAUhqD,EAAWx2B,QAAQwgF,SAC7B78E,KAAM,MACNjB,IAAK8zB,EAAWx2B,QAAQ2iF,QAAUnsD,EAAWx2B,QAAQ0C,IACrDwgD,WAAW,EACXszL,UAAWhgN,EAAWx2B,QAAQw2O,UAC9BxiK,WAAax9C,EAAWx2B,QACrBg0E,WACH9sE,OAAQsvB,EAAWx2B,QAAQ04E,UAC3BH,WAAY5xE,OAAO6H,OAAO,GAAIgoB,EAAW+hD,WAAY,CACnDznC,QAASgpM,KAEX/lK,aAAcv9C,EAAWx2B,QAAQ+zE,mBAAgB5xE,EACjDq5B,QAAShF,EAAWx2B,QAAQw7B,WAG/Bx4B,UAAWg3O,KACVp5N,EAAIu7C,SAAS69K,IACbp3L,EAAMpB,GAAG+7E,cACP,CACEriC,aAAc,CACZC,OAAQv4C,EAAM5iD,QAAQk7F,aAAaC,OACnCC,MAAO2+I,MAGX,GAEFC,GAAexjN,WAAWgrB,GAAGx9C,UAE7BshN,GAAM,IAAIyyB,GACR53O,KAAKsY,OACLtY,KAAKwoC,cACLxoC,KAAK63O,QACJnB,IAA8B12O,KAAK83O,gBAAgBpB,IACpD,CACExkO,GAAIuwC,EAAMvwC,GACVtG,MAAO62C,EAAM72C,MACb62C,MAAOo3L,GACPp5N,MACAw6B,YAAaj7C,KAAKi3O,mBAAmB4C,GAAgBp5N,GACrDm3B,YAAa,IAAIxsC,MAAY,IAC7BiT,KAAM,CACJw2H,mBAAe7yI,KAIrBhC,KAAKkzM,oBAAoBiS,GAAK00B,IAE9BA,GAAeh6O,QAAQ46C,UAAUghK,YAAco+B,GAAe3nO,GAC9DuwC,EAAM5iD,QAAQ46C,UAAYj0C,OAAO6H,OAAO,GAAIo0C,EAAM5iD,QAAQ46C,UAAW,CACnE8+L,qBAGKljN,EAAWx2B,QAAQwgF,SACnB8kI,KAGJA,EACT,CAEQ8xB,mBAAmBx0L,EAAoBhiC,GAC7C,MAAMvQ,EAAQ,IAAIitF,MAAa,GAAI,CAAE18E,QACrCvQ,EAAM+wF,UAAUx+C,GAEhB,MAAMk4C,EAAkB,IAAIyM,MAAiC,IACvD8vI,EAAsB,IAAI3tI,MAAgC,IAC1D6tI,EAA0B,IAAI5yI,MAAoC,IAClE+tG,GAAyB,IAAIjqL,MAAmC,IAChEkqL,GAAoB,IAAIlpG,MAA8B,CAC1D7mD,MAAO,IAAIsZ,MAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,KACZ3lD,WAAOnU,EACP2nD,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,IAEb56E,MACA0vE,aAAc,GACdyK,OAAQ56F,KAAK82O,SAAWj8I,MAAc59E,QAAU49E,MAAcj9E,KAC9Du6H,MAAM,EACNptC,SAAS,IAEX76F,SAAMqV,YAAYo1E,GAAiB,GACnCzqF,EAAMqV,YAAY2xN,GAAqB,GACvChnO,EAAMqV,YAAY6xN,GAAyB,GAC3ClnO,EAAMqV,YAAYitL,IAAmB,GACrCtiM,EAAMqV,YAAYgtL,IAAwB,GAC1CriM,EAAMqV,YAAYqxN,MAA+C,GAC1D1mO,CACT,CAEQgjM,oBACNz4J,EACAgI,GAEA,MAAM1hB,EAAS0hB,EAAMpsB,WAAWx2B,QAAQ+zE,cAAgB,GAElDyiK,EAAY5zL,EAAMpsB,WAAWx2B,QAAQw2O,WAAa,GAExD,IAAIyD,EAAe98N,MAA0BG,gBACzCojB,EAAU,GACV5J,GAAU,GACV8/M,GAAkB,GAEtBl2M,EAAU,CACR,CACEvR,KAAM,UACNpjB,WAAO5J,EACP2U,SAAUqG,MAA0BM,YACpC+6N,SAAS,EACTh0N,cAAeA,IACN,CACL,CACE4P,UAAU,EACVtoB,KAAM,OACNJ,MAAO,UACP4B,UACoD,IAAlDs1C,EAAMpsB,WAAWx2B,QAAQw7B,QAAQ0+M,aAGnC7iO,MAAQpM,KACN2vC,EAAU69L,YAAYxtO,GAAS2vC,EAAS,GAG5C,CACExmB,UAAU,EACVtoB,KAAM,SACNJ,MAAO,OACP4B,UACoD,IAAlDs1C,EAAMpsB,WAAWx2B,QAAQw7B,QAAQ2+M,aAGnC9iO,MAAQpM,KACN2vC,EAAUy9L,cAAcptO,GAAS2vC,EAAS,GAG9C,CACExmB,UAAU,EACVtoB,KAAM,QACNJ,MAAO,UACP4B,SAAUnN,KAAKoqH,QACflzG,MAAQpM,KACN9K,KAAKi6O,YAAYnvO,GAAS2vC,EAAS,GAGvC,CACExmB,UAAU,EACVtoB,KAAM,QACNJ,MAAO,UACP4B,SAAUnN,KAAKoqH,QACflzG,MAAQpM,KACN9K,KAAKk6O,WAAWz/L,EAAW3vC,GAAO,MAQxB,IAAlBi2B,EAAOn3B,QAiCX+sB,GAAUoK,EAAOtgB,IAAK+e,KACpB,IAAI5I,GAAS,CACX5H,KAAM,cAAcwQ,GAAMxQ,OAC1BpjB,MAAO4zB,GAAMk+C,MAAQl+C,GAAMk+C,MAAQl+C,GAAMxQ,KACzCrY,SAAUmjO,EACVz1N,mBAAeriB,EACf65B,cAAeA,KACb,MAAM26M,GAAY,GAClB,GAAIh3M,GAAMh8B,KACRgzO,UAAU,SAASh3M,GAAMh8B,SAAU,EAC5BgzO,IAGX6B,SAA2B,IAAlB74M,GAAM64M,QACfxhN,QAAS2I,GAAM3I,QACfiB,WAAY0H,GAAM1H,WAClBiB,gBAAiByG,GAAMzG,gBACvBv1B,KAAMg8B,GAAMh8B,KACZiuB,kBAAczvB,EACd00O,cAAU10O,EACVwvB,SAAUgO,GAAMhO,SAChBT,KAAMyO,GAAMzO,KACZljB,QAAS2xB,GAAM3xB,SAGjB,OAAmB,SAAf2xB,GAAMh8B,MAAkC,iBAAfg8B,GAAMh8B,OACjCxD,KAAK83O,gBAAgBt4M,GAAMk3M,UAAU7zO,UAAWwmC,KAC9CzS,GAAOnF,aAAe4X,GACtBzS,GAAO8/M,SAAWl3M,GAAMk3M,WAGrB9/M,KAGT6/M,GAAkBJ,EAAU51N,IAAKi2N,MAE7B1nN,KAAM,cAAc0nN,GAAS1nN,OAC7BpjB,MAAO8qO,GAASh5J,MAAQg5J,GAASh5J,MAAQg5J,GAAS1nN,KAClDrY,SAAUqG,MAA0BK,KACpC1R,KAAM+qO,GAAS/qO,KACfwtC,OAAQu9L,GAASv9L,OACjB31C,KAAM,WACNqK,QAAS6oO,GAAS7oO,QAClB/B,QAASA,MACyB,IAA5B9L,KAAK63O,QAAQl+M,YACf35B,KAAKi2O,IAAItzO,KAAK+zO,GAAS9qO,MAAK,EAGhCiwB,cAAeA,MACJ86M,YAAY,OAK3BhgN,GAAQrvB,QAAQmvO,IAChB9/M,GAAQrvB,QAAQi5B,GAEhBka,EAAUp8B,KAAKw2H,cAAgB,CAC7BnoH,WAAW,EACXlK,MAAM,EACNmU,aA5FA8jB,EAAUQ,YAAYx2B,UACnB1gB,QACC6jG,MAAWg0C,IAAuB,IAAfA,GAAIhyI,SAAY,EACnCggD,MAAK,IAEN/mD,UAAW2c,KACV,MAAM6hC,GAAM7hC,GAAS,GAAe6hC,GAC9Bi1L,GAAsBj1L,GACzBgb,UACA3yD,OACE6sO,KACEA,GAAIx1I,WAAW,MACR,aAARw1I,IACAA,KAAQl1L,GAAG09B,oBACVw3J,GAAIr7M,MAAM,gBAEdza,IAAKla,MAEFyoB,KAAM,cAAczoB,KACpBqF,MAAOrF,GACPoQ,SAAUmjO,KAGhBr/L,EAAUp8B,KAAKw2H,cAAgB,CAC7BnoH,WAAW,EACXlK,MAAM,EACNmU,QAAS2/M,KAoEnB,CAEO2D,YAAYnvO,EAAS2vC,GAC1B,IAAKz6C,KAAKm6O,gBAAgBrvO,EAAS2vC,GACjC,OAAO,EAGTz6C,KAAKo6O,kBAAkBtvO,EAAS2vC,GAEhC,MAAMqC,EAAUrC,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQyhB,QAC3D,IAAIv6C,EAAMvC,KAAKwoC,cAAcpoC,UAAU,eAQvC,GANKmC,EAGHA,GAAOu6C,GAAoB,GAF3Bv6C,EAAMu6C,EAKJhyC,EAAQolJ,WAAY,CACtB3tJ,GAAOk4C,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQg/M,OAElD,MACM/0O,EAAU,IAAInC,KADDs3C,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQi/M,YAG9Dt6O,KAAK88E,WAAWhyE,EAAS2vC,EAAWl4C,EAAK+C,EAC3C,KAAO,CAIH/C,GAF8D,SAA9Dk4C,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQk/M,eAGzC,IACA9/L,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQm/M,UAC3C1vO,EAAQ4tO,MAEHj+L,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQm/M,UAGpD,MAAMC,EACJhgM,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQk/M,eAGvCj1O,GAAU,IAAInC,KADlBs3C,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQq/M,eAG7C16O,KAAK26O,cAAc7vO,EAAS2vC,EAAWl4C,EAAK+C,GAASm1O,EACvD,CACF,CAEO39J,WACLhyE,EACA2vC,EACAl4C,EACA+C,GAEA,GAAIm1C,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQu/M,YAAa,CAC1D,MAAMC,EACJpgM,EAAUgI,MAAM5iD,QAAQijD,cAAcznB,QAAQy/M,iBAChDhwO,EAAQusB,WACNojB,EAAUgI,MAAMpsB,WAAWx2B,QAAQkH,OAAOuxE,mBAE1C,QACAuiK,EAASniN,QAAQ,QAAS,IAC1B,IACA14B,KAAKo5O,UAAUhjB,cACbp2N,KAAKs5O,cACF78J,YAAY3xE,EAAQw+E,UACpB6D,cACA/zE,UAAU,YAAayhO,GAC1B,CAAEp2L,eAAgBo2L,GAExB,CAEA,UAAW58N,KAAYnT,EAAQusB,WAC7B,UAAWuhD,KAAMn+B,EAAUgI,MAAMpsB,WAAWx2B,QAAQ+zE,cAE/CgF,EAAG5pD,OAAS/Q,GAAY26D,EAAG9gD,YAAYgoH,UACvClnE,EAAG5pD,OAAS/Q,IAAoC,IAAxB26D,EAAG9gD,YAAYgqF,cAEjCh3G,EAAQusB,WAAWpZ,GAKhCje,KAAKoqH,SAAU,EACfpqH,KAAKyB,KACFqC,KAAK,GAAGvB,IAAOuI,EAAQusB,WAAY,CAAE/xB,QAASA,IAC9CzC,UACC,KACE7C,KAAKoqH,SAAU,EACf3vE,EAAUQ,YAAYv2B,UAAU5d,QAChC2zC,EAAUiqJ,iBACVjqJ,EAAUQ,YAAYjyC,OAAO8B,GAE7B9K,KAAK4B,eAAe6oD,QAAQ,gCAE5BzqD,KAAK+6O,WAAWtgM,EAAUgI,MAAsBhI,EAAUgI,MAAMhiC,KAChEzgB,KAAK63O,QAAQl1O,MAAK,GAClB3C,KAAKm5O,+BAA+Bx2O,MAAK,EAAI,EAE9CyB,IACCpE,KAAKoqH,SAAU,EACfhmH,EAAMA,MAAMC,QAAS,EACrB,MAAMuiC,EAAW6T,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQuL,SAC5D,GAAIA,EAAU,CACZ,IAAIgG,GACJhG,EAASrsB,QAAS/B,KAChB,MAAMjS,GAAMC,OAAOC,KAAK+R,IAAS,GAC7BpU,EAAMA,MAAMoU,QAAQwf,SAASzxB,MAC/BqmC,GAAOp0B,GAAQjS,IACfvG,KAAK4B,eAAewC,MAAMwoC,IAAI,GAG7BA,IACH5sC,KAAK4B,eAAewC,MAAM,6BAE9B,MACEpE,KAAK4B,eAAewC,MAAM,6BAA4B,EAIhE,CAEO8zO,cAAcz9L,EAA6Bl4C,GAChDvC,KAAKoqH,SAAU,EACfpqH,KAAKyB,KAAKuH,OAAO,GAAGzG,IAAO,IAAIM,UAC7B,KACE7C,KAAKoqH,SAAU,EACfpqH,KAAK4B,eAAe6oD,QAAQ,mCAE5BzqD,KAAK+6O,WAAWtgM,EAAUgI,MAAsBhI,EAAUgI,MAAMhiC,KAChE,UAAWi2N,KAAYj8L,EAAUgI,MAAM5iD,QAAQijD,cAC5CuzL,UACD57L,EAAUh6B,IAAIq/B,OAAOvlC,QAASkoC,IACxBA,EAAM72C,QAAU8qO,EAAS9qO,OAC3B62C,EAAMpsB,WAAWgrB,GAAGx9C,SAAO,EAE9B,EAGJO,IACCpE,KAAKoqH,SAAU,EACfhmH,EAAMA,MAAMC,QAAS,EACrB,MAAMuiC,EAAW6T,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQuL,SAC5D,GAAIA,EAAU,CACZ,IAAIgG,EACJhG,EAASrsB,QAAS/B,IAChB,MAAMjS,GAAMC,OAAOC,KAAK+R,GAAS,GAC7BpU,EAAMA,MAAMoU,QAAQwf,SAASzxB,MAC/BqmC,EAAOp0B,EAAQjS,IACfvG,KAAK4B,eAAewC,MAAMwoC,GAAI,GAG7BA,GACH5sC,KAAK4B,eAAewC,MAAM,6BAE9B,MACEpE,KAAK4B,eAAewC,MAAM,6BAA4B,EAI9D,CAEOu2O,cACL7vO,EACA2vC,EACAl4C,EACA+C,EACAm1O,EAAY,SAEZ,GAAIhgM,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQu/M,YAAa,CAC1D,MAAMC,EACJpgM,EAAUgI,MAAM5iD,QAAQijD,cAAcznB,QAAQy/M,iBAEhDhwO,EAAQw+E,SAASpD,YAAc80J,GAAQlwO,EAAQw+E,SAASpD,aACxDp7E,EAAQusB,WACNojB,EAAUgI,MAAMpsB,WAAWx2B,QAAQkH,OAAOuxE,mBAE1C,QACAuiK,EAASniN,QAAQ,QAAS,IAC1B,IACA14B,KAAKo5O,UAAUhjB,cACbp2N,KAAKs5O,cACF78J,YAAY3xE,EAAQw+E,UACpB6D,cACA/zE,UAAU,YAAayhO,GAC1B,CAAEp2L,eAAgBo2L,GAExB,CAEA,UAAW58N,KAAYnT,EAAQusB,WAC7B,UAAWuhD,MAAMn+B,EAAUgI,MAAMpsB,WAAWx2B,QAAQ+zE,cAE/CgF,GAAG5pD,OAAS/Q,GAAY26D,GAAG9gD,YAAYgoH,UACvClnE,GAAG5pD,OAAS/Q,IAAoC,IAAxB26D,GAAG9gD,YAAYgqF,MAC3B,cAAb7jG,WAEOnT,EAAQusB,WAAWpZ,GAKhCje,KAAKoqH,SAAU,EACfpqH,KAAKyB,KAAKg5O,GAAW,GAAGl4O,IAAOuI,EAAQusB,WAAY,CACjD/xB,QAASA,IACRzC,UACD,KACE7C,KAAKoqH,SAAU,EACfpqH,KAAKk6O,WAAWz/L,EAAW3vC,GAAS,GAEpC9K,KAAK4B,eAAe6oD,QAAQ,mCAE5BzqD,KAAK+6O,WAAWtgM,EAAUgI,MAAsBhI,EAAUgI,MAAMhiC,KAEhE,IAAIw6N,EAAiB,GACrB,UAAWvE,MAAYj8L,EAAUgI,MAAM5iD,QAAQijD,cAC5CuzL,UACD57L,EAAUh6B,IAAIq/B,OAAOvlC,QAASkoC,KACxBA,GAAM72C,QAAU8qO,GAAS9qO,QAC3BqvO,EAAe3zO,KAAKm7C,IACpBA,GAAMpsB,WAAWgrB,GAAGx9C,UAAO,GAIjC7D,KAAKk5O,gBAAgBv2O,KAAKs4O,EAAc,EAEzC72O,IACCpE,KAAKoqH,SAAU,EACfhmH,EAAMA,MAAMC,QAAS,EACrB,MAAMuiC,GAAW6T,EAAUgI,MAAMpsB,WAAWx2B,QAAQw7B,QAAQuL,SAC5D,GAAIA,GAAU,CACZ,IAAIgG,GACJhG,GAASrsB,QAAS/B,KAChB,MAAMjS,GAAMC,OAAOC,KAAK+R,IAAS,GAC7BpU,EAAMA,MAAMoU,QAAQwf,SAASzxB,MAC/BqmC,GAAOp0B,GAAQjS,IACfvG,KAAK4B,eAAewC,MAAMwoC,IAAI,GAG7BA,IACH5sC,KAAK4B,eAAewC,MAAM,6BAE9B,MACEpE,KAAK4B,eAAewC,MAAM,6BAA4B,EAI9D,CAEA81O,WAAWz/L,EAA6B3vC,EAASowO,GAAW,GAC1DpwO,EAAQuwB,SAAU,EAClBr7B,KAAK63O,QAAQl1O,MAAK,GAClB83C,EAAUiqJ,iBACVjqJ,EAAUQ,YAAYv2B,UAAU5d,QAE5BgE,EAAQolJ,YACVz1G,EAAUQ,YAAYjyC,OAAO8B,GAC7B2vC,EAAUu8F,wBAEVh3I,KAAKm5O,+BAA+Bx2O,MAAK,KAEpCu4O,IACHpwO,EAAQusB,WAAavsB,EAAQ0tO,oBAC7B1tO,EAAQw+E,SAAWx+E,EAAQ2tO,0BAEtB3tO,EAAQ0tO,2BACR1tO,EAAQ2tO,kBAEnB,CAEAX,gBAAgBpB,GACd,IAAIn0O,EAAMm0O,EAASn0O,IACnB,OAAKA,IACHA,EAAMvC,KAAKwoC,cAAcpoC,UAAU,eAC/BJ,KAAKwoC,cAAcpoC,UAAU,eAAiBs2O,EAAS//I,MACvD+/I,EAAS//I,OAGR32F,KAAKyB,KAAKvB,IAASqC,GAAKwB,QAC7B0c,KAAK4oB,GACIA,IACR,EACDnlC,MAAYC,IACVA,EAAIC,MAAMC,QAAS,KACZm/D,MAAWr/D,KAGxB,CAOA42O,WAAWt4L,EAAoBhiC,GAC7B,MAAM06N,EAAa14L,EAAMpsB,WAAWgrB,GAoBpC85L,EAAWz4H,UAnBmBt9C,CAC5BoL,EACAlV,EACA/Z,GACAkJ,GACAk4D,MAEAlgE,EAAMmkE,gBACJnkE,EAAMpB,GAAGsC,YACTlB,EAAM5iD,QAAQijD,cACd9iD,KAAK60E,gBACLrE,EACAlV,EACA/Z,GACAkJ,GACAk4D,IACA,EAAI,GAIRw4H,EAAWt3O,UAEX,UAAWu+C,KAAO3hC,EAAIq/B,OACpB,GACEsC,EAAIlwC,KAAOuwC,EAAMvwC,IACjBkwC,EAAIviD,QAAQk7F,cAAcC,OAAOhjE,SAC/ByqB,EAAMvwC,GAAGo4C,OAAO,EAAG7H,EAAMvwC,GAAGxJ,QAAQ,KAAO,KAE7C05C,EAAIviD,QAAQk7F,cAAcC,OAAOhjE,SAAS,wBAC1C,CACA,MAAMojN,EAAah5L,EAAI/rB,WAAWgrB,GAClC,IAAIt6C,GAASq0O,EAAWt6G,YACxB/5H,GAAOs0O,QAASp6O,MAAOC,UACvBk6O,EAAWr6J,aAAah6E,GAC1B,CAEJ,CAEAozO,gBAAgBrvO,EAAS2vC,GACvB,IACIl0C,EACAw/B,GAAQ,EACZ0U,SAAUp8B,KAAKw2H,cAAcl+G,QAAQpc,QAASqc,IACxCA,EAAOjc,eAAe,eAAiBic,EAAOkB,aAChDvxB,EAAM6wB,GAAiCR,EAAO5H,MAC9CxoB,OAAOC,KAAKmwB,EAAOkB,YAAYvd,QAAS/W,KACtC,OAAQA,IACN,IAAK,YAEDozB,EAAOkB,WAAWt0B,OAChBsH,EAAQusB,WAAW1c,eAAepU,KACjCuE,EAAQusB,WAAW9wB,MAEtBw/B,GAAQ,EACR/lC,KAAK4B,eAAewC,MAClB,wCACApC,OACAA,EACA,CAAE40B,OAAQA,EAAOhrB,SAGrB,MAEF,IAAK,WAEDd,EAAQusB,WAAW1c,eAAepU,IAClCuE,EAAQusB,WAAW9wB,IACnBuE,EAAQusB,WAAW9wB,GAAOqwB,EAAOkB,WAAWt0B,MAE5CuiC,GAAQ,EACR/lC,KAAK4B,eAAewC,MAClB,uCACApC,OACAA,EACA,CACE40B,OAAQA,EAAOhrB,MACflF,MAAOkwB,EAAOkB,WAAWt0B,OAI/B,MAEF,IAAK,WAEDsH,EAAQusB,WAAW1c,eAAepU,IAClCuE,EAAQusB,WAAW9wB,IACnBuE,EAAQusB,WAAW9wB,GAAOqwB,EAAOkB,WAAWt0B,MAE5CuiC,GAAQ,EACR/lC,KAAK4B,eAAewC,MAClB,uCACApC,OACAA,EACA,CACE40B,OAAQA,EAAOhrB,MACflF,MAAOkwB,EAAOkB,WAAWt0B,OAI/B,MAEF,IAAK,YAEDsH,EAAQusB,WAAW1c,eAAepU,IAClCuE,EAAQusB,WAAW9wB,IACnBuE,EAAQusB,WAAW9wB,GAAKqD,OAASgtB,EAAOkB,WAAWt0B,MAEnDuiC,GAAQ,EACR/lC,KAAK4B,eAAewC,MAClB,wCACApC,OACAA,EACA,CACE40B,OAAQA,EAAOhrB,MACflF,MAAOkwB,EAAOkB,WAAWt0B,OAI/B,MAEF,IAAK,YAEDsH,EAAQusB,WAAW1c,eAAepU,IAClCuE,EAAQusB,WAAW9wB,IACnBuE,EAAQusB,WAAW9wB,GAAKqD,OAASgtB,EAAOkB,WAAWt0B,MAEnDuiC,GAAQ,EACR/lC,KAAK4B,eAAewC,MAClB,wCACApC,OACAA,EACA,CACE40B,OAAQA,EAAOhrB,MACflF,MAAOkwB,EAAOkB,WAAWt0B,OAMnC,GACD,GAGEuiC,CACT,CAEAq0M,kBAAkBtvO,EAAS2vC,GACzBA,EAAUp8B,KAAKw2H,cAAcl+G,QAAQpc,QAASqc,IAE1B,SAAhBA,EAAOpzB,MACPsH,EAAQusB,WAAWD,GAAiCR,EAAO5H,SAE3DlkB,EAAQusB,WAAWD,GAAiCR,EAAO5H,OACzDlkB,EAAQusB,WACND,GAAiCR,EAAO5H,OACxCmpC,WAAQ,EAGlB,4CAt0BW8gL,GAAuB73O,MAAAuE,OAAAvE,MAAAwE,OAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,OAAA5E,MAAAuT,MAAAvT,MAAAyT,OAAA,iCAAvBokO,EAAuB53O,QAAvB43O,EAAuB33O,UAAAC,WAFtB,gBAED03O,CAAuB,KAy0BpC,SAAS7hN,GAAiCR,GACxC,OAAIA,EAAOoB,SAAS,eACXpB,EAAOttB,MAAM,KAAK,GAEpBstB,CACT,CAEA,SAASokN,GAAQ/8G,GACf,OAAsB,IAAlBA,EAAOr0H,OAAqBq0H,EACP,iBAAdA,EAAO,GAAwBA,EAAOp6G,MAAM,EAAG,GACnDo6G,EAAOx9G,IAAIu6N,GACpB,iBCn2BO,IAAMM,GAAmB,MAA1B,MAAOA,EAQDjhL,aACAle,eACAu4B,oBACAna,aACA/xB,cACA68D,4BAZV,YAAIyxI,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEO+1O,IAAM,IAAIl0O,UAAwBC,GAEzCjC,YACUs6D,EACAle,EACAu4B,EACAna,EACA/xB,EACA68D,GALArlG,KAAAq6D,eACAr6D,KAAAm8C,iBACAn8C,KAAA00E,sBACA10E,KAAAu6D,eACAv6D,KAAAwoC,gBACAxoC,KAAAqlG,6BACP,CAEH0xI,gBAAgBt0L,EAAmBhiC,GACjC,IACGgiC,EAAM5iD,QAAQ46C,WACfh6B,EAAIq/B,OAAO19B,KACRggC,IAAQA,GAAIlwC,KAAOuwC,EAAMvwC,GAAK,2BAEjCuwC,EAAMpsB,WAAWx2B,QAAQw7B,QAEzB,OAEF,MAAMhF,EAA4BosB,EAAMpsB,WAClCmjN,EAAY/2L,EAAMvwC,GAAK,wBACvBunO,EAAYh3L,EAAMvwC,GAAK,yBACxBuwC,EAAM5iD,QAAQk7F,eACjBt4C,EAAM5iD,QAAQk7F,aAAe,CAAEC,OAAQw+I,EAAWv+I,MAAO,KAE3D,MAAMy+I,EAAiB,CACrBx+I,cAAc,EACdC,UAAW,CAACs+I,GACZpiN,WAAY,CAAC4rF,MAAiBM,OAAQN,MAAiBE,UAGpD1gE,EAAM5iD,QAAQ46C,WAAWm3B,eAC5B8nK,EAAeriN,WAAW/vB,KAAK27G,MAAiBI,eAElD,IAAIs2H,IAAgB,EAEjBtjN,EAAWx2B,QAA2Cu4E,YAAYznC,UAEnE+oM,EAAeriN,WAAW/vB,KAAK27G,MAAiBG,YAChDu2H,IAAgB,GAEbl3L,EAAM5iD,QAAQ46C,WAAWg3B,eAC5BioK,EAAeriN,WAAW/vB,KAAK27G,MAAiBK,eAGlD,IAgBI6hG,GAhBAy0B,GAAsC,GA+B1C,OA9BIn3L,EAAM5iD,QAAQk7F,aAAaE,QAC7B2+I,GAAc3hN,KAAKC,MACjBD,KAAKouB,UAAU5D,EAAM5iD,QAAQk7F,aAAaE,SAG9C2+I,GAAYtyO,KAAKoyO,GAEhBj3L,EAAM5iD,QAAQk7F,aAAaC,OAASv4C,EAAM5iD,QAAQk7F,aAAaC,OAC5Dv4C,EAAM5iD,QAAQk7F,aAAaC,OAC3Bw+I,EACD/2L,EAAM5iD,QAAQk7F,aAAaE,MAAQ2+I,GAoBtC55O,KAAKq6D,aACFU,iBAAiB,CAChB5F,oBAAoB,EACpBjjD,GAAIunO,EACJ1+I,aAAc,CACZC,OAAQy+I,GAEVh/L,UArBsC,CACxC8gM,UAAW94L,EAAM5iD,QAAQ46C,WAAW8gM,UACpCvE,MAAOv0L,EAAMvwC,GACbupM,iBAAaz5M,EACb2uC,SAAS,EACT6kM,aAAc,CACZG,kBACElzL,EAAM5iD,QAAQ46C,WAAW+6L,cAAcG,kBACzCF,SAAUhzL,EAAM5iD,QAAQ46C,WAAW+6L,cAAcC,UAEnDlrN,SAAUk4B,EAAM5iD,QAAQ46C,WAAWlwB,SACnCC,gBAAiBi4B,EAAM5iD,QAAQ46C,WAAWjwB,iBAWxCm/B,iBAAiB,EACjB/G,QAAS,EACTh3C,MAAO62C,EAAM72C,MACbgmE,cACEnvB,EAAM5iD,QAAQ46C,WAAWm3B,eAAiBnvB,EAAMmvB,eAAiB,EACnEH,cACEhvB,EAAM5iD,QAAQ46C,WAAWg3B,eACzBhvB,EAAMgvB,eACN8yC,IACFpuG,MAAOnW,KAAKu6D,aAAamB,YAAY,CACnC8f,KAAM,CACJjwE,MAAO,6BAET6vE,OAAQ,CACN7vE,MAAO,6BAETg8G,OAAQ,CACN/rC,KAAM,CACJjwE,MAAO,6BAET6vE,OAAQ,CACN7vE,MAAO,6BAET8uF,OAAQ,KAGZv3C,cAAe,CACbu9B,SAAUhqD,EAAWx2B,QAAQwgF,SAC7B78E,KAAM,MACNjB,IAAK8zB,EAAWx2B,QAAQ2iF,QAAUnsD,EAAWx2B,QAAQ0C,IACrDwgD,WAAW,EACXszL,UAAWhgN,EAAWx2B,QAAQw2O,UAC9BxiK,WAAax9C,EAAWx2B,QACrBg0E,WACHo8E,kBAAkBxtG,EAAM5iD,QAAQ46C,WAAW9J,SACtCta,EAAWx2B,QACTowJ,iBAEPlpJ,OAAQsvB,EAAWx2B,QAAQ04E,UAC3BH,WAAY5xE,OAAO6H,OAAO,GAAIgoB,EAAW+hD,WAAY,CACnDznC,QAASgpM,KAEX/lK,aAAcv9C,EAAWx2B,QAAQ+zE,mBAAgB5xE,KAGpDa,UAAWg3O,KAaV,GAZAp5N,EAAIu7C,SAAS69K,IACbp3L,EAAMpB,GAAG+7E,cACP,CACEriC,aAAc,CACZC,OAAQv4C,EAAM5iD,QAAQk7F,aAAaC,OACnCC,MAAO2+I,MAGX,GAEFC,GAAexjN,WAAWgrB,GAAGx9C,UAExB4+C,EAAM5iD,QAAQ46C,WAAW9J,QAG9Bw0K,UAAM,IAAImwB,GAAa,CACrBpjO,GAAIuwC,EAAMvwC,GACVtG,MAAO62C,EAAM72C,MACb62C,MAAOo3L,GACPp5N,MACAw6B,YAAaj7C,KAAKi3O,mBAAmB4C,GAAgBp5N,GACrDm3B,YAAa,IAAIxsC,MAAY,IAC7BiT,KAAM,CACJw2H,mBAAe7yI,KAGnBkxM,GAAoBiS,GAAK00B,GAAgB75O,KAAKq6D,aAAcr6D,KAAKi2O,KAEjE4D,GAAeh6O,QAAQ46C,UAAUghK,YAAco+B,GAAe3nO,GAC9DuwC,EAAM5iD,QAAQ46C,UAAYj0C,OAAO6H,OAAO,GAAIo0C,EAAM5iD,QAAQ46C,UAAW,CACnE9J,SAAS,EACTqmM,MAAOv0L,EAAMvwC,GACbupM,YAAao+B,GAAe3nO,GAC5BsjO,aAAc,CACZG,kBACElzL,EAAM5iD,QAAQ46C,WAAW+6L,cAAcG,kBACzCF,SAAUhzL,EAAM5iD,QAAQ46C,WAAW+6L,cAAcC,UAEnDlrN,SAAUk4B,EAAM5iD,QAAQ46C,WAAWlwB,SACnCC,gBAAiBi4B,EAAM5iD,QAAQ46C,WAAWjwB,yBAGrC6L,EAAWx2B,QAAQwgF,SACnB8kI,KAGJA,EACT,CAEQ8xB,mBAAmBx0L,EAAoBhiC,GAC7C,MAAMvQ,EAAQ,IAAIitF,MAAa,GAAI,CAAE18E,QACrCvQ,EAAM+wF,UAAUx+C,GAEhB,MAAMk4C,EAAkB,IAAIyM,MAAiC,IACvD8vI,EAAsB,IAAI3tI,MAAgC,IAC1D4tI,EAAwB,IAAI/xI,MAChC,CAAE3kF,OACFzgB,KAAKqlG,4BACLrlG,KAAK00E,qBAED0iK,GAA0B,IAAI5yI,MAAoC,IAClE+tG,GAAyB,IAAIjqL,MAAmC,IAChE+uN,GACJr3O,KAAKwoC,cAAcpoC,UAAU,qBAEzBoyM,GAAoB,IAAIlpG,MAA8B,CAC1D7mD,MAAO,IAAIsZ,MAAY,CACrBvZ,OAAQ,IACR/+B,OAAQ,IAAIq4C,KACZ3lD,MAAQrL,IACCupO,GACL7tO,OAAO6H,OACL,GACA,CAAEvD,YACFusO,IAAuB3qN,WAAa,KAI1Ci9B,iBAAiB,EACjByxC,YAAY,EACZC,WAAW,IAEb56E,MACA0vE,aAAc,GACdyK,OAAQ56F,KAAK82O,SAAWj8I,MAAc59E,QAAU49E,MAAcj9E,KAC9Du6H,MAAM,EACNptC,SAAS,IAEX76F,SAAMqV,YAAYo1E,GAAiB,GACnCzqF,EAAMqV,YAAY2xN,GAAqB,GACvChnO,EAAMqV,YAAY4xN,GAAuB,GACzCjnO,EAAMqV,YAAY6xN,IAAyB,GAC3ClnO,EAAMqV,YAAYitL,IAAmB,GACrCtiM,EAAMqV,YAAYgtL,IAAwB,GAC1CriM,EAAMqV,YAAYqxN,MAA+C,GAC1D1mO,CACT,4CAzOWorO,GAAmBl6O,MAAAuE,OAAAvE,MAAAwE,OAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA1E,MAAA2E,MAAA3E,MAAA4E,IAAA,iCAAnBs1O,EAAmBj6O,QAAnBi6O,EAAmBh6O,UAAAC,WAFlB,gBAED+5O,CAAmB,KCZnBE,GAA0B,MAAjC,MAAOA,EAgBDp/N,UACAq/N,oBACAC,oBACAC,wBACAC,wBAnBFnyL,SACA7iC,WAA6B,GAE5BnG,IAECo7N,gBAAkB,IAAIvuO,MACtBwyB,cAAgB,IAAIxyB,MACpB2tO,eAAiB,IAAI3tO,MACrBwuO,8BAAgC,IAAIxuO,MAE9C,kBAAIyuO,GACF,OAAO/7O,KAAKoc,UAAUlM,KACxB,CAEAnQ,YACUqc,EACAq/N,EACAC,EACAC,EACAC,GAJA57O,KAAAoc,YACApc,KAAAy7O,sBACAz7O,KAAA07O,sBACA17O,KAAA27O,0BACA37O,KAAA47O,yBACP,CAEHruO,WACEvN,KAAKypD,SAAWzpD,KAAKygB,IAAI0hC,QACtBp+C,QAAKof,MAAa,KAClBtgB,UAAWi9C,GAAoB9/C,KAAKg8O,eAAel8L,IAEtD9/C,KAAK47O,wBAAwB3F,IAAIpzO,UAAWk5E,IAC1C/7E,KAAK67O,gBAAgBztO,KAAK2tE,EAAE,GAE9B/7E,KAAK07O,oBAAoBzF,IAAIpzO,UAAWk5E,IACtC/7E,KAAK67O,gBAAgBztO,KAAK2tE,EAAE,GAE9B/7E,KAAKy7O,oBAAoBxF,IAAIpzO,UAAWk5E,IACtC/7E,KAAK67O,gBAAgBztO,KAAK2tE,EAAE,GAE9B/7E,KAAK27O,wBAAwB1F,IAAIpzO,UAAWk5E,IAC1C/7E,KAAK67O,gBAAgBztO,KAAK2tE,EAAE,GAE9B/7E,KAAK27O,wBAAwB9D,QAAQh1O,UAAWo5O,IAC9Cj8O,KAAK8/B,cAAc1xB,KAAK6tO,EAAM,GAEhCj8O,KAAK27O,wBAAwBzC,gBAAgBr2O,UAAWi9C,IACtD9/C,KAAKi7O,eAAe7sO,KAAK0xC,EAAM,GAEjC9/C,KAAK27O,wBAAwBxC,+BAA+Bt2O,UACzD0pC,IACCvsC,KAAK87O,8BAA8B1tO,KAAKm+B,EAAS,EAGvD,CAEAr+B,cACElO,KAAKypD,SAASt7C,cACdnO,KAAK4mB,WAAWnG,IAAKjB,GAAaA,EAASrR,cAC7C,CAEQ6tO,eAAel8L,GACrB,MAAMo8L,EAAiBp8L,EAAOp2C,OAAQ+4C,GACpCziD,KAAKm8O,gBAAgB15L,IAEjB25L,EAAoBF,EAAez7N,IAAKgiC,GAAiBA,EAAMvwC,IAE/DmqO,EAAkBH,EACrBz7N,IAAKgiC,GAAuBziD,KAAKs8O,qBAAqB75L,IACtD/4C,OAAQ+wC,QAAmDz4C,IAAdy4C,GAE1C8hM,EAAqBv8O,KAAK+7O,eAC7B95N,MACAvY,OAAQ+wC,GACA2hM,EAAkB1zO,QAAQ+xC,EAAUvoC,IAAM,GAGjDqqO,EAAmB3yO,OAAS,IAC9B2yO,EAAmBhiO,QAASkgC,IAC1BA,EAAUQ,YAAYh1B,yBACpBsjF,MAEF9uD,EAAUv0B,YAAU,GAEtBlmB,KAAK+7O,eAAevrO,MAAMqP,WAAW08N,EAAoB,CACvD50N,QAAQ,EACRa,UAAU,IAEZxoB,KAAK+7O,eAAe51N,WAAWo2N,IAG7BF,EAAgBzyO,OAAS,GAC3B5J,KAAK+7O,eAAez2N,WAAW+2N,EAEnC,CAEQC,qBACN75L,GAGA,QAAkBzgD,IADAhC,KAAK+7O,eAAe77O,IAAIuiD,EAAMvwC,IAIhD,IACEuwC,EAAMpsB,sBAAsB+/C,QACkB,IAA9C3zB,EAAMpsB,WAAWx2B,QAAQw7B,SAASsV,QAMlC,OAJe3wC,KAAKy7O,oBAAoB1E,gBACtCt0L,EACAziD,KAAKygB,KAGF,GACLgiC,EAAMpsB,sBAAsBmgD,QACkB,IAA9C/zB,EAAMpsB,WAAWx2B,QAAQw7B,SAASsV,QAClC,CACA,IAAK8R,EAAMpsB,WAAWx2B,QAAQ04E,UAC5B,OAEF,MAAMikK,EAASx8O,KAAK07O,oBAAoB3E,gBACtCt0L,EACAziD,KAAKygB,KAEP+7N,UAAQjmD,mBAAmB1zL,UAAWknN,IACnCtnK,EAAMpsB,WAAWx2B,QAAuCkjD,WACtDgnK,EAEDyyB,EAAO/5L,MAAMpsB,WAAWx2B,QACxBkjD,UAAYgnK,IAETyyB,CACT,CAAO,GACL/5L,EAAMpsB,sBAAsBylC,QACU,IAArCrZ,EAAsB24C,aACuB,IAA9C34C,EAAMpsB,WAAWx2B,QAAQw7B,SAASsV,QAMlC,OAJmB3wC,KAAK47O,wBAAwB7E,gBAC9Ct0L,EACAziD,KAAKygB,KAGF,GACLgiC,EAAMpsB,sBAAsBmgD,QACkB,IAA9C/zB,EAAMpsB,WAAWx2B,QAAQw7B,SAASsV,QAMlC,OAJmB3wC,KAAK27O,wBAAwB5E,gBAC9Ct0L,EACAziD,KAAKygB,IAAG,CAMd,CAEQ07N,gBAAgB15L,GACtB,MAAMpsB,EAAaosB,EAAMpsB,WAIzB,OAHIA,aAAsB+/C,OAGtB//C,aAAsBylC,OAGtBzlC,aAAsBmgD,SACGngD,EAAWx2B,SACpC,IAEkBu4E,YAAYznC,cACiB3uC,IAA/Cq0B,EAAWx2B,QAAQ04E,WAAWoK,aAKpC,4CA1KW64J,GAA0Bp6O,MAAAuE,OAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,IAAA1E,MAAA2E,IAAA,+BAA1By1O,EAA0BltO,UAAA,iCAAAC,OAAA,CAAAkS,IAAA,OAAAjS,QAAA,CAAAqtO,gBAAA,kBAAA/7M,cAAA,gBAAAm7M,eAAA,iBAAAa,8BAAA,iCAAArtO,YAAA,WAA1B+sO,CAA0B,yMChChC,IAAMv2O,EAAM,KAAb,MAAOA,EACHwnB,eAAyB,IACzBA,aAJR,mEAMQ,cAAOgwN,CAAQ7gO,EAAWwzB,GAEhC,OADUxzB,EAAE8gO,WAAWttM,EAEzB,CAEQ,gBAAOutM,CAAU/gO,EAAWwzB,GAElC,OADYpvC,KAAK48O,MAAMl0O,QAAQkT,EAAE8yB,OAAOU,GAE1C,CAEO,aAAOxuC,CAAOgb,GACnB,IACEwzB,EACAytM,EAFEC,EAAO,EAGTC,EAAOnhO,EAAEhS,OACTmqE,GAAI,GAIN,GAFAn4D,EAAI6tB,OAAO7tB,GAEE,IAATmhO,EACF,OAAOnhO,EAWT,IARIA,EAAE8yB,OAAOquM,EAAO,KAAO/8O,KAAKg9O,UAC9BF,EAAO,EACHlhO,EAAE8yB,OAAOquM,EAAO,KAAO/8O,KAAKg9O,UAC9BF,EAAO,GAETC,GAAQ,GAGL3tM,EAAI,EAAGA,EAAI2tM,EAAM3tM,GAAK,EACzBytM,EACG78O,KAAK28O,UAAU/gO,EAAGwzB,IAAM,GACxBpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,IAAM,GAC5BpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,IAAM,EAC7BpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,GACxB2kC,GAAEzsE,KAAKmiC,OAAOo0K,aAAag/B,GAAO,GAAKA,GAAO,EAAK,IAAW,IAANA,IAG1D,OAAQC,GACN,KAAK,EACHD,EACG78O,KAAK28O,UAAU/gO,EAAGwzB,IAAM,GACxBpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,IAAM,GAC5BpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,IAAM,EAC/B2kC,GAAEzsE,KAAKmiC,OAAOo0K,aAAag/B,GAAO,GAAKA,GAAO,EAAK,MACnD,MACF,KAAK,EACHA,EAAO78O,KAAK28O,UAAU/gO,EAAGwzB,IAAM,GAAOpvC,KAAK28O,UAAU/gO,EAAGwzB,EAAI,IAAM,GAClE2kC,GAAEzsE,KAAKmiC,OAAOo0K,aAAag/B,GAAO,KAItC,OAAO9oK,GAAElqE,KAAK,GAChB,CAEO,aAAO3E,CAAO0W,GAGnB,IAAIwzB,EACFytM,EACA9oK,EAAI,GACJgpK,GALFnhO,EAAI6tB,OAAO7tB,IAKAhS,OAAUgS,EAAEhS,OAAS,EAEhC,GAAiB,IAAbgS,EAAEhS,OACJ,OAAOgS,EAGT,IAAKwzB,EAAI,EAAGA,EAAI2tM,EAAM3tM,GAAK,EACzBytM,EACG78O,KAAKy8O,QAAQ7gO,EAAGwzB,IAAM,GACtBpvC,KAAKy8O,QAAQ7gO,EAAGwzB,EAAI,IAAM,EAC3BpvC,KAAKy8O,QAAQ7gO,EAAGwzB,EAAI,GACtB2kC,EAAEzsE,KAAKtH,KAAK48O,MAAMluM,OAAOmuM,GAAO,KAChC9oK,EAAEzsE,KAAKtH,KAAK48O,MAAMluM,OAAQmuM,GAAO,GAAM,KACvC9oK,EAAEzsE,KAAKtH,KAAK48O,MAAMluM,OAAQmuM,GAAO,EAAK,KACtC9oK,EAAEzsE,KAAKtH,KAAK48O,MAAMluM,OAAa,GAANmuM,IAG3B,OAAQjhO,EAAEhS,OAASmzO,GACjB,KAAK,EACHF,EAAM78O,KAAKy8O,QAAQ7gO,EAAGwzB,IAAM,GAC5B2kC,EAAEzsE,KACAtH,KAAK48O,MAAMluM,OAAOmuM,GAAO,IACvB78O,KAAK48O,MAAMluM,OAAQmuM,GAAO,GAAM,IAChC78O,KAAKg9O,QACLh9O,KAAKg9O,SAET,MACF,KAAK,EACHH,EAAO78O,KAAKy8O,QAAQ7gO,EAAGwzB,IAAM,GAAOpvC,KAAKy8O,QAAQ7gO,EAAGwzB,EAAI,IAAM,EAC9D2kC,EAAEzsE,KACAtH,KAAK48O,MAAMluM,OAAOmuM,GAAO,IACvB78O,KAAK48O,MAAMluM,OAAQmuM,GAAO,GAAM,IAChC78O,KAAK48O,MAAMluM,OAAQmuM,GAAO,EAAK,IAC/B78O,KAAKg9O,SAKb,OAAOjpK,EAAElqE,KAAK,GAChB,GA1GiB,kBCHb,SAAUywN,EAAkB14J,GAChC,OAAOA,EAAWnhD,IAAKw8N,GACjBA,aAAiB/tK,KACZ+tK,EAAM9kL,gBAEEn2D,IAAVi7O,EAAsBhlN,KAAKC,MAAMD,KAAKouB,UAAU42L,IAAUA,EAErE,gBCHO,MAAMjtG,QAAYktG,aACvB31O,OAAO2jE,UAAU8kE,WCLb,MAAOtkF,EACX,WAAOC,CAAKtjD,GACV,IAAI80O,GAAa,EACjB,GAAuB,iBAAZ90O,EAAsB,CAC/B,MAAMkwD,EAAW7M,EAAU0xL,eAAe/0O,GAC1CqjD,EAAU2xL,WAAW9kL,GACrB4kL,EAAazxL,EAAUD,sBACvBC,EAAU4xL,gBAAgB/kL,EAC5B,MACE7M,EAAU2xL,WAAWh1O,GACrB80O,EAAazxL,EAAUD,sBAEzB,OAAO0xL,CACT,CAEQ,qBAAOC,CAAexwM,GAC5B,MAAM2rB,EAAWjwD,SAASC,cAAc,YACxCgwD,SAAS7xD,MAAQkmC,EACjBtkC,SAASlF,KAAK6zF,YAAY1+B,GACnBA,CACT,CAEQ,sBAAO+kL,CAAgB/kL,GAC7BjwD,SAASlF,KAAKqjJ,YAAYluF,EAC5B,CAEQ,iBAAO8kL,CAAW9kL,GACxB,GAA8B,QAA1By3E,EAAUutG,YAAuB,CACnC,MAAMC,EAAqBjlL,EAASklL,gBAC9BC,EAAcnlL,EAASolL,SACvBzjN,EAAQ5xB,SAAS6xB,cACjBzN,EAAYnlB,OAAO8yB,eAEzBk+B,EAASqlL,iBAAkB,EAC3BrlL,EAASunF,UAAW,EACpB5lH,EAAM2jN,mBAAmBtlL,GACzB7rC,EAAU4N,kBACV5N,EAAU6N,SAASL,GACnBq+B,EAASulL,kBAAkB,EAAG,QAC9BvlL,EAASklL,gBAAkBD,EAC3BjlL,EAASolL,SAAWD,CACtB,MACEnlL,EAAStrC,QAEb,CAEQ,0BAAOw+B,GACb,OAAgC,QAA1BukF,EAAUutG,cAAyBvtG,EAAU+tG,eAAe,SACzDz1O,SAAS01O,YAAY,OAGhC,iBCjDF,SAASC,EAAU5kO,EAAW6kO,EAAqBt0O,GAGjD,OAAQyP,GAAK6kO,GADC,GAAKt0O,GAAU,CAG/B,CAEM,MAAO00I,EACH6/F,YAAc,IAAIj/N,IAClBk/N,YAAc,IAAIl/N,IAE1Bnf,cACEC,KAAKq+O,qBACP,CAEQA,sBAGN,QAASjvM,EAAI,EAAGA,EAAI,GAAIA,IACtBpvC,KAAKm+O,YAAY99O,IAAIopC,OAAOo0K,aAAa,GAAoBzuK,GAAIA,GACjEpvC,KAAKo+O,YAAY/9O,IAAI+uC,EAAG3F,OAAOo0K,aAAa,GAAoBzuK,IAGlE,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACtBpvC,KAAKm+O,YAAY99O,IAAIopC,OAAOo0K,aAAa,GAAoBzuK,GAAIA,EAAI,IACrEpvC,KAAKo+O,YAAY/9O,IAAI+uC,EAAI,GAAI3F,OAAOo0K,aAAa,GAAoBzuK,IAGvE,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACtBpvC,KAAKm+O,YAAY99O,IAAIopC,OAAOo0K,aAAa,GAAoBzuK,GAAIA,EAAI,IACrEpvC,KAAKo+O,YAAY/9O,IAAI+uC,EAAI,GAAI3F,OAAOo0K,aAAa,GAAoBzuK,IAGvEpvC,KAAKm+O,YAAY99O,IAAI,IAAK,IAC1BL,KAAKm+O,YAAY99O,IAAI,IAAK,IAC1BL,KAAKo+O,YAAY/9O,IAAI,GAAI,KACzBL,KAAKo+O,YAAY/9O,IAAI,GAAI,IAC3B,CAEAu+I,aAAa71G,GACX,OAAKA,EAIc,IAAInuB,IAAYouB,IACjC,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,cAAcJ,GACrBE,EAAOgf,OAAS,KACd,MAAMq2L,EAASr1M,EAAOI,OAAO6uK,UACvBqmC,EAASD,EAAOh0L,OAAOg0L,EAAO51O,QAAQ,KAAO,GAC7Cm2I,GAAa7+I,KAAKw+O,qBAAqBD,GAM7Cv1M,EAASrmC,KAL8B,CACrCiH,OAAQ20O,EAAO30O,OACfpG,KAAMulC,EAAKvlC,KACX+6G,OAAQsgC,IAEkB,CAC9B,QAhBA,CAmBJ,CAEAG,eAAey/F,GAEb,MAEMC,EAAuB1+O,KAAK2+O,uBAFnBF,EAAelgI,OACfkgI,EAAe70O,QAExBg1O,EAAiBC,KAAKH,GACtBI,EAAc,IAAIvjO,MAAMqjO,EAAeh1O,QAC7C,QAASwlC,GAAI,EAAGA,GAAIwvM,EAAeh1O,OAAQwlC,KACzC0vM,EAAY1vM,IAAKwvM,EAAelC,WAAWttM,IAE7C,MAAM2vM,GAAY,IAAIr9H,WAAWo9H,GAGjC,OAFa,IAAIl9H,KAAK,CAACm9H,IAAY,CAAEv7O,KAAMi7O,EAAej7O,MAG5D,CAEQg7O,qBAAqB5iO,GAE3B,IAAIo1H,EAAM,GACNguG,EAAO,GACPC,EAAM,EACNC,EAAM,EACV,UAAWllN,KAAKpe,EAAG,CACjB,MAAMlV,GAAQ1G,KAAKm+O,YAAYj+O,IAAI85B,GAC/BglN,EAAO,GACTA,GAAQ,EACRC,GAAOv4O,IAASs4O,IAEhBE,EAAM,EAAIF,EACVC,GAAOv4O,IAASw4O,EAChBluG,GAAOvnG,OAAOo0K,aAAaohC,GAC3BA,EAAMv4O,IAAU,GAAKw4O,EACrBF,EAAO,GAAKE,EAEhB,CACA,OAAItjO,EAAEhS,OAAS,GAAM,IACnBonI,GAAOvnG,OAAOo0K,aAAaohC,IAGtBx1M,SAA4BunG,CACrC,CAEQ2tG,uBAAuB3kN,EAAWpwB,GAExC,IAAKowB,EACH,OAGF,GAAwB,OAApBA,EAAE0iN,WAAW,GACf,OAAO1iN,EAGT,IAAIilN,EAAM,EACNC,EAAM,EACNF,EAAO,GACPhuG,EAAM,GACN32D,GAAI,EACJ3zE,GAAQszB,EAAE0iN,WAAWriK,IACzB,QAASjrC,GAAI,EAAGA,GAAIxlC,EAAQwlC,KACtB4vM,EAAO,GACTA,GAAQ,EACRC,EAAMhB,EAAUv3O,GAAOs4O,EAAM,GAC7BhuG,GAAOhxI,KAAKo+O,YAAYl+O,IAAI++O,KAE5BC,EAAM,EAAIF,EACVC,EAAMhB,EAAUv3O,GAAO,EAAGs4O,IAASE,EACnCx4O,GAAQszB,EAAE0iN,aAAariK,IACvB4kK,GAAOhB,EAAUv3O,GAAO,GAAKw4O,EAAKA,GAClCluG,GAAOhxI,KAAKo+O,YAAYl+O,IAAI++O,GAC5BD,EAAO,GAAKE,GAGhB,OAAOluG,CAET,EC5IK,IAAKmuG,EAAZ,SAAYA,GACVA,SAAA9yK,MAAA,QACA8yK,EAAAC,QAAA,UACAD,EAAA7yK,SAAA,WAHU6yK,CAIZ,CAJA,CAAYA,GAAU,ICAhB,MAAOvmN,EACX,WAAO64D,CAAK4tJ,EAAYC,EAAY31O,EAAI,GACtC,IAAK01O,IAAOC,EACV,MAAO,GAET,IAAKD,EACH,MAAO,0BAA4BC,EAAK,UAE1C,IAAKA,EACH,MAAO,yBAA2BD,EAAK,UAEzCA,EAAKA,EAAGlnL,WACRmnL,EAAKA,EAAGnnL,WACR,MAAMonL,EAAa3mN,EAAY4mN,WAAWH,EAAIC,EAAI,GAAI31O,GAChD81O,EAAQH,EAAGz7N,MACf07N,EAAWG,IAAI91O,OAAS21O,EAAWI,IAAI/1O,OAAS21O,EAAWK,IAAIh2O,QAE3Di2O,EAAWR,EAAGx7N,MAClB07N,EAAWG,IAAI91O,OAAS21O,EAAWO,IAAIl2O,OAAS21O,EAAWK,IAAIh2O,QAEjE,IAAIy/B,GAAS,GACb,OAAIk2M,EAAWO,IAAIl2O,OAAS,IAC1B21O,EAAWO,IAAM,yBAA2BP,EAAWO,IAAM,WAE3DP,EAAWI,IAAI/1O,OAAS,IAC1B21O,EAAWI,IAAM,0BAA4BJ,EAAWI,IAAM,WAEhEt2M,GAASk2M,EAAWG,IAAMH,EAAWO,IAAMP,EAAWI,IAAMJ,EAAWK,IACvEv2M,IACe,KAAbw2M,GAA6B,KAAVJ,EACf7mN,EAAY64D,KAAKouJ,EAAUJ,EAAO91O,GAClC,GACC0/B,EACT,CAEQ,2BAAO02M,CAAqBnkO,EAAGmkC,EAAG+kE,GAExC,IAAI11E,EAAI,EACJlU,GAAQ,EACZ,MAAM8kN,EAAOpkO,EAAEhS,OACT2pJ,GAAI,CAAE0sF,IAAKD,EAAMN,IAAK56H,EAAG86H,IAAK,IAEpC,KAAOxwM,EAAI4wM,GACTjgM,EAAE3Q,KAAOxzB,EAAEwzB,GACPlU,EACGq4H,GAAEqsF,KAAOhkO,EAAEwzB,IACVlU,GAAQ,EAAQq4H,GAAE0sF,IAAM7wM,EAAKmkH,GAAEqsF,IAAMhkO,EAAEwzB,IAC3ClU,IACGkU,EAAI4wM,KAET5wM,EAEJ,OAAOmkH,EACT,CAEQ,iBAAOisF,CAAWH,EAAIC,EAAIx6H,EAAGn7G,GACnC,MAAMu2O,EAAeb,EAAGz1O,QAAUy1O,EAAGz1O,OACrC,IAAKu2O,EAAQC,IAAWF,EAAe,CAACb,EAAIC,GAAM,CAACA,EAAID,GACnDgB,GAAK,EAET,KAAOD,GAAQC,MAAQF,EAAOE,KAAOA,GAAKD,GAAQx2O,UAC9Cy2O,GAEJF,EAASA,EAAO72O,MAAM,IAAIua,MAAMw8N,IAChCD,GAAUA,GAAQv8N,MAAMw8N,IAExB,MAAMC,GAAMH,EAAOv2O,OACnB,IAAImiD,GAAU,CACZk0L,IAAKG,GAAQx2O,OACb22O,IAAKD,GACLV,IAAK,GACLF,IAAK56H,EAAIw6H,EAAGz7N,MAAM,EAAGw8N,KAEnBh0N,GAAW,CAAEuzN,IAAK,IAEtB,GAAgB,KAAZQ,GACF,QAASI,GAAK,EAAGA,GAAKF,IAAOj0N,GAAIuzN,IAAIh2O,OAASD,EAAG62O,KAE/Cn0N,GAAMuM,EAAYmnN,qBAChBK,GACAxnN,EAAY6nN,YAAYN,EAAQK,IAChCz0L,GAAG2zL,KAELrzN,GAAIk0N,IACFC,GAAKF,GAAMj0N,GAAI4zN,IACX5zN,GAAI4zN,IAAMO,GACVn0N,GAAI4zN,IAAMK,GAAME,GAClBn0N,GAAIuzN,IAAIh2O,OAASmiD,GAAG6zL,IAAIh2O,SAC1BmiD,GAAK1/B,IAKX,OAAC0/B,GAAG+zL,IAAK/zL,GAAG4zL,KAAOO,EACf,CAACC,EAAOt8N,MAAM,EAAGkoC,GAAGw0L,KAAK12O,KAAK,IAAKu2O,GAAQv8N,MAAM,EAAGkoC,GAAGk0L,MACvD,CAACG,GAAQv8N,MAAM,EAAGkoC,GAAGk0L,KAAME,EAAOt8N,MAAM,EAAGkoC,GAAGw0L,KAAK12O,KAAK,MAC7B,IAAxBkiD,GAAG+zL,IAAIp3O,QAAQ,OACI,IAAxBqjD,GAAG4zL,IAAIj3O,QAAQ,MACJ,KAAXqjD,GAAG+zL,KACQ,KAAX/zL,GAAG4zL,KACQ,KAAX5zL,GAAG6zL,IACD7zL,GACAnzB,EAAY4mN,WAAWzzL,GAAG+zL,IAAK/zL,GAAG4zL,IAAK5zL,GAAG2zL,IAAK/1O,EACrD,CAEQ,kBAAO82O,CAAYnnE,EAAO/wE,GAChC,MAAM+3I,EAAMhnE,EAAM1vK,OACZ+zC,EAAM,IAAIpiC,MAAM+9J,EAAM1vK,QAC5B,GAAI2+F,EAAI+3I,GAAQ,EACd,OAAOhnE,EAAMz1J,QAEb,QAASurB,EAAI,EAAGA,EAAIkxM,EAAKlxM,IACvBuO,EAAIvO,GAAKkqI,GAAOlqI,GAAKkxM,EAAO/3I,EAAI+3I,IAASA,GAG7C,OAAO3iM,CACT,CAEA,oBAAO9kB,CAAcnyB,GACnB,OAAQ28K,MAAMloJ,OAAOz0B,GACvB,CAEA,oBAAOoyB,CAAcpyB,GACnB,OACEkyB,EAAYC,cAAcnyB,IAC1BA,EAAMq6F,WAAW,MACjBr6F,EAAMkD,OAAS,CAEnB,EC7HI,MAAO8nF,EACX,kBAAOC,CACL+uJ,EACAC,EACAC,EAAuB,IAEvB,MAAMhtM,EAAyB,CAC7B3Z,MAAO,GACP4mN,QAAS,GACThvJ,SAAU,IAGZ,IAAK6uJ,IAASC,EACZ,OAAO/sM,EAGT,MAAMktM,EAAiB,IAAIJ,GACrBK,EAAiB,IAAIJ,GAE3B,UAAWK,MAAYF,EAAW,CAChC,MAAM7hO,GAAQ8hO,EAAU/rM,UAAWp5B,IAAMA,GAAE1J,KAAO8uO,GAAS9uO,IAE3D,IAAc,IAAV+M,GAAc,CAChB20B,EAAMitM,QAAQv5O,KAAK,CACjByzC,OAAQ,CAAEv3C,KAAM27O,EAAWC,SAC3B14O,MAAOs6O,KAET,QACF,CAEA,MAAMC,GAASF,EAAUl7N,OAAO5G,GAAO,GAAG,GACpCiiO,GAAgBjpN,KAAKC,MAAMD,KAAKouB,UAAU26L,KAC1CG,GAAclpN,KAAKC,MAAMD,KAAKouB,UAAU46L,KAExCG,GAAc1vJ,EAAY2vJ,cAC9BH,GACAC,QACAn/O,EACA4+O,GAGEQ,GAAYx3O,QACdgqC,EAAMi+C,SAASvqF,KAAK,CAClByzC,OAAQ,CACNv3C,KAAM27O,EAAW7yK,SACjB80K,gBAEF16O,MAAOw6O,GACPI,SAAUN,GACVjvJ,SAAUkvJ,IAGhB,CAEArtM,SAAM3Z,MAAQ8mN,EAAUtgO,IAAK8gO,MAEzBxmM,OAAQ,CAAEv3C,KAAM27O,EAAW9yK,OAC3B3lE,MAAO66O,MAIJ3tM,CACT,CAEQ,oBAAOytM,CAAcL,EAAUC,EAAQO,EAAUZ,EAAa,IACpE,MAAMM,EAAgBjpN,KAAKC,MAAMD,KAAKouB,UAAU26L,IAC1CG,EAAclpN,KAAKC,MAAMD,KAAKouB,UAAU46L,IAExCx6O,GAAY,IAAIia,IAAI,IACrBla,OAAOC,KAAKu6O,MACZx6O,OAAOC,KAAKw6O,KAEjB,IAAIG,GAAc,GAClB36O,UAAK8T,QAAShU,KACZ,MAAMk7O,GAAYD,EAAU,GAAGA,KAAWj7O,KAAQA,IACZ,IAAlCq6O,EAAWl4O,QAAQ+4O,MAInBlmO,MAAMC,QAAQwlO,EAASz6O,OACzBy6O,EAASz6O,IAAOy6O,EAASz6O,IAAKsD,KAAK,UAEjC0R,MAAMC,QAAQylO,EAAO16O,OACvB06O,EAAO16O,IAAO06O,EAAO16O,IAAKsD,KAAK,UAIN,iBAAlBm3O,EAASz6O,KACO,iBAAhB06O,EAAO16O,KACI,OAAlBy6O,EAASz6O,KACO,OAAhB06O,EAAO16O,IAEP66O,GAAcA,GAAYzgO,OACxB3gB,KAAKqhP,cAAcL,EAASz6O,IAAM06O,EAAO16O,IAAMk7O,KAG7CT,EAASz6O,MAAS06O,EAAO16O,MAC3B66O,GAAY95O,KAAK,CACff,IAAKk7O,GACLH,SAAUJ,EAAc36O,IACxBwrF,SAAUovJ,EAAY56O,MAExBy6O,EAASz6O,IAAOqyB,EAAY64D,KAAKuvJ,EAASz6O,IAAM06O,EAAO16O,MAAI,GAK1D66O,EACT,EC/GI,MAAOM,EACX,aAAO3lO,CACL44E,EACAgtJ,EACA9hP,GAEA,MAAMmT,EAAK2hF,EAAIpsF,cAAco5O,GAE7B,UAAWp7O,KAAO1G,EAChBmT,EAAGzM,GAAO1G,EAAQ0G,GAGpB,OAAOyM,CACT,CAEA,aAAOvS,CAAO4wM,GACPA,EAAKlwI,YAGVkwI,EAAKlwI,WAAWslF,YAAY4qD,EAC9B,ECbI,SAAU/qJ,EACd0jE,EACAnjE,EACAw2J,IAaI,SAAUukC,EAAgB3kM,EAAaogK,GAC3C,MAAMh1M,EAAUC,SAASC,cAAc,KACvCF,EAAQy1J,aAAa,OAAQ7gH,GAC7B50C,EAAQy1J,aAAa,WAAYu/C,GACjCh1M,EAAQ8N,MAAMlI,QAAU,OACxB3F,SAASlF,KAAK6zF,YAAY5uF,GAE1BA,EAAQ6O,QAER5O,SAASlF,KAAKqjJ,YAAYp+I,EAC5B,CApBEu5O,CADY,QAAQ/6L,KAAYyP,mBAAmB0zD,KAC9BqzF,EACvB,CA0BM,SAAUvvC,EAAY+zE,GAC1B,IACE,OAAO5pN,KAAKC,MAAM2pN,MAAiBA,CACrC,OACE,OAAO,CACT,CACF,CC9CM,MAAOtlO,EACX,cAAOsyB,CAAQuW,EAAa7+C,GAC1B,MAAMu7O,EAAYv7O,EAAImyB,QAAQ,MAAO,KAAKA,QAAQ,MAAO,IAAIpvB,MAAM,KACnE,IAAI4tC,EAAUkO,EACd,KAAO08L,EAAUl4O,QAAQ,CACvB,GAAuB,iBAAZstC,EACT,OAEFA,EAAUA,EAAQ4qM,EAAUt4O,QAC9B,CAEA,OAAO0tC,CACT,CAEA,eAAO+mD,CAASpmE,GACd,OACEA,GACgB,iBAATA,IACNtc,MAAMC,QAAQqc,IACN,OAATA,KACEA,aAAgB52B,KAEtB,CAEA,gBAAO4+C,CACLjpC,EACA6M,EACAs+N,GAAkB,GAElB,MAAMvgB,EAASh7N,OAAO6H,OAAO,GAAIuI,GACjC,OAAI2F,EAAY0hF,SAASrnF,IAAW2F,EAAY0hF,SAASx6E,IACvDjd,OAAOC,KAAKgd,GACT/Z,OAAQnD,IAASw7O,QAAmC//O,IAAhByhB,EAAOld,IAC3CgU,QAAShU,IACJgW,EAAY0hF,SAASx6E,EAAOld,IACxBA,KAAOqQ,EAGX4qN,EAAOj7N,GAAOgW,EAAYsjC,UACxBjpC,EAAOrQ,GACPkd,EAAOld,GACPw7O,GALFv7O,OAAO6H,OAAOmzN,EAAQ,CAAEv9I,CAAC19E,GAAMkd,EAAOld,KASxCC,OAAO6H,OAAOmzN,EAAQ,CAAEv9I,CAAC19E,GAAMkd,EAAOld,IAAM,GAI7Ci7N,CACT,CAEA,eAAOruH,CAAS5qE,GACd,MAAM3xB,EAAS2E,MAAMC,QAAQ+sB,GAAO,GAAK,GACzC,UAAWy5M,KAAQz5M,EACjB,GAAIA,EAAI5tB,eAAeqnO,GAAO,CAC5B,MAAMt7O,EAAQ6hC,EAAIy5M,GAEhBprO,EAAOorO,GADLt7O,GAA0B,iBAAVA,EACH1G,KAAKmzG,SAASzsG,GAEdA,CAEnB,CAEF,OAAOkQ,CACT,CAEA,qCAAOy+D,CAA+BjwB,GACpC,MAAM68L,EAA0B,GAC1BC,EAAmB,GACnBC,EAAiB,GAEvB,UAAWlkO,KAAYmnC,EACrB,GAAIA,EAAIzqC,eAAesD,GAAW,CAChC,MAAMmkO,EAAoBnkO,EAASmxD,cAC9B6yK,EAAwBtnO,eAAeynO,GAK1CH,EAAwBG,GAAmB96O,KAAK,CAC9C28E,CAAChmE,GAAWmnC,EAAInnC,KALlBgkO,EAAwBG,GAAqB,CAC3C,CAAEn+J,CAAChmE,GAAWmnC,EAAInnC,KAQtBkkO,EAAe76O,KAAK,CAClBf,IAAK0X,EACL4D,MAAO5D,EAASya,QAAQ,UAAW,IAAI9uB,QAE3C,CAEF,UAAWy4O,KAAuBJ,EAChC,GAAIA,EAAwBtnO,eAAe0nO,IACrCJ,EAAwBtnO,eAAe0nO,GAAsB,CAC/D,MAAMC,EACJL,EAAwBI,GAC1B,GAAyC,IAArCC,EAA0B14O,OAAc,CAE1C,MAAM24O,GAAoBD,EAA0B,GACpDJ,EAAiBG,GACfE,GAAkB/7O,OAAOC,KAAK87O,IAAmB,GACrD,SAAWD,EAA0B14O,OAAS,EAAG,CAE/C,MAAM44O,GAA0BL,EAC7Bz4O,OACEy8B,IAAMA,GAAE5/B,IAAI4xB,gBAAkBkqN,EAAoBlqN,eAEpDjY,OAAO,CAACixM,GAAMj6K,KACNi6K,GAAKp4H,EAAI7hD,GAAQ6hD,EAAIo4H,GAAOj6K,IAEvCgrM,EAAiBM,GAAwBj8O,IAAI6oE,eAC3ChqB,EAAIo9L,GAAwBj8O,IAChC,CACF,CAGJ,UAAW0X,KAAYmnC,EACjBA,EAAIzqC,eAAesD,WACdmnC,EAAInnC,GAIf,UAAWA,KAAYikO,EACjBA,EAAiBvnO,eAAesD,KAClCmnC,EAAInnC,GAAYikO,EAAiBjkO,GAGvC,CAEA,sBAAOqzD,CAAgBlsB,GACrB,MAAMo8K,EAAS,GACf,OAAIjlN,EAAY0hF,SAAS74C,IACvB5+C,OAAOC,KAAK2+C,GACT17C,OAAQnD,QAAqBvE,IAAbojD,EAAI7+C,IACpBgU,QAAShU,IAENi7N,EAAOj7N,GADLgW,EAAY0hF,SAAS74C,EAAI7+C,KAASgV,MAAMC,QAAQ4pC,EAAI7+C,IACxCgW,EAAY+0D,gBAAgBlsB,EAAI7+C,IAEhC6+C,EAAI7+C,EAAG,GAIpBi7N,GAGLjmN,MAAMC,QAAQ4pC,GACTA,EAAI3kC,IAAK8yI,GAAMh3I,EAAY+0D,gBAAgBiiF,IAG7CnuG,CACT,CAEA,iBAAOoG,CAAWpG,GAChB,MAAMo8K,EAAS,GACf,OAAIjlN,EAAY0hF,SAAS74C,IACvB5+C,OAAOC,KAAK2+C,GACT17C,OAAQnD,GAAqB,OAAb6+C,EAAI7+C,IACpBgU,QAAShU,IAENi7N,EAAOj7N,GADLgW,EAAY0hF,SAAS74C,EAAI7+C,KAASgV,MAAMC,QAAQ4pC,EAAI7+C,IACxCgW,EAAYivC,WAAWpG,EAAI7+C,IAE3B6+C,EAAI7+C,EAAG,GAIpBi7N,GAGLjmN,MAAMC,QAAQ4pC,GACTA,EAAI3kC,IAAK8yI,GAAMh3I,EAAYivC,WAAW+nG,IAGxCnuG,CACT,CAEA,qBAAOhhC,CAAek+B,EAAGC,EAAGj+B,EAAY,MAAOC,GAQ7C,GAPkB,SAAdD,IACFi+B,EAAI,CAACD,EAAIA,EAAIC,GAAI,IAOX,OAAND,GACM,KAANA,QACMtgD,IAANsgD,GACM,OAANC,GACM,KAANA,QACMvgD,IAANugD,EACA,CACA,MAAMkgM,GACJngM,IAAMC,EACF,OACMvgD,IAANsgD,EACE,OACMtgD,IAANugD,GACE,EACM,OAAND,EACE,EACM,OAANC,GACE,EACM,KAAND,EACE,GACA,EAChB,MAAkB,SAAdh+B,GACoB,IAAfC,EAAuBk+N,IAAwB,EAAZA,IAEtB,IAAfl+N,GAAkC,EAAZk+N,GAAiBA,EAChD,CAEA,MAAMC,EAAK,GACLC,EAAK,GAYX,IAVApgM,EAAI,GAAKA,GADTD,EAAI,GAAKA,GAGP5pB,QAAQ,eAAgB,CAAC0pC,GAAGwgL,GAAIC,MAChCH,EAAGp7O,KAAK,CAACs7O,IAAMr+H,IAAUs+H,IAAM,IAAG,GAGpCtgM,EAAE7pB,QAAQ,eAAgB,CAAC0pC,GAAGwgL,GAAIC,MAChCF,EAAGr7O,KAAK,CAACs7O,IAAMr+H,IAAUs+H,IAAM,IAAG,GAG7BH,EAAG94O,QAAU+4O,EAAG/4O,QAAQ,CAC7B,MAAMk5O,GAAKJ,EAAGl5O,QACRu5O,GAAKJ,EAAGn5O,QACRw5O,GAAKF,GAAG,GAAKC,GAAG,IAAMD,GAAG,GAAG3wC,cAAc4wC,GAAG,IACnD,GAAIC,GACF,OAAOA,EAEX,CAEA,OAAON,EAAG94O,OAAS+4O,EAAG/4O,MACxB,CAUA,2BAAO4S,CAAqBkkO,EAAcC,GACxC,GAAID,IAASC,EACX,OAAO,EAGT,MAAMsC,EAAYz8O,OAAO08O,oBAAoBxC,GACvCyC,EAAY38O,OAAO08O,oBAAoBvC,GAC7C,GAAIsC,EAAUr5O,SAAWu5O,EAAUv5O,OACjC,OAAO,EAGT,UAAWo4O,KAAQiB,EACjB,GAAIvC,EAAKsB,KAAUrB,EAAKqB,GACtB,OAAO,EAIX,OAAO,CACT,CAQA,iBAAOnoB,CAAWz0K,EAAa3+C,GAQ7B,OAPeD,OAAOC,KAAK2+C,GACxB17C,OAAQnD,GAAQE,EAAKiC,QAAQnC,GAAO,GACpC2Z,OAAO,CAACkjO,EAAM78O,KACb68O,EAAK78O,GAAO6+C,EAAI7+C,GACT68O,GACN,GAGP,CAEA,cAAOzyL,CAAQvL,GACb,OAAmC,IAA5B5+C,OAAOC,KAAK2+C,GAAKx7C,MAC1B,EC3RI,MAAOqyF,GACX,sBAAOC,CAAgBqiH,EAAah1E,EAAkB,GACpD,MAAM85G,EAAcn3N,KAAKq7B,IAAI,GAAIgiF,GACjC,OAAOr9G,KAAKiwE,MAAMoiH,EAAM8kC,GAAeA,CACzC,ECHI,SAAUv0F,EAA0ByE,GACxC,OAAOA,EAAErzI,OAAO,CAACy9B,EAAKp3C,KACpBo3C,EAAIp3C,GAAOA,EACJo3C,GACNn3C,OAAOuV,OAAO,MACnB,CCJA,MAAMunO,EAAuB,2CACvBC,EAAU,eAEV,SAAUC,EACd7uJ,EACA8uJ,EACApgL,EAAeigL,GAEf,MAAM/6M,EAAM,GAAG86B,KAAQogL,QACjBC,EAAO/uJ,EAAI3zB,qBAAqB,QAAQ,GAE9C,IAAI2iL,EAAYhvJ,EAAIu7B,eAAeqzH,GACnCI,EAAaA,EAAUn7O,KAAO+/B,EAGhC,SAASq7M,EAAejvJ,EAAepsD,EAAa4Q,GAClD,MAAM9wC,EAAUq5O,EAAS3lO,OAAO44E,EAAK,OAAQ,CAC3CziF,GAAIqxO,EACJM,IAAK,aACLr7O,KAAM+/B,IAER4Q,EAAO89C,YAAY5uF,EACrB,CAVuCu7O,CAAejvJ,EAAKpsD,EAAKm7M,EAChE,CCfM,SAAUI,IAEd,OAA+B,OAArB,EAAI53N,KAAKi1D,UAAuB,GAAGhpB,SAAS,IAAIu0F,UAAU,EACtE,CAEM,SAAU/pI,IAEd,MADW,GAAGmhO,MAAOA,OAAQA,OAAQA,OAAQA,OAAQA,MAAOA,MAAOA,MACzD3rN,aACZ,2BCLYy9D,EAAZ,SAAYA,GACVA,WAAA5zE,MAAA,WACA4zE,IAAAC,KAAA,UACAD,IAAA+0B,QAAA,aACA/0B,IAAAgsC,QAAA,aAJUhsC,CAKZ,CALA,CAAYA,GAAa,IAOnB,MAAgBs0B,EACbvwD,QAAU,IAAI3e,IACXy0E,SAEV,UAAI95B,GACF,OAAO31F,KAAK+jP,OACd,CACA,UAAIpuJ,CAAOjvF,GACT1G,KAAK+jP,QAAUr9O,EACf1G,KAAK25D,QAAQh3D,KAAK+D,EACpB,CACQq9O,QAMRlhP,UAAUu2C,EAAoBzyC,GAC5B3G,KAAKqqH,QAELrqH,KAAKyvH,SAAWzvH,KAAK25D,QAClB51D,QAAKmtF,QACLruF,UAAW8yF,IACV31F,KAAK8vH,mBAAmBn6B,GACxBv8C,EAASh+B,KAAKzU,EAAO3G,KAAI,EAE/B,CAEAmO,cACEnO,KAAKyqH,eACiBzoH,IAAlBhC,KAAKyvH,WACPzvH,KAAKyvH,SAASthH,cACdnO,KAAKyvH,cAAWztH,GAElBhC,KAAK21F,OAASC,EAAcgsC,OAC9B,CAEU9R,mBAAmBn6B,GAAwB,iOClBrDv0F,MAAA,cAKEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAA3H,iBAAgB,GAEzBvC,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,kEAEFA,MAAA,SACEA,MAAA,QACAA,MAAA,YAA2BA,MAAA,GAC7BA,kCAD6BA,MAAA,GAAAA,MAAAkK,GAAAlH,iCAI/BhD,MAAA,YACEA,MAAA,oBACFA,gBADeA,cAAA,gBCJR,IAAM4iP,EAAmB,MAA1B,MAAOA,GAiBF33L,KACC1qD,gBAjBV,kBACIsiP,GACF,OAAOjkP,KAAKkkP,eACd,CACA,kBAAID,CAAev9O,IACjB1G,KAAKkkP,gBAAkBx9O,EACzB,CACQw9O,iBAAkB,EAEnB9/O,MAAQ,GACR+7B,KACAiqF,SAAU,EAEPrnH,MAA+B,IAAIuK,MAE7CvN,YACSssD,GACC1qD,GACRwiP,IAFOnkP,KAAAqsD,QACCrsD,KAAA2B,mBAGR3B,KAAKmgC,KAAOgkN,GAAGljN,MAAM,CACnBj+B,SAAU,CAAC,GAAI+hC,KAAW/C,UAC1B/+B,SAAU,CAAC,GAAI8hC,KAAW/C,WAE9B,CAEAoiN,UAAUzoO,IACR,OAAA3b,KAAKoqH,SAAU,EACfpqH,KAAKqsD,KAAKtpD,MAAM4Y,GAAO3Y,SAAU2Y,GAAO1Y,UAAUJ,UAChD,KACE7C,KAAK+C,MAAMqL,MAAK,GAChBpO,KAAKoqH,SAAU,GAEhBhmH,KACC,IACEpE,KAAK2B,gBAAgB4pB,UAClBrrB,IAAI,kBAAoBkE,GAAMA,MAAMoU,SACpC3V,UAAWwhP,IAAcrkP,KAAKoE,MAAQigP,GAC3C,OACErkP,KAAKoE,MAAQA,GAAMA,MAAMoU,OAC3B,CACAxY,KAAKoqH,SAAU,KAGZ,CACT,CAEAzmH,iBACE3D,KAAKqsD,KAAK1oD,iBAAiBd,UAAU,KACnC7C,KAAK+C,MAAMqL,MAAK,EAAI,EAExB,8CApDW41O,IAAmB5iP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAA,+BAAnBm+O,GAAmB11O,UAAA,sBAAAC,OAAA,CAAA01O,eAAA,kBAAAz1O,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,khBAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KDzChC1N,MAAA,YAAqCA,MAAA,6BAAY2N,GAAAq1O,UAAAr1O,GAAAoxB,KAAAz5B,MAAqB,GAGhEtF,MAFJ,QAEIA,CAFC,qBAEDA,CADiC,eACtBA,MAAA,wBAAiCA,QAC5CA,MAAA,kCAOJA,UAIIA,MAFJ,QAEIA,CAFC,qBAEDA,CADiC,gBACtBA,MAAA,0BAAqCA,QAChDA,MAAA,oCAQJA,UAEAA,MAAA,eACEA,MAAA,0BACFA,QAUAA,MATA,GAAAkjP,EAAA,eASAljP,CAHC,GAAAmjP,EAAA,aAOHnjP,QAEAA,MAAA,GAAAojP,EAAA,qBA5CMpjP,MAAA,YAAA2N,GAAAoxB,MAGW/+B,MAAA,GAAAA,YAAA,sBAITA,MAAA,GAAAA,MAAA,cAAAA,MAAA,uBAQSA,MAAA,GAAAA,YAAA,4BAKTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,4BAOJA,MAAA,GAAAA,MAAA,IAAAA,MAAA,6BAGCA,MAAA,GAAAA,MAAA,OAAA2N,GAAAk1O,gBAQG7iP,cAAA,OAAA2N,GAAA3K,OAMFhD,cAAA,OAAA2N,GAAAq7G,yBCbF3tF,KAAW52B,yBACX03B,KAAmB13B,UACnBokB,KAAkBnkB,UAClB+2B,KAAc92B,KACdwJ,KAAevJ,KACf6vC,KACA1mC,KACAQ,KAAiBgF,MAAA9E,OAAA,0SAGRm0O,EAAmB,uHCGzB,IAAMS,EAAsB,MAA7B,MAAOA,GASDt+O,YACAlG,OACAusH,OACAk4H,YAEAC,gBAbF9kP,QACS+kP,aAAe,IAAI5pM,IAC1Bj4C,MAA+B,IAAIuK,MACrCu3O,iBAER5gD,QAAmBn9J,KAEnB/mC,YACUoG,GACAlG,GACAusH,GACAk4H,GAEAC,IALA3kP,KAAAmG,eACAnG,KAAAC,UACAD,KAAAwsH,UACAxsH,KAAA0kP,eAEA1kP,KAAA2kP,mBAER3kP,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,kBAErCJ,KAAK0kP,YAAYpqO,SAAW,IAAIwqO,IAAwB,CACtDz4L,KAAMrsD,KAAKH,QACXklP,MAAO,CACLC,cAAe,oBAInBhlP,KAAK6kP,iBAAmB,IAAII,KAC1BjlP,KAAK0kP,YAAYpqO,SACjBta,KAAK0kP,aAGH1kP,KAAKH,SAASqlP,SAChBllP,KAAK6kP,iBAAiBM,YACnBphP,QACC2F,KACGisF,IAA8BA,KAAWyvJ,MAAkBxnO,OAAI,EAElEqhF,KAAUj/F,KAAK4kP,eAEhB/hP,UAAU,KACT7C,KAAKqlP,cAAY,GAGrBniL,QAAQC,KAAK,qDAEjB,CAEOmiL,iBACLtlP,KAAK0kP,YACFa,WAAW,IAAKvlP,KAAKwlP,UAAUC,cAC/B5iP,UAAWmvF,KACVhyF,KAAK0kP,YAAYpqO,SAASorO,iBAAiB1zJ,GAAS5jB,SACpDpuE,KAAKqlP,cAAY,EAEvB,CAEQA,eAAY,IAAA5wJ,GAAAz0F,KAClBA,KAAK0kP,YAAYpqO,SACdqrO,mBAAmB3lP,KAAKwlP,UAAUC,aAClChoH,KAAMzrC,KAGLhyF,KAAKmG,YACF5C,eAHiByuF,GAAS4zJ,YAGE,YAAa,CAAEC,QAF9B7zJ,GAAS8zJ,UAGtBjjP,UAAU,KACT7C,KAAKwsH,OAAOQ,OACZhtH,KAAK+C,MAAMqL,MAAK,EAAI,EACrB,GAEJi4I,MAAK,eAAA5wD,MAAAC,KAAC,UAAOtxF,IACZ,GAAIA,cAAiB2hP,KAEnB,OAAOtxJ,GAAKiwJ,YAAYsB,kBACtBvxJ,GAAK+wJ,UAAUC,aAGnBviL,QAAQK,IAAIn/D,GACd,GAAC,gBAAA6xF,IAAA,OAAAR,GAAAS,MAAAl2F,KAAAm2F,UAAA,EARK,IASLkwD,MAAOjiJ,KACN8+D,QAAQK,IAAI,qBAAoB,EAEtC,CAEQiiL,UACN,OAAOxlP,KAAK2kP,gBAAgBj7O,OAAQm9H,IAAuB,QAAdA,GAAKrjI,MAAgB,EACpE,8CApFWihP,IAAsBrjP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,mBAAAyE,MAAAzE,MAavB6kP,MAAiB,+BAbhBxB,GAAsBn2O,UAAA,yBAAAE,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,2EAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KC5CnC1N,MAAA,cAGEA,MAAA,0BAAS2N,GAAAu2O,gBAAgB,GAEzBlkP,MAAA,gBACAA,MAAA,wBACFA,gBAFYA,cAAA,OAAA2N,GAAAk1L,SACV7iM,cAAA,IAAAA,MAAA,sDDoCUmO,KAAezJ,KAAE6J,KAAiB5J,KAAE6J,MAAgBC,OAAA,kOAAAC,gBAAA,WAEnD20O,EAAsB,0CEpB5B,IAAMyB,EAAc,MAArB,MAAOA,GAMqB5rO,SACtB9S,SANF2+O,aACAC,OACAp3N,KAAO,sBACP4nC,QAAU,eAClB72D,YACgCua,GACtB9S,IADsBxH,KAAAsa,YACtBta,KAAAwH,YAER,MAAMgmK,GAAOxtK,KAAKwH,SAAS67D,MAAK,GAAM/5D,MAAM,KAAK0xB,MAC7CwyI,KACFxtK,KAAKmmP,aAAe,IAAI34E,MAE1BxtK,KAAKsa,SAAS+rO,yBAAyBC,MAAWC,QAASvmP,KAAK42D,QAClE,CAEA4vL,aACE,SAAO9mO,KAAK1f,KAAKsa,SAASksO,aAC5B,CAEAR,kBAAkB7lM,IAChB,SAAOzgC,KAAK1f,KAAKsa,SAAS0rO,kBAAkB7lM,IAC9C,CACAsmM,qBAAqBtmM,IACnB,SAAOzgC,KAAK1f,KAAKsa,SAASmsO,qBAAqBtmM,IACjD,CACAwlM,mBACEe,IAEA,SAAOhnO,KAAK1f,KAAKsa,SAASqrO,mBAAmBe,IAC/C,CACAC,yBAAyBn5E,IACvB,SAAO9tJ,KAAK1f,KAAKsa,SAASssO,sBAAsBp5E,IAAQxtK,KAAKmmP,cAC/D,CACAZ,WAAWplM,IACT,SAAOzgC,KAAK1f,KAAKsa,SAASirO,WAAWplM,IACvC,CACA0mM,cAAc1mM,IACZ,SAAOzgC,KAAK1f,KAAKsa,SAASusO,cAAc1mM,IAC1C,CACA77C,OAAOwiP,IACL,SAAOpnO,KAAK1f,KAAKsa,SAAShW,OAAOwiP,IACnC,CACAC,eAAeD,IACb,SAAOpnO,KAAK1f,KAAKsa,SAASysO,eAAeD,IAC3C,CACAE,YAAYF,IACV,SAAOpnO,KAAK1f,KAAKsa,SAAS0sO,YAAYF,IACxC,CACAG,UAAU9mM,IACR,SAAOzgC,KAAK1f,KAAKsa,SAAS2sO,UAAU9mM,IACtC,CAKA+mM,YACE,OAAKlnP,KAAKomP,SACRpmP,KAAKomP,OAASpmP,KAAKsa,SAAS4sO,YAAYl/O,MAAMhI,KAAKgvB,KAAMhvB,KAAK42D,UAEzD52D,KAAKomP,MACd,CAEAe,UAAUf,IACRpmP,KAAKomP,OAASA,GAAOp+O,MAAMhI,KAAKgvB,KAAMhvB,KAAK42D,SAC3C52D,KAAKsa,SAAS6sO,UAAUf,GAC1B,8CAlEWF,IAAc9kP,MAMfgmP,MAAahmP,MAAAuE,MAAA,iCANZugP,GAAc7kP,QAAd6kP,GAAc5kP,mBAAd4kP,EAAc,KCNdmB,EAAuB,MAA9B,MAAOA,GAOsBC,aACvBnhP,YAPFohP,aACDC,aACCC,YACDtC,YAEPplP,YACiCunP,GACvBnhP,IADuBnG,KAAAsnP,gBACvBtnP,KAAAmG,eAERnG,KAAKunP,aAAe,IAAIvsM,IACxBh7C,KAAKwnP,aAAexnP,KAAKunP,aAAa3kL,eAGtC5iE,KAAKynP,YAAc,IAAI1lP,IACrBqjP,MAAkBsC,SAEpB1nP,KAAKmlP,YAAcnlP,KAAKynP,YAAY7kL,eAEpC5iE,KAAKsnP,aAAaK,iBAAkBnvO,KAClCxY,KAAKunP,aAAa5kP,KAAK6V,IACvB,MAAMm9E,GAASiyJ,IAAkBC,8BAA8BrvO,IAChD,OAAXm9E,KACF31F,KAAKmG,YACF+gP,YACAY,QACC,sBAAsBtvO,GAAQ88L,8CAA8C3/G,MAEhF31F,KAAKynP,YAAY9kP,KAAKgzF,IAAM,EAGlC,8CA/BW0xJ,IAAuBjmP,MAOxBgmP,MAAahmP,MAAAuE,GAAA,iCAPZ0hP,GAAuBhmP,QAAvBgmP,GAAuB/lP,mBAAvB+lP,EAAuB,KCyBvBU,EAAyB,MAAhC,MAAOA,GASD5hP,YACAlG,OACAusH,OACAk4H,YAEAC,gBAbF9kP,QACS+kP,aAAe,IAAI5pM,IAC1Bj4C,MAA+B,IAAIuK,MACrCu3O,iBAER5gD,QAAmBn9J,KAEnB/mC,YACUoG,GACAlG,GACAusH,GACAk4H,GAEAC,IALA3kP,KAAAmG,eACAnG,KAAAC,UACAD,KAAAwsH,UACAxsH,KAAA0kP,eAEA1kP,KAAA2kP,mBAER3kP,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,sBAAwB,GAE7DJ,KAAK0kP,YAAYpqO,SAAW,IAAIwqO,IAAwB,CACtDz4L,KAAMrsD,KAAKH,QAAQmoP,mBACnBjD,MAAO,CACLC,cAAe,oBAInBhlP,KAAK6kP,iBAAmB,IAAIwC,EAC1BrnP,KAAK0kP,YAAYpqO,SACjBta,KAAK0kP,aAGH1kP,KAAKH,QAAQmoP,mBAAmB9C,SAClCllP,KAAK6kP,iBAAiBM,YACnBphP,QACC2F,KACGisF,IAA8BA,KAAWyvJ,MAAkBxnO,OAAI,EAElEqhF,KAAUj/F,KAAK4kP,eAEhB/hP,UAAU,KACT7C,KAAKqlP,cAAY,GAGrBniL,QAAQC,KAAK,qDAEjB,CAEO8kL,oBACLjoP,KAAK0kP,YACFa,WAAW,IAAKvlP,KAAKwlP,UAAUC,cAC/B5iP,UAAWmvF,KACVhyF,KAAK0kP,YAAYpqO,SAASorO,iBAAiB1zJ,GAAS5jB,SACpDpuE,KAAKqlP,cAAY,EAEvB,CAEQA,eAAY,IAAA5wJ,GAAAz0F,KAClBA,KAAK0kP,YAAYpqO,SACdqrO,mBAAmB3lP,KAAKwlP,UAAUC,aAClChoH,KAAMzrC,KAELhyF,KAAKmG,YAAY5C,eADHyuF,GAAS8zJ,QACgB,gBAAgBjjP,UAAU,KAC/D7C,KAAKwsH,OAAOQ,OACZhtH,KAAK+C,MAAMqL,MAAK,EAAI,EACrB,GAEFi4I,MAAK,eAAA5wD,MAAAC,KAAC,UAAOtxF,IACZ,GAAIA,cAAiB2hP,KAEnB,OAAOtxJ,GAAKiwJ,YAAYsB,kBACtBvxJ,GAAK+wJ,UAAUC,YAGrB,GAAC,gBAAAxvJ,IAAA,OAAAR,GAAAS,MAAAl2F,KAAAm2F,UAAA,EAPK,IAQLkwD,MAAOjiJ,KACN8+D,QAAQK,IAAI,qBAAoB,EAEtC,CAEQiiL,UACN,OAAOxlP,KAAK2kP,gBAAgBj7O,OAAQm9H,IAAuB,QAAdA,GAAKrjI,MAAgB,EACpE,8CAhFWukP,IAAyB3mP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,mBAAAyE,GAAAzE,MAa1B6kP,MAAiB,+BAbhB8B,GAAyBz5O,UAAA,4BAAAE,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,MAFzB,CAAC8kP,IAAe9kP,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,2EAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCzC7B1N,MAAA,cAGEA,MAAA,0BAAS2N,GAAAk5O,mBAAmB,GAE5B7mP,MAAA,gBACAA,MAAA,wBACFA,gBAFYA,cAAA,OAAA2N,GAAAk1L,SACV7iM,cAAA,IAAAA,MAAA,yDDkCUmO,KAAezJ,KAAE6J,KAAiB5J,KAAE6J,MAAgBC,OAAA,kOAAAC,gBAAA,WAGnDi4O,EAAyB,oBEvB/B,IAAMG,GAAqB,MAA5B,MAAOA,GAMD/hP,YACAlG,OACAusH,OAPF3sH,QAEEkD,MAA+B,IAAIuK,MAE7CvN,YACUoG,GACAlG,GACAusH,IAFAxsH,KAAAmG,eACAnG,KAAAC,UACAD,KAAAwsH,UAERxsH,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,iBAEjCJ,KAAKH,SAASsoP,MAChBnoP,KAAKooP,kBAELllL,QAAQC,KAAK,iDAEjB,CAEQklL,kBACL9gP,OAAe+gP,GAAGC,MAAM1lP,UAAU,oBAAsBw1D,KACvDr4D,KAAKwoP,qBAAqBnwL,GAAG,EAEjC,CAEQmwL,qBAAqBx2J,IACH,cAApBA,GAAS2D,QAEX31F,KAAKyoP,cADez2J,GAAS02J,aAAa9C,YAG9C,CAEQ6C,cAAcnoP,IACpBN,KAAKmG,YAAY5C,eAAejD,GAAO,YAAYuC,UAAU,KAC3D7C,KAAKwsH,OAAOQ,OACZhtH,KAAK+C,MAAMqL,MAAK,EAAI,EAExB,CAEQg6O,kBACN,GAAI9/O,SAAS4nH,eAAe,kBAC1B,OAGF,MAGMy4H,GAAMrgP,SAAS04D,qBAAqB,UAAU,GAC9C4nL,GAAKtgP,SAASC,cAAc,UAClCqgP,GAAG12O,GAAK,iBACR02O,GAAGrgN,IAAM,wEAAmBvoC,KAAKH,SAASsoP,QAC1CS,GAAG3gM,OAAS,KACVjoD,KAAKqoP,iBAAe,EAEtBM,GAAIxnL,WAAWjzB,aAAa06M,GAAID,GAClC,8CAvDWT,IAAqB9mP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,aAAA,+BAArB8mP,GAAqB55O,UAAA,wBAAAE,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,wNAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,ICpBlC1N,MAAA,6IDoBa8mP,EAAqB,KECrBW,GAAmB,MAA1B,MAAOA,GAMD1iP,YACAlG,OACA0B,gBACA6qH,OARF3sH,QAEEkD,MAA+B,IAAIuK,MAE7CvN,YACUoG,GACAlG,GACA0B,GACA6qH,IAHAxsH,KAAAmG,eACAnG,KAAAC,UACAD,KAAA2B,mBACA3B,KAAAwsH,UAERxsH,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,eAEjCJ,KAAKH,SAASipP,QAAU9oP,KAAKH,SAASqlP,UACxCllP,KAAK+oP,gBACL/oP,KAAKgpP,gBAEL9lL,QAAQC,KACN,gEAGN,CAEO8lL,oBACJ1hP,OAAe2hP,KAAKC,MAAMC,kBAAkBC,QAC/C,CAEOC,qBACJ/hP,OAAe2hP,KAAKC,MAAMC,kBAAkBG,SAC/C,CAEQC,mBACLjiP,OAAe2hP,KAAKhkO,KAAK,eAAgB,IAAMllB,KAAKypP,aACvD,CAEQA,aACLliP,OAAe2hP,KAAKQ,OAClB/1M,KAAK,CACJm1M,OAAQ9oP,KAAKH,SAASipP,OACtB5D,SAAUllP,KAAKH,SAASqlP,SACxByE,cAAe,CACb,4DAEFhjP,MAAO,YAER82H,KAAK,KACJz9H,KAAKspP,qBACLtpP,KAAK4pP,mBACJriP,OAAe2hP,KAAKC,MAClBC,kBACAS,WAAWC,OAAQzxL,KAClBr4D,KAAK+pP,mBAAmB1xL,GAAG,EAC5B,EAET,CAEQ0xL,mBAAmBF,IACzB7pP,KAAK4pP,mBACDC,IACF7pP,KAAKgqP,YAAaziP,OAAe2hP,KAAKQ,OAAOllP,WAAWylP,aAE5D,CAEQL,mBACN,MAAMM,GAAM5hP,SAAS2N,cAAc,2BAC/Bi0O,IAA8C,OAAvClqP,KAAK2B,gBAAgBgjE,gBACR,wBAAlBulL,GAAI5zO,UACN4zO,GAAI5zO,UAAYtW,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,yBAEyB,0BAAlBq9M,GAAI5zO,YACb4zO,GAAI5zO,UAAYtW,KAAK2B,gBAAgB4pB,UAAUshB,QAC7C,2BAIR,CAEQm9M,YAAY1pP,IAClBN,KAAKmG,YAAY5C,eAAejD,GAAO,UAAUuC,UAAU,KACzD7C,KAAKwsH,OAAOQ,OACZhtH,KAAK+C,MAAMqL,MAAK,EAAI,EAExB,CAEQ26O,gBACN,MAAMJ,GAAMrgP,SAAS04D,qBAAqB,UAAU,GAC9C4nL,GAAKtgP,SAASC,cAAc,UAClCqgP,GAAG12O,GAAK,eACR02O,GAAGrgN,IAAM,oCACTqgN,GAAG3gM,OAAS,KACVjoD,KAAKwpP,kBAAgB,EAEvBb,GAAIxnL,WAAWjzB,aAAa06M,GAAID,GAClC,CAEQK,eACN,MAAML,GAAMrgP,SAAS04D,qBAAqB,UAAU,GAC9C4nL,GAAKtgP,SAASC,cAAc,UAClCqgP,GAAG12O,GAAK,kBACR02O,GAAGrgN,IAAM,yCACTogN,GAAIxnL,WAAWjzB,aAAa06M,GAAID,GAClC,8CAtGWE,IAAmBznP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,aAAA,+BAAnBynP,GAAmBv6O,UAAA,sBAAAE,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,sGAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,ICrBhC1N,MAAA,4LDqBaynP,EAAmB,8BEpB9BznP,MAAA,wDAQEA,MAAA,uBAEEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,MAAA,UAAAA,MAASkK,GAAA6+O,UAAS,GAEpB/oP,sDAEAA,MAAA,0BAEEA,MAAA,mBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,MAAA,UAAAA,MAASkK,GAAA6+O,UAAS,GAEpB/oP,sDAEAA,MAAA,6BAEEA,MAAA,mBAAAA,MAAAkP,IAAA,MAAAhF,GAAAlK,MAAA,UAAAA,MAASkK,GAAA6+O,UAAS,GAEpB/oP,sDAEAA,MAAA,yBAEEA,MAAA,mBAAAA,MAAAmrD,IAAA,MAAAjhD,GAAAlK,MAAA,UAAAA,MAASkK,GAAA6+O,UAAS,GAEpB/oP,sDAEAA,MAAA,uBAGEA,MAAA,mBAAAA,MAAA2P,IAAA,MAAAzF,GAAAlK,MAAA,UAAAA,MAASkK,GAAA6+O,UAAS,GAEpB/oP,mCAHEA,MAAA,iBAAAkK,GAAAzL,QAAAokP,8CA5BF7iP,MADF,UACEA,CADmE,QAC/DA,MAAA,wBAAuCA,QA0B3CA,MAxBA,EAAAgpP,GAAA,wBAwBAhpP,CArBC,EAAAipP,GAAA,2BAqBDjpP,CAfC,EAAAkpP,GAAA,8BAeDlpP,CATC,EAAAmpP,GAAA,0BASDnpP,CAHC,EAAAopP,GAAA,yBASHppP,iCAhCMA,MAAA,GAAAA,YAAA,4BAGDA,MAAA,GAAAA,MAAA,OAAAkK,GAAAzL,QAAA4qP,SAAA,IAAAn/O,GAAAzL,QAAA4qP,OAAA95M,SAMAvvC,cAAA,OAAAkK,GAAAzL,QAAA6qP,YAAA,IAAAp/O,GAAAzL,QAAA6qP,UAAA/5M,SAMAvvC,cAAA,OAAAkK,GAAAzL,QAAA8qP,eAAA,IAAAr/O,GAAAzL,QAAA8qP,aAAAh6M,SAMAvvC,cAAA,OAAAkK,GAAAzL,QAAA+qP,WAAA,IAAAt/O,GAAAzL,QAAA+qP,SAAAj6M,SAMAvvC,cAAA,QAAAkK,GAAAzL,QAAAgrP,SAAA,IAAAv/O,GAAAzL,QAAAgrP,OAAAl6M,uDAWHvvC,MAJF,UAIEA,CADD,OACIA,MAAA,wBAA0CA,QAC7CA,MAAA,cAAwCA,MAAA,mBAAAA,MAAA8P,IAAA,MAAA5F,GAAAlK,MAAA,UAAAA,MAASkK,GAAAhH,SAAQ,GACvDlD,MAAA,wBAEJA,qCAJKA,MAAA,GAAAA,YAAA,uBAAAkK,GAAA9I,OAEDpB,MAAA,GAAAA,MAAA,IAAAA,MAAA,2EAMFA,MAAA,cAIEA,MAAA,mBAAAA,MAAA8tB,IAAA,MAAA5jB,GAAAlK,MAAA,UAAAA,MAASkK,GAAAw/O,OAAM,GAEf1pP,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,wDAPFA,MADF,UACEA,CADoD,OACjDA,MAAA,wBAAyCA,QAC5CA,MAAA,EAAA2pP,GAAA,iBAQF3pP,iCATKA,MAAA,GAAAA,YAAA,8BAEAA,MAAA,GAAAA,MAAA,OAAAkK,GAAAzL,QAAA+E,yCAtDPxD,MAAA,SAmDEA,MAlDA,EAAA4pP,GAAA,YAkDA5pP,CA/CC,EAAA6pP,GAAA,YA+CD7pP,CA7CqE,EAAA8pP,GAAA,YA6CrE9pP,CAPC,EAAA+pP,GAAA,aAkBH/pP,gCA5DKA,cAAA,QAAAkK,GAAA+gD,KAAAlnD,QAAAmG,GAAA8/O,mBAIGhqP,cAAA,QAAAkK,GAAA+gD,KAAAlnD,QAAAmG,GAAA+/O,cAoCHjqP,cAAA,OAAAkK,GAAA+gD,KAAAlnD,QAAAmG,GAAAggP,yBASGlqP,cAAA,OAAAkK,GAAAigP,gBCND,IAAMC,GAAiB,MAAxB,MAAOA,GAuEFn/L,KACCpsD,OACY4B,OAxEtB,qBACIupP,GACF,OAAIprP,KAAKyrP,gBAAiBzrP,KAAKyrP,eAGxBzrP,KAAK0rP,kBACd,CACA,qBAAIN,CAAkB1kP,IACpB1G,KAAK0rP,mBAA0C,SAArBhlP,GAAMyxD,UAClC,CACQuzL,oBAAqB,EAE7B,0BACIC,GACF,OAAO3rP,KAAK4rP,uBACd,CACA,0BAAID,CAAuBjlP,IACzB1G,KAAK4rP,wBAA+C,SAArBllP,GAAMyxD,UACvC,CACQyzL,yBAA0B,EAElC,gBACIC,GACF,OAAO7rP,KAAK8rP,aACd,CACA,gBAAID,CAAanlP,IACf1G,KAAK8rP,cAAqC,SAArBplP,GAAMyxD,UAC7B,CACQ2zL,eAAgB,EAExB,2BACIR,GACF,OAAItrP,KAAKyrP,cACAzrP,KAAK2rP,uBAEP3rP,KAAK+rP,wBACd,CACA,2BAAIT,CAAwB5kP,IAC1B1G,KAAK+rP,yBAAgD,SAArBrlP,GAAMyxD,UACxC,CACQ4zL,0BAA2B,EAEnC,iBACIR,GACF,OAAIvrP,KAAKyrP,cACAzrP,KAAK6rP,aAEP7rP,KAAKgsP,cACd,CACA,iBAAIT,CAAc7kP,IAChB1G,KAAKgsP,eAAsC,SAArBtlP,GAAMyxD,UAC9B,CACQ6zL,gBAAiB,EAEzB,gBAAIX,GACF,IAAKrrP,KAAKyrP,cACR,OAAO,CAEX,CAEU1oP,MAA+B,IAAIuK,MAEtCzN,QACA2C,KAEAq0B,SAAU,EAET40N,cAER1rP,YACSssD,GACCpsD,GACY4B,IAFb7B,KAAAqsD,QACCrsD,KAAAC,UACYD,KAAA6B,UAEpB7B,KAAKH,QAAUG,KAAKC,OAAOG,UAAU,QACrCJ,KAAK62B,QAA8D,IAApDrwB,OAAO08O,oBAAoBljP,KAAKH,SAAS+J,MAC1D,CAEO2D,WACLvN,KAAKisP,eACLjsP,KAAKksP,SACP,CAEO/B,UACLnqP,KAAKqsD,KAAK5nD,kBACVzE,KAAKksP,UACLlsP,KAAK+C,MAAMqL,MAAK,EAClB,CAEO9J,SACLtE,KAAKqsD,KAAK/nD,SAASzB,UAAU,KAC3B7C,KAAKwC,UAAOR,EACRhC,KAAK6B,SACH7B,KAAKH,SAASssP,YAChBnsP,KAAK6B,OAAO2xC,SAAS,CAACxzC,KAAKH,SAASssP,cAC3BnsP,KAAKH,SAAS+E,WACvB5E,KAAK6B,OAAO2xC,SAAS,CAACxzC,KAAKH,SAAS+E,YAAU,EAItD,CAEOkmP,OACD9qP,KAAK6B,QAAU7B,KAAKH,SAAS+E,WAC/B5E,KAAK6B,OAAO2xC,SAAS,CAACxzC,KAAKH,SAAS+E,WAExC,CAEQsnP,UACN,MAAM3mP,GAAevF,KAAKqsD,KAAK3pD,cAC3B6C,KACFvF,KAAKwC,KAAO,CACVwsB,KAAMzpB,GAAa/C,KAAK6+D,WAAa97D,GAAa/C,KAAKoG,UAG7D,CAEQqjP,eACDjsP,KAAK6B,QAIV7B,KAAK6B,OAAOsgJ,OACTp+I,QAAK2F,KAAQggB,IAAUA,cAAiB0iO,MACxCvpP,UAAW+gL,KACV,GAAIA,GAAYrhL,IAAK,CACnB,MAAM8pP,GAAezoE,GAAYrhL,IAC3B4pP,GAAcnsP,KAAKH,SAASssP,YAElCnsP,KAAKyrP,cAAgBY,KAAiBF,GAElCnsP,KAAKyrP,eACPzrP,KAAKqsD,KAAK/nD,QAEd,GAEN,8CAzIWknP,IAAiBpqP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,KAAA,kCAAjB2lP,GAAiBl9O,UAAA,oBAAAC,OAAA,CAAA68O,kBAAA,oBAAAO,uBAAA,yBAAAE,aAAA,eAAAP,wBAAA,0BAAAC,cAAA,iBAAA/8O,QAAA,CAAAzL,MAAA,SAAA0L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kWAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,ID7C9B1N,MAAA,EAAAkrP,GAAA,mBAAMlrP,MAAA,OAAA2N,GAAA8nB,wBCmCF1nB,KACA05O,GACApE,EACAsD,EACAG,GACAlE,EACAz0O,KAAezJ,KACf6J,KAAiB5J,MAAA8J,OAAA,oaAGR27O,EAAiB,kFCzCjB13E,GAAiB,CAC5B,CAAEzwG,KAAM,GAAIkpL,WAAY,OAAQC,UAAW,QAC3C,CACE5gP,MAAO,mBACPy3D,KAAM,OACNjnD,UCc6B,MAA3B,MAAOqwO,GAGSC,aAFbvnP,QAAkB,EAClBwnP,SACP5sP,YAAoB2sP,IAAA1sP,KAAA0sP,eAA4B,CAEhDn/O,WACEvN,KAAK2sP,SAAW3sP,KAAK0sP,aAAazqP,QAAQY,UAAWsC,KACnDnF,KAAKmF,OAASA,IAElB,CAEAb,SACEtE,KAAK0sP,aAAapoP,QACpB,CAEA4J,cACElO,KAAK2sP,SAASx+O,aAChB,8CAjBWs+O,IAAoBrrP,MAAAuE,MAAA,+BAApB8mP,GAAoBn+O,UAAA,oBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,gMAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KClB/B1N,MALF,qBAKEA,CADD,0BAEGA,MAAA,+DACAA,MAAA,QACAA,MAAA,cAIEA,MAAA,0BAAS2N,GAAAzK,QAAQ,GAEjBlD,MAAA,eAGNA,YACAA,MAAA,2BAfEA,MAAA,eAAAA,MAAA,EAAAoW,KAQIpW,MAAA,GAAAA,MAAA,YAAA2N,GAAA5J,wBDMFynP,KACAC,KACArB,GACAj8O,KAAe3J,MAAAiK,OAAA,gOAGN48O,EAAoB,uJED1B,IAAMK,EAAkB,MAAzB,MAAOA,GAeFj7O,QACCG,aAfH9B,MAAqB,IAAI9E,KAAY,IAEpC86N,OAAmC,IAAInkO,KAAgB,GAE/D,iBAAIkQ,GAGF,OAFqBjS,KAAKgS,aAAa+sB,OAAOr4B,QAEhC+M,KAAMC,SADkB1T,KAAKgS,aAAas0D,aAAa5/D,QACtBw/D,KAAiBE,UACvDp7D,KAAcC,KAEhBD,KAAcE,OACvB,CAEAnL,YACS8R,GACCG,IADDhS,KAAA6R,WACC7R,KAAAgS,eACP,CAEHzE,WACEvN,KAAKkQ,MAAMgV,KAAK,CACd,CACEhT,GAAI,MACJtG,MAAO,MACPD,KAAM,MACNkC,QAAS,cACTtB,QAASA,KACP7G,MAAM,QACN1F,KAAKkmO,OAAOvjO,MAAK,EAAI,GAGzB,CACEuP,GAAI,OACJtG,MAAO,OACPD,KAAM,OACNkC,QAAS,eACTL,KAAM,CAAC,KACPjB,QAAUsrB,KACRnyB,MAAM,aAAamyB,MAAO,EAE5B9pB,aAAcA,IAAM/N,KAAKkmO,QAE3B,CACEh0N,GAAI,SACJtG,MAAO,SACPiC,QAAS,iBACTlC,KAAM,SACNY,QAASA,KACP7G,MAAM,WACN1F,KAAKkmO,OAAOvjO,MAAK,EAAK,EAExBoL,aAAcA,IAAM/N,KAAKkmO,SAG/B,CAEAh4N,cACElO,KAAKkQ,MAAM6D,SACb,8CA1DW+4O,IAAkB1rP,MAAAuE,MAAAvE,MAAAwE,MAAA,+BAAlBknP,GAAkBx+O,UAAA,iBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,oJAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCrB7B1N,MADF,qBACEA,CAD+C,0BAE7CA,MAAA,qBA6BJA,kBA5BMA,MAAA,GAIAA,MAJA,QAAA2N,GAAAmB,MAIA9O,CAJe,cAIfA,CAHiB,wBAAA2N,GAAAkD,cAGjB7Q,CAFyC,gBAEzCA,CADmB,OAAA2N,GAAAkD,+BDcb26O,IAAoBC,IAAwBj7O,MAAkB/B,OAAA,gOAE7Di9O,EAAkB,sKEnB7B1rP,MAAA,2BAUQA,MAAA,gCADFA,MAAA,GACEA,MAAA,EAAA2rP,EAAA,2GACG3rP,QAGTA,MAHS,mBAAA4rP,GAGT5rP,CAAA,0BAAAA,MAAA,EAAA+zC,EAAA83M,GAAAvmP,MAAAwmP,GAAA7tO,OAAA8tO,GAAAF,GAAA1mP,oCAUWnF,MAFL,MAEKA,CAFF,SAEEA,CAAA,OAAGA,MAAA,GAAmCA,QAAKA,MAAA,SAAEA,QAC/CA,MAAA,aACHA,yEAFQA,MAAA,GAAAA,MAAA8rP,GAAA7tO,OAAA8tO,GAAAF,GAAA1mP,MACuBnF,MAAA,GAAAA,MAAA,YAAA6rP,GAAAvmP,MAAAtF,oCAnBnCA,MAAA,GAeEA,MAZA,EAAAgsP,GAAA,qBAYAhsP,CAZ+D,EAAAisP,EAAA,yBAAAjsP,yEAAhDA,QAAgCA,MAAhC,OAAA8rP,GAAAjvJ,SAAAgvJ,GAAAvmP,OAAgCtF,CAAA,WAAAksP,iCAJnDlsP,MAAA,GACEA,MAAA,EAAAmsP,EAAA,yFACGnsP,cAAA,YAAA8rP,GAAAtM,WAAAl4O,QAAAwkP,GAAA7tO,OAAA8tO,GAAAF,GAAA1mP,iCAFLnF,MAAA,EAAAosP,EAAA,iDAAmCpsP,MAAA,UAAAA,MAAA,aCiBhC,IAAMqsP,EAAmB,MAA1B,MAAOA,GAKQ71O,UAJZhM,MACA3H,KACA28O,WAEP7gP,YAAmB6X,IAAA5X,KAAA4X,YAA+C,CAElEqmF,SAAS29C,IACP,MAAsB,iBAARA,KAAqBrgI,MAAMC,QAAQogI,GACnD,CAEAv8H,OAAOmiO,GAASj7O,IACd,OAAQi7O,GAAUA,GAAU,IAAM,IAAMj7O,EAC1C,8CAbWknP,IAAmBrsP,MAAAuE,MAAA,+BAAnB8nP,GAAmBn/O,UAAA,sBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,+UAAAC,SAAA,SAAAC,GAAAC,IAAA,KAAAD,GAAA,kBDzBhC1N,MAAA,UAA4CA,MAAA,GAAWA,QAEvDA,MAAA,WAKEA,MAJA,EAAAssP,EAAA,qBAIAtsP,CAFC,EAAAusP,EAAA,yBAAAvsP,OA6BHA,QAGEA,MADF,UACEA,CADsB,cACaA,MAAA,mBAAAA,aAAAyK,IAAAzK,MAAS2N,GAAA6I,UAAAK,OAAgB,GAAM,GAChE7W,MAAA,UAEJA,qCAxC4CA,cAAA2N,GAAAnD,OAIvCxK,MAAA,GAA8BA,MAA9B,mBAAA4rP,GAA8B5rP,CAAA,0BAAAA,MAAA,EAAAoW,EAAAzI,GAAA9K,uBCW/BiU,KACAC,KACAoqJ,KACA9tJ,KACAtF,KACAiJ,KACA7I,KAAe3J,KACfosD,MAAYxvB,cAAA,WAGHirN,EAAmB,KCjBnBG,EAAiB,MAAxB,MAAOA,GACSt1O,OAApBvY,YAAoBuY,IAAAtY,KAAAsY,SAAoB,CAEjCC,KAAK3M,GAAY3H,GAAM28O,IAC5B,MAAMhpO,GAAY5X,KAAKsY,OAAOC,KAAKk1O,EAAqB,CACtD90O,cAAc,IAEhBf,UAAUgB,kBAAkB3U,KAAOA,GACnC2T,GAAUgB,kBAAkBhN,MAAQA,GACpCgM,GAAUgB,kBAAkBgoO,WAAaA,IAAc,GAEhDhpO,GAAUiB,aACnB,8CAZW+0O,IAAiBxsP,MAAAuE,MAAA,iCAAjBioP,GAAiBvsP,QAAjBusP,GAAiBtsP,mBAAjBssP,EAAiB,KCEjBC,EAAmB,MAA1B,MAAOA,GAIX,cAAO90O,GACL,MAAO,CACLC,SAAU60O,GAEd,8CARWA,GAAmB,8BAAnBA,uCAFA,CAACD,GAAkB30O,QAAA,CAFpBw0O,YAICI,EAAmB,0CCVpBC,EAAZ,SAAYA,IACVA,UAAAC,MAAA,QACAD,GAAAE,SAAA,WAFUF,EAGZ,CAHA,CAAYA,GAAqB,2CCW3B1sP,MAAA,qBAAmDA,MAAA,GAEjDA,qCAFYA,MAAA,kBAAAogC,GAAA96B,OAAqCtF,cAAAogC,GAAA51B,OAAA41B,GAAA96B,mCAPrDtF,MAAA,EAAA6sP,EAAA,4CAKE7sP,MAAA,UAAAkK,GAAArH,KAAA69B,sCAQA1gC,MAAA,yBAIEA,MAAA,GACFA,qCAHEA,MAAA,QAAA8sP,GAAAxnP,OAEAtF,cAAA,IAAA8sP,GAAAtiP,OAAAsiP,GAAAxnP,MAAA,kDALJtF,MAAA,wBAA+CA,MAAA,kBAAAqW,IAAArW,MAAAkL,IAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAAUkK,GAAAqlB,SAAAlZ,IAAgB,GACvErW,MAAA,EAAA+sP,EAAA,2BAMF/sP,kCALuBA,cAAA,UAAAkK,GAAArH,KAAA69B,UC2BpB,IAAMssN,EAAoC,MAA3C,MAAOA,GAKD54N,YACD7zB,gBACAiW,UAGA3T,KATFquB,UACA+7N,YAAwC,IAAItsP,KAAgB,GAEnEhC,YACUy1B,GACD7zB,GACAiW,GAGA3T,IALCjE,KAAAw1B,eACDx1B,KAAA2B,mBACA3B,KAAA4X,aAGA5X,KAAAiE,QAEPjE,KAAKsyB,UAAYtyB,KAAKw1B,YAAYyL,MAAMjhC,KAAKsuP,SAC7CtuP,KAAKiE,KAAKsqP,gBACRvuP,KAAKiE,KAAKsqP,iBACV,+CACFvuP,KAAKiE,KAAKshC,kBACRvlC,KAAKiE,KAAKshC,mBACV,iDACFvlC,KAAKiE,KAAKqhC,iBACRtlC,KAAKiE,KAAKqhC,kBACV,gDACFtlC,KAAKiE,KAAK2H,MACR5L,KAAKiE,KAAK2H,OAAS,6CACjB5L,KAAKiE,KAAKT,OAASsqP,EAAsBC,QAC3C/tP,KAAKiE,KAAK2H,MAAQ,qCAEtB,CAEA2B,WACEvN,KAAKsyB,UAAUiG,aAAa11B,UAAU,IAAM7C,KAAKwuP,aACnD,CAEAF,QACE,MAAMhsM,GAAI,GACV,OAAAtiD,KAAKiE,KAAK69B,QAAQrhB,IAAKs/B,IAAOuC,GAAEvC,GAAEr5C,QAAS,GACpC47C,EACT,CAEAksM,aACE,MAAM1sN,GAAU9hC,KAAKiE,KAAK69B,QAAQrhB,IAAKs/B,IAAMA,GAAEr5C,OACzC+nP,GAAc,GACpB3sN,GAAQrhB,IAAKs/B,IACX//C,KAAKsyB,UAAU5rB,MAAMq5C,IAAK0uM,GAAYnnP,KAAKy4C,SAAK/9C,GAG9ChC,KAAKquP,YAAY1rP,MADrB8rP,GAAY7kP,OAGd,CAEA4iD,OACE,MAAM1qB,GAAU9hC,KAAKiE,KAAK69B,QAAQrhB,IAAKs/B,IAAMA,GAAEr5C,OAEzCgoP,GAAkB,GACxB5sN,GAAQrhB,IAAKs/B,IACX//C,KAAKsyB,UAAU5rB,MAAMq5C,IAAK2uM,GAAgBpnP,KAAKy4C,SAAK/9C,GAEtDhC,KAAK4X,UAAUK,MAAM,CAAE6pB,QAAS4sN,IAClC,CAEAtpN,SACEplC,KAAK4X,UAAUK,OACjB,CAEA0Y,SAASgb,IACP,MAAM7J,GAAU,GAChB9hC,KAAKiE,KAAK69B,QAAQrhB,IAAKs/B,IAAOje,GAAQie,GAAEr5C,QAAS,GACjDo7B,GAAQ6J,GAAEjlC,QAAS,EACnB1G,KAAKsyB,UAAUiF,SAASuK,GAC1B,8CArEWssN,IAAoChtP,MAAAuE,MAAAvE,MAAAwE,MAAAxE,MAAAyE,MAAAzE,MASrCglC,KAAe,kCATdgoN,GAAoC9/O,UAAA,0CAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,8ZAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD7CjD1N,MAAA,UAAqBA,MAAA,wBAA4BA,QAG/CA,MADF,WACEA,CAD6C,eAc3CA,MAZA,EAAAutP,EAAA,WAYAvtP,CANC,EAAAwtP,EAAA,yBAcHxtP,QAGIA,MAFJ,UAEIA,CAFoB,UAEpBA,CADwB,cACgBA,MAAA,0BAAS2N,GAAAq2B,QAAQ,GACvDhkC,MAAA,0BACFA,QACAA,MAAA,iCAMEA,MAAA,0BAAS2N,GAAAy9C,MAAM,GAEfprD,MAAA,0BAIRA,sBA1CqBA,oBAAA,IAAA2N,GAAA9K,KAAA2H,QAEExK,MAAA,GAAAA,MAAA,YAAA2N,GAAAujB,WAGhBlxB,MAAA,GAAAA,MAAA,oBAAA2N,GAAA9K,KAAAT,MAWepC,cAAA,iBAAA2N,GAAA9K,KAAAT,MAYdpC,MAAA,GAAAA,MAAA,IAAAA,MAAA,KAAA2N,GAAA9K,KAAAqhC,kBAAA,KAGAlkC,MAAA,GAAAA,MAAA,WAAAA,MAAA,MAAA2N,GAAAs/O,cAOAjtP,MAAA,GAAAA,MAAA,IAAAA,MAAA,MAAA2N,GAAA9K,KAAAshC,mBAAA,qBCNJrtB,KACAukB,KAAW92B,eACX43B,KAAmB53B,UACnBwJ,KACAsF,KACAhF,KAAiB3J,KACjBiuD,KAAchuD,UACdqS,KACA7I,KAAevJ,KACf0J,KACAC,KAAiBgF,MAAA9E,OAAA,uMAGRu+O,EAAoC,KChCpCS,EAAwB,MAA/B,MAAOA,GACSv2O,OAApBvY,YAAoBuY,IAAAtY,KAAAsY,SAAoB,CAEjCC,KACLupB,GACAjiC,IAEA,MAAMoE,GAAwB,CAC5B69B,cACGjiC,IAQL,OALkBG,KAAKsY,OAAOC,KAAK61O,EAAsC,CACvEz1O,cAAc,EACd1U,WACGpE,KAEYgZ,aACnB,8CAlBWg2O,IAAwBztP,MAAAuE,MAAA,iCAAxBkpP,GAAwBxtP,QAAxBwtP,GAAwBvtP,mBAAxButP,EAAwB,KCHxBC,GAA0B,MAAjC,MAAOA,GAIX,cAAO/1O,GACL,MAAO,CACLC,SAAU81O,GACVtkP,UAAW,GAEf,8CATWskP,GAA0B,8BAA1BA,uCAFA,CAACD,GAAyB51O,QAAA,CAF3Bm1O,YAICU,EAA0B,KCmC1BC,GAAkB,MAAzB,MAAOA,GAEDnxL,qBACAoxL,yBACAC,kBACAC,kBAJVnvP,YACU69D,GACAoxL,GACAC,GACAC,IAHAlvP,KAAA49D,wBACA59D,KAAAgvP,4BACAhvP,KAAAivP,qBACAjvP,KAAAkvP,oBACP,CAEHrwL,UACE7+D,KAAK49D,qBACFrlD,KAAK,4BACL1V,UAAWmmE,KACVtjE,MAAM,mBAAmBsjE,KAAG,EAElC,CACAmmL,QACEnvP,KAAK49D,qBACFrlD,KAAK,0BAA2B,CAAEG,WAAW,IAC7C7V,UAAWmmE,KACVtjE,MAAM,mBAAmBsjE,KAAG,EAElC,CAEQ/7C,OAAOzpB,IAObxD,KAAKgvP,yBAAyBz2O,KANJ,CACxB,CAAE7R,MAAO,IAAKkF,MAAO,aACrB,CAAElF,MAAO,IAAKkF,MAAO,SACrB,CAAElF,MAAO,EAAGkF,MAAO,SAGuB,CAAEpI,UAAQX,UAAWmmE,KAC3DA,IAAGlnC,UACDknC,GAAElnC,QAAQl4B,OAAS,EACrBlE,MAAM,uBAAuBsjE,GAAElnC,WAE/Bp8B,MAAM,mBAAmBsjE,GAAElnC,WAAS,EAI5C,CAEAymL,QACEvoN,KAAKitB,OAAO6gO,EAAsBE,SACpC,CACAj1D,QACE/4L,KAAKitB,OAAO6gO,EAAsBC,MACpC,CAEAqB,OACEpvP,KAAKivP,kBAAkB12O,KACrB,gBACA,CACE82O,KAAM,cACNC,OAAQ,CACNC,SAAU,MACVC,UAAW,QAEbC,OAAQ,CACNF,SAAU,QACVC,UAAW,QAEb5jP,MAAO,oCACP81D,SAAU,CAAC,cAAe,eAE5B,CAAC,YAEL,CACAvhC,OA0DEngC,KAAKkvP,kBACF32O,KAAK,CAAEqtB,iBA1DkC,CAC1C,CACE5W,KAAM,UACNpjB,MAAO,UACP/L,QAAS,CACPokC,KAAM,KAqDgB4B,kBANkB,CAC5C,CAAE7W,KAAM,UAAW4W,iBA3CwB,CAC3C,CACE5W,KAAM,OACNpjB,MAAO,OACP/L,QAAS,CACPokC,KAAM,MAuCV,CAAEjV,KAAM,OAAQ4W,iBAnC2B,CAC3C,CACE5W,KAAM,KACNpjB,MAAO,KACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW/C,WAG1B,CACEhT,KAAM,OACNpjB,MAAO,OACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW/C,WAG1B,CACEhT,KAAM,SACNpjB,MAAO,SACPpI,KAAM,SACN3D,QAAS,CACPokC,KAAM,GAER11B,OAAQ,CACNuzB,QAAS,CACP,CAAEp7B,MAAO,EAAGkF,MAAO,UACnB,CAAElF,MAAO,EAAGkF,MAAO,kBAYsB,CAAE6xD,SAAU,SAC1D56D,UAAWoB,KACNA,IACFyB,MAAMuyB,KAAKouB,UAAUpiD,IAAK,EAGlC,CAEA0iC,QACE,MAAMf,GAAsC,CAC1C,CACE5W,KAAM,QACNpjB,MAAO,QACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW2qN,QAAQ,CAAC3qN,KAAW/C,SAAU+C,KAAW4B,UAGnE,CACE3X,KAAM,WACNpjB,MAAO,WACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW/C,UAExBzzB,OAAQ,CACNu0B,YAAY,KAKlB9iC,KAAKkvP,kBAAkB32O,KAAK,CAAEqtB,sBAAoB/iC,UAAWoB,KACvDA,KACFA,GAAKhB,SAAW,2CAChByC,MAAMuyB,KAAKouB,UAAUpiD,KAAK,EAGhC,8CAnKW8qP,IAAkB3tP,MAAAuE,MAAAvE,MAAAwE,GAAAxE,MAAAyE,GAAAzE,MAAA0E,MAAA,+BAAlBipP,GAAkBzgP,UAAA,iBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,iMAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KC1CzB1N,MAHN,qBAGMA,CAHoD,yBAGpDA,CAF2C,YAE3CA,CADO,WACoBA,MAAA,kBAAYA,QAErCA,MADF,UACEA,CAD8B,cAK5BA,MAAA,0BAAS2N,GAAA8vD,SAAS,GAElBz9D,MAAA,mBACFA,QACAA,MAAA,cAAsDA,MAAA,0BAAS2N,GAAAogP,OAAO,GACpE/tP,MAAA,6BAGNA,YACAA,MAAA,kBAGEA,MADF,aACEA,CADO,YACoBA,MAAA,uBAAgBA,QAEzCA,MADF,WACEA,CAD8B,eACwBA,MAAA,0BAAS2N,GAAAw5M,OAAO,GACpEnnN,MAAA,qDACFA,QACAA,MAAA,eAAsDA,MAAA,0BAAS2N,GAAAgqL,OAAO,GACpE33L,MAAA,wDAGNA,YACAA,MAAA,kBAEEA,MADF,aACEA,CADO,YACoBA,MAAA,iBAAUA,QAEnCA,MADF,WACEA,CAD8B,eACwBA,MAAA,0BAAS2N,GAAAoxB,MAAM,GACnE/+B,MAAA,mBACFA,QACAA,MAAA,eAAsDA,MAAA,0BAAS2N,GAAA43B,OAAO,GACpEvlC,MAAA,cAGNA,YACAA,MAAA,kBAEEA,MADF,aACEA,CADO,YACoBA,MAAA,eAAQA,QAEjCA,MADF,WACEA,CAD8B,eACwBA,MAAA,0BAAS2N,GAAAqgP,MAAM,GACnEhuP,MAAA,qCAKVA,gCDlBIwrP,IACAC,IACA/zO,KACAg2O,GACAroN,KACAonN,EACAt+O,KAAexJ,KACfmlD,IAAgBllD,KAAA6J,OAAA,ofAGPk/O,EAAkB,qBEvBxB,IAAMY,GAAsB,MAA7B,MAAOA,GAGS59O,MAFXid,KAETjvB,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAE/CgJ,iBACE/a,KAAK+R,MAAM4K,eACb,8CAPWgzO,IAAsBvuP,aAAA,+BAAtBuuP,GAAsBrhP,UAAA,+BAAAC,OAAA,CAAAygB,KAAA,QAAAvgB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAE,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KAJtB1N,MAAA,OAAGA,MAAA,GAA2BA,gBAA3BA,cAAA,qBAAA2N,GAAAigB,KAAA,kDAIH2gO,EAAsB,KAiBtBC,GAAuB,MAA9B,MAAOA,GACS79O,MAApBhS,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAE/CgJ,iBACE/a,KAAK+R,MAAM4K,eACb,8CALWizO,IAAuBxuP,aAAA,+BAAvBwuP,GAAuBthP,UAAA,gCAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAE,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KAJ/B1N,MAAA,OAAGA,MAAA,kEAA4DA,qDAIvDwuP,EAAuB,KAoBvBC,GAA4B,MAAnC,MAAOA,GACXzzO,UAAiBuzO,GAEjBphP,OAAS,CAAEygB,KAAM,OAEjB8gO,kBACE9vP,KAAKoc,UACHpc,KAAKoc,YAAcuzO,GACfC,GACAD,EACR,8CAVWE,GAA4B,+BAA5BA,GAA4BvhP,UAAA,4BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,0KAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KC1DvC1N,MADF,qBACEA,CAD0D,0BAExDA,MAAA,0BAGAA,MAAA,cAAwCA,MAAA,0BAAS2N,GAAA+gP,iBAAiB,GAChE1uP,MAAA,wBAGNA,oBAPwBA,MAAA,GAAwBA,MAAxB,YAAA2N,GAAAqN,UAAwBhb,CAAD,SAAA2N,GAAAR,wBDmD3Cq+O,IACAC,IACA3wO,MACA3M,KAAe5J,MAAAkK,OAAA,gOAGNggP,EAA4B,kDE/CnCzuP,MADF,QACEA,CAD4B,OACzBA,MAAA,oBAAsCA,QACzCA,MAAA,OAAGA,MAAA,oBAA0CA,QAC7CA,MAAA,OAAGA,MAAA,mBAAaA,MAAA,8BAClBA,kCAHKA,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAAqnB,GAAAsnO,iBAAA79O,GAAA,IACA9Q,MAAA,GAAAA,MAAA,SAAAA,MAAA,IAAAqnB,GAAAsnO,iBAAA/gO,KAAA,IACmB5tB,MAAA,GAAAA,MAAA,YAAAA,MAAA,KAAAqnB,GAAAsnO,iBAAAr8K,YAAAtyE,QCerB,IAAM4uP,GAA0B,MAAjC,MAAOA,GACJ9/O,MAAqB,IAAI7E,MAAY,IAErC0kP,gBACL,IAAIhuP,SAA4BC,GAC3BiuP,iBAEPlwP,cAAe,CAEfwN,WACEvN,KAAKkQ,MAAMgV,KAAK,CACd,CAAEhT,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,wBACxC,CAAExhE,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,wBACxC,CAAExhE,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,yBAE5C,CAEAxlE,cACElO,KAAKkQ,MAAM6D,SACb,CAEAm8O,SAASlyO,IACP,OAAOA,GAAOgR,IAChB,CAEAusB,iBAAiB7xB,IACf1pB,KAAKiwP,mBAAmBvmO,GAAMhjB,MAAMwL,GACpClS,KAAK+vP,gBAAgBptP,KAAK+mB,GAAMhjB,MAClC,8CA5BWspP,GAA0B,+BAA1BA,GAA0B1hP,UAAA,0BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4LAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD3BnC1N,MAFJ,qBAEIA,CAFsD,yBAEtDA,CADsD,2BAMpDA,MAAA,0BAAAqW,IAAA,OAAkB1I,GAAAwsC,iBAAA9jC,GAAwB,GAE5CrW,QAEAA,MAAA,EAAA+uP,GAAA,cAMJ/uP,kBAdMA,MAAA,GAGAA,MAHA,QAAA2N,GAAAmB,MAGA9O,CAHe,gBAAA2N,GAAAmhP,SAGf9uP,CAF0B,eAE1BA,CADgB,kCAMZA,cAAA,OAAA2N,GAAAkhP,kCCWNrD,IACAC,IACA7jO,MACA7Z,KACAO,MAASG,OAAA,gOAGAmgP,EAA0B,KCJ1BI,GAAuB,MAA9B,MAAOA,GACJlgP,MAAqB,IAAI7E,MAAY,IACrC4f,UACPJ,kBAA8C,IAAI9oB,KAAgB,GAE3D+oB,iBAAgD,CAAEP,SAAU,IAE5D1b,SAAgC,CACrC6d,WAAW,EACXoK,mBAAmB,EACnB3I,YAAY,EACZ3L,MAAM,EACN6B,cAAeA,CAACrG,GAAgBgR,QACvBjR,OAAkBC,GAAQgR,IAEnC2H,QAAS,CACP,CACE3H,KAAM,WACNpjB,MAAO,WACPyY,cAAgBrG,IACPhe,KAAKkQ,MAAMM,MAAMtQ,IAAI8d,IAAQwK,SAChC,uBACA,yBAEN7R,SAAUqG,MAA0BK,MAEtC,CACE2R,KAAM,KACNpjB,MAAO,MAET,CACEojB,KAAM,OACNpjB,MAAO,QAET,CACEojB,KAAM,cACNpjB,MAAO,cACP+K,SAAUqG,MAA0BE,MAEtC,CACE8R,KAAM,OACNpjB,MAAO,OACPpI,KAAM,QAER,CACEwrB,KAAM,MACNpjB,MAAO,aAET,CACEojB,KAAM,QACNpjB,MAAO,SAET,CACEojB,KAAM,SACNpjB,MAAO,GACPyY,cAAeA,IACN,CACL,CACE1Y,KAAM,OACNJ,MAAO,OACP2L,MAAQ4iB,KACNopC,QAAQK,IAAIzpC,GAAG,IAKvBnjB,SAAUqG,MAA0BM,eAK1Cvd,cAAe,CAEfwN,WAGE,MAAMiS,GAFgB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAE/BiB,IAAKvO,IACvB,IAAPA,GACK,CACLA,MACA8c,KAAM,QAAQ9c,KACdwhE,YAAa,kBAAkBxhE,SAC/B8mB,KAAM,IAAI/3B,KACVsB,IAAK,wBACLwpF,MAAO,6DAGJ,CACL75E,MACA8c,KAAM,QAAQ9c,KACdwhE,YAAa,kBAAkBxhE,SAC/B8mB,KAAM,IAAI/3B,KACVsB,IAAK,wBACLwpF,MAAO,0DAGX/rF,KAAKkQ,MAAMgV,KAAK1F,GAClB,CAEAkX,mBACE12B,KAAK6qB,kBAAkBloB,MAAK,EAC9B,CAEAqoB,gBAAgBtB,IACd1pB,KAAKirB,UAAYvB,EACnB,CAEAxb,cACElO,KAAKkQ,MAAM6D,SACb,8CA7GWq8O,GAAuB,+BAAvBA,GAAuB9hP,UAAA,uBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,iKAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCvBhC1N,MAFJ,qBAEIA,CAFmD,yBAEnDA,CADmD,wBAMjDA,MAAA,qCAAoB2N,GAAA2nB,kBAAkB,GAI5Ct1B,oBARMA,MAAA,GAGAA,MAHA,QAAA2N,GAAAmB,MAGA9O,CAHe,mBAGfA,CAFsB,mBAAA2N,GAAA+b,iBAEtB1pB,CADqC,WAAA2N,GAAAF,0BDkB/B+9O,IAAoBC,IAAwBt3N,OAAoB1lB,OAAA,gOAE/DugP,EAAuB,kDEvBhChvP,MAAA,iCAIEA,MAAA,sBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAq1B,SAAAlpB,IAAgB,GAE9BrW,MAAA,sBAGEA,MADF,UACEA,CADyC,cAKvCA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAs6L,WAAU,GAEnBxkM,MAAA,iBACFA,QACAA,MAAA,cAIEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAA+kP,YAAW,GAEpBjvP,MAAA,kBACFA,QACAA,MAAA,cAMEA,MAAA,cAGNA,iDA/BEA,MADA,OAAAkvP,GACAlvP,CADa,WAAAA,MAAA,IAAAkK,GAAA+5B,QAIGjkC,MAAA,GAAAA,MAAA,QAAAkvP,GAAAtvN,OAAA,IAuBZ5/B,MAAA,GAAAA,MAAA,WAAAkK,GAAA6+N,iBCGH,IAAMomB,GAAgB,MAAvB,MAAOA,GAWS7qN,YAVpBC,MAA+B,IAAI5jC,SAAsBC,GAEzDqjC,MAAiC,IAAItjC,SACnCC,GAGFmoO,gBAAiB,EAETqmB,eAERzwP,YAAoB2lC,IAAA1lC,KAAA0lC,cAA2B,CAE/Cn4B,WAkCE,MAAMwzB,GAjCkC,CACtC,CACE/R,KAAM,KACNpjB,MAAO,KACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW/C,WAG1B,CACEhT,KAAM,OACNpjB,MAAO,OACP/L,QAAS,CACPokC,KAAM,EACNK,UAAWS,KAAW/C,WAG1B,CACEhT,KAAM,SACNpjB,MAAO,SACPpI,KAAM,SACN3D,QAAS,CACPokC,KAAM,GAER11B,OAAQ,CACNuzB,QAAS,CACP,CAAEp7B,MAAO,EAAGkF,MAAO,UACnB,CAAElF,MAAO,EAAGkF,MAAO,eAMc6U,IAAKxgB,IAC5CD,KAAK0lC,YAAYlG,MAAMv/B,KAEnBkgC,GAAangC,KAAK0lC,YAAYvF,KAClC,GACA,CAACngC,KAAK0lC,YAAYzE,MAAM,CAAEjS,KAAM,QAAU+R,MAG5C/gC,KAAKwwP,eAAiBrwN,GAAK9H,QAAQE,aAAa11B,UAAU,KACxD7C,KAAKmqO,gBAAkBhqM,GAAK9H,QAAQ0N,QAGtC/lC,KAAK2lC,MAAMhjC,KAAKw9B,GAClB,CAEAjyB,cACElO,KAAKwwP,eAAeriP,aACtB,CAEAy3L,WACE5lM,KAAKqlC,MAAM1iC,KAAK,CACduP,GAAI,EACJ8c,KAAM,MACN2mE,OAAQ,GAEZ,CAEA06J,YACErwP,KAAK2lC,MAAMj/B,MAAM2xB,QAAQ6I,OAC3B,CAEAP,SAAS18B,IACPyB,MAAMuyB,KAAKouB,UAAUpiD,IACvB,8CAhFWssP,IAAgBnvP,MAAAuE,MAAA,+BAAhB4qP,GAAgBjiP,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,oVAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KDjC3B1N,MADF,qBACEA,CAD6C,0BAE3CA,MAAA,EAAAqvP,GAAA,oCAoCJrvP,kBAnCOA,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,GAAA42B,wBCsBHinN,IACAC,IACA19O,KACA+wB,KACA4D,KACAv0B,KAAe3J,KACf8J,MAASG,OAAA,+RAGA0gP,EAAgB,6CCVtB,IAAMG,GAAgB,MAAvB,MAAOA,GACXC,iBAA2BC,GAC3BC,uBAAiCC,GACjCC,qBAA+BC,GAC/BC,gBAA0BC,GAE1BC,YAAc,IAAIC,KAAoB,uEAN3BV,GAAgB,+BAAhBA,GAAgBpiP,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,wRAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCtBzB1N,MAFJ,qBAEIA,CAF2C,YAE3CA,CADO,OAELA,MAAA,WAAIA,MAAA,UAAMA,MAAA,UAAIA,QAAQA,MAAA,2FAEtBA,MAAA,SACGA,MAAA,mCAA6BA,QAEhCA,MAAA,mDAEJA,UAGEA,MADF,aACEA,CADO,SACHA,MAAA,sBAAeA,QAEnBA,MAAA,SAAIA,MAAA,oDAA6CA,QACjDA,MAAA,gBACAA,MAAA,WAAMA,MAAA,iBAAUA,QAChBA,MAAA,4EACKA,MAAL,SAAKA,CAAA,WAAMA,MAAA,IAAiCA,UAE5CA,MAAA,SAAIA,MAAA,uCAAgCA,QAElCA,MADF,QACEA,CADE,SAEAA,MAAA,gBACAA,MAAA,WAAMA,MAAA,iBAAUA,QAChBA,MAAA,4EACKA,MAAL,SAAKA,CAAA,WAAMA,MAAA,IACbA,YACAA,MAAA,SACEA,MAAA,qFACKA,MAAA,WAAMA,MAAA,iBAAUA,QAAQA,MAAA,cACxBA,MAAL,SAAKA,CAAA,WAAMA,MAAA,IACbA,YACAA,MAAA,SACEA,MAAA,uEACAA,MAAA,WAAMA,MAAA,cAAOA,QACRA,MAAL,SAAKA,CAAA,WAAMA,MAAA,IAGjBA,gBAGEA,MADF,0BACEA,CADwD,QAEtDA,MAAA,8BACAA,MAAA,UACGA,MAAA,oCAELA,UAGIA,MAFJ,WAEIA,CAFyB,sBAEzBA,CADwC,gBAC7BA,MAAA,gBAASA,QACpBA,MAAA,cACFA,QAEAA,MADA,gBACAA,CADiD,iBAIvDA,oBAvCeA,MAAA,IAAAA,MAAA2N,GAAA8hP,wBAQIzvP,MAAA,IAAAA,MAAA2N,GAAA4hP,kBAKAvvP,MAAA,GAAAA,MAAA2N,GAAAgiP,sBAKA3vP,MAAA,GAAAA,MAAA2N,GAAAkiP,iBAeiB7vP,MAAA,IAAAA,MAAA,cAAA2N,GAAAoiP,aAGpB/vP,MAAA,GAAAA,MAAA,OAAA2N,GAAAoiP,YAAAzqP,uBDzCZkmP,IACAC,IACAj9O,MACAqa,MAAkBtkB,YAClB43B,KAAmB33B,eACnBi3B,MAAch3B,OAAAgK,OAAA,kFAKL6gP,EAAgB,KAS7B,MAAMI,GAA4B,uIAC5BF,GAAqB,wJAErBI,GAAyB,oHAQzBE,GAAmB,8OE5CbG,GAAZ,SAAYA,IACVA,aAAAhZ,QAAA,aACAgZ,MAAAC,OAAA,YACAD,MAAAluL,KAAA,UAHUkuL,EAIZ,CAJA,CAAYA,IAAgB,4BCWtB,MAAOE,WAAwBh6K,MAUzBi6K,UACAC,OACAC,MAXV,UAAIhoP,GACF,OAAO1J,KAAK2xP,cAAcjrP,KAC5B,CACA,UAAIgD,CAAOA,IACT1J,KAAK2xP,cAAchvP,KAAK+G,GAC1B,CACQioP,cAAgB,IAAI5vP,IAAgB,IAE5ChC,YACUyxP,GACAC,GACAC,IAERtrP,QAJQpG,KAAAwxP,aACAxxP,KAAAyxP,UACAzxP,KAAA0xP,QAGV,CAIAE,UACE,OAAK5xP,KAAKwxP,WASV,EAAO12L,MALL96D,KAAKwxP,UAAUK,WACf7xP,KAAK2xP,cACL3xP,KAAK0xP,MAAMI,YAGuB/tP,QAClC0c,MAAI,IACKzgB,KAAK+xP,gBAAgB/xP,KAAKwxP,UAAUvtP,QAC5C,EACDwc,MAAKxc,IACIjE,KAAKgyP,cAAc/tP,OAb5B,EAAO62D,MAAM,GAgBjB,CAEAm3L,aAAc,CAEdF,gBAAgB9tP,IACd,OAAKjE,KAAK0J,OAGHzF,GAAK4f,QAAQna,OAAQmuB,KAO8B,IAN9B73B,KAAKyxP,OAAO96N,QACnCjtB,OAAQswB,IAAMA,GAAEk4N,YAChBzxO,IAAKuZ,IAAMzd,MAAYsyB,QAAQhX,GAAMmC,GAAEhL,OACvCnlB,KAAK,KACLsuB,cAEczvB,QAAQ1I,KAAK0J,OAAOyuB,gBAT9Bl0B,EAWX,CAEA+tP,cAAc/tP,IACZ,OAAKjE,KAAK0xP,MAAM/pO,QAAmC,KAAzB3nB,KAAK0xP,MAAMptO,UAI9BrgB,GAAKue,KAAK,CAAC8/B,GAAGC,MACnB,MAAM4vM,GAA6B51O,MAAYsyB,QAC7CyT,GACAtiD,KAAK0xP,MAAM/pO,QAEPyqO,GAA6B71O,MAAYsyB,QAC7C0T,GACAviD,KAAK0xP,MAAM/pO,QAGb,OAAOpL,MAAY6H,eACjBguO,GACAD,GACAnyP,KAAK0xP,MAAMptO,UAAS,GAhBfrgB,EAmBX,4DCtFE7C,MADF,WACEA,CAD+C,uBAE7CA,MAAA,qCAMJA,kBAHMA,MAAA,GAAAA,MAAA,cAAAA,MAAA,8EAUEA,MADF,UACEA,CADoC,qBAElCA,MAAA,kBAAAqW,IAAArW,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAAqW,GAAmBnM,GAAA0iM,eAAiB,KAAI,GAK5C5sM,oCAJIA,QACAA,MADA,UAAAkK,GAAAohB,UAAAyhL,YAAA7iM,GAAA2iM,gBACA7sM,CADmD,gBAAAkK,GAAAohB,UAAAyhL,aAAA7iM,GAAA2iM,+DAMrD7sM,MADF,UACEA,CADiC,qBAG/BA,MADA,iBAAAqW,IAAArW,aAAAkL,IAAAlL,MAASqW,GAAAgX,kBAAwB,EACjCrtB,CADkC,kBAAAqW,IAAA,MAAA46O,GAAAjxP,MAAAkL,IAAAiE,UAAAjF,GAAAlK,QAAA,OAAAA,MAAAqW,GACfnM,GAAAohB,UAAAzV,OAAAo7O,IAAwB,KAAI,GAInDjxP,oDAHIA,cAAA,UAAAkK,GAAAohB,UAAA4hL,WAAA+jD,mCAWFjxP,MAAA,WACEA,MAAA,GACFA,2CADEA,cAAA,IAAAkxP,GAAA1mP,MAAA,gCAFJxK,MAAA,GACEA,MAAA,EAAAmxP,GAAA,mDAMAnxP,MAAA,WAAsCA,MAAA,GAAkBA,2CAAlBA,cAAAkxP,GAAA1mP,kCADxCxK,MAAA,GACEA,MAAA,EAAAoxP,GAAA,kDAIApxP,MAAA,WAQEA,MAAA,GACFA,sEALEA,MAAA,UAAAkK,GAAAmnP,MAAA52N,cAAAvwB,GAAAmnP,MAAA52N,cAAA62N,GAAAJ,IAAAlxP,MAAA,EAAA+zC,KAIA/zC,cAAA,IAAAkK,GAAAquB,SAAA+4N,GAAAJ,GAAAtjO,MAAA,gCATJ5tB,MAAA,GACEA,MAAA,EAAAuxP,GAAA,kDAaAvxP,MAAA,wEAOEA,MAHA,UAAAkK,GAAAmnP,MAAA52N,cAAAvwB,GAAAmnP,MAAA52N,cAAA/M,GAAAwjO,IAAAlxP,MAAA,EAAA+zC,IAGA/zC,CADC,YAAAkK,GAAAquB,SAAA7K,GAAAwjO,GAAAtjO,MAAA5tB,iCANHA,MAAA,EAAAwxP,GAAA,0CA5BJxxP,MAAA,MA2BEA,MAvBA,EAAAyxP,GAAA,sBAuBAzxP,CAvBsC,EAAA0xP,GAAA,sBAuBtC1xP,CAjBuC,EAAA2xP,GAAA,sBAiBvC3xP,CAbkD,EAAA4xP,GAAA,yBAAA5xP,wDAblDA,MAAA,eAAAkxP,GAAAtjO,MAGe5tB,cAAA,OAAAkxP,GAAAv3N,UAMA35B,cAAA,QAAAkxP,GAAAv3N,UAIA35B,QAAoBA,MAApB,QAAAkxP,GAAAr9O,KAAoB7T,CAAA,WAAA6xP,8BA4BnC7xP,MAAA,wDAEEA,MAAA,eAIEA,MAAA,iBAAAqW,IAAA,MAAAy7O,GAAA9xP,MAAAurD,IAAAp8C,UAAAqf,GAAAxuB,QAAAmP,UAAAjF,GAAAlK,QAAA,OAAAA,MAASkK,GAAA6nP,kBAAA17O,GAAAy7O,GAAAtjO,IAAsC,GAE/CxuB,MAAA,cAAUA,MAAA,GACZA,qDAJEA,MAAA,QAAAkK,GAAA8nP,eAAAF,GAAA3nP,QAGUnK,MAAA,GAAAA,MAAA8xP,GAAAvnP,oCAPdvK,MAAA,WACEA,MAAA,EAAAiyP,GAAA,iBAQFjyP,gCAPuBA,cAAA,UAAAkK,GAAAmnP,MAAA55M,mCAUzBz3C,MAAA,wDACAA,MAAA,WAIEA,MAAA,yBAAAkyP,GAAAlyP,MAAAyuB,IAAAtf,UAAAjF,GAAAlK,QAAA,OAAAA,MAASkK,GAAAohB,UAAAzV,OAAAq8O,IAAqB,GAC/BlyP,kDAFCA,MAAA,UAAAkK,GAAAmnP,MAAA92N,aAAArwB,GAAAmnP,MAAA92N,aAAA23N,IAAAlyP,MAAA,EAAA+zC,MCzCD,IAAMo+M,GAAc,MAArB,MAAOA,GACX,YACIC,GACF,OAAOxzP,KAAKwxP,SACd,CACA,YAAIgC,CAAS9sP,IACX1G,KAAKwxP,UAAY9qP,EACnB,CACQ8qP,UAER,SACIiB,GACF,OAAOzyP,KAAKyxP,MACd,CACA,SAAIgB,CAAM/rP,IACR1G,KAAKyxP,OAAS/qP,EAChB,CACQ+qP,OAER,kBACIgC,GACF,OAAOzzP,KAAK0zP,eACd,CACA,kBAAID,CAAe/sP,IACjB1G,KAAK0zP,gBAAkBhtP,EACzB,CACQgtP,iBAAkB,EAEnBxkD,iBACA74K,WACA3J,UAAY,IAAI+kL,OAAoB,EAAM,IAGjDxkL,OAAS,IAAI3f,MAMQ5D,OACiB8Y,KAEtCjV,WACEvN,KAAKq2B,WAAa,IAAIk7N,GAAgBvxP,KAAKwzP,SAAUxzP,KAAKyyP,MAAOzyP,KAAKwiB,MAElExiB,KAAKyyP,QACPzyP,KAAKkvM,iBAAmBlvM,KAAKyyP,MAAM97N,QAChCjtB,OAAQswB,KAAsB,IAAhBA,GAAEirF,WAChBxkG,IAAKuZ,IAAMA,GAAEhL,MAEZhvB,KAAKyyP,MAAM37N,mBACb92B,KAAKkvM,iBAAiBzwJ,QAAQ,qBAE5Bz+C,KAAKyyP,MAAM55M,SAAW74C,KAAKyyP,MAAM55M,QAAQjvC,QAC3C5J,KAAKkvM,iBAAiB5nM,KAAK,WAI/BtH,KAAK0sB,UAAUggG,QAAQ7pH,UAAW8oC,IAAM3rC,KAAKitB,OAAO7e,KAAKu9B,IAC3D,CAEA+H,kBACM1zC,KAAK0J,WACP2hE,MAAUrrE,KAAK0J,OAAOuJ,cAAe,SAClClP,QAAKof,MAAa,MAAG,EAAG+tE,SACxBruF,UAAU,KACJ7C,KAAKq2B,aAGVr2B,KAAKq2B,WAAW3sB,OAAS1J,KAAK0J,OAAOuJ,cAAcvM,QAG3D,CAEAiN,YAAYonC,IACNA,GAAOy4M,WACTxzP,KAAKq2B,WAAa,IAAIk7N,GACpBvxP,KAAKwzP,SACLxzP,KAAKyyP,MACLzyP,KAAKwiB,MAEPxiB,KAAK0sB,UAAU5lB,QAEnB,CAEAssP,eAAeO,IACb,OAAOtC,GAAiBsC,GAC1B,CAEAh6N,SAASG,GAAKvzB,IACZ,OAAOgW,MAAYsyB,QAAQ/U,GAAKvzB,GAClC,CAGA0nM,gBAGE,OAFoBjuM,KAAK0sB,UAAUlE,SAAS5e,SAC5B5J,KAAKwzP,SAASvvP,KAAK2F,MAErC,CAGAokM,eACEhuM,KAAKiuM,gBACDjuM,KAAK0sB,UAAU5lB,QACf9G,KAAKwzP,SAASvvP,KAAKsW,QAASuf,IAAQ95B,KAAK0sB,UAAUO,OAAO6M,IAChE,CAEAq5N,kBAAkBzpO,GAAOhe,GAAQouB,IAC/BpQ,GAAM+E,kBACN/iB,GAAOwL,MAAM4iB,GACf,8CA9GWy5N,GAAc,+BAAdA,GAAcjlP,UAAA,gBAAAuO,UAAA,SAAA/N,GAAAC,OAAA,EAAAD,uBAwCd8kP,MAAO,o9CD3FpBxyP,MAAA,WACEA,MAAA,EAAAyyP,GAAA,aAWEzyP,MADF,UACEA,CAD2B,eAGzBA,MAAA,KASEA,MARA,EAAA0yP,GAAA,WAQA1yP,CARsC,EAAA2yP,GAAA,oBAkBxC3yP,MAAA,EAAA4yP,GAAA,uBAyCA5yP,MAAA,MAEEA,MADA,GAAA6yP,GAAA,WACA7yP,CADsC,GAAA8yP,GAAA,oBAcxC9yP,MADA,GAAA+yP,GAAA,YACA/yP,CADuD,GAAAgzP,GAAA,aAS7DhzP,oBAhG6BA,cAAA,OAAA2N,GAAA0kP,gBAWDryP,MAAA,GAAAA,MAAA,aAAA2N,GAAAsnB,YAuBDj1B,MAAA,GAAAA,MAAA,UAAA2N,GAAA0jP,MAAA97N,SAqDDv1B,MAAA,GAAAA,MAAA,kBAAA2N,GAAAmgM,kBAGG9tM,cAAA,mBAAA2N,GAAAmgM,kCCrDzB//L,KACA8a,MAAkBtkB,MAClBk3B,MAAcj3B,MACdu3B,MAAct3B,4DACdo3B,MAAan3B,YACb2J,KAAiB1J,KACjB0O,KACAnF,KACAC,KAAevJ,KACfwJ,MAAamF,MACbhF,KAAiBkF,MAAAhF,OAAA,quBAGR0jP,EAAc,KCjDrB,MAAOc,GAEXxC,WAAqC,IAAI9vP,IAAuB,IAChE,QAAIkC,GACF,OAAOjE,KAAK6xP,WAAWnrP,KACzB,CAEA3G,YAAYkE,IACNA,IACFjE,KAAK6xP,WAAWlvP,KAAKsB,GAEzB,CAEA5D,IAAI4D,IACFjE,KAAK6xP,WAAWlvP,KAAKsB,GACvB,CAEA2pC,IAAI/V,IACF,MAAMy8N,GAAat0P,KAAKiE,KAAK4f,QAC7BywO,GAAWhtP,KAAKuwB,IAChB73B,KAAKK,IAAIi0P,GACX,CAEA7zP,OAAOo3B,IACL,MAAMy8N,GAAat0P,KAAKiE,KAAK4f,QACvB5E,GAAQq1O,GAAW5rP,QAAQmvB,IACjCy8N,GAAWzuO,OAAO5G,GAAO,GACzBjf,KAAKK,IAAIi0P,GACX,ECXK,IAAMC,GAAiB,MAAxB,MAAOA,GACJf,SAEAf,MAAoB,CACzB97N,QAAS,CACP,CACE3H,KAAM,KACNpjB,MAAO,KACPmvB,UAAU,EACVm3N,YAAY,GAEd,CACEljO,KAAM,OACNpjB,MAAO,OACPmvB,UAAU,EACVm3N,YAAY,GAEd,CACEljO,KAAM,cACNpjB,MAAO,cACPmvB,UAAU,EACVm3N,YAAY,IAGhBr5M,QAAS,CACP,CACEltC,KAAM,cACNJ,MAAO8lP,GAAiBhZ,QACxBnhO,MAAQ4iB,IAAQ95B,KAAKw0P,SAAS16N,GAAI9K,QAGtC8H,mBAAmB,GAGrB/2B,cAAe,CAEfwN,WACEvN,KAAKwzP,SAAW,IAAIa,GAAc,CAChC,CAAEniP,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,WACxC,CAAExhE,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,aACxC,CAAExhE,GAAI,IAAK8c,KAAM,SAAU0kD,YAAa,WAE5C,CAEA8gL,SAASxlO,IACPtpB,MAAMspB,GACR,CAEAylO,aAAaC,IACXxxL,QAAQK,IAAImxL,GACd,8CAlDWH,GAAiB,+BAAjBA,GAAiBjmP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,uHAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCjB1B1N,MAFJ,qBAEIA,CAF4C,yBAE5CA,CAD4C,iBAK1CA,MAAA,kBAAAqW,IAAA,OAAU1I,GAAA0lP,aAAAh9O,GAAoB,GAIpCrW,oBAPMA,MAAA,GAEAA,MAFA,WAAA2N,GAAAykP,SAEApyP,CAFqB,QAAA2N,GAAA0jP,MAErBrxP,CADe,qCDaTwrP,IAAoBC,IAAwB0G,IAAc1jP,OAAA,gOAEzD0kP,EAAiB,0FEhBxBnzP,MAAA,cAGEA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAASkK,GAAAi/B,QAAAwM,uBAA8B,GAGvC31C,MAAA,cAAUA,MAAA,gBACZA,wDAEAA,MAAA,cAGEA,MAAA,mBAAAA,MAAAkL,IAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAASkK,GAAAi/B,QAAAyM,iBAAwB,GAGjC51C,MAAA,cAAUA,MAAA,UACZA,WCoBC,IAAMuzP,GAAN,MAAMA,GAGS5iP,MAFXid,KAETjvB,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAE/CgJ,iBACE/a,KAAK+R,MAAM4K,eACb,8CAPWg4O,IAA0BvzP,aAAA,+BAA1BuzP,GAA0BrmP,UAAA,0BAAAC,OAAA,CAAAygB,KAAA,QAAAvgB,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAE,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KAJzB1N,MAAA,OAAGA,MAAA,GAA6BA,gBAA7BA,cAAA,qBAAA2N,GAAAigB,KAAA,4CAIJ2lO,MAA0BlyN,OAAA,IAZtC8U,OAAc,CACbvoB,KAAM,kBACNpjB,MAAO,aACPD,KAAM,SACN9L,QAAS,CAAEmvB,KAAM,WAClB,EAACqU,GAAAC,IAAA,qBAU2BC,SAHhBoxN,IAqBN,IAAMC,GAAN,MAAMA,mDAAqB,+BAArBA,GAAqBtmP,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAE,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KAJpB1N,MAAA,OAAGA,MAAA,kCAA4BA,+CAIhCwzP,MAAqBnyN,OAAA,IAXjC8U,OAAc,CACbvoB,KAAM,aACNpjB,MAAO,QACPD,KAAM,iBAQKipP,IAkBN,IAAMC,GAAgB,MAAvB,MAAOA,GAWSxqN,YAVpBE,QAAmB,IAAIuL,MAEvB,eAAInL,GACF,OAAO3qC,KAAKuqC,QAAQI,WACtB,CAEA,cAAImqN,GACF,OAAO90P,KAAK2qC,YAAYjkC,MAAQ1G,KAAK2qC,YAAYjkC,MAAMkF,MAAQ,SACjE,CAEA7L,YAAoBsqC,IAAArqC,KAAAqqC,cAA2B,CAE/C98B,WACEvN,KAAKuqC,QAAQ+L,WAAW,CAAC,kBAAmB,eAC5Ct2C,KAAKuqC,QAAQoM,SAAS32C,KAAKqqC,YAAYqM,WACzC,CAEAxoC,cACElO,KAAKuqC,QAAQx2B,SACf,CAEAghP,yBACE/0P,KAAKuqC,QAAQuM,aAAa,kBAAmB,CAAE9nB,KAAM,OACvD,8CAxBW6lO,IAAgBzzP,MAAAuE,OAAA,+BAAhBkvP,GAAgBvmP,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,yaAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KD5EzB1N,MAFJ,qBAEIA,CAF2C,yBAE3CA,CAD2C,iBAEzCA,MAAA,EAAA4zP,GAAA,iCASA5zP,MAAA,EAAA6zP,GAAA,iCASA7zP,MAAA,mBAKFA,QAEAA,MAAA,cAIEA,MAAA,0BAAS2N,GAAAgmP,wBAAwB,GAEjC3zP,MAAA,gCAGNA,oBAnCeA,MAAA,GAAAA,MAAA,QAAA2N,GAAA+lP,YAKN1zP,cAAA,OAAAA,MAAA,IAAA2N,GAAA47B,cASAvpC,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,GAAA47B,cAMDvpC,MAAA,GACAA,MADA,UAAA2N,GAAAw7B,QACAnpC,CADmB,8BC8CvBwrP,IACAC,IACAv3M,KACAnmC,KACAI,KAAe3J,UACf4J,MAAa3J,MACbsyC,MACAzoC,MAASG,OAAA,gOAGAglP,EAAgB,iCC1CtB,IAAMK,GAA4B,MAAnC,MAAOA,GASSnjP,MANXid,KAECsa,SAAW,IAAIh8B,MAEf83B,OAAS,IAAI93B,MAEvBvN,YAAoBgS,IAAA/R,KAAA+R,QAA2B,CAE/CgJ,iBACE/a,KAAK+R,MAAM4K,eACb,8CAbWu4O,IAA4B9zP,aAAA,+BAA5B8zP,GAA4B5mP,UAAA,4BAAAC,OAAA,CAAAygB,KAAA,QAAAxgB,QAAA,CAAA86B,SAAA,WAAAlE,OAAA,UAAA32B,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mCAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KAVrC1N,MAAA,OAAGA,MAAA,GAA6BA,QAChCA,MAAA,cAAwBA,MAAA,0BAAS2N,GAAAu6B,SAAAl7B,KAAAW,GAAAigB,KAAmB,GAClD5tB,MAAA,wBACFA,QACAA,MAAA,cAAwBA,MAAA,0BAAS2N,GAAAq2B,OAAAh3B,KAAAW,GAAAigB,KAAiB,GAAE5tB,MAAA,aAAOA,gBAJxDA,cAAA,qBAAA2N,GAAAigB,KAAA,qBAQKzf,KAAe5J,MAAA68B,cAAA,EAAA1yB,gBAAA,WAEdolP,EAA4B,KCvBlC,MAAMphF,GAAiB,CAC5B,CAAEzwG,KAAM,GAAIkpL,WAAY,SAAUC,UAAW,QAC7C,CACE5gP,MAAO,SACPy3D,KAAM,SACNjnD,UAAW0wO,GAEb,CACElhP,MAAO,UACPy3D,KAAM,SACNjnD,UAAW2yO,IAEb,CACEnjP,MAAO,oBACPy3D,KAAM,oBACNjnD,UAAWyzO,IAEb,CACEjkP,MAAO,eACPy3D,KAAM,eACNjnD,UAAWg0O,IAEb,CACExkP,MAAO,kBACPy3D,KAAM,kBACNjnD,UAAW4zO,IAEb,CACEpkP,MAAO,OACPy3D,KAAM,OACNjnD,UAAWm0O,IAEb,CACE3kP,MAAO,OACPy3D,KAAM,OACNjnD,UAAWs0O,IAEb,CACE9kP,MAAO,QACPy3D,KAAM,QACNjnD,UAAWm4O,IAEb,CACE3oP,MAAO,OACPy3D,KAAM,OACNjnD,UAAWy4O,IAEb,CACEjpP,MAAO,SACPy3D,KAAM,SACNjnD,UDJ2B,MAAzB,MAAO+4O,GAKSp4B,cAJpBljL,OAEAtrC,OAAS,CAAEygB,KAAM,OAEjBjvB,YAAoBg9N,IAAA/8N,KAAA+8N,iBAClB/8N,KAAK65C,OAAS75C,KAAK+8N,cAAchhN,OAAOm5O,GAC1C,CAEAv5M,iBAAiB3sB,IACftpB,MAAM,GAAGspB,gEACX,CAEA0sB,iBACEh2C,MAAM,kEACR,8CAfWyvP,IAAkB/zP,MAAAwE,OAAA,+BAAlBuvP,GAAkB7mP,UAAA,iBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kHAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KEzD3B1N,MAFJ,qBAEIA,CAF6C,yBAE7CA,CAD6C,yBAK3CA,MADA,oBAAAqW,IAAA,OAAY1I,GAAA4sC,iBAAAlkC,GAAwB,EACpCrW,CADqC,2BAC3B2N,GAAA2sC,gBAAgB,GAIhCt6C,oBAPMA,MAAA,GACAA,MADA,SAAA2N,GAAA8qC,OACAz4C,CADiB,SAAA2N,GAAAR,wBFsDXq+O,IAAoBC,IAAwBlzM,MAAqB9zC,MAAAgK,OAAA,gOAEhEslP,EAAkB,0HGpDzB/zP,MAAA,QAAqCA,MAAA,GAASA,kCAATA,cAAAg0P,6BAHzCh0P,MAAA,GACEA,MAAA,aAAcA,MAAA,mBAAaA,QAC3BA,MAAA,QACEA,MAAA,EAAAi0P,EAAA,YACFj0P,sCADsBA,MAAA,GAAAA,MAAA,UAAAkK,EAAAgqP,eCGnB,IAAM1I,EAAkB,MAAzB,MAAOA,EACFhhP,MACA+3I,SACA2xG,wDAHE1I,EAAkB,+BAAlBA,EAAkBt+O,UAAA,qBAAAC,OAAA,CAAA3C,MAAA,QAAA+3I,SAAA,WAAA2xG,aAAA,gBAAA7mP,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAAC,EAAA9I,MAAA,EAAAC,KAAA,EAAAC,OAAA,4FAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,YDV/B1N,MAAA,UAAiCA,MAAA,GAAcA,QAC/CA,MAAA,QAAIA,MAAA,GAAWA,QAEfA,MAAA,WACEA,MAAA,EAAAm0P,EAAA,sBAMAn0P,MAAA,GACFA,eAXiCA,cAAA2N,EAAA40I,UAC7BviJ,MAAA,GAAAA,MAAA2N,EAAAnD,OAGaxK,MAAA,GAAAA,MAAA,aAAA2N,EAAAumP,aAAA,KAAAvmP,EAAAumP,aAAA1rP,wBCILuF,KAAMsF,MAAK5E,OAAA,wdAEV+8O,CAAkB,+KCGvBxrP,MAPF,QAOEA,CADD,cACWA,MAAA,eACZA,gCALEA,MAAA,OAAAqnB,EAAA+sO,QAAAp0P,iCAaAA,MAPF,QAOEA,CADD,cACWA,MAAA,cACZA,gCALEA,MAAA,OAAAqnB,EAAAgtO,UAAAr0P,QCVR,MAAMs0P,EACJ,8EAgBK,IAAM7I,EAAsB,MAA7B,MAAOA,EACFjhP,MACA+pP,WACAC,aAET,WAAIJ,GACF,MAAO,GAAGE,SAAgB11P,KAAK21P,YACjC,CAEA,aAAIF,GACF,MAAO,GAAGC,KAAY11P,KAAK41P,cAC7B,4CAXW/I,EAAsB,+BAAtBA,EAAsBv+O,UAAA,yBAAAC,OAAA,CAAA3C,MAAA,QAAA+pP,WAAA,aAAAC,aAAA,gBAAAnnP,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAmW,mBAAAC,EAAA9I,MAAA,GAAAC,KAAA,EAAAC,OAAA,0aAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,YDvB/B1N,MAFJ,eAEIA,CAF4B,oBAE5BA,CADe,uBAEbA,MAAA,GACFA,QACAA,MAAA,WAUEA,MATA,EAAAy0P,EAAA,UASAz0P,CAHC,EAAA00P,EAAA,WAaL10P,UAEAA,MAAA,mBAEAA,MAAA,wBACEA,MAAA,GAEJA,iBA7BMA,MAAA,GAAAA,MAAA,IAAA2N,EAAAnD,MAAA,KAIGxK,MAAA,GAAAA,MAAA,OAAA2N,EAAA4mP,YASAv0P,cAAA,OAAA2N,EAAA6mP,8BCCLhhP,KAAajP,oBACbwJ,KACAI,KAAe3J,KACfyJ,KAAgBxJ,KAChB2J,KAAa1J,KACbolD,IAAgBnlD,KAAA8J,OAAA,2VAGPg9O,CAAsB,2MC2BnBzrP,MAAA,iCAAqBA,MAAA,iBChD9B,MAAM0yK,EAAiB,CAC5B,CAAEzwG,KAAM,GAAIkpL,WAAY,UAAWC,UAAW,QAC9C,CACE5gP,MAAO,UACPy3D,KAAM,UACNjnD,UC6B4B,MAA1B,MAAO25O,EAeDp4L,WACAvU,eAfH3oC,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU49D,EACAvU,GADAppD,KAAA29D,aACA39D,KAAAopD,iBAERppD,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,KAC5BzgB,KAAKopD,eAAehJ,qBACpBpgD,KAAKopD,eAAe7L,cACtB,4CArBWw4M,GAAmB30P,MAAAuE,OAAAvE,MAAAwE,MAAA,+BAAnBmwP,EAAmBznP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,y0BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IFxBtB1N,MAdV,qBAcUA,CAVT,yBAUSA,CATiE,oBASjEA,CARsD,kBAQtDA,CAPW,sBAOXA,CADD,WAGGA,MADA,UACAA,CADkC,2BAOpCA,QACAA,MAAA,WAaEA,MAZA,6BAYAA,CAPyB,4BAOzBA,CADuB,yBAI7BA,YAGIA,MAFJ,mBAEIA,CAFW,YAEXA,CADiD,mBAE/CA,MAAA,0BAIFA,QAGEA,MADF,kBACEA,CAD4C,wBAE1CA,MAAA,GAAA40P,EAAA,yBAAA50P,OAQZA,kBAEAA,MAAA,4BAKEA,MAAA,mCAEJA,iBAjEEA,MAAA,eAAAA,MAAA,GAAAoW,IAQQpW,MAAA,GACAA,MADA,MAAA2N,EAAA0R,IACArf,CADW,OAAA2N,EAAAoB,MAOP/O,MAAA,GACAA,MADA,sBACAA,CADyB,MAAA2N,EAAA0R,KAQzBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMArf,cAAA,MAAA2N,EAAA0R,KAIerf,cAAA,MAAA2N,EAAA0R,KASfrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAKkCrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAgBjBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,qBEvC3BmsO,IACAC,IACAoJ,KAAiBpwP,UAAAF,8BAAAC,mBAGjB0vC,IAAc3vC,iBAGdsjD,eAGS8sM,CAAmB,6ICjBzB,IAAMG,EAAoB,MAA3B,MAAOA,GAGSj2L,gBAFZk2L,YAAwB,GAEhCp2P,YAAoBkgE,IAAAjgE,KAAAigE,kBAAmC,CAEvD1+B,WACEvhC,KAAKm2P,YAAY7uP,KAAKtH,KAAKigE,gBAAgB1+B,WAC7C,CAEA8+B,aACErgE,KAAKigE,gBAAgBI,WAAWrgE,KAAKm2P,YAAYn7N,MACnD,CAEA,WAAIo7N,GACF,OAAOp2P,KAAKigE,gBAAgBO,SAAS95D,KACvC,8CAfWwvP,IAAoB90P,MAAAuE,MAAA,+BAApBuwP,GAAoB5nP,UAAA,mBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,qMAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCpB/B1N,MADF,qBACEA,CAD+C,OAC5CA,MAAA,mEAA6DA,QAEhEA,MAAA,QACEA,MAAA,cAAOA,MAAA,UAAMA,MAAA,uBAAiBA,QAAQA,MAAA,4CACxCA,QACAA,MAAA,QAAIA,MAAA,aAAOA,MAAA,WAAMA,MAAA,wBAAiBA,QAAQA,MAAA,iBAASA,QAI/CA,MAFJ,0BAEIA,CAF2C,WAE3CA,CADoC,eACVA,MAAA,0BAAS2N,GAAAwyB,UAAU,GAAEngC,MAAA,eAAQA,QACvDA,MAAA,eAA0BA,MAAA,0BAAS2N,GAAAsxD,YAAY,GAAEj/D,MAAA,iBACnDA,UAGEA,MADF,WACEA,CADkC,QAC/BA,MAAA,IAAsBA,QAEzBA,MAAA,oBAGNA,oBALSA,MAAA,IAAAA,MAAA,YAAA2N,GAAAqnP,QAAA,oBDALxJ,IACAC,IACAn3M,KACAnmC,KAAe3J,MAAAiK,OAAA,iFAGNqmP,EAAoB,+BEL1B,IAAMG,EAAkB,MAAzB,MAAOA,GAGS7tN,cAFb8tN,eAEPv2P,YAAoByoC,IAAAxoC,KAAAwoC,iBAClBxoC,KAAKs2P,eAAiBt2P,KAAKwoC,cAAcpoC,UAAU,WACrD,8CALWi2P,IAAkBj1P,MAAAuE,MAAA,+BAAlB0wP,GAAkB/nP,UAAA,iBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,2IAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCf7B1N,MADF,qBACEA,CAD6C,OAC1CA,MAAA,6CAAuCA,QAE1CA,MAAA,QAAIA,MAAA,aAAOA,MAAA,UAAMA,MAAA,qBAAeA,QAAQA,MAAA,gBAASA,QAO/CA,MALF,yBAKEA,CADD,SACuBA,MAAA,qBAE1BA,oBAF0BA,MAAA,IAAAA,MAAA,oBAAAA,MAAA,KAAA2N,GAAAunP,gBAAA,oBDId1J,IAAoBC,IAAwB3sJ,eAE3Cm2J,EAAkB,+BEIxB,IAAME,EAAoB,MAA3B,MAAOA,GAIS50P,gBAHb60P,IAAM,CACX5qP,MAAO,OAET7L,YAAoB4B,IAAA3B,KAAA2B,kBAAmC,CAEvD80P,eAAexiM,IACbj0D,KAAK2B,gBAAgB8D,YAAYwuD,IACjCiP,QAAQK,IAAIvjE,KAAK2B,gBACnB,8CATW40P,IAAoBn1P,MAAAuE,MAAA,+BAApB4wP,GAAoBjoP,UAAA,mBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,uPAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCnB/B1N,MADF,qBACEA,CAD+C,OAC5CA,MAAA,wCAAkCA,QAErCA,MAAA,QAAIA,MAAA,aAAOA,MAAA,UAAMA,MAAA,uBAAiBA,QAAQA,MAAA,gBAASA,QACnDA,MAAA,QACEA,MAAA,qBACAA,MAAA,UAEGA,MAAA,mBAELA,UAIIA,MAFJ,0BAEIA,CAF2C,WAE3CA,CADoC,eACVA,MAAA,0BAAS2N,GAAA0nP,eAAe,KAAK,GAAEr1P,MAAA,cAAOA,QAChEA,MAAA,eAA0BA,MAAA,0BAAS2N,GAAA0nP,eAAe,KAAK,GAAEr1P,MAAA,kBAC3DA,UAEAA,MAAA,YACEA,MAAA,0BAGNA,oBAHMA,MAAA,IAAAA,MAAA,IAAAA,MAAA,eAAA2N,GAAAynP,KAAA,qBDLF5J,IACAC,IACAt9O,KAAe3J,KACf+J,KAAiB9J,eAGR0wP,EAAoB,oBEN1B,IAAMG,EAAiB,MAAxB,MAAOA,GACS1kP,aAApBjS,YAAoBiS,IAAAhS,KAAAgS,eAA6B,CAEjD,SAAIgtB,GACF,OAAOh/B,KAAKgS,aAAawB,UAC3B,CAEA,eAAIqhF,GACF,OAAO70F,KAAKgS,aAAai1D,gBAC3B,CAEA,iBAAIC,GACF,OAAOlnE,KAAKgS,aAAak1D,eAC3B,8CAbWwvL,IAAiBt1P,MAAAuE,MAAA,+BAAjB+wP,GAAiBpoP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,kEAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCb5B1N,MADF,qBACEA,CAD4C,OACzCA,MAAA,oDAA8CA,QAG/CA,MADF,yBACEA,CAD0C,OACvCA,MAAA,GAA0BA,QAC7BA,MAAA,OAAGA,MAAA,GAAsCA,QACzCA,MAAA,OACEA,MAAA,GAINA,oBAPOA,MAAA,GAAAA,MAAA,kBAAA2N,GAAAiwB,MAAA,IACA59B,MAAA,GAAAA,MAAA,wBAAA2N,GAAA8lF,YAAA,IAEDzzF,MAAA,GAAAA,MAAA,iBAAA2N,GAAAm4D,cAAA,0DDKM0lL,IAAoBC,cAEnB6J,EAAiB,mBECvB,IAAMC,EAAmB,MAA1B,MAAOA,GACS/0P,eAApB7B,YAAoB6B,IAAA5B,KAAA4B,iBAAiC,CAErD6oD,UACEzqD,KAAK4B,eAAe6oD,QAAQ,kBAAmB,UACjD,CAEAqU,OACE9+D,KAAK4B,eAAek9D,KAAK,iBAAkB,OAC7C,CAEAp5D,QACE1F,KAAK4B,eAAe8D,MAAM,UAAW,QACvC,CACAtB,QACEpE,KAAK4B,eAAewC,MAAM,iBAAkB,QAC9C,8CAhBWuyP,IAAmBv1P,MAAAuE,MAAA,+BAAnBgxP,GAAmBroP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,8SAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCd9B1N,MADF,qBACEA,CAD8C,OAC3CA,MAAA,2BAAqBA,QAExBA,MAAA,QAAIA,MAAA,aAAOA,MAAA,UAAMA,MAAA,sBAAgBA,QAAQA,MAAA,gBAASA,QAClDA,MAAA,QAAIA,MAAA,2CAAqCA,QAIrCA,MAFJ,0BAEIA,CAF0C,WAE1CA,CAD2C,eACjBA,MAAA,0BAAS2N,GAAA07C,SAAS,GAAErpD,MAAA,sBAAeA,QAC7DA,MAAA,eAA0CA,MAAA,0BAAS2N,GAAA+vD,MAAM,GACvD19D,MAAA,qBACFA,QACAA,MAAA,eAAyCA,MAAA,0BAAS2N,GAAArJ,OAAO,GACvDtE,MAAA,sBACFA,QACAA,MAAA,eAAuCA,MAAA,0BAAS2N,GAAA3K,OAAO,GACrDhD,MAAA,sBAIRA,8BDPYwrP,IAAoBC,IAAwBt9O,KAAe3J,eAE1D+wP,EAAmB,oBETzB,MAAMC,EAAoB/2P,MAC7BA,GAAQg3P,oBAAsBh3P,GAAQi3P,cAE7BC,GAAmBl3P,MAC5BA,GAAQm3P,4BAA8Bn3P,GAAQo3P,yECG3C,MCRMC,EAAqB,IAAIvzL,MACpC,sBAGI,SAAUwzL,EACdt3P,IAEA,IAAKA,GACH,MAAO,GAGT,MAAM2K,GAAwB,CAC5B,CAAEC,QAASysP,EAAoBrzL,SAAUhkE,KAW3C,MAPO,WADCA,GAAQghE,UAEZr2D,GAAUlD,QCPdzH,MAGA,QADsCmC,IAApBnC,GAAQ8wC,UAAwB9wC,GAAQ8wC,QAExD,MAAO,GFGeymN,EACxBv3P,GACAy3L,MAGA,IADMoyD,EAAS2N,QAEb,OAGF,MAAMj0L,GAA6B,IAC9BvjE,GACHy3P,aAAc,CACZV,EAAiB/2P,MAAO,EAAK03P,QAC7BR,GAAgBl3P,MAAO,EAAK23P,QAC5B9tP,OAAOkmC,WAGX+D,QAAKyvB,GAAU,EEjBfg0L,CAAWv3P,IAEX,MAAM43P,GAAiBb,EAAiB/2P,IAExC,MAAO,CACL,CACE4K,QAASitP,MACT/vN,WAAYA,IFfhB9nC,QAEO83P,MAAmB,CACxBC,UAAW/3P,GAAQ+3P,aACf/3P,GAAQg4P,qBAAuB,KEWfC,CAAyBj4P,KAE7C43P,IAAkB,CAChBhtP,QAASstP,KACTlwN,KAAM,CAACmwN,OAGTP,IAAkB,CAChBhtP,QAASi9B,MACTC,WAAYA,IAAM,OAClBE,KAAM,CAACkwN,MACPntP,OAAO,IAETlB,OAAOkmC,QAAO,EDpBMqoN,CAAwBp4P,KAMvC2K,EACT,qCEdO,IAAM0tP,EAAqB,MAA5B,MAAOA,GAKD1vN,cAGA2vN,kBACAv4P,SAPVuG,YAEApG,YACUyoC,GAGA2vN,GACAv4P,IAJAI,KAAAwoC,iBAGAxoC,KAAAm4P,qBACAn4P,KAAAJ,YAEHI,KAAKm4P,mBAAmBC,cAI7Bp4P,KAAKwoC,cAAcm6B,UAChB5+D,QACCs5C,KAAO+mB,IAAaA,KAAQ,EAC5Bt7B,KAAU,KACR9oC,KAAKmG,YAAcnG,KAAKJ,SAASM,IAAIsB,MAC9BxB,KAAKmG,aAAarE,iBAG5Be,UAAW0B,KAEVvE,KAAKq4P,cADQ9zP,GAAkBvE,KAAKmG,YAAY3D,KAAO,KAChC,EAE7B,CAEQ61P,cAAc71P,IAEb,WADCxC,KAAKm4P,kBAAkBt3L,UJjCAr+D,OACjC4+D,QACE5+D,GACI,CACE0P,GAAI1P,GAAK0P,GACTlP,SAAU,GAAGR,GAAK6+D,aAAa7+D,GAAK8+D,WACpC36B,MAAOnkC,GAAKmkC,OAEd,KAAI,EI2BJ2xN,CAAmB91P,GAMzB,8CAtCW01P,IAAqB92P,MAAAuE,MAAAvE,MAOtB81P,EAAkB,GAAA91P,aAAA,iCAPjB82P,GAAqB72P,QAArB62P,GAAqB52P,UAAAC,WAFpB,gBAED22P,EAAqB,KCL5B,SAAUK,EACd14P,IAEA,OAAKA,GAIE,CACL,CACE4K,QAASytP,EACTvtP,SAAUutP,EACVrwN,KAAM,CAAC1nC,KAAe+2P,EAAoBtsL,QAG5C,CACEngE,QAASi9B,MACTC,WAAYA,IAAM,OAClBE,KAAM,CAACqwN,GACPttP,OAAO,IAdF,EAiBX,gBCHO,IAAM4tP,GAAsB,MAA7B,MAAOA,GAIF34P,QACCuvP,KAJVqJ,oBAA8BvH,GAC9BnxP,YAESF,GACCuvP,IADDpvP,KAAAH,WACCG,KAAAovP,OACP,CAEHsJ,iBACE,MAAM,IAAI12O,MAAM,oBAClB,CAEA22O,wBACE,MAAMC,GAAc,0BAA0B3gO,KAAKouB,UACjDrmD,KAAKH,QACL,KACA,OAEF,OAAOG,KAAKovP,KAAKh2O,UAAU6e,KAAKC,MAAM0gO,IACxC,8CAnBWJ,IAAsBp3P,MAGvB81P,GAAkB91P,MAAAuE,MAAA,+BAHjB6yP,GAAsBlqP,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,MARtB,CACT8+F,QACGi3J,EAAkB0B,IAAYC,IAAIC,eAClCR,EAA0BM,IAAYC,IAAIC,cAC9C33P,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,iZAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCtBC1N,MAFJ,qBAEIA,CAF+C,YAE/CA,CADO,OAELA,MAAA,WAAIA,MAAA,UAAMA,MAAA,gBAAUA,QAAQA,MAAA,mFAE9BA,QAEEA,MADF,OACEA,CADE,QACEA,MAAA,oDAA8CA,QAClDA,MAAA,SAAIA,MAAA,oEAERA,YAGEA,MADF,aACEA,CADO,SACHA,MAAA,sBAAeA,QACnBA,MAAA,QACEA,MAAA,0DACAA,MAAA,WAAMA,MAAA,sBAAeA,QAAQA,MAAA,iIAG7BA,MAAA,UAGGA,MAAA,oBAELA,UACKA,MAAL,SAAKA,CAAA,WAAMA,MAAA,IACbA,YAGEA,MADF,aACEA,CADO,SACHA,MAAA,+CAAwCA,QAC5CA,MAAA,QACEA,MAAA,0FACUA,MAAA,WAAMA,MAAA,mBAAYA,QAAQA,MAAA,2DACpBA,MAAA,WAAMA,MAAA,gCAAyBA,QAAQA,MAAA,2BAE3DA,UAGEA,MADF,aACEA,CADO,SACHA,MAAA,+DAAwDA,QAC5DA,MAAA,QACEA,MAAA,+BACAA,MAAA,UAGGA,MAAA,2BAGPA,YAGEA,MADF,aACEA,CADO,SACHA,MAAA,4BAAqBA,QACzBA,MAAA,QACEA,MAAA,wBAAgBA,MAAA,WAAMA,MAAA,wBAAiBA,QAAQA,MAAA,sCAEjDA,QACAA,MAAA,UAAKA,MAAA,aACPA,UAOEA,MALF,0BAKEA,CADD,UAEGA,MAAA,6KAGFA,QACAA,MAAA,eAAuCA,MAAA,0BAAS2N,GAAA2pP,gBAAgB,GAC9Dt3P,MAAA,yBAGNA,oBA/CeA,MAAA,IAAAA,MAAA2N,GAAA4pP,yBA8BAv3P,MAAA,IAAAA,MAAA,YAAA2N,GAAA0pP,oBAAAr3P,uBD7BHwrP,IAAoBC,IAAwBt9O,KAAe3J,eAE1D4yP,EAAsB,KAsBnC,MAAMtH,GAAmB,0UE5BlB,IAAM8H,GAAmB,MAA1B,MAAOA,GAEDv3P,KACDE,gBAFT5B,YACU0B,GACDE,IADC3B,KAAAyB,QACDzB,KAAA2B,kBACN,CAEHs3P,WAEEj5P,KAAKyB,KAAKvB,IADE,oDACO2C,UAAWw1D,KAC5B6K,QAAQK,IAAIlL,GAAG,EAEnB,CAEA6gM,gBAEEl5P,KAAKyB,KAAKvB,IADE,OACO2C,UAAWw1D,KAC5B6K,QAAQK,IAAIlL,GAAG,EAEnB,8CAlBW2gM,IAAmB53P,MAAAuE,OAAAvE,MAAAwE,MAAA,+BAAnBozP,GAAmB1qP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,8HAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCrB9B1N,MADF,qBACEA,CAD8C,OAC3CA,MAAA,oCAA8BA,QAEjCA,MAAA,QACEA,MAAA,cAAOA,MAAA,UAAMA,MAAA,sBAAgBA,QAAQA,MAAA,uDAEvCA,QACAA,MAAA,QACEA,MAAA,cAAOA,MAAA,WAAMA,MAAA,qBAAcA,QAAQA,MAAA,oEAErCA,QACAA,MAAA,SAAIA,MAAA,+BAAwBA,QAIxBA,MAFJ,0BAEIA,CAFuC,WAEvCA,CAD6B,eACHA,MAAA,0BAAS2N,GAAAkqP,UAAU,GAAE73P,MAAA,UAAGA,QAClDA,MAAA,eAA0BA,MAAA,0BAAS2N,GAAAmqP,eAAe,GAAE93P,MAAA,YAG1DA,8BDFIwrP,IACAC,IACAt9O,KAAe1J,eAGNmzP,EAAmB,sFEZtB53P,MAAA,kBACEA,MAAA,GACFA,qCAFyCA,MAAA,QAAA+3P,GAAAzyP,OACvCtF,cAAA,IAAA+3P,GAAAvtP,MAAA,MCAL,MAAMkoK,GAAiB,CAC5B,CAAEzwG,KAAM,GAAIkpL,WAAY,WAAYC,UAAW,QAC/C,CACE5gP,MAAO,WACPy3D,KAAM,WACNjnD,UAAW85O,GAEb,CACEtqP,MAAO,SACPy3D,KAAM,SACNjnD,UAAWi6O,GAEb,CACEzqP,MAAO,WACPy3D,KAAM,WACNjnD,UAAWm6O,GAEb,CACE3qP,MAAO,QACPy3D,KAAM,QACNjnD,UAAWs6O,GAEb,CACE9qP,MAAO,UACPy3D,KAAM,UACNjnD,UAAWu6O,GAEb,CACE/qP,MAAO,aACPy3D,KAAM,aACNjnD,UAAWo8O,IAEb,CACE5sP,MAAO,UACPy3D,KAAM,UACNjnD,UAAW48O,IAEb,CACEptP,MAAO,SACPy3D,KAAM,QACNjnD,UCzB0B,MAAxB,MAAOg9O,GAeFz3P,gBACCgV,SAfV0iP,OACAC,OAAS,CACP,CAAE5yP,MAAO,OAAQkF,MAAO,QACxB,CAAElF,MAAO,WAAYkF,MAAO,aAC5B,CAAElF,MAAO,SAAUkF,MAAO,wBAC1B,CAAElF,MAAO,WAAYkF,MAAO,aAC5B,CAAElF,MAAO,OAAQkF,MAAO,QACxB,CAAElF,MAAO,aAAckF,MAAO,UAC9B,CAAElF,MAAO,SAAUkF,MAAO,UAC1B,CAAElF,MAAO,SAAUkF,MAAO,UAC1B,CAAElF,MAAO,OAAQkF,MAAO,SAG1B7L,YACS4B,GACCgV,IADD3W,KAAA2B,mBACC3B,KAAA2W,WACP,CAEH6sO,UAAU+V,IACR,GAA8B,mBAA1BA,GAAgB7yP,MAGlB,OAFA1G,KAAKq5P,QAAS,OACdr5P,KAAK2W,SAASQ,SAAS7O,SAASlF,KAAM,cAIpCpD,KAAKq5P,QACPr5P,KAAK2W,SAASS,YAAY9O,SAASlF,KAAM,eAAY,EAGvDogP,OAAUj8O,OAAOe,SAAUixP,GAAgB7yP,MAAQ,SACrD,8CA/BW0yP,IAAiBh4P,MAAAuE,MAAAvE,aAAA,+BAAjBg4P,GAAiB9qP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,sNAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KFzB5B1N,MADF,qBACEA,CAD4C,OACzCA,MAAA,0BAAoBA,QAKjBA,MAHN,yBAGMA,CAHsC,UAGtCA,CAF2B,mBAE3BA,CADc,kBAEZA,MAAA,2BAAAqW,IAAA,OAAmB1I,GAAAy0O,UAAA/rO,GAAiB,GAGpCrW,MAAA,EAAAo4P,GAAA,oBAGAp4P,MAAA,kBAAoCA,MAAA,kBAK9CA,0BARwCA,MAAA,GAAAA,MAAA,UAAA2N,GAAAuqP,wBEQpC1M,IACAC,IACA5iO,MAAkBrkB,MAClBskB,MAAerkB,MAAAC,MACf2O,KACA0V,gBAGSivO,EAAiB,wMCWvB,IAAMK,EAAmB,MAA1B,MAAOA,EAoBDp/L,aACAsqK,eACAxoL,eACAwhB,WAtBV6hK,QACO/+M,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGD43M,aAA4B,IAAIruP,KAAqB,IAErDsuP,iBAAgC,IAAItuP,KAAyB,IAEpEtL,YACUs6D,EACAsqK,EACAxoL,EACAwhB,IAHA39D,KAAAq6D,eACAr6D,KAAA2kO,iBACA3kO,KAAAm8C,iBACAn8C,KAAA29D,aACP,CAKHpwD,WACEvN,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,SAGTX,UAAW4/C,GAAqBziD,KAAKygB,IAAIu7C,SAASvZ,IAErDziD,KAAK8+N,eAEL9+N,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,KAC5BzgB,KAAK05P,aAAah1O,UACfrC,SACEkE,IAA4D,IAA1BA,EAAO/V,MAAMgY,UAEjD3lB,UAAW0jB,IACNA,GAAUA,EAAOvI,SAEnBhe,KAAKw/N,QADoBj5M,EAAOvI,OAElC,EAEN,CAOA47O,sBAAsBlwO,GACpB1pB,KAAKu/N,iBAAiB71M,EAAM81M,QAC9B,CAMQV,eACN9+N,KAAK2kO,eAAe7F,eAAej8N,UAAWw8N,IAC5Cr/N,KAAK05P,aAAa5yP,QAClB9G,KAAK05P,aAAax0O,KAChBm6M,EAAS1+M,OACN3gB,KAAKm8C,eAAej8C,IAAI,kBAAoB,IAC9C,EAGP,CAOQq/N,iBAAiBC,GACvBx/N,KAAK2kO,eACFpF,iBAAiBC,GACjB38N,UAAW+wC,IACV5zC,KAAK25P,iBAAiB7yP,QACtB9G,KAAK25P,iBAAiBz0O,KAAK0uB,EAAK,EAEtC,4CA5FW6lN,GAAmBr4P,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAuE,OAAA,+BAAnB8zP,EAAmBnrP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4SAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC9B1B1N,MAPN,qBAOMA,CAHL,yBAGKA,CAFyC,sBAEzCA,CADyC,WAEvCA,MAAA,uBAEJA,UAGEA,MADF,gBACEA,CADiC,2BAG/BA,MAAA,+BAAAqW,IAAA,OAAuB1I,EAAA6qP,sBAAAniP,GAA6B,GAGxDrW,UAEAA,MAAA,iBACEA,MAAA,2BAQNA,mBA1BEA,MAAA,eAAAA,MAAA,EAAAoW,IAGmBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMjBrf,MAAA,GAAAA,MAAA,QAAA2N,EAAA2qP,cAQAt4P,MAAA,GAEAA,MAFA,UAAA2N,EAAAywN,QAEAp+N,CAFmB,QAAA2N,EAAA4qP,iBAEnBv4P,CADgC,MAAA2N,EAAA0R,qBDMpCmsO,IACAC,IAAsBlnP,YAEtB2vC,IACA00L,MACA3C,OAAuBx3N,OAAA,yEAGd4pP,CAAmB,0EEQzB,IAAMI,EAAsB,MAA7B,MAAOA,EA8BDx/L,aACAsD,WACAx3D,YA/BHsa,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,EACNk0E,WAAW,GAGNjxC,WAAyB,IAAIkY,MAAW,IACxCjU,kBAAuC,IAAIkU,MAAkB,GAAI,CACtEz8E,IAAKzgB,KAAKygB,MAELukE,iBAAqC,IAAIqY,MAAiB,GAAI,CACnE58E,IAAKzgB,KAAKygB,MAELmkE,mBAAyC,IAAIwY,MAAmB,GAAI,CACzE38E,IAAKzgB,KAAKygB,MAELqkE,mBAAoC,IAAI9pC,IAExC0zC,eAEP3uF,YACUs6D,EACAsD,EACAx3D,GAFAnG,KAAAq6D,eACAr6D,KAAA29D,aACA39D,KAAAmG,cAERnG,KAAK0uF,eAAiB1uF,KAAKmG,YAAYrE,cACvC9B,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,KAC5BzgB,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,kBACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,mEACLu3E,YAAa,eAGhBj3E,UAAW4/C,IAAqBziD,KAAKygB,IAAIu7C,SAASvZ,IACvD,4CAhDWo3M,GAAsBz4P,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,MAAA,+BAAtBi0P,EAAsBvrP,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,MALtB,IACT8tO,UAAiBqB,WAAgB,EACjCS,OAAc,IAAClW,aAChB15N,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,omBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IClCO1N,MATV,qBASUA,CALT,yBAKSA,CAJwC,oBAIxCA,CAHsD,kBAGtDA,CADD,sBACCA,CAD0C,WAGxCA,MADA,UACAA,CADkC,2BAOpCA,QACAA,MAAA,WAaEA,MAZA,6BAYAA,CAPyB,4BAOzBA,CADuB,wBAG5BA,YAECA,MADF,mBACEA,CADa,aAEXA,MAAA,wBAcVA,uBA/CEA,MAAA,eAAAA,MAAA,GAAAoW,IAKwBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAKvB/O,MAAA,GACAA,MADA,sBACAA,CADyB,MAAA2N,EAAA0R,KAQzBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMArf,cAAA,MAAA2N,EAAA0R,KAIerf,cAAA,MAAA2N,EAAA0R,KAOjBrf,MAAA,GAKAA,MALA,aAAA2N,EAAAg2E,WAKA3jF,CALyB,oBAAA2N,EAAAi6E,kBAKzB5nF,CAJuC,mBAAA2N,EAAAi2E,iBAIvC5jF,CAHqC,qBAAA2N,EAAA61E,mBAGrCxjF,CAFyC,qBAAA2N,EAAA+1E,mBAEzC1jF,CADyC,iBAAA2N,EAAA2/E,gCDRjDk+J,IACAC,IACAoJ,KAAiBpwP,UAAAF,8BAEjB6nF,gBAOSqsK,CAAsB,qCEX5B,IAAMC,EAAgB,MAAvB,MAAOA,EAmBDp7I,kBACArkD,aACAsD,WApBHl9C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,GAEbysD,WAAW,KAIRptD,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,EACNE,WAAY,aAGPt6B,OAA0C,GAEjD3nB,YACU2+G,EACArkD,EACAsD,GAFA39D,KAAA0+G,oBACA1+G,KAAAq6D,eACAr6D,KAAA29D,aAER39D,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,KAC5BzgB,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,GACRgsB,WAAW,EACXxrB,SAAS,IACc,EAGjC,4CAtCWijO,GAAgB14P,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAhBm0P,EAAgBxrP,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mMAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC3BvB1N,MAPN,qBAOMA,CAHL,yBAGKA,CAFsC,sBAEtCA,CADyC,WAEvCA,MAAA,uBAEJA,UAEAA,MAAA,gBAEJA,iBAXEA,MAAA,eAAAA,MAAA,EAAAoW,IAGmBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAIXrf,QAAkBA,MAAlB,SAAA2N,EAAA2Y,OAAkBtmB,CAAD,MAAA2N,EAAA0R,qBDe3BqtG,MACA6iB,MACAq0D,MACA4nD,IACAC,KAAsBh9O,OAAA,4FAGbiqP,CAAgB,KEEhBC,EAAmB,MAA1B,MAAOA,EAqCDr7I,kBACArkD,aArCH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGD+yF,cAAqC,CAC1CnoH,WAAW,EACXyB,YAAY,EACZ3L,MAAM,EACNmU,QAAS,CACP,CACE3H,KAAM,gBACNpjB,MAAO,MAET,CACEojB,KAAM,kBACNpjB,MAAO,QAET,CACEojB,KAAM,yBACNpjB,MAAO,iBAKNsE,MAAsB,IAAIitF,MAAa,GAAI,CAAE18E,IAAKzgB,KAAKygB,MAE9D1gB,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,cACP,CAEH9sD,WACE,MAAMotF,EACJ,IAAI9K,MAA4B,IAClC7vF,KAAKkQ,MAAMqV,YAAYo1E,GAEvB,MAAM63G,EACJ,IAAIlpG,MAA8B,CAChC7oF,IAAKzgB,KAAKygB,IACVm6E,OAAQC,MAAc59E,UAE1Bjd,KAAKkQ,MAAMqV,YAAYitL,GAEvBxyM,KAAKkQ,MAAMgV,KAAK,CACd,CACE7G,KAAM,CAAEnM,GAAI,GACZ1O,KAAM,UACN8lF,SAAU,CACR9lF,KAAM,QACN0iF,YAAa,EAAC,GAAK,OAErBlkC,WAAY,YACZ3qB,WAAY,CACVnlB,GAAI,EACJ8c,KAAM,SACN0kD,YAAa,kBAGjB,CACEr1D,KAAM,CAAEnM,GAAI,GACZ1O,KAAM,UACN8lF,SAAU,CACR9lF,KAAM,QACN0iF,YAAa,EAAC,GAAK,OAErBlkC,WAAY,YACZ3qB,WAAY,CACVnlB,GAAI,EACJ8c,KAAM,SACN0kD,YAAa,kBAGjB,CACEr1D,KAAM,CAAEnM,GAAI,GACZ1O,KAAM,UACN8lF,SAAU,CACR9lF,KAAM,QACN0iF,YAAa,EAAC,GAAK,OAErBlkC,WAAY,YACZ3qB,WAAY,CACVnlB,GAAI,EACJ8c,KAAM,SACN0kD,YAAa,kBAGjB,CACEr1D,KAAM,CAAEnM,GAAI,GACZ1O,KAAM,UACN8lF,SAAU,CACR9lF,KAAM,aACN0iF,YAAa,CACX,EAAC,GAAK,MACN,EAAC,KAAO,MACR,EAAC,KAAO,QAGZlkC,WAAY,YACZ3qB,WAAY,CACVnlB,GAAI,EACJ8c,KAAM,SACN0kD,YAAa,kBAGjB,CACEr1D,KAAM,CAAEnM,GAAI,GACZ1O,KAAM,UACN8lF,SAAU,CACR9lF,KAAM,UACN0iF,YAAa,CACX,CACE,EAAC,GAAK,MACN,EAAC,GAAK,IACN,EAAC,KAAO,SAIdlkC,WAAY,YACZ3qB,WAAY,CACVnlB,GAAI,EACJ8c,KAAM,SACN0kD,YAAa,oBAKnB1zE,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTpT,OAAQ4S,IACe,GAI/Br2B,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,WAEPX,UAAWwzB,IACV,MAAMosB,GAAQziD,KAAKq6D,aAAawkD,YAAY,CAC1CjzG,MAAO,eACP6X,OAAQ4S,EACRijB,UAAW,CACTusC,SAAU,KAEZriC,SAAU,CACR08D,YAAa,CACX39G,IAAK,yCACLkhB,OAAQ,mBAIdzjB,KAAKygB,IAAIu7C,SAASvZ,IAClBziD,KAAKkQ,MAAM+wF,UAAUx+C,IACrBk4C,EAAgBl1E,WAChB+sL,EAAkB/sL,UAAQ,EAEhC,CAEAvX,cACElO,KAAKkQ,MAAM6D,SACb,4CAlLWgmP,GAAmB34P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAnBo0P,EAAmBzrP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4LAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICjC1B1N,MAHN,qBAGMA,CAHyC,yBAGzCA,CAFyC,sBAEzCA,CADyC,WAEvCA,MAAA,uBAEJA,UAEAA,MAAA,wBAGJA,iBATqBA,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAIHrf,QAAgBA,MAAhB,QAAA2N,EAAAmB,MAAgB9O,CAAD,WAAA2N,EAAA8lI,+BDsBjC+3G,IACAC,IAAsBlnP,YAEtB4vB,MAAoB1lB,OAAA,kIAGXkqP,CAAmB,oJE3B1B34P,MAAA,iCAIEA,MAAA,sBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAq1B,SAAAlpB,GAAgB,GAE9BrW,MAAA,sBAGEA,MADF,UACEA,CADyC,eAKvCA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAs6L,WAAU,GAEnBxkM,MAAA,iBACFA,QACAA,MAAA,eAIEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+kP,YAAW,GAEpBjvP,MAAA,kBACFA,QACAA,MAAA,eAMEA,MAAA,cAGNA,6CA/BEA,MADA,OAAAkvP,EACAlvP,CADa,WAAAA,MAAA,IAAAkK,EAAA+5B,QAIGjkC,MAAA,GAAAA,MAAA,QAAAkvP,EAAAtvN,OAAA,IAuBZ5/B,MAAA,GAAAA,MAAA,WAAAkK,EAAA6+N,iBCSL,IAAM6vB,EAAoB,MAA3B,MAAOA,EAwBDt0N,YACAg5E,kBACArkD,aAzBV55C,IAAc,IAAIosG,MAAO,CACvBv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,GAEbysD,WAAW,KAIfptD,KAAuB,CACrBuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,IAGRnc,MAA+B,IAAI5jC,SAAsBC,GAEzDqjC,MAAQ,IAAItjC,SAAwCC,GAEpDmoO,gBAA0B,EAElBqmB,eAERzwP,YACU2lC,EACAg5E,EACArkD,GAFAr6D,KAAA0lC,cACA1lC,KAAA0+G,oBACA1+G,KAAAq6D,cACP,CAEH9sD,WACEvN,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,GACRgsB,WAAW,EACXxrB,SAAS,IACc,GAgD/B,MAAMkK,EA5CkC,CACtC,CACE/R,KAAM,WACNpjB,MAAO,WACP/L,QAAS,CACPykC,UAAWS,KAAW/C,UAExBx+B,KAAM,WACN+K,OAAQ,CACNkS,IAAKzgB,KAAKygB,IACVqxL,mBAAmB,EACnB9vG,aAAc,UACd+vG,gBAAgB,EAChBpG,UAAW,GACXqG,qBAAsB,aACtBx2F,UAAW,IAAItX,KAAc,CAC3B9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,IAAK,EAAG,EAAG,GACnB2zB,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,IAAK,EAAG,EAAG,MAErBwgF,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,IAAK,EAAG,EAAG,KAErBiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,IAAK,EAAG,EAAG,YAM7B,CACEyjB,KAAM,OACNpjB,MAAO,OACP/L,QAAS,CACPykC,UAAWS,KAAW/C,YAKavhB,IAAKxgB,IAC5CD,KAAK0lC,YAAYlG,MAAMv/B,KAEnBkgC,EAAangC,KAAK0lC,YAAYvF,KAClC,GACA,CAACngC,KAAK0lC,YAAYzE,MAAM,CAAEjS,KAAM,QAAU+R,KAG5C/gC,KAAKwwP,eAAiBrwN,EAAK9H,QAAQE,aAAa11B,UAAU,KACxD7C,KAAKmqO,gBAAkBhqM,EAAK9H,QAAQ0N,QAGtC/lC,KAAK2lC,MAAMhjC,KAAKw9B,EAClB,CAEAjyB,cACElO,KAAKwwP,eAAeriP,aACtB,CAEAy3L,WACE5lM,KAAKqlC,MAAM1iC,KAAK,CACdqsB,KAAM,QACNs6D,SAAUrxD,KAAKouB,UAAU,CACvB7iD,KAAM,UACN0iF,YAAa,CACX,CACE,EAAC,IAAM,IACP,EAAC,IAAM,IACP,EAAC,GAAK,IACN,EAAC,GAAK,IACN,EAAC,IAAM,SAKjB,CAEAmqK,YACErwP,KAAK2lC,MAAMj/B,MAAM2xB,QAAQ6I,OAC3B,CAEAP,SAAS18B,GACPyB,MAAMuyB,KAAKouB,UAAUpiD,GACvB,4CApIW+1P,GAAoB54P,MAAAuE,MAAAvE,MAAAwE,OAAAxE,MAAAwE,OAAA,+BAApBo0P,EAAoB1rP,UAAA,mBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4cAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID3CzB1N,MAJR,qBAIQA,CAJ6C,yBAI7CA,CAHwC,UAGxCA,CAFmB,sBAEnBA,CADyC,WAEvCA,MAAA,uBAEJA,UAEAA,MAAA,EAAA64P,EAAA,oCAqCN74P,mBA3CuBA,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAKlBrf,cAAA,OAAAA,MAAA,IAAA2N,EAAA42B,wBC2BLinN,IACAC,IAAsBjnP,YAEtBuJ,KACA+wB,KACA4D,KACAv0B,MAAe1J,MACf6J,MAASG,OAAA,6bAGAmqP,CAAoB,sHCrB1B,IAAME,EAAiB,MAAxB,MAAOA,EA2BDx7I,kBACArkD,aACAroD,aA5BHmoP,kBAA4B,EAC5BC,yBAAmC,EACnC35O,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,GAEbysD,WAAW,KAIRptD,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,EACNE,WAAY,aAGd,SAAIhjB,GACF,OAAOh/B,KAAKgS,aAAawB,UAC3B,CAEA,iBAAI0zD,GACF,OAAOlnE,KAAKgS,aAAak1D,eAC3B,CAEAnnE,YACU2+G,EACArkD,EACAroD,GAFAhS,KAAA0+G,oBACA1+G,KAAAq6D,eACAr6D,KAAAgS,eAERhS,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,kBACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,mGAGRM,UAAW4/C,IAAqBziD,KAAKygB,IAAIu7C,SAASvZ,KAiBrDziD,KAAK0+G,kBACF3pC,sBAdwC,CACzCvxE,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN47E,aAAc,qBACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,SAMvBryK,UAAWwzB,KA8CVr2B,KAAKygB,IAAIu7C,SAASh8D,KAAKq6D,aAAawkD,YA7CK,CACvCjzG,MAAO,WACPirB,SAAS,EACTpT,OAAQ4S,GACRmtB,SAAU,CACRC,iBAAkB,CAChBq8C,UAAW,aACX77F,KAAM,CAAC,OAAQ,SACfm3E,OAAQ,CAAC,MAAO,QAChBI,KAAM,CAAC,UAAW,WAClB6e,OAAQ,CAAC,EAAG,GACZn7D,MAAO,CAAC,EAAG,IAEby+E,WAAY,CACVnyF,MAAO,CACLs0E,UAAW,8CACX3pF,MAAO,CACL+8G,UAAW,OACXyI,aAAc,MACdtI,KAAM,0BACN73C,KAAM,CAAEjwE,MAAO,QACfqwH,eAAgB,CAAErwH,MAAO,4BACzBswH,iBAAkB,CAChBtwH,MAAO,4BACP2zB,MAAO,GAETk8C,OAAQ,CAAE7vE,MAAO,OAAQ2zB,MAAO,GAChC6rF,UAAU,EACVoI,QAAS,GACTC,QAAS,GACT/gF,QAAS,CAAC,IAAK,IAAK,IAAK,OAG7BopB,UAAW,CACT8rD,OAAQ,CACNnsC,OAAQ,CACN7vE,MAAO,SACP2zB,MAAO,GAETm7D,OAAQ,SAM2C,EAEnE,4CA5GW6/J,GAAiB94P,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,MAAA,+BAAjBs0P,EAAiB5rP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,kbAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICbxB1N,MAbN,qBAaMA,CATL,yBASKA,CARuC,sBAQvCA,CADD,WAGGA,MADA,UACAA,CADkC,2BAOpCA,QACAA,MAAA,WAaEA,MAZA,6BAYAA,CAPyB,2BAOzBA,CADuB,uBAK/BA,qBApCEA,MAAA,eAAAA,MAAA,GAAAoW,IAIIpW,MAAA,GAIAA,MAJA,MAAA2N,EAAA0R,IAIArf,CAJW,OAAA2N,EAAAoB,KAIX/O,CAHa,uBAAA2N,EAAAqrP,yBAGbh5P,CADiD,6BAO7CA,MAAA,GACAA,MADA,sBACAA,CADyB,MAAA2N,EAAA0R,KAQzBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMArf,cAAA,MAAA2N,EAAA0R,KAIerf,cAAA,MAAA2N,EAAA0R,qBDXbmsO,IAAoBC,IAAwBxhB,MAAYxlO,IAAAC,IAAAC,IAAAC,IAAA2O,IAAAE,KAAAhF,OAAA,yEAEvDqqP,CAAiB,qDEIvB,IAAMG,GAAwB,MAA/B,MAAOA,EAgBShgM,aAfb55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGD5xC,MAAwB,IAAIoqC,KAAe,IAElDv6C,YAAoBs6D,GAAAr6D,KAAAq6D,eAClBr6D,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,SAGTX,UAAW4/C,GAAqBziD,KAAKygB,IAAIu7C,SAASvZ,GACvD,4CA3BW43M,GAAwBj5P,MAAAuE,OAAA,+BAAxB00P,EAAwB/rP,UAAA,wBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,8TAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICrB3B1N,MATV,qBASUA,CALT,yBAKSA,CAJ2C,oBAI3CA,CAHsD,kBAGtDA,CAFW,sBAEXA,CADyC,WAEvCA,MAAA,uBAGNA,YAEEA,MADF,kBACEA,CADa,WAEXA,MAAA,yBASVA,uBAtBEA,MAAA,eAAAA,MAAA,EAAAoW,KAKuBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAQjBrf,MAAA,GACAA,MADA,QAAA2N,EAAAmB,MACA9O,CADe,MAAA2N,EAAA0R,qBDKvBmsO,IACAC,IACAoJ,KAAiBrwP,UAAAD,4BAKR00P,CAAwB,+DEKrBj5P,MAVA,2BAUAA,CAV2D,2BAU3DA,CAT2D,6BAS3DA,CALyB,8BAKzBA,CAD0B,sDATLA,MAAA,QAAAq4L,GACAr4L,cAAA,QAAAq4L,GAEnBr4L,QACAA,MADA,YACAA,CADe,QAAAq4L,GAIfr4L,QACAA,MADA,YACAA,CADe,QAAAq4L,GAIfr4L,QACAA,MADA,QAAAq4L,EACAr4L,CADe,oBCY1B,IAAMk5P,GAAiB,MAAxB,MAAOA,EAgBD57I,kBACArkD,aAhBH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdo2E,mBAAoB,EAAC,KAAW,MAAS,KAAU,KACnDh2E,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTpT,OAAQ4S,KACe,GAiC/Br2B,KAAK0+G,kBACF3pC,sBA3ByC,CAC1CvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,aAAc,UACdgB,QAAS,aACT+1F,qBAAsB,OAExB98F,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV94C,QAAS,CACPwzC,SAAU,oBACVmnB,aAAc,oBACdkzB,WAAY,UAGhBl5B,cAAe,CACbvzB,eAAgB,gBAMjB5hD,UAAWwzB,KAOVr2B,KAAKygB,IAAIu7C,SAASh8D,KAAKq6D,aAAawkD,YANK,CACvCjzG,MAAO,oBACPirB,SAAS,EACTpT,OAAQ4S,GACRw8L,WAAW,IAEgD,GAGjE7yN,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,iBACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,eACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,oBACPirB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,+BACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,mBACPirB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,oBACPirB,SAAS,EACTq5C,cAAe,CACboE,gBAAiB,CACf,CAAEtlD,KAAM,eAAgBpjB,MAAO,gBAC/B,CAAEojB,KAAM,QAASpjB,MAAO,SACxB,CAAEojB,KAAM,eAAgBpjB,MAAO,gBAC/B,CAAEojB,KAAM,QAASpjB,MAAO,WAG5Bk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,2CACLwE,OAAQ,CACN0vD,OAAQ,uBACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,yBACPirB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,wDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,0BACPirB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAgBtDziD,KAAK0+G,kBACF3pC,sBAfsC,CACvCvxE,KAAM,MACNjB,IAAK,sDACL49E,mBAAoB,GACpBp5E,OAAQ,CACN0vD,OAAQ,2CACRC,QAAS,WAUV7zD,UAAWwzB,KASVr2B,KAAKygB,IAAIu7C,SAASh8D,KAAKq6D,aAAawkD,YARW,CAC7CjzG,MAAO,cACP6X,OAAQ4S,GACRo5C,SAAU,CACRltE,IAAK,sGACLwvE,QAAQ,KAGiD,EAEnE,4CAvMWuoL,GAAiBl5P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAjB20P,EAAiBhsP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,sdAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDvCpB1N,MATV,qBASUA,CALT,yBAKSA,CAJmC,oBAInCA,CAHsD,kBAGtDA,CAFW,sBAEXA,CADyC,WAEvCA,MAAA,uBAGNA,YAIMA,MAHN,kBAGMA,CAHS,UAGTA,CAFsC,gBAEtCA,CADsC,uBAQpCA,MAAA,GAAAm5P,GAAA,yBAAAn5P,OAsBdA,2BA3CEA,MAAA,eAAAA,MAAA,EAAAoW,KAKuBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAQfrf,MAAA,GAIAA,MAJA,MAAA2N,EAAA0R,IAIArf,CAJW,SAAA2N,EAAA0R,IAAAq/B,OAIX1+C,CAHqB,iCAGrBA,CAFqC,gBAErCA,CADmB,wCCgB7BwrP,IACAC,IACAoJ,KAAiBrwP,UAAAD,YAEjB2vC,IAAc3vC,iBAGd0vK,MAAuB1vK,sBAId20P,CAAiB,sCCZvB,IAAME,GAAkB,MAAzB,MAAOA,EAeD97I,kBACArkD,aAfH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACPirB,SAAS,EACTwrB,WAAW,EACX5+B,OAAQ4S,KACe,GAI/Br2B,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,6BACPskE,cAAe,CACbjiE,SAAS,GAEX60C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,wDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,yBACPskE,cAAe,CACbj7D,KAAM,wDAER6tC,cAAe,CACbt/C,KAAM,MACNjB,IAAK,wDACLwE,OAAQ,CACN0vD,OAAQ,cACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,wBACPskE,cAAe,CACb3tE,IAAK,moPAEPugD,cAAe,CACbt/C,KAAM,MACNjB,IAAK,wDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,oCACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,mBACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,oBACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,+BACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,mBACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,0BACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN0vD,OAAQ,aACRC,QAAS,YAId7zD,UAAW4/C,IAAsBziD,KAAKygB,IAAIu7C,SAASvZ,KAgBtDziD,KAAK0+G,kBACF3pC,sBAfsC,CACvCvxE,KAAM,MACNjB,IAAK,sDACL49E,mBAAoB,GACpBp5E,OAAQ,CACN0vD,OAAQ,2CACRC,QAAS,WAUV7zD,UAAWwzB,KASVr2B,KAAKygB,IAAIu7C,SAASh8D,KAAKq6D,aAAawkD,YARW,CAC7CjzG,MAAO,cACP6X,OAAQ4S,GACRo5C,SAAU,CACRltE,IAAK,sGACLwvE,QAAQ,KAGiD,EAEnE,4CAvKWyoL,GAAkBp5P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAlB60P,EAAkBlsP,UAAA,iBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,6UAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC7BzB1N,MAPN,qBAOMA,CAHL,yBAGKA,CAFwC,sBAExCA,CADyC,WAEvCA,MAAA,uBAEJA,UAEAA,MAAA,iBACEA,MAAA,6BAUNA,mBApBEA,MAAA,eAAAA,MAAA,EAAAoW,KAGmBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMjBrf,MAAA,GAIAA,MAJA,SAAA2N,EAAA0R,IAAAq/B,OAIA1+C,CAJqB,uBAIrBA,CAH0B,yBAG1BA,CAF4B,oCAE5BA,CADwC,0CDY5CwrP,IACAC,IAAsBlnP,YAEtB2vC,IAAc3vC,OAAAkK,OAAA,kIAIL2qP,CAAkB,sCEHxB,IAAMC,GAAmB,MAA1B,MAAOA,EAqBD/7I,kBACArkD,aArBH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,GAEbysD,WAAW,KAIRptD,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,EACNE,WAAY,aAGP9xC,MAAsB,IAAIitF,MAAiC,GAAI,CACpE18E,IAAKzgB,KAAKygB,MAGZ1gB,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,EACRgsB,WAAW,EACXxrB,SAAS,IACc,EAGjC,4CAtCW4jO,GAAmBr5P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAnB80P,EAAmBnsP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,wMAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC1B1B1N,MAPN,qBAOMA,CAHL,yBAGKA,CAFyC,sBAEzCA,CADyC,WAEvCA,MAAA,uBAEJA,UAEAA,MAAA,oBAEJA,iBAXEA,MAAA,eAAAA,MAAA,EAAAoW,KAGmBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAIPrf,QAAsBA,MAAtB,QAAA2N,EAAAmB,MAAsB9O,CAAD,MAAA2N,EAAA0R,qBDcnCmsO,IACAC,IACA/+H,MACA6iB,MACAiE,OAAiB/kI,OAAA,iMAGR4qP,CAAmB,sCEezB,IAAMC,GAAqB,MAA5B,MAAOA,EAeDh8I,kBACArkD,aAfH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,GACRgsB,WAAW,EACXxrB,SAAS,IACc,GA0D/B72B,KAAK0+G,kBACF3pC,sBAnD4B,CAC7BvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CAAE5kD,KAAM,oBAAqB0uD,MAAO,4BACpC,CAAE1uD,KAAM,mBAAoBs6J,uBAAuB,GACnD,CAAEt6J,KAAM,UAAWrT,OAAQ,CAAC,eAAa,cAE3Cy8D,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPisF,QAAS,KACTjsF,QAAS,CACP,CACEwzC,SAAU,oBACVmnB,aAAc,oBACdkzB,WAAY,SAEd,CACEr6C,SAAU,aACVsrB,aAAc,WACduuB,aAAc,qeAqBrB7tG,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,wDACP6X,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,SACP2zB,MAAO,UAIgB,GA+BrCl/B,KAAK0+G,kBACF3pC,sBA5BwC,CACzCvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExB98F,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,4BACPE,IAAK,8BAGTh/B,QAAS,4BACTC,QAAS,4BACTC,SAAU,QAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,kCACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,MACP2zB,MAAO,UAIgB,GAsCrCl/B,KAAK0+G,kBACF3pC,sBAnC4C,CAC7CvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,4BACPE,IAAK,8BAGTh/B,QAAS,4BACTC,QAAS,4BACTC,SAAU,SAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,mCACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,OACP2zB,MAAO,UAIgB,GAuCrCl/B,KAAK0+G,kBACF3pC,sBApCiD,CAClDvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,4BACPE,IAAK,4BACL0sE,cAAe,SAGnB1rG,QAAS,4BACTC,QAAS,4BACTC,SAAU,QAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,kCACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,SACP2zB,MAAO,UAIgB,GAuCrCl/B,KAAK0+G,kBACF3pC,sBApCgD,CACjDvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,4BACPE,IAAK,4BACL0sE,cAAe,SAGnB1rG,QAAS,4BACTC,QAAS,4BACTC,SAAU,QAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,kCACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,QACP2zB,MAAO,UAIgB,GAsCrCl/B,KAAK0+G,kBACF3pC,sBAnCoD,CACrDvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,iBACPE,IAAK,UAGTh/B,QAAS,4BACTC,QAAS,4BACTC,SAAU,QAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,qDACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,QACP2zB,MAAO,UAIgB,GAsCrCl/B,KAAK0+G,kBACF3pC,sBAnC4D,CAC7DvxE,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN47E,aAAc,8BACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,kBAAcn8E,EACdkzK,qBAAsB,OAExBthG,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV41C,qBAAsBvF,MAAsB3uF,IAC5CwF,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,sBACP40E,gBAAgB,IAGpB1zG,QAAS,4BACTC,QAAS,4BACTC,SAAU,QAKTrvE,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,kDACPsG,GAAI,IACJuR,OAAQ4S,GACRlgB,MAAO,IAAIg6D,KAAM,CACf4b,MAAO,IAAI6wE,IAAO,CAChBviE,OAAQ,EACR7e,KAAM,IAAIshF,IAAK,CACbvxJ,MAAO,UAET6vE,OAAQ,IAAIyhF,IAAO,CACjBtxJ,MAAO,MACP2zB,MAAO,UAIgB,GAgCrCl/B,KAAK0+G,kBACF3pC,sBA7BqC,CACtCvxE,KAAM,MACNjB,IAAK,sDACL8vE,yBAAyB,EACzBtrE,OAAQ,CACN0vD,OAAQ,8BACRC,QAAS,SAEXkd,aAAc,CACZ,CACE5kD,KAAM,mBACN0uD,MAAO,wBACPq0B,qBAAsBvF,MAAsBK,OAGhDz0B,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV94C,QAAS,CACPwzC,SAAU,SACVmnB,aAAc,mBACd8yB,MAAO,sBACPE,IAAK,uBAEPe,qBAAsBvF,MAAsBK,QAM7ChqG,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,uBACP6X,OAAQ4S,KACoB,GAsJpCr2B,KAAK0+G,kBACF3pC,sBA/I8C,CAC/CvxE,KAAM,MACNjB,IAAK,kDACLigF,OAAQ,kDACRz7E,OAAQ,CACN0vD,OAAQ,gBACRC,QAAS,SAEX0hB,WAAY,CACVznC,SAAS,EACTwrB,UAAU,EACV2c,YAAa,CACXC,aAAc,aACdu7E,MAAO,EACPtzH,OAAQ,CACN,CAAEp1B,MAAO,uBAAwBojB,KAAM,WAAYyxC,IAAK,CAAC,SAE3DwyC,QAAS,CACP,CACE/gG,GAAI,MACJtG,MAAO,aACP0jG,QAAS,KACTilF,UAAU,EACVjmL,UAAW,CACT,CACE1C,MAAO,sBACP+kC,SAAS,EACT9iC,QAAS,gCACTwV,QAAS,CACPisF,QAAS,KACTjsF,QAAS,CACP,CACEwzC,SAAU,oBACVmnB,aAAc,SACdkzB,WAAY,eAEd,CACEr6C,SAAU,oBACVmnB,aAAc,SACdkzB,WAAY,YAKpB,CACEtlG,MAAO,8BACP+kC,SAAS,EACT9iC,QAAS,gCACTwV,QAAS,CACPisF,QAAS,MACTjsF,QAAS,CACP,CACEwzC,SAAU,uBACVmnB,aAAc,SACdkzB,WAAY,eAEd,CACEr6C,SAAU,uBACVmnB,aAAc,SACdkzB,WAAY,gBAS5Bl4B,WAAY,CACVD,aAAc,WACdu7E,MAAO,EACPtzH,OAAQ,CACN,CACEp1B,MAAO,2BACPojB,KAAM,eACNyxC,IAAK,CAAC,SAGVwyC,QAAS,CACP,CACE/gG,GAAI,MACJtG,MAAO,sBACP0jG,QAAS,KACThhG,UAAW,CACT,CACE1C,MAAO,mBACP+kC,SAAS,EACT9iC,QAAS,gCACTwV,QAAS,CACPwzC,SAAU,oBACVmnB,aAAc,eACdkzB,WAAY,qBAGhB,CACEtlG,MAAO,qBACP+kC,SAAS,EACT9iC,QAAS,gCACTwV,QAAS,CACPwzC,SAAU,oBACVmnB,aAAc,eACdkzB,WAAY,uBAGhB,CACEtlG,MAAO,+BACP+kC,SAAS,EACTplC,MAAO,UACPsC,QAAS,gCACTwV,QAAS,CACPwzC,SAAU,oBACVmnB,aAAc,eACdkzB,WAAY,kDAGhB,CACEtlG,MAAO,kBACP+kC,SAAS,EACTplC,MAAO,UACPsC,QAAS,gCACTwV,QAAS,CACPwzC,SAAU,oBACVmnB,aAAc,eACdkzB,WAAY,8CAOxBa,qBAAsBvF,MAAsBE,OAE9Cn0B,UAAW,CACToK,aAAc,gBACdrK,kBAAmB,WACnB2G,YAAa,IACbroB,QAAS,QACTunB,aAAc,UACd+2F,qBAAsB,SAMvBryK,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MACE,+DACF6X,OAAQ4S,KACoB,EAGtC,4CAzoBWqkO,GAAqBt5P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAArB+0P,EAAqBpsP,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,kVAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICvCxB1N,MATV,qBASUA,CALT,yBAKSA,CAJwC,oBAIxCA,CAHsD,kBAGtDA,CAFW,sBAEXA,CADyC,WAEvCA,MAAA,uBAGNA,YAGIA,MAFJ,kBAEIA,CAFW,UAEXA,CADwD,iBAEtDA,MAAA,gCAOZA,yBArBEA,MAAA,eAAAA,MAAA,EAAAoW,KAKuBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAOQrf,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,SAAA2N,EAAA0R,IAAAq/B,wBDuB5C8sM,IACAC,IACAoJ,KAAiBrwP,UAAAD,YAEjB2vC,IAAc3vC,gBAIL+0P,CAAqB,KEtBrBC,GAAmB,MAA1B,MAAOA,EAgBDj8I,kBACArkD,aAhBH55C,IAAc,IAAIosG,MAAO,CAC9Bh7G,SAAS,EACTylB,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,cACP,CAEH9sD,WACEvN,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,EACRgsB,WAAW,EACXxrB,SAAS,IACc,EAGjC,CAEA6c,kBAkDE1zC,KAAKygB,IAAI5O,QAAQ8uI,YACf,CAlDwB,CACxBn9I,KAAMwpF,MACNhrC,WAAY,YACZ3jC,KAAM,CACJnM,GAAI,GAENmlB,WAAY,GACZiyD,SAAU,CACR9lF,KAAM,QACN0iF,YAAa,EAAC,GAAK,QAIG,CACxB1iF,KAAMwpF,MACNhrC,WAAY,YACZ3jC,KAAM,CACJnM,GAAI,GAENmlB,WAAY,GACZiyD,SAAU,CACR9lF,KAAM,aACN0iF,YAAa,CACX,EAAC,GAAK,MACN,EAAC,KAAO,MACR,EAAC,KAAO,SAKY,CACxB1iF,KAAMwpF,MACNhrC,WAAY,YACZ3jC,KAAM,CACJnM,GAAI,GAENmlB,WAAY,GACZiyD,SAAU,CACR9lF,KAAM,UACN0iF,YAAa,CACX,CACE,EAAC,GAAK,MACN,EAAC,GAAK,IACN,EAAC,KAAO,WAQd2U,MAAcj9E,KAElB,4CA3FW+8O,GAAmBv5P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAnBg1P,EAAmBrsP,UAAA,kBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qKAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICvB1B1N,MAHN,qBAGMA,CAHyC,yBAGzCA,CAFyC,sBAEzCA,CADyC,WAEvCA,MAAA,uBAIRA,qBANqBA,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,qBDoBbmsO,IAAoBC,IAAsBlnP,aAAAkK,OAAA,yEAEzC8qP,CAAmB,sCEKzB,IAAMC,GAAiB,MAAxB,MAAOA,EAcSvgM,aAbb55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YAAoBs6D,GAAAr6D,KAAAq6D,eAClBr6D,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,kBACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,MACNjB,IAAK,gGACLu3E,YAAa,eAGhBj3E,UAAW4/C,GAAqBziD,KAAKygB,IAAIu7C,SAASvZ,IAErDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,cACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,sDACLwE,OAAQ,CACN0vD,OAAQ,2CACRC,QAAS,SAEXojB,YAAa,eAGhBj3E,UAAW4/C,GAAsBziD,KAAKygB,IAAIu7C,SAASvZ,IAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,oBACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,yCACLwE,OAAQ,CACN0vD,OAAQ,iBACRC,QAAS,SAEXojB,YAAa,eAGhBj3E,UAAW4/C,GAAsBziD,KAAKygB,IAAIu7C,SAASvZ,IAEtDziD,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,eACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,mDACLwE,OAAQ,CACN+4C,OAAQ,WACR8W,QAAS,SAEXkjB,YAAa,eAGhBj3E,UAAW4/C,GAAsBziD,KAAKygB,IAAIu7C,SAASvZ,GACxD,4CAxEWm4M,GAAiBx5P,MAAAuE,OAAA,+BAAjBi1P,EAAiBtsP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,4aAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICtBpB1N,MATV,qBASUA,CALT,yBAKSA,CAJmC,oBAInCA,CAHsD,kBAGtDA,CADD,sBACCA,CAD0C,WAGxCA,MADA,UACAA,CADkC,2BAOpCA,QACAA,MAAA,WAaEA,MAZA,6BAYAA,CAPyB,4BAOzBA,CADuB,wBAG5BA,YACDA,MAAA,oBAAgBA,MAAA,mBAGtBA,qBAlCEA,MAAA,eAAAA,MAAA,EAAAoW,KAKwBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAKvB/O,MAAA,GACAA,MADA,sBACAA,CADyB,MAAA2N,EAAA0R,KAQzBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMArf,cAAA,MAAA2N,EAAA0R,KAIerf,cAAA,MAAA2N,EAAA0R,KAGIrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,qBDV7BmsO,IACAC,IACAoJ,KAAiBrwP,UAAAD,8BAEjBgpO,OAAc9+N,OAAA,qGAGL+qP,CAAiB,2HEbpBx5P,MADF,QACEA,CADoC,QAElCA,MAAA,qBACAA,MAAA,YAAwCA,MAAA,GAG1CA,UACAA,MAAA,2BACFA,6CAL4CA,MAAA,GAAAA,MAAAkK,EAAA4kP,SAAA2K,IAIrBz5P,cAAA,UAAAy5P,8BARzBz5P,MAAA,GACEA,MAAA,EAAA05P,GAAA,0CAAyB15P,cAAA,UAAA25P,IC6C1B,IAAMC,GAAiB,MAAxB,MAAOA,EAmBDt8I,kBACArkD,aAnBHs2K,UAAwC,IAAI5uO,IACjD,IAGK0e,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,EACRgsB,WAAW,EACXxrB,SAAS,IACc,GAI/B72B,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,MACNjB,IAAK,kDACLwgD,WAAW,EACXh8C,OAAQ,CACN+4C,OAAQ,+BACR8W,QAAS,WAGZ/zD,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,IACe,GAI/Br2B,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,MACNjB,IAAK,kDACLwgD,WAAW,EACX2tB,YAAaW,MAAY0/E,SACzBp3E,gBAAiBC,MAAgBo3E,OACjCjqJ,OAAQ,CACN+4C,OAAQ,WACR8W,QAAS,WAGZ/zD,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,kCACP6X,OAAQ4S,IACe,GAI/Br2B,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,+BACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,kDACLwgD,WAAW,EACX2tB,YAAaW,MAAY0/E,SACzBp3E,gBAAiBC,MAAgBo3E,OACjCmF,UAAW,CACT,CACE5zJ,IAAK,+QAGT60J,oBAAoB,EACpBrwJ,OAAQ,CACN+4C,OAAQ,kBACR8W,QAAS,YAId/zD,UAAW4/C,GAAsBziD,KAAKygB,IAAIu7C,SAASvZ,IAEtDziD,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACNu/C,WAAW,EACX6wB,aAAc,CACZ,CAAE5kD,KAAM,OAAQ0uD,MAAO,cACvB,CAAE1uD,KAAM,cAAe0uD,MAAO,wBAGjC76E,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,eACP6X,OAAQ4S,KAGZr2B,KAAK67D,YAAYxlC,EAAU,GAG/Br2B,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,uCACPk3C,cAAe,CACbt/C,KAAM,MACNjB,IAAK,oHACLwgD,WAAW,EACX2tB,YAAaW,MAAY0/E,SACzBp3E,gBAAiBC,MAAgBo3E,OACjCmF,UAAW,CACT,CACE5zJ,IAAK,+QAGT60J,oBAAoB,GAEtBl3C,YAAa,CACX39G,IAAK,4CACLkhB,OAAQ,cAGX5gB,UAAW4/C,GAA2BziD,KAAKygB,IAAIu7C,SAASvZ,GAC7D,CAEAoZ,YAAYxlC,GACV,MAAM4kO,EAAoC,IAAItuK,KAAU,CACtD39D,KAAM,WACNs6D,SAAU,IAAI4xK,KAAa,CACzBzqL,MAAiB,EAAC,GAAK,MAAO,YAAa,aAC3CA,MAAiB,EAAC,KAAO,MAAO,YAAa,aAC7CA,MAAiB,EAAC,KAAO,MAAO,YAAa,iBAI3C0qL,EAA+B,IAAIxuK,KAAU,CACjD39D,KAAM,WACNs6D,SAAU,IAAI3nC,KACZ8uB,MAAiB,EAAC,GAAK,MAAO,YAAa,gBAIzC2qL,GAAiC,IAAIzuK,KAAU,CACnD39D,KAAM,WACNs6D,SAAU,IAAIg0B,MAAU,CACtB,CACE7sC,MAAiB,EAAC,GAAK,MAAO,YAAa,aAC3CA,MAAiB,EAAC,GAAK,IAAK,YAAa,aACzCA,MAAiB,EAAC,KAAO,MAAO,YAAa,kBAKnDp6C,EAAWgrB,GAAGwa,YAAY,CAACo/L,EAAUE,EAAUC,IACjD,CAEAC,mBAAmBj8K,GACjB,MAAM70E,EAAsB60E,EAAQ70E,SAChCA,EAASX,QAAUW,EAAS,KAC9BvK,KAAK2wO,UAAUhuO,KAAK4H,GACpBvK,KAAKygB,IAAIqhH,oBAAoB6e,YAAYp2I,EAAUswF,MAAcj9E,MAErE,CAEAsyO,SAAS7mN,GACP,SAAO9qB,MAAe8qB,EACxB,4CAxLW2xN,GAAiB55P,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAjBq1P,EAAiB1sP,UAAA,gBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4UAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID5D1B1N,MAFJ,qBAEIA,CAF6D,yBAE7DA,CADyC,uBAOvCA,MAAA,iBAAAqW,IAAA,OAAS1I,EAAAssP,mBAAA5jP,GAA0B,GAEnCrW,MAAA,WACEA,MAAA,uBAEJA,UAEAA,MAAA,iBACEA,MAAA,EAAAk6P,GAAA,uCAaNl6P,mBA7B6CA,MAAA,eAAAA,MAAA,EAAAoW,KAGvCpW,MAAA,GAIAA,MAJA,MAAA2N,EAAA0R,IAIArf,CAJW,OAAA2N,EAAAoB,KAIX/O,CAHa,oBAOMA,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAKJrf,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,EAAA4hO,4BCkCjBic,IACAC,IAAsBlnP,YAEtBirO,MACAlc,MAAc9uN,KACd0vC,IACAnmC,KACAsF,KAAK9O,MAEL+J,MAASG,OAAA,kIAGAmrP,CAAiB,sOCpD9B55P,MAAA,mCAUEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAiwP,YAAW,GAEpBn6P,MAAA,UAAMA,MAAA,wBAA2DA,QACjEA,MAAA,cAAUA,MAAA,iBACZA,kCALEA,MADA,WAAAkK,EAAA8+G,QACAhpH,CADoB,aAAAA,MAAA,uDAIdA,MAAA,GAAAA,YAAA,2EAIRA,MAAA,mCAYEA,MAAA,UAAMA,MAAA,wBAA2DA,QACjEA,MAAA,cAAUA,MAAA,iBACZA,2CAJEA,MAFA,WAAAkK,EAAA8+G,QAEAhpH,CAFoB,aAAAA,MAAA,sDAEpBA,CAD2E,oBAAAo6P,GAGrEp6P,MAAA,GAAAA,YAAA,0FAKNA,MAAA,cAGEA,MAAA,yBAAAq6P,EAAAr6P,MAAAkP,GAAAC,UAAAjF,GAAAlK,QAAA,OAAAA,MAASkK,GAAAiwP,UAAAE,GAAgB,GAEzBr6P,MAAA,GACFA,8CADEA,cAAA,IAAAkK,EAAAowP,eAAAD,GAAA,gCAIJr6P,MAAA,kEAGEA,MAAA,OAAAA,MAAA,IAAAkK,EAAAqwP,cCZK,IAAMC,GAAN,MAAMA,GA2CFpzN,cACA6jB,KACC5qD,KACAsQ,MACApQ,gBA9CFk6P,cACR,cACIF,GACF,OAAO37P,KAAK87P,WACd,CACA,cAAIH,CAAWj1P,GACb1G,KAAK87P,YAAcvgP,MAAMC,QAAQ9U,GAASA,EAAMmD,KAAK,MAAQnD,CAC/D,CAEA,QACIuO,GACF,OAAOjV,KAAKyZ,KACd,CACA,QAAIxE,CAAKvO,GACP1G,KAAKyZ,MAAQ8B,MAAMC,QAAQ9U,GAASA,EAAMmD,KAAK,MAAQnD,CACzD,CACQq1P,uBAAiC,MAClCjyN,0BAA6ClmC,OAClD5D,KAAK+7P,wBAGP,yBACIC,GACF,OAAOh8P,KAAK+7P,sBACd,CACA,yBAAIC,CAAsBt1P,GACxB1G,KAAK+7P,uBAAyBr1P,EAC9B1G,KAAK8pC,0BAAyBlmC,OAAG8C,EACnC,CAESu1P,kBAEFC,iBACCziP,MAAgB,iCAChBqiP,YAEAK,cACAC,aAEDhyI,SAAU,EAEjBrqH,YACSyoC,EACA6jB,EACC5qD,EACAsQ,EACApQ,IAJD3B,KAAAwoC,gBACAxoC,KAAAqsD,OACCrsD,KAAAyB,OACAzB,KAAA+R,QACA/R,KAAA2B,mBAER3B,KAAK27P,WAAa37P,KAAK2B,gBAAgB4pB,UAAUshB,QAC/C,wCAEF7sC,KAAK67P,cAAgB77P,KAAKwoC,cAAcs6B,aACxC,MAAMu5L,GAAgBr8P,KAAK67P,cAAcjlM,QACzC52D,KAAKk8P,iBACHG,IAAe7F,KAAO6F,IAAe/5L,KAAO1L,MAAQ0L,IACtDtiE,KAAKm8P,cAAgBn8P,KAAK67P,cAAcl2F,SAASpjK,IACjDvC,KAAKo8P,aACHp8P,KAAK67P,cAAcS,OAAO/5P,IAEzBvC,KAAK67P,cAAcS,OAAeC,QACvC,CAEAhvP,WACMvN,KAAKqsD,KAAKzpD,eAAiB5C,KAAK67P,cAAc/9M,SAASv7C,IACzDvC,KAAKyB,KAAKvB,IAAIF,KAAKm8P,eAAet5P,UAAWo8C,IAE3Cj/C,KAAKi8P,kBADUh9M,EACiBu9M,OAChCx8P,KAAK+R,MAAM4K,eAAa,GAG1B3c,KAAKqsD,KAAKzpD,gBACT5C,KAAK67P,cAAc/9M,SAASv7C,KAC7BvC,KAAK67P,cAAcS,OAAOG,iBAE1Bz8P,KAAKi8P,kBAAoBj8P,KAAK67P,cAAcS,OAAOG,eAEvD,CAEAlB,UAAUmB,GACR18P,KAAKoqH,SAAU,EACf,MAAM7nH,EAAMm6P,EACR18P,KAAKo8P,aAAeM,EAAQ,IAC5B18P,KAAKo8P,aAAep8P,KAAKi8P,kBAAkB,GAAK,IACpDj8P,KAAKyB,KACFvB,IAAIqC,EAAK,CACRqmC,aAAc,SAEf/lC,UAAU,KACT7C,KAAKoqH,SAAU,EACf7iH,OAAOgR,KAAKhW,EAAK,UACjBvC,KAAK+R,MAAM4K,eAAa,EAE9B,CAEA++O,eAAe1sO,GAEb,MAAM/P,GADN+P,EAAOA,EAAK1lB,MAAM,KAAKO,KAAK,MACTnB,QAAQ,KAC3BsmB,OAAOA,EAAKnL,MAAM,EAAG5E,EAEvB,4CApGW28O,IAAkBx6P,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,mBAAA0E,OAAA,+BAAlB81P,GAAkBttP,UAAA,qBAAAC,OAAA,CAAAotP,WAAA,aAAA1mP,KAAA,OAAA+mP,sBAAA,wBAAAC,kBAAA,qBAAAxtP,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,84BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID1C/B1N,MADA,MACAA,CADO,4BA0BPA,MAhBA,EAAAu7P,GAAA,eAgBAv7P,CALC,EAAAw7P,GAAA,gBAqBDx7P,MAAA,qBACEA,MAAA,EAAAy7P,GAAA,gBAOFz7P,QAEAA,MAAA,EAAA07P,GAAA,yBAOA17P,MAAA,mDArDEA,cAAA,yBAAA2N,EAAA+6B,wBAKC1oC,cAAA,OAAA2N,EAAAs9C,KAAAzpD,eAAAmM,EAAAktP,mBAAA,IAAAltP,EAAAktP,kBAAAryP,QAgBAxI,cAAA,OAAA2N,EAAAs9C,KAAAzpD,eAAAmM,EAAAktP,mBAAAltP,EAAAktP,kBAAAryP,OAAA,GAiBmBxI,MAAA,GAAAA,MAAA,UAAA2N,EAAAktP,mBASnB76P,cAAA,YAAA2N,EAAA4sP,YAQDv6P,cAAA,OAAAA,MAAA,IAAA2N,EAAAkG,KAAA7T,MAAA,EAAAoW,GAAAzI,EAAAmtP,oCC7BE/xN,MACAh7B,KACAI,MAAexJ,MACfsJ,MAAgBrJ,MAChBwJ,MAAamF,MACbD,MAAaG,kBACbJ,KACA+E,MACA7J,MAAiBmF,OAAAjF,OAAA,0MAGR+rP,MAAkBn5N,OAAA,IAtB9B8U,OAAc,CACbvoB,KAAM,QACNpjB,MAAO,8BACPD,KAAM,UACP,EAAC03B,GAAAC,IAAA,qBA6DwBnjC,MACTqB,KACCqhE,MACCt/B,MACUihC,SA/ChBo3L,gCC7BN,IAAMmB,GAAQ,MAAf,MAAOA,EAoBDp/L,WACAq/L,kBACA7gN,eACA3T,cArBV,uBAAI+hL,GACF,OAAOvqN,KAAKi9P,kBACd,CAEA,uBAAI1yC,CAAoB7jN,GACtB1G,KAAKi9P,mBAAqBv2P,CAC5B,CACQu2P,mBAKR,OAAIx8O,GACF,OAAOzgB,KAAKouH,IACd,CACQA,KAERruH,YACU49D,EACAq/L,EACA7gN,EACA3T,IAHAxoC,KAAA29D,aACA39D,KAAAg9P,oBACAh9P,KAAAm8C,iBACAn8C,KAAAwoC,iBAERxoC,KAAKouH,KAAO,IAAIvB,MACd,CACEv1F,SAAU,CACRimC,WAAW,EACX+kE,YAAa,CACXxxH,WAAW,KAIjB9Q,KAAKm8C,eACLn8C,KAAKwoC,eAGPxoC,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,IAC9B,4CAvCWs8O,GAAQ37P,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAA,iCAARk3P,EAAQ17P,QAAR07P,EAAQz7P,UAAAC,WAFP,gBAEDw7P,CAAQ,KCFRG,GAAY,MAAnB,MAAOA,EAIX,gBAAIxD,GACF,OAAO15P,KAAKm9P,aACd,CACQA,cAKAC,mBAAqB,IAAIl+O,IAEjCnf,YAAYoG,GACVnG,KAAKm9P,cAAgB,IAAI9xP,KAAY,IAErClF,EAAYrE,cAAce,UAAU,KAClC7C,KAAKq9P,yBAAuB,EAEhC,CAOAC,qBAAqB99B,GACnB,OAAOx/N,KAAKo9P,mBAAmBl9P,IAAIs/N,EAAQttN,GAC7C,CAOAqrP,qBAAqB/9B,EAAkBtvN,GACrClQ,KAAKo9P,mBAAmB/8P,IAAIm/N,EAAQttN,GAAchC,EACpD,CAKAmtP,0BACEr9P,KAAKo9P,mBAAmBt2P,OAC1B,4CA7CWo2P,GAAY97P,MAAAuE,MAAA,iCAAZu3P,EAAY77P,QAAZ67P,EAAY57P,UAAAC,WAFX,gBAED27P,CAAY,8BCZzB97P,MAAA,yDAKEA,MAHA,UAAAkK,EAAAk0N,QAGAp+N,CAHmB,QAAAo8P,EAGnBp8P,CAFe,MAAAkK,EAAAmV,IAEfrf,CADW,uBAAAkK,EAAA47N,uBCsCN,IAAMu2B,GAAN,MAAMA,GA8BD94B,eACA+4B,aACAC,SACAx3P,YAhCVq5N,QAMAo+B,OAAS,IAAI77P,SACXC,GAMM67P,UAKC32B,sBAAgC,EAMzC,OAAIzmN,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACU4kO,EACA+4B,EACAC,EACAx3P,GAHAnG,KAAA2kO,iBACA3kO,KAAA09P,eACA19P,KAAA29P,WACA39P,KAAAmG,aACP,CAKHoH,WAGE,MAAMuwP,EAFe99P,KAAK09P,aAAahE,aAETh1O,UAAUrC,SACrCkE,IAA4D,IAA1BA,EAAO/V,MAAMgY,UAGlDxoB,KAAK69P,aAAY56O,MAAc,CAAC66O,EADV99P,KAAKmG,YAAYrE,gBACmBe,UACxD,EAAE0jB,EAAQ64C,OAERp/D,KAAKw/N,QADWj5M,EAAOvI,OAEvBhe,KAAKu/N,iBAAiBv/N,KAAKw/N,QAAO,EAGxC,CAKAtxN,cACElO,KAAK69P,UAAU1vP,aACjB,CAOQoxN,iBAAiBC,GACvB,IAAItvN,EAAQlQ,KAAK09P,aAAaJ,qBAAqB99B,QACrCx9N,IAAVkO,GAKJA,EAAQ,IAAI7E,KAAyB,IACrCrL,KAAK09P,aAAaH,qBAAqB/9B,EAAStvN,GAChDlQ,KAAK2kO,eACFpF,iBAAiBC,GACjBz7N,QAAK6lD,MAAK,IACV/mD,UAAW+wC,IACV1jC,EAAMgV,KAAK0uB,GACX5zC,KAAK49P,OAAOj7P,KAAKuN,EAAK,IAXxBlQ,KAAK49P,OAAOj7P,KAAKuN,EAarB,4CAnFWutP,IAA2Br8P,MAAAuE,OAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,MAAA,+BAA3B23P,GAA2BnvP,UAAA,+BAAAC,OAAA,CAAA24N,qBAAA,wBAAAz4N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,iHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID1CxC1N,MAAA,EAAA28P,GAAA,oDACG38P,MAAA,OAAAA,MAAA,IAAA2N,EAAA6uP,wBCuCSzuP,KAAMk4N,MAAyB33N,MAAS8yB,cAAA,EAAA1yB,gBAAA,KAEvC2tP,MAA2Bh7N,OAAA,IAZvC8U,OAAc,CACbvoB,KAAM,iBACNpjB,MAAO,gCACPutC,OAAQ,aACT,EAAC9V,GAAAC,IAAA,qBAsC0Bu7L,MACFq+B,GACJH,GACGv7P,QAjCZi8P,ICpCN,IAAKO,GAAZ,SAAYA,GACVA,SAAAv7M,MAAA,QACAu7M,EAAAlgN,QAAA,UAFUkgN,CAGZ,CAHA,CAAYA,IAAgB,IAKhBC,GAAZ,SAAYA,GACVA,SAAAz2M,OAAA,SACAy2M,EAAAh4M,OAAA,SAFUg4M,CAGZ,CAHA,CAAYA,IAAgB,IAWrB,IAAMC,GAAiB,MAAxB,MAAOA,EACFC,kBACP,IAAIp8P,IAAgBi8P,GAAiBv7M,OAC9B27M,cACP,IAAIr8P,IAAgBk8P,GAAiBz2M,QAC9Bg8J,eAAiD,IAAIzhN,SAC5DC,GAGFq8P,oBAAoB76P,GAClBxD,KAAKm+P,kBAAkBx7P,KAAKa,EAC9B,CAEA86P,QAAQ/rP,GACNvS,KAAKo+P,cAAcz7P,KAAK4P,EAC1B,CAEAgsP,kBAAkB36C,GAChB5jN,KAAKwjN,eAAe7gN,KAAKihN,EAC3B,4CAnBWs6C,EAAiB,iCAAjBA,EAAiB78P,QAAjB68P,EAAiB58P,UAAAC,WAFhB,gBAED28P,CAAiB,KCJjBM,GAAS,MAAhB,MAAOA,EAUDn0N,YACAo0N,kBAVV,WAAIl0N,GACF,OAAOvqC,KAAKqqC,YAAYE,OAC1B,CAEOm0N,aAAyC,IAAI38P,SAClDC,GAGFjC,YACUsqC,EACAo0N,GADAz+P,KAAAqqC,cACArqC,KAAAy+P,mBACP,CAEHE,0BAA0BC,GAIxB,GAAKA,EAGL,IAA4B,iBAAxBA,EAAexoN,KAAyB,CAC1C,IAAIwtK,EACF5jN,KAAKy+P,kBAAkBj7C,eAAe98M,MACnCk9M,GAMHA,EAAc9jK,OAAS8+M,EAAe/+P,QAAQigD,OAC9C8jK,EAAcwB,mBACZw5C,EAAe/+P,QAAQulN,oBAPzBxB,EAAgB,CACd9jK,OAAQ8+M,EAAe/+P,QAAQigD,OAC/BslK,mBAAoBw5C,EAAe/+P,QAAQulN,oBAO/CplN,KAAKy+P,kBAAkBF,kBAAkB36C,GACzC5jN,KAAKy+P,kBAAkBH,QAAQL,GAAiBh4M,OAClD,CAEIjmD,KAAKuqC,QAAQkM,QAAQmoN,EAAexoN,QACtCp2C,KAAKuqC,QAAQuM,aAAa8nN,EAAexoN,MACzCp2C,KAAK0+P,aAAa/7P,MAAK,GAAI,CAE/B,4CA1CW67P,GAASp9P,MAAAuE,OAAAvE,MAAAwE,IAAA,iCAAT44P,EAASn9P,QAATm9P,EAASl9P,UAAAC,WAFR,gBAEDi9P,CAAS,KCcTK,GAAN,MAAMA,GAgCDl6B,eACA+4B,aACAoB,UACA3iN,eA9BV,SAAIjsC,GACF,OAAOlQ,KAAK09P,aAAahE,YAC3B,CAKSzvB,mBAA6B,EAK7BtB,mBAAgC,GAEzC,qBAAI2B,CAAkBp4N,GACpBlS,KAAKm8C,eAAe97C,IAAI,oBAAqB6R,EAAItL,KAAaulE,QAChE,CAEA,eAAI4yL,GACF,OAAO/+P,KAAK8+P,UAAUv0N,QAAQ4M,6BAA6B,EAC7D,CAEA,YAAI6nN,GACF,OAAOh/P,KAAK8+P,UAAUv0N,QAAQ4M,6BAA6B,EAC7D,CAEAp3C,YACU4kO,EACA+4B,EACAoB,EACA3iN,GAHAn8C,KAAA2kO,iBACA3kO,KAAA09P,eACA19P,KAAA8+P,YACA9+P,KAAAm8C,gBACP,CAKH5uC,WACwB,mBAAlBvN,KAAKg/P,UAAsD,YAArBh/P,KAAK++P,cAC7C/+P,KAAKsqO,kBAAoB,MAGF,IAArBtqO,KAAKkQ,MAAM2R,OACb7hB,KAAK8+N,cAET,CAOA86B,sBAAsBlwO,IACG,IAAnBA,EAAMlB,UAGVxoB,KAAK8+P,UAAUv0N,QAAQuM,aAAa,iBACtC,CAMQgoL,eACN9+N,KAAK2kO,eACF7F,eACA/6N,QAAK6lD,MAAK,IACV/mD,UAAWw8N,IACVr/N,KAAKkQ,MAAMpJ,QACX9G,KAAKkQ,MAAMgV,KACTm6M,EAAS1+M,OACN3gB,KAAKm8C,eAAej8C,IAAI,kBAAoB,IAC9C,EAGT,4CA/EW2+P,IAA2Bz9P,MAAAuE,OAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,MAAA,+BAA3B+4P,GAA2BvwP,UAAA,+BAAAC,OAAA,CAAA07N,kBAAA,oBAAAtB,mBAAA,sBAAAl6N,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6EAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IChCxC1N,MAAA,2BAIEA,MAAA,+BAAAqW,IAAA,OAAuB1I,EAAA6qP,sBAAAniP,GAA6B,GAEtDrW,cAHEA,MAFA,qBAAA2N,EAAA45N,mBAEAvnO,CAFyC,oBAAA2N,EAAAk7N,kBAEzC7oO,CADuC,QAAA2N,EAAAmB,sBD4B7B85N,OAAsBxnM,cAAA,EAAA1yB,gBAAA,KAErB+uP,MAA2Bp8N,OAAA,IAZvC8U,OAAc,CACbvoB,KAAM,UACNpjB,MAAO,gCACPD,KAAM,iBACP,EAAC03B,GAAAC,IAAA,qBAwC0Bu7L,MACFq+B,GACHsB,GACK3zP,QAnCfg0P,oBEVN,IAAMI,GAAN,MAAMA,GACSH,UAApB/+P,YAAoB++P,GAAA9+P,KAAA8+P,WAAuB,CAE3Cr/L,kBACEz/D,KAAK8+P,UAAUv0N,QAAQwM,sBACzB,4CALWkoN,IAA0B79P,MAAAuE,IAAA,+BAA1Bs5P,GAA0B3wP,UAAA,8BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,mDAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICtBvC1N,MAAA,wBAEEA,MAAA,oCAAmB2N,EAAA0wD,iBAAiB,GACrCr+D,wBDiBW0qD,MAAsByT,OAA2B/8B,cAAA,KAEhDy8N,MAA0Bx8N,OAAA,IAZtC8U,OAAc,CACbvoB,KAAM,gBACNpjB,MAAO,iCACPD,KAAM,OACNwtC,OAAQ,oBACT,EAAC9V,GAAAC,IAAA,qBAQ+Bk7N,MADpBS,IECN,IAAMC,GAAN,MAAMA,GAQDJ,UACAnB,SARDwB,0BAAoC,WAE7C,OAAI1+O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACU++P,EACAnB,GADA39P,KAAA8+P,YACA9+P,KAAA29P,UACP,CAEHyB,cACEp/P,KAAK8+P,UAAUv0N,QAAQuM,aAAa,gBACtC,CAEA2V,oBACEzsD,KAAK8+P,UAAUv0N,QAAQuM,aAAa,2BACtC,4CAlBWooN,IAA2B99P,MAAAuE,IAAAvE,MAAAwE,IAAA,+BAA3Bs5P,GAA2B5wP,UAAA,+BAAAC,OAAA,CAAA4wP,0BAAA,6BAAA1wP,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kEAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ICvBxC1N,MAAA,wBAIEA,MADA,yBAAQ2N,EAAAqwP,aAAa,EACrBh+P,CADsB,sCACD2N,EAAA09C,mBAAmB,GAE1CrrD,cAJEA,MAAA,MAAA2N,EAAA0R,oBDmBUmvC,MAAsB8N,OAA2Bl7B,cAAA,KAEhD08N,MAA2Bz8N,OAAA,IAXvC8U,OAAc,CACbvoB,KAAM,iBACNpjB,MAAO,iCACPD,KAAM,UACP,EAAC03B,GAAAC,IAAA,qBAeqBk7N,GACDzB,MATTmC,IEHN,IAAMG,GAAN,MAAMA,iDAAqC,+BAArCA,GAAqC/wP,UAAA,0CAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,sCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCpBlD1N,MAAA,8CDkBYkyD,MAA6BqM,OAAkCn9B,cAAA,KAE9D68N,MAAqC58N,OAAA,IAZjD8U,OAAc,CACbvoB,KAAM,2BACNpjB,MAAO,iCACPD,KAAM,OACNwtC,OAAQ,oBAQGkmN,IERN,IAAMC,GAAkB,MAAzB,MAAOA,EACFC,SAAoC,IAAIx9P,IAAgB,IACxDmqN,WAAuC,IAAInqN,SAClDC,GAEOiqN,aAAyC,IAAIlqN,SACpDC,GAEOw9P,aAAwC,IAAIz9P,SACnDC,GAGFy9P,WAAWhzC,GACTzsN,KAAKu/P,SAAS58P,KAAK8pN,EACrB,CAEAizC,aAAal9O,GACXxiB,KAAKksN,WAAWvpN,KAAK6f,EACvB,CAEAm9O,eAAerzC,GACbtsN,KAAKisN,aAAatpN,KAAK2pN,EACzB,CAEAszC,eAAeC,GACb7/P,KAAKw/P,aAAa78P,KAAKk9P,EACzB,CAEAC,uBACE,MAAO,CACLrzC,QAASzsN,KAAKu/P,SAAS74P,MACvB4lN,YAAatsN,KAAKisN,aAAavlN,MAC/B6lN,UAAWvsN,KAAKksN,WAAWxlN,MAE/B,4CAlCW44P,EAAkB,iCAAlBA,EAAkBj+P,QAAlBi+P,EAAkBh+P,UAAAC,WAFjB,gBAED+9P,CAAkB,KCQlBS,GAAN,MAAMA,GAUDpC,SACAqC,mBAVV,OAAIv/O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,qBAAIw/O,GACF,OAAOjgQ,KAAKggQ,mBAAmBF,sBACjC,CAEA//P,YACU49P,EACAqC,GADAhgQ,KAAA29P,WACA39P,KAAAggQ,oBACP,4CAZQD,IAAyB3+P,MAAAuE,IAAAvE,MAAAwE,IAAA,+BAAzBm6P,GAAyBzxP,UAAA,6BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,YAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCpBtC1N,MAAA,0BAAeA,MAAA,MAAA2N,EAAA0R,oBDkBHs5C,OAAiBv3B,cAAA,KAEhBu9N,MAAyBt9N,OAAA,IAXrC8U,OAAc,CACbvoB,KAAM,WACNpjB,MAAO,iCACPD,KAAM,WACP,EAAC03B,GAAAC,IAAA,qBAiBoBy5N,GACUuC,MAXnBS,mBEJN,IAAMG,GAAY,MAAnB,MAAOA,EAOD92M,eACA/e,YACAy0N,UACAn9P,gBANV26C,SAA6C,IAAIv6C,SAAgBC,GAEjEjC,YACUqpD,EACA/e,EACAy0N,EACAn9P,IAHA3B,KAAAopD,iBACAppD,KAAAqqC,cACArqC,KAAA8+P,YACA9+P,KAAA2B,mBAER3B,KAAKopD,eAAe9M,SAASz5C,UAAWi7C,KACtC99C,KAAKmgQ,gBAAgBriN,GAAO,GAE9B99C,KAAKopD,eAAexM,cAAc/5C,UAAWi7C,KAC3C99C,KAAKogQ,YAAYtiN,GAAO,EAE5B,CAMQ2C,WAAW3C,GACjB99C,KAAKogQ,YAAYtiN,GACjB99C,KAAKs8C,SAAS35C,KAAKm7C,EACrB,CAMQsiN,YAAYtiN,GAClB,MAAMvT,EAAUvqC,KAAK8+P,UAAUv0N,QAEzBqM,EAAQ,IACOkH,EAAQlH,OAAS,IACzBr8B,QAAS8lP,KACpB,MAAMC,GAAWtgQ,KAAKqqC,YAAYoM,QAAQ4pN,GAAYrxO,MACtD,QAAiBhtB,IAAbs+P,GACF,OAGF,MAAMzgQ,GAAU2G,OAAO6H,OACrB,GACAiyP,GAASzgQ,SAAW,GACpBwgQ,GAAYxgQ,SAAW,IAEnBu2C,GAAO5vC,OAAO6H,OAAO,GAAIiyP,GAAUD,GAAa,CAAExgQ,aACxD+2C,EAAMtvC,KAAK8uC,GAAI,GAGjBQ,EAAMr8B,QAAS67B,KACb,GAAIA,GAAK+C,OAAQ,CACf,MAAMonN,GAAc3pN,EAAM5B,UAAWhiC,IAAOA,GAAGgc,OAASonB,GAAK+C,SACzC,IAAhBonN,KACF3pN,EAAM2pN,IAAa9/N,SAAW,GAC9BmW,EAAM2pN,IAAa9/N,SAASn5B,KAAK8uC,GAAKpnB,MAE1C,IAGFub,EAAQoM,SAASC,GACjBrM,EAAQ+L,WAAWwH,EAAQvH,SAAW,IAItCv2C,KAAKopD,eAAezS,SAAS,GAAGh2B,OAAOi2B,IACvC52C,KAAKopD,eAAe9S,WAAWwH,EAAQvH,SAAW,GACpD,CAMQ4pN,gBAAgBriN,QACN97C,IAAZ87C,GAGJ99C,KAAKygD,WAAW3C,EAClB,4CAjFWoiN,GAAY9+P,MAAAuE,OAAAvE,MAAAwE,OAAAxE,MAAAyE,IAAAzE,MAAA0E,OAAA,iCAAZo6P,EAAY7+P,QAAZ6+P,EAAY5+P,UAAAC,WAFX,gBAED2+P,CAAY,KCIZM,GAAc,MAArB,MAAOA,EAsBS7C,SArBb74K,mBAAoC,IAAI9pC,IAKxC+pC,WAAyB,IAAIkY,MAAW,IAKxCjU,kBAKApE,mBAEAI,iBAEA7hE,aAAuB,IAE9BpjB,YAAoB49P,GAAA39P,KAAA29P,WAClB39P,KAAKgpF,kBAAoB,IAAIkU,MAAkB,GAAI,CACjDz8E,IAAKzgB,KAAK29P,SAASl9O,MAGrBzgB,KAAK4kF,mBAAqB,IAAIwY,MAAmB,GAAI,CACnD38E,IAAKzgB,KAAK29P,SAASl9O,MAGrBzgB,KAAKglF,iBAAmB,IAAIqY,MAAiB,GAAI,CAC/C58E,IAAKzgB,KAAK29P,SAASl9O,MAGrBzgB,KAAK29P,SAASl9O,IAAI4gC,GAAGspC,KAAK,iBAAkB,KAC1C3qF,KAAKgpF,kBAAkBlnE,OAAOjf,UAAWuN,IACnCpQ,KAAKgpF,kBAAkBvmC,OAAO5iD,UAE9BG,KAAKgpF,kBAAkBvmC,MAAM5iD,QAC7B8pD,iBAAmBv5C,KAGzBpQ,KAAK4kF,mBAAmB9iE,OAAOjf,UAAWuN,IACpCpQ,KAAK4kF,mBAAmBniC,OAAO5iD,UAE/BG,KAAK4kF,mBAAmBniC,MAAM5iD,QAC9B8pD,iBAAmBv5C,IAExB,GAGHpQ,KAAK29P,SAASl9O,IAAI0hC,QAAQt/C,UAAU,KAC7B7C,KAAK29P,SAASl9O,IAAIqjH,aAAa,+BAClC9jI,KAAK+kF,WAAW5+D,WAAWnmB,KAAK+kF,WAAW9iE,OAC3CjiB,KAAKgpF,kBAAkB7iE,WAAWnmB,KAAKgpF,kBAAkB/mE,QAEtDjiB,KAAK29P,SAASl9O,IAAIqjH,aAAa,8BAClC9jI,KAAK4kF,mBAAmBz+D,WAAWnmB,KAAK4kF,mBAAmB3iE,MAAK,EAGtE,4CA7DWu+O,GAAcp/P,MAAAuE,IAAA,iCAAd66P,EAAcn/P,QAAdm/P,EAAcl/P,UAAAC,WAFb,gBAEDi/P,CAAc,qBCapB,IAAMC,GAAN,MAAMA,GA2DDC,eACA/C,SACAh8P,gBACAC,eACAu6C,eACDwkN,aACCx6P,YAhEHy6P,kBAKP,cAAI77K,GACF,OAAO/kF,KAAK0gQ,eAAe37K,UAC7B,CAEA,gBAAI5hE,GACF,OAAOnjB,KAAK0gQ,eAAev9O,YAC7B,CAMA,qBAAI6lE,GACF,OAAOhpF,KAAK0gQ,eAAe13K,iBAC7B,CAMA,sBAAIpE,GACF,OAAO5kF,KAAK0gQ,eAAe97K,kBAC7B,CAMA,oBAAII,GACF,OAAOhlF,KAAK0gQ,eAAe17K,gBAC7B,CAMA,sBAAIF,GACF,OAAO9kF,KAAK0gQ,eAAe57K,kBAC7B,CAEA,kBAAI4J,GACF,OAAO1uF,KAAKmG,YAAYrE,aAC1B,CAMA,OAAI2e,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACU2gQ,EACA/C,EACAh8P,EACAC,EACAu6C,GACDwkN,GACCx6P,IANAnG,KAAA0gQ,iBACA1gQ,KAAA29P,WACA39P,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAAm8C,kBACDn8C,KAAA2gQ,gBACC3gQ,KAAAmG,cACP,CAEHoH,WACuBvN,KAAKm8C,eAAej8C,IACvC,6BAGAF,KAAK4B,eAAek9D,KAClB,6CACA,2CACA,CAAEwI,QAAS,MAEbtnE,KAAKm8C,eAAe97C,IAClB,2BACA,EACAuG,KAAaulE,UAGjBnsE,KAAK2gQ,aAAarkN,SAASz5C,UAAWm3B,IAC/Bh6B,KAAKmG,YAAYvD,gBACpB5C,KAAK4gQ,kBAAoB5mO,EAAEijB,MAGjC,4CAzFWwjN,IAAuBr/P,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,OAAAzE,MAAA0E,OAAA1E,MAAA2E,MAAA3E,MAAA4E,IAAA5E,MAAAuT,MAAA,+BAAvB8rP,GAAuBnyP,UAAA,0BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6IAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCjCpC1N,MAAA,2BAQEA,MAPA,aAAA2N,EAAA6xP,kBAOAx/P,CAPgC,WAAA2N,EAAAoU,aAOhC/hB,CANyB,aAAA2N,EAAAg2E,WAMzB3jF,CALyB,oBAAA2N,EAAAi6E,kBAKzB5nF,CAJuC,mBAAA2N,EAAAi2E,iBAIvC5jF,CAHqC,qBAAA2N,EAAA61E,mBAGrCxjF,CAFyC,qBAAA2N,EAAA+1E,mBAEzC1jF,CADyC,iBAAA2N,EAAA2/E,+BDwB/ByiF,MAAmBt8J,MAAA2tB,cAAA,KAElBi+N,MAAuBh+N,OAAA,IAXnC8U,OAAc,CACbvoB,KAAM,aACNpjB,MAAO,mCACPD,KAAM,gBACP,EAAC03B,GAAAC,IAAA,qBAkE0Bk9N,GACNzD,GACOv4L,MACDqE,MACAh+D,KACHq1P,GACA1+P,QAjEZi/P,IEtBN,ICMMI,GAAS,MAAhB,MAAOA,EAMSlD,SALbj2O,OAA0C,GAC1Co5O,SAAqB,GACrB37D,aAAwC,GACxCV,mBAEP1kM,YAAoB49P,GAAA39P,KAAA29P,WAClB39P,KAAK29P,SAASl9O,IAAI0hC,QAAQt/C,UAAU,KAClC7C,KAAK8gQ,SAASvmP,QAASqhE,IACrB,IAAK57E,KAAK29P,SAASl9O,IAAIqjH,aAAaloD,GAAU,CAC5C,IAAImlL,EAAe/gQ,KAAK0nB,OAAOtF,KAC5BlS,IAAUA,GAAMuyC,MAAMvwC,KAAO0pE,GAEhCmlL,EAAa56O,WAAW46O,EAAa9+O,OACrCjiB,KAAK0nB,OAAO7B,OAAO7lB,KAAK0nB,OAAOhf,QAAQq4P,EAAc,GAAI,GACzD/gQ,KAAK8gQ,SAASj7O,OAAO7lB,KAAK8gQ,SAASp4P,QAAQkzE,EAAS,GAAI,GACxD,IAAIolL,GAAmBhhQ,KAAKmlM,aAAanwJ,UACtCqxJ,IAAOA,GAAG,KAAOzqH,GAEpB57E,KAAKmlM,aAAat/K,OAAOm7O,GAAkB,EAC7C,GACD,GAEH,QAAS9wP,KAASlQ,KAAK0nB,OACrBxX,EAAQ,IAAIitF,MAA8B,GAAI,CAAE18E,IAAKzgB,KAAK29P,SAASl9O,KAEvE,4CA1BWogP,GAASz/P,MAAAuE,IAAA,iCAATk7P,EAASx/P,QAATw/P,EAASv/P,UAAAC,WAFR,gBAEDs/P,CAAS,KCaTI,GAAN,MAAMA,GA4CDC,UACAvD,SAxCV,UAAIj2O,GACF,OAAO1nB,KAAKkhQ,UAAUx5O,MACxB,CAMA,OAAIjH,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,YAAIqgP,GACF,OAAO9gQ,KAAKkhQ,UAAUJ,QACxB,CAEA,gBAAI37D,GACF,OAAOnlM,KAAKkhQ,UAAU/7D,YACxB,CACA,gBAAIA,CAAakB,GACfrmM,KAAKkhQ,UAAU/7D,aAAekB,CAChC,CAEA,sBAAI5B,GACF,OAAOzkM,KAAKkhQ,UAAUz8D,kBACxB,CACA,sBAAIA,CAAmB/9L,GACrB1G,KAAKkhQ,UAAUz8D,mBAAqB/9L,CACtC,CAEOy6P,YAAYl3I,GACjBjqH,KAAK8gQ,SAASx5P,KAAK2iH,EACrB,CAEOm3I,gBAAgB/6D,GACrBrmM,KAAKmlM,aAAekB,CACtB,CAEAtmM,YACUmhQ,EACAvD,GADA39P,KAAAkhQ,YACAlhQ,KAAA29P,UACP,4CA9CQsD,IAAoB7/P,MAAAuE,IAAAvE,MAAAwE,IAAA,+BAApBq7P,GAAoB3yP,UAAA,uBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,iHAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC9BjC1N,MAAA,gBAOEA,MAJA,yBAAAqW,IAAA,OAAiB1I,EAAAoyP,YAAA1pP,GAAmB,EAIpCrW,CAJqC,6BAAAqW,IAAA,OAGhB1I,EAAAqyP,gBAAA3pP,GAAuB,EAC5CrW,CAD6C,6BAAAqW,IAAA,OAAA1I,EAAA01L,mBAAAhtL,EAAA,GAG/CrW,cAJEA,MAJA,SAAA2N,EAAA2Y,OAIAtmB,CAJiB,MAAA2N,EAAA0R,IAIjBrf,CAHW,qBAAA2N,EAAA01L,mBAGXrjM,CADyC,eAAA2N,EAAAo2L,6BDwB/BH,OAAaxiK,cAAA,EAAA1yB,gBAAA,KAEZmxP,MAAoBx+N,OAAA,IAZhC8U,OAAc,CACbvoB,KAAM,OACNpjB,MAAO,6BACPD,KAAM,iBACP,EAAC03B,GAAAC,IAAA,qBAoDqBu9N,GACD9D,MA7CTkE,oBErBP,SAAUzpN,GACdC,EAAQ,QACRj0C,EAAO,eAEP,SAAO6J,OAAQ,iBAAkB,IAC/BmD,OACE,WACA2F,OAAM,CACJiD,UAAW,uBACX,EAEJs+B,OAAW,mBAAiBC,OAAQF,EAAQ,IAAMj0C,KAEtD,CCDO,IAAM69P,GAAN,MAAMA,GAgBQ1D,SAfnB,OAAIl9O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,SAAIgiC,GACF,UAAWL,KAAOpiD,KAAKygB,IAAIq/B,OACzB,IAA2B,IAAvBsC,EAAIviD,QAAQ8nB,OACd,OAAOy6B,CAIb,CAEOzK,QAAU,QAEjB53C,YAAmB49P,GAAA39P,KAAA29P,UAAqB,4CAhB7B0D,IAA4BjgQ,MAAAuE,IAAA,+BAA5B07P,GAA4B/yP,UAAA,iCAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,6BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCrBzC1N,MAAA,oCAIEA,MAHA,MAAA2N,EAAA0R,IAGArf,CAHW,QAAA2N,EAAA0zC,MAGXrhD,CAFe,YAEfA,CADgB,kBAAA2N,EAAA4oC,wBDgBNg/I,OAA0Bn0J,cAAA,EAAAv+B,KAAA,CAAAq1C,UAFxB,CAAC9B,UERT,SAAUA,GACdC,EAAQ,QACRj0C,EAAO,eAEP,SAAO6J,OAAQ,iBAAkB,IAC/BmD,OACE,WACA2F,OAAM,CACJiD,UAAW,uBACX,EAEJs+B,OAAW,mBAAiBC,OAAQF,EAAQ,IAAMj0C,KAEtD,CFDa69P,MAA4B5+N,OAAA,IAbxC8U,OAAc,CACbvoB,KAAM,kBACNpjB,MAAO,kCACPD,KAAM,SACNwtC,OAAQ,cACT,EAAC9V,GAAAC,IAAA,qBAwB6By5N,MAhBlBsE,IGAN,IAAMC,GAAN,MAAMA,GAgBQ3D,SAfnB,OAAIl9O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,SAAIgiC,GACF,UAAWL,KAAOpiD,KAAKygB,IAAIq/B,OACzB,IAA2B,IAAvBsC,EAAIviD,QAAQ8nB,OACd,OAAOy6B,CAIb,CAEOzK,QAAU,QAEjB53C,YAAmB49P,GAAA39P,KAAA29P,UAAqB,4CAhB7B2D,IAA6BlgQ,MAAAuE,IAAA,+BAA7B27P,GAA6BhzP,UAAA,kCAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,uBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCrB1C1N,MAAA,iCAGEA,MAFA,QAAA2N,EAAA0zC,MAEArhD,CAFe,YAEfA,CADgB,kBAAA2N,EAAA4oC,wBDiBN+iK,OAAuBl4K,cAAA,EAAAv+B,KAAA,CAAAq1C,UAFrB,CAAC9B,UAIF8pN,MAA6B7+N,OAAA,IAbzC8U,OAAc,CACbvoB,KAAM,mBACNpjB,MAAO,mCACPD,KAAM,UACNwtC,OAAQ,cACT,EAAC9V,GAAAC,IAAA,qBAwB6By5N,MAhBlBuE,IEFN,IAAMC,GAAN,MAAMA,GACXxhQ,cAAe,4CADJwhQ,GAAsB,+BAAtBA,GAAsBjzP,UAAA,0BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCnBnC1N,MAAA,8CDiBYs4L,MAA4BG,OAAiCr3J,cAAA,KAE5D++N,MAAsB9+N,OAAA,IAXlC8U,OAAc,CACbvoB,KAAM,YACNpjB,MAAO,kCACPD,KAAM,YACP,EAAC03B,GAAAC,IAAA,yBAOWi+N,uGETN,IAAMC,GAAY,MAAnB,MAAOA,EAKSC,kBAJpB,kBAAItlN,GACF,OAAOn8C,KAAKyhQ,iBACd,CAEA1hQ,YAAoB0hQ,GAAAzhQ,KAAAyhQ,mBAAoC,4CAL7CD,GAAYpgQ,MAAAuE,MAAA,iCAAZ67P,EAAYngQ,QAAZmgQ,EAAYlgQ,UAAAC,WAFX,gBAEDigQ,CAAY,kECkBnB,SAAUE,GACdjnN,EACA0B,GAEqB1B,EAAUQ,YAAYl1B,kBACzCujF,OAEWM,UACVztD,EAAej8C,IAAI,YAChB26F,MAAc59E,QACd49E,MAAcj9E,KAEtB,CAEM,SAAU+jP,GACdlnN,EACA0+L,EACAyoB,EACAC,EACAC,EACAC,GACA5lN,GACAx6C,GACAqQ,GACA8sP,IAEA,MAAMjmN,GAAU,CACd,CACE3mC,GAAI,WACJhD,UAAU,EACVtD,MAAO,2CACPiC,QAAS,6CACTF,eAAgBm0P,EAChBv1P,QAASA,KACPm1P,GAAejnN,EAAW0B,IAC1BA,GAAe97C,IACb,YACC87C,GAAej8C,IAAI,YAAsB,GAIhD,CACEgS,GAAI,oBACJhD,UAAU,EACVtD,MAAO,8CACPiC,WAASgoO,OAA+Bp7L,GACxC9sC,eAAgBwrO,EAChB5sO,QAASA,IACP4sO,EAA+Bx2O,MAC5Bw2O,EAA+BzyO,QAGtC,CACEwL,GAAI,eACJhD,UAAU,EACVtD,MAAO,2CACPiC,QAAS,6CACTF,eAAgBi0P,EAChBr1P,QAASA,IACPq1P,EAA0Bj/P,MAAMi/P,EAA0Bl7P,QAE9D,CACEwL,GAAI,iBACJvG,KAAM,WACNC,MAAO,iDACPiC,QAAS,mDACTtB,QAAUwvE,KACRA,GAAG9gC,YAAYzqC,MAAMqP,WAAWk8D,GAAG9gC,YAAY9qC,KAAK8R,MAAO,CACzDuG,UAAU,GACX,EAEHhb,KAAM,CAACitC,GACP1sC,aAAeguE,OACb+5J,OAAkB/5J,KAEtB,CACE7pE,GAAI,kBACJvG,KAAM,YACNC,MAAO,2CACPiC,QAAS,6CACTtB,QAAUwvE,KACR,MAAMimL,GAAiBjmL,GAAG9gC,YAAYl1B,kBACpCgC,MAKIw8L,GAH0BxoI,GAAG9gC,YAAYl1B,kBAC7CuC,MAEkDX,OAChD,CAACo0D,GAAGt5B,MAAMvwC,IACV,GACJ4sP,GAAUH,0BAA0B,CAClCvoN,KAAM,eACNv2C,QAAS,CACPigD,OAAQ,CAACi8B,GAAGt5B,MAAMvwC,IAClBkzM,mBAAoB48C,GAAer6O,OACnC48L,yBAEH,EAEH/2M,KAAM,CAACitC,IAET,CACEvoC,GAAI,YACJvG,KAAM,aACNC,MAAO,4CACPiC,QAAS,8CACTtB,QAASA,CACPstC,GACAkiC,MAEAA,GAAG3gC,eAAevB,GAAQ,CACxBp5B,IAAKs7D,GAAGt7D,IACRgiC,MAAOs5B,GAAGt5B,OACX,EAEHj1C,KAAM,CAACq0P,EAAiBpnN,IAE1B,CACEvoC,GAAI,WACJtG,MAAOjK,GAAgB4pB,UAAUshB,QAC/B,sCAEFh/B,QAASlM,GAAgB4pB,UAAUshB,QACjC,6CAEFlhC,KAAM,SACNsC,QAASA,IACA8zP,GAAUh+P,QAAK0c,MAAKpH,KAAOA,KAAMrH,GAAasZ,aAEvD/e,QAASA,KACFyF,GAAasZ,YAChBy2O,GAAUp/P,MAAK,EAAI,GAIzB,CACEuP,GAAI,iBACJtG,MAAOjK,GAAgB4pB,UAAUshB,QAC/B,4CAEFh/B,QAASlM,GAAgB4pB,UAAUshB,QACjC,mDAEFlhC,KAAM,SACNsC,QAASA,IACA8zP,GAAUh+P,QAAK0c,MAAKpH,IAAMA,KAAMrH,GAAasZ,aAEtD/e,QAASA,KACPw1P,GAAUp/P,MAAK,EAAK,GAGxB,CACEuP,GAAI,QACJvG,KAAM,QACNC,MAAO,wCACPiC,QAAS,0CACTtB,QAAUwvE,KACR,MAAMnwE,GAAQ,GAAGmwE,GAAGt5B,MAAM72C,UA6ClC,SAASq2P,GAAcjpO,EAAYrB,GACjC,OAAOD,KAAOsB,GAAMrB,OAAOA,EAC7B,CA/C4CsqO,CAClC,IAAIhhQ,KACJ,uBAEI0zF,GAAW,IAAIC,WAAc,aAC7BstK,GAAgB,6BACtBvtK,GAAI/nD,KAAKhhC,GAAO,GAAI,IACpB+oF,GAAIqD,UAAU,CACZC,OAAQ,GACRkqK,WAAY,OACZltP,KAAM,yBACNmtP,qBAAqB,EACrBvyP,OAAQ,CAAEwyP,YAAa,GAAKC,aAAc,GAAI7pK,SAAU,GACxD8pK,YAAct+P,KACZ,IAAIqtD,GAAM,QAAUqjC,GAAIM,SAASgE,mBACA,mBAAtBtE,GAAI6tK,gBACblxM,GAAMA,GAAM,MAAQ4wM,IAEtBvtK,GAAI4B,YAAY,GAChB,MAAMhsE,GAAWoqE,GAAIM,SAAS1qE,SACxByqE,GAAazqE,GAAS0U,OACxB1U,GAAS0U,OACT1U,GAAS8uE,YACb1E,GAAI/nD,KAAK0kB,GAAKrtD,GAAKogK,SAASlsE,OAAOmgC,KAAMtjC,GAAa,GAAE,IAG3B,mBAAtBL,GAAI6tK,eACb7tK,GAAI6tK,cAAcN,IAEpBvtK,GAAInoC,KAAK,GAAG5gD,SAAW,EAEzB4B,KAAM,CAACitC,KAGX,IAAIgoN,GAAiBhoN,EAAUgI,MAAMpsB,WAClCx2B,QAAQu4E,YAAYznC,QACnBkI,GACAA,GAAQnvC,OAAQgC,IAAyB,cAAdA,GAAOwG,IACtCuwP,WACkD,IAAhDhoN,EAAUgI,MAAM5iD,QAAQ46C,UAAU8gM,UAC9B1iM,GACAA,GAAQnvC,OAAQgC,IAAyB,UAAdA,GAAOwG,IACjCuwP,EACT,CC7MO,IAAMC,GAAqB,MAA5B,MAAOA,EAiBDb,gBACAc,aACDhhQ,gBACCqQ,aACA8sP,UApBHiD,UAEPD,UAAsC,IAAI//P,KAAgB,GAClD6gQ,gBAER,kBAAIzmN,GACF,OAAOn8C,KAAK2iQ,aAAaxmN,cAC3B,CAEA,YAAI26L,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEAH,YAGU8hQ,EACAc,EACDhhQ,EACCqQ,GACA8sP,IAJA9+P,KAAA6hQ,kBACA7hQ,KAAA2iQ,eACD3iQ,KAAA2B,kBACC3B,KAAAgS,gBACAhS,KAAA8+P,aAER9+P,KAAK+hQ,UAAY,IAAIhgQ,IACnB/B,KAAKm8C,eAAej8C,IAAI,qBAE5B,CAEAgO,cACMlO,KAAK4iQ,iBACP5iQ,KAAK4iQ,gBAAgBz0P,aAEzB,CAEA00P,YACEpoN,EACA0+L,EACAyoB,GAEA,MAAM/oN,GAAU74C,KAAK8iQ,aACnBroN,EACA0+L,EACAyoB,GAEFnnN,EAAU7C,YAAY1yB,KAAK2zB,GAC7B,CAEAiqN,aACEroN,EACA0+L,EACAyoB,GAEA,OAAA5hQ,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB92O,KAAK4iQ,gBAAkB5iQ,KAAKm8C,eAAeswB,eACxC1oE,QACC6jG,MACGm7J,IACwB,aAAvBA,IAAex8P,KACfw8P,IAAer5O,QAAU0iD,KAAwBI,UAGtD3pE,UAAU,KACT7C,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB4qB,GAAejnN,EAAWz6C,KAAKm8C,eAAc,GAE1CwlN,GACLlnN,EACA0+L,EACAyoB,EACA5hQ,KAAK6hQ,gBACL7hQ,KAAK8hQ,UACL9hQ,KAAK+hQ,UACL/hQ,KAAKm8C,eACLn8C,KAAK2B,gBACL3B,KAAKgS,aACLhS,KAAK8+P,UAET,4CA7EW4D,GAAqBthQ,MAgBtBy7N,MAAe,GAAAz7N,MAAAuE,IAAAvE,MAAAwE,OAAAxE,MAAAyE,MAAAzE,MAAA0E,IAAA,iCAhBd48P,EAAqBrhQ,QAArBqhQ,EAAqBphQ,UAAAC,WAFpB,gBAEDmhQ,CAAqB,KCDrBM,GAAqB,MAA5B,MAAOA,EAeDL,aACDhhQ,gBACCm9P,UACA9sP,aAjBH+vP,UAEPD,UAAsC,IAAI//P,KAAgB,GAClD6gQ,gBAER,kBAAIzmN,GACF,OAAOn8C,KAAK2iQ,aAAaxmN,cAC3B,CAEA,YAAI26L,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEAH,YACU4iQ,EACDhhQ,EACCm9P,EACA9sP,IAHAhS,KAAA2iQ,eACD3iQ,KAAA2B,kBACC3B,KAAA8+P,YACA9+P,KAAAgS,gBAERhS,KAAK+hQ,UAAY,IAAIhgQ,IACnB/B,KAAKm8C,eAAej8C,IAAI,qBAE5B,CAEAgO,cACMlO,KAAK4iQ,iBACP5iQ,KAAK4iQ,gBAAgBz0P,aAEzB,CAEA00P,YACEpoN,EACA0+L,EACAyoB,GAEA,MAAM/oN,GAAU74C,KAAK8iQ,aACnBroN,EACA0+L,EACAyoB,GAEFnnN,EAAU7C,YAAY1yB,KAAK2zB,GAC7B,CAEAiqN,aACEroN,EACA0+L,EACAyoB,GAEA,OAAA5hQ,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB92O,KAAK4iQ,gBAAkB5iQ,KAAKm8C,eAAeswB,eACxC1oE,QACC6jG,MACGm7J,IACwB,aAAvBA,IAAex8P,KACfw8P,IAAer5O,QAAU0iD,KAAwBI,UAGtD3pE,UAAU,KACT7C,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB4qB,GAAejnN,EAAWz6C,KAAKm8C,eAAc,GAE1CwlN,GACLlnN,EACA0+L,EACAyoB,OACA5/P,EACAhC,KAAK8hQ,UACL9hQ,KAAK+hQ,UACL/hQ,KAAKm8C,eACLn8C,KAAK2B,gBACL3B,KAAKgS,aACLhS,KAAK8+P,UAET,4CA1EWkE,GAAqB5hQ,MAAAuE,IAAAvE,MAAAwE,OAAAxE,MAAAyE,IAAAzE,MAAA0E,MAAA,iCAArBk9P,EAAqB3hQ,QAArB2hQ,EAAqB1hQ,UAAAC,WAFpB,gBAEDyhQ,CAAqB,KCCrBC,GAAiB,MAAxB,MAAOA,EAqBDpB,gBACAc,aACDhhQ,gBACCqQ,aACA8sP,UAxBHiD,UAEPH,0BAAsD,IAAI7/P,KACxD,GAGF+/P,UAAsC,IAAI//P,KAAgB,GAClD6gQ,gBAER,kBAAIzmN,GACF,OAAOn8C,KAAK2iQ,aAAaxmN,cAC3B,CAEA,YAAI26L,GACF,OAAO92O,KAAKm8C,eAAej8C,IAAI,WACjC,CAEAH,YAGU8hQ,EACAc,EACDhhQ,EACCqQ,GACA8sP,IAJA9+P,KAAA6hQ,kBACA7hQ,KAAA2iQ,eACD3iQ,KAAA2B,kBACC3B,KAAAgS,gBACAhS,KAAA8+P,aAER9+P,KAAK+hQ,UAAY,IAAIhgQ,IACnB/B,KAAKm8C,eAAej8C,IAAI,qBAE5B,CAEAgO,cACMlO,KAAK4iQ,iBACP5iQ,KAAK4iQ,gBAAgBz0P,aAEzB,CAEA00P,YACEpoN,EACA0+L,EACAyoB,GAEA,MAAM/oN,GAAU74C,KAAK8iQ,aACnBroN,EACA0+L,EACAyoB,GAEFnnN,EAAU7C,YAAY1yB,KAAK2zB,GAC7B,CAEAiqN,aACEroN,EACA0+L,EACAyoB,GAEA,OAAA5hQ,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB92O,KAAK4iQ,gBAAkB5iQ,KAAKm8C,eAAeswB,eACxC1oE,QACC6jG,MACGm7J,IACwB,aAAvBA,IAAex8P,KACfw8P,IAAer5O,QAAU0iD,KAAwBI,UAGtD3pE,UAAU,KACT7C,KAAK8hQ,UAAUn/P,KAAK3C,KAAK82O,UACzB4qB,GAAejnN,EAAWz6C,KAAKm8C,eAAc,GAE1CwlN,GACLlnN,EACA0+L,EACAyoB,EACA5hQ,KAAK6hQ,gBACL7hQ,KAAK8hQ,UACL9hQ,KAAK+hQ,UACL/hQ,KAAKm8C,eACLn8C,KAAK2B,gBACL3B,KAAKgS,aACLhS,KAAK8+P,UAET,4CAjFWmE,GAAiB7hQ,MAoBlBy7N,MAAe,GAAAz7N,MAAAuE,IAAAvE,MAAAwE,OAAAxE,MAAAyE,MAAAzE,MAAA0E,IAAA,iCApBdm9P,EAAiB5hQ,QAAjB4hQ,EAAiB3hQ,UAAAC,WAFhB,gBAED0hQ,CAAiB,KCEjBC,GAAc,MAArB,MAAOA,EA4DDC,sBACAC,kBACAC,sBACAlnN,eA9DHmnN,wBAAkC,EAEhCC,kBACP,IAAIxhQ,KAAyB,GACtBo3O,+BACP,IAAIp3O,KAAyB,GACtB6/P,0BACP,IAAI7/P,KAAyB,GAEtByhQ,mBACDC,iBAAmC,GAEnCC,gCACAC,2BAGAC,kBAGAC,wBAGCC,uBACP,IAAI/hQ,SAAwBC,GAKvB+hQ,WAAa,IAAIhiQ,SAA2BC,GAKnD,SAAIkO,GACF,OAAOlQ,KAAKowM,MACd,CACQA,OAER,sBAAI4zD,GACF,OAAIhkQ,KAAK+jQ,WAAWr9P,MACX1G,KAAK+jQ,WAAWr9P,OAAOu0C,YAAYv2B,UAAUpC,OACjD0mD,IAA2B,IAArBA,EAAEx4D,MAAMgY,UAGV,EAEX,CAEA,uBAAIy7O,GACF,OAAIjkQ,KAAK+jQ,WAAWr9P,MACX1G,KAAK+jQ,WAAWr9P,OAAOu0C,aAAav2B,UAAUnC,QAClDymD,IAA2B,IAArBA,EAAEx4D,MAAMgY,WAAiB,EAG3B5kB,OAAG,GAEd,CAEA7D,YACUojQ,EACAC,EACAC,EACAlnN,IAHAn8C,KAAAmjQ,wBACAnjQ,KAAAojQ,oBACApjQ,KAAAqjQ,wBACArjQ,KAAAm8C,kBAERn8C,KAAKwjQ,mBAAqB,IAAIzhQ,IAC5B/B,KAAKm8C,eAAej8C,IAAI,sBAE1BF,KAAKkkQ,gBACP,CAOQA,iBACNlkQ,KAAKowM,OAAS,IAAI91J,KAAe,IACjCt6C,KAAKowM,OAAO1rL,UACTrC,SACEkE,IAA4D,IAAxBA,EAAO/V,MAAMmX,QAEnD9kB,UAAW0jB,IAEVvmB,KAAK+jQ,WAAWphQ,KADE4jB,EAASA,EAAOvI,YAAShc,EACb,GAGlChC,KAAKowM,OAAO1rL,UACThU,OACA7N,UAAWilK,IACVA,EAAWrnJ,IAAK0kM,IACVA,EAAInnM,OAAO45B,YAAYxnC,QACrB+0M,EAAInnM,kBAAkBs3N,MACxBt1O,KAAKojQ,kBAAkBP,YACrB19C,EAAInnM,OACJhe,KAAKm5O,+BACLn5O,KAAK4hQ,2BAEEz8C,EAAInnM,kBAAkBs5N,MAC/Bt3O,KAAKmjQ,sBAAsBN,YACzB19C,EAAInnM,OACJhe,KAAKm5O,+BACLn5O,KAAK4hQ,2BAEEz8C,EAAInnM,kBAAkB45N,OAC/B53O,KAAKqjQ,sBAAsBR,YACzB19C,EAAInnM,OACJhe,KAAKm5O,+BACLn5O,KAAK4hQ,2BAAyB,EAIrC,GAGL5hQ,KAAKyjQ,iBAAiBn8P,KACpBtH,KAAKmjQ,sBAAsBpB,UAAUl/P,UAAWshQ,IAC9CnkQ,KAAKokQ,wBAAwBD,EAAS,IAI1CnkQ,KAAKyjQ,iBAAiBn8P,KACpBtH,KAAKojQ,kBAAkBrB,UAAUl/P,UAAWshQ,IAC1CnkQ,KAAKokQ,wBAAwBD,EAAS,IAI1CnkQ,KAAKyjQ,iBAAiBn8P,KACpBtH,KAAKqjQ,sBAAsBtB,UAAUl/P,UAAWshQ,IAC9CnkQ,KAAKokQ,wBAAwBD,EAAS,IAI1CnkQ,KAAK4jQ,kBAAoB5jQ,KAAK+jQ,WAAWlhQ,UACtC43C,SACsCz4C,IAAjChC,KAAK6jQ,0BACP7jQ,KAAK6jQ,wBAAwB11P,cAC7BnO,KAAK6jQ,6BAA0B7hQ,QAGfA,IAAdy4C,IACFz6C,KAAK6jQ,wBAA0BppN,EAAUG,QAAQ/3C,UAC9Cg3C,GAAmB75C,KAAK8jQ,uBAAuBnhQ,KAAKk3C,IAAO,GAMpE75C,KAAK0jQ,gCACH1jQ,KAAKm5O,+BAA+Bt2O,UAAWwhQ,IAC7CrkQ,KAAKowM,OAAO1rL,UAAUzC,MAAMxB,IAAK0kM,IAC/B,IAAKA,EAAInnM,OAAO45B,YAAYxnC,MAAO,CACjC,MAAM4xP,EAAiB78C,EAAInnM,OAAOi9B,YAAYl1B,kBAC5CgC,MAEEi6O,IACEqC,EACFrC,EAAev8O,WAEfu8O,EAAe97O,aAGrB,GACD,GAGLlmB,KAAK2jQ,2BAA6B3jQ,KAAK4hQ,0BAA0B/+P,UAC9DyhQ,IACCtkQ,KAAKowM,OAAO1rL,UAAUzC,MAAMxB,IAAK0kM,IAC/B,IAAKA,EAAInnM,OAAO45B,YAAYxnC,MAAO,CACjC,MAAM4xP,EAAiB78C,EAAInnM,OAAOi9B,YAAYl1B,kBAC5CuC,MAEE05O,IACEsC,EACFtC,EAAev8O,WAEfu8O,EAAe97O,aAGrB,GACD,EAGP,CAEQk+O,wBAAwBD,GAC9BnkQ,KAAKm8C,eAAe97C,IAAI,oBAAqB8jQ,GAC7CnkQ,KAAKwjQ,mBAAmB7gQ,KAAKwhQ,EAC/B,CAEOI,uBAAuBryP,GAC5B,MAAMsyP,EAAYxkQ,KAAKkQ,MAAM+R,MAAMG,KAAMq4B,GAAcA,EAAUvoC,KAAOA,GACpEsyP,GACFxkQ,KAAKkQ,MAAMsqC,kBAAkBgqN,EAEjC,CAEOC,0BAA0B74P,GAC/B,MAAM84P,EAAe1kQ,KAAKkQ,MACvB+R,MACAG,KAAMq4B,GAAcA,EAAU7uC,QAAUA,GACvC84P,GACF1kQ,KAAKkQ,MAAMsqC,kBAAkBkqN,EAEjC,CAMAx2P,cACElO,KAAK2kQ,qBACL3kQ,KAAKyjQ,iBAAiBhjP,IAAK6hC,GAAMA,EAAEn0C,eAC/BnO,KAAK0jQ,iCACP1jQ,KAAK2jQ,2BAA2Bx1P,cAE9BnO,KAAK2jQ,4BACP3jQ,KAAK2jQ,2BAA2Bx1P,aAEpC,CAKQw2P,qBACN3kQ,KAAKkQ,MAAMpJ,aAC0B9E,IAAjChC,KAAK6jQ,yBACP7jQ,KAAK6jQ,wBAAwB11P,mBAEAnM,IAA3BhC,KAAK4jQ,mBACP5jQ,KAAK4jQ,kBAAkBz1P,aAE3B,4CAzOW+0P,GAAc9hQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,MAAA,iCAAdo9P,EAAc7hQ,QAAd6hQ,EAAc5hQ,UAAAC,WAFb,gBAED2hQ,CAAc,+BCe3B9hQ,MAAA,GACEA,MAAA,wDAAqBA,cAAA,UAAAy5P,IC8ChB,IAAM+J,GAAN,MAAMA,GA0CDC,gBACAj1D,qBACAlxF,kBACArkD,aACAsjM,SACA/7P,eACAD,gBACA88P,kBACAK,UACAgG,eACA/yP,MAnDV,OAAI0O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAESjd,KACA2wK,SAAkCpB,MAAsBC,QACxDy4B,qBAEF3rJ,OAAkB,GAClBilN,aAAwB,GAExB50D,UACAoB,UACA3qE,KACAsrE,eACAl3I,OAAS,EAETgqM,SAAW,EAEXC,iBAA6C,IAAIljQ,SACtDC,GAGM21B,OAAS,IAAIimI,KAEd1tJ,MAA8B,IAAI7E,KAAqB,IAEvD65P,iBAAyC,IAAI75P,KAAqB,IAElE++G,SAAU,EAEVimF,eAAiB,EAEjBz9D,YAAiCzB,MAAkBI,OAClD7yC,aAAe,IAAI1jD,IAEnBmqN,WAEDp4F,aAEPhtK,YACU8kQ,EACAj1D,EACAlxF,EACArkD,EACAsjM,GACA/7P,GACAD,GACA88P,GACAK,GACAgG,GACA/yP,IAVA/R,KAAA6kQ,kBACA7kQ,KAAA4vM,uBACA5vM,KAAA0+G,oBACA1+G,KAAAq6D,eACAr6D,KAAA29P,YACA39P,KAAA4B,kBACA5B,KAAA2B,mBACA3B,KAAAy+P,qBACAz+P,KAAA8+P,aACA9+P,KAAA8kQ,kBACA9kQ,KAAA+R,QACP,CAEHxE,WACE,UAAWk1C,KAASziD,KAAKygB,IAAIq/B,OAEzB2C,EAAM72C,OACN62C,EAAM72C,MAAMosB,SACVh4B,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,yCAIJ7sC,KAAK8/C,OAAOx4C,KAAKm7C,EAGvB,CAEAv0C,cACElO,KAAK0+F,aAAa/7F,OAClB3C,KAAK0+F,aAAap1D,UACpB,CAEA87N,cAAc17O,GACZ1pB,KAAKwD,KAAOkmB,EACZ1pB,KAAKmwM,eAAYnuM,CACnB,CAEAqjQ,mBAAmB37O,GACjB1pB,KAAKmwM,UAAYzmL,EACb1pB,KAAKmwM,WACPnwM,KAAKg0K,gBAET,CAEAsxF,qBACE,MAAM7kM,EAAM,GACN8kM,EAAK,IAAIv7P,OAAO,cACtB,UAAWy4C,KAASziD,KAAK8/C,OAClB2C,EAAM72C,MAAMsvB,MAAMqqO,IACrB9kM,EAAIn5D,KAAKm7C,EAAMvwC,IAGnBlS,KAAKy+P,kBAAkBH,QAAQL,GAAiBh4M,QAChDjmD,KAAKy+P,kBAAkBF,kBAAkB,CAAEz+M,OAAQ2gB,IACnDzgE,KAAK8+P,UAAUv0N,QAAQuM,aAAa,eACtC,CAEA0D,kBAAkBj0B,GAChB,IAAIi/O,EACJxlQ,KAAK8kQ,eAAe50P,MAAMuU,UACvB1gB,QAAKk7F,MAAUj/F,KAAK0+F,eACpB77F,UAAU,KACT,IACG0jB,GACDvmB,KAAK+kQ,aAAan7P,QAClB5J,KAAK8kQ,eAAe50P,MAAM+R,MAAMrY,OAAS,EACzC,CACA,GAAI5J,KAAKm0K,WAAapB,MAAsBE,WAC1C,UAAWmB,KAAYp0K,KAAKuxM,UAC1B,IAAKn9B,EAASqxF,YAAa,CACzBD,EAAiBxlQ,KAAK+kQ,aAAa3iP,KAAMqgC,GACvCA,EAAM72C,MAAMosB,SACVo8I,EAASplJ,KAAO,IAAMhvB,KAAKglQ,SAAS7sM,aAGxC,KACF,MAEG,CACL,MAAMvsD,EAAQ,YAAc5L,KAAKglQ,SAAS7sM,WAC1Cn4D,KAAK+kQ,aAAaxqP,QAASkoC,IACrBA,EAAM72C,MAAMosB,SAASpsB,KACvB45P,EAAiB/iN,IAGvB,CAEI+iN,IACFxlQ,KAAK8kQ,eAAexB,wBAAyB,EAC7CtjQ,KAAK8kQ,eAAeP,uBAAuBiB,EAAetzP,IAE9D,MACEqU,GACAvmB,KAAK+kQ,aAAan7P,QAClB5J,KAAK8kQ,eAAe50P,MAAM+R,MAAMrY,OAAS,IAEzC5J,KAAK0lQ,sBAAsBn/O,GAC3BvmB,KAAKmlQ,WAAanlQ,KAAKygB,IAAI4gC,GAAG/R,GAAG,UAAW,KAC1CtvC,KAAK0lQ,sBAAsBn/O,EAAM,GAClC,EAGT,CAEQm/O,sBAAsBn/O,GAC5BvmB,KAAK8kQ,eAAe50P,MAAM+R,MAAM1H,QAASkgC,IACvCA,EAAUQ,YAAYzqC,MAAM8P,UAAU,CAAEkI,UAAU,IAC9CiyB,EAAU7uC,MAAMosB,SAASzR,EAAO0T,MAAM,GAAG5b,KAAKzS,SAChD5L,KAAK8kQ,eAAeP,uBAAuB9pN,EAAUvoC,IACrDuoC,EAAUQ,YAAYzqC,MAAMqP,WAAW0G,EAAO0T,MAAO,CACnDzR,UAAU,IACX,EAGP,CAEQwrJ,iBACNh0K,KAAK4vM,qBACF57B,eAAeh0K,KAAKmwM,WACpBpsM,QAAKk7F,MAAUj/F,KAAK0+F,eACpB77F,UAAW0H,IACVA,EAASiY,KAAK,CAAC8/B,EAAGC,IACZD,EAAEjrB,WAAW84H,IAAM5tG,EAAElrB,WAAW84H,KAC3B,EAEL7tG,EAAEjrB,WAAW84H,IAAM5tG,EAAElrB,WAAW84H,IAC3B,EAEF,GAETnwJ,KAAKklQ,iBAAiBp+P,QACtB9G,KAAKklQ,iBAAiBhgP,KAAK3a,EAAQ,EAEzC,CAEAo7P,wBACE3lQ,KAAK4lQ,eACP,CAEAC,uBACE7lQ,KAAK4mI,UAAO5kI,EACZhC,KAAKmwM,eAAYnuM,CACnB,CAEA8jQ,WACE9lQ,KAAKygB,IAAIm6C,aAAa56D,KAAK8/C,QAC3B9/C,KAAK8/C,OAAS,GACd9/C,KAAK+kQ,aAAe,GACpB/kQ,KAAKqwM,eAAiB,EACtBrwM,KAAKglQ,SAAW,EACZhlQ,KAAKwD,OAASovK,MAAkBC,aAClC7yK,KAAK4mI,UAAO5kI,EACZhC,KAAKmwM,eAAYnuM,EAErB,CAEQ4jQ,gBACN5lQ,KAAKoqH,SAAU,EACf,IACImnF,EADAk0D,GAAc,GAEE,IAAhBzlQ,KAAKg7D,QAAgBh7D,KAAKwD,OAASovK,MAAkBh8C,QACvD52H,KAAK+lQ,oBAAoB,CAAC/lQ,KAAK4mI,OAM/B2qE,EAJEvxM,KAAKm0K,WAAapB,MAAsBE,UAI9B,CAHyB,CACnCjkJ,KAAM,KAIIhvB,KAAKuxM,UAGjBvxM,KAAK4yI,cAAgBzB,MAAkBK,YACvCxxI,KAAKwD,OAASovK,MAAkBh8C,QAEhC52H,KAAKg7D,OAAuB,IAAdh7D,KAAKg7D,QAEjBh7D,KAAKwD,OAASovK,MAAkBE,UAClC9yK,KAAKg7D,OAAS,GAGhB,MAAMl4C,EAAwC,GAC9CyuL,EAAUh3L,QAAS65J,IACjBtxJ,EAAaxb,KACXtH,KAAK4vM,qBACF17B,eACCl0K,KAAK4mI,KACL5mI,KAAKm0K,SACLn0K,KAAKmwM,UACL/7B,EACAp0K,KAAKg7D,QAENj3D,QACCC,MAAKuG,KACHvK,KAAKkQ,MAAMoV,WAAW/a,IACtB,MAAMy7P,GAA2B,GAC3BC,GAA8B,GACpC,IAAIC,GACAC,GACJ57P,GAASgQ,QAASzP,KACc,UAA1BA,GAAQw+E,SAAS9lF,MACnBsH,GAAQusB,WAAWgsK,UACjBv4L,GAAQw+E,SAASpD,YAAY,GAC/Bp7E,GAAQusB,WAAWisK,SAAWx4L,GAAQw+E,SAASpD,YAAY,GAC3D8/K,GAAc1+P,KAAKwD,IACnBo7P,GAAUp7P,GAAQuT,KAAKnM,KAEvB+zP,GAAiB3+P,KAAKwD,IACtBq7P,GAAar7P,GAAQuT,KAAKnM,MAI9BlS,KAAKomQ,iBAAiBJ,GAAeE,IACrClmQ,KAAKqmQ,iBAAiBJ,GAAkBE,IACpC57P,GAASX,QACX67P,GAAc,EACdzlQ,KAAKqwM,gBAAkB,EACvBj8B,EAASqxF,aAAc,EACvBzlQ,KAAK+R,MAAM4K,iBAEXy3J,EAASqxF,aAAc,EAGrBl7P,GAASX,QAAU,KACrB5J,KAAK4B,eAAe8D,MAClB,qCACA,gCACA,CAAE4hE,QAAS,KAAO,IAIzB,IAEN,EAEDhD,MAASxhD,GACN/e,QAAKk7F,MAAUj/F,KAAK0+F,eACpB77F,UAAU,KACT7C,KAAKoqH,SAAU,EACXq7I,GACFzlQ,KAAK4B,eAAe8D,MAClB,oCACA,gCACA,CAAE4hE,QAAS,KAAO,EAI5B,CAEAstI,aAAa9pM,EAAkBkwD,GAC7Bh7D,KAAK4mI,KAAO97H,EACRA,IACFkwD,EACIh7D,KAAK+lQ,oBAAoB,CAACj7P,IAAU,GACpC9K,KAAK+lQ,oBAAoB,CAACj7P,IAC9B9K,KAAKsmQ,oBAAoBx7P,GAE7B,CAKOi7P,oBAAoBx7P,EAAqBywD,GAC9C,IAAI5rB,EAAI,EACR,UAAWtkC,KAAWP,EAAU,CAC9B,GAAIvK,KAAKwD,OAASovK,MAAkBC,WAClC,UAAWpwH,MAASziD,KAAK8/C,OAAQ,CAC/B,GACE2C,GAAM5iD,QAAQ0mQ,WACd9jN,GAAM5iD,QAAQ0mQ,UAAU78I,OAAS5+G,EAAQusB,WAAWqyF,OACnD1uD,EACD,CACA,IAAKvY,GAAM72C,OAAOm1F,WAAW,QAAS,CACpC,MAAM9hF,GAAQjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAClCziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,EAC5B,CACA,MACF,CACA,GAAIwjC,GAAM72C,OAAOm1F,WAAW,QAAS,CACnC/gG,KAAK+kQ,aAAe,GACpB,MAAM9lP,GAAQjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAClCziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,GAC1Bjf,KAAKygB,IAAI8rF,YAAY9pD,GACvB,CACF,KACK,CACL,GAAIuY,EACF,UAAWvY,MAASziD,KAAK+kQ,aACvB,GAC+B,IAA7B/kQ,KAAK+kQ,aAAan7P,QAClB64C,GAAM72C,OAAOm1F,WAAW,QACxB,CACA,MAAM9hF,GAAQjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAClCziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,GAC1Bjf,KAAKygB,IAAI8rF,YAAY9pD,GACvB,CAGJziD,KAAK+kQ,aAAe,EACtB,CACA,UAAWtiN,MAASziD,KAAK8/C,OACnB2C,GAAM72C,OAAOm1F,WAAW,SAC1B3xD,IAGJpvC,KAAK+sK,aAAe,CAACluE,GAAUvjC,MAC7B,MAAM4qB,GAAe37E,EAAS,GAAW27E,YACzC,OAAO,IAAIge,KAAc,CACvBnY,MAAO,IAAImY,IAAe,CACxB7J,OAAQnU,GACJlmF,KAAKg7D,OACL9uC,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,GAAY,IACvC5qB,QACAt5D,EACJw5E,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,4BAET6vE,OAAQ,IAAI8oB,IAAe,CACzBhlE,MAAO,EACP3zB,MAAO,aAGX6vE,OAAQ,IAAI8oB,IAAe,CACzBhlE,MAAO,EACP3zB,MAAO,WAETiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,6BAEV,EAEHvL,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACNu/C,WAAW,IAEZh/C,QAAK6lD,MAAK,IACV/mD,UAAWwzB,KACV,MAAMurE,GAAU5hG,KAAKq6D,aAAawkD,YAAY,CAC5C1pD,oBAAoB,EACpBvpD,MAAQ,QACNwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ4N,UAAW,CAAE9J,SAAS,GACtB41N,UAAW,CACT78I,KACE1pH,KAAKwD,OAASovK,MAAkBC,WAC5B/nK,EAAQusB,WAAWqyF,UACnB1nH,GAERyhB,OAAQ4S,GACRQ,SAAS,IAEL2vO,GAAaj8P,EAASkW,IAAK0lB,OACxBi7D,OAAYj7D,GAAGnmC,KAAKygB,IAAIuhC,aAEjC,GAAIhiD,KAAKwD,OAASovK,MAAkBC,WAAY,CAC9C,MAAMrvK,GACJxD,KAAKwD,OAASovK,MAAkBh8C,MAAQ,SAAW,WACrD4vI,GAAW,GAAGnmQ,IAAI,MAAO,QAAQ,GACjCmmQ,GAAW,GAAGnmQ,IAAI,OAAQmD,IAAM,EAClC,CACW6yB,GAAWgrB,GACnBwa,YAAY2qM,IACf5kK,GAAQvgD,GAAG4iD,SAASjkG,KAAK+sK,cACzB/sK,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK+kQ,aAAaz9P,KAAKs6F,IACvB5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAMQypP,iBAAiB77P,EAAqB2H,GAC5C,IAAIk9B,EAAI,EACR,GAAI7kC,EAASX,OAAQ,CACnB,QAAiB5H,IAAbhC,KAAKygB,IACP,OAEF,UAAWgiC,KAASziD,KAAK8/C,OACnB2C,EAAM72C,OAAOm1F,WAAWx2F,EAAS,GAAG8T,KAAKzS,QAC3CwjC,IAGJpvC,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,UACN0O,KACA6wC,WAAW,EACXqY,SAAU,IACV/8C,KAAM,CACJzS,MAAO,aAGV7H,QAAK6lD,MAAK,IACV/mD,UAAWwzB,IACV,MAAM1qB,GAAOpB,EAAS,GAAG8T,KAAK1S,KAC9B,IAAIwK,GAIFA,GAHGxK,IAGK3L,KAAKymQ,cAAc96P,MAF3BwK,EAAQokF,SAKV,MAAMqH,GAAU5hG,KAAKq6D,aAAawkD,YAAY,CAC5C1pD,oBAAoB,EACpBvpD,MAAQrB,EAAS,GAAG8T,KAAKzS,MACvB,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJppB,OAAQ4S,EACRQ,SAAS,EACT1gB,WAGIqwP,GAAaj8P,EAASkW,IAAK3V,OACxBs2F,OAAYt2F,GAAS9K,KAAKygB,IAAIuhC,aAE5B3rB,EAAWgrB,GACnBsC,YAAYkY,YAAY2qM,IACvBxmQ,KAAK8/C,OAAO19B,KAAMqgC,IAAUA,GAAMvwC,KAAO0vF,GAAQ1vF,MACnDlS,KAAKygB,IAAI8rF,YACPvsG,KAAK8/C,OAAO19B,KAAMqgC,IAAUA,GAAMvwC,KAAO0vF,GAAQ1vF,KAEnDk9B,GAAQ,EACRwyD,GAAQh2F,MAASrB,EAAS,GAAG8T,KAAKzS,MAChC,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ+0D,GAAQ/hG,QAAQ+L,MAAQg2F,GAAQh2F,OAElC5L,KAAKglQ,SAAW51N,EAChBpvC,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK0mQ,UAAU9kK,IACf5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAEQ8pP,cAAc96P,GACpB,IAAIwK,EACJ,OAAAnW,KAAK6kQ,gBAAgB8B,gBAAgBh7P,GAAM9I,UAAW+jQ,IACpD,MAAMC,EAAgB,IAAI53J,cAC1B23J,EAAO9oG,aAAa,QAAS,MAC7B8oG,EAAO9oG,aAAa,SAAU,MAC9B8oG,EAAO9oG,aAAa,OAAQ,qBAC5B8oG,EAAO9oG,aAAa,SAAU,SAC9B,MAAM/2H,GAAM8/N,EAAc33J,kBAAkB03J,GAC5CzwP,EAAQ,IAAI+tF,KAAc,CACxBnY,MAAO,IAAImY,KAAa,CACtB37D,IAAK,2BAA6BxB,MAErC,GAEI5wB,CACT,CAIQkwP,iBAAiB97P,EAAqB2H,GAC5C,IAAIk9B,EAAI,EACR,GAAI7kC,EAASX,OAAQ,CACnB,QAAiB5H,IAAbhC,KAAKygB,IACP,OAEF,UAAWgiC,KAASziD,KAAK8/C,OACnB2C,EAAM72C,OAAOm1F,WAAWx2F,EAAS,GAAG8T,KAAKzS,QAC3CwjC,IAGJpvC,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACN0O,KACA6wC,WAAW,IAEZh/C,QAAK6lD,MAAK,IACV/mD,UAAWwzB,IACV,MAAMurE,GAAU5hG,KAAKq6D,aAAawkD,YAAY,CAC5C1pD,oBAAoB,EACpBvpD,MAAQrB,EAAS,GAAG8T,KAAKzS,MACvB,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJppB,OAAQ4S,EACRQ,SAAS,IAEL2vO,GAAaj8P,EAASkW,IAAK3V,OACxBs2F,OAAYt2F,GAAS9K,KAAKygB,IAAIuhC,aAE5B3rB,EAAWgrB,GACnBwa,YAAY2qM,IACXxmQ,KAAK8/C,OAAO19B,KAAMqgC,IAAUA,GAAMvwC,KAAO0vF,GAAQ1vF,MACnDlS,KAAKygB,IAAI8rF,YACPvsG,KAAK8/C,OAAO19B,KAAMqgC,IAAUA,GAAMvwC,KAAO0vF,GAAQ1vF,KAEnDk9B,GAAQ,EACRwyD,GAAQh2F,MAASrB,EAAS,GAAG8T,KAAKzS,MAChC,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ+0D,GAAQ/hG,QAAQ+L,MAAQg2F,GAAQh2F,OAElC5L,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK0mQ,UAAU9kK,IACf5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAEA2pP,oBAAoBx7P,GAClB,GAAIA,EAAS,CACX,MAAM6hF,EAAY3sF,KAAK23B,OAAO8kD,YAAY3xE,EAAS,CACjD25C,eAAgB35C,EAAQk3C,WACxB0C,kBAAmB1kD,KAAKygB,IAAIuhC,cAE9B8hD,SACE9jG,KAAKygB,IAAIyhC,eACT,CAACyqC,GACDkO,MAAcsG,KAElB,CACF,CAEAulK,UAAUjkN,GACR,UAAWL,KAAOpiD,KAAK+kQ,aACrB,GAAI3iN,EAAIlwC,KAAOuwC,EAAMvwC,GACnB,OAIJlS,KAAK+kQ,aAAaz9P,KAAKm7C,EACzB,4CAplBWmiN,IAA0BxjQ,MAAAuE,OAAAvE,MAAAwE,OAAAxE,MAAAwE,OAAAxE,MAAAwE,OAAAxE,MAAAyE,IAAAzE,MAAA0E,OAAA1E,MAAA2E,OAAA3E,MAAA4E,IAAA5E,MAAAuT,IAAAvT,MAAAyT,IAAAzT,aAAA,+BAA1BwjQ,GAA0Bt2P,UAAA,8BAAAC,OAAA,CAAA/K,KAAA,OAAA2wK,SAAA,WAAAs3B,qBAAA,wBAAAh9L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,mfAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDvFvC1N,MAAA,+BAUEA,MALA,qBAAAqW,IAAA,OAAa1I,EAAAq2P,cAAA3tP,GAAqB,EAKlCrW,CALmC,0BAAAqW,IAAA,OACjB1I,EAAAs2P,mBAAA5tP,GAA0B,EAI5CrW,CAJ6C,sBAAAqW,IAAA,OAC/B1I,EAAA6lM,aAAAn9L,GAAoB,EAGlCrW,CAHmC,gCAAAqW,IAAA,OACX1I,EAAA6lM,aAAAn9L,IAAqB,EAAK,EAElDrW,CAFmD,wBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAEnDrW,CADgC,6BAAAqW,IAAA,OAAA1I,EAAA6jI,YAAAn7H,EAAA,GAGlCrW,QAEAA,MAAA,+BAuBEA,MAbA,uBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAaArW,CAb+B,uBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAa/BrW,CAZ+B,6BAAAqW,IAAA,OAAA1I,EAAA6jI,YAAAn7H,EAAA,EAY/BrW,CAX0C,2BAAAqW,IAAA,OAAA1I,EAAA08L,qBAAAh0L,EAAA,EAW1CrW,CAViD,yBAAAqW,IAAA,OAAA1I,EAAA63H,KAAAnvH,EAAA,EAUjDrW,CAT+B,gCAAAqW,IAAA,OACP1I,EAAA6lM,aAAAn9L,IAAqB,EAAK,EAQlDrW,CARmD,0BAAAqW,IAAA,OAAA1I,EAAAolK,SAAA18J,EAAA,EAQnDrW,CAPoC,0BAAAqW,IAAA,OAAA1I,EAAAwiM,UAAA95L,EAAA,EAOpCrW,CANqC,iCACrB2N,EAAA42P,uBAAuB,EAKvCvkQ,CALwC,qCACpB2N,EAAA+2P,UAAU,EAI9B1kQ,CAJ+B,qCACX2N,EAAA82P,sBAAsB,EAG1CzkQ,CAH2C,2BACjC2N,EAAAu2P,oBAAoB,EAE9BlkQ,CAF+B,kCACd2N,EAAAyrC,mBAAmB,EACpCp5C,CADqC,wBAAAqW,IAAA,OACrB1I,EAAAyrC,kBAAA/iC,GAAyB,GAE3CrW,QACAA,MAAA,EAAA0lQ,GAAA,8CApCE1lQ,MAHA,QAAA2N,EAAAm2P,iBAGA9jQ,CAH0B,oBAAA2N,EAAAohM,UAG1B/uM,CAF+B,OAAA2N,EAAA63H,KAE/BxlI,CADa,SAAA2N,EAAAg2P,cAYb3jQ,QAQAA,MARA,OAAA2N,EAAAvL,KAQApC,CARa,YAAA2N,EAAAohM,UAQb/uM,CAPuB,MAAA2N,EAAA0R,IAOvBrf,CANW,OAAA2N,EAAA63H,KAMXxlI,CALa,UAAA2N,EAAAq7G,QAKbhpH,CAJmB,QAAA2N,EAAAmB,MAInB9O,CAHe,SAAA2N,EAAAg2P,aAGf3jQ,CAFuB,YAAA2N,EAAA+wC,OAEvB1+C,CADoB,iBAAA2N,EAAAshM,gBAkBPjvM,cAAA,OAAAA,MAAA,KAAA2N,EAAAk2P,mCCuCXhwD,MACAtF,MAEAnxG,MACArvF,KACAO,MAASG,OAAA,8KAAAC,gBAAA,KAGA80P,MAA0BniO,OAAA,IAvBtC8U,OAAc,CACbvoB,KAAM,gBACNpjB,MAAO,sCACPD,KAAMu7B,QACP,EACD7D,GAAAC,IAAA,qBA4D6BwE,MACKorI,MACHz+F,MACLgqC,MACJs+I,GACMl0L,MACCrE,MACE05L,GACRM,GACK0E,GACT3/N,SApDNqhO,ICpEN,IAAMmC,GAAN,MAAMA,GACXhnQ,cAAe,4CADJgnQ,GAAuB,+BAAvBA,GAAuBz4P,UAAA,2BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,kCAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GCnBpC1N,MAAA,2CDiBY+5M,MAAyBG,OAA8B94K,cAAA,KAEtDukO,MAAuBtkO,OAAA,IAXnC8U,OAAc,CACbvoB,KAAM,aACNpjB,MAAO,mCACPD,KAAM,aACP,EAAC03B,GAAAC,IAAA,yBAOWyjO,6DElBX3lQ,MADF,kBACEA,CAD8C,oCAI5CA,MAAA,2DASEA,MAFA,sBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAw8M,YAAArwM,GAAyB,EAEvCrW,CAFwC,+BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAEjBkK,GAAAm4M,oBAAAhsM,GAA2B,GAGtDrW,UACAA,MAAA,oCAGEA,MAAA,iCAEJA,kCApBIA,cAAA,QAAAA,MAAA,2DAGEA,MAAA,GAOAA,MAPA,aAAAA,MAAA,KAAAkK,EAAAq1P,aAAArkN,UAAAW,IAOA77C,CAPkD,MAAAkK,EAAAmV,IAOlDrf,CANW,kBAAAkK,EAAA63M,gBAMX/hN,CALmC,yBAAAkK,EAAAohI,uBAKnCtrI,CAJiD,QAAAkK,EAAAywO,eAIjD36O,CAHwB,eAAAA,MAAA,KAAAkK,EAAAmzP,kBAAAL,eAGxBh9P,CAFwD,iBAAAkK,EAAAmzP,kBAAAj7C,gBAQ1DpiN,MAAA,GAAAA,MAAA,QAAAA,MAAA,8DAE2BA,MAAA,GAAAA,MAAA,MAAAkK,EAAAmV,+CAI/Brf,MAAA,2DAQEA,MAFA,sBAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAAckK,GAAAw8M,YAAArwM,GAAyB,EAEvCrW,CAFwC,+BAAAqW,GAAArW,MAAAkL,GAAA,MAAAhB,GAAAlK,QAAA,OAAAA,MAEjBkK,GAAAm4M,oBAAAhsM,GAA2B,GAEpDrW,gCAHEA,MALA,aAAAA,MAAA,IAAAkK,EAAAq1P,aAAArkN,UAAAW,IAKA77C,CALkD,MAAAkK,EAAAmV,IAKlDrf,CAJW,QAAAkK,EAAAywO,eAIX36O,CAHwB,eAAAA,MAAA,IAAAkK,EAAAmzP,kBAAAL,eAGxBh9P,CAFwD,iBAAAkK,EAAAmzP,kBAAAj7C,0CAO1DpiN,MAAA,sDAEEA,MAAA,MAAAkK,EAAAmV,MCWK,IAAMumP,GAAN,MAAMA,GAqBDrJ,SACDc,kBACCqG,eACDnE,aAvBAj0H,uBAEAy2E,iBAA2B,EAMpC,OAAI1iM,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,kBAAIs7N,GACF,OAAO/7O,KAAK8kQ,eAAe50P,KAC7B,CAES+2P,iBAAqCjJ,GAAiBv7M,MACtDykN,0BAAoC,EAE7CnnQ,YACU49P,EACDc,EACCqG,EACDnE,GAHC3gQ,KAAA29P,WACD39P,KAAAy+P,oBACCz+P,KAAA8kQ,iBACD9kQ,KAAA2gQ,cACN,CAEHpzP,WACEvN,KAAKmnQ,aACLnnQ,KAAKujN,YACP,CAEQ4jD,aACFnnQ,KAAKinQ,kBACPjnQ,KAAKy+P,kBAAkBN,kBAAkBx7P,KAAK3C,KAAKinQ,kBAErD,MAAMG,EAAmBpnQ,KAAKy+P,kBAAkBN,kBAAkBz3P,MAEhE1G,KAAKy+P,kBAAkBJ,yBADAr8P,IAArBolQ,EACyCA,EAEApJ,GAAiBv7M,MAEhE,CAEQ8gK,aACN,MAAM8jD,EAAmBrnQ,KAAKy+P,kBAAkBL,cAAc13P,MAE5D1G,KAAKy+P,kBAAkBH,aADAt8P,IAArBqlQ,EAC6BA,EAEApJ,GAAiBz2M,OAEpD,CAEOsgK,YAAYv1M,GACjBvS,KAAKy+P,kBAAkBH,QAAQ/rP,EACjC,CAEOkxM,oBAAoBG,GACzB5jN,KAAKy+P,kBAAkBF,kBAAkB36C,EAC3C,CAEA0jD,uBAAuB59O,GACrB1pB,KAAKinQ,iBAAmBv9O,EAAMhjB,KAChC,4CA/DWsgQ,IAAyB5lQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,IAAA,+BAAzBkhQ,GAAyB14P,UAAA,6BAAAC,OAAA,CAAAm+H,uBAAA,yBAAAy2E,gBAAA,kBAAA8jD,iBAAA,mBAAAC,yBAAA,4BAAAz4P,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,gZAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GDbtC1N,MApCA,EAAAmmQ,GAAA,uBAoCAnmQ,CApCgD,EAAAomQ,GAAA,0BAoChDpmQ,CAHC,EAAAqmQ,GAAA,yCAjCermQ,MAAA,OAAA2N,EAAAm4P,0BAyBb9lQ,cAAA,QAAA2N,EAAAm4P,0BAAA,UAAAn4P,EAAAk4P,kBAYA7lQ,cAAA,QAAA2N,EAAAm4P,0BAAA,YAAAn4P,EAAAk4P,kCCIC93P,KACAgrD,MAAap0D,YACbw8M,MACAt5J,MACAv5C,KACAC,MAAiB3J,OAAA6J,OAAA,kDAAAC,gBAAA,KAGRk3P,MAAyBvkO,OAAA,IApBrC8U,OAAc,CACbvoB,KAAM,eACNpjB,MAAO,qCACPD,KAAM,eACP,EAAC03B,GAAAC,IAAA,qBAqCoBy5N,GACQmB,GACFgF,GACHhD,MAxBZ8G,iIC9CP5lQ,MADF,sBACEA,CADsE,eAC3DA,MAAA,wBAETA,QACFA,MAAA,wCAWFA,8BAdaA,MAAA,GAAAA,YAAA,mEAQTA,MAAA,GAIAA,MAJA,cAAAA,MAAA,kEAIAA,CADC,QAAAkK,EAAA46E,YAAA,+BAKH9kF,MAAA,uBACEA,MAAA,wCAWFA,8BANIA,QAIAA,MAJA,cAAAA,MAAA,kEAIAA,CADC,QAAAkK,EAAA46E,YAAA,+BAOL9kF,MADF,sBACEA,CADuE,eAC5DA,MAAA,wBAETA,QACFA,MAAA,wCAWFA,8BAdaA,MAAA,GAAAA,YAAA,mEAQTA,MAAA,GAIAA,MAJA,cAAAA,MAAA,kEAIAA,CADC,QAAAkK,EAAA46E,YAAA,+BAKH9kF,MAAA,uBACEA,MAAA,wCAWFA,8BANIA,QAIAA,MAJA,cAAAA,MAAA,mEAIAA,CADC,QAAAkK,EAAA46E,YAAA,8CA0BD9kF,MAAA,mBAIEA,MAAA,iBAAAqW,GAAArW,aAAAkL,GAAAlL,MAASqW,EAAAgX,kBAAwB,GAEjCrtB,MAAA,GACFA,oCAJEA,MAAA,QAAA4+M,GAGA5+M,cAAA,IAAA4+M,EAAA0nD,iBAAA1nD,EAAAtiI,MAAA,MCvBL,IAAMiqL,GAA4B,MAAnC,MAAOA,EAqCFhK,SACCh8P,gBACAC,eACAmQ,MACAoqC,eACAl8C,OACAu1B,YA1CHoyO,gBAA2C,IAAI7lQ,IAAgB,IAC/Dw+M,aACL,IAAIx+M,IAAgB,IACfo+B,KACA+lD,YACC2hL,yBACDnmN,OACComN,WAAqB,EACrBC,WAAa,CAAE,OAAO,EAAM,MAAM,GAClCvuM,WACAwuM,aACA5kD,wBAAyD,GACzDJ,uBACAilD,YACAC,aAAe,CAAEn7H,SAAK/qI,EAAWgrI,SAAKhrI,GACvC2wE,OAAiB,EACxB,OAAIlyD,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,aAAI4oC,GACF,OAAOrpD,KAAKmgC,KAAKjgC,IAAI,aAAawG,KACpC,CACA,aAAI2iD,CAAU3iD,GACZ1G,KAAKmgC,KAAKkyJ,WAAW,CAAEhpI,UAAW3iD,GACpC,CACA,0BAAIgmI,GACF,OAAO1sI,KAAKojN,yBAA2B,EACzC,CAEA,0BACI12E,CAAuBhmI,GACzB1G,KAAKojN,wBAA0B18M,CACjC,CAEA3G,YACS49P,EACCh8P,EACAC,EACAmQ,GACAoqC,GACAl8C,GACAu1B,IANDx1B,KAAA29P,WACC39P,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAA+R,SACA/R,KAAAm8C,kBACAn8C,KAAAC,UACAD,KAAAw1B,eAERx1B,KAAKioQ,YAAc,CACjBP,gBAAiB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9C,6CACA,CAAE68E,KAAM,cAEVu2F,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,GACNsF,SAAKlqI,EACLwuE,YAAQxuE,GAEVhC,KAAK0hD,OAAS1hD,KAAKm8C,eAAej8C,IAAI,gBACtCF,KAAKqjN,qBACLrjN,KAAK0pD,WACP,CAKAn8C,WACEvN,KAAKw5D,WAAax5D,KAAKygB,IAAIyhC,eAAewX,OACvC31D,QAAKof,MAAa,KAClBtgB,UAAU,KACT7C,KAAKmoQ,cAAcnoQ,KAAKygB,KACxBzgB,KAAKooQ,mBAAiB,GAG1BpoQ,KAAKgoQ,aAAehoQ,KAAKmgC,KAAK5H,aAAa11B,UAAU,KACnD7C,KAAKooQ,mBAAiB,GAGxB,MAAMC,EAAgBroQ,KAAKm8C,eAAej8C,IACxC,qBAQF,GALAF,KAAKqpD,UACHrpD,KAAKugN,aAAa75M,MAAM0b,KACrBw5H,GAAQA,EAAIlyB,OAAS1pH,KAAKioQ,YAAYv+I,OACpC1pH,KAAKugN,aAAa75M,MAAM,GAET,OAAlB2hQ,EAAwB,CAC1B,MAAMzhL,EAAM5mF,KAAKsoQ,eAAeD,GAChCroQ,KAAKqpD,UAAYrpD,KAAKugN,aAAa75M,MAAMkgF,GACzC5mF,KAAKuoQ,kBACP,CACAvoQ,KAAKygB,IAAIwvG,WAAWttH,KAAK3C,KAAK0hD,QAC9B1hD,KAAKkmF,YAAclmF,KAAK6hD,iBACxB7hD,KAAK6nQ,yBAA2B7nQ,KAAKygB,IAAIyhC,eAAeN,UACtD5hD,KAAKioQ,YAAYv+I,KAErB,CAEAx7G,cACElO,KAAKygB,IAAIwvG,WAAWttH,MAAK,GACzB3C,KAAKw5D,WAAWrrD,cAChBnO,KAAKgoQ,aAAa75P,aACpB,CAEAg6P,cAAc1nP,GACZzgB,KAAK4nQ,gBAAgBjlQ,KACnB,cAAaonI,OAAYtpH,EAAIyhC,eAAe02E,YAEhD,CAKA/2E,iBAGE,IAAI0uB,EAFJvwE,KAAKkoQ,aAAal7H,OAAMX,OAAQrsI,KAAK6nQ,yBAAyB,IAC9D7nQ,KAAKkoQ,aAAan7H,OAAMP,OAAQxsI,KAAK6nQ,yBAAyB,IAE9D,MAAMn+I,EAAO1pH,KAAKqpD,UAAUqgE,KAC5B,IAAI6f,EAAU,EACd,OAAI7f,EAAK1xF,SAAS,cAAgB0xF,EAAK1xF,SAAS,gBAC9CuxG,EAAU,GAEZvpI,KAAK2yE,MAAiB,cAAT+2C,GAAiC,cAATA,EACrCn5C,EAAQvwE,KAAKygB,IAAIyhC,eACdN,UAAU8nE,GACVjpG,IAAKuZ,IAAMA,GAAEg8B,QAAQuzE,IACjBh5D,CACT,CAEA63L,oBACEpoQ,KAAK6nQ,yBAA2B7nQ,KAAKygB,IAAIyhC,eAAeN,UACtD5hD,KAAKioQ,YAAYv+I,MAEnB,MAAM8+I,KAAiBn8H,OAAQrsI,KAAK6nQ,yBAAyB,IACvDY,KAAiBj8H,OAAQxsI,KAAK6nQ,yBAAyB,KACxD7nQ,KAAK8nQ,WAAaU,IAAmBxoQ,KAAKkoQ,aAAal7H,KAC1DhtI,KAAK0oQ,cAEP,IAAIj0D,GAAa,EACb+zD,IAAmBxoQ,KAAKkoQ,aAAal7H,MACvChtI,KAAKkoQ,aAAal7H,IAAMw7H,EACxB/zD,GAAa,GAEXg0D,IAAmBzoQ,KAAKkoQ,aAAan7H,MACvC/sI,KAAKkoQ,aAAan7H,IAAM07H,EACxBh0D,GAAa,GAEXA,GACFz0M,KAAK2oQ,8BAEP3oQ,KAAK4oQ,aAAa5oQ,KAAK6nQ,0BACvB7nQ,KAAKkmF,YAAclmF,KAAK6hD,iBAExB7hD,KAAKm8C,eAAe97C,IAClB,oBACAL,KAAKqpD,UACLziD,KAAaulE,QAEjB,CAKA1gB,sBACqBC,MAAUC,KAAK3rD,KAAKkmF,YAAY/tB,aAEjDn4D,KAAK4B,eAAe6oD,QAClB,iEACA,mEAGN,CAKAo+M,cAAc5xP,GACZjX,KAAK0hD,OAASzqC,EACdjX,KAAKygB,IAAIwvG,WAAWttH,KAAKsU,GACzBjX,KAAKm8C,eAAe97C,IAAI,eAAgB4W,EAAQrQ,KAAaulE,QAC/D,CAKQziB,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjCooB,UAAW,CAAC,GAAI,CAACtkB,KAAW/C,YAEhC,CAKQ2mO,8BACN,IAAIG,EAAe9oQ,KAAKugN,aAAa75M,MACrC,MAAM6kB,EAAYvrB,KAAK2B,gBAAgB4pB,UACvCu9O,EAAaroP,IAAK9W,IAChB,GAAuB,QAAnBA,EAAEs2M,aAAwB,CAC5B,MAAMr5E,MAAOyF,OAAQrsI,KAAK6nQ,yBAAyB,IACnD,GAAIjhI,GAAM,CACR,MAAMld,GAAOkd,GAAO,GAAK,YAAYA,KAAS,WAAW,GAAKA,KAC9Dj9H,EAAE+zE,MAAQ,OAAOkpD,KACjBj9H,EAAE+/G,KAAOA,GACT//G,EAAEi9H,KAAO,GAAGA,KACZj9H,EAAE+9P,gBAAkBn8O,EAAUshB,QAC5B,2CACAljC,EAEJ,MACEA,EAAE+zE,MAAQ,GACV19E,KAAK8nQ,WAAY,EACmB,QAAhC9nQ,KAAKqpD,UAAU42J,eACjBjgN,KAAKqpD,UAAYrpD,KAAKugN,aAAa75M,MAAM,GAG/C,CACA,GAAuB,QAAnBiD,EAAEs2M,aAAwB,CAC5B,MAAMr5E,MAAO4F,OAAQxsI,KAAK6nQ,yBAAyB,IAC7Cn+I,GAAO,WAAWkd,KACxBj9H,EAAE+zE,MAAQ,OAAOkpD,KACjBj9H,EAAE+/G,KAAOA,GACT//G,EAAEi9H,KAAO,GAAGA,KACZj9H,EAAE+9P,gBAAkBn8O,EAAUshB,QAC5B,2CACAljC,EAEJ,IAEFm/P,EAAeA,EAAap/P,OAAQC,GAAkB,KAAZA,EAAE+zE,OAC5C19E,KAAKugN,aAAa59M,KAAKmmQ,EACzB,CAKQzlD,qBACNrjN,KAAKgjN,0BAAyBv2E,OAC5BzsI,KAAK0sI,wBAEP,MAAMlC,EAAkC,GAEnCxqI,KAAK6nQ,2BACR7nQ,KAAK6nQ,yBAA2B7nQ,KAAKygB,IAAIyhC,eAAeN,UACtD5hD,KAAKioQ,YAAYv+I,OAIrB,MAAMn+F,EAAYvrB,KAAK2B,gBAAgB4pB,UA6CvC,GA5CIvrB,KAAKgjN,uBAAuBn2E,OAC9BrC,EAAYljI,KAAK,CACfogQ,gBAAiBn8O,EAAUshB,QACzB,6CACA,CAAE68E,KAAM,cAEVu2F,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,GACNsF,SAAKlqI,EACLwuE,YAAQxuE,IAIRhC,KAAKgjN,uBAAuBp2E,OAC9BpC,EAAYljI,KAAK,CACfogQ,gBAAiBn8O,EAAUshB,QACzB,6CACA,CAAE68E,KAAM,cAEVu2F,aAAc,QACdviI,MAAO,QACPgsC,KAAM,YACNkd,KAAM,GACNsF,SAAKlqI,EACLwuE,YAAQxuE,IAIRhC,KAAKgjN,uBAAuBl2E,aAC9BtC,EAAYljI,KAAK,CACfogQ,gBAAiBn8O,EAAUshB,QACzB,mDACA,CAAE68E,KAAM,cAEVu2F,aAAc,cACdviI,MAAO,eACPgsC,KAAM,YACNkd,KAAM,GACNsF,SAAKlqI,EACLwuE,YAAQxuE,IAGRhC,KAAKgjN,uBAAuBh2E,IAAK,CAEnC,MAAMpG,MAAOyF,OAAQrsI,KAAK6nQ,yBAAyB,IACnD,GAAIjhI,GAAM,CACR5mI,KAAK8nQ,WAAY,EACjB,MAAMp+I,GAAOkd,GAAO,GAAK,YAAYA,KAAS,WAAW,GAAKA,KAC9D4D,EAAY3kH,OAAO,EAAG,EAAG,CACvB6hP,gBAAiB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9C,2CACA,CAAE68E,QAAMkd,UAEVq5E,aAAc,MACdviI,MAAO,OAAOkpD,KACdld,QACAkd,KAAM,GAAGA,KACTsF,SAAKlqI,EACLwuE,YAAQxuE,GAEZ,MACEhC,KAAK8nQ,WAAY,CAErB,CACA,GAAI9nQ,KAAKgjN,uBAAuBj2E,IAAK,CACnC,MAAMunB,GAAQt0J,KAAK8nQ,UAAY,EAAI,EAC7BlhI,MAAO4F,OAAQxsI,KAAK6nQ,yBAAyB,IAC7Cn+I,GAAOkd,GAAO,GAAK,YAAYA,KAAS,WAAWA,KACzD4D,EAAY3kH,OAAOyuI,GAAO,EAAG,CAC3BozG,gBAAiB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9C,2CACA,CAAE68E,QAAMkd,UAEVq5E,aAAc,MACdviI,MAAO,OAAOkpD,KACdld,QACAkd,KAAM,GAAGA,KACTsF,SAAKlqI,EACLwuE,YAAQxuE,GAEZ,CACA,IAAImiN,EAAuC,GACvCnkN,KAAKgjN,uBAAuBr2E,iBAC9Bw3E,EAAoBnkN,KAAKC,OAAOG,UAAU,gBACxC,IAGJJ,KAAKugN,aAAa59M,KAAKwhN,EAAiBxjM,OAAO6pH,GACjD,CAMQu+H,QAAQv+H,GACd,GAAIxqI,KAAKgjN,uBAAuBh2E,IAAK,CACnC,MAAMpG,KAAOyF,OAAQrsI,KAAK6nQ,yBAAyB,IAC7Cn+I,EAAOkd,EAAO,GAAK,YAAYA,IAAS,WAAW,GAAKA,IAC9D4D,EAAY3kH,OAAO,EAAG,EAAG,CACvB6hP,gBAAiB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9C,2CACA,CAAE68E,OAAMkd,SAEVq5E,aAAc,MACdviI,MAAO,OAAOkpD,IACdld,OACAkd,KAAM,GAAGA,IACTsF,SAAKlqI,EACLwuE,YAAQxuE,GAEZ,CACF,CAMQ0mQ,cAEN1oQ,KAAK+oQ,QADe/oQ,KAAKugN,aAAa75M,OAEtC1G,KAAK8nQ,WAAY,CACnB,CAKQS,mBACN,GAAoC,QAAhCvoQ,KAAKqpD,UAAU42J,aAAwB,CACzC,MAAMr5E,KAAOyF,OAAQrsI,KAAK6nQ,yBAAyB,IACnD7nQ,KAAKqpD,UAAUq0B,MAAQ,OAAOkpD,IAC9B,MAAMld,EAAOkd,EAAO,GAAK,YAAYA,IAAS,WAAW,GAAKA,IAC9D5mI,KAAKqpD,UAAUqgE,KAAOA,EACtB1pH,KAAKqpD,UAAUu9E,KAAO,GAAGA,IACzB5mI,KAAKqpD,UAAUq+M,gBAAkB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9D,2CACA,CAAE68E,OAAMkd,QAEZ,CACA,GAAoC,QAAhC5mI,KAAKqpD,UAAU42J,aAAwB,CACzC,MAAMr5E,KAAO4F,OAAQxsI,KAAK6nQ,yBAAyB,IACnD7nQ,KAAKqpD,UAAUq0B,MAAQ,OAAOkpD,IAC9B,MAAMld,EAAOkd,EAAO,GAAK,YAAYA,IAAS,WAAWA,IACzD5mI,KAAKqpD,UAAUqgE,KAAOA,EACtB1pH,KAAKqpD,UAAUu9E,KAAO,GAAGA,IACzB5mI,KAAKqpD,UAAUq+M,gBAAkB1nQ,KAAK2B,gBAAgB4pB,UAAUshB,QAC9D,2CACA,CAAE68E,OAAMkd,QAEZ,CACF,CAOA0hI,eAAeD,GACb,MAAMW,EAAKX,EAAcpoD,aACnBviI,EAAQ2qL,EAAc3qL,MAC5B,IAAIruC,GACA45N,GAAO,EACX,OAAAjpQ,KAAKugN,aAAa75M,MAAM+Z,IAAKuhC,KACvBgnN,EACEA,IAAOhnN,GAAWi+J,eACpB5wK,GAAW45N,IAEJvrL,IAAU17B,GAAW07B,QAC9BruC,GAAW45N,IAEbA,OAEF55N,GAAWA,IAAsB,EAC1BA,EACT,CAMAu5N,aAAa1iL,IACgBlmF,KAAKC,OAAOG,UAAU,gBAAkB,IAChDma,QAASynC,IAC1B,IAAI8mN,GAAe9oQ,KAAKugN,aAAa75M,MACrC,MAAM8pE,GAASxuB,EAAWwuB,OACpBk5C,GAAO1nE,EAAW0nE,KAAKxuF,MAAM,OAC7BguO,GAAmBz4L,MACvBD,GACAxuB,EAAW0nE,KACX1pH,KAAKioQ,YAAYv+I,MAGjBxjC,EAAY,GAAKgjL,GAAiB,IAClChjL,EAAY,GAAKgjL,GAAiB,IAClChjL,EAAY,GAAKgjL,GAAiB,IAClChjL,EAAY,GAAKgjL,GAAiB,IAElClpQ,KAAK+nQ,WAAWr+I,KAAQ,EACpB1pH,KAAKqpD,UAAUq0B,QAAU17B,EAAW07B,QACtC19E,KAAKqpD,UAAYrpD,KAAKugN,aAAa75M,MAAM,IAE3CoiQ,GAAeA,GAAap/P,OAAQC,IAAMA,GAAE+zE,QAAU17B,EAAW07B,OACjE19E,KAAKugN,aAAa59M,KAAKmmQ,KAElB9oQ,KAAK+nQ,WAAWr+I,MACnB1pH,KAAKugN,aAAa59M,KAAKmmQ,GAAanoP,OAAOqhC,IAC3ChiD,KAAK+nQ,WAAWr+I,KAAQ,IAIhC,4CA5cWi+I,GAA4BvmQ,MAAAuE,IAAAvE,MAAAwE,OAAAxE,MAAAyE,OAAAzE,mBAAA0E,MAAA1E,MAAA2E,OAAA3E,MAAA4E,MAAA,+BAA5B2hQ,EAA4Br5P,UAAA,+BAAAC,OAAA,CAAAm+H,uBAAA,0BAAAj+H,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,6vBAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,kBDpEvC1N,MADF,UACEA,CADuD,WAkDrDA,MAhDA,EAAA+nQ,GAAA,uBAgDA/nQ,CAhDwE,EAAAgoQ,GAAA,yBAAAhoQ,MAgDxEA,CAhCwB,EAAAioQ,GAAA,uBAgCxBjoQ,CAhByE,EAAAkoQ,GAAA,yBAAAloQ,OA+BzEA,MAAA,mCAOEA,MAAA,mBAAAA,aAAAyK,IAAAzK,MAAS2N,EAAA08C,sBAAqB,GAE9BrqD,MAAA,eAAUA,MAAA,mBAEdA,YAKMA,MAHN,YAGMA,CAH+D,WAG/DA,CAF4D,sBAE5DA,CADoE,gBACzDA,MAAA,0BAGTA,QACFA,MAAA,mBAAYA,MAAA,uBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAA2N,EAAAs6C,UAAA5xC,MAAA1I,EAAAs6C,UAAA5xC,IAAArW,MAAAqW,GAAA,GACVrW,MAAA,GAAAmoQ,GAAA,uCAUNnoQ,YAEEA,MADF,WACEA,CAD8D,0BAK5DA,MAAA,kBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAU2N,EAAA85P,cAAApxP,GAAAoW,SAA6B,GAEvCzsB,MAAA,0BAMNA,YAEAA,MAAA,WACEA,MAAA,0BAIFA,QACAA,MAAA,WACEA,MAAA,4CAIFA,QACAA,MAAA,WACEA,MAAA,6CAMJA,gDAjIqBA,MAAA,GAAaA,MAAb,OAAA2N,EAAA4jE,MAAavxE,CAAA,WAAAooQ,IAgCbpoQ,MAAA,GAAaA,MAAb,OAAA2N,EAAA4jE,MAAavxE,CAAA,WAAAqoQ,IAiC5BroQ,MAAA,iGAW8CA,MAAA,GAAAA,MAAA,YAAA2N,EAAAoxB,MAGjC/+B,MAAA,GAAAA,YAAA,6EAICA,MAAA,GAAAA,MAAA,QAAA2N,EAAAs6C,WAGejoD,cAAA,UAAAA,MAAA,MAAA2N,EAAAwxM,eAY3Bn/M,MAAA,GACAA,MADA,UAAA2N,EAAA2yC,OACAtgD,CADkB,0BAIlBA,cAAA,IAAAA,MAAA,4EASJA,MAAA,GAAAA,MAAA,IAAAA,MAAA,yEAAA2N,EAAA0R,IAAAyhC,eAAAH,UAAA,KAMA3gD,MAAA,GAAAA,MAAA,IAAAA,MAAA,0EAAAA,MAAA,MAAA2N,EAAA64P,iBAAA,KAMAxmQ,MAAA,GAAAA,MAAA,IAAAA,MAAA,+EAAAA,MAAA,MAAA2N,EAAA0R,IAAAyhC,eAAA4iD,gBAAA,8BCxEA31F,KACA8a,MAAkBtV,YAClBkoB,MAAchoB,MACdtF,MAAeuF,MACftF,MAAastB,MACbL,KAAWz2B,UACXu3B,KAAmBv3B,KACnBkkB,MAAe8S,MAAAE,MACfzoB,KACA0V,MACAwpE,MAAoBv2D,MACpB1tB,KACAg6P,KACA/5P,MAAiB0tB,OAAAxtB,OAAA,+mCAGR83P,CAA4B,8DCnDjCvmQ,MAAA,kBAGEA,MAAA,mBAAAA,MAAAkP,GAAAlP,QAAA,MAAAuoQ,EAAAvoQ,MAAA,GAAAsgC,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAkoO,eAAAD,GAAiB,GACzBvoQ,MAAA,GAAiBA,oCAFlBA,MAAA,QAAAwsN,GAECxsN,cAAAwsN,EAAAhiN,iDAhBLxK,MANN,UAMMA,CAHL,WAGKA,CAFsC,mBAEtCA,CADc,eACHA,MAAA,wBAGTA,QAEAA,MADF,iBACEA,CAD4C,oBACpBA,MAAA,mBAAAA,MAAAyK,GAAA,MAAA89P,EAAAvoQ,MAAA,GAAAsgC,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAmnB,UAAA8gN,GAAY,GAC3CvoQ,MAAA,yBAIFA,QACAA,MAAA,kBACAA,MAAA,GAAAyoQ,GAAA,oBAOJzoQ,UACAA,MAAA,yBAIEA,MAAA,kBAAAqW,GAAArW,MAAAyK,GAAA,MAAA61B,GAAAtgC,QAAA,OAAAA,MAAUsgC,GAAAooO,WAAAryP,EAAAoW,SAA0B,GAEpCzsB,MAAA,0BAGNA,oCA/ByBA,cAAA,YAAAsgC,EAAAvB,MAER/+B,MAAA,GAAAA,YAAA,sEAKGA,MAAA,GAAAA,MAAA,WACVA,MAAA,GAAAA,MAAA,IAAAA,MAAA,yEAOkBA,MAAA,GAAAA,MAAA,UAAAsgC,EAAAsnB,yBAStB5nD,QACAA,MADA,UAAAsgC,EAAAqoO,MACA3oQ,CADiB,0BAIjBA,cAAA,IAAAA,MAAA,+GAOFA,MADF,aACEA,CADQ,SAENA,MAAA,wBACFA,QACAA,MAAA,SACEA,MAAA,wBAGFA,QAEEA,MADF,kBACEA,CADa,iBACaA,MAAA,YAAMA,QAChCA,MAAA,cAGEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAsoO,aAAY,GAErB5oQ,MAAA,0BAKJA,UAEEA,MADF,mBACEA,CADa,kBACaA,MAAA,kBAAWA,QACrCA,MAAA,cAGEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAuoO,cAAa,GAEtB7oQ,MAAA,0BAKJA,UAEEA,MADF,mBACEA,CADa,kBACaA,MAAA,WAAIA,QAC9BA,MAAA,cAGEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,QAAA,OAAAA,MAASsgC,EAAAwoO,cAAa,GAEtB9oQ,MAAA,0BAMNA,kBA9CIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,mEAGAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,uEAWEA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0EAaAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,4EAaAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,6EClCD,IAAM+oQ,GAAsB,MAA7B,MAAOA,EAiBFxM,SACCv0M,eACA5zB,YACAspO,UAnBHiL,OAAiB,EACjBxgN,UACAP,wBACA7oB,KACA2f,OACAnC,IACAysN,aAKP,OAAI3pP,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACS49P,EACCv0M,EACA5zB,EACAspO,IAHD9+P,KAAA29P,WACC39P,KAAAopD,iBACAppD,KAAAw1B,cACAx1B,KAAA8+P,aAER9+P,KAAK0pD,WACP,CAMAn8C,WACEvN,KAAKygB,IAAI0hC,QAAQt/C,UACd44K,GACEz7K,KAAKgpD,wBAA0ByyH,EAAG/xK,OAChC+4C,IACEA,EAAMJ,WAAaI,EAAMkH,iBAAmBlH,EAAMwiE,WAG7D,CAMA/2G,cACElO,KAAK+pQ,OAAQ,EACb/pQ,KAAKygB,IAAIuhH,cAAcr/H,KAAK3C,KAAK+pQ,MACnC,CAKQrgN,YACN1pD,KAAKmgC,KAAOngC,KAAKw1B,YAAYyL,MAAM,CACjC6e,OAAQ,CAAC,GAAI,CAAC/a,KAAW/C,YAE7B,CAKA8nO,WAAW7yP,GACTjX,KAAK+pQ,MAAQ9yP,EACbjX,KAAKygB,IAAIuhH,cAAcr/H,KAAKsU,GAC5BjX,KAAKoqQ,aAAe,GACpB,UAAW3nN,KAASziD,KAAKmgC,KAAKz5B,MAAMo5C,OAClC9/C,KAAKoqQ,aAAa9iQ,KAAKm7C,GAEzBziD,KAAKygB,IAAIwhH,kBAAkBt/H,KAAK3C,KAAKoqQ,aACvC,CAKAR,eAAej+N,GACb3rC,KAAK8pQ,YAAW,GAChB9pQ,KAAK8pQ,YAAW,GACZn+N,EAAE9e,YACJ8e,EAAE9e,WAAY,GAGO7sB,KAAKmgC,KAAK7I,SAASwoB,OAAOp5C,MAAMkD,SADrC5J,KAAKgpD,wBAAwBp/C,SAG7C+hC,EAAE9e,WAAY,EAElB,CAKAg8B,UAAUld,GACJA,EAAE9e,WACJ7sB,KAAKmgC,KAAK7I,SAASwoB,OAAOvoB,SAASv3B,KAAKgpD,yBACxCrd,EAAE9e,WAAY,GAEd7sB,KAAKmgC,KAAK7I,SAASwoB,OAAOvoB,SAAS,IAErCv3B,KAAK8pQ,YAAW,GAChB9pQ,KAAK8pQ,YAAW,EAClB,CAKAE,aACEhqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,gBACtC,CAKAmzN,cACEjqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,UACtC,CAKAozN,cACElqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,iBACtC,4CAvHWqzN,GAAsB/oQ,MAAAuE,IAAAvE,MAAAwE,OAAAxE,MAAAyE,MAAAzE,MAAA0E,IAAA,+BAAtBqkQ,EAAsB77P,UAAA,yBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,4kBAAAC,SAAA,SAAAC,EAAAC,MAAA,EAAAD,GDTnC1N,MArCA,EAAAipQ,GAAA,cAqCAjpQ,CAlCC,EAAAkpQ,GAAA,2BAAAlpQ,8BAFwCA,MAAtC,OAAA2N,EAAAi6C,wBAAAp/C,OAAsCxI,CAAA,WAAAmpQ,oBC8BrCp7P,KACAstB,KAAW52B,eACX03B,KAAmB13B,UACnBokB,MAAkBlkB,YAClBmkB,MAAelkB,MAAA2O,MACfwV,MACA+gC,KAAgBr2C,KAChBJ,KACAk/E,MAAoB7+E,MACpB1F,MAAa0tB,wBACbttB,MAAawtB,MACbrtB,MAAiButB,OAAArtB,OAAA,o2CAIRs6P,CAAsB,KCZtBK,GAAN,MAAMA,GAQQ7M,SAPnB,aAAIrvI,GACF,OAAOtuH,KAAK29P,SAASl9O,IAAI28C,sBAAsBkxD,SACjD,CACA,mBAAIyF,GACF,OAAO/zH,KAAK29P,SAASl9O,IAAI28C,sBAAsB22D,eACjD,CAEAh0H,YAAmB49P,GAAA39P,KAAA29P,UAAqB,CAExC8M,eAAe/jQ,GACb1G,KAAK29P,SAASl9O,IAAI28C,sBAAsB4wD,SAAWtnH,CACrD,CAEAgkQ,aAAahkQ,GACX1G,KAAK29P,SAASl9O,IAAI28C,sBAAsBm3D,eAAiB7tH,CAC3D,4CAhBW8jQ,IAAwBppQ,MAAAuE,IAAA,+BAAxB6kQ,GAAwBl8P,UAAA,4BAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,sPAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IClCrC1N,MAAA,UACEA,MAAA,wBAGFA,QAEAA,MADA,uBACAA,CADyC,mBAEzCA,MAAA,UACEA,MAAA,wBAIFA,QAEAA,MADA,6BACAA,CADqD,mBAGrDA,MAAA,WACEA,MAAA,0BACFA,QAIIA,MAFJ,WAEIA,CAF6B,WAE7BA,CAD8C,2CAK5CA,MAAA,kBAAAqW,IAAA,OAAU1I,EAAA07P,eAAAhzP,GAAAoW,QAA8B,GAExCzsB,MAAA,0BACFA,QAEAA,MAAA,6DAKEA,MAAA,kBAAAqW,IAAA,OAAU1I,EAAA27P,aAAAjzP,GAAAoW,QAA4B,GAEtCzsB,MAAA,0BAGNA,mBAxCEA,cAAA,IAAAA,MAAA,0EAOAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,iFASAA,MAAA,GAAAA,MAAA,IAAAA,MAAA,mEAOIA,MAAA,GACAA,MADA,UAAAA,MAAA,MAAA2N,EAAAu/G,WACAltH,CAD6B,0BAI7BA,MAAA,GAAAA,MAAA,IAAAA,MAAA,qEAKAA,MAAA,GAEAA,MAFA,gBAAAA,MAAA,MAAA2N,EAAAu/G,WAEAltH,CAFyC,yBAEzCA,CAD0B,UAAAA,MAAA,MAAA2N,EAAAglH,kBAI1B3yH,MAAA,GAAAA,MAAA,IAAAA,MAAA,mFDZF+oQ,GACAj/M,KAAgBtlD,KAChB+hQ,GACAh0K,MAAoB9tF,MACpB6J,KACAC,MAAiB7J,OAAA+J,OAAA,05BE/BrBzO,MAAA,mCAOEA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAAkvC,oBAAmB,GAE5Bp5C,MAAA,cAAUA,MAAA,WACZA,kCAJEA,MADA,aAAAA,MAAA,iDACAA,CADsE,QAAAkK,EAAAC,QF6B3Di/P,MAAwB/nO,OAAA,IAtBpC8U,OAAc,CACbvoB,KAAM,cACNpjB,MAAO,oCACPD,KAAM,yBACP,EACD03B,GAAAC,IAAA,qBAyB+By5N,MARlByN,IGAN,IAAMG,GAAwB,MAA/B,MAAOA,EAkBS7F,eAjBb8F,cAA0C,IAAI7oQ,KAAgB,GAC7D8oQ,eAEA/kI,OACAglI,OAAiC,IAAI/oQ,SAAgBC,GAC7D,SACIygD,CAAM/7C,GACR1G,KAAK8lI,OAASp/H,EACd1G,KAAK8qQ,OAAOnoQ,KAAK3C,KAAK8lI,OACxB,CAEA,SAAIrjF,GACF,OAAOziD,KAAK8lI,MACd,CAESv6H,MAAgB,UAEzBxL,YAAoB+kQ,GAAA9kQ,KAAA8kQ,gBAAiC,CAErDv3P,WACEvN,KAAK6qQ,kBAAiB5nP,MAAc,CAClCjjB,KAAK8kQ,eAAevB,kBACpBvjQ,KAAK8qQ,SACJjoQ,UAAWke,GACZ/gB,KAAK4qQ,cAAcjoQ,KAAKoe,EAAM,IAAMA,EAAM,IAAIlhB,QAAQ46C,WAAW9J,SAErE,CAEAziC,cACElO,KAAK6qQ,eAAe18P,aACtB,CAEAqsC,oBAEIx6C,KAAK8kQ,eAAef,WAAWr9P,OAC9B1G,KAAK8kQ,eAAef,WAAWr9P,MAAc+7C,MAAMvwC,KAClDlS,KAAKyiD,MAAMvwC,IACblS,KAAK8kQ,eAAexB,uBAEpBtjQ,KAAK8kQ,eAAexB,wBAAyB,GAE7CtjQ,KAAK8kQ,eAAexB,wBAAyB,EAC7CtjQ,KAAK8kQ,eAAeP,uBAAuBvkQ,KAAKyiD,MAAMvwC,IAE1D,4CA7CWy4P,GAAwBvpQ,MAAAuE,IAAA,+BAAxBglQ,EAAwBr8P,UAAA,2BAAAC,OAAA,CAAAk0C,MAAA,QAAAl3C,MAAA,SAAAkD,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,qOAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDlCrC1N,MAAA,EAAA2pQ,GAAA,uCACG3pQ,MAAA,OAAAA,MAAA,IAAA2N,EAAA67P,+BCyBCz7P,KACAI,MAAe3J,MACfyJ,MAAgBxJ,MAChB2J,MAAa1J,MACb4J,KACAC,MAAiB5J,OAAA+J,gBAAA,WAGR66P,CAAwB,8CCpBjCvpQ,MAAA,4BACAA,MAAA,yBAEEA,MAAA,yBAAA65J,EAAA75J,MAAAyK,GAAA42C,MAAA/gB,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAspO,eAAA/vG,GAAqB,GAC/B75J,QAaDA,MAZA,4BAYAA,CATyB,6BASzBA,CAL0B,+BAK1BA,CAD4B,8DAhBNA,MAAA,QAAA65J,GAEpB75J,cAAA,QAAA65J,GAIA75J,QACAA,MADA,SAAAsgC,EAAAquL,UACA3uN,CADoB,QAAA65J,GAIpB75J,QACAA,MADA,SAAAsgC,EAAAsuL,WACA5uN,CADqB,QAAA65J,GAIrB75J,QACAA,MADA,kBACAA,CADqB,QAAA65J,GAGF75J,cAAA,QAAA65J,8BA/BzB75J,MAAA,sBAYEA,MAAA,EAAA6pQ,GAAA,yBAAA7pQ,OAqBFA,8BAvBEA,MAPA,MAAAsgC,EAAAjhB,IAOArf,CAPW,oBAAAsgC,EAAAgpL,kBAOXtpN,CALuC,4BAAAsgC,EAAA8rL,0BAKvCpsN,CAJuD,8BAAAsgC,EAAAqsL,4BAIvD3sN,CAH2D,iCAAAsgC,EAAA2nL,+BAG3DjoN,CAFiE,iCAAAsgC,EAAAs1I,+BAEjE51K,CADiE,aAAAsgC,EAAAgoL,oCA+B/DtoN,MAAA,SAOEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,wFAGAA,MADF,kBACEA,CADiE,iBACvCA,MAAA,YAAMA,QAChCA,MAAA,aAGEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAoxB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAsoO,aAAY,GAErB5oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0FAIFA,MADF,kBACEA,CADkE,iBACxCA,MAAA,iBAAWA,QACrCA,MAAA,aAGEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAuoO,cAAa,GAEtB7oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2FAIFA,MADF,kBACEA,CADkE,iBACxCA,MAAA,UAAIA,QAC9BA,MAAA,aAGEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAwoO,cAAa,GAEtB9oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,4EAvCJA,MADF,aACEA,CAD2C,SAEzCA,MAAA,wBACFA,QA8BAA,MA7BA,EAAA8pQ,GAAA,WA6BA9pQ,CAvBC,EAAA+pQ,GAAA,sBAuBD/pQ,CApBmE,EAAAgqQ,GAAA,sBAoBnEhqQ,CAVoE,EAAAiqQ,GAAA,uBAoBtEjqQ,+BAzCIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0CAGCA,MAAA,GAAAA,MAAA,OAAAsgC,EAAA4pO,uBAAA5pO,EAAA6pO,qBAAA7pO,EAAA8pO,sBAAA9pO,EAAA+pO,uBAQarqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA6pO,qBAUAnqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA8pO,sBAUApqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA+pO,gDAjClBrqQ,MAAA,EAAAsqQ,GAAA,uCAAWtqQ,MAAA,OAAAsgC,EAAAiqO,6BCyBN,IAAMC,GAAN,MAAMA,GA+EDjO,SACAmB,UACA5mG,oBACAnmJ,MACA0sP,kBAlFHkN,4BAAsC,EAEpCtiD,gCAA0C,EAE1C0E,6BAAuC,EAEvC/2C,gCAA0C,EAE1C+4C,WAAqB,EAErBC,YAAsB,EAEtBiwC,kBAA8C,GAE9Cv2C,YAAsB,EAEtB4hD,sBAAgC,EAEzC,OAAI7qP,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,WAAI0hC,GACF,OAAOniD,KAAKygB,IAAI0hC,QAAQp+C,QACtB0c,MAAKq/B,GACHA,EAAOp2C,OACJ+4C,MAC2B,IAA1BA,EAAMkH,iBACJ3pD,KAAK0qN,mBAAsBjoK,EAAMJ,aAI7C,CAEA,qBAAIqoK,GACF,OAAO1qN,KAAKigQ,kBAAkBv1C,oBAAqB,CACrD,CAEA,6BAAI8C,GACF,MAAMq+C,EAAoBrlQ,OAAO6H,OAC/B,CACEikN,YAAaxF,MAAsBxgK,SAErCtsD,KAAKigQ,mBAGP,OAAQjgQ,KAAKigQ,kBAAkB3tC,aAC7B,KAAKxF,MAAsB/+J,OACzB89M,EAAkBv5C,YAAcxF,MAAsB/+J,OACtD,MACF,KAAK++J,MAAsB9+J,MACzB69M,EAAkBv5C,YAAcxF,MAAsB9+J,MAK1D,OAAO69M,CACT,CAEA,uBAAIN,GACF,OACmE,IAAjEvrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,kBAC5C1I,KAAKk4J,oBACF4M,aACAp7J,OAAOq7J,OACPr7J,OAAQkS,GAAMA,EAAE5N,WAA6B,UAAhB4N,EAAEqmF,WAAuBr4F,OAAS,CAEtE,CAEA,wBAAI4hQ,GACF,OAAkE,IAA3DxrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,UACrD,CAEA,wBAAI+iQ,GACF,OAAyE,IAAlEzrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,iBACrD,CAEA3I,YACU49P,EACAmB,EACA5mG,EACAnmJ,EACA0sP,IAJAz+P,KAAA29P,WACA39P,KAAA8+P,YACA9+P,KAAAk4J,sBACAl4J,KAAA+R,QACA/R,KAAAy+P,oBACP,CAEHlxP,WAEEoxB,WAAW,KACT3+B,KAAK2rQ,4BAA6B,EAClC3rQ,KAAK+R,MAAM4K,eAAa,EACvB,IACL,CAEAqtP,aACEhqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,gBACtC,CAEAmzN,cACEjqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,UACtC,CAEAozN,cACElqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,iBACtC,CAEAk0N,eAAevoN,GACb,IAAIvwC,EAAKuwC,EAAMvwC,GACXuwC,EAAM5iD,QAAQ46C,WAAWghK,cAC3BvpM,EACEuwC,EAAM5iD,QAAQ46C,UAAUghK,cAAgBh5J,EAAMvwC,GAC1CuwC,EAAM5iD,QAAQ46C,UAAUghK,YACxBh5J,EAAMvwC,IAEdlS,KAAKy+P,kBAAkBF,kBAAkB,CAAEz+M,OAAQ,CAAC5tC,KACpDlS,KAAKy+P,kBAAkBH,QAAQL,GAAiBh4M,QAChDjmD,KAAK8+P,UAAUv0N,QAAQuM,aAAa,eACtC,4CArHW80N,IAAuBxqQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,OAAAzE,mBAAA0E,IAAA,+BAAvB8lQ,GAAuBt9P,UAAA,2BAAAC,OAAA,CAAA86M,+BAAA,iCAAA0E,4BAAA,8BAAA/2C,+BAAA,iCAAA+4C,UAAA,YAAAC,WAAA,aAAAiwC,kBAAA,oBAAAv2C,WAAA,aAAA4hD,qBAAA,wBAAA78P,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,s3BAAAC,SAAA,SAAAC,EAAAC,MAAA,EAAAD,ID7DpC1N,MAAA,EAAA0qQ,GAAA,yCAmCA1qQ,MAAA,EAAA2qQ,GAAA,yBAAA3qQ,8BAjCmCA,MAAhC,OAAAA,MAAA,IAAA2N,EAAAozC,SAAAv4C,OAAgCxI,CAAA,WAAA4qQ,mBC4C/B78P,KACAsgN,MACAgE,MACAk3C,GACApvD,MACAjjB,MACA0iB,MACA8Y,MACAI,KACA9kN,MAAarJ,wBACbyJ,MAAaxJ,MACb0J,KACAC,MAAiBgF,OAAA9E,OAAA,g8BAGR+7P,MAAuBnpO,OAAA,IA1BnC8U,OAAc,CACbvoB,KAAM,aACNpjB,MAAO,4BACPD,KAAM,SACP,EAAC03B,GAAAC,IAAA,qBAqGoBy5N,GACCyB,GACU52F,MACdrkI,MACY26N,MAnFlB0N,6DC7DbxqQ,MAAA,8CAOEA,MAAA,2BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAmBkK,GAAA2gQ,iBAAAx0P,GAAwB,GAE7CrW,gCAHEA,MAHA,oBAAAkK,EAAAo/M,kBAGAtpN,CAHuC,sBAAAkK,EAAA0/M,oBAGvC5pN,CAF2C,iCAAAkK,EAAA0rK,+BAE3C51K,CADiE,sBAAAA,MAAA,IAAAkK,EAAA4gQ,gEAKnE9qQ,MAAA,EAAA+qQ,GAAA,6CAIA/qQ,MAAA,SAQEA,MAAA,8DAKFA,8BALEA,cAAA,IAAAA,MAAA,IAAAkK,EAAA8gQ,gBAAAxiQ,OAAAxI,MAAA,+CAAAA,MAAA,6EAYEA,MAAA,SAOEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,wFAIAA,MADF,kBACEA,CADiE,gBACvCA,MAAA,YAAMA,QAChCA,MAAA,YAGEA,MAAA,mBAAAA,MAAAkL,GAAA,MAAAhB,EAAAlK,MAAA,UAAAA,MAASkK,EAAA0+P,aAAY,GAErB5oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0FAIFA,MADF,kBACEA,CADkE,gBACxCA,MAAA,iBAAWA,QACrCA,MAAA,YAGEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAASkK,EAAA2+P,cAAa,GAEtB7oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2FAIFA,MADF,kBACEA,CADkE,gBACxCA,MAAA,UAAIA,QAC9BA,MAAA,aAGEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAAjhD,EAAAlK,MAAA,UAAAA,MAASkK,EAAA4+P,cAAa,GAEtB9oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,4EAxCJA,MADF,aACEA,CAD2C,SAEzCA,MAAA,wBACFA,QA+BAA,MA9BA,EAAAirQ,GAAA,UA8BAjrQ,CAxBC,EAAAkrQ,GAAA,sBAwBDlrQ,CApBmE,EAAAmrQ,GAAA,sBAoBnEnrQ,CAVoE,EAAAorQ,GAAA,uBAoBtEprQ,+BA1CIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0CAGCA,MAAA,GAAAA,MAAA,OAAAkK,EAAAggQ,uBAAAhgQ,EAAAigQ,qBAAAjgQ,EAAAkgQ,sBAAAlgQ,EAAAmgQ,uBASarqQ,cAAA,OAAAkK,EAAAggQ,sBAAAhgQ,EAAAigQ,qBAUAnqQ,cAAA,OAAAkK,EAAAggQ,sBAAAhgQ,EAAAkgQ,sBAUApqQ,cAAA,OAAAkK,EAAAggQ,sBAAAhgQ,EAAAmgQ,gDAlClBrqQ,MAAA,EAAAqrQ,GAAA,uCAAWrrQ,MAAA,OAAAkK,EAAAqgQ,6BCyBN,IAAMe,GAAN,MAAMA,GA8DD/O,SACAmB,UACA5mG,oBACAnmJ,MAhEH45P,4BAAsC,EAE7CxpN,QAAoC,IAAIpgD,IAAgB,IACxDmqQ,qBAAiD,IAAInqQ,KAAgB,GACrEod,QAAU,IAAIC,KAAoB,GAE1BslF,aACAioK,yBAEC31F,gCAA0C,EAE1Cs0F,sBAAgC,EAEhCtgD,qBAA+B,EAE/BT,qBAA+B,EAE/B01C,kBAA8C,GAEvD,OAAIx/O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,2BAAImsP,GACF,OAAO5sQ,KAAKmiD,QAAQp+C,QAClB0c,MAAKq/B,GACHA,EAAOp2C,OACJ+4C,GAAUA,EAAMoiE,SAASn+G,OAAS+7C,EAAM4hE,sBAAsB39G,QAIvE,CAEA,kBAAI0lQ,GACF,OAAOpsQ,KAAKmiD,QAAQp+C,QAClB0c,MAAKq/B,GAAWA,EAAOp2C,OAAQ+4C,GAAUA,EAAMoiE,SAASn+G,QAE5D,CAEA,qBAAIgkN,GACF,OAAO1qN,KAAKigQ,kBAAkBv1C,oBAAqB,CACrD,CAEA,uBAAI6gD,GACF,OACmE,IAAjEvrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,kBAC5C1I,KAAKk4J,oBACF4M,aACAp7J,OAAOq7J,OACPr7J,OAAQkS,GAAMA,EAAE5N,WAA6B,UAAhB4N,EAAEqmF,WAAuBr4F,OAAS,CAEtE,CAEA,wBAAI4hQ,GACF,OAAkE,IAA3DxrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,UACrD,CAEA,wBAAI+iQ,GACF,OAAyE,IAAlEzrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,iBACrD,CACA3I,YACU49P,EACAmB,EACA5mG,EACAnmJ,GAHA/R,KAAA29P,WACA39P,KAAA8+P,YACA9+P,KAAAk4J,sBACAl4J,KAAA+R,OACP,CAEHxE,WACEvN,KAAK0kG,gBAAezhF,MAAc,CAChCjjB,KAAKygB,IAAI0hC,QACTniD,KAAKygB,IAAIyhC,eAAe+iD,cAEvBlhG,QAAKof,MAAa,KAClBtgB,UAAWke,IACV/gB,KAAKmiD,QAAQx/C,KACXoe,EAAM,GAAGrX,OACN+4C,MAC2B,IAA1BA,EAAMkH,iBACJ3pD,KAAK0qN,mBAAsBjoK,EAAMJ,YACtC,GAIHriD,KAAKgrN,qBACPhrN,KAAK29P,SAASpzC,yBAC0BvoN,IAAtChC,KAAK29P,SAASpzC,oBACVvqN,KAAK29P,SAASpzC,oBACdvqN,KAAKuqN,sBAAuB,EAClCvqN,KAAKksQ,qBAAqBvpQ,KAAK3C,KAAK29P,SAASpzC,sBAE7CvqN,KAAKksQ,qBAAqBvpQ,MAAK,GAIjCg8B,WAAW,KACT3+B,KAAK2rQ,4BAA6B,EAClC3rQ,KAAK+R,MAAM4K,eAAa,EACvB,IACL,CAEAsvP,iBAAiBviP,GACf1pB,KAAK29P,SAASpzC,oBAAsB7gM,EACpC1pB,KAAKksQ,qBAAqBvpQ,KAAK+mB,EACjC,CAEAqhM,gBACE,GAAuC,IAAnC/qN,KAAKmiD,QAAQxoB,WAAW/vB,OAC1B,OAAO,EACF,GAC8B,IAAnC5J,KAAKmiD,QAAQxoB,WAAW/vB,SACK,IAA7B5J,KAAKgrN,oBACL,CACA,IAAI6hD,EASJ,GARA7sQ,KAAK2sQ,yBAA2B3sQ,KAAK4sQ,wBAAwB/pQ,UAC1D6D,IAEMmmQ,EADY,IAAjBnmQ,EAAMkD,MAEwB,IAIH,IAA3BijQ,EACF,OAAO,CAEX,CACA,OAAO,CACT,CAEA3+P,cACElO,KAAK0kG,aAAav2F,cACdnO,KAAK2sQ,0BACP3sQ,KAAK2sQ,yBAAyBx+P,aAElC,CAEA67P,aACEhqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,gBACtC,CAEAmzN,cACEjqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,UACtC,CAEAozN,cACElqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,iBACtC,4CAlJW41N,IAAsBtrQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,OAAAzE,aAAA,+BAAtBsrQ,GAAsBp+P,UAAA,0BAAAC,OAAA,CAAAyoK,+BAAA,iCAAAs0F,qBAAA,uBAAAtgD,oBAAA,sBAAAT,oBAAA,sBAAA01C,kBAAA,qBAAAxxP,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,4pBAAAC,SAAA,SAAAC,EAAAC,MAAA,EAAAD,ID7CnC1N,MAVA,EAAA0rQ,GAAA,8BAUA1rQ,CAFC,EAAA2rQ,GAAA,6BAMD3rQ,MAAA,EAAA4rQ,GAAA,6CAeA5rQ,MAAA,EAAA6rQ,GAAA,yBAAA7rQ,8BA5BGA,MAAA,OAAA2N,EAAAg8M,iBAUA3pN,QAAsCA,MAAtC,WAAAA,MAAA,IAAA2N,EAAAozC,SAAAv4C,OAAsCxI,CAAA,WAAA8rQ,GAKtC9rQ,MAAA,GAAAA,MAAA,QAAA2N,EAAAi8M,qBAAA,IAAA5pN,MAAA,IAAA2N,EAAAozC,SAAAv4C,QAAA,IAAAxI,MAAA,IAAA2N,EAAA69P,yBAAAhjQ,wBC8BCuF,KACAw7M,MACAiB,MACAx8M,MAAatJ,wBACb0J,MAAazJ,MACb2J,KACAC,MAAiB3J,OAAA6J,OAAA,03BAGR68P,MAAsBjqO,OAAA,IApBlC8U,OAAc,CACbvoB,KAAM,YACNpjB,MAAO,+BACPD,KAAM,0BACP,EAAC03B,GAAAC,IAAA,qBA8EoBy5N,GACCyB,GACU52F,MACdrkI,SAjENmpO,4CCnBN,IAAMS,GAAiB,MAAxB,MAAOA,EAmBDxP,SACAxhN,eAnBFixN,4BAAsC,GAEvCC,SAAqC,IAAItrQ,KAC9C,GAEKurQ,sBACAC,uBACL,IAAIxrQ,IAAwB,eACvByrQ,sBACCC,OAAyB,GAC1BC,2BACL,IAAI3rQ,SAAgBC,GAEtB,OAAIye,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACU49P,EACAxhN,GADAn8C,KAAA29P,WACA39P,KAAAm8C,iBAERn8C,KAAKwtQ,sBAAwB,IAAIrwK,MAAsB,GAAI,CACzD18E,IAAKzgB,KAAK29P,SAASl9O,MAGrBzgB,KAAKstQ,sBAAwB,IAAIvrQ,IAC9B/B,KAAKm8C,eAAej8C,IAAI,uBACvBF,KAAKotQ,6BAGTptQ,KAAK29P,SAASl9O,IAAI4gC,GAAGspC,KAAK,iBAAkB,KAC1C3qF,KAAK2tQ,2BAAyB,EAElC,CAEAA,4BACE3tQ,KAAKytQ,OAAOnmQ,QACV2b,MAAc,CACZjjB,KAAKqtQ,SACLrtQ,KAAKutQ,uBACLvtQ,KAAKstQ,yBACLv4I,MAAS,KACT/0H,KAAKygB,IAAI28C,sBAAsB02D,YAE9B/vH,QAAKof,MAAa,MAClBtgB,UACEke,IACC/gB,KAAKwtQ,sBAAsB1mQ,QAC3B,MAAM6pC,EAAU5vB,EAAM,GAChB++B,EAAS9/C,KAAKygB,IAAIq/B,OAClB8tN,GAAa5tQ,KAAKygB,IAAI28C,sBAAsB02D,UAAUptH,MACtDmnQ,GAAe9sP,EAAM,GACrB+sP,GAAuB/sP,EAAM,GAMnC,GALA/gB,KAAKm8C,eAAe97C,IAClB,qBACAytQ,IAAwB9tQ,KAAKotQ,8BAG1Bz8N,EACH,OAGF,IAAI4/B,GACJ,GAAqB,gBAAjBs9L,GAAgC,CAClC,IAAKD,KAAeA,GAAWv+N,SAC7B,OAGFkhC,GAAQsa,MACN+iL,GAAWv+N,SACXu+N,GAAW5rN,WACXhiD,KAAKygB,IAAIuhC,YAEXhiD,KAAKygB,IAAIwvG,WAAWttH,MAAK,EAC3B,MACE4tE,GAAQvwE,KAAKygB,IAAIyhC,eAAeN,YAChC5hD,KAAKygB,IAAIwvG,WAAWttH,MAAK,GAG3B,MAAMorQ,GAAcljL,MAClBta,GACAvwE,KAAKygB,IAAIuhC,WACT,aAEIgsN,MAAqB/nL,OACzB8nL,GACA,GAEF/tQ,KAAK0tQ,2BAA2B/qQ,KAAKqrQ,IAEbluN,EAAOp2C,OAC5B+4C,IACCA,GAAMpB,cAAcqlE,MACnBjkE,GAAMpsB,WAAmCx2B,QAAQkjD,WAClDN,GAAM5rB,SACN4rB,GAAM2hE,sBAGM3jG,IAAKwtP,KACnB,MAAMC,GACJD,GAAe5sN,GAAGsC,YAGdwqN,GACJD,GAAYE,wBAAwB79L,IACtC,GAAI49L,IAA0BA,GAAuBvkQ,OACnDukQ,GAAuB1tP,IAAK4tP,KAC1B,MAAMC,MAAwB9rK,OAC5B6rK,GACAruQ,KAAKygB,IAAIuhC,YAEX,IAAIp2C,GAAQ5L,KAAKwwJ,cACf89G,GACAL,IAGFjuQ,KAAK+4I,kBACHk1H,GACA19L,GACA+9L,GACA1iQ,GACA,EAAC,OAGA,CAEL,MAAM2iQ,GACJL,GAAYM,8BAA8Bj+L,IAC5C,GAAIg+L,GAAkB,CACpB,MAAME,GAAgBF,GAAiBphL,cACjCuhL,MAAiBlsK,OACrB+rK,GACAvuQ,KAAKygB,IAAIuhC,YAEL2sN,GACJF,GAAcG,gBAAgBr+L,IAC1Bs+L,GAAc,IAAI3T,KAAa,CACnC3qL,GACAo+L,KAEIG,MAAa3yH,OACjB0yH,GACA,aAEF,GAAIC,IAAchB,GAAsB,CACtC,IAAIliQ,GAAQ5L,KAAKwwJ,cACfk+G,GACAT,IAGFjuQ,KAAK+4I,kBACHk1H,GACA19L,GACAm+L,GACA9iQ,GACAkjQ,GAEJ,CACF,CACF,GACD,GAIX,CAMQ/1H,kBACNt2F,EACAssN,EACAjkQ,EACAc,GACAwvD,IAEA,MAAM+9E,MAAYx2H,SACZq/B,GAAahiD,KAAKygB,IAAI4gC,GAAGC,UAAUE,gBACnC0hD,GAAap4F,EAAQu2C,GAAG8rC,cACxB7D,IAAW,IAAItlC,MAAU8oC,oBAAoBoW,GAAY,CAC7Dx+C,kBAAmB1C,GACnByC,eAAgBzC,KAElBhiD,KAAKwtQ,sBAAsB7tP,OAAO,CAChCnc,KAAMwpF,MACN1D,YACAtnC,WAAYA,GAAWP,UACvBpqB,WAAY,IACPvsB,EAAQusB,WAETnlB,GAAIinI,GACJ9wI,QAASuD,GACTwvD,YACA2zM,8BACAC,WAAYvsN,EAAMvwC,GAClB+8P,cAAexsN,EAAM72C,OAGzByS,KAAM,CACJnM,GAAIinI,KAGV,CAEAqX,cAAc1lJ,EAAkB23C,GAC9B,IAAI72C,EACJ,GAAI62C,EAAM5iD,SAAS4jB,QAAQ5jB,QAAS,CAClC,MAAMy9E,GAAoB76B,EAAM5iD,QAAQ4jB,OACrC5jB,QACCy9E,GAAkBzJ,aACpBjoE,EAAQ5L,KAAK+2J,cAAcjsJ,EAASwyE,GAAkBzJ,YAE1D,CACA,OAAOjoE,CACT,CAEAmrJ,cAAcjsJ,EAAkBksJ,GAC9B,IAAIxrI,EAAQwrI,EACZ,MAAMC,GAAa17I,MAAMmE,KAAKs3I,EAAWE,SAAS,sBAElDD,UAAW18I,QAASlB,KAClBmS,EAAQA,EAAMkN,QAAQrf,GAAE,GAAIvO,EAAQusB,WAAWhe,GAAE,IAAG,GAI5B,IAAtB49I,GAAWrtJ,QAAgB4hB,IAAUwrI,IACvCxrI,EAAQ1gB,EAAQusB,WAAW2/H,IAAeA,GAErCxrI,CACT,4CAvOW2hP,GAAiB/rQ,MAAAuE,IAAAvE,MAAAwE,MAAA,iCAAjBunQ,EAAiB9rQ,QAAjB8rQ,EAAiB7rQ,UAAAC,WAFhB,gBAED4rQ,CAAiB,kDC7B9B/rQ,MAAA,uBAIEA,MAAA,wCAQFA,6BAHIA,QACAA,MADA,cAAAA,MAAA,8CACAA,CADoE,QAAA8tQ,EAAA,+BAIxE9tQ,MAAA,uBAIEA,MAAA,wCAQFA,6BAHIA,QACAA,MADA,cAAAA,MAAA,8CACAA,CADoE,QAAA+tQ,EAAA,8CAKxE/tQ,MAAA,eAMEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAA8+P,EAAAhuQ,QAAA,OAAAA,MAASguQ,EAAA3jN,sBAAqB,GAE9BrqD,MAAA,cAAUA,MAAA,kBACZA,WCKO,IAAMiuQ,EAAN,MAAMA,GAuBF1R,SACA2R,kBACC3tQ,gBACAC,eAzBF6rQ,OAAyB,GACK92K,MAEtC,eAAI44K,GACF,OAAOvvQ,KAAKsvQ,kBAAkBhC,sBAAsB5mQ,KACtD,CACA,eAAI6oQ,CAAY7oQ,GACd1G,KAAKsvQ,kBAAkBhC,sBAAsB3qQ,KAAK+D,EACpD,CAEA,OAAI+Z,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CACO+uP,qBACAC,0BAKA56H,cAEP90I,YACS49P,EACA2R,EACC3tQ,EACAC,GAHD5B,KAAA29P,WACA39P,KAAAsvQ,oBACCtvQ,KAAA2B,kBACA3B,KAAA4B,iBAER5B,KAAK60I,cAAgB,CACnBnoH,WAAW,EACXyB,YAAY,EACZ2I,mBAAmB,EACnBtU,MAAM,EACNmU,QAAS,CACP,CACE3H,KAAM,UACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,8CAEFxoB,cAAgBs5G,IACPA,GAAatmG,WAAWhvB,SAGnC,CACE2mB,KAAM,WACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,+CAEFxoB,cAAgBs5G,IACP,GAAG1hC,MAAYC,gBACpByhC,GAAatmG,WAAW+jC,SACxB,QAMZ,CAEA7tD,WACEvN,KAAKsvQ,kBAAkBjC,SAAS1qQ,MAAK,GACrC3C,KAAKyvQ,2BAC+C,IAAlDzvQ,KAAKygB,IAAI28C,sBAAsBm3D,eACjCv0H,KAAKwvQ,sBAAqD,IAA9BxvQ,KAAKygB,IAAIwvG,WAAWvpH,MAEhD1G,KAAKytQ,OAAOnmQ,KACVtH,KAAKsvQ,kBAAkB/B,uBAAuB1qQ,UAAWwW,IACvDrZ,KAAKygB,IAAIwvG,WAAWttH,KAAW,gBAAN0W,GAEvBrZ,KAAKygB,IAAI28C,sBAAsBm3D,eADvB,gBAANl7G,CAG8C,GAIxD,CAEAnL,cACElO,KAAKsvQ,kBAAkBjC,SAAS1qQ,MAAK,GACrC3C,KAAKygB,IAAIwvG,WAAWttH,KAAK3C,KAAKwvQ,sBAC9BxvQ,KAAKytQ,OAAOhtP,IAAK7E,GAAMA,EAAEzN,eACzBnO,KAAKygB,IAAI28C,sBAAsBm3D,eAC7Bv0H,KAAKyvQ,yBACT,CAEAC,qBAAqB/jO,GACnB3rC,KAAKsvQ,kBAAkB/B,uBAAuB5qQ,KAAKgpC,EAAEjlC,MACvD,CAKA+kD,sBACqBC,MAAUC,KAC3B3rD,KAAKsvQ,kBAAkB5B,4BAA4BhnQ,MAAMyxD,aAGzDn4D,KAAK4B,eAAe6oD,QAClB,6CACA,+CAGN,4CAtGW4kN,IAAyBjuQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,OAAAzE,MAAA0E,OAAA,+BAAzBupQ,GAAyB/gQ,UAAA,6BAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,2yBD1CtC1N,MANA,yBAMAA,CADoB,QAEpBA,MAAA,EAAAuuQ,GAAA,yCAaAvuQ,MAAA,EAAAwuQ,GAAA,yCAcAxuQ,MAAA,EAAAyuQ,GAAA,kDAWEzuQ,MADF,WACEA,CAD2B,kBACaA,MAAA,0BAG1CA,UAEEA,MADF,WACEA,CAD8C,wBAC7BA,MAAA,kBAAAqW,IAAArW,aAAAyK,GAAAzK,MAAU2N,EAAA2gQ,qBAAAj4P,IAA4B,GACrDrW,MAAA,4CAKGA,MAAA,0BAECA,QAEJA,MAAA,4CAKGA,MAAA,0BAKPA,YAIIA,MAFJ,YAEIA,CAFqB,uBAErBA,CADuD,gBAC5CA,MAAA,0BAETA,QACFA,MAAA,qCAGEA,MAAA,yBAAAqW,IAAArW,aAAAyK,GAAAzK,MAAA2N,EAAAwgQ,YAAA93P,MAAA1I,EAAAwgQ,YAAA93P,IAAArW,MAAAqW,GAAA,GAONrW,kBAnFEA,MADA,QAAA2N,EAAAugQ,kBAAA9B,sBACApsQ,CADiD,WAAA2N,EAAA8lI,eAKhDzzI,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAAugQ,kBAAA5B,6BAaAtsQ,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAAugQ,kBAAA5B,6BAcAtsQ,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAA2N,EAAAugQ,kBAAA5B,6BAAAtsQ,MAAA,KAAA2N,EAAAugQ,kBAAA5B,4BAAA9jQ,QAUuCxI,MAAA,GAAAA,YAAA,oDAOpCA,MAAA,GAAAA,MAAA,0BAAAA,MAAA,MAAA2N,EAAAugQ,kBAAA/B,yBAICnsQ,MAAA,GAAAA,YAAA,yDAKDA,MAAA,GAAAA,MAAA,wBAAAA,MAAA,MAAA2N,EAAAugQ,kBAAA/B,yBAICnsQ,MAAA,GAAAA,YAAA,uDASQA,MAAA,GAAAA,YAAA,qDAQTA,MAAA,GAAAA,MAAA,cAAAA,MAAA,qDAFAA,MAAA,UAAA2N,EAAAwgQ,6BC5CFh6O,KACApmB,KACA8a,MAAkBlkB,YAClB82B,MAAc72B,MACduJ,MAAeoF,MACfnF,MAAaqF,MACbk/C,MAAcj/C,YACd2nB,KAAWK,yBACXptB,KACAC,MAAiBqtB,OAAAntB,OAAA,ytCC/BbzO,MAAA,4BACAA,MAAA,yBAEEA,MAAA,yBAAA65J,EAAA75J,MAAAyK,GAAA42C,MAAA/gB,GAAAtgC,QAAA,OAAAA,MAASsgC,GAAAspO,eAAA/vG,GAAqB,GAC/B75J,QAaDA,MAZA,4BAYAA,CATyB,6BASzBA,CAL0B,+BAK1BA,CAD4B,6DAhBNA,MAAA,QAAA65J,GAEpB75J,cAAA,QAAA65J,GAIA75J,QACAA,MADA,SAAAsgC,EAAAquL,UACA3uN,CADoB,QAAA65J,GAIpB75J,QACAA,MADA,SAAAsgC,EAAAsuL,WACA5uN,CADqB,QAAA65J,GAIrB75J,QACAA,MADA,kBACAA,CADqB,QAAA65J,GAGF75J,cAAA,QAAA65J,IDiBhBo0G,KAAyB5sO,OAAA,IA1BrC8U,OAAc,CACbvoB,KAAM,gBACNpjB,MAAO,uCACPD,KAAM,WACP,EACD03B,GAAAC,IAAA,qBA4CqBy5N,GACSoQ,GACD3oM,MACDqE,SA1BfwmM,GEaN,IAAMS,EAAN,MAAMA,GA6CDnS,SACAmB,UACAL,kBA9CDp1C,gCAA0C,EAE1C0E,6BAAuC,EAEvC/2C,gCAA0C,EAE1C+4C,WAAqB,EAErBC,YAAsB,EAEtBiwC,kBAA8C,GAE9Cv2C,YAAsB,EAE/B,OAAIjpM,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,qBAAIiqM,GACF,OAAO1qN,KAAKigQ,kBAAkBv1C,oBAAqB,CACrD,CAEA,6BAAI8C,GACF,MAAMq+C,EAAoBrlQ,OAAO6H,OAC/B,CACEikN,YAAaxF,MAAsBxgK,SAErCtsD,KAAKigQ,mBAGP,OAAQjgQ,KAAKigQ,kBAAkB3tC,aAC7B,KAAKxF,MAAsB/+J,OACzB89M,EAAkBv5C,YAAcxF,MAAsB/+J,OACtD,MACF,KAAK++J,MAAsB9+J,MACzB69M,EAAkBv5C,YAAcxF,MAAsB9+J,MAK1D,OAAO69M,CACT,CAEA9rQ,YACU49P,EACAmB,EACAL,GAFAz+P,KAAA29P,WACA39P,KAAA8+P,YACA9+P,KAAAy+P,mBACP,CAEHuM,eAAevoN,GACb,IAAIvwC,EAAKuwC,EAAMvwC,GACXuwC,EAAM5iD,QAAQ46C,WAAWghK,cAC3BvpM,EACEuwC,EAAM5iD,QAAQ46C,UAAUghK,cAAgBh5J,EAAMvwC,GAC1CuwC,EAAM5iD,QAAQ46C,UAAUghK,YACxBh5J,EAAMvwC,IAEdlS,KAAKy+P,kBAAkBF,kBAAkB,CAAEz+M,OAAQ,CAAC5tC,KACpDlS,KAAKy+P,kBAAkBH,QAAQL,GAAiBh4M,QAChDjmD,KAAK8+P,UAAUv0N,QAAQuM,aAAa,eACtC,4CA7DWg5N,IAAgB1uQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAA,+BAAhBiqQ,GAAgBxhQ,UAAA,mBAAAC,OAAA,CAAA86M,+BAAA,iCAAA0E,4BAAA,8BAAA/2C,+BAAA,iCAAA+4C,UAAA,YAAAC,WAAA,aAAAiwC,kBAAA,oBAAAv2C,WAAA,cAAAj7M,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,GAAAC,OAAA,sVAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,ID5D3B1N,MADF,kBACEA,CADa,oCAEXA,MAAA,sBAUEA,MAAA,EAAA2uQ,EAAA,yBAAA3uQ,OAsBJA,UAEAA,MAAA,oCACEA,MAAA,wBAEJA,iBAtCWA,cAAA,QAAAA,MAAA,kCAELA,MAAA,GAOAA,MAPA,MAAA2N,EAAA0R,IAOArf,CAPW,oBAAA2N,EAAA27M,kBAOXtpN,CALuC,4BAAA2N,EAAAy+M,0BAKvCpsN,CAJuD,8BAAA2N,EAAAg/M,4BAIvD3sN,CAH2D,iCAAA2N,EAAAs6M,+BAG3DjoN,CAFiE,iCAAA2N,EAAAioK,+BAEjE51K,CADiE,aAAA2N,EAAA26M,YA2B5DtoN,MAAA,GAAAA,MAAA,QAAAA,MAAA,wDCWP+4D,MAAar0D,YACb2pN,MACAgE,MACAk3C,GACApvD,MACAjjB,MACA0iB,MACA8Y,MACAI,KACAtkK,MACA8N,MACA/tD,MAAiB5J,OAAA8J,OAAA,oEAAAC,gBAAA,KAGRggQ,KAAgBrtO,OAAA,IA1B5B8U,OAAc,CACbvoB,KAAM,MACNpjB,MAAO,4BACPD,KAAM,SACP,EAAC03B,GAAAC,IAAA,qBAmEoBy5N,GACCyB,GACQN,MA/ClB4R,kDC1CL1uQ,MAAA,gEAEEA,MAAA,QAAA4uQ,6CAOF5uQ,MAAA,+BAIEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAA7qB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAuuO,qBAAoB,GAC9B7uQ,iDAFCA,MADA,SAAAsgC,EAAAsuL,WACA5uN,CADqB,QAAA4uQ,6CAIvB5uQ,MAAA,8BAIEA,MAAA,mBAAAA,MAAA2P,GAAA,MAAA2wB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAwuO,oBAAmB,GAC7B9uQ,iDAFCA,MADA,SAAAsgC,EAAAquL,UACA3uN,CADoB,QAAA4uQ,6CAItB5uQ,MAAA,0BAGEA,MAAA,mBAAAA,MAAA8P,GAAA,MAAA8+P,EAAA5uQ,QAAAqhD,MAAA/gB,GAAAtgC,MAAA,UAAAA,MAASsgC,GAAAspO,eAAAgF,GAAqB,GAC/B5uQ,sCAFCA,MAAA,QAAA4uQ,8BAvBF5uQ,MAAA,EAAA+uQ,GAAA,uCAKA/uQ,MADA,2BACAA,CAD2D,iCAiB3DA,MAZA,EAAAgvQ,GAAA,gCAYAhvQ,CAPC,EAAAivQ,GAAA,+BAODjvQ,CADC,EAAAkvQ,GAAA,4BAMDlvQ,MAAA,8DAzBGA,MAAA,OAAAsgC,EAAA6uO,kBAAAP,IAGkB5uQ,cAAA,QAAA4uQ,GAEnB5uQ,QACAA,MADA,kBACAA,CADqB,QAAA4uQ,GAIpB5uQ,cAAA,OAAAsgC,EAAA8uO,mBAAAR,IAMA5uQ,cAAA,OAAAsgC,EAAA+uO,kBAAAT,IAMA5uQ,cAAA,OAAAsgC,EAAAgvO,eAAAV,IAImB5uQ,cAAA,QAAA4uQ,6CAvC1B5uQ,MAAA,sBAUEA,MAAA,gCAAAqW,GAAArW,MAAAqgC,GAAA,MAAAC,GAAAtgC,QAAA,OAAAA,MAAwBsgC,GAAAivO,kBAAAl5P,GAAyB,GAEjDrW,MAAA,EAAAwvQ,GAAA,yBAAAxvQ,OA6BFA,gCAhCEA,MANA,oBAAAsgC,EAAAgpL,kBAMAtpN,CANuC,4BAAAsgC,EAAA8rL,0BAMvCpsN,CALuD,8BAAAsgC,EAAAqsL,4BAKvD3sN,CAJ2D,iCAAAsgC,EAAA2nL,+BAI3DjoN,CAHiE,iCAAAsgC,EAAAs1I,+BAGjE51K,CAFiE,aAAAsgC,EAAAgoL,WAEjEtoN,CADyB,MAAAsgC,EAAAjhB,+CAqC3Brf,MAAA,+CAKEA,MAAA,2BAAAqW,GAAArW,MAAA8tB,GAAA,MAAAwS,GAAAtgC,QAAA,OAAAA,MAAmBsgC,GAAAuqO,iBAAAx0P,GAAwB,GAI7CrW,gCAFEA,MAJA,sBAAAsgC,EAAAspL,oBAIA5pN,CAJ2C,sBAAAA,MAAA,IAAAsgC,EAAAwqO,sBAI3C9qQ,CAHoD,oBAAAsgC,EAAAgpL,kBAGpDtpN,CADuC,iCAAAsgC,EAAAs1I,yEAIzC51K,MAAA,EAAAyvQ,GAAA,6CAIAzvQ,MAAA,UAQEA,MAAA,8DAKFA,8BALEA,cAAA,IAAAA,MAAA,IAAAsgC,EAAA0qO,gBAAAxiQ,OAAAxI,MAAA,+CAAAA,MAAA,4EAaAA,MAAA,UAOEA,MAAA,wBACFA,eADEA,cAAA,IAAAA,MAAA,wFAIAA,MADF,kBACEA,CADiE,iBACvCA,MAAA,YAAMA,QAChCA,MAAA,aAGEA,MAAA,mBAAAA,MAAAurD,GAAA,MAAAjrB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAsoO,aAAY,GAErB5oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0FAIFA,MADF,kBACEA,CADkE,iBACxCA,MAAA,iBAAWA,QACrCA,MAAA,aAGEA,MAAA,mBAAAA,MAAAsQ,GAAA,MAAAgwB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAuoO,cAAa,GAEtB7oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,2FAIFA,MADF,kBACEA,CADkE,iBACxCA,MAAA,UAAIA,QAC9BA,MAAA,aAGEA,MAAA,mBAAAA,MAAAwrD,GAAA,MAAAlrB,EAAAtgC,MAAA,UAAAA,MAASsgC,EAAAwoO,cAAa,GAEtB9oQ,MAAA,wBAEJA,gBAFIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,4EAxCJA,MADF,aACEA,CAD2C,UAEzCA,MAAA,wBACFA,QA+BAA,MA9BA,EAAA0vQ,GAAA,UA8BA1vQ,CAxBC,EAAA2vQ,GAAA,uBAwBD3vQ,CApBmE,EAAA4vQ,GAAA,uBAoBnE5vQ,CAVoE,EAAA6vQ,GAAA,wBAoBtE7vQ,+BA1CIA,MAAA,GAAAA,MAAA,IAAAA,MAAA,0CAGCA,MAAA,GAAAA,MAAA,OAAAsgC,EAAA4pO,uBAAA5pO,EAAA6pO,qBAAA7pO,EAAA8pO,sBAAA9pO,EAAA+pO,uBASarqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA6pO,qBAUAnqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA8pO,sBAUApqQ,cAAA,OAAAsgC,EAAA4pO,sBAAA5pO,EAAA+pO,gDAlClBrqQ,MAAA,EAAA8vQ,GAAA,wCAAW9vQ,MAAA,OAAAsgC,EAAAiqO,6BCAR,IAAMwF,GAAN,MAAMA,GAsHFnR,mBACClB,UACDnB,SACCzlG,oBACAumG,kBAzHVt8M,QAAoC,IAAIpgD,IAAgB,IACxDmqQ,qBAAiD,IAAInqQ,KAAgB,GAE7D2iG,aACAioK,yBACDhB,4BAAsC,EAEpC3gD,qBAA+B,EAE/BT,qBAA+B,EAE/BlB,gCAA0C,EAE1C0E,6BAAuC,EAEvC/2C,gCAA0C,EAE1Co6F,qBAEArhD,WAAqB,EAErBC,YAAsB,EAEtBs7C,sBAAgC,EAEzC,qBACIrL,GACF,OAAOjgQ,KAAKqxQ,kBACd,CACA,qBAAIpR,CAAkBv5P,GACpB,MAAM4qQ,EAAetxQ,KAAKggQ,mBAAmBF,uBACvCyR,EAAeD,EAAa7kD,QAC5B+kD,EAAmBF,EAAahlD,YAChCmlD,GAAiBH,EAAa/kD,UAEpC7lN,EAAM+lN,QAA2B,KAAjB8kD,EAAsBA,EAAe7qQ,EAAM+lN,QAC3D/lN,EAAM4lN,iBACiBtqN,IAArBwvQ,EAAiCA,EAAmB9qQ,EAAM4lN,YAC5D5lN,EAAM6lN,eACevqN,IAAnByvQ,GAA+BA,GAAiB/qQ,EAAM6lN,UAExD7lN,EAAM4lN,iBACkBtqN,IAAtB0E,EAAM4lN,aAAoC5lN,EAAM4lN,YAClD5lN,EAAM6lN,eAAgCvqN,IAApB0E,EAAM6lN,WAAkC7lN,EAAM6lN,UAEhEvsN,KAAKqxQ,mBAAqB3qQ,CAC5B,CACQ2qQ,mBAAqB,GAE7B,OAAI5wP,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAESipM,YAAsB,EAE/B,2BAAIkjD,GACF,OAAO5sQ,KAAKmiD,QAAQp+C,QAClB0c,MAAKq/B,GACHA,EAAOp2C,OACJ+4C,GAAUA,EAAMoiE,SAASn+G,OAAS+7C,EAAM4hE,sBAAsB39G,QAIvE,CAEA,kBAAI0lQ,GACF,OAAOpsQ,KAAKmiD,QAAQp+C,QAClB0c,MAAKq/B,GAAWA,EAAOp2C,OAAQ+4C,GAAUA,EAAMoiE,SAASn+G,QAE5D,CAEA,qBAAIgkN,GACF,OAAO1qN,KAAKigQ,kBAAkBv1C,oBAAqB,CACrD,CAEA,6BAAI8C,GACF,MAAMq+C,EAAoBrlQ,OAAO6H,OAC/B,CACEikN,YAAaxF,MAAsBxgK,SAErCtsD,KAAKigQ,mBAGP,OAAQjgQ,KAAKigQ,kBAAkB3tC,aAC7B,KAAKxF,MAAsB/+J,OACzB89M,EAAkBv5C,YAAcxF,MAAsB/+J,OACtD,MACF,KAAK++J,MAAsB9+J,MACzB69M,EAAkBv5C,YAAcxF,MAAsB9+J,MAK1D,OAAO69M,CACT,CAEyC6F,SAEzC,uBAAInG,GACF,OACmE,IAAjEvrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,kBAC5C1I,KAAKk4J,oBACF4M,aACAp7J,OAAOq7J,OACPr7J,OAAQkS,GAAMA,EAAE5N,WAA6B,UAAhB4N,EAAEqmF,WAAuBr4F,OAAS,CAEtE,CAEA,wBAAI4hQ,GACF,OAAkE,IAA3DxrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,UACrD,CAEA,wBAAI+iQ,GACF,OAAyE,IAAlEzrQ,KAAK8+P,UAAUv0N,QAAQsM,aAAanuC,QAAQ,iBACrD,CAEA3I,YACSigQ,EACClB,EACDnB,EACCzlG,EACAumG,IAJDz+P,KAAAggQ,qBACChgQ,KAAA8+P,YACD9+P,KAAA29P,WACC39P,KAAAk4J,sBACAl4J,KAAAy+P,oBACP,CAEHlxP,WACEvN,KAAK2xQ,cACL3xQ,KAAK0kG,gBAAezhF,MAAc,CAChCjjB,KAAKygB,IAAI0hC,QACTniD,KAAKygB,IAAIyhC,eAAe+iD,cAEvBlhG,QAAKof,MAAa,KAClBtgB,UAAWke,IACV/gB,KAAKmiD,QAAQx/C,KACXoe,EAAM,GAAGrX,OACN+4C,MAC2B,IAA1BA,EAAMkH,iBACJ3pD,KAAK0qN,mBAAsBjoK,EAAMJ,YACtC,GAIHriD,KAAKgrN,qBACPhrN,KAAK29P,SAASpzC,yBAC0BvoN,IAAtChC,KAAK29P,SAASpzC,oBACVvqN,KAAK29P,SAASpzC,oBACdvqN,KAAKuqN,sBAAuB,EAClCvqN,KAAKksQ,qBAAqBvpQ,KAAK3C,KAAK29P,SAASpzC,sBAE7CvqN,KAAKksQ,qBAAqBvpQ,MAAK,GAIjCg8B,WAAW,IAAO3+B,KAAK2rQ,4BAA6B,EAAO,IAC7D,CAEAz9P,cACElO,KAAK0kG,aAAav2F,cACdnO,KAAK2sQ,0BACP3sQ,KAAK2sQ,yBAAyBx+P,aAElC,CAEA89P,iBAAiBviP,GACf1pB,KAAK29P,SAASpzC,oBAAsB7gM,EACpC1pB,KAAKksQ,qBAAqBvpQ,KAAK+mB,EACjC,CAEQioP,cACN,MAAMC,EAAkB5xQ,KAAKggQ,mBAAmBR,aAAa94P,MAE3D1G,KAAKggQ,mBAAmBJ,oBADF59P,IAApB4vQ,EACqCA,EAEL,WAA9B5xQ,KAAKoxQ,qBACgC,EAEA,EAG7C,CAEOS,WAAWhS,GAChB7/P,KAAKggQ,mBAAmBJ,eAAeC,EAAI5gP,OAC3Cjf,KAAKmiD,QAAQx/C,KACX3C,KAAKygB,IAAIq/B,OAAOp2C,OACb+4C,MAC2B,IAA1BA,EAAMkH,iBACJ3pD,KAAK0qN,mBAAsBjoK,EAAMJ,YAG3C,CAEAsuN,kBAAkBmB,GAChB9xQ,KAAKggQ,mBAAmBP,WAAWqS,EAAerlD,SAClDzsN,KAAKggQ,mBAAmBN,aAAaoS,EAAevlD,WACpDvsN,KAAKggQ,mBAAmBL,eAAemS,EAAexlD,YACxD,CAEAvB,gBACE,GAAuC,IAAnC/qN,KAAKmiD,QAAQxoB,WAAW/vB,OAC1B,OAAO,EACF,GAC8B,IAAnC5J,KAAKmiD,QAAQxoB,WAAW/vB,SACK,IAA7B5J,KAAKgrN,oBACL,CACA,IAAI6hD,EASJ,GARA7sQ,KAAK2sQ,yBAA2B3sQ,KAAK4sQ,wBAAwB/pQ,UAC1D6D,IAEMmmQ,EADY,IAAjBnmQ,EAAMkD,MAEwB,IAIH,IAA3BijQ,EACF,OAAO,CAEX,CACA,OAAO,CACT,CAEA7B,eAAevoN,GACb,IAAIvwC,EAAKuwC,EAAMvwC,GACXuwC,EAAM5iD,QAAQ46C,WAAWghK,cAC3BvpM,EACEuwC,EAAM5iD,QAAQ46C,UAAUghK,cAAgBh5J,EAAMvwC,GAC1CuwC,EAAM5iD,QAAQ46C,UAAUghK,YACxBh5J,EAAMvwC,IAEdlS,KAAKy+P,kBAAkBF,kBAAkB,CAAEz+M,OAAQ,CAAC5tC,KACpDlS,KAAKy+P,kBAAkBH,QAAQL,GAAiBh4M,QAChDjmD,KAAK8+P,UAAUv0N,QAAQuM,aAAa,eACtC,CAEAm5N,qBACEjwQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,mBACtC,CAEAo5N,oBACElwQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,kBACtC,CAEAkzN,aACEhqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,gBACtC,CAEAmzN,cACEjqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,UACtC,CAEAozN,cACElqQ,KAAK8+P,UAAUv0N,QAAQuM,aAAa,iBACtC,CAEA05N,mBAAmB/tN,GACjB,MAAM5iD,EAAU4iD,EAAMpsB,WAAWx2B,QACjC,OAAOG,KAAKgwN,YAAcnwN,EAAQowE,gBAAkBpwE,EAAQkwE,UAC9D,CAEA0gM,kBAAkBhuN,GAChB,MAAM5iD,EAAU4iD,EAAMpsB,WAAWx2B,QACjC,OACEG,KAAK+vN,WACLlwN,EAAQu4E,YACRv4E,EAAQu4E,WAAWznC,UAClB9wC,EAAQu4E,WAAWU,aAClBj5E,EAAQu4E,WAAWY,YACnBn5E,EAAQu4E,WAAWa,cACnBp5E,EAAQu4E,WAAWnrD,QACnBptB,EAAQu4E,WAAW/3C,cACnBxgC,EAAQu4E,WAAWjc,SAEzB,CAEAu0M,eAAejuN,GACb,SACGA,aAAiBsZ,QAAoC,IAArBtZ,EAAM24C,YACtC34C,EAAMpsB,WAAWx2B,QAAQwgF,UACxB59B,EAAMpsB,WAAWx2B,QAAQwgF,SAAS99E,KACnCkgD,EAAM5iD,QAAQ46C,WAAW9J,SACxB8R,EAAM5iD,QAAQ46C,WAAWghK,cAAgBh5J,EAAMvwC,GAKrD,CAEAq+P,kBAAkB9tN,GAChB,SAAIA,aAAiBsZ,OACdtZ,EAAsB5iD,SAAS2jD,UAAU2Y,SAKlD,4CAtSWg1M,IAAiB/vQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,MAAAyE,IAAAzE,MAAA0E,OAAA1E,MAAA2E,IAAA,+BAAjBorQ,GAAiB7iQ,UAAA,oBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,i/DDlF9B1N,MAAA,wCAGEA,MAAA,6BAAAqW,IAAArW,aAAAyK,GAAAzK,MAAqB2N,EAAA8iQ,WAAAp6P,IAAkB,GAEvCrW,MAAA,oCACEA,MAAA,EAAA2wQ,GAAA,yCA0CF3wQ,QAEAA,MAAA,oCAWEA,MAVA,EAAA4wQ,GAAA,8BAUA5wQ,CAFC,GAAA6wQ,GAAA,8BAMD7wQ,MAAA,GAAA8wQ,GAAA,+CAcF9wQ,QAEAA,MAAA,GAAA+wQ,GAAA,yBAAA/wQ,OA+CFA,kCA9HEA,MAAA,gBAAAA,MAAA,IAAA2N,EAAAixP,mBAAAR,eAGSp+P,MAAA,GAAAA,MAAA,QAAAA,MAAA,sCAEJA,MAAA,GAAsCA,MAAtC,WAAAA,MAAA,KAAA2N,EAAAozC,SAAAv4C,OAAsCxI,CAAA,WAAAgxQ,GA2ClChxQ,MAAA,GAAAA,MAAA,QAAAA,MAAA,sCAEJA,MAAA,GAAAA,MAAA,OAAA2N,EAAAg8M,iBAUA3pN,QAAsCA,MAAtC,WAAAA,MAAA,MAAA2N,EAAAozC,SAAAv4C,OAAsCxI,CAAA,WAAAgxQ,GAKtChxQ,MAAA,GAAAA,MAAA,QAAA2N,EAAAi8M,qBAAA,IAAA5pN,MAAA,MAAA2N,EAAAozC,SAAAv4C,QAAA,IAAAxI,MAAA,MAAA2N,EAAA69P,yBAAAhjQ,wBCJHuwD,MAAan0D,YACbmJ,KACAsgN,MACAgE,MACAiJ,MACAxI,KACAJ,MACA9Y,MACA1iB,MACAijB,MACAovD,GACAhgD,MACAiB,MACAx8M,MAAauF,wBACbnF,MAAaqF,MACbnF,KACAC,MAAiBmF,OAAAjF,OAAA,8lCAAAC,gBAAA,KAGRqhQ,MAAiB1uO,OAAA,IA/B7B8U,OAAc,CACbvoB,KAAM,WACNpjB,MAAO,4BACPD,KAAM,SACP,EAAC03B,GAAAC,IAAA,qBAiJ6Bg8N,GACRd,GACFzB,GACYn1F,MACFs2F,MA1HlBiT,ICpDN,IClBMkB,GAAY,MAAnB,MAAOA,EAMS1U,SAFbztP,MAEPnQ,YAAoB49P,GAAA39P,KAAA29P,WAClB39P,KAAKkQ,MAAQ,IAAIitF,MAAiC,GAAI,CACpD18E,IAAKzgB,KAAK29P,SAASl9O,MAGrBzgB,KAAK29P,SAASl9O,IAAI0hC,QAAQt/C,UAAWi9C,IAEkC,IAAnEA,EAAOp2C,OAAQq2C,GAAMA,EAAE7tC,IAAI6uF,WAAW,kBAAkBn3F,SAExD5J,KAAKkQ,MAAMiW,WAAWnmB,KAAKkQ,MAAM+R,OACjCjiB,KAAK29P,SAASl9O,IAAI4gC,GACfixN,cACAxhL,WACApnF,OAAQmI,GACNA,EAAgBhS,QAAQi/B,UAAU9G,SAAS,oBAE7CvX,IAAK5O,GAAY7R,KAAK29P,SAASl9O,IAAI4gC,GAAGy4F,cAAcjoI,IAAQ,EAGrE,4CAzBWwgQ,GAAYjxQ,MAAAuE,IAAA,iCAAZ0sQ,EAAYhxQ,QAAZgxQ,EAAY/wQ,UAAAC,WAFX,gBAED8wQ,CAAY,KCgBZE,GAAN,MAAMA,GAkBDC,aACA7U,SAdV,SAAIztP,GACF,OAAOlQ,KAAKwyQ,aAAatiQ,KAC3B,CAMA,OAAIuQ,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YACUyyQ,EACA7U,GADA39P,KAAAwyQ,eACAxyQ,KAAA29P,UACP,4CApBQ4U,IAAqBnxQ,MAAAuE,IAAAvE,MAAAwE,IAAA,+BAArB2sQ,GAAqBjkQ,UAAA,wBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,oBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GC5BlC1N,MAAA,yBAA8BA,MAAhB,QAAA2N,EAAAmB,MAAgB9O,CAAD,MAAA2N,EAAA0R,oBD0BjBm0H,OAAiBpyG,cAAA,EAAA1yB,gBAAA,KAEhByiQ,MAAqB9vO,OAAA,IAZjC8U,OAAc,CACbvoB,KAAM,WACNpjB,MAAO,iCACPD,KAAM,iBACP,EAAC03B,GAAAC,IAAA,qBA0BwB+uO,GACJtV,MAnBTwV,IEjBN,ICOME,GAAN,MAAMA,GAKS9U,SAJpB,OAAIl9O,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA1gB,YAAoB49P,GAAA39P,KAAA29P,UAAqB,4CAL9B8U,IAAkBrxQ,MAAAuE,IAAA,+BAAlB8sQ,GAAkBnkQ,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,YAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,GClB/B1N,MAAA,sBAAWA,MAAA,MAAA2N,EAAA0R,oBDgBCkuN,OAAcnsM,cAAA,KAEbiwO,MAAkBhwO,OAAA,IAX9B8U,OAAc,CACbvoB,KAAM,QACNpjB,MAAO,8BACPD,KAAM,WACP,EAAC03B,GAAAC,IAAA,qBAY8By5N,MALnB0V,4CEqBN,IAAMC,GAAW,MAAlB,MAAOA,EA4DDx6G,oBACA/7G,eACA2oN,eACAt8N,cACAm1N,SA/DHgV,kBAA6C,GAC7CC,mBAA+C,GAC/CC,4BAAwD,GACxDC,wBAAoD,GAEpDC,sBACAC,uBAOAC,cAAqC,CAC1CzqP,SAAUqyE,MAAc59E,QACxBw0B,MAAOopD,MAAcj9E,MAGds1P,oBAA+C,IAAInxQ,IAC1D,KAGOoxQ,YAAuC,IAAIpxQ,SAClDC,GAGOy1J,YAAuC,IAAI11J,SAClDC,GAGOoxQ,gBAA4C,IAAIrxQ,KACvD,GAGOsxQ,8BACP,IAAItxQ,KAAgB,GAEbuxQ,sBACP,IAAIvxQ,SAAgBC,GAEbuxQ,gBAAiD,IAAIxxQ,SAC5DC,GAMOkO,MAAQ,IAAI7E,KAA0B,IAK/C,eAAImsJ,GACF,OAAOx3J,KAAKk4J,oBACTgC,oBACAz5I,IAAKgD,GAA0BA,EAAO1jB,YAAoByD,KAC/D,CAEAzD,YACUm4J,EACA/7G,EACA2oN,EACAt8N,GACAm1N,IAJA39P,KAAAk4J,sBACAl4J,KAAAm8C,iBACAn8C,KAAA8kQ,iBACA9kQ,KAAAwoC,iBACAxoC,KAAA29P,YAER,MAAMiV,GACJ5yQ,KAAKwoC,cAAcpoC,UAAU,sBAC3BwyQ,KACF5yQ,KAAK4yQ,mBAAqBA,GAAmBnzN,KAC7Cz/C,KAAK6yQ,4BAA8BD,GAAmBlmP,UACtD1sB,KAAK8yQ,wBAA0BF,GAAmBnhO,OAGpD,MAAMsmH,GAA+B/3J,KAAKm8C,eAAej8C,IACvD,gCAEE63J,IACF/3J,KAAKqzQ,8BAA8B1wQ,KAAKo1J,IAE1C/3J,KAAKkQ,MAAMqV,YAAYvlB,KAAKwzQ,kCAAkC,GAE9D,MAAMC,GAAYzzQ,KAAKk4J,oBACpB4M,aACA1iJ,KAAMqB,IAA8B,cAAnBA,GAAOm5D,SACvB62L,IACFzzQ,KAAK8kQ,eAAe50P,MAAMuU,UAAU5hB,UAAW8oC,KAC7C,MAAM+nO,GAAgB/nO,GAAEjiC,OACrBigK,IACCA,cAAc2tE,OACd3tE,GAAGlnH,MAAM5iD,QAAQ46C,UAAUskK,oBAE/B/+M,KAAKk4J,oBAAoB2P,cAAc4rG,GAAWC,GAAa,GAGnE1zQ,KAAK2zQ,sBACP,CAEQA,uBACN3zQ,KAAK29P,SAASl9O,IAAI0hC,QAAQt/C,UAAWi9C,IACnC9/C,KAAK2yQ,kBAAkBp4P,QAASrK,IAE9B,IADY4vC,EAAO19B,KAAM29B,IAAMA,GAAE7tC,KAAOhC,EAAMuyC,MAAMvwC,IACxC,CACV,MAAM+M,GAAQjf,KAAK2yQ,kBAAkBjqQ,QAAQwH,GAC7ClQ,KAAK2yQ,kBAAkB9sP,OAAO5G,GAAO,EACvC,GACD,EAEL,CAEQu0P,iCAIN,OAAO,IAAIzrP,KAAoC,CAC7CK,iBAJwB7B,GACY,MAA7BA,EAAOvI,OAAOK,KAAKm4M,OAK9B,CAMAo9C,mCACE,MAAMpuP,EAAWxlB,KAAKkQ,MAAM6V,kBAC1BgC,WAEe/lB,IAAbwjB,GACFA,EAASC,UAEb,CAMAouP,qCACE,MAAMruP,EAAWxlB,KAAKkQ,MAAM6V,kBAC1BgC,WAEe/lB,IAAbwjB,GACFA,EAASU,YAEb,CAEA4tP,eACE9zQ,KAAKozQ,gBAAgBzwQ,MAAK,EAC5B,CAEAoxQ,gBACE/zQ,KAAKozQ,gBAAgBzwQ,MAAK,EAC5B,CAEAqxQ,cAAc/rG,GACZjoK,KAAKmzQ,YAAYxwQ,KAAKslK,EACxB,CAEArP,cAAcvmE,GACZryF,KAAKk4J,oBAAoBwK,oBAAoBrwE,GAC7CryF,KAAKy3J,YAAY90J,KAAK0vF,EACxB,CAEA4hL,0BACEj0Q,KAAKszQ,sBAAsB3wQ,MAAK,EAClC,CAEAuxQ,kBAAkB7qO,GAChBrpC,KAAKuzQ,gBAAgB5wQ,KAAK0mC,EAC5B,CAEA8qO,+BAA+BztQ,GAC7B1G,KAAKm8C,eAAe97C,IAAI,+BAAgCqG,GACxD1G,KAAKqzQ,8BAA8B1wQ,KAAK+D,EAC1C,4CA7KWgsQ,GAAWtxQ,MAAAuE,OAAAvE,MAAAwE,MAAAxE,MAAAyE,IAAAzE,MAAA0E,OAAA1E,MAAA2E,IAAA,iCAAX2sQ,EAAWrxQ,QAAXqxQ,EAAWpxQ,mBAAXoxQ,CAAW,4BCjClBtxQ,MANN,UAMMA,CAHL,cAGKA,CAF4B,OAE5BA,CADE,YACMA,MAAA,wBAGVA,UAEEA,MADF,MACEA,CADC,YACOA,MAAA,wBAGVA,UACAA,MAAA,2DAMJA,iBAfcA,MAAA,GAAAA,YAAA,oDAKAA,MAAA,GAAAA,YAAA,mDAKRA,MAAA,GAAAA,MAAA,YAAAA,MAAA,KAAAA,MAAA,oDAAAA,iCAmCEA,MAAA,+DAKEA,MAJA,MAAAkK,EAAAmV,IAIArf,CAJW,QAAAkK,EAAA4E,MAIX9O,CAHe,SAAAkK,EAAAoc,OAGftmB,CAFiB,QAAAgzQ,EAEjBhzQ,CADgB,0BAAAkK,EAAA4wJ,mEA4BpB96J,MAAA,qDAYEA,MAAA,mBAAAA,MAAAmrD,GAAA,MAAAjhD,EAAAlK,MAAA,UAAAA,MAASkK,EAAAg7P,sBAAqB,GAE9BllQ,MAAA,mDAMGA,MAAA,aAELA,mCAjBEA,MAAA,aAAAA,MAAA,IAAAA,MAAA,IAAAkK,EAAA+oQ,4BAAA,6HAWEjzQ,MAAA,GAGAA,MAHA,WAAAA,MAAA,IAAAkK,EAAA+oQ,4BAAA,OAGAjzQ,CAH4D,sBAAAA,MAAA,IAAAkK,EAAA+oQ,uEAnClEjzQ,MAAA,kBAGEA,MAAA,iBAAAqW,GAAArW,MAAAkP,GAAA,MAAAhF,GAAAlK,MAAA,UAAAA,MAASkK,GAAAgpQ,eAAA78P,GAAsB,GAG/BrW,MAAA,eAIEA,MAAA,mBAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAASkK,EAAAgpQ,iBAAgB,GAEzBlzQ,MAAA,cAAUA,MAAA,oBAKZA,UAEAA,MAAA,EAAAmzQ,GAAA,kBAwBAnzQ,MAAA,6CAKEA,MAAA,0BAAAA,MAAAkP,GAAA,MAAAhF,EAAAlK,MAAA,UAAAA,MAAgBkK,EAAAskO,WAAU,GAG9BxuO,mCA/CEA,MAHA,QAAAkK,EAAAkpQ,aAGApzQ,CAHsB,oBAWVA,MAAA,GAAAA,MAAA,cAAAA,MAAA,IAAAkK,EAAAmpQ,gBAAA,iCAQTrzQ,MAAA,GAAAA,MAAA,OAAAkK,EAAAR,QAAAw+E,UAyBDloF,QAEAA,MAFA,UAAAA,MAAA,IAAAkK,EAAA80F,UAEAh/F,CAF4B,MAAAkK,EAAAmV,IAE5Brf,CADW,UAAAkK,EAAAwzP,UAAAv0N,mDAvFnBnpC,MAAA,uCAYIA,MADF,UACEA,CADuB,0BAarBA,MALA,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAekK,GAAAopQ,cAAAj9P,GAAqB,EAKpCrW,CALqC,wBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MACrBkK,GAAAuzJ,eAAApnJ,GAAsB,EAItCrW,CAJuC,yBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MACtBkK,GAAAqpQ,gBAAAl9P,GAAuB,EAGxCrW,CAHyC,4BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MACrBkK,GAAAopQ,cAAAj9P,GAAqB,EAEzCrW,CAF0C,4BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MACtBkK,GAAAqpQ,gBAAAl9P,GAAuB,EAC3CrW,CAD4C,uBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAC7BkK,GAAAo8J,SAAAjwJ,GAAgB,GAG/BrW,MAAA,EAAAwzQ,GAAA,yBAAAxzQ,OAWJA,UAEAA,MAAA,YACEA,MAAA,EAAAyzQ,GAAA,sCAqDJzzQ,kCArFEA,MAAA,QAAAA,MAAA,IAAAkK,EAAA80F,UAAA90F,EAAAwpQ,cAAA,WAII1zQ,MAAA,GAYAA,MAZA,QAAAkK,EAAA4E,MAYA9O,CAZe,YAAAkK,EAAAgyJ,UAYfl8J,CAXuB,OAAAkK,EAAA4iD,KAWvB9sD,CAVa,eAAAkK,EAAA4tJ,aAUb93J,CAT6B,kBAAAkK,EAAA81J,gBAS7BhgK,CARmC,MAAAkK,EAAAmV,KA0BlCrf,MAAA,GAAAA,MAAA,OAAAA,MAAA,KAAAkK,EAAA80F,YCqBA,IAAM20K,GAAN,MAAMA,GA2FDpX,SACAqX,YACAljQ,MACDgtP,UACC4B,eA3FDpjG,WAAqB,EAKrB23G,qBAA+B,WAEhCC,+BAAyC,EAC1Ch5G,yBAAmC,EAElCi5G,wBACAC,WACAC,uBAAoC,GACpCC,+BAA4C,GAC5CC,eAAgD,IAAIxzQ,SAC1DC,GAEKqyQ,2BAA6B,IAAItyQ,KAAgB,GAChDyzQ,4BACAC,sBACAC,uBAEDC,gBAA4C,IAAI5zQ,KAAgB,GAC/D6zQ,iBAMR,SAAI1lQ,GACF,OAAOlQ,KAAKg1Q,YAAY9kQ,KAC1B,CAMA,OAAIuQ,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEA,gBAAI+zP,GACF,OAAOx0Q,KAAK8K,WAAUyT,MAAeve,KAAK8K,cAAW9I,CACvD,CAEA,YAAIo+F,GACF,OAAOpgG,KAAKkQ,MAAMwU,UACfrC,SAAUspB,GAAMA,EAAEn7B,MAAM4gC,SACxBrtC,QACC0c,MACGpY,GACErI,KAAK8K,QAAUzC,EACXA,EAAQ2V,OAAO/Z,UAChBjC,GAGd,CAEO8I,QAEAojD,KAAO,GACN2nN,aAEDz0G,gBAAkB,IAAIr/J,SAAyBC,GAE/CyyQ,eAAiB,IAAI1yQ,IAA+B,WACnD+zQ,gBAER,iBACIhB,CAAcpuQ,GAChB1G,KAAKy0Q,eAAe9xQ,KAAK+D,EAC3B,CACA,iBAAIouQ,GACF,OAAO90Q,KAAKy0Q,eAAe/tQ,KAC7B,CAEA,gBAAIwyJ,GACF,OAAOl5J,KAAKg1Q,YAAY9B,oBAAoBxsQ,KAC9C,CAEQixB,OAAS,IAAIimI,KAErB,UAAIl2I,GACF,OAAO1nB,KAAKg1Q,YAAYrC,iBAC1B,CAEA5yQ,YACU49P,EACAqX,EACAljQ,EACDgtP,EACC4B,GACRl4N,IALQxoC,KAAA29P,WACA39P,KAAAg1Q,cACAh1Q,KAAA8R,QACD9R,KAAA8+P,YACC9+P,KAAA0gQ,kBAGR1gQ,KAAKk1Q,8BAAgC1sO,GAAcpoC,UACjD,iCAEFJ,KAAKk8J,wBAA0B1zH,GAAcpoC,UAC3C,0BAEJ,CAEAmN,WACEvN,KAAK61Q,aAAe71Q,KAAKg1Q,YAAY7B,YAAYtwQ,UAC9ColK,IAGkB,MAAfA,GACe,KAAfA,GAEAjoK,KAAKkuD,KAAO+5G,EACZjoK,KAAK21Q,gBAAgBhzQ,MAAK,IACF,KAAfslK,GACTjoK,KAAK21Q,gBAAgBhzQ,MAAK,EAAI,GAKpC,UAAWg7C,KAAO39C,KAAKkQ,MAAMwU,UAAUhU,OAAOhK,OACM,IAA9C1G,KAAKkQ,MAAMM,MAAMtQ,IAAIy9C,EAAI3/B,QAAQwK,WACnCxoB,KAAK80Q,cAAgB,YAIzB90Q,KAAKg1Q,YAAY1B,sBAAsBzwQ,UAAU,KAC/C7C,KAAKohK,gBAAgBz+J,MAAK,EAAI,GAGhC3C,KAAK81Q,gBAAkB91Q,KAAKy0Q,eAAe5xQ,UAAU,KACnD,MAAMkxC,EAAU/zC,KAAK+1Q,oBAAoB,GACnCvtP,EAAWxoB,KAAK+1Q,oBAAoB,GACtCvtP,GACFmW,WAAW,KAEJ3+B,KAAKi0C,mBAAmBF,EAASvrB,IACpCxoB,KAAKg2Q,eAAejiO,EAASvrB,EAAQ,EAEtCmV,KAAkBiB,eAAiB,GAAE,GAIxC5+B,KAAKk1Q,gCACFl1Q,KAAKg1Q,YAAYjC,wBACpB/yQ,KAAKg1Q,YAAYjC,yBAAwB9vP,MAAc,CACrDjjB,KAAKu1Q,eACLv1Q,KAAKygB,IAAIyhC,eAAe+iD,cACvBpiG,UAAWke,GACZ/gB,KAAKi2Q,oBAAoBl1P,EAAM,GAAI,aAIlC/gB,KAAKg1Q,YAAYhC,yBACpBhzQ,KAAKg1Q,YAAYhC,0BAAyB/vP,MAAc,CACtDjjB,KAAKg1Q,YAAYzB,gBACjBvzQ,KAAKygB,IAAIyhC,eAAe+iD,cACvBpiG,UAAWke,GACZ/gB,KAAKi2Q,oBAAoBl1P,EAAM,GAAI,eAIzC/gB,KAAKk2Q,yBAELl2Q,KAAKm1Q,2BAA0BlyP,MAAc,CAC3CjjB,KAAKg1Q,YAAY3B,8BACjBrzQ,KAAKkQ,MAAMwU,UAAUhU,OACrB1Q,KAAKu1Q,eACLv1Q,KAAKg1Q,YAAYzB,gBACjBvzQ,KAAKg1Q,YAAY7B,YACjBnzQ,KAAKygB,IAAIyhC,eAAe+iD,cACvBpiG,UAECke,IASA,MAAMg3I,EAA+Bh3I,EAAM,GACrCo1P,EAAgBp1P,EAAM,GAExB/gB,KAAKk1Q,+BACPl1Q,KAAKo2Q,qBAAqB,SAE5Bp2Q,KAAKq1Q,uBAAuB50P,IAAK4oB,IAC/BrpC,KAAKygB,IAAIqhH,oBAAoBjlD,cAAcxzC,KAEjB8sO,EAAczsQ,OACvC2/B,IACCA,GAAOrrB,OAAOK,KAAK+9I,WAAapvE,OAChC3jD,GAAOrrB,OAAO/Z,KAAKqlF,WAClBjgD,GAAO74B,MAAMgY,WACb6gB,GAAO74B,MAAM4gC,SAGE3wB,IAAK4oB,KACnB0uH,IACF1uH,GAAOrrB,OAAO/Z,KAAKoa,KAAKlI,SAAQs+N,OAC9BjuO,OAAO6H,OACL,GACA,CACEvD,QAASu+B,GAAOrrB,OAAO/Z,MAEzBjE,KAAKg1Q,YAAYpC,mBACjBvpO,GAAOrrB,OAAO7H,OAAOspC,KAAOpW,GAAOrrB,OAAO7H,MAAMspC,KAAO,KAG3Dz/C,KAAKq1Q,uBAAuB/tQ,KAAK+hC,GAAOrrB,OAAO/Z,MAC/CjE,KAAKygB,IAAIqhH,oBAAoBhlD,WAC3BzzC,GAAOrrB,OAAO/Z,KACd42F,MAAcj9E,MAEZ5d,KAAKk1Q,+BACPl1Q,KAAKi2Q,oBACH5sO,GAAOrrB,OACP,SAAO,EAId,GAILhe,KAAK41Q,iBAAmB51Q,KAAKkQ,MAAMwU,UAAU5C,OAC1C/d,QAAKof,MAAa,OAClBtgB,UAAWuN,GAAUpQ,KAAK21Q,gBAAgBhzQ,KAAKyN,GACpD,CAEQ8lQ,yBACNl2Q,KAAKw1Q,+BAA8BvyP,MAAc,CAC/CjjB,KAAKygB,IAAIyhC,eAAewX,OACxB15D,KAAKg1Q,YAAYzB,kBAEhBxvQ,QAAKof,MAAa,MAClBtgB,UAAWke,IACV,MAAMs1P,EAAiBt1P,EAAM,GAC7B,GAAKs1P,GAIL,GAAIA,EAAepyQ,KAAKqlF,SAAU,CAChC,MAAMgtL,KAAoBl1K,OACxBi1K,EAAepyQ,KACfjE,KAAKygB,IAAIuhC,YAELu0N,KAA0B5zK,OAC9B,CAAC2zK,GACDt2Q,KAAKygB,IAAIyhC,eAAe6hD,mBAE1B/jG,KAAKq0Q,2BAA2B1xQ,QAC9BygG,OAAqBpjG,KAAKygB,IAAIojE,YAAa0yL,GAE/C,OAfEv2Q,KAAKq0Q,2BAA2B1xQ,MAAK,EAevC,EAEN,CAEQszQ,oBACN5sO,EACAh8B,GAKA,GAHgB,UAAZA,GACFrN,KAAKo2Q,qBAAqB/oQ,IAEvBg8B,IAAWA,EAAOplC,KAAKqlF,SAC1B,OAGF,MAAM4Z,KADc9B,OAAY/3D,EAAOplC,KAAMjE,KAAKygB,IAAIuhC,YACvBmrC,cAC/B,MACEsW,OACEzjG,KAAKygB,IAAIyhC,eACTghD,EAAWrf,YACX,OAEF,CACA,MAAMrT,GAAS0yB,EAAWrf,YAGpBo3K,GAAW,IAAItuK,KAAU,CAC7B39D,KAAM,GAAG3hB,mBACTi8E,SAAU,IAAI3nC,KAAQ,CAJd6uB,GAAO,IAAMA,GAAO,GAAKA,GAAO,IAAM,EACtCA,GAAO,IAAMA,GAAO,GAAKA,GAAO,IAAM,MAK1CgmM,MAAiBh0K,OAAcy4J,GAAUj7P,KAAKygB,IAAIuhC,YAExD,IAAIy0N,GACAC,GAAe,EAEnB,OAAQrpQ,GACN,IAAK,UACHopQ,MAAgBpiC,OACd7tO,OAAO6H,OACL,GACA,CAAEvD,QAAS0rQ,IACXx2Q,KAAKg1Q,YAAYlC,wBACjBzpO,EAAOlzB,OAAOs7B,MAAQpI,EAAOlzB,MAAMs7B,MAAQ,KAG/CilO,GAAe,EACf,MACF,IAAK,QACHD,MAAgBhiC,OACdjuO,OAAO6H,OACL,GACA,CAAEvD,QAAS0rQ,IACXx2Q,KAAKg1Q,YAAYpC,mBACjBvpO,EAAOlzB,OAAOspC,KAAOpW,EAAOlzB,MAAMspC,KAAO,KAG7C,MACF,IAAK,WACHg3N,MAAgBpiC,OACd7tO,OAAO6H,OACL,GACA,CAAEvD,QAAS0rQ,IACXx2Q,KAAKg1Q,YAAYnC,4BACjBxpO,EAAOlzB,OAAOuW,UAAY2c,EAAOlzB,MAAMuW,UAAY,KAGvDgqP,GAAe,EAGnBF,GAAen4P,KAAKlI,MAAQsgQ,GAC5BD,GAAen4P,KAAKlI,MAAM+tG,UAAU,IAAOwyJ,IAC3C12Q,KAAKygB,IAAIshH,qBAAqBjlD,WAC5B05L,GACAx2Q,KAAKg1Q,YAAY/B,cAAcxhO,OAEjB,YAAZpkC,IACFrN,KAAKy1Q,sBAAwBe,IAEf,aAAZnpQ,IACFrN,KAAK01Q,uBAAyBc,IAEhB,UAAZnpQ,GACFrN,KAAKs1Q,+BAA+BhuQ,KAAKkvQ,GAE7C,MACEx2Q,KAAKo2Q,qBAAqB/oQ,EAE9B,CAEQ+oQ,qBAAqB/oQ,GACX,YAAZA,GAAyBrN,KAAKy1Q,wBAChCz1Q,KAAKygB,IAAIshH,qBAAqBllD,cAAc78E,KAAKy1Q,uBACjDz1Q,KAAKy1Q,2BAAwBzzQ,GAEf,aAAZqL,GAA0BrN,KAAK01Q,yBACjC11Q,KAAKygB,IAAIshH,qBAAqBllD,cAAc78E,KAAK01Q,wBACjD11Q,KAAK01Q,4BAAyB1zQ,GAEhB,UAAZqL,IACFrN,KAAKs1Q,+BAA+B70P,IAAKk2P,GACvC32Q,KAAKygB,IAAIshH,qBAAqBllD,cAAc85L,IAE9C32Q,KAAKs1Q,+BAAiC,GAE1C,CAEApnQ,cACElO,KAAK81Q,gBAAgB3nQ,cACrBnO,KAAK61Q,aAAa1nQ,cACdnO,KAAKw1Q,6BACPx1Q,KAAKw1Q,4BAA4BrnQ,cAE/BnO,KAAKm1Q,yBACPn1Q,KAAKm1Q,wBAAwBhnQ,cAE3BnO,KAAKo1Q,YACPp1Q,KAAKo1Q,WAAWjnQ,cAEdnO,KAAK41Q,kBACP51Q,KAAK41Q,iBAAiBznQ,aAE1B,CAOAumQ,cAAcrrO,GAEZ,GADArpC,KAAKu1Q,eAAe5yQ,KAAK0mC,GACrBA,EAAOhrB,KAAK+9I,WAAapvE,OAAW3jD,EAAOplC,KAAKqlF,SAAU,CAC5DjgD,EAAOplC,KAAKoa,KAAKlI,SAAQk+N,OACvB7tO,OAAO6H,OACL,GACA,CAAEvD,QAASu+B,EAAOplC,MAClBjE,KAAKg1Q,YAAYlC,wBACjBzpO,EAAOlzB,OAAOs7B,MAAQpI,EAAOlzB,MAAMs7B,MAAQ,KAI/C,MAAM3mC,EACJ9K,KAAKygB,IAAIshH,qBAAqB1rG,WAAWgrB,GAAGs7B,eAC1CtzC,EAAOhrB,KAAKnM,IAEhB,GAAIpH,EAEF,YADAA,EAAQm5F,SAAS56D,EAAOplC,KAAKoa,KAAKlI,OAGpCnW,KAAKygB,IAAIshH,qBAAqBjlD,WAC5BzzC,EAAOplC,KACPjE,KAAKg1Q,YAAY/B,cAAcxhO,MAEnC,CACF,CAEAkjO,gBAAgBtrO,GAEd,GADArpC,KAAKu1Q,eAAe5yQ,UAAKX,GACrBqnC,EAAOhrB,KAAK+9I,WAAapvE,MAI7B,KAA8C,IAA1ChtF,KAAKkQ,MAAMM,MAAMtQ,IAAImpC,GAAQ7gB,SAAmB,CAClD,MAAM1d,EACJ9K,KAAKygB,IAAIshH,qBAAqB1rG,WAAWgrB,GAAGs7B,eAC1CtzC,EAAOhrB,KAAKnM,IAEhB,GAAIpH,EAAS,CACX,MAAMqL,KAAQk+N,OACZ7tO,OAAO6H,OACL,GACA,CAAEvD,QAASu+B,EAAOplC,MAClBjE,KAAKg1Q,YAAYlC,wBACjBzpO,EAAOlzB,OAAOs7B,MAAQpI,EAAOlzB,MAAMs7B,MAAQ,KAG/C3mC,EAAQm5F,SAAS9tF,EACnB,CACA,MACF,CACAnW,KAAKygB,IAAIshH,qBAAqBllD,cAAcxzC,EAAOplC,KAAe,CACpE,CAOA46J,eAAex1H,GAab,GAZArpC,KAAKygB,IAAIshH,qBAAqB1rG,WAAWgrB,GAAGv6C,QAC5C9G,KAAK42Q,mBAAmBvtO,EAAQrpC,KAAKg1Q,YAAY/B,cAAczqP,UAC/DxoB,KAAKg1Q,YAAYd,kBAAkB7qO,GAER,YAAvBrpC,KAAK80Q,gBAEL90Q,KAAK80Q,cAD2B,cAA9B90Q,KAAKi1Q,qBACc,WAEA,aAIE,aAAvBj1Q,KAAK80Q,cAA8B,CACrC,MAAM/gO,EAAU/zC,KAAK+1Q,oBAAoB,GACnCvtP,EAAWxoB,KAAK+1Q,oBAAoB,GACrC/1Q,KAAKi0C,mBAAmBF,EAASvrB,IACpCxoB,KAAKg2Q,eAAejiO,EAASvrB,EAEjC,CACF,CAEAk/I,SAASh+I,GACP,MAAM01D,EAAU11D,EAAM01D,QAChBo7E,EAAax6J,KAAKkQ,MAAMuU,UAAU/d,MACrCgD,OAAQ2/B,GAAyBA,EAAO5lB,SAAWiG,EAAM4wI,SAAS72I,QAClE9C,OAAOy+D,GAEVp/E,KAAKkQ,MAAMgV,KAAKs1I,GAEhB,UAAW78G,KAAO39C,KAAKkQ,MAAM+R,OAEa,IAAtCjiB,KAAKkQ,MAAMM,MAAMtQ,IAAIy9C,GAAKvM,UACa,IAAvCpxC,KAAKkQ,MAAMM,MAAMtQ,IAAIy9C,GAAKn1B,UAE1BxoB,KAAKkQ,MAAMM,MAAMmP,OAAOg+B,EAAK,CAAEvM,SAAS,IAAS,GAIrDzS,WAAW,KACT,MAAMoV,EAAU/zC,KAAK8R,MAAMmB,cAAcgD,cAAc,YACvD,IAAIqrJ,GACJ53I,EAAM4wI,SAASn6G,QAAQt9C,UAAW4gB,KAI9B69I,GAHG79I,GAAO,IAAOA,GAAO,GAAGA,OAEW,aAA7BA,GAAO,GAAGA,OAAOm5D,QACZ7oC,EAAQ99B,cAAc,0BACE,WAA7BwN,GAAO,GAAGA,OAAOm5D,QACZ7oC,EAAQ99B,cAAc,wBACE,cAA7BwN,GAAO,GAAGA,OAAOm5D,QACZ7oC,EAAQ99B,cAAc,2BAEtB89B,EAAQ99B,cACpB,IAAMwN,GAAO,GAAGA,OAAOm5D,QAAU,iBATrB,KAcE,OAAhB0kF,KACCthK,KAAKi0C,mBAAmBF,EAASutH,MAElCvtH,EAAQ1gC,UACNiuJ,GAAYlvH,UACZkvH,GAAYptH,aACZH,EAAQ7gC,eAEb,EACA,IACL,CAEA6iQ,oBACE,MAAMniO,EAAQtrC,SAAS04D,qBAAqB,2BACtCjtB,EACJ/zC,KAAK8R,MAAMmB,cAAc+tD,qBAAqB,YAAY,GAC5D,IAAIhuB,EAEJ,QAAS5D,EAAI,EAAGA,EAAIwE,EAAMhqC,OAAQwlC,IAC5BwE,EAAMxE,GAAGtQ,UAAU9G,SAAS,4BAC9Bgb,EAAeY,EAAMxE,IAGzB,MAAO,CAAC2E,EAASf,EACnB,CAEAgjO,eAAe9iD,EAAY5+K,GACpBt0C,KAAKi0C,mBAAmBi/K,EAAY5+K,KACvC4+K,EAAW7/M,UACTihC,EAAKlC,UACLkC,EAAK7T,SAAS,GAAGyT,aACjBg/K,EAAWhgN,aAEjB,CAEAohQ,eAAe5qP,GACTA,GAA8C,oBAApCA,EAAM9S,QAAgBkoB,YAIhC9+B,KAAK80Q,cADoB,aAAvB90Q,KAAK80Q,cACc,YAEA,WAG3B,CAEAxO,sBACE,GAAItmQ,KAAK8K,QAAQw+E,SAAU,CACzB,MAAMyzC,EAAiB/8H,KAAK23B,OAAO8kD,YAAYz8E,KAAK8K,QAAS,CAC3D25C,eAAgBzkD,KAAK8K,QAAQk3C,WAC7B0C,kBAAmB1kD,KAAKygB,IAAI8hH,kBAE9Bz+B,SACE9jG,KAAKygB,IAAIyhC,eACT,CAAC66E,GACDliC,MAAcsG,KAElB,CACF,CAOQy1K,mBACNvtO,EACAuxD,EAAwBC,MAAc59E,SAEtC,GAAIosB,EAAOhrB,KAAK+9I,WAAapvE,MAC3B,OAEF,MAAMliF,EAAWu+B,EAAiCplC,KAG7C6G,EAAQw+E,WAIbx+E,EAAQuT,KAAKlI,SAAQk+N,OACnB7tO,OAAO6H,OACL,GACA,CAAEvD,WACF9K,KAAKg1Q,YAAYnC,4BACjBxpO,EAAOlzB,OAAOuW,UAAY2c,EAAOlzB,MAAMuW,UAAY,KAIvD1sB,KAAKygB,IAAIshH,qBAAqBjlD,WAAWhyE,EAAS8vF,GACpD,CAEA3mD,mBAAmBi/K,EAAY5+K,GAE7B,MAAMC,EAAa2+K,EAAW7/M,UAGxBmhC,GAAUF,EAAKlC,UAErB,OADmBoC,GAAUF,EAAKphC,aAAem/B,GAH3BkC,EAAa2+K,EAAWhgN,cAIRshC,IAAWD,CACnD,CAEAq7L,WACE5vO,KAAK8+P,UAAUv0N,QAAQuM,aAAa,cACpC92C,KAAK0gQ,eAAe37K,WAAWE,aAC/BtmD,WAAW,KACT,IAAIk4O,GAAqB,EACrB72Q,KAAKo1Q,YACPp1Q,KAAKo1Q,WAAWjnQ,cAElBnO,KAAKo1Q,WACHp1Q,KAAK0gQ,eAAe37K,WAAWoM,kBAAkBtuF,UAC9C8wC,IACC,GACE3zC,KAAK0gQ,eAAe37K,WAAWoM,kBAAkBzqF,QAChDmwQ,EACD,CACAA,GAAqB,EACrB,MAAM9wL,EAAO/lF,KAAK0gQ,eAAe37K,WAC9B9iE,MACAG,KAAMupB,IAAqB,IAAfA,GAAE0D,UACjB,IAAIkhC,EACJ,GAAIvwE,KAAK8K,QAAQw+E,SACf,GAAmC,UAA/BtpF,KAAK8K,QAAQw+E,SAAS9lF,KACxB+sE,EAAQ,CACNvwE,KAAK8K,QAAQw+E,SAASpD,YAAY,GAClClmF,KAAK8K,QAAQw+E,SAASpD,YAAY,QAE/B,CACL,MAAMqD,MAAQC,MAAexpF,KAAK8K,QAAQw+E,UAC1C/Y,EAAQ,CACNgZ,GAAMD,SAASpD,YAAY,GAC3BqD,GAAMD,SAASpD,YAAY,GAE/B,CAKF,GAHAH,EAAKn5C,KAAO5sC,KAAKw0Q,aACjBzuL,EAAKG,YAAc3V,EACnBvwE,KAAK0gQ,eAAe37K,WAAWplE,OAAOomE,GAClC/lF,KAAKygB,IAAI28C,sBAAsB02D,UAAUptH,MAAO,CAClD,MAAMknQ,GACJ5tQ,KAAKygB,IAAI28C,sBAAsB02D,UAAUptH,MACrCq/E,GAAO/lF,KAAK0gQ,eAAe37K,WAC9B9iE,MACAG,KAAMupB,IAAqB,IAAfA,GAAE0D,UACXynO,GAAejsL,MACnB+iL,GAAWv+N,SACXu+N,GAAW5rN,WACX,aAEIuuB,MAA0B0V,OAC9B,CAAC6wL,GAAa,GAAIA,GAAa,IAC/B,GAEF/wL,GAAKn5C,KAAO2jC,GAAM1mE,KAAK,KACvBk8E,GAAKG,YAAc3V,GACnBvwE,KAAK0gQ,eAAe37K,WAAWplE,OAAOomE,GACxC,CACF,GACD,EAEJ,IACL,4CAzpBWgvL,IAA0B3zQ,MAAAuE,IAAAvE,MAAAwE,IAAAxE,mBAAAyE,IAAAzE,MAAA0E,IAAA1E,MAAA2E,OAAA,+BAA1BgvQ,GAA0BzmQ,UAAA,8BAAAC,OAAA,CAAA+uJ,UAAA,YAAA23G,qBAAA,uBAAAH,cAAA,iBAAArmQ,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,EAAAC,KAAA,EAAAC,OAAA,80CAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDvFvC1N,MAAA,EAAA21Q,GAAA,gCAuBA31Q,MAAA,EAAA41Q,GAAA,gDAtBG51Q,MAAA,SAAA2N,EAAAmB,OAAAnB,EAAAmB,MAAAwU,UAAAtU,QAAAhP,MAAA,IAAA2N,EAAA4mQ,kBAuBAv0Q,MAAA,GAAAA,MAAA,YAAAA,MAAA,IAAA2N,EAAA4mQ,kCCgDCxmQ,KACAwuB,KACAojI,MACAhF,MACAzmH,IACA/lC,MAAevJ,MACfwJ,MAAamF,MACbtF,MAAgBwF,MAChBwoJ,KAAcvoJ,KACd0pF,MACA9uF,KACAC,MAAiBmtB,MACjB5jB,OAAgBspB,cAAA,EAAA1yB,gBAAA,KAGPilQ,MAA0BtyO,OAAA,IA1BtC8U,OAAc,CACbvoB,KAAM,gBACNpjB,MAAO,sCACPD,KAAM,YACP,EAAC03B,GAAAC,IAAA,qBAiHoBy5N,GACG2V,GACNuE,MACGzY,GACMgC,GACTrgQ,SAhGN40Q,qDChFT3zQ,MAAA,2BAEEA,MAAA,+CAHJA,MAAA,WACEA,MAAA,EAAA81Q,GAAA,wBAIF91Q,mCAHsBA,cAAA,UAAA+1Q,EAAAp2O,kDARxB3/B,MAAA,iCAIEA,MAAA,sBAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,QAAA,OAAAA,MAAckK,GAAAq1B,SAAAlpB,GAAsB,GAEpCrW,MAAA,EAAAg2Q,GAAA,aAQEh2Q,MADF,UACEA,CADyC,cAKvCA,MAAA,mBAAAA,MAAAyK,GAAA,MAAAP,EAAAlK,QAAA,OAAAA,MAASkK,EAAA+kP,YAAW,GAEpBjvP,MAAA,wBACFA,QACAA,MAAA,cAMEA,MAAA,wBAGNA,6CA5BEA,MADA,OAAA+1Q,EACA/1Q,CADa,WAAAA,MAAA,IAAAkK,EAAA+5B,QAIPjkC,MAAA,GAAAA,MAAA,OAAA+1Q,EAAAp2O,OAAAn3B,QAcFxI,MAAA,GAAAA,MAAA,IAAAA,MAAA,+DAMAA,MAAA,GAAAA,MAAA,WAAAkK,EAAA6+N,gBAEA/oO,cAAA,IAAAA,MAAA,kECMC,IAAMi2Q,GAAN,MAAMA,GAuBD1Z,SACAj4N,YACA/jC,gBACAC,eACA4gE,WAvBDjgE,IAMT,OAAIke,GACF,OAAOzgB,KAAK29P,SAASl9O,GACvB,CAEAklB,MAAQ,IAAI5jC,SAAsBC,GAElCqjC,MAAQ,IAAItjC,SAAwCC,GAEpDmoO,gBAAiB,EAETqmB,eAERzwP,YACU49P,EACAj4N,EACA/jC,EACAC,EACA4gE,IAJAxiE,KAAA29P,WACA39P,KAAA0lC,cACA1lC,KAAA2B,kBACA3B,KAAA4B,iBACA5B,KAAAwiE,aACP,CAEHj1D,YACE0V,QAAc,CAACjjB,KAAK2B,gBAAgB8iE,UAAWzkE,KAAKygB,IAAI0hC,UAAUt/C,UAChE,EAAEoxD,EAAUnU,MACV,MAAMw3N,EAA8Bx3N,EACjCp2C,OAAQq2C,IAAMA,GAAEsC,WAAatC,GAAE4J,iBAC/BlpC,IAAKs/B,MACKr5C,MAAO,GAAGq5C,GAAEn0C,SAASm0C,GAAE7tC,KAAMtG,MAAOm0C,GAAEn0C,SA0F7Cm1B,GAxFe,CACnB,CACE/R,KAAM,WACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,kDAEFrpC,KAAM,WACN+K,OAAQ,CACNkS,IAAKzgB,KAAKygB,IACVqxL,mBAAmB,EACnB9vG,aAAc,UACd+vG,gBAAgB,EAChBpG,UAAW,EACXqG,qBAAsBhyM,KAAK2B,gBAAgB4pB,UAAUshB,QACnD,8DAEF2uE,UAAW,IAAItX,KAAc,CAC3B9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,IAAK,EAAG,EAAG,GACnB2zB,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,IAAK,EAAG,EAAG,MAErBwgF,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,IAAK,EAAG,EAAG,KAErBiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,IAAK,EAAG,EAAG,UAIzB6gM,aAAc,IAAIloG,KAAc,CAC9B9oB,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,EAAG,IAAK,EAAG,GACnB2zB,MAAO,IAETs8C,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,EAAG,IAAK,EAAG,MAErBwgF,MAAO,IAAImY,IAAe,CACxB7J,OAAQ,EACRjf,OAAQ,IAAI8oB,IAAe,CACzB34F,MAAO,CAAC,EAAG,IAAK,EAAG,KAErBiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,CAAC,EAAG,IAAK,EAAG,YAM7B,CACEyjB,KAAM,QACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,+CAEFrpC,KAAM,SACN3D,QAAS,CACPokC,KAAM,GAER11B,OAAQ,CACNuzB,QAASw1O,IAGb,CACEtoP,KAAM,OACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,qDAEFrpC,KAAM,WACN3D,QAAS,CACPykC,UAAWS,KAAW/C,WAG1B,CACEhT,KAAM,QACNpjB,MAAO5L,KAAK2B,gBAAgB4pB,UAAUshB,QACpC,+CAEFhtC,QAAS,CACPykC,UAAWS,KAAW4B,SAKAlmB,IAAKxgB,IAC/BD,KAAK0lC,YAAYlG,MAAMv/B,KAEnBkgC,GAAOngC,KAAK0lC,YAAYvF,KAAKY,GAAQ,IAE3C/gC,KAAKwwP,eAAiBrwN,GAAK9H,QAAQE,aAAa11B,UAAU,KACxD7C,KAAKmqO,gBAAkBhqM,GAAK9H,QAAQ0N,QAGtC/lC,KAAK2lC,MAAMhjC,KAAKw9B,GAAI,EAG1B,CAEAjyB,cACElO,KAAKwwP,eAAeriP,aACtB,CAEAkiP,YACErwP,KAAK2lC,MAAMj/B,MAAM2xB,QAAQ6I,OAC3B,CAEAP,SAAS18B,GACP,MAAMszQ,EAAc,qDACfv3Q,KAAKuC,KAORvC,KAAKwiE,WACF1+D,KAA4B9D,KAAKuC,IAAK0B,GACtCpB,UAAU,KACT7C,KAAK4B,eAAe6oD,QAClB,uDACA8sN,EAAW,GAGjBv3Q,KAAKqwP,cAdLrwP,KAAK4B,eAAe8D,MAClB,4DACA6xQ,GAEF7xQ,MAAMuyB,KAAKouB,UAAUpiD,IAYzB,4CAvKWozQ,IAA8Bj2Q,MAAAuE,IAAAvE,MAAAwE,MAAAxE,MAAAyE,OAAAzE,MAAA0E,OAAA1E,MAAA2E,OAAA,+BAA9BsxQ,GAA8B/oQ,UAAA,8BAAAC,OAAA,CAAAhM,IAAA,OAAAmM,MAAA,EAAAC,KAAA,EAAAC,OAAA,2WAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDlC3C1N,MAAA,EAAAo2Q,GAAA,2CACGp2Q,MAAA,OAAAA,MAAA,IAAA2N,EAAA42B,qYCiCU0xO,MAA8B50O,OAAA,IAV1C8U,OAAc,CACbvoB,KAAM,oBACNpjB,MAAO,0CACPD,KAAM,cACP,EAAC03B,GAAAC,IAAA,qBA6BoBy5N,GACG34N,KACIogC,MACDqE,MACJhG,SA3BXw0M,+DCdN,IAAMI,GAAoB,MAA3B,MAAOA,EAQF5lQ,QACA6lQ,iBACCC,WATFC,WACAvrP,IAEiBwrP,YACfC,aAAe,IAAIxqQ,MAE7BvN,YACS8R,EACA6lQ,EACCC,GAFD33Q,KAAA6R,UACA7R,KAAA03Q,mBACC13Q,KAAA23Q,YACP,CAIII,cAAcpsO,GACnB,IAAIooC,EACAglB,EAQJ,GAPIptD,aAAaqsO,YACfjkM,EAAIpoC,EAAEooC,EACNglB,EAAIptD,EAAEotD,GACGptD,aAAassO,aACtBlkM,EAAIpoC,EAAE+iG,QAAQ,GAAGwpI,MACjBn/K,EAAIptD,EAAE+iG,QAAQ,GAAGypI,QAEdpkM,IAAMglB,EACT,OAGF/4F,KAAKiY,QACL0zB,EAAEtd,iBACFruB,KAAK83Q,aAAa1pQ,KAAK,CAAE2lE,IAAGglB,MAC5B/4F,KAAK43Q,WAAa,KAClB,MAAMQ,GAAmBp4Q,KAAK6R,QAC3Bw9B,WACAgpO,oBAAoB,CAAEtkM,IAAGglB,MACzBu/K,cAAc,CACb,CACEC,QAAS,MACTC,QAAS,SACTC,SAAU,QACVC,SAAU,SAGhB14Q,KAAK43Q,WAAa53Q,KAAK6R,QAAQkK,OAAO,CACpCq8P,oBACAO,eAAgB34Q,KAAK6R,QAAQ+mQ,iBAAiB3gQ,UAEhDjY,KAAK43Q,WAAWiB,OACd,IAAIC,MAAe94Q,KAAK63Q,YAAa73Q,KAAK03Q,iBAAkB,CAC1DnnQ,eAAWvO,KAIfhC,KAAKqsB,OAAMg/C,MAAsB/iE,SAAU,SACxCvE,QACC2F,MAAQggB,KACN,MAAMqvP,GAAcrvP,GAAM9S,OAC1B,OAAA5W,KAAKiY,UAEDjY,KAAK43Q,aACN53Q,KAAK43Q,WAAWoB,eAAermO,SAASomO,GAAW,IAEvD,EACDnvN,MAAK,IAEN/mD,UAAU,IAAM7C,KAAKiY,SAExBjY,KAAKqsB,OAAMg/C,MAAsB/iE,SAAU,eACxCvE,QACC2F,MAAQggB,KACN,MAAMqvP,GAAcrvP,GAAM9S,OAC1B,GACEmiQ,KACC/4Q,KAAK23Q,WAAW1kQ,cAAc0/B,SAASomO,MACvC/4Q,KAAK43Q,WAAWoB,eAAermO,SAASomO,IAEzC,OAAO,EAEPrvP,GAAM2E,gBAAc,IAEvB,EACDu7B,MAAK,IAEN/mD,UAAU,IAAM7C,KAAKiY,QAC1B,CAEAA,QACMjY,KAAK43Q,aACP53Q,KAAK43Q,WAAWqB,UAChBj5Q,KAAK43Q,WAAa,MAEhB53Q,KAAKqsB,KACPrsB,KAAKqsB,IAAIle,aAEb,4CA/FWspQ,GAAoBr2Q,MAAAuE,OAAAvE,0BAAA,+BAApBq2Q,EAAoBnpQ,UAAA,2BAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAApB1N,MAAA,qBAAAqW,IAAA,OAAA1I,EAAAgpQ,cAAAtgQ,GAAqB,EAArBrW,CAAoB,uBAAAqW,IAAA,OAApB1I,EAAAgpQ,cAAAtgQ,GAAqB,kIAArBggQ,CAAoB,KCApByB,GAAkB,MAAzB,MAAOA,EACHC,aACCC,cAAwB,IACxBC,SAAmB,EAClBC,UAAY,IAAIhsQ,MAE1BvN,cAAe,CAGRw5Q,WAAW5tO,GACZA,EAAE+iG,QAAQ9kI,OAAS,EACrB5J,KAAKw5Q,WAGPx5Q,KAAKm5Q,aAAex6O,WAAW,KACzB3+B,KAAKq5Q,QACuB,QAA1BrpI,MAAUutG,aACZv9O,KAAKs5Q,UAAUlrQ,KAAKu9B,GAGtB3rC,KAAKs5Q,UAAUlrQ,KAAKu9B,EAAC,EAEtB3rC,KAAKo5Q,cACV,CAIOK,WACLz5Q,KAAKw5Q,UACP,CAEQA,WACNv2O,aAAajjC,KAAKm5Q,aACpB,4CAjCWD,EAAkB,+BAAlBA,EAAkB5qQ,UAAA,yBAAA6F,aAAA,SAAArF,EAAAC,GAAA,EAAAD,GAAlB1N,MAAA,sBAAAqW,IAAA,OAAA1I,EAAAwqQ,WAAA9hQ,GAAkB,EAAlBrW,CAAkB,8BAAlB2N,EAAA0qQ,UAAU,EAAVr4Q,CAAkB,gCAAlB2N,EAAA0qQ,UAAU,EAAVr4Q,CAAkB,6BAAlB2N,EAAA0qQ,UAAU,oHAAVP,CAAkB,sJCd3B93Q,MAAA,aACEA,MAAA,GAEFA,8BAFEA,cAAA,uBAAAkK,EAAAo7J,+BAAA,8EAiDItlK,MAAA,8DAAmCA,MAAZ,MAAAkK,EAAAmV,IAAYrf,CAAD,QAAAgzQ,8BAMxChzQ,MAAA,kBACEA,MAAA,4BACFA,8BADuBA,cAAA,UAAAkK,EAAAssI,2CAIrBx2I,MAAA,2CAIEA,MAHA,QAAAkK,EAAA4E,MAGA9O,CAHe,cAGfA,CAFkB,gBAElBA,CADmB,OAAAkK,EAAAouQ,gBCMpB,IAAMC,GAAkB,MAAzB,MAAOA,EA2CDh8M,WACAtD,aACA26M,YACAhjQ,aACAmqC,eA9CHjsC,MAAqB,IAAI9E,MAAY,IAC5CsuQ,cAAgB1uQ,MAAcG,QACvBu7J,gCAA0C,EAE1CxN,aAAuB,IAEvBz4I,IAAc,IAAIosG,MAAO,CAC9Bh7G,SAAS,EACTylB,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAIR83N,WAEOx4I,OACAnG,cACA/sE,KAEAkzG,gBACL,IAAIr/J,SAAyBC,GAE/B,eAAI63Q,GACF,OAAO75Q,KAAKg1Q,YAAY9kQ,KAC1B,CAEA,iBAAIg3D,GACF,OAAOlnE,KAAKgS,aAAak1D,eAC3B,CAEO0wE,gBACAkiI,oCAEP/5Q,YACU49D,EACAtD,EACA26M,EACAhjQ,GACAmqC,IAJAn8C,KAAA29D,aACA39D,KAAAq6D,eACAr6D,KAAAg1Q,cACAh1Q,KAAAgS,gBACAhS,KAAAm8C,kBAERn8C,KAAK29D,WAAWwjD,OAAOnhH,KAAKygB,KAE5BzgB,KAAKq6D,aACFU,iBAAiB,CAChBnvD,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTisB,cAAe,CACbt/C,KAAM,SAGTX,UAAW4/C,IAAUziD,KAAKygB,IAAIu7C,SAASvZ,KAE1CziD,KAAK85Q,sCACK95Q,KAAKm8C,eAAej8C,IAAI,sCAChC,CACJ,CAEA65Q,6BAA6BrzQ,GAC3B1G,KAAK0mK,+BAAiChgK,CACxC,CAEAszQ,mBAAmB9rN,GACjBluD,KAAKkuD,KAAOA,EACZluD,KAAKg1Q,YAAYhB,cAAc9lN,GACIA,EAAKx1B,QAAQ,aAAc,IAAI+vG,OAC3C7+H,OAAS,IAC9B5J,KAAK65Q,YAAY/yQ,QACjB9G,KAAK43I,qBAAkB51I,EAE3B,CAEA0lK,SAASh+I,GACP,MAAM01D,EAA0B11D,EAAM01D,QACtCp/E,KAAK65Q,YAAYrpQ,MAAM8P,UAAU,CAAE8wB,SAAS,EAAO5oB,UAAU,IAC7D,MAAMgyI,EAA6Bx6J,KAAK65Q,YAAYp1P,UAAU/d,MAC3DgD,OAAQ2/B,IAAyBA,GAAO5lB,SAAWiG,EAAM4wI,SAAS72I,QAClE9C,OAAOy+D,GACVp/E,KAAK65Q,YAAYh6P,WAAW26I,EAC9B,CAEAy/G,kCAAkCvzQ,GAChC1G,KAAKm8C,eAAe97C,IAAI,mCAAoCqG,GAC5D1G,KAAK85Q,oCAAsCpzQ,CAC7C,CAEAmxJ,yBACE73J,KAAKohK,gBAAgBz+J,MAAK,EAC5B,CAOA+xQ,cAAcrrO,GACZrpC,KAAK42Q,mBAAmBvtO,EAAQrpC,KAAKg1Q,YAAY/B,cAAcxhO,OAC/DzxC,KAAK43I,gBAAkBvuG,EAAOplC,IAChC,CAMA46J,eAAex1H,GACbrpC,KAAK42Q,mBAAmBvtO,EAAQrpC,KAAKg1Q,YAAY/B,cAAczqP,UAC/DxoB,KAAK43I,gBAAkBvuG,EAAOplC,IAChC,CAMQ2yQ,mBACNn0N,EACAm4C,EAAwBC,MAAc59E,SAElCwlC,EAAMpkC,KAAK+9I,WAAapvE,YAKAhrF,IAAxBygD,EAAMx+C,KAAKqlF,UAIftpF,KAAKygB,IAAIshH,qBAAqB4e,YAAY,CAACl+F,EAAMx+C,MAAO22F,EAC1D,CAEArtF,WACEvN,KAAKkQ,MAAMgV,KAAK,CACd,CACEhT,GAAI,cACJtG,MAAO,cACPW,QAASA,IAAMvM,KAAKk6Q,iBAAiBl6Q,KAAKohI,SAE5C,CACElvH,GAAI,aACJtG,MAAO,YACPW,QAASA,IAAMvM,KAAKm6Q,eAAen6Q,KAAKohI,SAE1C,CACElvH,GAAI,mBACJtG,MAAO,mBACPW,QAASA,IAAMvM,KAAKo6Q,qBAAqBp6Q,KAAKohI,UAGpD,CAEAlzH,cACElO,KAAKkQ,MAAM6D,SACb,CAKAsmQ,uBACEr6Q,KAAKygB,IAAIshH,qBAAqBj7H,OAChC,CAEAwzQ,kBAAkB5wP,GAChB,MAAM2lB,EAAkBrvC,KAAKu6Q,YAAY7wP,GACnC6mD,EAAoBvwE,KAAK29D,WAC5BS,SACA/c,GAAGm5N,uBAAuBnrO,GAC7BrvC,KAAKi7H,cAAgBj7H,KAAK29D,WAAWS,SAASmkE,eAC9CviI,KAAKohI,OAAS7/E,MAAegvB,EAAOvwE,KAAKi7H,cAAe,YAC1D,CAEAs/I,YAAY7wP,GACV,MAAM+wP,EAA6C/wP,EACnD+wP,SAAiB1hL,EACf0hL,EAAiB1hL,EACjB/4F,KAAK45Q,WAAW3mQ,cAAcynQ,wBAAwBtiL,IACtD7wF,OAAOozQ,QACTF,EAAiB1mM,EACf0mM,EAAiB1mM,EACjB/zE,KAAK45Q,WAAW3mQ,cAAcynQ,wBAAwBpiJ,KACtD/wH,OAAOqzQ,QACe,CAACH,EAAiB1mM,EAAG0mM,EAAiB1hL,EAEhE,CAEAmhL,iBAAiB94I,GACfphI,KAAK65Q,YAAY/yQ,QACjB9G,KAAKkuD,KAAQluD,KAAK85Q,oCAEd14I,EACGrhH,UACAU,IAAKuZ,GAAcA,EAAEg8B,QAAQ,IAC7BnsD,KAAK,MAJRu3H,EAAO3gH,IAAKuZ,GAAcA,EAAEg8B,QAAQ,IAAInsD,KAAK,KAKnD,CAEAswQ,eAAe/4I,GACb75H,OAAOgR,KAAK08M,MAAYC,uBAAuB9zF,EAAO,GAAIA,EAAO,IACnE,CAEAg5I,qBAAqBh5I,GACnB75H,OAAOgR,KAAK08M,MAAYE,wBAAwB/zF,EAAO,GAAIA,EAAO,IACpE,4CAhNWu4I,GAAkBv4Q,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,IAAAxE,MAAAyE,MAAAzE,MAAA0E,MAAA,+BAAlB6zQ,EAAkBrrQ,UAAA,iBAAAuO,UAAA,SAAA/N,EAAAC,MAAA,EAAAD,cAqBImoQ,8FA5BtB,IACTjmC,OAAc,IAAClW,UAAkB,EAAIsZ,UAAwB,CAC3DjsE,WAAW,IAEbuqG,KACDtxQ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,y4BAAAC,SAAA,SAAAC,EAAAC,GAAA,KAAAD,EAAA,kBDrED1N,MALF,qBAKEA,CADD,0BAEGA,MAAA,EAAAy5Q,GAAA,cAIAz5Q,MAAA,yBAUEA,MAAA,wBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAgB2N,EAAAurQ,kBAAA7iQ,IAAyB,GAEzCrW,MAAA,WACEA,MAAA,uBAEJA,UAGEA,MADF,gBACEA,CADwB,uBAYtBA,MATA,gCAAAqW,IAAArW,aAAAyK,IAAAzK,MAAwB2N,EAAAgrQ,6BAAAtiQ,IAAoC,EAS5DrW,CAT6D,4BAAAqW,IAAArW,aAAAyK,IAAAzK,MAIzC2N,EAAAirQ,mBAAAviQ,IAA0B,EAK9CrW,CAL+C,kBAAAqW,IAAArW,aAAAyK,IAAAzK,MACrC2N,EAAA24J,SAAAjwJ,IAAgB,EAI1BrW,CAJ2B,0BAAAA,aAAAyK,IAAAzK,MACX2N,EAAAsrQ,uBAAsB,EAGtCj5Q,CAHuC,kCAAAA,aAAAyK,IAAAzK,MACf2N,EAAA8oJ,yBAAwB,EAEhDz2J,CAFiD,2CAAAqW,IAAArW,aAAAyK,IAAAzK,MAGpC2N,EAAAkrQ,kCAAAxiQ,IAErB,GACMrW,QAEAA,MAAA,2BAQEA,MAFA,uBAAAqW,IAAArW,aAAAyK,IAAAzK,MAAe2N,EAAA2lQ,cAAAj9P,IAA2B,EAE1CrW,CAF2C,wBAAAqW,IAAArW,aAAAyK,IAAAzK,MAC3B2N,EAAA8vJ,eAAApnJ,IAA4B,EAC5CrW,CAD6C,uBAAAqW,IAAArW,aAAAyK,IAAAzK,MAC9B2N,EAAA24J,SAAAjwJ,IAAgB,GAE/BrW,MAAA,GAAA05Q,GAAA,yBAAA15Q,OAKJA,UAMAA,MAJA,GAAA25Q,GAAA,kBAIA35Q,CAJmD,GAAA45Q,GAAA,yBAAA55Q,OAcvDA,qCAzEEA,MAAA,eAAAA,MAAA,GAAA+zC,KAGS/zC,MAAA,GAAAA,MAAA,QAAA2N,EAAAm4D,eAML9lE,QAOAA,MAPA,MAAA2N,EAAA0R,IAOArf,CAPW,OAAA2N,EAAAoB,KAOX/O,CANa,iBAAA65Q,GAMb75Q,CAJgC,mCAIhCA,CADoC,iCAAA2N,EAAA23J,gCAKjBtlK,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMjBrf,MAAA,GASAA,MATA,OAAA2N,EAAAm/C,KASA9sD,CATa,oBASbA,CAPuB,QAAA2N,EAAA8qQ,YAOvBz4Q,CANqB,eAAA2N,EAAAmqJ,aAMrB93J,CAL6B,mCAAA2N,EAAA+qQ,qCAa7B14Q,QAIAA,MAJA,QAAA2N,EAAA8qQ,YAIAz4Q,CAJqB,OAAA2N,EAAAm/C,KAIrB9sD,CAHa,eAAA2N,EAAAmqJ,aAGb93J,CAF6B,kBAAA2N,EAAAqyJ,iBAcrBhgK,MAAA,GAAAA,MAAA,OAAA2N,EAAA6oI,iCCLZg1G,IACAC,IACA19O,KACA2+G,MACA6iB,MAAmB5qI,MAEnBg2N,MAAe/1N,KAAA2O,KAAAE,KAAAC,KACfwgC,IAEA1jC,MACA4sF,OAAuB3uF,OAAA,8IASd8pQ,CAAkB,gEClC3Bv4Q,MAAA,OAA0BA,MAAA,GAAkBA,8BAAlBA,cAAAqnB,EAAAyyP,eCjBvB,IAAMC,GAAqB,MAA5B,MAAOA,EA2BDz8J,kBACArkD,aACAroD,aA5BHkpQ,aACA/gB,kBAA4B,EAC5B15O,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,GAEbysD,WAAW,KAIRptD,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,EACNurE,SAAU,KAGZ,SAAIruF,GACF,OAAOh/B,KAAKgS,aAAawB,UAC3B,CAEA,iBAAI0zD,GACF,OAAOlnE,KAAKgS,aAAak1D,eAC3B,CAEAnnE,YACU2+G,EACArkD,EACAroD,GAFAhS,KAAA0+G,oBACA1+G,KAAAq6D,eACAr6D,KAAAgS,eAERhS,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,GACRQ,SAAS,EACTwrB,WAAW,IACY,EAGjC,CAEA+4N,cAAc1xP,GACZ1pB,KAAKk7Q,aAAexxP,CACtB,4CAjDWyxP,GAAqB/5Q,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,MAAA,+BAArBu1Q,EAAqB7sQ,UAAA,qBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,0dAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDnB9B1N,MANJ,qBAMIA,CAFH,yBAEGA,CAD8C,uBAM5CA,MAAA,gCAAAqW,IAAA,OAAwB1I,EAAAqsQ,cAAA3jQ,GAAqB,GAE7CrW,MAAA,wBAGAA,MAAA,WAEEA,MADA,UACAA,CADkC,2BAOpCA,QACAA,MAAA,WAcEA,MAbA,6BAaAA,CARyB,yBAQzBA,CAP6C,4BAO7CA,CADuB,wBAG3BA,UACAA,MAAA,GAAAi6Q,GAAA,YAEJj6Q,iBAzCEA,MAAA,eAAAA,MAAA,GAAAoW,KAIIpW,MAAA,GAGAA,MAHA,MAAA2N,EAAA0R,IAGArf,CAHW,OAAA2N,EAAAoB,KAGX/O,CAFa,uBAAA2N,EAAAorP,mBAMX/4P,cAAA,oBAAA2N,EAAAmsQ,aAAA,KAAAnsQ,EAAAmsQ,aAAA/iN,YAME/2D,MAAA,GACAA,MADA,sBACAA,CADyB,MAAA2N,EAAA0R,KAQzBrf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAOArf,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAIerf,cAAA,MAAA2N,EAAA0R,KAGjBrf,cAAA,QAAA2N,EAAAm4D,+BCnBI0lL,IAAoBC,IAAsBlnP,gDAAkBwJ,MAAIU,OAAA,yEAE/DsrQ,CAAqB,gECsCtB/5Q,MAAA,GACEA,MAAA,yDAAqBA,cAAA,UAAAy5P,ICiB5B,IAAMygB,GAAyB,MAAhC,MAAOA,EAiDDzW,gBACAj1D,qBACAlxF,kBACArkD,aACAz4D,eACAD,gBACAoQ,MAtDH0O,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGCt+C,KACA2wK,SAAkCpB,MAAsBC,QACxDy4B,qBAEF3rJ,OAAkB,GAClBilN,aAAwB,GAExB50D,UACAoB,UACA3qE,KACAsrE,eACAl3I,OAAiB,EAEjBgqM,SAAmB,EAEnBC,iBAA6C,IAAIljQ,SACtDC,GAGM21B,OAA0B,IAAIimI,KAE/B1tJ,MAAqB,IAAI7E,KAAqB,IAE9C65P,iBAAyC,IAAI75P,KAAqB,IAElE++G,SAAmB,EAEnBimF,eAAyB,EAEzBz9D,YAAiCzB,MAAkBI,OAClD7yC,aAAe,IAAI1jD,IAEpB+xH,aAEPhtK,YACU8kQ,EACAj1D,EACAlxF,EACArkD,GACAz4D,GACAD,GACAoQ,IANA/R,KAAA6kQ,kBACA7kQ,KAAA4vM,uBACA5vM,KAAA0+G,oBACA1+G,KAAAq6D,gBACAr6D,KAAA4B,kBACA5B,KAAA2B,mBACA3B,KAAA+R,SAER/R,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,GACRgsB,WAAW,EACXxrB,SAAS,IACc,EAGjC,CAEAtpB,WACE,UAAWk1C,KAASziD,KAAKygB,IAAIq/B,OAEzB2C,EAAM72C,OACN62C,EAAM72C,MAAMosB,SACVh4B,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,yCAIJ7sC,KAAK8/C,OAAOx4C,KAAKm7C,EAGvB,CAEAv0C,cACElO,KAAK0+F,aAAa/7F,OAClB3C,KAAK0+F,aAAap1D,UACpB,CAEA87N,cAAc17O,GACZ1pB,KAAKwD,KAAOkmB,EACZ1pB,KAAKmwM,eAAYnuM,CACnB,CAEAqjQ,mBAAmB37O,GACjB1pB,KAAKmwM,UAAYzmL,EACb1pB,KAAKmwM,WACPnwM,KAAKg0K,gBAET,CAEQA,iBACNh0K,KAAK4vM,qBACF57B,eAAeh0K,KAAKmwM,WACpBpsM,QAAKk7F,MAAUj/F,KAAK0+F,eACpB77F,UAAW0H,IACVA,EAASiY,KAAK,CAAC8/B,EAAGC,IACZD,EAAEjrB,WAAW84H,IAAM5tG,EAAElrB,WAAW84H,KAC3B,EAEL7tG,EAAEjrB,WAAW84H,IAAM5tG,EAAElrB,WAAW84H,IAC3B,EAEF,GAETnwJ,KAAKklQ,iBAAiBp+P,QACtB9G,KAAKklQ,iBAAiBhgP,KAAK3a,EAAQ,EAEzC,CAEAo7P,wBACE3lQ,KAAK4lQ,eACP,CAEAC,uBACE7lQ,KAAK4mI,UAAO5kI,EACZhC,KAAKmwM,eAAYnuM,CACnB,CAEA8jQ,WACE9lQ,KAAKygB,IAAIm6C,aAAa56D,KAAK8/C,QAC3B9/C,KAAK8/C,OAAS,GACd9/C,KAAK+kQ,aAAe,GACpB/kQ,KAAKqwM,eAAiB,EACtBrwM,KAAKglQ,SAAW,EACZhlQ,KAAKwD,OAASovK,MAAkBC,aAClC7yK,KAAK4mI,UAAO5kI,EACZhC,KAAKmwM,eAAYnuM,EAErB,CAEQ4jQ,gBACN5lQ,KAAKoqH,SAAU,EACf,IACImnF,EADAk0D,GAAuB,GAEP,IAAhBzlQ,KAAKg7D,QAAgBh7D,KAAKwD,OAASovK,MAAkBh8C,QACvD52H,KAAK+lQ,oBAAoB,CAAC/lQ,KAAK4mI,OAM/B2qE,EAJEvxM,KAAKm0K,WAAapB,MAAsBE,UAI9B,CAHyB,CACnCjkJ,KAAM,KAIIhvB,KAAKuxM,UAGjBvxM,KAAK4yI,cAAgBzB,MAAkBK,YACvCxxI,KAAKwD,OAASovK,MAAkBh8C,QAEhC52H,KAAKg7D,OAAuB,IAAdh7D,KAAKg7D,QAEjBh7D,KAAKwD,OAASovK,MAAkBE,UAClC9yK,KAAKg7D,OAAS,GAGhB,MAAMl4C,EAAwC,GAC9CyuL,EAAUh3L,QAAS65J,KACjBtxJ,EAAaxb,KACXtH,KAAK4vM,qBACF17B,eACCl0K,KAAK4mI,KACL5mI,KAAKm0K,SACLn0K,KAAKmwM,UACL/7B,GACAp0K,KAAKg7D,QAENj3D,QACCC,MAAKuG,KACHvK,KAAKkQ,MAAMoV,WAAW/a,IACtB,MAAMy7P,GAA2B,GAC3BC,GAA8B,GACpC,IAAIC,GACAC,GACJ57P,GAASgQ,QAASzP,KACZA,GAAQw+E,SAAS9lF,OAASovK,MAAkBh8C,OAC9C9rH,GAAQusB,WAAWgsK,UACjBv4L,GAAQw+E,SAASpD,YAAY,GAC/Bp7E,GAAQusB,WAAWisK,SAAWx4L,GAAQw+E,SAASpD,YAAY,GAC3D8/K,GAAc1+P,KAAKwD,IACnBo7P,GAAUp7P,GAAQuT,KAAKnM,KAEvB+zP,GAAiB3+P,KAAKwD,IACtBq7P,GAAar7P,GAAQuT,KAAKnM,MAI9BlS,KAAKomQ,iBAAiBJ,GAAeE,IACrClmQ,KAAKqmQ,iBAAiBJ,GAAkBE,IACpC57P,GAASX,QACX67P,GAAc,EACdzlQ,KAAKqwM,gBAAkB,EACvBj8B,GAASqxF,aAAc,EACvBzlQ,KAAK+R,MAAM4K,iBAEXy3J,GAASqxF,aAAc,EAGrBl7P,GAASX,QAAU,KACrB5J,KAAK4B,eAAe8D,MAClB,qCACA,gCACA,CAAE4hE,QAAS,KAAO,IAIzB,IAEN,EAEDhD,MAASxhD,GACN/e,QAAKk7F,MAAUj/F,KAAK0+F,eACpB77F,UAAU,KACT7C,KAAKoqH,SAAU,EACXq7I,GACFzlQ,KAAK4B,eAAe8D,MAClB,oCACA,gCACA,CAAE4hE,QAAS,KAAO,EAI5B,CAEAstI,aAAa9pM,EAAkBkwD,GAC7Bh7D,KAAK4mI,KAAO97H,EACRA,IACFkwD,EACIh7D,KAAK+lQ,oBAAoB,CAACj7P,IAAU,GACpC9K,KAAK+lQ,oBAAoB,CAACj7P,IAC9B9K,KAAKsmQ,oBAAoBx7P,GAE7B,CAKOi7P,oBAAoBx7P,EAAqBywD,GAC9C,IAAI5rB,EAAY,EAChB,UAAWtkC,MAAWP,EAAU,CAC9B,GAAIvK,KAAKwD,OAASovK,MAAkBC,WAClC,UAAWpwH,MAASziD,KAAK8/C,OAAQ,CAC/B,GACE2C,GAAM5iD,QAAQ0mQ,WACd9jN,GAAM5iD,QAAQ0mQ,UAAU78I,OAAS5+G,GAAQusB,WAAWqyF,OACnD1uD,EACD,CACA,IAAKvY,GAAM72C,OAAOm1F,WAAW,QAAS,CACpC,MAAM9hF,GAAgBjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAC1CziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,EAC5B,CACA,MACF,CACA,GAAIwjC,GAAM72C,OAAOm1F,WAAW,QAAS,CACnC/gG,KAAK+kQ,aAAe,GACpB,MAAM9lP,GAAgBjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAC1CziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,GAC1Bjf,KAAKygB,IAAI8rF,YAAY9pD,GACvB,CACF,KACK,CACL,GAAIuY,EACF,UAAWvY,MAASziD,KAAK+kQ,aACvB,GAC+B,IAA7B/kQ,KAAK+kQ,aAAan7P,QAClB64C,GAAM72C,OAAOm1F,WAAW,QACxB,CACA,MAAM9hF,GAAgBjf,KAAK8/C,OAAOp3C,QAAQ+5C,IAC1CziD,KAAK8/C,OAAOj6B,OAAO5G,GAAO,GAC1Bjf,KAAKygB,IAAI8rF,YAAY9pD,GACvB,CAGJziD,KAAK+kQ,aAAe,EACtB,CACA,UAAWtiN,MAASziD,KAAK8/C,OACnB2C,GAAM72C,OAAOm1F,WAAW,SAC1B3xD,IAGJpvC,KAAK+sK,aAAe,CAACluE,GAAUvjC,MAC7B,MAAM4qB,GAA0B37E,EAAS,GAAG++E,SAASpD,YACrD,OAAO,IAAIge,KAAc,CACvBnY,MAAO,IAAImY,IAAe,CACxB7J,OAAQnU,GACJlmF,KAAKg7D,OACL9uC,KAAK6hJ,IAAK7hJ,KAAK4lG,GAAK,IAAO5rC,GAAY,IACvC5qB,QACAt5D,EACJw5E,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,4BAET6vE,OAAQ,IAAI8oB,IAAe,CACzBhlE,MAAO,EACP3zB,MAAO,aAGX6vE,OAAQ,IAAI8oB,IAAe,CACzBhlE,MAAO,EACP3zB,MAAO,WAETiwE,KAAM,IAAI0oB,IAAa,CACrB34F,MAAO,6BAEV,EAEHvL,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACNu/C,WAAW,IAEZh/C,QAAK6lD,MAAK,IACV/mD,UAAWwzB,KACV,MAAMurE,GAAuB5hG,KAAKq6D,aAAawkD,YAAY,CACzD1pD,oBAAoB,EACpBvpD,MAAQ,QACNwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ4N,UAAW,CAAE9J,SAAS,GACtB41N,UAAW,CACT78I,KACE1pH,KAAKwD,OAASovK,MAAkBC,WAC5B/nK,GAAQusB,WAAWqyF,UACnB1nH,GAERyhB,OAAQ4S,GACRQ,SAAS,IAEL2vO,GAAaj8P,EAASkW,IAAK3V,OACxBs2F,OAAYt2F,GAAS9K,KAAKygB,IAAI8hH,iBAEvC,GAAIviI,KAAKwD,OAASovK,MAAkBC,WAAY,CAC9C,MAAMrvK,GACJxD,KAAKwD,OAASovK,MAAkBh8C,MAAQ,SAAW,WACrD4vI,GAAW,GAAGnmQ,IAAI,MAAO,QAAQ,GACjCmmQ,GAAW,GAAGnmQ,IAAI,OAAQmD,IAAM,EAClC,CACW6yB,GAAWgrB,GACnBwa,YAAY2qM,IACf5kK,GAAQvgD,GAAG4iD,SAASjkG,KAAK+sK,cACzB/sK,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK+kQ,aAAaz9P,KAAKs6F,IACvB5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAMQypP,iBAAiB77P,EAAqB2H,GAC5C,IAAIk9B,EAAY,EAChB,GAAI7kC,EAASX,OAAQ,CACnB,QAAiB5H,IAAbhC,KAAKygB,IACP,OAEF,UAAWgiC,MAASziD,KAAK8/C,OACnB2C,GAAM72C,OAAOm1F,WAAWx2F,EAAS,GAAG8T,KAAKzS,QAC3CwjC,IAGJpvC,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,UACN0O,KACA6wC,WAAW,EACXqY,SAAU,IACV/8C,KAAM,CACJzS,MAAO,aAGV7H,QAAK6lD,MAAK,IACV/mD,UAAWwzB,KACV,MAAM1qB,GAAepB,EAAS,GAAG8T,KAAK1S,KACtC,IAAIwK,GAIFA,GAHGxK,IAGK3L,KAAKymQ,cAAc96P,MAF3BwK,EAAQokF,SAKV,MAAMqH,GAAiB5hG,KAAKq6D,aAAawkD,YAAY,CACnD1pD,oBAAoB,EACpBvpD,MAAQrB,EAAS,GAAG8T,KAAKzS,MACvB,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJppB,OAAQ4S,GACRQ,SAAS,EACT1gB,WAGIqwP,GAAaj8P,EAASkW,IAAK3V,OACxBs2F,OAAYt2F,GAAS9K,KAAKygB,IAAI8hH,iBAEXlsG,GAAWgrB,GACpCsC,YAAYkY,YAAY2qM,IACvBxmQ,KAAK8/C,OAAO19B,KAAMqgC,IAAiBA,GAAMvwC,KAAO0vF,GAAQ1vF,MAC1DlS,KAAKygB,IAAI8rF,YACPvsG,KAAK8/C,OAAO19B,KAAMqgC,IAAiBA,GAAMvwC,KAAO0vF,GAAQ1vF,KAE1Dk9B,GAAQ,EACRwyD,GAAQh2F,MAASrB,EAAS,GAAG8T,KAAKzS,MAChC,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ+0D,GAAQ/hG,QAAQ+L,MAAQg2F,GAAQh2F,OAElC5L,KAAKglQ,SAAW51N,EAChBpvC,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK0mQ,UAAU9kK,IACf5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAEQ8pP,cAAc96P,GACpB,IAAIwK,EACJ,OAAAnW,KAAK6kQ,gBACF8B,gBAAgBh7P,GAChB9I,UAAW+jQ,IACV,MAAMC,GAA+B,IAAI53J,cACzC23J,EAAO9oG,aAAa,QAAS,MAC7B8oG,EAAO9oG,aAAa,SAAU,MAC9B8oG,EAAO9oG,aAAa,OAAQ,qBAC5B8oG,EAAO9oG,aAAa,SAAU,SAC9B,MAAM/2H,GAAc8/N,GAAc33J,kBAAkB03J,GACpDzwP,EAAQ,IAAI+tF,KAAc,CACxBnY,MAAO,IAAImY,KAAa,CACtB37D,IAAK,2BAA6BxB,MAErC,GAEE5wB,CACT,CAIQkwP,iBAAiB97P,EAAqB2H,GAC5C,IAAIk9B,EAAY,EAChB,GAAI7kC,EAASX,OAAQ,CACnB,QAAiB5H,IAAbhC,KAAKygB,IACP,OAEF,UAAWgiC,MAASziD,KAAK8/C,OACnB2C,GAAM72C,OAAOm1F,WAAWx2F,EAAS,GAAG8T,KAAKzS,QAC3CwjC,IAGJpvC,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,SACN0O,KACA6wC,WAAW,IAEZh/C,QAAK6lD,MAAK,IACV/mD,UAAWwzB,KACV,MAAMurE,GAAiB5hG,KAAKq6D,aAAawkD,YAAY,CACnD1pD,oBAAoB,EACpBvpD,MAAQrB,EAAS,GAAG8T,KAAKzS,MACvB,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJppB,OAAQ4S,GACRQ,SAAS,IAEL2vO,GAAaj8P,EAASkW,IAAK3V,OACxBs2F,OAAYt2F,GAAS9K,KAAKygB,IAAI8hH,iBAE5BlsG,GAAWgrB,GACnBwa,YAAY2qM,IACXxmQ,KAAK8/C,OAAO19B,KAAMqgC,IAAiBA,GAAMvwC,KAAO0vF,GAAQ1vF,MAC1DlS,KAAKygB,IAAI8rF,YACPvsG,KAAK8/C,OAAO19B,KAAMqgC,IAAiBA,GAAMvwC,KAAO0vF,GAAQ1vF,KAE1Dk9B,GAAQ,EACRwyD,GAAQh2F,MAASrB,EAAS,GAAG8T,KAAKzS,MAChC,IACAwjC,EACA,MACApvC,KAAK2B,gBAAgB4pB,UAAUshB,QAC7B,uCAEJ+0D,GAAQ/hG,QAAQ+L,MAAQg2F,GAAQh2F,OAElC5L,KAAKygB,IAAIu7C,SAAS4lC,IAClB5hG,KAAK8/C,OAAOx4C,KAAKs6F,IACjB5hG,KAAK0mQ,UAAU9kK,IACf5hG,KAAK+R,MAAM4K,eAAa,EAE9B,CACF,CAEA2pP,oBAAoBx7P,GAClB,GAAIA,EAAS,CACX,MAAM6hF,EAAY3sF,KAAK23B,OAAO8kD,YAAY3xE,EAAS,CACjD25C,eAAgB35C,EAAQk3C,WACxB0C,kBAAmB1kD,KAAKygB,IAAI8hH,kBAE9Bz+B,SACE9jG,KAAKygB,IAAIyhC,eACT,CAACyqC,GACDkO,MAAcsG,KAElB,CACF,CAEAulK,UAAUjkN,GACR,UAAWqmK,KAAe9oN,KAAK+kQ,aAC7B,GAAIj8C,EAAY52M,KAAOuwC,EAAMvwC,GAC3B,OAIJlS,KAAK+kQ,aAAaz9P,KAAKm7C,EACzB,4CAhiBW64N,GAAyBl6Q,MAAAuE,OAAAvE,MAAAwE,OAAAxE,MAAAwE,OAAAxE,MAAAwE,OAAAxE,MAAAyE,OAAAzE,MAAA0E,OAAA1E,aAAA,+BAAzBk6Q,EAAyBhtQ,UAAA,yBAAAC,OAAA,CAAA/K,KAAA,OAAA2wK,SAAA,WAAAs3B,qBAAA,wBAAAh9L,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,k0BAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IDlE5B1N,MAfV,qBAeUA,CAXT,yBAWSA,CAV4C,oBAU5CA,CATsD,kBAStDA,CARW,sBAQXA,CADD,WAEGA,MAAA,uBAGNA,YAIMA,MAHN,kBAGMA,CAHS,UAGTA,CAF+D,gBAE/DA,CADuB,gCAWrBA,MALA,qBAAAqW,IAAA,OAAa1I,EAAAq2P,cAAA3tP,GAAqB,EAKlCrW,CALmC,0BAAAqW,IAAA,OACjB1I,EAAAs2P,mBAAA5tP,GAA0B,EAI5CrW,CAJ6C,sBAAAqW,IAAA,OAC/B1I,EAAA6lM,aAAAn9L,GAAoB,EAGlCrW,CAHmC,gCAAAqW,IAAA,OACX1I,EAAA6lM,aAAAn9L,IAAqB,EAAK,EAElDrW,CAFmD,wBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAEnDrW,CADgC,6BAAAqW,IAAA,OAAA1I,EAAA6jI,YAAAn7H,EAAA,GAGlCrW,QAEAA,MAAA,gCAoBEA,MAVA,uBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAUArW,CAV+B,uBAAAqW,IAAA,OAAA1I,EAAAisD,OAAAvjD,EAAA,EAU/BrW,CAT+B,6BAAAqW,IAAA,OAAA1I,EAAA6jI,YAAAn7H,EAAA,EAS/BrW,CAR0C,2BAAAqW,IAAA,OAAA1I,EAAA08L,qBAAAh0L,EAAA,EAQ1CrW,CAPiD,yBAAAqW,IAAA,OAAA1I,EAAA63H,KAAAnvH,EAAA,EAOjDrW,CAN+B,gCAAAqW,IAAA,OACP1I,EAAA6lM,aAAAn9L,IAAqB,EAAK,EAKlDrW,CALmD,0BAAAqW,IAAA,OAAA1I,EAAAolK,SAAA18J,EAAA,EAKnDrW,CAJoC,0BAAAqW,IAAA,OAAA1I,EAAAwiM,UAAA95L,EAAA,EAIpCrW,CAHqC,iCACrB2N,EAAA42P,uBAAuB,EAEvCvkQ,CAFwC,qCACpB2N,EAAA+2P,UAAU,EAC9B1kQ,CAD+B,qCACX2N,EAAA82P,sBAAsB,GAG9CzkQ,UAEAA,MAAA,kBACEA,MAAA,GAAAm6Q,GAAA,yCAQZn6Q,yBApEEA,MAAA,eAAAA,MAAA,GAAAoW,KAMQpW,MAAA,GAIAA,MAJA,MAAA2N,EAAA0R,IAIArf,CAJW,OAAA2N,EAAAoB,KAIX/O,CAHa,oBAMMA,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAQfrf,MAAA,GAGAA,MAHA,QAAA2N,EAAAm2P,iBAGA9jQ,CAH0B,oBAAA2N,EAAAohM,UAG1B/uM,CAF+B,OAAA2N,EAAA63H,KAE/BxlI,CADa,SAAA2N,EAAAg2P,cAYb3jQ,QAQAA,MARA,OAAA2N,EAAAvL,KAQApC,CARa,YAAA2N,EAAAohM,UAQb/uM,CAPuB,MAAA2N,EAAA0R,IAOvBrf,CANW,OAAA2N,EAAA63H,KAMXxlI,CALa,UAAA2N,EAAAq7G,QAKbhpH,CAJmB,QAAA2N,EAAAmB,MAInB9O,CAHqB,SAAA2N,EAAAg2P,aAGrB3jQ,CAFuB,YAAA2N,EAAA+wC,OAEvB1+C,CADoB,iBAAA2N,EAAAshM,gBAkBPjvM,MAAA,GAAAA,MAAA,OAAAA,MAAA,MAAA2N,EAAAk2P,mCCMvBrY,IACAC,IACAoJ,KAAiBlwP,UAAAH,YAEjB8uN,MAAc1uN,KACdsvC,IAAc1vC,YAEduJ,KAAIvJ,MAEJ8J,MAASG,OAAA,qKAAAC,gBAAA,WAGAwrQ,CAAyB,sCC5C/B,IAAME,GAAsB,MAA7B,MAAOA,EAeD98J,kBACArkD,aAfH55C,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR/hD,YACU2+G,EACArkD,GADAr6D,KAAA0+G,oBACA1+G,KAAAq6D,eAERr6D,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACPy2C,WAAW,EACXxrB,SAAS,EACTpT,OAAQ4S,KACe,GAsB/Br2B,KAAK0+G,kBACF3pC,sBAnBqD,CACtDvxE,KAAM,MACNjB,IAAK,uDACLwE,OAAQ,CACN0vD,OAAQ,2CACRC,QAAS,SAEXuZ,gBAAgB,EAChBF,WAAY,CACV3jD,IAAK,OACLD,IAAK,OACL+N,OAAO,EACP12B,KAAM4vE,MAAeiiC,KACrBl/F,MAAOm9D,KAAgBgiC,OACvBvkF,KAAM,KAMPluB,UAAWwzB,KACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,cACP6X,OAAQ4S,KACe,EAGjC,4CA7DWmlP,GAAsBp6Q,MAAAuE,OAAAvE,MAAAuE,OAAA,+BAAtB61Q,EAAsBltQ,UAAA,sBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,sUAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IC5BzB1N,MATV,qBASUA,CALT,yBAKSA,CAJyC,oBAIzCA,CAHsD,kBAGtDA,CAFW,sBAEXA,CADyC,WAEvCA,MAAA,uBAGNA,YAGIA,MAFJ,kBAEIA,CAFW,UAEXA,CADwC,iBAEtCA,MAAA,6BAMZA,yBApBEA,MAAA,eAAAA,MAAA,EAAAoW,KAKuBpW,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAOKrf,MAAA,GAAAA,MAAA,SAAA2N,EAAA0R,IAAAq/B,wBDY9B8sM,IACAC,IACAoJ,KAAiBrwP,UAAAD,YAEjB2vC,IAAc3vC,gBAIL61Q,CAAsB,8DErB7Bp6Q,MAAA,kCAKEA,MAAA,2BAAAqW,GAAArW,MAAAyK,GAAA,MAAAP,GAAAlK,MAAA,UAAAA,MAAmBkK,GAAA0f,gBAAAvT,GAAuB,GAE5CrW,+CAHEA,MAFA,QAAAq6Q,EAAAxgO,YAEA75C,CAF+B,mBAAAkK,EAAAwf,iBAE/B1pB,CADqC,oBAAAkK,EAAAuf,8CAJzCzpB,MAAA,GACEA,MAAA,EAAAs6Q,GAAA,kFACGt6Q,cAAA,OAAAA,MAAA,IAAAq6Q,EAAAllF,+CAUHn1L,MAAA,0DAMEA,MAJA,QAAAu6Q,EAAA/jO,YAIAx2C,CAJ+B,gBAI/BA,CAHmB,sBAGnBA,CAFyB,eAEzBA,CADkB,OAAAkK,EAAA2G,yCAKpB7Q,MAAA,6DAWEA,MAHA,YAAAkK,EAAAswQ,mBAGAx6Q,CAHgC,iBAAAkK,EAAA0hB,eAGhC5rB,CAFiC,QAAAu6Q,EAAA1gO,YAEjC75C,CAD+B,WAAAu6Q,EAAAt9P,KAAAw2H,uCAIjCzzI,MAAA,sBAGEA,MAAA,wDACFA,mCA7BFA,MAAA,GAWEA,MAVA,EAAAy6Q,GAAA,sBAUAz6Q,CAHC,EAAA06Q,GAAA,4CAiBD16Q,MAAA,EAAA26Q,GAAA,2CAMA36Q,MAAA,iEA7BGA,cAAA,OAAAu6Q,EAAA/jO,aAUAx2C,cAAA,OAAAu6Q,EAAA1gO,aAAA0gO,EAAAt9P,MAAAs9P,EAAAt9P,KAAAw2H,eAAAzzI,MAAA,IAAAu6Q,EAAAplF,qBAcAn1L,MAAA,GAAAA,MAAA,YAAAA,MAAA,IAAAu6Q,EAAAplF,qBAMDn1L,MAAA,GAAAA,MAAA,YAAAu6Q,ICpCD,MAAM7nG,GAAiB,CAC5B,CAAEzwG,KAAM,GAAIkpL,WAAY,WAAYC,UAAW,QAC/C,CACE5gP,MAAO,aACPy3D,KAAM,aACNjnD,UAAW++P,IAEb,CACEvvQ,MAAO,QACPy3D,KAAM,QACNjnD,UAAWk+O,IAEb,CACE1uP,MAAO,SACPy3D,KAAM,SACNjnD,UAAWo+O,IAEb,CACE5uP,MAAO,UACPy3D,KAAM,UACNjnD,UAAWu+O,IAEb,CACE/uP,MAAO,WACPy3D,KAAM,WACNjnD,UAAW49O,GAEb,CACEpuP,MAAO,UACPy3D,KAAM,UACNjnD,UAAW29O,GAEb,CACEnuP,MAAO,QACPy3D,KAAM,QACNjnD,UAAW89O,GAEb,CACEtuP,MAAO,UACPy3D,KAAM,UACNjnD,UAAWq+O,IAEb,CACE7uP,MAAO,OACPy3D,KAAM,OACNjnD,UAAW09O,GAEb,CACEluP,MAAO,QACPy3D,KAAM,QACNjnD,UAAW4+O,IAEb,CACEpvP,MAAO,UACPy3D,KAAM,UACNjnD,UAAWq9O,GAEb,CACE7tP,MAAO,SACPy3D,KAAM,SACNjnD,UAAWu9P,IAEb,CACE/tQ,MAAO,QACPy3D,KAAM,QACNjnD,UAAWw+O,IAEb,CACEhvP,MAAO,gBACPy3D,KAAM,gBACNjnD,UAAWi+O,IAEb,CACEzuP,MAAO,aACPy3D,KAAM,aACNjnD,UAAWy9O,GAEb,CACEjuP,MAAO,cACPy3D,KAAM,cACNjnD,UAAWo/P,IAEb,CACE5vQ,MAAO,aACPy3D,KAAM,aACNjnD,UAAWs+O,IAEb,CACE9uP,MAAO,iBACPy3D,KAAM,iBACNjnD,UAAWk/P,IAEb,CACE1vQ,MAAO,YACPy3D,KAAM,YACNjnD,UCtD8B,MAA5B,MAAO4/P,EAkCDt9J,kBACArkD,aACDyqM,eAnCF8W,mBACP/wP,kBAA8C,IAAI9oB,KAAgB,GAC3D+oB,iBAAgD,CACrDP,SAAU,EACVC,gBAAiB,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,KACxCC,sBAAsB,GAGjBhK,IAAc,IAAIosG,MAAO,CAC9Bv1F,SAAU,CACRgrG,YAAa,CACXxxH,WAAW,MAKVX,KAAuB,CAC5BuxC,OAAQ,EAAC,GAAK,MACdI,KAAM,GAGR,kBAAIi6L,GACF,OAAO/7O,KAAK8kQ,eAAe50P,KAC7B,CAEO+rQ,mBAEAhqQ,cAA+BjH,MAAcE,QAE7C8hB,eACLzP,KAA0BE,QAE5B1d,YACU2+G,EACArkD,EACDyqM,GAFC9kQ,KAAA0+G,oBACA1+G,KAAAq6D,eACDr6D,KAAA8kQ,gBACN,CAEHv3P,WACEvN,KAAKi8Q,mBAAqBj8Q,KAAK+7O,eAAer3N,UAC3CrC,SACEkE,IAA8D,IAA1BA,EAAO/V,MAAMgY,UAEnDzkB,QACC0c,MAAK8F,IACH,MAAMvI,OACOhc,IAAXukB,OAAuBvkB,EAAYukB,EAAOvI,OAC5C,OAAIA,GAKFA,EAAO45B,YAAYznC,KAAKzG,OAAQgC,IACT,gBAAdA,GAAOwG,IAGX8L,KAIbhe,KAAK0+G,kBACF3pC,sBAAsB,CACrBvxE,KAAM,QAEPX,UAAWwzB,IACVr2B,KAAKygB,IAAIu7C,SACPh8D,KAAKq6D,aAAawkD,YAAY,CAC5BjzG,MAAO,MACP6X,OAAQ4S,EACRgsB,WAAW,EACXxrB,SAAS,IACc,GAoB/B72B,KAAK0+G,kBACF3pC,sBAjBgD,CACjDvxE,KAAM,MACNjB,IAAK,kDACLwE,OAAQ,CACN47E,aAAc,oBACdrK,kBAAmB,WACnB1hB,QAAS,QACTunB,aAAc,WAEhBvK,aAAc,CACZ,CAAE5kD,KAAM,YAAa0uD,MAAO,MAC5B,CAAE1uD,KAAM,aAAc0uD,MAAO,QAC7B,CAAE1uD,KAAM,aAAc0uD,MAAO,WAM9B76E,UAAWwzB,IAOVr2B,KAAKygB,IAAIu7C,SAASh8D,KAAKq6D,aAAawkD,YANK,CACvCjzG,MAAO,cACP6lE,cAAe,IACf56C,SAAS,EACTpT,OAAQ4S,IAEmD,EAEnE,CAEArL,gBAAgBtB,GACd1pB,KAAK47Q,mBAAqBlyP,CAC5B,4CA3GWsyP,GAAqB56Q,MAAAuE,OAAAvE,MAAAuE,OAAAvE,MAAAwE,IAAA,+BAArBo2Q,EAAqB1tQ,UAAA,oBAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,GAAAC,OAAA,gtBAAAC,SAAA,SAAAC,EAAAC,GAAA,EAAAD,IF5D5B1N,MAHN,qBAGMA,CAH2C,yBAG3CA,CAF2C,sBAE3CA,CADwD,WAEtDA,MAAA,uBAEJA,UAEAA,MAAA,8BAOAA,MAAA,EAAA86Q,GAAA,uCAWA96Q,MAAA,EAAA+6Q,GAAA,uCAoCJ/6Q,iBA5DqBA,MAAA,GAAYA,MAAZ,MAAA2N,EAAA0R,IAAYrf,CAAD,OAAA2N,EAAAoB,MAEP/O,MAAA,GAAAA,MAAA,MAAA2N,EAAA0R,KAMnBrf,QACAA,MADA,QAAA2N,EAAAgtO,eACA36O,CADwB,MAAA2N,EAAA0R,KAKXrf,cAAA,OAAAA,MAAA,IAAA2N,EAAAktQ,qBAWA76Q,MAAA,GAAAA,MAAA,OAAAA,MAAA,IAAA2N,EAAAktQ,qCEsBfvsQ,KACAk9O,IACAC,IACAt3N,KACA3jB,MACAwY,KACA8yM,MAAqBv3N,YAErB01C,KACAmgM,MACA5/L,KACAhnC,MAAa/O,MACbsJ,MAAIU,OAAA,gOAGKmsQ,CAAqB,yDC5D3B,MAAMnjB,EAAkC,CAC7CujB,YAAY,EACZtjB,IAAK,CACHujB,kBAAmB,CACjBC,KAAM,CACJttP,KAAM,iBACN8tB,QAAS,6BACTqyC,SAAU,CACR,CACEngE,KAAM,WAER,CACEA,KAAM,YACNggE,cAAe,CACbzsF,IAAK,sBACL0b,SAAU,4BAMpBusH,YAAa,CACX,CACE9gB,KAAM,aACNhsC,MAAO,iBACPwuD,IAAK,iHACL17D,OAAQ,EAAC,YAAc,YAAa,YAAa,gBAGrDnkB,KAAM,CACJvsD,SAAU,cACV+qP,OAAQ,CACNl6M,SAAS,GAEXszM,gBAAgB,GAElBs4B,gBAAiB,CACfC,cAAc,EACdC,yBAAyB,GAE3BC,aAAc,CACZn6Q,IAAK,2CAEP0xD,SAAU,CACR9I,OAAQ,aAEVq0K,QAAS,CACP1wI,QAAS,CACP,CACE58E,GAAI,YACJtG,MAAO,aACPrJ,IAAK,uDAEP,CACE2P,GAAI,qBACJtG,MAAO,uBACPrJ,IAAK,kDACLmuE,YAAa,CACXz7D,KAAM,IACNm6O,KAAM,CAAC,0BAA2B,kCAEpCz1K,gBAAiB,SACjB93D,MAAO,IAET,CACE3P,GAAI,mBACJtG,MAAO,4BACPrJ,IAAK,kDACLs7N,WAAY,CAAC,UAEf,CACE3rN,GAAI,4BACJtG,MAAO,4BACPrJ,IAAK,sDACLy7N,qBAAav6G,IAAYE,YAI/Bo1I,WAAY,CACVl4L,SAAU,SACV87M,IAAK,iDACLvkB,cAAc,GAEhB5vF,cAAe,CACbo0G,qBAAsB,CAAEjsO,SAAS,GACjCksO,UAAW,CACTlsO,SAAS,GAEXmsO,SAAU,CACRvzG,UAAW,8CACXjV,MAAO,EACP3jH,SAAS,EACT5pC,OAAQ,CACNo7J,MAAO,KAETs2D,sBAAsB,GAExBskD,mBAAoB,CAClBp0G,sBAAsB,GAExBq0G,gBAAiB,CACfr0G,sBAAsB,EACtBY,UAAW,6CACXjV,MAAO,EACP3jH,SAAS,GAEXssO,OAAQ,CACN1zG,UAAW,mDACXjV,MAAO,EACP3jH,SAAS,EACT5pC,OAAQ,CACNo7J,MAAO,+RCjGV,IAAM+6G,EAAgB,MAAvB,MAAOA,GACSt7Q,eAApB7B,YAAoB6B,IAAA5B,KAAA4B,iBAAiC,CAErD+F,UACEC,GACAjF,IAEA,MAAM+lC,GAAiB9gC,GAAYtC,QAAQpF,IAAI,kBACzC6H,GAAMH,GAAYI,MAAM,CAC5B1C,QAASsC,GAAYtC,QAAQ0D,OAAO,oBAEtC,GAAuB,UAAnB0/B,GACF,OAAO/lC,GAAKwF,OAAOJ,IAErB,MAAMo1Q,GAAiB,CAAEtzM,eAAW7nE,GACpC,OAAOW,GAAKwF,OAAOJ,IAAKhE,QACtBG,KAAYE,IAAUpE,KAAK49C,YAAYx5C,GAAO+4Q,MAAe,EAC7D/8M,KAAS,KACP,MAAMyJ,GAAYszM,GAAetzM,UAC5BA,KAIDA,GAAUzlE,MAAMykC,UAClB7oC,KAAKo9Q,kBAAkBvzM,IACbA,GAAUzlE,MAAMC,QAC1BrE,KAAKq9Q,oBAAoBxzM,IAAS,GAI1C,CAEQjsB,YACNisB,GACAszM,IAEA,GAAItzM,cAAqByzM,KAAmB,CAC1C,MAAMC,GAA+B,WAApB1zM,GAAUzlE,MAAqBylE,GAAUzlE,MAAQ,GAClEm5Q,GAAS/kQ,QAAUqxD,GAAUzlE,OAAOoU,SAAWqxD,GAAU2zM,WACzDD,GAASl5Q,QAAS,EAElBwlE,GAAY,IAAIyzM,KAAkB,CAChCl5Q,MAAOm5Q,GACPj4Q,QAASukE,GAAUvkE,QACnBqwF,OAAQ9rB,GAAU8rB,OAClB6nL,WAAY3zM,GAAU2zM,WACtBj7Q,IAAKsnE,GAAUtnE,KAEnB,CAEA46Q,UAAetzM,UAAYA,MACpBrG,MAAWqG,GACpB,CAEQuzM,kBAAkBvzM,IACxBA,GAAUzlE,MAAMC,QAAS,EACzBrE,KAAK4B,eAAewC,MAAMylE,GAAUzlE,MAAMoU,QAASqxD,GAAUzlE,MAAMwH,MAAO,CACxE+7D,aAAa,GAEjB,CAEQ01M,oBAAoBxzM,IAC1BA,GAAUzlE,MAAMC,QAAS,EACzBrE,KAAK4B,eAAewC,MAClB,mCACA,iCACA,CACEujE,aAAa,GAGnB,8CAtEWu1M,IAAgB97Q,MAAAuE,MAAA,iCAAhBu3Q,GAAgB77Q,QAAhB67Q,GAAgB57Q,UAAAC,WAFf,gBAED27Q,EAAgB,KCFhBO,EAAc,MAArB,MAAOA,GACX,cAAO1kQ,GACL,MAAO,CACLC,SAAUykQ,GACVjzQ,UAAW,CACT,CACEC,QAASC,KACTC,SAAUuyQ,EACVtyQ,OAAO,IAIf,CAEA7K,YAAoC29Q,IAClC,GAAIA,GACF,MAAM,IAAI17P,MACR,oEAGN,8CApBWy7P,IAAcr8Q,MAAAq8Q,GAAA,kCAAdA,yCAAc,6BCH3B,MAAME,EAAqB,CACzB3uP,KAAM,SACN4nC,QAAS,EACTgnN,iBAAkB,CAChB,CACE1tQ,MAAO,UACP2tQ,YAAa,CAAEC,QAAS,MAAOC,eAAe,GAC9CC,YAAa,CACX,CAAEhvP,KAAM,WAAYivP,QAAS,WAAYp+Q,QAAS,CAAEm5O,QAAQ,MAGhE,CACE9oO,MAAO,YACP2tQ,YAAa,CAAEC,QAAS,UAAWC,eAAe,GAClDC,YAAa,CACX,CACEhvP,KAAM,eACNivP,QAAS,eACTp+Q,QAAS,CAAEm5O,QAAQ,IAErB,CACEhqN,KAAM,gBACNivP,QAAS,gBACTp+Q,QAAS,CAAEm5O,QAAQ,QAkBtB,IAAMklC,EAAa,MAApB,MAAOA,GACX,cAAOnlQ,CACLlZ,GAAyB,IAEzB,MAAO,CACLmZ,SAAUklQ,GACV1zQ,UAAW,IAACo5D,MAAc/jE,KAAO,EAAGslE,SAExC,CAEAplE,cAAe,8CAVJm+Q,GAAa,8BAAbA,uCAJA,IAAC/1M,SAAiBlvD,QAAA,CAN3By6E,KACAz2B,KACAqD,KAAkBvnD,UAClB0kQ,EAAe1kQ,UACfolQ,KAAmBplQ,QAAQ4kQ,GAInBr9M,KAAmBm9M,EAAgB9tQ,eAElCuuQ,EAAa,4IC5CnB,MAAMpqG,GAAiB,CAC5B,CAAEloK,MAAO,OAAQy3D,KAAM,OAAQjnD,UCMJ,MAAvB,MAAOgiQ,GACSh0O,uBAApBrqC,YAAoBqqC,IAAApqC,KAAAoqC,yBAAiD,CAErEe,YACEnrC,KAAKoqC,uBAAuBe,UAAU,SACxC,8CALWizO,IAAgBh9Q,MAAAuE,MAAA,+BAAhBy4Q,GAAgB9vQ,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,6YAAAC,SAAA,SAAAC,GAAAC,IAAA,EAAAD,KCdzB1N,MAFJ,mBAEIA,CAFY,UAEZA,CAD8B,UACXA,MAAA,oBAAcA,QACjCA,MAAA,WACFA,QAEAA,MAAA,OACEA,MAAA,4BAMFA,QAEAA,MAAA,SACEA,MAAA,gGACaA,MAAA,QACbA,MAAA,4FAEFA,QAEAA,MAAA,SAAIA,MAAA,qDAA8CA,QAG9CA,MAFJ,UAEIA,CAFmB,QAEnBA,CADE,QACCA,MAAA,kBAAeA,QAAKA,MAAA,yEAEzBA,QAEEA,MADF,QACEA,CADE,QACCA,MAAA,iBAAcA,QAAKA,MAAA,wGAExBA,QAEEA,MADF,QACEA,CADE,QACCA,MAAA,mBAAgBA,QAAKA,MAAA,wGAE1BA,QAEEA,MADF,QACEA,CADE,QACCA,MAAA,iBAAcA,QAAKA,MAAA,kEAExBA,QAEEA,MADF,QACEA,CADE,QACCA,MAAA,gBAAaA,QAAKA,MAAA,6EAEvBA,QAEEA,MADF,QACEA,CADE,QACCA,MAAA,oBAAiBA,QAAKA,MAAA,iEAE3BA,QACIA,MAAJ,QAAIA,CAAA,QAAGA,MAAA,wBAAqBA,QAAKA,MAAA,4CACnCA,UAEAA,MAAA,SAAIA,MAAA,6CAAsCA,QAIpCA,MAHN,QAGMA,CAHF,QAGEA,CAFA,QAEAA,CADE,UAKCA,MAAA,mBAGPA,YAGIA,MAFJ,QAEIA,CAFA,QAEAA,CADE,UAECA,MAAA,4BAITA,cAEAA,MAAA,aACGA,MAAA,sBAAeA,MAAA,WAAMA,MAAA,iBAAcA,QAAQA,MAAA,kCAEhDA,0BD7DYwrP,KAAoB37M,KAAwBrrC,eAE3Cw4Q,EAAgB,MDL3B,CACExyQ,MAAO,OACPy3D,KAAM,OACNg7M,aAAcA,IAAMzvO,QAAAC,UAAA4uF,KAAA6gJ,EAAA3jM,KAAA2jM,EAAA,QAA8B7gJ,KAAM3Y,IAAMA,GAAEgvD,SAElE,CACEloK,MAAO,SACPy3D,KAAM,SACNg7M,aAAcA,IAAMzvO,QAAAC,UAAA4uF,KAAA6gJ,EAAA3jM,KAAA2jM,EAAA,QAAkC7gJ,KAAM3Y,IAAMA,GAAEgvD,SAEtE,CACEloK,MAAO,UACPy3D,KAAM,UACNg7M,aAAcA,IACZzvO,QAAAC,UAAA4uF,KAAA6gJ,EAAA3jM,KAAA2jM,EAAA,QAAoC7gJ,KAAM3Y,IAAMA,GAAEgvD,SAEtD,CACEloK,MAAO,OACPy3D,KAAM,OACNg7M,aAAcA,IAAMzvO,QAAAC,UAAA4uF,KAAA6gJ,EAAA3jM,KAAA2jM,EAAA,QAA8B7gJ,KAAM3Y,IAAMA,GAAEgvD,SAElE,CACEloK,MAAO,MACPy3D,KAAM,MACNg7M,aAAcA,IAAMzvO,QAAAC,UAAA4uF,KAAA6gJ,EAAA3jM,KAAA2jM,EAAA,QAA4B7gJ,KAAM3Y,IAAMA,GAAEgvD,SAEhE,CAAEzwG,KAAM,KAAMkpL,WAAY,UAGfgyB,GAAwB,CACnC,CAAE3yQ,MAAO,OAAQy3D,KAAM,OAAQkpL,WAAY,QAASC,UAAW,QAC/D,CACE5gP,MAAO,OACPy3D,KAAM,OACN5iC,SAAU+9O,GAAgBC,WAE5B,CACE7yQ,MAAO,OACPy3D,KAAM,OACN5iC,SAAU+9O,GAAgBE,WAE5B,CACE9yQ,MAAO,SACPy3D,KAAM,SACN5iC,SAAU+9O,GAAgBG,WAE5B,CACE/yQ,MAAO,MACPy3D,KAAM,MACN5iC,SAAU+9O,GAAgBI,WAE5B,CACEhzQ,MAAO,UACPy3D,KAAM,UACN5iC,SAAU+9O,GAAgBK,YAI9B,SAASL,GAAgB1qG,IACvB,OAAOA,GACJpqK,OAAQ2yC,IAAUA,GAAMzwC,OACxB4W,KAAK,CAAC8/B,GAAGC,KAAOD,GAAE12C,MAAiBumM,cAAc5vJ,GAAE32C,OACxD,oFGnDUxK,MAAA,GAEIA,MADF,iBACEA,CADY,UAOTA,MAAA,GAELA,UACAA,MAAA,2DAPIA,MAAA,GACAA,MADA,aAAA09Q,GAAAz7M,KACAjiE,CAD+B,0BAAAA,MAAA,EAAAoW,KAI9BpW,cAAA09Q,GAAAlzQ,qCAWDxK,MAAA,UAKGA,MAAA,GAAiBA,2DAFlBA,MAAA,aAAA09Q,GAAAz7M,KAAA,IAAA07M,GAAA17M,MAECjiE,cAAA29Q,GAAAnzQ,qCARHxK,MAFJ,2BAEIA,CAF0B,+BAE1BA,CAD0B,qBACRA,MAAA,GACpBA,UACAA,MAAA,kBACEA,MAAA,EAAA49Q,GAAA,YAQJ59Q,UAEAA,MAAA,mDAbsBA,MAAA,GAAAA,MAAA,IAAA09Q,GAAAlzQ,MAAA,KAIExK,MAAA,GAAAA,MAAA,UAAA09Q,GAAAr+O,wCArB5Br/B,MAAA,GAcEA,MAbA,EAAA69Q,GAAA,sBAaA79Q,CAboE,EAAA89Q,GAAA,yBAAA99Q,wDAArDA,QAA6BA,MAA7B,QAAA09Q,GAAAr+O,SAA6Br/B,CAAA,WAAA+9Q,KC2B/C,IAAMC,GAAY,MAAnB,MAAOA,GAUiB92Q,SAClB+2Q,kBACArgP,MACAn9B,OAZVy9Q,YAEAC,aAAehB,GAER3yQ,MAAQ,MACRgrD,QAAUA,KACT4oN,qBAERz/Q,YAC4BuI,GAClB+2Q,GACArgP,GACAn9B,IAHkB7B,KAAAsI,YAClBtI,KAAAq/Q,qBACAr/Q,KAAAg/B,SACAh/B,KAAA6B,UAER7B,KAAKs/Q,YAAct/Q,KAAKg/B,MAAMygP,WAAW,sBACzCz/Q,KAAKw/Q,qBAAuB,IAAMx/Q,KAAKq/Q,kBAAkB1iQ,gBACzD3c,KAAKs/Q,YAAY7+K,iBAAiB,SAAUzgG,KAAKw/Q,sBAEjDx/Q,KAAK0/Q,kBACP,CAEAnyQ,WACEvN,KAAK2/Q,oBACP,CAEQA,qBACN3/Q,KAAK6B,OAAOsgJ,OACTp+I,QACCs5C,KAAO8kG,IAAWA,cAAkBy9H,OAAa,EACjD71J,KAAM,MAEPlnH,UAAU,KACT7C,KAAK6/Q,qBAAmB,EAE9B,CAEQA,sBACN,MAAMC,GAAQ9/Q,KAAKsI,SAAS4nH,eAAe,iBAC3C,IAAK4vJ,GACH,OAEFA,GAAMnyO,UAAUC,IAAI,iBAEpB,MACMmyO,GAAa//Q,KAAKsI,SAAS4nH,eAAe,4BAEhDvxF,WAAW,KACT+iN,KAASjhP,OAAOq/Q,IAChBp+B,KAASjhP,OAAOs/Q,GAAU,EALI,IAOlC,CAEA7xQ,cACElO,KAAKs/Q,YAAYU,oBAAoB,SAAUhgR,KAAKw/Q,qBACtD,CAEQE,mBACa1vI,KAAUC,UAAU,CACrCC,GAAI,OACJE,OAAQ,MACRC,QAAS,SAITntE,QAAQK,IAAI,sBAAuBysE,KAAUiwI,aAEjD,8CAnEWb,IAAYh+Q,MAUbs4F,MAAQt4F,mBAAAuE,OAAAvE,MAAAwE,MAAA,+BAVPw5Q,GAAY9wQ,UAAA,eAAAG,YAAA,EAAAlE,SAAA,CAAAnJ,OAAAsN,MAAA,GAAAC,KAAA,EAAAC,OAAA,soBAAAC,SAAA,SAAAC,GAAAC,IAAA,KAAAD,GAAA,kBD/CrB1N,MAFJ,UAEIA,CAF2E,kBAE3EA,CADoE,cAC5CA,MAAA,mBAAAA,MAAAyK,IAAA,MAAAq0Q,GAAA9+Q,MAAA,WAAAA,MAAS8+Q,GAAAjpQ,SAAa,GAC5C7V,MAAA,cAAUA,MAAA,UACZA,UACAA,MAAA,QAAIA,MAAA,GAAWA,QACfA,MAAA,UAAiCA,MAAA,GACnCA,UAaIA,MAXJ,4BAWIA,CARH,qBAQGA,CADD,sBAEGA,MAAA,GAAA++Q,GAAA,sBAkCJ/+Q,UAEAA,MAAA,0BACEA,MAAA,oBAGNA,mBA7D+BA,MAAA,oBAAA2N,GAAAuwQ,YAAA34M,SAKvBvlE,MAAA,GAAAA,MAAA2N,GAAAnD,OAC6BxK,MAAA,GAAAA,MAAA2N,GAAA6nD,QAAA0L,KAKjClhE,cAAA,aAAA2N,GAAAuwQ,YAAA34M,QAAA,WAKEvlE,QACAA,MADA,OAAA2N,GAAAuwQ,YAAA34M,QAAA,cACAvlE,CAD8C,kBAAA2N,GAAAuwQ,YAAA34M,SAKNvlE,MAAA,GAAAA,MAAA,UAAA2N,GAAAwwQ,8BCe1C9qQ,KACAtF,KACAixQ,KAAkBv6Q,oBAClBw6Q,KAAgBv6Q,KAChByJ,KAAexJ,KACfyJ,KAAaxJ,KACbs6Q,KAAgB3rQ,eAChBvF,KAAayF,UAAAC,KACbyrQ,KACAC,KACAC,MAAY5wQ,OAAA,s9BAGHuvQ,EAAY,qBCRrBvmB,KAAYujB,eACdsE,UAAc,EAGhBC,MAAqBvB,GAAc,CACjC50Q,UAAW,IACT66D,OACE64M,EACA0C,KACAC,KACAtxQ,KACAC,KACAJ,KACAkxQ,KACAD,OAAgB,EAElBS,SAAkBC,UAAkB,EACpCC,MAAcltG,MAAQmtG,MAAeC,QAAkB,EACvDC,SAAiB,EACjBv9M,MAAc,CACZtX,QAASusM,KAAYC,OACtB,EACD3zL,SAAkB,EAClB76D,SAAuB,EACvBm9B,QACA,CACEh9B,QAAS22Q,KACTv9M,SAAU,CAAEo1F,WAAY,YAE1B,CAAExuJ,QAAS42Q,KAA6Bx9M,SApCmB,CAC7Dy9M,UAAW,IACXC,UAAW,EACXC,kBAAmB,EACnBC,6BAA6B,OAkC5Bp7H,MAAOliJ,IAAQ++D,QAAQK,IAAIp/D,wBCxE9B,IAAAsc,EAAA,CACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,mBACA,sBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,iBACA,oBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,cACA,kBACA,qBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,WACA,kBACA,qBACA,cACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,SAAAihQ,EAAA35Q,GACA,IAAAmK,EAAAyvQ,EAAA55Q,GACA,OAAAu2Q,EAAApsQ,EACA,CACA,SAAAyvQ,EAAA55Q,GACA,IAAAu2Q,EAAA/qH,EAAA9yI,EAAA1Y,GAAA,CACA,IAAA4jC,EAAA,IAAA3pB,MAAA,uBAAAja,EAAA,KACA,MAAA4jC,EAAA+9E,KAAA,mBACA/9E,CACA,CACA,OAAAlrB,EAAA1Y,EACA,CACA25Q,EAAAj7Q,KAAA,WACA,OAAAD,OAAAC,KAAAga,EACA,EACAihQ,EAAA7yO,QAAA8yO,EACAC,GAAAC,QAAAH,EACAA,EAAAxvQ,GAAA","names":["TokenService","injector","options","tokenKey","constructor","this","config","get","ConfigService","getConfig","set","token","localStorage","setItem","remove","removeItem","getItem","decode","jwtDecode","isExpired","jwt","currentTime","Date","getTime","exp","i0","factory","ɵfac","providedIn","AuthService","http","tokenService","languageService","messageService","router","authenticate$","BehaviorSubject","undefined","logged$","redirectUrl","languageForce","anonymous","authOptions","hasAuthService","url","user","decodedToken","decodeToken","next","authenticated","subscribe","globalCacheBusterNotifier","login","username","password","myHeader","HttpHeaders","body","encodePassword","loginCall","loginWithToken","type","infosUser","typeConnection","loginAnonymous","of","refresh","post","pipe","tap","data","catchError","err","error","caught","logout","isAuthenticated","getToken","goToRedirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","patch","Base64","encode","logged","isAnonymous","isAdmin","headers","tokenDecoded","locale","setLanguage","alert","i1","i2","i3","i4","i5","i6","AuthStorageService","BaseStorage","authService","super","userIgo","preference","key","Object","keys","value","scope","StorageScope","LOCAL","clear","params","mergePreference","AuthInterceptor","refreshInProgress","trustHosts","hostsWithCredentials","hostsWithAuthByKey","push","window","location","hostname","hostsByKey","intercept","originalReq","withCredentials","handleHostsWithCredentials","req","clone","hostWithKey","handleHostsAuthByKey","handle","refreshToken","element","document","createElement","href","host","indexOf","authReq","sourceId","hashUser","Md5","hashStr","delete","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","split","urlWithKeyAdded","shift","paramsToKeep","filter","p","length","join","reqUrl","hostWithCredentials","RegExp","domainRegFilters","test","hostWithAuthByKey","keyProperty","keyValue","provideAuthentification","features","providers","provide","HTTP_INTERCEPTORS","useClass","multi","StorageService","feature","makeEnvironmentProviders","ActionbarMode","Dock","Overlay","Context","ActionStore","EntityStore","ctx_r1","color","disabled$","isObservable","action","icon","title","_r1","onClick","ActionbarItemComponent_mat_list_item_0_button_4_Template","ActionbarItemComponent_mat_list_item_0_span_5_Template","withTooltip","tooltip$","ngClass$","withIcon","withTitle","_r3","handler","checkCondition$","ActionbarItemComponent_mat_list_item_1_mat_checkbox_4_Template","ActionbarItemComponent","noDisplay$","ngClass$$","disabled$$","availability$$","checkCondition$$","tooltip$$","noDisplay$$","display$$","disabled","noDisplay","trigger","EventEmitter","ngOnInit","args","ngClass","updateNgClass","checkCondition","updateCheckCondition","tooltip","updateTooltip","availability","available","display","ngOnDestroy","unsubscribe","emit","assign","selectors","inputs","outputs","standalone","decls","vars","consts","template","rf","ctx","ActionbarItemComponent_mat_list_item_0_Template","ActionbarItemComponent_mat_list_item_1_Template","checkbox","NgIf","MatListModule","MatTooltipModule","NgClass","MatButtonModule","MatIconModule","MatCheckboxModule","AsyncPipe","IgoLanguageModule","IgoIconComponent","styles","changeDetection","scrollUp","onTriggerAction","toggleCollapseAction","store","view","empty","action_r5","_r4","$implicit","state","ActionbarComponent_mat_list_1_2_ng_template_0_Template","all$","ActionbarComponent_mat_list_1_igo_actionbar_item_1_Template","ActionbarComponent_mat_list_1_2_Template","withToggleButton","collapsed","_r6","scrollDown","action_r8","_r7","ActionbarComponent_div_3_ng_template_8_Template","actionbarMenu_r9","iconColor","overlayClass","xPosition","yPosition","action_r11","_r10","ActionbarComponent_mat_card_4_ng_template_2_Template","ActionbarComponent","overlay","elRef","cdRef","mediaService","actionbarMode","id","watcher","heightCondition$","positionConditionTop$","positionConditionLow$","mode","horizontal","scrollActive","_overlayClass","isCollapsed","withTitleClass","withIconClass","horizontalClass","heightCondition","el","nativeElement","clientHeight","scrollHeight","positionConditionTop","scrollTop","positionConditionLow","isDesktop","getMedia","Media","Desktop","ngOnChanges","changes","currentValue","previousValue","destroy","EntityStoreWatcher","scrollBy","hostVars","hostBindings","ActionbarComponent_div_0_Template","ActionbarComponent_mat_list_1_Template","ActionbarComponent_div_2_Template","ActionbarComponent_div_3_Template","ActionbarComponent_mat_card_4_Template","NgFor","MatMenuModule","i7","MatCardModule","i8","i9","IgoBadgeIconDirective","igoMatBadgeIcon","html","updateHtml","matBadgeHidden","hidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","inverseColor","updateColor","igoMatBadgeInheritColor","inheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","querySelector","originalColor","style","alignItems","justifyContent","innerHTML","background","getComputedStyle","getPropertyValue","CollapseDirective","renderer","target","_target","_collapsed","collapseTarget","expandTarget","toggle","click","addClass","removeClass","CollapsibleComponent","_title","ngContentSelectors","_c0","$event","content_r2","ConfirmDialogComponent","dialogRef","confirmMessage","titleKey","proccessKey","cancelKey","close","MatDialogTitle","MatDialogContent","MatDialogActions","ConfirmDialogService","dialog","open","message","_options","modeYesNo","disableClose","componentInstance","afterClosed","IgoConfirmDialogModule","forRoot","ngModule","imports","SanitizeHtmlPipe","_sanitizer","transform","v","bypassSecurityTrustHtml","pure","CustomHtmlComponent","_html","DynamicComponent","componentFactory","componentRef","subscriptions","inputs$$","subscribers","setTarget","createComponent","updateInputs","updateSubscribers","unobserveAllInputs","unsubscribeAll","instance","forEach","propName","unobserveInput","inputValue","hasOwnProperty","Observable","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","call","emitter","subscriber","Array","isArray","_subscriber","observable","values","s","DynamicComponentService","resolver","create","componentCls","resolveComponentFactory","DynamicOutletComponent","dynamicComponentService","component","dynamicComponent","eq","ObjectUtils","objectsAreEquivalent","inputsAreEquivalents","subscribersAreEquivalents","detectChanges","renderComponent","viewQuery","ViewContainerRef","DynamicOutletComponent_ng_template_0_Template","EntityTableColumnRenderer","Default","HTML","UnsanitizedHTML","Editable","Icon","ButtonGroup","EntityTableScrollBehavior","Auto","Instant","Smooth","EntityTableSelectionState","None","All","Some","getEntityProperty","entity","property","t","safeObject","getEntityId","meta","idProperty","getEntityTitle","titleProperty","getEntityTitleHtml","titleHtml","titleHtmlProperty","getEntityIcon","iconProperty","getEntityRevision","revision","EntityStateManager","index","Map","change$","ReplaySubject","getKey","size","setMany","entities","setAll","from","update","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","currentState","reduce","acc","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","map","Set","concat","some","changeKey","entries","bunch","storeKeys","EntityView","source$","values$","values$$","lifted","joins","filter$","filters$","filterIndex","sort$","getKey$","count$","count","empty$","_index","Error","all","firstBy","clause","find","firstBy$","manyBy","manyBy$","sort","createIndex","addFilter","uuid","removeFilter","lift","observables$","liftJoinedSource","liftSource","combineLatest","skip","debounceTime","_values","filters","processValues","setValues","sources$","source","joinData","computeJoinedValue","joinIndex","slice","filterValues","sortValues","clauses","every","v1","v2","naturalCompare","valueAccessor","direction","nullsFirst","generateIndex","entities$","stateView","getProperty","pristine","_pristine","strategies","createStateManager","createDataView","createStateView","load","softClear","updateCount","insert","insertMany","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","splice","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","deleteMany","currentRecord","statesAreTheSame","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","innerStateIndex","entities$$","state$$","setChangeDetector","setStore","teardownObservers","setupObservers","onEntitiesChange","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","ctx_r0","emptyValue","emptyText","multiSelectValue","multiText$","record_r2","titleAccessor","EntitySelectorComponent","selected$","selected$$","multiAllText","multiNoneText","placeholder","selectedChange","records","onSelectFromStore","onSelectionChange","event","multiSelect","_value","updateMultiToggleWithEntities","EntitySelectorComponent_mat_option_3_Template","EntitySelectorComponent_mat_option_4_Template","EntitySelectorComponent_ng_template_5_Template","MatFormFieldModule","MatSelectModule","MatOptionModule","EntityTablePaginatorComponent","hidePageSize","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","count$$","entitySortChange$$","paginationLabelTranslation$$","entitySortChange$","paginatorOptions","page","paginatorChange","paginator","emitPaginator","firstPage","initPaginatorOptions","translateLabels","isMobile","translate","label","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","startIndex","Math","max","min","sub","MatPaginator","MatPaginatorModule","EntityTableRowDirective","static","selection","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","scrollBehavior","select","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","onToggleRows","checked","selectionState_r3","entityTableSelectionState","EntityTableComponent_th_3_ng_container_1_ng_container_1_Template","selectionState$","EntityTableComponent_th_3_ng_container_1_Template","selectMany","shiftKey","preventDefault","row_r5","onShiftToggleRow","rowIsSelected","stopPropagation","onToggleRow","column_r6","EntityTableComponent_ng_container_5_ng_container_1_th_1_Template","EntityTableComponent_ng_container_5_ng_container_2_th_1_Template","row_r7","cellData","name","class","_r8","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_ng_template_3_Template","isImg","notImg_r9","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_Template","isUrl","isAnUrlDefault_r10","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_Template","row_r11","_r12","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_ng_template_3_Template","notImg_r13","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_Template","isAnUrlHTML_r14","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_Template","_r16","row_r17","onDateChange","picker_r18","_r19","onFocus","onChange","onBlur","_r20","onValueChange","step","getValidationAttributeValue","_r21","_r22","onBooleanValueChange","option_r24","_r23","onSelectValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_mat_option_1_Template","multiple","domainValues","auto_r25","option_r26","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_div_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_checkbox_5_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_7_Template","_r15","onAutocompleteValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_option_10_Template","formGroup","filteredOptions","_r27","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_ng_template_3_Template","notImg_r28","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_td_0_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_Template","isAnUrlUnsanitizedHTML_r29","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_Template","isEdition","isUnsanitizedHTML_r30","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_Template","_r31","row_r32","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_Template","_r33","button_r34","row_r35","onButtonClick","_r36","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_Template","editMode","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_Template","columnRenderer_r37","entityTableColumnRenderer","EntityTableComponent_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_Template","columnIsSortable","getColumnRenderer","getHeaderClass","row_r39","_r38","onRowSelect","onRowClick","getRowClass","_r40","EntityTableComponent","formBuilder","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","selection$$","dataSource$$","lastRecordCheckedKey","_paginator","dataSource","sortNullsFirst","withPaginator","entityClick","entitySelectChange","entitySortChange","columns","column","visible","selectionCheckbox","MatTableDataSource","fixedHeader","tableHeight","setLocale","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","controls","setValue","option","viewValue","moment","format","enableEdit","item","validation","mandatory","includes","JSON","parse","toLowerCase","setControl","control","parseInt","valueChanges","filterNormalized","normalize","replace","formControlValue","StringUtils","isValidNumber","isOctalNumber","linkColumnForce","date","utc","newKey","disable","unsubscribeStore","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","computeSelectionState","getValue","getCellClass","getTrackByFunction","row","onSort","c","added","range","createRange","selectNode","getSelection","removeAllRanges","addRange","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","sortable","pop","list_id","match","Number","list_option","edition","validationType","getTableClass","func","headerClassFunc","Function","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","MatFormFieldControl","useExisting","provideMomentDateAdapter","EntityTableComponent_th_3_Template","EntityTableComponent_td_4_Template","EntityTableComponent_ng_container_5_Template","EntityTableComponent_tr_6_Template","EntityTableComponent_tr_7_Template","EntityTableComponent_igo_entity_table_paginator_8_Template","FormsModule","ImageErrorDirective","MatAutocompleteModule","MatDatepickerModule","MatInputModule","i10","MatNativeDateModule","i11","MatSortModule","i12","MatTableModule","i13","i14","NgStyle","ReactiveFormsModule","SecureImagePipe","StopPropagationDirective","i15","FlexibleComponent","main","initial","_initial","expanded","_expanded","initialMobile","_initialMobile","collapsedMobile","_collapsedMobile","expandedMobile","_expandedMobile","_direction","_state","sizes","setSize","setTimeout","transitionTime","mediaService$$","className","media$","media","height","width","getFieldComponent","getFieldInputs","getFieldSubscribers","FormFieldComponent","formFieldService","field","fieldInputs","fieldSubscribers","fieldOptions","getFieldByType","errors","disableSwitch","formControl","getDefaultErrorMessages","FormFieldComponent_ng_container_0_Template","FormComponent","form","formData","autocomplete","submitForm","buttons","hasButtons","children","setData","onSubmit","getData","getAllFormFields","updateDataWithFormField","fields","groups","group","reset","_c3","IgoFormFieldComponent","compType","FormFieldService","register","choice_r1","_r2","ctx_r2","onDisableSwitchClick","getErrorMessage","FormFieldSelectComponent","choices","choices$","required","formControlIsRequired","getControlErrorMessage","toggleDisabled","enable","FormFieldSelectComponent_mat_option_2_Template","FormFieldSelectComponent_mat_icon_4_Template","FormFieldSelectComponent_mat_error_5_Template","encapsulation","__decorate","togglePassword","hide","FormFieldTextComponent","lastTimeoutRequest","isPassword","delayedHide","delayMS","clearTimeout","FormFieldTextComponent_mat_icon_2_Template","FormFieldTextComponent_button_3_Template","FormFieldTextComponent_mat_error_4_Template","tslib_es6","Sn","ChangeDetectorRef","FormFieldTextareaComponent","FormFieldTextareaComponent_mat_icon_3_Template","FormFieldTextareaComponent_mat_error_4_Template","getFieldNgClass","field_r1","FormGroupComponent_div_0_div_1_Template","FormGroupComponent","getFieldColSpan","colSpan","cols","FormGroupComponent_div_0_Template","FormGroupComponent_mat_error_3_Template","FormService","addControl","validator","validators","getValidators","setValidators","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","Validators","FormDialogComponent_igo_form_3_div_2_igo_form_field_1_Template","FormDialogComponent_igo_form_3_div_2_igo_form_group_2_Template","form_r5","FormDialogComponent_igo_form_3_div_2_Template","cancel","data$","cancelButtonText","processButtonText","notice","FormDialogComponent","formService","form$","formFieldConfigs","formGroupsConfigs","formGroupsConfig","valid","k","markAsTouched","updateValueAndValidity","f","MAT_DIALOG_DATA","FormDialogComponent_igo_form_3_Template","FormDialogComponent_igo_custom_html_6_Template","FormDialogService","formDialogConfig","IgoFormDialogModule","MatDialogModule","email","messages","errorMessages","MICROSOFT_ICON","svg","KEYBOARD_ESC_ICON","ENGINE_ICON","SELECTION_MARKER_ICON","PRESENTATION_PLAY_ICON","IconService","iconRegistry","sanitizer","registerSvg","addSvgIconLiteral","provideIcon","APP_INITIALIZER","useFactory","setDefaultFontSetClass","deps","MatIconRegistry","iconService","isSvg","_icon","IgoIconComponent_Conditional_0_Template","IgoIconComponent_Conditional_1_Template","errorImageUrl","hideError","onError","src","configService","activityInterceptor","interceptError","regexDepot","responseType","toDisplay","switchMap","blob","observer","reader","FileReader","readAsDataURL","onloadend","result","complete","Cacheable","maxCacheCount","String","startInteractiveTour","getClass","disabledTourButton","presentationIcon","discoverTitleInLocale$","InteractiveTourComponent_ng_container_0_button_1_Template","InteractiveTourComponent_ng_container_0_ng_template_2_Template","styleButton","raisedButton_r4","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","toolbox","getTourToStart","activeToolName","isActiveTool","activeTool$","isToolHaveTour","isToolHaveTourConfig","showTourButton","haveTour","inMobileAndShow","isTourDisplayInMobile","tour","startTour","InteractiveTourComponent_ng_container_0_Template","InteractiveTourLoader","jsonURL","allToursOptions","getPathToConfigFile","loadConfigTour","getJSON","e","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","interactiveTourLoader","shepherdService","previousStep","nextIndex","isAppHaveTour","stepConfig","conditions","condition","showInMobile","getButtons","buttonKind","classes","text","instant","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","innerText","insertBefore","checkNext","service","nextStep","_setupModal","show","executeAction","actionConfig","charAt","executeActionPromise","Promise","resolve","waitFor","maxTry","maxWait","getShepherdSteps","tourConfig","shepherdSteps","i","position","on","floatingUIOptions","middleware","autoPlacement","offset","mainAxis","Boolean","beforeShowPromise","beforeChange","beforeShow","noBackButton","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","onHide","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","IgoInteractiveTourModule","ListItemDirective","_color","focused","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","getOffsetTop","offsetTop","padding","focusedCls","disabledCls","ClickoutDirective","clickout","handleMouseClick","contains","ListComponent","navigation","_navigation","_selection","selectedItem","_selectedItem","focusedItem","_focusedItem","navigationEnabled","listItems$$","listItems","handleKeyboardEvent","navigate","enableNavigation","ngAfterViewInit","init","items","focusNext","toArray","igoList","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","disableNavigation","scrollToItem","elem","docViewTop","elemTop","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","findIndex","contentQueries","dirIndex","_c1","_c2","cursorPointer","PanelComponent","withHeader","_withHeader","PanelComponent_div_0_Template","SpinnerComponent","shown$","shown","MatProgressSpinner","Toolbox","toolbar$","activeTool$$","activeToolHistory","previousToolName","currentToolName","tool","tools$","setToolbar","toolbar","initStore","getTool","getTools","setTools","tools","getToolbar","activateTool","activatePreviousTool","deactivateTool","previous","current","getCurrentPreviousToolName","clearActiveToolHistory","setActiveTool","ToolService","ToolComponent","toolSlideInOut","speed","transition","animate","actionStore","toolbarWithTitle$","onAnimationStart","onAnimationComplete","animation$","tool_r3","getToolInputs","ToolboxComponent","isActive","toolbar$$","animating$","animating$$","classColorGrey","classColorPrimary","onToolbarChange","onActiveToolChange","onAnimate","actions","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","callback","unAnimate","animation","ToolboxComponent_igo_actionbar_0_Template","ToolboxComponent_div_2_Template","WidgetService","widgetCls","IgoWidgetOutletModule","IgoWidgetModule","widget","getEffectiveSubscribers","WidgetOutletComponent","baseSubscribers","onCancel","onComplete","destroyWidget","baseSubscriber","WidgetOutletComponent_igo_dynamic_outlet_0_Template","WorkspaceStore","activeWorkspace$","activateWorkspace","workspace","deactivateWorkspace","Workspace","widget$","widgetInputs$","widgetSubscribers$","change","Subject","entityStore","hasWidget","deactivateWidget","activateWidget","WorkspaceSelectorComponent","getWorkspaceTitle","onSelectedChange","widget_r2","ngIf","onWidgetCancel","onWidgetComplete","WorkspaceWidgetOutletComponent","WorkspaceWidgetOutletComponent_ng_container_0_Template","TypePermission","null","read","write","ContextService","storageService","exportService","route","context$","contexts$","ours","defaultContextId$","editedContext$","importedContext","toolsChanged$","mapViewFromRoute","baseUrl","defaultContextUri","_defaultContextUri","uri","basePath","contextListFile","readParamsFromRoute","first","handleContextsChange","loadContexts","permissions","getById","getDetails","res","handleError","getDefault","context","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","unshift","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getPath","getLocalContext","mergeMap","base","urlBase","resBase","resMerge","mergeDeep","layers","l","l2","t2","err2","request","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextKey","queryParams","contextParam","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","getContextFromMap","igoMap","ol","getView","proj","getProjection","getCode","center","olPoint","getCenter","getCoordinates","zoom","getZoom","projection","maxZoomOnExtent","viewController","layers$","lay","baseLayer","a","b","zIndex","layer","layerOptions","security","opacity","opts","sourceOptions","queryable","global","getContextFromLayers","extraFeatures","currentLayers","layerFound","contextLayer","layerFoundAs","layerStyle","igoStyle","styleByAttribute","clusterBaseStyle","getSource","olVectorSource","getExtraFeatures","catalogLayer","writer","GeoJSON","olFeatures","Cluster","getFeatures","flatMap","cluster","cleanedOlFeatures","generateFeature","writeFeatures","dataProjection","featureProjection","removeAllAreNotError","contextToLoad","getContextLayers","mapLayers","centerKey","projectionKey","zoomKey","file","permissionError","obj","titleContext","keepCurrentContext","editedContext","findContext","newContext","editedFound","public","found","ExportError","ExportNothingToExportError","setPrototypeOf","ContextExportService","export","exportAsync","nothingToExport","contextJSON","stringify","downloadContent","ImportError","ImportInvalidFileError","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","handleInvalidFileImportError","mimeType","handleSizeFileImportError","sizeMb","handleUnreadbleFileImportError","collectFeaturesFromExtraFeatures","featureCollection","readFeatures","ContextImportService","clientSideFileSizeMax","configFileSizeMb","pow","import","importAsync","getFileImporter","extension","getFileExtension","allowedMimeTypes","allowedExtensions","importFile","importer","onload","parseContextFromFile","onerror","evt","readAsText","fileInput_r2","importFiles","files","loading$","fileSizeMb","layer_r6","e_r5","selectAll","ContextImportExportComponent_form_9_mat_option_18_Template","handleExportFormSubmit","userControlledLayerList","ContextImportExportComponent","contextImportService","contextExportService","contextService","inputProj","forceNaming","layerList","activeImportExport","layers$$","buildForm","showInLayerList","take","onFileImportSuccess","onFileImportError","contextOptions","onFileExportError","onFileExportSuccess","handleFileImportSuccess","handleNothingToImportError","contextTitle","computeLayerTitleFromFile","substr","lastIndexOf","addContextToContextList","success","handleFileImportError","handleFileExportError","handleNothingToExportError","handleFileExportSuccess","onImportExportChange","ContextImportExportComponent_div_8_Template","ContextImportExportComponent_form_9_Template","MatButtonToggleModule","MatDividerModule","prefix","ContextFormComponent","btnSubmitText","_btnSubmitText","handleFormSubmit","removeNull","copyTextToClipboard","Clipboard","copy","uriSplit","ContextFormComponent_span_8_Template","ContextEditComponent","cd","ContextEditComponent_igo_context_form_0_Template","iconImage","favoriteClick","ContextItemComponent_button_1_mat_icon_2_Template","ContextItemComponent_button_1_img_3_Template","auth","default","_r5","save","managePermissions","edit","_r9","_r11","ContextItemComponent_div_5_button_1_Template","ContextItemComponent_div_5_button_4_Template","ContextItemComponent_div_5_button_5_Template","ContextItemComponent_div_5_button_6_Template","ContextItemComponent_div_5_button_7_Template","ContextItemComponent_div_5_button_8_Template","ContextItemComponent_div_5_button_9_Template","canShare","actions_r12","ContextItemComponent","showFavorite","favorite","manageTools","ContextItemComponent_button_1_Template","ContextItemComponent_button_2_Template","ContextItemComponent_div_5_Template","BookmarkDialogComponent","ContextListControlsEnum","always","never","clearFilter","term","ContextListComponent_mat_form_field_2_button_6_Template","accountMenu_r5","user_r7","handleToggleCategory","getPermission","indeterminate","child_r10","ContextListComponent_ng_container_12_ng_template_2_button_6_Template","subAccountMenu_r11","childs","ContextListComponent_ng_container_12_button_1_Template","ContextListComponent_ng_container_12_ng_template_2_Template","withSubMenu_r12","context_r16","selectedContext","_r13","groupContexts_r14","titleMapping","ContextListComponent_ng_template_18_igo_collapsible_0_ng_template_2_Template","context_r18","_r17","contextConfigs","ContextListComponent_ng_template_18_1_ng_template_0_Template","ContextListComponent_ng_template_18_igo_collapsible_0_Template","ContextListComponent_ng_template_18_1_Template","ContextListComponent","contextsInitial","change$$","_contexts","_defaultContextId","showHiddenContexts","filterPermissionsChanged","shared","users","showHidden","_term","sortedAlpha","_sortedAlpha","showContextFilter","thresholdToFilter","isEmpty","debounce","timer","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","totalLength","contextsList","str","toggleSort","parentPermission","childrenPermission","ContextListComponent_mat_form_field_2_Template","ContextListComponent_igo_actionbar_8_Template","ContextListComponent_button_9_Template","ContextListComponent_ng_container_12_Template","ContextListComponent_ng_template_18_Template","ContextListComponent_div_21_Template","KeyValuePipe","scopeChanged","ContextPermissionsComponent_div_0_div_2_mat_radio_button_8_Template","profil_r4","onProfilSelected","ContextPermissionsComponent_div_0_form_3_mat_option_6_Template","auto_r5","displayFn","profils","permission_r7","removePermission","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_button_8_Template","profilTitle","canWrite","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_Template","groupPermissions_r8","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_Template","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_Template","ContextPermissionsComponent_div_0_div_1_Template","ContextPermissionsComponent_div_0_div_2_Template","ContextPermissionsComponent_div_0_form_3_Template","ContextPermissionsComponent_div_0_igo_list_4_Template","ContextPermissionsComponent","_permissions","_profils","baseUrlProfils","UntypedFormControl","formValueChanges$$","addPermission","profilTitleNormalized","ContextPermissionsComponent_div_0_Template","MatRadioModule","ShareMapService","language","lang","getUrlWithApi","formValues","origin","pathname","createContextShared","updateContextShared","getUrlWithoutApi","publicShareOption","visibleOnLayersKey","visibleOffLayersKey","llc","layerlistControls","querystring","visibleKey","invisibleKey","visibleLayers","isIgoInternalLayer","invisibleLayers","layersUrl","layersToLoop","contextLayersID","contextLayers","addedLayersQueryParamsWms","makeLayersByService","addedLayersQueryParamsWmts","addedLayersQueryParamsArcgisRest","addedLayersQueryParamsImageArcgisRest","addedLayersQueryParamsTileArcgisRest","arrayCenter","toFixed","endsWith","typeService","addedLayersByService","layerVersion","linkUrl","encodeURIComponent","addedLayer","datasourceOptions","LAYERS","VERSION","addedLayerPosition","version","operator","definedUrl","addedLayersQueryParams","linkUrlKey","layersKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","linkUrlQueryParams","layersQueryParams","userId","textArea_r4","ShareMapApiComponent","shareMapService","idContextShared","toString","createUrl","rep","showError","textArea","ShareMapApiComponent_span_10_Template","ShareMapApiComponent_button_18_Template","ShareMapApiComponent_button_19_Template","ShareMapApiComponent_div_20_Template","ShareMapUrlComponent_div_14_h4_1_Template","ShareMapUrlComponent_div_14_li_4_Template","ShareMapUrlComponent_div_14_li_6_Template","ShareMapUrlComponent_div_14_li_8_Template","ShareMapUrlComponent_div_14_li_10_Template","ShareMapUrlComponent_div_14_li_12_Template","ShareMapUrlComponent_div_14_h4_14_Template","ShareMapUrlComponent_div_14_li_17_Template","ShareMapUrlComponent_div_14_li_19_Template","ShareMapUrlComponent_div_14_li_21_Template","ShareMapUrlComponent_div_14_li_23_Template","ShareMapUrlComponent","mapState$$","resetUrl","state$","status$","textArea_r2","ShareMapUrlComponent_div_14_Template","ShareMapUrlComponent_igo_custom_html_16_Template","ShareMapComponent","hasApi","ShareMapComponent_mat_tab_group_0_Template","ShareMapComponent_igo_share_map_url_1_Template","MatTabsModule","LayerContextDirective","layerService","styleListService","styleService","context$$","removeLayersOnContextChange","handleContextChange","removeAllLayers","removeLayers","layersAndIndex$","merge","createAsyncLayer","buffer","handleAddLayers","importWithStyle","addImportedFeaturesStyledToMap","distance","getStyleList","resolution","createStyleByAttribute","clusterParam","baseStyle","createStyle","createClusterStyle","ClusterDataSource","addFeatures","FeatureDataSource","VectorLayer","addLayer","addImportedFeaturesToMap","randomStyle","editable","featureKeys","getKeys","featureRandomStyleFunction","featureRandomStyle","createAsyncIdbLayers","computeLayerVisibilityFromUrl","addLayers","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","HttpClientModule","MapContextDirective","viewContext","geolocationController","updateGeolocationOptions","controlsContext","scaleLine","scaleLineOption","minWidth","ContextListBindingDirective","mapService","confirmDialogService","contexts$$","selectedContext$$","defaultContextId$$","previousMessageId","onSelect","onEdit","onSave","getMap","contextFromMap","msgSuccess","onFavorite","messageObj","toastId","onManageTools","onManagePermissions","onDelete","confirm","info","onClone","onCreate","onShowContext","onHideContext","storedContextUri","authenticate","profilsAcc","cur","ContextEditBindingDirective","editedContext$$","submitSuccessed","handleEditedContextChange","ContextPermissionsBindingDirective","onAddPermission","onRemovePermission","onScopeChanged","permissionsArray","ActivityInterceptor","activityService","activity","actReq","finalize","unregister","IgoActivityModule","ActivityService","counter$","ids","AnalyticsService","paq","_paq","provider","initMatomo","g","getElementsByTagName","async","defer","parentNode","setUser","firstName","lastName","trackSearch","nbResults","trackEvent","category","trackLayer","parameters","CONFIG_DEPRECATED","showMenuButton","alternativeKey","mayBeRemoveIn","menuButtonReverseColor","hasGeolocateButton","ALTERNATE_CONFIG_FROM_DEPRECATION","_","deprecatedKey","lib","releaseDate","httpClient","configDeprecated","_isLoaded$","isLoaded$","asObservable","HttpClient","getConfigs","handleDeprecatedConfig","defaultValue","handleDeprecationPossibility","console","warn","baseConfig","path","_reject","log","throwError","configResponse","CONFIG_OPTIONS","InjectionToken","provideConfig","useValue","configFactory","TranslateModule","LanguageLoader","suffix","getTranslation","igoLocale$","isLoaded","appLocale$","forkJoin","translations","LanguageService","language$","getBrowserLang","getLanguage","setDefaultLang","use","reloadLang","IgoMissingTranslationHandler","translateService","langs","TIMEOUT_DURATION","provideTranslation","loader","importProvidersFrom","setTranslationConfig","currentLoader","timeout","defaultLanguage","DEFAULT_LANGUAGE_LOADER","missingTranslationHandler","MissingTranslationHandler","TranslateLoader","defaultLanguageLoader","HttpBackend","Mobile","Tablet","MediaOrientation","Portrait","Landscape","MediaService","orientation$","breakpointObserver","observe","Breakpoints","HandsetLandscape","matches","HandsetPortrait","TabletLandscape","TabletPortrait","WebLandscape","WebPortrait","getOrientation","isTouchScreen","documentElement","TOASTR_CONFIG","positionClass","timeOut","extendedTimeOut","titleClass","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","provideMessage","provideToastr","IgoMessageModule","MessageType","ERROR","ALERT","WARNING","INFO","SUCCESS","SHOW","MessageService","messages$","activeMessageTranslations","r","toastr","toasts","toast","activeMessageTranslation","amt","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","textKey","toastRef","ToastrService","httpError","messageType","toastrConfig","iconClasses","currentDate","to","showIcon","handleTemplate","messageShown","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","mess","Injector","NetworkService","stateChangeEventEmitter","onlineSubscription","offlineSubscription","connection","navigator","onLine","checkNetworkState","fromEvent","emitEvent","reportState","startWith","ROUTE_SERVICE_OPTIONS","RouteService","searchKey","directionsCoordKey","directionsOptionsKey","toolKey","vectorKey","decodeURIComponent","search","pair","SESSION","StorageServiceEventEnum","ADDED","MODIFIED","REMOVED","CLEARED","storageChange$","sessionStorage","TypeCapabilities","wms","wmts","arcgisrest","imagearcgisrest","tilearcgisrest","ArcGISRestCapabilitiesLayerTypes","FeatureLayer","RasterLayer","GroupLayer","CapabilitiesService","parsers","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","baseOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","account","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","legend","parseTileOrImageArcgisOptions","getTileArcgisOptions","legendInfo","HttpParams","fromObject","toUpperCase","_i","findDataSourceInCapabilities","Capability","Layer","metadata","DataURL","abstract","Abstract","keywordList","KeywordList","timeFilter","getTimeFilter","timeFilterable","legendOptions","Style","getStyle","isExtentInGeographic","EX_GeographicBoundingBox","coord","extent","olproj","queryFormat","queryFormatMimeTypePriority","QueryFormatMimeType","GEOJSON","GEOJSON2","GML3","GML2","Request","GetFeatureInfo","Format","keyEnum","QueryFormat","removeUndefined","_layerOptionsFromSource","Title","maxResolution","getResolutionFromScale","MaxScaleDenominator","minResolution","MinScaleDenominator","OnlineResource","extern","minDate","maxDate","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","drawingInfo","EsriStyleGenerator","generateStyle","units","attributions","olAttribution","copyrightText","timeExtent","timeInfo","time","setTime","toUTCString","TimeFilterType","DATETIME","TimeFilterStyle","CALENDAR","maxScale","minScale","description","serviceDescription","sourceFields","queryTitle","displayField","x","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","tslib__WEBPACK_IMPORTED_MODULE_19__","OptionsService","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","authInterceptor","datasources$","createAsyncDataSource","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","removeDuplicateCaseInsensitive","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","d","OSMDataSource","WebSocketDataSource","WFSDataSource","observables","optionsFromApi","optionsMerged","WMSDataSource","WMTSDataSource","XYZDataSource","TileDebugDataSource","CartoDataSource","getArcgisRestOptions","ArcGISRestDataSource","ImageArcGISRestDataSource","TileArcGISRestDataSource","MVTDataSource","createOlSource","getSourceFormatFromOptions","olSourceCluster","generateId","onUnwatch","DataSource","dataService","generateIdFromSourceOptions","getLegend","setLegend","olSourceVector","olFormatCls","formatType","olformat","formatOptions","olSourceOSM","olSourceXYZ","wfsService","ogcFilters","checkWfsParams","fieldNameGeometry","paramsWFS","defaultFieldNameGeometry","ogcFilterWriter","OgcFilterWriter","defineOgcFiltersDefaultOptions","sf","getSourceFieldsFromWFS","pushButtons","selectorType","checkboxes","radioButtons","setOgcFilters","getFormatFromOptions","OlLoadingStrategy","triggerEvent","notify","tileGrid","createDefaultTileGrid","olSourceWMTS","mapLabel","queryHtmlTarget","QueryHtmlTarget","BLANK","crossOrigin","olSourceCarto","htmlString","types","oneType","cartocss","colors","j","layer_name","esrijsonFormat","olFormatEsriJSON","overlaps","customParams","bind","olloadingstrategy","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","stroke","strokeWidth","outlineColor","outline","fill","renderingRule","ImageArcGISRest","ratio","layerId","TileGrid","TileDebug","ws","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onopen","onOpen","featureAdded","readFeature","featureToRemove","getFeatureById","getId","removeFeature","addFeature","mvtFormat","featureClass","olFormatMVT","olSourceVectorTile","olSourceTileArcGISRest","DataService","WFSService","dataSourceOptions","defineFieldAndValuefromWFS","getfeatureSourceField","sourcefield","alias","wfsGetFeature","nb","defaultMaxFeatures","epsgCode","defaultEpsg","propertyName","forceDefaultOutputFormat","formatWFSQueryString","outputFormat","gmlRegex","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","concatMap","allowGml","firstFeature","getGeometryName","processingArray","maxFeatures","chunkSize","srsName","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","timeFilter$","sourceParams","dpi","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","download","dynamicUrl","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","advancedOgcFilters","calendarModeYear","filterQueryString","handleOgcFiltersAppliedValue","FILTER","updateParams","timeFilterableDataSourceOptions","setTimeFilter","igoRefresh","random","asWFSDataSourceOptions","olSourceImageWMS","scale","projParam","contentDependent","contentDependentLegend","separator","currentStyle","defaultWfsVersion","buildUrl","randomParam","queryStringValues","igoFilters","filterOrBox","buildFilter","geometryName","filterOrPush","xmlFilter","epsg","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","featureTypes","paramMaxFeatures","cnt","srs","valueReference","fieldsNames","getFeature","getpropertyvalue","wfsDataSourceOptions","srcType","wfsOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","projectionExtent","getExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","printDirections","DirectionsButtonsComponent","directionsService","activeRoute","routesFeatureStore","contextUri","zoomToActiveRoute$","stopsStore","stepFeatureStore","clearStops","addStop","addStopToStore","getUrl","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","summary","formatDistance","formatDuration","duration","wayPointsCnt","stop","stopText","roundCoordTo","coordinates","toLocaleString","localCnt","instruction","formatStep","formatInstruction","maneuver","modifier","bearing_after","exit","pos","routingOptions","directionsKey","stopsCoordinates","directionsUrl","downloadDirection","DirectionsButtonsComponent_button_5_Template","DirectionsButtonsComponent_button_8_Template","DirectionsButtonsComponent_button_10_Template","DirectionsButtonsComponent_button_12_Template","DirectionsButtonsComponent_button_14_Template","stop_r2","clearStop","result_r5","DirectionsInputsComponent_div_1_mat_optgroup_9_mat_option_1_Template","source_r6","removeStop","DirectionsInputsComponent_div_1_div_10_button_5_Template","onStopEnter","onStopLeave","stopIsDragged","onInputFocus","setStopText","DirectionsInputsComponent_div_1_button_6_Template","chooseProposal","DirectionsInputsComponent_div_1_mat_optgroup_9_Template","DirectionsInputsComponent_div_1_div_10_Template","getNgClass","getPlaceholder","auto_r8","stopWithHover","getOptionText","searchProposals","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopsFeatureStore","coordRoundedDecimals","stopInputHasFocus","unlistenMapSingleClick","geomCoord","geom","geometry","point","pointOnFeature","validateTerm","keyIsValid","extra","relativePosition","DirectionRelativePositionType","Intermediate","removeStopFromStore","drop","moveStops","previousIndex","currentIndex","fromIndex","toIndex","stops","moveItemInArray","computeRelativePosition","updateStoreSorting","listenMapSingleClick","once","clickCoordinates","olProj","coordinate","roundedCoord","olObservable","DirectionsInputsComponent_div_1_Template","CdkDropList","CdkDrag","CdkDragHandle","direction_r4","cnt_r5","changeRoute","activeDirection","DirectionsResultsComponent_div_0_mat_form_field_1_mat_option_6_Template","directions","step_r7","showSegment","cnt_r8","cssClass","image","DirectionsResultsComponent_div_0_mat_form_field_1_Template","DirectionsResultsComponent_div_0_mat_divider_2_Template","onStepsListBlur","DirectionsResultsComponent_div_0_mat_list_item_8_Template","DirectionsResultsComponent","activeFeatureWithDirection","zoomToExtent","showRouteSegmentGeometry","vertexId","lastPoint","olGeom","olFeature","geojsonGeom","OlGeoJSON","writeGeometryObject","previousVertex","FEATURE","DirectionType","Vertex","getGeometry","DirectionsResultsComponent_div_0_Template","DirectionsSource","onTogglePrivateModeControl","enabledProfileHasAuthorization","DirectionsComponent","directionsSourceService","searchService","queryService","hasOsrmPrivateAccess","twoSourcesAvailable","zoomRoute$$","storeEmpty$$","storeChange$$","routesQueries$$","selectStopInteraction","translateStop","selectedRoute","focusOnStop","isTranslating","previousStops","searchs$$","authenticated$$","authenticated$","directionControlIsActive","queryEnabled","interactions","sources","getEnabledProfile","authorization","profileWithAuth","getProfileWithAuthorization","profiles","initEntityStores","initStopsFeatureStore","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","u","freezeStores","interaction","removeInteraction","FeatureStoreLoadingStrategy","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","olInteraction","hitTolerance","dragging","executeStopTranslation","olCondition","Route","selectCoordinates","mapBrowserEvent","addedStop","addInteraction","onStopInputHasFocusChange","getLength","getArray","translatedStopId","translationCoordinates","translatedStop","distinctUntilChanged","storeInitialized$","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","diff","ChangeUtils","findChanges","stopIdToProcess","modified","changedStop","newValue","response","stringToLonLat","researches","isCoord","lonLat","searchType","requests$","sp","ProposalType","Coord","Text","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","addDirectionToRoutesFeatureStore","addStopToStopsFeatureStore","onToggleDirectionsControl","profile","DirectionsComponent_mat_slide_toggle_4_Template","CommonModule","MatSlideToggleModule","DirectionsSourceService","directionsSourceServiceFactory","provideDirectionsSourceService","DirectionsFormat","SourceDirectionsType","Trip","Stop","Start","End","DirectionsService","printService","directionsOptions","routeSource","_this","activityId","doc","jsPDF","orientation","unit","pageWidth","pageHeight","internal","margins","addAttribution","imageDimensions","align","addMap","PrintLegendPosition","none","_ref","_asyncToGenerator","status","SubjectStatus","Done","addInstructions","setPageHeaderFooter","returnPromise","_x","apply","arguments","attributionText","getAttributionText","verticalSpacing","setFontSize","setHTMLTableContent","_this2","directionsInstruction","table","tblBody","cellImage","cellText","img","span","appendChild","spanDistance","verticalAlign","append","_this3","matListItem","iconsArray","iconName","iconCanvas","html2canvas","toDataURL","formattedDirection","_this4","addPage","HTMLtable","autoTable","startY","titlePosition","margin","top","bottom","columnStyles","cellWidth","theme","fontSize","didDrawCell","cell","section","raw","addImage","y","pageCount","getNumberOfPages","now","logo","setPage","getHeight","getWidth","baseline","getCurrentPageInfo","pageNumber","DOCUMENT","positions","maxPosition","insertPosition","lastPosition","stopToUpdate","computeStopsPosition","stopsToComputePosition","directionsStyle","vertexStyle","olStyle","radius","stopStyle","createOverlayMarkerStyle","markerColor","markerOutlineColor","routeStyle","loadingStrategy","motion","FeatureMotion","stopsLayer","linkedLayers","linkId","links","syncedDelete","linkedIds","exportable","browsable","tryBindStoreLayer","tryAddLoadingStrategy","routeLayer","stepLayer","stopColor","previousStop","stopFeatureStore","stopOpacity","moveToExtent","previousRoute","routeFeatureStore","NumberUtils","roundToNDecimal","round","hour","minute","stepPosition","lastStep","directive","translatedDirection","translateBearing","bearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","StopsStore","StopsFeatureStore","FeatureStore","RoutesFeatureStore","StepFeatureStore","property_r3","openSecureUrl","getEmbeddedLinkText","FeatureDetailsComponent_table_0_tr_2_td_1_Template","FeatureDetailsComponent_table_0_tr_2_td_2_Template","FeatureDetailsComponent_table_0_tr_2_td_3_Template","FeatureDetailsComponent_table_0_tr_2_td_4_Template","FeatureDetailsComponent_table_0_tr_2_td_5_Template","FeatureDetailsComponent_table_0_tr_2_td_6_Template","FeatureDetailsComponent_table_0_tr_2_td_7_Template","FeatureDetailsComponent_table_0_tr_2_td_8_Template","isObject","isEmbeddedLink","isDoc","FeatureDetailsComponent_table_0_tr_2_Template","filterFeatureProperties","htmlSanitizer","urlSanitizer","FeatureDetailsComponent","networkService","unsubscribe$","ready","_source","_feature","selectFeature","routeEvent","htmlDisplayEvent","takeUntil","bypassSecurityTrustResourceUrl","isHtmlDisplay","URL","docOrImage","fileUrl","createObjectURL","div","getAttribute","allowedFieldsAndAlias","offlineButtonState","forcedOffline$","excludeAttributeOffline","attribute","excludeAttribute","FeatureDetailsComponent_table_0_Template","FeatureDetailsComponent_iframe_1_Template","JsonPipe","FeatureDetailsDirective","feature$","routingEvent","setFeature","bindClicking","routeElement","addEventListener","FEATURE_DETAILS_DIRECTIVES","FeatureFormComponent","igoForm","formDataToFeature","entry","startsWith","propertyPrefix","bindLayer","Move","Zoom","featureToOl","projectionOut","OlFormatGeoJSON","setId","mapTitle","renderFeatureFromOl","olRenderFeature","projectionIn","olLayer","exclude","excludeOffline","olFormat","geometryType","getType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","featureFromOl","idColumn","getRevision","computeOlFeaturesExtent","olextent","featureExtent","computeOlFeatureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","scaleExtent","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","featuresAreTooDeepInView","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","moveToOlFeatures","getOlProjection","hideOlFeature","setStyle","olstyle","computeOlFeaturesDiff","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","FeatureStoreInMapResolutionStrategy","stores$$","resolution$$","empty$$","watchStore","updateEntitiesInResolution","getResolution","unwatchStore","unwatchAll","resolution$","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","states$$","updateEntitiesPropertiesState","pairwise","prevLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","so","LAYER","potentialLayerId","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingLayerStrategy","onSourceChanges","setStoreOlFeatures","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","searchDocument","FlexSearchDocument","tokenize","skipWhile","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","n","propertiesToIndex","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","clearLayer","olSource","removeOlFeaturesFromLayer","addOlFeaturesToLayer","setLayerExtent","viewProjection","setExtent","tryAddSelectionStrategy","FeatureStoreSelectionStrategy","FeatureStoreInMapExtentStrategy","updateEntitiesInExtent","inMapExtent","entitiesInMapExtent","getFeaturesInExtent","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","OlDragSelectInteraction","OlDragBoxInteraction","mapClickListener","olDragSelectInteraction","olDragSelectInteractionEndKey","overlayStore","_overlayStore","createOverlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","onMapClick","unByKey","ctrlKeyDown","getFeaturesAtPixel","pixel","layerFilter","onSelectFromMap","olInteractions","getInteractions","onDragBoxEnd","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","removeLayer","OgcFilterOperatorType","BasicNumericOperator","Basic","BasicAndSpatial","Spatial","Time","OgcFilterOperator","BBOX","PropertyIsBetween","Contains","During","PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","Intersects","PropertyIsNull","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsLike","PropertyIsNotEqualTo","Within","And","Or","Not","filterSequence","operators","spatial","fieldRestrict","ogcFiltersOptions","ogcFiltersDefaultValue","ourBboxFilter","enableBbox","filterAssembly","olfilter","checkIgoFiltersProperties","bundleFilter","featureNS","featurePrefix","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","logical","filterOptions","wfsPropertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","wfsEnd","end","wfsExpression","expression","olFormatWKT","readGeometry","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","copyDeep","selectorGroup","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","interfaceOgcFilters","formatProcessedOgcFilter","enableds","list","selectorBundle","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","parseDateOperation","isValid","operationSplitted","leftOperand","rightOperand","rightUnitOperand","endOf","subtract","DATE","TIME","YEAR","SLIDER","DrawControl","start$","end$","changes$","modify$","select$","abort$","freehand$","ispredefinedRadius$","predefinedRadius$","radiusDrawEnd$","keyDown$$","olGeometryType","olInteractionStyle","olMap","olDrawingLayer","olDrawInteraction","olSelectInteraction","olModifyInteraction","onDrawStartKey","onDrawEndKey","onDrawAbortKey","onDrawKey","mousePosition","radiusVal","radiusValData","radiusCercle","olDrawingLayerSource","drawingLayer","createOlInnerOverlayLayer","interactionStyle","setOlMap","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","OlDraw","maxPoints","freehand","stopClick","freehandCondition","onDrawStart","onDrawEnd","OlModify","OlSelect","doubleClick","unsubscribeKeyDown","olGeometryEvent","getMousePositionFromOlGeometryEvent","subscribeKeyDown","removeLastPoint","finishDrawing","abortDrawing","ModifyControl","olOverlayLayer","onModifyStartKey","onModifyEndKey","onModifyKey","olModifyInteractionIsActive","olTranslateInteraction","onTranslateStartKey","onTranslateEndKey","onTranslateKey","olTranslateInteractionIsActive","olDrawInteractionIsActive","drawKeyUp$$","drawKeyDown$$","removedOlInteractions","olLinearRingsLayer","olOuterGeometry","olOverlaySource","olLinearRingsSource","modify","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","OlFeature","createDrawHoleInteractionStyle","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStart","onModifyEnd","subscribeToKeyDown","unsubscribeToKeyDown","OlTranslate","deactivateTranslateInteraction","onTranslateStart","onTranslateEnd","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","olLinearRing","OlLinearRing","addLinearRingToOlPolygon","newCoordinates","getLinearRings","setCoordinates","createDrawInteractionStyle","olPolygon","appendLinearRing","olEvent","computeMVTOptionsOnHover","vectorTileLayerOptions","hoverStyle","LayerDBService","ngxIndexedDBService","dbName","layerDBData","subject","getByID","dbObject","customUpdate","deleteRequest","deleteByKey","isDeleted","object","getAll","LayerService","dataSourceService","geoNetworkService","layerDBService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","ImageLayer","TileLayer","igoLayer","handleLegacyStyles","igoStyleObject","idbInfo","storeToIdb","parseStyle","serviceStyle","geoDBService","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","VectorTileLayer","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","layersOptions","idbl","ImageWatcher","valStatus","olLoadingProblem","createOlLayer","olOptions","olLayerImage","setImageLoadFunction","tile","customLoader","setMap","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","Uint8Array","TextDecoder","Blob","imageUrl","send","TileWatcher","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","vectorTile","olLayerVectorTile","vectorTileSource","getFormat","onLoad","setLoader","failure","responseText","responseXML","DOMParser","parseFromString","readProjection","LinkedProperties","OPACITY","VISIBLE","OGCFILTERS","MINRESOLUTION","MAXRESOLUTION","ZINDEX","TIMEFILTER","TooltipType","TITLE","ABSTRACT","CUSTOM","legendCollapsed","firstLoadComponent","hasBeenVisible$","hasBeenVisible$$","getZIndex","setZIndex","setOpacity","isInResolutionsRange","isInResolutionsRange$","setMaxResolution","Infinity","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","visible$","m","showOnEachLayerVisibility","showMessage","displayed","displayed$","maxScaleDenom","minScaleDenom","unobserveResolution","observeResolution","previousLoadExtent","previousLoadResolution","previousOgcFilters","xhrAccumulator","trackFeatureListenerId","VectorWatcher","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","preload","bypassResolution","bypassVisible","flash","firstLoad","maintainFeaturesInIdb","trackFeature","enableTrackFeature","vector","olLayerVector","vectorSource","customWFSLoader","idbLoader","customIDBLoader","maintainOptionsInIdb","removeLayerFromIDB","zip","olStyleToBasicIgoStyle","layerOlStyle","getFill","getColor","getStroke","circle","layerData","insertEvent","dsFeatures","geojsonObject","InsertSourceInsertDBEnum","User","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","elapsed","elapsedRatio","easeOut","newColor","ColorAsArray","getStyleFunction","style2","styleClone","getRadius","setRadius","setColor","setWidth","setText","drawGeometry","render","stopAnimation","un","centerMapOnFeature","feat","setCenter","disableTrackFeature","wfsProj","olProjection","code","currentExtent","removeLoadedExtent","alteredUrl","nbOfFeature","delay","content","layerID","Watcher","loaded","loading","watch","handleLoadStart","handleLoadEnd","handleLoadError","unwatch","__watchers__","Working","watcherIndex","params_","baseLayersSwitcherSlideInOut","overflow","baseLayer_r3","baseLayers","expand","i_r4","useStaticIcon","showButton","collapseOrExpand","BaseLayersSwitcherComponent_div_0_div_1_Template","BaseLayersSwitcherComponent_div_0_igo_mini_basemap_3_Template","BaseLayersSwitcherComponent_div_0_div_4_Template","hasMoreThanTwo","BaseLayersSwitcherComponent","_baseLayers","arrayLayers","mapZoom","bl","maxZoom","minZoom","blHidden","BaseLayersSwitcherComponent_div_0_Template","MiniBaseMapComponent","changeBaseLayer","MiniBaseMapComponent_div_1_div_2_Template","basemap","appRef","_display","changed","_baseLayer","handleBaseLayerChanged","IgoMap","handleMainMapViewChange","olView","tick","mainMapView","mainMapViewProperties","setResolution","setRotation","rotation","baselayer","handleLinkedBaseLayer","link","linkedId","layerToApply","linkedLayerOptions","showInMiniBaseMap","MiniBaseMapComponent_div_1_Template","MapBrowserComponent","onGeolocationClick","tracking","icon$","GeolocateButtonComponent","tracking$$","_map","ngAfterContentInit","tracking$","GeolocateButtonComponent_div_0_Template","HomeExtentButtonComponent","extentOverride","centerOverride","zoomOverride","homeExtentButtonExtent","homeExtentButtonCenter","homeExtentButtonZoom","computeHomeExtent","homeExtentButtonOptions","homeExtButtonExtent","homeExtButtonCenter","homeExtButtonZoom","onToggleClick","zoomTo","infoContent","InfoSectionComponent","InfoSectionComponent_div_0_Template","status$$","_view","updateView","_controls","updateControls","handleStatusChange","MapCenterComponent","displayCenter$$","mapCenter$","getElementById","visibility","letZoom","deltaY","zoomOut","zoomIn","MenuButtonComponent","sidenavOpened","_sidenavOpenend","getClassMenuButton","openSidenav","useThemeColor","menuButtonClass","configValue","onToggleSidenavClick","OfflineButtonComponent","btnStyle","handleButtonStyle","resetRotation","rotated$","azimuthRounded","rotationRounded","currentStyle$","RotationButtonComponent","showIfNoRotation","rotation$","radians","deg","PI","bearingToAzimuth","RotationButtonComponent_div_0_Template","MapController","observerKeys","getOlMap","GeolocationOverlayType","Position","PositionDirection","Accuracy","Buffer","MapGeolocationController","arrowRotation","subscriptions$$","geolocationOverlay","positionFeatureStyle","accuracyFeatureStyle","bufferStyle","bufferStroke","bufferFill","textAlign","offsetX","offsetY","font","showBufferRadius","bufferRadius","arrowStyle","points","displacement","rotateWithView","geolocation","emissionIntervalSeconds$","position$","followPosition$","_buffer","handleFeatureCreation","accuracyThreshold","_accuracyThreshold","olGeolocation","getTracking","setTracking","followPosition","_followPosition","deleteGeolocationFeatures","deleteFeatureByType","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","interval","updateArrowFeatureOrientation","position4326","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","setGeometry","addOlFeature","bufferFeature","bufferFeatureExists","bufferGeometry","edgeRatios","areOutOfView","MapViewController","maxLayerZoomExtent","extent$","extent$$","states","stateIndex","stateHistory","setPadding","right","left","onMoveEnd","monitorRotation","getRotation","calculateExtent","getSize","getScale","getScaleFromResolution","getUnits","cancelAnimations","easing","oleasing","MapViewAction","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","fit","isFinished","setState","viewStatesAreEqual","HoverFeatureDirective","pointerHoverFeatureStore","store$$","selectionLayer","selectionMVT","mvtStyleOptions","pointerMoveListener","singleClickMapListener","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","mapProjection","listenToMapPointerMove","subscribeToPointerStore","hoverFeatureMarkerStyle","renderMode","declutter","olVectorTileSource","createHoverStyle","localHoverStyle","hasLabelStyle","textBaseline","backgroundFill","backgroundStroke","unlistenToMapPointerMove","unsubscribeToPointerStore","unlistenToMapSingleClick","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","getLayerByOlUId","ol_uid","canProcessHover","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","myLayerVectorTile","setSource","then","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","getOrientedFlatCoordinates","coords","flatCoords","idx","parseFloat","getLinkedLayersOptions","getIgoLayerByLinkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","layerHasLinkWithProperty","hasLinkWithProperty","layerLLOptions","currentLinkId","parents","pl","getDirectChildLayersByProperty","lid","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","getRootParentByDeletion","getDirectParentLayerByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","initLayerSyncFromRootParentLayers","rootLayersByProperty","plbp","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","PointerPositionDirective","pointerPositionDelay","pointerPositionCoord","onPointerEvent","lonlat","MapService","LayerWatcher","propertyChange$","unwatchLayer","setPropertyChange","watchLayer","layer$$","Waiting","layersAddedByClick$","queryResultsOverlay","searchResultsOverlay","swipeEnabled$","selectedFeatures$","bufferDataSource","layerWatcher","mapViewOptions","defaultOptions","attribution","projectionCode","olproj4","proj4","olControlAttribution","olControlScaleLine","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","pc","viewOptions","constrainResolution","getControls","removeControl","getBaseLayers","setMinZoom","setMaxZoom","getLayerById","getLayerByAlias","olUId","getLayerByOlLayer","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","newLayers","layersToRemove","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","clbd","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","_layer","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","conf","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","convertDMSToDD","epsgUtm","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","decimal","lonLatDMS","ceil","int","state1","state2","tolerance","trunc","formatScale","inchesPerMeter","originalEvent","altKey","MAC","metaKey","ctrlKey","roundCoordToString","lonLatConversion","projections","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZone","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZone","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","MapOfflineDirective","initialOnline","forcedOffline","online","handleLayersOnlineState","handleNonOfflinableLayerResolution","offlinableByUrlSourceOptions","pathOffline","setUrl","ProjectionService","registerProjection","def","lon0","defs","zoneMtm","lonMin","deltaLon","zoneUtm","computeProjectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","detectFileEPSG","nbLines","geojson","crs","lines","line","SwipeControlComponent","pos1","pos3","inDragAction","swipeEnabled$$","boundPrerender","prerender","getListOfLayers","displaySwipe","displaySwipeOff","swipeId","postrender","dragDown","clientX","mouseSwipe","onmouseup","closeDragMouseElement","touches","touchSwipe","ontouchend","closeDragTouchElement","offsetLeft","changedTouches","onmousemove","ontouchmove","mapSize","tl","getRenderPixel","tr","br","beginPath","moveTo","lineTo","closePath","clip","restore","WakeLockButtonComponent","noSleep","NoSleep","userAgent","satisfies","ie","edge","chrome","firefox","opera","safari","disableWakeLock","enableWakeLock","toggleWakeLock","ZoomButtonComponent","getMinZoom","getMaxZoom","MeasureFormatPipe","unitAbbr","out","MeasureAreaUnit","squareMetersToUnit","MeasureLengthUnit","metersToUnit","formatMeasure","measureLengthUnit","Meters","Kilometers","Miles","Feet","area","measureAreaUnit","SquareMeters","SquareKilometers","SquareMiles","Acres","Hectares","perimeter","MeasurerDialogComponent","onNoClick","MeasurerDialogComponent_table_4_Template","MeasurerDialogComponent_table_5_Template","measureUnit_r1","MeasurerItemComponent","measure$","measure$$","measureType","measureUnit","measure","auto","toggleAutoUnit","_auto","measureUnitChange","measureUnits","MeasureType","Area","onMeasureUnitChange","computeBestMeasureUnit","computeBestAreaUnit","Length","computeBestLengthUnit","MeasurerItemComponent_mat_option_8_Template","onToggleDisplayLines","displayLines","onToggleDisplayDistance","displayDistance","onToggleDisplayAreas","displayAreas","onLengthUnitChange","activeLengthUnit","measure_r7","measureUnitsAuto","activeMeasureType","onAreaUnitChange","activeAreaUnit","MeasurerComponent_ng_container_29_igo_measurer_item_1_Template","MeasurerComponent_ng_container_29_igo_measurer_item_2_Template","onCalculateClick","onDeleteClick","MeasurerComponent","tableTemplate","hasLine$","hasArea$","showTooltips","drawControlIsDisabled","drawLineControl","drawPolygonControl","modifyControl","activeOlGeometry","onFeatureAddedKey","onFeatureRemovedKey","activeDrawControl","drawStart$$","drawEnd$$","drawChanges$$","modifyStart$$","modifyEnd$$","modifyChanges$$","selectedFeatures$$","olDrawSource","setActiveMeasureType","_activeMeasureType","minSegmentLength","drawControlIsActive","getSavedUnits","createDrawLineControl","createDrawPolygonControl","createModifyControl","toggleDrawControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleDrawControl","deactivateDrawControl","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","elements","getElementsByClassName","saveCurrentUnits","refreshTableAndTooltip","updateTooltipsOfOlGeometry","sum","openDialog","selectedFeature","drawingLayerFeature","onModifyClick","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","createMeasureLayerStyle","many","updateMeasureOfOlGeometry","objectsExists","objectExist","createMeasureInteractionStyle","OlStyle","activateDrawControl","drawControl","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","addFeatureToStore","measureOlGeometry","onModifyChanges","_measure","featureId","lengths","olMidpointsTooltips","updateOlTooltipsAtMidpoints","updateOlTooltip","updateOlTooltipAtCenter","showTooltipsOfOlGeometry","getTooltipsOfOlGeometry","olTooltip","shouldShowTooltip","addOverlay","removeOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","distanceUnit","areaUnit","MeasurerComponent_mat_divider_13_Template","MeasurerComponent_mat_slide_toggle_15_Template","MeasurerComponent_mat_divider_17_Template","MeasurerComponent_mat_slide_toggle_20_Template","MeasurerComponent_mat_slide_toggle_22_Template","MeasurerComponent_mat_divider_24_Template","MeasurerComponent_ng_container_29_Template","MeasurerComponent_mat_divider_31_Template","MeasurerComponent_button_35_Template","MeasurerComponent_button_38_Template","MeasureLengthUnitAbbreviation","SquareFeet","MeasureAreaUnitAbbreviation","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","conversion","val","parts","minimumFractionDigits","maximumFractionDigits","converted","possibleUnits","lineDash","measureOlGeometryLength","olGetLength","measureOlGeometryArea","olGetArea","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","expectedNumber","clearOlMidpointTooltip","typeGeom","createOlTooltipAtPoint","setPosition","olCenter","updateOlGeometryCenter","centerCoordinate","olGetCenter","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","srcGeomType","OlOverlay","stopEvent","System","GeoDBService","collisionsMap","_newData","compression","Compression","regionID","insertSource","compress","geoDBData","object$","compressBlob","compressed","currentRegionID","collisions","decompressBlob","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","DBMode","readonly","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","newData","GeoNetworkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","setFeatures","removeOlFeature","addOlFeatures","removeFeatures","overlayDataSource","createOverlayLayerStyle","jsGeoPdfPlugin","jsPDFAPI","setGeoArea","pdfExt","geoExt","bbox","minx","maxx","maxy","miny","bounds","bbox_obj","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","toLocaleDateString","events","bbox_id","PrintService","zipFile","nbFileToProcess","mapPrintExtent","imgSizeAdded","TEXTPDFFONT","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","legendPostion","legendPosition","GeoPdfPlugin","API","baseMargins","titleSizes","subtitleSizes","subtitle","PrintPaperFormat","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","addTextInPdfDoc","marginLeft","comment","addComment","handleFooter","addGeoRef","handleMeasureLayer","showNorthArrow","northArrowCanvas","createNorthDirectionArrow","addNorthArrowInDoc","addLegendSamePage","addLegend","saveDoc","docHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","addCanvas","getLayersLegendHtml","legends","getLayersLegends","legendUrls","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","toPromise","canvas","useCORS","catch","removeHtmlElement","generateCanvaFileToZip","saveCanvasImageAsFile","removeChild","fontStyle","setFont","textMarginLeft","textDimensions","getTextDimensions","w","h","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","showProjection","showScale","getProjScale","htmlAttribution","getOverlayContainerStopEvent","cloneNode","textProjScale","scaleText","mapScale","_this5","imageSize","pourcentageReduction","imgData","_this6","marginsLegend","defineNbFileToProcess","ms","getImageSizeToFitPdf","rect","_this7","viewResolution","dimensionPixels","setMapResolution","_ref2","mapCanvas","getViewport","mapResultCanvas","drawMap","resetOriginalMapSize","drawMapControls","mapStatus$$","mapStatus","_x2","initialSize","widthPixels","heightPixels","scaling","updateSize","renderSync","_this8","handleCanvas","mapContextResult","getContext","parentElement","globalAlpha","matrix","CanvasRenderingContext2D","setTransform","fillStyle","fillRect","drawImage","mapOverlayHTML","canvasOverlayHTML","allowTaint","ignoreElements","HTMLElement","arrawCanvas","northArrowDimension","_this9","maxWidth","maxHeight","downloadMapImage","printResolution","_this10","initialMapSize","_ref3","addLegendToImage","newCanvas","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","fileNameWithExt","tfwFileNameWithExt","substring","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","_x3","setMapImageResolution","scaleFactor","newMapSize","_this11","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","renderMap","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","that","toBlob","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","PrintOutputFormat","strEnum","PrintOrientation","PrintResolution","PrintSaveImageFormat","QueryDirective","queries$$","queryFeatures","queryFeaturesHitTolerance","queryFeaturesCondition","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","layerIsQueryable","query$","clickedFeatures","featureOL","values_","queryFormatAsWms","newFeature","nom","id_","sourceTitle","getAllowedFieldsAndAlias","OlRenderFeature","getQueryTitle","olLayerFeatureIsQueryable","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","ESRIJSON","TEXT","HTMLGML2","IFRAME","QueryService","defaultFeatureCount","featureCount","previousMessageIds","queryLayer","getQueryUrl","urlGml","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","olgeom","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","o","lower","upper","imposedGeometry","queryDataSource","extractGML3Data","extractGeoJSONData","extractEsriJSONData","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","order","searchParams","bboxRaw","threshold","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","bodyTagStart","bodyTagEnd","striptags","queryString","pairs","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","tileArcGISRestDatasource","deltaX","mime","getLabelMatch","labelMatch","labelToGet","matchAll","layerFeatureIsQueryable","queryLayerFeatures","onClearButtonClick","handleSearch","onSearchTypeChange","searchTypes","searchType$","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","onSearchSettingsChange","pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","SearchBarComponent","searchSourceService","placeholder$","term$$","stream$","stream$$","searchType$$","researches$$","showSearchButton","SEARCH_TYPES","withDivider","setSearchType","setTerm","term$","_reverseSearchCoordsFormatEnabled","floatLabel","appearance","termSplitter","minLength","searchSelector","searchSettings","searchTermChange","searchTypeChange","clearFeature","searchSettingsChange","input","onSetTerm","handlePlaceholder","onSetSearchType","onKeyup","doSearch","reverseCoordEvent","slug","getEnabledSources","ss","rawTerm","terms","research","onResearchCompleted","newResults","SearchBarComponent_mat_label_3_Template","SearchBarComponent_button_10_Template","SearchBarComponent_mat_divider_12_Template","SearchBarComponent_button_14_Template","SearchBarComponent_igo_search_selector_15_Template","SearchBarComponent_igo_search_settings_16_Template","SearchSelectorComponent","SearchSettingsComponent","layer_r2","SaveFeatureDialogComponent","filteredLayers$","SaveFeatureDialogComponent_mat_option_13_Template","auto_r3","SearchResultsItemComponent","onMouseEvent","computeTooltip","isPreview$","getBadgeIcon","inRange$","isVisible$","addFeatureToLayer","addFeatureToLayerTooltip$","SearchResultAddButtonComponent","layersSubcriptions","mouseInsideAdd","saveSearchResultInLayer","allLayers","dataType","isVisible","currEvent","addLayerToMap","removeLayerFromMap","oLayer","activeStore","layerTitle","Circle","Stroke","Fill","layerCounterID","numberId","searchLayer","clearLabelsOfOlGeometry","SearchResultAddButtonComponent_button_0_Template","SearchResultAddButtonComponent_button_1_Template","MatBadgeModule","showIcons","tooltipHtml","SearchResultsItemComponent_ng_template_3_span_0_Template","onZoomHandler","withZoomButton","zoomEvent","olFormatGeoJSON","hideBtn","setAttribute","showBtn","SearchResultsItemComponent_mat_icon_1_Template","SearchResultsItemComponent_div_2_Template","SearchResultsItemComponent_ng_template_3_Template","SearchResultsItemComponent_button_6_Template","normalTitle_r4","group_r2","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_ng_container_1_Template","computeGroupTitle","storeItemTemplate_r4","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_ng_container_0_Template","result_r6","resultFocus","resultUnfocus","onResultSelect","templateSearchToolbar","displayMoreResults","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_ng_template_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_span_1_Template","results_r8","isMoreResults","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_Template","searchResultMode","Grouped","flatTemplate_r9","SearchResultsComponent_igo_list_0_ng_template_1_Template","results$","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_ng_container_1_Template","group_r10","storeItemTemplate_r11","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_Template","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_ng_container_0_Template","group_r12","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_Template","result_r14","group_r16","SearchResultsComponent_igo_list_1_ng_template_6_ng_template_0_Template","SearchResultsComponent_igo_list_1_ng_template_6_span_1_Template","SearchResultsComponent_igo_list_1_ng_container_1_Template","SearchResultsComponent_igo_list_1_ng_template_2_Template","SearchResultsComponent_igo_list_1_ng_template_4_Template","SearchResultsComponent_igo_list_1_ng_template_6_Template","tabsTemplate_r17","flatTemplate_r18","SearchResultMode","Flat","SearchResultsComponent","showResultsCount","settingsChange$$","pageIterator","tabsMode","settingsChange$","resultSelect","moreResults","resultMouseenter","resultMouseleave","_results$","liftResults","EMPTY","groupResults","sortByOrder","r1","r2","displayOrder","grouped","sourceResults","limit","nextPage","SearchResultsComponent_igo_list_0_Template","SearchResultsComponent_igo_list_1_Template","NgTemplateOutlet","searchType_r2","getSearchTypeTitle","enableSourcesByType","SearchSelectorComponent_mat_radio_button_9_Template","searchSelectorMenu_r4","checkUncheckAllSources","searchSourcesAllEnabled","sub_menu_r6","source_r5","settingValue_r8","setting_r9","settingsValueCheckedRadioButton","getAvailableHashtagsValues","SearchSettingsComponent_ng_container_8_ng_container_7_span_6_mat_radio_button_2_Template","checkUncheckAll","allEnabled","settingValue_r12","settingsValueCheckedCheckbox","displayBlock","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_div_1_Template","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_div_2_Template","getAvailableValues","SearchSettingsComponent_ng_container_8_ng_container_7_span_6_Template","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_Template","test_sub_menu_r13","onCheckSearchSource","SearchSettingsComponent_ng_container_8_button_3_Template","SearchSettingsComponent_ng_container_8_button_4_Template","SearchSettingsComponent_ng_container_8_ng_container_7_Template","settings","_r14","changePointerReverseSearch","hasPointerReverseSearchSource","lastKeyTime","searchSourceChange","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","getSources","sourceCanSearch","showInSettings","reverseSearchSources","sourceCanReverseSearch","computeSourcesCheckAllBehavior","sourceCanReverseSearchAsSummary","setting","settingValue","setParamFromSetting","computeSettingCheckAllBehavior","enabledSourcesCnt","disabledSourcesCnt","storage","hashtags","changeSearchResultsGeometry","reverseSearchCoordsFormat","SearchSettingsComponent_div_7_Template","SearchSettingsComponent_ng_container_8_Template","SearchSettingsComponent_mat_slide_toggle_12_Template","searchSettingsMenu_r15","NgSwitch","NgSwitchCase","SearchPointerSummaryDirective","pointerSearchStore","reverseSearch$$","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","mouseleave","pointerPositionSummaryMarkerStyle","ngAfterContentChecked","unsubscribeReverseSearch","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","pointerSummaryTitle","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","reverseSearch","_results","onSearch","pointerSummary","SearchSourceService","setWorkspaces","workspaces","SearchService","analyticsService","searchTerm","signal","analytics","handleAnalytics","effect","termIsValid","getEnabledOnly","searchSources","asPointerSummary","reverseSourceFonction","showInPointerSummary","findDiff","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","delta","SearchSource","getDefaultOptions","searchUrl","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","fw","datasets","saveInStorage","confValue","storageOptions","getHashtagsValid","settingsName","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","_converters","_renderers","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertPointToPixel","_transformColor","_getResolutionForScale","mpu","_transformAngle","angle","weight","family","verticalAlignment","horizontalAlignment","xoffset","yoffset","_convertOutline","ol3Rad","radius2","_convertLabelingInfo","labelingInfo","mapUnits","ii","labelExpression","getText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","hash","layerInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","customStyle","isValidJSON","cos","StyleService","olStyles","svgIconColor","svgOutlineColor","newOutlineColor","anchor","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","parsedStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","guessTypeFeature","labelStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","image_","radiusCalc","generateWMSIdFromSourceOptions","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","generateArcgisRestIdFromSourceOptions","osm","tiledebug","chain","standardizeUrl","urlStandardized","IgoDirectionsModule","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","year","years","getFullYear","month","getMonth","day","getUTCDate","getUTCHours","getUTCMinutes","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","setOgcWMSFiltersOptions","filtered","SpatialFilterType","Predefined","Polygon","SpatialFilterItemType","Address","Thematics","SpatialFilterService","urlFilterList","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","getKeyByValue","loadFilterList","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","DownloadButtonComponent_button_0_Template","item_r2","toggleLegendItem","legend_r4","computeItemTitle","style_r6","onChangeStyle","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_mat_option_4_Template","onLoadImage","imgGraphValue","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_img_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_small_2_Template","imagesHeight","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_mat_list_item_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_Template","noItems_r8","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_Template","items_r9","LayerLegendComponent_ng_container_0_ng_container_1_Template","LayerLegendComponent_ng_container_0_ng_template_2_Template","LayerLegendComponent","updateLegendOnResolutionChange","legendItems$","renderedLegends","lastlLegend","listStyles","STYLES","onViewControllerStateChange","getLegendGraphic","obsLegGraph","leg","transfertToggleLegendItem","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegend","LayerLegendComponent_ng_container_0_Template","WktService","wktToFeature","wkt","wktProj","featureProj","olWKT","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","array","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","OGCFilterTimeService","defaultStepMillisecond","currentFilter","stepMillisecond","asMilliseconds","stepIsYearDuration","months","weeks","days","hours","stepIsMonthDuration","stepIsWeekDuration","week","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","dateToNumber","newDate","addStep","toDate","subtractStep","OgcFilterTimeSliderComponent","ogcFilterTimeService","changeProperty","slider","sliderValue","calculatedStep","_defaultDisplayFormat","_defaultSliderInterval","playIcon","resetIcon","sliderInterval","displayFormat","beginMillisecond","maxMillisecond","sliderDisplayWith","calculateStep","handleSliderInput","dateTmp","toAdd","playFilter","stopFilter","_emitInputEvent","resetFilter","matSliderChange","dateBeginTmp","dateEndTmp","toISOString","refreshFilter","startOf","MatSlider","ngSlider_r2","ngSliderThumb_r3","MatSliderModule","sliderMode","modeChange","changePropertyByPass","beginValue","restrictedToStep","endValue","beginDatepicker_r5","yearOnlyInputChange","yearSelected","endDatepicker_r6","toggleFilterState","onlyYearBegin","filterStateDisable","calendarView","handleDate","onlyYearEnd","hour_r11","minute_r12","begin_r8","changeTemporalProperty","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_12_Template","beginHourFormControl","beginHours","beginMinuteFormControl","beginMinutes","hour_r17","minute_r18","end_r14","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_12_Template","endHourFormControl","endHours","endMinuteFormControl","endMinutes","endDatepicker_r15","monthSelected","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_Template","filterEndFunction","calendarType","beginDatepicker_r9","OgcFilterTimeComponent_div_3_div_2_div_10_Template","OgcFilterTimeComponent_div_3_div_2_div_11_Template","filterBeginFunction","OgcFilterTimeComponent_div_3_div_1_Template","OgcFilterTimeComponent_div_3_div_2_Template","calendarTypeYear","OgcFilterTimeComponent","_beginValue","_endValue","_defaultMin","_defaultMax","_defaultSliderModeEnabled","ogcFilterOperator","endDatepickerTime","beginDatepickerTime","beginTime","endTime","filterOriginConfig","stepMilliseconds","parseFilter","handleMin","handleMax","getUTCFullYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","isNaN","intervalInt","_now","getDateFromStringWithoutTime","valueTmp","getDateTime","dateStringFromYearNotime","changeEvent","datePicker","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","setHours","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","getHours","fullEndHoursArray","fullBeginMinutesArray","getMinutes","fullEndMinutesArray","beginTmp","endTmp","restrictToStep","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","OgcFilterTimeComponent_mat_slide_toggle_1_Template","OgcFilterTimeComponent_div_2_Template","OgcFilterTimeComponent_div_3_Template","field_r3","clearSelectedField","inputClearable","updateFieldsList","changeField","OgcFilterFormComponent_mat_form_field_14_mat_option_10_Template","OgcFilterFormComponent_mat_form_field_14_button_12_Template","autoCompleteField_r5","selectedField$","filteredFields$","operator_r6","igoSpatialSelector_r8","changeSpatialSelector","OgcFilterFormComponent_mat_form_field_28_mat_option_2_Template","igoSpatialSelectors","value_r10","clearProperty","updateValuesList","OgcFilterFormComponent_mat_form_field_30_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_30_button_7_Template","autoCompleteValues_r12","detectProperty","filteredValues$","isClearable","changeSNRC","OgcFilterFormComponent_mat_form_field_36_button_3_Template","changeMapExtentGeometry","OgcFilterFormComponent_ng_container_38_button_1_Template","value_r17","_r18","changeNumericProperty","OgcFilterFormComponent_mat_form_field_41_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_41_button_7_Template","autoDualValueOperator1_r19","value_r21","OgcFilterFormComponent_mat_form_field_42_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_42_button_7_Template","autoDualValueOperator2_r23","_r24","OgcFilterFormComponent","wktService","allOgcFilterOperators","ogcFilterOperators$","inputOperator","fields$","currentFilterIsSpatial$","refreshFilters","_snrc","activeFilters","sFields","excludeFromOgcFilters","sfs","currentFilterIsSpatial","_filterFields","_filterValues","keywordRegex","detectedProperty","deleteFilter","changeLogical","changeOperator","changeCaseSensitive","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterFormComponent_mat_form_field_14_Template","OgcFilterFormComponent_mat_option_25_Template","OgcFilterFormComponent_mat_form_field_28_Template","OgcFilterFormComponent_mat_form_field_30_Template","OgcFilterFormComponent_mat_form_field_36_Template","OgcFilterFormComponent_ng_container_38_Template","OgcFilterFormComponent_mat_form_field_41_Template","OgcFilterFormComponent_mat_form_field_42_Template","OgcFilterFormComponent_igo_ogc_filter_time_43_Template","_c4","DOMService","getDomValuesFromURL","domOptions","selectorGroup_r3","currentPushButtonsGroup","OgcFilterSelectionComponent_div_1_div_1_div_2_mat_option_4_Template","getPushButtonsGroups","ogcPushButton_r5","selector_r6","getToolTip","getButtonColor","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_mat_button_toggle_4_Template","bundle_r7","bundleIsVertical","OgcFilterSelectionComponent_div_1_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_Template","selectorGroup_r9","currentCheckboxesGroup","OgcFilterSelectionComponent_div_1_div_2_div_2_mat_option_4_Template","getCheckboxesGroups","ogcCheckbox_r11","displayLessResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_1_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_2_Template","isLessResults","bundle_r14","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_Template","OgcFilterSelectionComponent_div_1_div_2_div_2_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_Template","selectorGroup_r16","currentRadioButtonsGroup","OgcFilterSelectionComponent_div_1_div_3_div_2_mat_option_4_Template","getRadioButtonsGroups","emptyRadioButtons","ogcRadioButton_r19","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_1_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_2_Template","bundle_r22","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_4_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_5_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_Template","unfiltered","OgcFilterSelectionComponent_div_1_div_3_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_Template","selectorGroup_r24","currentSelectGroup","OgcFilterSelectionComponent_div_1_div_4_div_2_mat_option_4_Template","getSelectGroups","_r25","emptySelect","_r26","selectAllSelected","toggleAllSelection","bundle_r28","selectOptionClick","ogcSelect_r29","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_option_5_Template","_r30","ogcSelect_r31","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_mat_option_1_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_Template","notMulti_r32","OgcFilterSelectionComponent_div_1_div_4_div_2_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_Template","autocompleteGroup_r34","currentAutocompleteGroup","OgcFilterSelectionComponent_div_1_div_5_div_2_mat_option_4_Template","getAutocompleteGroups","_r35","emptyAutocomplete","autocompleteEnabled_r38","_r37","toggleSelection","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_chip_set_3_mat_chip_1_Template","autocompleteEnableds","ogcAutocomplete_r40","_r39","toggleAutocompleteOption","checkedStatus","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_chip_set_3_Template","onInputChange","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_option_8_Template","bundle_r42","filteredOgcAutocomplete","tmp_10_0","showChips","auto_r41","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_Template","OgcFilterSelectionComponent_div_1_div_5_div_2_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_Template","OgcFilterSelectionComponent_div_1_div_1_Template","OgcFilterSelectionComponent_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_Template","OgcFilterSelectionComponent_div_1_div_4_Template","OgcFilterSelectionComponent_div_1_div_5_Template","OgcFilterSelectionComponent_div_2_h3_2_Template","OgcFilterSelectionComponent_div_2_h3_3_Template","_r43","OgcFilterSelectionComponent","ogcFilterService","domService","sel","matAutocomplete","checkboxesIndex","radioButtonsIndex","baseIndex","_currentFilter","inputChangeAutocomplete","selectEnabled$","selectEnableds$","autocompleteEnableds$","applyFiltersTimeout","ogcFiltersSelectors","ogcSelector","patchValue","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","compSelect","applyFilters","selectEnableds","filterList","autocompleteFilter","selectMulti","initSelectEnabled","getSelectDomValues","initAutocompleteEnableds","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","dom","toolTip","domSelectors","domValues","domSelector","filterDOM","newBundle","comp","configDom","domValue","computedSelector","pushButton","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","toggledFilter","enabledFilter","currentGroups","currentGroup","selectorsLength","MatAutocompleteTrigger","OgcFilterSelectionComponent_div_1_Template","OgcFilterSelectionComponent_div_2_Template","i16","MatChipsModule","i17","refreshFunc","currentFilter_r2","OgcFilterableFormComponent_1_ng_template_0_Template","OgcFilterableFormComponent","MAT_SELECT_CONFIG","overlayPanelClass","MAT_AUTOCOMPLETE_DEFAULT_OPTIONS","OgcFilterableFormComponent_igo_ogc_filter_selection_0_Template","OgcFilterableFormComponent_1_Template","toggleFiltersCollapsed","ogcFilters_r3","filtersCollapsed","toggleLegendOnClick","addFilterToSequence","addFilterDisabled","inResolutionRange$","OgcFilterableItemComponent_div_9_igo_layer_legend_2_Template","showLegend$","changeOgcFilterType","OgcFilterableItemComponent","lastRunOgcFilter","defaultLogicalParent","hasActiveSpatialFilter","filtersAreEditable","hasSelector","arr","lastLevel","firstFieldName","includedFields","firstOperatorName","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","toggleLegend","OgcFilterableItemComponent_mat_icon_2_Template","OgcFilterableItemComponent_span_3_Template","OgcFilterableItemComponent_button_5_Template","OgcFilterableItemComponent_button_6_Template","OgcFilterableItemComponent_div_9_Template","OgcFilterableItemComponent_section_11_Template","OgcFilterButtonComponent_div_1_igo_ogc_filterable_item_2_Template","ogcFilterCollapse","OgcFilterButtonComponent","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","cntRadioButtons","radio","cntSelect","cntAutocomplete","filterActiveValue","OgcFilterButtonComponent_button_0_Template","OgcFilterButtonComponent_div_1_Template","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","layer_r1","OgcFilterableListComponent","OgcFilterableListComponent_div_1_Template","OgcFilterableListComponent_ng_template_3_Template","OgcFilterableListBindingDirective","GeometryType","LineString","LabelType","Coordinates","Custom","CoordinatesUnit","DecimalDegree","DegreesMinutesSeconds","DrawIconService","icons","getIconsList","getIcons","createInteractionStyle","Olstyle","DDtoDMS","numVal","FontType","Arial","ArialBlack","Verdana","Tahoma","TrebuchetMS","Impact","TimesNewRoman","Georgia","AmericanTypewriter","Courier","LucidaConsole","BrushScriptMT","ComicSansMS","handleChange","handleClick","colorPicker","ColorPickerFormFieldComponent","isOpen","formatColor","onTouch","colorChange","writeValue","registerOnChange","fn","registerOnTouched","rgb","tinycolor","toHexString","toRgbString","toHsvString","NG_VALUE_ACCESSOR","forwardRef","ColorPickerFormFieldComponent_ng_template_5_Template","trigger_r4","CdkOverlayOrigin","CdkConnectedOverlay","ColorChromeModule","DrawStyleService","labelsAreShown","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","getFontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","textToShow","textIgoStyleObject","flatCoordinates","fontSelect_r2","StyleModalDrawingComponent","drawStyleService","confirmFlag","styleModalData","linestringOnly","buildStyleData","getFeatureFillColor","getFeatureStrokeColor","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureOffsetX","getFeatureOffsetY","cancelDrawing","openPicker","closePicker","StyleModalDrawingComponent_ng_container_6_Template","StyleModalDrawingComponent_mat_option_28_Template","DrawLayerPopupComponent","labelString","input_r2","onLabelTypeChange","option_r4","optionAvailable","getProperLengthLabel","DrawPopupComponent_ng_container_3_mat_radio_group_14_mat_radio_button_1_Template","arrayBuiltInType","option_r6","DrawPopupComponent_ng_container_3_ng_container_15_mat_checkbox_1_Template","unit_r8","onChangeCoordinateUnit","DrawPopupComponent_ng_container_3_div_16_mat_option_8_Template","currentCoordinates","coordinatesMeasureUnit","allCoordinatesUnits","unit_r10","getLengthUnitEnum","onChangeLengthUnit","DrawPopupComponent_ng_container_3_div_17_mat_option_8_Template","lengthLabelT","currentLength","lengthMeasureUnit","allLengthUnits","unit_r12","getAreaUnitEnum","onChangeAreaUnit","DrawPopupComponent_ng_container_3_div_18_mat_option_10_Template","currentArea","areaMeasureUnit","allAreaUnits","DrawPopupComponent_ng_container_3_mat_radio_group_14_Template","DrawPopupComponent_ng_container_3_ng_container_15_Template","DrawPopupComponent_ng_container_3_div_16_Template","DrawPopupComponent_ng_container_3_div_17_Template","DrawPopupComponent_ng_container_3_div_18_Template","customOrPredefined","labelType","labelFlag","polygonCheck","noLabelButton","getLabelLength","input_r14","currentLabel","DrawPopupComponent","lengthInMeters","areaInMetersSquare","coordinatesInDD","currentCoordinatesUnit","longlatDD","labelLength","longitudeLatitude","longitude","latitude","point4326","circularPolygon","buildArrayType","lengthUnit","coordinatesUnit","selectOptions","currentOption","DrawPopupComponent_ng_container_3_Template","DrawPopupComponent_ng_container_4_Template","DrawShorcutsComponent","svgIcon","MatDialogClose","onToggleFreehandMode","freehandMode","measureUnit_r5","DrawComponent_div_23_mat_option_6_Template","radiusFormControl","layer_r7","activeDrawingLayer","deleteDrawings","icon_html_r12","onIconChange","DrawComponent_mat_form_field_44_div_6_Template","DrawComponent_mat_form_field_44_mat_option_10_Template","openStyleModalDialog","DrawComponent","drawIconService","_stores","drawControls","_drawControls","_activeDrawingLayer","activeLayerChange","drawControlsEvent","layersIDEvent","draw$","activeDrawingLayerSource","drawSelect$$","fillForm","strokeForm","radiusFormControlChange$$","Subscription","numberOfDrawings","isCreatingNewLayer","currGeometryType","draw","editLabelDrawing","dc","onLayerChange","createDrawControl","changeRadius","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","extent4326","getDistance","setupLayer","onToggleLabels","selectionChange","olGeometryFeature","openShorcutsDialog","elementStyle","toggleIsChecked","isCircle","currLayer","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","updateActiveLayer","isPoint","isLineString","isPolygon","radiusMeters","pointStyle","selectedMeasureUnit","MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS","hideSingleSelectionIndicator","DrawComponent_mat_slide_toggle_22_Template","DrawComponent_div_23_Template","selectedLayer_r6","DrawComponent_mat_option_32_Template","DrawComponent_button_36_Template","DrawComponent_button_39_Template","DrawComponent_mat_form_field_44_Template","DrawComponent_button_50_Template","GeometryFormFieldInputComponent","olGeoJSON","defaultDrawStyleRadius","olGeometryEnds$$","olGeometryChanges$$","createMeasureTooltip","activeControl","_geometryType","deactivateControl","freehandDrawIsActive","toggleControl","drawGuide","_drawControlIsActive","_freehandDrawIsActive","predefinedRadius","_predefinedRadius","controlOptions","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","overlayStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","onTouched","updateDrawStyleWithDrawGuide","activateControl","onOlGeometryEnds","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","GeometryFormFieldInputComponent_ng_template_0_Template","onDrawControlChange","onfreehandControlChange","SpatialFilterItemComponent_div_7_mat_option_6_Template","bufferFormControl","measureUnit_r7","SpatialFilterItemComponent_div_8_mat_option_6_Template","onItemTypeChange","item_r9","masterToggle","isAllSelected","selectedThematics","hasValue","node_r12","onToggleChange","isSelected","node_r14","childrensToggle","treeControl","isExpanded","hasChildrenSelected","SpatialFilterItemComponent_div_14_mat_header_cell_3_Template","SpatialFilterItemComponent_div_14_mat_header_cell_5_Template","SpatialFilterItemComponent_div_14_mat_header_row_6_Template","SpatialFilterItemComponent_div_14_mat_row_7_Template","SpatialFilterItemComponent_div_14_mat_tree_node_9_Template","SpatialFilterItemComponent_div_14_mat_nested_tree_node_10_Template","displayedColumns","hasChild","clearSearch","disabledClearSearch","clearDrawZone","toggleVisibleList","SpatialFilterItemComponent_div_28_button_1_Template","entityChange","listIsVisible","SpatialFilterItemComponent","spatialFilterService","geometryTypes","drawGuide$","drawStyle$","PointStyle","PolyStyle","overlayStyle$","queryType","_store","thematicLength","_thematicLength","toggleSearch","itemTypeChange","thematicChange","drawZoneEvent","bufferEvent","zoneWithBufferChange","radiusEvent","freehandControl","clearButtonEvent","clearSearchEvent","openWorkspace","selectedItemType","selectedSourceAddress","NestedTreeControl","node","childrens","thematics","MatTreeNestedDataSource","SelectionModel","value$","value$$","radiusChanges$$","bufferChanges$$","geometryTypeField","drawGuideField","drawGuidePlaceholder","drawZone","zoneWithBuffer","localeCompare","limits","child","featureGeom","selectedRecordStrategy","selectionStrategy","detach","isPredefined","collapse","numSelected","numNodes","bool","selectedThematicsName","nodeSelected","toggleSearchButton","createTableTemplate","clearButton","disableSearchButton","formValue","typeColumn","nameColumn","SpatialFilterItemComponent_mat_slide_toggle_5_Template","SpatialFilterItemComponent_mat_slide_toggle_6_Template","SpatialFilterItemComponent_div_7_Template","SpatialFilterItemComponent_div_8_Template","SpatialFilterItemComponent_mat_radio_button_13_Template","SpatialFilterItemComponent_div_14_Template","SpatialFilterItemComponent_button_16_Template","SpatialFilterItemComponent_button_17_Template","SpatialFilterItemComponent_button_27_Template","SpatialFilterItemComponent_div_28_Template","MatTreeModule","entities_r2","measureUnit_r3","SpatialFilterListComponent","_queryType","_zone","selectedZone","zoneChange","bufferChange","bufferValueChanges$$","onZoneChange","SpatialFilterListComponent_mat_option_10_Template","SpatialFilterListComponent_mat_option_22_Template","auto_r4","queryType_r1","SpatialFilterTypeComponent","selectedTypeIndex","spatialType","activeDrawType","selectedQueryType","eventType","eventQueryType","onTypeChange","onDrawTypeChange","SpatialFilterTypeComponent_mat_option_8_Template","handleDateChange","datetimePicker_r3","startDate","endDate","minDatetimePicker_r5","getRangeMaxDate","maxDatetimePicker_r6","getRangeMinDate","TimeFilterFormComponent_div_0_div_1_Template","TimeFilterFormComponent_div_0_div_2_Template","isRange","year_r8","handleYearChange","TimeFilterFormComponent_div_1_div_1_mat_option_4_Template","listYears","startYear_r10","endYear_r11","startYear","TimeFilterFormComponent_div_1_div_2_mat_option_5_Template","endYear","TimeFilterFormComponent_div_1_div_2_mat_option_10_Template","startListYears","endListYears","TimeFilterFormComponent_div_1_div_1_Template","TimeFilterFormComponent_div_1_div_2_Template","ngSlider_r13","ngSliderThumb_r14","handleSliderYearChange","TimeFilterFormComponent_div_3_p_9_Template","playYear","handleSliderValue","handleSliderDateChange","ngSlider_r16","ngSliderThumb_r17","handleSliderTooltip","TimeFilterFormComponent","initStartYear","initEndYear","valueArray","valueOf","yearChange","mySlider","getStepDefinition","timeInterval","getTimezoneOffset","is","checkFilterValue","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","setSliderThumbLabel","thumbLabel","findThumbLabel","childNodes","textContent","newMinDateNumber","maxDateNumber","getRoundedDate","toDateString","toTimeString","setSeconds","setMinutes","getDay","selectedHour","selectedMinute","atMinute","coeff","TimeFilterFormComponent_div_0_Template","TimeFilterFormComponent_div_1_Template","TimeFilterFormComponent_div_3_Template","TimeFilterFormComponent_div_4_Template","MatDatetimepickerModule","TimeFilterItemComponent_mat_list_item_0_button_5_Template","filters_r5","TimeFilterItemComponent","timeFilterService","TimeFilterItemComponent_mat_list_item_0_Template","TimeFilterItemComponent_igo_layer_legend_5_Template","TimeFilterButtonComponent_div_1_igo_time_filter_item_2_Template","timeFilterCollapse","TimeFilterButtonComponent","TimeFilterButtonComponent_button_0_Template","TimeFilterButtonComponent_div_1_Template","TimeFilterListComponent","_layers","TimeFilterListComponent_ng_template_1_Template","TimeFilterListBindingDirective","ExportButtonComponent","layerIsExportable","workspaceId","ExportButtonComponent_button_0_Template","StyleListService","styleList","baseStyleList","styleListResponse","ExportInvalidFileError","ExportFormat","EncodingFormat","ExportService","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon","ogreUrl","aggregateInComment","gpxAggregateInComment","encoding","exportOlFeatures","excludePrefix","generateAggregatedFeature","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","featuresText","fileName","encodingType","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","fromCharCode","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","ImportSRSError","ImportOgreServerError","padTo2Digits","num","padStart","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","addLayerAndFeaturesToMap","searchIndexEnabled","handleSRSImportError","handleOgreServerImportError","ImportService","importConfig","clientSideFileSizeMaxMb","formats","formatExtensionAssociation","zipMimeTypes","allowedZipMimeTypes","importFileWithOgre","parseFeaturesFromFile","FormData","parseFeaturesFromGeoJSON","errMsg","msg","writeFeatureObject","projection_r4","translateKey","ImportExportComponent_form_8_mat_option_7_p_1_Template","ImportExportComponent_form_8_mat_option_7_p_2_Template","ImportExportComponent_form_8_mat_option_7_Template","fileInput_r5","importForm","projections$","invalid","importHtmlClarifications","ImportExportComponent_section_9_div_1_Template","ImportExportComponent_section_9_igo_custom_html_2_Template","layer_r9","onlySelectedClick","inLayersIdToExportSelectionOnly","onlySelected","ImportExportComponent_form_12_mat_option_10_mat_slide_toggle_4_Template","layerHasSelectedFeatures","format_r10","ImportExportComponent_form_12_ng_container_18_mat_option_1_Template","formats$","encoding_r11","ImportExportComponent_form_12_div_23_ng_container_6_mat_option_1_Template","encodings$","ImportExportComponent_form_12_div_23_ng_container_6_Template","exportHtmlClarifications","ImportExportComponent_form_12_span_9_Template","ImportExportComponent_form_12_mat_option_10_Template","ImportExportComponent_form_12_ng_container_18_Template","ImportExportComponent_form_12_mat_option_20_Template","ImportExportComponent_form_12_div_22_Template","ImportExportComponent_form_12_div_23_Template","ImportExportComponent_form_12_div_24_Template","ImportExportComponent_form_12_div_25_Template","ImportExportComponent_form_12_div_26_Template","ImportExportComponent_form_12_igo_custom_html_36_Template","getLayerTitleById","exportableLayers$","combineLayers","ImportExportComponent","importService","controlFormat","exportableLayers$$","formats$$","encodings$$","formLayer$$","exportOptions$$","espgCodeRegex","projectionsConstraints","popupChecked","previousLayerSpecs$","selectFirstProj","_projectionsLimitations","computeProjections","selectedMode","selectMode","exportOptions$","exportOptionsChange","popupAllowed","loadConfig","exportOptions","computeFormats","handlePopup","handlePreviousLayerSpecs","selectedLayers","previousSpecs","encodings","configProjection","getWorkspaceByLayerId","wksFromLayerId","wksFromLayer","layersWithSelection","specs","previousLayer","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","extraMessage","forceNamingConfig","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","validateListFormat","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","ImportExportComponent_form_8_Template","ImportExportComponent_section_9_Template","ImportExportComponent_section_10_Template","ImportExportComponent_form_12_Template","i18","i19","i20","i21","check","layerCheck","toggleVisibility","eyeTooltip","queryBadgeHidden$","toggleLayerTool","LayerItemComponent","activeLayer","_activeLayer","selectionMode","layerTool$","tooltipText","_selectAll","network$$","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","updateQueryBadge","onResolutionChange","layerTooltip","layerMetadata","inResolutionRange","LayerItemComponent_mat_checkbox_1_Template","LayerItemComponent_button_5_Template","LayerItemComponent_button_6_Template","LayerItemComponent_button_7_Template","LayerItemComponent_igo_layer_legend_10_Template","LayerLegendItemComponent","toggleShowAllLegends","showAllLegendsValue","layer_r3","LayerLegendListComponent_ng_template_6_igo_layer_legend_item_0_Template","excludeBaseLayers","LayerLegendListComponent","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegend","allowShowAllLegends","allLegendsShown","computeShownLayers","shownLayers","sortLayersByZindex","LayerLegendListComponent_mat_slide_toggle_1_Template","LayerLegendListComponent_mat_divider_3_Template","LayerLegendListComponent_ng_template_6_Template","LayerLegendListComponent_p_8_Template","LayerLegendListComponent_p_12_Template","LayerLegendListComponent_p_16_Template","LayerLegendListComponent_p_20_Template","LayerLegendListBindingDirective","layersOrResolutionChange$$","layersVisibility$$","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","onlyVisible$$","sortAlpha$$","layersAreAllVisible","onlyVisible","sortAlpha","appliedFilterAndSort","keyword","toggleSortAlpha","toggleOnlyVisible","toggleSelectionMode","LayerListToolComponent_button_4_Template","LayerListControlsEnum","LayerListSelectVisibleEnum","ALL_VISIBLE","ALL_HIDDEN","MIXED","NULL","LayerListDisplacement","Raise","Lower","onAppliedFilterAndSortChange","layerFilterAndSortOptions","selectAllCheck","layersChecked","layersCheck","layer_r5","getLowerLayer","getUpperLayer","expandLegendOfVisibleLayers","layerItemChangeDetection$","LayerListComponent_ng_template_6_igo_layer_item_0_Template","zoomLayerExtents","LayerListComponent_igo_panel_8_button_2_Template","moveActiveLayer","layerListDisplacement","ngSlider_r8","ngSliderThumb_r9","changeOpacity","LayerListComponent_igo_panel_8_button_24_Template","isLayerRemovable","opacityMenu_r11","badgeOpacity","activeLayerExtentIsValid","templateLayerToolbar","checkOpacity","zoomLayersExtents","LayerListComponent_igo_panel_9_mat_slider_30_Template","LayerListComponent_igo_panel_9_button_31_Template","isAllLayersRemovable","statusSelectedLayersCheck","lowerDisabledSelection","raiseDisabledSelection","opacityMenu_r15","activeLayersExtentAreValid","LayerListComponent","thresholdToFilterAndSort","showToolbar$","layerTool","hideSelectedLayers","activeLayer$","ogcButton","timeButton","removeProblemLayerInList","_keyword","_onlyVisible","isUpperBaselayer","isLowerBaselayer","raisableLayers","lowerableLayers","layersCheckedOpacity","toggleOpacity","selectAllCheck$","selectAllCheck$$","computeShowToolbar","computeLayers","checks","showButtonZoomToExtent","layerExtent","layersExtent","clearKeyword","prev","actiontype","fromUi","sortedLayersToMove","layersToMove","mapIndex","currentLayer","raisableLayer","layersToRaise","checkItems","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","onKeywordChange","showToolbar","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordInList","removable","statusSelectedLayers","findTrue","findFalse","eventMapIndex","elemSource","layersList","LayerListComponent_igo_layer_list_tool_0_Template","LayerListComponent_div_2_Template","LayerListComponent_ng_template_6_Template","LayerListComponent_igo_panel_8_Template","LayerListComponent_igo_panel_9_Template","LayerListBindingDirective","setLayersVisibilityStatus","visibles","allLayersAreVisible","toggleTrackFeature","TrackFeatureButtonComponent","TrackFeatureButtonComponent_button_0_Template","MetadataService","openMetadata","MetadataButtonComponent","metadataService","MetadataAbstractComponent","MetadataButtonComponent_button_0_Template","MetadataAbstractComponent_mat_dialog_content_4_Template","MetadataAbstractComponent_mat_dialog_content_5_Template","QuerySearchSource","querySearchSourceFactory","IgoQueryModule","IgoSearchBarModule","IgoSearchResultsModule","IgoSearchSelectorModule","IgoSearchSettingsModule","searchSourceServiceFactory","provideSearchSourceService","GoogleLinks","getGoogleMapsCoordLink","getGoogleStreetViewLink","getGoogleMapsNameLink","encodeURI","OsmLinks","getOpenStreetMapLink","getOpenStreetCamLink","CoordinatesSearchResultFormatter","formatResult","CoordinatesReverseSearchSource","title$","dataToResult","dataDMS","roundedCoordString","roundedCoordStringDMS","subtitleHtml","circleGeometry","polygonGeometry","writeGeometry","GoogleMaps","GoogleStreetView","OpenStreetMap","score","coordinates_CoordinatesReverseSearchSource","SearchSourceKind","ICherche","IChercheReverse","Cadastre","CoordinatesReverse","ILayer","Nominatim","StoredQueries","StoredQueriesReverse","defaultCoordinatesSearchResultFormatterFactory","ICHERCHE_ICONS","city","bank","engine","hospital","pharmacy","parking","tree","terrain","IChercheSearchResultFormatter","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","hashtagsLieuxToKeep","getAllowedTypes","ecmax","showAdvancedParams","showAdvancedSettings","computeRequestParams","getSearch","extractResults","typeSetting","regex","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","computeProperties","highlight","title2","subtitleHtml2","title3","removeKeys","propertiesBlacklist","googleLinksProperties","googleMaps","googleMapsNom","municipalite","routing","keep","cacheHasher","customCacheHasher","IChercheReverseSearchSource","getReverseSearch","getSubtitle","computeExtent","defaultIChercheSearchResultFormatterFactory","provideDefaultIChercheSearchResultFormatter","ichercheSearchSourceFactory","withIChercheSource","kind","icherche_IChercheReverseSearchSource","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","metadataUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayer_ILayerSearchSource","IgoSearchModule","setLayerFillColor","StyleModalLayerComponent","initialValues","defaultValues","getLayerFillColor","getLayerStrokeColor","arrayColor","cAA","setLayerStrokeColor","StyleModalLayerComponent_ng_container_7_Template","StyleModalLayerButtonComponent","OgcFilterComponent","IgoOgcFilterModule","OgcFilterWidget","ogcFilterWidgetFactory","widgetService","provideOgcFilterWidget","IgoWorkspaceSelectorModule","IgoGeoWorkspaceModule","CatalogItemType","Group","TypeCatalog","baselayers","composite","Catalog","externalProvider","forcedProperties","matrixSet","requestEncoding","regFilters","groupImpose","groupSeparator","tooltipType","sortDirection","setCrossOriginAnonymous","showLegend","WMSCatalog","_collectCatlogItems","collectCatalogItems","WMTSCatalog","BaselayersCatalog","ArcGISRestCatalog","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","baseLayersCatalog","catalogsFromApi$","catalogs","_response","loadCatalogItems","catalog","newCatalog","CatalogFactory","createInstanceCatalog","loadCatalogBaseLayerItems","getCatalogBaseLayersOptions","loadCatalogWMSLayerItems","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","loadCatalogWMTSLayerItems","getWMTSItems","loadCatalogArcGISRestItems","getArcGISRESTItems","loadCatalogCompositeLayerItems","compositeCatalog","catalogsFromInstance","request1$","request2$","flatDeepLayer","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","output","recursiveGroupByLayerAddress","keyFn","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","returnProperty","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","baseSourceOptions","propertiesToForce","baseAbstract","layerOnlineResource","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","subLayerIds","groupHandledLayersIds","groupedItems","TitleOrId","nonHandledLayers","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","catalogService","igoLayer$","CatalogBrowserLayerComponent","isPreview$$","layerLegendShown$","catalogAllowLegend","addedChange","addedLayerIsPreview","computeTitleTooltip","askForLegend","haveGroup","CatalogBrowserLayerComponent_mat_icon_1_Template","CatalogBrowserLayerComponent_button_5_Template","CatalogBrowserLayerComponent_igo_layer_legend_21_Template","CatalogBrowserGroupComponent_button_6_mat_icon_1_Template","onLayerPreview","onLayerAddedChange","item_r7","CatalogBrowserGroupComponent_ng_template_14_ng_container_0_Template","CatalogBrowserGroupComponent_ng_template_14_ng_container_1_Template","isGroup","isLayer","CatalogBrowserGroupComponent","added$","preview$","toggleCollapsed","layerAddedChange","evaluateAdded","evaluateDisabled","onToggleCollapsed","tryToggleGroup","onTitleClick","CatalogBrowserGroupComponent_button_6_Template","CatalogBrowserGroupComponent_ng_container_7_Template","CatalogBrowserGroupComponent_ng_template_10_Template","CatalogBrowserGroupComponent_ng_template_14_Template","notadded_r8","onGroupAddedChange","item_r3","toggleCollapsedGroup","CatalogBrowserComponent_ng_template_1_ng_container_0_Template","CatalogBrowserComponent_ng_template_1_ng_container_1_Template","CatalogBrowserComponent","currentItems","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","sortCatalogItemsByTitle","returnItem","titleA","titleB","CatalogBrowserComponent_ng_template_1_Template","predefinedCatalog_r2","predefinedCatalog_r3","type_r5","ctx_r5","addedCatalog","emailAddress","AddCatalogDialogComponent","defaultAddedCatalogType","addedCatalogType$$","predefinedCatalogsList$","typeCapabilities","predefinedCatalogs","storeViewAll$$","computePredefinedCatalogList","changeUrlOrTitle","addCatalog","AddCatalogDialogComponent_mat_option_11_Template","AddCatalogDialogComponent_mat_option_18_Template","AddCatalogDialogComponent_mat_option_23_Template","AddCatalogDialogComponent_span_24_Template","AddCatalogDialogComponent_span_25_Template","auto2_r7","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","CatalogLibaryItemComponent_mat_icon_4_Template","CatalogLibaryItemComponent_button_5_Template","CatalogLibaryItemComponent_button_6_Template","catalog_r2","onCatalogRemove","onCatalogSelect","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","submitDisabled","addingCatalog$$","addedCatalogs","selectedCatalogId","selectedCatalog","getCatalogs","unsubscribeAddingCatalog","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","CatalogLibaryComponent_ng_template_1_Template","CatalogLibaryComponent_div_3_Template","GeometryFormFieldComponent","geometryType$","GeometryFormFieldComponent_div_3_Template","GeometryFormFieldComponent_mat_form_field_4_Template","IgoMapModule","maxLength","legendPosition_r2","PrintFormComponent_mat_option_46_ng_container_1_Template","PrintFormComponent_mat_option_46_ng_container_2_Template","outputFormat_r3","paperFormat_r4","imageFormat_r5","resolution_r6","orientation_r7","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","showNorth","showNorthArrowField","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintFormComponent_mat_error_8_Template","PrintFormComponent_mat_error_16_Template","PrintFormComponent_mat_error_24_Template","PrintFormComponent_mat_option_46_Template","PrintFormComponent_mat_option_55_Template","PrintFormComponent_mat_option_64_Template","PrintFormComponent_mat_option_73_Template","PrintFormComponent_mat_option_83_Template","PrintFormComponent_mat_option_91_Template","maxlength","PrintComponent","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","provideDirection","DirectionSourceKind","OSRM","OsrmDirectionsSource","_http","_config","sourceName","getSourceName","directionsParams","getRouteParams","getRoute","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","osrmDirectionsSourcesFactory","withOsrmSource","OverlayAction","ZoomIfOutMapExtent","OverlayService","features$","OverlayDirective","overlayService","features$$","handleFeatures","provideSearch","CadastreSearchSource","getCadastre","numero","lot","computeGeometry","NoLot","cadastre_CadastreSearchSource","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatim_NominatimSearchSource","StoredQueriesSearchSource","resultTitle","storedQueriesOptions","multipleFieldsQuery","storedquery_id","splitPrefix","outputformat","srsname","storedqueriesParams","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","storedqueries_StoredQueriesSearchSource","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueries_StoredQueriesReverseSearchSource","WorkspaceSearchSource","limitValue","fswi","termToUse","foundIn","gettedIndex","sortedResultToProcess","resultsCnt","workspaceSearchSourceFactory","withWorkspaceSource","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","RegexService","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","mapExtentStrategyActiveToolTip","noElementSelected","addOrRemoveLayer","addedLayerId","ws$","geoServiceAction","getGeoServiceAction","geoServiceProperties","relations","columnsFromFeatures","col","cellClass","relationsColumn","relation","class_icon","createFilterInMapExtentOrResolutionStrategy","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","adding$","getDomainValues","modifyStyle","newFeaturefilterClauseFunc","editFeaturefilterClauseFunc","deleteFeature","deleteUrl","columnName","primary","editFeature","editionOpt","original_properties","original_geometry","idkey","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","unique","EditionWorkspaceService","relationLayers$","rowsInMapExtentCheckCondition$","wktFormat","WKT","geoJsonFormat","wksConfig","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","workspaceLayer","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","refreshMap","removeZ","relationLayers","fromSave","wfsOlLayer","wmsOlLayer","_t","WmsWorkspaceService","printable","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","editionWorkspaceService","featureWorkspaceService","changeWorkspace","rowsInMapExtentCheckCondition","workspaceStore","onLayersChange","adding","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","getByte","charCodeAt","getByte64","ALPHA","b10","pads","imax","PADCHAR","param","Bowser","successful","createTextArea","selectText","destroyTextArea","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","contenteditable","selectNodeContents","setSelectionRange","compareVersion","execCommand","getNumber","endposition","base64Index","indexBase64","generateBase64Index","base64","text64","compressStringBase64","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","bits","chr","rem","ChangeType","DELETED","s1","s2","changeData","getChanges","nextS","mtc","ins","sbs","nextThis","del","getMatchingSubstring","slen","fis","isThisLonger","longer","shorter","bi","len","fil","rc","rotateArray","obj1","obj2","ignoreKeys","deleted","obj1Clone","obj2Clone","fromItem","toItem","fromItemClone","toItemClone","keysChanged","compareObject","oldValue","itemAdded","baseKey","keyString","DomUtils","tagName","downloadFromUri","jsonString","keysArray","ignoreUndefined","prop","summaryCapitalizeObject","capitalizeObject","upperCaseCount","upperCaseProperty","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","nullScore","ax","bx","$1","$2","an","bn","nn","obj1Props","getOwnPropertyNames","obj2Props","_obj","roundFactor","PATH_PREBUILT_THEMES","LINK_ID","loadTheme","themeName","head","themeLink","createHtmlLink","rel","S4","_status","AuthInternComponent","allowAnonymous","_allowAnonymous","fb","loginUser","errorMsg","AuthInternComponent_button_18_Template","AuthInternComponent_div_19_Template","AuthInternComponent_div_20_Template","AuthMicrosoftComponent","msalService","msalGuardConfig","_destroying$","broadcastService","PublicClientApplication","cache","cacheLocation","MsalBroadcastService","clientId","inProgress$","InteractionStatus","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","acquireTokenSilent","accessToken","tokenId","idToken","InteractionRequiredAuthError","acquireTokenPopup","MSAL_GUARD_CONFIG","MsalServiceb2c","redirectHash","logger","initializeWrapperLibrary","WrapperSKU","Angular","initialize","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","_inProgress","Startup","addEventCallback","EventMessageUtils","getInteractionStatusFromEvent","verbose","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","fjs","js","AuthGoogleComponent","apiKey","loadSDKGoogle","loadPlatform","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","btn","onLogin","AuthFormComponent_div_0_div_2_igo_auth_google_4_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoft_5_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoftb2c_6_Template","AuthFormComponent_div_0_div_2_igo_auth_facebook_7_Template","AuthFormComponent_div_0_div_2_igo_auth_intern_8_Template","google","microsoft","microsoftb2c","facebook","intern","home","AuthFormComponent_div_0_div_4_button_4_Template","AuthFormComponent_div_0_div_1_Template","AuthFormComponent_div_0_div_2_Template","AuthFormComponent_div_0_div_3_Template","AuthFormComponent_div_0_div_4_Template","backgroundDisable","showLoginDiv","showAlreadyConnectedDiv","showLogoutDiv","AuthFormComponent","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","analyzeRoute","getName","logoutRoute","NavigationStart","currentRoute","AuthFormComponent_div_0_Template","redirectTo","pathMatch","AppAuthFormComponent","_authService","logged$$","DocViewerComponent","ExampleViewerComponent","AppActionComponent","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_container_1_ng_container_1_Template","loopObject_r5","property_r2","ctx_r3","baseKey_r3","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_container_1_Template","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_template_2_Template","notObject_r6","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_Template","JsonDialogComponent_ng_template_4_ng_container_0_Template","JsonDialogComponent","JsonDialogComponent_ng_container_3_Template","JsonDialogComponent_ng_template_4_Template","JsonDialogService","IgoJsonDialogModule","SelectValueDialogType","Radio","Checkbox","SelectValueCheckRadioDialogComponent_5_ng_template_0_Template","choice_r4","SelectValueCheckRadioDialogComponent_mat_radio_group_6_mat_radio_button_1_Template","SelectValueCheckRadioDialogComponent","isDisabled$","getFg","selectFieldText","canProcess","selectedIds","selectedChoices","SelectValueCheckRadioDialogComponent_5_Template","SelectValueCheckRadioDialogComponent_mat_radio_group_6_Template","SelectValueDialogService","IgoSelectValueDialogModule","AppDialogComponent","selectValueDialogService","jsonDialogService","formDialogService","yesno","json","isbn","author","lastname","firstname","editor","compose","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentComponent","toggleComponent","selectedEntity$","AppEntitySelectorComponent","entityIsSelected","getTitle","AppEntitySelectorComponent_div_3_Template","AppEntityTableComponent","clearForm","form_r3","AppFormComponent","valueChanges$$","AppFormComponent_igo_form_2_Template","AppIconComponent","exampleIndexHtml","EXAMPLE_INDEX_HTML","exampleIndexStaticHtml","EXAMPLE_INDEX_STATIC_HTML","exampleStyleVariable","EXAMPLE_STYLE_VARIABLE","exampleProvider","EXAMPLE_PROVIDER","nameControl","FormControl","TableActionColor","accent","TableDataSource","_database","_model","_sort","_filterChange","connect","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","row_r4","column_r5","TableComponent_ng_container_8_ng_container_1_th_1_Template","TableComponent_ng_container_8_ng_container_2_th_1_Template","model","row_r6","TableComponent_ng_container_8_ng_container_3_td_1_Template","TableComponent_ng_container_8_ng_template_4_td_0_Template","TableComponent_ng_container_8_ng_container_1_Template","TableComponent_ng_container_8_ng_container_2_Template","TableComponent_ng_container_8_ng_container_3_Template","TableComponent_ng_container_8_ng_template_4_Template","cellHTML_r8","action_r10","handleClickAction","getActionColor","TableComponent_td_11_button_1_Template","row_r13","TableComponent","database","hasFilterInput","_hasFIlterInput","colorId","MatSort","TableComponent_div_1_Template","TableComponent_th_6_Template","TableComponent_td_7_Template","TableComponent_ng_container_8_Template","TableComponent_th_10_Template","TableComponent_td_11_Template","TableComponent_tr_12_Template","TableComponent_tr_13_Template","TableDatabase","copiedData","AppTableComponent","showName","handleSelect","rows","AppSalutationToolComponent","AppAboutToolComponent","AppToolComponent","panelTitle","activateSalutationTool","AppToolComponent_button_3_Template","AppToolComponent_button_5_Template","AppSalutationWidgetComponent","AppWidgetComponent","dep_r1","DocViewerComponent_ng_container_5_li_4_Template","dependencies","DocViewerComponent_ng_container_5_Template","codeUrl","configUrl","SRC_PATH","codeFolder","configFolder","ExampleViewerComponent_a_5_Template","ExampleViewerComponent_a_6_Template","AppContextComponent","AppContextComponent_ng_template_18_Template","MatGridListModule","AppActivityComponent","idsActivity","counter","AppConfigComponent","configLanguage","AppLanguageComponent","app","changeLanguage","AppMediaComponent","AppMessageComponent","isTracingEnabled","tracesSampleRate","tracesSampler","isReplayEnabled","replaysSessionSampleRate","replaysOnErrorSampleRate","MONITORING_OPTIONS","provideMonitoring","initSentry","getClient","integrations","browserTracingIntegration","replayIntegration","tracingEnabled","ErrorHandler","createErrorHandler","logErrors","errorHandlerOptions","createSentryErrorHandler","TraceService","Router","provideSentryMonitoring","AuthMonitoringService","monitoringOptions","identifyUser","_identifyUser","identifySentryUser","provideAuthUserMonitoring","AppMonitoringComponent","exampleProviderCode","throwTestError","getBasicConfigExample","codeExample","environment","igo","monitoring","AppRequestComponent","callHttp","callHttpError","theme_r1","AppThemeComponent","isDark","themes","matSelectChange","AppThemeComponent_mat_option_7_Template","AppCatalogComponent","catalogStore","catalogItemStore","onCatalogSelectChange","AppDirectionsComponent","AppDrawComponent","AppFeatureComponent","AppGeometryComponent","AppGeometryComponent_igo_form_6_Template","AppHoverComponent","pointerCoordDelay","pointerHoverFeatureDelay","AppImportExportComponent","AppLayerComponent","AppLayerComponent_ng_template_11_Template","AppLegendComponent","AppMeasureComponent","AppOgcFilterComponent","AppOverlayComponent","AppPrintComponent","feature_r1","AppQueryComponent_ng_container_6_div_1_Template","features_r3","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryComponent_ng_container_6_Template","openGuide","menu_r3","guide_r5","formatFileName","headerHtml","AboutToolComponent","configOptions","_headerHtml","_discoverTitleInLocale","discoverTitleInLocale","trainingGuideURLs","effectiveVersion","baseUrlProfil","baseUrlGuide","configVersion","depot","guideUrl","guides","trainingGuides","guide","AboutToolComponent_button_2_Template","AboutToolComponent_button_3_Template","AboutToolComponent_button_6_Template","AboutToolComponent_igo_custom_html_7_Template","MapState","projectionService","_legendToolShowAll","CatalogState","_catalogStore","catalogItemsStores","clearCatalogItemsStores","getCatalogItemsStore","setCatalogItemsStore","store_r1","CatalogBrowserToolComponent","catalogState","mapState","store$","catalog$$","catalog$","CatalogBrowserToolComponent_igo_catalog_browser_0_Template","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","openSidenav$","toolToActivateFromOptions","toolToActivate","CatalogLibraryToolComponent","toolState","currentTool","lastTool","ContextEditorToolComponent","ContextManagerToolComponent","toolToOpenOnContextChange","editContext","ContextPermissionManagerToolComponent","LayerListToolState","keyword$","selectedTab$","setKeyword","setSortAlpha","setOnlyVisible","setSelectedTab","tab","getLayerListControls","ContextShareToolComponent","layerListToolState","layerListControls","ContextState","onContextChange","updateTools","contextTool","baseTool","parentIndex","DirectionState","DirectionsToolComponent","directionState","contextState","currentContextUri","DrawState","layersID","deletedStore","drawControlIndex","DrawingToolComponent","drawState","addLayersID","addDrawControls","ActiveOgcFilterToolComponent","ActiveTimeFilterToolComponent","OgcFilterToolComponent","StorageState","igoStorageService","handleZoomAuto","getWorkspaceActions","selectOnlyCheckCondition$","ogcFilterWidget","zoomAuto$","maximize$","filterStrategy","dateTransform","totalPagesExp","tableWidth","horizontalPageBreak","cellPadding","minCellWidth","didDrawPage","putTotalPages","returnActions","EditionActionsService","storageState","storageChange$$","loadActions","buildActions","storageChange","FeatureActionsService","WfsActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","workspaceEnabled$","workspaceMaximize$","actionMaximize$$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","workspace$","workspaceSelection","workspaceSelection$","initWorkspaces","maximized","setWorkspaceIsMaximized","rowsInMapExtent","selectOnly","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","SpatialFilterToolComponent","matIconRegistry","workspaceState","activeLayers","iterator","selectedFeature$","spatialListStore","moveendKey","getOutputType","getOutputQueryType","activateExportTool","re","layerToOpenWks","zeroResults","selectWorkspaceEntity","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","getNamedSvgIcon","svgObj","xmlSerializer","SpatialFilterToolComponent_ng_container_2_Template","TimeFilterToolComponent","ImportExportToolComponent","importExportType","importExportShowBothType","selectType","userSelectedType","userSelectedMode","importExportTypeChange","ImportExportToolComponent_mat_tab_group_0_Template","ImportExportToolComponent_igo_import_export_1_Template","ImportExportToolComponent_igo_context_import_export_2_Template","translatedValue","AdvancedCoordinatesComponent","formattedScale$","currentCenterDefaultProj","inMtmZone","inLambert2","formStatus$$","defaultProj","currentZones","setScaleValue","updateCoordinates","tempInputProj","positionInList","updateZoneMtmUtm","currentMtmZone","currentUtmZone","back2quebec","updateProjectionsZoneChange","checkLambert","displayCenter","modifiedProj","pushMtm","tk","iter","currentExtentWGS","AdvancedCoordinatesComponent_mat_form_field_2_Template","AdvancedCoordinatesComponent_ng_template_3_Template","AdvancedCoordinatesComponent_mat_form_field_5_Template","AdvancedCoordinatesComponent_ng_template_6_Template","AdvancedCoordinatesComponent_mat_option_19_Template","elseBlock_r5","elseBlock2_r6","DecimalPipe","e_r2","applyNewLayers","AdvancedSwipeComponent_div_0_mat_option_12_Template","startSwipe","swipe","searchEmit","catalogEmit","contextEmit","AdvancedSwipeComponent","listForSwipe","AdvancedSwipeComponent_div_0_Template","AdvancedSwipeComponent_ng_template_1_Template","noLayersBlock_r7","AdvancedMapToolComponent","toggleTracking","toggleFollow","WorkspaceButtonComponent","hasWorkspace$","hasWorkspace$$","layer$","WorkspaceButtonComponent_button_0_Template","activateExport","MapDetailsToolComponent_igo_layer_list_0_ng_template_1_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_p_4_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_5_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_6_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_7_Template","layerAdditionAllowed","searchToolInToolbar","catalogToolInToolbar","contextToolInToolbar","MapDetailsToolComponent_ng_template_2_mat_list_0_Template","delayedShowEmptyMapContent","MapDetailsToolComponent","filterSortOptions","MapDetailsToolComponent_igo_layer_list_0_Template","MapDetailsToolComponent_ng_template_2_Template","empty_r7","onShowAllLegends","showAllLegendsValue$","MapLegendToolComponent_1_ng_template_0_Template","visibleLayers$","MapLegendToolComponent_ng_template_6_mat_list_0_p_4_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_5_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_6_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_7_Template","MapLegendToolComponent_ng_template_6_mat_list_0_Template","MapLegendToolComponent","visibleOrInRangeLayers$$","visibleOrInRangeLayers$","visibleOrInRangeLayers","MapLegendToolComponent_igo_layer_legend_list_0_Template","MapLegendToolComponent_1_Template","MapLegendToolComponent_p_3_Template","MapLegendToolComponent_ng_template_6_Template","emptyLayers_r6","MapProximityState","defaultProximityRadiusValue","enabled$","proximityRadiusValue$","proximitylocationType$","proximityFeatureStore","subs$$","currentPositionCoordinate$","subscribeProximityMonitor","currentPos","locationType","proximityRadiusValue","coordLonLat","roundedCoordLonLat","layerToMonitor","layerSource","olFeaturesAtCoordinate","getFeaturesAtCoordinate","olFeatureAtCoordinate","featureAtThisPosition","closestOlFeature","getClosestFeatureToCoordinate","closestOlGeom","closestFeature","geometryClosestPoint","getClosestPoint","linebetween","lineLength","coordFromCalculatedDistance","layerSrcId","layerSrcTitle","coord_r2","coord2_r3","ctx_r4","MapProximityToolComponent","mapProximityState","maxDistance","userDefinedMapCenter","userDefinedFollowPosition","onLocationTypeChange","MapProximityToolComponent_mat_form_field_3_Template","MapProximityToolComponent_mat_form_field_5_Template","MapProximityToolComponent_button_7_Template","MapToolComponent","MapToolComponent_ng_template_4_Template","layer_r4","activateTimeFilter","activateOgcFilter","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_style_modal_layer_button_0_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_time_filter_button_3_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_ogc_filter_button_4_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_export_button_5_Template","isStyleEditButton","isTimeFilterButton","isOGCFilterButton","isExportButton","onLayerListChange","MapToolsComponent_igo_layer_list_5_ng_template_1_Template","MapToolsComponent_10_ng_template_0_Template","MapToolsComponent_ng_template_15_mat_list_0_p_4_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_5_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_6_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_7_Template","MapToolsComponent_ng_template_15_mat_list_0_Template","MapToolsComponent","selectedTabAtOpening","_layerListControls","stateOptions","stateKeyword","stateOnlyVisible","stateSortAlpha","tabGroup","selectedTab","userSelectedTab","tabChanged","appliedFilters","MapToolsComponent_igo_layer_list_5_Template","MapToolsComponent_igo_layer_legend_list_9_Template","MapToolsComponent_10_Template","MapToolsComponent_p_12_Template","MapToolsComponent_ng_template_15_Template","emptyLayers_r12","MeasureState","getOverlays","MeasurerToolComponent","measureState","PrintToolComponent","SearchState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","focusedOrResolution$$","selectedOrResolution$$","featureMotion","searchTermSplitter$","searchTerm$","searchDisabled$","searchResultsGeometryEnabled$","searchSettingsChange$","selectedResult$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","disableSearch","setSearchTerm","setSearchSettingsChange","setSelectedResult","setSearchResultsGeometryStatus","result_r3","isSelectedResultOutOfView$","toggleTopPanel","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_button_5_Template","featureTitle","topPanelState$","onResultFocus","onResultUnfocus","SearchResultsToolComponent_igo_flexible_2_ng_template_5_Template","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_Template","topPanelState","SearchResultsToolComponent","searchState","topPanelStateDefault","hasFeatureEmphasisOnSelection","showResultsGeometries$$","getRoute$$","shownResultsGeometries","shownResultsEmphasisGeometries","focusedResult$","isSelectedResultOutOfView$$","abstractFocusedResult","abstractSelectedResult","debouncedEmpty$","debouncedEmpty$$","searchTerm$$","topPanelState$$","computeElementRef","adjustTopPanel","buildResultEmphasis","monitorResultOutOfView","searchResults","clearFeatureEmphasis","selectedResult","selectedOlFeature","selectedOlFeatureExtent","abstractResult","computedStyle","zIndexOffset","shownResult","tryAddFeatureToMap","routingCoordLoaded","currentCoord","SearchResultsToolComponent_div_0_Template","SearchResultsToolComponent_igo_flexible_2_Template","ElementRef","DataIssueReporterToolComponent_igo_form_0_div_2_igo_form_field_1_Template","form_r4","DataIssueReporterToolComponent_igo_form_0_div_2_Template","DataIssueReporterToolComponent","baseLayerOrShownInLayerList","submitTitle","DataIssueReporterToolComponent_igo_form_0_Template","ContextMenuDirective","viewContainerRef","elementRef","overlayRef","menuContext","menuPosition","onContextMenu","MouseEvent","TouchEvent","pageX","pageY","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","clickTarget","overlayElement","dispose","LongPressDirective","touchTimeout","touchDuration","onlyIOS","longpress","touchstart","touchEnd","touchend","actionBarMode","AppSearchComponent","mapBrowser","searchStore","igoReverseSearchCoordsFormatEnabled","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","getBoundingClientRect","scrollY","scrollX","AppSearchComponent_span_2_Template","AppSearchComponent_ng_template_10_Template","AppSearchComponent_igo_panel_12_Template","AppSearchComponent_ng_template_13_Template","actionbarMenu_r4","pointerCoord","AppSimpleMapComponent","onPointerMove","AppSimpleMapComponent_p_12_Template","AppSpatialFilterComponent","AppSpatialFilterComponent_ng_container_13_Template","AppTimeFilterComponent","workspace_r3","AppWorkspaceComponent_ng_container_6_igo_entity_table_paginator_1_Template","workspace_r4","workspacePaginator","AppWorkspaceComponent_ng_container_8_igo_actionbar_1_Template","AppWorkspaceComponent_ng_container_8_igo_entity_table_2_Template","AppWorkspaceComponent_ng_container_8_mat_card_content_4_Template","AppWorkspaceComponent","selectedWorkspace$","AppWorkspaceComponent_ng_container_6_Template","AppWorkspaceComponent_ng_container_8_Template","production","directionsSources","osrm","interactiveTour","tourInMobile","activateInteractiveTour","importExport","dsn","storedqueriesreverse","nominatim","icherche","coordinatesreverse","icherchereverse","ilayer","ErrorInterceptor","errorContainer","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","IgoErrorModule","parentModule","dbConfig","objectStoresMeta","storeConfig","keyPath","autoIncrement","storeSchema","keypath","IgoCoreModule","NgxIndexedDBModule","AppHomeComponent","loadChildren","__webpack_require__","ROUTES_CONFIG","getRoutesConfig","coreRoutes","authRoutes","commonRoutes","geoRoutes","contextRoutes","routeConfig_r3","route_r4","AppComponent_ng_container_13_ng_template_2_a_5_Template","AppComponent_ng_container_13_ng_container_1_Template","AppComponent_ng_container_13_ng_template_2_Template","routeWithChildren_r5","AppComponent","changeDetectorRef","mobileQuery","routesConfig","_mobileQueryListener","matchMedia","detectOldBrowser","handleSplashScreen","NavigationEnd","_removeSplashScreen","intro","stylesheet","removeEventListener","getBrowser","snav_r2","AppComponent_ng_container_13_Template","MatExpansionModule","MatToolbarModule","MatSidenavModule","RouterLink","RouterLinkActive","RouterOutlet","enableProdMode","bootstrapApplication","BrowserModule","HammerModule","provideHttpClient","withJsonpSupport","provideRouter","withPreloading","PreloadAllModules","provideAnimations","MAT_FORM_FIELD_DEFAULT_OPTIONS","MAT_TOOLTIP_DEFAULT_OPTIONS","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","webpackContext","webpackContextResolve","module","exports"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/shared/auth-storage.service.ts","./packages/auth/src/lib/shared/auth.interface.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/auth.provider.ts","./packages/common/action/src/shared/action.enums.ts","./packages/common/action/src/shared/store.ts","./packages/common/action/src/actionbar/actionbar-item.component.html","./packages/common/action/src/actionbar/actionbar-item.component.ts","./packages/common/action/src/actionbar/actionbar.component.html","./packages/common/action/src/actionbar/actionbar.component.ts","./packages/common/badge/src/badge-icon.directive.ts","./packages/common/collapsible/src/collapse.directive.ts","./packages/common/collapsible/src/collapsible.component.ts","./packages/common/collapsible/src/collapsible.component.html","./packages/common/confirm-dialog/src/confirm-dialog.component.ts","./packages/common/confirm-dialog/src/confirm-dialog.component.html","./packages/common/confirm-dialog/src/confirm-dialog.service.ts","./packages/common/confirm-dialog/src/confirm-dialog.module.ts","./packages/common/custom-html/src/custom-html.pipe.ts","./packages/common/custom-html/src/custom-html.component.ts","./packages/common/custom-html/src/custom-html.component.html","./packages/common/dynamic-component/src/shared/dynamic-component.ts","./packages/common/dynamic-component/src/shared/dynamic-component.service.ts","./packages/common/dynamic-component/src/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/dynamic-component/src/dynamic-outlet/dynamic-outlet.component.html","./packages/common/entity/src/shared/entity.enums.ts","./packages/common/entity/src/shared/entity.utils.ts","./packages/common/entity/src/shared/state.ts","./packages/common/entity/src/shared/view.ts","./packages/common/entity/src/shared/store.ts","./packages/common/entity/src/shared/watcher.ts","./packages/common/entity/src/shared/strategies/strategy.ts","./packages/common/entity/src/shared/strategies/filter-custom-function.ts","./packages/common/entity/src/shared/strategies/filter-selection.ts","./packages/common/entity/src/entity-selector/entity-selector.component.html","./packages/common/entity/src/entity-selector/entity-selector.component.ts","./packages/common/entity/src/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/entity/src/entity-table-paginator/entity-table-paginator.component.html","./packages/common/entity/src/entity-table/entity-table-row.directive.ts","./packages/common/entity/src/entity-table/entity-table.component.html","./packages/common/entity/src/entity-table/entity-table.component.ts","./packages/common/flexible/src/flexible.component.ts","./packages/common/flexible/src/flexible.component.html","./packages/common/form/src/form-field/form-field.component.html","./packages/common/form/src/form-field/form-field.component.ts","./packages/common/form/src/form/form.component.ts","./packages/common/form/src/form/form.component.html","./packages/common/form/src/shared/form-field-component.ts","./packages/common/form/src/form-field/form-field-select.component.html","./packages/common/form/src/form-field/form-field-select.component.ts","./packages/common/form/src/form-field/form-field-text.component.html","./packages/common/form/src/form-field/form-field-text.component.ts","./packages/common/form/src/form-field/form-field-textarea.component.html","./packages/common/form/src/form-field/form-field-textarea.component.ts","./packages/common/form/src/form-field/form-field.directive.ts","./packages/common/form/src/form-group/form-group.component.html","./packages/common/form/src/form-group/form-group.component.ts","./packages/common/form/src/shared/form.service.ts","./packages/common/form/src/form-dialog/form-dialog.component.html","./packages/common/form/src/form-dialog/form-dialog.component.ts","./packages/common/form/src/form-dialog/form-dialog.service.ts","./packages/common/form/src/form-dialog/form-dialog.module.ts","./packages/common/form/src/shared/form-field.service.ts","./packages/common/form/src/shared/form.utils.ts","./packages/common/icon/src/shared/icons.ts","./packages/common/icon/src/shared/icon.service.ts","./packages/common/icon/src/icon.provider.ts","./packages/common/icon/src/icon/icon.component.html","./packages/common/icon/src/icon/icon.component.ts","./packages/common/image/src/image-error.directive.ts","./packages/common/image/src/secure-image.pipe.ts","./packages/common/interactive-tour/src/interactive-tour.component.html","./packages/common/interactive-tour/src/interactive-tour.component.ts","./packages/common/interactive-tour/src/interactive-tour.loader.ts","./packages/common/interactive-tour/src/interactive-tour.service.ts","./packages/common/interactive-tour/src/interactive-tour.module.ts","./packages/common/list/src/list-item.directive.ts","./packages/common/clickout/src/clickout.directive.ts","./packages/common/list/src/list.component.ts","./packages/common/list/src/list.component.html","./packages/common/panel/src/panel.component.html","./packages/common/panel/src/panel.component.ts","./packages/common/spinner/src/spinner.component.ts","./packages/common/spinner/src/spinner.component.html","./packages/common/stop-propagation/src/stop-drop-propagation.directive.ts","./packages/common/stop-propagation/src/stop-propagation.directive.ts","./packages/common/tool/src/shared/toolbox.ts","./packages/common/tool/src/shared/tool.service.ts","./packages/common/tool/src/shared/tool-component.ts","./packages/common/tool/src/toolbox/toolbox.animation.ts","./packages/common/tool/src/toolbox/toolbox.component.html","./packages/common/tool/src/toolbox/toolbox.component.ts","./packages/common/widget/src/shared/widget.service.ts","./packages/common/widget/src/widget-outlet/widget-outlet.module.ts","./packages/common/widget/src/widget.module.ts","./packages/common/widget/src/widget-outlet/widget-outlet.component.html","./packages/common/widget/src/widget-outlet/widget-outlet.component.ts","./packages/common/workspace/src/shared/store.ts","./packages/common/workspace/src/shared/workspace.ts","./packages/common/workspace/src/workspace-selector/workspace-selector.component.ts","./packages/common/workspace/src/workspace-selector/workspace-selector.component.html","./packages/common/workspace/src/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/workspace/src/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-export.service.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-import-export/shared/context-import.service.ts","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.html","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.ts","./packages/context/src/lib/context-import-export/shared/context-export.utils.ts","./packages/context/src/lib/context-manager/context-form/context-form.component.html","./packages/context/src/lib/context-manager/context-form/context-form.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit.component.html","./packages/context/src/lib/context-manager/context-edit/context-edit.component.ts","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.html","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.ts","./packages/context/src/lib/context-map-button/user-button/user-button.component.ts","./packages/context/src/lib/share-map/shared/share-map.service.ts","./packages/context/src/lib/share-map/share-map/share-map-api.component.html","./packages/context/src/lib/share-map/share-map/share-map-api.component.ts","./packages/context/src/lib/share-map/share-map/share-map-url.component.html","./packages/context/src/lib/share-map/share-map/share-map-url.component.ts","./packages/context/src/lib/share-map/share-map/share-map.component.html","./packages/context/src/lib/share-map/share-map/share-map.component.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-manager/context-edit/context-edit-binding.directive.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions-binding.directive.ts","./packages/core/activity/src/activity.interceptor.ts","./packages/core/activity/src/activity.module.ts","./packages/core/activity/src/activity.service.ts","./packages/core/analytics/src/analytics.service.ts","./packages/core/config/src/config-deprecated.ts","./packages/core/config/src/version.ts","./packages/core/config/src/config.service.ts","./packages/core/config/src/config.provider.ts","./packages/core/language/src/language.module.ts","./packages/core/language/src/shared/language.loader.ts","./packages/core/language/src/shared/language.service.ts","./packages/core/language/src/shared/missing-translation.guard.ts","./packages/core/language/src/shared/language.provider.ts","./packages/core/media/src/media.enum.ts","./packages/core/media/src/media.service.ts","./packages/core/message/src/shared/message.provider.ts","./packages/core/message/src/message.module.ts","./packages/core/message/src/shared/message.enum.ts","./packages/core/message/src/shared/message.service.ts","./packages/core/network/src/network.service.ts","./packages/core/route/src/route.service.ts","./packages/core/storage/src/storage.interface.ts","./packages/core/storage/src/storage.ts","./packages/core/storage/src/storage.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.interface.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.component.ts","./packages/geo/src/lib/feature/feature-form/feature-form.component.html","./packages/geo/src/lib/feature/shared/feature-store.utils.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/geometry/shared/geometry.errors.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/map-center/map-center.component.ts","./packages/geo/src/lib/map/map-center/map-center.component.html","./packages/geo/src/lib/map/menu-button/menu-button.component.ts","./packages/geo/src/lib/map/menu-button/menu-button.component.html","./packages/geo/src/lib/map/offline-button/offline-button.component.ts","./packages/geo/src/lib/map/offline-button/offline-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.interface.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/map/shared/mapOffline.directive.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/map/swipe-control/swipe-control.component.ts","./packages/geo/src/lib/map/swipe-control/swipe-control.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/common/dom/src/dom.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/common/color/src/color-picker-form-field/color-picker-form-field.component.html","./packages/common/color/src/color-picker-form-field/color-picker-form-field.component.ts","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","./packages/geo/src/lib/import-export/export-button/export-button.component.html","./packages/geo/src/lib/import-export/export-button/export-button.component.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/source.interfaces.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche-icons.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.html","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.html","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/catalog/shared/catalogs.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/directions/directions.provider.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.interface.ts","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/search/shared/search.provider.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/core/regex/src/regex.service.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/cache.utils.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/compression/compression.utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/dom.utils.ts","./packages/utils/src/lib/file.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/theme.utils.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/auth/internal/src/auth-intern/auth-intern.component.html","./packages/auth/internal/src/auth-intern/auth-intern.component.ts","./packages/auth/microsoft/src/auth-microsoft/auth-microsoft.component.ts","./packages/auth/microsoft/src/auth-microsoft/auth-microsoft.component.html","./packages/auth/microsoft/src/auth-microsoftb2c/auth-msalServiceb2c.service.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-microsoftb2c.component.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-microsoftb2c.component.html","./packages/auth/facebook/src/auth-facebook/auth-facebook.component.ts","./packages/auth/facebook/src/auth-facebook/auth-facebook.component.html","./packages/auth/google/src/auth-google/auth-google.component.ts","./packages/auth/google/src/auth-google/auth-google.component.html","./packages/auth/form/src/auth-form/auth-form.component.html","./packages/auth/form/src/auth-form/auth-form.component.ts","./projects/demo/src/app/auth/auth.routing.ts","./projects/demo/src/app/auth/auth-form/auth-form.component.ts","./projects/demo/src/app/auth/auth-form/auth-form.component.html","./projects/demo/src/app/common/action/action.component.ts","./projects/demo/src/app/common/action/action.component.html","./packages/common/json-dialog/src/json-dialog.component.html","./packages/common/json-dialog/src/json-dialog.component.ts","./packages/common/json-dialog/src/json-dialog.service.ts","./packages/common/json-dialog/src/json-dialog.module.ts","./packages/common/select-value-dialog/src/select-value-dialog.enums.ts","./packages/common/select-value-dialog/src/select-value-check-radio-dialog.component.html","./packages/common/select-value-dialog/src/select-value-check-radio-dialog.component.ts","./packages/common/select-value-dialog/src/select-value-dialog.service.ts","./packages/common/select-value-dialog/src/select-value-dialog.module.ts","./projects/demo/src/app/common/dialog/dialog.component.ts","./projects/demo/src/app/common/dialog/dialog.component.html","./projects/demo/src/app/common/dynamic-component/dynamic-component.component.ts","./projects/demo/src/app/common/dynamic-component/dynamic-component.component.html","./projects/demo/src/app/common/entity-selector/entity-selector.component.html","./projects/demo/src/app/common/entity-selector/entity-selector.component.ts","./projects/demo/src/app/common/entity-table/entity-table.component.ts","./projects/demo/src/app/common/entity-table/entity-table.component.html","./projects/demo/src/app/common/form/form.component.html","./projects/demo/src/app/common/form/form.component.ts","./projects/demo/src/app/common/icon/icon.component.ts","./projects/demo/src/app/common/icon/icon.component.html","./packages/common/table/src/table-action-color.enum.ts","./packages/common/table/src/table-datasource.ts","./packages/common/table/src/table.component.html","./packages/common/table/src/table.component.ts","./packages/common/table/src/table-database.ts","./projects/demo/src/app/common/table/table.component.ts","./projects/demo/src/app/common/table/table.component.html","./projects/demo/src/app/common/tool/tool.component.html","./projects/demo/src/app/common/tool/tool.component.ts","./projects/demo/src/app/common/widget/widget.component.ts","./projects/demo/src/app/common/common.routing.ts","./projects/demo/src/app/common/widget/widget.component.html","./projects/demo/src/app/components/doc-viewer/doc-viewer.component.html","./projects/demo/src/app/components/doc-viewer/doc-viewer.component.ts","./projects/demo/src/app/components/example/example-viewer/example-viewer.component.html","./projects/demo/src/app/components/example/example-viewer/example-viewer.component.ts","./projects/demo/src/app/context/context/context.component.html","./projects/demo/src/app/context/context.routing.ts","./projects/demo/src/app/context/context/context.component.ts","./projects/demo/src/app/core/activity/activity.component.ts","./projects/demo/src/app/core/activity/activity.component.html","./projects/demo/src/app/core/config/config.component.ts","./projects/demo/src/app/core/config/config.component.html","./projects/demo/src/app/core/language/language.component.ts","./projects/demo/src/app/core/language/language.component.html","./projects/demo/src/app/core/media/media.component.ts","./projects/demo/src/app/core/media/media.component.html","./projects/demo/src/app/core/message/message.component.ts","./projects/demo/src/app/core/message/message.component.html","./packages/core/monitoring/src/sentry/sentry.utils.ts","./packages/core/monitoring/src/sentry/sentry.ts","./packages/core/monitoring/src/monitoring.provider.ts","./packages/core/monitoring/src/sentry/sentry.provider.ts","./packages/auth/monitoring/src/auth-monitoring/auth-monitoring.service.ts","./packages/auth/monitoring/src/auth-monitoring/auth-monitoring.provider.ts","./projects/demo/src/app/core/monitoring/monitoring.component.ts","./projects/demo/src/app/core/monitoring/monitoring.component.html","./projects/demo/src/app/core/request/request.component.ts","./projects/demo/src/app/core/request/request.component.html","./projects/demo/src/app/core/theme/theme.component.html","./projects/demo/src/app/core/core.routing.ts","./projects/demo/src/app/core/theme/theme.component.ts","./projects/demo/src/app/geo/catalog/catalog.component.ts","./projects/demo/src/app/geo/catalog/catalog.component.html","./projects/demo/src/app/geo/directions/directions.component.ts","./projects/demo/src/app/geo/directions/directions.component.html","./projects/demo/src/app/geo/draw/draw.component.ts","./projects/demo/src/app/geo/draw/draw.component.html","./projects/demo/src/app/geo/feature/feature.component.ts","./projects/demo/src/app/geo/feature/feature.component.html","./projects/demo/src/app/geo/geometry/geometry.component.html","./projects/demo/src/app/geo/geometry/geometry.component.ts","./projects/demo/src/app/geo/hover/hover.component.ts","./projects/demo/src/app/geo/hover/hover.component.html","./projects/demo/src/app/geo/import-export/import-export.component.ts","./projects/demo/src/app/geo/import-export/import-export.component.html","./projects/demo/src/app/geo/layer/layer.component.html","./projects/demo/src/app/geo/layer/layer.component.ts","./projects/demo/src/app/geo/legend/legend.component.ts","./projects/demo/src/app/geo/legend/legend.component.html","./projects/demo/src/app/geo/measure/measure.component.ts","./projects/demo/src/app/geo/measure/measure.component.html","./projects/demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./projects/demo/src/app/geo/ogc-filter/ogc-filter.component.html","./projects/demo/src/app/geo/overlay/overlay.component.ts","./projects/demo/src/app/geo/overlay/overlay.component.html","./projects/demo/src/app/geo/print/print.component.ts","./projects/demo/src/app/geo/print/print.component.html","./projects/demo/src/app/geo/query/query.component.html","./projects/demo/src/app/geo/query/query.component.ts","./packages/integration/src/lib/about/about-tool/about-tool.component.html","./packages/integration/src/lib/about/about-tool/about-tool.component.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/catalog/catalog.state.ts","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.html","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.html","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.ts","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.html","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.html","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.ts","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.html","./packages/integration/src/lib/map/layer-list-tool.state.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.html","./packages/integration/src/lib/context/context.state.ts","./packages/integration/src/lib/directions/directions.state.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.html","./packages/integration/src/lib/directions/directions.module.ts","./packages/integration/src/lib/draw/draw.state.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.html","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.html","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.html","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.html","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.ts","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.html","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.ts","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.html","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.ts","./packages/integration/src/lib/map/map-proximity.state.ts","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.html","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.ts","./packages/integration/src/lib/map/map-tool/map-tool.component.html","./packages/integration/src/lib/map/map-tool/map-tool.component.ts","./packages/integration/src/lib/map/map-tools/map-tools.component.html","./packages/integration/src/lib/map/map-tools/map-tools.component.ts","./packages/integration/src/lib/map/map.module.ts","./packages/integration/src/lib/measure/measure.state.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.html","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.module.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.html","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.ts","./packages/integration/src/lib/geometry-form/data-issue-reporter-tool/data-issue-reporter-tool.component.html","./packages/integration/src/lib/geometry-form/data-issue-reporter-tool/data-issue-reporter-tool.component.ts","./packages/common/context-menu/src/context-menu.directive.ts","./packages/common/context-menu/src/long-press.directive.ts","./projects/demo/src/app/geo/search/search.component.html","./projects/demo/src/app/geo/search/search.component.ts","./projects/demo/src/app/geo/simple-map/simple-map.component.html","./projects/demo/src/app/geo/simple-map/simple-map.component.ts","./projects/demo/src/app/geo/spatial-filter/spatial-filter.component.html","./projects/demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./projects/demo/src/app/geo/time-filter/time-filter.component.ts","./projects/demo/src/app/geo/time-filter/time-filter.component.html","./projects/demo/src/app/geo/workspace/workspace.component.html","./projects/demo/src/app/geo/geo.routing.ts","./projects/demo/src/app/geo/workspace/workspace.component.ts","./projects/demo/src/environments/environment.prod.ts","./packages/core/request/src/error.interceptor.ts","./packages/core/request/src/error.module.ts","./packages/core/src/lib/core.module.ts","./projects/demo/src/app/app.routing.ts","./projects/demo/src/app/pages/home/home.component.ts","./projects/demo/src/app/pages/home/home.component.html","./projects/demo/src/app/app.component.html","./projects/demo/src/app/app.component.ts","./projects/demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["import { Injectable, Injector } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { jwtDecode } from 'jwt-decode';\n\nimport { AuthOptions } from './auth.interface';\nimport { IgoJwtPayload } from './token.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options?: AuthOptions;\n  private tokenKey: string;\n\n  constructor(private injector: Injector) {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth');\n    this.tokenKey = this.options?.tokenKey;\n  }\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode(): IgoJwtPayload | null {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token) satisfies IgoJwtPayload;\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\nimport { Router } from '@angular/router';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Base64 } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { AuthOptions, IInfosUser, User } from './auth.interface';\nimport { IgoJwtPayload } from './token.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  public languageForce = false;\n  private anonymous = false;\n  private authOptions: AuthOptions;\n\n  get hasAuthService() {\n    return this.authOptions?.url !== undefined;\n  }\n\n  get user(): User | null {\n    const decodedToken = this.decodeToken();\n    return decodedToken?.user ? decodedToken.user : null;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authOptions = this.config.getConfig('auth');\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(\n    token: string,\n    type: string,\n    infosUser?: IInfosUser\n  ): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    return this.http.post(`${this.authOptions?.url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken(): IgoJwtPayload | null {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    if (redirectUrl === this.authOptions.loginRoute) {\n      const homeRoute = this.authOptions.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.authOptions?.url + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    return this.http.get<{ profils: string[] }>(\n      `${this.authOptions?.url}/profils`\n    );\n  }\n\n  updateUser(user: User): Observable<User> {\n    return this.http.patch<User>(this.authOptions?.url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token?.user?.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    return this.http\n      .post(`${this.authOptions?.url}/login`, body, { headers })\n      .pipe(\n        tap((data: any) => {\n          this.tokenService.set(data.token);\n          const tokenDecoded = this.decodeToken();\n          if (tokenDecoded?.user) {\n            if (tokenDecoded.user.locale && !this.languageForce) {\n              this.languageService.setLanguage(tokenDecoded.user.locale);\n            }\n            if (tokenDecoded.user.isExpired) {\n              this.messageService.alert('igo.auth.error.Password expired');\n            }\n          }\n          this.authenticate$.next(true);\n        }),\n        catchError((err) => {\n          err.error.caught = true;\n          throw err;\n        })\n      );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { BaseStorage, StorageScope } from '@igo2/core/storage';\n\nimport { AuthStorageOptions } from './auth-storage.interface';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends BaseStorage<AuthStorageOptions> {\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe((isAuthenticated) => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .patch(\n          this.options.url,\n          { preference: {} },\n          {\n            params: {\n              mergePreference: 'false'\n            }\n          }\n        )\n        .subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { Provider } from '@angular/core';\n\nimport { BaseUser } from '@igo2/core/user';\n\nexport interface User extends BaseUser {\n  source?: string;\n  sourceId?: string;\n  locale?: string;\n  isExpired?: boolean;\n  isAdmin?: boolean;\n  defaultContextId?: string;\n}\n\nexport interface IInfosUser {\n  tokenId: string;\n}\n\nexport type AuthOptions = {\n  url?: string;\n  tokenKey?: string;\n  allowAnonymous?: boolean;\n  loginRoute?: string;\n  logoutRoute?: string;\n  homeRoute?: string;\n  trustHosts?: string[];\n  profilsGuard?: string[];\n  hostsWithCredentials?: WithCredentialsOptions[];\n  hostsByKey?: AuthByKeyOptions[];\n  intern?: AuthInternOptions;\n};\n\nexport interface AuthByKeyOptions {\n  domainRegFilters?: string;\n  keyProperty?: string;\n  keyValue?: string;\n}\nexport interface WithCredentialsOptions {\n  withCredentials?: boolean;\n  domainRegFilters?: string;\n}\n\nexport interface AuthInternOptions {\n  enabled?: boolean;\n}\n\nexport interface AuthFeature<KindT extends AuthFeatureKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum AuthFeatureKind {\n  Microsoft = 0\n}\n","import { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport {\n  AuthByKeyOptions,\n  AuthOptions,\n  WithCredentialsOptions\n} from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private authOptions: AuthOptions;\n  private refreshInProgress = false;\n  private trustHosts: string[];\n  private hostsWithCredentials: WithCredentialsOptions[];\n  private hostsWithAuthByKey: AuthByKeyOptions[];\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {\n    this.authOptions = this.config.getConfig('auth') as AuthOptions;\n\n    this.trustHosts = this.authOptions?.trustHosts || [];\n    this.trustHosts.push(window.location.hostname);\n\n    this.hostsWithCredentials = this.authOptions?.hostsWithCredentials || [];\n    this.hostsWithAuthByKey = this.authOptions?.hostsByKey || [];\n  }\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n      return next.handle(req);\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded = this.tokenService.decode();\n    if (authReq.params.get('_i') === 'true' && tokenDecoded?.user?.sourceId) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n      xhr.withCredentials = withCredentials;\n      return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter((p) => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials =\n          hostWithCredentials.withCredentials !== undefined\n            ? hostWithCredentials.withCredentials\n            : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): { key: string; value: string } {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace, 'gm');\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {\n            key: hostWithAuthByKey.keyProperty,\n            value: hostWithAuthByKey.keyValue\n          };\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.authOptions?.url;\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        (err) => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport {\n  EnvironmentProviders,\n  Provider,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\n\nimport {\n  AuthFeature,\n  AuthFeatureKind,\n  AuthInterceptor,\n  AuthStorageService\n} from './shared';\n\nexport function provideAuthentification(\n  ...features: AuthFeature<AuthFeatureKind>[]\n): EnvironmentProviders {\n  const providers: Provider[] = [\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: AuthInterceptor,\n      multi: true\n    },\n    {\n      provide: StorageService,\n      useClass: AuthStorageService\n    }\n  ];\n\n  for (const feature of features) {\n    providers.push(...feature.providers);\n  }\n\n  return makeEnvironmentProviders(providers);\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {}\n","<mat-list-item\n  *ngIf=\"!action.checkbox\"\n  class=\"actionbar-item\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\"\n>\n  <button\n    *ngIf=\"withIcon\"\n    matListItemAvatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\"\n    [disableRipple]=\"true\"\n  >\n    <igo-icon\n      [icon]=\"isObservable(action.icon) ? (action.icon | async) : action.icon\"\n    ></igo-icon>\n  </button>\n  <span *ngIf=\"withTitle\" matLine>{{ title | translate }}</span>\n</mat-list-item>\n\n<mat-list-item\n  class=\"item-checkbox\"\n  *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n>\n  <mat-checkbox\n    *ngIf=\"withTitle\"\n    (change)=\"action.handler()\"\n    [checked]=\"checkCondition$ | async\"\n  >\n    {{ title | translate }}\n  </mat-checkbox>\n</mat-list-item>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoIconComponent } from '@igo2/common/icon';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n/**\n * An action button\n */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatListModule,\n    MatTooltipModule,\n    NgClass,\n    MatButtonModule,\n    MatIconModule,\n    MatCheckboxModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{ [key: string]: boolean }> =\n    new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  isObservable = isObservable;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) {\n    this.noDisplay$.next(value);\n  }\n  get noDisplay(): boolean {\n    return this.noDisplay$.value;\n  }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.action.title;\n  }\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action\n        .ngClass(...args)\n        .subscribe((ngClass: { [key: string]: boolean }) =>\n          this.updateNgClass(ngClass)\n        );\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition.subscribe(\n        (checkCondition: boolean) => this.updateCheckCondition(checkCondition)\n      );\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip.subscribe((tooltip: string) =>\n        this.updateTooltip(tooltip)\n      );\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action\n        .availability(...args)\n        .subscribe((available: boolean) => (this.disabled = !available));\n    }\n\n    this.disabled$$ = this.disabled$.subscribe((disabled: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-disabled': disabled })\n    );\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action\n        .display(...args)\n        .subscribe((display: boolean) => (this.noDisplay = !display));\n    }\n\n    this.noDisplay$$ = this.noDisplay$.subscribe((noDisplay: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-no-display': noDisplay })\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: { [key: string]: boolean }) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n}\n","<div\n  *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n  id=\"topChevron\"\n>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n    (click)=\"scrollUp()\"\n  >\n    <mat-icon>expand_less</mat-icon>\n  </button>\n</div>\n<mat-list *ngIf=\"mode === actionbarMode.Dock\" matListItemIcon>\n  <igo-actionbar-item\n    *ngIf=\"withToggleButton\"\n    color=\"accent\"\n    [withTitle]=\"false\"\n    [withIcon]=\"true\"\n    [color]=\"color\"\n    [disabled]=\"store.view.empty\"\n    [action]=\"toggleCollapseAction\"\n    (trigger)=\"onTriggerAction(toggleCollapseAction)\"\n  >\n  </igo-actionbar-item>\n\n  <ng-template\n    #buttonContent\n    *ngIf=\"!collapsed\"\n    ngFor\n    let-action\n    [ngForOf]=\"store.view.all$() | async\"\n  >\n    <igo-actionbar-item\n      color=\"accent\"\n      [withTitle]=\"withTitle\"\n      [withIcon]=\"withIcon\"\n      [withTooltip]=\"withTooltip\"\n      [color]=\"color\"\n      [disabled]=\"store.state.get(action).disabled\"\n      [action]=\"action\"\n      (trigger)=\"onTriggerAction(action)\"\n    >\n    </igo-actionbar-item>\n  </ng-template>\n</mat-list>\n\n<div\n  *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n  id=\"lowChevron\"\n>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n    (click)=\"scrollDown()\"\n  >\n    <mat-icon>expand_more</mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button\n    class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\"\n  >\n    <mat-icon>{{ icon }}</mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\"\n  >\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\"\n        >\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card\n  *ngIf=\"mode === actionbarMode.Context\"\n  class=\"context-menu-card mat-elevation-z4\"\n>\n  <mat-list>\n    <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [color]=\"color\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\"\n      >\n      </igo-actionbar-item>\n      <br />\n    </ng-template>\n  </mat-list>\n</mat-card>\n","import { Overlay } from '@angular/cdk/overlay';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostBinding,\n  Input,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport {\n  MatMenuModule,\n  MenuPositionX,\n  MenuPositionY\n} from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStoreWatcher } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { ActionbarMode } from '../shared/action.enums';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionStore } from '../shared/store';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    ActionbarItemComponent,\n    NgFor,\n    MatMenuModule,\n    MatCardModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'more_vert',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'more_horiz';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition: MenuPositionX = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition: MenuPositionY = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  @HostBinding('class.is-collapsed') isCollapsed = this.collapsed;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= el.scrollHeight - el.clientHeight) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n}\n","import { Directive, ElementRef, Input, OnInit } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]',\n  standalone: true,\n  providers: [MatIconModule]\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.html = `\n      <mat-icon class=\"mat-icon material-symbols-outlined\" style=\"height: 16px; width: 16px; font-size: 16px;\">${value}</mat-icon>\n    `;\n    this.updateHtml();\n  }\n  private html: string;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  @Input()\n  set igoMatBadgeColor(value: string) {\n    this.color = value;\n    this.updateColor();\n  }\n  private color;\n\n  @Input()\n  set igoMatBadgeBackgroundColor(value: string) {\n    this.backgroundColor = value;\n    this.updateColor();\n  }\n  private backgroundColor;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateHtml();\n  }\n\n  private updateHtml() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.html) {\n      this.badge.innerHTML = this.html;\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.color || this.backgroundColor) {\n      this.badge.style.color = this.color ? this.color : '';\n      this.badge.style.background = this.backgroundColor\n        ? this.backgroundColor\n        : '';\n    } else if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else if (!this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]',\n  standalone: true\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss'],\n  standalone: true,\n  imports: [MatListModule, MatIconModule, CollapseDirective]\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\"\n  >\n    expand_less\n  </mat-icon>\n  <span matListItemTitle>{{ title }}</span>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n  public titleKey: string = 'igo.common.confirmDialog.title';\n  public proccessKey: string = 'igo.common.confirmDialog.confirmBtn';\n  public cancelKey: string = 'igo.common.confirmDialog.cancelBtn';\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ titleKey | translate }}\n</h2>\n<div mat-dialog-content class=\"mat-typography\">\n  {{ confirmMessage | translate }}\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"dialogRef.close(true)\">\n    {{ proccessKey | translate }}\n  </button>\n  <button mat-flat-button (click)=\"dialogRef.close(false)\">\n    {{ cancelKey | translate }}\n  </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogOptions } from './confirm-dialog.interface';\n\n@Injectable({ providedIn: 'root' })\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    message: string,\n    options?: ConfirmDialogOptions\n  ): Observable<boolean> {\n    const _options: ConfirmDialogOptions = {\n      title: 'igo.common.confirmDialog.title',\n      modeYesNo: false,\n      ...options\n    };\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = message;\n    dialogRef.componentInstance.titleKey = _options.title;\n    if (_options.modeYesNo) {\n      dialogRef.componentInstance.proccessKey = 'igo.common.confirmDialog.yes';\n      dialogRef.componentInstance.cancelKey = 'igo.common.confirmDialog.no';\n    }\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  /**\n   * @deprecated this has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({\n  name: 'sanitizeHtml',\n  standalone: true\n})\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {}\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss'],\n  standalone: true,\n  imports: [SanitizeHtmlPipe]\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: { [key: string]: any } = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: { [key: string]: Subscription } = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: { [key: string]: (event: any) => void } = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: { [key: string]: any }) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n\n        this.unobserveInput(key);\n\n        const inputValue = inputs[key];\n        if (inputs.hasOwnProperty(key)) {\n          if (inputValue instanceof Observable) {\n            this.observeInput(key, inputValue);\n          } else {\n            this.setInputValue(instance, key, inputValue);\n          }\n        }\n      }\n    );\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: { [key: string]: (event: any) => void }) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n        if (subscribers.hasOwnProperty(key)) {\n          const emitter = instance[key];\n          const subscriber = subscribers[key];\n          if (Array.isArray(subscriber)) {\n            subscriber.forEach((_subscriber) => {\n              this.subscriptions.push(emitter.subscribe(_subscriber));\n            });\n          } else {\n            this.subscriptions.push(emitter.subscribe(subscriber));\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n}\n","import { ComponentFactoryResolver, Injectable } from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title\n    ? meta.title\n    : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml\n    ? meta.titleHtml\n    : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon\n    ? meta.icon\n    : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\n\ninterface EntityStateManagerOptions<E extends object> {\n  getKey?: (entity: object) => EntityKey;\n  index?: Map<EntityKey, E>;\n}\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<\n  E extends object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  constructor(private options: EntityStateManagerOptions<E> = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce(\n        (acc: { [key: string]: boolean }, key: string) => {\n          acc[key] = currentState[key] || false;\n          return acc;\n        },\n        {}\n      ) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || ({} as S);\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some(\n          (changeKey: string) => {\n            return (\n              state[changeKey] !== undefined &&\n              state[changeKey] !== reverseChanges[changeKey]\n            );\n          }\n        );\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce(\n      (reverseChanges: Partial<S>, bunch: [string, any]) => {\n        const [changeKey, value] = bunch;\n        if (typeof value === typeof true) {\n          (reverseChanges as object)[changeKey] = !value;\n        }\n        return reverseChanges;\n      },\n      {}\n    );\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = Array.from(this.options?.index?.keys() ?? []);\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport {\n  EntityFilterClause,\n  EntityJoinClause,\n  EntityKey,\n  EntitySortClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject(\n    []\n  );\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey {\n    return this.getKey$.value;\n  }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error(\n        'This view has no index, therefore, this method is unavailable.'\n      );\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error(\n        'This view has already been lifted, therefore, no join is allowed.'\n      );\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ =\n      this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: any[]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [\n      this.source$,\n      combineLatest(this.joins.map((join: EntityJoinClause) => join.source))\n    ];\n\n    return combineLatest(sources$).pipe(\n      map((bunch: [E[], any[]]) => {\n        const [entities, joinData] = bunch;\n        return entities.reduce((values: V[], entity: E) => {\n          const value = this.computeJoinedValue(entity, joinData);\n          if (value !== undefined) {\n            values.push(value);\n          }\n          return values;\n        }, []);\n      })\n    );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[],\n    filters: EntityFilterClause[],\n    filter: EntityFilterClause,\n    sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) {\n      return values;\n    }\n\n    return values.filter((value: V) => {\n      return clauses\n        .filter((clause: EntityFilterClause) => clause !== undefined)\n        .every((clause: EntityFilterClause) => clause(value));\n    });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) {\n      return values;\n    }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityKey, EntityRecord, EntityState } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStateManager } from './state';\nimport type { EntityStoreStrategy } from './strategies/strategy';\nimport { EntityView } from './view';\n\nexport interface EntityStoreOptions {\n  getKey?: (entity: object) => EntityKey;\n  getProperty?: (entity: object, property: string) => any;\n}\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<\n  E extends object = object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean {\n    return this._pristine;\n  }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty\n      ? options.getProperty\n      : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(\n    strategy: EntityStoreStrategy,\n    activate: boolean = false\n  ): EntityStore {\n    const existingStrategy = this.strategies.find(\n      (_strategy: EntityStoreStrategy) => {\n        return strategy.constructor === _strategy.constructor;\n      }\n    );\n    if (existingStrategy !== undefined) {\n      throw new Error(\n        'A strategy of this type already exists on that EntityStore.'\n      );\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({\n      getKey: this.getKey,\n      index: this.index\n    });\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return { entity, state, revision, ref };\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { EntityKey } from './entity.interfaces';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, { [key: string]: any }>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$.subscribe((entities: E[]) =>\n      this.onEntitiesChange(entities)\n    );\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport type { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(\n      store,\n      store.stateView.addFilter(this.options.filterClauseFunc)\n    );\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\" subscriptSizing=\"dynamic\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\"\n  >\n    <mat-option\n      *ngIf=\"emptyText !== undefined && multi === false\"\n      [value]=\"emptyValue\"\n      >{{ emptyText }}</mat-option\n    >\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{\n      multiText$ | async\n    }}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{ titleAccessor(record.entity) }}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { getEntityTitle } from '../shared/entity.utils';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\n\nexport interface EntitySelectorChange<T = any> {\n  selected: boolean;\n  value: T;\n}\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatSelectModule,\n    NgIf,\n    MatOptionModule,\n    NgFor,\n    AsyncPipe\n  ]\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = { id: 'IGO_MULTI_SELECT' };\n\n  readonly emptyValue = { id: 'IGO_EMPTY_SELECT' };\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<EntitySelectorChange>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map(\n          (record: EntityRecord<object>) => record.entity\n        );\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: { value: object | undefined }) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find(\n      (_value: object) => _value === this.multiSelectValue\n    );\n    let entities = values.filter(\n      (_value: object) => _value !== this.multiSelectValue\n    );\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({ selected: false });\n    } else {\n      this.store.state.updateMany(entities, { selected: true }, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({ selected: true, value });\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (\n      entities.length === this.store.count &&\n      this.multiText$.value !== this.multiNoneText\n    ) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (\n      entities.length < this.store.count &&\n      this.multiText$.value !== this.multiAllText\n    ) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  MatPaginator,\n  MatPaginatorModule,\n  PageEvent\n} from '@angular/material/paginator';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityStore } from '../shared';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatPaginatorModule]\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> =\n    new EventEmitter<MatPaginator>();\n\n  constructor(\n    private languageService: LanguageService,\n    private mediaService: MediaService\n  ) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions =\n      this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons =\n        this.paginatorOptions?.showFirstLastButtons ||\n        this.showFirstLastButtons;\n      this.hidePageSize =\n        this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.firstPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.firstPageLabel = label;\n        })\n    );\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.itemsPerPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.itemsPerPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.lastPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.lastPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.nextPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.nextPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.previousPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.previousPageLabel = label;\n        })\n    );\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.of')\n        .subscribe((label: string) => {\n          of.next(label);\n        })\n    );\n    if (length === 0 || pageSize === 0) {\n      return `0 ${of.value} ${length}`;\n    }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex =\n      startIndex < length\n        ? Math.min(startIndex + pageSize, length)\n        : startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  };\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map((sub) => sub.unsubscribe());\n    if (this.count$$) {\n      this.count$$.unsubscribe();\n    }\n    if (this.entitySortChange$$) {\n      this.entitySortChange$$.unsubscribe();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator\n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\"\n>\n</mat-paginator>\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]',\n  standalone: true\n})\nexport class EntityTableRowDirective {\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n    if (value === this._selected) {\n      return;\n    }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","<div class=\"table-container\" [ngStyle]=\"{ height: tableHeight }\">\n  <table\n    id=\"currentWorkspaceTable\"\n    mat-table\n    matSort\n    [ngClass]=\"getTableClass()\"\n    [dataSource]=\"dataSource\"\n    [trackBy]=\"getTrackByFunction()\"\n    (matSortChange)=\"onSort($event)\"\n  >\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n      <th mat-header-cell *matHeaderCellDef>\n        <ng-container *ngIf=\"selectMany\">\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n            <mat-checkbox\n              (change)=\"onToggleRows($event.checked)\"\n              [checked]=\"selectionState === entityTableSelectionState.All\"\n              [indeterminate]=\"\n                selectionState === entityTableSelectionState.Some\n              \"\n            >\n            </mat-checkbox>\n          </ng-container>\n        </ng-container>\n      </th>\n      <td mat-cell *matCellDef=\"let row\">\n        <mat-checkbox\n          (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\n          (click)=\"\n            $event.shiftKey\n              ? onShiftToggleRow(!rowIsSelected(row.record), row.record, $event)\n              : $event.stopPropagation()\n          \"\n          (change)=\"onToggleRow($event.checked, row.record)\"\n          [checked]=\"rowIsSelected(row.record)\"\n        >\n        </mat-checkbox>\n      </td>\n    </ng-container>\n\n    <ng-container\n      [matColumnDef]=\"column.name\"\n      *ngFor=\"let column of template.columns\"\n    >\n      <ng-container *ngIf=\"columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          mat-sort-header\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlDefault\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              {{ row.cellData[column.name].value }}\n            </td>\n            <ng-template #isAnUrlDefault>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"row.cellData[column.name].class\"\n              >\n                <a\n                  href=\"{{ row.cellData[column.name].value }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                    src=\"{{\n                      row.cellData[column.name].value | secureImage | async\n                    }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.common.entity-table.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlHTML\"\n              [ngClass]=\"row.cellData[column.name].class\"\n              [innerHTML]=\"row.cellData[column.name].value\"\n            ></td>\n            <ng-template #isAnUrlHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"row.cellData[column.name].class\"\n              >\n                <a\n                  href=\"{{ row.cellData[column.name].value }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                    src=\"{{\n                      row.cellData[column.name].value | secureImage | async\n                    }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text edition\"\n              [formGroup]=\"formGroup\"\n              *ngIf=\"isEdition(row.record); else isUnsanitizedHTML\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                <mat-datepicker-toggle\n                  matSuffix\n                  [for]=\"picker\"\n                ></mat-datepicker-toggle>\n                <input\n                  matInput\n                  [matDatepicker]=\"picker\"\n                  [formControlName]=\"column.name\"\n                  value=\"{{ row.cellData[column.name].value }}\"\n                  (dateChange)=\"onDateChange(column.name, row.record, $event)\"\n                />\n                <mat-datepicker #picker></mat-datepicker>\n              </div>\n              <input\n                matInput\n                type=\"time\"\n                *ngIf=\"column.type === 'time'\"\n                [formControlName]=\"column.name\"\n                step=\"900\"\n                (focus)=\"column.onFocus($event)\"\n                (keypress)=\"column.onChange($event)\"\n                (blur)=\"column.onBlur($event)\"\n              />\n              <input\n                matInput\n                type=\"number\"\n                class=\"class_number_edition\"\n                *ngIf=\"column.type === 'number'\"\n                [formControlName]=\"column.name\"\n                step=\"{{ column.step }}\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                (input)=\"onValueChange(column.name, row.record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                min=\"{{ getValidationAttributeValue(column, 'minValue') }}\"\n                max=\"{{ getValidationAttributeValue(column, 'maxValue') }}\"\n              />\n              <input\n                matInput\n                type=\"text\"\n                *ngIf=\"!column.type || column.type === 'string'\"\n                [formControlName]=\"column.name\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                (input)=\"onValueChange(column.name, row.record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n              />\n              <mat-checkbox\n                *ngIf=\"column.type === 'boolean'\"\n                [formControlName]=\"column.name\"\n                [checked]=\"row.cellData[column.name].value\"\n                (change)=\"onBooleanValueChange(column.name, row.record, $event)\"\n              ></mat-checkbox>\n              <mat-select\n                *ngIf=\"column.type === 'list'\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                [formControlName]=\"column.name\"\n                [multiple]=\"column.multiple\"\n                (selectionChange)=\"\n                  onSelectValueChange(column.name, row.record, $event)\n                \"\n                [value]=\"row.cellData[column.name].value\"\n              >\n                <mat-option\n                  *ngFor=\"let option of column.domainValues\"\n                  [value]=\"option.id\"\n                  [disabled]=\"option.disabled\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-select>\n              <input\n                matInput\n                type=\"text\"\n                [formControlName]=\"column.name\"\n                *ngIf=\"column.type === 'autocomplete'\"\n                [matAutocomplete]=\"auto\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n              />\n              <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"\n                  onAutocompleteValueChange(column, row.record, $event)\n                \"\n                panelWidth=\"430px\"\n              >\n                <mat-option\n                  *ngFor=\"let option of filteredOptions[column.name] | async\"\n                  [value]=\"option.id\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-autocomplete>\n            </td>\n            <ng-template #isUnsanitizedHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                *ngIf=\"\n                  !row.cellData[column.name].isUrl;\n                  else isAnUrlUnsanitizedHTML\n                \"\n                [ngClass]=\"row.cellData[column.name].class\"\n                [innerHTML]=\"row.cellData[column.name].value | sanitizeHtml\"\n              ></td>\n              <ng-template #isAnUrlUnsanitizedHTML>\n                <td\n                  mat-cell\n                  class=\"mat-cell-text\"\n                  [ngClass]=\"row.cellData[column.name].class\"\n                >\n                  <a\n                    href=\"{{ row.cellData[column.name].value }}\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    (click)=\"$event.stopPropagation()\"\n                  >\n                    <img\n                      igoImageError\n                      *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                      src=\"{{\n                        row.cellData[column.name].value | secureImage | async\n                      }}\"\n                      width=\"50\"\n                      heigth=\"auto\"\n                    />\n                    <ng-template #notImg\n                      ><span\n                        >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                      </span></ng-template\n                    >\n                  </a>\n                </td>\n              </ng-template>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"row.cellData[column.name].class\"\n          >\n            <mat-icon *ngIf=\"column.onClick\" (click)=\"column.onClick($event)\">{{\n              row.cellData[column.name].value || column.icon\n            }}</mat-icon>\n            <mat-icon *ngIf=\"!column.onClick\">{{\n              row.cellData[column.name].value || column.icon\n            }}</mat-icon>\n          </td>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              <span *ngFor=\"let button of row.cellData[column.name].value\">\n                <ng-container\n                  *ngIf=\"\n                    isEdition(row.record) === button.editMode ||\n                    button.editMode === undefined\n                  \"\n                >\n                  <button\n                    *ngIf=\"button.style === 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-icon-button\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon>{{ button.icon }}</mat-icon>\n                  </button>\n                  <button\n                    *ngIf=\"button.style !== 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-mini-fab\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon>{{ button.icon }}</mat-icon>\n                  </button>\n                </ng-container>\n              </span>\n            </td>\n          </ng-container>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      mat-header-row\n      *matHeaderRowDef=\"headers; sticky: fixedHeader\"\n      [ngClass]=\"getHeaderClass()\"\n    ></tr>\n    <tr\n      mat-row\n      igoEntityTableRow\n      *matRowDef=\"let row; columns: headers\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [ngClass]=\"getRowClass(row.record)\"\n      [selection]=\"selection\"\n      [selected]=\"rowIsSelected(row.record)\"\n      (select)=\"onRowSelect(row.record)\"\n      (click)=\"onRowClick(row.record)\"\n    ></tr>\n  </table>\n  <igo-entity-table-paginator\n    *ngIf=\"withPaginator\"\n    [store]=\"store\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [entitySortChange$]=\"entitySortChange$\"\n    (paginatorChange)=\"paginatorChange($event)\"\n  >\n  </igo-entity-table-paginator>\n</div>\n","import { FocusMonitor } from '@angular/cdk/a11y';\nimport { AsyncPipe, NgClass, NgFor, NgIf, NgStyle } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Output,\n  Self,\n  SimpleChanges,\n  TrackByFunction\n} from '@angular/core';\nimport {\n  FormControlName,\n  FormsModule,\n  NgControl,\n  NgForm,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { provideMomentDateAdapter } from '@angular/material-moment-adapter';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport {\n  DateAdapter,\n  ErrorStateMatcher,\n  MatNativeDateModule,\n  MatOptionModule\n} from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport {\n  MatFormFieldControl,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableDataSource, MatTableModule } from '@angular/material/table';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StringUtils } from '@igo2/utils';\n\nimport { default as moment } from 'moment';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { EntityTablePaginatorComponent } from '../entity-table-paginator/entity-table-paginator.component';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableScrollBehavior,\n  EntityTableSelectionState,\n  EntityTableTemplate\n} from '../shared';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\n\ninterface CellData {\n  [key: string]: {\n    value: any;\n    class: { [key: string]: boolean };\n    isUrl: boolean;\n    isImg: boolean;\n  };\n}\n\ninterface RowData {\n  record: EntityRecord<object, EntityState>;\n  cellData: CellData;\n}\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    { provide: MatFormFieldControl, useExisting: EntityTableComponent },\n    provideMomentDateAdapter()\n  ],\n  standalone: true,\n  imports: [\n    AsyncPipe,\n    EntityTablePaginatorComponent,\n    EntityTableRowDirective,\n    FormsModule,\n    ImageErrorDirective,\n    MatAutocompleteModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatDatepickerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatInputModule,\n    MatNativeDateModule, // For the DateAdapter provider\n    MatOptionModule,\n    MatSelectModule,\n    MatSortModule,\n    MatTableModule,\n    MatTooltipModule,\n    NgClass,\n    NgFor,\n    NgIf,\n    NgStyle,\n    ReactiveFormsModule,\n    SanitizeHtmlPipe,\n    SecureImagePipe,\n    StopPropagationDirective,\n    IgoLanguageModule\n  ]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\n\n  public filteredOptions = {};\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> =\n    new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{\n    column: EntityTableColumn;\n    direction: string;\n  }> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<RowData>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean {\n    return this.template.selection || false;\n  }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean {\n    return this.template.selectionCheckbox || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean {\n    return this.template.selectMany || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean {\n    return this.template.fixedHeader === undefined\n      ? true\n      : this.template.fixedHeader;\n  }\n\n  get tableHeight(): string {\n    return this.template.tableHeight ? this.template.tableHeight : 'auto';\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private formBuilder: UntypedFormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n    this.store.state.change$.pipe(debounceTime(100)).subscribe(() => {\n      this.handleDatasource();\n      this.refresh();\n    });\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(\n    column: EntityTableColumn,\n    record: EntityRecord<any>,\n    event\n  ) {\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = 'YYYY-MM-DD';\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach((column) => {\n      column.title =\n        column.validation?.mandatory && !column.title.includes('*')\n          ? column.title + ' *'\n          : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control([item[key]])\n          );\n        } else {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control(item[key])\n          );\n\n          typeof item[key] === 'string'\n            ? this.formGroup.controls[column.name].setValue(parseInt(item[key]))\n            : this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n\n        this.filteredOptions[column.name] = new Observable<any[]>();\n        this.filteredOptions[column.name] = this.formGroup.controls[\n          column.name\n        ].valueChanges.pipe(\n          map((value) => {\n            if (value?.length) {\n              return column.domainValues?.filter((option) => {\n                const filterNormalized = value\n                  ? value\n                      .toLowerCase()\n                      .normalize('NFD')\n                      .replace(/[\\u0300-\\u036f]/g, '')\n                  : '';\n                const featureNameNormalized = option.value\n                  .toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach((option) => {\n          if (\n            typeof formControlValue === 'string' &&\n            StringUtils.isValidNumber(formControlValue) &&\n            !StringUtils.isOctalNumber(formControlValue)\n          ) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (\n            option.value === formControlValue ||\n            option.id === formControlValue\n          ) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible !== false) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(item[key])\n            );\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(null)\n            );\n          }\n        }\n      } else {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      }\n\n      if (\n        this.formGroup.controls[column.name] &&\n        this.getValidationAttributeValue(column, 'readonly')\n      ) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView\n          .all()\n          .indexOf(firstSelected);\n        const pageMax = this.paginator\n          ? this.paginator.pageSize * (this.paginator.pageIndex + 1)\n          : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n            firstSelectedStateviewPosition >= pageMax)\n        ) {\n          const pageToReach = Math.floor(\n            firstSelectedStateviewPosition / this.paginator.pageSize\n          );\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all.map((record) => {\n        return {\n          record,\n          cellData: this.template.columns.reduce(\n            (cellData: CellData, column) => {\n              const value = this.getValue(record, column);\n              cellData[column.name] = {\n                class: this.getCellClass(record, column),\n                value,\n                isUrl: this.isUrl(value),\n                isImg: this.isImg(value)\n              };\n              return cellData;\n            },\n            {}\n          )\n        };\n      });\n    });\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction(): TrackByFunction<RowData> {\n    return (_index, row) => row.record.ref;\n  }\n  /**\n   * Trigger a refresh of the table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: { active: string; direction: string }) {\n    const direction = event.direction;\n    const column = this.template.columns.find(\n      (c: EntityTableColumn) => c.name === event.active\n    );\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) =>\n          this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({ column, direction });\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    this.store.state.update(entity, { selected: true }, true);\n    this.entitySelectChange.emit({ added: [entity] });\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entities = this.store.view.all();\n    this.entitySelectChange.emit({ added: [entities] });\n    this.store.state.updateMany(entities, { selected: toggle });\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, { selected: toggle }, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: [entity] });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(\n    toggle: boolean,\n    record: EntityRecord<object>,\n    event: MouseEvent\n  ) {\n    if (this.selection === false) {\n      return;\n    }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(\n      this.lastRecordCheckedKey\n    );\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(\n      Math.min(...indexes),\n      Math.max(...indexes) + 1\n    );\n\n    const entities = selectRecords.map(\n      (_record: EntityRecord<object>) => _record.entity\n    );\n    this.store.state.updateMany(entities, { selected: toggle });\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: entities });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(\n    selectedRecords: EntityRecord<object>[]\n  ): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0\n      ? states.None\n      : selectionCount === this.store.stateView.count\n        ? states.All\n        : states.Some;\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !==\n        -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number') {\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)) {\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string'\n          ? (list_id = value.match(/[\\w.-]+/g).map(Number))\n          : (list_id = value);\n        let list_option = [];\n\n        column.domainValues.forEach((option) => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? (value = list_id) : (value = list_option);\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value =\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ];\n        } else {\n          column.domainValues.forEach((option) => {\n            if (\n              typeof value === 'string' &&\n              StringUtils.isValidNumber(value) &&\n              !StringUtils.isOctalNumber(value)\n            ) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record)\n                ? (value = option.id)\n                : (value = option.value);\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value =\n          entity?.properties[\n            this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n          ];\n      } else {\n        column.domainValues.forEach((option) => {\n          if (\n            typeof value === 'string' &&\n            StringUtils.isValidNumber(value) &&\n            !StringUtils.isOctalNumber(value)\n          ) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = '';\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(\n    column: EntityTableColumn,\n    validationType: string\n  ): any {\n    if (\n      column.validation !== undefined &&\n      column.validation[validationType] !== undefined\n    ) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): { [key: string]: boolean } {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): { [key: string]: boolean } {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): { [key: string]: boolean } {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(\n    record: EntityRecord<object>,\n    column: EntityTableColumn\n  ): { [key: string]: boolean } {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n}\n","import {\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { Subscription } from 'rxjs';\n\nimport { FlexibleDirection, FlexibleState } from './flexible.type';\n\n@Component({\n  selector: 'igo-flexible',\n  templateUrl: './flexible.component.html',\n  styleUrls: ['./flexible.component.scss'],\n  standalone: true\n})\nexport class FlexibleComponent implements OnInit, OnDestroy {\n  static transitionTime = 250;\n\n  @ViewChild('flexibleMain', { static: true }) main;\n\n  @Input()\n  get initial(): string {\n    return this._initial;\n  }\n  set initial(value: string) {\n    this._initial = value;\n  }\n  private _initial = '0';\n\n  @Input()\n  get collapsed(): string {\n    return this._collapsed;\n  }\n  set collapsed(value: string) {\n    this._collapsed = value;\n  }\n  private _collapsed = '0';\n\n  @Input()\n  get expanded(): string {\n    return this._expanded;\n  }\n  set expanded(value: string) {\n    this._expanded = value;\n  }\n  private _expanded = '100%';\n\n  @Input()\n  get initialMobile(): string {\n    return this._initialMobile;\n  }\n  set initialMobile(value: string) {\n    this._initialMobile = value;\n  }\n  private _initialMobile: string = this.expanded;\n\n  @Input()\n  get collapsedMobile(): string {\n    return this._collapsedMobile;\n  }\n  set collapsedMobile(value: string) {\n    this._collapsedMobile = value;\n  }\n  private _collapsedMobile: string = this.collapsed;\n\n  @Input()\n  get expandedMobile(): string {\n    return this._expandedMobile;\n  }\n  set expandedMobile(value: string) {\n    this._expandedMobile = value;\n  }\n  private _expandedMobile: string = this.expanded;\n\n  @Input()\n  get direction(): FlexibleDirection {\n    return this._direction;\n  }\n  set direction(value: FlexibleDirection) {\n    this._direction = value;\n  }\n  private _direction: FlexibleDirection = 'column';\n\n  @Input()\n  get state(): FlexibleState {\n    return this._state;\n  }\n  set state(value: FlexibleState) {\n    const sizes = {\n      initial: this.initial,\n      collapsed: this.collapsed,\n      expanded: this.expanded\n    };\n\n    if (this.mediaService.isMobile()) {\n      Object.assign(sizes, {\n        initial: this.initialMobile,\n        collapsed: this.collapsedMobile,\n        expanded: this.expandedMobile\n      });\n    }\n\n    const size = sizes[value];\n    if (size !== undefined) {\n      this.setSize(size);\n      setTimeout(() => {\n        this._state = value;\n      }, FlexibleComponent.transitionTime);\n    }\n  }\n  private _state: FlexibleState = 'initial';\n\n  private mediaService$$: Subscription;\n\n  constructor(\n    private el: ElementRef,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnInit() {\n    this.el.nativeElement.className += this.direction;\n\n    // Since this component supports different sizes\n    // on mobile, force a redraw when the media changes\n    this.mediaService$$ = this.mediaService.media$.subscribe(\n      (media: Media) => (this.state = this.state)\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  private setSize(size: string) {\n    this._state = 'transition';\n\n    if (this.direction === 'column') {\n      this.main.nativeElement.style.height = size;\n    } else if (this.direction === 'row') {\n      this.main.nativeElement.style.width = size;\n    }\n  }\n}\n","<div #flexibleMain class=\"igo-flexible-main {{ state }} {{ direction }}\">\n  <div class=\"igo-container\">\n    <ng-content></ng-content>\n  </div>\n</div>\n<div class=\"igo-flexible-fill\">\n  <div>\n    <div class=\"igo-container\">\n      <ng-content select=\"[igoFlexibleFill]\"></ng-content>\n    </div>\n  </div>\n</div>\n","<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\"\n  >\n  </igo-dynamic-outlet>\n</ng-container>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\n\nimport { DynamicOutletComponent } from '@igo2/common/dynamic-component';\n\nimport { getDefaultErrorMessages } from '../shared';\nimport { FormFieldService } from '../shared/form-field.service';\nimport {\n  FormField,\n  FormFieldInputs,\n  FormFieldOptions,\n  FormFieldSubscribers\n} from '../shared/form.interfaces';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, DynamicOutletComponent]\n})\nexport class FormFieldComponent {\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: FormFieldSubscribers = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): FormFieldSubscribers {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgClass } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { t } from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [FormsModule, ReactiveFormsModule, NgClass]\n})\nexport class FormComponent implements OnChanges {\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any };\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{ [key: string]: any }>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any } {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: { [key: string]: any }) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(\n    data: { [key: string]: any },\n    field: FormField\n  ) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n}\n","<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\"\n>\n  <div\n    class=\"igo-form-body\"\n    [ngClass]=\"{ 'igo-form-body-with-buttons': hasButtons }\"\n  >\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { FormFieldService } from './form-field.service';\n\nexport function IgoFormFieldComponent(type: string): (cls: any) => any {\n  return (compType: any) => {\n    FormFieldService.register(type, compType);\n  };\n}\n","<mat-form-field>\n  <mat-select\n    [multiple]=\"multiple\"\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n    <mat-option *ngFor=\"let choice of choices$ | async\" [value]=\"choice.value\">\n      {{ choice.title }}\n    </mat-option>\n  </mat-select>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport { FormFieldSelectChoice } from '../shared/form.interfaces';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a select field\n */\n@IgoFormFieldComponent('select')\n@Component({\n  selector: 'igo-form-field-select',\n  templateUrl: './form-field-select.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatSelectModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    NgIf,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldSelectComponent implements OnInit {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Select input choices\n   */\n  @Input()\n  set choices(value: FormFieldSelectChoice[]) {\n    this.choices$.next(value);\n  }\n  get choices(): FormFieldSelectChoice[] {\n    return this.choices$.value;\n  }\n  readonly choices$: BehaviorSubject<FormFieldSelectChoice[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * If the select allow multiple selections\n   */\n  @Input() multiple: boolean = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","<mat-form-field>\n  <input\n    matInput\n    (blur)=\"delayedHide(0)\"\n    [type]=\"isPassword ? (hide ? 'password' : 'text') : 'text'\"\n    [required]=\"isPassword ? 'true' : required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n    (change)=\"delayedHide()\"\n  />\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n\n  <button\n    type=\"button\"\n    *ngIf=\"isPassword\"\n    matSuffix\n    mat-icon-button\n    (click)=\"togglePassword()\"\n  >\n    <mat-icon color=\"primary\">{{\n      hide ? 'visibility_off' : 'visibility'\n    }}</mat-icon>\n  </button>\n\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a text field\n */\n@IgoFormFieldComponent('text')\n@Component({\n  selector: 'igo-form-field-text',\n  templateUrl: './form-field-text.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldTextComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  hide: boolean = true;\n  private lastTimeoutRequest;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * if the input is a password\n   */\n  @Input() isPassword: boolean;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n\n  togglePassword() {\n    this.hide = !this.hide;\n    this.delayedHide();\n  }\n  delayedHide(delayMS: number = 10000) {\n    if (this.isPassword && !this.hide) {\n      if (this.lastTimeoutRequest) {\n        clearTimeout(this.lastTimeoutRequest);\n      }\n      this.lastTimeoutRequest = setTimeout(() => {\n        this.hide = true;\n        this.cdRef.detectChanges();\n      }, delayMS);\n    }\n  }\n}\n","<mat-form-field>\n  <textarea\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n  </textarea>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a textarea field\n */\n@IgoFormFieldComponent('textarea')\n@Component({\n  selector: 'igo-form-field-textarea',\n  templateUrl: './form-field-textarea.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldTextareaComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","import { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\nimport { FormFieldComponent } from './form-field.component';\n\nexport const FORM_FIELD_DIRECTIVES = [\n  FormFieldComponent,\n  FormFieldSelectComponent,\n  FormFieldTextComponent,\n  FormFieldTextareaComponent\n] as const;\n","<div *ngIf=\"group && group.fields.length > 0\" class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\"\n  >\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{\n  getErrorMessage() | translate\n}}</mat-error>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { UntypedFormGroup } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { FormFieldComponent } from '../form-field/form-field.component';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getControlErrorMessage } from '../shared/form.utils';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    NgClass,\n    FormFieldComponent,\n    MatFormFieldModule,\n    IgoLanguageModule\n  ]\n})\nexport class FormGroupComponent {\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Form group control\n   */\n  get formControl(): UntypedFormGroup {\n    return this.group.control;\n  }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): { [key: string]: boolean } {\n    const colspan = this.getFieldColSpan(field);\n    return { [`igo-form-field-colspan-${colspan}`]: true };\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { UntypedFormBuilder, ValidatorFn, Validators } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n  constructor(private formBuilder: UntypedFormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return { fields, groups, control };\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, { fields, control }) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({ type: 'text' }, config, { control }) as FormField;\n  }\n\n  extendFieldConfig(\n    config: FormFieldConfig,\n    partial: Partial<FormFieldConfig>\n  ): FormFieldConfig {\n    const options = Object.assign(\n      {},\n      config.options || {},\n      partial.options || {}\n    );\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign(\n      {},\n      config.subscribers || {},\n      partial.subscribers || {}\n    );\n    return Object.assign({}, config, { options, inputs, subscribers });\n  }\n\n  private getValidators(\n    validatorOption: string | string[] | ValidatorFn\n  ): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n}\n","<h1 mat-dialog-title>{{ data.title | translate }}</h1>\n\n<igo-form\n  *ngIf=\"form$ | async as form\"\n  [form]=\"form\"\n  [formData]=\"data$ | async\"\n  (submitForm)=\"onSubmit($event)\"\n>\n  <div *ngIf=\"form.fields.length\" class=\"form-dialog-container\">\n    <igo-form-field\n      *ngFor=\"let field of form.fields\"\n      [field]=\"field\"\n    ></igo-form-field>\n    <igo-form-group\n      *ngFor=\"let group of form.groups\"\n      [group]=\"group\"\n    ></igo-form-group>\n  </div>\n\n  <div formButtons mat-dialog-actions>\n    <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"cancel()\">\n      {{ data.cancelButtonText | translate }}\n    </button>\n    <button mat-flat-button type=\"submit\" color=\"primary\">\n      {{ data.processButtonText | translate }}\n    </button>\n  </div>\n</igo-form>\n<div>\n  <igo-custom-html\n    *ngIf=\"data.notice && data.notice !== ''\"\n    [html]=\"data.notice\"\n  >\n  </igo-custom-html>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FormComponent } from '../form';\nimport { FormFieldComponent } from '../form-field';\nimport { FormGroupComponent } from '../form-group';\nimport {\n  Form,\n  FormField,\n  FormFieldGroup,\n  FormFieldInputs,\n  FormService\n} from '../shared';\nimport { FormDialogData } from './form-dialog.interface';\n\n@Component({\n  selector: 'igo-form-dialog',\n  templateUrl: './form-dialog.component.html',\n  styleUrls: ['./form-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    NgIf,\n    FormComponent,\n    NgFor,\n    FormFieldComponent,\n    FormGroupComponent,\n    MatDialogActions,\n    MatButtonModule,\n    CustomHtmlComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormDialogComponent {\n  form$ = new BehaviorSubject<Form>(undefined);\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n  constructor(\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<FormDialogComponent>,\n    private formService: FormService,\n    @Inject(MAT_DIALOG_DATA)\n    public data: FormDialogData\n  ) {\n    this.data.processButtonText =\n      this.data.processButtonText ?? 'igo.common.formDialog.processButtonText';\n    this.data.cancelButtonText =\n      this.data.cancelButtonText ?? 'igo.common.formDialog.cancelButtonText';\n    this.data.title = this.data.title ?? 'igo.common.formDialog.title';\n    this.data$ = this.data.data$;\n\n    let fields: FormField<FormFieldInputs>[] = [];\n    let groups: FormFieldGroup[] = [];\n    this.data.formFieldConfigs?.map((config) =>\n      fields.push(this.formService.field(config))\n    );\n\n    this.data.formGroupsConfigs?.map((formGroupsConfig) => {\n      const fields = formGroupsConfig.formFieldConfigs?.map((config) =>\n        this.formService.field(config)\n      );\n      groups.push(\n        this.formService.group({ name: formGroupsConfig.name }, fields)\n      );\n    });\n    const form = this.formService.form(fields, groups);\n\n    this.form$.next(form);\n  }\n\n  onSubmit(data: { [key: string]: any }) {\n    const form = this.form$.getValue();\n    if (form.control.valid) {\n      this.dialogRef.close(data);\n    } else {\n      if (form.groups?.length) {\n        form.groups.map((group) => {\n          Object.keys(group.control.controls).map((k) => {\n            group.control.controls[k].markAsTouched();\n            group.control.controls[k].updateValueAndValidity();\n          });\n        });\n      } else {\n        form.fields.map((f) => {\n          f.control.markAsTouched();\n          f.control.updateValueAndValidity();\n        });\n      }\n    }\n  }\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { FormDialogComponent } from './form-dialog.component';\nimport {\n  FormDialogData,\n  FormDialogFormConfig,\n  FormDialogOptions\n} from './form-dialog.interface';\n\n@Injectable()\nexport class FormDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    formDialogConfig?: FormDialogFormConfig,\n    options?: FormDialogOptions\n  ): Observable<{ [key: string]: any }> {\n    const data: FormDialogData = {\n      formFieldConfigs: formDialogConfig.formFieldConfigs,\n      formGroupsConfigs: formDialogConfig.formGroupsConfigs,\n      ...options\n    };\n    const dialogRef = this.dialog.open(FormDialogComponent, {\n      disableClose: false,\n      data,\n      ...options\n    });\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { FormDialogComponent } from './form-dialog.component';\nimport { FormDialogService } from './form-dialog.service';\n\n/**\n * @deprecated import the FlexibleComponent directly\n */\n@NgModule({\n  imports: [MatDialogModule, FormDialogComponent],\n  exports: [FormDialogComponent],\n  providers: [FormDialogService]\n})\nexport class IgoFormDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoFormDialogModule> {\n    return {\n      ngModule: IgoFormDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n  static fields: { [key: string]: any } = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find(\n      (key: string) => {\n        return formControlIsRequired((control as any).controls[key]);\n      }\n    );\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): { [key: string]: string } {\n  return {\n    required: 'igo.common.form.errors.required',\n    email: 'igo.common.form.errors.email'\n  };\n}\n\nexport function getControlErrorMessage(\n  control: AbstractControl,\n  messages: { [key: string]: string }\n): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","import { IconSvg } from './icon.interface';\n\n/**\n * Source: https://pictogrammers.com/library/mdi/\n */\n\nexport const MICROSOFT_ICON: IconSvg = {\n  name: 'microsoft',\n  svg: `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>microsoft</title><path d=\"M2,3H11V12H2V3M11,22H2V13H11V22M21,3V12H12V3H21M21,22H12V13H21V22Z\" /></svg>\n`\n};\n\nexport const KEYBOARD_ESC_ICON: IconSvg = {\n  name: 'keyboard-esc',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>keyboard-esc</title><path d=\"M1 7H7V9H3V11H7V13H3V15H7V17H1V7M11 7H15V9H11V11H13C14.11 11 15 11.9 15 13V15C15 16.11 14.11 17 13 17H9V15H13V13H11C9.9 13 9 12.11 9 11V9C9 7.9 9.9 7 11 7M19 7H21C22.11 7 23 7.9 23 9V10H21V9H19V15H21V14H23V15C23 16.11 22.11 17 21 17H19C17.9 17 17 16.11 17 15V9C17 7.9 17.9 7 19 7Z\" /></svg>\n`\n};\n\nexport const ENGINE_ICON: IconSvg = {\n  name: 'engine',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>engine</title><path d=\"M7,4V6H10V8H7L5,10V13H3V10H1V18H3V15H5V18H8L10,20H18V16H20V19H23V9H20V12H18V8H12V6H15V4H7Z\" /></svg>\n`\n};\n\nexport const SELECTION_MARKER_ICON: IconSvg = {\n  name: 'selection-marker',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>selection-marker</title><path d=\"M2 4C2 2.89 2.9 2 4 2H7V4H4V7H2V4M22 4V7H20V4H17V2H20C21.1 2 22 2.89 22 4M2 20V17H4V20H7V22H4C2.9 22 2 21.11 2 20M10 2H14V4H10V2M10 20H14V22H10V20M2 10H4V14H2V10M18.5 13C20.4 13 22 14.6 22 16.5C22 19.1 18.5 23 18.5 23C18.5 23 15 19.1 15 16.5C15 14.6 16.6 13 18.5 13M18.5 17.8C19.2 17.8 19.8 17.2 19.7 16.6C19.7 16 19.1 15.4 18.5 15.4C17.9 15.4 17.3 15.9 17.3 16.6C17.3 17.2 17.8 17.8 18.5 17.8M20 10H22V12.34C21.42 11.84 20.74 11.45 20 11.23V10Z\" /></svg>\n`\n};\n\nexport const PRESENTATION_PLAY_ICON: IconSvg = {\n  name: 'presentation-play',\n  svg: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>presentation-play</title><path d=\"M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z\" /></svg>`\n};\n","import { Injectable } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { DomSanitizer } from '@angular/platform-browser';\n\nimport { IconSvg } from './icon.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class IconService {\n  constructor(\n    private iconRegistry: MatIconRegistry,\n    private sanitizer: DomSanitizer\n  ) {}\n\n  registerSvg(icon: IconSvg): void {\n    this.iconRegistry.addSvgIconLiteral(\n      icon.name,\n      this.sanitizer.bypassSecurityTrustHtml(icon.svg)\n    );\n  }\n}\n","import {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  makeEnvironmentProviders\n} from '@angular/core';\nimport { MatIconModule, MatIconRegistry } from '@angular/material/icon';\n\ntype MaterialSymbolStyle = 'outlined' | 'rounded' | 'sharp';\n\nexport function provideIcon(\n  style: MaterialSymbolStyle = 'outlined'\n): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    MatIconModule,\n    {\n      provide: APP_INITIALIZER,\n      useFactory: (iconRegistry: MatIconRegistry) => () =>\n        iconRegistry.setDefaultFontSetClass(`material-symbols-${style}`),\n      deps: [MatIconRegistry],\n      multi: true\n    }\n  ]);\n}\n","@if (isSvg(icon)) {\n  <mat-icon [svgIcon]=\"icon.name\"></mat-icon>\n} @else {\n  <mat-icon>{{ icon }}</mat-icon>\n}\n","import { Component, Input } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IconSvg } from '../shared';\nimport { IconService } from '../shared/icon.service';\n\n@Component({\n  selector: 'igo-icon',\n  standalone: true,\n  imports: [MatIconModule],\n  templateUrl: './icon.component.html'\n})\nexport class IgoIconComponent {\n  @Input({ required: true })\n  set icon(icon: string | IconSvg) {\n    if (this.isSvg(icon)) {\n      this.registerSvg(icon);\n    }\n\n    this._icon = icon;\n  }\n  get icon(): string | IconSvg {\n    return this._icon;\n  }\n  private _icon: string | IconSvg;\n\n  constructor(private iconService: IconService) {}\n\n  registerSvg(icon: IconSvg): void {\n    this.iconService.registerSvg(icon);\n  }\n\n  isSvg(icon: string | IconSvg): icon is IconSvg {\n    return typeof icon != 'string';\n  }\n}\n","import { Directive, ElementRef, HostListener, Input } from '@angular/core';\n\n@Directive({\n  selector: '[igoImageError]',\n  standalone: true\n})\nexport class ImageErrorDirective {\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\n  @Input() hideError: boolean = false;\n\n  constructor(private el: ElementRef) {}\n\n  @HostListener('error', ['$event'])\n  public onError(event: any): void {\n    if (this.hideError) {\n      this.el.nativeElement.style.display = 'none';\n    } else {\n      event.target.src = this.errorImageUrl;\n    }\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Pipe, PipeTransform } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\n@Pipe({\n  name: 'secureImage',\n  standalone: true\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService\n  ) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false',\n      interceptError: 'false'\n    });\n\n    const regexDepot = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\n    );\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        catchError((err) => {\n          err.error.caught = true;\n          err.error.toDisplay = false;\n          throw err;\n        }),\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","<ng-container *ngIf=\"showTourButton\">\n  <button\n    *ngIf=\"styleButton === 'icon'; else raisedButton\"\n    (click)=\"startInteractiveTour()\"\n    [ngClass]=\"getClass()\"\n    color=\"primary\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      disabledTourButton\n        ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n          | translate)\n        : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n    \"\n    [disabled]=\"disabledTourButton\"\n  >\n    <igo-icon [icon]=\"presentationIcon\" iconPositionEnd />\n  </button>\n\n  <ng-template #raisedButton>\n    <button\n      (click)=\"startInteractiveTour()\"\n      [ngClass]=\"getClass()\"\n      color=\"primary\"\n      mat-raised-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"disabledTourButton\"\n    >\n      {{ 'igo.common.interactiveTour.buttonTitle' | translate }}\n      {{ discoverTitleInLocale$ | async | translate }}\n      <mat-icon\n        [svgIcon]=\"presentationIcon.name\"\n        iconPositionEnd\n        [matTooltip]=\"\n          disabledTourButton\n            ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n              | translate)\n            : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n        \"\n        >\n      </mat-icon>\n    </button>\n  </ng-template>\n</ng-container>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport { Component, Input, ViewEncapsulation } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IconService,\n  IgoIconComponent,\n  PRESENTATION_PLAY_ICON\n} from '@igo2/common/icon';\nimport { ToolService } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Observable, of } from 'rxjs';\n\nimport { InteractiveTourService } from './interactive-tour.service';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    NgClass,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class InteractiveTourComponent {\n  presentationIcon = PRESENTATION_PLAY_ICON;\n\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: 'icon' | 'raised';\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService,\n    private iconService: IconService\n  ) {\n    this.iconService.registerSvg(this.presentationIcon);\n  }\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { InteractiveTourOptions } from './interactive-tour.interface';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(\n    private http: HttpClient,\n    private configService: ConfigService\n  ) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n  public loadConfigTour() {\n    this.getJSON().subscribe(\n      (data) => {\n        this.allToursOptions = data;\n      },\n      (err) => {\n        throw new Error(\n          `Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`\n        );\n      }\n    );\n  }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { autoPlacement, offset } from '@floating-ui/dom';\nimport { ShepherdService } from 'angular-shepherd';\nimport Shepherd from 'shepherd.js';\n\nimport {\n  InteractiveTourAction,\n  InteractiveTourOptions,\n  InteractiveTourStep\n} from './interactive-tour.interface';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig(\n      'interactiveTour.activateInteractiveTour'\n    );\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n\n    return showInMobile === undefined ? true : showInMobile;\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (\n          self.getCurrentStep().options.attachTo.element &&\n          !document.querySelector(\n            self.getCurrentStep().options.attachTo.element\n          )\n        ) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll(\n              '.shepherd-content, .shepherd-text'\n            );\n            shepherdList.forEach((element) => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (\n        tour.getCurrentStep().options.attachTo.element &&\n        document.querySelector(tour.getCurrentStep().options.attachTo.element)\n      ) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (\n        nextStep.options.attachTo.element &&\n        !document.querySelector(nextStep.options.attachTo.element)\n      ) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(tourConfig: InteractiveTourOptions) {\n    const shepherdSteps: Shepherd.Step.StepOptions[] = [];\n\n    let i = 0;\n    for (const step of tourConfig.steps) {\n      const position = step.position ?? tourConfig.position;\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: position as any // PopperPlacement\n        },\n        floatingUIOptions: {\n          middleware: [\n            position === 'auto' && autoPlacement(),\n            offset({ mainAxis: 15 })\n          ].filter(Boolean)\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === tourConfig.steps.length\n              ? 'last'\n              : tourConfig.steps[i].noBackButton\n                ? 'noBackButton'\n                : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || tourConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || tourConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      } satisfies Shepherd.Step.StepOptions);\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) => {\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport { InteractiveTourService } from './interactive-tour.service';\n\n@NgModule({\n  imports: [InteractiveTourComponent],\n  exports: [InteractiveTourComponent],\n  providers: [InteractiveTourService, InteractiveTourLoader]\n})\nexport class IgoInteractiveTourModule {}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]',\n  standalone: true\n})\nexport class ListItemDirective {\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(\n    public renderer: Renderer2,\n    public el: ElementRef\n  ) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]',\n  standalone: true\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgClass } from '@angular/common';\nimport {\n  AfterViewInit,\n  Component,\n  ContentChildren,\n  ElementRef,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ClickoutDirective } from '@igo2/common/clickout';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss'],\n  standalone: true,\n  imports: [MatListModule, ClickoutDirective, NgClass]\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach((item) => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find((item) => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find((item) => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex((item) => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{ selectable: selection }\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\"\n>\n  <ng-content></ng-content>\n</mat-list>\n","<div\n  *ngIf=\"withHeader\"\n  class=\"igo-panel-header\"\n  title=\"\"\n  [ngClass]=\"{ 'igo-cursor-pointer': cursorPointer === true }\"\n>\n  <div class=\"panel-left\">\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n  </div>\n  <h3 class=\"igo-panel-title\">\n    {{ title }}\n    <ng-content select=\"[panelHeader]\"></ng-content>\n  </h3>\n  <div class=\"panel-right\">\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </div>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import { NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  HostBinding,\n  Input\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, NgClass]\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","import { AsyncPipe, NgClass } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatProgressSpinner } from '@angular/material/progress-spinner';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss'],\n  standalone: true,\n  imports: [NgClass, MatProgressSpinner, AsyncPipe]\n})\nexport class SpinnerComponent {\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) {\n    this.shown$.next(value);\n  }\n  get shown(): boolean {\n    return this.shown$.value;\n  }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{\n    'igo-spinner-container': true,\n    'igo-spinner-shown': (shown$ | async)\n  }\"\n>\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner\n    diameter=\"40\"\n    mode=\"indeterminate\"\n  ></mat-progress-spinner>\n</div>\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopDropPropagation]',\n  standalone: true\n})\nexport class StopDropPropagationDirective {\n  @HostListener('drop', ['$event'])\n  public onDrop(event: any): void {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]',\n  standalone: true\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import { EntityRecord, EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { Tool, ToolboxOptions } from './tool.interface';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n  private previousToolName: string;\n  private currentToolName: string;\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  getCurrentPreviousToolName(): [string, string] {\n    return [this.previousToolName, this.currentToolName];\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n\n      this.previousToolName = this.currentToolName;\n      this.currentToolName =\n        this.activeToolHistory[this.activeToolHistory.length - 1];\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(\n      Object.assign({}, tool, {\n        component: compType\n      } as Tool)\n    );\n  };\n}\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\"\n>\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container mat-body-1\"\n  [ngClass]=\"{\n    'igo-tool-container-with-toolbar': !actionStore.empty,\n    'igo-tool-container-with-animation': animate\n  }\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\"\n>\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\"\n  >\n  </igo-dynamic-outlet>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  HostBinding,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { Action, ActionStore, ActionbarComponent } from '@igo2/common/action';\nimport { DynamicOutletComponent } from '@igo2/common/dynamic-component';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Tool } from '../shared/tool.interface';\nimport { Toolbox } from '../shared/toolbox';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    ActionbarComponent,\n    NgClass,\n    DynamicOutletComponent,\n    AsyncPipe\n  ]\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  get isActive(): boolean {\n    return !!this.activeTool$.value;\n  }\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = 'white';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === 'grey';\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === 'primary';\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '@igo2/common/dynamic-component';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @deprecated import the WidgetOutletComponent directly\n */\n@NgModule({\n  imports: [WidgetOutletComponent],\n  exports: [WidgetOutletComponent]\n})\nexport class IgoWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\n\nimport { WidgetService } from './shared/widget.service';\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\n\n/**\n * @deprecated import the WidgetOutletComponent directly\n */\n@NgModule({\n  imports: [IgoWidgetOutletModule],\n  exports: [IgoWidgetOutletModule],\n  declarations: [],\n  providers: [WidgetService]\n})\nexport class IgoWidgetModule {}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\"\n>\n</igo-dynamic-outlet>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\n\nimport {\n  DynamicComponent,\n  DynamicOutletComponent\n} from '@igo2/common/dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, DynamicOutletComponent]\n})\nexport class WidgetOutletComponent implements OnDestroy {\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: { [key: string]: any };\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): { [key: string]: (event: any) => void } {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Workspace } from './workspace';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, { active: true, selected: true }, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n}\n","import { ActionStore } from '@igo2/common/action';\nimport { EntityStore } from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{ [key: string]: any }>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string {\n    return this.options.id;\n  }\n\n  /**\n   * Workspace title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Workspace title\n   */\n  get meta(): { [key: string]: any } {\n    return this.options.meta || {};\n  }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> {\n    return this.options.entityStore as EntityStore<E>;\n  }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore {\n    return this.options.actionStore;\n  }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget {\n    return this.widget$.value;\n  }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean {\n    return this.widget !== undefined;\n  }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView\n        .all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: { [key: string]: any } = {},\n    subscribers: { [key: string]: (event: any) => void } = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport {\n  EntitySelectorChange,\n  EntitySelectorComponent,\n  getEntityTitle\n} from '@igo2/common/entity';\n\nimport { WorkspaceStore } from '../shared/store';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [EntitySelectorComponent]\n})\nexport class WorkspaceSelectorComponent {\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: EntitySelectorChange<Workspace>) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({ selected: true, value: workspace });\n  }\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\"\n>\n</igo-entity-selector>\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\"\n  >\n  </igo-widget-outlet>\n</ng-container>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { Widget, WidgetOutletComponent } from '@igo2/common/widget';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, WidgetOutletComponent, AsyncPipe]\n})\nexport class WorkspaceWidgetOutletComponent {\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> {\n    return this.workspace.widget$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{ [key: string]: any }> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { Tool } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { Message, MessageService } from '@igo2/core/message';\nimport { RouteService } from '@igo2/core/route';\nimport { StorageService } from '@igo2/core/storage';\nimport type {\n  AnyLayerOptions,\n  IgoMap,\n  Layer,\n  VectorLayerOptions,\n  VectorTileLayerOptions\n} from '@igo2/geo';\nimport { ExportService } from '@igo2/geo';\nimport { ObjectUtils, uuid } from '@igo2/utils';\n\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { Geometry } from 'ol/geom';\nimport olPoint from 'ol/geom/Point';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Feature } from 'ol';\nimport { BehaviorSubject, Observable, Subject, of } from 'rxjs';\nimport {\n  catchError,\n  debounceTime,\n  first,\n  map,\n  mergeMap,\n  skip,\n  tap\n} from 'rxjs/operators';\n\nimport { TypePermission } from './context.enum';\nimport {\n  Context,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils,\n  ContextServiceOptions,\n  ContextsList,\n  DetailedContext,\n  ExtraFeatures\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return (\n      (this.storageService.get('favorite.context.uri') as string) ||\n      this._defaultContextUri ||\n      this.options.defaultContextUri\n    );\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private exportService: ExportService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url ?? '';\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context: DetailedContext = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$\n        .getValue()\n        .filter((lay) => !lay.id.includes('WfsWorkspaceTableDest'))\n        .sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const layer of layers) {\n      const layerOptions: AnyLayerOptions = {\n        title: layer.options.title,\n        zIndex: ++i,\n        visible: layer.visible,\n        security: layer.options.security,\n        opacity: layer.opacity\n      };\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions,\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return {\n        id: String(tool.id),\n        global: tool.global\n      } as Tool;\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string,\n    keepCurrentView?: boolean\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context: DetailedContext = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          keepCurrentView\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      // Do not seem to work properly. layerFound is always undefined.\n      const layerFound = currentContext.layers.find((contextLayer) => {\n        const source = contextLayer.source;\n        return source && layer.id === source.id && !contextLayer.baseLayer;\n      });\n      if (layerFound) {\n        let layerFoundAs = layerFound as\n          | VectorLayerOptions\n          | VectorTileLayerOptions;\n        let layerStyle = layerFoundAs.style;\n        if (layerFoundAs.igoStyle?.styleByAttribute) {\n          layerStyle = undefined;\n        } else if (layerFoundAs.igoStyle?.clusterBaseStyle) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        delete layerFound.source;\n        const opts: AnyLayerOptions = {\n          ...layerFound,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          style: layerStyle,\n          visible: layer.visible,\n          opacity: layer.opacity\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          (catalogLayer.visible = layer.visible),\n            (catalogLayer.opacity = layer.opacity);\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          const extraFeatures = this.getExtraFeatures(layer);\n          extraFeatures.name = layer.options.title;\n          extraFeatures.opacity = layer.opacity;\n          extraFeatures.visible = layer.visible;\n          context.extraFeatures.push(extraFeatures);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  private getExtraFeatures(layer: Layer): ExtraFeatures {\n    const writer = new GeoJSON();\n    let olFeatures: Feature<Geometry>[];\n    if (layer.ol.getSource() instanceof Cluster) {\n      const clusterSource = layer.ol.getSource() as Cluster;\n      olFeatures = clusterSource.getFeatures();\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    } else {\n      const source = layer.ol.getSource() as olVectorSource;\n      olFeatures = source.getFeatures();\n    }\n    const cleanedOlFeatures = this.exportService.generateFeature(\n      olFeatures,\n      'GeoJSON',\n      '_featureStore'\n    );\n    const features = writer.writeFeatures(cleanedOlFeatures, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:3857'\n    });\n    return JSON.parse(features);\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (\n      this.context$.value &&\n      context.uri &&\n      this.context$.value.uri !== context.uri\n    ) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map((message) => {\n      if (message) {\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(\n      'igo.context.contextManager.errors.addPermission',\n      'igo.context.contextManager.errors.addPermissionTitle'\n    );\n  }\n\n  private handleContextsChange(keepCurrentContext = true) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe((newContext: DetailedContext) => {\n          this.toolsChanged$.next(newContext);\n        });\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ExportNothingToExportError } from './context-export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextExportService {\n  export(res: DetailedContext): Observable<void> {\n    return this.exportAsync(res);\n  }\n\n  protected exportAsync(res: DetailedContext): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(res);\n      if (nothingToExport === true) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n      const contextJSON = JSON.stringify(res);\n      downloadContent(\n        contextJSON,\n        'text/json;charset=utf-8',\n        `${res.uri}.json`\n      );\n      observer.complete();\n    };\n    return new Observable(doExport);\n  }\n\n  protected nothingToExport(res: DetailedContext): boolean {\n    if (res.map === undefined) {\n      return true;\n    }\n    return false;\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","import { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  ClusterDataSourceOptions,\n  ClusterParam,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  QueryableDataSourceOptions,\n  StyleByAttribute,\n  StyleListService,\n  StyleService,\n  VectorLayer,\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '@igo2/geo';\n\nimport OlFeature from 'ol/Feature';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DetailedContext,\n  ExtraFeatures\n} from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  messageService.success(\n    'igo.context.contextImportExport.import.success.text',\n    'igo.context.contextImportExport.import.success.title',\n    undefined,\n    {\n      value: contextTitle\n    }\n  );\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.invalid.text',\n    'igo.context.contextImportExport.import.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    'igo.context.contextImportExport.import.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.unreadable.text',\n    'igo.context.contextImportExport.import.unreadable.title',\n    undefined,\n    {\n      value: file.name\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.empty.text',\n    'igo.context.contextImportExport.import.empty.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap\n): VectorLayer {\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n\n  let randomStyle;\n  let editable: boolean = false;\n  const featureKeys = olFeatures[0]?.getKeys() ?? [];\n  if (featureKeys.includes('_style') || featureKeys.includes('_mapTitle')) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    style: randomStyle,\n    visible: extraFeatures.visible,\n    opacity: extraFeatures.opacity\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (styleListService.getStyleList(extraFeatures.name + '.styleByAttribute')) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      extraFeatures.name + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(extraFeatures.name + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      extraFeatures.name + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(extraFeatures.name + '.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(extraFeatures.name + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.style'),\n        feature,\n        resolution\n      );\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n  let source;\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  if (styleListService.getStyleList(extraFeatures.name + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    style,\n    opacity: extraFeatures.opacity,\n    visible: extraFeatures.visible\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nfunction collectFeaturesFromExtraFeatures(\n  featureCollection: ExtraFeatures\n): OlFeature<OlGeometry>[] {\n  const format = new GeoJSON();\n  const features = format.readFeatures(featureCollection, {\n    dataProjection: 'EPSG:4326',\n    featureProjection: 'EPSG:3857'\n  });\n  return features;\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport {\n  ImportInvalidFileError,\n  ImportSizeError,\n  ImportUnreadableFileError\n} from './context-import.errors';\nimport { getFileExtension } from './context-import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextImportService {\n  static allowedMimeTypes = ['application/json'];\n\n  static allowedExtensions = 'json';\n\n  private clientSideFileSizeMax: number;\n\n  constructor(private config: ConfigService) {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(file: File): Observable<DetailedContext> {\n    return this.importAsync(file);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<DetailedContext>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [...ContextImportService.allowedMimeTypes];\n    const allowedExtensions = ContextImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      extension === ContextImportService.allowedExtensions\n    ) {\n      return this.importFile;\n    }\n    return undefined;\n  }\n\n  private importAsync(file: File): Observable<DetailedContext> {\n    const doImport = (observer: Observer<DetailedContext>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(file: File, observer: Observer<DetailedContext>) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const context = this.parseContextFromFile(file, event.target.result);\n        observer.next(context);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private parseContextFromFile(file: File, data: string): DetailedContext {\n    const context: DetailedContext = JSON.parse(data);\n    return context;\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"activeImportExport\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"activeImportExport === 'import'\">\n  <form class=\"igo-form\">\n    <div class=\"igo-form-button-group\">\n      <button\n        mat-raised-button\n        type=\"button\"\n        (click)=\"fileInput.click()\"\n        [disabled]=\"loading$ | async\"\n      >\n        {{ 'igo.geo.importExportForm.importButton' | translate }}\n      </button>\n      <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n      <input\n        #fileInput\n        type=\"file\"\n        [style.display]=\"'none'\"\n        (click)=\"fileInput.value = null\"\n        (change)=\"importFiles($any($event.target).files)\"\n      />\n    </div>\n  </form>\n  <section class=\"mat-typography\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n    </ul>\n  </section>\n</div>\n\n<form\n  class=\"igo-form\"\n  *ngIf=\"activeImportExport === 'export'\"\n  [formGroup]=\"form\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field class=\"example-full-width\">\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportContextName' | translate\n      }}</mat-label>\n      <input formControlName=\"name\" matInput [value]=\"\" />\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportPlaceHolder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.context.contextImportExport.export.exportSelectAll' | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{ 'igo.geo.importExportForm.exportButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n</form>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Layer, VectorLayer } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport { ContextExportService } from '../shared/context-export.service';\nimport { handleFileExportError } from '../shared/context-export.utils';\nimport { handleFileExportSuccess } from '../shared/context-export.utils';\nimport { ContextImportService } from '../shared/context-import.service';\nimport {\n  handleFileImportError,\n  handleFileImportSuccess\n} from '../shared/context-import.utils';\n\n@Component({\n  selector: 'igo-context-import-export',\n  templateUrl: './context-import-export.component.html',\n  styleUrls: ['./context-import-export.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    NgIf,\n    FormsModule,\n    MatButtonModule,\n    SpinnerComponent,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDividerModule,\n    NgFor,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ContextImportExportComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public inputProj: string = 'EPSG:4326';\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public res: DetailedContext;\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n  public activeImportExport: string = 'import';\n\n  private layers$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  constructor(\n    private contextImportService: ContextImportService,\n    private contextExportService: ContextExportService,\n    private messageService: MessageService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private contextService: ContextService\n  ) {\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.layerList = this.contextService.getContextLayers(this.map);\n      this.userControlledLayerList = this.layerList.filter(\n        (layer) => layer.showInLayerList\n      );\n    });\n  }\n\n  importFiles(files: File[]) {\n    this.loading$.next(true);\n    for (const file of files) {\n      this.contextImportService\n        .import(file)\n        .pipe(take(1))\n        .subscribe(\n          (context: DetailedContext) => this.onFileImportSuccess(file, context),\n          (error: Error) => this.onFileImportError(file, error),\n          () => {\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  handleExportFormSubmit(contextOptions) {\n    this.loading$.next(true);\n    this.res = this.contextService.getContextFromLayers(\n      this.map,\n      contextOptions.layers,\n      contextOptions.name,\n      false\n    );\n    this.res.imported = true;\n    this.contextExportService\n      .export(this.res)\n      .pipe(take(1))\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n          this.loading$.next(false);\n        }\n      );\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]],\n      name: ['', [Validators.required]]\n    });\n  }\n\n  private onFileImportSuccess(file: File, context: DetailedContext) {\n    handleFileImportSuccess(\n      file,\n      context,\n      this.messageService,\n      this.contextService\n    );\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    }\n    if (e._selected === false) {\n      this.form.controls.layers.setValue([]);\n    }\n  }\n\n  onImportExportChange(event) {\n    this.activeImportExport = event.value;\n  }\n\n  ngOnDestroy(): void {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { MessageService } from '@igo2/core/message';\n\nimport { ExportNothingToExportError } from './context-export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    this.handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.context.contextImportExport.export.failed.text',\n    'igo.context.contextImportExport.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.context.contextImportExport.export.success.text',\n    'igo.context.contextImportExport.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.context.contextImportExport.export.nothing.text',\n    'igo.context.contextImportExport.export.nothing.title'\n  );\n}\n","<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  (ngSubmit)=\"handleFormSubmit(form.value)\"\n>\n  <mat-form-field class=\"full-width\">\n    <input\n      matInput\n      required\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n      formControlName=\"title\"\n    />\n    <mat-error>\n      {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n    </mat-error>\n  </mat-form-field>\n\n  <mat-form-field id=\"uriInput\" class=\"full-width\">\n    <span *ngIf=\"prefix\" class=\"prefix\">{{ prefix }}-</span>\n    <span class=\"fieldWrapper\">\n      <input\n        matInput\n        maxlength=\"64\"\n        floatLabel=\"always\"\n        [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n        formControlName=\"uri\"\n      />\n    </span>\n  </mat-form-field>\n\n  <button\n    id=\"copyButton\"\n    type=\"button\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.context.contextManager.form.copy' | translate\"\n    color=\"primary\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon>content_copy</mat-icon>\n  </button>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid || disabled\"\n    >\n      {{ 'igo.context.contextManager.form.edit' | translate }}\n    </button>\n  </div>\n</form>\n","import { NgIf } from '@angular/common';\nimport { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Clipboard, ObjectUtils } from '@igo2/utils';\n\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-form',\n  templateUrl: './context-form.component.html',\n  styleUrls: ['./context-form.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ContextFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public prefix: string;\n\n  @Input()\n  get btnSubmitText(): string {\n    return this._btnSubmitText;\n  }\n  set btnSubmitText(value: string) {\n    this._btnSubmitText = value;\n  }\n  private _btnSubmitText: string;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.buildForm();\n  }\n  private _context: Context;\n\n  @Input()\n  get disabled(): boolean {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    this._disabled = value;\n  }\n  private _disabled = false;\n\n  // TODO: replace any by ContextOptions or Context\n  @Output() submitForm: EventEmitter<any> = new EventEmitter();\n  @Output() clone: EventEmitter<any> = new EventEmitter();\n  @Output() delete: EventEmitter<any> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n  }\n\n  public handleFormSubmit(value) {\n    let inputs = Object.assign({}, value);\n    inputs = ObjectUtils.removeNull(inputs);\n    inputs.uri = inputs.uri.replace(' ', '');\n    if (inputs.uri) {\n      inputs.uri = this.prefix + '-' + inputs.uri;\n    } else {\n      inputs.uri = this.prefix;\n    }\n    this.submitForm.emit(inputs);\n  }\n\n  public copyTextToClipboard() {\n    const text = this.prefix + '-' + this.form.value.uri.replace(' ', '');\n    const successful = Clipboard.copy(text);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.copyMsg',\n        'igo.context.contextManager.dialog.copyTitle'\n      );\n    }\n  }\n\n  private buildForm(): void {\n    const context: any = this.context || {};\n\n    const uriSplit = context.uri.split('-');\n    this.prefix = uriSplit.shift();\n    const uri = uriSplit.join('-');\n\n    this.form = this.formBuilder.group({\n      title: [context.title],\n      uri: [uri || ' ']\n    });\n  }\n}\n","<igo-context-form\n  *ngIf=\"context\"\n  [btnSubmitText]=\"'igo.context.contextManager.save' | translate\"\n  [context]=\"context\"\n  (submitForm)=\"submitForm.emit($event)\"\n>\n</igo-context-form>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { ContextFormComponent } from '../context-form/context-form.component';\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-edit',\n  templateUrl: './context-edit.component.html',\n  standalone: true,\n  imports: [NgIf, ContextFormComponent, IgoLanguageModule]\n})\nexport class ContextEditComponent {\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.refresh();\n  }\n  private _context: Context;\n\n  @Output() submitForm: EventEmitter<Context> = new EventEmitter();\n\n  constructor(private cd: ChangeDetectorRef) {}\n\n  refresh() {\n    this.cd.detectChanges();\n  }\n}\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{ 'mat-list-item-light': hidden }\"\n>\n  <button\n    *ngIf=\"auth.authenticated\"\n    matListItemAvatar\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"\n      auth.authenticated\n        ? ('igo.context.contextManager.favorite' | translate)\n        : ''\n    \"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon *ngIf=\"!context.iconImage\">{{\n      context.icon\n        ? context.icon\n        : context.scope === 'public'\n          ? 'public'\n          : 'star'\n    }}</mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\" />\n  </button>\n  <button\n    matListItemAvatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon>star</mat-icon>\n  </button>\n  <span matListItemTitle>{{ context.title }}</span>\n\n  <div\n    *ngIf=\"auth.authenticated\"\n    matListItemMeta\n    igoStopPropagation\n    class=\"igo-actions-container\"\n  >\n    <button\n      *ngIf=\"\n        collapsed &&\n        selected &&\n        (context.permission === typePermission[typePermission.write] ||\n          context.imported)\n      \"\n      class=\"save-button\"\n      mat-icon-button\n      [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n      matTooltipShowDelay=\"500\"\n      [color]=\"color\"\n      (click)=\"save.emit(context)\"\n    >\n      <mat-icon>save</mat-icon>\n    </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n      <button\n        *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.managePermissions' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\"\n      >\n        <mat-icon>manage_accounts</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\"\n      >\n        <mat-icon>content_copy</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] &&\n          !context.imported\n        \"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\"\n      >\n        <mat-icon>edit</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\"\n      >\n        <mat-icon>visibility</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\"\n      >\n        <mat-icon>visibility_off</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] ||\n          context.imported\n        \"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=\"collapsed\"\n      (click)=\"collapsed = !collapsed\"\n    >\n      <mat-icon>more_horiz</mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import { NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgClass,\n    NgIf,\n    MatButtonModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    MatIconModule,\n    CollapseDirective,\n    IgoLanguageModule\n  ]\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","import { Component } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html',\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.context.bookmarkButton.dialog.title' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input\n      matInput\n      required\n      autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"\n        'igo.context.bookmarkButton.dialog.placeholder' | translate\n      \"\n      [(ngModel)]=\"title\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-button\n    color=\"primary\"\n    [disabled]=\"!title\"\n    (click)=\"dialogRef.close(title)\"\n  >\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","<igo-list [navigation]=\"true\">\n  <div class=\"context-filter-container\">\n    <mat-form-field *ngIf=\"showFilter()\" floatLabel=\"always\">\n      <mat-label>{{\n        'igo.context.contextManager.filterPlaceHolder' | translate\n      }}</mat-label>\n      <input\n        matInput\n        type=\"text\"\n        [placeholder]=\"\n          'igo.context.contextManager.filterPlaceHolder' | translate\n        \"\n        [(ngModel)]=\"term\"\n      />\n      <button\n        mat-icon-button\n        matSuffix\n        class=\"clear-button\"\n        *ngIf=\"term.length\"\n        aria-label=\"Clear\"\n        color=\"warn\"\n        (click)=\"clearFilter()\"\n      >\n        <mat-icon>close</mat-icon>\n      </button>\n    </mat-form-field>\n\n    <div class=\"actions-container\">\n      <button\n        class=\"sort-alpha\"\n        [class.--active]=\"sortedAlpha\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.sortAlphabetically' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"toggleSort()\"\n      >\n        <mat-icon color=\"primary\">sort_by_alpha</mat-icon>\n      </button>\n\n      <igo-actionbar\n        *ngIf=\"auth.authenticated && contextConfigs\"\n        class=\"add-context-button\"\n        [iconColor]=\"color\"\n        [store]=\"actionStore\"\n        [withIcon]=\"true\"\n        icon=\"add\"\n        [withTitle]=\"actionbarMode === 'overlay'\"\n        [horizontal]=\"false\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <button\n        *ngIf=\"auth.authenticated && contextConfigs\"\n        class=\"users-filter\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n        matTooltipShowDelay=\"500\"\n        [matMenuTriggerFor]=\"accountMenu\"\n      >\n        <mat-icon color=\"primary\">fitler_alt</mat-icon>\n      </button>\n      <mat-menu #accountMenu=\"matMenu\">\n        <ng-container *ngFor=\"let user of users\">\n          <button\n            *ngIf=\"!user.childs; else withSubMenu\"\n            mat-menu-item\n            class=\"profil-menu\"\n          >\n            <mat-checkbox\n              [checked]=\"getPermission(user).checked\"\n              [indeterminate]=\"getPermission(user).indeterminate\"\n              (click)=\"$event.stopPropagation()\"\n              (change)=\"handleToggleCategory(user)\"\n            >\n            </mat-checkbox>\n            <span>{{ user.title }}</span>\n          </button>\n          <ng-template #withSubMenu>\n            <button\n              mat-menu-item\n              [matMenuTriggerFor]=\"subAccountMenu\"\n              class=\"profil-menu\"\n            >\n              <mat-checkbox\n                [checked]=\"getPermission(user).checked\"\n                [indeterminate]=\"getPermission(user).indeterminate\"\n                (click)=\"$event.stopPropagation()\"\n                (change)=\"handleToggleCategory(user)\"\n              >\n              </mat-checkbox>\n              <span>{{ user.title }}</span>\n            </button>\n\n            <mat-menu #subAccountMenu=\"matMenu\">\n              <button\n                mat-menu-item\n                *ngFor=\"let child of user.childs\"\n                class=\"profil-menu\"\n              >\n                <mat-checkbox\n                  [checked]=\"getPermission(child).checked\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"handleToggleCategory(child, user)\"\n                >\n                  {{ child.title }}\n                </mat-checkbox>\n              </button>\n            </mat-menu>\n          </ng-template>\n        </ng-container>\n\n        <button mat-menu-item class=\"profil-menu\">\n          <mat-checkbox\n            [checked]=\"showHidden\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"showHiddenContexts.emit()\"\n          >\n          </mat-checkbox>\n          <span>\n            {{ 'igo.context.contextManager.showHidden' | translate }}\n          </span>\n        </button>\n      </mat-menu>\n    </div>\n  </div>\n\n  <ng-template\n    ngFor\n    let-groupContexts\n    [ngForOf]=\"$any(contexts$ | async) | keyvalue\"\n  >\n    <igo-collapsible\n      *ngIf=\"$any(groupContexts).value.length && auth.authenticated\"\n      [title]=\"titleMapping[$any(groupContexts).key] | translate\"\n      [collapsed]=\"$any(collapsed[titleMapping[$any(groupContexts).key]])\"\n      (toggle)=\"collapsed[titleMapping[$any(groupContexts).key]] = $any($event)\"\n    >\n      <ng-template ngFor let-context [ngForOf]=\"$any(groupContexts).value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"\n            context.id &&\n            this.defaultContextId &&\n            this.defaultContextId === context.id\n          \"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\"\n        >\n        </igo-context-item>\n      </ng-template>\n    </igo-collapsible>\n\n    <ng-template\n      *ngIf=\"$any(groupContexts).value.length && !auth.authenticated\"\n      ngFor\n      let-context\n      [ngForOf]=\"$any(groupContexts).value\"\n    >\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"\n          configService.getConfig('favoriteContext4NonAuthenticated')\n        \"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"\n          contextConfigs\n            ? defaultContextId === context.id\n            : defaultContextId === context.uri\n        \"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\"\n      >\n      </igo-context-item>\n    </ng-template>\n  </ng-template>\n\n  <div *ngIf=\"isEmpty\" class=\"no-result\">\n    {{ 'igo.context.contextManager.noResult' | translate }}\n  </div>\n</igo-list>\n","import { AsyncPipe, KeyValuePipe, NgFor, NgIf } from '@angular/common';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport {\r\n  ActionStore,\r\n  ActionbarComponent,\r\n  ActionbarMode\r\n} from '@igo2/common/action';\r\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\r\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport { LanguageService } from '@igo2/core/language';\r\nimport { IgoLanguageModule } from '@igo2/core/language';\r\nimport { StorageService } from '@igo2/core/storage';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, ReplaySubject, Subscription, timer } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\r\nimport { ContextItemComponent } from '../context-item/context-item.component';\r\nimport {\r\n  ContextProfils,\r\n  ContextServiceOptions,\r\n  ContextUserPermission,\r\n  ContextsList,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextListControlsEnum } from './context-list.enum';\r\n\r\n@Component({\r\n  selector: 'igo-context-list',\r\n  templateUrl: './context-list.component.html',\r\n  styleUrls: ['./context-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  standalone: true,\r\n  imports: [\r\n    ListComponent,\r\n    NgIf,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    FormsModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    ActionbarComponent,\r\n    MatMenuModule,\r\n    NgFor,\r\n    MatCheckboxModule,\r\n    CollapsibleComponent,\r\n    ContextItemComponent,\r\n    ListItemDirective,\r\n    AsyncPipe,\r\n    KeyValuePipe,\r\n    IgoLanguageModule\r\n  ]\r\n})\r\nexport class ContextListComponent implements OnInit, OnDestroy {\r\n  public contextConfigs: ContextServiceOptions;\r\n  private contextsInitial: ContextsList = { ours: [] };\r\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\r\n    this.contextsInitial\r\n  );\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private change$$: Subscription;\r\n\r\n  @Input()\r\n  get contexts(): ContextsList {\r\n    return this._contexts;\r\n  }\r\n  set contexts(value: ContextsList) {\r\n    this._contexts = value;\r\n    this.next();\r\n  }\r\n  private _contexts: ContextsList = { ours: [] };\r\n\r\n  @Input() selectedContext: DetailedContext;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get defaultContextId(): string {\r\n    return this.contextConfigs\r\n      ? this._defaultContextId\r\n      : (this.storageService.get('favorite.context.uri') as string) ||\r\n          this._defaultContextId;\r\n  }\r\n  set defaultContextId(value: string) {\r\n    this._defaultContextId = value;\r\n  }\r\n  private _defaultContextId: string;\r\n\r\n  public collapsed: { contextScope }[] = [];\r\n\r\n  @Output() select = new EventEmitter<DetailedContext>();\r\n  @Output() unselect = new EventEmitter<DetailedContext>();\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n  @Output() filterPermissionsChanged = new EventEmitter<\r\n    ContextUserPermission[]\r\n  >();\r\n\r\n  public titleMapping = {\r\n    ours: 'igo.context.contextManager.ourContexts',\r\n    shared: 'igo.context.contextManager.sharedContexts',\r\n    public: 'igo.context.contextManager.publicContexts'\r\n  };\r\n\r\n  public users: ContextProfils[];\r\n  public permissions: ContextUserPermission[] = [];\r\n\r\n  public actionStore = new ActionStore([]);\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public color = 'primary';\r\n\r\n  public showHidden = false;\r\n\r\n  /**\r\n   * Context filter term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.next();\r\n  }\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  public _term: string = '';\r\n\r\n  get sortedAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortedAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha: boolean = undefined;\r\n\r\n  public showContextFilter = ContextListControlsEnum.always;\r\n\r\n  public thresholdToFilter = 5;\r\n\r\n  get isEmpty(): boolean {\r\n    return (\r\n      !this.contexts.ours.length &&\r\n      !this.contexts.public?.length &&\r\n      !this.contexts.shared?.length\r\n    );\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.contextConfigs = this.configService.getConfig('context');\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.change$$ = this.change$\r\n      .pipe(debounce(() => timer(50)))\r\n      .subscribe(() => {\r\n        this.contexts$.next(this.filterContextsList(this.contexts));\r\n      });\r\n\r\n    this.actionStore.load([\r\n      {\r\n        id: 'emptyContext',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContext'\r\n        ),\r\n        icon: 'star',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContextTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'contextFromMap',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMap'\r\n        ),\r\n        icon: 'map',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMapTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(false);\r\n        }\r\n      }\r\n    ]);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private filterContextsList(contexts: ContextsList): ContextsList {\r\n    if (this.term === '') {\r\n      if (this.sortedAlpha) {\r\n        contexts = this.sortContextsList(contexts);\r\n      }\r\n      return contexts;\r\n    } else {\r\n      const ours = contexts.ours.filter((context) => {\r\n        const filterNormalized = this.term\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const contextTitleNormalized = context.title\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        return contextTitleNormalized.includes(filterNormalized);\r\n      });\r\n\r\n      let updateContexts: ContextsList = {\r\n        ours\r\n      };\r\n\r\n      if (this.contexts.public) {\r\n        const publics = contexts.public.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.public = publics;\r\n      }\r\n\r\n      if (this.contexts.shared) {\r\n        const shared = contexts.shared.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.shared = shared;\r\n      }\r\n\r\n      if (this.sortedAlpha) {\r\n        updateContexts = this.sortContextsList(updateContexts);\r\n      }\r\n      return updateContexts;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  public showFilter() {\r\n    switch (this.showContextFilter) {\r\n      case ContextListControlsEnum.always:\r\n        return true;\r\n      case ContextListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        let totalLength = this.contexts.ours.length;\r\n        this.contexts.public\r\n          ? (totalLength += this.contexts.public.length)\r\n          : (totalLength += 0);\r\n        this.contexts.shared\r\n          ? (totalLength += this.contexts.shared.length)\r\n          : (totalLength += 0);\r\n        if (totalLength >= this.thresholdToFilter) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  sortContextsList(contexts: ContextsList) {\r\n    if (contexts) {\r\n      const contextsList = JSON.parse(JSON.stringify(contexts));\r\n      contextsList.ours.sort((a, b) => {\r\n        if (this.normalize(a.title) < this.normalize(b.title)) {\r\n          return -1;\r\n        }\r\n        if (this.normalize(a.title) > this.normalize(b.title)) {\r\n          return 1;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      if (contextsList.shared) {\r\n        contextsList.shared.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      } else if (contextsList.public) {\r\n        contextsList.public.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      }\r\n      return contextsList;\r\n    }\r\n  }\r\n\r\n  normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  toggleSort() {\r\n    this.sortedAlpha = !this.sortedAlpha;\r\n  }\r\n\r\n  clearFilter() {\r\n    this.term = '';\r\n  }\r\n\r\n  createContext(empty?: boolean) {\r\n    this.dialog\r\n      .open(BookmarkDialogComponent, { disableClose: false })\r\n      .afterClosed()\r\n      .pipe(take(1))\r\n      .subscribe((title: string) => {\r\n        if (title) {\r\n          this.create.emit({ title, empty });\r\n        }\r\n      });\r\n  }\r\n\r\n  getPermission(user?): ContextUserPermission {\r\n    if (user) {\r\n      const permission = this.permissions.find((p) => p.name === user.name);\r\n      return permission;\r\n    }\r\n  }\r\n\r\n  handleToggleCategory(user, parent?) {\r\n    const permission = this.getPermission(user);\r\n    if (permission) {\r\n      permission.checked = !permission.checked;\r\n      this.storageService.set(\r\n        'contexts.permissions.' + permission.name,\r\n        permission.checked\r\n      );\r\n      permission.indeterminate = false;\r\n    }\r\n\r\n    if (parent) {\r\n      let indeterminate = false;\r\n\r\n      for (const c of parent.childs) {\r\n        const cPermission = this.getPermission(c);\r\n        if (cPermission.checked !== permission.checked) {\r\n          indeterminate = true;\r\n          break;\r\n        }\r\n      }\r\n      const parentPermission = this.getPermission(parent);\r\n      if (parentPermission) {\r\n        parentPermission.checked = permission.checked;\r\n        this.storageService.set(\r\n          'contexts.permissions.' + parentPermission.name,\r\n          permission.checked\r\n        );\r\n        parentPermission.indeterminate = indeterminate;\r\n      }\r\n    }\r\n\r\n    if (user.childs) {\r\n      for (const c of user.childs) {\r\n        const childrenPermission = this.getPermission(c);\r\n        if (\r\n          childrenPermission &&\r\n          childrenPermission.checked !== permission.checked\r\n        ) {\r\n          childrenPermission.checked = permission.checked;\r\n          this.storageService.set(\r\n            'contexts.permissions.' + childrenPermission.name,\r\n            permission.checked\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this.filterPermissionsChanged.emit(this.permissions);\r\n  }\r\n\r\n  hideContext(context: DetailedContext) {\r\n    context.hidden = true;\r\n    if (!this.showHidden) {\r\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\r\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\r\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\r\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\r\n      this.contexts = contexts;\r\n    }\r\n    this.hide.emit(context);\r\n  }\r\n\r\n  showContext(context: DetailedContext) {\r\n    context.hidden = false;\r\n    this.show.emit(context);\r\n  }\r\n}\r\n","<div *ngIf=\"context\">\n  <div *ngIf=\"!canWrite\" class=\"scopeForm\">\n    <h4>{{ 'igo.context.permission.readOnlyTitle' | translate }}</h4>\n    <p>{{ 'igo.context.permission.readOnlyMsg' | translate }}</p>\n  </div>\n\n  <div *ngIf=\"canWrite\" class=\"scopeForm\">\n    <mat-radio-group\n      [(ngModel)]=\"context.scope\"\n      (change)=\"scopeChanged.emit(context)\"\n    >\n      <mat-radio-button value=\"private\">\n        {{ 'igo.context.permission.scope.private' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"protected\">\n        {{ 'igo.context.permission.scope.shared' | translate }}\n      </mat-radio-button>\n      <mat-radio-button *ngIf=\"authService.isAdmin\" value=\"public\">\n        {{ 'igo.context.permission.scope.public' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </div>\n\n  <form\n    *ngIf=\"context.scope !== 'private' && canWrite\"\n    [formGroup]=\"form\"\n    (ngSubmit)=\"handleFormSubmit(form.value)\"\n  >\n    <mat-form-field class=\"full-width\">\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.permission.user' | translate\"\n        [formControl]=\"formControl\"\n        [matAutocomplete]=\"auto\"\n      />\n      <mat-autocomplete\n        #auto=\"matAutocomplete\"\n        (optionSelected)=\"onProfilSelected($event.option.value)\"\n        [displayWith]=\"displayFn\"\n      >\n        <mat-option *ngFor=\"let profil of this.profils\" [value]=\"profil\">\n          {{ profil.title }}<br />\n          <small class=\"mat-typography\">{{ profil.name }}</small>\n        </mat-option>\n      </mat-autocomplete>\n      <mat-error>\n        {{ 'igo.context.permission.profilRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n\n    <mat-radio-group formControlName=\"typePermission\">\n      <mat-radio-button value=\"read\">\n        {{ 'igo.context.permission.read' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"write\">\n        {{ 'igo.context.permission.write' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n\n    <div class=\"igo-form-button-group\">\n      <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid\">\n        {{ 'igo.context.permission.addBtn' | translate }}\n      </button>\n    </div>\n  </form>\n\n  <igo-list *ngIf=\"permissions && context.scope !== 'private'\">\n    <ng-template ngFor let-groupPermissions [ngForOf]=\"permissions | keyvalue\">\n      <igo-collapsible\n        *ngIf=\"groupPermissions.value.length\"\n        [title]=\"'igo.context.permission.' + groupPermissions.key | translate\"\n      >\n        <ng-template ngFor let-permission [ngForOf]=\"groupPermissions.value\">\n          <mat-list-item>\n            <mat-icon matListItemIcon>person</mat-icon>\n            <h4 matListItemTitle>\n              {{ permission.profilTitle }}\n              <small class=\"mat-typography\">{{ permission.profil }}</small>\n            </h4>\n\n            <div\n              matListItemMeta\n              igoStopPropagation\n              class=\"igo-actions-container\"\n            >\n              <button\n                *ngIf=\"\n                  canWrite ||\n                  permission.profil === authService.decodeToken().user.sourceId\n                \"\n                mat-icon-button\n                [matTooltip]=\"'igo.context.permission.delete' | translate\"\n                matTooltipShowDelay=\"500\"\n                color=\"warn\"\n                (click)=\"removePermission.emit(permission)\"\n              >\n                <mat-icon>delete</mat-icon>\n              </button>\n            </div>\n          </mat-list-item>\n        </ng-template>\n      </igo-collapsible>\n    </ng-template>\n  </igo-list>\n</div>\n","import { KeyValuePipe, NgFor, NgIf } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\nimport { ListComponent } from '@igo2/common/list';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Subscription } from 'rxjs';\n\nimport { TypePermission } from '../shared/context.enum';\nimport {\n  Context,\n  ContextPermission,\n  ContextPermissionsList,\n  ContextProfils\n} from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-permissions',\n  templateUrl: './context-permissions.component.html',\n  styleUrls: ['./context-permissions.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatRadioModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatButtonModule,\n    ListComponent,\n    CollapsibleComponent,\n    MatListModule,\n    MatIconModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class ContextPermissionsComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.cd.detectChanges();\n  }\n  private _context: Context;\n\n  @Input()\n  get permissions(): ContextPermissionsList {\n    return this._permissions;\n  }\n  set permissions(value: ContextPermissionsList) {\n    this._permissions = value;\n    this.cd.detectChanges();\n  }\n  private _permissions: ContextPermissionsList;\n\n  get profils(): ContextProfils[] {\n    return this._profils;\n  }\n  set profils(value: ContextProfils[]) {\n    this._profils = value;\n    this.cd.detectChanges();\n  }\n  private _profils: ContextProfils[] = [];\n\n  get canWrite(): boolean {\n    return this.context.permission === TypePermission[TypePermission.write];\n  }\n\n  private baseUrlProfils;\n\n  public formControl = new UntypedFormControl();\n  formValueChanges$$: Subscription;\n\n  @Output() addPermission: EventEmitter<ContextPermission> = new EventEmitter();\n  @Output() removePermission: EventEmitter<ContextPermission> =\n    new EventEmitter();\n  @Output() scopeChanged: EventEmitter<Context> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private cd: ChangeDetectorRef,\n    private http: HttpClient,\n    public authService: AuthService,\n    private config: ConfigService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n\n    this.baseUrlProfils =\n      this.config.getConfig('context.url') + '/profils-users?';\n\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.http\n            .get(this.baseUrlProfils + 'q=' + value)\n            .subscribe((profils) => {\n              this.profils = profils as ContextProfils[];\n            });\n          this.profils.filter((profil) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilTitleNormalized = profil.title\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNameNormalized = profil.name\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNormalized =\n              profilNameNormalized + profilTitleNormalized;\n            return profilNormalized.includes(filterNormalized);\n          });\n        } else {\n          this.profils = [];\n        }\n      }\n    );\n  }\n\n  displayFn(profil?: ContextProfils): string | undefined {\n    return profil ? profil.title : undefined;\n  }\n\n  public handleFormSubmit(value) {\n    this.addPermission.emit(value);\n  }\n\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      profil: [],\n      typePermission: ['read']\n    });\n  }\n\n  onProfilSelected(value) {\n    this.form.setValue({\n      profil: value.name,\n      typePermission: this.form.value.typePermission\n    });\n  }\n}\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { PoiButtonComponent } from '../poi-button/poi-button.component';\nimport { userButtonSlideInOut } from './user-button.animation';\nimport { UserDialogComponent } from './user-dialog.component';\n\n@Component({\n  selector: 'igo-user-button',\n  templateUrl: './user-button.component.html',\n  styleUrls: ['./user-button.component.scss'],\n  animations: [userButtonSlideInOut()],\n  standalone: true,\n  imports: [\n    NgIf,\n    PoiButtonComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class UserButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  public expand = false;\n  public visible = false;\n  public hasApi = false;\n\n  constructor(\n    private dialog: MatDialog,\n    private config: ConfigService,\n    public auth: AuthService\n  ) {\n    this.visible = this.config.getConfig('auth') ? true : false;\n    this.hasApi = this.config.getConfig('context.url') !== undefined;\n  }\n\n  accountClick() {\n    if (this.auth.authenticated) {\n      this.expand = !this.expand;\n    } else {\n      this.auth.logout();\n    }\n  }\n\n  logout() {\n    this.expand = false;\n    this.auth.logout();\n  }\n\n  infoUser() {\n    this.dialog.open(UserDialogComponent, { disableClose: false });\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\n\nimport { RouteService } from '@igo2/core/route';\nimport { Layer, WMSDataSourceOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShareMapService {\n  private language = '';\n\n  constructor(\n    private contextService: ContextService,\n    @Optional() private route: RouteService\n  ) {\n    this.route.queryParams.subscribe((params) => {\n      if (params['lang']) {\n        this.language = params['lang'];\n      }\n    });\n  }\n\n  getUrlWithApi(formValues) {\n    return this.language\n      ? `${location.origin + location.pathname}?context=${\n          formValues.uri\n        }&lang=${this.language}`\n      : `${location.origin + location.pathname}?context=${formValues.uri}`;\n  }\n\n  createContextShared(map: IgoMap, formValues) {\n    const context = this.contextService.getContextFromMap(map);\n    context.scope = 'public';\n    context.title = formValues.title;\n    context.uri = formValues.uri;\n    return this.contextService.create(context);\n  }\n\n  updateContextShared(map: IgoMap, formValues, id: string) {\n    const context = this.contextService.getContextFromMap(map);\n    return this.contextService.update(id, {\n      title: formValues.title,\n      map: context.map\n    } as DetailedContext);\n  }\n\n  getUrlWithoutApi(map: IgoMap, publicShareOption) {\n    if (\n      !this.route ||\n      !this.route.options.visibleOnLayersKey ||\n      !this.route.options.visibleOffLayersKey ||\n      !map.viewController.getZoom()\n    ) {\n      return;\n    }\n    const llc = publicShareOption.layerlistControls.querystring;\n\n    let visibleKey = this.route.options.visibleOnLayersKey;\n    let invisibleKey = this.route.options.visibleOffLayersKey;\n    const layers = map.layers;\n\n    const visibleLayers = layers.filter(\n      (lay) => lay.visible && !lay.isIgoInternalLayer\n    );\n    const invisibleLayers = layers.filter(\n      (lay) => !lay.visible && !lay.isIgoInternalLayer\n    );\n\n    if (visibleLayers.length === 0) {\n      visibleKey = '';\n    }\n    if (invisibleLayers.length === 0) {\n      invisibleKey = '';\n    }\n\n    let layersUrl = '';\n    let layersToLoop = [];\n    if (visibleLayers.length > invisibleLayers.length) {\n      layersUrl = `${visibleKey}=*&${invisibleKey}=`;\n      layersToLoop = invisibleLayers;\n    } else {\n      layersUrl = `${invisibleKey}=*&${visibleKey}=`;\n      layersToLoop = visibleLayers;\n    }\n\n    for (const layer of layersToLoop) {\n      if (layer.id) {\n        layersUrl += layer.id + ',';\n      }\n    }\n    const contextLayersID = [];\n    const contextLayers = this.contextService.context$.value.layers;\n    for (const contextLayer of contextLayers) {\n      if (\n        typeof contextLayer.id !== 'undefined' ||\n        typeof contextLayer.source !== 'undefined'\n      ) {\n        contextLayersID.push(contextLayer.id || contextLayer.source.id);\n      }\n    }\n\n    const addedLayersQueryParamsWms = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wms'\n    );\n    const addedLayersQueryParamsWmts = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wmts'\n    );\n    const addedLayersQueryParamsArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'arcgisrest'\n    );\n    const addedLayersQueryParamsImageArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'imagearcgisrest'\n    );\n    const addedLayersQueryParamsTileArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'tilearcgisrest'\n    );\n\n    layersUrl = layersUrl.substr(0, layersUrl.length - 1);\n\n    const zoomKey = this.route.options.zoomKey;\n    const centerKey = this.route.options.centerKey;\n    const contextKey = this.route.options.contextKey;\n\n    const zoom = `${zoomKey}=${map.viewController.getZoom()}`;\n    const arrayCenter = map.viewController.getCenter('EPSG:4326') || [];\n    const long = arrayCenter[0].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const lat = arrayCenter[1].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const center = `${centerKey}=${long},${lat}`.replace(/.00000/g, '');\n    let context = '';\n    if (this.contextService.context$.value) {\n      context = `${contextKey}=${this.contextService.context$.value.uri}`;\n    }\n\n    let url = this.language\n      ? `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}&lang=${this.language}`\n      : `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}`;\n    for (let i = 0; i < 5; i++) {\n      url = url.replace(/&&/g, '&');\n      url = url.endsWith('&') ? url.slice(0, -1) : url;\n    }\n    url = url.endsWith('&') ? url.slice(0, -1) : url;\n    url = url.replace('?&wm', '&wm');\n    url = url.replace('?&', '?');\n\n    return url;\n  }\n\n  private makeLayersByService(\n    layers: Layer[],\n    contextLayersID: any[],\n    typeService: string\n  ): string {\n    const addedLayersByService = [];\n    for (const layer of layers.filter(\n      (l) => l.dataSource.options?.type === typeService\n    )) {\n      if (contextLayersID.indexOf(layer.id) === -1) {\n        let linkUrl = encodeURIComponent((layer.dataSource.options as any).url);\n        let addedLayer = '';\n        let layerVersion: string;\n        switch (layer.dataSource.options.type.toLowerCase()) {\n          case 'wms':\n            const datasourceOptions = layer.dataSource\n              .options as WMSDataSourceOptions;\n            addedLayer = encodeURIComponent(datasourceOptions.params.LAYERS);\n            layerVersion =\n              datasourceOptions.params.VERSION === '1.3.0'\n                ? layerVersion\n                : datasourceOptions.params.VERSION;\n            break;\n          case 'wmts':\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            addedLayer = encodeURIComponent(\n              (layer.dataSource.options as any).layer\n            );\n            break;\n        }\n        const addedLayerPosition = `${addedLayer}:igoz${layer.zIndex}`;\n\n        let version = '';\n        if (layerVersion) {\n          const operator =\n            (layer.dataSource.options as any).url.indexOf('?') === -1\n              ? '?'\n              : '&';\n          version = encodeURIComponent(`${operator}VERSION=${layerVersion}`);\n        }\n        linkUrl = `${linkUrl}${version}`;\n\n        if (\n          !addedLayersByService.find((definedUrl) => definedUrl.url === linkUrl)\n        ) {\n          addedLayersByService.push({\n            url: linkUrl,\n            layers: [addedLayerPosition]\n          });\n        } else {\n          addedLayersByService.forEach((service) => {\n            if (service.url === linkUrl) {\n              service.layers.push(addedLayerPosition);\n            }\n          });\n        }\n      }\n    }\n\n    let addedLayersQueryParams = '';\n    if (addedLayersByService.length >= 1) {\n      let linkUrlKey;\n      let layersKey;\n      /*\n      const linkUrlKey = (typeService === 'wms') ? this.route.options.wmsUrlKey :\n        (typeService === 'wmts') ? this.route.options.wmtsUrlKey : '' ;\n      const layersKey = (typeService === 'wms') ? this.route.options.wmsLayersKey :\n        (typeService === 'wmts') ? this.route.options.wmtsLayersKey : '' ;\n*/\n      switch (typeService.toLowerCase()) {\n        case 'wms':\n          linkUrlKey = this.route.options.wmsUrlKey;\n          layersKey = this.route.options.wmsLayersKey;\n          break;\n        case 'wmts':\n          linkUrlKey = this.route.options.wmtsUrlKey;\n          layersKey = this.route.options.wmtsLayersKey;\n          break;\n        case 'arcgisrest':\n          linkUrlKey = this.route.options.arcgisUrlKey;\n          layersKey = this.route.options.arcgisLayersKey;\n          break;\n        case 'imagearcgisrest':\n          linkUrlKey = this.route.options.iarcgisUrlKey;\n          layersKey = this.route.options.iarcgisLayersKey;\n          break;\n        case 'tilearcgisrest':\n          linkUrlKey = this.route.options.tarcgisUrlKey;\n          layersKey = this.route.options.tarcgisLayersKey;\n          break;\n        default:\n          linkUrlKey = '';\n          layersKey = '';\n      }\n\n      let linkUrlQueryParams = '';\n      let layersQueryParams = '';\n      addedLayersByService.forEach((service) => {\n        linkUrlQueryParams += `${service.url},`;\n        layersQueryParams += `(${service.layers.join(',')}),`;\n      });\n      linkUrlQueryParams = linkUrlQueryParams.endsWith(',')\n        ? linkUrlQueryParams.slice(0, -1)\n        : linkUrlQueryParams;\n      layersQueryParams = layersQueryParams.endsWith(',')\n        ? layersQueryParams.slice(0, -1)\n        : layersQueryParams;\n      addedLayersQueryParams = `${linkUrlKey}=${linkUrlQueryParams}&${layersKey}=${layersQueryParams}`;\n    }\n\n    return addedLayersQueryParams;\n  }\n}\n","<form class=\"igo-form\" [formGroup]=\"form\" (ngSubmit)=\"createUrl(form.value)\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n        formControlName=\"title\"\n      />\n      <mat-error>\n        {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div id=\"uriInput\" class=\"igo-input-container\">\n    <mat-form-field>\n      <span *ngIf=\"userId\" class=\"prefix\">{{ userId }}-</span>\n      <span class=\"fieldWrapper\">\n        <input\n          matInput\n          required\n          [readonly]=\"!userId\"\n          [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n          formControlName=\"uri\"\n        />\n      </span>\n      <mat-error>\n        {{ 'igo.context.contextManager.form.uriRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      *ngIf=\"!url\"\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid\"\n    >\n      {{ 'igo.context.shareMap.button' | translate }}\n    </button>\n    <button\n      *ngIf=\"url\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"updateContextShared(form.value)\"\n    >\n      {{ 'igo.context.shareMap.refreshBtn' | translate }}\n    </button>\n  </div>\n</form>\n\n<div *ngIf=\"url\" class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      class=\"textAreaWithButton\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.context.shareMap.copy' | translate\"\n      color=\"primary\"\n      (click)=\"copyTextToClipboard(textArea)\"\n    >\n      <mat-icon>content_copy</mat-icon>\n    </button>\n  </mat-form-field>\n  <div></div>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport type { IgoMap } from '@igo2/geo';\nimport { Clipboard, uuid } from '@igo2/utils';\n\nimport { ShareMapService } from '../shared/share-map.service';\n\n@Component({\n  selector: 'igo-share-map-api',\n  templateUrl: './share-map-api.component.html',\n  styleUrls: ['./share-map-api.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapApiComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public userId: string;\n  public idContextShared: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private shareMapService: ShareMapService,\n    private formBuilder: UntypedFormBuilder\n  ) {}\n\n  ngOnInit(): void {\n    this.auth.authenticate$.subscribe((auth) => {\n      const decodeToken = this.auth.decodeToken();\n      this.userId = decodeToken?.user?.id.toString();\n      this.buildForm();\n    });\n  }\n\n  createUrl(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.url = this.shareMapService.getUrlWithApi(inputs);\n    this.shareMapService.createContextShared(this.map, inputs).subscribe(\n      (rep) => {\n        this.idContextShared = rep.id;\n        this.messageService.success(\n          'igo.context.contextManager.dialog.saveMsg',\n          'igo.context.contextManager.dialog.saveTitle',\n          undefined,\n          { value: inputs.title }\n        );\n      },\n      (err) => {\n        err.error.title = this.languageService.translate.instant(\n          'igo.context.shareMap.errorTitle'\n        );\n        this.messageService.showError(err);\n      }\n    );\n  }\n\n  updateContextShared(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.shareMapService\n      .updateContextShared(this.map, inputs, this.idContextShared)\n      .subscribe(\n        (rep) => {\n          this.messageService.success(\n            'igo.context.contextManager.dialog.saveMsg',\n            'igo.context.contextManager.dialog.saveTitle',\n            undefined,\n            { value: inputs.title }\n          );\n        },\n        (err) => {\n          err.error.title = this.languageService.translate.instant(\n            'igo.context.shareMap.errorTitle'\n          );\n          this.messageService.showError(err);\n        }\n      );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n\n  buildForm(): void {\n    this.url = undefined;\n    const id = uuid();\n    let title = 'Partage ';\n    title += this.userId ? `(${this.userId}-${id})` : `(${id})`;\n    this.form = this.formBuilder.group({\n      title: [title],\n      uri: [id]\n    });\n  }\n}\n","<div class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n  </mat-form-field>\n\n  <div class=\"igo-form-button-group\">\n    <button mat-raised-button (click)=\"copyTextToClipboard(textArea)\">\n      <mat-icon>content_copy</mat-icon>\n      {{ 'igo.context.shareMap.copy' | translate }}\n    </button>\n  </div>\n  <div>\n    <br />\n    <section class=\"mat-typography\">\n      <div\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) === ''\"\n      >\n        <h4 *ngIf=\"('igo.context.shareMap.included' | translate) !== ''\">\n          {{ 'igo.context.shareMap.included' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.context' | translate) !== ''\">\n            {{ 'igo.context.shareMap.context' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.center' | translate) !== ''\">\n            {{ 'igo.context.shareMap.center' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.zoom' | translate) !== ''\">\n            {{ 'igo.context.shareMap.zoom' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.addedLayers' | translate) !== ''\">\n            {{ 'igo.context.shareMap.addedLayers' | translate }}\n          </li>\n          <li\n            *ngIf=\"('igo.context.shareMap.visibleInvisible' | translate) !== ''\"\n          >\n            {{ 'igo.context.shareMap.visibleInvisible' | translate }}\n          </li>\n        </ul>\n\n        <h4 *ngIf=\"('igo.context.shareMap.excluded' | translate) !== ''\">\n          {{ 'igo.context.shareMap.excluded' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.order' | translate) !== ''\">\n            {{ 'igo.context.shareMap.order' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.opacity' | translate) !== ''\">\n            {{ 'igo.context.shareMap.opacity' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterOgc' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterOgc' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterTime' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterTime' | translate }}\n          </li>\n        </ul>\n      </div>\n      <igo-custom-html\n        class=\"shareCustomPadding\"\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) !== ''\"\n        class=\"mat-typography\"\n        [html]=\"'igo.context.shareMap.htmlClarifications' | translate\"\n      >\n      </igo-custom-html>\n    </section>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport type { IgoMap } from '@igo2/geo';\nimport { Clipboard } from '@igo2/utils';\n\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { ShareMapService } from '../shared/share-map.service';\n\n@Component({\n  selector: 'igo-share-map-url',\n  templateUrl: './share-map-url.component.html',\n  styleUrls: ['./share-map-url.component.scss'],\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    NgIf,\n    CustomHtmlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapUrlComponent implements AfterViewInit, OnInit, OnDestroy {\n  private mapState$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public publicShareOption = {\n    layerlistControls: { querystring: '' }\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private shareMapService: ShareMapService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resetUrl();\n    this.mapState$$ = combineLatest([\n      this.map.viewController.state$,\n      this.map.status$\n    ]).subscribe((c) => {\n      this.resetUrl();\n      this.cdRef.detectChanges();\n    });\n  }\n\n  ngAfterViewInit(): void {\n    this.resetUrl();\n  }\n\n  ngOnDestroy(): void {\n    this.mapState$$.unsubscribe();\n  }\n\n  resetUrl(values: any = {}) {\n    this.url = this.shareMapService.getUrlWithoutApi(\n      this.map,\n      this.publicShareOption\n    );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n}\n","<mat-tab-group *ngIf=\"hasApi\">\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithApi' | translate\">\n    <igo-share-map-api [map]=\"map\"></igo-share-map-api>\n  </mat-tab>\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithUrl' | translate\">\n    <igo-share-map-url [map]=\"map\"></igo-share-map-url>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-share-map-url *ngIf=\"!hasApi\" [map]=\"map\"></igo-share-map-url>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ShareMapApiComponent } from './share-map-api.component';\nimport { ShareMapUrlComponent } from './share-map-url.component';\n\n@Component({\n  selector: 'igo-share-map',\n  templateUrl: './share-map.component.html',\n  styleUrls: ['./share-map.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTabsModule,\n    ShareMapApiComponent,\n    ShareMapUrlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapComponent {\n  @Input() map: IgoMap;\n\n  public hasApi = false;\n\n  constructor(private config: ConfigService) {\n    this.hasApi = this.config.getConfig('context.url') ? true : false;\n  }\n}\n","import { HttpClientModule } from '@angular/common/http';\nimport { Directive, Input, OnDestroy, OnInit, Optional } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { RouteService } from '@igo2/core/route';\nimport {\n  Layer,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter, first } from 'rxjs/operators';\n\nimport {\n  addImportedFeaturesStyledToMap,\n  addImportedFeaturesToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport { DetailedContext } from './context.interface';\nimport { ContextService } from './context.service';\n\n@Directive({\n  selector: '[igoLayerContext]',\n  standalone: true,\n  providers: [HttpClientModule]\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      this.route.queryParams\n        .pipe(first((params) => !ObjectUtils.isEmpty(params)))\n        .subscribe((params) => {\n          this.queryParams = params;\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        this.handleAddLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const importExportOptions =\n              this.configService.getConfig('importExport');\n            if (!importExportOptions?.importWithStyle) {\n              addImportedFeaturesToMap(featureCollection, this.map);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n\n    this.layerService\n      .createAsyncIdbLayers(context.uri)\n      .pipe(debounceTime(500))\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\n  }\n\n  private handleAddLayers(layers: Layer[]) {\n    layers = layers\n      .filter((layer: Layer) => layer !== undefined)\n      .map((layer) => {\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\n        layer.zIndex = layer.zIndex;\n\n        return layer;\n      });\n    this.contextLayers.concat(layers);\n    this.map.addLayers(layers);\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (\n        visiblelayers.indexOf(currentLayerid) > -1 ||\n        visiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = true;\n      }\n      if (\n        invisiblelayers.indexOf(currentLayerid) > -1 ||\n        invisiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import { Directive, OnDestroy, OnInit } from '@angular/core';\n\nimport { MediaService } from '@igo2/core/media';\nimport {\n  MapBrowserComponent,\n  MapControlsOptions,\n  MapScaleLineOptions,\n  MapViewOptions\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { ContextMapView, DetailedContext } from './context.interface';\nimport { ContextService } from './context.service';\n\n@Directive({\n  selector: '[igoMapContext]',\n  standalone: true\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (\n      !this.component.view ||\n      viewContext.keepCurrentView !== true ||\n      context.map.view.projection !== this.map.projection\n    ) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(\n        viewContext\n      );\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof controlsContext.scaleLine !== 'boolean') {\n          const scaleLineOption =\n            controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import {\n  ChangeDetectorRef,\n  Directive,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\nimport { MapService } from '@igo2/geo';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  Context,\n  ContextUserPermission,\n  ContextsList,\n  DetailedContext\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]',\n  standalone: true,\n  providers: [ConfirmDialogService]\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const messageObj = this.messageService.success(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        'igo.context.contextManager.dialog.favoriteTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              this.messageService.info(\n                'igo.context.contextManager.dialog.deleteMsg',\n                'igo.context.contextManager.dialog.deleteTitle',\n                undefined,\n                { value: context.title }\n              );\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.cloneMsg',\n        'igo.context.contextManager.dialog.cloneTitle',\n        undefined,\n        { value: context.title }\n      );\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        'igo.context.bookmarkButton.dialog.createTitle',\n        undefined,\n        { value: context.title }\n      );\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get(\n      'favorite.context.uri'\n    ) as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\n\nimport { Context, DetailedContext } from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextEditComponent } from './context-edit.component';\n\n@Directive({\n  selector: '[igoContextEditBinding]',\n  standalone: true\n})\nexport class ContextEditBindingDirective implements OnInit, OnDestroy {\n  private component: ContextEditComponent;\n  private editedContext$$: Subscription;\n\n  @Output() submitSuccessed: EventEmitter<Context> = new EventEmitter();\n\n  @HostListener('submitForm', ['$event'])\n  onEdit(context: Context) {\n    const id = this.component.context.id;\n    this.contextService.update(id, context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title || this.component.context.title\n        }\n      );\n      this.contextService.setEditedContext(undefined);\n      this.submitSuccessed.emit(context);\n    });\n  }\n\n  constructor(\n    @Self() component: ContextEditComponent,\n    private contextService: ContextService,\n    private messageService: MessageService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n  }\n}\n","import {\n  ChangeDetectorRef,\n  Directive,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\n\nimport {\n  Context,\n  ContextPermission,\n  DetailedContext\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextPermissionsComponent } from './context-permissions.component';\n\n@Directive({\n  selector: '[igoContextPermissionsBinding]',\n  standalone: true\n})\nexport class ContextPermissionsBindingDirective implements OnInit, OnDestroy {\n  private component: ContextPermissionsComponent;\n  private editedContext$$: Subscription;\n\n  @HostListener('addPermission', ['$event'])\n  onAddPermission(permission: ContextPermission) {\n    if (!permission.profil) {\n      this.messageService.error(\n        'igo.context.contextManager.errors.addPermissionEmpty',\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      return;\n    }\n    const contextId = this.component.context.id;\n    this.contextService\n      .addPermissionAssociation(\n        contextId,\n        permission.profil,\n        permission.typePermission\n      )\n      .subscribe((profils) => {\n        for (const p of profils) {\n          this.component.permissions[permission.typePermission].push(p);\n        }\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.addMsg',\n          'igo.context.permission.dialog.addTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('removePermission', ['$event'])\n  onRemovePermission(permission: ContextPermission) {\n    const contextId = this.component.context.id;\n    this.contextService\n      .deletePermissionAssociation(contextId, permission.id)\n      .subscribe(() => {\n        const index = this.component.permissions[\n          permission.typePermission\n        ].findIndex((p) => {\n          return p.id === permission.id;\n        });\n        this.component.permissions[permission.typePermission].splice(index, 1);\n\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.deleteMsg',\n          'igo.context.permission.dialog.deleteTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('scopeChanged', ['$event'])\n  onScopeChanged(context: Context) {\n    const scope = context.scope;\n    this.contextService.update(context.id, { scope }).subscribe(() => {\n      this.messageService.success(\n        'igo.context.permission.dialog.scopeChangedMsg',\n        'igo.context.permission.dialog.scopeChangedTitle',\n        undefined,\n        { value: 'igo.context.permission.scope.' + scope }\n      );\n    });\n  }\n\n  constructor(\n    @Self() component: ContextPermissionsComponent,\n    private contextService: ContextService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cd: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n    this.contextService.editedContext$.next(undefined);\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n\n    if (context) {\n      this.contextService\n        .getPermissions(context.id)\n        .subscribe((permissionsArray) => {\n          permissionsArray = permissionsArray || [];\n          const permissions = {\n            read: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'read';\n            }),\n            write: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'write';\n            })\n          };\n          return (this.component.permissions = permissions);\n        });\n    }\n  }\n}\n","import {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { uuid } from '@igo2/utils';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { AnalyticsBaseUser, AnalyticsOptions } from './analytics.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AnalyticsService {\n  private options: AnalyticsOptions;\n\n  get paq() {\n    return ((window as any)._paq = (window as any)._paq || []);\n  }\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('analytics') || {};\n\n    if (this.options.provider === 'matomo') {\n      this.initMatomo();\n    }\n  }\n\n  private initMatomo() {\n    if (!this.options.url || !this.options.id) {\n      return;\n    }\n    const url =\n      this.options.url.substr(-1) === '/'\n        ? this.options.url + 'matomo'\n        : this.options.url;\n\n    // this.paq.push(['trackPageView']);\n    // this.paq.push(['enableLinkTracking']);\n    (() => {\n      this.paq.push(['setTrackerUrl', url + '.php']);\n      this.paq.push(['setSiteId', this.options.id]);\n      const g = document.createElement('script');\n      const s = document.getElementsByTagName('script')[0];\n      g.type = 'text/javascript';\n      g.async = true;\n      g.defer = true;\n      g.src = url + '.js';\n      s.parentNode.insertBefore(g, s);\n    })();\n  }\n\n  /**\n   * Pass `null` to unset the user.\n   */\n  public setUser(user: AnalyticsBaseUser | null, profils?: string[]) {\n    if (this.options.provider === 'matomo') {\n      if (!user) {\n        this.paq.push(['resetUserId']);\n        this.paq.push(['deleteCustomVariable', 1, 'user']);\n        this.paq.push(['deleteCustomVariable', 2, 'name']);\n        this.paq.push(['deleteCustomVariable', 3, 'profils']);\n      } else {\n        this.paq.push(['setUserId', user.id]);\n\n        const name = `${user.firstName} ${user.lastName}`;\n        this.paq.push(['setCustomVariable', 1, 'user', user.sourceId, 'visit']);\n        this.paq.push(['setCustomVariable', 2, 'name', name, 'visit']);\n        this.paq.push(['setCustomVariable', 3, 'profils', profils, 'visit']);\n      }\n\n      this.paq.push(['trackPageView']);\n      this.paq.push(['enableLinkTracking']);\n    }\n  }\n\n  public trackSearch(term: string, nbResults: number) {\n    if (this.options.provider === 'matomo') {\n      this.paq.push(['trackSiteSearch', term, false, nbResults]);\n    }\n  }\n\n  public trackEvent(category: string, action: string, name: string) {\n    if (this.options.provider === 'matomo') {\n      this.paq.push(['trackEvent', category, action, name]);\n    }\n  }\n\n  /**\n   * Function that tracks layers added to the map\n   */\n  public trackLayer(category: string, action: string, parameters: any) {\n    if (this.options.provider === 'matomo')\n      this.paq.push(['trackEvent', category, action, parameters]);\n  }\n}\n","import { AlternateConfigOptions, DeprecatedOptions } from './config.interface';\n\nexport const CONFIG_DEPRECATED: { [key: string]: DeprecatedOptions } = {\n  showMenuButton: {\n    alternativeKey: 'menu.button.visible',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  menuButtonReverseColor: {\n    alternativeKey: 'menu.button.useThemeColor',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  importWithStyle: {\n    alternativeKey: 'importExport.importWithStyle',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  hasGeolocateButton: {\n    alternativeKey: 'geolocate.button.visible',\n    mayBeRemoveIn: new Date('2024-06-06')\n  }\n};\n\nexport const ALTERNATE_CONFIG_FROM_DEPRECATION = new Map<\n  string,\n  AlternateConfigOptions\n>(\n  Object.entries(CONFIG_DEPRECATED)\n    .filter(([_, options]) => options.alternativeKey)\n    .map(([key, options]) => [\n      options.alternativeKey,\n      {\n        deprecatedKey: key\n      } satisfies AlternateConfigOptions\n    ])\n);\n","export interface Version {\r\n  app?: string;\r\n  lib?: string;\r\n  releaseDateApp?: number;\r\n  releaseDate?: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '17.0.0',\r\n  releaseDate: 1724343367841\r\n};\r\n","import { HttpBackend, HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport {\n  ALTERNATE_CONFIG_FROM_DEPRECATION,\n  CONFIG_DEPRECATED\n} from './config-deprecated';\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService<T extends object = { [key: string]: any }> {\n  private config: T | null;\n  private httpClient: HttpClient;\n  private configDeprecated = new Map(Object.entries(CONFIG_DEPRECATED));\n\n  private _isLoaded$ = new BehaviorSubject<boolean>(null);\n  isLoaded$ = this._isLoaded$.asObservable();\n\n  constructor(handler: HttpBackend) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  /**\n   * Use to get the all config file (merge from environnement.ts and config.json)\n   */\n  public getConfigs(): any {\n    Array.from(this.configDeprecated.keys()).map((deprecatedKey) => {\n      const deprecatedValue = ObjectUtils.resolve(this.config, deprecatedKey);\n      if (deprecatedValue !== undefined) {\n        this.handleDeprecatedConfig(deprecatedKey);\n      }\n    });\n    return this.config;\n  }\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig<T = any>(key: string, defaultValue?: unknown): T {\n    let value = ObjectUtils.resolve(this.config, key);\n\n    const isDeprecated = this.configDeprecated.get(key);\n    if (isDeprecated && value !== undefined) {\n      this.handleDeprecatedConfig(key);\n    } else if (value === undefined) {\n      value = this.handleDeprecationPossibility(key);\n    }\n\n    return value ?? defaultValue;\n  }\n\n  private handleDeprecatedConfig(key: string): void {\n    const options = this.configDeprecated.get(key);\n\n    let message = `This config (${key}) is deprecated and will be removed shortly`;\n    if (options.alternativeKey) {\n      message += ` You should use this key (${options.alternativeKey}) as an alternate solution`;\n    }\n\n    const currentDate = new Date();\n    currentDate >= options.mayBeRemoveIn\n      ? console.error(message)\n      : console.warn(message);\n  }\n\n  private handleDeprecationPossibility(key: string): any {\n    const options = ALTERNATE_CONFIG_FROM_DEPRECATION.get(key);\n    if (!options) {\n      return;\n    }\n\n    return this.getConfig(options.deprecatedKey);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions<T>) {\n    const baseConfig = options.default;\n    if (!options.path) {\n      this.config = baseConfig;\n      this._isLoaded$.next(true);\n      return true;\n    }\n\n    return new Promise((resolve, _reject) => {\n      this.httpClient\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            this._isLoaded$.next(false);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          this._isLoaded$.next(true);\n          resolve(true);\n        });\n    });\n  }\n}\n","import {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  InjectionToken,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { ConfigOptions } from './config.interface';\nimport { ConfigService } from './config.service';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfig(options: ConfigOptions): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    {\n      provide: CONFIG_OPTIONS,\n      useValue: options\n    },\n    {\n      provide: APP_INITIALIZER,\n      useFactory: configFactory,\n      multi: true,\n      deps: [ConfigService, CONFIG_OPTIONS]\n    }\n  ]);\n}\n\nfunction configFactory(configService: ConfigService, options: ConfigOptions) {\n  return () => configService.load(options);\n}\n","import { NgModule } from '@angular/core';\n\nimport { TranslateModule } from '@ngx-translate/core';\n\n@NgModule({\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, first, forkJoin, map, switchMap, tap } from 'rxjs';\n\nimport { LanguageLoaderBase } from './language.interface';\n\nexport class LanguageLoader implements LanguageLoaderBase {\n  private httpClient: HttpClient;\n\n  private _isLoaded$ = new BehaviorSubject<boolean>(null);\n  isLoaded$ = this._isLoaded$.asObservable();\n\n  constructor(\n    handler: HttpBackend,\n    private configService: ConfigService,\n    private prefix?: string | string[],\n    private suffix: string = '.json'\n  ) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  public getTranslation(lang: string): any {\n    const igoLocale$ = this.httpClient.get(`locale/libs_locale/${lang}.json`);\n    return this.configService.isLoaded$.pipe(\n      first((isLoaded) => isLoaded),\n      switchMap(() => {\n        if (this.configService && !this.prefix) {\n          const prefix = this.configService.getConfig('language.prefix');\n          this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n        }\n\n        if (!this.prefix || this.prefix.length === 0) {\n          this._isLoaded$.next(true);\n          return igoLocale$;\n        }\n\n        const appLocale$ = (this.prefix as string[]).map((prefix) =>\n          this.httpClient.get(`${prefix}${lang}${this.suffix}`)\n        );\n\n        const locale$ = forkJoin([igoLocale$, ...appLocale$]);\n\n        return locale$.pipe(\n          map((translations) => {\n            return translations.reduce(\n              (acc, current) => ObjectUtils.mergeDeep(acc, current),\n              {}\n            );\n          }),\n          tap(() => {\n            this._isLoaded$.next(true);\n          })\n        );\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string;\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  constructor(public translate: TranslateService) {\n    this.language = this.translate.getBrowserLang();\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n    this.language$.next(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    combineLatest([\n      this.translate.use(this.language),\n      this.translate.reloadLang(this.language)\n    ]).subscribe(() => {\n      this.language$.next(this.language);\n    });\n  }\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { HttpBackend } from '@angular/common/http';\nimport {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  Provider,\n  importProvidersFrom,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport {\n  MissingTranslationHandler,\n  TranslateLoader,\n  TranslateModule,\n  TranslateModuleConfig\n} from '@ngx-translate/core';\nimport { first } from 'rxjs';\nimport { catchError, timeout } from 'rxjs/operators';\n\nimport { LanguageLoaderBase } from './language.interface';\nimport { LanguageLoader } from './language.loader';\nimport { LanguageService } from './language.service';\nimport { IgoMissingTranslationHandler } from './missing-translation.guard';\n\n// 5 seconds\nconst TIMEOUT_DURATION = 5000;\n\n/**\n * Make sure you only call this method in the root module of your application, most of the time called AppModule.\n */\nexport function provideTranslation(loader?: Provider): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    importProvidersFrom(TranslateModule.forRoot(setTranslationConfig(loader))),\n    {\n      provide: APP_INITIALIZER,\n      useFactory: (languageService: LanguageService) => () => {\n        return (\n          languageService.translate.currentLoader as LanguageLoaderBase\n        ).isLoaded$?.pipe(\n          timeout(TIMEOUT_DURATION),\n          first((isLoaded) => isLoaded === true),\n          catchError((error) => {\n            error.message += ` - Request timed out for language loader after: ${TIMEOUT_DURATION}`;\n            throw error;\n          })\n        );\n      },\n      deps: [LanguageService],\n      multi: true\n    }\n  ]);\n}\n\nexport const setTranslationConfig = (\n  loader?: Provider\n): TranslateModuleConfig => ({\n  defaultLanguage: 'fr',\n  loader: loader ?? DEFAULT_LANGUAGE_LOADER,\n  missingTranslationHandler: {\n    provide: MissingTranslationHandler,\n    useClass: IgoMissingTranslationHandler\n  }\n});\n\nexport const DEFAULT_LANGUAGE_LOADER: Provider = {\n  provide: TranslateLoader,\n  useFactory: defaultLanguageLoader,\n  deps: [HttpBackend, ConfigService]\n};\n\nfunction defaultLanguageLoader(http: HttpBackend, config?: ConfigService) {\n  return new LanguageLoader(http, config, undefined, undefined);\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';\nimport { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.HandsetPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","import { EnvironmentProviders, makeEnvironmentProviders } from '@angular/core';\n\nimport { GlobalConfig, provideToastr } from 'ngx-toastr';\n\nconst TOASTR_CONFIG: Partial<GlobalConfig> = {\n  positionClass: 'toast-bottom-right',\n  timeOut: 10000,\n  extendedTimeOut: 10000,\n  titleClass: 'mat-subtitle-2',\n  messageClass: 'toast-message',\n  closeButton: true,\n  progressBar: true,\n  enableHtml: true,\n  tapToDismiss: true,\n  maxOpened: 4,\n  preventDuplicates: true,\n  resetTimeoutOnDuplicate: true,\n  countDuplicates: false,\n  includeTitleDuplicates: true\n};\n\nexport function provideMessage(): EnvironmentProviders {\n  return makeEnvironmentProviders([provideToastr(TOASTR_CONFIG)]);\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { provideMessage } from './shared/message.provider';\n\n/**\n * @deprecated import the provideMessage directly\n */\n@NgModule({\n  imports: [],\n  providers: [provideMessage()],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { Inject, Injectable, Injector } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { BehaviorSubject, forkJoin } from 'rxjs';\nimport { debounceTime, first } from 'rxjs/operators';\n\nimport { MessageType } from './message.enum';\nimport { Message, MessageOptions } from './message.interface';\n\ninterface ActiveMessageTranslation {\n  id: number;\n  titleKey: string;\n  textKey: string;\n  textInterpolateParams?: Object;\n  titleInterpolateParams?: Object;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options?: MessageOptions;\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message');\n    this.languageService.language$.pipe(debounceTime(500)).subscribe((r) => {\n      if (this.toastr.toasts.length === 0) {\n        this.activeMessageTranslations = [];\n      }\n      this.toastr.toasts.map((toast) => {\n        const activeMessageTranslation = this.activeMessageTranslations.find(\n          (amt) => amt.id === toast.toastId\n        );\n        if (activeMessageTranslation) {\n          const translatedTextInterpolateParams = {\n            ...activeMessageTranslation.textInterpolateParams\n          };\n          const translatedTitleInterpolateParams = {\n            ...activeMessageTranslation.titleInterpolateParams\n          };\n\n          if (activeMessageTranslation.textInterpolateParams) {\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTextInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.textInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n          if (activeMessageTranslation.titleInterpolateParams) {\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTitleInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.titleInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n\n          forkJoin([\n            this.languageService.translate.get(\n              activeMessageTranslation.textKey,\n              translatedTextInterpolateParams\n            ),\n            this.languageService.translate.get(\n              activeMessageTranslation.titleKey,\n              translatedTitleInterpolateParams\n            )\n          ])\n            .pipe(first())\n            .subscribe((res: [string, string]) => {\n              toast.toastRef.componentInstance.message = res[0];\n              toast.toastRef.componentInstance.title = res[1];\n            });\n        }\n      });\n    });\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    const messageType = message.type;\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\n\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || ({} as MessageOptions);\n    const currentDate = new Date();\n\n    message.options.from = message.options.from\n      ? message.options.from\n      : new Date('1 jan 1900');\n    message.options.to = message.options.to\n      ? message.options.to\n      : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(\n        Date.parse(message.options.from.replace(/-/g, ' '))\n      );\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(\n        Date.parse(message.options.to.replace(/-/g, ' '))\n      );\n    }\n    if (\n      currentDate > message.options.from &&\n      currentDate < message.options.to\n    ) {\n      if (message.showIcon === false) {\n        this.toastr.toastrConfig.iconClasses[messageType] =\n          `toast-${messageType} toast-no-icon`;\n      }\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.SHOW:\n            messageShown = this.show(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          default:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(\n    text: string,\n    title: string = 'igo.core.message.success',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'success',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  error(\n    text: string,\n    title: string = 'igo.core.message.error',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'error',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  info(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'info',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  alert(\n    text: string,\n    title: string = 'igo.core.message.alert',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'alert',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  show(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'show',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  private handleNgxToastr(\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\n    text: string,\n    title: string,\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    const translatedTextInterpolateParams = { ...textInterpolateParams };\n    const translatedTitlenterpolateParams = { ...titleInterpolateParams };\n\n    if (textInterpolateParams) {\n      Object.keys(textInterpolateParams).map((k) => {\n        const value = textInterpolateParams[k];\n        if (value) {\n          translatedTextInterpolateParams[k] =\n            typeof value === 'string'\n              ? this.languageService.translate.instant(value)\n              : value;\n        }\n      });\n    }\n    if (titleInterpolateParams) {\n      Object.keys(titleInterpolateParams).map((k) => {\n        if (k) {\n          const value = titleInterpolateParams[k];\n          translatedTitlenterpolateParams[k] =\n            typeof value === 'string'\n              ? this.languageService.translate.instant(value)\n              : value;\n        }\n      });\n    }\n\n    const message = this.languageService.translate.instant(\n      text,\n      translatedTextInterpolateParams\n    );\n    const translatedTitle = this.languageService.translate.instant(\n      title,\n      translatedTitlenterpolateParams\n    );\n\n    let activeToast;\n    switch (type) {\n      case 'success':\n        activeToast = this.toastr.success(message, translatedTitle, options);\n        break;\n      case 'error':\n        activeToast = this.toastr.error(message, translatedTitle, options);\n        break;\n      case 'show':\n      case 'info':\n        activeToast = this.toastr.info(message, translatedTitle, options);\n        break;\n      case 'alert':\n        activeToast = this.toastr.warning(message, translatedTitle, options);\n        break;\n    }\n    this.activeMessageTranslations.push({\n      id: activeToast.toastId,\n      titleKey: title,\n      textKey: text,\n      textInterpolateParams,\n      titleInterpolateParams\n    });\n    return activeToast;\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options?.template || message.html) {\n      return message;\n    }\n\n    let html = this.options?.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { EventEmitter, Injectable, Injector, OnDestroy } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n    this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.online.message',\n        'igo.core.network.online.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.offline.message',\n        'igo.core.network.offline.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\n\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey: 'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey: 'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey: 'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey: 'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey: 'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('¢er=')) {\n      url = url.replace('¢er', '&center');\n      const queryParams: any = url\n        .slice(1)\n        .split('&')\n        .map((p) => p.split('='))\n        .reduce((obj, pair) => {\n          const [key, value] = pair.map(decodeURIComponent);\n          obj[key] = value;\n          return obj;\n        }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { ConfigService } from '@igo2/core/config';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  StorageOptions,\n  StorageScope,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from './storage.interface';\n\nexport abstract class BaseStorage<T extends StorageOptions = StorageOptions> {\n  protected options?: T;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> =\n    new BehaviorSubject(undefined);\n\n  constructor(config: ConfigService) {\n    this.options = config.getConfig<T>('storage') || ({ key: 'igo' } as T);\n  }\n\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key,\n        scope,\n        event:\n          previousValue !== undefined\n            ? StorageServiceEventEnum.MODIFIED\n            : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({\n      key,\n      scope,\n      event: StorageServiceEventEnum.REMOVED,\n      previousValue\n    });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({ scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { BaseStorage } from './storage';\nimport { StorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService extends BaseStorage<StorageOptions> {\n  constructor(private config: ConfigService) {\n    super(config);\n  }\n}\n","export enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\nexport interface ArcGISRestCapabilitiesLayer {\n  id: number;\n  name: string;\n  parentLayerId: number;\n  defaultVisibility?: boolean;\n  subLayerIds: number[];\n  minScale: number;\n  maxScale: number;\n  type: ArcGISRestCapabilitiesLayerTypes;\n  geometryType?: string;\n}\n\nexport enum ArcGISRestCapabilitiesLayerTypes {\n  FeatureLayer = 'Feature Layer',\n  RasterLayer = 'Raster Layer',\n  GroupLayer = 'Group Layer'\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olAttribution from 'ol/control/Attribution';\nimport { EsriJSON, WMSCapabilities, WMTSCapabilities } from 'ol/format';\nimport * as olproj from 'ol/proj';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\n\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport {\n  TimeFilterStyle,\n  TimeFilterType\n} from '../../filter/shared/time-filter.enum';\nimport {\n  ItemStyleOptions,\n  LegendOptions\n} from '../../layer/shared/layers/legend.interface';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\nimport {\n  TypeCapabilities,\n  TypeCapabilitiesStrings\n} from './capabilities.interface';\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  CartoDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions,\n  WMTSDataSourceOptions\n} from './datasources';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(\n    private http: HttpClient,\n    private mapService: MapService\n  ) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'arcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getImageArcgisOptions(\n    baseOptions:\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'imagearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(\n          baseOptions,\n          res[0],\n          res[1],\n          res[2]\n        );\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'tilearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic\n      ? olproj.transformExtent(\n          layer.EX_GeographicBoundingBox,\n          'EPSG:4326',\n          this.mapService.getMap().projection\n        )\n      : undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions:\n      | TileArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers\n      ? legend.layers.find((x) => x.layerName === title)\n      : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions:\n      | ArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<\n    | ArcGISRestDataSourceOptions\n    | ArcGISRestImageDataSourceOptions\n    | TileArcGISRestDataSourceOptions\n  >;\n}\n","import { Injectable, Optional } from '@angular/core';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, forkJoin, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport {\n  AnyDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions,\n  DataSource,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  ImageArcGISRestDataSource,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WebSocketDataSource,\n  XYZDataSource,\n  XYZDataSourceOptions\n} from './datasources';\nimport { WFSService } from './datasources/wfs.service';\nimport { OptionsService } from './options/options.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(\n    context: AnyDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(\n          context as TileDebugDataSource\n        );\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable((d) => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable((d) => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable((d) => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable((d) =>\n      d.next(\n        new WFSDataSource(\n          context,\n          this.wfsDataSourceService,\n          this.authInterceptor\n        )\n      )\n    );\n  }\n\n  private createWMSDataSource(\n    context: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError((e) => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.layer }\n          );\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable((d) => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable((d) => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable((d) => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable((d) => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.layer }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable((d) => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable((d) => d.next(new ClusterDataSource(context)));\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport olSourceCluster from 'ol/source/Cluster';\n\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\nimport { FeatureDataSource } from './feature-datasource';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public declare options: ClusterDataSourceOptions;\n  public declare ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import olClusterSource from 'ol/source/Cluster';\nimport olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\n\nimport {\n  LegendMapViewOptions,\n  LegendOptions\n} from '../../../layer/shared/layers/legend.interface';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { DataService } from './data.service';\nimport { DataSourceOptions, Legend } from './datasource.interface';\n\nexport abstract class DataSource {\n  public id: string;\n  public ol: olSource | olVectorSource | olClusterSource;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url }];\n    } else if (options.html) {\n      this.legend = [{ html: options.html }];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","import * as olformat from 'ol/format';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public declare options: FeatureDataSourceOptions;\n  public declare ol: olSourceVector;\n  protected createOlSource(): olSourceVector {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public declare options: OSMDataSourceOptions;\n  public declare ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public declare options: XYZDataSourceOptions;\n  public declare ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import { AuthInterceptor } from '@igo2/auth';\n\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\nimport {\n  checkWfsParams,\n  defaultFieldNameGeometry,\n  getFormatFromOptions\n} from './wms-wfs.utils';\n\nexport class WFSDataSource extends DataSource {\n  public declare ol: olSourceVector;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const fieldNameGeometry =\n      this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        ogcFilters,\n        fieldNameGeometry\n      );\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons) {\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes) {\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons) {\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select) {\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete) {\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters(\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters,\n      true\n    );\n  }\n\n  protected createOlSource(): olSourceVector {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public declare options: WMTSDataSourceOptions;\n  public declare ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\n\nexport class CartoDataSource extends DataSource {\n  public declare ol: olSourceCarto;\n  public declare options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend) {\n      this.options.config.layers[0].legend.items.forEach((f) => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceVector;\n  public declare options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function (extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach((element) => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(\n          legendElement.contentType,\n          legendElement.imageData\n        );\n        label = legendElement.label\n          ? legendElement.label.replace('<Null>', 'Null')\n          : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === 'uniqueValue') {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(\n            legendElement.symbol.contentType,\n            legendElement.symbol.imageData\n          );\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString +=\n            `<tr><td align='left'>` +\n            svg +\n            `</td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === 'simple') {\n      label = legendInfo.label\n        ? legendInfo.label.replace('<Null>', 'Null')\n        : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(\n          legendInfo.symbol.contentType,\n          legendInfo.symbol.imageData\n        );\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString +=\n          `<tr><td align='left'>` +\n          svg +\n          `</td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string =\n        `stroke:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\" ` +\n          strokeDashArray +\n          `/></svg>`;\n      }\n    } else if (\n      symbol.style === 'esriSMSCircle' ||\n      symbol.style === 'esriSFSSolid'\n    ) {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke =\n        `stroke:rgba(` +\n        outlineColor[0] +\n        ',' +\n        outlineColor[1] +\n        ',' +\n        outlineColor[2] +\n        ',' +\n        outlineColor[3] +\n        ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill =\n        `fill:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` +\n          size / 2 +\n          `\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      } else {\n        svg =\n          `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\n\nexport class ImageArcGISRestDataSource extends DataSource {\n  public declare ol: ImageArcGISRest;\n  public declare options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params =\n      this.options.layer === undefined\n        ? this.options.params\n        : Object.assign(\n            { LAYERS: `show:${this.options.layer}` },\n            this.options.params\n          );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public declare options: TileDebugDataSourceOptions;\n  public declare ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olFeature from 'ol/Feature';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public declare options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(\n      event.data\n    ) as olFeature;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport feature from 'ol/Feature';\nimport olFormatMVT from 'ol/format/MVT';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { Md5 } from 'ts-md5';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public declare options: MVTDataSourceOptions;\n  public declare ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({ featureClass: feature });\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n      return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceTileArcGISRest;\n  public declare options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","export abstract class DataService {\n  abstract getData(): string;\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, combineLatest, of } from 'rxjs';\nimport { concatMap } from 'rxjs/operators';\n\nimport { DataService } from './data.service';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport {\n  defaultEpsg,\n  defaultMaxFeatures,\n  formatWFSQueryString,\n  getFormatFromOptions,\n  gmlRegex\n} from './wms-wfs.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ) {\n    if (\n      !dataSourceOptions.sourceFields ||\n      dataSourceOptions.sourceFields.length === 0\n    ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields = getfeatureSourceField;\n        }\n      );\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields.forEach((sourcefield) => {\n            if (sourcefield.alias === undefined) {\n              sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n            }\n            if (\n              sourcefield.values === undefined ||\n              sourcefield.values.length === 0\n            ) {\n              sourcefield.values = getfeatureSourceField.find(\n                (sf) => sf.name === sourcefield.name\n              ).values;\n            }\n          });\n        }\n      );\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(\n      dataSourceOptions,\n      nb,\n      epsgCode,\n      propertyName,\n      startIndex,\n      forceDefaultOutputFormat\n    );\n    const baseUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (\n      forceDefaultOutputFormat ||\n      gmlRegex.test(outputFormat) ||\n      !outputFormat\n    ) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable((d) => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions =\n        JSON.parse(JSON.stringify(dataSourceOptions));\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields\n        ?.filter((f) => !f.values)\n        .map((f) => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true)\n        .pipe(\n          concatMap((res) =>\n            String(res).toLowerCase().includes('exception')\n              ? of(false)\n              : of(true)\n          ),\n          concatMap((allowGml) => {\n            // If the service return GML (return no exception)\n            return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n              concatMap((firstFeature) => {\n                const features = olFormats.readFeatures(firstFeature);\n                fieldList = features[0].getKeys();\n                if (\n                  dataSourceOptions.sourceFields ||\n                  dataSourceOptions.sourceFields.length === 0\n                ) {\n                  sourceFieldsToRetrieveValues = fieldList;\n                }\n                fieldListWoGeom = fieldList.filter(\n                  (field) =>\n                    sourceFieldsToRetrieveValues.includes(field) &&\n                    field !== features[0].getGeometryName() &&\n                    !field.match(/boundedby/gi)\n                );\n                fieldListWoGeomStr = fieldListWoGeom.join(',');\n                const processingArray = [];\n                let startIndex = 0;\n                // If the service do not allow gml return, dice the call in multiple\n                // calls by increment of chunkSize with the original outputFormat\n                if (\n                  !allowGml &&\n                  dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                  dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures\n                ) {\n                  const chunkSize = 1000;\n                  while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                    processingArray.push(\n                      this.wfsGetFeature(\n                        dataSourceOptions,\n                        chunkSize,\n                        dataSourceOptions.paramsWFS.srsName,\n                        fieldListWoGeomStr,\n                        startIndex\n                      )\n                    );\n                    startIndex += chunkSize;\n                  }\n                  effectiveOlFormats = olFormats;\n                } else {\n                  processingArray.push(\n                    this.wfsGetFeature(\n                      dataSourceOptions,\n                      dataSourceOptions.paramsWFS.maxFeatures ||\n                        defaultMaxFeatures,\n                      dataSourceOptions.paramsWFS.srsName,\n                      fieldListWoGeomStr,\n                      0,\n                      true\n                    )\n                  );\n                }\n                return combineLatest(processingArray);\n              })\n            );\n          })\n        )\n        .subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach((element) => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields\n            .filter((f) => f.name === key)\n            .forEach((v) => {\n              if (v.values.indexOf(featureProperties[key]) === -1) {\n                v.values.push(featureProperties[key]);\n              }\n            });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import { ObjectUtils } from '@igo2/utils';\n\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterDuringOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/legend.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WFSService } from './wfs.service';\nimport {\n  TimeFilterableDataSourceOptions,\n  WMSDataSourceOptions\n} from './wms-datasource.interface';\nimport {\n  checkWfsParams,\n  defaultFieldNameGeometry,\n  formatWFSQueryString\n} from './wms-wfs.utils';\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n\nexport class WMSDataSource extends DataSource {\n  public declare ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  set timeFilter(value: TimeFilterOptions) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> =\n    new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach((sourceField) => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters =\n        ogcFilterWriter.defineOgcFiltersDefaultOptions(\n          initOgcFilters,\n          fieldNameGeometry,\n          'wms'\n        );\n    } else {\n      initOgcFilters.advancedOgcFilters =\n        initOgcFilters.pushButtons ||\n        initOgcFilters.checkboxes ||\n        initOgcFilters.radioButtons ||\n        initOgcFilters.select ||\n        initOgcFilters.autocomplete\n          ? false\n          : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n        const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n        if (filterDuring.calendarModeYear) {\n          initOgcFilters.advancedOgcFilters = false;\n        }\n      }\n      if (initOgcFilters.pushButtons) {\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes) {\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons) {\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select) {\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete) {\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.ol.updateParams({ FILTER: sourceParams.FILTER });\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions =\n      options as TimeFilterableDataSourceOptions;\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter\n    ) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ ratio: 1 }, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n      this.ol.notify('timeFilter', this.ogcFilters);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && style === undefined && !view?.scale) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (\n      view?.size &&\n      view?.extent &&\n      view?.projection &&\n      this.options.contentDependentLegend\n    ) {\n      projParam =\n        this.params.VERSION === '1.3.0' || this.params.VERSION === undefined\n          ? 'CRS'\n          : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : (style as string)\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n","import { Extent } from 'ol/extent';\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent: Extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean\n): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(\n    options,\n    undefined,\n    options.paramsWFS.srsName\n  );\n  let igoFilters;\n  if (ogcFilters?.enabled) {\n    igoFilters = ogcFilters?.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(\n    igoFilters,\n    extent,\n    proj,\n    ogcFilters?.geometryName,\n    options\n  );\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(\n    options,\n    ogcFilters?.geometryName,\n    extent,\n    proj\n  );\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters?.advancedOgcFilters\n    ? filterOrBox\n    : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find((f) => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter)\n    ? `${baseUrl}&${paramsWFS.xmlFilter}`\n    : baseUrl;\n  options.download = Object.assign({}, options.download, {\n    dynamicUrl: baseUrl\n  });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex =\n    paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n      ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n      : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n    outputFormat = '';\n    version = 'version=1.1.0';\n    cnt = cnt.replace('count', 'maxFeatures');\n  }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n      ? 'srsname=' + paramsWFS.srsName\n      : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach((sourcefield) => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML2 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML32 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML3 }\n    });\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\nimport * as olproj from 'ol/proj';\nimport olTileGridWMTS from 'ol/tilegrid/WMTS';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","<div class=\"igo-form-button-group\">\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\"\n    color=\"primary\"\n    (click)=\"addStop()\"\n  >\n    <mat-icon>add_location_alt</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"\n      (routesFeatureStore.count$ | async) >= 1 ||\n      (stopsStore.count$ | async) >= 1\n    \"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\"\n    color=\"warn\"\n    (click)=\"resetStops()\"\n  >\n    <mat-icon>restore_page</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>zoom_in</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>content_copy</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyLinkToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>link</mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"printDirections()\"\n    [disabled]=\"disabled$ | async\"\n    [matTooltip]=\"'igo.geo.directionsForm.print' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>print</mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, Input, Optional } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { RouteService } from '@igo2/core/route';\nimport { Clipboard } from '@igo2/utils';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { DirectionsService } from '../shared';\nimport { FeatureWithDirection } from '../shared/directions.interface';\nimport {\n  addStopToStore,\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsStore\n} from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    NgIf,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsButtonsComponent {\n  get activeRoute() {\n    return this.routesFeatureStore\n      .all()\n      .find((route) => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  public disabled$ = new BehaviorSubject(false);\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService,\n    private directionsService: DirectionsService\n  ) {}\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsgLink',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsg',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach((stop) => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(',');\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach((step) => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore\n      .all()\n      .map((direction: FeatureWithDirection) => direction.properties.id)\n      .indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view\n      .all()\n      .map((stop) => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n\n  printDirections() {\n    this.stepFeatureStore.clear();\n    this.disabled$.next(true);\n    this.directionsService\n      .downloadDirection(\n        this.routesFeatureStore.map,\n        this.activeRoute.properties.direction\n      )\n      .subscribe(() => {\n        this.disabled$.next(false);\n      });\n  }\n}\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div\n    touchleave\n    (touchenter)=\"onStopEnter(stop)\"\n    (touchleave)=\"onStopLeave()\"\n    (mouseover)=\"onStopEnter(stop)\"\n    (mouseleave)=\"onStopLeave()\"\n    (cdkDragStarted)=\"stopIsDragged = true\"\n    (cdkDragEnded)=\"stopIsDragged = false\"\n    cdkDragLockAxis=\"y\"\n    class=\"stop-box\"\n    *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index\"\n    cdkDrag\n  >\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>{{ getPlaceholder(stop) }}</mat-label>\n        <input\n          id=\"{{ stop.id }}\"\n          type=\"text\"\n          [placeholder]=\"getPlaceholder(stop)\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"stop.text\"\n          aria-label=\"Number\"\n          matInput\n          (focus)=\"onInputFocus(stop)\"\n          [(ngModel)]=\"stop.text\"\n          (keyup)=\"setStopText($event, stop)\"\n          (keydown.enter)=\"$event.preventDefault()\"\n          [matAutocomplete]=\"auto\"\n        />\n        <button\n          *ngIf=\"\n            (stop.text || stop.coordinates) &&\n            stopWithHover &&\n            stop.id === stopWithHover.id\n          \"\n          mat-icon-button\n          matSuffix\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n          color=\"warn\"\n          aria-label=\"Clear\"\n          (click)=\"clearStop(stop)\"\n        >\n          <mat-icon>close</mat-icon>\n        </button>\n\n        <mat-autocomplete\n          [displayWith]=\"getOptionText\"\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"chooseProposal($event, stop)\"\n        >\n          <mat-optgroup\n            *ngFor=\"let source of stop.searchProposals\"\n            [label]=\"source.source.title\"\n            [disabled]=\"source.source.enabled === false\"\n          >\n            <mat-option\n              *ngFor=\"let result of source.results\"\n              [value]=\"result\"\n              matTooltipShowDelay=\"500\"\n              [matTooltip]=\"result.meta ? result.meta.title : ''\"\n            >\n              {{ result.meta ? result.meta.title : '' }}\n            </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n    <div\n      *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\"\n      class=\"igo-form-button-group\"\n    >\n      <button\n        class=\"swipe-vertical\"\n        cdkDragHandle\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\"\n        color=\"primary\"\n      >\n        <mat-icon>drag_indicator</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"(stopsStore.count$ | async) > 2\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\n        color=\"warn\"\n        (click)=\"removeStop(stop)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </div>\n  </div>\n</div>\n","import {\n  CdkDrag,\n  CdkDragDrop,\n  CdkDragHandle,\n  CdkDropList,\n  moveItemInArray\n} from '@angular/cdk/drag-drop';\nimport { AsyncPipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport {\n  MatAutocomplete,\n  MatAutocompleteModule\n} from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOption, MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olObservable from 'ol/Observable';\nimport * as olProj from 'ol/proj';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\nimport { Stop } from '../shared/directions.interface';\nimport {\n  computeRelativePosition,\n  removeStopFromStore,\n  updateStoreSorting\n} from '../shared/directions.utils';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss'],\n  standalone: true,\n  imports: [\n    CdkDropList,\n    NgFor,\n    CdkDrag,\n    NgClass,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatAutocompleteModule,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    MatOptionModule,\n    CdkDragHandle,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> =\n    new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) {}\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(\n    event: { source: MatAutocomplete; option: MatOption },\n    stop: Stop\n  ) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find((value) => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (\n        stop.relativePosition === DirectionRelativePositionType.Intermediate\n      ) {\n        extra = ' #' + stop.position;\n      }\n      return (\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.' + stop.relativePosition\n        ) + extra\n      );\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({\n      id: stop.id,\n      relativePosition: stop.relativePosition,\n      position: stop.position\n    });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once(\n      'singleclick',\n      (event) => {\n        const clickCoordinates = olProj.transform(\n          event.coordinate,\n          this.stopsFeatureStore.layer.map.projection,\n          this.projection\n        );\n        const roundedCoord = roundCoordTo(\n          clickCoordinates as [number, number],\n          this.coordRoundedDecimals\n        );\n        stop.text = roundedCoord.join(',');\n        stop.coordinates = roundedCoord;\n        this.stopsStore.update(stop);\n        setTimeout(() => {\n          this.stopInputHasFocus.emit(false);\n        }, 500);\n      }\n    );\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map((key) => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n  <mat-form-field *ngIf=\"directions && directions.length > 1\">\n    <mat-label>{{\n      'igo.geo.directionsForm.drivingOptions' | translate\n    }}</mat-label>\n    <mat-select\n      placeholder=\"{{ 'igo.geo.directionsForm.drivingOptions' | translate }}\"\n      (selectionChange)=\"changeRoute()\"\n      [(ngModel)]=\"activeDirection\"\n    >\n      <mat-option\n        *ngFor=\"let direction of directions; let cnt = index\"\n        [value]=\"direction\"\n      >\n        Option {{ cnt + 1 }} : {{ formatDistance(direction.distance) }} ({{\n          formatDuration(direction.duration)\n        }})\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n  <mat-list (mouseleave)=\"onStepsListBlur()\">\n    <h2 mat-header class=\"igo-route-title\">{{ activeDirection.title }}</h2>\n    <span class=\"mat-caption\">\n      {{ formatDistance(activeDirection.distance) }},\n      {{ formatDuration(activeDirection.duration) }}\n    </span>\n    <mat-list-item\n      class=\"igo-steps\"\n      (mouseenter)=\"showSegment(step)\"\n      (click)=\"showSegment(step, true)\"\n      *ngFor=\"let step of activeDirection.steps; let cnt = index\"\n      igoListItem\n    >\n      <mat-icon [ngClass]=\"formatStep(step, cnt).cssClass\" matListItemIcon\n        >{{ formatStep(step, cnt).image }}\n      </mat-icon>\n\n      <span class=\"igo-step-text\">\n        {{ cnt + 1 }}. {{ formatStep(step, cnt).instruction }}\n      </span>\n      <span matListItemMeta>\n        {{ formatDistance(step.distance) }}\n      </span>\n    </mat-list-item>\n\n    <mat-divider></mat-divider>\n  </mat-list>\n</div>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionType } from '../shared/directions.enum';\nimport {\n  Direction,\n  FeatureWithStep,\n  IgoStep\n} from '../shared/directions.interface';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatSelectModule,\n    FormsModule,\n    NgFor,\n    MatOptionModule,\n    MatDividerModule,\n    MatListModule,\n    MatIconModule,\n    NgClass,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe((entities) => {\n        const activeFeatureWithDirection = entities.find(\n          (entity) => entity.properties.active\n        );\n        this.directions = entities.map((entity) => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection =\n            activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(\n      (entity) => (entity.properties.active = !entity.properties.active)\n    );\n    this.routesFeatureStore.layer.ol\n      .getSource()\n      .getFeatures()\n      .map((feature) => feature.set('active', !feature.get('active')));\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (\n      geometryMapProjection as any\n    ).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(\n        feature.getGeometry().getExtent() as [number, number, number, number]\n      );\n    }\n  }\n}\n","import { Position } from 'geojson';\nimport { Observable } from 'rxjs';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { BaseDirectionsSourceOptionsProfile } from './directions-source.interface';\n\nexport abstract class DirectionsSource {\n  abstract profiles: BaseDirectionsSourceOptionsProfile[];\n  abstract getSourceName(): string;\n  abstract getEnabledProfile(): BaseDirectionsSourceOptionsProfile;\n  abstract getProfileWithAuthorization(): BaseDirectionsSourceOptionsProfile;\n  abstract route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions\n  ): Observable<Direction[]>;\n}\n","<div class=\"directions-options\">\n  <mat-slide-toggle\n    [checked]=\"directionControlIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onToggleDirectionsControl($event.checked)\"\n  >\n    {{ 'igo.geo.directionsForm.toggleActive' | translate }}\n  </mat-slide-toggle>\n  <mat-slide-toggle\n    *ngIf=\"hasOsrmPrivateAccess && twoSourcesAvailable\"\n    [checked]=\"enabledProfileHasAuthorization\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onTogglePrivateModeControl($event.checked)\"\n  >\n    {{ 'igo.geo.directionsForm.toggleType' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<igo-directions-buttons\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [contextUri]=\"contextUri\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [stopsStore]=\"stopsStore\"\n></igo-directions-buttons>\n\n<igo-directions-inputs\n  (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\"\n  [coordRoundedDecimals]=\"coordRoundedDecimals\"\n  [projection]=\"projection\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stopsStore]=\"stopsStore\"\n  [debounce]=\"debounce\"\n  [length]=\"length\"\n></igo-directions-inputs>\n\n<igo-directions-results\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n></igo-directions-results>\n","import { CommonModule } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { EntityStoreWatcher } from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\n\nimport Collection from 'ol/Collection';\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport { SelectEvent } from 'ol/interaction/Select';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport * as olProj from 'ol/proj';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { QueryService } from '../query/shared/query.service';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { SearchService } from '../search/shared/search.service';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\nimport { BaseDirectionsSourceOptionsProfile } from './directions-sources';\nimport { DirectionsSourceService } from './shared/directions-source.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport {\n  DirectionOptions,\n  FeatureWithStopProperties,\n  Stop\n} from './shared/directions.interface';\nimport { DirectionsService } from './shared/directions.service';\nimport {\n  addDirectionToRoutesFeatureStore,\n  addStopToStopsFeatureStore,\n  addStopToStore,\n  initRoutesFeatureStore,\n  initStepFeatureStore,\n  initStopsFeatureStore,\n  updateStoreSorting\n} from './shared/directions.utils';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from './shared/store';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss'],\n  standalone: true,\n  imports: [\n    CommonModule,\n    MatSlideToggleModule,\n    DirectionsButtonsComponent,\n    DirectionsInputsComponent,\n    DirectionsResultsComponent,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n  public hasOsrmPrivateAccess: boolean = false;\n  public twoSourcesAvailable: boolean = false;\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute: olInteraction.Select;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n  private authenticated$$: Subscription;\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() authenticated$: BehaviorSubject<boolean>;\n\n  /**\n   * Wheter one of the direction control is active\n   * @internal\n   */\n  get directionControlIsActive(): boolean {\n    return !this.queryService.queryEnabled;\n  }\n\n  get interactions(): olInteraction.Interaction[] {\n    return [this.selectStopInteraction, this.translateStop, this.selectedRoute];\n  }\n\n  get enabledProfileHasAuthorization() {\n    return this.directionsSourceService.sources[0].getEnabledProfile()\n      .authorization;\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private directionsSourceService: DirectionsSourceService,\n    private searchService: SearchService,\n    private queryService: QueryService,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit(): void {\n    this.authenticated$$ = this.authenticated$.subscribe(\n      (authenticated: boolean) => {\n        if (authenticated) {\n          const profileWithAuth: BaseDirectionsSourceOptionsProfile =\n            this.directionsSourceService.sources[0].getProfileWithAuthorization();\n          if (profileWithAuth) {\n            this.http\n              .get(profileWithAuth.authorization.url)\n              .subscribe((user) => {\n                this.hasOsrmPrivateAccess =\n                  user[profileWithAuth.authorization.property];\n              });\n          }\n        }\n      }\n    );\n    this.twoSourcesAvailable =\n      this.directionsSourceService.sources[0].profiles.length === 2\n        ? true\n        : false;\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.authenticated$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.interactions.map((interaction) =>\n      this.routesFeatureStore.layer.map.ol.removeInteraction(interaction)\n    );\n    this.stopsFeatureStore.deactivateStrategyOfType(\n      FeatureStoreLoadingStrategy\n    );\n    this.routesFeatureStore.deactivateStrategyOfType(\n      FeatureStoreLoadingStrategy\n    );\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore\n          .all()\n          .find((route) => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(\n            routeExtent as [number, number, number, number]\n          );\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: (feature) => {\n        return (\n          feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating\n        );\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number],\n          this.coordRoundedDecimals\n        );\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.interactions.map((interaction) =>\n      this.routesFeatureStore.layer.map.ol.addInteraction(interaction)\n    );\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus\n      ? this.routesFeatureStore.layer.map.ol.removeInteraction(\n          this.selectedRoute\n        )\n      : this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(features: Collection<any>) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(\n      translationCoordinates as [number, number],\n      this.coordRoundedDecimals\n    );\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(distinctUntilChanged())\n      .subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map((s) => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({\n        ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates }\n      });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, [\n      'coordinates'\n    ]);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = change.newValue as Stop;\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(\n            term,\n            this.stopsFeatureStore.layer.map.projection\n          );\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, {\n            searchType: 'Feature'\n          });\n          this.cancelSearch();\n          const requests$ = researches.map((res) =>\n            res.request.pipe(\n              map((results: SearchResult[]) =>\n                results.filter((r) =>\n                  isCoord\n                    ? r.data.geometry.type === 'Point' && r.data.geometry\n                    : r.data.geometry\n                )\n              )\n            )\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request\n              .pipe(\n                map((results: SearchResult[]) =>\n                  results.filter((r) =>\n                    isCoord\n                      ? r.data.geometry.type === 'Point' && r.data.geometry\n                      : r.data.geometry\n                  )\n                )\n              )\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map((r) => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(\n                    (sp) =>\n                      sp.type ===\n                      (isCoord ? ProposalType.Coord : ProposalType.Text)\n                  );\n                  let storedSource = stop.searchProposals.find(\n                    (sp) => sp.source === source\n                  );\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter((stop) => stop.coordinates);\n    stopsWithCoordinates.map((stop) => this.addStopOverlay(stop));\n    this.stopsFeatureStore\n      .all()\n      .map((stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter((stop) => !stop.coordinates);\n    stopsWithoutCoordinates.map((stop) => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter((stop) => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(\n        stop.coordinates,\n        this.coordRoundedDecimals\n      );\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      this.routesQueries$$.push(\n        routeResponse.subscribe((directions) => {\n          this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n          directions.map((direction) =>\n            addDirectionToRoutesFeatureStore(\n              this.routesFeatureStore,\n              direction,\n              this.projection,\n              direction === directions[0] ? true : false\n            )\n          );\n        })\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(\n      stop,\n      this.stopsStore,\n      this.stopsFeatureStore,\n      this.projection,\n      this.languageService\n    );\n  }\n\n  onToggleDirectionsControl(isActive: boolean) {\n    this.queryService.queryEnabled = !isActive;\n    const ol = this.routesFeatureStore.layer.map.ol;\n    this.interactions.map((interaction) =>\n      isActive\n        ? ol.addInteraction(interaction)\n        : ol.removeInteraction(interaction)\n    );\n  }\n\n  onTogglePrivateModeControl(isActive: boolean) {\n    this.directionsSourceService.sources[0].profiles.forEach(\n      (profile) => (profile.enabled = false)\n    );\n    if (isActive) {\n      this.directionsSourceService.sources[0].profiles.find(\n        (profile) => profile.authorization\n      ).enabled = true;\n      this.messageService.alert(\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.forestRoadsWarning.text'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.forestRoadsWarning.title'\n        )\n      );\n    } else {\n      this.directionsSourceService.sources[0].profiles.find(\n        (profile) => !profile.authorization\n      ).enabled = true;\n    }\n    this.getRoutes();\n  }\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core/activity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Position } from 'geojson';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport { UserOptions } from 'jspdf-autotable';\nimport moment from 'moment';\nimport { Observable, Subject } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintService } from '../../print/shared/print.service';\nimport { PrintLegendPosition } from '../../print/shared/print.type';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSourceService } from './directions-source.service';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from './directions.utils';\n\n@Injectable()\nexport class DirectionsService {\n  constructor(\n    private directionsSourceService: DirectionsSourceService,\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private printService: PrintService,\n    @Inject(DOCUMENT) private document: Document,\n    private activityService: ActivityService\n  ) {}\n\n  route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.routeSource(\n      this.directionsSourceService.sources[0],\n      coordinates,\n      directionsOptions\n    );\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions);\n    return request;\n  }\n\n  downloadDirection(\n    map: IgoMap,\n    direction: Direction\n  ): Observable<SubjectStatus> {\n    const activityId = this.activityService.register();\n    const status$ = new Subject<SubjectStatus>();\n\n    const doc: jsPDF = new jsPDF({\n      orientation: 'p',\n      format: 'Letter',\n      unit: 'mm' // default\n    });\n\n    const { width: pageWidth, height: pageHeight } = doc.internal.pageSize;\n\n    /** top | right | bottom | left */\n    const margins: [number, number, number, number] = [20, 10, 20, 10];\n    this.addAttribution(map, doc, margins);\n    const width = pageWidth - margins[3] - margins[1];\n    const height = pageHeight - margins[0] - margins[2];\n    const imageDimensions: [number, number] = [width, height];\n    const title = `${direction.title} (${formatDistance(\n      direction.distance\n    )}, ${formatDuration(direction.duration)})`;\n    const titlePosition = 25;\n\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n\n    const resolution = 96; // Default is 96\n    this.printService\n      .addMap(\n        doc,\n        map,\n        resolution,\n        imageDimensions,\n        margins,\n        PrintLegendPosition.none\n      )\n      .subscribe(async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addInstructions(doc, direction, title);\n          this.setPageHeaderFooter(doc);\n          await doc.save(`${title}.pdf`, { returnPromise: true });\n        }\n\n        this.activityService.unregister(activityId);\n        status$.next(status);\n      });\n\n    return status$;\n  }\n\n  private addAttribution(\n    map: IgoMap,\n    doc: jsPDF,\n    margins: [number, number, number, number]\n  ) {\n    const verticalSpacing: number = 5;\n    const attributionText: string = this.printService.getAttributionText(map);\n    if (attributionText) {\n      margins[2] += verticalSpacing;\n      const xPosition = margins[3];\n      const marginBottom = margins[2];\n      // calculate text position Y\n      const yPosition =\n        doc.internal.pageSize.height - marginBottom + verticalSpacing;\n      doc.setFontSize(10);\n      doc.text(attributionText, xPosition, yPosition);\n    }\n  }\n\n  private async setHTMLTableContent(\n    direction: Direction\n  ): Promise<HTMLTableElement> {\n    const data = await this.directionsInstruction(direction);\n    const table = document.createElement('table');\n    const tblBody = document.createElement('tbody');\n    for (let index = 0; index < data.length; index++) {\n      const element = data[index];\n      var row = document.createElement('tr');\n      var cellImage = document.createElement('td');\n      var cellText = document.createElement('td');\n      // icon\n      const img = document.createElement('img') as HTMLImageElement;\n      img.src = element.icon;\n      // instruction text\n      const span = document.createElement('span') as HTMLElement;\n      span.innerHTML = element.instruction;\n      cellImage.appendChild(img);\n      cellText.appendChild(span);\n      if (element.distance) {\n        const spanDistance = document.createElement('span') as HTMLElement;\n        spanDistance.style.verticalAlign = 'middle';\n        spanDistance.innerHTML =\n          '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element.distance;\n        cellText.appendChild(spanDistance);\n      }\n      row.append(cellImage);\n      row.append(cellText);\n      tblBody.appendChild(row);\n    }\n    table.appendChild(tblBody);\n    return table;\n  }\n\n  private async directionsInstruction(\n    direction: Direction\n  ): Promise<Array<{ instruction: string; icon: string; distance: string }>> {\n    const matListItems = this.document\n      .getElementsByTagName('igo-directions-results')[0]\n      .getElementsByTagName('mat-list')[0];\n    const matListItem = matListItems.getElementsByTagName('mat-list-item');\n    // convert icon list to base64\n    let iconsArray: Array<{ name: string; icon: string }> = [];\n    for (let index = 0; index < matListItem.length; index++) {\n      const element = matListItem[index];\n      const icon = element.getElementsByTagName('mat-icon')[0] as HTMLElement;\n      const iconName = icon.innerText;\n      const found = iconsArray.some((el) => el.name === iconName);\n      if (!found) {\n        const iconCanvas = await html2canvas(icon, { scale: 3 });\n        iconsArray.push({ name: iconName, icon: iconCanvas.toDataURL() });\n      }\n    }\n\n    let formattedDirection: Array<{\n      instruction: string;\n      icon: string;\n      distance: string;\n    }> = [];\n    for (let i = 0; i < direction.steps.length; i++) {\n      const step = direction.steps[i];\n      const instruction = formatInstruction(\n        step.maneuver.type,\n        step.maneuver.modifier,\n        step.name,\n        step.maneuver.bearing_after,\n        i,\n        (step.maneuver as any).exit,\n        this.languageService,\n        i === direction.steps.length - 1\n      );\n\n      const distance = formatDistance(step.distance);\n      formattedDirection.push({\n        instruction: i + 1 + '. ' + instruction.instruction,\n        icon: iconsArray.find((icon) => icon.name === instruction.image).icon,\n        distance: distance ? '(' + distance + ')' : undefined\n      });\n    }\n    return formattedDirection;\n  }\n\n  private async addInstructions(\n    doc: jsPDF,\n    direction: Direction,\n    title: string\n  ) {\n    doc.addPage();\n    const titlePosition = 25;\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n    const HTMLtable = await this.setHTMLTableContent(direction);\n    const tablePos = titlePosition + 5;\n    (doc as any).autoTable({\n      html: HTMLtable,\n      startY: tablePos,\n      margin: { top: 20, bottom: 20 },\n      columnStyles: {\n        0: { cellWidth: 10 }\n      },\n      theme: 'plain',\n      styles: {\n        fontSize: 12\n      },\n      didDrawCell: function (data) {\n        if (data.column.index === 0 && data.cell.section === 'body') {\n          data.row.height = 10;\n          const td = data.cell.raw as HTMLElement;\n          const img = td.getElementsByTagName('img')[0];\n          doc.addImage(img.src, data.cell.x, data.cell.y, 8, 8);\n        }\n      }\n    } satisfies UserOptions);\n  }\n\n  private setPageHeaderFooter(doc: jsPDF) {\n    const pageCount = doc.getNumberOfPages();\n    const date = moment(Date.now()).format('DD/MM/YYYY hh:mm').toString();\n\n    const logoConfig = this.configService.getConfig('directionsSources.logo');\n    const logo = logoConfig ? logoConfig : 'assets/logo.png';\n\n    for (let index = 0; index < pageCount; index++) {\n      doc.setPage(index);\n      doc.setFontSize(8);\n      const pageSize = doc.internal.pageSize;\n      const pageHeight = pageSize.height\n        ? pageSize.height\n        : pageSize.getHeight();\n      const width = pageSize.width ? pageSize.width : pageSize.getWidth();\n      doc.text(date, 10, 10, { baseline: 'top' });\n      doc.addImage(logo, 'PNG', width - 20, 5, 10, 10);\n      doc.text(date, 10, pageHeight - 10);\n      doc.text(\n        'Page ' + doc.getCurrentPageInfo().pageNumber + ' / ' + pageCount,\n        width - 20,\n        pageHeight - 10\n      );\n    }\n  }\n}\n","import { LanguageService } from '@igo2/core/language';\nimport { NumberUtils, uuid } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olProj from 'ol/proj';\nimport * as olStyle from 'ol/style';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\nimport {\n  DirectionRelativePositionType,\n  DirectionType\n} from './directions.enum';\nimport {\n  Direction,\n  FeatureWithDirection,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(\n  stopsStore: StopsStore,\n  direction: 'asc' | 'desc' = 'asc',\n  field = 'position'\n) {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(\n  index: number,\n  totalLength\n): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(\n      stop.position,\n      stopsToComputePosition.length\n    );\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map((stop) => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore\n    .all()\n    .find((stop) => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(\n      lastPosition,\n      stopsStore.count + 1\n    );\n  }\n\n  stopsStore.insert({\n    id,\n    position: insertPosition,\n    relativePosition: computeRelativePosition(\n      insertPosition,\n      stopsStore.count + 1\n    )\n  });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`,\n        width: 10\n      })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`,\n        width: 6\n      })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(\n  stopsFeatureStore: StopsFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.stopLayer'\n    ),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.routeLayer'\n    ),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService\n) {\n  let stopColor;\n  let stopText;\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.start'\n      );\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.end'\n      );\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText =\n        languageService.translate.instant(\n          'igo.geo.directionsForm.intermediate'\n        ) +\n        ' #' +\n        stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(\n      stop.coordinates,\n      projection,\n      stopsFeatureStore.map.projection\n    )\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false\n) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  if (distance >= 1000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route: string = 'Voie',\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'arrow_forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix =\n    modifier === 'straight'\n      ? ''\n      : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory_arrow_right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory_arrow_right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'arrow_forward';\n  } else if (modifier === 'slight left') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory_arrow_left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory_arrow_left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', {\n        route\n      });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', {\n        route,\n        aggregatedDirection,\n        translatedModifier\n      });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', {\n      route,\n      translatedDirection\n    });\n    image = 'explore';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', {\n      route,\n      translatedDirection\n    });\n    image = 'explore';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', {\n        coma,\n        aggregatedDirection\n      });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', {\n        route\n      });\n      image = 'location_on';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', {\n      translatedModifier,\n      route\n    });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', {\n      route\n    });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix =\n      exit === 1\n        ? translate.instant('igo.geo.directions.cntSuffix.first')\n        : translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', {\n      exit,\n      cntSuffix,\n      route\n    });\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', {\n      route\n    });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', {\n      translatedDirection,\n      route\n    });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'explore' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(\n  bearing: number,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FeatureStore } from '../../feature/shared/store';\nimport {\n  FeatureWithDirection,\n  FeatureWithStep,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n  public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  public clearStops() {\n    this.storeInitialized$.next(false);\n    this.clear();\n  }\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {}\n","<table\n  class=\"igo-striped mat-typography\"\n  *ngIf=\"\n    ready &&\n    feature &&\n    isObject(feature.properties) &&\n    feature.properties.target !== 'iframe'\n  \"\n>\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <mat-icon matListItemIcon>{{ icon }}</mat-icon>\n      </td>\n\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          {{ 'igo.geo.targetHtmlUrl' | translate }} {{ title }}</a\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon>content_copy</mat-icon>\n        </button>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{ property.key }}\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          !isUrl(property.value) &&\n          !isEmbeddedLink(property.value)\n        \"\n        [innerHTML]=\"property.value\"\n      ></td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          isEmbeddedLink(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ getEmbeddedLinkText(property.value) }}</u\n        >\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          (isDoc(property.value) || isUrl(property.value)) &&\n          !isImg(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ 'igo.geo.targetHtmlUrl' | translate }}</u\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon>content_copy</mat-icon>\n        </button>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          isUrl(property.value) &&\n          isImg(property.value)\n        \"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          (click)=\"openSecureUrl(property.value)\"\n          rel=\"noopener noreferrer\"\n        >\n          <img\n            igoImageError\n            src=\"{{ property.value | secureImage | async }}\"\n            width=\"225\"\n            height=\"auto\"\n          />\n        </a>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined && isObject(property.value)\n        \"\n        [innerHTML]=\"property.value | json\"\n      ></td>\n    </tr>\n  </tbody>\n</table>\n\n<iframe\n  *ngIf=\"isHtmlDisplay()\"\n  [srcdoc]=\"htmlSanitizer(feature.properties)\"\n  [src]=\"urlSanitizer(feature.properties.url)\"\n></iframe>\n","import {\n  AsyncPipe,\n  JsonPipe,\n  KeyValuePipe,\n  NgFor,\n  NgIf,\n  NgStyle\n} from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n\nimport { getEntityIcon, getEntityTitle } from '@igo2/common/entity';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport type { Toolbox } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\nimport { Clipboard } from '@igo2/utils';\n\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { Feature } from '../shared';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    MatIconModule,\n    NgStyle,\n    ImageErrorDirective,\n    AsyncPipe,\n    JsonPipe,\n    KeyValuePipe,\n    IgoLanguageModule,\n    SecureImagePipe\n  ]\n})\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private configService: ConfigService\n  ) {\n    this.networkService\n      .currentState()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n      });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n  isHtmlDisplay(): boolean {\n    if (\n      this.feature &&\n      this.isObject(this.feature.properties) &&\n      this.feature.properties.target === 'iframe'\n    ) {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body) {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace(\n        '<head>',\n        `<head><base href=\"${url.origin}\">`\n      );\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot: RegExp = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\\\\s|$)'\n    );\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http\n        .get(url, {\n          responseType: 'blob'\n        })\n        .subscribe(\n          (docOrImage) => {\n            const fileUrl = URL.createObjectURL(docOrImage);\n            window.open(fileUrl, '_blank');\n            this.cdRef.detectChanges();\n          },\n          (error: Error) => {\n            this.messageService.error(\n              'igo.geo.targetHtmlUrlUnauthorized',\n              'igo.geo.targetHtmlUrlUnauthorizedTitle'\n            );\n          }\n        );\n    } else {\n      let url = value;\n      if (this.isEmbeddedLink(value)) {\n        var div = document.createElement('div');\n        div.innerHTML = value;\n        url = div.children[0].getAttribute('href');\n      }\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n      const matchRegex = /<a/g;\n      const match = value.match(matchRegex) || [];\n      const count = match.length;\n      if (count === 1) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n    return false;\n  }\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?:>).*?(?=<|$)/;\n    let text = value.match(regex)[0] as string;\n    text = text.replace(/>/g, '');\n    return text;\n  }\n\n  filterFeatureProperties(feature): { [key: string]: any } {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.forcedOffline$\n        .pipe(takeUntil(this.unsubscribe$))\n        .subscribe((state) => {\n          offlineButtonState = state;\n        });\n    }\n\n    if (\n      feature.properties &&\n      feature.properties.Route &&\n      this.toolbox &&\n      !this.toolbox.getTool('directions')\n    ) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach((field) => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (\n          this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttribute\n        ) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        } else if (\n          !this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttributeOffline\n        ) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (\n        this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttribute\n      ) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      } else if (\n        !this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttributeOffline\n      ) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n\n  /**\n   * Copy the url to a clipboard\n   */\n  copyTextToClipboard(value: string): void {\n    const successful = Clipboard.copy(value);\n    if (successful) {\n      this.messageService.success('igo.geo.query.link.message');\n    }\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\n\n@Directive({\n  // This directive allow to view the route between the user coordinates and the feature\n  selector: '[igoFeatureDetailsDirective]',\n  standalone: true\n})\nexport class FeatureDetailsDirective implements OnInit {\n  private component: FeatureDetailsComponent;\n\n  get feature() {\n    return this.component.feature;\n  }\n  feature$ = new BehaviorSubject(undefined);\n\n  @Output() routingEvent = new EventEmitter<void>();\n\n  @HostListener('selectFeature')\n  setFeature() {\n    this.feature$.next(this.feature);\n  }\n\n  constructor(\n    @Self() component: FeatureDetailsComponent,\n    private el: ElementRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.feature$.subscribe(() => {\n      if (this.feature.geometry) {\n        this.bindClicking();\n      }\n    });\n  }\n\n  bindClicking() {\n    setTimeout(() => {\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\n      if (routeElement) {\n        routeElement.addEventListener('click', () => {\n          this.routingEvent.emit();\n        });\n      }\n    }, 1);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\nexport const FEATURE_DETAILS_DIRECTIVES = [\n  FeatureDetailsComponent,\n  FeatureDetailsDirective\n] as const;\n\n/**\n * @deprecated import the FeatureDetailsComponent, FeatureDetailsDirective directly or the FEATURE_DETAILS_DIRECTIVES for all\n */\n@NgModule({\n  imports: [...FEATURE_DETAILS_DIRECTIVES],\n  exports: [...FEATURE_DETAILS_DIRECTIVES]\n})\nexport class IgoFeatureDetailsModule {}\n","import { AsyncPipe } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output,\n  ViewChild\n} from '@angular/core';\n\nimport { getEntityRevision } from '@igo2/common/entity';\nimport { Form, FormComponent } from '@igo2/common/form';\nimport { uuid } from '@igo2/utils';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FEATURE } from '../shared/feature.enums';\nimport { Feature, FeatureMeta } from '../shared/feature.interfaces';\n\n/**\n * A configurable form, optionnally bound to a feature.\n * This component creates an entity form and, on submit,\n * returns a feature made out of the submitted data. It also\n * does things like managing the feature visibility while it's being updated\n * as well as disabling the selection of another feature.\n */\n@Component({\n  selector: 'igo-feature-form',\n  templateUrl: './feature-form.component.html',\n  styleUrls: ['./feature-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [FormComponent, AsyncPipe]\n})\nexport class FeatureFormComponent {\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Feature to update\n   */\n  @Input()\n  set feature(value: Feature | undefined) {\n    this.feature$.next(value);\n  }\n  get feature(): Feature | undefined {\n    return this.feature$.value;\n  }\n  readonly feature$: BehaviorSubject<Feature> = new BehaviorSubject(undefined);\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<Feature>();\n\n  @ViewChild('igoForm', { static: true }) igoForm: FormComponent;\n\n  constructor() {}\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit(data: { [key: string]: any }) {\n    const feature = this.formDataToFeature(data);\n    this.submitForm.emit(feature);\n  }\n\n  getData(): Feature {\n    return this.formDataToFeature(this.igoForm.getData());\n  }\n\n  /**\n   * Transform the form data to a feature\n   * @param data Form data\n   * @returns A feature\n   */\n  private formDataToFeature(data: { [key: string]: any }): Feature {\n    const properties = {};\n    const meta = {};\n    if (this.feature === undefined) {\n      (meta as any).id = uuid();\n    } else {\n      Object.assign(properties, this.feature.properties);\n      Object.assign(meta, this.feature.meta, {\n        revision: getEntityRevision(this.feature) + 1\n      });\n    }\n\n    const propertyPrefix = 'properties.';\n    Object.entries(data).forEach((entry: [string, any]) => {\n      const [key, value] = entry;\n      if (key.startsWith(propertyPrefix)) {\n        const property = key.substr(propertyPrefix.length);\n        properties[property] = value;\n      }\n    });\n\n    let geometry = data.geometry;\n    if (geometry === undefined && this.feature !== undefined) {\n      geometry = this.feature.geometry;\n    }\n\n    return {\n      meta: meta as FeatureMeta,\n      type: FEATURE,\n      geometry,\n      projection: 'EPSG:4326',\n      properties\n    };\n  }\n}\n","<igo-form\n  #igoForm\n  [form]=\"form\"\n  [formData]=\"feature$ | async\"\n  (submitForm)=\"onSubmit($event)\"\n>\n  <ng-content></ng-content>\n\n  <ng-content select=\"[formButtons]\" formButtons></ng-content>\n</igo-form>\n","import { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureStore } from './store';\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import {\n  EntityKey,\n  getEntityIcon,\n  getEntityId,\n  getEntityProperty,\n  getEntityRevision,\n  getEntityTitle\n} from '@igo2/common/entity';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport type { GeometryLayout } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLayer from 'ol/layer/Layer';\nimport * as olproj from 'ol/proj';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlSource from 'ol/source/Source';\nimport * as olstyle from 'ol/style';\n\nimport { MapViewController } from '../../map/shared/controllers/view';\nimport { MapExtent } from '../../map/shared/map.interface';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(\n    olRenderFeature.getExtent(),\n    projectionIn,\n    projectionOut\n  ) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        (sourceOptions.type === 'arcgisrest' ||\n        sourceOptions.type === 'tilearcgisrest'\n          ? 'OBJECTID'\n          : undefined);\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId()\n    ? olFeature.getId()\n    : olFeature.get(idColumn)\n      ? olFeature.get(idColumn)\n      : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  olFeature: OlFeature<OlGeometry>,\n  projection: olproj.Projection\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  olFeatures: OlFeature<OlGeometry>[],\n  projection: olproj.Projection\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(olFeature, projection);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * By default, we define the edge as 5% (0.05) of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param edgeRatio Number or Number[] Single value OR an array =>\n *  [top,right,bottom,left] directions, in that order\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  extent: MapExtent,\n  featuresExtent: [number, number, number, number],\n  edgeRatio: number | number[] = 0.05\n) {\n  const edgesRatio = Array.isArray(edgeRatio)\n    ? edgeRatio\n    : [edgeRatio, edgeRatio, edgeRatio, edgeRatio];\n  const scale = [-1, -1, -1, -1].map((x, i) => x * edgesRatio[i]);\n  const viewExtent = scaleExtent(\n    extent,\n    scale as [number, number, number, number]\n  );\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  viewController: MapViewController,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  viewController: MapViewController,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const extent = viewController.getExtent();\n  const projection = viewController.getOlProjection();\n  const featuresExtent = computeOlFeaturesExtent(olFeatures, projection);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(extent, featuresExtent) ||\n      featuresAreTooDeepInView(viewController, featuresExtent, areaRatio)\n    ) {\n      viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { Subscription, debounceTime } from 'rxjs';\n\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$.subscribe(() =>\n      this.updateEntitiesInResolution(\n        store,\n        store.layer.map.viewController.getResolution()\n      )\n    );\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(\n      store,\n      store.layer.map.viewController.getResolution()\n    );\n    this.resolution$$.push(\n      store.layer.map.viewController.resolution$\n        .pipe(debounceTime(250))\n        .subscribe((res) => {\n          this.updateEntitiesInResolution(store, res);\n        })\n    );\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (\n      mapResolution > store.layer.minResolution &&\n      mapResolution < store.layer.maxResolution\n    ) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\n\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { GeoServiceDefinition } from '../../../utils/propertyTypeDetector/propertyTypeDetector.interface';\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport {\n  Feature,\n  FeatureStorePropertyTypeStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated to detect geoproperties\n * (wms/arcgis... layer and url).\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\n */\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  /**\n   * The map the layer is bound to\n   */\n  private readonly map: IgoMap;\n\n  constructor(\n    protected options: FeatureStorePropertyTypeStrategyOptions,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {\n    super(options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesPropertiesState(store);\n    this.states$$.push(\n      this.map.layers$\n        .pipe(debounceTime(250), pairwise())\n        .subscribe(([prevLayers, currentLayers]) => {\n          let prevLayersId;\n          if (prevLayers) {\n            prevLayersId = prevLayers.map((l) => l.id);\n          }\n          const layers = currentLayers.filter(\n            (l) => !prevLayersId.includes(l.id)\n          );\n          this.updateEntitiesPropertiesState(store, layers);\n        })\n    );\n    this.states$$.push(\n      store.entities$.pipe(debounceTime(250)).subscribe((a) => {\n        this.updateEntitiesPropertiesState(store);\n      })\n    );\n  }\n\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\n    const layersId = this.map.layers.map((l) => l.id);\n    let entities: Feature[] = [];\n    if (layers) {\n      entities = store.entities$.value;\n    } else {\n      const allSV = store.stateView.all();\n      entities = allSV.length\n        ? store.stateView\n            .all()\n            .filter((s) => !s.state.geoService)\n            .map((e) => e.entity)\n        : store.entities$.value;\n    }\n    const sampling = entities.length >= 250 ? 250 : entities.length;\n    const firstN = entities.slice(0, sampling);\n    let allKeys = [];\n    firstN.map((e) => {\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\n    });\n    allKeys = [...new Set(allKeys)];\n    const distinctValues = {};\n    allKeys.map((k) => {\n      distinctValues[k] = [\n        ...new Set(entities.map((item) => item.properties[k]))\n      ];\n    });\n    const containGeoServices = {};\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      const valuedAreGeoservices = values.filter((value) =>\n        this.propertyTypeDetectorService.isGeoService(value)\n      );\n      if (valuedAreGeoservices?.length) {\n        containGeoServices[key] = valuedAreGeoservices;\n      }\n    });\n    interface GeoServiceAssociation {\n      url: string;\n      layerNameProperty: string;\n      urlProperty: string;\n      geoService: GeoServiceDefinition;\n    }\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      values.map((value) => {\n        const geoService = this.propertyTypeDetectorService.getGeoService(\n          value,\n          allKeys\n        );\n        if (geoService) {\n          const propertiesForLayerName = allKeys.filter((p) =>\n            geoService.propertiesForLayerName.includes(p)\n          );\n          // providing the the first matching regex;\n          const propertyForLayerName = propertiesForLayerName.length\n            ? propertiesForLayerName[0]\n            : undefined;\n          if (propertyForLayerName) {\n            geoServiceAssociations.push({\n              url: value,\n              urlProperty: key,\n              layerNameProperty: propertyForLayerName,\n              geoService\n            });\n          }\n        }\n      });\n    });\n    const geoServiceStates: {\n      geoServiceAssociation: GeoServiceAssociation;\n      state: any;\n    }[] = [];\n    geoServiceAssociations.map((geoServiceAssociation) => {\n      const url = geoServiceAssociation.url;\n      const type = geoServiceAssociation.geoService.type || 'wms';\n      distinctValues[geoServiceAssociation.layerNameProperty].map(\n        (layerName) => {\n          let appliedLayerName = layerName;\n          let arcgisLayerName = undefined;\n          if (\n            ['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)\n          ) {\n            appliedLayerName = undefined;\n            arcgisLayerName = layerName;\n          }\n          const so = ObjectUtils.removeUndefined({\n            sourceOptions: {\n              type: type || 'wms',\n              url,\n              optionsFromCapabilities: true,\n              optionsFromApi: true,\n              params: {\n                LAYERS: appliedLayerName,\n                LAYER: arcgisLayerName\n              }\n            }\n          });\n          const potentialLayerId = generateIdFromSourceOptions(\n            so.sourceOptions\n          );\n          geoServiceStates.push({\n            geoServiceAssociation,\n            state: {\n              added: layersId.find((l) => l === potentialLayerId) !== undefined,\n              haveGeoServiceProperties: true,\n              type,\n              url,\n              layerName\n            }\n          });\n        }\n      );\n    });\n    geoServiceStates.map((geoServiceState) => {\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\n      const layerNameProperty =\n        geoServiceState.geoServiceAssociation.layerNameProperty;\n\n      const urlValue = geoServiceState.state.url;\n      const layerNameValue = geoServiceState.state.layerName;\n      const entitiesToProcess = entities.filter(\n        (e) =>\n          e.properties[urlProperty] === urlValue &&\n          e.properties[layerNameProperty] === layerNameValue\n      );\n      const ns = {\n        geoService: geoServiceState.state\n      };\n      store.state.updateMany(entitiesToProcess, ns, true);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport OlEvent from 'ol/events/Event';\n\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { DocumentOptions, Document as FlexSearchDocument } from 'flexsearch';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n *\n * This strategy loads a layer's features's properties into a searchable index.\n */\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  private initStoreSearchIndex(store) {\n    store.searchDocument = new FlexSearchDocument({ tokenize: 'full' });\n  }\n\n  /**\n   * Watch for a store's entities changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n    this.initStoreSearchIndex(store);\n\n    store.entities$\n      .pipe(skipWhile((e) => !e.length))\n      .subscribe(() => this.onEntitiesChanges(store));\n  }\n\n  /**\n   * Stop watching for a store's entities changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      store.searchDocument = undefined;\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Maintain searcahble index for every loaded entities\n   * @param store Feature store\n   */\n  private onEntitiesChanges(store: FeatureStore) {\n    const ratio = this.options.percentDistinctValueRatio || 2;\n    const featuresProperties = [];\n    store.index.forEach((value, key) => {\n      const fp = value.properties;\n      fp.igoSearchID = key;\n      featuresProperties.push(fp);\n    });\n    const toIndex = [];\n    let columnsToNotIndex = [];\n    let contentToIndex = [];\n    if (this.options.sourceFields) {\n      columnsToNotIndex = this.options.sourceFields.filter(\n        (sf) => !sf.searchIndex?.enabled\n      );\n      contentToIndex = this.options.sourceFields\n        .filter((sf) => sf.searchIndex?.enabled)\n        .map((sf2) => {\n          return Object.assign(\n            {},\n            { field: sf2.name, tokenize: 'full' },\n            sf2.searchIndex\n          );\n        });\n    } else {\n      if (featuresProperties.length) {\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\n        const columns = Object.keys(featuresProperties[0]);\n        const columnsToIndex = [];\n        columnsToNotIndex = columns\n          .map((column) => {\n            const distinctValues = [\n              ...new Set(featuresProperties.map((item) => item[column]))\n            ];\n            // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\n            if (\n              (distinctValues.length / featuresProperties.length) * 100 <=\n                ratio ||\n              distinctValues.every((n) => Number(n) === n && n % 1 !== 0)\n            ) {\n              columnsToNotIndex.push(column);\n            } else {\n              columnsToIndex.push(column);\n            }\n          })\n          .filter((f) => f);\n        const keysToIndex = columnsToIndex.filter((f) => f !== 'igoSearchID');\n        contentToIndex = keysToIndex.map((key) => {\n          return { field: key, tokenize: 'full' };\n        });\n      }\n    }\n    store.index.forEach((value, key) => {\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\n      columnsToNotIndex.map((c) => delete propertiesToIndex[c]);\n      if (Object.keys(propertiesToIndex).length) {\n        toIndex.push(propertiesToIndex);\n      }\n    });\n\n    if (toIndex.length === 0) {\n      this.initStoreSearchIndex(store);\n    } else {\n      store.searchDocument = new FlexSearchDocument({\n        document: {\n          id: 'igoSearchID',\n          index: contentToIndex\n        } as DocumentOptions<any>\n      });\n      toIndex.map((i) => {\n        store.searchDocument.add(i.igoSearchID, i);\n      });\n    }\n  }\n}\n","import { EntityKey, EntityStore, getEntityId } from '@igo2/common/entity';\n\nimport OlFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Document } from 'flexsearch';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap, MapExtent } from '../../map/shared';\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport {\n  computeOlFeaturesDiff,\n  computeOlFeaturesExtent,\n  featureFromOl,\n  featureToOl,\n  moveToOlFeatures\n} from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer\n      ? (this.layer.dataSource as FeatureDataSource)\n      : undefined;\n  }\n\n  /**\n   * The searchable index of loaded feature. Computed if strategy is provided\n   */\n  set searchDocument(v: Document<T>) {\n    this._searchDocument = v;\n  }\n\n  get searchDocument(): Document<T> {\n    return this._searchDocument;\n  }\n  private _searchDocument: Document<T>;\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features.map((feature: Feature) =>\n      featureToOl(feature, this.map.projection, getId)\n    );\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(\n        this.map.viewController,\n        diff.add,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(\n        this.map.viewController,\n        olFeatures,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    }\n  }\n\n  setLayerExtent(): void {\n    let features = this.entities$.getValue();\n    let extent = olextent.createEmpty() as MapExtent;\n    let olFeatures = [];\n\n    features.forEach((feature) => {\n      olFeatures.push(featureToOl(feature, this.map.projection));\n    });\n    const featuresExtent = computeOlFeaturesExtent(\n      olFeatures,\n      this.map.viewProjection\n    );\n    olextent.extend(extent, featuresExtent);\n    this.layer.setExtent(extent);\n  }\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport * as olextent from 'ol/extent';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime, skipWhile } from 'rxjs/operators';\n\nimport { MapExtent } from '../../../map/shared/map.interface';\nimport {\n  Feature,\n  FeatureStoreInMapExtentStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(\n      store.layer.map.viewController.state$\n        .pipe(debounceTime(250))\n        .subscribe(() => this.updateEntitiesInExtent(store))\n    );\n  }\n\n  private updateEntitiesInExtent(store: FeatureStore) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      const features = store.entities$.value;\n      const entitiesInMapExtent = this.getFeaturesInExtent(features, mapExtent);\n      store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n    }\n  }\n\n  private getFeaturesInExtent(\n    features: Feature<any>[],\n    extent: MapExtent\n  ): Feature[] {\n    return features.reduce((acc, feature) => {\n      const geom = feature.ol?.getGeometry();\n      if (geom) {\n        const featureExtent = geom.getExtent();\n\n        if (olextent.intersects(featureExtent, extent)) {\n          acc.push(feature);\n        }\n      } else {\n        // By default, keep entity with no geometry\n        acc.push(feature);\n      }\n      return acc;\n    }, []);\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { Subscription } from 'rxjs';\n\nimport { FeatureMotion } from '../feature.enums';\nimport {\n  Feature,\n  FeatureStoreLoadingStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view\n      .all$()\n      .subscribe((features: Feature[]) =>\n        this.onFeaturesChange(features, store)\n      );\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, Subscription]) => {\n        entries[1].unsubscribe();\n      }\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) {\n      return this.motion;\n    }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import {\n  EntityKey,\n  EntityRecord,\n  EntityStoreStrategy\n} from '@igo2/common/entity';\n\nimport OlFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\nimport { FeatureMotion } from '../feature.enums';\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: (olLayer) => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer?.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map(\n      (olFeature: OlFeature<OlGeometry>) => olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","export enum OgcFilterOperatorType {\n  BasicNumericOperator = 'basicnumericoperator',\n  Basic = 'basic',\n  BasicAndSpatial = 'basicandspatial',\n  Spatial = 'spatial',\n  All = 'all',\n  Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n  BBOX = 'BBox',\n  PropertyIsBetween = 'PropertyIsBetween',\n  Contains = 'Contains',\n  During = 'During',\n  PropertyIsEqualTo = 'PropertyIsEqualTo',\n  PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n  PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n  Intersects = 'Intersects',\n  PropertyIsNull = 'PropertyIsNull',\n  PropertyIsLessThan = 'PropertyIsLessThan',\n  PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n  PropertyIsLike = 'PropertyIsLike',\n  PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n  Within = 'Within',\n  And = 'And',\n  Or = 'Or',\n  Not = 'Not'\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { Extent } from 'ol/extent';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olFormatWKT from 'ol/format/WKT';\nimport * as olfilter from 'ol/format/filter';\nimport olGeometry from 'ol/geom/Geometry';\nimport olProjection from 'ol/proj/Projection';\n\nimport { default as moment } from 'moment';\n\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator, OgcFilterOperatorType } from './ogc-filter.enum';\nimport {\n  AnyBaseOgcFilterOptions,\n  IgoOgcFilterObject,\n  IgoOgcSelector,\n  OgcFilter,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions,\n  OgcSelectorBundle,\n  SelectorGroup\n} from './ogc-filter.interface';\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (\n      ogcFiltersOptions.enabled &&\n      (ogcFiltersOptions.pushButtons ||\n        ogcFiltersOptions.checkboxes ||\n        ogcFiltersOptions.radioButtons ||\n        ogcFiltersOptions.select ||\n        ogcFiltersOptions.autocomplete)\n    ) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: Extent,\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40 * -1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern\n            ? wfsPattern.replace(/[()_]/gi, wfsSingleChar)\n            : wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n        ? proj.getCode()\n        : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error('You must set an id for each of your bundles');\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: Extent,\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (\n      ogcFilters.enabled &&\n      (ogcFilters.pushButtons ||\n        ogcFilters.checkboxes ||\n        ogcFilters.radioButtons ||\n        ogcFilters.select ||\n        ogcFilters.autocomplete)\n    ) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (\n        ogcFilters.filters &&\n        'operator' in ogcFilters.filters &&\n        ogcFilters.filters.operator.toLowerCase() ===\n          OgcFilterOperator.During.toLowerCase() &&\n        ogcFilters.filters.active &&\n        ogcFilters.interfaceOgcFilters?.length > 0\n      ) {\n        conditions.push(ogcFilters.interfaceOgcFilters[0]);\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach((bundle) => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce(\n          (list, filter, index) =>\n            filter.enabled === true ? list.concat(index) : list,\n          []\n        );\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach((index) => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(selectors);\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) =>\n          bundleCondition.push(enabledSelector.filters)\n        );\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n    if (!processedFilter) {\n      return undefined;\n    }\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (\n      value.toLowerCase().includes('now') ||\n      value.toLowerCase().includes('today')\n    ) {\n      return this.parseDateOperation(value);\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n  /**\n   * this function to parse date with specific format\n   * exemple 'today + 1 days' or 'now + 1 years'\n   * @param value string date\n   * @returns date\n   */\n  private parseDateOperation(value: string): string {\n    const operationSplitted = value.toLowerCase().split(' ');\n    const leftOperand = operationSplitted[0];\n    const operator = ['+', '-'].includes(operationSplitted[1])\n      ? operationSplitted[1]\n      : undefined;\n    const rightOperand = /^[0-9]*$/.test(operationSplitted[2])\n      ? operationSplitted[2]\n      : undefined;\n    const rightUnitOperand = (\n      ['years', 'months', 'weeks', 'days', 'hours', 'seconds'].includes(\n        operationSplitted[3]\n      )\n        ? operationSplitted[3]\n        : undefined\n    ) as moment.DurationInputArg2;\n\n    if (!operator || !rightUnitOperand || !rightOperand) {\n      return leftOperand === 'now'\n        ? moment().format()\n        : moment().endOf('day').format();\n    }\n\n    if (operator === '+') {\n      return leftOperand === 'now'\n        ? moment().add(parseInt(rightOperand, 10), rightUnitOperand).format()\n        : moment()\n            .endOf('day')\n            .add(parseInt(rightOperand, 10), rightUnitOperand)\n            .format();\n    } else {\n      return leftOperand === 'now'\n        ? moment()\n            .subtract(parseInt(rightOperand, 10), rightUnitOperand)\n            .format()\n        : moment()\n            .endOf('day')\n            .subtract(parseInt(rightOperand, 10), rightUnitOperand)\n            .format();\n    }\n  }\n}\n","export enum TimeFilterType {\n  DATE = 'date',\n  TIME = 'time',\n  DATETIME = 'datetime',\n  YEAR = 'year'\n}\n\nexport enum TimeFilterStyle {\n  CALENDAR = 'calendar',\n  SLIDER = 'slider'\n}\n","import OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport BasicEvent from 'ol/events/Event';\nimport { doubleClick } from 'ol/events/condition';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDraw from 'ol/interaction/Draw';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { BehaviorSubject, Subject, Subscription, fromEvent } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: Type | string;\n  drawingLayerSource?: OlVectorSource;\n  drawingLayer?: OlVectorLayer<OlVectorSource>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n  public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Observables from predefined radius (defaults to false and undefined)\n   */\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometry | undefined | string;\n  private olInteractionStyle: OlStyleLike;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n  public radius: number;\n\n  private mousePosition: [number, number];\n\n  /**\n   * take the value of radius\n   */\n  get radiusVal(): number {\n    return this.predefinedRadius$.getValue();\n  }\n  set radiusValData(radiusCercle: number) {\n    this.predefinedRadius$.next(radiusCercle);\n  }\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer\n      ? options.drawingLayer\n      : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n    this.olInteractionStyle = this.options.interactionStyle;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource {\n    return this.olDrawingLayerSource;\n  }\n\n  setOlInteractionStyle(style) {\n    this.olInteractionStyle = style;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: Type) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Get the current geometry type\n   */\n  getGeometryType() {\n    return this.olGeometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource\n        ? this.options.drawingLayerSource\n        : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      if (!this.ispredefinedRadius$.getValue()) {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: 'Point',\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      }\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          style:\n            typeof this.olInteractionStyle === 'function'\n              ? undefined\n              : this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n    this.onDrawStartKey = olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) =>\n      this.onDrawEnd(event)\n    );\n    this.onDrawAbortKey = olDrawInteraction.on(\n      'drawabort',\n      (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry())\n    );\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) =>\n          this.onSelect(event)\n        );\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([\n      this.onDrawStartKey,\n      this.onDrawEndKey,\n      this.onDrawKey,\n      this.onDrawAbortKey\n    ]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    if (event.feature.getGeometry().getType() === 'Point') {\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\n    }\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        // On Escape or 'c' keydowns, abort the current drawing\n        if (event.key === 'Escape') {\n          this.olDrawInteraction.abortDrawing();\n          return;\n        }\n\n        // On Backspace or 'u' keydowns, remove last vertex of current drawing\n        if (event.key === 'Backspace') {\n          this.olDrawInteraction.removeLastPoint();\n        }\n\n        // On Enter or 'f' keydowns, finish current drawing\n        if (event.key === 'Enter') {\n          this.olDrawInteraction.finishDrawing();\n        }\n\n        // On space bar key down, pan to the current mouse position\n        if (event.key === ' ') {\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 100\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport OlMap from 'ol/Map';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport BasicEvent from 'ol/events/Event';\nimport OlCircle from 'ol/geom/Circle';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport OlDraw from 'ol/interaction/Draw';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlModify from 'ol/interaction/Modify';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition =\n          getMousePositionFromOlGeometryEvent(olGeometryEvent);\n        this.changes$.next(\n          olGeometryEvent.target as OlLineString | OlCircle | OlPolygon\n        );\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = (\n      (olGeometry as any).getLinearRing() as any\n    ).getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n      const _linearRingCoordinates = olGeometryTarget\n        .getLinearRing(0)\n        .getCoordinates();\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n      this.changes$.next(this.getOlGeometry());\n    });\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = (\n      (event.feature.getGeometry() as any).getLinearRing() as any\n    ).getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super(\"Can't slice a MultiPolygon.\");\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super(\"Can't slice with a line that has more than 2 points.\");\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super(\n      'More than 2 intersections found between the target polygon and the slicing line.'\n    );\n    Object.setPrototypeOf(\n      this,\n      GeometrySliceTooManyIntersectionError.prototype\n    );\n  }\n}\n","import BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport * as olstyle from 'ol/style';\n\nimport { lineString } from '@turf/helpers';\nimport lineIntersect from '@turf/line-intersect';\n\nimport {\n  GeometrySliceLineStringError,\n  GeometrySliceMultiPolygonError,\n  GeometrySliceTooManyIntersectionError\n} from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(\n  color?: [number, number, number]\n): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(\n  olLineString: OlLineString,\n  olSlicer: OlLineString\n): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(\n  olPolygon: OlPolygon,\n  olSlicer: OlLineString\n): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(\n  olPolygon: OlPolygon,\n  olLinearRing: OlLinearRing\n) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(olEvent: BasicEvent) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","export const LAYER = 'Layer';\n","import { AnyLayerOptions } from '../shared/layers/any-layer.interface';\nimport { VectorTileLayerOptions } from '../shared/layers/vectortile-layer.interface';\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle ||\n      vectorTileLayerOptions.igoStyle?.hoverStyle)\n  ) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import { Injectable } from '@angular/core';\n\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, Subject, of } from 'rxjs';\nimport { concatMap, first } from 'rxjs/operators';\n\nimport { LayerDBData } from './layerDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerDBService {\n  readonly dbName: string = 'layerData';\n\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\n\n  /**\n   * This method allow to update the stored layer into the indexeddb (layerData)\n   * @param layerDBData\n   * @returns\n   */\n  update(layerDBData: LayerDBData): Observable<any> {\n    const subject: Subject<LayerDBData> = new Subject();\n    this.ngxIndexedDBService\n      .getByID(this.dbName, layerDBData.layerId)\n      .pipe(\n        first(),\n        concatMap((dbObject: LayerDBData) => {\n          if (!dbObject) {\n            return this.ngxIndexedDBService.add(this.dbName, layerDBData);\n          } else {\n            return this.customUpdate(layerDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\n    const subject: Subject<LayerDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      layerDBData.layerId\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, layerDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  /**\n   * This method retrieve an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getByID(layerId: string): Observable<LayerDBData> {\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\n  }\n\n  /**\n   * This method delete an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  deleteByKey(layerId: string): Observable<boolean> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\n  }\n\n  /**\n   * This method retrive all idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getAll(): Observable<LayerDBData[]> {\n    return this.ngxIndexedDBService.getAll(this.dbName);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport { Style } from 'ol/style';\nimport * as olStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { stylefunction } from 'ol-mapbox-style';\nimport { Observable, combineLatest, of } from 'rxjs';\nimport { catchError, concatMap, map } from 'rxjs/operators';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\nimport {\n  ArcGISRestDataSource,\n  CartoDataSource,\n  ClusterDataSource,\n  FeatureDataSource,\n  ImageArcGISRestDataSource,\n  MVTDataSource,\n  OSMDataSource,\n  TileArcGISRestDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMSDataSource,\n  WMTSDataSource,\n  WebSocketDataSource,\n  XYZDataSource\n} from '../../datasource/shared/datasources';\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport {\n  AnyLayerOptions,\n  ImageLayer,\n  ImageLayerOptions,\n  Layer,\n  LayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetworkService: GeoNetworkService,\n    private messageService: MessageService,\n    private layerDBService: LayerDBService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(\n    _layerOptions: AnyLayerOptions,\n    detailedContextUri?: string\n  ): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable((d) => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map((source) => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\n    let igoLayer: VectorLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'clusterBaseStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n    if (\n      layerOptions.igoStyle.igoStyleObject &&\n      !layerOptions.idbInfo?.storeToIdb\n    ) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    } else if (\n      layerOptions.igoStyle.igoStyleObject &&\n      layerOptions.idbInfo?.storeToIdb\n    ) {\n      // temporary fix todo : handle it with geostyler.\n      style = this.styleService.parseStyle(\n        'style',\n        layerOptions.igoStyle.igoStyleObject\n      );\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\n    legacyStyleOptions.map((legacyOption) => {\n      if (layerOptions[legacyOption]) {\n        let newKey = legacyOption;\n        if (legacyOption === 'style') {\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\n            return;\n          }\n          if (typeof layerOptions[legacyOption] === 'object') {\n            newKey = 'igoStyleObject';\n          } else {\n            return;\n          }\n        }\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\n        delete layerOptions[legacyOption];\n        console.warn(`\n        The location of this style option (${legacyOption}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `);\n      }\n    });\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n\n    if (layerOptions.igoStyle.igoStyleObject) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    }\n\n    if (layerOptions.igoStyle.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.igoStyle?.mapboxStyle) {\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe((res) => {\n        if (res.sprite) {\n          const url = this.getAbsoluteUrl(\n            layerOptions.igoStyle.mapboxStyle.url,\n            res.sprite\n          );\n          this.getStuff(url + '.json').subscribe((res2) => {\n            stylefunction(\n              layer.ol as olLayerVectorTile,\n              res,\n              layerOptions.igoStyle.mapboxStyle.source,\n              undefined,\n              res2,\n              url + '.png'\n            );\n          });\n        } else {\n          stylefunction(\n            layer.ol as olLayerVectorTile,\n            res,\n            layerOptions.igoStyle.mapboxStyle.source\n          );\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|//', 'i');\n    if (r.test(url)) {\n      return url;\n    } else {\n      if (source.substr(source.length - 1) === '/') {\n        return source + url;\n      } else {\n        return source + '/' + url;\n      }\n    }\n  }\n\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\n    return this.layerDBService.getAll().pipe(\n      concatMap((res) => {\n        const idbLayers =\n          contextUri !== '*'\n            ? res.filter((l) => l.detailedContextUri === contextUri)\n            : res;\n        const layersOptions: LayerOptions[] = idbLayers.map((idbl) =>\n          Object.assign({}, idbl.layerOptions, {\n            sourceOptions: idbl.sourceOptions\n          })\n        );\n        return combineLatest(\n          layersOptions.map((layerOptions) =>\n            this.createAsyncLayer(layerOptions)\n          )\n        );\n      })\n    );\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ImageWatcher } from '../../utils/image-watcher';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { Layer } from './layer';\n\nexport class ImageLayer extends Layer {\n  public declare dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public declare options: ImageLayerOptions;\n  public declare ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe((valStatus) => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(\n    tile,\n    src: string,\n    interceptor: AuthInterceptor,\n    messageService: MessageService\n  ) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function () {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(\n          'igo.geo.dataSource.optionsApiUnavailable',\n          'igo.geo.dataSource.unavailableTitle'\n        );\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport Tile from 'ol/Tile';\nimport olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\n\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { TileWatcher } from '../../utils/tile-watcher';\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nexport class TileLayer extends Layer {\n  public declare dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public declare options: TileLayerOptions;\n  public declare ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor) {\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport VectorTile from 'ol/VectorTile';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { TileWatcher } from '../../utils/tile-watcher';\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\n\nexport class VectorTileLayer extends Layer {\n  public declare dataSource: MVTDataSource;\n  public declare options: VectorTileLayerOptions;\n  public declare ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(\n        url,\n        tile.getFormat(),\n        this.authInterceptor,\n        tile.onLoad.bind(tile)\n      );\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    });\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return (extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open('GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(\n              this,\n              format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              }),\n              format.readProjection(source)\n            );\n          } else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    };\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { Message } from '@igo2/core/message';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { MapExtent } from '../../../map/shared/map.interface';\nimport { LegendOptions } from './legend.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  security?: LayerSecurityOptions;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n  showButtonZoomToExtent?: boolean;\n}\n\nexport interface LayerSecurityOptions {\n  profils?: string[];\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n  searchIndexEnabled?: boolean;\n  printable?: boolean;\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  /** Default value is true */\n  showInMiniBaseMap?: boolean;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { Message, MessageService } from '@igo2/core/message';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { Legend } from '../../../datasource/shared/datasources/datasource.interface';\nimport type { MapBase } from '../../../map/shared/map.abstract';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport { LayerOptions } from './layer.interface';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: MapBase;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value) {\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter((m) => m.options?.showOnEachLayerVisibility)\n        .map((message) => this.showMessage(message));\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor,\n    protected geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution =\n      options.maxResolution ||\n      getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution =\n      options.minResolution ||\n      getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(map: MapBase | undefined) {\n    this.map = map;\n\n    this.unobserveResolution();\n    if (map !== undefined) {\n      this.observeResolution();\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map((message) => {\n            this.showMessage(message);\n          });\n        }\n      });\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution =\n        this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange =\n        resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport OlFeature from 'ol/Feature';\nimport { unByKey } from 'ol/Observable';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { easeOut } from 'ol/easing';\nimport BaseEvent from 'ol/events/Event';\nimport { Extent } from 'ol/extent';\nimport { FeatureLoader } from 'ol/featureloader';\nimport * as olformat from 'ol/format';\nimport olLayerVector from 'ol/layer/Vector';\nimport * as olproj from 'ol/proj';\nimport olProjection from 'ol/proj/Projection';\nimport { getVectorContext } from 'ol/render';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { fromEvent, of, zip } from 'rxjs';\nimport {\n  catchError,\n  concatMap,\n  debounceTime,\n  delay,\n  first\n} from 'rxjs/operators';\n\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  buildUrl,\n  defaultMaxFeatures\n} from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map/shared';\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBData } from '../../../offline/layerDB/layerDB.interface';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport {\n  GeoNetworkService,\n  SimpleGetOptions\n} from '../../../offline/shared/geo-network.service';\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\nimport { VectorWatcher } from '../../utils/vector-watcher';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\n\nexport class VectorLayer extends Layer {\n  private previousLoadExtent: Extent;\n  private previousLoadResolution: number;\n  private previousOgcFilters: OgcFiltersOptions;\n  private xhrAccumulator: XMLHttpRequest[] = [];\n  public declare dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public declare options: VectorLayerOptions;\n  public declare ol: olLayerVector<olSourceVector>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    public geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    super(\n      options,\n      messageService,\n      authInterceptor,\n      geoDBService,\n      layerDBService\n    );\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector> {\n    const initialOpacityValue = this.options.opacity || 1;\n    const initialVisibleValue = this.options.visible !== false;\n    const initialMinResValue =\n      this.options.minResolution ||\n      getResolutionFromScale(Number(this.options.minScaleDenom));\n    const initialMaxResValue =\n      this.options.maxResolution ||\n      getResolutionFromScale(Number(this.options.maxScaleDenom));\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\n    if (this.dataSource instanceof FeatureDataSource) {\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\n        this.options.opacity = 0;\n        if (\n          so.preload.bypassResolution &&\n          (this.options.minResolution || this.options.maxResolution)\n        ) {\n          this.options.minResolution = 0;\n          this.options.maxResolution = Infinity;\n        }\n        if (so.preload.bypassVisible && !initialVisibleValue) {\n          this.options.visible = true;\n        }\n      }\n    }\n\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector,\n      sourceOptions: this.options.sourceOptions || this.options.source.options\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function (e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      if (this.options.idbInfo.firstLoad) {\n        this.maintainFeaturesInIdb();\n      }\n      this.dataSource.ol.once('featuresloadend', () => {\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('changefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('removefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n      });\n    }\n\n    if (\n      this.dataSource instanceof FeatureDataSource &&\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)\n    ) {\n      this.dataSource.ol.once('featuresloadend', () => {\n        if (initialOpacityValue) {\n          this.opacity = initialOpacityValue;\n        }\n        if (so.preload.bypassResolution) {\n          this.minResolution = initialMinResValue;\n          this.maxResolution = initialMaxResValue;\n        }\n        if (so.preload.bypassVisible) {\n          this.visible = initialVisibleValue;\n        }\n      });\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector;\n    const url = vectorSource.getUrl();\n    if (typeof url === 'function') {\n      return vector;\n    }\n    if (url || olOptions.sourceOptions?.type === 'wfs') {\n      let loader: FeatureLoader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (\n        wfsOptions?.type === 'wfs' &&\n        (wfsOptions.params || wfsOptions.paramsWFS)\n      ) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      const idbLoader = (extent, resolution, proj, success, failure) => {\n        this.customIDBLoader(\n          vectorSource,\n          olOptions.id,\n          extent,\n          proj,\n          success,\n          failure\n        );\n      };\n      if (idbLoader) {\n        vectorSource.setLoader(idbLoader);\n      }\n    }\n\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      vector.once('sourceready', () => {\n        if (this.options.idbInfo.firstLoad) {\n          this.maintainOptionsInIdb();\n        }\n        fromEvent<BaseEvent>(vector, 'change')\n          .pipe(debounceTime(750))\n          .subscribe(() => this.maintainOptionsInIdb());\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\n      });\n    }\n    return vector;\n  }\n\n  removeLayerFromIDB() {\n    if (this.geoDBService && this.layerDBService) {\n      zip(\n        this.geoDBService.deleteByKey(this.id),\n        this.layerDBService.deleteByKey(this.id)\n      ).subscribe();\n    }\n  }\n\n  private maintainOptionsInIdb() {\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\n      layerId: this.id,\n      detailedContextUri: this.options.idbInfo.contextUri,\n      sourceOptions: {\n        id: this.id,\n        type: 'vector',\n        queryable: true\n      },\n      layerOptions: {\n        workspace: this.options.workspace,\n        zIndex: this.ol ? this.zIndex : 1000000,\n        id: this.id,\n        isIgoInternalLayer: this.isIgoInternalLayer,\n        title: this.title,\n        igoStyle: this.options.igoStyle,\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\n      },\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\n    });\n    this.layerDBService.update(layerData);\n  }\n\n  private maintainFeaturesInIdb() {\n    const dsFeatures = this.dataSource.ol.getFeatures();\n    const geojsonObject = JSON.parse(\n      new olformat.GeoJSON().writeFeatures(dsFeatures, {\n        dataProjection: 'EPSG:4326',\n        featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\n      })\n    );\n    this.geoDBService.update(\n      this.id,\n      this.id,\n      geojsonObject,\n      InsertSourceInsertDBEnum.User,\n      `${this.title}-${this.id}-${new Date()}`\n    );\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if (\n            styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'\n          ) {\n            const radius =\n              easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public setExtent(extent: MapExtent): void {\n    this.options.extent = extent;\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function (e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol\n        .getView()\n        .setCenter((feat.getGeometry() as any).getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource: olSourceVector,\n    options: WFSDataSourceOptions,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    resolution: number,\n    proj: olProjection,\n    success: (features: olFeature[]) => void,\n    failure: () => void,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName\n        ? new olProjection({ code: paramsWFS.srsName })\n        : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      const ogcFilters = (options as OgcFilterableDataSourceOptions).ogcFilters;\n\n      if (\n        (this.previousLoadExtent &&\n          this.previousLoadExtent !== currentExtent) ||\n        (this.previousLoadResolution &&\n          this.previousLoadResolution !== resolution) ||\n        (this.previousOgcFilters && this.previousOgcFilters !== ogcFilters)\n      ) {\n        vectorSource.removeLoadedExtent(this.previousLoadExtent);\n        for (let xhr of this.xhrAccumulator) {\n          xhr.abort();\n        }\n      }\n\n      this.previousLoadExtent = currentExtent;\n      this.previousLoadResolution = resolution;\n      this.previousOgcFilters = ogcFilters;\n\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        ogcFilters,\n        randomParam\n      );\n      let startIndex = 0;\n      if (\n        paramsWFS.version === '2.0.0' &&\n        paramsWFS.maxFeatures > defaultMaxFeatures\n      ) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace(\n            'count=' + paramsWFS.maxFeatures,\n            'count=' + nbOfFeature\n          );\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(\n            vectorSource,\n            interceptor,\n            currentExtent,\n            wfsProj,\n            proj,\n            alteredUrl,\n            success,\n            failure\n          );\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(\n          vectorSource,\n          interceptor,\n          currentExtent,\n          wfsProj,\n          proj,\n          url,\n          success,\n          failure\n        );\n      }\n    }\n  }\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    dataProjection: olProjection,\n    featureProjection: olProjection,\n    url: string,\n    success: (features: olFeature[]) => void,\n    failure: () => void\n  ) {\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features = vectorSource\n          .getFormat()\n          .readFeatures(xhr.responseText, {\n            dataProjection,\n            featureProjection\n          }) as olFeature[];\n        if (features) {\n          vectorSource.addFeatures(features);\n          success(features);\n        } else {\n          success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    this.xhrAccumulator.push(xhr);\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource: olSourceVector,\n    url: string,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    resolution: number,\n    projection: olProjection,\n    success: (features: olFeature[]) => void,\n    failure: () => void\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService\n        .get(url)\n        .pipe(delay(750))\n        .pipe(\n          concatMap((r) =>\n            r\n              ? of(r)\n              : this.geoNetworkService.get(modifiedUrl as string, options).pipe(\n                  first(),\n                  catchError((res) => {\n                    onError();\n                    throw res;\n                  })\n                )\n          )\n        )\n        .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              }) as OlFeature[];\n              vectorSource.addFeatures(features);\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n    } else {\n      xhr.open('GET', modifiedUrl as string);\n      const format = vectorSource.getFormat();\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl as string);\n      }\n\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      xhr.onerror = onError;\n      xhr.onload = () => {\n        // status will be 0 for file:// urls\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }) as OlFeature[];\n            vectorSource.addFeatures(features);\n            success(features);\n          } else {\n            onError();\n          }\n        } else {\n          onError();\n        }\n      };\n      xhr.send();\n    }\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param layerID the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customIDBLoader(\n    vectorSource,\n    layerID,\n    extent,\n    projection,\n    success,\n    failure\n  ) {\n    if (this.geoNetworkService) {\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      this.geoNetworkService.geoDBService.get(layerID).subscribe((content) => {\n        if (content) {\n          const format = vectorSource.getFormat();\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = content;\n          } else if (type === 'xml') {\n            source = content;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                content,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = content;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            });\n            vectorSource.addFeatures(features, format.readProjection(source));\n            success(features);\n          } else {\n            onError();\n          }\n        }\n      });\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\n\nexport function olStyleToBasicIgoStyle(layer: olLayerVector<olSourceVector>) {\n  const layerOlStyle = layer.getStyle();\n  if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\n    return;\n  }\n\n  const rStyle = {\n    fill: {\n      color: layerOlStyle.getFill().getColor()\n    },\n    stroke: {\n      color: layerOlStyle.getStroke().getColor(),\n      width: 2\n    },\n    circle: {\n      fill: {\n        color: (layerOlStyle.getImage() as any).getFill().getColor()\n      },\n      stroke: {\n        color: (layerOlStyle.getImage() as any).getStroke().getColor(),\n        width: 2\n      },\n      radius: 5\n    }\n  };\n  return rStyle;\n}\n","import { MessageService } from '@igo2/core/message';\nimport { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport olSourceImage from 'ol/source/Image';\n\nimport type { ImageLayer } from '../shared/layers/image-layer';\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n    this.messageService.error(\n      'igo.geo.dataSource.unavailable',\n      'igo.geo.dataSource.unavailableTitle',\n      undefined,\n      { value: event.target.params_.LAYERS }\n    );\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n  }\n}\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport olSourceTile from 'ol/source/Tile';\n\nimport type { TileLayer } from '../shared/layers/tile-layer';\nimport type { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport type { VectorLayer } from '../shared/layers/vector-layer';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '80px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","<div\n  *ngIf=\"baseLayers.length > 0\"\n  class=\"igo-baselayers-switcher-container\"\n  [ngClass]=\"{ 'container-expand': expand }\"\n  [@baseLayerSwitcherState]=\"\n    expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\n  \"\n  (@baseLayerSwitcherState.start)=\"showButton = false\"\n  (@baseLayerSwitcherState.done)=\"showButton = true\"\n  (click)=\"collapseOrExpand()\"\n>\n  <div\n    *ngIf=\"useStaticIcon && !expand && showButton\"\n    class=\"igo-baselayers-switcher-button-container\"\n  >\n    <button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n      matTooltipPosition=\"right\"\n      color=\"primary\"\n    >\n      <mat-icon>photo_library</mat-icon>\n    </button>\n  </div>\n\n  <div class=\"basemap-list\">\n    <igo-mini-basemap\n      *ngFor=\"let baseLayer of baseLayers; let i = index\"\n      [map]=\"map\"\n      [baseLayer]=\"baseLayer\"\n      [title]=\"\n        baseLayers.length > 2 && !expand\n          ? ('igo.geo.baselayersSwitcher.title' | translate)\n          : baseLayer.title\n      \"\n      [display]=\"expand || (i === 0 && !useStaticIcon)\"\n      [disabled]=\"!expand && baseLayers.length > 1\"\n    >\n    </igo-mini-basemap>\n  </div>\n\n  <div *ngIf=\"hasMoreThanTwo\" class=\"more-baselayers\">\n    <mat-icon class=\"material-icons mat-icon\" color=\"primary\"\n      >arrow_drop_down</mat-icon\n    >\n  </div>\n</div>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { Subscription } from 'rxjs';\n\nimport { Layer } from '../../layer/shared';\nimport { IgoMap } from '../shared/map';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\nimport { MiniBaseMapComponent } from './mini-basemap.component';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()],\n  standalone: true,\n  imports: [\n    NgIf,\n    NgClass,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    NgFor,\n    MiniBaseMapComponent,\n    IgoLanguageModule\n  ]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  get hasMoreThanTwo(): boolean {\n    return this.baseLayers.length > 1;\n  }\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe((arrayLayers) => {\n      this._baseLayers = arrayLayers.filter((l) => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.hasMoreThanTwo || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter((l) => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution ||\n          mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom ||\n          mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom ||\n          mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter((l) => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","<div class=\"igo-mini-basemap-container\">\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf=\"title\" class=\"igo-mini-basemap-title\">{{ title }}</div>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy\n} from '@angular/core';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\nimport {\n  Layer,\n  LayerOptions,\n  LayersLink,\n  LayersLinkProperties\n} from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, MapBrowserComponent]\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() title: string;\n\n  @Input()\n  get display(): boolean {\n    return this._display;\n  }\n  set display(value: boolean) {\n    this._display = value;\n    this.basemap.ol.getView().changed();\n  }\n  private _display: boolean;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) {}\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', (change) => {\n      this.handleMainMapViewChange(change.target as OlView);\n    });\n    this.map.ol.on('pointerdrag', (change) => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', (change) => {\n      this.handleMainMapViewChange(change.target as OlView);\n    });\n    this.map.ol.un('pointerdrag', (change) => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(\n      mainMapViewProperties.resolution\n    );\n    this.basemap.viewController.olView.setRotation(\n      mainMapViewProperties.rotation\n    );\n    this.basemap.viewController.olView.setCenter(\n      this.map.viewController.getCenter()\n    );\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer): void {\n    const linkedLayers: LayersLink = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const links: LayersLinkProperties[] = linkedLayers.links;\n    const isParentLayer: boolean = links ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      links.map((link: LayersLinkProperties) => {\n        link.linkedIds.map((linkedId: string) => {\n          const layerToApply: Layer = this.map.layers.find(\n            (layer: Layer) => layer.options.linkedLayers?.linkId === linkedId\n          );\n          if (layerToApply) {\n            const linkedLayerOptions: LayerOptions = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible:\n                  layerToApply.options.linkedLayers?.showInMiniBaseMap ?? true,\n                baseLayer: false\n              } as LayerOptions\n            );\n            this.basemap.addLayer(\n              this.layerService.createLayer(linkedLayerOptions)\n            );\n          }\n        });\n      });\n    }\n  }\n}\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      map.geolocationController.tracking\n        ? ('igo.geo.mapButtons.geolocateInactive' | translate)\n        : ('igo.geo.mapButtons.geolocate' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\"\n  >\n    <mat-icon>{{ icon$ | async }}</mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('my_location');\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor(private configService: ConfigService) {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ = this.map.geolocationController.tracking$.subscribe(\n        (tracking) => {\n          if (tracking) {\n            this.icon$.next('my_location');\n          } else {\n            this.configService.getConfig('geolocate.basic')\n              ? this.icon$.next('my_location')\n              : this.icon$.next('location_searching');\n          }\n        }\n      );\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olproj from 'ol/proj';\n\nimport { IgoMap } from '../shared/map';\nimport { MapExtent } from '../shared/map.interface';\nimport { HomeExtentButtonOptions } from './home-extent-button.interface';\n\n/*\nButton to center the map to the home extent\n*/\n@Component({\n  selector: 'igo-home-extent-button',\n  templateUrl: './home-extent-button.component.html',\n  styleUrls: ['./home-extent-button.component.scss'],\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class HomeExtentButtonComponent {\n  @Input() map: IgoMap;\n  @Input() color: string;\n  @Input() extentOverride?: MapExtent;\n  @Input() centerOverride?: [number, number];\n  @Input() zoomOverride?: number;\n\n  private homeExtentButtonExtent;\n  private homeExtentButtonCenter;\n  private homeExtentButtonZoom;\n\n  constructor(public configService: ConfigService) {\n    this.computeHomeExtent();\n  }\n\n  computeHomeExtent() {\n    const homeExtentButtonOptions: HomeExtentButtonOptions =\n      this.configService.getConfig('homeExtentButton');\n\n    this.homeExtentButtonExtent =\n      this.extentOverride || homeExtentButtonOptions?.homeExtButtonExtent;\n    this.homeExtentButtonCenter =\n      this.centerOverride || homeExtentButtonOptions?.homeExtButtonCenter;\n    this.homeExtentButtonZoom =\n      this.zoomOverride || homeExtentButtonOptions?.homeExtButtonZoom;\n\n    // priority over extent if these 2 properties are defined;\n    if (this.centerOverride && this.zoomOverride) {\n      this.homeExtentButtonExtent = undefined;\n    }\n  }\n\n  onToggleClick() {\n    this.computeHomeExtent();\n    if (this.homeExtentButtonExtent) {\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\n      const center = olproj.fromLonLat(\n        this.homeExtentButtonCenter,\n        this.map.viewController.olView.getProjection().getCode()\n      );\n      this.map.viewController.olView.setCenter(center);\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\n    }\n  }\n}\n","<div class=\"igo-home-extent-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onToggleClick()\"\n  >\n    <mat-icon>home</mat-icon>\n  </button>\n</div>\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n  <pre>{{ infoContent }}</pre>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss'],\n  standalone: true,\n  imports: [NgIf]\n})\nexport class InfoSectionComponent {\n  @Input() infoContent: string = '';\n\n  constructor() {}\n}\n","import {\n  AfterViewInit,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { ActivityService } from '@igo2/core/activity';\nimport { SubjectStatus, uuid } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss'],\n  standalone: true\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${uuid()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe((status) =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n/**\n * Tool to display the center of the map\n */\n@Component({\n  selector: 'igo-map-center',\n  templateUrl: './map-center.component.html',\n  styleUrls: ['./map-center.component.scss'],\n  standalone: true\n})\nexport class MapCenterComponent implements AfterViewInit, OnDestroy {\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private displayCenter$$: Subscription;\n  constructor() {}\n\n  /**\n   * Set a visibility for cursor of the center of the map\n   */\n  ngAfterViewInit() {\n    if (this.map) {\n      this.displayCenter$$ = this.map.mapCenter$.subscribe((value) => {\n        value\n          ? (document.getElementById('mapCenter').style.visibility = 'visible')\n          : (document.getElementById('mapCenter').style.visibility = 'hidden');\n      });\n    }\n    this.letZoom();\n  }\n\n  /**\n   * Destroyer of a component\n   */\n  ngOnDestroy() {\n    if (this.displayCenter$$) {\n      this.displayCenter$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('mapCenter').addEventListener(\n      'wheel',\n      (event) => {\n        event.deltaY > 0\n          ? this.map.viewController.zoomOut()\n          : this.map.viewController.zoomIn();\n      },\n      true\n    );\n  }\n}\n","<div class=\"mapCenter\" id=\"mapCenter\">\n  <div class=\"vertical\"></div>\n  <div class=\"horizontal\"></div>\n</div>\n","import { NgClass } from '@angular/common';\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-menu-button',\n  templateUrl: './menu-button.component.html',\n  styleUrls: ['./menu-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    NgClass,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class MenuButtonComponent {\n  @Input()\n  get sidenavOpened(): boolean {\n    return this._sidenavOpenend;\n  }\n  set sidenavOpened(value: boolean) {\n    this._sidenavOpenend = value;\n    this.getClassMenuButton();\n  }\n  private _sidenavOpenend: boolean;\n\n  @Output() openSidenav = new EventEmitter<any>();\n\n  public useThemeColor: boolean;\n\n  public menuButtonClass;\n\n  constructor(public configService: ConfigService) {\n    const configValue = this.configService.getConfig(\n      'menu.button.useThemeColor'\n    );\n    this.useThemeColor = configValue !== undefined ? configValue : false;\n  }\n\n  getClassMenuButton() {\n    this.menuButtonClass = {\n      'menu-button-white-background': !this.useThemeColor\n    };\n  }\n\n  onToggleSidenavClick() {\n    this.openSidenav.emit();\n  }\n}\n","<button\n  mat-icon-button\n  id=\"menu-button\"\n  [ngClass]=\"menuButtonClass\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(sidenavOpened ? 'menu.close' : 'menu.open') | translate\"\n  (click)=\"onToggleSidenavClick()\"\n>\n  <mat-icon>menu</mat-icon>\n</button>\n","import { NgClass } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-offline-button',\n  templateUrl: './offline-button.component.html',\n  styleUrls: ['./offline-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    NgClass,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class OfflineButtonComponent implements OnInit {\n  btnStyle: string = 'onlineStyle';\n\n  @Input() map: IgoMap;\n  @Input() color: string;\n  @Input() enabled: boolean = false;\n\n  constructor() {}\n\n  ngOnInit(): void {\n    this.map.forcedOffline$.next(this.enabled);\n  }\n\n  onClick() {\n    this.enabled = !this.enabled;\n    this.handleButtonStyle();\n    this.map.forcedOffline$.next(this.enabled);\n  }\n\n  private handleButtonStyle() {\n    if (this.enabled) {\n      this.btnStyle = 'offlineStyle';\n    } else {\n      this.btnStyle = 'onlineStyle';\n    }\n  }\n}\n","<div class=\"igo-user-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.online' | translate)\n        : ('igo.geo.mapButtons.offline' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [ngClass]=\"[btnStyle]\"\n    [color]=\"enabled ? color : null\"\n    (click)=\"onClick()\"\n  >\n    <mat-icon>wifi_off</mat-icon>\n  </button>\n</div>\n","<div\n  *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\"\n  class=\"igo-rotation-button-container\"\n  [matTooltip]=\"\n    (rotated$ | async)\n      ? ('igo.geo.mapButtons.resetRotation'\n        | translate: { azimuth: azimuthRounded, rotation: rotationRounded })\n      : ('igo.geo.mapButtons.tipRotation' | translate)\n  \"\n  matTooltipPosition=\"left\"\n>\n  <button\n    mat-icon-button\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\"\n  >\n    <mat-icon [ngStyle]=\"currentStyle$ | async\">navigation </mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf, NgStyle } from '@angular/common';\nimport { AfterContentInit, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { bearingToAzimuth } from '@turf/helpers';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    NgStyle,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class RotationButtonComponent implements AfterContentInit {\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\n  public azimuthRounded: number = 0;\n  public rotationRounded: number = 0;\n  readonly currentStyle$ = new BehaviorSubject<{}>({\n    transform: 'rotate(0rad)'\n  });\n\n  @Input() map: IgoMap;\n  @Input() showIfNoRotation: boolean;\n  @Input() color: string;\n\n  constructor() {}\n\n  ngAfterContentInit() {\n    this.map.viewController.rotation$.subscribe((r) => {\n      const radians = r || 0;\n      const deg = (radians * 180) / Math.PI;\n      this.rotationRounded = Math.round(deg);\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\n      this.currentStyle$.next({\n        transform: 'rotate(' + radians + 'rad)'\n      });\n      this.rotated$.next(radians !== 0);\n    });\n  }\n}\n","import OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\n\n/**\n * Base map controller\n */\nexport class MapController {\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n}\n","import { ProjectionLike } from 'ol/proj';\n\nexport interface GeolocationOptions {\n  activateDefault?: boolean;\n  basic?: boolean; // to control the button icon.\n  followPosition?: boolean; // to overide the followPosition define at the context level.\n  button?: {\n    visible: boolean;\n  };\n}\n\nexport interface MapGeolocationControllerOptions {\n  projection: ProjectionLike;\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\n\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\nexport enum GeolocationOverlayType {\n  Position = 'position',\n  PositionDirection = 'positionDirection',\n  Accuracy = 'accuracy',\n  Buffer = 'buffer'\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport olFeature from 'ol/Feature';\nimport olGeolocation from 'ol/Geolocation';\nimport OlMap from 'ol/Map';\nimport { Point, Polygon } from 'ol/geom';\nimport OlCircle from 'ol/geom/Circle';\nimport Geometry from 'ol/geom/Geometry';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\nimport * as olSphere from 'ol/sphere';\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription, interval } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport {\n  computeOlFeaturesExtent,\n  featuresAreOutOfView,\n  hideOlFeature,\n  moveToOlFeatures\n} from '../../../feature/shared/feature.utils';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport type { MapBase } from '../map.abstract';\nimport { MapViewOptions } from '../map.interface';\nimport { MapController } from './controller';\nimport {\n  GeolocationBuffer,\n  GeolocationOverlayType,\n  MapGeolocationControllerOptions,\n  MapGeolocationState\n} from './geolocation.interface';\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n  private arrowRotation: number;\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      image: new olstyle.Circle({\n        radius: 6,\n        fill: new olstyle.Fill({\n          color: '#3399CC'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 2\n        })\n      })\n    });\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      stroke: new olstyle.Stroke({\n        color: 'rgba(120, 120, 120, 0.4)',\n        width: 1\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(120, 120, 120, 0.4)'\n      })\n    });\n\n  private get bufferStyle(): olstyle.Style {\n    return new olstyle.Style({\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n      text: new olstyle.Text({\n        textAlign: 'left',\n        offsetX: 10,\n        offsetY: -10,\n        font: '12px Calibri,sans-serif',\n        text: this.buffer.showBufferRadius\n          ? `${this.buffer.bufferRadius}m`\n          : '',\n        fill: new olstyle.Fill({ color: '#000' }),\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n      })\n    });\n  }\n\n  private get arrowStyle(): olstyle.Style {\n    return new olstyle.Style({\n      image: new olstyle.RegularShape({\n        radius: 5.5,\n        fill: new olstyle.Fill({\n          color: 'rgba(0, 132, 202)'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 1.5\n        }),\n        points: 3,\n        displacement: [0, 9],\n        rotation: this.arrowRotation,\n        rotateWithView: true\n      })\n    });\n  }\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> =\n    new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(\n    undefined\n  );\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n  private lastPosition: { coordinates: number[]; dateTime: Date };\n\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n  set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n  get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold;\n\n  get olGeolocation() {\n    return this.geolocation;\n  }\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n  /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n  private _followPosition;\n\n  constructor(\n    private map: MapBase,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n    this._followPosition =\n      this.options && this.options.followPosition\n        ? this.options.followPosition\n        : false;\n\n    this._buffer =\n      this.options && this.options.buffer ? this.options.buffer : undefined;\n    this._accuracyThreshold =\n      this.options && this.options.accuracyThreshold\n        ? this.options.accuracyThreshold\n        : 5000;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe((tracking) => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection\n    });\n    let tracking = false;\n    this.subscriptions$$.push(\n      this.emissionIntervalSeconds$\n        .pipe(switchMap((value) => interval(value * 1000)))\n        .subscribe(() => {\n          if (tracking === this.tracking) {\n            this.onPositionChange(true);\n          } else {\n            tracking = this.tracking;\n            this.onPositionChange(true, true);\n          }\n        })\n    );\n\n    this.geolocation.on('change', (evt) => {\n      this.onPositionChange(false, false);\n    });\n  }\n\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\n    const position4326 = olproj.transform(\n      position.position,\n      position.projection,\n      'EPSG:4326'\n    );\n    if (!this.lastPosition) {\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n      return;\n    }\n    const arrowFeature = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    const isMoving =\n      position?.speed > 1.25 &&\n      this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) >\n        0.003;\n    if (position.accuracy <= this.accuracyThreshold && isMoving) {\n      // Calculate the heading using current position and last recorded\n      // because ol heading not returning right value\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\n      var theta = Math.atan2(dy, dx);\n      if (theta < 0) theta = 2 * Math.PI + theta;\n      this.arrowRotation = theta;\n      if (arrowFeature) {\n        arrowFeature.setStyle(this.arrowStyle);\n      }\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n    } else {\n      if (\n        arrowFeature &&\n        new Date().getTime() - this.lastPosition.dateTime.getTime() > 3000\n      )\n        hideOlFeature(arrowFeature);\n    }\n  }\n\n  /**\n   * @returns distance in km between coord1 and coord2\n   */\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number {\n    return olSphere.getDistance(coord1, coord2) / 1000;\n  }\n\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\n    let listener = () => {\n      event(this.geolocation);\n    };\n    this.geolocation.on('change', listener);\n    return listener;\n  }\n\n  public deleteChangedListener(event: () => any) {\n    this.geolocation.un('change', event);\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) {\n      return;\n    }\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get(\n        'geolocation.tracking'\n      ) as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get(\n        'geolocation.followPosition'\n      ) as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map((s) => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(\n    emitEvent: boolean = false,\n    zoomTo: boolean = false\n  ) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions\n        ?.enableHighAccuracy\n        ? true\n        : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position);\n    this.handleViewFromFeatures(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n    }\n  }\n\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById =\n      this.geolocationOverlay?.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState) {\n    if (!position || !position.position) {\n      return;\n    }\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(\n      new OlCircle(position.position, position.accuracy || 0)\n    );\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    const positionFeatureExists = positionFeature ? true : false;\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\n    const accuracyFeatureExists = accuracyFeature ? true : false;\n    if (!positionFeatureArrowExists) {\n      positionFeatureArrow = new olFeature<Point>({\n        geometry: positionGeometry\n      });\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\n      hideOlFeature(positionFeatureArrow);\n    }\n    if (!positionFeatureExists) {\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n    }\n    if (!accuracyFeatureExists) {\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\n    }\n\n    if (positionGeometry) {\n      positionFeatureExists\n        ? positionFeature.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeature,\n            FeatureMotion.None\n          );\n      positionFeatureArrowExists\n        ? positionFeatureArrow.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeatureArrow,\n            FeatureMotion.None\n          );\n      this.updateArrowFeatureOrientation(position);\n      accuracyFeatureExists\n        ? accuracyFeature.setGeometry(accuracyGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            accuracyFeature,\n            FeatureMotion.None\n          );\n\n      if (this.buffer) {\n        let bufferFeature = this.getFeatureByType(\n          GeolocationOverlayType.Buffer\n        );\n        const bufferFeatureExists = bufferFeature ? true : false;\n        const bufferGeometry = new OlCircle(\n          position.position,\n          this.buffer.bufferRadius\n        );\n        if (!bufferFeatureExists) {\n          bufferFeature = new olFeature(bufferGeometry);\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\n          bufferFeature.setStyle(this.positionFeatureStyle);\n        }\n        bufferFeature.setStyle(this.bufferStyle);\n        bufferFeatureExists\n          ? bufferFeature.setGeometry(bufferGeometry)\n          : this.geolocationOverlay.addOlFeature(\n              bufferFeature,\n              FeatureMotion.None\n            );\n      }\n    }\n  }\n  handleViewFromFeatures(\n    position: MapGeolocationState,\n    zoomTo: boolean = false\n  ) {\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\n    const features = [\n      positionFeature,\n      positionFeatureArrow,\n      accuracyFeature,\n      bufferFeature\n    ].filter((f) => f);\n    if (features.length > 0) {\n      const featuresExtent = computeOlFeaturesExtent(\n        features,\n        this.map.viewProjection\n      );\n      const edgeRatios =\n        position?.speed > 12.5\n          ? [0.25, 0.25, 0.25, 0.25]\n          : [0.15, 0.1, 0.1, 0.1];\n      const areOutOfView = featuresAreOutOfView(\n        this.map.getExtent(),\n        featuresExtent,\n        edgeRatios\n      );\n      let motion =\n        this.followPosition && areOutOfView\n          ? FeatureMotion.Move\n          : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      motion !== FeatureMotion.None\n        ? moveToOlFeatures(this.map.viewController, features, motion)\n        : undefined;\n    }\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\nimport { ObjectEvent } from 'ol/Object';\nimport OlView from 'ol/View';\nimport * as oleasing from 'ol/easing';\nimport { EventsKey } from 'ol/events';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current rotation in radians\n   */\n  readonly rotation$ = new BehaviorSubject<number>(0);\n\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) =>\n          this.onMoveEnd(event)\n        ) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  monitorRotation() {\n    this.observerKeys.push(\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\n        this.rotation$.next(evt.target.getRotation());\n      }) as EventsKey\n    );\n    this.rotation$.next(this.getRotation());\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [\n        number,\n        number\n      ];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in radians\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import {\n  Directive,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { MediaService } from '@igo2/core/media';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport * as OlGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olLayerVector from 'ol/layer/Vector';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport RenderFeature from 'ol/render/Feature';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { Layer, VectorLayer, VectorTileLayer } from '../../layer/shared/layers';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleService } from '../../style/style-service/style.service';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]',\n  standalone: true\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> =\n    new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n        this.listenToMapPointerMove();\n        this.subscribeToPointerStore();\n        this.listenToMapClick();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find((l) => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: 'vector',\n      declutter: true,\n      source: new olVectorTileSource({ projection: this.map.projection }),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(\n            feature,\n            this.mvtStyleOptions,\n            resolution\n          );\n        }\n      }\n    });\n  }\n\n  createHoverStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    hoverStyle: StyleByAttribute,\n    resolution: number\n  ) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style = {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(\n      feature,\n      localHoverStyle,\n      resolution\n    );\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.addFeatureOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          if (!layerOL) {\n            return;\n          }\n          const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n          if (!this.canProcessHover(igoLayer as any)) {\n            return;\n          }\n          if (igoLayer.zIndex <= maximumZindex) {\n            return;\n          }\n          maximumZindex = igoLayer.zIndex;\n          topMostOlLayer = layerOL;\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) =>\n            olLayer instanceof olLayerVector ||\n            olLayer instanceof olLayerVectorTile\n        }\n      );\n      if (!topMostOlLayer) {\n        // To clear label\n        this.clearLayer();\n        this.pointerHoverFeatureStore.clear();\n        return;\n      }\n\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          // To avoid flashing feature\n          if (\n            mapFeature.get('hoverSummary') === undefined &&\n            mapFeature.getProperties() !==\n              this.pointerHoverFeatureStore.all()[0]?.getProperties()\n          ) {\n            this.clearLayer();\n            let igoLayer;\n            if (layerOL instanceof olLayerVector) {\n              const myLayerVector = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorLayer;\n              if (!this.canProcessHover(myLayerVector)) {\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(mapFeature);\n              this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\n              const featuresToLoad = [localOlFeature];\n              localOlFeature.set('_isLabel', false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n                localOlFeature.getGeometry().getType() === 'Point'\n                  ? localOlFeature.getGeometry()\n                  : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set('_isLabel', true);\n              this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\n              featuresToLoad.push(myLabelOlFeature);\n              this.pointerHoverFeatureStore.load(featuresToLoad);\n              igoLayer = myLayerVector;\n              return true;\n            }\n            if (layerOL instanceof olLayerVectorTile) {\n              const myLayerVectorTile = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorTileLayer;\n              if (!this.canProcessHover(myLayerVectorTile)) {\n                return;\n              }\n              if (\n                myLayerVectorTile?.options?.igoStyle?.styleByAttribute\n                  ?.hoverStyle\n              ) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\n              } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.hoverStyle;\n              }\n              this.selectionLayer.setSource(layerOL.getSource());\n              layerOL\n                .getFeatures(event.pixel)\n                .then(\n                  (mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n                    if (!mvtFeatures.length) {\n                      this.selectionMVT = {};\n                      this.selectionLayer.changed();\n                      this.clearLayer();\n                      return;\n                    }\n                    const feature = mvtFeatures[0];\n                    if (!feature) {\n                      this.clearLayer();\n                      return;\n                    }\n                    let localOlFeature = this.handleRenderFeature(feature);\n                    localOlFeature.set('_isLabel', false);\n                    const myLabelOlFeature = new OlFeature();\n                    myLabelOlFeature.setProperties(\n                      localOlFeature.getProperties()\n                    );\n                    const labelGeom =\n                      localOlFeature.getGeometry().getType() === 'Point'\n                        ? localOlFeature.getGeometry()\n                        : new OlGeom.Point(event.coordinate);\n                    myLabelOlFeature.setGeometry(labelGeom);\n                    myLabelOlFeature.setId(localOlFeature.getId());\n                    myLabelOlFeature.set('_isLabel', true);\n                    this.setLayerStyleFromOptions(\n                      myLayerVectorTile,\n                      myLabelOlFeature\n                    );\n                    this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n                    this.selectionMVT[feature.getId()] = localOlFeature;\n                    this.selectionLayer.changed();\n                  }\n                );\n              igoLayer = myLayerVectorTile;\n            }\n          }\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) => olLayer === topMostOlLayer\n        }\n      );\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (\n      !igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n\n    if (\n      igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(\n    feature: RenderFeature | OlFeature<OlGeometry>\n  ): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    localFeature.setProperties(feature.getProperties());\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n    if (hoverEntity.length > 0) {\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(\n    igoLayer: VectorLayer | VectorTileLayer,\n    feature: OlFeature<OlGeometry>\n  ) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.styleByAttribute.hoverStyle,\n          resolution\n        )\n      );\n      return;\n    }\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.hoverStyle,\n          resolution\n        )\n      );\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([\n            parseFloat(coords[idx]),\n            parseFloat(coords[idx + 1])\n          ]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { ObjectEvent } from 'ol/Object';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport { getUid } from 'ol/util';\n\nimport {\n  TimeFilterableDataSource,\n  TimeFilterableDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSource,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport type { MapBase } from '../shared/map.abstract';\n\nexport function getLinkedLayersOptions(layer: Layer) {\n  return layer.options.linkedLayers;\n}\n\nexport function getIgoLayerByLinkId(map: MapBase, id: string) {\n  return map.layers.find((l) => l.options.linkedLayers?.linkId === id);\n}\n\nexport function layerHasLinkWithProperty(\n  layer: Layer,\n  property: LinkedProperties\n): boolean {\n  let hasLinkWithProperty = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) =>\n      l.properties.includes(property)\n    );\n    hasLinkWithProperty = link ? true : false;\n  }\n  return hasLinkWithProperty;\n}\n\nexport function layerHasLinkDeletion(layer: Layer): boolean {\n  let hasLinkWithSyncedDelete = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) => l.syncedDelete);\n    hasLinkWithSyncedDelete = link ? true : false;\n  }\n  return hasLinkWithSyncedDelete;\n}\n\nexport function getRootParentByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkWithProperty(layerToUse, property)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  if (layer?.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) =>\n            l.linkedIds.includes(currentLinkId) &&\n            l.properties.includes(property)\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n            , The first parent (${\n              parents[0].title || parents[0].id\n            }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.properties.includes(property))\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[],\n  property: LinkedProperties\n): Layer[] {\n  let childLayers = getDirectChildLayersByProperty(map, layer, property);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\n    if (directChildLayers) {\n      getAllChildLayersByProperty(map, cl, knownChildLayers, property);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function getRootParentByDeletion(map: MapBase, layer: Layer): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkDeletion(layerToUse)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer {\n  if (layer.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) => l.linkedIds.includes(currentLinkId) && l.syncedDelete\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n          , The first parent (${\n            parents[0].title || parents[0].id\n          }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.syncedDelete)\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[]\n): Layer[] {\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByDeletion(map, cl);\n    if (directChildLayers) {\n      getAllChildLayersByDeletion(map, cl, knownChildLayers);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function initLayerSyncFromRootParentLayers(\n  map: MapBase,\n  layers: Layer[]\n) {\n  const rootLayersByProperty = {};\n  const keys = Object.keys(LinkedProperties);\n  keys.map((k) => {\n    rootLayersByProperty[LinkedProperties[k]] = [];\n  });\n  layers\n    .filter((l) => getLinkedLayersOptions(l))\n    .map((l) => {\n      keys.map((key) => {\n        const k = LinkedProperties[key];\n        const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\n        const layers = rootLayersByProperty[k];\n        const layersId = layers.map((l) => l.id);\n        if (plbp && !layersId.includes(plbp.id)) {\n          rootLayersByProperty[k].push(plbp);\n        }\n      });\n    });\n  Object.keys(rootLayersByProperty).map((k) => {\n    const layers = rootLayersByProperty[k];\n    layers.map((l: Layer) => l.ol.notify(k, undefined));\n  });\n}\n\nexport function handleLayerPropertyChange(\n  map: MapBase,\n  propertyChange: ObjectEvent,\n  initiatorIgoLayer: Layer\n) {\n  if (!propertyChange) {\n    return;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  let isLayerProperty = true;\n  let isDatasourceProperty = true;\n  const key = propertyChange.key;\n  let newValue;\n  if (key === 'ogcFilters') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions\n    ).ogcFilters;\n  } else if (key === 'timeFilter') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions\n    ).timeFilter;\n  } else {\n    isLayerProperty = true;\n    isDatasourceProperty = false;\n    newValue = initiatorIgoLayer.ol.get(key);\n  }\n\n  const initiatorLinkedLayersOptions =\n    getLinkedLayersOptions(initiatorIgoLayer);\n  if (initiatorLinkedLayersOptions) {\n    let rootParentByProperty = getRootParentByProperty(\n      map,\n      initiatorIgoLayer,\n      key as LinkedProperties\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = initiatorIgoLayer;\n    }\n\n    const clbp = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      map,\n      rootParentByProperty,\n      clbp,\n      key as LinkedProperties\n    );\n\n    let resolutionPropertyHasChanged = false;\n    const initiatorIgoLayerSourceType =\n      initiatorIgoLayer.options.source.options.type;\n    const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer\n      .dataSource.options as OgcFilterableDataSourceOptions;\n    clbp.map((l) => {\n      if (\n        initiatorIgoLayer &&\n        l &&\n        getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)\n      ) {\n        const lLayerType = l.options.source.options.type;\n        if (isLayerProperty) {\n          l.ol.set(key, newValue, true);\n          if (key === 'visible') {\n            l.visible$.next(newValue);\n          }\n          if (key === 'minResolution' || key === 'maxResolution') {\n            resolutionPropertyHasChanged = true;\n          }\n        } else if (isDatasourceProperty) {\n          if (key === 'ogcFilters') {\n            (l.dataSource as OgcFilterableDataSource).setOgcFilters(\n              newValue,\n              false\n            );\n            if (lLayerType === 'wfs') {\n              l.ol.getSource().refresh();\n            }\n            if (lLayerType === 'wms') {\n              let appliedOgcFilter;\n              if (initiatorIgoLayerSourceType === 'wfs') {\n                appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\n                  initiatorIgoLayerOgcFilterableDataSourceOptions,\n                  (initiatorIgoLayer.dataSource.options as any)\n                    .fieldNameGeometry,\n                  undefined,\n                  map.viewController.getOlProjection()\n                );\n              } else if (initiatorIgoLayerSourceType === 'wms') {\n                appliedOgcFilter = (\n                  initiatorIgoLayer.dataSource as WMSDataSource\n                ).ol.getParams().FILTER;\n              }\n              (l.dataSource as WMSDataSource).ol.updateParams({\n                FILTER: appliedOgcFilter\n              });\n            }\n          } else if (\n            l.dataSource instanceof WMSDataSource &&\n            key === 'timeFilter'\n          ) {\n            (l.dataSource as TimeFilterableDataSource).setTimeFilter(\n              newValue,\n              false\n            );\n            const appliedTimeFilter = (\n              initiatorIgoLayer.ol.getSource() as olSourceImageWMS\n            ).getParams().TIME;\n            l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\n          }\n        }\n      }\n    });\n    if (resolutionPropertyHasChanged) {\n      map.viewController.resolution$.next(map.viewController.resolution$.value);\n    }\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { MediaService } from '@igo2/core/media';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { transform } from 'ol/proj';\n\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\n\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]',\n  standalone: true\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) =>\n        this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { SubjectStatus, Watcher } from '@igo2/utils';\n\nimport { ObjectEvent } from 'ol/Object';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  public propertyChange$: BehaviorSubject<{\n    event: ObjectEvent;\n    layer: Layer;\n  }> = new BehaviorSubject(undefined);\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach((layer) => this.unwatchLayer(layer), this);\n  }\n\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\n    if (\n      ![\n        LinkedProperties.TIMEFILTER,\n        LinkedProperties.OGCFILTERS,\n        LinkedProperties.VISIBLE,\n        LinkedProperties.OPACITY,\n        LinkedProperties.MINRESOLUTION,\n        LinkedProperties.MAXRESOLUTION\n      ].includes(change.key as any)\n    ) {\n      return;\n    }\n    this.propertyChange$.next({ event: change, layer });\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n    layer.ol.on('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.on('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status) => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.ol.un('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.un('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olMap from 'ol/Map';\nimport { ObjectEvent } from 'ol/Object';\nimport olView, { ViewOptions } from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olinteraction from 'ol/interaction';\nimport olLayer from 'ol/layer/Layer';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olproj4 from 'ol/proj/proj4';\nimport olSource from 'ol/source/Source';\nimport { getUid } from 'ol/util';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject, pairwise, skipWhile } from 'rxjs';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { MapViewController } from './controllers/view';\nimport {\n  getAllChildLayersByDeletion,\n  getRootParentByDeletion,\n  handleLayerPropertyChange,\n  initLayerSyncFromRootParentLayers\n} from './linkedLayers.utils';\nimport type { MapBase } from './map.abstract';\nimport {\n  MapAttributionOptions,\n  MapControlsOptions,\n  MapExtent,\n  MapOptions,\n  MapScaleLineOptions,\n  MapViewOptions\n} from './map.interface';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap implements MapBase {\n  public ol: olMap;\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\n  public status$: Subject<SubjectStatus>;\n  public propertyChange$: Subject<{ event: ObjectEvent; layer: Layer }>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  /** @deprecated use projectionCode */\n  get projection(): string {\n    return this.projectionCode;\n  }\n\n  get viewProjection(): olproj.Projection {\n    return this.viewController.getOlProjection();\n  }\n\n  get projectionCode(): string {\n    return this.viewProjection.getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (\n          this.options.controls.attribution === true\n            ? {}\n            : this.options.controls.attribution\n        ) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (\n          this.options.controls.scaleLine === true\n            ? {}\n            : this.options.controls.scaleLine\n        ) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService\n      );\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(\n          this.mapViewOptions\n        );\n      }\n      this.layers$.pipe(pairwise()).subscribe(([prevLayers, currentLayers]) => {\n        let prevLayersId;\n        if (prevLayers) {\n          prevLayersId = prevLayers.map((l) => l.id);\n        }\n        const layers = currentLayers.filter(\n          (l) => !prevLayersId.includes(l.id)\n        );\n\n        for (const layer of layers) {\n          if (layer.options.linkedLayers) {\n            layer.ol.once('postrender', () => {\n              initLayerSyncFromRootParentLayers(this, layers);\n            });\n          }\n        }\n      });\n      this.viewController.monitorRotation();\n    });\n    this.propertyChange$\n      .pipe(skipWhile((pc) => !pc))\n      .subscribe((p) => handleLayerPropertyChange(this, p.event, p.layer));\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => {}, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions: MapViewOptions = {\n      ...currentView.getProperties(),\n      ...options\n    };\n\n    if (options.zoom && options.resolution == null) {\n      viewOptions.resolution = undefined;\n    }\n\n    this.setView(viewOptions);\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    const viewOptions: ViewOptions = { constrainResolution: true, ...options };\n    if (options.center) {\n      viewOptions.center = olproj.fromLonLat(\n        options.center,\n        options.projection\n      );\n    }\n\n    this.ol.setView(new olView(viewOptions));\n\n    if (options.maxLayerZoomExtent) {\n      this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (\n        value.attribution === true ? {} : value.attribution\n      ) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (\n        value.scaleLine === true ? {} : value.scaleLine\n      ) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach((control) => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach((control) => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\n    );\n  }\n\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\n    const olUId = getUid(olLayer);\n    return this.getLayerByOlUId(olUId);\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) {\n          return;\n        }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      if (layer instanceof VectorLayer) {\n        layer.removeLayerFromIDB();\n      }\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map((linkedLayer) => {\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\n    if (!rootParentByDeletion) {\n      rootParentByDeletion = srcLayer;\n    }\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [\n      rootParentByDeletion\n    ]);\n    for (const layer of clbd) {\n      layersToRemove.push(layer);\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n}\n","import { NumberUtils } from '@igo2/utils';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\nimport * as olproj from 'ol/proj';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n  /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map((s) => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [, negativeLon, lon, , decimalLon, negativeLat, lat, , decimalLat] =\n      coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    lonLat[0] > 180 ||\n    lonLat[0] < -180 ||\n    lonLat[1] > 90 ||\n    lonLat[1] < -90\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number],\n  decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach((dd) => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(\n  coord: [number, number],\n  decimal: number = 3\n): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)\n  ] as [number, number];\n}\n\nexport function roundCoordToString(\n  coord: [number, number],\n  decimal: number = 3\n): [string, string] {\n  return roundCoordTo(coord, decimal).map((r) => r.toString()) as [\n    string,\n    string\n  ];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [\n    number,\n    number\n  ];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [\n    number,\n    number\n  ];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [\n      number,\n      number\n    ];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach((projection) => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [\n      number,\n      number\n    ];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import { AfterViewInit, Directive } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { combineLatest } from 'rxjs';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { IgoMap } from './map';\n\ninterface OfflinableSourceOptions extends DataSourceOptions {\n  pathOffline?: string;\n}\n\n@Directive({\n  selector: '[igoMapOffline]',\n  standalone: true\n})\nexport class MapOfflineDirective implements AfterViewInit {\n  private component: MapBrowserComponent;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  private previousMessageId;\n\n  constructor(\n    component: MapBrowserComponent,\n    private networkService: NetworkService,\n    private messageService: MessageService\n  ) {\n    this.component = component;\n  }\n\n  ngAfterViewInit() {\n    const initialOnline = window.navigator.onLine;\n    this.map.forcedOffline$.subscribe((forcedOffline: boolean) => {\n      const online = window.navigator.onLine;\n      // prevent first online message if no state change.\n      if (initialOnline && initialOnline === online && !forcedOffline) {\n        return;\n      }\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      if (!forcedOffline && online) {\n        const messageObj = this.messageService.info(\n          'igo.geo.network.online.message',\n          'igo.geo.network.online.title'\n        );\n        this.previousMessageId = messageObj.toastId;\n      } else if (forcedOffline) {\n        const messageObj = this.messageService.info(\n          'igo.geo.network.offline.message',\n          'igo.geo.network.offline.title'\n        );\n        this.previousMessageId = messageObj.toastId;\n      }\n    });\n\n    combineLatest([\n      this.networkService.currentState(),\n      this.map.forcedOffline$,\n      this.map.layers$\n    ]).subscribe((bunch: [ConnectionState, boolean, Layer[]]) => {\n      const online = bunch[0].connection;\n      const forcedOffline = bunch[1];\n      const layers = bunch[2];\n      this.handleLayersOnlineState(online, forcedOffline, layers);\n    });\n  }\n\n  private handleNonOfflinableLayerResolution(\n    online: boolean,\n    forcedOffline: boolean,\n    layer: Layer\n  ) {\n    if (!online || forcedOffline) {\n      layer.maxResolution = 0;\n    } else if (online || !forcedOffline) {\n      layer.maxResolution = layer.options.maxResolution || Infinity;\n    }\n  }\n\n  private handleLayersOnlineState(\n    online: boolean,\n    forcedOffline: boolean,\n    layers: Layer[]\n  ) {\n    layers.forEach((layer) => {\n      let offlinableByUrlSourceOptions;\n      if (layer.isIgoInternalLayer) {\n        return;\n      }\n      // detect if layer/source are offlinable by url/pathOffline properties\n      if (\n        (layer.options.sourceOptions as OfflinableSourceOptions)?.pathOffline\n      ) {\n        offlinableByUrlSourceOptions = layer.options.sourceOptions;\n      }\n      if (offlinableByUrlSourceOptions) {\n        const type = offlinableByUrlSourceOptions.type;\n        if (type === 'mvt') {\n          layer.ol.getSource().refresh();\n        }\n        if (!online || forcedOffline) {\n          if (['vector', 'cluster'].includes(type)) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(\n            offlinableByUrlSourceOptions.pathOffline\n          );\n        } else if (!online || !forcedOffline) {\n          if (['vector', 'cluster'].includes(type)) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(\n            offlinableByUrlSourceOptions.url\n          );\n        } else {\n          this.handleNonOfflinableLayerResolution(online, forcedOffline, layer);\n        }\n      } else {\n        // FOR ALL NON OFFLINABLE SOURCE (i.e. EXCEPT PREVIOUS);\n        this.handleNonOfflinableLayerResolution(online, forcedOffline, layer);\n        return;\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport proj4 from 'proj4';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n  constructor(private config: ConfigService) {\n    const projections: Projection[] =\n      this.config.getConfig('projections') || [];\n    projections.forEach((projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code =\n        mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n}\n","import { Observable, from } from 'rxjs';\n\nimport { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n  let lonMin = -54;\n  const lonMax = -81;\n  if (lon < lonMax || lon > lonMin) {\n    return 0;\n  } else {\n    const deltaLon = 3;\n    let zone = 2;\n    while (Math.abs(lon - lonMin) > deltaLon) {\n      lonMin = lonMin - deltaLon;\n      zone++;\n    }\n    return zone;\n  }\n}\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n  projectionsLimitations: ProjectionsLimitationsOptions\n): ProjectionsLimitationsOptions {\n  const mtmZone = projectionsLimitations.mtmZone;\n  const utmZone = projectionsLimitations.utmZone;\n  const projectionsConstraints = {\n    projFromConfig:\n      projectionsLimitations.projFromConfig === false ? false : true,\n    nad83: projectionsLimitations.nad83 === false ? false : true,\n    wgs84: projectionsLimitations.wgs84 === false ? false : true,\n    webMercator: projectionsLimitations.webMercator === false ? false : true,\n    utm: projectionsLimitations.utm === false ? false : true,\n    mtm: projectionsLimitations.mtm === false ? false : true,\n    utmZone: {\n      minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n      maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21\n    },\n    mtmZone: {\n      minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n      maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10\n    }\n  };\n  return projectionsConstraints;\n}\n/**\n * Method allowing to read the file and try to detect projection/Coord system\n * Only geojson/json/gml could be detected at this moment.\n * @param options A file and an optional number of line to read the EPSG Code. Used only for GML files\n * @returns Observable string, epsgNotDefined if the EPSG is not detected or a EPSG string ex: EPSG:3857\n */\nexport function detectFileEPSG(options: {\n  file: File;\n  nbLines?: number;\n}): Observable<string> {\n  const file = options.file;\n  const nbLines = options.nbLines ?? 500;\n\n  const reader = new FileReader();\n  return from(\n    new Promise<string>((resolve) => {\n      if (\n        !file.name.toLowerCase().endsWith('.geojson') &&\n        !file.name.toLowerCase().endsWith('.json') &&\n        !file.name.toLowerCase().endsWith('.gml')\n      ) {\n        resolve('epsgNotDefined');\n        return;\n      }\n\n      reader.onload = (e) => {\n        if (\n          file.name.toLowerCase().endsWith('.geojson') ||\n          file.name.toLowerCase().endsWith('.json')\n        ) {\n          const geojson = JSON.parse(reader.result as string);\n          if (geojson.crs?.properties?.name) {\n            const epsg =\n              geojson.crs.properties.name.match(/EPSG:{1,2}\\d{0,6}/gm);\n            if (epsg !== null && epsg.length) {\n              resolve(epsg[0].replace(/::/g, ':'));\n              return;\n            } else {\n              resolve('epsgNotDefined');\n              return;\n            }\n          } else {\n            resolve('epsgNotDefined');\n            return;\n          }\n        } else if (file.name.toLowerCase().endsWith('.gml')) {\n          const text = reader.result as string;\n          const lines = (text as string).split('\\n');\n          for (let line = 0; line <= nbLines; line++) {\n            const epsg = lines[line].match(/EPSG:\\d{0,6}/gm);\n            if (epsg !== null && epsg.length) {\n              resolve(epsg[0]);\n              break;\n            } else {\n              resolve(undefined);\n            }\n          }\n        } else {\n          resolve('epsgNotDefined');\n        }\n      };\n      reader.readAsText(file, 'UTF-8');\n    })\n  );\n}\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\n\nimport { getRenderPixel } from 'ol/render';\n\nimport { Subscription } from 'rxjs';\n\nimport { Layer } from '../../layer/shared';\nimport { IgoMap } from '../shared/map';\n\n/**\n * Tool to swipe the layers\n */\n@Component({\n  selector: 'igo-swipe-control',\n  templateUrl: './swipe-control.component.html',\n  styleUrls: ['./swipe-control.component.scss'],\n  standalone: true\n})\nexport class SwipeControlComponent implements AfterViewInit, OnDestroy {\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The list of layers for swipe\n   */\n  private layers: Layer[];\n\n  /**\n   * Final position of the swiped element\n   */\n  private pos1: number;\n\n  /**\n   * Intermediate position of the swiped element\n   */\n  private pos3: number;\n\n  /**\n   * State of draggable action\n   */\n  private inDragAction: boolean = false;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private swipeEnabled$$: Subscription;\n\n  /**\n   * Binder of prerender on the same element\n   */\n  private boundPrerender = this.prerender.bind(this);\n\n  constructor() {}\n\n  /**\n   * Get the list of layers for swipe and activate of deactivate the swipe\n   * @internal\n   */\n  ngAfterViewInit(): void {\n    this.getListOfLayers();\n    this.swipeEnabled$$ = this.map.swipeEnabled$.subscribe((value) => {\n      value ? this.displaySwipe() : this.displaySwipeOff();\n    });\n    this.letZoom();\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy(): void {\n    this.swipeEnabled$$.unsubscribe();\n    this.map.swipeEnabled$.unsubscribe();\n    this.displaySwipeOff();\n  }\n\n  /**\n   * Display a swipe-element and render the layers\n   */\n  displaySwipe() {\n    if (this.swipeId) {\n      this.swipeId.style.visibility = 'visible';\n    }\n    this.layers.map((layer) => layer.ol.on('prerender', this.boundPrerender));\n    this.layers.map((layer) => layer.ol.on('postrender', this.postrender));\n    this.map.ol.render();\n  }\n\n  /**\n   * Clear a swipe-element and render the layers on the initial state\n   */\n  displaySwipeOff() {\n    if (this.swipeId) {\n      this.swipeId.style.visibility = 'hidden';\n    }\n    this.layers.map((layer) => layer.ol.un('prerender', this.boundPrerender));\n    this.layers.map((layer) => layer.ol.un('postrender', this.postrender));\n    this.map.ol.render();\n    this.layers = [];\n  }\n\n  /**\n   * Getter of element\n   */\n  get swipeId() {\n    return document.getElementById('igo-layer-swipe');\n  }\n\n  /**\n   * Get the list of layers for swipe\n   */\n  getListOfLayers() {\n    this.map.selectedFeatures$.subscribe((layers) => {\n      this.layers = [];\n      if (layers !== null) {\n        for (const layer of layers) {\n          if (!this.layers.includes(layer)) {\n            this.layers.push(layer);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Get a position of click or touch\n   */\n  dragDown(event) {\n    this.inDragAction = true;\n    event.preventDefault();\n    if (event.type === 'mousedown') {\n      this.pos3 = event.clientX;\n      this.mouseSwipe();\n      document.onmouseup = this.closeDragMouseElement;\n    } else if (event.type === 'touchstart') {\n      document.getElementById('arrows').style.visibility = 'hidden';\n      this.pos3 = event.touches[0].clientX;\n      this.touchSwipe();\n      document.ontouchend = this.closeDragTouchElement;\n    }\n  }\n\n  /**\n   * Moving a line with a mouse\n   */\n  mouseSwipe() {\n    document.addEventListener('mousemove', (event) => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        this.pos1 = this.pos3 - event.clientX;\n        this.pos3 = event.clientX;\n        this.swipeId.style.left = this.swipeId.offsetLeft - this.pos1 + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Moving a line with a touch\n   */\n  touchSwipe() {\n    document.addEventListener('touchmove', (event) => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos1 = this.pos3 - event.changedTouches[0].clientX;\n        this.pos3 = event.changedTouches[0].clientX;\n        this.swipeId.style.left = this.swipeId.offsetLeft - this.pos1 + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Deactivate a listener of a mouse-action\n   */\n  closeDragMouseElement() {\n    document.onmouseup = null;\n    document.onmousemove = null;\n    this.inDragAction = false;\n  }\n\n  /**\n   * Deactivate a listener of a touch-action\n   */\n  closeDragTouchElement() {\n    document.ontouchend = null;\n    document.ontouchmove = null;\n    document.getElementById('arrows').style.visibility = 'visible';\n    this.inDragAction = false;\n  }\n\n  /**\n   * Cut the image of a layer by the position of swiped-element\n   */\n  prerender(event) {\n    const ctx = event.context;\n    const mapSize = this.map.ol.getSize();\n    const width = this.swipeId.offsetLeft;\n    const tl = getRenderPixel(event, [width, 0]);\n    const tr = getRenderPixel(event, [0, 0]);\n    const bl = getRenderPixel(event, [width, mapSize[1]]);\n    const br = getRenderPixel(event, [0, mapSize[1]]);\n    ctx.save();\n    ctx.beginPath();\n    ctx.moveTo(tl[0], tl[1]);\n    ctx.lineTo(bl[0], bl[1]);\n    ctx.lineTo(br[0], br[1]);\n    ctx.lineTo(tr[0], tr[1]);\n    ctx.closePath();\n    ctx.clip();\n  }\n\n  /**\n   * Save a current state of the context\n   */\n  postrender(event) {\n    event.context.restore();\n    event.context.save();\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('igo-layer-swipe').addEventListener(\n      'wheel',\n      (event) => {\n        event.deltaY > 0\n          ? this.map.viewController.zoomOut()\n          : this.map.viewController.zoomIn();\n      },\n      true\n    );\n  }\n}\n","<div\n  class=\"igo-swipe-control-container\"\n  id=\"igo-layer-swipe\"\n  (mousedown)=\"dragDown($event)\"\n  (mouseup)=\"closeDragMouseElement()\"\n  (touchstart)=\"dragDown($event)\"\n  (touchend)=\"closeDragTouchElement()\"\n>\n  <div class=\"igo-swipe-control-line\"></div>\n\n  <div class=\"igo-swipe-control-arrows\" id=\"arrows\">\n    <div class=\"igo-arrow-left\"></div>\n    <div class=\"igo-arrow-right\"></div>\n  </div>\n</div>\n","import { AsyncPipe } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { userAgent } from '@igo2/utils';\n\nimport NoSleep from 'nosleep.js';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n  @Input() color: string = 'primary';\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('bedtime');\n  public visible = false;\n\n  constructor(private storageService: StorageService) {\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.addEventListener('blur', () => {\n        this.disableWakeLock();\n        this.enabled = false;\n      });\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('bedtime_off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('bedtime');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div class=\"igo-wake-lock-button-container\">\n  <button\n    [color]=\"color\"\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.preventScreenLock' | translate)\n        : ('igo.geo.mapButtons.letScreenLock' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    (click)=\"toggleWakeLock()\"\n  >\n    <mat-icon>{{ icon$ | async }}</mat-icon>\n  </button>\n</div>\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss'],\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class ZoomButtonComponent {\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number {\n    return this.map.viewController.getZoom();\n  }\n\n  get minZoom(): number {\n    return this.map.viewController.olView.getMinZoom() || 1;\n  }\n\n  get maxZoom(): number {\n    return this.map.viewController.olView.getMaxZoom();\n  }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: { zoom: zoom + 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\"\n  >\n    <mat-icon>add</mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: { zoom: zoom - 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\"\n  >\n    <mat-icon>remove</mat-icon>\n  </button>\n</div>\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport {\n  formatMeasure,\n  metersToUnit,\n  squareMetersToUnit\n} from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat',\n  standalone: true\n})\nexport class MeasureFormatPipe implements PipeTransform {\n  /**\n   * @ignore\n   */\n  transform(\n    value: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (\n      Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0\n    ) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out\n      ? formatMeasure(out, {\n          decimal: 1,\n          unit,\n          unitAbbr,\n          locale: 'fr'\n        })\n      : out;\n  }\n}\n","<h3 mat-dialog-title>{{ 'igo.geo.measure.dialog.title' | translate }}</h3>\n<div mat-dialog-content>\n  <table *ngIf=\"data.length > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.length.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Meters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.length | measureFormat: measureLengthUnit.Kilometers }}\n        </td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInKilometers' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Miles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Feet }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInFeet' | translate }}</td>\n      </tr>\n    </tbody>\n  </table>\n\n  <table *ngIf=\"data.area > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.area.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMeters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.area | measureFormat: measureAreaUnit.SquareKilometers }}\n        </td>\n        <td>\n          {{ 'igo.geo.measure.dialog.areaInSquareKilometers' | translate }}\n        </td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMiles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Acres }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInAcres' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Hectares }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInHectares' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ 'igo.geo.measure.dialog.perimeterInMeters' | translate }}</td>\n        <td>{{ data.perimeter | measureFormat: measureLengthUnit.Meters }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Inject } from '@angular/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\nimport { MeasureFormatPipe } from './measure-format.pipe';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    NgIf,\n    IgoLanguageModule,\n    MeasureFormatPipe\n  ]\n})\nexport class MeasurerDialogComponent {\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n}\n","<mat-form-field class=\"measure-field\" floatLabel=\"always\">\n  <mat-label>{{ placeholder }}</mat-label>\n  <input\n    matInput\n    [disabled]=\"true\"\n    [readonly]=\"true\"\n    [value]=\"(measure$ | async) || 0 | measureFormat: measureUnit\"\n  />\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\"\n  >\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{ 'igo.geo.measure.' + measureUnit | translate }}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n  MeasureType\n} from '../shared/measure.enum';\nimport {\n  computeBestAreaUnit,\n  computeBestLengthUnit\n} from '../shared/measure.utils';\nimport { MeasureFormatPipe } from './measure-format.pipe';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    MeasureFormatPipe\n  ]\n})\nexport class MeasurerItemComponent implements OnDestroy {\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number {\n    return this.measure$.value;\n  }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) {\n    this.toggleAutoUnit(value);\n  }\n  get auto(): boolean {\n    return this._auto;\n  }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<\n    MeasureAreaUnit | MeasureLengthUnit\n  >();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\"\n    >\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{ 'igo.geo.measure.' + measureType.Length | translate }}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{ 'igo.geo.measure.' + measureType.Area | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleActive' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasLine$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasLine$ | async\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayLines' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayDistance' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayAreas' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasArea$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleAutoUnits' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item\n      *ngIf=\"\n        activeMeasureType === measureType.Length ||\n        activeMeasureType === measureType.Area\n      \"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"activeLengthUnit\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"\n        (activeMeasureType === measureType.Area\n          ? 'igo.geo.measure.perimeter'\n          : 'igo.geo.measure.length'\n        ) | translate\n      \"\n      (measureUnitChange)=\"onLengthUnitChange($any($event))\"\n    >\n    </igo-measurer-item>\n\n    <igo-measurer-item\n      *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"activeAreaUnit\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($any($event))\"\n    >\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\"\n    >\n      <mat-icon>calculate</mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\"\n  >\n  </igo-entity-table>\n</div>\n","import { AsyncPipe, DOCUMENT, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  EntityRecord,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport { unByKey } from 'ol/Observable';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlStyle from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n  MeasureType\n} from '../shared/measure.enum';\nimport {\n  FeatureWithMeasure,\n  Measure,\n  MeasurerDialogData\n} from '../shared/measure.interfaces';\nimport {\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  formatMeasure,\n  getTooltipsOfOlGeometry,\n  measureOlGeometry,\n  metersToUnit,\n  squareMetersToUnit,\n  updateOlTooltipAtCenter,\n  updateOlTooltipsAtMidpoints\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\nimport { MeasurerItemComponent } from './measurer-item.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    MatSlideToggleModule,\n    NgIf,\n    MatDividerModule,\n    MeasurerItemComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    EntityTableComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n  public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  public activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  public activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) {\n    this.setActiveMeasureType(value);\n  }\n  get activeMeasureType(): MeasureType {\n    return this._activeMeasureType;\n  }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService,\n    @Inject(DOCUMENT) private document: Document\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      columns: [\n        {\n          name: 'length',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.lengthHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeLengthUnit;\n            const measure = metersToUnit(\n              localFeature.properties.measure.length,\n              unit\n            );\n            return formatMeasure(measure, {\n              decimal: 1,\n              unit,\n              unitAbbr: false,\n              locale: 'fr'\n            });\n          }\n        },\n        {\n          name: 'area',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.areaHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeAreaUnit;\n            const measure = squareMetersToUnit(\n              localFeature.properties.measure.area,\n              unit\n            );\n            return measure\n              ? formatMeasure(measure, {\n                  decimal: 1,\n                  unit,\n                  unitAbbr: false,\n                  locale: 'fr'\n                })\n              : '';\n          }\n        }\n      ]\n    };\n  }\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.getSavedUnits();\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle\n      ? this.storageService.set('distanceToggle', true, StorageScope.SESSION)\n      : this.storageService.set('distanceToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle\n      ? this.storageService.set('linesToggle', true, StorageScope.SESSION)\n      : this.storageService.set('linesToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle\n      ? this.storageService.set('areasToggle', true, StorageScope.SESSION)\n      : this.storageService.set('areasToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle() {\n    if (this.storageService.get('distanceToggle') === false) {\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false) {\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false) {\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName(\n        'igo-map-tooltip-measure-polygone-segments'\n      );\n    if (this.displayDistance) {\n      Array.from(elements).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(elements).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden')\n      );\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName(\n        'igo-map-tooltip-measure-line-segments'\n      );\n\n    if (this.displayLines) {\n      Array.from(elements).map((value: Element) => {\n        value.classList.remove('igo-map-tooltip-hidden');\n      });\n    } else {\n      Array.from(elements).map((value: Element) => {\n        value.classList.add('igo-map-tooltip-hidden');\n      });\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName('igo-map-tooltip-measure-area');\n\n    if (this.displayAreas) {\n      Array.from(elements).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(elements).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden')\n      );\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.saveCurrentUnits();\n    this.refreshTableAndTooltip();\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.saveCurrentUnits();\n    this.refreshTableAndTooltip();\n  }\n\n  private refreshTableAndTooltip(): void {\n    this.store.stateView.clear();\n\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        return sum + localFeature.properties.measure.area || 0;\n      },\n      0\n    );\n    const length = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'Polygon') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n    const perimeter = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'LineString') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.olDrawSource.getFeatures().forEach((drawingLayerFeature) => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) {\n      return;\n    }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as OlLineString | OlPolygon);\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, { data });\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant(\n        'igo.geo.measure.layerTitle'\n      ),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe((visible) => {\n      const elements: HTMLCollectionOf<Element> =\n        this.document.getElementsByClassName('igo-map-tooltip-measure');\n\n      if (visible) {\n        Array.from(elements).map((value: Element) =>\n          value.classList.remove('igo-map-tooltip-measure-by-display')\n        );\n      } else {\n        Array.from(elements).map((value: Element) =>\n          value.classList.add('igo-map-tooltip-measure-by-display')\n        );\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(\n      store,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        many: true\n      })\n    );\n\n    this.onFeatureAddedKey = store.source.ol.on(\n      'addfeature',\n      (event: OlVectorSourceEvent) => {\n        const localFeature = event.feature;\n        const olGeometry = localFeature.getGeometry() as any;\n        this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n        this.onDisplayDistance();\n        this.onDisplayLines();\n        this.onDisplayAreas();\n      }\n    );\n\n    this.onFeatureRemovedKey = store.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent) => {\n        const olGeometry = event.feature.getGeometry() as any;\n        this.clearTooltipsOfOlGeometry(olGeometry);\n      }\n    );\n\n    this.selectedFeatures$$ = store.stateView\n      .manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n        return record.state.selected === true;\n      })\n      .pipe(\n        skip(1) // Skip initial emission\n      )\n      .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n        if (this.modifyControl.active === true) {\n          this.deactivateModifyControl();\n        }\n        this.selectedFeatures$.next(records.map((record) => record.entity));\n      });\n\n    this.subscriptions$$.push(\n      this.store.entities$.subscribe((objectsExists) => {\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'Polygon'\n          )\n        ) {\n          this.hasArea$.next(true);\n        } else {\n          this.hasArea$.next(false);\n        }\n\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'LineString'\n          )\n        ) {\n          this.hasLine$.next(true);\n        } else {\n          this.hasLine$.next(false);\n        }\n      })\n    );\n\n    this.subscriptions$$.push(\n      this.store.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.store.layer.options.showInLayerList = true)\n          : (this.store.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry)\n    );\n    this.drawEnd$$ = drawControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.abort$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      }\n    );\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined) {\n      this.drawStart$$.unsubscribe();\n    }\n    if (this.drawEnd$$ !== undefined) {\n      this.drawEnd$$.unsubscribe();\n    }\n    if (this.drawChanges$$ !== undefined) {\n      this.drawChanges$$.unsubscribe();\n    }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(\n      olGeometry,\n      Object.assign({}, measure, {\n        area: undefined // We don't want to display an area tooltip while drawing.\n      })\n    );\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(\n      FeatureStoreSelectionStrategy\n    ) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry)\n    );\n    this.modifyEnd$$ = this.modifyControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry)\n    );\n    this.modifyChanges$$ = this.modifyControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry)\n    );\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined) {\n      this.modifyStart$$.unsubscribe();\n    }\n    if (this.modifyEnd$$ !== undefined) {\n      this.modifyEnd$$.unsubscribe();\n    }\n    if (this.modifyChanges$$ !== undefined) {\n      this.modifyChanges$$.unsubscribe();\n    }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(\n    olGeometry: OlLineString | OlPolygon,\n    measure: Measure\n  ) {\n    olGeometry.setProperties({ _measure: measure }, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature\n      ? localFeature.properties.id\n      : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (this.shouldShowTooltip(olTooltip)) {\n          this.map.ol.addOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties(\n      { _measure: measure, _unit: unit, _type: type },\n      true\n    );\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(\n      properties._measure,\n      {\n        decimal: 1,\n        unit: properties._unit,\n        unitAbbr: true,\n        locale: 'fr'\n      },\n      this.languageService\n    );\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength =\n        metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n\n  private saveCurrentUnits() {\n    this.storageService.set(\n      'distanceUnit',\n      this.activeLengthUnit,\n      StorageScope.SESSION\n    );\n    this.storageService.set(\n      'areaUnit',\n      this.activeAreaUnit,\n      StorageScope.SESSION\n    );\n  }\n\n  private getSavedUnits() {\n    const distanceUnit = this.storageService.get(\n      'distanceUnit'\n    ) as MeasureLengthUnit;\n    const areaUnit = this.storageService.get('areaUnit') as MeasureAreaUnit;\n\n    this.activeLengthUnit = distanceUnit ? distanceUnit : this.activeLengthUnit;\n    this.activeAreaUnit = areaUnit ? areaUnit : this.activeAreaUnit;\n  }\n}\n","export const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core/language';\n\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport { getArea as olGetArea, getLength as olGetLength } from 'ol/sphere';\nimport * as olstyle from 'ol/style';\n\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\nimport { Measure } from './measure.interfaces';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(\n  value: number,\n  unit: MeasureLengthUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(\n  value: number,\n  unit: MeasureAreaUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService\n) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(\n      measure.toLocaleString(options.locale, {\n        minimumFractionDigits: decimal,\n        maximumFractionDigits: decimal\n      })\n    );\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit]\n          ? languageService.translate.instant(\n              'igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]\n            )\n          : languageService.translate.instant(\n              'igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit]\n            )\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ||\n          MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter((p) => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33'\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, { projection });\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, { projection });\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max(\n      olGeometry.getFlatCoordinates().length / 2 - 1,\n      0\n    );\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n    typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(\n  olPoint: OlPoint,\n  center: boolean = false,\n  srcGeomType: string = ''\n): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center\n      ? [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          'igo-map-tooltip-measure-area'\n        ]\n      : [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          `igo-map-tooltip-measure-${srcGeomType}segments`\n        ]\n    ).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","export enum InsertSourceInsertDBEnum {\n  System = 'system',\n  User = 'user'\n}\n","import { Injectable } from '@angular/core';\n\nimport { Compression } from '@igo2/utils';\n\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, Subject, of } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\n\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\nimport { GeoDBData } from './geoDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newData: number = 0;\n  private compression = new Compression();\n\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\n\n  /**\n   * Only blob can be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(\n    url: string,\n    regionID: any,\n    object: any,\n    insertSource: InsertSourceInsertDBEnum,\n    insertEvent: string\n  ): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$\n      .pipe(\n        first(),\n        concatMap((object) => {\n          geoDBData = {\n            url,\n            regionID,\n            object: object,\n            compressed: compress,\n            insertSource,\n            insertEvent\n          };\n          return this.ngxIndexedDBService.getByID(this.dbName, url);\n        }),\n        concatMap((dbObject: GeoDBData) => {\n          if (!dbObject) {\n            this._newData++;\n            return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n          } else {\n            const currentRegionID = dbObject.regionID;\n            if (currentRegionID !== regionID) {\n              const collisions = this.collisionsMap.get(currentRegionID);\n              if (collisions !== undefined) {\n                collisions.push(dbObject.url);\n                this.collisionsMap.set(currentRegionID, collisions);\n              } else {\n                this.collisionsMap.set(currentRegionID, [dbObject.url]);\n              }\n            }\n            return this.customUpdate(geoDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      geoDBData.url\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, geoDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getByID(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\n  }\n\n  deleteByKey(url: string): Observable<any> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\n  }\n\n  getRegionCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id).subscribe((datas) => {\n      subject.next(datas.length);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    dbRequest.subscribe((datas: GeoDBData[]) => {\n      datas.forEach((data) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(\n      this.dbName,\n      'regionID',\n      keyRange,\n      mode\n    );\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newData = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService\n          .getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newData(): number {\n    return this._newData;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { Type } from 'ol/format/Feature';\n\nimport { Observable } from 'rxjs';\n\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer = 'arraybuffer',\n  Blob = 'blob',\n  Text = 'text',\n  Json = 'json'\n}\nexport interface SimpleGetOptions {\n  responseType: Type;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(\n    url: string,\n    simpleGetOptions: SimpleGetOptions\n  ): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      case 'arraybuffer':\n        request = this.http.get(url, {\n          responseType: 'arraybuffer',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'text':\n        request = this.http.get(url, {\n          responseType: 'text',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'json':\n        request = this.http.get(url, {\n          responseType: 'json',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      default:\n        request = this.http.get(url, {\n          responseType: 'blob',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport type { MapBase } from '../../map/shared/map.abstract';\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay<T extends MapBase = MapBase> {\n  /**\n   * The map to add the layer to\n   */\n  private map: T;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: T) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: T) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view (default on FeatureMotion.Default)\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map.viewController, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(\n            this.dataSource.ol.getFeatureById(feature.meta.id)\n          );\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n  const setGeoArea = function (pdfExt, geoExt) {\n    const bbox = pdfExt.join(' ');\n    // the ordering may seem odd here but PDF\n    //  flips the Y axis upside down and this accounts for that\n    //  change.\n    const minx = geoExt[0];\n    const maxx = geoExt[2];\n    const maxy = geoExt[1];\n    const miny = geoExt[3];\n    const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n    const bbox_obj = this.internal.newAdditionalObject();\n    const bounds_obj = this.internal.newAdditionalObject();\n    const proj_obj = this.internal.newAdditionalObject();\n\n    proj_obj.content =\n      '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"' +\n      ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]' +\n      ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]' +\n      ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]' +\n      ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n    bounds_obj.content =\n      '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n      proj_obj.objId +\n      ' 0 R /GPTS [ ' +\n      bounds +\n      ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n    bbox_obj.content =\n      '<< /BBox [ ' +\n      bbox +\n      ' ] /Measure ' +\n      bounds_obj.objId +\n      ' 0 R /Name (Layer) /Type /Viewport >>';\n\n    const title_obj = this.internal.newAdditionalObject();\n    const date = new Date().toLocaleDateString('en-CA');\n    title_obj.content = '<< /Name IGO2 /Type /OCG /Date ' + date + ' >>';\n\n    return bbox_obj.objId;\n  };\n\n  jsPDFAPI.setGeoArea = function (pdfExt, geoExt) {\n    this.internal.events.subscribe('putPage', function () {\n      const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n      this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n    });\n  };\n}\n","import { DOCUMENT } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { SecureImagePipe } from '@igo2/common/image';\nimport { ActivityService } from '@igo2/core/activity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { saveAs } from 'file-saver';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport { default as JSZip } from 'jszip';\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { LegendMapViewOptions } from '../../layer/shared/layers/legend.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport GeoPdfPlugin from './geopdf';\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\nimport {\n  PrintLegendPosition,\n  PrintPaperFormat,\n  PrintResolution\n} from './print.type';\n\ndeclare global {\n  interface Navigator {\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean;\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  mapPrintExtent: Array<number>;\n  imgSizeAdded: Array<number>;\n\n  TEXTPDFFONT = {\n    titleFont: 'times',\n    titleFontStyle: 'bold',\n    subtitleFont: 'times',\n    subtitleFontStyle: 'bold',\n    commentFont: 'times',\n    commentFontStyle: 'normal',\n    commentFontSize: 12\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    @Inject(DOCUMENT) private document: Document\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n    this.activityId = this.activityService.register();\n\n    GeoPdfPlugin(jsPDF.API);\n\n    const doc = new jsPDF({\n      orientation,\n      format: paperFormat.toLowerCase(),\n      unit: 'mm' // default\n    });\n\n    const { width: pageWidth, height: pageHeight } = doc.internal.pageSize;\n\n    /** top | right | bottom | left */\n    const baseMargins: [number, number, number, number] = [10, 10, 10, 10];\n\n    let titleSizes: TextPdfSizeAndMargin;\n    let subtitleSizes: TextPdfSizeAndMargin;\n\n    // if paper format A1 or A0 add margin top\n    if (\n      (options.title !== '' || options.subtitle !== '') &&\n      (paperFormat === PrintPaperFormat.A1 ||\n        paperFormat === PrintPaperFormat.A0)\n    ) {\n      baseMargins[0] += 10;\n    }\n    // PDF title\n    const fontSizeInPt = Math.round(2 * (pageHeight + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\n    if (options.title !== undefined && options.title !== '') {\n      titleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.title,\n        baseMargins,\n        this.TEXTPDFFONT.titleFont,\n        fontSizeInPt,\n        this.TEXTPDFFONT.titleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.title,\n        this.TEXTPDFFONT.titleFont,\n        this.TEXTPDFFONT.titleFontStyle,\n        titleSizes.fontSize,\n        titleSizes.marginLeft + baseMargins[3],\n        baseMargins[0]\n      );\n\n      baseMargins[0] = titleSizes.height + baseMargins[0]; // cumulative margin top for next elem to place in pdf doc\n    }\n\n    // PDF subtitle\n    if (options.subtitle !== undefined && options.subtitle !== '') {\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.subtitle,\n        baseMargins,\n        this.TEXTPDFFONT.subtitleFont,\n        options.title !== '' ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\n        this.TEXTPDFFONT.subtitleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.subtitle,\n        this.TEXTPDFFONT.subtitleFont,\n        this.TEXTPDFFONT.subtitleFontStyle,\n        subtitleSizes.fontSize,\n        subtitleSizes.marginLeft + baseMargins[3],\n        baseMargins[0]\n      );\n\n      baseMargins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\n    }\n\n    const verticalSpacing: number = 5;\n    if (options.comment !== undefined && options.comment !== '') {\n      this.addComment(doc, options.comment, baseMargins, verticalSpacing);\n    }\n\n    this.handleFooter(\n      map,\n      doc,\n      options,\n      resolution,\n      verticalSpacing,\n      baseMargins\n    );\n\n    const width = pageWidth - baseMargins[3] - baseMargins[1];\n    const height = pageHeight - baseMargins[0] - baseMargins[2];\n    const size: [number, number] = [width, height];\n\n    this.addMap(\n      doc,\n      map,\n      resolution,\n      size,\n      baseMargins,\n      legendPostion\n    ).subscribe(async (status: SubjectStatus) => {\n      if (status === SubjectStatus.Done) {\n        const width = this.imgSizeAdded[0];\n        const height = this.imgSizeAdded[1];\n        this.addGeoRef(doc, map, width, height, baseMargins);\n        await this.handleMeasureLayer(doc, map, baseMargins);\n        if (options.showNorthArrow) {\n          const northArrowCanvas = await this.createNorthDirectionArrow(\n            map.viewController.getRotation()\n          );\n          await this.addNorthArrowInDoc(\n            doc,\n            northArrowCanvas,\n            baseMargins,\n            legendPostion,\n            width\n          );\n        }\n\n        if (options.legendPosition !== 'none') {\n          if (\n            ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n              options.legendPosition\n            ) > -1\n          ) {\n            await this.addLegendSamePage(\n              doc,\n              map,\n              baseMargins,\n              resolution,\n              options.legendPosition\n            );\n          } else if (options.legendPosition === 'newpage') {\n            await this.addLegend(doc, map, baseMargins, resolution);\n          }\n        } else {\n          await this.saveDoc(doc);\n        }\n      }\n\n      if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n        this.activityService.unregister(this.activityId);\n        status$.next(SubjectStatus.Done);\n      }\n    });\n\n    return status$;\n  }\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\n  addGeoRef(\n    doc,\n    map: IgoMap,\n    width: number,\n    height: number,\n    baseMargins: [number, number, number, number]\n  ) {\n    const unit = 'mm';\n    const docHeight = doc.internal.pageSize.getHeight();\n\n    // x,y = margin left-bottom corner for img in pdf doc\n    const x = baseMargins[3];\n    const y = docHeight - baseMargins[0] - height;\n\n    let pdf_extents = [x, y, x + width, y + height];\n    for (let i = 0; i < pdf_extents.length; i++) {\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\n    }\n    doc.setGeoArea(pdf_extents, this.mapPrintExtent);\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  baseMargins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jsPDF,\n    map: IgoMap,\n    baseMargins: [number, number, number, number]\n  ) {\n    if (\n      map.layers.find(\n        (layer) => layer.visible && layer.id.startsWith('igo-measures-')\n      )\n    ) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then((e) => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, baseMargins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(map.layers, {\n        resolution: map.viewController.getResolution(),\n        extent: map.viewController.getExtent(),\n        projection: map.viewController.getOlProjection().getCode(),\n        // scale: map.viewController.getScale(resolution),\n        size: map.ol.getSize()\n      } as LegendMapViewOptions);\n\n      if (legends.filter((l) => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html +=\n        '.html2canvas-container { width: ' +\n        width +\n        'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html +=\n        'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends\n        .filter((l) => l.display && l.isInResolutionsRange === true)\n        .map((legend) =>\n          this.getDataImage(legend.url).pipe(\n            rxMap((dataImage) => {\n              let htmlImg =\n                '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n              htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n              return htmlImg;\n            })\n          )\n        );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  private removeHtmlElement(element: HTMLElement) {\n    element.parentNode.removeChild(element);\n  }\n\n  getTextPdfObjectSizeAndMarg(\n    text: string,\n    margins,\n    font: string,\n    fontSizeInPt: number,\n    fontStyle: string,\n    doc: jsPDF\n  ): TextPdfSizeAndMargin {\n    const pdfResolution = 96;\n    const docWidth = doc.internal.pageSize.getWidth();\n    const pageWidth = docWidth - margins[1] - margins[3];\n\n    // important to set it first, the textDimension change when font change!\n    doc.setFont(font, fontStyle);\n    doc.setFontSize(fontSizeInPt);\n\n    let textDimensions = doc.getTextDimensions(text);\n    let textMarginLeft: number;\n\n    if (textDimensions.w > pageWidth) {\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\n      textMarginLeft = 0;\n      fontSizeInPt = fontSizeInPt * 0.7;\n      doc.setFontSize(fontSizeInPt);\n      textDimensions = doc.getTextDimensions(text);\n    } else {\n      textMarginLeft = (pageWidth - textDimensions.w) / 2;\n    }\n\n    return {\n      fontSize: fontSizeInPt,\n      marginLeft: textMarginLeft,\n      height: textDimensions.h\n    };\n  }\n\n  /**\n   * Add comment to the document\n   * @param  doc - pdf document\n   * @param  comment - Comment to add in the document\n   * @param baseMargins - top | right | bottom | left\n   * @param verticalSpacing - calculate text position and map height\n   */\n  private addComment(\n    doc: jsPDF,\n    comment: string,\n    baseMargins: [number, number, number, number],\n    verticalSpacing: number\n  ) {\n    // calculate map image height\n    baseMargins[2] += verticalSpacing;\n\n    const xPosition = baseMargins[3]; //margin left and bottom is fix\n    const marginBottom = baseMargins[2];\n    // calculate text position Y\n    const yPosition =\n      doc.internal.pageSize.height - marginBottom + verticalSpacing;\n\n    this.addTextInPdfDoc(\n      doc,\n      comment,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      xPosition,\n      yPosition,\n      true\n    );\n  }\n\n  private addTextInPdfDoc(\n    doc: jsPDF,\n    textToAdd: string,\n    textFont: string,\n    textFontStyle: string,\n    textFontSize: number,\n    textMarginLeft: number,\n    textMarginTop: number,\n    isComment: boolean = false\n  ) {\n    doc.setFont(textFont, textFontStyle);\n    doc.setFontSize(textFontSize);\n\n    if (isComment) {\n      textToAdd = doc.splitTextToSize(\n        textToAdd,\n        doc.internal.pageSize.getWidth() - textMarginLeft * 3\n      );\n    }\n    doc.text(textToAdd, textMarginLeft, textMarginTop);\n  }\n\n  /**\n   * Add attribution and/or (projection and/or scale) to the document\n   * @param  map - Map of the app\n   * @param  doc - pdf document\n   * @param  options - Print options\n   * @param  resolution - cart resolution\n   * @param baseMargins - top | right | bottom | left\n   * @param verticalSpacing - calculate text position and map height\n   */\n  private async handleFooter(\n    map: IgoMap,\n    doc: jsPDF,\n    options: PrintOptions,\n    resolution: number,\n    verticalSpacing: number,\n    baseMargins: [number, number, number, number]\n  ) {\n    let text: string = '';\n\n    const attributionText: string = this.getAttributionText(map);\n    if (attributionText) {\n      text += attributionText + '. ';\n    }\n    if (options.showProjection === true || options.showScale === true) {\n      text += this.getProjScale(map, options, resolution);\n    }\n\n    if (text) {\n      baseMargins[2] += verticalSpacing;\n    }\n\n    const xPosition = baseMargins[3];\n    const marginBottom = baseMargins[2];\n    // calculate text position Y\n    const yPosition =\n      doc.internal.pageSize.height - marginBottom + verticalSpacing;\n\n    this.addTextInPdfDoc(\n      doc,\n      text,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      xPosition,\n      yPosition\n    );\n  }\n\n  getAttributionText(map: IgoMap): string {\n    const mapOverlayHtml = map.ol.getOverlayContainerStopEvent() as HTMLElement;\n    const htmlAttribution = mapOverlayHtml\n      .getElementsByClassName('ol-attribution')[0]\n      .cloneNode(true) as HTMLElement;\n    htmlAttribution.getElementsByTagName('button')[0].remove();\n    return htmlAttribution.innerText;\n  }\n\n  private getProjScale(\n    map: IgoMap,\n    options: PrintOptions,\n    dpi: number\n  ): string {\n    const translate = this.languageService.translate;\n    let textProjScale: string = '';\n    if (options.showProjection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (options.showScale === true) {\n      if (options.showProjection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    return textProjScale;\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n    }\n\n    await this.saveDoc(doc);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  baseMargins - Page margins\n   */\n  private async addLegendSamePage(\n    doc: jsPDF,\n    map: IgoMap,\n    baseMargins: [number, number, number, number],\n    resolution: number,\n    legendPosition: string\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    let marginsLegend;\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      // Move the legend to the correct position on the page\n      if (legendPosition === 'bottomright') {\n        marginsLegend = [\n          doc.internal.pageSize.height - baseMargins[2] - imageSize[1],\n          baseMargins[1],\n          baseMargins[2],\n          doc.internal.pageSize.width - baseMargins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'topright') {\n        marginsLegend = [\n          baseMargins[0],\n          baseMargins[1],\n          doc.internal.pageSize.height - baseMargins[0] - imageSize[1],\n          doc.internal.pageSize.width - baseMargins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'bottomleft') {\n        // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n        marginsLegend = [\n          doc.internal.pageSize.height - baseMargins[2] - imageSize[1],\n          doc.internal.pageSize.width - baseMargins[3] - imageSize[0],\n          baseMargins[2],\n          baseMargins[3]\n        ];\n      } else if (legendPosition === 'topleft') {\n        marginsLegend = [\n          baseMargins[0],\n          doc.internal.pageSize.width - baseMargins[3] - imageSize[0],\n          doc.internal.pageSize.height - baseMargins[0] - imageSize[1],\n          baseMargins[3]\n        ];\n      }\n      this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n      await this.saveDoc(doc);\n    }\n  }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jsPDF,\n    canvas: HTMLCanvasElement,\n    baseMargins: [number, number, number, number]\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      if (image.length < 20) {\n        console.log('Warning: An image cannot be print in pdf file');\n        return;\n      }\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, baseMargins);\n      doc.addImage(\n        image,\n        'PNG',\n        baseMargins[3],\n        baseMargins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(baseMargins[3], baseMargins[0], imageSize[0], imageSize[1]);\n      this.imgSizeAdded = imageSize; // keep img size for georef later\n    }\n  }\n\n  // TODO fix printing with image resolution\n  addMap(\n    doc: jsPDF,\n    map: IgoMap,\n    resolution: number,\n    imageDimensions: [number, number],\n    baseMargins: [number, number, number, number],\n    legendPostion: PrintLegendPosition\n  ) {\n    const mapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n    const dimensionPixels = this.setMapResolution(\n      map,\n      imageDimensions,\n      resolution,\n      viewResolution\n    );\n    const status$ = new Subject();\n\n    let timeout;\n    map.ol.once('rendercomplete', async (event: any) => {\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n\n      const mapResultCanvas = await this.drawMap(dimensionPixels, mapCanvas);\n\n      this.mapPrintExtent = map.viewController.getExtent('EPSG:3857');\n\n      this.resetOriginalMapSize(map, mapSize, viewResolution);\n      await this.drawMapControls(map, mapResultCanvas, legendPostion);\n\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n        mapStatus$$.unsubscribe();\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, baseMargins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, baseMargins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        this.resetOriginalMapSize(map, mapSize, viewResolution);\n        status$.next(status);\n      }, 200);\n    });\n\n    return status$;\n  }\n\n  private setMapResolution(\n    map: IgoMap,\n    initialSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): [number, number] {\n    const mapSize = map.ol.getSize();\n    const widthPixels = Math.round((initialSize[0] * resolution) / 25.4);\n    const heightPixels = Math.round((initialSize[1] * resolution) / 25.4);\n\n    // Set print size\n    const printSize = [widthPixels, heightPixels];\n    map.ol.setSize(printSize);\n    const scaling = Math.min(\n      widthPixels / mapSize[0],\n      heightPixels / mapSize[1]\n    );\n    map.ol.getView().setResolution(viewResolution / scaling);\n\n    return [widthPixels, heightPixels];\n  }\n\n  private resetOriginalMapSize(\n    map: IgoMap,\n    initialSize: [number, number],\n    viewResolution: number\n  ) {\n    map.ol.setSize(initialSize);\n    map.ol.getView().setResolution(viewResolution);\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  async drawMap(\n    size: Array<number>,\n    mapCanvas: HTMLCollectionOf<HTMLCanvasElement>\n  ): Promise<HTMLCanvasElement> {\n    const mapResultCanvas = document.createElement('canvas');\n    mapResultCanvas.width = size[0];\n    mapResultCanvas.height = size[1];\n\n    for (let index = 0; index < mapCanvas.length; index++) {\n      const canvas = mapCanvas[index];\n      if (canvas.width > 0) {\n        this.handleCanvas(canvas, mapResultCanvas);\n      }\n    }\n    return mapResultCanvas;\n  }\n\n  private handleCanvas(\n    canvas: HTMLCanvasElement,\n    mapResultCanvas: HTMLCanvasElement\n  ) {\n    const mapContextResult = mapResultCanvas.getContext('2d');\n    const opacity = canvas.parentElement.style.opacity || canvas.style.opacity;\n    mapContextResult.globalAlpha = opacity === '' ? 1 : Number(opacity);\n    const transform = canvas.style.transform;\n    let matrix: number[];\n    if (transform) {\n      // Get the transform parameters from the style's transform matrix\n      matrix = transform\n        .match(/^matrix\\(([^\\(]*)\\)$/)[1]\n        .split(',')\n        .map(Number);\n    } else {\n      matrix = [\n        parseFloat(canvas.style.width) / canvas.width,\n        0,\n        0,\n        parseFloat(canvas.style.height) / canvas.height,\n        0,\n        0\n      ];\n    }\n    CanvasRenderingContext2D.prototype.setTransform.apply(\n      mapContextResult,\n      matrix\n    );\n    const backgroundColor = canvas.parentElement.style.backgroundColor;\n    if (backgroundColor) {\n      mapContextResult.fillStyle = backgroundColor;\n      mapContextResult.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    mapContextResult.drawImage(canvas, 0, 0);\n    mapContextResult.globalAlpha = 1;\n    // reset canvas transform to initial\n    mapContextResult.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  async drawMapControls(\n    map: IgoMap,\n    canvas: HTMLCanvasElement,\n    position: PrintLegendPosition\n  ): Promise<void> {\n    const context = canvas.getContext('2d');\n    // Get the scale and attribution\n    // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n    const mapOverlayHTML = map.ol\n      .getOverlayContainerStopEvent()\n      .cloneNode(true) as HTMLElement;\n\n    // set 'OverlayContainer' size to print size\n    mapOverlayHTML.style.width = canvas.width + 'px';\n    mapOverlayHTML.style.height = canvas.height + 'px';\n    // we add zindex -1 to not show modification to the user\n    mapOverlayHTML.style.zIndex = '-1';\n    // and make sure html2canvas to render the image correctly\n    document\n      .getElementsByClassName('ol-viewport')[0]\n      .appendChild(mapOverlayHTML);\n    // Change the styles of hyperlink in the printed version\n    // Transform the Overlay into a canvas\n    // scale is necessary to make it in google chrome\n    // background as null because otherwise it is white and cover the map\n    // allowtaint is to allow rendering images in the attributions\n    // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n    const canvasOverlayHTML = await html2canvas(mapOverlayHTML, {\n      scale: 1,\n      backgroundColor: null,\n      allowTaint: true,\n      useCORS: true,\n      ignoreElements: (element: Element) => {\n        return element instanceof HTMLElement\n          ? element.className.includes('ol-attribution')\n          : false;\n      }\n    });\n\n    if (canvasOverlayHTML.width !== 0 && canvasOverlayHTML.height !== 0) {\n      context.drawImage(canvasOverlayHTML, 0, 0);\n    }\n\n    // remove 'mapOverlayHTML' after generating canvas\n    mapOverlayHTML.remove();\n  }\n\n  private async addNorthArrowInDoc(\n    doc: jsPDF | CanvasRenderingContext2D,\n    arrawCanvas: HTMLCanvasElement,\n    baseMargins: [number, number, number, number],\n    legendPosition: PrintLegendPosition,\n    width: number,\n    yPosition: number = 0\n  ) {\n    let xPosition: number = 0;\n    let northArrowDimension: number = 0;\n    if (doc instanceof CanvasRenderingContext2D) {\n      northArrowDimension = 50;\n      xPosition =\n        legendPosition === 'topright' ? 0 : width - northArrowDimension;\n      doc.drawImage(\n        arrawCanvas,\n        xPosition,\n        yPosition,\n        northArrowDimension,\n        northArrowDimension\n      );\n    } else {\n      northArrowDimension = 16;\n      xPosition = legendPosition === 'topright' ? 10 : width - baseMargins[1];\n      yPosition = baseMargins[0];\n      doc.addImage(\n        arrawCanvas.toDataURL(),\n        xPosition,\n        yPosition,\n        northArrowDimension,\n        northArrowDimension\n      );\n    }\n  }\n\n  /**\n   * @param rotation - map rotation 'rad' unit\n   *\n   */\n  private async createNorthDirectionArrow(\n    rotation: number\n  ): Promise<HTMLCanvasElement> {\n    const div = this.document.createElement('div');\n    div.style.maxWidth = '50mm';\n    div.style.maxHeight = '50mm';\n    div.style.textAlign = 'center';\n\n    const img = this.document.createElement('img');\n    img.src = './assets/igo2/geo/images/north-direction.png';\n    img.style.maxWidth = '50mm';\n    img.style.maxHeight = '50mm';\n    img.style.transform = 'rotate(' + rotation + 'rad)';\n    img.style.padding = '5mm';\n    div.appendChild(img);\n    this.document.body.appendChild(div);\n    const canvas = await html2canvas(div, { backgroundColor: null });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      return canvas;\n    }\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    printResolution: PrintResolution,\n    format = 'png',\n    projection = false,\n    scale = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true,\n    legendPosition: PrintLegendPosition,\n    showNorthArrow: boolean\n  ) {\n    const status$ = new Subject();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    format = format.toLowerCase();\n    const resolution = +printResolution;\n    const initialMapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n\n    map.ol.once('rendercomplete', async (event: any) => {\n      const size = map.ol.getSize();\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n      const mapResultCanvas = await this.drawMap(size, mapCanvas);\n\n      this.resetOriginalMapSize(map, initialMapSize, viewResolution);\n\n      await this.drawMapControls(map, mapResultCanvas, legendPosition);\n\n      // Check the legendPosition\n      if (legendPosition !== 'none') {\n        if (\n          ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n            legendPosition\n          ) > -1\n        ) {\n          await this.addLegendToImage(\n            mapResultCanvas,\n            map,\n            resolution,\n            legendPosition,\n            format\n          );\n        } else if (legendPosition === 'newpage') {\n          await this.getLayersLegendImage(map, format, doZipFile, resolution);\n        }\n      }\n      // add other information to final canvas before exporting\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Get height/width of map canvas\n      const width = mapResultCanvas.width;\n      let height = mapResultCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n\n      if (['bmp', 'gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\n        // Patch Jpeg default black background to white\n        if (\n          format === 'jpeg' ||\n          title !== '' ||\n          subtitle !== '' ||\n          comment !== '' ||\n          projection !== false ||\n          scale !== false\n        ) {\n          newContext.fillStyle = '#ffffff';\n          newContext.fillRect(0, 0, width, height);\n          newContext.fillStyle = '#000000';\n        }\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection or/end scale need to be added to canvas\n      if (projection !== false || scale !== false) {\n        let projectionScaleText = '';\n        if (projection !== false) {\n          const projText = translate.instant('igo.geo.printForm.projection');\n          projectionScaleText = projText + ': ' + map.projection + '         ';\n        }\n\n        if (scale !== false) {\n          const scaleText = translate.instant('igo.geo.printForm.scale');\n          const mapScale = map.viewController.getScale(resolution);\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n        }\n        newContext.textAlign = 'center';\n        newContext.fillText(\n          projectionScaleText,\n          width / 2,\n          positionHProjScale,\n          width * 0.9\n        );\n      }\n\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n\n      newContext.drawImage(mapResultCanvas, 0, positionHCanvas);\n\n      if (showNorthArrow) {\n        const northArrowCanvas = await this.createNorthDirectionArrow(\n          map.viewController.getRotation()\n        );\n        await this.addNorthArrowInDoc(\n          newContext,\n          northArrowCanvas,\n          null,\n          legendPosition,\n          width,\n          positionHCanvas\n        );\n      }\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt =\n          'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt =\n          fileNameWithExt.substring(\n            0,\n            fileNameWithExt.toLowerCase().indexOf('.tiff')\n          ) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt, blob);\n        }\n      }\n    });\n\n    this.setMapImageResolution(map, initialMapSize, resolution, viewResolution);\n\n    return status$;\n  }\n\n  private setMapImageResolution(\n    map: IgoMap,\n    initialMapSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): void {\n    const scaleFactor = resolution / 96;\n    const newMapSize = [\n      Math.round(initialMapSize[0] * scaleFactor), // width\n      Math.round(initialMapSize[1] * scaleFactor) // height\n    ];\n    map.ol.setSize(newMapSize);\n    const scaling = Math.min(\n      newMapSize[0] / initialMapSize[0],\n      newMapSize[1] / initialMapSize[1]\n    );\n    const view = map.ol.getView();\n    view.setResolution(viewResolution / scaling);\n    map.ol.renderSync();\n  }\n\n  /**\n   * Create and Add Legend to the map canvas\n   * @param  canvas Canvas of the map\n   * @param  map Map of the app\n   * @param  resolution Resolution of map\n   * @param  legendPosition Legend position\n   * @param  format Image format\n   */\n  private async addLegendToImage(\n    canvas: HTMLCanvasElement,\n    map: IgoMap,\n    resolution: number,\n    legendPosition: string,\n    format: string\n  ) {\n    const fileNameWithExt = 'map.' + format;\n    const context = canvas.getContext('2d');\n\n    // Get html code for the legend\n    const html = await this.getLayersLegendHtml(\n      map,\n      canvas.width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch(\n      (e) => {\n        console.log(e);\n      }\n    );\n\n    if (canvasLegend) {\n      const canvasHeight = canvas.height;\n      const canvasWidth = canvas.width;\n      const legendHeight = canvasLegend.height;\n      const legendWidth = canvasLegend.width;\n      // Move the legend to the correct position on the page\n      const offset = canvasHeight * 0.01;\n      let legendX: number;\n      let legendY: number;\n\n      if (legendPosition === 'bottomright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = offset;\n      } else if (legendPosition === 'bottomleft') {\n        legendX = offset;\n        legendY = canvasHeight - legendHeight - offset - 15;\n      } else if (legendPosition === 'topleft') {\n        legendX = offset;\n        legendY = offset;\n      }\n\n      context.drawImage(\n        canvasLegend,\n        legendX,\n        legendY,\n        legendWidth,\n        legendHeight\n      );\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\n      this.removeHtmlElement(div);\n      return true;\n    }\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jsPDF) {\n    await doc.save('map_georef.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\n\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      canvas.toBlob((blob) => {\n        // download image\n        saveAs(blob, nameWithExt);\n        that.saveFileProcessing();\n      }, blobFormat);\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n\n  private pdf_units2points(n, unit): number {\n    let k = 1;\n\n    // this code is borrowed from jsPDF\n    //  as it does not expose a public API\n    //  for converting units to points.\n    switch (unit) {\n      case 'pt':\n        k = 1;\n        break;\n      case 'mm':\n        k = 72 / 25.4;\n        break;\n      case 'cm':\n        k = 72 / 2.54;\n        break;\n      case 'in':\n        k = 72;\n        break;\n      case 'px':\n        k = 96 / 72;\n        break;\n      case 'pc':\n        k = 12;\n        break;\n      case 'em':\n        k = 12;\n        break;\n      case 'ex':\n        k = 6;\n        break;\n      default:\n        throw new Error('Invalid unit: ' + unit);\n    }\n\n    return n * k;\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport {\n  LegendMapViewOptions,\n  OutputLayerLegend\n} from '../shared/layers/legend.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(\n  layers: Layer[],\n  view?: LegendMapViewOptions\n): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) {\n      continue;\n    }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) {\n        continue;\n      }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display:\n          legendOptions?.display === undefined ? true : legendOptions.display,\n        isInResolutionsRange: layer.isInResolutionsRange\n      });\n    }\n  }\n\n  return legends;\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = ['72', '96', '150', '300'] as const;\nexport type PrintResolution = (typeof PrintResolution)[number];\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import {\n  AfterViewInit,\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output,\n  Self\n} from '@angular/core';\n\nimport OlFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport OlLayer from 'ol/layer/Layer';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Observable, Subscription, of, zip } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { QueryableDataSourceOptions } from './query.interfaces';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]',\n  standalone: true\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map as any as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if (\n            (layer.dataSource.options as QueryableDataSourceOptions)\n              .queryFormatAsWms\n          ) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer)\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter((layer) => layer instanceof VectorLayer && layer.visible)\n        .map((layer) => {\n          const featuresOL = layer.dataSource.ol as olVectorSource;\n          featuresOL.forEachFeatureIntersectingExtent(\n            dragExtent,\n            (olFeature: any) => {\n              const newFeature: Feature = featureFromOl(\n                olFeature,\n                this.map.projection,\n                layer.ol\n              );\n              newFeature.meta = {\n                id: layer.id + '.' + olFeature.getId(),\n                icon: olFeature.values_._icon,\n                sourceTitle: layer.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          );\n        });\n    }\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\nimport { uuid } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport * as olformat from 'ol/format';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport * as olgeom from 'ol/geom';\n\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport { default as striptags } from 'striptags';\n\nimport {\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../feature/shared/feature.interfaces';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapExtent } from '../../map/shared/map.interface';\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryUrlData,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService\n  ) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach((id) => {\n        this.messageService.remove(id);\n      });\n    }\n\n    const newLayers = layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n    // the directive accept array in this format [observable, observable...]\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\n    // so we need to flat the array\n    let flatArray = [].concat.apply([], newLayers);\n    return flatArray;\n  }\n\n  queryLayer(\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> | Observable<Feature[]>[] {\n    const url = this.getQueryUrl(\n      layer.dataSource,\n      options,\n      false,\n      layer.map.viewController.getExtent()\n    );\n    if (!url) {\n      return of([]);\n    }\n\n    const resolution: number = layer.map.viewController.getResolution();\n    const scale: number = layer.map.viewController.getScale();\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      if (typeof url === 'string') {\n        const urlGml = this.getQueryUrl(\n          layer.dataSource,\n          options,\n          true\n        ) as string;\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\n          mergeMap((gmlRes) => {\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\n            const imposedGeom = mergedGML[0];\n            const imposedProperties = mergedGML[1];\n            return this.http\n              .get(url, { responseType: 'text' })\n              .pipe(\n                map((res) =>\n                  this.extractData(\n                    res,\n                    layer,\n                    options,\n                    url,\n                    imposedGeom,\n                    imposedProperties\n                  )\n                )\n              );\n          })\n        );\n      }\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\n      let observables: any = [];\n      for (let i = 0; i < urlGmls.length; i++) {\n        const element = urlGmls[i] as QueryUrlData;\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          observables.push(\n            this.requestDataForHTMLGML2(element.url, url[i].url, layer, options)\n          );\n        }\n      }\n      return observables;\n    } else {\n      if (typeof url === 'string') {\n        const request = this.http.get(url, { responseType: 'text' });\n        return request.pipe(\n          map((res) => this.extractData(res, layer, options, url))\n        );\n      }\n      let observables: any = [];\n      for (let i = 0; i < url.length; i++) {\n        const element: QueryUrlData = url[i];\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          const request = this.http.get(element.url, { responseType: 'text' });\n          observables.push(\n            request.pipe(\n              map((res) => this.extractData(res, layer, options, element.url))\n            )\n          );\n        }\n      }\n      return observables;\n    }\n  }\n\n  private requestDataForHTMLGML2(\n    urlGml: string,\n    url: string,\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> {\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\n      mergeMap((gmlRes) => {\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\n        const imposedGeom = mergedGML[0];\n        const imposedProperties = mergedGML[1];\n        return this.http\n          .get(url, { responseType: 'text' })\n          .pipe(\n            map((res) =>\n              this.extractData(\n                res,\n                layer,\n                options,\n                url,\n                imposedGeom,\n                imposedProperties\n              )\n            )\n          );\n      })\n    );\n  }\n\n  private checkScaleAndResolution(\n    resolution: number,\n    scale: number,\n    element: QueryUrlData\n  ): boolean {\n    let checkScale: boolean;\n    let checkResolution: boolean;\n\n    if (\n      !element.minResolution &&\n      !element.maxResolution &&\n      !element.minScale &&\n      !element.maxScale\n    ) {\n      return true;\n    } else {\n      /******************* checking Resolution *******************/\n      if (element.minResolution && element.maxResolution) {\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\n        if (\n          resolution >= element.minResolution &&\n          resolution <= element.maxResolution\n        ) {\n          checkResolution = true;\n        }\n      } else {\n        // check if \"minResolution\" or \"maxResolution\" exists\n        if (element.minResolution && resolution >= element.minResolution) {\n          checkResolution = true;\n        }\n        if (element.maxResolution && resolution <= element.maxResolution) {\n          checkResolution = true;\n        }\n      }\n\n      /******************* checking Scale *******************/\n      if (element.minScale && element.maxScale) {\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\n        if (scale > element.minScale && scale < element.maxScale) {\n          checkScale = true;\n        }\n      } else {\n        // check if \"minScale\" or \"maxScale\" exists\n        if (element.maxScale && scale <= element.maxScale) {\n          checkScale = true;\n        }\n        if (element.minScale && scale >= element.minScale) {\n          checkScale = true;\n        }\n      }\n\n      /******************* result of checking *******************/\n      if (checkScale === true && checkResolution === true) {\n        return true;\n      } else if (\n        (checkResolution === true && !checkScale) ||\n        (checkScale === true && !checkResolution)\n      ) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  private mergeGML(\n    gmlRes,\n    url,\n    layer: Layer\n  ): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map((feature) => {\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent\n            ? queryTitleContent\n            : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = (\n        feature.getGeometry() as any\n      ).getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n        break;\n      case 'Point':\n        returnGeometry = olmpts;\n        break;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [returnGeometry, imposedProperties];\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n    if (\n      features.length > 0 &&\n      (features[0].geometry === null || !features[0].geometry)\n    ) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT\n      ? new RegExp('FEATURE_COUNT=' + this.featureCount)\n      : new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT &&\n        this.featureCount > 1 &&\n        features.length === this.featureCount) ||\n        (!wmsDatasource.params?.FEATURE_COUNT &&\n          features.length === this.defaultFeatureCount))\n    ) {\n      const messageObj = this.messageService.info(\n        'igo.geo.query.featureCountMax',\n        undefined,\n        undefined,\n        { value: layer.title }\n      );\n      this.previousMessageIds.push(messageObj.toastId);\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(\n      (feature) =>\n        (feature.meta = {\n          id: uuid(),\n          order: 1000 - zIndex,\n          alias: allowedFieldsAndAlias\n        })\n    );\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const body = striptags(\n      res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '')\n    );\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign(\n          { target: htmlTarget, body: res, url },\n          imposedProperties\n        ),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach((pair) => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.SHAPE_S;\n    delete properties.SHAPE_L;\n    delete properties.SHAPE_P;\n    delete properties.the_geom;\n    delete properties.geom;\n    delete properties.geom32198;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string | QueryUrlData[] {\n    let url;\n\n    if (datasource.options.queryUrls) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT:\n            wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision\n          ? tileArcGISRestDatasource.options.queryPrecision\n          : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      (key) => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent\n  ): QueryUrlData[] {\n    const extent = olextent.getForViewAndSize(\n      options.coordinates,\n      options.resolution,\n      0,\n      [101, 101]\n    );\n\n    return datasource.options.queryUrls.map((item) => {\n      let data: QueryUrlData = {\n        url: item.url\n          .replace(/\\{bbox\\}/g, extent.join(','))\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:', ''))\n      };\n\n      // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\n      // we need to check \"mapExtent\" befor replace variables in the url\n      if (mapExtent) {\n        data.url\n          .replace(/\\{xmin\\}/g, mapExtent[0].toString())\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\n      }\n\n      if (item.maxResolution) {\n        data.maxResolution = item.maxResolution;\n      }\n\n      if (item.minResolution) {\n        data.minResolution = item.minResolution;\n      }\n\n      if (item.minScale) {\n        data.minScale = item.minScale;\n      }\n\n      if (item.maxScale) {\n        data.maxScale = item.maxScale;\n      }\n\n      return data;\n    });\n  }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined\n    ? dataSource.options.queryLayerFeatures === true\n    : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined\n    ? false\n    : layerIsQueryable(layer) && layerFeatureIsQueryable(layer);\n}\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{ empty: empty$ | async }\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{ label }}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{ hasSearchIcon: showSearchButton }\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"\n        placeholder\n          ? placeholder\n          : (placeholder$ | async)\n            ? (placeholder$.value | translate)\n            : undefined\n      \"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n    />\n    <button\n      *ngIf=\"(empty$ | async) === false\"\n      mat-icon-button\n      matSuffix\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"withDivider\" [vertical]=\"true\"></mat-divider>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      *ngIf=\"showSearchButton\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"handleSearch()\"\n    >\n      <mat-icon>search</mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\"\n    >\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"\n        reverseSearchCoordsFormatStatus.emit($event)\n      \"\n      (searchSourceChange)=\"onSearchSettingsChange()\"\n    >\n    </igo-search-settings>\n  </div>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { SearchSelectorComponent } from '../search-selector/search-selector.component';\nimport { SearchSettingsComponent } from '../search-settings/search-settings.component';\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { Research, SearchResult } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgClass,\n    MatFormFieldModule,\n    NgIf,\n    MatInputModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatDividerModule,\n    SearchSelectorComponent,\n    SearchSettingsComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * whether to show search button or not\n   */\n\n  public showSearchButton: boolean = false;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  @Input() withDivider: boolean;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format setting is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * When reverse coordinates status change\n   */\n  @Input()\n  get reverseSearchCoordsFormatEnabled(): boolean {\n    return this._reverseSearchCoordsFormatEnabled;\n  }\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\n    this._reverseSearchCoordsFormatEnabled = value;\n    this.setTerm(this.term, true);\n  }\n  private _reverseSearchCoordsFormatEnabled = false;\n\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() appearance: MatFormFieldAppearance = 'fill';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private configService: ConfigService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(debounce(() => timer(this.debounce)))\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n\n    const configValue = this.configService.getConfig(\n      'searchBar.showSearchButton'\n    );\n    this.showSearchButton = configValue !== undefined ? configValue : false;\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string, reverseCoordEvent?: boolean) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term && !reverseCoordEvent) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  handleSearch(): void {\n    this.doSearch(this.term);\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (\n      this.termSplitter &&\n      rawTerm.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = rawTerm\n        .split(this.termSplitter)\n        .filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(\n        this.searchService.search(term, {\n          forceNA: this.forceNA\n        })\n      );\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.layer.saveFeatureInLayer' | translate }}\n</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        [showIcons]=\"true\"\n      >\n      </igo-search-results-item>\n    </igo-list>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          placeholder=\"{{ 'igo.geo.layer.chooseOrSet' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\"\n        />\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option\n            *ngFor=\"let layer of filteredLayers$ | async\"\n            [value]=\"layer\"\n          >\n            <p matListItemTitle>{{ layer.title }}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.layer.cancelBtn' | translate }}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\"\n    >\n      {{ 'igo.geo.layer.saveBtn' | translate }}\n    </button>\n  </div>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport { Component, Inject, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Observable } from 'rxjs';\nimport { map, startWith } from 'rxjs/operators';\n\nimport { Layer } from '../../layer/shared';\nimport { SearchResult } from '../shared';\nimport { SearchResultsItemComponent } from './search-results-item.component';\n\n@Component({\n  selector: 'igo-save-feature-dialog',\n  templateUrl: './save-feature-dialog.component.html',\n  styleUrls: ['./save-feature-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    ListComponent,\n    SearchResultsItemComponent,\n    ListItemDirective,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatListModule,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SaveFeatureDialogComponent implements OnInit {\n  public form: UntypedFormGroup;\n  feature: SearchResult;\n  layers: Layer[] = [];\n  filteredLayers$: Observable<Layer[]>;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { feature: SearchResult; layers: Layer[] }\n  ) {\n    this.form = this.formBuilder.group({\n      layerName: ['', [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.feature = this.data.feature;\n    this.layers = this.data.layers;\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\n      startWith(''),\n      map((val) => this.filter(val))\n    );\n  }\n\n  private filter(val): Layer[] {\n    if (typeof val !== 'string') {\n      return;\n    }\n    return this.layers\n      .map((l) => l)\n      .filter((layer) =>\n        layer?.title?.toLowerCase().includes(val.toLowerCase())\n      );\n  }\n\n  displayFn(layer: Layer): string {\n    return layer && layer.title ? layer.title : '';\n  }\n\n  save() {\n    const data: { layer: string | Layer; feature: SearchResult } = {\n      layer: this.form.value.layerName,\n      feature: this.feature\n    };\n    this.dialogRef.close(data);\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","<button\n  igoStopPropagation\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n  *ngIf=\"layer.meta.dataType === 'Layer'\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"computeTooltip() | translate\"\n  [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n  (click)=\"onToggleClick($event)\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    [igoMatBadgeIcon]=\"getBadgeIcon()\"\n    igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n    igoMatBadgeBackgroundColor=\"none\"\n    [igoMatBadgeInverseColor]=\"true\"\n    [matBadgeHidden]=\"\n      ((inRange$ | async) && (isVisible$ | async) === true) ||\n      ((inRange$ | async) && !added) ||\n      ((inRange$ | async) && (isPreview$ | async))\n    \"\n    [matBadgeDisabled]=\"(inRange$ | async) === false\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    >{{ (isPreview$ | async) ? 'add' : added ? 'delete' : 'add' }}\n  </mat-icon>\n</button>\n\n<button\n  [id]=\"!isMobile ? 'hide-save-search-result-btn' : ''\"\n  igoStopPropagation\n  *ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"addFeatureToLayerTooltip$ | async | translate\"\n  (click)=\"addFeatureToLayer()\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    igoMatBadgeIcon=\"visibility_off\"\n    [igoMatBadgeInverseColor]=\"true\"\n    [matBadgeHidden]=\"inRange$ | async\"\n    [matBadgeDisabled]=\"true\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    >add_to_photos\n  </mat-icon>\n</button>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { EntityStore } from '@igo2/common/entity';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport OlOverlay from 'ol/Overlay';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport Circle from 'ol/style/Circle';\nimport Fill from 'ol/style/Fill';\nimport Stroke from 'ol/style/Stroke';\nimport Style from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription, take } from 'rxjs';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { getTooltipsOfOlGeometry } from '../../measure';\nimport { QueryableDataSourceOptions } from '../../query/shared';\nimport { SearchResult } from '../shared/search.interfaces';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> =\n    new BehaviorSubject('igo.geo.search.addToLayer');\n\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * show hide save search result in layer button\n   */\n  @Input() saveSearchResultInLayer: boolean = false;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input() stores: FeatureStore<Feature>[] = [];\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-search-layer')\n    );\n  }\n  private mediaService$$: Subscription;\n  public isMobile: boolean = false;\n  constructor(\n    private layerService: LayerService,\n    private dialog: MatDialog,\n    private dataSourceService: DataSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    // check the view if is mobile or not\n    this.mediaService$$ = this.mediaService.media$.subscribe((media: Media) => {\n      if (media === Media.Mobile) {\n        this.isMobile = true;\n      }\n    });\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          (lay) => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (value) => {\n        this.isInResolutionsRange(value);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(currEvent: Event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    const event = currEvent ? currEvent : ({} as Event);\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap(event);\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map((s) => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap(event?: Event) {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService.createAsyncLayer(layerOptions).subscribe((layer) => {\n        if (event.type === 'click') {\n          this.map.layersAddedByClick$.next([layer]);\n        }\n        this.map.addLayer(layer);\n      })\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.data?.sourceOptions?.id) {\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.value) {\n      return this.isVisible$.value ? '' : 'visibility_off';\n    } else {\n      return 'visibility_off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n\n  addFeatureToLayer() {\n    if (this.layer.meta.dataType !== 'Feature') {\n      return;\n    }\n\n    const selectedFeature = this.layer;\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\n      width: '700px',\n      data: {\n        feature: selectedFeature,\n        layers: this.allLayers\n      }\n    });\n\n    dialogRef\n      .afterClosed()\n      .subscribe((data: { layer: string | any; feature: SearchResult }) => {\n        if (data) {\n          if (this.stores.length > 0) {\n            this.stores.map((store) => {\n              store.state.updateAll({ selected: false });\n              if (store?.layer) {\n                store.layer.visible = false;\n              }\n              return store;\n            });\n          }\n          // check if is new layer\n          if (typeof data.layer === 'string') {\n            this.createLayer(data.layer, data.feature);\n          } else {\n            const activeStore = this.stores.find(\n              (store) => store.layer.id === data.layer.id\n            );\n            activeStore.layer.visible = true;\n            activeStore.layer.opacity = 1;\n            this.addFeature(data.feature, activeStore);\n          }\n        }\n      });\n  }\n\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\n      map: this.map\n    });\n\n    const styles = [\n      new Style({\n        image: new Circle({\n          radius: 5,\n          stroke: new Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new Fill({\n            color: 'rgba(143,7,7,1)'\n          })\n        })\n      }),\n      new Style({\n        stroke: new Stroke({\n          width: 1,\n          color: 'rgba(143,7,7,1)'\n        }),\n        fill: new Fill({\n          color: 'rgba(0, 0, 255, 0.1)'\n        })\n      })\n    ];\n\n    // set layer id\n    let layerCounterID: number = 0;\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-search-layer', ''));\n      layerCounterID = Math.max(numberId, layerCounterID);\n    }\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true\n      } as QueryableDataSourceOptions)\n      .pipe(take(1))\n      .subscribe((dataSource: FeatureDataSource) => {\n        let searchLayer: VectorLayer = new VectorLayer({\n          isIgoInternalLayer: true,\n          id: 'igo-search-layer' + ++layerCounterID,\n          title: layerTitle,\n          source: dataSource,\n          igoStyle: {\n            editable: false,\n            igoStyleObject: {\n              fill: { color: 'rgba(255,255,255,0.4)' },\n              stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n              circle: {\n                fill: { color: 'rgba(255,255,255,0.4)' },\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n                radius: 5\n              }\n            }\n          },\n          style: styles,\n          showInLayerList: true,\n          exportable: true,\n          workspace: {\n            enabled: true\n          }\n        });\n\n        tryBindStoreLayer(activeStore, searchLayer);\n        tryAddLoadingStrategy(\n          activeStore,\n          new FeatureStoreLoadingStrategy({\n            motion: FeatureMotion.None\n          })\n        );\n\n        tryAddSelectionStrategy(\n          activeStore,\n          new FeatureStoreSelectionStrategy({\n            map: this.map,\n            motion: FeatureMotion.None,\n            many: true\n          })\n        );\n\n        activeStore.layer.visible = true;\n        activeStore.source.ol.on(\n          'removefeature',\n          (event: OlVectorSourceEvent) => {\n            const olGeometry = event.feature.getGeometry();\n            this.clearLabelsOfOlGeometry(olGeometry);\n          }\n        );\n\n        this.addFeature(selectedFeature, activeStore);\n        this.stores.push(activeStore);\n      });\n  }\n\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\n    const newFeature = {\n      type: feature.data.type,\n      geometry: {\n        coordinates: feature.data.geometry.coordinates,\n        type: feature.data.geometry.type\n      },\n      projection: feature.data.projection,\n      properties: feature.data.properties,\n      meta: {\n        id: feature.meta.id\n      }\n    };\n    delete newFeature.properties.Route;\n    activeStore.update(newFeature);\n    activeStore.setLayerExtent();\n    activeStore.layer.ol.getSource().refresh();\n  }\n\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n}\n","<mat-list-item\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n>\n  <mat-icon *ngIf=\"icon\" matListItemIcon>{{\n    showIcons ? icon : 'blank'\n  }}</mat-icon>\n\n  <div\n    matListItemTitle\n    *ngIf=\"titleHtml; else normalTitle\"\n    [innerHtml]=\"titleHtml\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"tooltipHtml\"\n    matTooltipClass=\"search-result-tooltip\"\n  ></div>\n  <ng-template #normalTitle>\n    <span\n      matListItemTitle\n      *ngIf=\"!titleHtml\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"title\"\n      >{{ title }}</span\n    >\n  </ng-template>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"withZoomButton\"\n      igoStopPropagation\n      mat-icon-button\n      (click)=\"onZoomHandler()\"\n    >\n      <mat-icon>search</mat-icon>\n    </button>\n\n    <ng-content select=\"[igoSearchItemToolbar]\"> </ng-content>\n  </div>\n</mat-list-item>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  getEntityIcon,\n  getEntityTitle,\n  getEntityTitleHtml\n} from '@igo2/common/entity';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map/shared/map';\nimport { SearchResult } from '../shared/search.interfaces';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    MatTooltipModule,\n    MatButtonModule,\n    StopPropagationDirective\n  ]\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(\n      this.map.viewController,\n      [olFeature],\n      FeatureMotion.Default\n    );\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    const element = event.target;\n    const type = event.type;\n    switch (type) {\n      case 'mouseenter':\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\n        hideBtn\n          ? hideBtn.setAttribute('id', 'show-save-search-result-btn')\n          : null;\n        break;\n      case 'mouseleave':\n        const showBtn = element.querySelector('#show-save-search-result-btn');\n        showBtn\n          ? showBtn.setAttribute('id', 'hide-save-search-result-btn')\n          : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\n  <ng-template #groupTemplate ngFor let-group [ngForOf]=\"results$ | async\">\n    <igo-collapsible\n      [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\"\n    >\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\"\n        >\n          <ng-container\n            igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{ result: result }\"\n          >\n          </ng-container>\n        </igo-search-results-item>\n      </ng-template>\n      <span\n        class=\"moreResults mat-typography\"\n        *ngIf=\"isMoreResults(group)\"\n        (click)=\"displayMoreResults(group)\"\n      >\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n  </ng-template>\n</igo-list>\n\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\n  <ng-container\n    *ngIf=\"\n      mode === searchResultMode.Grouped;\n      then tabsTemplate;\n      else flatTemplate\n    \"\n  ></ng-container>\n\n  <ng-template #tabsTemplate>\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\n      <mat-tab\n        *ngFor=\"let group of results$ | async\"\n        [label]=\"computeGroupTitle(group)\"\n      >\n        <ng-container\n          *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n        ></ng-container>\n      </mat-tab>\n    </mat-tab-group>\n  </ng-template>\n\n  <ng-template #flatTemplate>\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\n      <ng-container\n        *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n      ></ng-container>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #storeItemTemplate let-group=\"group\">\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [map]=\"map\"\n        [result]=\"result\"\n        [showIcons]=\"showIcons\"\n        [withZoomButton]=\"withZoomButton\"\n        [focused]=\"store.state.get(result).focused\"\n        [selected]=\"store.state.get(result).selected\"\n        (focus)=\"resultFocus.emit(result)\"\n        (unfocus)=\"resultUnfocus.emit(result)\"\n        (select)=\"onResultSelect(result)\"\n        (mouseenter)=\"resultFocus.emit(result)\"\n        (mouseleave)=\"resultUnfocus.emit(result)\"\n      >\n        <ng-container\n          igoSearchItemToolbar\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\n          [ngTemplateOutletContext]=\"{ result: result }\"\n        >\n        </ng-container>\n      </igo-search-results-item>\n    </ng-template>\n    <span\n      class=\"moreResults mat-typography\"\n      *ngIf=\"isMoreResults(group)\"\n      (click)=\"displayMoreResults(group)\"\n    >\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n    </span>\n  </ng-template>\n</igo-list>\n","import { AsyncPipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChild,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\nimport {\n  EntityState,\n  EntityStore,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreWatcher\n} from '@igo2/common/entity';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, EMPTY, Observable, Subscription, timer } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { Research, SearchResult } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSource } from '../shared/sources/source';\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchResultsItemComponent } from './search-results-item.component';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    ListComponent,\n    NgFor,\n    CollapsibleComponent,\n    NgTemplateOutlet,\n    SearchResultsItemComponent,\n    ListItemDirective,\n    MatTabsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  private showResultsCount: boolean = true;\n\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: { sourceId: string }[] = [];\n\n  public collapsed: { sourceId: string }[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * To check if the view for tabsMode for search-result-tools\n   */\n  @Input() tabsMode: boolean = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {})\n  templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  >;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private searchService: SearchService,\n    private configService: ConfigService\n  ) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n\n    if (\n      this.configService.getConfig('searchSources.showResultsCount') === false\n    ) {\n      this.showResultsCount = false;\n    }\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {\n    source: SearchSource;\n    results: SearchResult[];\n  }): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1 && this.showResultsCount) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, { focused: true, selected: true }, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n  private liftResults(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    return this.store.stateView.all$().pipe(\n      debounce((results: { entity: SearchResult; state: EntityState }[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: { entity: SearchResult; state: EntityState }[]) => {\n        return this.groupResults(\n          results.map((r) => r.entity).sort(this.sortByOrder)\n        );\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(\n    results: SearchResult[]\n  ): { source: SearchSource; results: SearchResult[] }[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return { source, results: grouped.get(source) };\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const stategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    const active = stategy?.active || false;\n    if (!active) {\n      return (\n        group.results &&\n        group.results[group.results.length - 1].meta.nextPage === true\n      );\n    } else {\n      return (\n        group.results?.length % +group.source.params.limit === 0 &&\n        +group.source.params.page < 30\n      );\n    }\n  }\n\n  displayMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (\n      this.termSplitter &&\n      this.term.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map((research) => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({ research, results: newResults });\n      });\n    });\n    return;\n  }\n}\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\"\n  >\n    <mat-icon>arrow_drop_down</mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\"\n  >\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\"\n    >\n      <mat-radio-button\n        *ngFor=\"let searchType of searchTypes\"\n        [value]=\"searchType\"\n      >\n        {{ getSearchTypeTitle(searchType) | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SEARCH_TYPES } from '../shared/search.enums';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatIconModule,\n    MatRadioModule,\n    NgFor,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n}\n","<div class=\"igo-search-settings\">\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\"\n  >\n    <mat-icon>expand_more</mat-icon>\n  </button>\n  <mat-menu #searchSettingsMenu=\"matMenu\" class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length > 4\">\n      <button mat-raised-button (click)=\"checkUncheckAllSources($event)\">\n        {{\n          !searchSourcesAllEnabled\n            ? ('igo.geo.search.searchSources.unselectAll' | translate)\n            : ('igo.geo.search.searchSources.selectAll' | translate)\n        }}\n      </button>\n    </div>\n    <ng-container *ngFor=\"let source of getSearchSources()\">\n      <span class=\"igo-search-settings-search-source\">\n        <mat-checkbox\n          class=\"igo-search-settings-checkbox\"\n          [checked]=\"source.enabled\"\n          [value]=\"$any(source)\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"onCheckSearchSource($event, source)\"\n        >\n        </mat-checkbox>\n        <button\n          *ngIf=\"source.settings.length > 0\"\n          [matMenuTriggerFor]=\"sub_menu\"\n          mat-menu-item\n        >\n          {{ source.title }}\n        </button>\n        <button mat-menu-item *ngIf=\"source.settings.length === 0\">\n          {{ source.title }}\n        </button>\n      </span>\n      <mat-menu #sub_menu=\"matMenu\">\n        <ng-container *ngFor=\"let setting of source.settings\">\n          <button mat-menu-item [matMenuTriggerFor]=\"test_sub_menu\">\n            {{\n              'igo.geo.search.searchSources.settings.' + setting.title\n                | translate\n            }}\n          </button>\n          <mat-menu\n            #test_sub_menu=\"matMenu\"\n            [ngSwitch]=\"setting.type\"\n            yPosition=\"above\"\n          >\n            <span *ngSwitchCase=\"'radiobutton'\">\n              <mat-radio-group\n                class=\"igo-search-settings-radio-group\"\n                [value]=\"setting\"\n              >\n                <mat-radio-button\n                  *ngFor=\"let settingValue of setting.values\"\n                  class=\"mat-typography\"\n                  [value]=\"settingValue\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  [checked]=\"settingValue.enabled\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedRadioButton(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-radio-button>\n              </mat-radio-group>\n            </span>\n            <span *ngSwitchCase=\"'checkbox'\">\n              <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                <button\n                  mat-raised-button\n                  (click)=\"checkUncheckAll($event, source, setting)\"\n                >\n                  {{\n                    setting.allEnabled || setting.allEnabled === undefined\n                      ? ('igo.geo.search.searchSources.settings.unselectAll'\n                        | translate)\n                      : ('igo.geo.search.searchSources.settings.selectAll'\n                        | translate)\n                  }}\n                </button>\n              </div>\n              <div\n                class=\"igo-search-settings-sub-menu\"\n                mat-menu-item\n                *ngFor=\"let settingValue of getAvailableValues(setting)\"\n              >\n                <mat-checkbox\n                  [style.display]=\"displayBlock\"\n                  [checked]=\"settingValue.enabled\"\n                  [value]=\"$any(setting)\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedCheckbox(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-checkbox>\n              </div>\n            </span>\n          </mat-menu>\n        </ng-container>\n      </mat-menu>\n    </ng-container>\n    <mat-divider></mat-divider>\n    <span class=\"pointer-summary-slide-toggle-container\">\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changePointerReverseSearch($event)\"\n          tooltip-position=\"below\"\n          *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.pointerSearchSummary.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"pointerSummaryEnabled\"\n        >\n          {{ 'igo.geo.search.pointerSearchSummary.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changeSearchResultsGeometry($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.searchResultsGeometry.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"searchResultsGeometryEnabled\"\n        >\n          {{ 'igo.geo.search.searchResultsGeometry.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"reverseSearchCoordsFormat($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            reverseSearchCoordsFormatEnabled\n              ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n              : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"reverseSearchCoordsFormatEnabled\"\n        >\n          {{ 'igo.geo.search.reverseCoordFormat.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n    </span>\n  </mat-menu>\n</div>\n","import { NgFor, NgIf, NgSwitch, NgSwitchCase } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  HostListener,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatCheckboxChange,\n  MatCheckboxModule\n} from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport {\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch\n} from '../shared/search.utils';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatIconModule,\n    NgIf,\n    NgFor,\n    MatCheckboxModule,\n    NgSwitch,\n    NgSwitchCase,\n    MatRadioModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ]\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource =\n      this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter(\n      (source) => !source.enabled\n    ).length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') ||\n      {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(source.getId() + '.options', storage);\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n\n  reverseSearchCoordsFormat(event) {\n    this.reverseSearchCoordsFormatEnabled = event.checked;\n    this.reverseSearchCoordsFormatStatus.emit(\n      this.reverseSearchCoordsFormatEnabled\n    );\n  }\n}\n","import {\n  AfterContentChecked,\n  Directive,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { MediaService } from '@igo2/core/media';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olgeom from 'ol/geom';\nimport { transform } from 'ol/proj';\n\nimport { Subscription, first } from 'rxjs';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research, SearchResult } from './search.interfaces';\nimport { SearchService } from './search.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]',\n  standalone: true\n})\nexport class SearchPointerSummaryDirective\n  implements OnInit, OnDestroy, AfterContentChecked\n{\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> =\n    new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string =\n    'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  @HostListener('mouseleave')\n  mouseleave() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n        this.subscribeToPointerStore();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (\n        this.store &&\n        !layers.find((l) => l.id === 'searchPointerSummaryId')\n      ) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n    if (\n      !this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      this.hasPointerReverseSearchSource = false;\n    } else {\n      this.hasPointerReverseSearchSource = true;\n    }\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map((result) => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance =\n            closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = {\n              distance: result.data.properties.distance,\n              title\n            };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = {\n            distance: result.data.properties.distance,\n            title\n          };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(\n    resultsUnderPointerPosition: SearchResult[]\n  ) {\n    const closestResultByType = this.computeSummaryClosestFeature(\n      resultsUnderPointerPosition\n    );\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map((result) => {\n      const typeIndex = summarizedClosestType.indexOf(\n        result.data.properties.type\n      );\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (\n          processedSummarizedClosestType.indexOf(\n            result.data.properties.type\n          ) === -1\n        ) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map((s) => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(\n      this.lonLat,\n      { params: { geometry: 'false', icon: 'false' } },\n      true\n    );\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          })\n        );\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore\n      .all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { Workspace } from '@igo2/common/workspace';\n\nimport { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\n    source.setWorkspaces(workspaces);\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { LAYER } from '../../layer/shared/layer.enums';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","import {\n  Inject,\n  Injectable,\n  Optional,\n  WritableSignal,\n  effect,\n  signal\n} from '@angular/core';\n\nimport { AnalyticsService } from '@igo2/core/analytics';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { stringToLonLat } from '../../map/shared/map.utils';\nimport { SearchSourceService } from './search-source.service';\nimport { Research, ReverseSearch, TextSearch } from './search.interfaces';\nimport {\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch\n} from './search.utils';\nimport { SearchSource } from './sources/source';\nimport {\n  ReverseSearchOptions,\n  TextSearchOptions\n} from './sources/source.interfaces';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable()\nexport class SearchService {\n  searchTerm: WritableSignal<string> = signal(null);\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService,\n    private storageService: StorageService,\n    private analyticsService: AnalyticsService,\n    @Inject('searchAnalytics')\n    @Optional()\n    analytics: boolean\n  ) {\n    if (analytics) {\n      this.handleAnalytics();\n    }\n  }\n\n  private handleAnalytics(): void {\n    effect(() => {\n      const term = this.searchTerm();\n      if (term != null) {\n        this.analyticsService.trackSearch(term, null);\n      }\n    });\n  }\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    this.searchTerm.set(term);\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, {\n        distance: response.radius,\n        conf: response.conf\n      });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    const reverseSearchCoordsFormat =\n      (this.storageService.get(\n        'reverseSearchCoordsFormatEnabled'\n      ) as boolean) || false;\n\n    return this.reverseSearchSources(\n      sources,\n      lonLat,\n      options || {},\n      reverseSearchCoordsFormat\n    );\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormat: boolean\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as ReverseSearch).reverseSearch(\n          lonLat,\n          options,\n          reverseSearchCoordsFormat\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchResult } from './search.interfaces';\nimport { SearchSource } from './sources/source';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (\n    (source as any).reverseSearch !== undefined &&\n    source.showInPointerSummary === true\n  );\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  if (feature.properties) {\n    delete feature.properties.geometry;\n    delete feature.properties.GEOMETRIE;\n    delete feature.properties.boundedBy;\n    delete feature.properties.shape;\n    delete feature.properties.SHAPE;\n    delete feature.properties.SHAPE_S;\n    delete feature.properties.SHAPE_L;\n    delete feature.properties.SHAPE_P;\n    delete feature.properties.the_geom;\n    delete feature.properties.geom;\n    delete feature.properties.geom32198;\n  }\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'location_on'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string) {\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(\n  from,\n  to,\n  caseSensitive: boolean = false\n): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = (totalDiff.length / termFrom.length) * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { Workspace } from '@igo2/common/workspace';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { FeatureStore } from '../../../feature/shared/store';\nimport {\n  ISearchSourceParams,\n  SearchSourceOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): ISearchSourceParams | null {\n    return this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\n    this._featureStoresWithIndex = storesWithIndex;\n  }\n  get featureStoresWithIndex() {\n    return this._featureStoresWithIndex;\n  }\n  private _featureStoresWithIndex: FeatureStore[];\n\n  setWorkspaces(workspaces: Workspace[]) {\n    if (\n      workspaces.filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n        .length >= 1\n    ) {\n      this.options.available = true;\n    } else {\n      this.options.available = false;\n    }\n    const values = [];\n    this.featureStoresWithIndex = workspaces\n      .filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n      .map((fw) => {\n        values.push({\n          title: fw.title,\n          value: fw.title,\n          enabled: true\n        });\n        return fw.entityStore as FeatureStore;\n      });\n    const datasets = this.options.settings.find((s) => s.title === 'datasets');\n    if (datasets) {\n      datasets.values = values;\n    }\n    this.setParamFromSetting(datasets);\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach((conf) => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter((s) => s.available !== false)\n          .forEach((conf) => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(this.getId() + '.options', {\n        params: this.options.params\n      });\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(\n    options: SearchSourceOptions,\n    private storageService?: StorageService\n  ) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(\n      this.getDefaultOptions(),\n      this.options\n    );\n\n    // Set Default Params from Settings\n    this.settings.forEach((setting) => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-zÀ-ÿ-+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach((hashtag) => {\n      searchSourceSetting.values.forEach((conf) => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (\n          conf.hashtags &&\n          conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1\n        ) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n","import * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function (feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","import { isValidJSON } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport * as olGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\n\nimport { StyleService } from '../../style-service/style.service';\n\nexport function featureRandomStyleFunction(): (\n  olFeature: olFeature<OlGeometry>,\n  resolution: number\n) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  return (olFeature: olFeature<OlGeometry>, resolution: number) => {\n    const customStyle = olFeature.get('_style');\n    if (customStyle && isValidJSON(customStyle)) {\n      if (\n        customStyle.circle &&\n        olFeature.get('rad') &&\n        olFeature.get('longitude') &&\n        olFeature.get('latitude')\n      ) {\n        const lonLat: [number, number] = [\n          olFeature.get('longitude'),\n          olFeature.get('latitude')\n        ];\n        const radius =\n          olFeature.get('rad') /\n          Math.cos((Math.PI / 180) * lonLat[1]) /\n          resolution;\n        customStyle.circle.radius = radius;\n      }\n      const styleService = new StyleService();\n      return styleService.createStyle(customStyle, undefined, resolution);\n    }\n    const style = new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      }),\n      text: olFeature.get('_mapTitle')\n        ? new olStyle.Text({\n            text: olFeature.get('_mapTitle').toString(),\n            offsetX: 5,\n            offsetY: -5,\n            font: '12px Calibri,sans-serif',\n            fill: new olStyle.Fill({ color: '#000' }),\n            stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n            overflow: true\n          })\n        : undefined\n    });\n    return style;\n  };\n}\n\nexport function featureRandomStyle(): olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  const style = new olStyle.Style({\n    stroke,\n    fill,\n    image: new olStyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    })\n  });\n  return style;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarkerStyle(\n  feature: olFeature<olGeom.Geometry>,\n  resolution: number\n): olStyle.Style[] {\n  const olStyleText = new olStyle.Style({\n    text: new olStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n  const olStyles = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyles.push(\n        new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 10,\n            stroke: new olStyle.Stroke({\n              color: 'blue',\n              width: 3\n            })\n          })\n        })\n      );\n      break;\n    default:\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'white',\n            width: 5\n          })\n        })\n      );\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      );\n  }\n\n  return olStyles;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarkerStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style {\n  return new olStyle.Style({\n    image: new olStyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg'\n    }),\n\n    text: new olStyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { asArray as ColorAsArray } from 'ol/color';\nimport * as olstyle from 'ol/style';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (\n    newColor.length === 4 &&\n    (typeof markerColor !== 'string' ||\n      /^#[0-9A-F]{8}$/i.test(markerColor as string))\n  ) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\n\nimport { StyleService } from '../../../style/style-service/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nexport function createOverlayLayerStyle(): (\n  olFeature: OlFeature<OlGeometry>,\n  resolution: number\n) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9]\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport RenderFeature from 'ol/render/Feature';\nimport * as olStyle from 'ol/style';\n\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olStyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(\n    options: { [key: string]: any },\n    feature?: RenderFeature | OlFeature<OlGeometry>,\n    resolution?: number\n  ) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale = options.text?.minScaleDenom\n          ? getResolutionFromScale(Number(options.text.minScaleDenom))\n          : undefined;\n        const labelMaxResolutionFromScale = options.text?.maxScaleDenom\n          ? getResolutionFromScale(Number(options.text.maxScaleDenom))\n          : undefined;\n        const minResolution = options.text?.minResolution\n          ? options.text.minResolution\n          : 0;\n        const maxResolution = options.text?.maxResolution\n          ? options.text.maxResolution\n          : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (\n        options.text?.minScaleDenom ||\n        options.text?.maxScaleDenom ||\n        options.text?.minResolution ||\n        options.text?.maxResolution\n      ) {\n        if (\n          feature &&\n          resolution >= labelMinResolution &&\n          resolution <= labelMaxResolution\n        ) {\n          if (feature && options.text.attribute) {\n            parsedStyle\n              .getText()\n              .setText(this.getLabel(feature, options.text.attribute));\n          }\n        } else {\n          parsedStyle.setText();\n        }\n      }\n    }\n    return parsedStyle;\n  }\n\n  public parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach((_key) => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olStyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olStyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olStyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    styleByAttribute: StyleByAttribute,\n    resolution: number\n  ) {\n    let style;\n    const type = styleByAttribute.type\n      ? styleByAttribute.type\n      : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label\n      ? styleByAttribute.label.attribute\n      : undefined;\n    const labelMinResolutionFromScale = styleByAttribute.label?.minScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom))\n      : undefined;\n    const labelMaxResolutionFromScale = styleByAttribute.label?.maxScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom))\n      : undefined;\n    const minResolution = styleByAttribute.label?.minResolution\n      ? styleByAttribute.label.minResolution\n      : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution\n      ? styleByAttribute.label.maxResolution\n      : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style\n      ? this.parseStyle('text', styleByAttribute.label.style)\n      : undefined;\n    if (!labelStyle && label) {\n      labelStyle = new olStyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (\n        resolution >= labelMinResolution &&\n        resolution <= labelMaxResolution\n      ) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          if (icon) {\n            style = [\n              new olStyle.Style({\n                image: new olStyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text:\n                  labelStyle instanceof olStyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              image: new olStyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olStyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olStyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: 4,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olStyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    resolution: number,\n    clusterParam: ClusterParam = {},\n    layerStyle\n  ) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olStyle.Circle;\n\n            if (r.showRange) {\n              const text = new olStyle.Text({\n                text: size.toString(),\n                fill: new olStyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: clusterRadius,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olStyle.Text({\n              text: size.toString(),\n              fill: new olStyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport { Md5 } from 'ts-md5';\n\nimport { WFSDataSourceOptions } from '../datasource/shared/datasources';\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(\n  options: DataSourceOptions\n): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  if (!options.url) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(\n  options: ArcGISRestDataSourceOptions\n) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(\n    (p) => p.length !== 0 && p.charAt(0) !== '_'\n  );\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\nimport { DirectionsComponent } from './directions.component';\n\n@NgModule({\n  imports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ]\n})\nexport class IgoDirectionsModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else {\n      // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(\n      filterString,\n      wmsDatasource.options.params.LAYERS\n    );\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            options.ogcFilters.filters,\n            options.paramsWFS.fieldNameGeometry\n          );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            // With some wms server, this param must be set to make spatials call.\n            options.ogcFilters.filters,\n            options.fieldNameGeometry\n          );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(\n          options.ogcFilters.filters,\n          undefined,\n          undefined,\n          undefined,\n          wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n  AdmRegion = 'AdmRegion',\n  Mun = 'Mun',\n  Arrond = 'Arrond',\n  CircFed = 'CircFed',\n  CircProv = 'CircProv',\n  DirReg = 'DirReg',\n  MRC = 'MRC',\n  RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n  Predefined = 'Predefined',\n  Polygon = 'Polygon',\n  Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n  Address = 'Address',\n  Thematics = 'Thematics'\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find((key) => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{\n          features: Feature[];\n        }>(this.baseUrl + this.urlFilterList[urlPath])\n        .pipe(\n          map((featureCollection) =>\n            featureCollection.features.map((f) => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach((type) => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name =\n                name.substring(0, 1).toUpperCase() +\n                name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group =\n                substr.substring(0, 1).toUpperCase() +\n                substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name =\n                  name.substring(0, 1).toUpperCase() +\n                  name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map((f) => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode, {\n            params: {\n              geometry: '100',\n              bufferOutput: buffer.toString()\n            }\n          })\n          .pipe(\n            map((f) => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map((f) => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport * as olproj from 'ol/proj';\nimport olProjection from 'ol/proj/Projection';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport {\n  OgcFilterWriter,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared';\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n  constructor(private messageService: MessageService) {}\n\n  open(layer: Layer) {\n    this.messageService.success(\n      'igo.geo.download.start',\n      'igo.geo.download.title'\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0) {\n          currentProj = paramsWFS.srsName\n            ? new olProjection({ code: paramsWFS.srsName })\n            : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined\n              ? ''\n              : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (\n          layer.dataSource.options as OgcFilterableDataSourceOptions\n        ).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter().handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj\n        );\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n          filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    options &&\n    options.download &&\n    (options.download['dynamicUrl'] || options.download['url'])\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\"\n>\n  <mat-icon>download</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            matListItemIcon\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"item.collapsed\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            >expand_less\n          </mat-icon>\n          <span matListItemTitle>{{ computeItemTitle(item) | async }} </span>\n        </mat-list-item>\n        <div\n          #legend\n          class=\"igo-layer-legend\"\n          [ngClass]=\"{ 'with-title': item.title }\"\n        >\n          <div *ngIf=\"currentStyle !== undefined\">\n            <mat-form-field>\n              <mat-select\n                tooltip-position=\"below\"\n                matTooltipShowDelay=\"500\"\n                [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n                [(ngModel)]=\"currentStyle\"\n                (selectionChange)=\"onChangeStyle()\"\n              >\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{\n                  style.title\n                }}</mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!item.collapsed\">\n            <div *ngIf=\"item.url\">\n              <img\n                igoImageError\n                *ngIf=\"item.imgGraphValue\"\n                [hideError]=\"true\"\n                #renderedLegend\n                id=\"{{ item.title }}\"\n                (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{ 'igo.geo.layer.legend.loadingLegendText' | translate }}\"\n              />\n              <small *ngIf=\"imagesHeight[item.title] < 16\">\n                {{ 'igo.geo.layer.legend.noLegendScale' | translate }}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\"\n            ></div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{ 'igo.geo.layer.legend.noLegendText' | translate }}\n    </small>\n  </ng-template>\n</ng-container>\n","import { AsyncPipe, NgClass, NgFor, NgIf, NgStyle } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChildren\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { Layer } from '../shared/layers/layer';\nimport {\n  ItemStyleOptions,\n  LegendMapViewOptions\n} from '../shared/layers/legend.interface';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    NgClass,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatTooltipModule,\n    FormsModule,\n    MatOptionModule,\n    ImageErrorDirective,\n    NgStyle,\n    AsyncPipe,\n    IgoLanguageModule,\n    SanitizeHtmlPipe\n  ]\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(\n        (style) => style.name === sourceOptions.params.STYLES\n      ).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (\n      typeof this.layer.options.legendOptions !== 'undefined' &&\n      this.layer.options.legendOptions.display === false\n    ) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(\n        this.currentStyle,\n        this.view\n      );\n    }\n\n    if (\n      this.updateLegendOnResolutionChange ||\n      (sourceOptions as WMSDataSourceOptions).contentDependentLegend\n    ) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG\n        .transform(item.url)\n        .pipe(\n          catchError((err) => {\n            if (err.error) {\n              err.error.caught = true;\n              this.getLegend = false;\n              this.cdRef.detectChanges();\n              return err;\n            }\n          })\n        )\n        .subscribe((obsLegGraph) => {\n          const idx = this.legendItems$.value.findIndex(\n            (leg) => leg.title === item.title\n          );\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n    }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(\n      (layer) => layer === layerLegend.title\n    );\n    return this.capabilitiesService.getWMSOptions(localLayerOptions).pipe(\n      map((wmsDataSourceOptions) => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      })\n    );\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(\n      this.currentStyle,\n      this.view\n    );\n    if (this.layer.legend && this.layer.legend.length > 1) {\n      legendItems = this.transfertToggleLegendItem(legendItems);\n    }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(\n          layerOptions.legendOptions.stylesAvailable.filter(\n            (sA) =>\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'default' &&\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'defaut'\n          )\n        );\n      }\n      stylesAvailable\n        .filter((sa) => !sa.title)\n        .map((sa) => (sa.title = sa.name));\n      stylesAvailable.map(\n        (s) =>\n          (s.title =\n            s.title.charAt(0).toUpperCase() +\n            s.title.slice(1).replace(/_/g, ' '))\n      );\n      return stylesAvailable;\n    }\n    return;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol\n        .getParams()\n        .LAYERS.split(',')\n        .map((layer) => (STYLES += this.currentStyle + ','));\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(\n        (renderedLegend) => renderedLegend.nativeElement.id === id\n      ).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olWKT from 'ol/format/WKT';\nimport * as olproj from 'ol/proj';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach((element) => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach((element) => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: { ul?: any; lr?: any; ur?: any; ll?: any } = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [coord.ul[0] + unitPerTypeEW, coord.ul[1] - unitPerTypeSN];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { default as moment } from 'moment';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n  readonly defaultStepMillisecond = 60000;\n\n  constructor() {}\n\n  step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n  }\n\n  stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n    const step = moment\n      .duration(this.step(dataSource, currentFilter))\n      .asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  stepIsYearDuration(step: string) {\n    const year = moment.duration(step);\n    return (\n      year.years() !== 0 &&\n      year.months() === 0 &&\n      year.weeks() === 0 &&\n      year.days() === 0 &&\n      year.hours() === 0 &&\n      year.minutes() === 0\n    );\n  }\n\n  stepIsMonthDuration(step: string) {\n    const month = moment.duration(step);\n    return (\n      month.months() !== 0 &&\n      month.weeks() === 0 &&\n      month.days() === 0 &&\n      month.hours() === 0 &&\n      month.minutes() === 0\n    );\n  }\n\n  stepIsWeekDuration(step: string) {\n    const week = moment.duration(step);\n    return (\n      week.weeks() !== 0 &&\n      week.days() === 7 &&\n      week.hours() === 0 &&\n      week.minutes() === 0\n    );\n  }\n\n  stepIsDayDuration(step: string) {\n    const day = moment.duration(step);\n    return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n  }\n\n  stepIsHourDuration(step: string) {\n    const hour = moment.duration(step);\n    return hour.hours() !== 0 && hour.minutes() === 0;\n  }\n\n  stepIsMinuteDuration(step: string) {\n    const minute = moment.duration(step);\n    return minute.minutes() !== 0;\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate = new Date();\n    if (date) {\n      newDate = new Date(date);\n    }\n    return newDate.getTime();\n  }\n\n  public addStep(value, stepMillisecond) {\n    return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n  }\n\n  public subtractStep(value, stepMillisecond) {\n    return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n  }\n}\n","import {\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSlider, MatSliderModule } from '@angular/material/slider';\n\nimport { default as moment } from 'moment';\n\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss'],\n  standalone: true,\n  imports: [MatSliderModule, FormsModule, MatButtonModule, MatIconModule],\n  providers: [OGCFilterTimeService]\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play_circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat) {\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(\n      this.datasource,\n      this.currentFilter\n    );\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit() {\n    this.calculateStep();\n    this.handleSliderInput({ value: 1 });\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(\n      this.beginMillisecond + (value - 1) * this.stepMillisecond\n    );\n\n    if (\n      this.ogcFilterTimeService.stepIsYearDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .years();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'year')\n        .toDate();\n    } else if (\n      this.ogcFilterTimeService.stepIsMonthDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .months();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'month')\n        .toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        (that) => {\n          if (this.slider.step < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n    this.slider.step = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n      if (\n        this.ogcFilterTimeService.stepIsYearDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .years();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'year')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsMonthDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .months();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'month')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsDayDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsHourDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsMinuteDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const dateTmp = new Date(\n          this.beginMillisecond +\n            this.stepMillisecond * (matSliderChange.value - 1)\n        );\n        this.changeProperty.next({\n          value: dateTmp.toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: new Date(\n            this.ogcFilterTimeService.addStep(\n              dateTmp.toISOString(),\n              this.stepMillisecond\n            )\n          ).toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      }\n    }\n  }\n\n  calculateStep() {\n    for (\n      let i = 1;\n      this.maxMillisecond -\n        (this.beginMillisecond + i * this.stepMillisecond) >=\n      -1;\n      i++\n    ) {\n      this.calculatedStep = i;\n    }\n  }\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    thumbLabel\n    #ngSlider\n    ><input\n      matSliderThumb\n      (input)=\"\n        handleSliderInput({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon>{{ playIcon }}</mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon>{{ resetIcon }}</mat-icon>\n  </button>\n</div>\n","<div class=\"datetime-container\">\n  <mat-slide-toggle\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\"\n  >\n    {{ 'igo.geo.filter.sliderModeTitle' | translate }}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\"\n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.startYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearBegin }}\"\n          (change)=\"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"beginDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #beginYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"\n            endValue && !restrictedToStep()\n              ? endValue\n              : handleDate(datasource.options.maxDate)\n          \"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.endYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearEnd }}\"\n          (change)=\"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"endDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #endYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"endValue ? endValue : handleDate(datasource.options.maxDate)\"\n          [min]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n        />\n      </mat-form-field>\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon>{{ resetIcon }}</mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType() !== 'year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"beginDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"\n              endValue && !restrictedToStep()\n                ? endValue\n                : handleDate(datasource.options.maxDate)\n            \"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option\n                *ngFor=\"let minute of beginMinutes\"\n                [value]=\"minute\"\n                >{{ minute }}</mat-option\n              >\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div *ngIf=\"!restrictedToStep()\" class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"endDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #end\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n            [matDatepickerFilter]=\"filterEndFunction\"\n            [value]=\"\n              endValue ? endValue : handleDate(datasource.options.maxDate)\n            \"\n            [min]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [max]=\"handleDate(datasource.options.maxDate)\"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{\n                minute\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon>{{ resetIcon }}</mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n  </div>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { provideMomentDateAdapter } from '@angular/material-moment-adapter';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { default as moment } from 'moment';\n\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterDuringOptions,\n  OgcFilterableDataSource,\n  OgcFilterableDataSourceOptions\n} from '../shared/ogc-filter.interface';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time-slider.component';\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatSlideToggleModule,\n    FormsModule,\n    OgcFilterTimeSliderComponent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatSelectModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    IgoLanguageModule\n  ],\n  providers: [OGCFilterTimeService, provideMomentDateAdapter()]\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new UntypedFormControl();\n  beginMinuteFormControl = new UntypedFormControl();\n  endHourFormControl = new UntypedFormControl();\n  endMinuteFormControl = new UntypedFormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  private filterOriginConfig: OgcFilterDuringOptions;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate\n      ? this.datasource.options.maxDate\n      : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat\n      ? this.currentFilter.displayFormat\n      : this._defaultDisplayFormat;\n  }\n\n  public filterBeginFunction;\n  public filterEndFunction;\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit() {\n    this.filterOriginConfig = this.datasource.options.ogcFilters\n      .filters as OgcFilterDuringOptions;\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled =\n        this.currentFilter.sliderOptions.enabled !== undefined\n          ? this.currentFilter.sliderOptions.enabled\n          : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    this.dateFilter(this.filterBeginFunction, 'begin');\n    this.dateFilter(this.filterEndFunction, 'end');\n  }\n\n  parseFilter(filter): Date {\n    if (!filter) {\n      return new Date();\n    } else if (isNaN(new Date(filter).getTime())) {\n      if (filter.search('now') >= 0) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0) {\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('+') + 1, interval.index),\n            10\n          );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('-') + 1, interval.index),\n            10\n          );\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(\n    value: string | Date,\n    position?,\n    refreshFilter = true\n  ) {\n    if (typeof value === 'string') {\n      value = new Date(value);\n    }\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-12-31`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({\n        value: dateStringFromYearNotime,\n        pos: position,\n        refreshFilter\n      });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(\n          this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds),\n          2,\n          refreshFilter\n        );\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({\n      value: valueTmp.toISOString(),\n      pos: position,\n      refreshFilter\n    });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof value === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(\n    year,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (\n        property === 'begin' &&\n        this.restrictedToStep() &&\n        !this.calendarTypeYear\n      ) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        year,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  monthSelected(\n    month,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        month,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  calendarView(): 'month' | 'year' | 'multi-year' {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock' as any;\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string) {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'years',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'years',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asYears() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asYears() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'months',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'months',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asMonths() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asMonths() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'weeks',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'weeks',\n          true\n        );\n        this.filterEndFunction =\n          weekDiffPlus1 % moment.duration(this.step).asWeeks() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          weekDiff % moment.duration(this.step).asWeeks() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'days',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'days',\n          true\n        );\n        const _mod = dayDiffPlus1 % moment.duration(this.step).asDays();\n        this.filterEndFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      } else if (type === 'begin') {\n        const _mod = (dayDiff % moment.duration(this.step).asDays()) + 1;\n        this.filterBeginFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      if (type === 'end') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterEndFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      } else if (type === 'begin') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterBeginFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (type === 'end') {\n        this.filterEndFunction = true;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction = true;\n        return;\n      }\n    }\n\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\n    return;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.beginHourFormControl.value,\n              this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60\n          ? 1\n          : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep\n      : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin\n      ? this.currentFilter.begin\n      : this.datasource.options.minDate\n        ? this.datasource.options.minDate\n        : this._defaultMin;\n  }\n\n  public handleMax() {\n    return this.currentFilter.end\n      ? this.currentFilter.end\n      : this.datasource.options.maxDate\n        ? this.datasource.options.maxDate\n        : this._defaultMax;\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if (this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n      const dateItems = stringDate.split('-');\n      if (dateItems.length !== 3) {\n        throw new Error(\n          'Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY'\n        );\n      } else {\n        year = dateItems[0];\n        month = dateItems[1];\n        day = dateItems[2];\n      }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (this.filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0, 4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${this.filterOriginConfig.end.substring(0, 4)}-01-01`;\n      }\n      minDefaultISOString = `${this.filterOriginConfig.begin.substring(0, 4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(this.filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(this.filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if (\n      this.currentFilter.begin !== minDefaultISOString ||\n      this.currentFilter.end !== maxDefaultISOString\n    ) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","<div class=\"ogc-filter-form-container\">\n  <mat-checkbox\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n    (click)=\"$event.stopPropagation()\"\n    (change)=\"toggleFilterState($event)\"\n    [checked]=\"currentFilter.active\"\n  >\n  </mat-checkbox>\n\n  <mat-form-field\n    [ngClass]=\"{\n      logical:\n        activeFilters.indexOf(currentFilter) !== 0 &&\n        currentFilter.active === true,\n      logicalHidden:\n        activeFilters.indexOf(currentFilter) === 0 ||\n        currentFilter.active !== true\n    }\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.parentLogical\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.parentLogical\n          ? ('igo.geo.operators.tooltip.' + currentFilter.parentLogical\n            | translate)\n          : ''\n      \"\n      (selectionChange)=\"changeLogical($event.value)\"\n    >\n      <mat-option\n        [value]=\"ogcFilterOperator.And\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\"\n      >\n        {{ 'igo.geo.operators.And' | translate }}\n      </mat-option>\n      <mat-option\n        [value]=\"ogcFilterOperator.Or\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\"\n      >\n        {{ 'igo.geo.operators.Or' | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"field\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) === false &&\n      (fields$ | async) &&\n      (fields$ | async).length > 0 &&\n      (fields$ | async)[0].name !== ''\n    \"\n    (mouseenter)=\"inputClearable = 'selectField'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteField\"\n      [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        (selectedField$ | async)\n          ? (selectedField$ | async).alias\n          : ('igo.geo.sourceFields.selectField' | translate)\n      \"\n      (input)=\"updateFieldsList($any($event.target).value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteField=\"matAutocomplete\"\n      (optionSelected)=\"changeField($event.option.id)\"\n    >\n      <mat-option\n        *ngFor=\"let field of filteredFields$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"field.alias\"\n        [id]=\"field.name\"\n        [matTooltip]=\"field.alias\"\n      >\n        {{ field.alias }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        currentFilter.propertyName &&\n        inputClearable === 'selectField' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearSelectedField()\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    [ngClass]=\"{\n      operator: (currentFilterIsSpatial$ | async) === false,\n      dualInput: (currentFilterIsSpatial$ | async)\n    }\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <mat-select\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.operator\n          ? ('igo.geo.operators.tooltip.' + currentFilter.operator | translate)\n          : ('igo.geo.filter.selectOperator' | translate)\n      \"\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.operator\"\n      (selectionChange)=\"changeOperator($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let operator of ogcFilterOperators$ | async | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.' + operator.key | translate\"\n      >\n        {{ 'igo.geo.operators.' + operator.key | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"spatialSelector\"\n    *ngIf=\"currentFilterIsSpatial$ | async\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.igoSpatialSelector\"\n      (selectionChange)=\"changeSpatialSelector($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\"\n      >\n        {{ 'igo.geo.spatialSelector.' + igoSpatialSelector.type | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"singleInput\"\n    *ngIf=\"['expression', 'pattern'].indexOf(detectProperty()) !== -1\"\n    (mouseenter)=\"inputClearable = 'selectProperty'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteValues\"\n      [value]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression\n          : currentFilter.pattern\n      \"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression || ''\n          : currentFilter.pattern || ''\n      \"\n      (input)=\"updateValuesList($any($event.target).value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteValues=\"matAutocomplete\"\n      (optionSelected)=\"changeProperty($event.option.value)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable() &&\n        inputClearable === 'selectProperty' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty()\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <div class=\"igo-layer-button-group\">\n    <button\n      mat-icon-button\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n      color=\"warn\"\n      (click)=\"deleteFilter()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n  </div>\n\n  <mat-form-field\n    class=\"snrc\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'snrc'\n    \"\n    (mouseenter)=\"inputClearable = 'selectSNRC'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n      [value]=\"currentFilter.igoSNRC\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n      (input)=\"changeSNRC($any($event.target).value)\"\n    />\n    <button\n      *ngIf=\"currentFilter.igoSNRC\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"\n        !currentFilter.active &&\n        inputClearable === 'selectSNRC' &&\n        currentFilter.active\n      \"\n      (click)=\"currentFilter.igoSNRC = ''\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <ng-container\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'fixedExtent'\n    \"\n  >\n    <button\n      [disabled]=\"!currentFilter.active\"\n      *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n      matSuffix\n      mat-icon-button\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"changeMapExtentGeometry()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\"\n    >\n      <mat-icon>zoom_out_map</mat-icon>\n    </button>\n  </ng-container>\n</div>\n\n<div class=\"ogc-filter-form-container\">\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['lowerBoundary', 'begin'].indexOf(detectProperty(1)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty1'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(1) === 'lowerBoundary'\n          ? currentFilter.lowerBoundary\n          : currentFilter.begin\n      \"\n      (input)=\"updateValuesList($any($event.target).value, 1)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 1)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(1) &&\n        inputClearable === 'selectProperty1' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['upperBoundary', 'end'].indexOf(detectProperty(2)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty2'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(2) === 'upperBoundary'\n          ? currentFilter.upperBoundary\n          : currentFilter.end\n      \"\n      (input)=\"updateValuesList($any($event.target).value, 2)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 2)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(2) &&\n        inputClearable === 'selectProperty2' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n</div>\n\n<igo-ogc-filter-time\n  *ngIf=\"isTemporalOperator()\"\n  [datasource]=\"datasource\"\n  [currentFilter]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n>\n</igo-ogc-filter-time>\n","import { AsyncPipe, KeyValuePipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  FloatLabelType,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { MapBase } from '../../map';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { OgcFilterTimeComponent } from '../ogc-filter-time/ogc-filter-time.component';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss'],\n  standalone: true,\n  imports: [\n    MatCheckboxModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    NgClass,\n    MatSelectModule,\n    MatOptionModule,\n    NgIf,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatButtonModule,\n    MatIconModule,\n    OgcFilterTimeComponent,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType;\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n          ? of(this.selectedField$.value.values)\n          : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .replace(/[.*+?^${}()|[\\]\\\\]/g, '')\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n\n    return this.selectedField$.value?.values?.filter(\n      (val) =>\n        val &&\n        keywordRegex.test(\n          val\n            .toString()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n        )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n            ? 'upperBoundary'\n            : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n            ? 'end'\n            : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n  constructor(private http: HttpClient) {}\n\n  async getDomValuesFromURL(domOptions: DOMOptions): Promise<DOMValue[]> {\n    const url = domOptions.url;\n    let result: DOMValue[];\n\n    await this.http\n      .get<any>(url)\n      .pipe(\n        map((response) => {\n          result = response;\n          return response;\n        }),\n        catchError((err: HttpErrorResponse) => {\n          return throwError(err);\n        })\n      )\n      .toPromise();\n\n    return result;\n  }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div\n      class=\"pushButtonGroups\"\n      *ngIf=\"selector.selectorType === 'pushButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\"\n          class=\"mat-typography\"\n          appearance=\"legacy\"\n          vertical=\"{{ bundleIsVertical(bundle) }}\"\n          multiple=\"true\"\n        >\n          <mat-button-toggle\n            *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\"\n            (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\"\n            >{{ ogcPushButton.title }}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox\n            *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\"\n            (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\"\n            >{{ ogcCheckbox.title }}\n          </mat-checkbox>\n        </div>\n        <p\n          *ngIf=\"\n            isLessResults(bundle, 'checkbox') ||\n            isMoreResults(bundle, 'checkbox')\n          \"\n        >\n          <u\n            *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u\n            *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"radioButtonGroups\"\n      *ngIf=\"selector.selectorType === 'radioButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-radio-group formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button\n            *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\"\n            >{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button\n            *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\"\n            (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\"\n            >{{ ogcRadioButton.title }}\n          </mat-radio-button>\n          <p\n            *ngIf=\"\n              isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\n            \"\n          >\n            <u\n              *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\"\n              >{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u\n              *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\"\n              >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\"\n          >\n            <mat-icon>filter_alt_off</mat-icon>\n          </mat-button>\n          <mat-form-field\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection\n                [multiple]=\"bundle.multiple\"\n                [placeholder]=\"bundle.title\"\n                formControlName=\"selectMulti\"\n              >\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox\n                    *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\"\n                    [ngModelOptions]=\"{ standalone: true }\"\n                    (change)=\"toggleAllSelection()\"\n                    >Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle, $event)\n                  \"\n                  [value]=\"ogcSelect\"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle)\n                  \"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"autocompleteGroups\"\n      *ngIf=\"selector.selectorType === 'autocomplete'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\"\n          >\n            <mat-option\n              *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\"\n              >{{ autocompleteGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\"\n          >\n            <mat-icon>filter_alt_off</mat-icon>\n          </mat-button>\n          <mat-form-field\n            *ngIf=\"filteredOgcAutocomplete[bundle.id]\"\n            floatLabel=\"always\"\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <mat-label>{{ bundle.title }}</mat-label>\n            <mat-chip-set\n              *ngIf=\"\n                filteredOgcAutocomplete[bundle.id] && (bundle.showChips ?? true)\n              \"\n            >\n              <mat-chip\n                *ngFor=\"let autocompleteEnabled of autocompleteEnableds\"\n                (removed)=\"toggleSelection(autocompleteEnabled)\"\n              >\n                {{ autocompleteEnabled }}\n                <button\n                  matChipRemove\n                  [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n                >\n                  <mat-icon>cancel</mat-icon>\n                </button>\n              </mat-chip>\n            </mat-chip-set>\n            <input\n              matInput\n              type=\"text\"\n              formControlName=\"autocomplete\"\n              #input\n              [matAutocomplete]=\"auto\"\n              (input)=\"onInputChange()\"\n            />\n            <mat-autocomplete #auto=\"matAutocomplete\" [displayWith]=\"displayFn\">\n              <mat-option\n                *ngFor=\"\n                  let ogcAutocomplete of filteredOgcAutocomplete[bundle.id]\n                    | async\n                \"\n                id=\"mat-option\"\n                [matTooltip]=\"getToolTip(ogcAutocomplete)\"\n              >\n                <div\n                  (click)=\"\n                    toggleAutocompleteOption($event, ogcAutocomplete.value)\n                  \"\n                >\n                  <mat-checkbox\n                    id=\"mat-checkbox\"\n                    color=\"primary\"\n                    [checked]=\"checkedStatus(ogcAutocomplete.value)\"\n                    (click)=\"\n                      toggleAutocompleteOption($event, ogcAutocomplete.value)\n                    \"\n                  >\n                  </mat-checkbox>\n                  {{ ogcAutocomplete.value }}\n                </div>\n              </mat-option>\n            </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h3 *ngIf=\"!currentFilter.title\">\n    {{ 'igo.geo.filter.reportingDate' | translate }}\n  </h3>\n  <h3 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h3>\n  <igo-ogc-filter-time\n    [datasource]=\"datasource\"\n    [currentFilter]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n  >\n  </igo-ogc-filter-time>\n</div>\n","import { AsyncPipe, NgFor, NgIf, NgStyle } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport {\n  MatAutocompleteModule,\n  MatAutocompleteTrigger\n} from '@angular/material/autocomplete';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatOption, MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelect, MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { DOMOptions, DOMService, DOMValue } from '@igo2/common/dom';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable, Subject, of } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport {\n  IgoOgcFilterObject,\n  OgcAutocomplete,\n  OgcFilterableDataSource,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n} from '../../filter/shared/ogc-filter.interface';\nimport { MapBase } from '../../map';\nimport { OgcFilterTimeComponent } from '../ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [DOMService],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    NgFor,\n    NgIf,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatOptionModule,\n    MatButtonToggleModule,\n    NgStyle,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatIconModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    OgcFilterTimeComponent,\n    AsyncPipe,\n    IgoLanguageModule,\n    MatChipsModule\n  ]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n  @ViewChild('selection') sel: MatSelect;\n  @ViewChild(MatAutocompleteTrigger, { read: MatAutocompleteTrigger })\n  matAutocomplete: MatAutocompleteTrigger;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n  private inputChangeAutocomplete = new Subject<void>();\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: UntypedFormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnableds$ = new BehaviorSubject<string[]>([]);\n  public filteredOgcAutocomplete: { [key: string]: Observable<any[]> } = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value === selector\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value.includes(selector)\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnableds() {\n    return this.autocompleteEnableds$.value;\n  }\n\n  // Updates the currentAutocompleteGroup and applies filters\n  set autocompleteEnableds(filterList) {\n    this.autocompleteEnableds$.next(filterList);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        selector.enabled = false;\n        for (const filter of filterList) {\n          if (filter === selector.title) {\n            selector.enabled = true;\n          }\n        }\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  // Indicates the checked status of autocomplete checkboxes\n  checkedStatus(autocompleteFilter: string): boolean {\n    return this.autocompleteEnableds.includes(autocompleteFilter);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: UntypedFormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: [''],\n      radioButtons: [''],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: [''],\n      selectMulti: [''],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['']\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.select.groups[0];\n        this.initSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.initAutocompleteEnableds();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n      .get('pushButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onPushButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('checkboxesGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onCheckboxesChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n\n    // Debounce time for autocomplete filter options - value chosen arbitrarily\n    this.inputChangeAutocomplete.pipe().subscribe(() => {\n      this.getAutocompleteDomValues();\n    });\n  }\n\n  private initSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private initAutocompleteEnableds() {\n    let enabled = [];\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled.push(selector.title);\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnableds = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig<DOMOptions[]>(\n            'dom'\n          )) {\n            if (\n              domSelector.id === domOptions.id ||\n              domSelector.name === domOptions.name\n            ) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDomValuesFromURL(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find((sel) => sel.title === value.value)\n                  ? (enabled = true)\n                  : (enabled = false);\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled:\n                    this.selectEnabled?.title === value.value ? true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups()\n              .find((group) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (comp) => comp.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n        this.initSelectEnabled();\n      }\n    }\n  }\n\n  // Trigger filter refresh (with debounce)\n  onInputChange() {\n    this.inputChangeAutocomplete.next();\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete\n      .bundles) {\n      if (bundle.domSelectors) {\n        let domValues: DOMValue[];\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM: DOMOptions;\n          for (const configDom of this.configService.getConfig<DOMOptions[]>(\n            'dom'\n          )) {\n            if (\n              domSelector.id === configDom.id ||\n              domSelector.name === configDom.name\n            ) {\n              filterDOM = {\n                id: configDom.id,\n                url: configDom.url,\n                name: configDom.name,\n                values: configDom.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDomValuesFromURL(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle: OgcSelectorBundle = bundle;\n            newBundle.selectors = [];\n            let selector: OgcAutocomplete;\n            for (const domValue of domValues) {\n              selector = {\n                title: domValue.id as string,\n                enabled: this.autocompleteEnableds?.includes(domValue.value)\n                  ? true\n                  : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: domValue.value\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups()\n              .find((group: SelectorGroup) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (computedSelector) => computedSelector.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = of(domValues);\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map((group) => (group.enabled = false));\n    this.getPushButtonsGroups().find(\n      (group) => group === this.currentPushButtonsGroup\n    ).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map((group) => (group.enabled = false));\n    this.getCheckboxesGroups().find(\n      (group) => group === this.currentCheckboxesGroup\n    ).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map((group) => (group.enabled = false));\n    this.getRadioButtonsGroups().find(\n      (group) => group === this.currentRadioButtonsGroup\n    ).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map((group) => (group.enabled = false));\n    this.getSelectGroups().find(\n      (group) => group === this.currentSelectGroup\n    ).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map((group) => (group.enabled = false));\n    this.getAutocompleteGroups().find(\n      (group) => group === this.currentAutocompleteGroup\n    ).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors.map((selector) => (selector.enabled = false));\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n    });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnableds = [];\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n        compSelect.selectors?.forEach((selector) => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  toggleAutocompleteOption(event: Event, toggledFilter: string) {\n    event.stopPropagation();\n    this.toggleSelection(toggledFilter);\n  }\n\n  toggleSelection(toggledFilter: string) {\n    if (this.autocompleteEnableds.includes(toggledFilter)) {\n      this.autocompleteEnableds = this.autocompleteEnableds.filter(\n        (enabledFilter) => enabledFilter !== toggledFilter\n      );\n    } else {\n      this.autocompleteEnableds = [...this.autocompleteEnableds, toggledFilter];\n    }\n  }\n\n  // Value displayed in the autocomplete input box\n  displayFn(): string {\n    return '';\n  }\n\n  // Applies filters based on the current group of all filter selection types\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [\n      this.currentPushButtonsGroup,\n      this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup,\n      this.currentSelectGroup,\n      this.currentAutocompleteGroup\n    ];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map((selectorBundle) => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n            ?.filter((ogcSelector) => ogcSelector.enabled === true)\n            .forEach((enabledSelector) =>\n              bundleCondition.push(enabledSelector.filters)\n            );\n          if (bundleCondition.length >= 1) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({\n                logical: selectorBundle.logical,\n                filters: bundleCondition\n              });\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(\n        this.datasource.options.ogcFilters.interfaceOgcFilters[0]\n      );\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter.buildFilter(\n        conditions.length === 1\n          ? conditions[0]\n          : ({ logical: 'And', filters: conditions } as IgoOgcFilterObject)\n      );\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(\n        this.datasource as WMSDataSource,\n        filterQueryString\n      );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex += 5)\n      : (this.checkboxesIndex += 5);\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex = this.baseIndex)\n      : (this.checkboxesIndex = this.baseIndex);\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (filter) => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n            ? 'upperBoundary'\n            : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n            ? 'end'\n            : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\"\n>\n</igo-ogc-filter-selection>\n\n<ng-template\n  *ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\n  ngFor\n  let-currentFilter\n  [ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\"\n>\n  <igo-ogc-filter-form\n    [currentFilter]=\"currentFilter\"\n    [refreshFilters]=\"refreshFunc\"\n    [datasource]=\"datasource\"\n    [map]=\"map\"\n  >\n  </igo-ogc-filter-form>\n</ng-template>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MAT_AUTOCOMPLETE_DEFAULT_OPTIONS } from '@angular/material/autocomplete';\nimport { MAT_SELECT_CONFIG } from '@angular/material/select';\n\nimport { ListItemDirective } from '@igo2/common/list';\n\nimport { MapBase } from '../../map';\nimport { OgcFilterFormComponent } from '../ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterSelectionComponent } from '../ogc-filter-selection/ogc-filter-selection.component';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html',\n  styles: ['::ng-deep.igo-overlay-panel-width { min-width: fit-content;}'],\n  providers: [\n    {\n      provide: MAT_SELECT_CONFIG,\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\n    },\n    {\n      provide: MAT_AUTOCOMPLETE_DEFAULT_OPTIONS,\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\n    }\n  ],\n  standalone: true,\n  imports: [\n    NgIf,\n    OgcFilterSelectionComponent,\n    ListItemDirective,\n    NgFor,\n    OgcFilterFormComponent\n  ]\n})\nexport class OgcFilterableFormComponent {\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters\n      ? this.datasource.options.ogcFilters.interfaceOgcFilters[0]\n      : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<div [ngClass]=\"{ 'separate-item': header === true }\">\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      matListItemIcon\n      igoCollapse\n      [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      >expand_less\n    </mat-icon>\n    <span\n      *ngIf=\"header\"\n      matListItemTitle\n      [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n      [matTooltip]=\"layer.title\"\n      matTooltipShowDelay=\"500\"\n      (click)=\"toggleLegendOnClick()\"\n    >\n      {{ layer.title }}\n    </span>\n    <div matListItemMeta>\n      <button\n        *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\"\n        [disabled]=\"addFilterDisabled()\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\"\n        [color]=\"color\"\n        (click)=\"addFilterToSequence()\"\n      >\n        <mat-icon>add</mat-icon>\n      </button>\n      <button\n        *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"\n          layer.visible\n            ? ('igo.geo.layer.hideLayer' | translate)\n            : ('igo.geo.layer.showLayer' | translate)\n        \"\n        (click)=\"layer.visible = !layer.visible\"\n      >\n        <mat-icon\n          [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n          >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n        </mat-icon>\n      </button>\n    </div>\n  </mat-list-item>\n\n  <div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n    <igo-ogc-filterable-form\n      [datasource]=\"datasource\"\n      [map]=\"map\"\n      [refreshFilters]=\"refreshFunc\"\n    >\n    </igo-ogc-filterable-form>\n\n    <section\n      *ngIf=\"hasSelector && filtersAreEditable\"\n      class=\"mat-typography advancedOgcFilters\"\n    >\n      <mat-divider></mat-divider>\n      <mat-checkbox\n        (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\"\n      >\n        {{ 'igo.geo.filter.advancedOgcFilters' | translate }}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>\n","import { AsyncPipe, NgClass, NgIf, NgStyle } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map';\nimport { OgcFilterableFormComponent } from '../ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss'],\n  standalone: true,\n  imports: [\n    NgClass,\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    CollapseDirective,\n    NgStyle,\n    MatTooltipModule,\n    MatButtonModule,\n    LayerLegendComponent,\n    OgcFilterableFormComponent,\n    MatDividerModule,\n    MatCheckboxModule,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ],\n  providers: [OGCFilterService]\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: MapBase;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    if (this.layer.visible) {\n      this.filtersCollapsed = false;\n    }\n\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)\n    ) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter((f) => f.wkt_geometry).length >=\n          1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] =\n      this.datasource.options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(\n      (f) => !f.excludeFromOgcFilters\n    );\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters\n      ? ogcFilters.interfaceOgcFilters.filter((f) => f.active === true)\n      : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        (af) => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters =\n          this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters =\n            this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n              activeFilters\n            );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(\n      ogcFilters,\n      true\n    );\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<button\n  *ngIf=\"\n    header &&\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    >filter_alt</mat-icon\n  >\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n>\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\"\n  >\n  </igo-ogc-filterable-item>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map';\nimport { OgcFilterableItemComponent } from '../ogc-filterable-item/ogc-filterable-item.component';\nimport {\n  IgoOgcSelector,\n  OgcFilterableDataSourceOptions\n} from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    OgcFilterableItemComponent,\n    ListItemDirective,\n    IgoLanguageModule\n  ]\n})\nexport class OgcFilterButtonComponent implements OnInit {\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(\n            (cb) =>\n              (cntPushButtons += (cb.selectors as any)?.filter(\n                (button) => button.enabled\n              ).length)\n          );\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find((gr) => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(\n            (cb) =>\n              (cntCheckboxes += (cb.selectors as any)?.filter(\n                (checkbox) => checkbox.enabled\n              ).length)\n          );\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(\n            (cb) =>\n              (cntRadioButtons += (cb.selectors as any)?.filter(\n                (radio) => radio.enabled\n              ).length)\n          );\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find((gr) => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(\n            (cb) =>\n              (cntSelect += (cb.selectors as any)?.filter(\n                (multi) => multi.enabled\n              ).length)\n          );\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(\n            (cb) =>\n              (cntAutocomplete += (cb.selectors as any)?.filter(\n                (autocomplete) => autocomplete.enabled\n              ).length)\n          );\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (\n      filter.filters &&\n      filter.filters.operator === 'During' &&\n      filter.filters.active &&\n      filter.interfaceOgcFilters &&\n      filter.interfaceOgcFilters[0].active\n    ) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if (\n          filterActiveValue.begin.substring(0, 4) !==\n            this.options.minDate.substring(0, 4) ||\n          filterActiveValue.end.substring(0, 4) !==\n            this.options.maxDate.substring(0, 4)\n        ) {\n          cnt += 1;\n        }\n      } else if (\n        filterActiveValue.begin !== this.options.minDate ||\n        filterActiveValue.end !== this.options.maxDate\n      ) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource\n        .options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: MapBase;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource\n      .options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { TimeFilterableDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource',\n  standalone: true\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)\n    ) {\n      isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div\n    id=\"no-layer-message\"\n    *ngIf=\"(layers | filterableDataSource: 'ogc').length === 0\"\n  >\n    {{ 'igo.geo.filter.noFilterableLayer' | translate }}\n  </div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item\n      igoListItem\n      [header]=\"true\"\n      [layer]=\"layer\"\n      [map]=\"layer.map\"\n    ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import { NgFor, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map/shared/map.abstract';\nimport { OgcFilterableItemComponent } from '../ogc-filterable-item/ogc-filterable-item.component';\nimport { FilterableDataSourcePipe } from '../shared/filterable-datasource.pipe';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  styleUrls: ['./ogc-filterable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgIf,\n    NgFor,\n    OgcFilterableItemComponent,\n    ListItemDirective,\n    IgoLanguageModule,\n    FilterableDataSourcePipe\n  ]\n})\nexport class OgcFilterableListComponent {\n  @Input() layers: Layer[];\n\n  @Input() map: MapBase;\n\n  constructor() {}\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\n\n@Directive({\n  selector: '[igoOgcFilterableListBinding]',\n  standalone: true\n})\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\n  private component: OgcFilterableListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: OgcFilterableListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers.filter((layer) => layer.showInLayerList);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","export enum GeometryType {\n  Point = 'Point',\n  LineString = 'LineString',\n  Polygon = 'Polygon',\n  Circle = 'Circle'\n}\n\nexport enum LabelType {\n  Coordinates = 'Coordinates',\n  Length = 'Length',\n  Area = 'Area',\n  Predefined = 'Predefined',\n  Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n  DecimalDegree = 'DD',\n  DegreesMinutesSeconds = 'DMS'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawIconService {\n  protected icons: Array<string>;\n\n  constructor(protected config: ConfigService) {\n    this.getIconsList();\n  }\n\n  getIcons() {\n    return this.icons;\n  }\n\n  getPath(): string[] {\n    return this.config.getConfig('drawingTool.icons') || [];\n  }\n\n  getIconsList() {\n    this.icons = this.getPath();\n  }\n}\n","import OlOverlay from 'ol/Overlay';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport * as Olstyle from 'ol/style';\n\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\nimport {\n  updateOlGeometryCenter,\n  updateOlGeometryMidpoints\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit } from './draw.enum';\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(\n  fillColor?: string,\n  strokeColor?: string,\n  strokeWidth?: number,\n  label?: string\n): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(\n  olGeometry: OlLineString | OlPolygon\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: ['igo-map-tooltip', 'igo-map-tooltip-draw'].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n\nexport function DDtoDMS(\n  value: [number, number],\n  unit: CoordinatesUnit\n): string[] | undefined {\n  const conversionMapper = new Map([\n    [\n      CoordinatesUnit.DecimalDegree,\n      (val: [number, number]) => {\n        if (typeof val[0] === 'number') {\n          return roundCoordToString(val, 5) as string[];\n        } else {\n          const numVal: [number, number] = [Number(val[0]), Number(val[1])];\n          return roundCoordToString(numVal, 5) as string[];\n        }\n      }\n    ],\n    [\n      CoordinatesUnit.DegreesMinutesSeconds,\n      (val: [number, number]) => convertDDToDMS(val, 2)\n    ]\n  ]);\n  let conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n","export enum FontType {\n  Arial = 'Arial',\n  ArialBlack = 'Arial Black',\n  Verdana = 'Verdana',\n  Tahoma = 'Tahoma',\n  TrebuchetMS = 'Trebuchet MS',\n  Impact = 'Impact',\n  TimesNewRoman = 'Times New Roman',\n  Georgia = 'Georgia',\n  AmericanTypewriter = 'American Typewriter',\n  Courier = 'Courier',\n  LucidaConsole = 'Lucida Console',\n  BrushScriptMT = 'Brush Script MT',\n  ComicSansMS = 'Comic Sans MS'\n}\n","<mat-form-field\n  class=\"fill-field\"\n  floatLabel=\"always\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  subscriptSizing=\"dynamic\"\n  cdkOverlayOrigin\n  #trigger=\"cdkOverlayOrigin\"\n  (click)=\"isOpen = !isOpen\"\n>\n  <mat-label>{{ colorPicker }}</mat-label>\n  <input\n    type=\"text\"\n    matInput\n    [readonly]=\"true\"\n    [style.background]=\"colorPicker\"\n  />\n</mat-form-field>\n\n<ng-template\n  cdkConnectedOverlay\n  [cdkConnectedOverlayOrigin]=\"trigger\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  [cdkConnectedOverlayHasBackdrop]=\"true\"\n  (backdropClick)=\"isOpen = false\"\n  cdkConnectedOverlayBackdropClass=\"cdk-overlay-transparent-backdrop\"\n>\n  <div class=\"picker\">\n    <color-chrome (onChange)=\"handleChange($event)\" [color]=\"colorPicker\">\n    </color-chrome>\n    <div class=\"buttons\">\n      <button mat-flat-button color=\"primary\" (click)=\"handleClick($event)\">\n        {{ 'igo.common.confirmDialog.applyBtn' | translate }}\n      </button>\n    </div>\n  </div>\n</ng-template>\n","import { CdkConnectedOverlay, CdkOverlayOrigin } from '@angular/cdk/overlay';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  Output,\n  forwardRef\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { ColorEvent } from 'ngx-color';\nimport { ColorChromeModule } from 'ngx-color/chrome';\nimport tinycolor, { ColorInput } from 'tinycolor2';\n\ntype ColorFormat = 'hex' | 'rgba' | 'hsla';\n\n@Component({\n  selector: 'igo-color-picker-form-field',\n  templateUrl: './color-picker-form-field.component.html',\n  styleUrls: ['./color-picker-form-field.component.scss'],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => ColorPickerFormFieldComponent),\n      multi: true\n    }\n  ],\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    CdkOverlayOrigin,\n    MatInputModule,\n    CdkConnectedOverlay,\n    ColorChromeModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class ColorPickerFormFieldComponent implements ControlValueAccessor {\n  isOpen: boolean = false;\n\n  set value(value: string) {\n    this._value = this.formatColor(value ?? '#000');\n    this.colorPicker = this._value;\n\n    this.onChange(this.value);\n    this.onTouch(this.value);\n  }\n  get value(): string {\n    return this._value;\n  }\n  private _value: string;\n\n  @Input() outputFormat: ColorFormat = 'rgba';\n\n  /**\n   * The emitted value represent the current chosen color in the picker\n   * The value is emitted by default in RGBA, or based on the input 'outputFormat' value.\n   */\n  @Output() colorChange: EventEmitter<string> = new EventEmitter<string>();\n\n  colorPicker: string;\n\n  onChange: any = () => {};\n  onTouch: any = () => {};\n\n  writeValue(value: string) {\n    this.value = value;\n  }\n\n  registerOnChange(fn: any) {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: any) {\n    this.onTouch = fn;\n  }\n\n  handleClick(event: MouseEvent) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.isOpen = false;\n    this.value = this.colorPicker;\n  }\n\n  handleChange($event: ColorEvent) {\n    this.colorPicker = this.formatColor($event.color.rgb, 'rgba');\n    this.colorChange.emit(this.formatColor(this.colorPicker));\n  }\n\n  private formatColor(\n    color: ColorInput,\n    format: ColorFormat = this.outputFormat\n  ): string {\n    switch (format) {\n      case 'hex':\n        color = tinycolor(color).toHexString();\n        break;\n      case 'rgba':\n        color = tinycolor(color).toRgbString();\n        break;\n      case 'hsla':\n        color = tinycolor(color).toHsvString();\n        break;\n      default:\n        color = tinycolor(color).toRgbString();\n        break;\n    }\n    return color;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport OlPoint from 'ol/geom/Point';\nimport { ProjectionLike, transform } from 'ol/proj';\nimport * as OlStyle from 'ol/style';\n\nimport { FontType } from '../shared/font.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '15';\n  private fontStyle: string = FontType.Arial.toString();\n  private offsetX: number = 0;\n  private offsetY: number = 0;\n\n  constructor() {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  getOffsetX(): number {\n    return this.offsetX;\n  }\n\n  setOffsetX(offsetX: number) {\n    this.offsetX = offsetX;\n  }\n\n  getOffsetY(): number {\n    return this.offsetY;\n  }\n\n  setOffsetY(offsetY: number) {\n    this.offsetY = offsetY;\n  }\n\n  createIndividualElementStyle(\n    feature,\n    resolution,\n    labelsAreShown: boolean,\n    fontSizeAndStyle: string,\n    fillColor: string,\n    strokeColor: string,\n    offsetX: number,\n    offsetY: number,\n    proj: ProjectionLike,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n    const textToShow = labelsAreShown ? feature.get('draw') : '';\n    feature.set('_mapTitle', textToShow);\n    const textIgoStyleObject = {\n      text: textToShow,\n      stroke: {\n        color: 'white',\n        width: 0.75\n      },\n      fill: { color: 'black' },\n      font: fontSizeAndStyle,\n      overflow: true,\n      offsetX: offsetX,\n      offsetY: offsetY\n    };\n\n    let igoStyleObject;\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(\n        feature.getGeometry().flatCoordinates,\n        proj,\n        'EPSG:4326'\n      );\n      const radius =\n        feature.get('rad') /\n        Math.cos((Math.PI / 180) * coordinates[1]) /\n        resolution;\n      igoStyleObject = {\n        text: textIgoStyleObject,\n        circle: {\n          radius,\n          stroke: {\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: textToShow,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        image: new OlStyle.Circle({\n          radius,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n\n      // if feature is an icon\n    } else if (icon) {\n      this.offsetY = -26;\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        icon: {\n          src: icon\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n      // if feature is a point, a linestring or a polygon\n    } else {\n      this.offsetY = labelsAreOffset ? -15 : 0;\n\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        circle: {\n          radius: 5,\n          stroke: {\n            color: strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div\n  class=\"edition-drawing\"\n  mat-dialog-content\n  [hidden]=\"data.features.length === 0\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"color-picker\">\n      <ng-container *ngIf=\"linestringOnly !== true\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\">format_color_fill</mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n\n        <igo-color-picker-form-field\n          formControlName=\"fill\"\n        ></igo-color-picker-form-field>\n      </ng-container>\n\n      <span>\n        <mat-icon class=\"stroke-palette-icon\">border_color </mat-icon>\n        {{ 'igo.geo.style.stroke' | translate }}\n      </span>\n\n      <igo-color-picker-form-field\n        formControlName=\"stroke\"\n      ></igo-color-picker-form-field>\n    </div>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\n        <input\n          matInput\n          #testFontSize\n          type=\"number\"\n          placeholder=\"10\"\n          min=\"10\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureFontSize()\"\n          (input)=\"styleModalData.fontSize = $any($event.target).value\"\n        />\n        <span matTextSuffix>px</span>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\n        <mat-select\n          #testFontStyle\n          [value]=\"getFeatureFontStyle()\"\n          (selectionChange)=\"styleModalData.fontStyle = $event.value\"\n        >\n          <mat-option\n            *ngFor=\"let fontSelect of allFontStyles\"\n            [value]=\"fontSelect\"\n          >\n            {{ fontSelect }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetXInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetX()\"\n          (input)=\"styleModalData.offsetX = $any($event.target).value\"\n        />\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetYInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetY()\"\n          (input)=\"styleModalData.offsetY = $any($event.target).value\"\n        />\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { ColorPickerFormFieldComponent } from '@igo2/common/color';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { FontType } from '../../shared/font.enum';\nimport { DrawStyleService } from '../../style-service/draw-style.service';\nimport {\n  DrawingMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-drawing',\n  templateUrl: './style-modal-drawing.component.html',\n  styleUrls: ['./style-modal-drawing.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    ColorPickerFormFieldComponent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class StyleModalDrawingComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData\n  ) {}\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.features) {\n      if (feature.geometry.type !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [this.getFeatureFillColor()],\n      stroke: [this.getFeatureStrokeColor()]\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.fill\n          : 'rgba(255,255,255,0.4)',\n      strokeColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.stroke\n          : 'rgba(143,7,7,1)',\n      fontSize:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle\n              .split(' ')[0]\n              .replace('px', '')\n          : '20',\n      fontStyle:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle.substring(\n              this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n            )\n          : FontType.Arial,\n      offsetX:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetX\n          : this.drawStyleService.getOffsetX(),\n      offsetY:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetY\n          : this.drawStyleService.getOffsetY()\n    };\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  getFeatureFontSize(): string {\n    if (!this.styleModalData.fontSize) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle\n            .split(' ')[0]\n            .replace('px', '')\n        : '20';\n    } else {\n      return this.styleModalData.fontSize;\n    }\n  }\n\n  getFeatureFontStyle() {\n    if (!this.styleModalData.fontStyle) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle.substring(\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n          )\n        : FontType.Arial;\n    } else {\n      return this.styleModalData.fontStyle;\n    }\n  }\n\n  private getFeatureFillColor() {\n    if (!this.styleModalData.fillColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)';\n    } else {\n      return this.styleModalData.fillColor;\n    }\n  }\n\n  private getFeatureStrokeColor() {\n    if (!this.styleModalData.strokeColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)';\n    } else {\n      return this.styleModalData.strokeColor;\n    }\n  }\n\n  getFeatureOffsetX() {\n    if (!this.styleModalData.offsetX) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX();\n    } else {\n      return this.styleModalData.offsetX;\n    }\n  }\n\n  getFeatureOffsetY() {\n    if (!this.styleModalData.offsetY) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetY\n        : this.drawStyleService.getOffsetY();\n    } else {\n      return this.styleModalData.offsetY;\n    }\n  }\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogContent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(public dialogRef: MatDialogRef<DrawLayerPopupComponent>) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.draw.popupTitle' | translate }}\n</h2>\n\n<ng-container *ngIf=\"labelFlag !== labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <div>\n      <p>\n        {{ 'igo.geo.draw.builtInInstructions' | translate }}\n      </p>\n      <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\">\n        <mat-radio-button\n          *ngFor=\"let option of arrayBuiltInType\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.value)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-radio-button>\n      </mat-radio-group>\n      <ng-container *ngIf=\"olGeometryType === 'Polygon'\">\n        <mat-checkbox\n          *ngFor=\"let option of arrayBuiltInType\"\n          class=\"mat-typography\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"\n            onLabelTypeChange($any($event.source.value), $event.checked)\n          \"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-checkbox>\n      </ng-container>\n      <div *ngIf=\"labelFlag === labelType.Coordinates\" class=\"fields-container\">\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>(Latitude, Longitude)</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"(Latitude, Longitude)\"\n            value=\"{{ currentCoordinates }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"coordinatesMeasureUnit\"\n            (selectionChange)=\"onChangeCoordinateUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n              {{ unit }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ lengthLabelT }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ lengthLabelT }}\"\n            value=\"{{ currentLength }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"lengthMeasureUnit\"\n            (selectionChange)=\"onChangeLengthUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n              {{ getLengthUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ 'igo.geo.draw.labelType.Area' | translate }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n            value=\"{{ currentArea }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"areaMeasureUnit\"\n            (selectionChange)=\"onChangeAreaUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n              {{ getAreaUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm()\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"labelFlag === labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <p>\n      {{ 'igo.geo.draw.dialogInstruction' | translate }}\n    </p>\n    <mat-form-field class=\"input\">\n      <mat-label>{{ 'igo.geo.draw.dialogTitle' | translate }}</mat-label>\n      <input\n        #input\n        matInput\n        (select)=\"(true)\"\n        (input)=\"getLabelLength($any($event.target).value)\"\n        placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial\n      />\n    </mat-form-field>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport OlFeature from 'ol/Feature';\nimport Circle from 'ol/geom/Circle';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport { transform } from 'ol/proj';\nimport { getLength } from 'ol/sphere';\n\nimport { IgoMap, roundCoordTo } from '../../map/shared';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from '../../measure/shared/measure.enum';\nimport {\n  measureOlGeometryArea,\n  measureOlGeometryLength,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { DDtoDMS } from '../shared/draw.utils';\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    NgIf,\n    MatDialogContent,\n    MatButtonToggleModule,\n    MatRadioModule,\n    NgFor,\n    MatCheckboxModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\n  @Input() areaMeasureUnit: MeasureAreaUnit;\n\n  public geometryType = GeometryType;\n  public labelType = LabelType;\n  public arrayBuiltInType: any[] = [];\n\n  public currentLabel: string;\n  public currentCoordinates: string;\n  public currentArea: string;\n  public currentLength: string;\n\n  public olGeometryType: GeometryType = undefined;\n  public lengthInMeters: string;\n  public areaInMetersSquare: string;\n  public coordinatesInDD: string;\n  public currentCoordinatesUnit: string;\n\n  private longlatDD: [number, number];\n  private labelLength: number;\n\n  public polygonCheck = 0; // Count for polygon label types checkboxes\n\n  constructor(\n    private languageService: LanguageService,\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any; map: IgoMap }\n  ) {\n    this.currentLabel = this.data.olGeometry.get('draw');\n    this.labelLength = this.currentLabel ? this.currentLabel.length : 0;\n    let olGeometry;\n\n    const projection = this.data.map.ol.getView().getProjection();\n\n    if (this.data.olGeometry instanceof OlFeature) {\n      if (this.data.olGeometry.get('rad')) {\n        const longitudeLatitude = [\n          this.data.olGeometry.get('longitude'),\n          this.data.olGeometry.get('latitude')\n        ];\n        this.olGeometryType = GeometryType.Circle;\n        olGeometry = new Circle(\n          longitudeLatitude,\n          this.data.olGeometry.get('rad')\n        );\n      } else {\n        this.olGeometryType = this.data.olGeometry.getGeometry().getType();\n        olGeometry = this.data.olGeometry.get('geometry');\n      }\n    } else {\n      this.olGeometryType = this.data.olGeometry.getType();\n      olGeometry = this.data.olGeometry;\n    }\n\n    if (\n      this.olGeometryType === GeometryType.Point ||\n      this.olGeometryType === GeometryType.Circle\n    ) {\n      if (this.data.olGeometry instanceof OlFeature) {\n        let longitude = this.data.olGeometry.get('longitude');\n        let latitude = this.data.olGeometry.get('latitude');\n        this.longlatDD = roundCoordTo([longitude, latitude], 5);\n        this.coordinatesInDD = '(' + latitude + ', ' + longitude + ')';\n      } else {\n        let point4326 = transform(\n          this.data.olGeometry.getFlatCoordinates(),\n          projection,\n          'EPSG:4326'\n        );\n        this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\n        this.coordinatesInDD =\n          '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\n      }\n      this.currentCoordinates = this.coordinatesInDD;\n    }\n    if (this.olGeometryType === GeometryType.LineString) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    } else if (this.olGeometryType === GeometryType.Circle) {\n      let circularPolygon = fromCircle(olGeometry, 10000);\n      const radius = this.getRadius(circularPolygon);\n      this.lengthInMeters = radius.toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        circularPolygon,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    }\n\n    if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Coordinates, true);\n      this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Length) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Area) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType')?.length === 2) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\n    }\n    this.buildArrayType();\n  }\n\n  /**\n   * HTML Interactions\n   */\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm(input?: string) {\n    this.confirmFlag = true;\n    if (this.labelFlag === LabelType.Predefined) {\n      this.dialogRef.close();\n    } else if (this.labelFlag === LabelType.Custom) {\n      this.dialogRef.close({\n        label: input\n      });\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.dialogRef.close({\n        label: this.currentCoordinates,\n        measureUnit: this.coordinatesMeasureUnit\n      });\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      if (this.polygonCheck === 2) {\n        this.labelFlag = [LabelType.Length, LabelType.Area];\n        this.dialogRef.close({\n          label:\n            'P: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] +\n            '\\n' +\n            this.languageService.translate.instant('igo.geo.draw.labelType.A') +\n            this.currentArea +\n            ' ' +\n            MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters],\n          measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\n        });\n      } else {\n        this.labelFlag === LabelType.Length\n          ? this.dialogRef.close({\n              label:\n                'P: ' +\n                this.currentLength +\n                ' ' +\n                MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n              measureUnit: this.lengthMeasureUnit\n            })\n          : this.dialogRef.close({\n              label:\n                this.currentArea +\n                ' ' +\n                MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n              measureUnit: this.areaMeasureUnit\n            });\n      }\n    } else if (this.labelFlag === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Circle) {\n        this.dialogRef.close({\n          label:\n            'R: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.dialogRef.close({\n          label:\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n    } else if (this.labelFlag === LabelType.Area) {\n      this.dialogRef.close({\n        label:\n          this.currentArea +\n          ' ' +\n          MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n        measureUnit: this.areaMeasureUnit\n      });\n    }\n  }\n\n  onLabelTypeChange(labelType: LabelType, checked?: boolean) {\n    if (\n      labelType !== LabelType.Predefined &&\n      labelType !== LabelType.Custom &&\n      this.olGeometryType === GeometryType.Polygon\n    ) {\n      this.arrayBuiltInType.find((type) => type.value === labelType)\n        ? (this.arrayBuiltInType.find(\n            (type) => type.value === labelType\n          ).checked = checked)\n        : (this.labelFlag = undefined);\n      checked\n        ? (this.labelFlag = labelType)\n        : (this.labelFlag = this.arrayBuiltInType.find(\n            (type) => type.checked\n          )?.value);\n    } else {\n      this.labelFlag = labelType;\n    }\n\n    if (labelType === LabelType.Predefined) {\n      if (this.olGeometryType === GeometryType.Point) {\n        this.labelFlag = LabelType.Coordinates;\n        this.currentCoordinates = this.coordinatesInDD;\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.labelFlag = LabelType.Length;\n        this.currentLength = this.lengthInMeters;\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n      }\n    } else if (labelType === LabelType.Area) {\n      this.currentArea = this.areaInMetersSquare;\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\n    } else if (labelType === LabelType.Length) {\n      this.currentLength = this.lengthInMeters;\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.currentCoordinates = this.coordinatesInDD;\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n    }\n\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\n    if (\n      this.olGeometryType === GeometryType.Polygon &&\n      labeltypes.includes(labelType)\n    ) {\n      checked ? (this.polygonCheck += 1) : (this.polygonCheck -= 1);\n    } else {\n      this.polygonCheck = 0;\n    }\n  }\n\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit) {\n    this.lengthMeasureUnit = lengthUnit;\n    this.currentLength = metersToUnit(\n      Number(this.lengthInMeters),\n      lengthUnit\n    ).toFixed(2);\n  }\n\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit) {\n    this.areaMeasureUnit = areaUnit;\n    this.currentArea = squareMetersToUnit(\n      Number(this.areaInMetersSquare),\n      areaUnit\n    ).toFixed(2);\n  }\n\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit) {\n    this.coordinatesMeasureUnit = coordinatesUnit;\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\n    this.currentCoordinates =\n      '(' + coordinates[1] + ', ' + coordinates[0] + ')';\n  }\n\n  buildArrayType() {\n    for (const labelType of Object.values(LabelType)) {\n      if (\n        labelType !== LabelType.Custom &&\n        labelType !== LabelType.Predefined\n      ) {\n        this.arrayBuiltInType.push({\n          value: labelType,\n          checked:\n            this.selectOptions(labelType) ||\n            this.labelFlag === labelType ||\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\n        });\n      }\n    }\n  }\n\n  noLabelButton() {\n    if (\n      this.labelFlag === LabelType.Predefined ||\n      (this.labelFlag === LabelType.Custom && this.labelLength === 0)\n    ) {\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\n    }\n\n    return 'OK';\n  }\n\n  get customOrPredefined() {\n    if (this.labelFlag === LabelType.Custom) {\n      return LabelType.Custom;\n    }\n    return LabelType.Predefined;\n  }\n\n  optionAvailable(currentOption: LabelType) {\n    switch (this.olGeometryType) {\n      case GeometryType.Point:\n        if (currentOption === LabelType.Coordinates) {\n          return false;\n        }\n        return true;\n      case GeometryType.LineString:\n        if (currentOption === LabelType.Length) {\n          return false;\n        }\n        return true;\n      case GeometryType.Polygon:\n        if (currentOption === LabelType.Coordinates) {\n          return true;\n        }\n        return false;\n      default:\n        return false;\n    }\n  }\n\n  get allLengthUnits(): MeasureLengthUnit[] {\n    return Object.values(MeasureLengthUnit);\n  }\n\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit) {\n    return MeasureLengthUnitAbbreviation[lengthUnit];\n  }\n\n  get allAreaUnits(): MeasureAreaUnit[] {\n    return Object.values(MeasureAreaUnit);\n  }\n\n  get allCoordinatesUnits(): CoordinatesUnit[] {\n    return Object.values(CoordinatesUnit);\n  }\n\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit) {\n    return MeasureAreaUnitAbbreviation[areaUnit];\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n  get lengthLabelT() {\n    if (this.olGeometryType === GeometryType.Polygon) {\n      return this.languageService.translate.instant(\n        'igo.geo.measure.perimeter'\n      );\n    }\n    if (this.olGeometryType === GeometryType.Circle) {\n      return this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.Length'\n    );\n  }\n\n  getLabelLength(event?) {\n    this.labelLength = event.length;\n  }\n\n  selectOptions(option) {\n    if (this.olGeometryType === GeometryType.Point) {\n      return option === LabelType.Coordinates;\n    } else if (this.olGeometryType === GeometryType.LineString) {\n      return option === LabelType.Length;\n    }\n  }\n\n  getProperLengthLabel(option) {\n    if (option === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Polygon) {\n        return this.languageService.translate.instant(\n          'igo.geo.measure.perimeter'\n        );\n      }\n      if (this.olGeometryType === GeometryType.Circle) {\n        return this.languageService.translate.instant(\n          'igo.geo.search.coordinates.radius'\n        );\n      }\n      return this.languageService.translate.instant(\n        'igo.geo.draw.labelType.Length'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.' + option\n    );\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogClose,\n  MatDialogContent\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IconSvg,\n  IgoIconComponent,\n  KEYBOARD_ESC_ICON\n} from '@igo2/common/icon';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogContent,\n    MatIconModule,\n    MatDialogActions,\n    MatButtonModule,\n    MatDialogClose,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class DrawShorcutsComponent {\n  svgIcon: IconSvg = KEYBOARD_ESC_ICON;\n}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">keyboard_return</mat-icon\n      >{{ 'igo.geo.draw.finish' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">keyboard_backspace</mat-icon\n      >{{ 'igo.geo.draw.undo' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <igo-icon [icon]=\"svgIcon\" />\n      {{ 'igo.geo.draw.abort' | translate }}\n    </span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">space_bar</mat-icon\n      >{{ 'igo.geo.draw.move' | translate }}</span\n    >\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\"\n      [value]=\"geometryType.Point\"\n    >\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.draw.drawControl' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\"\n    >\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"!isPoint()\"\n      [checked]=\"freehandMode\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleFreehandMode($event)\"\n    >\n      {{ 'igo.geo.draw.freehandMode' | translate }}\n    </mat-slide-toggle>\n\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\n      <mat-form-field class=\"radius\">\n        <input\n          matInput\n          type=\"number\"\n          min=\"0\"\n          placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n          [formControl]=\"radiusFormControl\"\n          [readonly]=\"this.freehandMode\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-divider></mat-divider>\n\n  <div class=\"layer-select-container\">\n    <mat-form-field class=\"layer-select\" subscriptSizing=\"dynamic\">\n      <mat-label>{{ 'igo.geo.draw.layer.title' | translate }}</mat-label>\n      <mat-select\n        #selectedLayer\n        (selectionChange)=\"onLayerChange(selectedLayer.value)\"\n        [value]=\"updateActiveLayer()\"\n      >\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\n          {{ layer.title }}\n        </mat-option>\n        <mat-option id=\"createNewLayer\">\n          {{ 'igo.geo.draw.layer.createNewLayer' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <button\n      *ngIf=\"activeDrawingLayer\"\n      mat-icon-button\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        activeDrawingLayer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\"\n    >\n      <mat-icon>\n        {{ activeDrawingLayer.visible ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n  </div>\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"activeStore.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <div>\n      <igo-entity-table\n        #table\n        class=\"table-compact\"\n        [store]=\"activeStore\"\n        [template]=\"tableTemplate\"\n      >\n      </igo-entity-table>\n    </div>\n  </div>\n\n  <div class=\"icon-options\">\n    <mat-form-field *ngIf=\"icons.length >= 1\">\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n      <mat-select>\n        <mat-select-trigger>\n          <div *ngIf=\"icon\" class=\"box\">\n            <img src=\"{{ icon }}\" />\n          </div>\n        </mat-select-trigger>\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{\n          'igo.geo.draw.noIcon' | translate\n        }}</mat-option>\n        <mat-option\n          *ngFor=\"let icon_html of icons\"\n          [value]=\"icon_html\"\n          (click)=\"onIconChange(icon_html)\"\n        >\n          <div class=\"box\">\n            <img src=\"{{ icon_html }}\" />\n          </div>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"actions-container\">\n    <button\n      mat-icon-button\n      color=\"accent\"\n      disableRipple=\"true\"\n      (click)=\"openShorcutsDialog()\"\n    >\n      <mat-icon\n        class=\"shortcuts-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\n        >keyboard\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectedFeatures$.value.length\"\n      mat-raised-button\n      color=\"primary\"\n      (click)=\"openStyleModalDialog()\"\n      [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\"\n    >\n      {{ 'igo.geo.style.styleModal' | translate }}\n      <mat-icon\n        aria-hidden=\"false\"\n        iconPositionEnd\n        class=\"style-icon\"\n        [matBadge]=\"selectedFeatures$.value.length\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        >palette\n      </mat-icon>\n    </button>\n  </div>\n</div>\n","import {\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS,\n  MatButtonToggleDefaultOptions,\n  MatButtonToggleModule\n} from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  EntityRecord,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport OlFeature from 'ol/Feature';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport type { Type } from 'ol/geom/Geometry';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlPoint from 'ol/geom/Point';\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\nimport { transform } from 'ol/proj';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport { getDistance, getLength } from 'ol/sphere';\nimport * as OlStyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { first, skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport {\n  FEATURE,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  featureToOl,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from '../../measure/shared/measure.enum';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport {\n  measureOlGeometryArea,\n  measureOlGeometryLength,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport { FontType } from '../../style/shared/font.enum';\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\nimport { DrawIconService } from '../shared/draw-icon.service';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { DDtoDMS, createInteractionStyle } from '../shared/draw.utils';\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n@Component({\n  selector: 'igo-draw',\n  animations: [\n    trigger('openClose', [\n      state(\n        'open',\n        style({\n          opacity: 1\n        })\n      ),\n      state(\n        'closed',\n        style({\n          opacity: 0\n        })\n      ),\n      transition('open => closed', [animate('600ms ease')]),\n      transition('closed => open', [animate('800ms ease')])\n    ])\n  ],\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    MatSlideToggleModule,\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatDividerModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    EntityTableComponent,\n    MatBadgeModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ],\n  providers: [\n    {\n      provide: MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS,\n      useValue: {\n        hideSingleSelectionIndicator: true\n      } satisfies MatButtonToggleDefaultOptions\n    }\n  ]\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input()\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this._stores;\n  }\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\n    this._stores = value;\n  }\n  private _stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  @Input()\n  get drawControls(): [string, DrawControl][] {\n    return this._drawControls;\n  }\n  set drawControls(value: [string, DrawControl][]) {\n    this._drawControls = value;\n  }\n  private _drawControls = [];\n\n  @Input()\n  get activeDrawingLayer(): VectorLayer {\n    return this._activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this._activeDrawingLayer = value;\n  }\n  private _activeDrawingLayer: VectorLayer;\n\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\n  @Output() layersIDEvent = new EventEmitter<string>();\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n\n  public activeStore: FeatureStore<FeatureWithDraw>;\n  private layerCounterID: number = 0;\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n  private activeDrawingLayerSource = new OlVectorSource();\n  private activeDrawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  public freehandMode = false;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: UntypedFormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  public radiusFormControl = new UntypedFormControl(1000);\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public radiusFormControlChange$$: Subscription = new Subscription();\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n  private numberOfDrawings: number;\n  public isCreatingNewLayer: boolean = false;\n  private currGeometryType = this.geometryType.Point as any;\n\n  @ViewChild('selectedLayer') select;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      fixedHeader: true,\n      tableHeight: 'auto',\n      columns: [\n        {\n          name: 'Drawing',\n          title: this.languageService.translate.instant('igo.geo.draw.labels'),\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return feature.properties.draw;\n          }\n        },\n        {\n          name: 'Edition',\n          title: '',\n          sort: false,\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return [\n              {\n                editMode: false,\n                icon: 'edit',\n                color: 'primary',\n                click: () => {\n                  this.editLabelDrawing(feature);\n                },\n                style: 'mat-icon-button'\n              }\n            ] as EntityTableButton[];\n          },\n          renderer: EntityTableColumnRenderer.ButtonGroup\n        }\n      ]\n    };\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    if (!this.stores.length) {\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n        map: this.map\n      });\n      this.initStore();\n      this.activeDrawControl = this.createDrawControl(\n        this.fillColor,\n        this.strokeColor,\n        this.strokeWidth\n      );\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\n      this.toggleDrawControl();\n      this.stores.push(this.activeStore);\n      this.drawControls.push([\n        this.activeDrawingLayer.id,\n        this.activeDrawControl\n      ]);\n      this.drawControlsEvent.emit(this.drawControls);\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\n      this.onLayerChange(this.activeDrawingLayer);\n    } else {\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.deactivateDrawControl();\n      this.allLayers.forEach((layer) => {\n        if (layer.id !== this.activeDrawingLayer.id) {\n          layer.opacity = 0;\n        }\n        let store = this.stores.find((s) => s.layer.id === layer.id);\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(first())\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              records.forEach((record) => {\n                record.state.selected = false;\n              });\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              skip(1) // Skip initial emission\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              this.selectedFeatures$.next(\n                records.map((record) => record.entity)\n              );\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.count$.subscribe((cnt) => {\n            cnt >= 1\n              ? (this.activeStore.layer.options.showInLayerList = true)\n              : (this.activeStore.layer.options.showInLayerList = false);\n          })\n        );\n      });\n      this.onLayerChange(this.activeDrawingLayer);\n    }\n\n    this.radiusFormControlChange$$ =\n      this.radiusFormControl.valueChanges.subscribe((value) => {\n        if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\n          this.changeRadius(value);\n        }\n      });\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.allLayers.forEach((layer) => (layer.opacity = 1));\n    this.activeStore.state.updateAll({ selected: false });\n    this.deactivateDrawControl();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n    this.radiusFormControlChange$$.unsubscribe();\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const activeDrawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.activeDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return activeDrawControl;\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\n    this.createLayer(newTitle, isNewLayer);\n    this.subscriptions$$.push(\n      this.activeStore.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n\n    this.subscriptions$$.push(\n      this.activeStore.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.activeStore.layer.options.showInLayerList = true)\n          : (this.activeStore.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\n        disableClose: false,\n        data: {\n          features: this.selectedFeatures$.getValue(),\n          icons: this.icons,\n          icon: this.icon\n        },\n        autoFocus: false\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\n          this.onColorChange(\n            this.labelsAreShown,\n            this.icon ? true : false,\n            data.fillColor,\n            data.strokeColor\n          );\n          this.onOffsetLabelChange(\n            this.labelsAreShown,\n            data.offsetX,\n            data.offsetY\n          );\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: { olGeometry: olGeometry, map: this.map }\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((result) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\n          this.updateLabelType(\n            olGeometry,\n            dialogRef.componentInstance.labelFlag\n          );\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\n\n          if (!(olGeometry instanceof OlFeature)) {\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\n            this.updateFillAndStrokeColor(\n              olGeometry,\n              'rgba(255,255,255,0.4)',\n              'rgba(143,7,7,1)'\n            );\n            this.updateOffset(\n              olGeometry,\n              0,\n              olGeometry instanceof OlPoint ? -15 : 0\n            );\n          }\n\n          isDrawEnd\n            ? this.onDrawEnd(olGeometry)\n            : this.onSelectDraw(olGeometry, result.label, [\n                dialogRef.componentInstance.labelFlag,\n                result.measureUnit\n              ]);\n          this.updateHeightTable();\n        }\n        // deletes the feature\n        else {\n          this.activeDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometry === geometry) {\n                this.activeDrawingLayerSource.removeFeature(\n                  drawingLayerFeature\n                );\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.activeStore.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.activeStore.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        if (entity.properties.labelType === LabelType.Coordinates) {\n          let longLat = DDtoDMS(\n            [entity.properties.longitude, entity.properties.latitude],\n            entity.properties.measureUnit as CoordinatesUnit\n          );\n          this.updateLabelOfOlGeometry(\n            olGeometry,\n            '(' + longLat[1] + ', ' + longLat[0] + ')'\n          );\n        } else if (entity.properties.labelType === LabelType.Length) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            const radius = metersToUnit(\n              this.getRadius(circularPolygon),\n              entity.properties.measureUnit as MeasureLengthUnit\n            );\n            const unit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            const radiusLabel =\n              'R: ' + radius.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\n          } else {\n            let olGeometryLength = measureOlGeometryLength(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureLengthUnit = entity.properties\n              .measureUnit as MeasureLengthUnit;\n            measureUnit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\n            let lengthLabel =\n              olGeometry instanceof Polygon\n                ? 'P: ' +\n                  olGeometryLength.toFixed(2).toString() +\n                  ' ' +\n                  measureUnit\n                : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else if (entity.properties.labelType === LabelType.Area) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            let circleArea = measureOlGeometryArea(\n              circularPolygon,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            const unit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            circleArea = squareMetersToUnit(circleArea, temp);\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\n          } else {\n            let olGeometryArea = measureOlGeometryArea(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            measureUnit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\n            const lengthLabel =\n              olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else {\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        }\n\n        this.updateLabelType(olGeometry, entity.properties.labelType);\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\n        this.updateFontSizeAndStyle(\n          olGeometry,\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\n          entity.properties.fontStyle.substring(\n            entity.properties.fontStyle.indexOf(' ') + 1\n          )\n        );\n        this.updateFillAndStrokeColor(\n          olGeometry,\n          entity.properties.drawingStyle.fill,\n          entity.properties.drawingStyle.stroke\n        );\n        this.updateOffset(\n          olGeometry,\n          entity.properties.offsetX,\n          entity.properties.offsetY\n        );\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(\n    olFeature: OlFeature<OlGeometry>,\n    label: string,\n    labelTypeAndUnit?\n  ) {\n    const entities = this.activeStore.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n      if (olGeometryCoordinates === entityCoordinates) {\n        const fontSize = olFeature\n          .get('fontStyle')\n          .split(' ')[0]\n          .replace('px', '');\n        const fontStyle = olFeature\n          .get('fontStyle')\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\n\n        const fillColor = olFeature.get('drawingStyle').fill;\n        const strokeColor = olFeature.get('drawingStyle').stroke;\n\n        const offsetX = olFeature.get('offsetX');\n        const offsetY = olFeature.get('offsetY');\n\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\n        this.updateOffset(olGeometry, offsetX, offsetY);\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n        this.radiusFormControl.setValue(Math.round(rad));\n      }\n    }\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.activeStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null,\n        fontStyle: olGeometry.get('fontStyle_'),\n        drawingStyle: {\n          fill: olGeometry.get('fillColor_'),\n          stroke: olGeometry.get('strokeColor_')\n        },\n        offsetX: olGeometry.get('offsetX_'),\n        offsetY: olGeometry.get('offsetY_'),\n        labelType: olGeometry.get('labelType_'),\n        measureUnit: olGeometry.get('measureUnit_')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n    this.activeStore.setLayerExtent();\n    this.activeDrawControl.predefinedRadius$.next(undefined);\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  public setupLayer(isNewLayer?: boolean) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\n        disableClose: false\n      });\n      dialogRef.afterClosed().subscribe((label: string) => {\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.activeStore.state.updateAll({ selected: false });\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n            map: this.map\n          });\n          this.activeDrawingLayerSource = new OlVectorSource();\n          this.activeDrawingLayer.opacity = 0;\n          this.deactivateDrawControl();\n          this.initStore(label, isNewLayer);\n          this.activeDrawControl = this.createDrawControl(\n            this.fillColor,\n            this.strokeColor,\n            this.strokeWidth\n          );\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\n          this.toggleDrawControl();\n          this.stores.push(this.activeStore);\n          this.drawControls.push([\n            this.activeDrawingLayer.id,\n            this.activeDrawControl\n          ]);\n          this.drawControlsEvent.emit(this.drawControls);\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\n          this.isCreatingNewLayer = false;\n          if (!this.labelsAreShown) {\n            this.onToggleLabels();\n          }\n          this.activeLayerChange.emit(this.activeDrawingLayer);\n        } else {\n          this.select.value = this.activeDrawingLayer;\n          this.select.selectionChange.emit(this.activeDrawingLayer);\n        }\n      });\n    }, 250);\n  }\n\n  // HTML user interactions\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing(feature) {\n    const olGeometryFeature = featureToOl(\n      feature,\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDrawDialog(olGeometryFeature, false);\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  deleteDrawings() {\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.activeDrawingLayerSource\n        .getFeatures()\n        .forEach((drawingLayerFeature) => {\n          const geometry = drawingLayerFeature.getGeometry() as any;\n          if (selectedFeature.properties.id === geometry.ol_uid) {\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\n          }\n        });\n    });\n    this.updateHeightTable();\n    this.activeStore.setLayerExtent();\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.elementStyle(this.labelsAreShown, true)\n      : this.elementStyle(this.labelsAreShown, false);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  onToggleFreehandMode(event: any) {\n    if (this.isCircle() && !event.checked) {\n      this.activeDrawControl.ispredefinedRadius$.next(true);\n      this.changeRadius(this.radiusFormControl.value);\n    } else {\n      this.activeDrawControl.setOlInteractionStyle(\n        createInteractionStyle(\n          this.fillColor,\n          this.strokeColor,\n          this.strokeWidth\n        )\n      );\n      this.activeDrawControl.ispredefinedRadius$.next(false);\n    }\n    this.freehandMode = event.checked;\n    this.activeDrawControl.freehand$.next(event.checked);\n    this.toggleDrawControl();\n  }\n\n  // User changes properties of a drawing element\n\n  /**\n   * Display the current layer with the current store and the current layerSource\n   */\n\n  public onLayerChange(currLayer?: VectorLayer) {\n    if (currLayer) {\n      this.activeStore.state.updateAll({ selected: false });\n      this.isCreatingNewLayer = false;\n      this.activeDrawingLayer.opacity = 0;\n      this.activeDrawingLayer = currLayer;\n      this.activeDrawingLayer.opacity = 1;\n      this.deactivateDrawControl();\n      if (!this.labelsAreShown) {\n        this.onToggleLabels();\n      }\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.activeDrawingLayerSource =\n        this.activeDrawControl.olDrawingLayerSource;\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\n      this.toggleDrawControl();\n    } else {\n      this.setupLayer(true);\n    }\n    this.activeLayerChange.emit(this.activeDrawingLayer);\n  }\n\n  public createLayer(newTitle?, isNewLayer?) {\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-draw-layer', ''));\n      this.layerCounterID = Math.max(numberId, this.layerCounterID);\n    }\n    this.activeDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer' + ++this.layerCounterID,\n      title: isNewLayer\n        ? newTitle\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\n\n    tryAddLoadingStrategy(\n      this.activeStore,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n\n    tryAddSelectionStrategy(\n      this.activeStore,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.activeStore.layer.visible = true;\n    this.activeStore.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   * @param fillColor which is the filling color\n   * @param strokeColor which is the stroke color\n   */\n  onColorChange(\n    labelsAreShown: boolean,\n    isAnIcon: boolean,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\n\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\n        this.activeStore.update(entity);\n      });\n    }\n\n    this.elementStyle(labelsAreShown, isAnIcon);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFontSizeAndStyle(olFeature, size, style);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\n        olFeature.changed();\n      });\n\n      this.fontSize = size;\n      this.fontStyle = style;\n\n      this.drawStyleService.setFontSize(size);\n      this.drawStyleService.setFontStyle(style);\n\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  /**\n   * Called when the user changes the value of the horizontal/vertical offset\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param offsetX horizontal offset of the label\n   * @param offsetY vertical offset of the label\n   */\n\n  onOffsetLabelChange(\n    labelsAreShown: boolean,\n    offsetX: number,\n    offsetY: number\n  ) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateOffset(olFeature, offsetX, offsetY);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.offsetX = olFeature.get('offsetX_');\n        entity.properties.offsetY = olFeature.get('offsetY_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({\n          offsetX: entity.properties.offsetX,\n          offsetY: entity.properties.offsetY\n        });\n        olFeature.changed();\n      });\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.elementStyle(true, this.icon);\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type) {\n    this.currGeometryType = geometryType;\n    this.activeDrawControl.setGeometryType(geometryType);\n    this.freehandMode\n      ? this.onToggleFreehandMode({ checked: true })\n      : this.onToggleFreehandMode({ checked: false });\n    this.toggleDrawControl();\n  }\n\n  // Updates the properties of olFeature inputted\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param OlFeature the feature\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\n    OlFeature.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  private updateFontSizeAndStyle(\n    olFeature: OlFeature<OlGeometry>,\n    fontSize: string,\n    fontStyle: string\n  ) {\n    olFeature.setProperties(\n      {\n        fontStyle_: `${fontSize}px ${fontStyle}`\n      },\n      true\n    );\n  }\n\n  private updateFillAndStrokeColor(\n    olFeature: OlFeature<OlGeometry>,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    olFeature.setProperties(\n      {\n        fillColor_: fillColor,\n        strokeColor_: strokeColor\n      },\n      true\n    );\n  }\n\n  private updateOffset(\n    olFeature: OlFeature<OlGeometry>,\n    offsetX: number,\n    offsetY: number\n  ) {\n    olFeature.setProperties(\n      {\n        offsetX_: offsetX,\n        offsetY_: offsetY\n      },\n      true\n    );\n  }\n\n  private updateLabelType(\n    olFeature: OlFeature<OlGeometry>,\n    typeOfLabel: LabelType | [LabelType, LabelType]\n  ) {\n    olFeature.setProperties(\n      {\n        labelType_: typeOfLabel\n      },\n      true\n    );\n  }\n\n  private updateMeasureUnit(\n    olFeature: OlFeature<OlGeometry>,\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\n  ) {\n    olFeature.setProperties(\n      {\n        measureUnit_: measureUnit\n      },\n      true\n    );\n  }\n\n  // Updates values of the selected element on the HTML view\n\n  getFeatureFontSize(): string {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '15';\n  }\n\n  getFeatureFontStyle() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n  }\n\n  getFeatureFillColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\n      : 'rgba(255,255,255,0.4)';\n  }\n\n  getFeatureStrokeColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\n      : 'rgba(143,7,7,1)';\n  }\n\n  getFeatureOffsetX() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetX\n      : this.drawStyleService.getOffsetX();\n  }\n\n  getFeatureOffsetY() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetY\n      : '0';\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-draw-layer')\n    );\n  }\n\n  updateHeightTable() {\n    // Check the amount of rows as a possible alternative\n    this.numberOfDrawings = this.activeStore.count$.getValue();\n    this.numberOfDrawings > 10\n      ? (this.tableTemplate.tableHeight = '35vh')\n      : (this.tableTemplate.tableHeight = 'auto');\n  }\n\n  updateActiveLayer() {\n    let currLayer = this.allLayers.find(\n      (layer) => layer.title === this.activeDrawingLayer.title\n    );\n    return currLayer ? currLayer : this.allLayers[0];\n  }\n\n  // Helper methods\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.activeStore.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.activeDrawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.activeDrawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDrawDialog(olGeometry, true);\n      }\n    );\n\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDrawDialog(olFeature, false);\n        }\n      );\n    }\n    this.activeDrawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * get the geometry of design\n   *\n   */\n\n  isPoint() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\n  }\n\n  isLineString() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.LineString\n    );\n  }\n\n  isPolygon() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Polygon\n    );\n  }\n\n  isCircle() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Circle\n    );\n  }\n\n  /**\n   * The fonction to predefine the radius of the user\n   *\n   */\n\n  changeRadius(radius: number) {\n    let radiusMeters: number;\n\n    if (radius) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (radiusMeters = radius)\n        : (radiusMeters = radius * 1000);\n    } else {\n      radiusMeters = undefined;\n    }\n\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n      const geom = feature.getGeometry() as OlPoint;\n      const coordinates = olproj.transform(\n        geom.getCoordinates(),\n        this.map.projection,\n        'EPSG:4326'\n      );\n\n      const radius =\n        radiusMeters / Math.cos((Math.PI / 180) * coordinates[1]) / resolution;\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\n      return new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: radius,\n          stroke: new OlStyle.Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new OlStyle.Fill({\n            color: 'rgba(255,255,255,0.4)'\n          })\n        })\n      });\n    };\n\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\n    this.toggleDrawControl();\n  }\n\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\n    if (selectedMeasureUnit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = selectedMeasureUnit;\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n        : this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n    }\n  }\n\n  /**\n   * Recreates the style of the feature stored\n   */\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\n    if (isAnIcon) {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      });\n    } else {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection\n        );\n      });\n    }\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Self\n} from '@angular/core';\nimport { ControlValueAccessor, NgControl } from '@angular/forms';\n\nimport OlFeature from 'ol/Feature';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport Point from 'ol/geom/Point';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport * as olproj from 'ol/proj';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureLengthUnit,\n  formatMeasure,\n  measureOlGeometry,\n  updateOlGeometryMidpoints\n} from '../../measure';\nimport {\n  DrawControl,\n  ModifyControl,\n  ModifyControlOptions\n} from '../shared/controls';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { DrawControlOptions } from './../shared/controls/draw';\n\ninterface HasRadius {\n  getRadius: () => number;\n  setRadius: (radius: number) => void;\n}\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class GeometryFormFieldInputComponent\n  implements OnInit, OnDestroy, ControlValueAccessor\n{\n  private olOverlayLayer: OlVectorLayer<OlVectorSource>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: Type) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): Type {\n    return this._geometryType;\n  }\n  private _geometryType: Type;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get predefinedRadius(): boolean {\n    return this._predefinedRadius;\n  }\n  set predefinedRadius(value: boolean) {\n    this._predefinedRadius = value;\n    this.drawControl.ispredefinedRadius$.next(value);\n  }\n  private _predefinedRadius: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._drawStyle;\n  }\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    this._overlayStyle = value;\n  }\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._overlayStyle;\n  }\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry {\n    return this._value;\n  }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$.subscribe((olGeometry: OlGeometry) =>\n      this.onOlGeometryEnds(olGeometry)\n    );\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$.subscribe(\n        (olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) =>\n          this.onOlGeometryChanges(olGeometry)\n      );\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') {\n      // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(\n      center,\n      this.map.projection,\n      'EPSG:4326'\n    );\n    const radius = Math.round(\n      olGeometry.getRadius() * Math.cos((Math.PI / 180) * coordinates[1])\n    );\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: ['igo-map-tooltip', 'igo-map-tooltip-measure'].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex =\n      olGeometry.getType() === 'Polygon'\n        ? lengths.length - 2\n        : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyleLike | OlStyle.RegularShape,\n    resolution: number\n  ) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\n    if (olGuideStyle === undefined) {\n      return;\n    }\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyleLike | OlStyle.RegularShape\n  ): HasRadius | undefined {\n    let baseStyle: unknown;\n    if (Array.isArray(olStyle)) {\n      baseStyle = olStyle[0];\n    } else {\n      baseStyle = olStyle;\n    }\n\n    if (typeof (baseStyle as any).getImage === 'function') {\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\n    }\n\n    let guideStyle: HasRadius;\n    if (typeof (baseStyle as any).setRadius === 'function') {\n      guideStyle = baseStyle as HasRadius;\n    }\n\n    return guideStyle;\n  }\n}\n","<ng-template></ng-template>\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\"\n  [predefinedRadius]=\"$any(predefinedRadius)\"\n>\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"drawControlIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onDrawControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.drawControl' | translate }}\n  </mat-slide-toggle>\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"freehandDrawIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onfreehandControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.freehandControl' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <mat-form-field class=\"buffer\">\n    <input\n      type=\"number\"\n      matInput\n      placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n      [formControl]=\"bufferFormControl\"\n      [value]=\"0\"\n      [readonly]=\"this.formControl.value === null\"\n    />\n  </mat-form-field>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <mat-form-field class=\"radius\">\n    <input\n      type=\"number\"\n      matInput\n      placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n      [formControl]=\"radiusFormControl\"\n      [value]=\"1000\"\n      (input)=\"getRadius()\"\n      [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\"\n    />\n  </mat-form-field>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\"\n  >{{ 'igo.geo.spatialFilter.search' | translate }} :\n</mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n  <mat-radio-button\n    *ngFor=\"let item of itemType\"\n    [value]=\"item\"\n    (change)=\"onItemTypeChange($event)\"\n  >\n    {{ 'igo.geo.spatialFilter.' + item | translate }}\n  </mat-radio-button>\n</mat-radio-group>\n\n<div\n  class=\"thematics\"\n  *ngIf=\"\n    (selectedItemType === 'Thematics' && !tableTemplate) ||\n    (selectedItemType === 'Thematics' && tableTemplate && !listIsVisible)\n  \"\n>\n  <mat-table>\n    <!-- Name Column -->\n    <ng-container matColumnDef=\"name\">\n      <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{\n        'igo.geo.spatialFilter.Thematics' | translate\n      }}</mat-header-cell>\n    </ng-container>\n\n    <!-- Select Column -->\n    <ng-container matColumnDef=\"select\">\n      <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n        <mat-checkbox\n          (change)=\"$event ? masterToggle() : null\"\n          [checked]=\"isAllSelected()\"\n          [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\"\n        >\n        </mat-checkbox>\n      </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns\"></mat-row>\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"$event ? onToggleChange(node) : null\"\n          [checked]=\"selectedThematics.isSelected(node)\"\n        >\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n      <div class=\"mat-tree-node\">\n        <button mat-icon-button (click)=\"onToggleClick(node)\">\n          <mat-icon>{{\n            treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'\n          }}</mat-icon>\n        </button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check-2\"\n          (change)=\"$event ? childrensToggle(node) : null\"\n          [checked]=\"isAllSelected(node)\"\n          [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\"\n        >\n        </mat-checkbox>\n      </div>\n      <ul\n        class=\"tree-ul\"\n        [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\"\n      >\n        <ng-container matTreeNodeOutlet></ng-container>\n      </ul>\n    </mat-nested-tree-node>\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n  <button\n    *ngIf=\"isPredefined()\"\n    mat-raised-button\n    class=\"clear-search-button\"\n    [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearSearch' | translate }}\n  </button>\n\n  <button\n    *ngIf=\"isPolygon() || isPoint()\"\n    mat-raised-button\n    class=\"clear-form-button\"\n    [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearForm' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"search-button\"\n    [disabled]=\"disableSearchButton()\"\n    color=\"primary\"\n    (click)=\"toggleSearchButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.goSearch' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"remove-button\"\n    [disabled]=\"allLayers.length === 0\"\n    (click)=\"clearButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.removeLayer' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"export-button\"\n    [disabled]=\"!store.entities$.getValue().length\"\n    (click)=\"export.emit()\"\n  >\n    {{ 'igo.geo.spatialFilter.exportLayer' | translate }}\n  </button>\n</div>\n\n<button\n  class=\"expand-more\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\"\n>\n  <mat-icon>expand_more</mat-icon>\n</button>\n\n<div\n  class=\"results\"\n  *ngIf=\"store.all().length && tableTemplate && listIsVisible\"\n>\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\"\n  >\n    <mat-icon>expand_less</mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\"\n  >\n  </igo-entity-table>\n</div>\n","import { SelectionModel } from '@angular/cdk/collections';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule, MatTreeNestedDataSource } from '@angular/material/tree';\n\nimport {\n  EntityStore,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlPoint from 'ol/geom/Point';\nimport * as olproj from 'ol/proj';\nimport * as olStyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../../datasource/shared';\nimport { GeometryType } from '../../../draw';\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { GeometryFormFieldInputComponent } from '../../../geometry/geometry-form-field/geometry-form-field-input.component';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { IgoMap } from '../../../map/shared/map';\nimport { MeasureLengthUnit } from '../../../measure';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    GeometryFormFieldInputComponent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatRadioModule,\n    MatTableModule,\n    MatCheckboxModule,\n    MatTreeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    EntityTableComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(\n      (geom) => geom === (this.type as any)\n    );\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (\n        feature: OlFeature<OlGeometry>,\n        resolution: number\n      ) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(\n          geom.getCoordinates(),\n          this.map.projection,\n          'EPSG:4326'\n        );\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius:\n              this.radius /\n              Math.cos((Math.PI / 180) * coordinates[1]) /\n              resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill: new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => {\n      this.cdRef.detectChanges();\n    });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n  @Output() predefinedRadius = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [\n    SpatialFilterItemType.Address,\n    SpatialFilterItemType.Thematics\n  ];\n  public selectedItemType: SpatialFilterItemType =\n    SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> =\n    new NestedTreeControl<SpatialFilterThematic>((node) => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(\n    true,\n    []\n  );\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new UntypedFormControl();\n  public geometryType: GeometryType;\n  public geometryTypeField = false;\n  public geometryTypes: GeometryType[] = [\n    GeometryType.Point,\n    GeometryType.Polygon\n  ];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new UntypedFormControl();\n  public bufferFormControl = new UntypedFormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.spatialFilterService\n      .loadThematicsList()\n      .subscribe((items: SpatialFilterThematic[]) => {\n        for (const item of items) {\n          this.childrens.push(item);\n          this.childrens.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        }\n        this.groups.push(\n          this.languageService.translate.instant('igo.geo.terrapi.limites')\n        );\n        const limits: SpatialFilterThematic = {\n          name: this.groups[0],\n          children: []\n        };\n        this.thematics.push(limits);\n        this.childrens.forEach((child) => {\n          if (child.group && this.groups.indexOf(child.group) === -1) {\n            this.groups.push(child.group);\n            const thematic: SpatialFilterThematic = {\n              name: child.group,\n              children: []\n            };\n            this.thematics.push(thematic);\n          }\n\n          if (!child.group) {\n            if (\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.AdmRegion'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.Arrond'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircFed'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircProv'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.DirReg'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.RegTour'\n                )\n            ) {\n              child.group = limits.name;\n            } else if (\n              child.name ===\n              this.languageService.translate.instant('igo.geo.terrapi.routes')\n            ) {\n              child.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.transport'\n              );\n            } else {\n              const thematic: SpatialFilterThematic = {\n                name: child.name,\n                children: [],\n                source: child.source\n              };\n              this.thematics.push(thematic);\n            }\n          }\n          this.thematics.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        });\n        this.thematics.forEach((thematic) => {\n          for (const child of this.childrens) {\n            if (child.group === thematic.name) {\n              thematic.children.push(child);\n            }\n          }\n        });\n      });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        if (value) {\n          this.value$.next(value);\n          this.drawZone = this.formControl.value as Feature;\n          if (this.buffer !== 0) {\n            this.drawZoneEvent.emit(this.drawZone);\n            this.bufferFormControl.setValue(this.buffer);\n          }\n        } else {\n          this.value$.next(undefined);\n          this.drawZone = undefined;\n        }\n      }\n    );\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500))\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(this.drawZone, SpatialFilterType.Polygon, value)\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.drawZone,\n              SpatialFilterType.Polygon,\n              value * 1000\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.buffer = 0;\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n          : this.bufferFormControl.setValue(\n              this.bufferFormControl.value / 1000\n            );\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n          : this.radiusFormControl.setValue(\n              this.radiusFormControl.value / 1000\n            );\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node)\n      ? this.treeControl.collapse(node)\n      : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.thematics.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach((children) => {\n        if (\n          this.selectedThematics.selected.find(\n            (thematic) => thematic === children\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach((child) => {\n      if (\n        this.selectedThematics.selected.find(\n          (thematic) => thematic.source === child.source\n        )\n      ) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ? this.selectedThematics.clear() : this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.selectedThematics.selected.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach((children) =>\n          this.selectedThematics.select(children)\n        );\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node)\n      ? node.children.forEach((child) => this.selectedThematics.deselect(child))\n      : this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (\n      this.selectedThematics.selected.find(\n        (thematic) => thematic.source === nodeSelected.source\n      ) !== undefined\n    ) {\n      selected = true;\n    }\n\n    this.childrens.forEach((children) => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach((thematic) => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n    if (this.isPoint()) {\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\n      if (this.freehandDrawIsActive) {\n        this.overlayStyle$.next(undefined);\n        this.drawStyle$.next(undefined);\n      }\n    } else {\n      this.predefinedRadius.emit(false);\n    }\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(debounceTime(500)).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.queryType !== undefined &&\n          this.zone !== undefined &&\n          this.selectedThematics.selected.length > 0\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    if (\n      this.type === SpatialFilterType.Polygon ||\n      this.type === SpatialFilterType.Point\n    ) {\n      if (\n        this.selectedItemType === SpatialFilterItemType.Address &&\n        this.formControl.value !== null\n      ) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.selectedThematics.selected.length > 0 &&\n          this.formControl.value !== null\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address\n      ? (disable = this.queryType === undefined)\n      : (disable =\n          this.queryType === undefined &&\n          this.selectedThematics.selected.length === 0);\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (formValue = this.formControl.value.radius)\n        : (formValue = this.formControl.value.radius / 1000);\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters &&\n            this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers &&\n            this.radiusFormControl.value >= 100)\n        ) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.radiusAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters\n            ? this.radiusFormControl.setValue(this.radius)\n            : this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(\n              'igo.geo.spatialFilter.radiusAlert',\n              'igo.geo.spatialFilter.warning'\n            );\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.type'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.searchResults'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"form-list\">\n  <mat-form-field class=\"zone-list\">\n    <mat-label>{{ 'igo.geo.spatialFilter.listLabel' | translate }}</mat-label>\n    <input\n      #input\n      type=\"text\"\n      placeholder=\"{{ 'igo.geo.spatialFilter.listLabel' | translate }}\"\n      matInput\n      [formControl]=\"formControl\"\n      [matAutocomplete]=\"auto\"\n    />\n    <mat-autocomplete\n      #auto=\"matAutocomplete\"\n      (optionSelected)=\"onZoneChange($event.option.value)\"\n      [displayWith]=\"displayFn\"\n    >\n      <mat-option\n        *ngFor=\"let entities of this.store.view.all$() | async\"\n        [value]=\"entities\"\n      >\n        {{ entities.properties.nom }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n  <div>\n    <div class=\"buffer-div\">\n      <mat-form-field class=\"buffer\">\n        <mat-label>{{ 'igo.geo.spatialFilter.buffer' | translate }}</mat-label>\n        <input\n          type=\"number\"\n          matInput\n          placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n          [formControl]=\"bufferFormControl\"\n          [value]=\"0\"\n          [readonly]=\"!zone\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\n\nimport { Feature } from '../../../feature';\nimport { Layer } from '../../../layer';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from './../../shared/spatial-filter.enum';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatAutocompleteModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    MatSelectModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new UntypedFormControl();\n\n  public bufferFormControl = new UntypedFormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.store.view.filter((feature) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const featureNameNormalized = feature.properties.nom\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            return featureNameNormalized.includes(filterNormalized);\n          });\n        }\n      }\n    );\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500), distinctUntilChanged())\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value * 1000,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService\n        .loadItemById(feature, this.queryType)\n        .subscribe((featureGeom: Feature) => {\n          this.selectedZone = featureGeom;\n          this.zoneChange.emit(featureGeom);\n        });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n        : this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\"\n>\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.spatialFilter.searchLabel' | translate\n      }}</mat-label>\n      <mat-select\n        (selectionChange)=\"onSelectionChange()\"\n        [(value)]=\"selectedQueryType\"\n      >\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{ 'igo.geo.terrapi.' + queryType | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\"\n    >\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\"\n      >\n        <mat-button-toggle\n          [value]=\"spatialType.Polygon\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\"\n        >\n          <mat-icon>pentagon</mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle\n          [value]=\"spatialType.Point\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\"\n        >\n          <mat-icon>circle</mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n</mat-tab-group>\n","import { NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Feature } from '../../../feature';\nimport { Layer } from '../../../layer';\nimport { MeasureLengthUnit } from '../../../measure';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { SpatialFilterListComponent } from '../spatial-filter-list/spatial-filter-list.component';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    SpatialFilterListComponent,\n    MatButtonToggleModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = [\n    'Arrond',\n    'CircFed',\n    'CircProv',\n    'DirReg',\n    'Mun',\n    'MRC',\n    'AdmRegion',\n    'RegTour'\n  ];\n  public selectedTypeIndex = new UntypedFormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !== 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle\n        class=\"time-filter-mat-datetimepicker-toggle\"\n        [for]=\"datetimePicker\"\n        matSuffix\n      ></mat-datetimepicker-toggle>\n      <mat-datetimepicker\n        #datetimePicker\n        [type]=\"type\"\n        [openOnFocus]=\"true\"\n        [timeInterval]=\"5\"\n      ></mat-datetimepicker>\n      <input\n        matInput\n        autocomplete=\"false\"\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"minDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #minDatetimePicker\n          [type]=\"type\"\n          [openOnFocus]=\"true\"\n          [timeInterval]=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"(startDate)\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"maxDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #maxDatetimePicker\n          [type]=\"type\"\n          [openOnFocus]=\"true\"\n          [timeInterval]=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type === 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-select\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [(ngModel)]=\"year\"\n        (selectionChange)=\"handleYearChange($event)\"\n      >\n        <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{\n          year\n        }}</mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [(ngModel)]=\"startYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option\n            [value]=\"startYear\"\n            *ngFor=\"let startYear of startListYears\"\n            >{{ startYear }}</mat-option\n          >\n        </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [(ngModel)]=\"endYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{\n            endYear\n          }}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<br />\n<div\n  *ngIf=\"!isRange && style === 'slider' && type === 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m mat-typography\"\n>\n  <span>{{ startYear }}</span>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"startYear\"\n    [max]=\"endYear\"\n    [color]=\"color\"\n    thumbLabel\n    [disabled]=\"!options.enabled || !layer.visible\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n      (change)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n    />\n  </mat-slider>\n  <span>{{ endYear }}</span>\n  <p *ngIf=\"options.enabled\" class=\"date-below\">{{ year }}</p>\n  <div #actions class=\"igo-layer-actions-container\">\n    <mat-slide-toggle\n      (change)=\"toggleFilterState()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n      [color]=\"color\"\n      [checked]=\"options.enabled\"\n      [disabled]=\"!layer.visible\"\n    >\n    </mat-slide-toggle>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"playYear($event)\"\n    >\n      <mat-icon>{{ playIcon }}</mat-icon>\n    </button>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"resetFilter($event)\"\n    >\n      <mat-icon>{{ resetIcon }}</mat-icon>\n    </button>\n  </div>\n</div>\n\n<div\n  *ngIf=\"style === 'slider' && type !== 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m\"\n>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"dateToNumber(min)\"\n    [max]=\"dateToNumber(max)\"\n    thumbLabel\n    (selectionChange)=\"handleSliderDateChange($event)\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderDateChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <p class=\"date-below\">{{ handleSliderTooltip() }}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon>{{ playIcon }}</mat-icon>\n  </button>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  DateAdapter,\n  MatNativeDateModule,\n  MatOptionModule,\n  ThemePalette\n} from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSlider, MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { MatDatetimepickerModule } from '@mat-datetimepicker/core';\nimport { default as moment } from 'moment';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterStyle, TimeFilterType } from '../shared/time-filter.enum';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatDatetimepickerModule,\n    MatNativeDateModule, // For the DateAdapter provider\n    MatInputModule,\n    FormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color: ThemePalette = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play_circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach((value) => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        (that) => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        () => {\n          if (this.year + this.mySlider.step > this.max.getFullYear()) {\n            this.stopFilter();\n          } else {\n            this.year = this.year + this.mySlider.step;\n          }\n          this.yearChange.emit(this.year);\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n  >\n    expand_less\n  </mat-icon>\n\n  <span\n    matListItemTitle\n    (click)=\"toggleLegendOnClick()\"\n    [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n    >{{ layer.title }}</span\n  >\n\n  <button\n    *ngIf=\"header\"\n    mat-icon-button\n    matListItemMeta\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      layer.visible\n        ? ('igo.geo.layer.hideLayer' | translate)\n        : ('igo.geo.layer.showLayer' | translate)\n    \"\n    (click)=\"layer.visible = !layer.visible\"\n  >\n    <mat-icon [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n      >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n    </mat-icon>\n  </button>\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]=\"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\"\n  >\n  </igo-time-filter-form>\n</div>\n","import { AsyncPipe, NgClass, NgIf, NgStyle } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { TimeFilterableDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { TimeFilterFormComponent } from '../time-filter-form/time-filter-form.component';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    NgStyle,\n    MatButtonModule,\n    MatTooltipModule,\n    NgClass,\n    LayerLegendComponent,\n    TimeFilterFormComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ],\n  providers: [TimeFilterService]\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<button\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    >history</mat-icon\n  >\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n>\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\"\n  >\n  </igo-time-filter-item>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { TimeFilterableDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { TimeFilterItemComponent } from '../time-filter-item/time-filter-item.component';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    TimeFilterItemComponent,\n    ListItemDirective,\n    IgoLanguageModule\n  ]\n})\nexport class TimeFilterButtonComponent implements OnInit {\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template\n    ngFor\n    let-layer\n    [ngForOf]=\"layers | filterableDataSource: 'time'\"\n  >\n    <igo-time-filter-item\n      [header]=\"true\"\n      igoListItem\n      [layer]=\"layer\"\n    ></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import { NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input\n} from '@angular/core';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { FilterableDataSourcePipe } from '../shared/filterable-datasource.pipe';\nimport { TimeFilterItemComponent } from '../time-filter-item/time-filter-item.component';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    TimeFilterItemComponent,\n    ListItemDirective,\n    FilterableDataSourcePipe\n  ]\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { TimeFilterListComponent } from './time-filter-list.component';\n\n@Directive({\n  selector: '[igoTimeFilterListBinding]',\n  standalone: true\n})\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\n  private component: TimeFilterListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: TimeFilterListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers;\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon>file_save</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared';\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-export-button',\n  templateUrl: './export-button.component.html',\n  styleUrls: ['./export-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ExportButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor() {}\n\n  get options(): DataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n\n  layerIsExportable(): boolean {\n    if (\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\n      (this.layer.dataSource.options.download &&\n        this.layer.dataSource.options.download.url) ||\n      (this.layer.options.workspace?.enabled &&\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n  private httpClient: HttpClient;\n\n  constructor(handler: HttpBackend) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    return new Promise((resolve, _reject) => {\n      this.httpClient\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(\n            baseStyleList,\n            styleListResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum([\n  'URL',\n  'GeoJSON',\n  'GML',\n  'GPX',\n  'KML',\n  'Shapefile',\n  'CSVcomma',\n  'CSVsemicolon'\n]);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { downloadContent } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, Observer } from 'rxjs';\nimport { encode } from 'windows-1252';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\nimport { EncodingFormat, ExportFormat } from './export.type';\n\nconst SHAPEFILE_FIELD_MAX_LENGHT = 255;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(\n      olFeatures,\n      format,\n      '_featureStore'\n    );\n\n    return this.exportAsync(\n      exportOlFeatures,\n      format,\n      title,\n      encoding,\n      projectionIn,\n      projectionOut\n    );\n  }\n\n  public generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    excludePrefix: string = '_'\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      let keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith(excludePrefix));\n\n      if (format === ExportFormat.Shapefile && olFeature.get('_style')) {\n        const style = JSON.stringify(olFeature.get('_style'));\n        if (style.length > SHAPEFILE_FIELD_MAX_LENGHT)\n          keys = keys.filter((key) => key !== '_style');\n      }\n\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          if (key && key !== 'geometry') {\n            key === 'id' && olFeature.get('draw')\n              ? (comment += key + ':' + olFeature.get('draw') + '   \\r\\n')\n              : (comment += key + ':' + olFeature.get(key) + '   \\r\\n');\n          }\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        {\n          geometry: olFeature.getGeometry()\n        }\n      );\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(\n              olFeatures,\n              observer,\n              format,\n              title,\n              projectionIn,\n              projectionOut\n            );\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(\n          olFeatures,\n          observer,\n          format,\n          title,\n          encoding,\n          projectionIn,\n          projectionOut\n        );\n      } else {\n        this.exportToFile(\n          olFeatures,\n          observer,\n          format,\n          title,\n          projectionIn,\n          projectionOut\n        );\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'attachment/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map((f) => {\n        const encodedProperties = String.fromCharCode.apply(\n          null,\n          encode(JSON.stringify(f.properties), { mode: 'replacement' })\n        );\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName =\n      format === 'Shapefile'\n        ? `${title}.zip`\n        : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .replace(/’/g, \"'\");\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: string\n  ): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find((olFeature) => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(\n            olFeature.getGeometry().getType()\n          ) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n    super('Error 500 with OGRE');\n    Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { MessageService } from '@igo2/core/message';\nimport { uuid } from '@igo2/utils';\n\nimport { first, of } from 'rxjs';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  computeOlFeaturesExtent,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport {\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '../../style/shared/feature/feature-style';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { StyleService } from '../../style/style-service/style.service';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  layerTitle: string,\n  layerService: LayerService,\n  storeToIdb: boolean = false\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const id = uuid();\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    id,\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  let randomStyle;\n  let editable: boolean = false;\n  if (\n    olFeatures[0].getKeys().includes('_style') ||\n    olFeatures[0].getKeys().includes('_mapTitle')\n  ) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = layerService.createLayer({\n    id,\n    title: layerTitle,\n    workspace: { enabled: true, searchIndexEnabled: true },\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\n    style: randomStyle\n  }) as VectorLayer;\n  layer.setExtent(computeOlFeaturesExtent(olFeatures, map.viewProjection));\n  map.addLayer(layer);\n  moveToOlFeatures(map.viewController, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.style'),\n        feature,\n        resolution\n      );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign(\n      {\n        title: layerTitle,\n        id: layerId || uuid(),\n        isIgoInternalLayer: true,\n        source,\n        style\n      },\n      imposedLayerOptions\n    )\n  );\n  map.addLayer(layer);\n  if (zoomTo) {\n    moveToOlFeatures(map.viewController, olFeatures);\n  }\n  return layer;\n}\n\nfunction padTo2Digits(num) {\n  return num.toString().padStart(2, '0');\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  messageService: MessageService,\n  layerService: LayerService,\n  confirmDialogService?: ConfirmDialogService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  let layerTitle = computeLayerTitleFromFile(file);\n\n  const obs$ = confirmDialogService\n    ? confirmDialogService.open('igo.geo.import.promptStoreToIdb')\n    : of(false);\n\n  obs$.pipe(first()).subscribe((confirm) => {\n    const d = new Date();\n    const dformat =\n      [\n        d.getFullYear(),\n        padTo2Digits(d.getMonth() + 1),\n        padTo2Digits(d.getDate())\n      ].join('/') +\n      ' ' +\n      [padTo2Digits(d.getHours()), padTo2Digits(d.getMinutes())].join(':');\n\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\n    if (!styleListService) {\n      addLayerAndFeaturesToMap(\n        features,\n        map,\n        contextUri,\n        layerTitle,\n        layerService,\n        confirm\n      );\n    } else {\n      addLayerAndFeaturesStyledToMap(\n        features,\n        map,\n        layerTitle,\n        styleListService,\n        styleService\n      );\n    }\n\n    messageService.success(\n      'igo.geo.dropGeoFile.success.text',\n      'igo.geo.dropGeoFile.success.title',\n      undefined,\n      { value: layerTitle }\n    );\n  });\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalid.text',\n    'igo.geo.dropGeoFile.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.unreadable.text',\n    'igo.geo.dropGeoFile.unreadable.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.tooLarge.text',\n    'igo.geo.dropGeoFile.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.empty.text',\n    'igo.geo.dropGeoFile.empty.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalidSRS.text',\n    'igo.geo.dropGeoFile.invalidSRS.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.ogreServer.text',\n    'igo.geo.dropGeoFile.ogreServer.title'\n  );\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportOgreServerError,\n  ImportSRSError,\n  ImportSizeError,\n  ImportUnreadableFileError\n} from './import.errors';\nimport { ImportExportServiceOptions } from './import.interface';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static formatExtensionAssociation = {\n    GeoJSON: 'geojson',\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'zip'\n  };\n\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService\n  ) {\n    const importConfig = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    this.ogreUrl = importConfig.url;\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    if (importConfig.formats) {\n      ImportService.allowedExtensions = importConfig.formats\n        .map((format) => ImportService.formatExtensionAssociation[format])\n        .filter((e) => e);\n      if (ImportService.allowedExtensions.includes('geojson')) {\n        ImportService.allowedExtensions.push('json');\n      }\n    }\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const allowedExtensions = ImportService.allowedExtensions;\n    let zipMimeTypes = [];\n    if (allowedExtensions.includes('zip')) {\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\n    }\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...zipMimeTypes\n    ];\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (\n          errMsg &&\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"selectedMode\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"importForm\"\n  *ngIf=\"selectedMode === 'import'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.importProjPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of projections$ | async\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle *ngIf=\"projection.translateKey\">\n            {{\n              'igo.geo.importExportForm.projections.' + projection.translateKey\n                | translate: projection\n            }}\n          </p>\n          <p matListItemTitle *ngIf=\"!projection.translateKey\">\n            {{ projection.alias }}\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      importForm.invalid\n        ? ('igo.geo.importExportForm.projections.choose' | translate)\n        : ('igo.geo.importExportForm.importButton' | translate)\n    \"\n    class=\"igo-form-button-group\"\n  >\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\"\n    >\n      {{ 'igo.geo.importExportForm.importButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($any($event.target).files)\"\n    />\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n      <li>\n        {{ 'igo.geo.importExportForm.importFormatAuthorized' | translate }}\n      </li>\n      <li>{{ 'igo.geo.importExportForm.importShpZip' | translate }}</li>\n    </ul>\n  </div>\n  <igo-custom-html\n    *ngIf=\"importHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\"\n  >\n  </igo-custom-html>\n</section>\n\n<section\n  class=\"mat-typography\"\n  *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\"\n>\n  <h4>{{ 'igo.geo.importExportForm.exportNoLayersExportable' | translate }}</h4>\n</section>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportLayerPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{ layers.length ? getLayerTitleById(layers[0]) : '' }}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{ layers.length - 1 }}\n            {{\n              (layers?.length === 2\n                ? 'igo.geo.importExportForm.other'\n                : 'igo.geo.importExportForm.others'\n              ) | translate\n            }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of exportableLayers$ | async\"\n          [ngClass]=\"{\n            'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)\n          }\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle>{{ layer.title }}</p>\n          <p matListItemTitle>\n            <mat-slide-toggle\n              *ngIf=\"layerHasSelectedFeatures(layer)\"\n              (click)=\"onlySelectedClick($event, layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event, layer.id)\"\n            >\n              <small>{{\n                'igo.geo.importExportForm.exportSelectedFeature' | translate\n              }}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportFormatPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let format of formats$ | async | keyvalue\"\n            [value]=\"format.key\"\n          >\n            {{ 'igo.geo.export.format.' + format.value | translate }}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{ 'igo.geo.export.noFormat.title' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"forceNaming && form.value.format !== 'URL'\"\n  >\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"name\"\n        placeholder=\"{{\n          'igo.geo.importExportForm.exportFileNamePlaceholder' | translate\n        }}\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"\n      form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\n    \"\n  >\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.encodingPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let encoding of encodings$ | async | keyvalue\"\n            [value]=\"encoding.key\"\n          >\n            {{ 'igo.geo.export.encoding.' + encoding.value | translate }}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"export-combine-layers mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\n    \"\n  >\n    <mat-slide-toggle\n      formControlName=\"combineLayers\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportCombineResults' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-separator mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' ||\n        form.value.format === 'CSVsemicolon') &&\n      form.value.combineLayers\n    \"\n  >\n    <mat-slide-toggle formControlName=\"separator\" [labelPosition]=\"'before'\">\n      {{ 'igo.geo.importExportForm.exportSeparator' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-options mat-typography\"\n    *ngIf=\"form.value.format !== 'URL'\"\n  >\n    <mat-slide-toggle\n      formControlName=\"featureInMapExtent\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportFeatureInExtent' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{\n        form.value.format !== 'URL'\n          ? ('igo.geo.importExportForm.exportButton' | translate)\n          : form.value.layers.length > 1\n            ? ('igo.geo.importExportForm.exportButtonLinks' | translate)\n            : ('igo.geo.importExportForm.exportButtonLink' | translate)\n      }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html\n    *ngIf=\"exportHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\"\n  >\n  </igo-custom-html>\n</form>\n","import { AsyncPipe, KeyValuePipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport {\n  MatSlideToggleChange,\n  MatSlideToggleModule\n} from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { EntityRecord } from '@igo2/common/entity';\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport type { WorkspaceStore } from '@igo2/common/workspace';\nimport { Workspace } from '@igo2/common/workspace';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\nimport { strEnum } from '@igo2/utils';\n\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\nimport olClusterSource from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { computeProjectionsConstraints } from '../../map/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportService } from '../shared/export.service';\nimport { EncodingFormat, ExportFormat } from '../shared/export.type';\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ImportExportServiceOptions } from '../shared/import.interface';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportError,\n  handleFileImportSuccess\n} from '../shared/import.utils';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    NgIf,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatTooltipModule,\n    MatButtonModule,\n    SpinnerComponent,\n    CustomHtmlComponent,\n    NgClass,\n    MatSlideToggleModule,\n    MatInputModule,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ],\n  providers: [ConfirmDialogService]\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: UntypedFormGroup;\n  public importForm: UntypedFormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n  public importHtmlClarifications: string;\n  public exportHtmlClarifications: string;\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  @Input() contextUri: string;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return (\n      (this.storageService.get('importExportPopupAllowed') as boolean) || false\n    );\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService,\n    private layerService: LayerService,\n    private confirmDialogService: ConfirmDialogService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n    this.importHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.importHtmlClarifications'\n    );\n    this.exportHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.exportHtmlClarifications'\n    );\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges.subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)\n        ) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers =\n          layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({\n            encoding: encodings[Object.keys(encodings)[0]]\n          });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (\n        format === ExportFormat.CSVcomma ||\n        format === ExportFormat.CSVsemicolon\n      ) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({\n          inputProj: {\n            translateKey: 'nad83',\n            alias: 'NAD83',\n            code: 'EPSG:4326',\n            zone: ''\n          }\n        });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code =\n          mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({\n          translateKey: 'mtm',\n          alias: `MTM ${mtmZone}`,\n          code,\n          zone: `${mtmZone}`,\n          extent: undefined,\n          def: undefined\n        });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code =\n          utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({\n          translateKey: 'utm',\n          alias: `UTM ${utmZone}`,\n          code,\n          zone: `${utmZone}`,\n          extent: undefined,\n          def: undefined\n        });\n      }\n    }\n\n    let configProjection: InputProjections[] = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = (this.config.getConfig('projections') ||\n        []) as InputProjections[];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(\n        (workspace) =>\n          (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace)\n            .layer.id === id\n      );\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView.firstBy(\n        (record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        }\n      );\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(\n        (layerId) => layerId !== id\n      );\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find((layerId) => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(\n      (layerId) => layerId === layer.id\n    )\n      ? true\n      : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (\n      !this.popupChecked &&\n      data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 ||\n        data.format === ExportFormat.URL) &&\n      !this.popupAllowed\n    ) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string; features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = '';\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (\n        !(\n          data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma\n        ) ||\n        !data.combineLayers ||\n        data.layers.length === 1\n      ) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant(\n          'igo.geo.export.combinedLayers'\n        );\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (\n        data.format === ExportFormat.URL &&\n        dSOptions.download &&\n        (dSOptions.download.url || dSOptions.download.dynamicUrl)\n      ) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi)\n            ? this.downloadService.open(lay)\n            : window.open(url, '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n        if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          data.featureInMapExtent\n        ) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter(\n              (e: EntityRecord<object>) =>\n                e.state.inMapExtent && e.state.selected\n            )\n            .map((e) => (e.entity as Feature).ol);\n        } else if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          !data.featureInMapExtent\n        ) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.selected)\n            .map((e) => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent)\n            .map((e) => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .map((e) => (e.entity as Feature).ol);\n        }\n      } else {\n        const ol = lay.dataSource.ol as olVectorSource | olClusterSource;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      let geomTypes: { geometryType: string; features: any[] }[] = [];\n      if (\n        data.format === ExportFormat.Shapefile ||\n        data.format === ExportFormat.GPX\n      ) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(\n            (geomType) => geomType.geometryType === featureGeomType\n          );\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({\n              geometryType: featureGeomType,\n              features: [olFeature]\n            });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach((geomType) => {\n        geomType.features.forEach((feature) => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [\n              feature.get('longitude'),\n              feature.get('latitude')\n            ];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter((geomType) =>\n          ['LineString', 'Point'].includes(geomType.geometryType)\n        );\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          this.messageService.error(\n            'igo.geo.export.gpx.error.poly.text',\n            'igo.geo.export.gpx.error.poly.title',\n            { timeOut: 20000 }\n          );\n        }\n      } else if (\n        (data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma) &&\n        data.combineLayers\n      ) {\n        geomTypes.forEach((geomType) => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach((geomType) => {\n            geomType.features.forEach((currentFeature) => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (\n                    currentFeature.get('_featureStore').layer.options.title !==\n                    previousFeature.get('_featureStore').layer.options.title\n                  ) {\n                    const titleEmptyRows = this.createTitleEmptyRows(\n                      previousFeature,\n                      currentFeature\n                    );\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(\n                    currentFeature,\n                    currentFeature\n                  );\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        this.messageService.error(\n          'igo.geo.export.nothing.text',\n          'igo.geo.export.nothing.title',\n          { timeOut: 20000 }\n        );\n      } else {\n        if (\n          !(\n            data.format === ExportFormat.CSVsemicolon ||\n            data.format === ExportFormat.CSVcomma\n          ) ||\n          !data.combineLayers\n        ) {\n          geomTypes.map((geomType) =>\n            this.exportService\n              .export(\n                geomType.features,\n                data.format,\n                filename + geomType.geometryType,\n                data.encoding,\n                this.map.projection\n              )\n              .subscribe(\n                () => {},\n                (error: Error) => this.onFileExportError(error),\n                () => {\n                  this.onFileExportSuccess();\n\n                  geomType.features.forEach((feature) => {\n                    this.circleToPoint(feature);\n                  });\n\n                  this.loading$.next(false);\n                }\n              )\n          );\n        }\n      }\n    }\n    if (\n      (data.format === ExportFormat.CSVsemicolon ||\n        data.format === ExportFormat.CSVcomma) &&\n      data.combineLayers\n    ) {\n      this.exportService\n        .export(\n          featuresCSV,\n          data.format,\n          filename,\n          data.encoding,\n          this.map.projection\n        )\n        .subscribe(\n          () => {},\n          (error: Error) => this.onFileExportError(error),\n          () => {\n            this.onFileExportSuccess();\n\n            featuresCSV.forEach((feature) => {\n              this.circleToPoint(feature);\n            });\n\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach((previousKey) => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach((key) => {\n      const sameKeys: boolean =\n        previousFeatureKeys.length === currentFeatureKeys.length &&\n        previousFeatureKeys.every(\n          (value, index) => value === currentFeatureKeys[index]\n        );\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title +\n            ' ===============>',\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!currentFeatureKeys.includes(key)) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([\n        feature.get('longitude'),\n        feature.get('latitude')\n      ]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]]\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    const importExportOptions = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    const confirmDialogService = importExportOptions?.allowToStoreLayer\n      ? this.confirmDialogService\n      : undefined;\n    if (!importExportOptions?.importWithStyle) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const extraMessage = preCheck\n      ? 'igo.geo.export.popupBlocked.selectAgain'\n      : 'igo.geo.export.popupBlocked.retry';\n    this.messageService.error(\n      'igo.geo.export.popupBlocked.text',\n      'igo.geo.export.popupBlocked.title',\n      { timeOut: 20000 },\n      { extraMessage }\n    );\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private loadConfig() {\n    const forceNamingConfig = this.config.getConfig('importExport.forceNaming');\n    this.forceNaming =\n      forceNamingConfig !== undefined ? forceNamingConfig : false;\n\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (\n      format === ExportFormat.CSVcomma ||\n      format === ExportFormat.CSVsemicolon\n    ) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({\n            layer: layer.title,\n            formats: this.validateListFormat(\n              layer.dataSource.options.download.allowedFormats\n            )\n          });\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url ||\n            layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    const configImportExportFormats = this.config.getConfig(\n      'importExport.formats'\n    );\n    if (configImportExportFormats) {\n      const validatedListFormat = this.validateListFormat(\n        configImportExportFormats\n      );\n      appliedformats = appliedformats.filter((af) =>\n        validatedListFormat.includes(af)\n      );\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map((list) => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter((value) =>\n          previousCustomListFormats.includes(value)\n        );\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter((value) =>\n        appliedformats.includes(value)\n      );\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              'igo.geo.export.customList.text',\n              'igo.geo.export.customList.title',\n              undefined,\n              { value: layersWithCustomFormats.join() }\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          'igo.geo.export.noFormat.text',\n          'igo.geo.export.noFormat.title'\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import {\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  getEntityProperty\n} from '@igo2/common/entity';\nimport { MessageService } from '@igo2/core/message';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.geo.export.failed.text',\n    'igo.geo.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.geo.export.success.text',\n    'igo.geo.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.geo.export.nothing.text',\n    'igo.geo.export.nothing.title'\n  );\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(\n  rows: any[][],\n  fileName: string,\n  separator: string = ';'\n) {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(\n  entities: object[],\n  columns: EntityTableColumn[]\n) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (\n        column.renderer === undefined ||\n        column.renderer === EntityTableColumnRenderer.Default\n      ) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <mat-checkbox\n    *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    matListItemIcon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\"\n  >\n  </mat-checkbox>\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleLegendOnClick()\"\n  >\n    {{ layer.title }}\n  </span>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"!selectionMode\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"eyeTooltip | translate\"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        >{{ (layer.visible$ | async) ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectionMode\"\n      class=\"selection-eye\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        layer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"!selectionMode\"\n      class=\"actions-button\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.moreOptions' | translate\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"toggleLayerTool()\"\n    >\n      <mat-icon>more_horiz</mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Renderer2\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { LayerLegendComponent } from '../layer-legend/layer-legend.component';\nimport { Layer } from '../shared/layers/layer';\nimport { TooltipType } from '../shared/layers/layer.interface';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatCheckboxModule,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    MatBadgeModule,\n    NgClass,\n    LayerLegendComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (\n      value &&\n      this.layer &&\n      value.id === this.layer.id &&\n      !this.selectionMode\n    ) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible\n        ? 'igo.geo.layer.hideLayer'\n        : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility(event: Event) {\n    event.stopPropagation();\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({ layer: this.layer, check: this.layerCheck });\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { LayerLegendComponent } from '../layer-legend/layer-legend.component';\nimport { Layer } from '../shared/layers/layer';\nimport { TooltipType } from '../shared/layers/layer.interface';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatListModule, MatTooltipModule, LayerLegendComponent]\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    >{{ layer.title }}</span\n  >\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n    [checked]=\"showAllLegendsValue\"\n    class=\"mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n    [labelPosition]=\"'before'\"\n    (change)=\"toggleShowAllLegends($event.checked)\"\n  >\n    {{ 'igo.geo.layer.legend.showAll' | translate }}\n  </mat-slide-toggle>\n  <mat-divider\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n  ></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item\n        *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n        igoListItem\n        [layer]=\"layer\"\n        [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      >\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      allowShowAllLegends\n    \"\n  >\n    {{\n      'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate\n    }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisible' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleButZoom' | translate }}\n  </p>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport {\n  BehaviorSubject,\n  EMPTY,\n  ReplaySubject,\n  Subscription,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\nimport { LayerLegendItemComponent } from '../layer-legend-item/layer-legend-item.component';\nimport { Layer } from '../shared/layers/layer';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatSlideToggleModule,\n    MatTooltipModule,\n    MatDividerModule,\n    ListComponent,\n    NgFor,\n    LayerLegendItemComponent,\n    ListItemDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> =\n    new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() {}\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && !layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers\n            .slice(0)\n            .filter(\n              (layer) =>\n                layer.showInLayerList !== false &&\n                (!this.excludeBaseLayers || !layer.baseLayer)\n            )\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter(\n      (layer: Layer) => layer.visible && layer.isInResolutionsRange\n    );\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n    this.showAllLegendsValue = toggle;\n    this.next();\n    this.allLegendsShown.emit(toggle);\n  }\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { LayerLegendListComponent } from './layer-legend-list.component';\n\n@Directive({\n  selector: '[igoLayerLegendListBinding]',\n  standalone: true\n})\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerLegendListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerLegendListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n\n        this.layersVisibility$$ = combineLatest(\n          shownLayers.map((layer: Layer) => layer.visible$)\n        ).subscribe((r) => {\n          this.component.change$.next();\n        });\n      });\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n    [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n    matTooltipShowDelay=\"500\"\n    type=\"text\"\n    [(ngModel)]=\"term\"\n  />\n  <button\n    *ngIf=\"term\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    color=\"warn\"\n    (click)=\"clearTerm()\"\n  >\n    <mat-icon>close</mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"actions-container\">\n  <button\n    class=\"sort-alpha\"\n    [class.--active]=\"sortAlpha\"\n    [color]=\"sortAlpha ? 'warn' : 'primary'\"\n    mat-icon-button\n    [matTooltip]=\"\n      sortAlpha\n        ? ('igo.geo.layer.sortMapOrder' | translate)\n        : ('igo.geo.layer.sortAlphabetically' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSortAlpha()\"\n  >\n    <mat-icon>sort_by_alpha</mat-icon>\n  </button>\n  <button\n    class=\"only-visible\"\n    mat-icon-button\n    [disabled]=\"layersAreAllVisible && !onlyVisible\"\n    [color]=\"onlyVisible ? 'warn' : 'primary'\"\n    [matTooltip]=\"\n      onlyVisible\n        ? ('igo.geo.layer.resetLayersList' | translate)\n        : ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleOnlyVisible()\"\n  >\n    <mat-icon\n      aria-hidden=\"false\"\n      matBadge=\"icon\"\n      igoMatBadgeIcon=\"visibility\"\n      [igoMatBadgeInverseColor]=\"true\"\n      [igoMatBadgeInheritColor]=\"true\"\n    >\n      {{ onlyVisible ? 'filter_alt_off' : 'filter_alt' }}\n    </mat-icon>\n  </button>\n\n  <button\n    class=\"selection-mode\"\n    mat-icon-button\n    color=\"primary\"\n    [matTooltip]=\"\n      selectionMode\n        ? ('igo.geo.layer.deactivateSelectionMode' | translate)\n        : ('igo.geo.layer.activateSelectionMode' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSelectionMode()\"\n  >\n    <mat-icon>{{\n      selectionMode ? 'library_add_check' : 'filter_none'\n    }}</mat-icon>\n  </button>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  FloatLabelType,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    IgoLanguageModule\n  ]\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((keyword) => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe((onlyVisible) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe((sortAlpha) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower'\n}\n","<igo-layer-list-tool\n  *ngIf=\"showToolbar$ | async\"\n  floatLabel=\"auto\"\n  [layersAreAllVisible]=\"layersAreAllVisible\"\n  [term]=\"layerFilterAndSortOptions.keyword\"\n  [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n  [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n  (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n  (selection)=\"toggleSelectionMode($event)\"\n>\n</igo-layer-list-tool>\n\n<div *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"\n  >\n    {{\n      selectAllCheck\n        ? ('igo.geo.layer.deselectAll' | translate)\n        : ('igo.geo.layer.selectAll' | translate)\n    }}\n  </mat-checkbox>\n</div>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item\n      *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\"\n    >\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel\n  *ngIf=\"!selection && layerTool && activeLayer\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"activeLayer.title\"\n>\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Lower, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabled\"\n        >arrow_downward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Raise, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabled\"\n        >arrow_upward</mat-icon\n      >\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"badgeOpacity\"\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        >opacity</mat-icon\n      >\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"panel-opacity-menu\">\n      <mat-slider\n        id=\"opacity-slider\"\n        color=\"primary\"\n        discrete\n        step=\"5\"\n        [min]=\"0\"\n        [max]=\"100\"\n        [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n        (click)=\"$event.stopPropagation()\"\n        matTooltipShowDelay=\"500\"\n        tooltip-position=\"below\"\n        #ngSlider\n        ><input\n          matSliderThumb\n          [value]=\"opacity\"\n          (input)=\"\n            changeOpacity({\n              source: ngSliderThumb,\n              parent: ngSlider,\n              value: ngSliderThumb.value\n            })\n          \"\n          #ngSliderThumb=\"matSliderThumb\"\n        />\n      </mat-slider>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\"\n    >\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\"\n        >frame_inspect</mat-icon\n      >\n    </button>\n\n    <ng-container\n      igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{ layer: activeLayer }\"\n    >\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel\n  *ngIf=\"selection && layers.length > 0\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"'igo.geo.layer.tools' | translate\"\n>\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        isAllLayersRemovable(layersChecked)\n          ? ('igo.geo.layer.removeSelectedLayers' | translate)\n          : ('igo.geo.layer.removeSelectedLayersRestriction' | translate)\n      \"\n      (click)=\"removeLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"'!'\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n        >delete</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? ('igo.geo.layer.showSelectedLayers' | translate)\n          : ('igo.geo.layer.hideSelectedLayers' | translate)\n      \"\n      (click)=\"toggleVisibility(layersChecked)\"\n    >\n      <mat-icon>{{\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? 'visibility_off'\n          : 'visibility'\n      }}</mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabledSelection\"\n        >arrow_downward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabledSelection\"\n        >arrow_upward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon>opacity</mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <!-- TODO: The 'tickInterval' property no longer exists -->\n        <mat-slider\n          *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          showTickMarks\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click)=\"$event.stopPropagation()\"\n          ><input matSliderThumb />\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"\n        layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\n      \"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\"\n    >\n      <mat-icon>frame_inspect</mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import { AsyncPipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ContentChild,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSliderChange, MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olextent from 'ol/extent';\n\nimport {\n  BehaviorSubject,\n  EMPTY,\n  ReplaySubject,\n  Subscription,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport {\n  getAllChildLayersByProperty,\n  getRootParentByProperty\n} from '../../map/shared/linkedLayers.utils';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MetadataLayerOptions,\n  MetadataOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerItemComponent } from '../layer-item/layer-item.component';\nimport { LayerListToolComponent } from '../layer-list-tool/layer-list-tool.component';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties } from '../shared/layers/layer.interface';\nimport {\n  LayerListControlsEnum,\n  LayerListDisplacement\n} from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerListToolComponent,\n    MatCheckboxModule,\n    MatDividerModule,\n    ListComponent,\n    NgFor,\n    LayerItemComponent,\n    ListItemDirective,\n    PanelComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatMenuModule,\n    MatSliderModule,\n    NgTemplateOutlet,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe((valStatus) => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n            this.layers.filter(\n              (lay) => lay.baseLayer !== true && lay.showInLayerList\n            ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerExtentIsValid(layer: Layer): boolean {\n    let valid = false;\n    if (layer.options.showButtonZoomToExtent === false) {\n      return false;\n    }\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layersExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [\n      number,\n      number,\n      number,\n      number\n    ];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange) {\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(\n    activeLayer: Layer,\n    actiontype: LayerListDisplacement,\n    fromUi: boolean = false\n  ) {\n    const sortedLayersToMove = [];\n    getRootParentByProperty(this.map, activeLayer, LinkedProperties.ZINDEX);\n    let rootParentByProperty = getRootParentByProperty(\n      this.map,\n      activeLayer,\n      LinkedProperties.ZINDEX\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = activeLayer;\n    }\n    const layersToMove = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      this.map,\n      rootParentByProperty,\n      layersToMove,\n      LinkedProperties.ZINDEX\n    );\n\n    this.layers.map((layer) => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, fromUi);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, fromUi);\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[0];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[checkItems.length - 1];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every((l) => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","import { Directive, OnDestroy, OnInit, Optional, Self } from '@angular/core';\n\nimport { RouteService } from '@igo2/core/route';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { LayerListComponent } from './layer-list.component';\n\n@Directive({\n  selector: '[igoLayerListBinding]',\n  standalone: true\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n        this.setLayersVisibilityStatus(\n          shownLayers,\n          this.component.excludeBaseLayers\n        );\n      });\n  }\n\n  private setLayersVisibilityStatus(\n    layers: Layer[],\n    excludeBaseLayers: boolean\n  ) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(\n      layers\n        .filter((layer) => layer.baseLayer !== excludeBaseLayers)\n        .map((layer: Layer) => layer.visible$)\n    )\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe(\n        (allLayersAreVisible: boolean) =>\n          (this.component.layersAreAllVisible = allLayersAreVisible)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<button\n  *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\"\n>\n  <mat-icon>my_location</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    (options && options.metadata && options.metadata.url) ||\n    (options && options.metadata && options.metadata.abstract)\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\"\n>\n  <mat-icon>info</mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  Input,\n  ViewEncapsulation\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialog,\n  MatDialogClose,\n  MatDialogContent,\n  MatDialogModule,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  MetadataLayerOptions,\n  MetadataOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ]\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog\n  ) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatButtonModule,\n    MatDialogClose,\n    NgIf,\n    MatDialogContent\n  ]\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\n\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { CommonModule } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core/message';\n\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\n\n@NgModule({\n  imports: [CommonModule, IgoMessageModule, QueryDirective],\n  exports: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { SearchBarComponent } from './search-bar.component';\n\n/**\n * @deprecated import the SearchBarComponent directly\n */\n@NgModule({\n  imports: [SearchBarComponent],\n  exports: [SearchBarComponent]\n})\nexport class IgoSearchBarModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\nimport { SearchResultsComponent } from './search-results.component';\n\n/**\n * @deprecated import the components directly or the SEARCH_RESULTS_DIRECTIVES\n */\n@NgModule({\n  imports: [SearchResultsComponent, SearchResultAddButtonComponent],\n  exports: [SearchResultsComponent, SearchResultAddButtonComponent]\n})\nexport class IgoSearchResultsModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @deprecated import the SearchSelectorComponent directly\n */\n@NgModule({\n  imports: [SearchSelectorComponent],\n  exports: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchSettingsComponent } from './search-settings.component';\n\n/**\n * @deprecated import the SearchSettingsComponent directly\n */\n@NgModule({\n  imports: [SearchSettingsComponent],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule {}\n","import { SearchSourceService } from './search-source.service';\nimport { SearchSource } from './sources/source';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat}%2C${lon}`;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return `https://www.google.com/maps/search/?api=1&query=${encodedName}`;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport * as olformat from 'ol/format';\nimport OlCircle from 'ol/geom/Circle';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport {\n  convertDDToDMS,\n  lonLatConversion,\n  roundCoordTo\n} from '../../../map/shared/map.utils';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { OsmLinks } from '../../../utils/osmLinks';\nimport { ReverseSearch, SearchResult } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { ReverseSearchOptions, SearchSourceOptions } from './source.interfaces';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[]\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled?: boolean\n  ): Observable<SearchResult<Feature>[]> {\n    return of([\n      this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)\n    ]);\n  }\n\n  private dataToResult(\n    data: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled: boolean\n  ): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce(\n      (obj, item) => ((obj[item.alias] = item.igo2CoordFormat), obj),\n      {}\n    );\n\n    const roundedCoordString = !reverseSearchCoordsFormatEnabled\n      ? roundCoordTo(data, 6).join(', ')\n      : roundCoordTo(data, 6).reverse().join(', ');\n\n    const roundedCoordStringDMS = !reverseSearchCoordsFormatEnabled\n      ? dataDMS.join(', ')\n      : dataDMS.reverse().join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform(\n        [data[0], data[1]],\n        'EPSG:4326',\n        'EPSG:3857'\n      );\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(\n        writer.writeGeometry(\n          polygonGeometry.transform('EPSG:3857', 'EPSG:4326')\n        )\n      );\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.conf'\n      );\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coord'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoord'\n        );\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coordDMS'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoordDMS'\n        );\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(properties, coords, {\n          GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n          GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n            data[0],\n            data[1]\n          ),\n          OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n          Route:\n            '<span class=\"routing\"> <u>' +\n            this.languageService.translate.instant('igo.geo.seeRouting') +\n            '</u> </span>'\n        }),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'location_on',\n        score: 100 // every coord exists\n      }\n    };\n  }\n}\n","import { Provider } from '@angular/core';\n\nexport interface SearchSourceOptions {\n  title?: string;\n  searchUrl?: string;\n  available?: boolean;\n  enabled?: boolean;\n  order?: number;\n  distance?: number;\n  params?: ISearchSourceParams;\n  settings?: SearchSourceSettings[];\n  showInPointerSummary?: boolean;\n  showInSettings?: boolean;\n  showAdvancedSettings?: boolean;\n}\n\nexport interface SearchSourceSettings {\n  type: 'radiobutton' | 'checkbox';\n  values: SettingOptions[];\n  title: string;\n  name: string;\n  allEnabled?: boolean;\n}\n\nexport interface ISearchSourceParams {\n  limit?: string;\n  datasets?: string;\n  ecmax?: string;\n  page?: string;\n  type?: string;\n}\n\nexport interface SettingOptions {\n  value: string | number;\n  enabled: boolean;\n  title: string;\n  hashtags?: string[];\n  available?: boolean;\n}\n\nexport interface TextSearchOptions {\n  params?: { [key: string]: string };\n  searchType?: 'Feature' | 'Layer'; // refer to search.enum.ts SEARCH_TYPES = [FEATURE, LAYER];\n  getEnabledOnly?: boolean;\n  extent?: [number, number, number, number];\n  page?: number;\n  sourceId?: string;\n  forceNA?: boolean;\n}\n\nexport interface ReverseSearchOptions {\n  distance?: number;\n  conf?: number;\n  zoom?: number;\n  params?: { [key: string]: string };\n}\n\nexport interface SearchSourceFeature<KindT extends SearchSourceKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum SearchSourceKind {\n  ICherche = 0,\n  IChercheReverse = 1,\n  Cadastre = 2,\n  CoordinatesReverse = 3,\n  ILayer = 4,\n  Nominatim = 5,\n  StoredQueries = 6,\n  StoredQueriesReverse = 7,\n  Workspace = 8\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * Coordinate search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the Coordinates search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the Coordinate search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n\nexport function withCoordinatesReverseSource(): SearchSourceFeature<SearchSourceKind.CoordinatesReverse> {\n  return {\n    kind: SearchSourceKind.CoordinatesReverse,\n    providers: [\n      provideCoordinatesReverseSearchSource(),\n      provideDefaultCoordinatesSearchResultFormatter()\n    ]\n  };\n}\n","import { ENGINE_ICON, IconSvg } from '@igo2/common/icon';\n\n/**\n * Icons mappings to be retrocompatible with iCherche\n */\nexport const ICHERCHE_ICONS: {\n  [key: string]: string | IconSvg;\n} = {\n  'map-marker': 'location_on',\n  city: 'location_city',\n  'flag-triangle': 'flag',\n  'map-marker-alert': 'fmd_bad',\n  'map-marker-radius': 'pin_drop',\n  'map-marker-multiple': 'local_post_office',\n  'map-legend': 'map',\n  bank: 'account_balance',\n  'map-search': 'search_insights',\n  'book-open-variant': 'menu_book',\n  'office-building': 'apartment',\n  'table-picnic': 'table_restaurant',\n  flash: 'flash_on',\n  engine: ENGINE_ICON,\n  'road-variant': 'add_road',\n  'baby-face-outline': 'child_care',\n  'home-account': 'location_home',\n  hospital: 'local_hospital',\n  pharmacy: 'local_pharmacy',\n  'police-badge-outline': 'local_police',\n  parking: 'local_parking',\n  tree: 'nature',\n  'home-city': 'home_work',\n  terrain: 'landscape',\n  'panorama-horizontal': 'panorama_horizontal'\n};\n","import {\n  HttpClient,\n  HttpParameterCodec,\n  HttpParams\n} from '@angular/common/http';\nimport { Inject, Injectable, Injector } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg } from '@igo2/common/icon';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { GoogleLinks } from './../../../utils/googleLinks';\nimport { ICHERCHE_ICONS } from './icherche-icons';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { SearchSource } from './source';\nimport {\n  ReverseSearchOptions,\n  SearchSourceOptions,\n  SearchSourceSettings,\n  TextSearchOptions\n} from './source.interfaces';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n      ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n      : [\n          'adresses',\n          'codes-postaux',\n          'routes',\n          'intersections',\n          'municipalites',\n          'mrc',\n          'regadmin',\n          'lieux'\n        ];\n\n    const showAdvancedParams = this.options.showAdvancedSettings;\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cycleStop',\n              value: 'haltes_cyclables',\n              enabled: types.indexOf('haltes_cyclables') !== -1,\n              hashtags: ['haltevelo', 'haltes_cyclables']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.restArea',\n              value: 'haltes_routieres',\n              enabled: types.indexOf('haltes_routieres') !== -1,\n              hashtags: ['halteroute', 'haltes_routieres']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cultpatri',\n              value: 'culture',\n              enabled: types.indexOf('culture') !== -1,\n              hashtags: ['grille', 'culture']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.unites',\n              value: 'unites',\n              enabled: types.indexOf('unites') !== -1,\n              hashtags: ['unites', 'adresse']\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        showAdvancedParams &&\n          ({\n            type: 'radiobutton',\n            title: 'ecmax',\n            name: 'ecmax',\n            values: [\n              {\n                title: '10 %',\n                value: 10,\n                enabled: ecmax === 10\n              },\n              {\n                title: '30 %',\n                value: 30,\n                enabled: ecmax === 30 || !ecmax\n              },\n              {\n                title: '50 %',\n                value: 50,\n                enabled: ecmax === 50\n              },\n              {\n                title: '75 %',\n                value: 75,\n                enabled: ecmax === 75\n              },\n              {\n                title: '100 %',\n                value: 100,\n                enabled: ecmax === 100\n              }\n            ]\n          } satisfies SearchSourceSettings),\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        } satisfies SearchSourceSettings\n      ].filter(Boolean)\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type: 'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(\n    response: IChercheResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(\n        this.dataToResult(data, term, response)\n      );\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    let icon: string | IconSvg = data.icon;\n    if (typeof icon == 'string' && Object.keys(ICHERCHE_ICONS).includes(icon)) {\n      icon = ICHERCHE_ICONS[icon];\n    }\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: icon || 'location_on',\n        score:\n          data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.geometry.coordinates[0],\n          data.geometry.coordinates[1]\n        );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = String(hashtag).substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.unites',\n              value: 'unites',\n              enabled: types.indexOf('unites') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'location_on',\n        pointerSummaryTitle: this.getSubtitle(data) + ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injector, Provider } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport {\n  IChercheReverseSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheSearchSource\n} from './icherche';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter(): Provider {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource(): Provider {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\nexport function withIChercheSource(): SearchSourceFeature<SearchSourceKind.ICherche> {\n  return {\n    kind: SearchSourceKind.ICherche,\n    providers: [\n      provideIChercheSearchSource(),\n      provideDefaultIChercheSearchResultFormatter()\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n\nexport function withIChercheReverseSource(): SearchSourceFeature<SearchSourceKind.IChercheReverse> {\n  return {\n    kind: SearchSourceKind.IChercheReverse,\n    providers: [\n      provideIChercheReverseSearchSource(),\n      provideDefaultIChercheSearchResultFormatter()\n    ]\n  };\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { LAYER } from '../../../layer/shared/layer.enums';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { QueryableDataSourceOptions } from '../../../query/shared/query.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport {\n  QueryFormat,\n  QueryHtmlTarget\n} from './../../../query/shared/query.enums';\nimport {\n  ILayerData,\n  ILayerDataSource,\n  ILayerItemResponse,\n  ILayerSearchSourceOptions,\n  ILayerServiceResponse\n} from './ilayer.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceSettings, TextSearchOptions } from './source.interfaces';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const showAdvancedParams = this.options.showAdvancedSettings;\n\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        showAdvancedParams &&\n          ({\n            type: 'radiobutton',\n            title: 'ecmax',\n            name: 'ecmax',\n            values: [\n              {\n                title: '10 %',\n                value: 10,\n                enabled: ecmax === 10\n              },\n              {\n                title: '30 %',\n                value: 30,\n                enabled: ecmax === 30\n              },\n              {\n                title: '50 %',\n                value: 50,\n                enabled: ecmax === 50 || !ecmax\n              },\n              {\n                title: '75 %',\n                value: 75,\n                enabled: ecmax === 75\n              },\n              {\n                title: '100 %',\n                value: 100,\n                enabled: ecmax === 100\n              }\n            ]\n          } satisfies SearchSourceSettings)\n      ].filter(Boolean)\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) =>\n          this.extractResults(response, term)\n        )\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse,\n    term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n      this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score:\n          data.score ||\n          computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions =\n      this.extractQueryParamsFromSourceUrl(url);\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params:\n          data.properties.format === 'wms'\n            ? { LAYERS: data.properties.name }\n            : undefined,\n        layer:\n          data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(url: string): {\n    queryFormat: QueryFormat;\n    queryHtmlTarget: QueryHtmlTarget;\n  } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = (value as any as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach((urlOpt) => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { ILayerSearchResultFormatter, ILayerSearchSource } from './ilayer';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      ILayerSearchResultFormatter\n    ]\n  };\n}\n\nexport function withILayerSource(): SearchSourceFeature<SearchSourceKind.ILayer> {\n  return {\n    kind: SearchSourceKind.ILayer,\n    providers: [\n      provideILayerSearchSource(),\n      provideILayerSearchResultFormatter()\n    ]\n  };\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { SearchBarComponent } from './search-bar/search-bar.component';\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { SEARCH_RESULTS_DIRECTIVES } from './search-results';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { SearchSelectorComponent } from './search-selector/search-selector.component';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { SearchSettingsComponent } from './search-settings/search-settings.component';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { SearchService } from './shared/search.service';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nexport const SEARCH_DIRECTIVES = [\n  SearchBarComponent,\n  SearchSelectorComponent,\n  ...SEARCH_RESULTS_DIRECTIVES,\n  SearchSettingsComponent,\n  SearchPointerSummaryDirective\n] as const;\n\n@NgModule({\n  imports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ]\n})\nexport class IgoSearchModule {\n  /**\n   * @deprecated import the provideSearch() directly and add the source in the provider property\n   */\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListOptions } from './style-list.interface';\nimport { StyleListService } from './style-list.service';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>(\n  'styleListOptions'\n);\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div mat-dialog-content>\n  <div class=\"edit-colorpicker\">\n    <form class=\"igo-form\" [formGroup]=\"form\">\n      <div class=\"color-picker\">\n        <ng-container *ngIf=\"linestringOnly !== true\">\n          <span>\n            <mat-icon class=\"stroke-palette-icon\">format_color_fill</mat-icon>\n            {{ 'igo.geo.style.fill' | translate }}\n          </span>\n\n          <igo-color-picker-form-field\n            formControlName=\"fill\"\n            (colorChange)=\"setLayerFillColor($event)\"\n          ></igo-color-picker-form-field>\n        </ng-container>\n\n        <span>\n          <mat-icon class=\"stroke-palette-icon\">border_color</mat-icon>\n          {{ 'igo.geo.style.stroke' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"stroke\"\n          (colorChange)=\"setLayerStrokeColor($event)\"\n        ></igo-color-picker-form-field>\n      </div>\n    </form>\n  </div>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancel()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Inject, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { ColorPickerFormFieldComponent } from '@igo2/common/color';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { asArray as ColorAsArray } from 'ol/color';\nimport olStyle from 'ol/style/Style';\n\nimport {\n  LayerMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer',\n  templateUrl: './style-modal-layer.component.html',\n  styleUrls: ['./style-modal-layer.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    ColorPickerFormFieldComponent,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class StyleModalLayerComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  private initialValues: StyleModalData;\n\n  private defaultValues: StyleModalData = {\n    fillColor: 'rgba(255,255,255,0.4)',\n    strokeColor: 'rgba(143,7,7,1)'\n  };\n\n  get layerOlStyle(): olStyle {\n    const style = this.data.layer.ol.getStyle();\n    return style instanceof Function ? undefined : (style as olStyle).clone();\n  }\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalLayerComponent>,\n    private formBuilder: UntypedFormBuilder,\n    @Inject(MAT_DIALOG_DATA) public data: LayerMatDialogData\n  ) {}\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.layer.ol.getSource().getFeatures()) {\n      if (feature.getGeometry()?.getType() !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [this.getLayerFillColor()],\n      stroke: [this.getLayerStrokeColor()]\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n    this.initialValues = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n  }\n\n  private getLayerFillColor() {\n    let fillColor = this.defaultValues.fillColor;\n    const style = this.layerOlStyle;\n    if (style?.getFill()?.getColor()) {\n      const arrayColor = style.getFill().getColor();\n      fillColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 0.4\n      })`;\n    }\n    return fillColor;\n  }\n\n  private getLayerStrokeColor() {\n    let strokeColor = this.defaultValues.strokeColor;\n    const style = this.layerOlStyle;\n    if (style?.getStroke()?.getColor()) {\n      const arrayColor = style.getStroke().getColor();\n      strokeColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 1\n      })`;\n    }\n    return strokeColor;\n  }\n\n  setLayerFillColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getFill().setColor(cAA);\n    s.getFill().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.fillColor = event;\n  }\n\n  setLayerStrokeColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getStroke().setColor(cAA);\n    s.getStroke().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.strokeColor = event;\n  }\n\n  cancel() {\n    this.dialogRef.close();\n    this.setLayerFillColor(this.initialValues.fillColor);\n    this.setLayerStrokeColor(this.initialValues.strokeColor);\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { StyleModalLayerComponent } from '../layer/style-modal-layer.component';\nimport { LayerMatDialogData } from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer-button',\n  templateUrl: './style-modal-layer-button.component.html',\n  styleUrls: ['./style-modal-layer-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class StyleModalLayerButtonComponent {\n  @Input() layer: VectorLayer;\n  constructor(private dialog: MatDialog) {}\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const data: LayerMatDialogData = { layer: this.layer };\n      const dialogRef = this.dialog.open(StyleModalLayerComponent, {\n        disableClose: false,\n        data,\n        autoFocus: false\n      });\n    }, 250);\n  }\n}\n","<button\n  mat-icon-button\n  color=\"primary\"\n  (click)=\"openStyleModalDialog()\"\n  [matTooltip]=\"'igo.geo.style.styleModalTooltipLayer' | translate\"\n>\n  <mat-icon class=\"style-icon\">palette </mat-icon>\n</button>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common/dynamic-component';\nimport { WidgetComponent } from '@igo2/common/widget';\n\nimport { OgcFilterableItemComponent } from '../../../filter/ogc-filterable-item/ogc-filterable-item.component';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [OgcFilterableItemComponent]\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [map]=\"map\"\n>\n</igo-ogc-filterable-item>\n","import { NgModule } from '@angular/core';\n\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @deprecated import the OgcFilterComponent directly\n */\n@NgModule({\n  imports: [OgcFilterComponent],\n  exports: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common/widget';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @deprecated import the WorkspaceSelectorDirective directly\n */\n@NgModule({\n  imports: [WorkspaceSelectorDirective],\n  exports: [WorkspaceSelectorDirective]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoWidgetModule } from '@igo2/common/widget';\n\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { provideOgcFilterWidget } from './widgets/widgets';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\n\n@NgModule({\n  imports: [\n    IgoWidgetModule,\n    IgoOgcFilterModule,\n    IgoWorkspaceSelectorModule,\n    MatDialogModule\n  ],\n  exports: [IgoOgcFilterModule],\n  providers: [provideOgcFilterWidget()]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { QueryFormat } from '../../query/shared/query.enums';\n\nexport type CatalogQueryFormatTypes = {\n  [key in QueryFormat]: string | string[];\n};\n\nexport enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms,\n  wmts,\n  baselayers,\n  arcgisrest,\n  tilearcgisrest,\n  imagearcgisrest,\n  composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TimeFilterOptions } from '../../filter/shared/time-filter.interface';\nimport { TooltipType } from '../../layer/shared/layers/layer.interface';\nimport { QueryFormat, QueryHtmlTarget } from '../../query/shared/query.enums';\nimport { TypeCatalogStrings } from './catalog.enum';\nimport { CatalogItem, CatalogItemGroup, ICatalog } from './catalog.interface';\n\nexport abstract class Catalog implements ICatalog {\n  id: string;\n  title: string;\n  url: string;\n  removable?: boolean;\n  externalProvider?: boolean;\n  abstract?: string;\n  forcedProperties?: any[];\n  items?: CatalogItem[];\n  type?: TypeCatalogStrings;\n  version?: string;\n  matrixSet?: string;\n  requestEncoding?: string;\n  regFilters?: string[];\n  groupImpose?: CatalogItemGroup;\n  groupSeparator?: string;\n  timeFilter?: TimeFilterOptions;\n  queryFormat?: QueryFormat;\n  queryHtmlTarget?: QueryHtmlTarget;\n  queryParams?: { [key: string]: string };\n  sourceOptions?: { [key: string]: any };\n  count?: number;\n  tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n  sortDirection?: 'asc' | 'desc';\n  setCrossOriginAnonymous?: boolean;\n  showLegend?: boolean;\n  profils?: string[];\n\n  constructor(options: Catalog) {\n    Object.assign(this, options);\n  }\n\n  public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nexport type CollectCatalogItemsFn = (\n  _this: Catalog\n) => Observable<CatalogItem[]>;\n","import { Observable } from 'rxjs';\n\nimport { Catalog, CollectCatalogItemsFn } from './catalog.abstract';\nimport { TypeCatalog } from './catalog.enum';\nimport {\n  CatalogItem,\n  CatalogItemGroup,\n  ICatalog,\n  ICompositeCatalog\n} from './catalog.interface';\n\nexport class WMSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wms];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class WMTSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wmts];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class BaselayersCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.baselayers];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class ArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class TileOrImageArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    public _collectCatlogItems: CollectCatalogItemsFn,\n    typeCatalog: TypeCatalog\n  ) {\n    super(options);\n    this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n  declare composite: ICatalog[];\n\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.composite];\n    this.type = TypeCatalog[sType];\n    this.url = null;\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport {\n  ArcGISRestCapabilitiesLayer,\n  ArcGISRestCapabilitiesLayerTypes\n} from '../../datasource/shared/capabilities.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport {\n  ArcGISRestDataSourceOptions,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { ImageLayerOptions, LayerOptions } from '../../layer/shared';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { QueryFormat } from '../../query/shared/query.enums';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { Catalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport {\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogServiceOptions,\n  ForcedProperty\n} from './catalog.interface';\nimport {\n  ArcGISRestCatalog,\n  BaselayersCatalog,\n  CompositeCatalog,\n  TileOrImageArcGISRestCatalog,\n  WMSCatalog,\n  WMTSCatalog\n} from './catalogs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n\n    const catalogConfig: CatalogServiceOptions =\n      this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      if (catalogConfig.baselayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items: CatalogItem[] = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (\n          capabilities.Service &&\n          capabilities.Service.Abstract &&\n          capabilities.Service.Abstract.length\n        ) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(\n          capabilities.Capability.Layer,\n          0,\n          finalLayers,\n          catalog.groupSeparator\n        );\n        const capabilitiesCapabilityLayer = Object.assign(\n          {},\n          capabilities.Capability.Layer\n        );\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(\n          (f) => f.Layer.length !== 0\n        );\n        this.includeRecursiveItems(catalog, capabilitiesCapabilityLayer, items);\n        return items;\n      }),\n      catchError(() => {\n        this.messageService.error(\n          'igo.geo.catalog.unavailable',\n          'igo.geo.catalog.unavailableTitle',\n          undefined,\n          { value: catalog.title }\n        );\n        return EMPTY;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n      const modifiedParent = Object.assign({}, parent);\n      modifiedParent.Layer = [];\n      finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n      const modifiedLayer = Object.assign({}, layer);\n      if (level > 0) {\n        modifiedLayer.Title = parent.Title + separator + layer.Title;\n      }\n      if (layer.Layer) {\n        this.flattenWmsCapabilities(\n          modifiedLayer,\n          level + 1,\n          finalLayers,\n          separator\n        );\n      } else {\n        finalLayers.find((ff) => ff.Title === parent.Title).Layer.push(layer);\n      }\n    }\n  }\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n      );\n    });\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition =\n              indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          this.messageService.error(\n            catalog.title\n              ? 'igo.geo.catalog.unavailable'\n              : 'igo.geo.catalog.someUnavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            catalog.title ? { value: catalog.title } : undefined\n          );\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]\n  ): ForcedProperty {\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(\n      (f) => f.layerName === '*'\n    );\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll =\n          forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll =\n          forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map((forcedProperty) => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(\n      layer.Name,\n      catalog.forcedProperties\n    );\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource =\n      layer?.DataURL && layer?.DataURL.length > 0\n        ? layer?.DataURL[0].OnlineResource\n        : undefined;\n\n    let metadataUrl =\n      propertiesToForce?.metadataUrl ||\n      propertiesToForce?.metadataUrlAll ||\n      layerOnlineResource;\n    let metadataAbstract =\n      propertiesToForce?.metadataAbstract ||\n      propertiesToForce?.metadataAbstractAll ||\n      baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (\n      propertiesToForce?.metadataAbstract &&\n      propertiesToForce?.metadataUrlAll\n    ) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> =\n            this.prepareCatalogItemLayer(\n              layer,\n              idGroup,\n              layersQueryFormat,\n              catalog\n            );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length\n    ) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.Title,\n          catalog.forcedProperties\n        );\n        let extern = true;\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private getArcGISRESTItems(\n    catalog: Catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities || !capabilities.layers) {\n      this.messageService.error(\n        'igo.geo.catalog.someUnavailable',\n        'igo.geo.catalog.unavailableTitle'\n      );\n      return [];\n    }\n    const groups: ArcGISRestCapabilitiesLayer[] = !capabilities.layers\n      ? []\n      : capabilities.layers.filter((layer) => layer.subLayerIds);\n    const layers: ArcGISRestCapabilitiesLayer[] = !capabilities.layers\n      ? []\n      : capabilities.layers.filter(\n          (layer) =>\n            !layer.type ||\n            layer.type === ArcGISRestCapabilitiesLayerTypes.FeatureLayer ||\n            layer.type === ArcGISRestCapabilitiesLayerTypes.RasterLayer\n        );\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (\n      capabilities.serviceDescription &&\n      capabilities.serviceDescription.length\n    ) {\n      const regex = /(<([^>]+)>)/gi;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    const items: CatalogItemLayer[] = layers\n      .map((layer: ArcGISRestCapabilitiesLayer) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.name,\n          catalog.forcedProperties\n        );\n        let baseAbstract = catalog.abstract;\n        let extern = true;\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id.toString(), regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions: ArcGISRestDataSourceOptions &\n          QueryableDataSourceOptions = {\n          type: TypeCatalog[catalog.type] as any,\n          url: catalog.url,\n          layer: layer.id.toString(),\n          queryable: true,\n          queryFormat: QueryFormat.ESRIJSON,\n          optionsFromCapabilities: true\n        };\n        const sourceOptions: ArcGISRestDataSourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        );\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.name,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: catalog.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n    const groupHandledLayersIds: string[] = [];\n    const groupedItems: CatalogItemLayer[] = groups\n      .map((group) => {\n        return {\n          options: undefined,\n          address: `catalog.group.${group.name}`,\n          id: `catalog.group.${group.name}`,\n          type: CatalogItemType.Group,\n          externalProvider: catalog.externalProvider,\n          sortDirection: catalog.sortDirection,\n          title: group.name,\n          items: items\n            .filter((i) => {\n              const subLayerIdsStr = group.subLayerIds.map((r) => r.toString());\n              return subLayerIdsStr.includes(\n                (i.options.sourceOptions as ArcGISRestDataSourceOptions).layer\n              );\n            })\n            .map((i) => {\n              groupHandledLayersIds.push(i.id);\n              return Object.assign({}, i, {\n                address: `catalog.group.${group.name}`\n              });\n            })\n        };\n      })\n      .filter((g) => g.items.length);\n\n    if (groups) {\n      const TitleOrId = catalog.title || catalog.id;\n      const nonHandledLayers = items\n        .filter((i) => !groupHandledLayersIds.includes(i.id))\n        .map((i) =>\n          Object.assign({}, i, {\n            address: `catalog.group.${TitleOrId}`\n          })\n        );\n      if (nonHandledLayers.length) {\n        const nonHandledGroup = {\n          options: undefined,\n          address: `catalog.group.${TitleOrId}`,\n          id: `catalog.group.${TitleOrId}`,\n          type: CatalogItemType.Group,\n          externalProvider: catalog.externalProvider,\n          sortDirection: catalog.sortDirection,\n          title: TitleOrId,\n          items: nonHandledLayers\n        };\n        groupedItems.push(nonHandledGroup);\n      }\n    }\n\n    return groups ? groupedItems : items;\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n\nclass CatalogFactory {\n  public static createInstanceCatalog(\n    options: Catalog,\n    catalogService: CatalogService\n  ): Catalog {\n    let catalog: Catalog;\n    if (options.hasOwnProperty('composite')) {\n      catalog = new CompositeCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogCompositeLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n      catalog = new BaselayersCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogBaseLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n      catalog = new ArcGISRestCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogArcGISRestItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.tilearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.imagearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n      catalog = new WMTSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMTSLayerItems(catalog)\n      );\n    } else {\n      catalog = new WMSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMSLayerItems(catalog)\n      );\n    }\n\n    return catalog;\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    *ngIf=\"haveGroup()\"\n    class=\"catalog-browser-layer-carret\"\n    matListItemIcon\n  ></mat-icon>\n  <span\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [ngClass]=\"catalogAllowLegend ? 'igo-cataloglayer-title' : ''\"\n    (click)=\"askForLegend($event)\"\n    [matTooltip]=\"computeTitleTooltip()\"\n  >\n    {{ title }}\n  </span>\n\n  <div matListItemMeta>\n    <button *ngIf=\"layer.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloglayer-external-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        public\n      </mat-icon>\n    </button>\n    <igo-metadata-button [layer]=\"$any(layer)\"></igo-metadata-button>\n\n    <button\n      (mouseenter)=\"onMouseEvent($event)\"\n      (mouseleave)=\"onMouseEvent($event)\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"computeTooltip() | translate\"\n      [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n      (click)=\"onToggleClick($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"icon\"\n        [igoMatBadgeIcon]=\"getBadgeIcon()\"\n        igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n        igoMatBadgeBackgroundColor=\"none\"\n        [igoMatBadgeInverseColor]=\"true\"\n        [matBadgeHidden]=\"\n          ((inRange$ | async) && (isVisible$ | async) === true) ||\n          ((inRange$ | async) && !added) ||\n          ((inRange$ | async) && (isPreview$ | async))\n        \"\n        [matBadgeDisabled]=\"(inRange$ | async) === false\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n      >\n        {{ (isPreview$ | async) ? 'plus' : added ? 'delete' : 'add' }}\n      </mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"\n      (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\n    \"\n    [layer]=\"igoLayer$ | async\"\n  >\n  </igo-layer-legend>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { getEntityIcon, getEntityTitle } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { IgoMap } from '../../map/shared/map';\nimport { MetadataButtonComponent } from '../../metadata/metadata-button/metadata-button.component';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    NgClass,\n    MatTooltipModule,\n    MatButtonModule,\n    MetadataButtonComponent,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    LayerLegendComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService) {}\n\n  ngOnInit(): void {\n    this.isPreview$$ = this.isPreview$.subscribe((value) =>\n      this.addedLayerIsPreview.emit(value)\n    );\n\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (resolution) => {\n        this.isInResolutionsRange(resolution);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return getEntityTitle(this.layer);\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService\n      .createAsyncLayer(this.layer.options)\n      .pipe(first())\n      .subscribe((layer) => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove(event);\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove(event);\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer, event });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove(event: Event) {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer, event });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution =\n      !this.layer.options.minResolution ||\n      Number.isNaN(this.layer.options.minResolution)\n        ? 0\n        : this.layer.options.minResolution;\n    const maxResolution =\n      !this.layer.options.maxResolution ||\n      Number.isNaN(this.layer.options.maxResolution)\n        ? Infinity\n        : this.layer.options.maxResolution;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.id) {\n      const oLayer = this.map.getLayerById(this.layer?.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.getValue()) {\n      return this.isVisible$.getValue() ? '' : 'visibility_off';\n    } else {\n      return 'visibility_off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    matListItemIcon\n    igoCollapse\n    class=\"igo-chevron catalog-browser-group-carret\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\"\n  >\n    expand_less\n  </mat-icon>\n\n  <span\n    class=\"igo-catalog-group-title\"\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"title\"\n    (click)=\"onTitleClick()\"\n    >{{ title }}</span\n  >\n\n  <div matListItemMeta>\n    <button *ngIf=\"group.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloggroup-external-icon\"\n        *ngIf=\"group.externalProvider\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        public\n      </mat-icon>\n    </button>\n\n    <ng-container\n      *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\"\n    >\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n        color=\"warn\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </ng-container>\n\n    <ng-template #notadded>\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon>add</mat-icon>\n      </button>\n    </ng-template>\n  </div>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"$any(item)\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport type { EntityStateManager } from '@igo2/common/entity';\nimport { EntityStore } from '@igo2/common/entity';\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    NgFor,\n    CatalogBrowserLayerComponent,\n    ListItemDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event: Event) {\n    this.added$.value ? this.remove(event) : this.add(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group,\n      event\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove(event: Event) {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group,\n      event\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: AddedChangeEmitter) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every((value) => value === added)) {\n      added ? this.add(event.event) : this.remove(event.event);\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"store.count === 1 ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"$any(item)\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common/entity';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\n\nimport { BehaviorSubject, zip } from 'rxjs';\n\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    NgIf,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent,\n    ListItemDirective,\n    AsyncPipe\n  ]\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n  // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> {\n    return this.map.viewController.resolution$;\n  }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend\n      ? catalogShowLegend\n      : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added\n      ? this.addLayerToMap(layer, event)\n      : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added\n      ? this.addGroupToMap(group, event)\n      : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\n    this.addLayersToMap([layer], event);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(\n    layers: CatalogItemLayer[],\n    event: AddedChangeEmitter | AddedChangeGroupEmitter\n  ) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      if (this.catalog.profils?.length) {\n        layer.options.security = { profils: this.catalog.profils };\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n    zip(...layers$).subscribe((layers: Layer[]) => {\n      if (event.event.type === 'click' && event.added) {\n        this.map.layersAddedByClick$.next(layers);\n      }\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(layers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const currLayer = this.map.getLayerById(layer.options.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      } else {\n        const currLayer = this.map.getLayerById(layer.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(\n    group: CatalogItemGroup,\n    event: AddedChangeGroupEmitter\n  ) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.catalog.library.addTitle' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"title\"\n          placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto2\"\n        />\n        <mat-autocomplete\n          #auto2=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.title }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"url\"\n          placeholder=\"URL\"\n          matInput\n          [matAutocomplete]=\"auto\"\n        />\n        <mat-autocomplete\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.url }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select formControlName=\"type\" placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            <p matListItemTitle>{{ type }}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant(\n          'igo.geo.catalog.externalProvider.unavailableWithEmail',\n          { value: addedCatalog.url, email: emailAddress }\n        )\n      }}\n    </p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant('igo.geo.catalog.unavailable', {\n          value: addedCatalog.url\n        })\n      }}\n    </p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.catalog.library.cancel' | translate }}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\"\n    >\n      {{ 'igo.geo.catalog.library.add' | translate }}\n    </button>\n  </div>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, OnDestroy, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { TypeCapabilities } from '../../datasource/shared/capabilities.interface';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatTooltipModule,\n    MatSelectModule,\n    MatListModule,\n    NgIf,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: {\n      predefinedCatalogs: Catalog[];\n      store: EntityStore<Catalog>;\n      error: boolean;\n      addedCatalog: Catalog;\n    }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<mat-list-item>\n  <span matListItemTitle>\n    {{ title }}\n  </span>\n  <div matListItemMeta>\n    <mat-icon\n      *ngIf=\"catalog.externalProvider\"\n      matListItemIcon\n      class=\"igo-external-provider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n    >\n      public\n    </mat-icon>\n    <button\n      *ngIf=\"catalog.removable\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n      color=\"warn\"\n      (click)=\"removeCatalogFromLibrary($event)\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <button\n      class=\"igo-blank\"\n      *ngIf=\"!catalog.removable\"\n      disabled=\"true\"\n      mat-icon-button\n    >\n      <mat-icon></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { getEntityTitle } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogLibaryItemComponent {\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.catalog);\n  }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\"\n    >\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=\"btnAddCatalog\">\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\"\n  >\n    {{ 'igo.geo.catalog.library.addBtn' | translate }}\n    <mat-icon>library_add</mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { IgoMap } from '../../map/shared/map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    CatalogLibaryItemComponent,\n    ListItemDirective,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  get selectedCatalogId() {\n    return this.storageService.get('selectedCatalogId', StorageScope.SESSION);\n  }\n  set selectedCatalogId(id) {\n    this.storageService.set('selectedCatalogId', id, StorageScope.SESSION);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    if (this.selectedCatalogId) {\n      const selectedCatalog = this.store\n        .all()\n        .find((item) => item.id === this.selectedCatalogId);\n      if (selectedCatalog) {\n        this.onCatalogSelect(selectedCatalog);\n      }\n    }\n    this.predefinedCatalogs = this.predefinedCatalogs.map((c) => {\n      c.id = Md5.hashStr((c.type || 'wms') + standardizeUrl(c.url)) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.selectedCatalogId = catalog.id;\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      this.messageService.alert(\n        'igo.geo.catalog.library.inlist.message',\n        'igo.geo.catalog.library.inlist.title'\n      );\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n      .getCapabilities(\n        addedCatalog.type as any,\n        addedCatalog.url,\n        addedCatalog.version\n      )\n      .pipe(\n        catchError((e) => {\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          this.messageService.error(\n            'igo.geo.catalog.unavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            { value: addedCatalog.url }\n          );\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign(\n            {},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })\n          ) as Catalog\n        );\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\"\n>\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\"\n  >\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\"\n    >\n      {{ 'igo.geo.geometry.point' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\"\n    >\n      {{ 'igo.geo.geometry.line' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\"\n    >\n      {{ 'igo.geo.geometry.polygon' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\"\n  />\n  <mat-icon matPrefix [color]=\"'primary'\">adjust </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{\n    'igo.geo.measure.meters' | translate\n  }}</span>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoFormFieldComponent } from '@igo2/common/form';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport type { Type } from 'ol/geom/Geometry';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map.\n */\n@IgoFormFieldComponent('geometry')\n@Component({\n  selector: 'igo-geometry-form-field',\n  templateUrl: './geometry-form-field.component.html',\n  styleUrls: ['./geometry-form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    GeometryFormFieldInputComponent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatButtonToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(\n    undefined\n  );\n\n  private value$$: Subscription;\n\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  private _drawControlIsActive = true;\n\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  private _freehandDrawIsActive = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  set geometryType(value: Type) {\n    this.geometryType$.next(value);\n  }\n  get geometryType(): Type {\n    return this.geometryType$.value;\n  }\n  readonly geometryType$: BehaviorSubject<Type> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Whether a geometry type toggle should be displayed\n   */\n  @Input() geometryTypeField: boolean = false;\n\n  /**\n   * Available geometry types\n   */\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\n\n  /**\n   * Whether a draw guide field should be displayed\n   */\n  @Input() drawGuideField: boolean = false;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input()\n  set drawGuide(value: number) {\n    this.drawGuide$.next(value);\n  }\n  get drawGuide(): number {\n    return this.drawGuide$.value;\n  }\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\n\n  /**\n   * Draw guide placeholder\n   */\n  @Input() drawGuidePlaceholder: string = '';\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input() drawStyle: OlStyleLike;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input() overlayStyle: OlStyleLike;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Set up a value stream\n   * @internal\n   */\n  ngOnInit() {\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        this.value$.next(value ? value : undefined);\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\n\nexport const MAP_DIRECTIVES = [\n  BaseLayersSwitcherComponent,\n  GeolocateButtonComponent,\n  HomeExtentButtonComponent,\n  HoverFeatureDirective,\n  InfoSectionComponent,\n  MapBrowserComponent,\n  MapCenterComponent,\n  MapOfflineDirective,\n  MenuButtonComponent,\n  MiniBaseMapComponent,\n  OfflineButtonComponent,\n  PointerPositionDirective,\n  RotationButtonComponent,\n  SwipeControlComponent,\n  WakeLockButtonComponent,\n  ZoomButtonComponent\n] as const;\n\n/**\n * @deprecated import the components directly or the MAP_DIRECTIVES for the set\n */\n@NgModule({\n  imports: [...MAP_DIRECTIVES],\n  exports: [...MAP_DIRECTIVES]\n})\nexport class IgoMapModule {}\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.title' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n      />\n      <mat-error *ngIf=\"titleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.title' | translate,\n                value: 130\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.subtitle' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{ 'igo.geo.printForm.subtitle' | translate }}\"\n      />\n      <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.subtitle' | translate,\n                value: 120\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.comment' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{ 'igo.geo.printForm.comment' | translate }}\"\n      />\n      <mat-error *ngIf=\"commentField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.comment' | translate,\n                value: maxLength\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container slide-toggle-container\">\n    <div class=\"print-slide-toggle-container\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showProjection' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showScale' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\"\n      >\n        {{ 'igo.geo.printForm.doZipFile' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showNorthArrow\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showNorthArrow' | translate }}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.printForm.legendPosition' | translate\n      }}</mat-label>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{ 'igo.geo.printForm.legendPosition' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let legendPosition of legendPositions | keyvalue\"\n          [value]=\"legendPosition.key\"\n        >\n          <ng-container\n            *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              'igo.geo.printForm.legendPositions.' + legendPosition.value\n                | translate\n            }}\n          </ng-container>\n\n          <ng-container\n            *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              (outputFormat === 'Pdf'\n                ? 'igo.geo.printForm.legendPositions.newpage'\n                : 'igo.geo.printForm.legendPositions.newimage'\n              ) | translate\n            }}\n          </ng-container>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.outputFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.outputFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let outputFormat of outputFormats | keyvalue\"\n          [value]=\"outputFormat.key\"\n        >\n          {{ outputFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.paperFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"paperFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.paperFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let paperFormat of paperFormats | keyvalue\"\n          [value]=\"paperFormat.key\"\n        >\n          {{\n            'igo.geo.printForm.paperFormats.' + paperFormat.value | translate\n          }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'none' : 'block'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.imageFormat' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.imageFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let imageFormat of imageFormats | keyvalue\"\n          [value]=\"imageFormat.key\"\n        >\n          {{ imageFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label\n        >{{ 'igo.geo.printForm.resolution' | translate }} ({{\n          'igo.geo.printForm.resolutionUnit' | translate\n        }})</mat-label\n      >\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{ 'igo.geo.printForm.resolution' | translate }}\"\n      >\n        <mat-option *ngFor=\"let resolution of resolutions\" [value]=\"resolution\">\n          {{ resolution }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.orientation' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"orientation\"\n        placeholder=\"{{ 'igo.geo.printForm.orientation' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let orientation of orientations | keyvalue\"\n          [value]=\"orientation.key\"\n        >\n          {{ 'igo.geo.printForm.' + orientation.value | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\"\n    >\n      {{ 'igo.geo.printForm.saveBtn' | translate }}\n    </button>\n  </div>\n</form>\n","import { AsyncPipe, KeyValuePipe, NgFor, NgIf } from '@angular/common';\nimport { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\nimport {\n  PrintLegendPosition,\n  PrintOrientation,\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintResolution,\n  PrintSaveImageFormat\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatSlideToggleModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatButtonModule,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class PrintFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = [...PrintResolution];\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || ('96' satisfies PrintResolution), {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get showNorth(): boolean {\n    return this.showNorthArrowField.value;\n  }\n  set showNorth(value: boolean) {\n    this.showNorthArrowField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as UntypedFormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as UntypedFormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as UntypedFormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as UntypedFormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as UntypedFormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as UntypedFormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\n  }\n\n  get showNorthArrowField() {\n    return (this.form.controls as any).showNorth as UntypedFormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as UntypedFormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as UntypedFormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  maxLength: number = 180;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private mediaService: MediaService\n  ) {\n    this.form = this.formBuilder.group({\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\n      comment: [\n        '',\n        [Validators.minLength(0), Validators.maxLength(this.maxLength)]\n      ],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: ['', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{ hidden: this.isPrintService }],\n      showNorthArrow: false\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n    if (this.mediaService.isMobile()) {\n      this.resolutions = this.resolutions.filter(\n        (resolution) => resolution !== '300'\n      );\n    }\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n      this.commentField.clearValidators();\n      this.commentField.updateValueAndValidity();\n    } else {\n      this.isPrintService = true;\n    }\n  }\n\n  changeCommentLength() {\n    switch (this.paperFormat) {\n      case PrintPaperFormat.A0:\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 900 : 600;\n        break;\n      case PrintPaperFormat.A1:\n        // A1, landscape, length 600 | A1, portrait, length 400;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 600 : 400;\n        break;\n      case PrintPaperFormat.A2:\n        // A2, landscape, length 400 | A2, portrait, length 300;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 400 : 300;\n        break;\n      case PrintPaperFormat.A3:\n        // A3, landscape, length 300 | A3, portrait, length 200;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 300 : 200;\n        break;\n      case PrintPaperFormat.A4:\n        // A4, landscape length 200 | A4, portrait length 120;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 100;\n        break;\n      case PrintPaperFormat.A5:\n        // A5, landscape length 120 | A5, portrait length 80;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 120 : 80;\n        break;\n      case PrintPaperFormat.Letter:\n        // lettre, landscape, 180 | lettre, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 180 : 140;\n        break;\n      default:\n        // legal, landscape, 200 | legal, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 140;\n        break;\n    }\n\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]);\n    this.commentField.updateValueAndValidity();\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintFormComponent } from '../print-form/print-form.component';\nimport { PrintOptions } from '../shared/print.interface';\nimport { PrintService } from '../shared/print.service';\nimport {\n  PrintLegendPosition,\n  PrintOrientation,\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintResolution,\n  PrintSaveImageFormat\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html',\n  standalone: true,\n  imports: [PrintFormComponent]\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      if (data.legendPosition === 'newpage') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      this.printService\n        .downloadMapImage(\n          this.map,\n          data.resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile,\n          data.legendPosition,\n          data.showNorthArrow\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\"\n>\n</igo-print-form>\n","import { Provider } from '@angular/core';\n\nimport {\n  DirectionSourceFeature,\n  DirectionSourceKind\n} from './directions-sources';\nimport { DirectionsService } from './shared';\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\n\nexport function provideDirection(\n  ...sources: DirectionSourceFeature<DirectionSourceKind>[]\n): Provider[] {\n  const providers: Provider[] = [\n    {\n      provide: DirectionsService,\n      useClass: DirectionsService\n    },\n    provideDirectionsSourceService()\n  ];\n\n  for (const source of sources) {\n    providers.push(...source.providers);\n  }\n\n  return providers;\n}\n","import { Provider } from '@angular/core';\n\nexport interface DirectionsSourceOptions extends BaseDirectionsSourceOptions {\n  osrm?: OsrmDirectionsSourceOptions;\n  logo?: string;\n}\n\nexport type OsrmDirectionsSourceOptions = BaseDirectionsSourceOptions;\n\ninterface BaseDirectionsSourceOptions {\n  name?: string;\n  baseUrl?: string;\n  profiles?: BaseDirectionsSourceOptionsProfile[];\n}\n\nexport interface BaseDirectionsSourceOptionsProfile {\n  enabled?: boolean;\n  name: string;\n  authorization?: BaseDirectionsSourceOptionsProfileAuthorization;\n}\n\nexport interface BaseDirectionsSourceOptionsProfileAuthorization {\n  url: string;\n  property: string;\n}\n\nexport interface DirectionSourceFeature<KindT extends DirectionSourceKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum DirectionSourceKind {\n  OSRM = 0\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { uuid } from '@igo2/utils';\n\nimport { Position } from 'geojson';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  DirectionsFormat,\n  SourceDirectionsType\n} from '../shared/directions.enum';\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from './directions-source';\nimport {\n  BaseDirectionsSourceOptionsProfile,\n  OsrmDirectionsSourceOptions\n} from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get options(): OsrmDirectionsSourceOptions {\n    return this._options;\n  }\n\n  set options(value: OsrmDirectionsSourceOptions) {\n    this._options = value;\n  }\n\n  get sourceName(): string {\n    return this._options.name;\n  }\n\n  set sourceName(value: string) {\n    this._options.name = value;\n  }\n\n  get baseUrl(): string {\n    return this._options.baseUrl;\n  }\n\n  set baseUrl(value: string) {\n    this._options.baseUrl = value;\n  }\n\n  get url(): string {\n    return `${this.baseUrl}${this.getEnabledProfile().name}/`;\n  }\n\n  get profiles(): BaseDirectionsSourceOptionsProfile[] {\n    return this._options.profiles;\n  }\n\n  set profiles(value: BaseDirectionsSourceOptionsProfile[]) {\n    this._options.profiles = value;\n  }\n\n  private _options: OsrmDirectionsSourceOptions;\n\n  constructor(\n    private _http: HttpClient,\n    private _config: ConfigService\n  ) {\n    super();\n    this._options = this._config.getConfig('directionsSources.osrm');\n    if (!this.baseUrl) {\n      this.baseUrl = '/apis/itineraire/route/v1/';\n    }\n\n    if (!this.sourceName) {\n      this.sourceName = 'OSRM Québec';\n    }\n\n    if (!this.profiles) {\n      const profile: BaseDirectionsSourceOptionsProfile = {\n        enabled: true,\n        name: 'driving'\n      };\n      this.profiles = [profile];\n    } else {\n      if (!this.profiles.find((profile) => profile.enabled)) {\n        this.profiles[0].enabled = true;\n      }\n    }\n  }\n\n  getSourceName(): string {\n    return this.sourceName;\n  }\n\n  getEnabledProfile(): BaseDirectionsSourceOptionsProfile {\n    return this.profiles.find((profile) => profile.enabled);\n  }\n\n  getProfileWithAuthorization(): BaseDirectionsSourceOptionsProfile {\n    return this.profiles.find((profile) => profile.authorization);\n  }\n\n  route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.getRoute(coordinates, directionsParams);\n  }\n\n  private getRoute(\n    coordinates: Position[],\n    params: HttpParams\n  ): Observable<Direction[]> {\n    const url: string = this.url;\n    return this._http\n      .get<JSON[]>(url + coordinates.join(';'), {\n        params\n      })\n      .pipe(map((res) => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach((route) => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n    directionsOptions.alternatives =\n      directionsOptions.alternatives !== undefined\n        ? directionsOptions.alternatives\n        : true;\n    directionsOptions.steps =\n      directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries =\n      directionsOptions.geometries !== undefined\n        ? directionsOptions.geometries\n        : 'geojson';\n    directionsOptions.overview =\n      directionsOptions.overview !== undefined\n        ? directionsOptions.overview\n        : false;\n    directionsOptions.continue_straight =\n      directionsOptions.continue_straight !== undefined\n        ? directionsOptions.continue_straight\n        : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries\n          ? directionsOptions.geometries\n          : 'geojson',\n        continue_straight: directionsOptions.continue_straight\n          ? 'true'\n          : 'false'\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach((leg) => {\n      leg.steps.forEach((step) => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: this.url,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { DirectionsSource } from './directions-source';\nimport {\n  DirectionSourceFeature,\n  DirectionSourceKind\n} from './directions-source.interface';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n\nexport function withOsrmSource(): DirectionSourceFeature<DirectionSourceKind.OSRM> {\n  return {\n    kind: DirectionSourceKind.OSRM,\n    providers: [provideOsrmDirectionsSource()]\n  };\n}\n","export enum OverlayAction {\n  None,\n  Move,\n  Zoom,\n  ZoomIfOutMapExtent\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { Subscription } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { OverlayAction } from '../shared/overlay.enum';\nimport { OverlayService } from '../shared/overlay.service';\n\n@Directive({\n  selector: '[igoOverlay]',\n  standalone: true\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe((res) =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { Provider } from '@angular/core';\n\nimport { provideSearchSourceService } from './search-source-service.providers';\nimport { SearchService } from './search.service';\nimport {\n  SearchSourceFeature,\n  SearchSourceKind\n} from './sources/source.interfaces';\n\ninterface ISearchProviderOptions {\n  /** Share the search term with analytics tracking */\n  analytics?: boolean;\n}\n\nexport function provideSearch(\n  sources: SearchSourceFeature<SearchSourceKind>[],\n  options?: ISearchProviderOptions\n): Provider[] {\n  const providers: Provider[] = [\n    options?.analytics && {\n      provide: 'searchAnalytics',\n      useValue: options.analytics\n    },\n    {\n      provide: SearchService,\n      useClass: SearchService\n    },\n    provideSearchSourceService()\n  ].filter(Boolean);\n\n  for (const source of sources) {\n    providers.push(...source.providers);\n  }\n\n  return providers;\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { customCacheHasher } from '@igo2/utils';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { GeoJsonGeometryTypes } from 'geojson';\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.replace(/ /g, '');\n    term = term.replace(/,+/g, ',');\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.getCadastre(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getCadastre(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: string,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'location_on'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\n      coordinates: (feature.getGeometry() as any).getCoordinates()\n    };\n  }\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\nimport { customCacheHasher } from '@igo2/utils';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { NominatimData } from './nominatim.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: NominatimData[]) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: NominatimData[],\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(\n    data: NominatimData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'location_on',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach((tag) => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach((settings) => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach((conf) => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach((value) => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport * as olformat from 'ol/format';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport {\n  ReverseSearchOptions,\n  SearchSourceOptions,\n  TextSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesFields,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesReverseSearchSourceOptions,\n  StoredQueriesSearchSourceOptions\n} from './storedqueries.interfaces';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource\n  extends SearchSource\n  implements TextSearch\n{\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId =\n      this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    )\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' }).pipe(\n          map((response) => {\n            let resultArray = this.extractResults(\n              this.extractWFSData(response),\n              term\n            );\n            resultArray.sort((a, b) =>\n              a.meta.score > b.meta.score\n                ? 1\n                : a.meta.score === b.meta.score\n                  ? a.meta.titleHtml < b.meta.titleHtml\n                    ? 1\n                    : -1\n                  : -1\n            );\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd =\n                Number(this.options.params.limit) *\n                Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        )\n      : this.http.get(this.searchUrl, { params }).pipe(\n          map((response) => {\n            return this.extractResults(this.extractWFSData(response), term);\n          })\n        );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach((field) => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach((field) => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(\n    data: StoredQueriesData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'location_on',\n        score: data.properties.title\n          ? computeTermSimilarity(term.trim(), data.properties.title)\n          : computeTermSimilarity(term.trim(), data.properties[title])\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      {\n        Route:\n          '<span class=\"routing\"> <u>' +\n          this.languageService.translate.instant('igo.geo.seeRouting') +\n          '</u> </span>'\n      }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n/* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions =\n      options as StoredQueriesReverseSearchSourceOptions;\n\n    if (\n      !this.storedQueriesOptions ||\n      (this.storedQueriesOptions && !this.storedQueriesOptions.available)\n    ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    const isGml = new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    );\n    const request$ = isGml\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' })\n      : this.http.get(this.searchUrl, { params });\n    return request$.pipe(\n      map((response) => {\n        return this.extractResults(this.extractWFSData(response));\n      })\n    );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'location_on'\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesReverseData): {\n    [key: string]: any;\n  } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      properties,\n      { type: data.properties.doc_type },\n      routing\n    );\n  }\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { WorkspaceData } from './workspace.interfaces';\n\n/**\n * Workspace search source\n */\n@Injectable()\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\n  static id = 'workspace';\n  static type = FEATURE;\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n  }\n\n  getId(): string {\n    return WorkspaceSearchSource.id;\n  }\n\n  getType(): string {\n    return WorkspaceSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit: Number = 5;\n\n    return {\n      title: 'igo.geo.search.workspace.name',\n      searchUrl: undefined,\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'datasets',\n          name: 'datasets',\n          values: []\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            { title: '1', value: 1, enabled: limit === 1 },\n            { title: '5', value: 5, enabled: limit === 5 || !limit },\n            { title: '10', value: 10, enabled: limit === 10 },\n            { title: '25', value: 25, enabled: limit === 25 },\n            { title: '50', value: 50, enabled: limit === 50 }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\n    const limitValue =\n      (limitSetting.values.find((v) => v.enabled).value as number) || 5;\n    this.options.params.limit = limitValue.toLocaleString();\n    const results: WorkspaceData[] = [];\n    this.options.params.page = (options.page || 1).toLocaleString();\n    const page = options.page || 1;\n    const datasets = this.options.params.datasets.split(',');\n    this.featureStoresWithIndex\n      .filter(\n        (fswi) => fswi.searchDocument && datasets.includes(fswi.layer.title)\n      )\n      .map((fswi) => {\n        const termToUse = term;\n        fswi.searchDocument\n          .search(termToUse, { limit: page * limitValue })\n          .map((foundIn) => {\n            const field = foundIn.field;\n            foundIn.result.map((index) => {\n              const feature = fswi.index.get(index);\n              const score = computeTermSimilarity(\n                termToUse.trim(),\n                feature.properties[field]\n              );\n              results.push({ index, feature, layer: fswi.layer, field, score });\n            });\n          });\n      });\n\n    results.sort((a, b) => (a.score > b.score ? -1 : 1));\n    const gettedIndex = [];\n    const sortedResultToProcess: WorkspaceData[] = [];\n    results.map((r) => {\n      if (!gettedIndex.includes(r.index)) {\n        gettedIndex.push(r.index);\n        sortedResultToProcess.push(r);\n      }\n    });\n\n    return of(\n      this.extractResults(\n        sortedResultToProcess\n          .sort((a, b) => (a.score > b.score ? -1 : 1))\n          .slice(0, page * limitValue)\n      )\n    );\n  }\n\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\n    return results.map((result) => this.dataToResult(result, results.length));\n  }\n\n  private dataToResult(\n    data: WorkspaceData,\n    resultsCnt: number\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.index].join('.');\n    const titleHtml = data.feature.properties[data.field];\n    const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.feature.geometry,\n        extent: data.feature.extent,\n        properties,\n        meta: {\n          id,\n          title: data.feature.properties[data.field],\n          alias: this.getAllowedFieldsAndAlias(data.layer)\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.feature.meta.title,\n        titleHtml: titleHtml + subtitleHtml2,\n        icon: 'location_on',\n        score: data.score,\n        nextPage:\n          resultsCnt % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    } as SearchResult<Feature>;\n  }\n\n  private getAllowedFieldsAndAlias(layer: Layer) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  private computeProperties(data: WorkspaceData): { [key: string]: any } {\n    if (!data.feature.geometry) {\n      return Object.assign(\n        { type: data.layer.title + '.' + data.field },\n        data.feature.properties\n      );\n    }\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n    let googleMaps;\n    if (data.feature.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.feature.geometry.coordinates[0],\n        data.feature.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.feature.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a>';\n    if (data.feature.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.feature.geometry.coordinates[0],\n          data.feature.geometry.coordinates[1]\n        );\n    }\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      { type: data.feature.sourceId },\n      data.feature.properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\nimport { WorkspaceSearchSource } from './workspace';\n\n/**\n * Workspace search source factory\n * @ignore\n */\nexport function workspaceSearchSourceFactory(\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new WorkspaceSearchSource(\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the Workspace search source\n */\nexport function provideWorkspaceSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: workspaceSearchSourceFactory,\n    multi: true,\n    deps: [LanguageService, StorageService, ConfigService]\n  };\n}\n\nexport function withWorkspaceSource(): SearchSourceFeature<SearchSourceKind.Workspace> {\n  return {\n    kind: SearchSourceKind.Workspace,\n    providers: [provideWorkspaceSearchSource()]\n  };\n}\n","import olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\n\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 1,\n  markerOutlineColor = [0, 255, 255],\n  fillColor,\n  fillOpacity = 0.15,\n  strokeColor = [0, 255, 255],\n  strokeOpacity = 0.5,\n  strokeWidth = 4\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 0.5,\n  markerOutlineColor,\n  fillColor = [0, 161, 222],\n  fillOpacity = 0.15,\n  strokeColor = [0, 161, 222],\n  strokeOpacity = 0.5,\n  strokeWidth = 2\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (\n      markerColorAsArray.length === 4 &&\n      (typeof markerColor !== 'string' ||\n        /^#[0-9A-F]{8}$/i.test(markerColor as string))\n    ) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (\n      !(\n        fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(fillColor as string))\n      )\n    ) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (\n      !(\n        strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(strokeColor as string))\n      )\n    ) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { RegexOptions } from './regex.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RegexService {\n  protected options: RegexOptions;\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('regex');\n  }\n\n  getAll() {\n    return this.options;\n  }\n\n  get(key) {\n    if (this.options) {\n      return this.options[key];\n    }\n    return;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { RegexService } from '@igo2/core/regex';\n\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PropertyTypeDetectorService {\n  public geoServiceRegexes: GeoServiceDefinition[] = [];\n\n  constructor(private regexService: RegexService) {\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\n  }\n\n  getPropertyType(value) {\n    return typeof value;\n  }\n\n  private isUrl(value): boolean {\n    const regex = /^https?:\\/\\//;\n    return regex.test(value.toString());\n  }\n\n  isGeoService(value): boolean {\n    let isGeoService = false;\n    if (!this.isUrl) {\n      return;\n    }\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(value)) {\n        isGeoService = true;\n        break;\n      }\n    }\n    return isGeoService;\n  }\n\n  getGeoService(\n    url: string,\n    availableProperties: string[]\n  ): GeoServiceDefinition {\n    if (!this.isGeoService(url)) {\n      return;\n    }\n    let matchingGeoservice: GeoServiceDefinition;\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(url)) {\n        // providing the the first matching regex;\n        const matchingProperties = availableProperties.filter((p) =>\n          geoServiceRegex.propertiesForLayerName.includes(p)\n        );\n        matchingGeoservice = matchingProperties ? geoServiceRegex : undefined;\n        if (matchingGeoservice) {\n          break;\n        }\n      }\n    }\n    return matchingGeoservice;\n  }\n\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\n    return (this.regexService.get('geoservice') ||\n      []) as GeoServiceDefinition[];\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import {\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableButton,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { Workspace } from '@igo2/common/workspace';\nimport { StorageScope } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable } from 'rxjs';\nimport { map, skipWhile, take } from 'rxjs/operators';\n\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams\n} from '../../datasource/shared/datasources/datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { WfsWorkspace } from './wfs-workspace';\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean) ||\n    true\n  );\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(\n    `workspace.rowsInMapExtent.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.selectedOnly.${layerId}`) as boolean) ||\n    false\n  );\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(\n    `workspace.selectedOnly.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function mapExtentStrategyActiveToolTip(\n  ws: Workspace\n): Observable<string> {\n  return ws.entityStore\n    .getStrategyOfType(EntityStoreFilterCustomFuncStrategy)\n    .active$.pipe(\n      map((active: boolean) =>\n        active\n          ? 'igo.geo.workspace.inMapExtent.active.tooltip'\n          : 'igo.geo.workspace.inMapExtent.inactive.tooltip'\n      )\n    );\n}\n\nexport function noElementSelected(ws: Workspace): Observable<boolean> {\n  return ws.entityStore.stateView\n    .manyBy$((record: EntityRecord<Feature>) => {\n      return record.state.selected === true;\n    })\n    .pipe(map((entities: EntityRecord<Feature>[]) => entities.length >= 1));\n}\n\nexport function addOrRemoveLayer(\n  action: 'add' | 'remove',\n  map: IgoMap,\n  url: string,\n  type: string,\n  layerName: string,\n  layerService: LayerService\n) {\n  const so = ObjectUtils.removeUndefined({\n    sourceOptions: {\n      type: type,\n      url,\n      optionsFromCapabilities: true,\n      optionsFromApi: true,\n      params: {\n        LAYERS: type === 'wms' ? layerName : undefined,\n        LAYER: type === 'wms' ? undefined : layerName\n      }\n    }\n  });\n  if (action === 'add') {\n    layerService.createAsyncLayer(so).subscribe((layer) => {\n      map.layersAddedByClick$.next([layer]);\n      map.addLayer(layer);\n    });\n  } else if (action === 'remove') {\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\n    map.removeLayer(map.layers.find((l) => l.id === addedLayerId));\n  }\n}\n\nexport function getGeoServiceAction(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layerService: LayerService\n) {\n  const geoServiceAction = [\n    {\n      name: 'geoServiceAction',\n      title: undefined,\n      tooltip: '',\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\n        let geoServiceProperties = record.state.geoService;\n        if (\n          geoServiceProperties &&\n          geoServiceProperties.haveGeoServiceProperties &&\n          geoServiceProperties.url &&\n          geoServiceProperties.layerName\n        ) {\n          if (geoServiceProperties.added) {\n            return [\n              {\n                icon: 'delete',\n                color: 'warn',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'remove',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = false;\n                }\n              }\n            ] as EntityTableButton[];\n          } else {\n            return [\n              {\n                icon: 'add',\n                color: 'primary',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'add',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = true;\n                }\n              }\n            ] as EntityTableButton[];\n          }\n        } else {\n          return [];\n        }\n      }\n    }\n  ];\n  return geoServiceAction;\n}\n\nexport function createTableTemplate(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layer: VectorLayer,\n  layerService: LayerService,\n  ws$\n) {\n  const geoServiceAction = getGeoServiceAction(workspace, layerService);\n  const fields = layer.dataSource.options.sourceFields || [];\n\n  const relations = layer.dataSource.options.relations || [];\n\n  if (fields.length === 0) {\n    workspace.entityStore.entities$\n      .pipe(\n        skipWhile((val) => val.length === 0),\n        take(1)\n      )\n      .subscribe((entities) => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol\n          .getKeys()\n          .filter(\n            (col) =>\n              !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi)\n          )\n          .map((key) => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures,\n          tableHeight: '100%'\n        } as EntityTableTemplate;\n      });\n    return;\n  }\n  const columns = fields.map((field: SourceFieldsOptionsParams) => {\n    return {\n      name: `properties.${field.name}`,\n      title: field.alias ? field.alias : field.name,\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n      tooltip: field.tooltip,\n      cellClassFunc: () => {\n        const cellClass = {};\n        if (field.type) {\n          cellClass[`class_${field.type}`] = true;\n          return cellClass;\n        }\n      }\n    } as EntityTableColumn;\n  });\n\n  const relationsColumn = relations.map((relation: RelationOptions) => {\n    return {\n      name: `properties.${relation.name}`,\n      title: relation.alias ? relation.alias : relation.name,\n      renderer: EntityTableColumnRenderer.Icon,\n      icon: relation.icon,\n      parent: relation.parent,\n      type: 'relation',\n      tooltip: relation.tooltip,\n      onClick: () => {\n        ws$.next(relation.title);\n      },\n      cellClassFunc: () => {\n        return { class_icon: true };\n      }\n    };\n  });\n\n  columns.push(...relationsColumn);\n  columns.unshift(...geoServiceAction);\n  workspace.meta.tableTemplate = {\n    selection: true,\n    sort: true,\n    columns,\n    tableHeight: '100%'\n  };\n}\n\nexport function createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n  const filterClauseFunc = (record: EntityRecord<object>) => {\n    return (\n      record.state.inMapExtent === true && record.state.inMapResolution === true\n    );\n  };\n  return new EntityStoreFilterCustomFuncStrategy({\n    filterClauseFunc\n  } as EntityStoreStrategyFuncOptions);\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport {\n  GeoWorkspaceOptions,\n  LayerService,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions,\n  getCommonVectorSelectedStyle\n} from '../../style/shared';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector';\nimport { WfsWorkspace } from './wfs-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSearchIndexStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions,\n  getCommonVectorSelectedStyle\n} from '../../style/shared';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { FeatureWorkspace } from './feature-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\n      percentDistinctValueRatio: 2,\n      sourceFields: layer.dataSource.options.sourceFields\n    });\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    if (layer.options.workspace?.searchIndexEnabled) {\n      store.addStrategy(searchStrategy, true);\n    }\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef\n} from '@angular/material/dialog';\n\nimport { LanguageService } from '@igo2/core/language';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n  selector: 'igo-confirmation-popup-component',\n  templateUrl: './confirmation-popup.component.html',\n  styleUrls: ['./confirmation-popup.component.scss'],\n  standalone: true,\n  imports: [MatDialogContent, MatDialogActions, MatButtonModule]\n})\nexport class ConfirmationPopupComponent {\n  constructor(\n    public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n    public languageService: LanguageService,\n    @Inject(MAT_DIALOG_DATA) public data: { type: string; cancel: boolean }\n  ) {}\n\n  cancelAction() {\n    this.data.cancel = true;\n    this.dialogRef.close(this.data.cancel);\n  }\n\n  confirmedAction() {\n    this.data.cancel = false;\n    this.dialogRef.close(this.data.cancel);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{\n      data.type === 'add'\n        ? languageService.translate.instant('igo.geo.workspace.addConfirmation')\n        : languageService.translate.instant(\n            'igo.geo.workspace.deleteConfirmation'\n          )\n    }}\n  </p>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"confirmedAction()\">\n    Ok\n  </button>\n  <button mat-raised-button (click)=\"cancelAction()\">\n    {{ languageService.translate.instant('igo.geo.workspace.cancel') }}\n  </button>\n</div>\n","import { MatDialog } from '@angular/material/dialog';\n\nimport { EntityRecord } from '@igo2/common/entity';\nimport { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\nimport { ConfigService } from '@igo2/core/config';\n\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { FeatureDataSource, RelationOptions } from '../../datasource/shared';\nimport { GeometryType, createInteractionStyle } from '../../draw/shared';\nimport { featureToOl } from '../../feature/shared';\nimport { DrawControl } from '../../geometry/shared';\nimport { ImageLayer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): ImageLayer | VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    private dialog: MatDialog,\n    private configService: ConfigService,\n    private adding$: BehaviorSubject<boolean>,\n    private getDomainValues: (relation: RelationOptions) => Observable<any>,\n    protected options: EditionWorkspaceOptions\n  ) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: { type: 'delete' }\n      });\n\n      dialogRef.afterClosed().subscribe((result) => {\n        if (result === false) {\n          let id, url;\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl =\n            workspace.layer.dataSource.options.edition.deleteUrl;\n          if (baseUrl.length) {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') +\n                baseUrl +\n                '?' +\n                deleteUrl\n              : baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') + deleteUrl\n              : deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns) {\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.getDomainValues(column.relation).subscribe((result) => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(\n        JSON.stringify(feature.properties)\n      );\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(\n            feature,\n            { newFeature: true },\n            true\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(\n    geometryType: Type,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl(feature, workspace);\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    );\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(\n    feature,\n    workspace: EditionWorkspace,\n    olGeometry?: OlGeometry\n  ) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(\n    olFeature: OlFeature<OlGeometry>,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach((feature) => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import {\n  HttpClient,\n  HttpErrorResponse,\n  HttpHeaders\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ActionStore } from '@igo2/common/action';\nimport {\n  EntityStoreFilterSelectionStrategy,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\n\nimport olFeature from 'ol/Feature';\nimport { FeatureLoader } from 'ol/featureloader';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport WKT from 'ol/format/WKT';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\n\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams,\n  WMSDataSource\n} from '../../datasource/shared/datasources';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy\n} from '../../feature/shared';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  GeoWorkspaceOptions,\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap, MapBase } from '../../map/shared';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { EditionWorkspace } from './edition-workspace';\nimport { createFilterInMapExtentOrResolutionStrategy } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(\n    undefined\n  );\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n  public wktFormat = new WKT();\n  public geoJsonFormat = new GeoJSON();\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (\n      layer.options.workspace?.enabled !== true ||\n      layer.dataSource.options.edition.enabled !== true\n    ) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace(\n          this.dialog,\n          this.configService,\n          this.adding$,\n          (relation: RelationOptions) => this.getDomainValues(relation),\n          {\n            id: layer.id,\n            title: layer.title,\n            layer: workspaceLayer,\n            map,\n            entityStore: this.createFeatureStore(workspaceLayer, map),\n            actionStore: new ActionStore([]),\n            meta: {\n              tableTemplate: undefined\n            }\n          }\n        );\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          wksConfig\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(\n    workspace: EditionWorkspace,\n    layer: VectorLayer\n  ): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [\n      {\n        name: 'edition',\n        title: undefined,\n        renderer: EntityTableColumnRenderer.ButtonGroup,\n        primary: false,\n        valueAccessor: () => {\n          return [\n            {\n              editMode: false,\n              icon: 'edit',\n              color: 'primary',\n              disabled:\n                layer.dataSource.options.edition.modifyButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.editFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: false,\n              icon: 'delete',\n              color: 'warn',\n              disabled:\n                layer.dataSource.options.edition.deleteButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.deleteFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'check',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.saveFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'close',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.cancelEdit(workspace, feature);\n              }\n            }\n          ] as EntityTableButton[];\n        }\n      }\n    ];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$\n        .pipe(\n          skipWhile((val) => val.length === 0),\n          take(1)\n        )\n        .subscribe((entities) => {\n          const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n          const columnsFromFeatures = ol\n            .getKeys()\n            .filter(\n              (col) =>\n                !col.startsWith('_') &&\n                col !== 'geometry' &&\n                col !== ol.getGeometryName() &&\n                !col.match(/boundedby/gi)\n            )\n            .map((key) => {\n              return {\n                name: `properties.${key}`,\n                title: key,\n                renderer: rendererType\n              };\n            });\n          workspace.meta.tableTemplate = {\n            selection: false,\n            sort: true,\n            columns: columnsFromFeatures\n          };\n        });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe((result) => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { class_icon: true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)) {\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n    let url = this.configService.getConfig('edition.url');\n\n    if (!url) {\n      url = baseUrl;\n    } else {\n      url += baseUrl ? baseUrl : '';\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (\n        workspace.layer.dataSource.options.edition.modifyProtocol !== 'post'\n      ) {\n        url +=\n          '?' +\n          workspace.layer.dataSource.options.edition.modifyUrl +\n          feature.idkey;\n      } else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole =\n        workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders =\n        workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any }\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false)\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http\n      .post(`${url}`, feature.properties, { headers: headers })\n      .subscribe(\n        () => {\n          this.loading = false;\n          workspace.entityStore.stateView.clear();\n          workspace.deleteDrawings();\n          workspace.entityStore.delete(feature);\n\n          this.messageService.success('igo.geo.workspace.addSuccess');\n\n          this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n          this.adding$.next(false);\n          this.rowsInMapExtentCheckCondition$.next(true);\n        },\n        (error) => {\n          this.loading = false;\n          error.error.caught = true;\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach((message) => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error('igo.geo.workspace.addError');\n            }\n          } else {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        }\n      );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  public modifyFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any },\n    protocole = 'patch'\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      // Remove 3e dimension\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false) ||\n          property === 'boundedBy'\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, {\n      headers: headers\n    }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        this.messageService.success('igo.geo.workspace.modifySuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url')\n        ? this.configService.getConfig('edition.url') + relation.table\n        : relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map((result) => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: MapBase) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader: FeatureLoader = (\n      extent,\n      resolution,\n      proj,\n      success,\n      failure\n    ) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions as WFSDataSourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(\n          layer.id.substr(0, layer.id.indexOf('.') - 1)\n        ) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      ) {\n        const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n        let params = wmsOlLayer.getParams();\n        params._t = new Date().getTime();\n        wmsOlLayer.updateParams(params);\n      }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    let message;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys(column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (\n                column.validation[type] &&\n                (!feature.properties.hasOwnProperty(key) ||\n                  !feature.properties[key])\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.mandatory',\n                  undefined,\n                  undefined,\n                  { column: column.title }\n                );\n              }\n              break;\n            }\n            case 'minValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n          }\n        });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (\n        column.type === 'list' &&\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]\n      ) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[\n            getColumnKeyWithoutPropertiesTag(column.name)\n          ].toString();\n      }\n    });\n  }\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n\nfunction removeZ(coords: any) {\n  if (coords.length === 0) return coords;\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\n  return coords.map(removeZ);\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  GeoWorkspaceOptions,\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions\n} from '../../style/shared/vector/vector-style.interface';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { WfsWorkspace } from './wfs-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private capabilitiesService: CapabilitiesService,\n    private styleService: StyleService,\n    private configService: ConfigService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(\n        (lay) => lay.id === layer.id + '.WfsWorkspaceTableDest'\n      ) ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    let wks;\n    let wksLayerOption: GeoWorkspaceOptions = {\n      printable: layer.options.workspace?.printable,\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab:\n          layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled\n            ? (dataSource.options as QueryableDataSourceOptions)\n                .queryFormatAsWms\n            : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        createTableTemplate(wks, workspaceLayer, this.layerService, this.ws$);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          enabled: true,\n          srcId: layer.id,\n          workspaceId: workspaceLayer.id,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\n\nimport {\n  Workspace,\n  WorkspaceSelectorComponent,\n  WorkspaceStore\n} from '@igo2/common/workspace';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  FeatureDataSource,\n  WFSDataSource,\n  WMSDataSource\n} from '../../datasource/shared/datasources';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared';\nimport { ImageLayer, Layer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]',\n  standalone: true\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) => this.onLayersChange(layers));\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.adding$.subscribe((adding) => {\n      this.disableSwitch.emit(adding);\n    });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => {\n      this.relationLayers.emit(layers);\n    });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(\n      (condition) => {\n        this.rowsInMapExtentCheckCondition.emit(condition);\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map((entities) => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore\n      .all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(\n          FeatureStoreInMapExtentStrategy\n        );\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {\n        active: false,\n        selected: false\n      });\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(\n    layer: VectorLayer | ImageLayer\n  ): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (\n      layer.dataSource instanceof WFSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return wfsWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      if (!layer.dataSource.options.paramsWFS) {\n        return;\n      }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable =\n          !inResolutionRange;\n        (\n          wmsWks.layer.dataSource.options as QueryableDataSourceOptions\n        ).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n      layer.dataSource instanceof FeatureDataSource &&\n      (layer as VectorLayer).exportable === true &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return featureWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled === true\n    ) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (\n        dataSourceOptions.ogcFilters?.enabled ||\n        dataSource.options.paramsWFS?.featureTypes !== undefined\n      );\n    }\n\n    return false;\n  }\n}\n","/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - (s.length % 3);\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import { HttpParams } from '@angular/common/http';\n\nexport function customCacheHasher(parameters: unknown[]): unknown[] {\n  return parameters.map((param) => {\n    if (param instanceof HttpParams) {\n      return param.toString();\n    }\n    return param !== undefined ? JSON.parse(JSON.stringify(param)) : param;\n  });\n}\n","import Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","import { Observable, Observer } from 'rxjs';\n\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = (1 << length) - 1;\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\nexport class Compression {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = {\n          length: text64.length,\n          type: blob.type,\n          object: compressed\n        };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], { type: compressedData.type });\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = value << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n    /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n\n  static isValidNumber(value: string): boolean {\n    return !isNaN(Number(value));\n  }\n\n  static isOctalNumber(value: string): boolean {\n    return (\n      StringUtils.isValidNumber(value) &&\n      value.startsWith('0') &&\n      value.length > 1\n    );\n  }\n}\n","import { ChangeType, GroupingChanges } from './change.interface';\nimport { StringUtils } from './string-utils';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex((s) => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map((itemAdded) => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach((key) => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class DomUtils {\n  static create<K extends keyof HTMLElementTagNameMap>(\n    doc: Document,\n    tagName: K,\n    options?: Partial<HTMLElementTagNameMap[K]>\n  ): HTMLElementTagNameMap[K] {\n    const el = doc.createElement(tagName);\n\n    for (const key in options) {\n      el[key] = options[key];\n    }\n\n    return el;\n  }\n\n  static remove(node: HTMLElement | SVGElement): void {\n    if (!node.parentNode) {\n      return;\n    }\n    node.parentNode.removeChild(node);\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(\n  content: string,\n  mimeType: string,\n  fileName: string\n) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n\n/**\n * Validate if string is valid json object\n * @param jsonString\n * @return boolean\n */\nexport function isValidJSON(jsonString: string): boolean {\n  try {\n    return JSON.parse(jsonString) && !!jsonString;\n  } catch (e) {\n    return false;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key.replace(/\\[/g, '.').replace(/\\]/g, '').split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter((key) => !ignoreUndefined || source[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                (f) => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== null)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n            ? 3\n            : b === undefined\n              ? -3\n              : a === null\n                ? 2\n                : b === null\n                  ? -2\n                  : a === ''\n                    ? 1\n                    : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter((key) => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n\n  static isEmpty(obj: object): boolean {\n    return Object.keys(obj).length === 0;\n  }\n}\n","export class NumberUtils {\n  static roundToNDecimal(num: number, decimal: number = 3): number {\n    const roundFactor = Math.pow(10, decimal);\n    return Math.round(num * roundFactor) / roundFactor;\n  }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","import { DomUtils } from './dom.utils';\n\nconst PATH_PREBUILT_THEMES = 'assets/igo2/core/theming/prebuilt-themes';\nconst LINK_ID = 'theme-styles';\n\nexport function loadTheme(\n  doc: Document,\n  themeName: string,\n  path: string = PATH_PREBUILT_THEMES\n): void {\n  const src = `${path}/${themeName}.css`;\n  const head = doc.getElementsByTagName('head')[0];\n\n  let themeLink = doc.getElementById(LINK_ID) as HTMLLinkElement;\n  themeLink ? (themeLink.href = src) : createHtmlLink(doc, src, head);\n}\n\nfunction createHtmlLink(doc: Document, src: string, parent: HTMLElement): void {\n  const element = DomUtils.create(doc, 'link', {\n    id: LINK_ID,\n    rel: 'stylesheet',\n    href: src\n  });\n  parent.appendChild(element);\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.user' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        placeholder=\"{{ 'igo.auth.user' | translate }}\"\n        formControlName=\"username\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.password' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        type=\"password\"\n        placeholder=\"{{ 'igo.auth.password' | translate }}\"\n        formControlName=\"password\"\n      />\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">\n    {{ 'igo.auth.login' | translate }}\n  </button>\n  <button\n    *ngIf=\"allowAnonymous\"\n    mat-raised-button\n    class=\"anonymous\"\n    type=\"button\"\n    (click)=\"loginAnonymous()\"\n  >\n    {{ 'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br />\n    <font size=\"3\" color=\"red\">{{ error }}</font>\n  </div>\n</form>\n\n<div *ngIf=\"loading\" class=\"loading-container\">\n  <mat-spinner [diameter]=\"40\"></mat-spinner>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinner } from '@angular/material/progress-spinner';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default,\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatProgressSpinner,\n    NgIf,\n    IgoLanguageModule\n  ]\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: UntypedFormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: UntypedFormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe((errorMsg) => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Inject,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg, IgoIconComponent, MICROSOFT_ICON } from '@igo2/common/icon';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport {\n  MSAL_GUARD_CONFIG,\n  MsalBroadcastService,\n  MsalService\n} from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  InteractionRequiredAuthError,\n  InteractionStatus,\n  PopupRequest,\n  PublicClientApplication,\n  SilentRequest\n} from '@azure/msal-browser';\nimport { Subject } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\n\nimport {\n  AuthMicrosoftOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth-microsoft.interface';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, IgoLanguageModule, IgoIconComponent]\n})\nexport class AuthMicrosoftComponent {\n  private options?: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  svgIcon: IconSvg = MICROSOFT_ICON;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoft');\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options?.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService\n          .loginWithToken(tokenAccess, 'microsoft', { tokenId })\n          .subscribe(() => {\n            this.appRef.tick();\n            this.login.emit(true);\n          });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n        console.log(error);\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'add')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoft()\"\n>\n  <igo-icon [icon]=\"svgIcon\"></igo-icon>\n  {{ 'igo.auth.microsoft.login' | translate }}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nimport { Location } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { IMsalService } from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  EndSessionPopupRequest,\n  EndSessionRequest,\n  IPublicClientApplication,\n  Logger,\n  PopupRequest,\n  RedirectRequest,\n  SilentRequest,\n  SsoSilentRequest,\n  WrapperSKU\n} from '@azure/msal-browser';\nimport { Observable, from } from 'rxjs';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n  private redirectHash: string;\n  private logger: Logger;\n  private name = '@azure/msal-angular';\n  private version = '2.0.0-beta.2';\n  constructor(\n    @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n    private location: Location\n  ) {\n    const hash = this.location.path(true).split('#').pop();\n    if (hash) {\n      this.redirectHash = `#${hash}`;\n    }\n    this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n  }\n\n  initialize(): Observable<void> {\n    return from(this.instance.initialize());\n  }\n\n  acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenPopup(request));\n  }\n  acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n    return from(this.instance.acquireTokenRedirect(request));\n  }\n  acquireTokenSilent(\n    silentRequest: SilentRequest\n  ): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenSilent(silentRequest));\n  }\n  handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n    return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n  }\n  loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.loginPopup(request));\n  }\n  loginRedirect(request?: RedirectRequest): Observable<void> {\n    return from(this.instance.loginRedirect(request));\n  }\n  logout(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logout(logoutRequest));\n  }\n  logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logoutRedirect(logoutRequest));\n  }\n  logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n    return from(this.instance.logoutPopup(logoutRequest));\n  }\n  ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n    return from(this.instance.ssoSilent(request));\n  }\n  /**\n   * Gets logger for msal-angular.\n   * If no logger set, returns logger instance created with same options as msal-browser\n   */\n  getLogger(): Logger {\n    if (!this.logger) {\n      this.logger = this.instance.getLogger().clone(this.name, this.version);\n    }\n    return this.logger;\n  }\n  // Create a logger instance for msal-angular with the same options as msal-browser\n  setLogger(logger: Logger): void {\n    this.logger = logger.clone(this.name, this.version);\n    this.instance.setLogger(logger);\n  }\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nimport { Inject, Injectable } from '@angular/core';\n\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport {\n  EventMessage,\n  EventMessageUtils,\n  IPublicClientApplication,\n  InteractionStatus\n} from '@azure/msal-browser';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n  private _msalSubject: Subject<EventMessage>;\n  public msalSubject$: Observable<EventMessage>;\n  private _inProgress: BehaviorSubject<InteractionStatus>;\n  public inProgress$: Observable<InteractionStatus>;\n\n  constructor(\n    @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n    private authService: MsalServiceb2c\n  ) {\n    this._msalSubject = new Subject<EventMessage>();\n    this.msalSubject$ = this._msalSubject.asObservable();\n\n    // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n    this._inProgress = new BehaviorSubject<InteractionStatus>(\n      InteractionStatus.Startup\n    );\n    this.inProgress$ = this._inProgress.asObservable();\n\n    this.msalInstance.addEventCallback((message: EventMessage) => {\n      this._msalSubject.next(message);\n      const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n      if (status !== null) {\n        this.authService\n          .getLogger()\n          .verbose(\n            `BroadcastService - ${message.eventType} results in setting inProgress to ${status}`\n          );\n        this._inProgress.next(status);\n      }\n    });\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Inject,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg, IgoIconComponent, MICROSOFT_ICON } from '@igo2/common/icon';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  InteractionRequiredAuthError,\n  InteractionStatus,\n  PopupRequest,\n  PublicClientApplication,\n  SilentRequest\n} from '@azure/msal-browser';\nimport { Subject } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\n\nimport {\n  AuthMicrosoftb2cOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth-microsoft.interface';\nimport { MsalBroadcastServiceb2c } from './auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, IgoLanguageModule, IgoIconComponent],\n  providers: [MsalServiceb2c]\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  svgIcon: IconSvg = MICROSOFT_ICON;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'b2c')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoftb2c()\"\n>\n  <igo-icon [icon]=\"svgIcon\"></igo-icon>\n  {{ 'igo.auth.microsoftb2c.login' | translate }}\n</button>\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Output\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\n\nimport { AuthFacebookOptions } from '../shared/auth-facebook.interface';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AuthFacebookComponent {\n  private options?: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook');\n\n    if (this.options?.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', (rep) => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options?.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  scope=\"public_profile,email\"\n  class=\"fb-login-button\"\n  data-max-rows=\"1\"\n  data-size=\"large\"\n  data-button-type=\"login_with\"\n  data-show-faces=\"false\"\n  data-auto-logout-link=\"false\"\n  data-use-continue-as=\"false\"\n></div>\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Output\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { AuthGoogleOptions } from '../shared/auth-google.interface';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AuthGoogleComponent {\n  private options?: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google');\n\n    if (this.options?.apiKey && this.options?.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn(\n        'Google authentification needs \"apiKey\" and \"clientId\" options'\n      );\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options?.apiKey,\n        clientId: this.options?.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2\n          .getAuthInstance()\n          .isSignedIn.listen((rep) => {\n            this.updateSigninStatus(rep);\n          });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.login'\n        );\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.logged'\n        );\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  class=\"g-signin2 google-login-button\"\n  data-height=\"40\"\n  data-width=\"265\"\n  data-longtitle=\"true\"\n></div>\n","<div *ngIf=\"visible\">\n  <div\n    *ngIf=\"!auth.logged && backgroundDisable\"\n    class=\"backgroundDisable\"\n  ></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{ 'igo.auth.connection' | translate }}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-google>\n\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoft>\n\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoftb2c>\n\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-facebook>\n\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-intern>\n  </div>\n\n  <div\n    *ngIf=\"auth.logged && showAlreadyConnectedDiv\"\n    class=\"login center-block\"\n  >\n    <p>{{ 'igo.auth.welcome' | translate: user }}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">\n      {{ 'igo.auth.signOut' | translate }}\n    </button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{ 'igo.auth.deconnection' | translate }}</p>\n    <button\n      *ngIf=\"options.homeRoute\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"home()\"\n    >\n      {{ 'igo.auth.home' | translate }}\n    </button>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Optional,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { NavigationStart, Router } from '@angular/router';\n\nimport { AuthOptions, AuthService } from '@igo2/auth';\nimport { AuthFacebookComponent } from '@igo2/auth/facebook';\nimport { AuthGoogleComponent } from '@igo2/auth/google';\nimport { AuthInternComponent } from '@igo2/auth/internal';\nimport {\n  AuthMicrosoftComponent,\n  AuthMicrosoftb2cComponent\n} from '@igo2/auth/microsoft';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { filter } from 'rxjs/operators';\n\nimport { AuthFormOptions } from '../shared';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default,\n  standalone: true,\n  imports: [\n    NgIf,\n    AuthGoogleComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    AuthFacebookComponent,\n    AuthInternComponent,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options?: AuthOptions & AuthFormOptions;\n  public user;\n\n  public visible = true;\n\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth');\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options?.logoutRoute) {\n          this.router.navigate([this.options?.logoutRoute]);\n        } else if (this.options?.homeRoute) {\n          this.router.navigate([this.options?.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options?.homeRoute) {\n      this.router.navigate([this.options?.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options?.logoutRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Routes } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form/auth-form.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'form', pathMatch: 'full' },\n  {\n    title: 'Authentification',\n    path: 'form',\n    component: AppAuthFormComponent\n  }\n];\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { AuthFormComponent } from '@igo2/auth/form';\n\nimport { Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    AuthFormComponent,\n    MatButtonModule\n  ]\n})\nexport class AppAuthFormComponent implements OnInit, OnDestroy {\n  public logged: boolean = false;\n  public logged$$: Subscription;\n  constructor(private _authService: AuthService) {}\n\n  ngOnInit() {\n    this.logged$$ = this._authService.logged$.subscribe((logged: boolean) => {\n      this.logged = logged;\n    });\n  }\n\n  logout() {\n    this._authService.logout();\n  }\n\n  ngOnDestroy() {\n    this.logged$$.unsubscribe();\n  }\n}\n","<app-doc-viewer\n  title=\"Authentification\"\n  subtitle=\"Auth\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"auth/auth-form\" configFolder=\"environments\">\n    The dialog opens automatically if you are not logged in\n    <br />\n    <button\n      mat-raised-button\n      color=\"primary\"\n      [disabled]=\"!logged\"\n      (click)=\"logout()\"\n    >\n      Log out\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n<igo-auth-form></igo-auth-form>\n","import { Overlay } from '@angular/cdk/overlay';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport {\n  ActionStore,\n  ActionbarComponent,\n  ActionbarMode\n} from '@igo2/common/action';\nimport { Media, MediaOrientation, MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, ActionbarComponent]\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store: ActionStore = new ActionStore([]);\n\n  private added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media: Media = this.mediaService.media$.value;\n    const orientation: MediaOrientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnInit(): void {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'add',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'edit',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Action\" subtitle=\"Common\">\n  <app-example-viewer title=\"Action Bar\" codeFolder=\"common/action\">\n    <igo-actionbar\n      [store]=\"store\"\n      [withIcon]=\"true\"\n      [withTitle]=\"actionbarMode === 'overlay'\"\n      [horizontal]=\"true\"\n      [mode]=\"actionbarMode\"\n    >\n    </igo-actionbar>\n  </app-example-viewer>\n\n  <!-- <app-example-viewer title=\"Action context-menu\" codeFolder=\"common/action\">\n    <mat-card [igoContextMenu]=\"actionbarMenu\">\n      <mat-card-header>\n        <mat-card-subtitle>Common</mat-card-subtitle>\n        <mat-card-title>Action context-menu</mat-card-title>\n      </mat-card-header>\n      <div></div>\n    </mat-card>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"true\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer> -->\n</app-doc-viewer>\n","<h1 mat-dialog-title class=\"mat-typography\">{{ title }}</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <ng-container\n    *ngTemplateOutlet=\"loopObject; context: { obj: data }\"\n  ></ng-container>\n\n  <ng-template #loopObject let-obj=\"obj\" let-baseKey=\"baseKey\">\n    <ng-container *ngFor=\"let property of obj | keyvalue\">\n      <ng-container\n        *ngIf=\"ignoreKeys.indexOf(getKey(baseKey, property.key)) === -1\"\n      >\n        <ng-container *ngIf=\"isObject(property.value); else notObject\">\n          <ng-container\n            *ngTemplateOutlet=\"\n              loopObject;\n              context: {\n                obj: property.value,\n                baseKey: getKey(baseKey, property.key)\n              }\n            \"\n          ></ng-container>\n        </ng-container>\n\n        <ng-template #notObject>\n          <p>\n            <span\n              ><b>{{ getKey(baseKey, property.key) }}</b> : </span\n            ><span class=\"propertyValue\" [innerHtml]=\"property.value\"></span>\n          </p>\n        </ng-template>\n      </ng-container>\n    </ng-container>\n  </ng-template>\n</div>\n\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(false)\">\n    OK\n  </button>\n</div>\n","import { KeyValuePipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-json-dialog',\n  templateUrl: './json-dialog.component.html',\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    NgTemplateOutlet,\n    NgFor,\n    NgIf,\n    MatDialogActions,\n    MatButtonModule,\n    KeyValuePipe\n  ]\n})\nexport class JsonDialogComponent {\n  public title: string;\n  public data: any;\n  public ignoreKeys: string[];\n\n  constructor(public dialogRef: MatDialogRef<JsonDialogComponent>) {}\n\n  isObject(val) {\n    return typeof val === 'object' && !Array.isArray(val);\n  }\n\n  getKey(baseKey, key) {\n    return (baseKey ? baseKey + '.' : '') + key;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { JsonDialogComponent } from './json-dialog.component';\n\n@Injectable()\nexport class JsonDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(title: any, data, ignoreKeys?: string[]): Observable<any> {\n    const dialogRef = this.dialog.open(JsonDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.data = data;\n    dialogRef.componentInstance.title = title;\n    dialogRef.componentInstance.ignoreKeys = ignoreKeys ?? [];\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { JsonDialogComponent } from './json-dialog.component';\nimport { JsonDialogService } from './json-dialog.service';\n\n@NgModule({\n  imports: [JsonDialogComponent],\n  exports: [JsonDialogComponent],\n  providers: [JsonDialogService]\n})\nexport class IgoJsonDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoJsonDialogModule> {\n    return {\n      ngModule: IgoJsonDialogModule\n    };\n  }\n}\n","export enum SelectValueDialogType {\n  Radio = 'radio',\n  Checkbox = 'checkbox'\n}\n","<h1 mat-dialog-title>{{ data.title | translate }}</h1>\n\n<form class=\"igo-form\" [formGroup]=\"formGroup\">\n  <section class=\"choices-section\">\n    <ng-template\n      *ngIf=\"data.type === 'checkbox'\"\n      ngFor\n      let-choice\n      let-i=\"index\"\n      [ngForOf]=\"data.choices\"\n    >\n      <mat-checkbox formControlName=\"{{ choice.value }}\">{{\n        choice.title || choice.value\n      }}</mat-checkbox>\n    </ng-template>\n\n    <mat-radio-group *ngIf=\"data.type === 'radio'\" (change)=\"onChange($event)\">\n      <mat-radio-button\n        *ngFor=\"let choice of data.choices\"\n        [value]=\"choice.value\"\n      >\n        {{ choice.title || choice.value }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </section>\n  <div mat-dialog-actions>\n    <div class=\"button-group\">\n      <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n        {{ data.cancelButtonText | translate }}\n      </button>\n      <button\n        [disabled]=\"isDisabled$ | async\"\n        id=\"processBtnDialog\"\n        mat-raised-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"save()\"\n      >\n        {{ data.processButtonText | translate }}\n      </button>\n    </div>\n  </div>\n</form>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { SelectValueDialogType } from './select-value-dialog.enums';\nimport { SelectValueData } from './select-value-dialog.interface';\n\n@Component({\n  selector: 'igo-select-value-check-radio-dialog',\n  templateUrl: './select-value-check-radio-dialog.component.html',\n  styleUrls: ['./select-value-check-radio-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    NgFor,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SelectValueCheckRadioDialogComponent implements OnInit {\n  public formGroup: UntypedFormGroup;\n  public isDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SelectValueCheckRadioDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: SelectValueData\n  ) {\n    this.formGroup = this.formBuilder.group(this.getFg());\n    this.data.selectFieldText =\n      this.data.selectFieldText ??\n      'igo.common.selectValueDialog.selectFieldText';\n    this.data.processButtonText =\n      this.data.processButtonText ??\n      'igo.common.selectValueDialog.processButtonText';\n    this.data.cancelButtonText =\n      this.data.cancelButtonText ??\n      'igo.common.selectValueDialog.cancelButtonText';\n    this.data.title =\n      this.data.title ?? 'igo.common.selectValueDialog.multipleTitle';\n    if (this.data.type === SelectValueDialogType.Radio) {\n      this.data.title = 'igo.common.selectValueDialog.title';\n    }\n  }\n\n  ngOnInit() {\n    this.formGroup.valueChanges.subscribe(() => this.canProcess());\n  }\n\n  getFg() {\n    const a = {};\n    this.data.choices.map((l) => (a[l.value] = false));\n    return a;\n  }\n\n  canProcess() {\n    const choices = this.data.choices.map((l) => l.value);\n    const selectedIds = [];\n    choices.map((l) =>\n      this.formGroup.value[l] ? selectedIds.push(l) : undefined\n    );\n    selectedIds.length\n      ? this.isDisabled$.next(false)\n      : this.isDisabled$.next(true);\n  }\n\n  save() {\n    const choices = this.data.choices.map((l) => l.value);\n\n    const selectedChoices = [];\n    choices.map((l) =>\n      this.formGroup.value[l] ? selectedChoices.push(l) : undefined\n    );\n    this.dialogRef.close({ choices: selectedChoices });\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n\n  onChange(e: MatRadioChange) {\n    const choices = {};\n    this.data.choices.map((l) => (choices[l.value] = false));\n    choices[e.value] = true;\n    this.formGroup.setValue(choices);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { SelectValueCheckRadioDialogComponent } from './select-value-check-radio-dialog.component';\nimport {\n  Choice,\n  SelectValueData,\n  SelectValueDialogOptions\n} from './select-value-dialog.interface';\n\n@Injectable()\nexport class SelectValueDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    choices: Choice[],\n    options?: SelectValueDialogOptions\n  ): Observable<any> {\n    const data: SelectValueData = {\n      choices,\n      ...options\n    };\n\n    const dialogRef = this.dialog.open(SelectValueCheckRadioDialogComponent, {\n      disableClose: false,\n      data,\n      ...options\n    });\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { SelectValueCheckRadioDialogComponent } from './select-value-check-radio-dialog.component';\nimport { SelectValueDialogService } from './select-value-dialog.service';\n\n@NgModule({\n  imports: [SelectValueCheckRadioDialogComponent],\n  exports: [SelectValueCheckRadioDialogComponent],\n  providers: [SelectValueDialogService]\n})\nexport class IgoSelectValueDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoSelectValueDialogModule> {\n    return {\n      ngModule: IgoSelectValueDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport {\n  ConfirmDialogService,\n  IgoConfirmDialogModule\n} from '@igo2/common/confirm-dialog';\nimport {\n  FormDialogService,\n  FormFieldConfig,\n  FormGroupsConfig,\n  IgoFormDialogModule\n} from '@igo2/common/form';\nimport {\n  IgoJsonDialogModule,\n  JsonDialogService\n} from '@igo2/common/json-dialog';\nimport {\n  Choice,\n  IgoSelectValueDialogModule,\n  SelectValueDialogService,\n  SelectValueDialogType\n} from '@igo2/common/select-value-dialog';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-dialog',\n  templateUrl: './dialog.component.html',\n  styleUrls: ['./dialog.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    IgoConfirmDialogModule,\n    IgoSelectValueDialogModule,\n    IgoFormDialogModule,\n    IgoJsonDialogModule,\n    MatButtonModule,\n    MatDividerModule\n  ]\n})\nexport class AppDialogComponent {\n  constructor(\n    private confirmDialogService: ConfirmDialogService,\n    private selectValueDialogService: SelectValueDialogService,\n    private jsonDialogService: JsonDialogService,\n    private formDialogService: FormDialogService\n  ) {}\n\n  confirm(): void {\n    this.confirmDialogService\n      .open('Do you want to continue?')\n      .subscribe((r) => {\n        alert(`Your choice is: ${r}`);\n      });\n  }\n  yesno(): void {\n    this.confirmDialogService\n      .open('Is the sky blue today? ', { modeYesNo: true })\n      .subscribe((r) => {\n        alert(`Your choice is: ${r}`);\n      });\n  }\n\n  private select(type: SelectValueDialogType): void {\n    const choices: Choice[] = [\n      { value: '1', title: 'Chocolate' },\n      { value: '2', title: 'Candy' },\n      { value: 3, title: 'Cake' }\n    ];\n\n    this.selectValueDialogService.open(choices, { type }).subscribe((r) => {\n      if (r?.choices) {\n        if (r.choices.length > 1) {\n          alert(`Your choice(s) are: ${r.choices}`);\n        } else {\n          alert(`Your choice is: ${r.choices}`);\n        }\n      }\n    });\n  }\n\n  check(): void {\n    this.select(SelectValueDialogType.Checkbox);\n  }\n  radio(): void {\n    this.select(SelectValueDialogType.Radio);\n  }\n\n  json(): void {\n    this.jsonDialogService.open(\n      'A JSON viewer',\n      {\n        isbn: '123-456-222',\n        author: {\n          lastname: 'Doe',\n          firstname: 'Jane'\n        },\n        editor: {\n          lastname: 'Smith',\n          firstname: 'Jane'\n        },\n        title: 'The Ultimate Database Study Guide',\n        category: ['Non-Fiction', 'Technology']\n      },\n      ['category']\n    );\n  }\n  form(): void {\n    const formFieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'country',\n        title: 'Country',\n        options: {\n          cols: 1\n        }\n      }\n    ];\n\n    const formFieldConfigs1: FormFieldConfig[] = [\n      {\n        name: 'city',\n        title: 'City',\n        options: {\n          cols: 1\n        }\n      }\n    ];\n    const formFieldConfigs2: FormFieldConfig[] = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            { value: 1, title: 'Single' },\n            { value: 2, title: 'Married' }\n          ]\n        }\n      }\n    ];\n\n    const formGroupsConfigs: FormGroupsConfig[] = [\n      { name: 'country', formFieldConfigs: formFieldConfigs1 },\n      { name: 'city', formFieldConfigs: formFieldConfigs2 }\n    ];\n\n    this.formDialogService\n      .open({ formFieldConfigs, formGroupsConfigs }, { minWidth: '50vh' })\n      .subscribe((data: any) => {\n        if (data) {\n          alert(JSON.stringify(data));\n        }\n      });\n  }\n\n  email(): void {\n    const formFieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'email',\n        title: 'Email',\n        options: {\n          cols: 2,\n          validator: Validators.compose([Validators.required, Validators.email])\n        }\n      },\n      {\n        name: 'password',\n        title: 'Password',\n        options: {\n          cols: 2,\n          validator: Validators.required\n        },\n        inputs: {\n          isPassword: true\n        }\n      }\n    ];\n\n    this.formDialogService.open({ formFieldConfigs }).subscribe((data: any) => {\n      if (data) {\n        data.password = '°°°°°°°°°°';\n        alert(JSON.stringify(data));\n      }\n    });\n  }\n}\n","<app-doc-viewer title=\"Various dialogs\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dialog\">\n    <section>\n      <div class=\"example-label\">Confirmation</div>\n      <div class=\"example-button-row\">\n        <button\n          mat-flat-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"confirm()\"\n        >\n          Base dialog\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"yesno()\">\n          Yes/no confirm dialog\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n\n    <section>\n      <div class=\"example-label\">Custom selectors</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"check()\">\n          Open a dialog to select values by checkboxes\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"radio()\">\n          Open a dialog to select values by radio buttons\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n    <section>\n      <div class=\"example-label\">Form based</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"form()\">\n          Basic form\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"email()\">\n          Email\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n    <section>\n      <div class=\"example-label\">Renderer</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"json()\">\n          Open a dialog to open a json\n        </button>\n      </div>\n    </section>\n  </app-example-viewer>\n</app-doc-viewer>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  DynamicOutletComponent,\n  OnUpdateInputs\n} from '@igo2/common/dynamic-component';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template:\n    '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    DynamicOutletComponent,\n    MatButtonModule\n  ]\n})\nexport class AppDynamicComponentComponent {\n  component: any = AppSalutationComponent;\n\n  inputs = { name: 'Bob' };\n\n  toggleComponent() {\n    this.component =\n      this.component === AppSalutationComponent\n        ? AppExplanationComponent\n        : AppSalutationComponent;\n  }\n}\n","<app-doc-viewer title=\"Dynamic Component\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dynamic-component\">\n    <igo-dynamic-outlet [component]=\"component\" [inputs]=\"inputs\">\n    </igo-dynamic-outlet>\n\n    <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">\n      Toggle Component\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Entity Selector\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-selector\">\n    <igo-entity-selector\n      [store]=\"store\"\n      [titleAccessor]=\"getTitle\"\n      [emptyText]=\"''\"\n      [placeholder]=\"'Select an entity'\"\n      (selectedChange)=\"onSelectedChange($event)\"\n    >\n    </igo-entity-selector>\n\n    <div *ngIf=\"entityIsSelected\">\n      <p>ID: {{ (selectedEntity$ | async).id }}</p>\n      <p>Name: {{ (selectedEntity$ | async).name }}</p>\n      <p>Description: <span [innerHtml]=\"(selectedEntity$ | async).description\"></span></p>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport { EntitySelectorComponent, EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    EntitySelectorComponent,\n    NgIf,\n    AsyncPipe\n  ]\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n  public store: EntityStore = new EntityStore([]);\n\n  public selectedEntity$: BehaviorSubject<DemoEntity> =\n    new BehaviorSubject<DemoEntity>(undefined);\n  public entityIsSelected: boolean;\n\n  constructor() {}\n\n  ngOnInit(): void {\n    this.store.load([\n      { id: '2', name: 'Name 2', description: '<b>Description 2</b>' },\n      { id: '1', name: 'Name 1', description: '<b>Description 1</b>' },\n      { id: '3', name: 'Name 3', description: '<b>Description 3</b>' }\n    ] satisfies DemoEntity[]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: { selected: boolean; value: DemoEntity }): void {\n    this.entityIsSelected = event.value.id ? true : false;\n    this.selectedEntity$.next(event.value);\n  }\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\n\nimport {\n  EntityStore,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTablePaginatorOptions,\n  EntityTableTemplate,\n  getEntityProperty\n} from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, EntityTableComponent]\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store: EntityStore = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = { pageSize: 10 };\n\n  public template: EntityTableTemplate = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radio_button_checked'\n            : 'radio_button_unchecked';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'date',\n        title: 'Date',\n        type: 'date'\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: () => {\n          return [\n            {\n              icon: 'home',\n              color: 'warn',\n              click: (row) => {\n                console.log(row);\n              }\n            }\n          ] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor() {}\n\n  ngOnInit(): void {\n    const ids: number[] = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities: object[] = ids.map((id: number) => {\n      if (id === 3) {\n        return {\n          id,\n          name: `Name ${id}`,\n          description: `<b>Description ${id}</b>`,\n          date: new Date(),\n          url: 'https://igouverte.org',\n          image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'\n        };\n      }\n      return {\n        id,\n        name: `Name ${id}`,\n        description: `<b>Description ${id}</b>`,\n        date: new Date(),\n        url: 'https://igouverte.org',\n        image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'\n      };\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange(): void {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator): void {\n    this.paginator = event;\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Entity Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-table\">\n    <igo-entity-table\n      [store]=\"store\"\n      [withPaginator]=\"true\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [template]=\"template\"\n      (entitySortChange)=\"entitySortChange()\"\n    >\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Form\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/form\">\n    <igo-form\n      *ngIf=\"form$ | async as form\"\n      [form]=\"form\"\n      [formData]=\"data$ | async\"\n      (submitForm)=\"onSubmit($event)\"\n    >\n      <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n      <div formButtons class=\"actions-container\">\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"fillForm()\"\n        >\n          Fill Form\n        </button>\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"clearForm()\"\n        >\n          Clear Form\n        </button>\n        <button\n          mat-flat-button\n          type=\"submit\"\n          color=\"primary\"\n          [disabled]=\"submitDisabled\"\n        >\n          Submit\n        </button>\n      </div>\n    </igo-form>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  Form,\n  FormComponent,\n  FormField,\n  FormFieldConfig,\n  FormGroupComponent,\n  FormService\n} from '@igo2/common/form';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    NgIf,\n    FormComponent,\n    FormGroupComponent,\n    MatButtonModule,\n    AsyncPipe\n  ]\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n  form$: BehaviorSubject<Form> = new BehaviorSubject<Form>(undefined);\n\n  data$: BehaviorSubject<object> = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(private formService: FormService) {}\n\n  ngOnInit() {\n    const fieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            { value: 1, title: 'Single' },\n            { value: 2, title: 'Married' }\n          ]\n        }\n      }\n    ];\n\n    const fields: FormField[] = fieldConfigs.map((config: FormFieldConfig) =>\n      this.formService.field(config)\n    );\n    const form: Form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy(): void {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm(): void {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm(): void {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: object): void {\n    alert(JSON.stringify(data));\n  }\n}\n","import { Component } from '@angular/core';\nimport { FormControl, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoIconComponent } from '@igo2/common/icon';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-icon',\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    IgoIconComponent,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule\n  ],\n  templateUrl: './icon.component.html',\n  styleUrl: './icon.component.scss'\n})\nexport class AppIconComponent {\n  exampleIndexHtml: string = EXAMPLE_INDEX_HTML;\n  exampleIndexStaticHtml: string = EXAMPLE_INDEX_STATIC_HTML;\n  exampleStyleVariable: string = EXAMPLE_STYLE_VARIABLE;\n  exampleProvider: string = EXAMPLE_PROVIDER;\n\n  nameControl = new FormControl<string>('shopping_cart_checkout');\n}\n\nconst EXAMPLE_INDEX_STATIC_HTML = `<link rel=\"stylesheet\" href=\"\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0\"\" />`;\nconst EXAMPLE_INDEX_HTML = `<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\" />`;\n\nconst EXAMPLE_STYLE_VARIABLE = `.material-symbols-outlined {\n  font-variation-settings:\n  'FILL' 0,\n  'wght' 400,\n  'GRAD' 0,\n  'opsz' 24\n}`;\n\nconst EXAMPLE_PROVIDER = `import { provideIcon } from '@igo2/common/icon';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideIcon(),\n  ]\n})\n`;\n","<app-doc-viewer title=\"Icon\" subtitle=\"Common\">\n  <section>\n    <p>\n      The <code>icon</code> is a core concept for many packages of the IGO2\n      library. The icon system is base on\n      <a href=\"https://fonts.google.com/icons\" target=\"_blank\"\n        >Google Font - Material Symbol</a\n      >\n      who use font ligature to configure the icon\n    </p>\n  </section>\n\n  <section>\n    <h3>Getting started</h3>\n\n    <h2>Static icon font (Most light in term of data)</h2>\n    In your\n    <code>index.html</code>\n    file, add the variable font stylesheet request to your head tag and\n    <pre><code>{{exampleIndexStaticHtml}}</code></pre>\n\n    <h2>Variable icon font (Alternative)</h2>\n    <ol>\n      <li>\n        In your\n        <code>index.html</code>\n        file, add the variable font stylesheet request to your head tag and\n        <pre><code>{{exampleIndexHtml}}</code></pre>\n      </li>\n      <li>\n        Then add the current class with variable axes configuration to icons in\n        your <code>style.scss</code> file.\n        <pre><code>{{exampleStyleVariable}}</code></pre>\n      </li>\n      <li>\n        Finally, add the icon provider configuration in your main file\n        <code>main.ts</code>\n        <pre><code>{{exampleProvider}}</code></pre>\n      </li>\n    </ol>\n  </section>\n\n  <app-example-viewer title=\"Icon\" codeFolder=\"common/icon\">\n    <p>\n      Enter a name from the\n      <a href=\"https://fonts.google.com/icons\" target=\"_blank\"\n        >Google Font - Material Symbol</a\n      >\n    </p>\n    <div class=\"field-container\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>Icon Name</mat-label>\n        <input matInput type=\"text\" [formControl]=\"nameControl\" />\n      </mat-form-field>\n      <igo-icon icon=\"equal\" class=\"m-h-12\"></igo-icon>\n      <igo-icon [icon]=\"nameControl.value\"></igo-icon>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { TableDatabase } from './table-database';\nimport { TableModel } from './table-model.interface';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map((data) => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter((c) => c.filterable)\n        .map((c) => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","<div class=\"table-box\">\n  <div class=\"table-header\" *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder=\"never\">\n      <input\n        matInput\n        #filter\n        [placeholder]=\"'igo.common.table.filter' | translate\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div class=\"table-container\">\n    <table mat-table #table [dataSource]=\"dataSource\" matSort>\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox\n            (change)=\"$event ? masterToggle() : null\"\n            [checked]=\"selection.hasValue() && isAllSelected()\"\n            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\n          >\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"$event ? selection.toggle(row) : null\"\n            [checked]=\"selection.isSelected(row)\"\n          >\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container\n        [matColumnDef]=\"column.name\"\n        *ngFor=\"let column of model.columns\"\n      >\n        <ng-container *ngIf=\"column.sortable\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>\n            {{ column.title }}\n          </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.sortable\">\n          <th mat-header-cell *matHeaderCellDef>{{ column.title }}</th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n          >\n            {{ getValue(row, column.name) }}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n            [innerHTML]=\"getValue(row, column.name)\"\n          ></td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef=\"action\">\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef=\"let row\">\n          <button\n            *ngFor=\"let action of model.actions\"\n            mat-mini-fab\n            [color]=\"getActionColor(action.color)\"\n            (click)=\"handleClickAction($event, action, row)\"\n          >\n            <mat-icon>{{ action.icon }}</mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n      <tr\n        mat-row\n        *matRowDef=\"let row; columns: displayedColumns\"\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\"\n      ></tr>\n    </table>\n  </div>\n</div>\n","import { SelectionModel } from '@angular/cdk/collections';\nimport { NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSort, MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { fromEvent } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\n\nimport { TableActionColor } from './table-action-color.enum';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableModel } from './table-model.interface';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatTableModule,\n    MatSortModule,\n    MatCheckboxModule,\n    NgFor,\n    NgClass,\n    MatButtonModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter((c) => c.displayed !== false)\n        .map((c) => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe((e) => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(debounceTime(150), distinctUntilChanged())\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach((row) => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport {\n  TableActionColor,\n  TableComponent,\n  TableDatabase,\n  TableModel\n} from '@igo2/common/table';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, TableComponent]\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model: TableModel = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'description',\n        color: TableActionColor.primary,\n        click: (row) => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor() {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name: string): void {\n    alert(name);\n  }\n\n  handleSelect(rows: any): void {\n    console.log(rows);\n  }\n}\n","<app-doc-viewer title=\"Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/table\">\n    <igo-table\n      [database]=\"database\"\n      [model]=\"model\"\n      [hasFilterInput]=\"true\"\n      (select)=\"handleSelect($event)\"\n    >\n    </igo-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Tool\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/tool\">\n    <igo-panel [title]=\"panelTitle\">\n      <button\n        mat-icon-button\n        panelLeftButton\n        (click)=\"toolbox.activatePreviousTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon>arrow_back</mat-icon>\n      </button>\n\n      <button\n        mat-icon-button\n        panelRightButton\n        (click)=\"toolbox.deactivateTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon>menu</mat-icon>\n      </button>\n\n      <igo-toolbox\n        [toolbox]=\"toolbox\"\n        [animate]=\"true\"\n        color=\"primary\"\n      ></igo-toolbox>\n    </igo-panel>\n\n    <button\n      mat-flat-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"activateSalutationTool()\"\n    >\n      Activate Salutation Tool\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { OnUpdateInputs } from '@igo2/common/dynamic-component';\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  Tool,\n  ToolComponent,\n  ToolService,\n  Toolbox,\n  ToolboxComponent\n} from '@igo2/common/tool';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'person',\n  options: { name: 'Jack' }\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: ` <p>Hello, my name is {{ name }}.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: ` <p>I'm a tool inside a toolbox.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    PanelComponent,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    ToolboxComponent,\n    AsyncPipe\n  ]\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n  toolbox: Toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(private toolService: ToolService) {}\n\n  ngOnInit(): void {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy(): void {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool(): void {\n    this.toolbox.activateTool('demo-salutation', { name: 'Bob' });\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  DynamicComponent,\n  OnUpdateInputs\n} from '@igo2/common/dynamic-component';\nimport {\n  IgoWidgetOutletModule,\n  WidgetComponent,\n  WidgetService\n} from '@igo2/common/widget';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{ name }}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">\n      Nice to meet you\n    </button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule]\n})\nexport class AppSalutationWidgetComponent\n  implements OnUpdateInputs, WidgetComponent\n{\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, IgoWidgetOutletModule]\n})\nexport class AppWidgetComponent {\n  widget: DynamicComponent<WidgetComponent>;\n\n  inputs = { name: 'Bob' };\n\n  constructor(private widgetService: WidgetService) {\n    this.widget = this.widgetService.create(AppSalutationWidgetComponent);\n  }\n\n  onWidgetComplete(name: string): void {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel(): void {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n}\n","import { Routes } from '@angular/router';\n\nimport { AppActionComponent } from './action/action.component';\nimport { AppDialogComponent } from './dialog/dialog.component';\nimport { AppDynamicComponentComponent } from './dynamic-component/dynamic-component.component';\nimport { AppEntitySelectorComponent } from './entity-selector/entity-selector.component';\nimport { AppEntityTableComponent } from './entity-table/entity-table.component';\nimport { AppFormComponent } from './form/form.component';\nimport { AppIconComponent } from './icon/icon.component';\nimport { AppTableComponent } from './table/table.component';\nimport { AppToolComponent } from './tool/tool.component';\nimport { AppWidgetComponent } from './widget/widget.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'action', pathMatch: 'full' },\n  {\n    title: 'Action',\n    path: 'action',\n    component: AppActionComponent\n  },\n  {\n    title: 'Dialogs',\n    path: 'dialog',\n    component: AppDialogComponent\n  },\n  {\n    title: 'Dynamic Component',\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  },\n  {\n    title: 'Entity Table',\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  },\n  {\n    title: 'Entity Selector',\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  },\n  {\n    title: 'Form',\n    path: 'form',\n    component: AppFormComponent\n  },\n  {\n    title: 'Icon',\n    path: 'icon',\n    component: AppIconComponent\n  },\n  {\n    title: 'Table',\n    path: 'table',\n    component: AppTableComponent\n  },\n  {\n    title: 'Tool',\n    path: 'tool',\n    component: AppToolComponent\n  },\n  {\n    title: 'Widget',\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n","<app-doc-viewer title=\"Widget\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/widget\">\n    <igo-widget-outlet\n      [widget]=\"widget\"\n      [inputs]=\"inputs\"\n      (complete)=\"onWidgetComplete($event)\"\n      (cancel)=\"onWidgetCancel()\"\n    >\n    </igo-widget-outlet>\n  </app-example-viewer>\n</app-doc-viewer>\n","<h6 class=\"mat-subtitle-2 m-b-0\">{{ subtitle }}</h6>\n<h2>{{ title }}</h2>\n\n<div class=\"mat-body-1\">\n  <ng-container *ngIf=\"dependencies?.length\">\n    <label for=\"\">Dependencies:</label>\n    <ul>\n      <li *ngFor=\"let dep of dependencies\">{{ dep }}</li>\n    </ul>\n  </ng-container>\n  <ng-content></ng-content>\n</div>\n<!-- <mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>{{subtitle}}</mat-card-subtitle>\n    <mat-card-title>{{title}}</mat-card-title>\n  </mat-card-header>\n  <mat-card-content>\n    <ng-container *ngIf=\"dependencies?.length\">\n        <label for=\"\">Dependencies:</label>\n        <ul>\n            <li *ngFor=\"let dep of dependencies\">{{dep}}</li>\n        </ul>\n        <br />\n    </ng-container>\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card> -->\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'app-doc-viewer',\n  templateUrl: './doc-viewer.component.html',\n  styleUrls: ['./doc-viewer.component.scss'],\n  standalone: true,\n  imports: [NgIf, NgFor]\n})\nexport class DocViewerComponent {\n  @Input() title: string;\n  @Input() subtitle: string;\n  @Input() dependencies: string[];\n}\n","<mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>\n      {{ title }}\n    </mat-card-subtitle>\n    <div class=\"actions\">\n      <a\n        *ngIf=\"codeFolder\"\n        mat-icon-button\n        [href]=\"codeUrl\"\n        target=\"_blank\"\n        matTooltip=\"View code example\"\n      >\n        <mat-icon>code-tags</mat-icon>\n      </a>\n      <a\n        *ngIf=\"configFolder\"\n        mat-icon-button\n        [href]=\"configUrl\"\n        target=\"_blank\"\n        matTooltip=\"View config example\"\n      >\n        <mat-icon>settings</mat-icon>\n      </a>\n    </div>\n  </mat-card-header>\n\n  <mat-divider class=\"m-b-16\"></mat-divider>\n\n  <mat-card-content class=\"mat-body-1\">\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nconst SRC_PATH =\n  'https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src';\n\n@Component({\n  selector: 'app-example-viewer',\n  templateUrl: './example-viewer.component.html',\n  styleUrls: ['./example-viewer.component.scss'],\n  standalone: true,\n  imports: [\n    MatCardModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatDividerModule\n  ]\n})\nexport class ExampleViewerComponent {\n  @Input() title: string;\n  @Input() codeFolder: string;\n  @Input() configFolder: string;\n\n  get codeUrl() {\n    return `${SRC_PATH}/app/${this.codeFolder}`;\n  }\n\n  get configUrl() {\n    return `${SRC_PATH}/${this.configFolder}`;\n  }\n}\n","<app-doc-viewer\n  title=\"Context\"\n  subtitle=\"Context\"\n  [dependencies]=\"['HttpClientModule']\"\n>\n  <app-example-viewer codeFolder=\"context/context\" configFolder=\"contexts\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          igoMapContext\n          igoLayerContext\n          [map]=\"map\"\n          [view]=\"view\"\n        >\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100\">\n          <igo-panel title=\"Contexts list\" class=\"h-100 w-100\">\n            <igo-context-list\n              igoContextListBinding\n              [map]=\"map\"\n            ></igo-context-list>\n          </igo-panel>\n\n          <igo-panel title=\"Layers\" class=\"h-100 w-100\">\n            <igo-layer-list igoLayerListBinding [map]=\"map\">\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n\n  <app-example-viewer\n    title=\"Import/Export context\"\n    codeFolder=\"context/context\"\n    configFolder=\"contexts\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppContextComponent } from './context/context.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'context', pathMatch: 'full' },\n  {\n    title: 'Context',\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  CONTEXT_MANAGER_DIRECTIVES,\n  ContextImportExportComponent,\n  ContextService\n} from '@igo2/context';\nimport {\n  IgoMap,\n  LAYER_DIRECTIVES,\n  MAP_DIRECTIVES,\n  METADATA_DIRECTIVES,\n  MapService,\n  MapViewOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    CONTEXT_MANAGER_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES,\n    METADATA_DIRECTIVES,\n    ContextImportExportComponent\n  ]\n})\nexport class AppContextComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private mapService: MapService,\n    private contextService: ContextService\n  ) {\n    this.mapService.setMap(this.map);\n    this.contextService.loadDefaultContext();\n    this.contextService.loadContexts();\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport { ActivityService } from '@igo2/core/activity';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    SpinnerComponent,\n    MatButtonModule\n  ]\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter(): number {\n    return this.activityService.counter$.value;\n  }\n}\n","<app-doc-viewer title=\"Activity\" subtitle=\"Core\">\n  <p>Register activities in service. Use to display a loading icon</p>\n\n  <li>\n    Import <code>IgoActivityModule</code> only if you want register HTTP calls\n  </li>\n  <li>Import <code>IgoActivityModule</code> only once</li>\n\n  <app-example-viewer codeFolder=\"core/activity\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"register()\">Register</button>\n      <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n    </div>\n\n    <div class=\"mat-body-1 sub-content\">\n      <p>Counter: {{ counter }}</p>\n\n      <igo-spinner igoSpinnerActivity></igo-spinner>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { JsonPipe } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageOptions } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, JsonPipe]\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<app-doc-viewer title=\"Config\" subtitle=\"Core\">\n  <p>Load config in your angular application</p>\n\n  <li>Import <code>IgoConfigModule</code> only once</li>\n\n  <app-example-viewer\n    title=\"Simple config\"\n    codeFolder=\"core/config\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">Config language: {{ configLanguage | json }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule, LanguageService } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<app-doc-viewer title=\"Language\" subtitle=\"Core\">\n  <p>Translate your angular application</p>\n\n  <li>Import <code>IgoLanguageModule</code> only once</li>\n  <li>\n    Configure the\n    <a\n      href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale\"\n      >locale files</a\n    >\n  </li>\n\n  <app-example-viewer codeFolder=\"core/language\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n      <button mat-raised-button (click)=\"changeLanguage('fr')\">Français</button>\n    </div>\n\n    <div class=\"m-t-12\">\n      {{ 'welcome' | translate: app }}\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport { Media, MediaOrientation, MediaService } from '@igo2/core/media';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent]\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation(): MediaOrientation {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n}\n","<app-doc-viewer title=\"Media\" subtitle=\"Core\">\n  <p>Detect type of media (mobile, tablet, desktop)</p>\n\n  <app-example-viewer codeFolder=\"core/media\">\n    <p>Current media: {{ media }}</p>\n    <p>Current orientation: {{ orientation }}</p>\n    <p>\n      Device mode:\n      {{ isTouchScreen ? 'Touch device' : 'Not a touch device ' }}\n    </p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MatButtonModule]\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success(): void {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info(): void {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert(): void {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error(): void {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<app-doc-viewer title=\"Message\" subtitle=\"Core\">\n  <p>Show message to user.</p>\n\n  <li>Import <code>IgoMessageModule</code> only once</li>\n  <li>Dependencies: BrowserAnimationsModule</li>\n\n  <app-example-viewer codeFolder=\"core/message\">\n    <div class=\"d-flex m-t-16 actions-container\">\n      <button mat-raised-button (click)=\"success()\">Success message</button>\n      <button mat-raised-button color=\"primary\" (click)=\"info()\">\n        Info message\n      </button>\n      <button mat-raised-button color=\"accent\" (click)=\"alert()\">\n        Alert message\n      </button>\n      <button mat-raised-button color=\"warn\" (click)=\"error()\">\n        Error message\n      </button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { BaseUser } from '@igo2/core/user';\n\nimport { setUser } from '@sentry/angular';\n\nimport { SentryMonitoringOptions } from './sentry.interface';\n\nexport const isTracingEnabled = (options: SentryMonitoringOptions): boolean =>\n  !!options.tracesSampleRate || !!options.tracesSampler;\n\nexport const isReplayEnabled = (options: SentryMonitoringOptions): boolean =>\n  !!options.replaysSessionSampleRate || !!options.replaysOnErrorSampleRate;\n\nexport const identifySentryUser = (user: BaseUser | null): void => {\n  setUser(\n    user\n      ? {\n          id: user.id,\n          username: `${user.firstName} ${user.lastName}`,\n          email: user.email\n        }\n      : null\n  );\n};\n","import {\n  BrowserOptions,\n  SentryErrorHandler,\n  browserTracingIntegration,\n  createErrorHandler,\n  getClient,\n  init,\n  replayIntegration\n} from '@sentry/angular';\n\nimport { SentryMonitoringOptions } from './sentry.interface';\nimport { isReplayEnabled, isTracingEnabled } from './sentry.utils';\n\nexport const createSentryErrorHandler = (\n  options: SentryMonitoringOptions\n): SentryErrorHandler => {\n  return createErrorHandler({\n    logErrors: options.logErrors,\n    ...(options.errorHandlerOptions ?? {})\n  });\n};\n\nexport const initSentry = (\n  options: SentryMonitoringOptions,\n  force?: boolean\n): void => {\n  const client = getClient();\n  if (!force && client) {\n    return;\n  }\n\n  const baseConfig: BrowserOptions = {\n    ...options,\n    integrations: [\n      isTracingEnabled(options) && browserTracingIntegration(),\n      isReplayEnabled(options) && replayIntegration()\n    ].filter(Boolean)\n  };\n\n  init(baseConfig);\n};\n","import { InjectionToken, Provider } from '@angular/core';\n\nimport { provideSentryMonitoring } from './sentry/sentry.provider';\nimport { AnyMonitoringOptions, MonitoringOptions } from './shared';\n\nexport const MONITORING_OPTIONS = new InjectionToken<MonitoringOptions | null>(\n  'monitoring.options'\n);\n\nexport function provideMonitoring(\n  options: AnyMonitoringOptions | null\n): Provider[] {\n  if (!options) {\n    return [];\n  }\n\n  const providers: Provider[] = [\n    { provide: MONITORING_OPTIONS, useValue: options }\n  ];\n\n  switch (options.provider) {\n    case 'sentry':\n      providers.push(...provideSentryMonitoring(options));\n      break;\n    default:\n      break;\n  }\n\n  return providers;\n}\n","import {\n  APP_INITIALIZER,\n  ConstructorProvider,\n  ErrorHandler,\n  FactoryProvider\n} from '@angular/core';\nimport { Router } from '@angular/router';\n\nimport { TraceService } from '@sentry/angular';\n\nimport { createSentryErrorHandler, initSentry } from './sentry';\nimport { SentryMonitoringOptions } from './sentry.interface';\nimport { isTracingEnabled } from './sentry.utils';\n\nexport const provideSentryMonitoring = (\n  options: SentryMonitoringOptions\n): (FactoryProvider | ConstructorProvider)[] => {\n  const isEnabled = options.enabled !== undefined ? options.enabled : true;\n  if (!isEnabled) {\n    return [];\n  }\n\n  initSentry(options);\n\n  const tracingEnabled = isTracingEnabled(options);\n\n  return [\n    {\n      provide: ErrorHandler,\n      useFactory: () => createSentryErrorHandler(options)\n    },\n    tracingEnabled && {\n      provide: TraceService,\n      deps: [Router]\n    },\n    // Force instantiate TraceService to avoid require it in any constructor.\n    tracingEnabled && {\n      provide: APP_INITIALIZER,\n      useFactory: () => () => {},\n      deps: [TraceService],\n      multi: true\n    }\n  ].filter(Boolean);\n};\n","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\n\r\nimport { AuthService, User } from '@igo2/auth';\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS,\r\n  identifySentryUser\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { first, switchMap } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthMonitoringService {\r\n  // The AuthService need to be lazy provided because this service is provided in the APP_INITIALIZER\r\n  authService?: AuthService;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    @Optional()\r\n    @Inject(MONITORING_OPTIONS)\r\n    private monitoringOptions: AnyMonitoringOptions | null,\r\n    private injector: Injector\r\n  ) {\r\n    if (!this.monitoringOptions?.identifyUser) {\r\n      return;\r\n    }\r\n\r\n    this.configService.isLoaded$\r\n      .pipe(\r\n        first((isLoaded) => isLoaded),\r\n        switchMap(() => {\r\n          this.authService = this.injector.get(AuthService);\r\n          return this.authService?.authenticate$;\r\n        })\r\n      )\r\n      .subscribe((isAuthenticated) => {\r\n        const user = isAuthenticated ? this.authService.user : null;\r\n        this._identifyUser(user);\r\n      });\r\n  }\r\n\r\n  private _identifyUser(user: User | null): void {\r\n    switch (this.monitoringOptions.provider) {\r\n      case 'sentry':\r\n        identifySentryUser(user);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","import { APP_INITIALIZER, Injector, Provider } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { AuthMonitoringService } from './auth-monitoring.service';\r\n\r\nexport function provideAuthUserMonitoring(\r\n  options: AnyMonitoringOptions | null\r\n): Provider[] {\r\n  if (!options) {\r\n    return [];\r\n  }\r\n\r\n  return [\r\n    {\r\n      provide: AuthMonitoringService,\r\n      useClass: AuthMonitoringService,\r\n      deps: [ConfigService, MONITORING_OPTIONS, Injector]\r\n    },\r\n    // Force instantiate Tracing service to avoid require it in any constructor.\r\n    {\r\n      provide: APP_INITIALIZER,\r\n      useFactory: () => () => {},\r\n      deps: [AuthMonitoringService],\r\n      multi: true\r\n    }\r\n  ];\r\n}\r\n","import { JsonPipe } from '@angular/common';\r\nimport { Component, Inject } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\n\r\nimport { provideAuthUserMonitoring } from '@igo2/auth/monitoring';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS,\r\n  provideMonitoring\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { environment } from 'projects/demo/src/environments/environment';\r\n\r\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\r\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\r\n\r\n@Component({\r\n  selector: 'app-monitoring',\r\n  templateUrl: './monitoring.component.html',\r\n  styleUrls: ['./monitoring.component.scss'],\r\n  providers: [\r\n    JsonPipe,\r\n    ...provideMonitoring(environment.igo.monitoring),\r\n    ...provideAuthUserMonitoring(environment.igo.monitoring)\r\n  ],\r\n  standalone: true,\r\n  imports: [DocViewerComponent, ExampleViewerComponent, MatButtonModule]\r\n})\r\nexport class AppMonitoringComponent {\r\n  exampleProviderCode: string = EXAMPLE_PROVIDER;\r\n  constructor(\r\n    @Inject(MONITORING_OPTIONS)\r\n    public options: AnyMonitoringOptions | null,\r\n    private json: JsonPipe\r\n  ) {}\r\n\r\n  throwTestError(): void {\r\n    throw new Error('Sentry Test Error');\r\n  }\r\n\r\n  getBasicConfigExample(): string {\r\n    const codeExample = `{\"igo\": {\"monitoring\": ${JSON.stringify(\r\n      this.options,\r\n      null,\r\n      2\r\n    )}}}`;\r\n    return this.json.transform(JSON.parse(codeExample));\r\n  }\r\n}\r\n\r\nconst EXAMPLE_PROVIDER = `bootstrapApplication(AppComponent, {\r\n  providers: [\r\n    ...provideMonitoring(environment.igo.monitoring),\r\n\r\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \r\n    ...provideAuthUserMonitoring(environment.igo.monitoring)\r\n  ]\r\n})\r\n`;\r\n","<app-doc-viewer title=\"Monitoring\" subtitle=\"Core\">\n  <section>\n    <p>\n      The <code>monitoring</code> package provides a set of configuration for\n      managing application monitoring\n    </p>\n    <ul>\n      <li>Error montioring, report application exception</li>\n      <li>Custom event reporting, like tracking use of code deprecation</li>\n    </ul>\n  </section>\n\n  <section>\n    <h3>Getting started</h3>\n    <p>\n      Start by configure the monitoring options in your\n      <code>environnment.ts</code> file. You can complement this configuration\n      with your provider options. To get the basic options, for Sentry consult\n      the\n      <a\n        href=\"https://docs.sentry.io/platforms/javascript/configuration/options\"\n        target=\"_blank\"\n        >documentation</a\n      >\n    </p>\n    <pre><code>{{getBasicConfigExample()}}</code></pre>\n  </section>\n\n  <section>\n    <h3>Identify user information with the event</h3>\n    <p>\n      If you yant to identify the user with the monitoring event, you need to\n      configure <code>identifyUser</code> to true in the monitoring options.\n      Then import the <code>provideAuthUserMonitoring</code> to your main file.\n    </p>\n  </section>\n\n  <section>\n    <h3>Add Readable Stack Traces to Errors for your application</h3>\n    <p>\n      Follow the instruction\n      <a\n        href=\"https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/\"\n        target=\"_blank\"\n        >Sentry - Source Maps</a\n      >\n    </p>\n  </section>\n\n  <section>\n    <h3>Initialize monitoring</h3>\n    <p>\n      Then import the <code>provideMonitoring</code> providers into your main\n      file\n    </p>\n    <pre><code [innerHTML]=\"exampleProviderCode\"></code></pre>\n  </section>\n\n  <app-example-viewer\n    title=\"Sentry\"\n    codeFolder=\"core/monitoring\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">\n      Trigger a test error somewhere in your Angular app, for example in your\n      main app component. Once triggered, an error event should be sent on your\n      Sentry application\n    </p>\n    <button mat-raised-button color=\"warn\" (click)=\"throwTestError()\">\n      Throw Test Error\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { HttpClient } from '@angular/common/http';\nimport { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { LanguageService } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss'],\n  standalone: true,\n  imports: [\n    // IgoErrorModule,\n    // IgoLoggingModule, // Import in your root module or main.ts, only if you want register http calls in console\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatButtonModule\n  ]\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n}\n","<app-doc-viewer title=\"Request\" subtitle=\"Core\">\n  <p>Register http calls in console</p>\n\n  <li>\n    Import <code>IgoLoggingModule</code> only if you want register HTTP calls in\n    console\n  </li>\n  <li>\n    Import <code>IgoErrorModule</code> only if you want register errors from\n    HTTP calls in console\n  </li>\n  <li>Import modules only once</li>\n\n  <app-example-viewer codeFolder=\"core/core\">\n    <div class=\"actions-container\">\n      <button mat-raised-button (click)=\"callHttp()\">Log</button>\n      <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Theme\" subtitle=\"Core\">\n  <p>Change the app theme</p>\n\n  <app-example-viewer codeFolder=\"core/theme\">\n    <div class=\"actions-container\">\n      <mat-form-field>\n        <mat-select\n          (selectionChange)=\"loadTheme($event)\"\n          placeholder=\"Select a theme\"\n        >\n          <mat-option *ngFor=\"let theme of themes\" [value]=\"theme.value\">\n            {{ theme.title }}\n          </mat-option>\n          <mat-option value=\"dark-demo-test\"> Dark theme </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppActivityComponent } from './activity/activity.component';\nimport { AppConfigComponent } from './config/config.component';\nimport { AppLanguageComponent } from './language/language.component';\nimport { AppMediaComponent } from './media/media.component';\nimport { AppMessageComponent } from './message/message.component';\nimport { AppMonitoringComponent } from './monitoring/monitoring.component';\nimport { AppRequestComponent } from './request/request.component';\nimport { AppThemeComponent } from './theme/theme.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'activity', pathMatch: 'full' },\n  {\n    title: 'Activity',\n    path: 'activity',\n    component: AppActivityComponent\n  },\n  {\n    title: 'Config',\n    path: 'config',\n    component: AppConfigComponent\n  },\n  {\n    title: 'Language',\n    path: 'language',\n    component: AppLanguageComponent\n  },\n  {\n    title: 'Media',\n    path: 'media',\n    component: AppMediaComponent\n  },\n  {\n    title: 'Message',\n    path: 'message',\n    component: AppMessageComponent\n  },\n  {\n    title: 'Monitoring',\n    path: 'monitoring',\n    component: AppMonitoringComponent\n  },\n  {\n    title: 'Request',\n    path: 'request',\n    component: AppRequestComponent\n  },\n  {\n    title: 'Themes',\n    path: 'theme',\n    component: AppThemeComponent\n  }\n];\n","import { NgFor } from '@angular/common';\nimport { Component, Renderer2 } from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectChange, MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { loadTheme } from '@igo2/utils';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-theme',\n  templateUrl: './theme.component.html',\n  styleUrls: ['./theme.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule\n  ]\n})\nexport class AppThemeComponent {\n  isDark: boolean;\n  themes = [\n    { value: 'blue', title: 'Blue' },\n    { value: 'bluedark', title: 'Blue-dark' },\n    { value: 'bluedq', title: 'Données Québec' },\n    { value: 'bluegrey', title: 'Blue grey' },\n    { value: 'dark', title: 'Dark' },\n    { value: 'deeppurple', title: 'Purple' },\n    { value: 'indigo', title: 'Indigo' },\n    { value: 'orange', title: 'Orange' },\n    { value: 'teal', title: 'Teal' }\n  ];\n\n  constructor(\n    public languageService: LanguageService,\n    private renderer: Renderer2\n  ) {}\n\n  loadTheme(matSelectChange: MatSelectChange): void {\n    if (matSelectChange.value === 'dark-demo-test') {\n      this.isDark = true;\n      this.renderer.addClass(document.body, 'dark-theme');\n      return;\n    }\n\n    if (this.isDark) {\n      this.renderer.removeClass(document.body, 'dark-theme');\n    }\n\n    loadTheme(window.document, matSelectChange.value + '-theme');\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { EntityRecord, EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  Catalog,\n  CatalogBrowserComponent,\n  CatalogItem,\n  CatalogLibaryComponent,\n  CatalogService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapService,\n  MapViewOptions,\n  TileLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    CatalogLibaryComponent,\n    CatalogBrowserComponent\n  ]\n})\nexport class AppCatalogComponent implements OnInit {\n  catalog: Catalog;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore: EntityStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore: EntityStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n\n    this.mapService.setMap(this.map);\n    this.catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog: Catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n  }\n\n  /**\n   * When the selected catalog changes, toggle the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }): void {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs(): void {\n    this.catalogService.loadCatalogs().subscribe((catalogs: Catalog[]) => {\n      this.catalogStore.clear();\n      this.catalogStore.load(\n        catalogs.concat(\n          (this.storageService.get('addedCatalogs') || []) as Catalog[]\n        )\n      );\n    });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog): void {\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Catalog\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/catalog\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Catalog Library\">\n      <igo-catalog-library\n        [store]=\"$any(catalogStore)\"\n        (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n      >\n      </igo-catalog-library>\n    </igo-panel>\n\n    <igo-panel title=\"Catalog Browser\">\n      <igo-catalog-browser\n        [catalog]=\"catalog\"\n        [store]=\"$any(catalogItemStore)\"\n        [map]=\"map\"\n      >\n      </igo-catalog-browser>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { AuthService } from '@igo2/auth';\nimport {\n  DirectionsComponent,\n  IgoMap,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapService,\n  MapViewOptions,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore,\n  TileLayer,\n  TileLayerOptions,\n  provideDirection,\n  provideSearch,\n  withIChercheSource,\n  withOsrmSource\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    DirectionsComponent\n  ],\n  providers: [\n    provideDirection(withOsrmSource()),\n    provideSearch([withIChercheSource()])\n  ]\n})\nexport class AppDirectionsComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], {\n    map: this.map\n  });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], {\n    map: this.map\n  });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], {\n    map: this.map\n  });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  public authenticated$: BehaviorSubject<boolean>;\n\n  constructor(\n    private layerService: LayerService,\n    private mapService: MapService,\n    private authService: AuthService\n  ) {\n    this.authenticated$ = this.authService.authenticate$;\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: '/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png',\n          crossOrigin: 'anonymous'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Directions\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/directions\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-directions\n            class=\"w-100\"\n            [stopsStore]=\"stopsStore\"\n            [stopsFeatureStore]=\"stopsFeatureStore\"\n            [stepFeatureStore]=\"stepFeatureStore\"\n            [routesFeatureStore]=\"routesFeatureStore\"\n            [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n            [authenticated$]=\"authenticated$\"\n          >\n          </igo-directions>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport {\n  DataSourceService,\n  DrawComponent,\n  FeatureStore,\n  FeatureWithDraw,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapService,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  ZoomButtonComponent\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  standalone: true,\n  imports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    DrawComponent,\n    DocViewerComponent,\n    ExampleViewerComponent\n  ]\n})\nexport class AppDrawComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Draw\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/draw\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport { EntityTableComponent, EntityTableTemplate } from '@igo2/common/entity';\nimport {\n  DataSourceService,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    EntityTableComponent\n  ]\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store: FeatureStore = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    const loadingStrategy: FeatureStoreLoadingStrategy =\n      new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy: FeatureStoreSelectionStrategy =\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.Default\n      });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },\n      {\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [\n            [-72, 47.8],\n            [-73.5, 47.4],\n            [-72.4, 48.6]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [\n            [\n              [-71, 46.8],\n              [-73, 47],\n              [-71.2, 46.6]\n            ]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      } satisfies FeatureDataSourceOptions)\n      .subscribe((dataSource: FeatureDataSource) => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          igoStyle: {\n            mapboxStyle: {\n              url: 'assets/mapboxStyleExample-feature.json',\n              source: 'source_nameX'\n            }\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Feature\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/feature\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-entity-table [store]=\"store\" [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Geometry Form\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/geometry\">\n    <div class=\"container\">\n      <igo-map-browser [map]=\"map\" [view]=\"view\">\n        <div class=\"map-actions --vertical --bottom --right\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n        </div>\n      </igo-map-browser>\n\n      <igo-form\n        *ngIf=\"form$ | async as form\"\n        [form]=\"form\"\n        [formData]=\"data$ | async\"\n        (submitForm)=\"onSubmit($event)\"\n      >\n        <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n        <div formButtons class=\"actions-container\">\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"fillForm()\"\n          >\n            Fill Form\n          </button>\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"clearForm()\"\n          >\n            Clear Form\n          </button>\n          <button\n            mat-flat-button\n            type=\"submit\"\n            color=\"primary\"\n            [disabled]=\"submitDisabled\"\n          >\n            Submit\n          </button>\n        </div>\n      </igo-form>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  Form,\n  FormComponent,\n  FormField,\n  FormFieldConfig,\n  FormGroupComponent,\n  FormService\n} from '@igo2/common/form';\nimport {\n  DataSourceService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    NgIf,\n    FormComponent,\n    FormGroupComponent,\n    MatButtonModule,\n    AsyncPipe\n  ]\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n  map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$: BehaviorSubject<Form> = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled: boolean = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    const fieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options: {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill: new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields: FormField[] = fieldConfigs.map((config: FormFieldConfig) =>\n      this.formService.field(config)\n    );\n    const form: Form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy(): void {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm(): void {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-106, 42],\n            [-107, 31],\n            [-81, 32],\n            [-82, 42],\n            [-106, 42]\n          ]\n        ]\n      })\n    });\n  }\n\n  clearForm(): void {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: { [key: string]: any }): void {\n    alert(JSON.stringify(data));\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\nimport {\n  DataSourceService,\n  IgoMap,\n  IgoMapModule,\n  LayerService,\n  MapViewOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, IgoMapModule]\n})\nexport class AppHoverComponent {\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: 'https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    interface WFSDataOptions extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n      params: {\n        featureTypes: 'MSP_CASERNE_PUBLIC',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'Casernes',\n          visible: true,\n          source: dataSource,\n          igoStyle: {\n            styleByAttribute: {\n              attribute: 'en_caserne',\n              data: ['true', 'false'],\n              stroke: ['red', 'blue'],\n              fill: ['#ffffff', '#ffffff'],\n              radius: [7, 7],\n              width: [2, 2]\n            },\n            hoverStyle: {\n              label: {\n                attribute: 'Caserne: ${no_caserne} \\nMun: ${nom_ssi}',\n                style: {\n                  textAlign: 'left',\n                  textBaseline: 'top',\n                  font: '12px Calibri,sans-serif',\n                  fill: { color: '#000' },\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                  backgroundStroke: {\n                    color: 'rgba(200, 200, 200, 0.75)',\n                    width: 2\n                  },\n                  stroke: { color: '#fff', width: 3 },\n                  overflow: true,\n                  offsetX: 20,\n                  offsetY: 10,\n                  padding: [2.5, 2.5, 2.5, 2.5]\n                }\n              },\n              baseStyle: {\n                circle: {\n                  stroke: {\n                    color: 'orange',\n                    width: 5\n                  },\n                  radius: 15\n                }\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Hover\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/hover\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoHoverFeature\n      [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n      [igoHoverFeatureEnabled]=\"true\"\n    >\n      <div class=\"map-actions --vertical --top --right\">\n        <div class=\"spinner-spacer\"></div>\n        <igo-rotation-button\n          class=\"mat-elevation-z2\"\n          [showIfNoRotation]=\"true\"\n          [map]=\"map\"\n          color=\"primary\"\n        ></igo-rotation-button>\n      </div>\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-home-extent-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-home-extent-button>\n        <igo-geolocate-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-geolocate-button>\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { WorkspaceStore } from '@igo2/common/workspace';\nimport {\n  IMPORT_EXPORT_DIRECTIVES,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  TileLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    IMPORT_EXPORT_DIRECTIVES\n  ]\n})\nexport class AppImportExportComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store: WorkspaceStore = new WorkspaceStore([]);\n\n  constructor(private layerService: LayerService) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Import / Export\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/import-export\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-import-export\n            class=\"w-100\"\n            [store]=\"store\"\n            [map]=\"map\"\n          ></igo-import-export>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer\n  title=\"Layer\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/layer\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-layer-list\n              [map]=\"map\"\n              [layers]=\"map.layers\"\n              [expandLegendOfVisibleLayers]=\"false\"\n              [queryBadge]=\"true\"\n              [excludeBaseLayers]=\"true\"\n            >\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n                <igo-download-button [layer]=\"layer\"></igo-download-button>\n                <igo-ogc-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-ogc-filter-button>\n                <igo-time-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-time-filter-button>\n                <igo-track-feature-button\n                  [layer]=\"layer\"\n                  [trackFeature]=\"true\"\n                ></igo-track-feature-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  DownloadButtonComponent,\n  FILTER_DIRECTIVES,\n  FeatureDataSource,\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LAYER_DIRECTIVES,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  METADATA_DIRECTIVES,\n  MapViewOptions,\n  MetadataLayerOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES,\n    METADATA_DIRECTIVES,\n    DownloadButtonComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppLayerComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: false,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe((dataSource: FeatureDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Parcs routiers',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Lieux habités',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Direction du vent',\n        visible: false,\n        legendOptions: {\n          stylesAvailable: [\n            { name: 'WDIR6-LINEAR', title: 'WDIR6-LINEAR' },\n            { name: 'WDIR6', title: 'WDIR6' },\n            { name: 'WDIR3-LINEAR', title: 'WDIR3-LINEAR' },\n            { name: 'WDIR3', title: 'WDIR3' }\n          ]\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geo.weather.gc.ca/geomet?lang=fr',\n          params: {\n            LAYERS: 'HRDPS.CONTINENTAL_WD',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'District écologique',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routiers',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WMSDataSource) => {\n        const layerOptions: LayerOptionsWithMetadata = {\n          title: 'Embâcles',\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LAYER_DIRECTIVES,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  MetadataLayerOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES\n  ]\n})\nexport class AppLegendComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with display: false',\n        legendOptions: {\n          display: false\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with html param',\n        legendOptions: {\n          html: '<h2 style=\"background-color: blue;\">HTML legend</h2>'\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_sreg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with url param',\n        legendOptions: {\n          url: `data:image/jpeg;base64,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`\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_reg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Commissions scolaires anglophones',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          params: {\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Lieux habités',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routiers',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WMSDataSource) => {\n        const layerOptions: LayerOptionsWithMetadata = {\n          title: 'Embâcles',\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Simple Map with a legend list\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/legend\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Legends\">\n      <igo-layer-legend-list\n        [layers]=\"map.layers\"\n        [excludeBaseLayers]=\"true\"\n        [allowShowAllLegends]=\"true\"\n        [updateLegendOnResolutionChange]=\"false\"\n        [showAllLegendsValue]=\"false\"\n      >\n      </igo-layer-legend-list>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport {\n  DataSourceService,\n  FeatureStore,\n  FeatureWithMeasure,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapViewOptions,\n  MeasurerComponent,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  ZoomButtonComponent\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    MeasurerComponent\n  ]\n})\nexport class AppMeasureComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store: FeatureStore = new FeatureStore<FeatureWithMeasure>([], {\n    map: this.map\n  });\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Measure\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/measure\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-measurer [store]=\"$any(store)\" [map]=\"map\"></igo-measurer>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  AnyBaseOgcFilterOptions,\n  DataSourceService,\n  FILTER_DIRECTIVES,\n  IgoMap,\n  ImageLayerOptions,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OgcFilterAttributeOptions,\n  OgcFilterDuringOptions,\n  OgcFilterEqualToOptions,\n  OgcFilterOperatorType,\n  OgcFilterableDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { Circle, Fill, Stroke, Style } from 'ol/style';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppOgcFilterComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    interface WFSOptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalitée' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immédiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            } satisfies OgcFilterEqualToOptions,\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (PropertyIsEqualTo OR Intersects polygon)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilter: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-21T00:00:00-05:00',\n          end: '2016-01-26T00:00:00-05:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTime: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T04:00:00-05:00',\n          end: '2016-01-12T16:00:00-05:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T00:00:00-05:00',\n          end: '2016-03-31T00:00:00-05:00',\n          displayFormat: 'MMMM'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2014-01-01T00:00:00-05:00',\n          end: '2019-12-31T00:00:00-05:00',\n          displayFormat: 'YYYY'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n          end: 'today' // \"now\" can also be used. Instead of midnight, the current time will be used\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2019-01-01 00:00:00',\n          restrictToStep: true\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      optionsFromCapabilities: false,\n      params: {\n        LAYERS: 'vg_observation_v_autre_wmst',\n        VERSION: '1.3.0'\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01 00:00:00',\n          end: '2020-01-01 00:00:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions,\n        allowedOperatorsType: OgcFilterOperatorType.Time\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe((dataSource: WMSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondations (During)',\n            source: dataSource\n          } satisfies ImageLayerOptions)\n        );\n      });\n\n    interface WMSOptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSOptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups: [\n            { title: 'Nom du group1 - push', name: '1 - push', ids: ['id1'] }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Régions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups: [\n            {\n              title: 'Nom du group1 - checkbox',\n              name: '1 - checkbox',\n              ids: ['id1']\n            }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n      },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } satisfies WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe((dataSource: WMSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title:\n              'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          } satisfies ImageLayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Ogc filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/ogc-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel title=\"Layers\">\n            <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n            </igo-ogc-filterable-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AfterViewInit, Component, OnInit } from '@angular/core';\n\nimport {\n  DataSourceService,\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MAP_DIRECTIVES]\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map: IgoMap = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  ngAfterViewInit(): void {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [\n          [-72, 47.8],\n          [-73.5, 47.4],\n          [-72.4, 48.6]\n        ]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-71, 46.8],\n            [-73, 47],\n            [-71.2, 46.6]\n          ]\n        ]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3] satisfies Feature[],\n      FeatureMotion.None\n    );\n  }\n}\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/overlay\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport {\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  PrintComponent,\n  TileLayer,\n  TileLayerOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PrintComponent\n  ]\n})\nexport class AppPrintComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(private layerService: LayerService) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: 'https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png',\n          crossOrigin: 'anonymous'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embâcles',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Radar météo',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geo.meteo.gc.ca/geomet?lang=fr', // https://geo.meteo.gc.ca/geomet?lang=fr\n          params: {\n            LAYERS: 'RADAR_1KM_RRAI',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Aéroports',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?',\n          params: {\n            layers: 'aeroport',\n            version: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Print\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/print\">\n    <mat-grid-list cols=\"2\" rowHeight=\"800px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile> <igo-print [map]=\"map\"></igo-print></mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Query\" subtitle=\"Geo\" [dependencies]=\"[]\">\n  <app-example-viewer codeFolder=\"geo/query\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      igoQuery\n      [queryFeatures]=\"true\"\n      (query)=\"handleQueryResults($event)\"\n    >\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Details\">\n      <ng-container *ngIf=\"features$ | async as features\">\n        <div *ngFor=\"let feature of features\">\n          <h1>\n            Query Title :\n            <span style=\"background-color: #e0e0e0\">{{\n              getTitle($any(feature))\n            }}</span>\n          </h1>\n          <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n        </div>\n      </ng-container>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSource,\n  DataSourceService,\n  FEATURE_DETAILS_DIRECTIVES,\n  Feature,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  FeatureMotion,\n  IgoMap,\n  IgoQueryModule,\n  ImageLayer,\n  ImageLayerOptions,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OverlayDirective,\n  QueryFormat,\n  QueryHtmlTarget,\n  QueryableDataSourceOptions,\n  SearchResult,\n  VectorLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from '@igo2/geo';\n\nimport olFeature from 'ol/Feature';\nimport olLineString from 'ol/geom/LineString';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    OverlayDirective,\n    IgoQueryModule,\n    PanelComponent,\n    NgIf,\n    NgFor,\n    FEATURE_DETAILS_DIRECTIVES,\n    AsyncPipe\n  ]\n})\nexport class AppQueryComponent {\n  public features$: BehaviorSubject<Feature[]> = new BehaviorSubject<Feature[]>(\n    []\n  );\n\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource: DataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'aeroport',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource: DataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'WMS with different query url',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          queryable: true,\n          queryFormat: QueryFormat.HTMLGML2,\n          queryHtmlTarget: QueryHtmlTarget.IFRAME,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493'\n            }\n          ],\n          queryLayerFeatures: false,\n          params: {\n            layers: 'SDA_MUNIC_S_20K',\n            version: '1.3.0'\n          }\n        }\n      } as ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as FeatureDataSourceOptions)\n      .subscribe((dataSource: FeatureDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector layer',\n            source: dataSource\n          } satisfies VectorLayerOptions)\n        );\n        this.addFeatures(dataSource);\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with different query url',\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryFormat: QueryFormat.HTMLGML2,\n          queryHtmlTarget: QueryHtmlTarget.IFRAME,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493'\n            }\n          ],\n          queryLayerFeatures: false\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as VectorTileLayerOptions)\n      .subscribe((layer: VectorTileLayer) => this.map.addLayer(layer));\n  }\n\n  addFeatures(dataSource: FeatureDataSource): void {\n    const feature1: olFeature<olLineString> = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ])\n    });\n\n    const feature2: olFeature<olPoint> = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      )\n    });\n\n    const feature3: olFeature<olPolygon> = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ])\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n  }\n\n  handleQueryResults(results: any): void {\n    const features: Feature[] = results.features;\n    if (features.length && features[0]) {\n      this.features$.next(features);\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\n    }\n  }\n\n  getTitle(result: SearchResult): string {\n    return getEntityTitle(result);\n  }\n}\n","<p></p>\n<igo-interactive-tour\n  mat-raised-button\n  tourToStart=\"global\"\n  menuIsOpen=\"true\"\n  styleButton=\"raised\"\n  [discoverTitleInLocale$]=\"discoverTitleInLocale$\"\n>\n</igo-interactive-tour>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length === 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  (click)=\"openGuide()\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon>description</mat-icon>\n</button>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length > 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  [matMenuTriggerFor]=\"menu\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon>description</mat-icon>\n</button>\n\n<mat-menu #menu=\"matMenu\">\n  <button\n    *ngFor=\"let guide of trainingGuideURLs\"\n    mat-menu-item\n    (click)=\"openGuide(guide)\"\n  >\n    {{ formatFileName(guide) }}\n  </button>\n</mat-menu>\n\n<igo-custom-html\n  *ngIf=\"headerHtml !== ''\"\n  class=\"mat-typography\"\n  [html]=\"headerHtml | translate\"\n>\n</igo-custom-html>\n\n<igo-custom-html\n  class=\"mat-typography\"\n  [html]=\"html | translate: { version: effectiveVersion }\"\n>\n</igo-custom-html>\n","import { NgFor, NgIf } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { InteractiveTourComponent } from '@igo2/common/interactive-tour';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ConfigService, version } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { of } from 'rxjs';\nimport type { Observable } from 'rxjs';\n\nimport { AllEnvironmentOptions } from '../../environment';\n\n@ToolComponent({\n  name: 'about',\n  title: 'igo.integration.tools.about',\n  icon: 'help'\n})\n@Component({\n  selector: 'igo-about-tool',\n  templateUrl: './about-tool.component.html',\n  styleUrls: ['./about-tool.component.scss'],\n  standalone: true,\n  imports: [\n    InteractiveTourComponent,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatMenuModule,\n    NgFor,\n    CustomHtmlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class AboutToolComponent implements OnInit {\n  private configOptions: AllEnvironmentOptions;\n  @Input()\n  get headerHtml() {\n    return this._headerHtml;\n  }\n  set headerHtml(value: string) {\n    this._headerHtml = Array.isArray(value) ? value.join('\\n') : value;\n  }\n\n  @Input()\n  get html() {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = Array.isArray(value) ? value.join('\\n') : value;\n  }\n  private _discoverTitleInLocale: string = 'IGO';\n  public discoverTitleInLocale$: Observable<string> = of(\n    this._discoverTitleInLocale\n  );\n\n  @Input()\n  get discoverTitleInLocale() {\n    return this._discoverTitleInLocale;\n  }\n  set discoverTitleInLocale(value: string) {\n    this._discoverTitleInLocale = value;\n    this.discoverTitleInLocale$ = of(value);\n  }\n\n  @Input() trainingGuideURLs;\n\n  public effectiveVersion: string;\n  private _html: string = 'igo.integration.aboutTool.html';\n  private _headerHtml: string;\n\n  private baseUrlProfil;\n  private baseUrlGuide;\n\n  public loading = false;\n\n  constructor(\n    public configService: ConfigService,\n    public auth: AuthService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService\n  ) {\n    this.headerHtml = this.languageService.translate.instant(\n      'igo.integration.aboutTool.headerHtml'\n    );\n    this.configOptions = this.configService.getConfigs();\n    const configVersion = this.configOptions.version;\n    this.effectiveVersion =\n      configVersion?.app || configVersion?.lib || version.lib;\n    this.baseUrlProfil = this.configOptions.storage?.url;\n    this.baseUrlGuide =\n      this.configOptions.depot?.url +\n      // todo validate this property\n      (this.configOptions.depot as any)?.guideUrl;\n  }\n\n  ngOnInit() {\n    if (this.auth.authenticated && this.configOptions.context?.url) {\n      this.http.get(this.baseUrlProfil).subscribe((profil) => {\n        const recast = profil as any;\n        this.trainingGuideURLs = recast.guides;\n        this.cdRef.detectChanges();\n      });\n    } else if (\n      this.auth.authenticated &&\n      !this.configOptions.context?.url &&\n      this.configOptions.depot?.trainingGuides\n    ) {\n      this.trainingGuideURLs = this.configOptions.depot?.trainingGuides;\n    }\n  }\n\n  openGuide(guide?) {\n    this.loading = true;\n    const url = guide\n      ? this.baseUrlGuide + guide + '?'\n      : this.baseUrlGuide + this.trainingGuideURLs[0] + '?';\n    this.http\n      .get(url, {\n        responseType: 'blob'\n      })\n      .subscribe(() => {\n        this.loading = false;\n        window.open(url, '_blank');\n        this.cdRef.detectChanges();\n      });\n  }\n\n  formatFileName(name: string) {\n    name = name.split('_').join(' ');\n    const index = name.indexOf('.');\n    name = name.slice(0, index);\n    return name;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\n\n// import { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of the map module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapState {\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\n  get showAllLegendsValue(): boolean {\n    return this._legendToolShowAll;\n  }\n\n  set showAllLegendsValue(value) {\n    this._legendToolShowAll = value;\n  }\n  private _legendToolShowAll: boolean;\n\n  /**\n   * Active map\n   */\n  get map(): IgoMap {\n    return this._map;\n  }\n  private _map: IgoMap;\n\n  constructor(\n    private mapService: MapService,\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\n    private storageService: StorageService,\n    private configService: ConfigService\n  ) {\n    this._map = new IgoMap(\n      {\n        controls: {\n          scaleLine: true,\n          attribution: {\n            collapsed: true\n          }\n        }\n      },\n      this.storageService,\n      this.configService\n    );\n\n    this.mapService.setMap(this.map);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityStore } from '@igo2/common/entity';\nimport { Catalog, CatalogItem } from '@igo2/geo';\n\n/**\n * Service that holds the state of the catalog module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogState {\n  /**\n   * Store that contains all the catalogs\n   */\n  get catalogStore(): EntityStore<Catalog> {\n    return this._catalogStore;\n  }\n  private _catalogStore: EntityStore<Catalog>;\n\n  /**\n   * Catalog -> Catalog items store mapping\n   */\n  private catalogItemsStores = new Map<string, EntityStore<CatalogItem>>();\n\n  constructor(authService: AuthService) {\n    this._catalogStore = new EntityStore([]);\n\n    authService.authenticate$.subscribe(() => {\n      this.clearCatalogItemsStores();\n    });\n  }\n\n  /**\n   * Get a catalog's items store\n   * @param catalog Catalog\n   * @returns Store that contains the catalog items\n   */\n  getCatalogItemsStore(catalog: Catalog): EntityStore<CatalogItem> {\n    return this.catalogItemsStores.get(catalog.id as string);\n  }\n\n  /**\n   * Bind a catalog items store to a catalog\n   * @param catalog Catalog\n   * @param store Catalog items store\n   */\n  setCatalogItemsStore(catalog: Catalog, store: EntityStore<CatalogItem>) {\n    this.catalogItemsStores.set(catalog.id as string, store);\n  }\n\n  /**\n   * Clear all catalog items stores\n   */\n  clearCatalogItemsStores() {\n    this.catalogItemsStores.clear();\n  }\n}\n","<igo-catalog-browser\n  *ngIf=\"store$ | async as store\"\n  [catalog]=\"catalog\"\n  [store]=\"store\"\n  [map]=\"map\"\n  [toggleCollapsedGroup]=\"toggleCollapsedGroup\"\n>\n</igo-catalog-browser>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityRecord, EntityStore } from '@igo2/common/entity';\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  Catalog,\n  CatalogBrowserComponent,\n  CatalogItem,\n  CatalogItemState,\n  CatalogService,\n  IgoMap\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MapState } from '../../map/map.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse a catalog's groups and layers and display them to a map.\n */\n@ToolComponent({\n  name: 'catalogBrowser',\n  title: 'igo.integration.tools.catalog',\n  parent: 'catalog'\n})\n@Component({\n  selector: 'igo-catalog-browser-tool',\n  templateUrl: './catalog-browser-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, CatalogBrowserComponent, AsyncPipe]\n})\nexport class CatalogBrowserToolComponent implements OnInit, OnDestroy {\n  catalog: Catalog;\n\n  /**\n   * Store that contains the catalog items\n   * @internal\n   */\n  store$ = new BehaviorSubject<EntityStore<CatalogItem, CatalogItemState>>(\n    undefined\n  );\n\n  /**\n   * Subscription to the selected catalog\n   */\n  private catalog$$: Subscription;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  /**\n   * Map to add layers to\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private mapState: MapState,\n    private authService: AuthService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const catalogStore = this.catalogState.catalogStore;\n\n    const catalog$ = catalogStore.stateView.firstBy$(\n      (record: EntityRecord<Catalog>) => record.state.selected === true\n    );\n    const authenticate$ = this.authService.authenticate$;\n    this.catalog$$ = combineLatest([catalog$, authenticate$]).subscribe(\n      ([record, authenticate]) => {\n        const catalog = record.entity;\n        this.catalog = catalog;\n        this.loadCatalogItems(this.catalog);\n      }\n    );\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.catalog$$.unsubscribe();\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    let store = this.catalogState.getCatalogItemsStore(catalog);\n    if (store !== undefined) {\n      this.store$.next(store);\n      return;\n    }\n\n    store = new EntityStore<CatalogItem>([]);\n    this.catalogState.setCatalogItemsStore(catalog, store);\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .pipe(take(1))\n      .subscribe((items: CatalogItem[]) => {\n        store.load(items);\n        this.store$.next(store);\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ExportOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n  readonly importExportType$: BehaviorSubject<ImportExportType> =\n    new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> =\n    new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n    this.exportOptions$.next(exportOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ToolService, Toolbox } from '@igo2/common/tool';\nimport { ExportOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n  ) {}\n\n  toolToActivateFromOptions(toolToActivate: {\n    tool: string;\n    options: { [key: string]: any };\n  }) {\n    if (!toolToActivate) {\n      return;\n    }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions =\n        this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent =\n          toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { Catalog, CatalogLibaryComponent, CatalogService } from '@igo2/geo';\n\nimport { take } from 'rxjs/operators';\n\nimport { ToolState } from '../../tool/tool.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse the list of available catalogs.\n */\n@ToolComponent({\n  name: 'catalog',\n  title: 'igo.integration.tools.catalog',\n  icon: 'library_add'\n})\n@Component({\n  selector: 'igo-catalog-library-tool',\n  templateUrl: './catalog-library-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [CatalogLibaryComponent]\n})\nexport class CatalogLibraryToolComponent implements OnInit {\n  /**\n   * Store that contains the catalogs\n   * @internal\n   */\n  get store(): EntityStore<Catalog> {\n    return this.catalogState.catalogStore;\n  }\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * List of predefined catalogs\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  set selectedCatalogId(id) {\n    this.storageService.set('selectedCatalogId', id, StorageScope.SESSION);\n  }\n\n  get currentTool() {\n    return this.toolState.toolbox.getCurrentPreviousToolName()[1];\n  }\n\n  get lastTool() {\n    return this.toolState.toolbox.getCurrentPreviousToolName()[0];\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private toolState: ToolState,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    if (this.lastTool === 'catalogBrowser' && this.currentTool === 'catalog') {\n      this.selectedCatalogId = null;\n    }\n\n    if (this.store.count === 0) {\n      this.loadCatalogs();\n    }\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\n    if (event.selected === false) {\n      return;\n    }\n    this.toolState.toolbox.activateTool('catalogBrowser');\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService\n      .loadCatalogs()\n      .pipe(take(1))\n      .subscribe((catalogs: Catalog[]) => {\n        this.store.clear();\n        this.store.load(\n          catalogs.concat(\n            (this.storageService.get('addedCatalogs') || []) as Catalog[]\n          )\n        );\n      });\n  }\n}\n","<igo-catalog-library\n  [predefinedCatalogs]=\"predefinedCatalogs\"\n  [addCatalogAllowed]=\"addCatalogAllowed\"\n  [store]=\"store\"\n  (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n>\n</igo-catalog-library>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextEditBindingDirective,\n  ContextEditComponent\n} from '@igo2/context';\n\nimport { ToolState } from '../../tool/tool.state';\n\n@ToolComponent({\n  name: 'contextEditor',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-editor-tool',\n  templateUrl: './context-editor-tool.component.html',\n  standalone: true,\n  imports: [ContextEditComponent, ContextEditBindingDirective]\n})\nexport class ContextEditorToolComponent {\n  constructor(private toolState: ToolState) {}\n\n  submitSuccessed() {\n    this.toolState.toolbox.activatePreviousTool();\n  }\n}\n","<igo-context-edit\n  igoContextEditBinding\n  (submitSuccessed)=\"submitSuccessed()\"\n></igo-context-edit>\n","import { Component, Input } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextListBindingDirective,\n  ContextListComponent\n} from '@igo2/context';\nimport { IgoMap } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\n\n@ToolComponent({\n  name: 'contextManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star'\n})\n@Component({\n  selector: 'igo-context-manager-tool',\n  templateUrl: './context-manager-tool.component.html',\n  standalone: true,\n  imports: [ContextListComponent, ContextListBindingDirective]\n})\nexport class ContextManagerToolComponent {\n  @Input() toolToOpenOnContextChange: string = 'mapTools';\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private toolState: ToolState,\n    private mapState: MapState\n  ) {}\n\n  editContext() {\n    this.toolState.toolbox.activateTool('contextEditor');\n  }\n\n  managePermissions() {\n    this.toolState.toolbox.activateTool('contextPermissionManager');\n  }\n}\n","<igo-context-list\n  igoContextListBinding\n  [map]=\"map\"\n  (edit)=\"editContext()\"\n  (managePermissions)=\"managePermissions()\"\n>\n</igo-context-list>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextPermissionsBindingDirective,\n  ContextPermissionsComponent\n} from '@igo2/context';\n\n@ToolComponent({\n  name: 'contextPermissionManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-permission-manager-tool',\n  templateUrl: './context-permission-manager-tool.component.html',\n  standalone: true,\n  imports: [ContextPermissionsComponent, ContextPermissionsBindingDirective]\n})\nexport class ContextPermissionManagerToolComponent {}\n","<igo-context-permissions igoContextPermissionsBinding></igo-context-permissions>\n","import { Injectable } from '@angular/core';\n\nimport { LayerListControlsOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of layer list tool values\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolState {\n  readonly keyword$: BehaviorSubject<string> = new BehaviorSubject('');\n  readonly sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly selectedTab$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  setKeyword(keyword: string) {\n    this.keyword$.next(keyword);\n  }\n\n  setSortAlpha(sort: boolean) {\n    this.sortAlpha$.next(sort);\n  }\n\n  setOnlyVisible(onlyVisible: boolean) {\n    this.onlyVisible$.next(onlyVisible);\n  }\n\n  setSelectedTab(tab: number) {\n    this.selectedTab$.next(tab);\n  }\n\n  getLayerListControls(): LayerListControlsOptions {\n    return {\n      keyword: this.keyword$.value,\n      onlyVisible: this.onlyVisible$.value,\n      sortAlpha: this.sortAlpha$.value\n    };\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ShareMapComponent } from '@igo2/context';\nimport { IgoMap, LayerListControlsOptions } from '@igo2/geo';\n\nimport { LayerListToolState } from '../../map/layer-list-tool.state';\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'shareMap',\n  title: 'igo.integration.tools.shareMap',\n  icon: 'share'\n})\n@Component({\n  selector: 'igo-context-share-tool',\n  templateUrl: './context-share-tool.component.html',\n  standalone: true,\n  imports: [ShareMapComponent]\n})\nexport class ContextShareToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layerListControls(): LayerListControlsOptions {\n    return this.layerListToolState.getLayerListControls();\n  }\n\n  constructor(\n    private mapState: MapState,\n    private layerListToolState: LayerListToolState\n  ) {}\n}\n","<igo-share-map [map]=\"map\"></igo-share-map>\n","import { Injectable } from '@angular/core';\n\nimport { Tool, ToolService } from '@igo2/common/tool';\nimport { ContextService, DetailedContext } from '@igo2/context';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { ToolState } from '../tool/tool.state';\n\n/**\n * Service that holds the state of the context module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextState {\n  /**\n   * Observable of the active context\n   */\n  context$: BehaviorSubject<DetailedContext> = new BehaviorSubject(undefined);\n\n  constructor(\n    private contextService: ContextService,\n    private toolService: ToolService,\n    private toolState: ToolState,\n    private languageService: LanguageService\n  ) {\n    this.contextService.context$.subscribe((context: DetailedContext) => {\n      this.onContextChange(context);\n    });\n    this.contextService.toolsChanged$.subscribe((context: DetailedContext) => {\n      this.updateTools(context);\n    });\n  }\n\n  /**\n   * Set the active context\n   * @param context Detailed context\n   */\n  private setContext(context: DetailedContext) {\n    this.updateTools(context);\n    this.context$.next(context);\n  }\n\n  /**\n   * Update the tool state with the context's tools\n   * @param context Detailed context\n   */\n  private updateTools(context: DetailedContext) {\n    const toolbox = this.toolState.toolbox;\n\n    const tools = [];\n    const contextTools = context.tools || [];\n    contextTools.forEach((contextTool: Tool) => {\n      const baseTool = this.toolService.getTool(contextTool.name);\n      if (baseTool === undefined) {\n        return;\n      }\n\n      const options = Object.assign(\n        {},\n        baseTool.options || {},\n        contextTool.options || {}\n      );\n      const tool = Object.assign({}, baseTool, contextTool, { options });\n      tools.push(tool);\n    });\n\n    tools.forEach((tool) => {\n      if (tool.parent) {\n        const parentIndex = tools.findIndex((el) => el.name === tool.parent);\n        if (parentIndex !== -1) {\n          tools[parentIndex].children = [];\n          tools[parentIndex].children.push(tool.name);\n        }\n      }\n    });\n\n    toolbox.setTools(tools);\n    toolbox.setToolbar(context.toolbar || []);\n\n    // TODO: This is a patch so the context service can work without\n    // injecting the ToolState or without being completely refactored\n    this.contextService.setTools([].concat(tools));\n    this.contextService.setToolbar(context.toolbar || []);\n  }\n\n  /**\n   * Set a new context and update the tool state\n   * @param context Detailed context\n   */\n  private onContextChange(context: DetailedContext) {\n    if (context === undefined) {\n      return;\n    }\n    this.setContext(context);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  AnyLayerOptions,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from '@igo2/geo';\n\nimport { Subject } from 'rxjs';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionState {\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  /**\n   * Store that holds the stop\n   */\n  public stopsStore: StopsStore = new StopsStore([]);\n\n  /**\n   * Store that holds the driving stops as feature\n   */\n  public stopsFeatureStore: StopsFeatureStore;\n\n  /**\n   * Store that holds the driving route as feature\n   */\n  public routesFeatureStore: RoutesFeatureStore;\n\n  public stepFeatureStore: StepFeatureStore;\n\n  public debounceTime: number = 200;\n\n  constructor(private mapState: MapState) {\n    this.stopsFeatureStore = new StopsFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.routesFeatureStore = new RoutesFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.stepFeatureStore = new StepFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.stopsFeatureStore.empty$.subscribe((empty) => {\n        if (this.stopsFeatureStore.layer?.options) {\n          (\n            this.stopsFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n      this.routesFeatureStore.empty$.subscribe((empty) => {\n        if (this.routesFeatureStore.layer?.options) {\n          (\n            this.routesFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n    });\n\n    this.mapState.map.layers$.subscribe(() => {\n      if (!this.mapState.map.getLayerById('igo-direction-stops-layer')) {\n        this.stopsStore.deleteMany(this.stopsStore.all());\n        this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all()); // not necessary\n      }\n      if (!this.mapState.map.getLayerById('igo-direction-route-layer')) {\n        this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      }\n    });\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport {\n  IgoDirectionsModule,\n  IgoMap,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { ContextState } from '../../context/context.state';\nimport { MapState } from '../../map/map.state';\nimport { DirectionState } from '../directions.state';\n\n@ToolComponent({\n  name: 'directions',\n  title: 'igo.integration.tools.directions',\n  icon: 'directions'\n})\n@Component({\n  selector: 'igo-directions-tool',\n  templateUrl: './directions-tool.component.html',\n  standalone: true,\n  imports: [IgoDirectionsModule]\n})\nexport class DirectionsToolComponent implements OnInit {\n  public currentContextUri: string;\n  /**\n   * stops\n   * @internal\n   */\n  get stopsStore(): StopsStore {\n    return this.directionState.stopsStore;\n  }\n\n  get debounceTime(): number {\n    return this.directionState.debounceTime;\n  }\n\n  /**\n   * stops\n   * @internal\n   */\n  get stopsFeatureStore(): StopsFeatureStore {\n    return this.directionState.stopsFeatureStore;\n  }\n\n  /**\n   * routes\n   * @internal\n   */\n  get routesFeatureStore(): RoutesFeatureStore {\n    return this.directionState.routesFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get stepFeatureStore(): StepFeatureStore {\n    return this.directionState.stepFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get zoomToActiveRoute$(): Subject<void> {\n    return this.directionState.zoomToActiveRoute$;\n  }\n\n  get authenticated$(): BehaviorSubject<boolean> {\n    return this.authService.authenticate$;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private directionState: DirectionState,\n    private mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    public contextState: ContextState,\n    private authService: AuthService\n  ) {}\n\n  ngOnInit(): void {\n    const warningShown = this.storageService.get(\n      'direction.warning.shown'\n    ) as boolean;\n    if (!warningShown) {\n      this.messageService.info(\n        'igo.integration.directions.warning.message',\n        'igo.integration.directions.warning.title',\n        { timeOut: 20000 }\n      );\n      this.storageService.set(\n        'direction.warning.shown',\n        true,\n        StorageScope.SESSION\n      );\n    }\n    this.contextState.context$.subscribe((c) => {\n      if (!this.authService.authenticated) {\n        this.currentContextUri = c.uri;\n      }\n    });\n  }\n}\n","<igo-directions\n  [contextUri]=\"currentContextUri\"\n  [debounce]=\"debounceTime\"\n  [stopsStore]=\"stopsStore\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n  [authenticated$]=\"authenticated$\"\n>\n</igo-directions>\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DirectionsToolComponent } from './directions-tool/directions-tool.component';\n\n/**\n * @deprecated import the DirectionsToolComponent directly\n */\n@NgModule({\n  imports: [DirectionsToolComponent],\n  exports: [DirectionsToolComponent]\n})\nexport class IgoAppDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoAppDirectionsModule> {\n    return {\n      ngModule: IgoAppDirectionsModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  DrawControl,\n  FeatureStore,\n  FeatureWithDraw,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawState {\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n  public layersID: string[] = [];\n  public drawControls: [string, DrawControl][] = [];\n  public activeDrawingLayer: VectorLayer;\n\n  constructor(private mapState: MapState) {\n    this.mapState.map.layers$.subscribe(() => {\n      this.layersID.forEach((layerId) => {\n        if (!this.mapState.map.getLayerById(layerId)) {\n          let deletedStore = this.stores.find(\n            (store) => store.layer.id === layerId\n          );\n          deletedStore.deleteMany(deletedStore.all());\n          this.stores.splice(this.stores.indexOf(deletedStore, 0), 1);\n          this.layersID.splice(this.layersID.indexOf(layerId, 0), 1);\n          let drawControlIndex = this.drawControls.findIndex(\n            (dc) => dc[0] === layerId\n          );\n          this.drawControls.splice(drawControlIndex, 1);\n        }\n      });\n    });\n    for (let store of this.stores) {\n      store = new FeatureStore<FeatureWithDraw>([], { map: this.mapState.map });\n    }\n  }\n}\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  DrawComponent,\n  DrawControl,\n  FeatureStore,\n  FeatureWithDraw,\n  IgoMap,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { DrawState } from '../draw.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'draw',\n  title: 'igo.integration.tools.draw',\n  icon: 'stylus_note'\n})\n@Component({\n  selector: 'igo-drawing-tool',\n  templateUrl: './drawing-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [DrawComponent]\n})\nexport class DrawingToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this.drawState.stores;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layersID(): string[] {\n    return this.drawState.layersID;\n  }\n\n  get drawControls(): [string, DrawControl][] {\n    return this.drawState.drawControls;\n  }\n  set drawControls(dc: [string, DrawControl][]) {\n    this.drawState.drawControls = dc;\n  }\n\n  get activeDrawingLayer(): VectorLayer {\n    return this.drawState.activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this.drawState.activeDrawingLayer = value;\n  }\n\n  public addLayersID(layerID: string) {\n    this.layersID.push(layerID);\n  }\n\n  public addDrawControls(dc: [string, DrawControl][]) {\n    this.drawControls = dc;\n  }\n\n  constructor(\n    private drawState: DrawState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-draw\n  [stores]=\"stores\"\n  [map]=\"map\"\n  (layersIDEvent)=\"addLayersID($event)\"\n  [activeDrawingLayer]=\"activeDrawingLayer\"\n  [drawControls]=\"drawControls\"\n  (drawControlsEvent)=\"addDrawControls($event)\"\n  (activeLayerChange)=\"activeDrawingLayer = $event\"\n>\n</igo-draw>\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, Layer, OgcFilterableItemComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { toolSlideInOut } from './active-ogc-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeOgcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-ogc-filter-tool',\n  templateUrl: './active-ogc-filter-tool.component.html',\n  animations: [toolSlideInOut()],\n  standalone: true,\n  imports: [OgcFilterableItemComponent]\n})\nexport class ActiveOgcFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-ogc-filterable-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-ogc-filterable-item>\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, Layer, TimeFilterItemComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { toolSlideInOut } from './active-time-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeTimeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-time-filter-tool',\n  templateUrl: './active-time-filter-tool.component.html',\n  animations: [toolSlideInOut()],\n  standalone: true,\n  imports: [TimeFilterItemComponent]\n})\nexport class ActiveTimeFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-time-filter-item\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-time-filter-item>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  OgcFilterableListBindingDirective,\n  OgcFilterableListComponent\n} from '@igo2/geo';\n\n@ToolComponent({\n  name: 'ogcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter'\n})\n@Component({\n  selector: 'igo-ogc-filter-tool',\n  templateUrl: './ogc-filter-tool.component.html',\n  standalone: true,\n  imports: [OgcFilterableListComponent, OgcFilterableListBindingDirective]\n})\nexport class OgcFilterToolComponent {\n  constructor() {}\n}\n","<igo-ogc-filterable-list igoOgcFilterableListBinding></igo-ogc-filterable-list>\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Action } from '@igo2/common/action';\nimport {\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  EditionWorkspace,\n  ExportOptions,\n  FeatureMotion,\n  FeatureStoreSelectionStrategy,\n  FeatureWorkspace,\n  OgcFilterableDataSource,\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected\n} from '@igo2/geo';\n\nimport * as jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport moment from 'moment';\nimport { BehaviorSubject, map } from 'rxjs';\n\nimport { ToolState } from '../../tool';\n\nexport function handleZoomAuto(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  storageService\n) {\n  const zoomStrategy = workspace.entityStore.getStrategyOfType(\n    FeatureStoreSelectionStrategy\n  ) as FeatureStoreSelectionStrategy;\n  zoomStrategy.setMotion(\n    (storageService.get('zoomAuto') as boolean)\n      ? FeatureMotion.Default\n      : FeatureMotion.None\n  );\n}\n\nexport function getWorkspaceActions(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n  selectOnlyCheckCondition$: BehaviorSubject<boolean>,\n  ogcFilterWidget: Widget,\n  zoomAuto$: BehaviorSubject<boolean>,\n  maximize$: BehaviorSubject<boolean>,\n  storageService: StorageService,\n  languageService: LanguageService,\n  mediaService: MediaService,\n  toolState: ToolState\n): Action[] {\n  const actions = [\n    {\n      id: 'zoomAuto',\n      checkbox: true,\n      title: 'igo.integration.workspace.zoomAuto.title',\n      tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n      checkCondition: zoomAuto$,\n      handler: () => {\n        handleZoomAuto(workspace, storageService);\n        storageService.set(\n          'zoomAuto',\n          !storageService.get('zoomAuto') as boolean\n        );\n      }\n    },\n    {\n      id: 'filterInMapExtent',\n      checkbox: true,\n      title: 'igo.integration.workspace.inMapExtent.title',\n      tooltip: mapExtentStrategyActiveToolTip(workspace),\n      checkCondition: rowsInMapExtentCheckCondition$,\n      handler: () =>\n        rowsInMapExtentCheckCondition$.next(\n          !rowsInMapExtentCheckCondition$.value\n        )\n    },\n    {\n      id: 'selectedOnly',\n      checkbox: true,\n      title: 'igo.integration.workspace.selected.title',\n      tooltip: 'igo.integration.workspace.selected.tooltip',\n      checkCondition: selectOnlyCheckCondition$,\n      handler: () =>\n        selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n    },\n    {\n      id: 'clearselection',\n      icon: 'deselect',\n      title: 'igo.integration.workspace.clearSelection.title',\n      tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n          selected: false\n        });\n      },\n      args: [workspace],\n      availability: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) =>\n        noElementSelected(ws)\n    },\n    {\n      id: 'featureDownload',\n      icon: 'file_save',\n      title: 'igo.integration.workspace.download.title',\n      tooltip: 'igo.integration.workspace.download.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const filterStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterCustomFuncStrategy\n        );\n        const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterSelectionStrategy\n        );\n        const layersWithSelection = filterSelectionStrategy.active\n          ? [ws.layer.id]\n          : [];\n        toolState.toolToActivateFromOptions({\n          tool: 'importExport',\n          options: {\n            layers: [ws.layer.id],\n            featureInMapExtent: filterStrategy.active,\n            layersWithSelection\n          } as ExportOptions\n        });\n      },\n      args: [workspace]\n    },\n    {\n      id: 'ogcFilter',\n      icon: 'filter_alt',\n      title: 'igo.integration.workspace.ogcFilter.title',\n      tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n      handler: (\n        widget: Widget,\n        ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace\n      ) => {\n        ws.activateWidget(widget, {\n          map: ws.map,\n          layer: ws.layer\n        });\n      },\n      args: [ogcFilterWidget, workspace]\n    },\n    {\n      id: 'maximize',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.maximize'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.maximizeTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => !v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        if (!mediaService.isMobile()) {\n          maximize$.next(true);\n        }\n      }\n    },\n    {\n      id: 'standardExtent',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.standardExtent'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.standardExtentTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        maximize$.next(false);\n      }\n    },\n    {\n      id: 'print',\n      icon: 'print',\n      title: 'igo.integration.workspace.print.title',\n      tooltip: 'igo.integration.workspace.print.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const title = `${ws.layer.title} (${dateTransform(\n          new Date(),\n          'YYYY-MM-DD-HH_mm'\n        )})`;\n        const doc: any = new jsPDF.default('landscape');\n        const totalPagesExp = '{total_pages_count_string}';\n        doc.text(title, 14, 20);\n        doc.autoTable({\n          startY: 25,\n          tableWidth: 'wrap',\n          html: '#currentWorkspaceTable',\n          horizontalPageBreak: true,\n          styles: { cellPadding: 0.5, minCellWidth: 20, fontSize: 6 },\n          didDrawPage: (data) => {\n            let str = 'Page ' + doc.internal.getNumberOfPages();\n            if (typeof doc.putTotalPages === 'function') {\n              str = str + ' / ' + totalPagesExp;\n            }\n            doc.setFontSize(6);\n            const pageSize = doc.internal.pageSize;\n            const pageHeight = pageSize.height\n              ? pageSize.height\n              : pageSize.getHeight();\n            doc.text(str, data.settings.margin.left, pageHeight - 10);\n          }\n        });\n        if (typeof doc.putTotalPages === 'function') {\n          doc.putTotalPages(totalPagesExp);\n        }\n        doc.save(`${title}.pdf`);\n      },\n      args: [workspace]\n    }\n  ];\n  let returnActions = (workspace.layer.dataSource as OgcFilterableDataSource)\n    .options.ogcFilters?.enabled\n    ? actions\n    : actions.filter((action) => action.id !== 'ogcFilter');\n  returnActions =\n    workspace.layer.options.workspace.printable !== false\n      ? actions\n      : actions.filter((action) => action.id !== 'print');\n  return returnActions;\n}\n\nfunction dateTransform(date: Date, format: string): string {\n  return moment(date).format(format);\n}\n","import { Inject, Injectable, OnDestroy, Optional } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { EditionWorkspace, OgcFilterWidget } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Optional()\n    @Inject(OgcFilterWidget)\n    private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { FeatureWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      undefined,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Inject, Injectable, OnDestroy, Optional } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { OgcFilterWidget, WfsWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Optional()\n    @Inject(OgcFilterWidget)\n    private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityState,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\nimport { Workspace, WorkspaceStore } from '@igo2/common/workspace';\nimport { StorageService } from '@igo2/core/storage';\nimport { EditionWorkspace, FeatureWorkspace, WfsWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\n\nimport { EditionActionsService } from './shared/edition-actions.service';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean>;\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> =\n    new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore {\n    return this._store;\n  }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore.stateView.manyBy(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.workspaceMaximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.active === true\n      )\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView\n      .all$()\n      .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n        workspaces.map((wks: EntityRecord<Workspace>) => {\n          if (wks.entity.actionStore.empty) {\n            if (wks.entity instanceof WfsWorkspace) {\n              this.wfsActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof FeatureWorkspace) {\n              this.featureActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof EditionWorkspace) {\n              this.editionActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            }\n          }\n        });\n      });\n\n    this.actionMaximize$$.push(\n      this.featureActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.wfsActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.editionActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.activeWorkspace$$ = this.workspace$.subscribe(\n      (workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$.subscribe(\n            (widget: Widget) => this.activeWorkspaceWidget$.next(widget)\n          );\n        }\n      }\n    );\n\n    this.rowsInMapExtentCheckCondition$$ =\n      this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterCustomFuncStrategy\n            );\n            if (filterStrategy) {\n              if (rowsInMapExtent) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe(\n      (selectOnly) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterSelectionStrategy\n            );\n            if (filterStrategy) {\n              if (selectOnly) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      }\n    );\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store.all().find((workspace) => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find((workspace) => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map((a) => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n}\n","<igo-spatial-filter-type\n  [store]=\"spatialListStore\"\n  [selectedQueryType]=\"queryType\"\n  [zone]=\"zone\"\n  [layers]=\"activeLayers\"\n  (eventType)=\"getOutputType($event)\"\n  (eventQueryType)=\"getOutputQueryType($event)\"\n  (zoneChange)=\"onZoneChange($event)\"\n  (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n  (bufferChange)=\"buffer = $event\"\n  (measureUnitChange)=\"measureUnit = $event\"\n>\n</igo-spatial-filter-type>\n\n<igo-spatial-filter-item\n  [type]=\"type\"\n  [queryType]=\"queryType\"\n  [map]=\"map\"\n  [zone]=\"zone\"\n  [loading]=\"loading\"\n  [store]=\"store\"\n  [layers]=\"activeLayers\"\n  [allLayers]=\"layers\"\n  [thematicLength]=\"thematicLength\"\n  (radiusEvent)=\"buffer = $event\"\n  (bufferEvent)=\"buffer = $event\"\n  (measureUnitChange)=\"measureUnit = $event\"\n  (freehandControl)=\"freehandDrawIsActive = $event\"\n  (drawZoneEvent)=\"zone = $event\"\n  (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n  (itemTypeChange)=\"itemType = $event\"\n  (thematicChange)=\"thematics = $event\"\n  (toggleSearch)=\"getOutputToggleSearch()\"\n  (clearButtonEvent)=\"clearMap()\"\n  (clearSearchEvent)=\"getOutputClearSearch()\"\n  (export)=\"activateExportTool()\"\n  (openWorkspace)=\"activateWorkspace()\"\n  (entityChange)=\"activateWorkspace($event)\"\n>\n</igo-spatial-filter-item>\n<ng-container *ngIf=\"selectedFeature$ | async as feature\">\n  <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n</ng-container>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { SELECTION_MARKER_ICON } from '@igo2/common/icon';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  DataSource,\n  DataSourceService,\n  ExportOptions,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  IgoMap,\n  Layer,\n  LayerService,\n  MeasureLengthUnit,\n  QueryableDataSourceOptions,\n  SpatialFilterItemComponent,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterService,\n  SpatialFilterThematic,\n  SpatialFilterType,\n  SpatialFilterTypeComponent,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  featureToOl,\n  moveToOlFeatures\n} from '@igo2/geo';\n\nimport { EventsKey } from 'ol/events';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport * as olstyle from 'ol/style';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport { take, takeUntil, tap } from 'rxjs/operators';\n\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from './../../import-export/import-export.state';\n\n/**\n * Tool to apply spatial filter\n */\n@ToolComponent({\n  name: 'spatialFilter',\n  title: 'igo.integration.tools.spatialFilter',\n  icon: SELECTION_MARKER_ICON\n})\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-tool',\n  templateUrl: './spatial-filter-tool.component.html',\n  styleUrls: ['./spatial-filter-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    SpatialFilterTypeComponent,\n    SpatialFilterItemComponent,\n    PanelComponent,\n    FeatureDetailsComponent,\n    NgIf,\n    AsyncPipe\n  ]\n})\nexport class SpatialFilterToolComponent implements OnInit, OnDestroy {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store: EntityStore<Feature> = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  private moveendKey: EventsKey;\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapState: MapState,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private importExportState: ImportExportState,\n    private toolState: ToolState,\n    private workspaceState: WorkspaceState,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  activateExportTool() {\n    const ids = [];\n    const re = new RegExp('^Zone \\\\d+');\n    for (const layer of this.layers) {\n      if (!layer.title.match(re)) {\n        ids.push(layer.id);\n      }\n    }\n    this.importExportState.setMode(ImportExportMode.export);\n    this.importExportState.setsExportOptions({ layers: ids } as ExportOptions);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateWorkspace(record?) {\n    let layerToOpenWks;\n    this.workspaceState.store.entities$\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        if (\n          !record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          if (this.itemType === SpatialFilterItemType.Thematics) {\n            for (const thematic of this.thematics) {\n              if (!thematic.zeroResults) {\n                layerToOpenWks = this.activeLayers.find((layer) =>\n                  layer.title.includes(\n                    thematic.name + ' ' + this.iterator.toString()\n                  )\n                );\n                break;\n              }\n            }\n          } else {\n            const title = 'Adresses ' + this.iterator.toString();\n            this.activeLayers.forEach((layer) => {\n              if (layer.title.includes(title)) {\n                layerToOpenWks = layer;\n              }\n            });\n          }\n\n          if (layerToOpenWks) {\n            this.workspaceState.workspacePanelExpanded = true;\n            this.workspaceState.setActiveWorkspaceById(layerToOpenWks.id);\n          }\n        } else if (\n          record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          this.selectWorkspaceEntity(record);\n          this.moveendKey = this.map.ol.on('moveend', () => {\n            this.selectWorkspaceEntity(record);\n          });\n        }\n      });\n  }\n\n  private selectWorkspaceEntity(record) {\n    this.workspaceState.store.all().forEach((workspace) => {\n      workspace.entityStore.state.updateAll({ selected: false });\n      if (workspace.title.includes(record.added[0].meta.title)) {\n        this.workspaceState.setActiveWorkspaceById(workspace.id);\n        workspace.entityStore.state.updateMany(record.added, {\n          selected: true\n        });\n      }\n    });\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach((feature) => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((f) => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  TimeFilterListBindingDirective,\n  TimeFilterListComponent\n} from '@igo2/geo';\n\n@ToolComponent({\n  name: 'timeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history'\n})\n@Component({\n  selector: 'igo-time-filter-tool',\n  templateUrl: './time-filter-tool.component.html',\n  standalone: true,\n  imports: [TimeFilterListComponent, TimeFilterListBindingDirective]\n})\nexport class TimeFilterToolComponent {\n  constructor() {}\n}\n","<igo-time-filter-list igoTimeFilterListBinding></igo-time-filter-list>\n","<mat-tab-group *ngIf=\"importExportShowBothType\">\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportData' | translate\"\n  >\n    <igo-import-export\n      [contextUri]=\"(contextState.context$ | async).uri\"\n      [map]=\"map\"\n      [selectFirstProj]=\"selectFirstProj\"\n      [projectionsLimitations]=\"projectionsLimitations\"\n      [store]=\"workspaceStore\"\n      [selectedMode]=\"importExportState.selectedMode$ | async\"\n      (selectMode)=\"modeChanged($any($event))\"\n      [exportOptions$]=\"importExportState.exportOptions$\"\n      (exportOptionsChange)=\"exportOptionsChange($event)\"\n    >\n    </igo-import-export>\n  </mat-tab>\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportContext' | translate\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'layer'\"\n  [contextUri]=\"(contextState.context$ | async).uri\"\n  [map]=\"map\"\n  [store]=\"workspaceStore\"\n  [selectedMode]=\"importExportState.selectedMode$ | async\"\n  (selectMode)=\"modeChanged($any($event))\"\n  [exportOptions$]=\"importExportState.exportOptions$\"\n  (exportOptionsChange)=\"exportOptionsChange($event)\"\n>\n</igo-import-export>\n\n<igo-context-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'context'\"\n  [map]=\"map\"\n>\n</igo-context-import-export>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport type { WorkspaceStore } from '@igo2/common/workspace';\nimport { ContextImportExportComponent } from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportOptions,\n  IgoMap,\n  ImportExportComponent,\n  ProjectionsLimitationsOptions\n} from '@igo2/geo';\n\nimport { ContextState } from '../../context/context.state';\nimport { MapState } from '../../map/map.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport {\n  ImportExportMode,\n  ImportExportState,\n  ImportExportType\n} from '../import-export.state';\n\n@ToolComponent({\n  name: 'importExport',\n  title: 'igo.integration.tools.importExport',\n  icon: 'file_save'\n})\n@Component({\n  selector: 'igo-import-export-tool',\n  templateUrl: './import-export-tool.component.html',\n  styleUrls: ['./import-export-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTabsModule,\n    ImportExportComponent,\n    ContextImportExportComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ImportExportToolComponent implements OnInit {\n  @Input() projectionsLimitations: ProjectionsLimitationsOptions;\n\n  @Input() selectFirstProj: boolean = false;\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  @Input() importExportType: ImportExportType = ImportExportType.layer;\n  @Input() importExportShowBothType: boolean = true;\n\n  constructor(\n    private mapState: MapState,\n    public importExportState: ImportExportState,\n    private workspaceState: WorkspaceState,\n    public contextState: ContextState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectType();\n    this.selectMode();\n  }\n\n  private selectType() {\n    if (this.importExportType) {\n      this.importExportState.importExportType$.next(this.importExportType);\n    }\n    const userSelectedType = this.importExportState.importExportType$.value;\n    if (userSelectedType !== undefined) {\n      this.importExportState.setImportExportType(userSelectedType);\n    } else {\n      this.importExportState.setImportExportType(ImportExportType.layer);\n    }\n  }\n\n  private selectMode() {\n    const userSelectedMode = this.importExportState.selectedMode$.value;\n    if (userSelectedMode !== undefined) {\n      this.importExportState.setMode(userSelectedMode);\n    } else {\n      this.importExportState.setMode(ImportExportMode.import);\n    }\n  }\n\n  public modeChanged(mode: ImportExportMode) {\n    this.importExportState.setMode(mode);\n  }\n\n  public exportOptionsChange(exportOptions: ExportOptions) {\n    this.importExportState.setsExportOptions(exportOptions);\n  }\n\n  importExportTypeChange(event) {\n    this.importExportType = event.value;\n  }\n}\n","<div class=\"advanced-coordinates__coordinates-container\">\n  <div class=\"advanced-coordinates__coordinates-container__inner\">\n    <mat-form-field *ngIf=\"units; else elseBlock\" subscriptSizing=\"dynamic\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lon' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lon'\n            | translate\n        \"\n        [value]=\"coordinates[0]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock>\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.est'\n              | translate\n          \"\n          [value]=\"coordinates[0]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n\n    <mat-form-field *ngIf=\"units; else elseBlock2\" subscriptSizing=\"dynamic\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lat' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lat'\n            | translate\n        \"\n        [value]=\"coordinates[1]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock2>\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.nord'\n              | translate\n          \"\n          [value]=\"coordinates[1]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n    <button\n      mat-icon-button\n      [attr.aria-label]=\"\n        'igo.integration.advanced-map-tool.advanced-coordinates.copy'\n          | translate\n      \"\n      class=\"igo-form-button-group advanced-coordinates__copy-coordinates\"\n      (click)=\"copyTextToClipboard()\"\n    >\n      <mat-icon>content_copy</mat-icon>\n    </button>\n  </div>\n\n  <form class=\"igo-form advanced-coordinates__form\" [formGroup]=\"form\">\n    <div class=\"advanced-coordinates__coordinates-container__inner\">\n      <mat-form-field class=\"igo-input-container\" subscriptSizing=\"dynamic\">\n        <mat-label>{{\n          'igo.integration.advanced-map-tool.advanced-coordinates.coordSystem'\n            | translate\n        }}</mat-label>\n        <mat-select [(value)]=\"inputProj\">\n          <mat-option\n            matTooltipShowDelay=\"500\"\n            *ngFor=\"let projection of projections$ | async\"\n            [value]=\"projection\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            {{ projection.translatedValue || projection.alias }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n    <div class=\"advanced-coordinates__coordinates-container__inner\">\n      <mat-slide-toggle\n        class=\"center-toggle mat-typography\"\n        [checked]=\"center\"\n        [labelPosition]=\"'before'\"\n        (change)=\"displayCenter($event.checked)\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-coordinates.center'\n            | translate\n        }}\n      </mat-slide-toggle>\n    </div>\n  </form>\n\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.zoom' | translate\n    }}\n    {{ map.viewController.getZoom() }}\n  </p>\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.scale' | translate\n    }}\n    {{ formattedScale$ | async }}\n  </p>\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.resolution'\n        | translate\n    }}\n    {{ map.viewController.getResolution() | number: '1.0-0' }}\n  </p>\n</div>\n","import { AsyncPipe, DecimalPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport {\n  IgoMap,\n  InputProjections,\n  ProjectionsLimitationsOptions,\n  formatScale\n} from '@igo2/geo';\nimport { computeProjectionsConstraints, zoneMtm, zoneUtm } from '@igo2/geo';\nimport { Clipboard } from '@igo2/utils';\n\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapState } from '../../map.state';\n\n/**\n * Tool to display the coordinates and a cursor of the center of the map\n */\n@Component({\n  selector: 'igo-advanced-coordinates',\n  templateUrl: './advanced-coordinates.component.html',\n  styleUrls: ['./advanced-coordinates.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatSlideToggleModule,\n    AsyncPipe,\n    DecimalPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AdvancedCoordinatesComponent implements OnInit, OnDestroy {\n  public formattedScale$: BehaviorSubject<string> = new BehaviorSubject('');\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  public form: UntypedFormGroup;\n  public coordinates: string[];\n  private currentCenterDefaultProj: [number, number];\n  public center: boolean;\n  private inMtmZone: boolean = true;\n  private inLambert2 = { 32198: true, 3798: true };\n  private mapState$$: Subscription;\n  private formStatus$$: Subscription;\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n  private defaultProj: InputProjections;\n  private currentZones = { utm: undefined, mtm: undefined };\n  public units: boolean = true;\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get inputProj(): InputProjections {\n    return this.form.get('inputProj').value;\n  }\n  set inputProj(value: InputProjections) {\n    this.form.patchValue({ inputProj: value });\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private config: ConfigService,\n    private formBuilder: UntypedFormBuilder\n  ) {\n    this.defaultProj = {\n      translatedValue: this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.wgs84',\n        { code: 'EPSG:4326' }\n      ),\n      translateKey: 'wgs84',\n      alias: 'WGS84',\n      code: 'EPSG:4326',\n      zone: '',\n      def: undefined,\n      extent: undefined\n    };\n    this.center = this.storageService.get('centerToggle') as boolean;\n    this.computeProjections();\n    this.buildForm();\n  }\n\n  /**\n   * Listen a state of the map, a state of a form, update the coordinates\n   */\n  ngOnInit(): void {\n    this.mapState$$ = this.map.viewController.state$\n      .pipe(debounceTime(50))\n      .subscribe(() => {\n        this.setScaleValue(this.map);\n        this.updateCoordinates();\n      });\n\n    this.formStatus$$ = this.form.valueChanges.subscribe(() => {\n      this.updateCoordinates();\n    });\n\n    const tempInputProj = this.storageService.get(\n      'currentProjection'\n    ) as InputProjections;\n\n    this.inputProj =\n      this.projections$.value.find(\n        (val) => val.code === this.defaultProj.code\n      ) ?? this.projections$.value[0];\n\n    if (tempInputProj !== null) {\n      const pos = this.positionInList(tempInputProj);\n      this.inputProj = this.projections$.value[pos];\n      this.updateZoneMtmUtm();\n    }\n    this.map.mapCenter$.next(this.center);\n    this.coordinates = this.getCoordinates();\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\n      this.defaultProj.code\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.map.mapCenter$.next(false);\n    this.mapState$$.unsubscribe();\n    this.formStatus$$.unsubscribe();\n  }\n\n  setScaleValue(map: IgoMap) {\n    this.formattedScale$.next(\n      ': ~ 1 / ' + formatScale(map.viewController.getScale())\n    );\n  }\n  /**\n   * Coordinates of the center of the map on the appropriate systeme of coordinates\n   * @returns Array of two numbers\n   */\n  getCoordinates(): string[] {\n    this.currentZones.mtm = zoneMtm(this.currentCenterDefaultProj[0]);\n    this.currentZones.utm = zoneUtm(this.currentCenterDefaultProj[0]);\n    let coord;\n    const code = this.inputProj.code;\n    let decimal = 2;\n    if (code.includes('EPSG:4326') || code.includes('EPSG:4269')) {\n      decimal = 5;\n    }\n    this.units = code === 'EPSG:4326' || code === 'EPSG:4269';\n    coord = this.map.viewController\n      .getCenter(code)\n      .map((c) => c.toFixed(decimal));\n    return coord;\n  }\n\n  updateCoordinates() {\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\n      this.defaultProj.code\n    );\n    const currentMtmZone = zoneMtm(this.currentCenterDefaultProj[0]);\n    const currentUtmZone = zoneUtm(this.currentCenterDefaultProj[0]);\n    if (!this.inMtmZone && currentMtmZone !== this.currentZones.mtm) {\n      this.back2quebec();\n    }\n    let zoneChange = false;\n    if (currentMtmZone !== this.currentZones.mtm) {\n      this.currentZones.mtm = currentMtmZone;\n      zoneChange = true;\n    }\n    if (currentUtmZone !== this.currentZones.utm) {\n      this.currentZones.utm = currentUtmZone;\n      zoneChange = true;\n    }\n    if (zoneChange) {\n      this.updateProjectionsZoneChange();\n    }\n    this.checkLambert(this.currentCenterDefaultProj);\n    this.coordinates = this.getCoordinates();\n\n    this.storageService.set(\n      'currentProjection',\n      this.inputProj,\n      StorageScope.SESSION\n    );\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(this.coordinates.toString());\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyMsg',\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyTitle'\n      );\n    }\n  }\n\n  /**\n   * Display a cursor on the center of the map\n   */\n  displayCenter(toggle: boolean): void {\n    this.center = toggle;\n    this.map.mapCenter$.next(toggle);\n    this.storageService.set('centerToggle', toggle, StorageScope.SESSION);\n  }\n\n  /**\n   * Builder of the form\n   */\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Update list of projections after changing of the state of the map\n   */\n  private updateProjectionsZoneChange(): void {\n    let modifiedProj = this.projections$.value;\n    const translate = this.languageService.translate;\n    modifiedProj.map((p) => {\n      if (p.translateKey === 'mtm') {\n        const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n        if (zone) {\n          const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n          p.alias = `MTM ${zone}`;\n          p.code = code;\n          p.zone = `${zone}`;\n          p.translatedValue = translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            p\n          );\n        } else {\n          p.alias = '';\n          this.inMtmZone = false;\n          if (this.inputProj.translateKey === 'mtm') {\n            this.inputProj = this.projections$.value[0];\n          }\n        }\n      }\n      if (p.translateKey === 'utm') {\n        const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n        const code = `EPSG:326${zone}`;\n        p.alias = `UTM ${zone}`;\n        p.code = code;\n        p.zone = `${zone}`;\n        p.translatedValue = translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          p\n        );\n      }\n    });\n    modifiedProj = modifiedProj.filter((p) => p.alias !== '');\n    this.projections$.next(modifiedProj);\n  }\n\n  /**\n   * Create a list of currents projections\n   */\n  private computeProjections(): void {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (!this.currentCenterDefaultProj) {\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\n        this.defaultProj.code\n      );\n    }\n\n    const translate = this.languageService.translate;\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.wgs84',\n          { code: 'EPSG:4326' }\n        ),\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.nad83',\n          { code: 'EPSG:4269' }\n        ),\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.webMercator',\n          { code: 'EPSG:3857' }\n        ),\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n    if (this.projectionsConstraints.mtm) {\n      // Quebec\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      if (zone) {\n        this.inMtmZone = true;\n        const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n        projections.splice(3, 0, {\n          translatedValue: this.languageService.translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            { code, zone }\n          ),\n          translateKey: 'mtm',\n          alias: `MTM ${zone}`,\n          code,\n          zone: `${zone}`,\n          def: undefined,\n          extent: undefined\n        });\n      } else {\n        this.inMtmZone = false;\n      }\n    }\n    if (this.projectionsConstraints.utm) {\n      const order = this.inMtmZone ? 4 : 3;\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      projections.splice(order, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          { code, zone }\n        ),\n        translateKey: 'utm',\n        alias: `UTM ${zone}`,\n        code,\n        zone: `${zone}`,\n        def: undefined,\n        extent: undefined\n      });\n    }\n    let configProjection: InputProjections[] = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = (this.config.getConfig('projections') ||\n        []) as InputProjections[];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  /**\n   * Push the MTM in the array of systeme of coordinates\n   * @param projections Array of the InputProjections\n   */\n  private pushMtm(projections: Array<InputProjections>): void {\n    if (this.projectionsConstraints.mtm) {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      projections.splice(3, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.mtm',\n          { code, zone }\n        ),\n        translateKey: 'mtm',\n        alias: `MTM ${zone}`,\n        code,\n        zone: `${zone}`,\n        def: undefined,\n        extent: undefined\n      });\n    }\n  }\n\n  /**\n   * Updates the list of systems of coordinates for territory of Quebec\n   * push MTM and UTM in the Array\n   */\n  private back2quebec(): void {\n    const projections = this.projections$.value;\n    this.pushMtm(projections);\n    this.inMtmZone = true;\n  }\n\n  /**\n   * Update the numbers of the zones when application is restarted\n   */\n  private updateZoneMtmUtm() {\n    if (this.inputProj.translateKey === 'mtm') {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `MTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.mtm',\n        { code, zone }\n      );\n    }\n    if (this.inputProj.translateKey === 'utm') {\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `UTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.utm',\n        { code, zone }\n      );\n    }\n  }\n\n  /**\n   * Compute the position of a current projection in a list. 0 if the projection is not in the list\n   * @param translateKey string, translate key of a projection\n   * @returns numeric, position of an element in the array\n   */\n  positionInList(tempInputProj: InputProjections): number {\n    const tk = tempInputProj.translateKey;\n    const alias = tempInputProj.alias;\n    let position; // = undefined;\n    let iter = 0;\n    this.projections$.value.map((projection) => {\n      if (tk) {\n        if (tk === projection.translateKey) {\n          position = iter;\n        }\n      } else if (alias === projection.alias) {\n        position = iter;\n      }\n      iter++;\n    });\n    position = position ? position : 0;\n    return position;\n  }\n\n  /**\n   * Change the list of projections depending on the projections of Lambert\n   * @param coordinates An array of numbers, longitude and latitude\n   */\n  checkLambert(coordinates: [number, number]) {\n    const lambertProjections = this.config.getConfig('projections') || [];\n    lambertProjections.forEach((projection) => {\n      let modifiedProj = this.projections$.value;\n      const extent = projection.extent;\n      const code = projection.code.match(/\\d+/);\n      const currentExtentWGS = olproj.transformExtent(\n        extent,\n        projection.code,\n        this.defaultProj.code\n      );\n      if (\n        coordinates[0] < currentExtentWGS[0] ||\n        coordinates[0] > currentExtentWGS[2] ||\n        coordinates[1] < currentExtentWGS[1] ||\n        coordinates[1] > currentExtentWGS[3]\n      ) {\n        this.inLambert2[code] = false;\n        if (this.inputProj.alias === projection.alias) {\n          this.inputProj = this.projections$.value[0];\n        }\n        modifiedProj = modifiedProj.filter((p) => p.alias !== projection.alias);\n        this.projections$.next(modifiedProj);\n      } else {\n        if (!this.inLambert2[code]) {\n          this.projections$.next(modifiedProj.concat(projection));\n          this.inLambert2[code] = true;\n        }\n      }\n    });\n  }\n}\n","<div\n  *ngIf=\"userControlledLayerList.length; else noLayersBlock\"\n  class=\"igo-swipe-select-container\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-swipe.swipe-select'\n          | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.integration.advanced-map-tool.advanced-swipe.selectAll'\n              | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          (click)=\"applyNewLayers(e)\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n    <mat-slide-toggle\n      class=\"swipe-toggle mat-typography\"\n      [checked]=\"swipe\"\n      [labelPosition]=\"'before'\"\n      (change)=\"startSwipe($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.swipe' | translate }}\n    </mat-slide-toggle>\n  </form>\n</div>\n\n<ng-template #noLayersBlock>\n  <mat-list>\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.empty' | translate }}\n    </p>\n    <p class=\"map-empty mat-typography\">\n      {{\n        'igo.integration.advanced-map-tool.advanced-swipe.customize' | translate\n      }}\n    </p>\n    <mat-list-item>\n      <mat-icon matListItemIcon>search</mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.search-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon>library_add</mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.catalog-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon>star</mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.context-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoIconComponent } from '@igo2/common/icon';\nimport { ContextService, DetailedContext } from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { IgoMap, Layer, VectorLayer } from '@igo2/geo';\n\nimport { ToolState } from '../../../tool/tool.state';\nimport { MapState } from '../../map.state';\n\n@Component({\n  selector: 'igo-advanced-swipe',\n  templateUrl: './advanced-swipe.component.html',\n  styleUrls: ['./advanced-swipe.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDividerModule,\n    NgFor,\n    MatSlideToggleModule,\n    MatListModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class AdvancedSwipeComponent implements OnInit, OnDestroy {\n  public swipe: boolean = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public res: DetailedContext;\n  public listForSwipe: Layer[];\n\n  /**\n   * Get an active map state\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private contextService: ContextService,\n    private formBuilder: UntypedFormBuilder,\n    private toolState: ToolState\n  ) {\n    this.buildForm();\n  }\n\n  /**\n   * Get the list of layers for swipe\n   * @internal\n   */\n  ngOnInit() {\n    this.map.layers$.subscribe(\n      (ll) =>\n        (this.userControlledLayerList = ll.filter(\n          (layer) =>\n            !layer.baseLayer && layer.showInLayerList && layer.displayed\n        ))\n    );\n  }\n\n  /**\n   * Desactivate the swipe\n   * @internal\n   */\n  ngOnDestroy() {\n    this.swipe = false;\n    this.map.swipeEnabled$.next(this.swipe);\n  }\n\n  /**\n   * Build a form for choise of the layers\n   */\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Activate the swipe, send a list of layers for a swipe-tool\n   */\n  startSwipe(toggle: boolean) {\n    this.swipe = toggle;\n    this.map.swipeEnabled$.next(toggle);\n    this.listForSwipe = [];\n    for (const layer of this.form.value.layers) {\n      this.listForSwipe.push(layer);\n    }\n    this.map.selectedFeatures$.next(this.listForSwipe);\n  }\n\n  /**\n   * Restart a swipe for a new layers-list\n   */\n  applyNewLayers(e) {\n    this.startSwipe(false); // l'approche KISS\n    this.startSwipe(true);\n    if (e._selected) {\n      e._selected = false;\n    }\n    const allLayers = this.userControlledLayerList.length;\n    const selectedLayers = this.form.controls.layers.value.length;\n    if (selectedLayers === allLayers) {\n      e._selected = true;\n    }\n  }\n\n  /**\n   * Select all list of layers and restart a tool\n   */\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    } else {\n      this.form.controls.layers.setValue([]);\n    }\n    this.startSwipe(false);\n    this.startSwipe(true);\n  }\n\n  /**\n   * Open search tool\n   */\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  /**\n   * Open catalog\n   */\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  /**\n   * Open context manager\n   */\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","import { AsyncPipe } from '@angular/common';\nimport { Component } from '@angular/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MapState } from '../map.state';\nimport { AdvancedCoordinatesComponent } from './advanced-coordinates/advanced-coordinates.component';\nimport { AdvancedSwipeComponent } from './advanced-swipe/advanced-swipe.component';\n\n@ToolComponent({\n  name: 'advancedMap',\n  title: 'igo.integration.tools.advancedMap',\n  icon: 'home_repair_service'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-advanced-map-tool',\n  templateUrl: './advanced-map-tool.component.html',\n  styleUrls: ['./advanced-map-tool.component.scss'],\n  standalone: true,\n  imports: [\n    AdvancedSwipeComponent,\n    MatDividerModule,\n    AdvancedCoordinatesComponent,\n    MatSlideToggleModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AdvancedMapToolComponent {\n  get tracking$() {\n    return this.mapState.map.geolocationController.tracking$;\n  }\n  get followPosition$() {\n    return this.mapState.map.geolocationController.followPosition$;\n  }\n\n  constructor(public mapState: MapState) {}\n\n  toggleTracking(value) {\n    this.mapState.map.geolocationController.tracking = value;\n  }\n\n  toggleFollow(value) {\n    this.mapState.map.geolocationController.followPosition = value;\n  }\n}\n","<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-swipe.swipe-tool' | translate\n  }}\n</h4>\n<igo-advanced-swipe></igo-advanced-swipe>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.coordinates'\n      | translate\n  }}\n</h4>\n<igo-advanced-coordinates></igo-advanced-coordinates>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n\n<h4 class=\"nameOfTool\">\n  {{ 'igo.integration.advanced-map-tool.geolocation.title' | translate }}\n</h4>\n\n<div class=\"igo-input-container\">\n  <div class=\"geolocation-slide-toggle-container\">\n    <mat-slide-toggle\n      class=\"geolocation-option\"\n      [checked]=\"tracking$ | async\"\n      [labelPosition]=\"'before'\"\n      (change)=\"toggleTracking($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.tracking' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      class=\"geolocation-option\"\n      [disabled]=\"(tracking$ | async) !== true\"\n      [labelPosition]=\"'before'\"\n      [checked]=\"followPosition$ | async\"\n      (change)=\"toggleFollow($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.follow' | translate }}\n    </mat-slide-toggle>\n  </div>\n</div>\n","<button\n  *ngIf=\"hasWorkspace$ | async\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.integration.workspace.toggleWorkspace' | translate\"\n  [color]=\"color\"\n  (click)=\"activateWorkspace()\"\n>\n  <mat-icon>table</mat-icon>\n</button>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { Layer } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\n\nimport { WorkspaceState } from '../workspace.state';\n\n@Component({\n  selector: 'igo-workspace-button',\n  templateUrl: './workspace-button.component.html',\n  styleUrls: ['./workspace-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class WorkspaceButtonComponent implements OnInit, OnDestroy {\n  public hasWorkspace$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private hasWorkspace$$: Subscription;\n\n  private _layer: Layer;\n  private layer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n  @Input()\n  set layer(value: Layer) {\n    this._layer = value;\n    this.layer$.next(this._layer);\n  }\n\n  get layer(): Layer {\n    return this._layer;\n  }\n\n  @Input() color: string = 'primary';\n\n  constructor(private workspaceState: WorkspaceState) {}\n\n  ngOnInit(): void {\n    this.hasWorkspace$$ = combineLatest([\n      this.workspaceState.workspaceEnabled$,\n      this.layer$\n    ]).subscribe((bunch) =>\n      this.hasWorkspace$.next(bunch[0] && bunch[1]?.options.workspace?.enabled)\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.hasWorkspace$$.unsubscribe();\n  }\n\n  activateWorkspace() {\n    if (\n      this.workspaceState.workspace$.value &&\n      (this.workspaceState.workspace$.value as any).layer.id ===\n        this.layer.id &&\n      this.workspaceState.workspacePanelExpanded\n    ) {\n      this.workspaceState.workspacePanelExpanded = false;\n    } else {\n      this.workspaceState.workspacePanelExpanded = true;\n      this.workspaceState.setActiveWorkspaceById(this.layer.id);\n    }\n  }\n}\n","<igo-layer-list\n  class=\"mapDetailsList\"\n  *ngIf=\"(layers$ | async).length; else empty\"\n  [map]=\"map\"\n  igoLayerListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n  [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n  [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [queryBadge]=\"queryBadge\"\n>\n  <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n    <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n    <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n    <igo-export-button\n      [layer]=\"layer\"\n      (click)=\"activateExport(layer)\"\n    ></igo-export-button>\n    <igo-ogc-filter-button\n      [header]=\"ogcButton\"\n      [layer]=\"layer\"\n    ></igo-ogc-filter-button>\n    <igo-time-filter-button\n      [header]=\"timeButton\"\n      [layer]=\"layer\"\n    ></igo-time-filter-button>\n    <igo-track-feature-button\n      [trackFeature]=\"true\"\n      [layer]=\"layer\"\n    ></igo-track-feature-button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n  </ng-template>\n</igo-layer-list>\n\n<ng-template #empty>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>search</mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>library_add</mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>star</mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  SearchSourceService,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { WorkspaceButtonComponent } from '../../workspace';\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\n\n@ToolComponent({\n  name: 'mapDetails',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-details-tool',\n  templateUrl: './map-details-tool.component.html',\n  styleUrls: ['./map-details-tool.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerListComponent,\n    LayerListBindingDirective,\n    WorkspaceButtonComponent,\n    ExportButtonComponent,\n    OgcFilterButtonComponent,\n    TimeFilterButtonComponent,\n    TrackFeatureButtonComponent,\n    MetadataButtonComponent,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapDetailsToolComponent implements OnInit {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layers$(): Observable<Layer[]> {\n    return this.map.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) =>\n            layer.showInLayerList !== false &&\n            (!this.excludeBaseLayers || !layer.baseLayer)\n        )\n      )\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","<igo-layer-legend-list\n  *ngIf=\"showAllLegend()\"\n  igoLayerLegendListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [allowShowAllLegends]=\"allowShowAllLegends\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n  (allLegendsShown)=\"onShowAllLegends($event)\"\n>\n</igo-layer-legend-list>\n<ng-template\n  *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n></ng-template>\n\n<p\n  class=\"map-empty mat-typography\"\n  *ngIf=\"\n    !allowShowAllLegends &&\n    (layers$ | async).length !== 0 &&\n    (visibleOrInRangeLayers$ | async).length === 0\n  \"\n>\n  {{\n    (visibleLayers$ | async).length\n      ? ('igo.integration.mapTool.noLayersInRange' | translate)\n      : ('igo.integration.mapTool.noLayersVisible' | translate)\n  }}\n</p>\n\n<ng-template #emptyLayers>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>search</mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>library_add</mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>star</mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  IgoMap,\n  Layer,\n  LayerLegendListBindingDirective,\n  LayerLegendListComponent,\n  LayerListControlsOptions,\n  SearchSourceService,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport {\n  BehaviorSubject,\n  Observable,\n  ReplaySubject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\n\n@ToolComponent({\n  name: 'mapLegend',\n  title: 'igo.integration.tools.legend',\n  icon: 'format_list_bulleted'\n})\n@Component({\n  selector: 'igo-map-legend-tool',\n  templateUrl: './map-legend-tool.component.html',\n  styleUrls: ['./map-legend-tool.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerLegendListComponent,\n    LayerLegendListBindingDirective,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapLegendToolComponent implements OnInit, OnDestroy {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  change$ = new ReplaySubject<void>(1);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  FEATURE,\n  Feature,\n  FeatureStore,\n  IgoMap,\n  Layer,\n  MapGeolocationState,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  featureFromOl,\n  measureOlGeometryLength,\n  roundCoordTo\n} from '@igo2/geo';\nimport { uuid } from '@igo2/utils';\n\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Geometry from 'ol/geom/Geometry';\nimport olLineString from 'ol/geom/LineString';\nimport olLayerVector from 'ol/layer/Vector';\nimport * as olProj from 'ol/proj';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { BehaviorSubject, Subscription, combineLatest, interval } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapProximityState {\n  private defaultProximityRadiusValue: number = 30;\n\n  public enabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n  public proximityRadiusValue$: BehaviorSubject<number>;\n  public proximitylocationType$: BehaviorSubject<string> =\n    new BehaviorSubject<string>('geolocation');\n  public proximityFeatureStore: FeatureStore<Feature>;\n  private subs$$: Subscription[] = [];\n  public currentPositionCoordinate$: BehaviorSubject<[number, number]> =\n    new BehaviorSubject(undefined);\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private storageService: StorageService\n  ) {\n    this.proximityFeatureStore = new FeatureStore<Feature>([], {\n      map: this.mapState.map\n    });\n\n    this.proximityRadiusValue$ = new BehaviorSubject<number>(\n      (this.storageService.get('mapProximityRadius') as number) ||\n        this.defaultProximityRadiusValue\n    );\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.subscribeProximityMonitor();\n    });\n  }\n\n  subscribeProximityMonitor() {\n    this.subs$$.push(\n      combineLatest([\n        this.enabled$,\n        this.proximitylocationType$,\n        this.proximityRadiusValue$,\n        interval(5000),\n        this.map.geolocationController.position$\n      ])\n        .pipe(debounceTime(750))\n        .subscribe(\n          (bunch: [boolean, string, number, number, MapGeolocationState]) => {\n            this.proximityFeatureStore.clear();\n            const enabled = bunch[0];\n            const layers = this.map.layers;\n            const currentPos = this.map.geolocationController.position$.value;\n            const locationType = bunch[1];\n            const proximityRadiusValue = bunch[2];\n            this.storageService.set(\n              'mapProximityRadius',\n              proximityRadiusValue || this.defaultProximityRadiusValue\n            );\n\n            if (!enabled) {\n              return;\n            }\n\n            let coord: number[];\n            if (locationType === 'geolocation') {\n              if (!currentPos || !currentPos.position) {\n                return;\n              }\n\n              coord = olProj.transform(\n                currentPos.position,\n                currentPos.projection,\n                this.map.projection\n              );\n              this.map.mapCenter$.next(false);\n            } else {\n              coord = this.map.viewController.getCenter();\n              this.map.mapCenter$.next(true);\n            }\n\n            const coordLonLat = olProj.transform(\n              coord,\n              this.map.projection,\n              'EPSG:4269'\n            );\n            const roundedCoordLonLat = roundCoordTo(\n              coordLonLat as [number, number],\n              6\n            );\n            this.currentPositionCoordinate$.next(roundedCoordLonLat);\n\n            const layersToMonitor = layers.filter(\n              (layer) =>\n                layer.ol instanceof olLayerVector &&\n                (layer.dataSource as QueryableDataSource).options.queryable &&\n                layer.visible &&\n                layer.isInResolutionsRange\n            );\n\n            layersToMonitor.map((layerToMonitor) => {\n              const layerSource =\n                layerToMonitor.ol.getSource() as olVectorSource;\n\n              // Mostly for polygon features.\n              const olFeaturesAtCoordinate =\n                layerSource.getFeaturesAtCoordinate(coord);\n              if (olFeaturesAtCoordinate && olFeaturesAtCoordinate.length) {\n                olFeaturesAtCoordinate.map((olFeatureAtCoordinate) => {\n                  const featureAtThisPosition = featureFromOl(\n                    olFeatureAtCoordinate,\n                    this.map.projection\n                  );\n                  let title = this.getQueryTitle(\n                    featureAtThisPosition,\n                    layerToMonitor\n                  );\n                  // todo handle imported layers without querytitle? prompt title or detect first column?\n                  this.addFeatureToStore(\n                    layerToMonitor,\n                    coord,\n                    featureAtThisPosition,\n                    title,\n                    0\n                  );\n                });\n              } else {\n                // compute proximity for remaining sources\n                const closestOlFeature =\n                  layerSource.getClosestFeatureToCoordinate(coord);\n                if (closestOlFeature) {\n                  const closestOlGeom = closestOlFeature.getGeometry();\n                  const closestFeature = featureFromOl(\n                    closestOlFeature,\n                    this.map.projection\n                  );\n                  const geometryClosestPoint =\n                    closestOlGeom.getClosestPoint(coord);\n                  const linebetween = new olLineString([\n                    coord,\n                    geometryClosestPoint\n                  ]);\n                  const lineLength = measureOlGeometryLength(\n                    linebetween,\n                    'EPSG:3857'\n                  );\n                  if (lineLength <= proximityRadiusValue) {\n                    let title = this.getQueryTitle(\n                      closestFeature,\n                      layerToMonitor\n                    );\n                    // todo handle imported layers without querytitle? prompt title or detect first column?\n                    this.addFeatureToStore(\n                      layerToMonitor,\n                      coord,\n                      closestFeature,\n                      title,\n                      lineLength\n                    );\n                  }\n                }\n              }\n            });\n          }\n        )\n    );\n  }\n\n  /**\n   * Add a feature with proximity properties to the store\n   * @internal\n   */\n  private addFeatureToStore(\n    layer: Layer,\n    coordFromCalculatedDistance,\n    feature: Feature,\n    title,\n    distance\n  ) {\n    const featureId = uuid();\n    const projection = this.map.ol.getView().getProjection();\n    const olGeometry = feature.ol.getGeometry() as Geometry;\n    const geometry = new GeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.proximityFeatureStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        ...feature.properties,\n        ...{\n          id: featureId,\n          element: title,\n          distance,\n          coordFromCalculatedDistance,\n          layerSrcId: layer.id,\n          layerSrcTitle: layer.title\n        }\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n    return label;\n  }\n}\n","<igo-entity-table\n  #table\n  class=\"table-compact\"\n  [store]=\"mapProximityState.proximityFeatureStore\"\n  [template]=\"tableTemplate\"\n></igo-entity-table>\n<br />\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord\"\n  class=\"coordinates\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lon' | translate\"\n    [value]=\"coord[0]\"\n  ></textarea>\n</mat-form-field>\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord2\"\n  class=\"coordinates2\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lat' | translate\"\n    [value]=\"coord2[1]\"\n  ></textarea>\n</mat-form-field>\n\n<button\n  *ngIf=\"\n    (mapProximityState.currentPositionCoordinate$ | async) &&\n    (mapProximityState.currentPositionCoordinate$ | async).length\n  \"\n  mat-icon-button\n  (click)=\"copyTextToClipboard()\"\n>\n  <mat-icon>content_copy</mat-icon>\n</button>\n<div class=\"title-container\">\n  <mat-label class=\"title mat-typography\">{{\n    'igo.integration.map-proximity-tool.method' | translate\n  }}</mat-label>\n</div>\n<div class=\"igo-input-container mat-typography\">\n  <mat-radio-group (change)=\"onLocationTypeChange($event)\">\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'geolocation'\n      \"\n      value=\"geolocation\"\n      >{{\n        'igo.integration.map-proximity-tool.geolocation' | translate\n      }}</mat-radio-button\n    >\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'mapCenter'\n      \"\n      value=\"mapCenter\"\n      >{{\n        'igo.integration.map-proximity-tool.mapCenter' | translate\n      }}</mat-radio-button\n    >\n  </mat-radio-group>\n</div>\n\n<div class=\"radius-unit\">\n  <mat-form-field class=\"radius-field\" floatLabel=\"always\">\n    <mat-label>{{\n      'igo.integration.map-proximity-tool.radiusM' | translate\n    }}</mat-label>\n    <input\n      type=\"number\"\n      pattern=\"[0-9]*\"\n      [(ngModel)]=\"maxDistance\"\n      matInput\n      placeholder=\"{{\n        'igo.integration.map-proximity-tool.radiusM' | translate\n      }}\"\n    />\n  </mat-form-field>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\n\nimport { EntityTableComponent, EntityTableTemplate } from '@igo2/common/entity';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Feature, IgoMap } from '@igo2/geo';\nimport { Clipboard, NumberUtils } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapProximityState } from '../map-proximity.state';\nimport { MapState } from '../map.state';\n\n@ToolComponent({\n  name: 'map-proximity',\n  title: 'igo.integration.tools.closestFeature',\n  icon: 'radar'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-map-proximity-tool',\n  templateUrl: './map-proximity-tool.component.html',\n  styleUrls: ['./map-proximity-tool.component.scss'],\n  standalone: true,\n  imports: [\n    EntityTableComponent,\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    MatRadioModule,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapProximityToolComponent implements OnInit, OnDestroy {\n  private subs$$: Subscription[] = [];\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  get maxDistance() {\n    return this.mapProximityState.proximityRadiusValue$.value;\n  }\n  set maxDistance(value: number) {\n    this.mapProximityState.proximityRadiusValue$.next(value);\n  }\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n  public userDefinedMapCenter: boolean;\n  public userDefinedFollowPosition: boolean;\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    public mapState: MapState,\n    public mapProximityState: MapProximityState,\n    private languageService: LanguageService,\n    private messageService: MessageService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: false,\n      selectionCheckbox: false,\n      sort: true,\n      columns: [\n        {\n          name: 'element',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.feature'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return localFeature.properties.element;\n          }\n        },\n        {\n          name: 'distance',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.distance'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return `${NumberUtils.roundToNDecimal(\n              localFeature.properties.distance,\n              1\n            )}m`;\n          }\n        }\n      ]\n    };\n  }\n\n  ngOnInit(): void {\n    this.mapProximityState.enabled$.next(true);\n    this.userDefinedFollowPosition =\n      this.map.geolocationController.followPosition === true;\n    this.userDefinedMapCenter = this.map.mapCenter$.value === true;\n\n    this.subs$$.push(\n      this.mapProximityState.proximitylocationType$.subscribe((v) => {\n        this.map.mapCenter$.next(v !== 'geolocation');\n        if (v === 'geolocation') {\n          this.map.geolocationController.followPosition = true;\n        } else {\n          this.map.geolocationController.followPosition = false;\n        }\n      })\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.mapProximityState.enabled$.next(false);\n    this.map.mapCenter$.next(this.userDefinedMapCenter);\n    this.subs$$.map((s) => s.unsubscribe());\n    this.map.geolocationController.followPosition =\n      this.userDefinedFollowPosition;\n  }\n\n  onLocationTypeChange(e: MatRadioChange) {\n    this.mapProximityState.proximitylocationType$.next(e.value);\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(\n      this.mapProximityState.currentPositionCoordinate$?.value.toString()\n    );\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.map-proximity-tool.copyMsg',\n        'igo.integration.map-proximity-tool.copyTitle'\n      );\n    }\n  }\n}\n","<mat-tab-group>\n  <mat-tab [label]=\"'igo.integration.tools.map' | translate\">\n    <igo-layer-list\n      [map]=\"map\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [queryBadge]=\"queryBadge\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n        <igo-export-button\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-ogc-filter-button\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n        ></igo-ogc-filter-button>\n        <igo-time-filter-button\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n        ></igo-time-filter-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.contexts' | translate\">\n    <igo-context-list igoContextListBinding></igo-context-list>\n  </mat-tab>\n</mat-tab-group>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextListBindingDirective,\n  ContextListComponent\n} from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent\n} from '@igo2/geo';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceButtonComponent } from '../../workspace/workspace-button/workspace-button.component';\nimport { MapState } from './../map.state';\n\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'map',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tool',\n  templateUrl: './map-tool.component.html',\n  styleUrls: ['./map-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    LayerListComponent,\n    LayerListBindingDirective,\n    WorkspaceButtonComponent,\n    ExportButtonComponent,\n    OgcFilterButtonComponent,\n    TimeFilterButtonComponent,\n    TrackFeatureButtonComponent,\n    MetadataButtonComponent,\n    ContextListComponent,\n    ContextListBindingDirective,\n    IgoLanguageModule\n  ]\n})\nexport class MapToolComponent {\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private importExportState: ImportExportState\n  ) {}\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","<mat-tab-group\n  #tabGroup\n  [selectedIndex]=\"layerListToolState.selectedTab$ | async\"\n  (selectedTabChange)=\"tabChanged($event)\"\n>\n  <mat-tab [label]=\"'igo.integration.tools.layers' | translate\">\n    <igo-layer-list\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [queryBadge]=\"queryBadge\"\n      [map]=\"map\"\n      (appliedFilterAndSort)=\"onLayerListChange($event)\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-style-modal-layer-button\n          *ngIf=\"isStyleEditButton(layer)\"\n          [layer]=\"layer\"\n        ></igo-style-modal-layer-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-time-filter-button\n          *ngIf=\"isTimeFilterButton(layer)\"\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n          (click)=\"activateTimeFilter()\"\n        ></igo-time-filter-button>\n        <igo-ogc-filter-button\n          *ngIf=\"isOGCFilterButton(layer)\"\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n          (click)=\"activateOgcFilter()\"\n        ></igo-ogc-filter-button>\n        <igo-export-button\n          *ngIf=\"isExportButton(layer)\"\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.legend' | translate\">\n    <igo-layer-legend-list\n      *ngIf=\"showAllLegend()\"\n      igoLayerLegendListBinding\n      [allowShowAllLegends]=\"allowShowAllLegends\"\n      [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n      (allLegendsShown)=\"onShowAllLegends($event)\"\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n    >\n    </igo-layer-legend-list>\n    <ng-template\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n    ></ng-template>\n\n    <p\n      class=\"map-empty mat-typography\"\n      *ngIf=\"\n        !allowShowAllLegends &&\n        (layers$ | async).length !== 0 &&\n        (visibleOrInRangeLayers$ | async).length === 0\n      \"\n    >\n      {{\n        (visibleLayers$ | async).length\n          ? ('igo.integration.mapTool.noLayersInRange' | translate)\n          : ('igo.integration.mapTool.noLayersVisible' | translate)\n      }}\n    </p>\n  </mat-tab>\n\n  <ng-template #emptyLayers>\n    <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n      <p class=\"map-empty mat-typography\">\n        {{ 'igo.integration.mapTool.empty' | translate }}\n      </p>\n      <p\n        *ngIf=\"\n          layerAdditionAllowed &&\n          (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n        \"\n        class=\"map-empty mat-typography\"\n      >\n        {{ 'igo.integration.mapTool.customize' | translate }}\n      </p>\n\n      <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n        <mat-icon matListItemIcon>search</mat-icon>\n        <span\n          matListItemTitle\n          class=\"search-tool mat-typography\"\n          (click)=\"searchEmit()\"\n        >\n          {{ 'igo.integration.mapTool.search-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n        <mat-icon matListItemIcon>library_add</mat-icon>\n        <span\n          matListItemTitle\n          class=\"catalog-tool mat-typography\"\n          (click)=\"catalogEmit()\"\n        >\n          {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n        <mat-icon matListItemIcon>star</mat-icon>\n        <span\n          matListItemTitle\n          class=\"context-tool mat-typography\"\n          (click)=\"contextEmit()\"\n        >\n          {{ 'igo.integration.mapTool.context-tool' | translate }}\n        </span>\n      </mat-list-item>\n    </mat-list>\n  </ng-template>\n</mat-tab-group>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTabChangeEvent, MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerLegendListBindingDirective,\n  LayerLegendListComponent,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  SearchSourceService,\n  StyleModalLayerButtonComponent,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent,\n  VectorLayer,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceButtonComponent } from '../../workspace/workspace-button/workspace-button.component';\nimport { LayerListToolState } from '../layer-list-tool.state';\nimport { MapState } from '../map.state';\n\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'mapTools',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tools',\n  templateUrl: './map-tools.component.html',\n  styleUrls: ['./map-tools.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    NgIf,\n    LayerListComponent,\n    LayerListBindingDirective,\n    StyleModalLayerButtonComponent,\n    MetadataButtonComponent,\n    TrackFeatureButtonComponent,\n    TimeFilterButtonComponent,\n    OgcFilterButtonComponent,\n    ExportButtonComponent,\n    WorkspaceButtonComponent,\n    LayerLegendListComponent,\n    LayerLegendListBindingDirective,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapToolsComponent implements OnInit, OnDestroy {\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() selectedTabAtOpening: string;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input()\n  get layerListControls(): LayerListControlsOptions {\n    return this._layerListControls;\n  }\n  set layerListControls(value: LayerListControlsOptions) {\n    const stateOptions = this.layerListToolState.getLayerListControls();\n    const stateKeyword = stateOptions.keyword;\n    const stateOnlyVisible = stateOptions.onlyVisible;\n    const stateSortAlpha = stateOptions.sortAlpha;\n\n    value.keyword = stateKeyword !== '' ? stateKeyword : value.keyword;\n    value.onlyVisible =\n      stateOnlyVisible !== undefined ? stateOnlyVisible : value.onlyVisible;\n    value.sortAlpha =\n      stateSortAlpha !== undefined ? stateSortAlpha : value.sortAlpha;\n\n    value.onlyVisible =\n      value.onlyVisible === undefined ? false : value.onlyVisible;\n    value.sortAlpha = value.sortAlpha === undefined ? false : value.sortAlpha;\n\n    this._layerListControls = value;\n  }\n  private _layerListControls = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() queryBadge: boolean = false;\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): LayerListControlsOptions {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  @ViewChild('tabGroup', { static: true }) tabGroup;\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    public layerListToolState: LayerListToolState,\n    private toolState: ToolState,\n    public mapState: MapState,\n    private searchSourceService: SearchSourceService,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedTab();\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => (this.delayedShowEmptyMapContent = true), 250);\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  private selectedTab() {\n    const userSelectedTab = this.layerListToolState.selectedTab$.value;\n    if (userSelectedTab !== undefined) {\n      this.layerListToolState.setSelectedTab(userSelectedTab);\n    } else {\n      if (this.selectedTabAtOpening === 'legend') {\n        this.layerListToolState.setSelectedTab(1);\n      } else {\n        this.layerListToolState.setSelectedTab(0);\n      }\n    }\n  }\n\n  public tabChanged(tab: MatTabChangeEvent) {\n    this.layerListToolState.setSelectedTab(tab.index);\n    this.layers$.next(\n      this.map.layers.filter(\n        (layer) =>\n          layer.showInLayerList !== false &&\n          (!this.excludeBaseLayers || !layer.baseLayer)\n      )\n    );\n  }\n\n  onLayerListChange(appliedFilters: LayerListControlsOptions) {\n    this.layerListToolState.setKeyword(appliedFilters.keyword);\n    this.layerListToolState.setSortAlpha(appliedFilters.sortAlpha);\n    this.layerListToolState.setOnlyVisible(appliedFilters.onlyVisible);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateTimeFilter() {\n    this.toolState.toolbox.activateTool('activeTimeFilter');\n  }\n\n  activateOgcFilter() {\n    this.toolState.toolbox.activateTool('activeOgcFilter');\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  isTimeFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return this.timeButton && options.timeFilterable && options.timeFilter;\n  }\n\n  isOGCFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return (\n      this.ogcButton &&\n      options.ogcFilters &&\n      options.ogcFilters.enabled &&\n      (options.ogcFilters.pushButtons ||\n        options.ogcFilters.checkboxes ||\n        options.ogcFilters.radioButtons ||\n        options.ogcFilters.select ||\n        options.ogcFilters.autocomplete ||\n        options.ogcFilters.editable)\n    );\n  }\n\n  isExportButton(layer: Layer): boolean {\n    if (\n      (layer instanceof VectorLayer && layer.exportable === true) ||\n      (layer.dataSource.options.download &&\n        layer.dataSource.options.download.url) ||\n      (layer.options.workspace?.enabled &&\n        layer.options.workspace?.workspaceId !== layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  isStyleEditButton(layer: Layer): boolean {\n    if (layer instanceof VectorLayer) {\n      if ((layer as VectorLayer).options?.igoStyle?.editable) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { AdvancedMapToolComponent } from './advanced-map-tool/advanced-map-tool.component';\nimport { MapDetailsToolComponent } from './map-details-tool/map-details-tool.component';\nimport { MapLegendToolComponent } from './map-legend/map-legend-tool.component';\nimport { MapProximityToolComponent } from './map-proximity-tool/map-proximity-tool.component';\nimport { MapToolComponent } from './map-tool/map-tool.component';\nimport { MapToolsComponent } from './map-tools/map-tools.component';\n\n/**\n * @deprecated import the ImportExportToolComponent directly or INTEGRATION_MAP_DIRECTIVES for the set\n */\n@NgModule({\n  imports: [\n    AdvancedMapToolComponent,\n    MapProximityToolComponent,\n    MapToolComponent,\n    MapToolsComponent,\n    MapDetailsToolComponent,\n    MapLegendToolComponent\n  ],\n  exports: [\n    AdvancedMapToolComponent,\n    MapProximityToolComponent,\n    MapToolComponent,\n    MapToolsComponent,\n    MapDetailsToolComponent,\n    MapLegendToolComponent\n  ]\n})\nexport class IgoAppMapModule {\n  static forRoot(): ModuleWithProviders<IgoAppMapModule> {\n    return {\n      ngModule: IgoAppMapModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { FeatureStore, FeatureWithMeasure } from '@igo2/geo';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MeasureState {\n  /**\n   * Store that holds the measures\n   */\n  public store: FeatureStore<FeatureWithMeasure>;\n\n  constructor(private mapState: MapState) {\n    this.store = new FeatureStore<FeatureWithMeasure>([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.layers$.subscribe((layers) => {\n      if (\n        layers.filter((l) => l.id?.startsWith('igo-measures-')).length === 0\n      ) {\n        this.store.deleteMany(this.store.all());\n        this.mapState.map.ol\n          .getOverlays()\n          .getArray()\n          .filter((overlay) =>\n            (overlay as any).options.className.includes('igo-map-tooltip')\n          )\n          .map((overlay) => this.mapState.map.ol.removeOverlay(overlay));\n      }\n    });\n  }\n}\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  FeatureStore,\n  FeatureWithMeasure,\n  IgoMap,\n  MeasurerComponent\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { MeasureState } from '../measure.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'measurer',\n  title: 'igo.integration.tools.measurer',\n  icon: 'square_foot'\n})\n@Component({\n  selector: 'igo-measurer-tool',\n  templateUrl: './measurer-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MeasurerComponent]\n})\nexport class MeasurerToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get store(): FeatureStore<FeatureWithMeasure> {\n    return this.measureState.store;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private measureState: MeasureState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n","import { NgModule } from '@angular/core';\n\nimport { MeasurerToolComponent } from './measurer-tool.component';\n\n/**\n * @deprecated import the MeasurerToolComponent directly\n */\n@NgModule({\n  imports: [MeasurerToolComponent],\n  exports: [MeasurerToolComponent]\n})\nexport class IgoAppMeasurerToolModule {}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, PrintComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'print',\n  title: 'igo.integration.tools.print',\n  icon: 'print'\n})\n@Component({\n  selector: 'igo-print-tool',\n  templateUrl: './print-tool.component.html',\n  standalone: true,\n  imports: [PrintComponent]\n})\nexport class PrintToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(private mapState: MapState) {}\n}\n","<igo-print [map]=\"map\"></igo-print>\n","import { Injectable } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityStore,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions\n} from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  CommonVectorStyleOptions,\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureWorkspace,\n  OverlayStyleOptions,\n  SearchResult,\n  SearchSource,\n  SearchSourceService\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MapState } from '../map';\nimport { WorkspaceState } from '../workspace/workspace.state';\n\n/**\n * Define the FeatureMotion to apply when adding the SearchResult to the map as an overlay.\n */\nexport interface SearchFeatureMotion {\n  selected?: FeatureMotion;\n  focus?: FeatureMotion;\n}\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable()\nexport class SearchState {\n  public searchLayerStores: FeatureStore<Feature>[] = [];\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  /**\n   * Default feature motion are:\n   * on selection = FeatureMotion.Default and\n   * on focus = FeatureMotion.None\n   */\n  public featureMotion: SearchFeatureMotion = {\n    selected: FeatureMotion.Default,\n    focus: FeatureMotion.None\n  };\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject(\n    '|'\n  );\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private workspaceState: WorkspaceState,\n    private configService: ConfigService,\n    private mapState: MapState\n  ) {\n    const searchOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('searchOverlayStyle');\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get(\n      'searchResultsGeometryEnabled'\n    ) as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n\n    const wksSource = this.searchSourceService\n      .getSources()\n      .find((source) => source.getId() === 'workspace');\n    if (wksSource) {\n      this.workspaceState.store.entities$.subscribe((e) => {\n        const searchableWks = e.filter(\n          (fw) =>\n            fw instanceof FeatureWorkspace &&\n            fw.layer.options.workspace.searchIndexEnabled\n        );\n        this.searchSourceService.setWorkspaces(wksSource, searchableWks);\n      });\n    }\n    this.monitorLayerDeletion();\n  }\n\n  private monitorLayerDeletion() {\n    this.mapState.map.layers$.subscribe((layers) => {\n      this.searchLayerStores.forEach((store) => {\n        let layer = layers.find((l) => l.id === store.layer.id);\n        if (!layer) {\n          const index = this.searchLayerStores.indexOf(store);\n          this.searchLayerStores.splice(index, 1);\n        }\n      });\n    });\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({\n      filterClauseFunc\n    } as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","<div\n  *ngIf=\"(!store || store.stateView.empty) && (debouncedEmpty$ | async)\"\n  style=\"margin: 10px\"\n>\n  <section class=\"mat-typography\">\n    <h4>\n      <strong>{{\n        'igo.integration.searchResultsTool.noResults' | translate\n      }}</strong>\n    </h4>\n    <p>\n      <strong>{{\n        'igo.integration.searchResultsTool.doSearch' | translate\n      }}</strong>\n    </p>\n    <div\n      [innerHTML]=\"\n        'igo.integration.searchResultsTool.examples' | translate | sanitizeHtml\n      \"\n    ></div>\n  </section>\n</div>\n\n<igo-flexible\n  *ngIf=\"(debouncedEmpty$ | async) === false\"\n  #topPanel\n  initial=\"100%\"\n  initialMobile=\"100%\"\n  collapsed=\"calc(100% - 58px)\"\n  collapsedMobile=\"calc(100% - 58px)\"\n  expanded=\"60%\"\n  expandedMobile=\"60%\"\n  [state]=\"(feature$ | async) ? topPanelState : 'initial'\"\n>\n  <div class=\"igo-content\">\n    <igo-search-results\n      [store]=\"store\"\n      [showIcons]=\"showIcons\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      [settingsChange$]=\"settingsChange$\"\n      placeholder=\"false\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultSelect($event)\"\n      (resultUnfocus)=\"onResultUnfocus($event)\"\n      (resultMouseenter)=\"onResultFocus($event)\"\n      (resultMouseleave)=\"onResultUnfocus($event)\"\n      (moreResults)=\"onSearch($event)\"\n      [map]=\"map\"\n    >\n      <ng-template #igoSearchItemToolbar let-result=\"result\">\n        <igo-search-add-button\n          [map]=\"map\"\n          [store]=\"store\"\n          [stores]=\"stores\"\n          [layer]=\"result\"\n          [saveSearchResultInLayer]=\"saveSearchResultInLayer\"\n        >\n        </igo-search-add-button>\n      </ng-template>\n    </igo-search-results>\n  </div>\n\n  <div igoFlexibleFill class=\"igo-content\">\n    <igo-panel\n      [title]=\"featureTitle\"\n      *ngIf=\"feature$ | async\"\n      (click)=\"toggleTopPanel($event)\"\n      [cursorPointer]=\"true\"\n    >\n      <button\n        mat-icon-button\n        panelLeftButton\n        class=\"igo-icon-button\"\n        (click)=\"toggleTopPanel()\"\n      >\n        <mat-icon>{{\n          (topPanelState$ | async) === 'collapsed'\n            ? 'arrow_upward'\n            : 'arrow_downward'\n        }}</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"feature.geometry\"\n        mat-icon-button\n        panelRightButton\n        class=\"igo-icon-button\"\n        [matTooltip]=\"\n          ((isSelectedResultOutOfView$ | async)\n            ? 'igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView'\n            : 'igo.integration.searchResultsTool.zoomOnFeatureTooltip'\n          ) | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"zoomToFeatureExtent()\"\n      >\n        <mat-icon\n          aria-hidden=\"false\"\n          [matBadge]=\"(isSelectedResultOutOfView$ | async) ? '!' : ''\"\n          matBadgeColor=\"accent\"\n          matBadgeSize=\"small\"\n          [matBadgeHidden]=\"(isSelectedResultOutOfView$ | async) === false\"\n          >zoom_in</mat-icon\n        >\n      </button>\n\n      <igo-feature-details\n        igoFeatureDetailsDirective\n        [feature]=\"feature$ | async\"\n        [map]=\"map\"\n        [toolbox]=\"toolState.toolbox\"\n        (routingEvent)=\"getRoute()\"\n      >\n      </igo-feature-details>\n    </igo-panel>\n  </div>\n</igo-flexible>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { EntityState, EntityStore, getEntityTitle } from '@igo2/common/entity';\nimport { FlexibleComponent, FlexibleState } from '@igo2/common/flexible';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  FEATURE,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  FeatureStore,\n  IgoMap,\n  Research,\n  SearchResult,\n  SearchResultAddButtonComponent,\n  SearchResultsComponent,\n  computeOlFeaturesExtent,\n  featureFromOl,\n  featureToOl,\n  featuresAreOutOfView,\n  featuresAreTooDeepInView,\n  getCommonVectorSelectedStyle,\n  getCommonVectorStyle,\n  moveToOlFeatures,\n  roundCoordTo\n} from '@igo2/geo';\n\nimport olFeature from 'ol/Feature';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olPoint from 'ol/geom/Point';\nimport * as olProj from 'ol/proj';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { DirectionState } from '../../directions/directions.state';\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { SearchState } from '../search.state';\n\n/**\n * Tool to browse the search results\n */\n@ToolComponent({\n  name: 'searchResults',\n  title: 'igo.integration.tools.searchResults',\n  icon: 'search'\n})\n@Component({\n  selector: 'igo-search-results-tool',\n  templateUrl: './search-results-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    FlexibleComponent,\n    SearchResultsComponent,\n    SearchResultAddButtonComponent,\n    PanelComponent,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatBadgeModule,\n    FeatureDetailsComponent,\n    AsyncPipe,\n    IgoLanguageModule,\n    SanitizeHtmlPipe\n  ]\n})\nexport class SearchResultsToolComponent implements OnInit, OnDestroy {\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean = true;\n\n  /**\n   * Determine the top panel default state\n   */\n  @Input() topPanelStateDefault: string = 'expanded';\n\n  private hasFeatureEmphasisOnSelection: boolean = false;\n  public saveSearchResultInLayer: boolean = false;\n\n  private showResultsGeometries$$: Subscription;\n  private getRoute$$: Subscription;\n  private shownResultsGeometries: Feature[] = [];\n  private shownResultsEmphasisGeometries: Feature[] = [];\n  private focusedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n  public isSelectedResultOutOfView$ = new BehaviorSubject(false);\n  private isSelectedResultOutOfView$$: Subscription;\n  private abstractFocusedResult: Feature;\n  private abstractSelectedResult: Feature;\n\n  public debouncedEmpty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private debouncedEmpty$$: Subscription;\n\n  /**\n   * Store holding the search results\n   * @internal\n   */\n  get store(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  /**\n   * Map to display the results on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get featureTitle(): string {\n    return this.feature ? getEntityTitle(this.feature) : undefined;\n  }\n\n  get feature$(): Observable<Feature> {\n    return this.store.stateView\n      .firstBy$((e) => e.state.focused)\n      .pipe(\n        map(\n          (element) =>\n            (this.feature = element\n              ? (element.entity.data as Feature)\n              : undefined)\n        )\n      );\n  }\n\n  public feature: Feature;\n\n  public term = '';\n  private searchTerm$$: Subscription;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  public topPanelState$ = new BehaviorSubject<FlexibleState>('initial');\n  private topPanelState$$: Subscription;\n\n  @Input()\n  set topPanelState(value: FlexibleState) {\n    this.topPanelState$.next(value);\n  }\n  get topPanelState(): FlexibleState {\n    return this.topPanelState$.value;\n  }\n\n  get termSplitter(): string {\n    return this.searchState.searchTermSplitter$.value;\n  }\n\n  private format = new olFormatGeoJSON();\n\n  get stores(): FeatureStore<Feature>[] {\n    return this.searchState.searchLayerStores;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private searchState: SearchState,\n    private elRef: ElementRef,\n    public toolState: ToolState,\n    private directionState: DirectionState,\n    configService: ConfigService\n  ) {\n    this.hasFeatureEmphasisOnSelection = configService.getConfig(\n      'hasFeatureEmphasisOnSelection'\n    );\n    this.saveSearchResultInLayer = configService.getConfig(\n      'saveSearchResultInLayer'\n    );\n  }\n\n  ngOnInit() {\n    this.searchTerm$$ = this.searchState.searchTerm$.subscribe(\n      (searchTerm: string) => {\n        if (\n          searchTerm !== undefined &&\n          searchTerm !== null &&\n          searchTerm !== ''\n        ) {\n          this.term = searchTerm;\n          this.debouncedEmpty$.next(false);\n        } else if (searchTerm === '') {\n          this.debouncedEmpty$.next(true);\n        }\n      }\n    );\n\n    for (const res of this.store.stateView.all$().value) {\n      if (this.store.state.get(res.entity).selected === true) {\n        this.topPanelState = 'expanded';\n      }\n    }\n\n    this.searchState.searchSettingsChange$.subscribe(() => {\n      this.settingsChange$.next(true);\n    });\n\n    this.topPanelState$$ = this.topPanelState$.subscribe(() => {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (selected) {\n        setTimeout(() => {\n          // To be sure the flexible component has been displayed yet\n          if (!this.isScrolledIntoView(igoList, selected)) {\n            this.adjustTopPanel(igoList, selected);\n          }\n        }, FlexibleComponent.transitionTime + 50);\n      }\n    });\n\n    if (this.hasFeatureEmphasisOnSelection) {\n      if (!this.searchState.focusedOrResolution$$) {\n        this.searchState.focusedOrResolution$$ = combineLatest([\n          this.focusedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'focused')\n        );\n      }\n\n      if (!this.searchState.selectedOrResolution$$) {\n        this.searchState.selectedOrResolution$$ = combineLatest([\n          this.searchState.selectedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'selected')\n        );\n      }\n    }\n    this.monitorResultOutOfView();\n\n    this.showResultsGeometries$$ = combineLatest([\n      this.searchState.searchResultsGeometryEnabled$,\n      this.store.stateView.all$(),\n      this.focusedResult$,\n      this.searchState.selectedResult$,\n      this.searchState.searchTerm$,\n      this.map.viewController.resolution$\n    ]).subscribe(\n      (\n        bunch: [\n          boolean,\n          { entity: SearchResult; state: EntityState }[],\n          SearchResult,\n          SearchResult,\n          string,\n          number\n        ]\n      ) => {\n        const searchResultsGeometryEnabled = bunch[0];\n        const searchResults = bunch[1];\n\n        if (this.hasFeatureEmphasisOnSelection) {\n          this.clearFeatureEmphasis('shown');\n        }\n        this.shownResultsGeometries.map((result) =>\n          this.map.queryResultsOverlay.removeFeature(result)\n        );\n        const featureToHandleGeom = searchResults.filter(\n          (result) =>\n            result.entity.meta.dataType === FEATURE &&\n            result.entity.data.geometry &&\n            !result.state.selected &&\n            !result.state.focused\n        );\n\n        featureToHandleGeom.map((result) => {\n          if (searchResultsGeometryEnabled) {\n            result.entity.data.meta.style = getCommonVectorStyle(\n              Object.assign(\n                {},\n                {\n                  feature: result.entity.data as Feature | olFeature<OlGeometry>\n                },\n                this.searchState.searchOverlayStyle,\n                result.entity.style?.base ? result.entity.style.base : {}\n              )\n            );\n            this.shownResultsGeometries.push(result.entity.data as Feature);\n            this.map.queryResultsOverlay.addFeature(\n              result.entity.data as Feature,\n              FeatureMotion.None\n            );\n            if (this.hasFeatureEmphasisOnSelection) {\n              this.buildResultEmphasis(\n                result.entity as SearchResult<Feature>,\n                'shown'\n              );\n            }\n          }\n        });\n      }\n    );\n\n    this.debouncedEmpty$$ = this.store.stateView.empty$\n      .pipe(debounceTime(1500))\n      .subscribe((empty) => this.debouncedEmpty$.next(empty));\n  }\n\n  private monitorResultOutOfView() {\n    this.isSelectedResultOutOfView$$ = combineLatest([\n      this.map.viewController.state$,\n      this.searchState.selectedResult$\n    ])\n      .pipe(debounceTime(100))\n      .subscribe((bunch) => {\n        const selectedResult = bunch[1] as SearchResult<Feature>;\n        if (!selectedResult) {\n          this.isSelectedResultOutOfView$.next(false);\n          return;\n        }\n        if (selectedResult.data.geometry) {\n          const selectedOlFeature = featureToOl(\n            selectedResult.data,\n            this.map.projection\n          );\n          const selectedOlFeatureExtent = computeOlFeaturesExtent(\n            [selectedOlFeature],\n            this.map.viewController.getOlProjection()\n          );\n          this.isSelectedResultOutOfView$.next(\n            featuresAreOutOfView(this.map.getExtent(), selectedOlFeatureExtent)\n          );\n        }\n      });\n  }\n\n  private buildResultEmphasis(\n    result: SearchResult<Feature>,\n    trigger: 'selected' | 'focused' | 'shown' | undefined\n  ) {\n    if (trigger !== 'shown') {\n      this.clearFeatureEmphasis(trigger);\n    }\n    if (!result || !result.data.geometry) {\n      return;\n    }\n    const myOlFeature = featureToOl(result.data, this.map.projection);\n    const olGeometry = myOlFeature.getGeometry();\n    if (\n      featuresAreTooDeepInView(\n        this.map.viewController,\n        olGeometry.getExtent() as [number, number, number, number],\n        0.0025\n      )\n    ) {\n      const extent = olGeometry.getExtent();\n      const x = extent[0] + (extent[2] - extent[0]) / 2;\n      const y = extent[1] + (extent[3] - extent[1]) / 2;\n      const feature1 = new olFeature({\n        name: `${trigger}AbstractResult'`,\n        geometry: new olPoint([x, y])\n      });\n      const abstractResult = featureFromOl(feature1, this.map.projection);\n\n      let computedStyle;\n      let zIndexOffset = 0;\n\n      switch (trigger) {\n        case 'focused':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleFocus,\n              result.style?.focus ? result.style.focus : {}\n            )\n          );\n          zIndexOffset = 2;\n          break;\n        case 'shown':\n          computedStyle = getCommonVectorStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyle,\n              result.style?.base ? result.style.base : {}\n            )\n          );\n          break;\n        case 'selected':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleSelection,\n              result.style?.selection ? result.style.selection : {}\n            )\n          );\n          zIndexOffset = 1;\n          break;\n      }\n      abstractResult.meta.style = computedStyle;\n      abstractResult.meta.style.setZIndex(2000 + zIndexOffset);\n      this.map.searchResultsOverlay.addFeature(\n        abstractResult,\n        this.searchState.featureMotion.focus\n      );\n      if (trigger === 'focused') {\n        this.abstractFocusedResult = abstractResult;\n      }\n      if (trigger === 'selected') {\n        this.abstractSelectedResult = abstractResult;\n      }\n      if (trigger === 'shown') {\n        this.shownResultsEmphasisGeometries.push(abstractResult);\n      }\n    } else {\n      this.clearFeatureEmphasis(trigger);\n    }\n  }\n\n  private clearFeatureEmphasis(trigger: 'selected' | 'focused' | 'shown') {\n    if (trigger === 'focused' && this.abstractFocusedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult);\n      this.abstractFocusedResult = undefined;\n    }\n    if (trigger === 'selected' && this.abstractSelectedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult);\n      this.abstractSelectedResult = undefined;\n    }\n    if (trigger === 'shown') {\n      this.shownResultsEmphasisGeometries.map((shownResult) =>\n        this.map.searchResultsOverlay.removeFeature(shownResult)\n      );\n      this.shownResultsEmphasisGeometries = [];\n    }\n  }\n\n  ngOnDestroy() {\n    this.topPanelState$$.unsubscribe();\n    this.searchTerm$$.unsubscribe();\n    if (this.isSelectedResultOutOfView$$) {\n      this.isSelectedResultOutOfView$$.unsubscribe();\n    }\n    if (this.showResultsGeometries$$) {\n      this.showResultsGeometries$$.unsubscribe();\n    }\n    if (this.getRoute$$) {\n      this.getRoute$$.unsubscribe();\n    }\n    if (this.debouncedEmpty$$) {\n      this.debouncedEmpty$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.focusedResult$.next(result);\n    if (result.meta.dataType === FEATURE && result.data.geometry) {\n      result.data.meta.style = getCommonVectorSelectedStyle(\n        Object.assign(\n          {},\n          { feature: result.data as Feature | olFeature<OlGeometry> },\n          this.searchState.searchOverlayStyleFocus,\n          result.style?.focus ? result.style.focus : {}\n        )\n      );\n\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        feature.setStyle(result.data.meta.style);\n        return;\n      }\n      this.map.searchResultsOverlay.addFeature(\n        result.data as Feature,\n        this.searchState.featureMotion.focus\n      );\n    }\n  }\n\n  onResultUnfocus(result: SearchResult) {\n    this.focusedResult$.next(undefined);\n    if (result.meta.dataType !== FEATURE) {\n      return;\n    }\n\n    if (this.store.state.get(result).selected === true) {\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        const style = getCommonVectorSelectedStyle(\n          Object.assign(\n            {},\n            { feature: result.data as Feature | olFeature<OlGeometry> },\n            this.searchState.searchOverlayStyleFocus,\n            result.style?.focus ? result.style.focus : {}\n          )\n        );\n        feature.setStyle(style);\n      }\n      return;\n    }\n    this.map.searchResultsOverlay.removeFeature(result.data as Feature);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being selected\n   * @internal\n   * @param result A search result that could be a feature or some layer options\n   */\n  onResultSelect(result: SearchResult) {\n    this.map.searchResultsOverlay.dataSource.ol.clear();\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.selected);\n    this.searchState.setSelectedResult(result);\n\n    if (this.topPanelState === 'initial') {\n      if (this.topPanelStateDefault !== 'collapsed') {\n        this.topPanelState = 'expanded';\n      } else {\n        this.topPanelState = 'collapsed';\n      }\n    }\n\n    if (this.topPanelState === 'expanded') {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (!this.isScrolledIntoView(igoList, selected)) {\n        this.adjustTopPanel(igoList, selected);\n      }\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.store.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n\n    this.store.load(newResults);\n\n    for (const res of this.store.all()) {\n      if (\n        this.store.state.get(res).focused === true &&\n        this.store.state.get(res).selected !== true\n      ) {\n        this.store.state.update(res, { focused: false }, true);\n      }\n    }\n\n    setTimeout(() => {\n      const igoList = this.elRef.nativeElement.querySelector('igo-list');\n      let moreResults;\n      event.research.request.subscribe((source) => {\n        if (!source[0] || !source[0].source) {\n          moreResults = null;\n        } else if (source[0].source.getId() === 'icherche') {\n          moreResults = igoList.querySelector('.icherche .moreResults');\n        } else if (source[0].source.getId() === 'ilayer') {\n          moreResults = igoList.querySelector('.ilayer .moreResults');\n        } else if (source[0].source.getId() === 'nominatim') {\n          moreResults = igoList.querySelector('.nominatim .moreResults');\n        } else {\n          moreResults = igoList.querySelector(\n            '.' + source[0].source.getId() + ' .moreResults'\n          );\n        }\n\n        if (\n          moreResults !== null &&\n          !this.isScrolledIntoView(igoList, moreResults)\n        ) {\n          igoList.scrollTop =\n            moreResults.offsetTop +\n            moreResults.offsetHeight -\n            igoList.clientHeight;\n        }\n      });\n    }, 250);\n  }\n\n  computeElementRef() {\n    const items = document.getElementsByTagName('igo-search-results-item');\n    const igoList =\n      this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\n    let selectedItem;\n    // eslint-disable-next-line\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].className.includes('igo-list-item-selected')) {\n        selectedItem = items[i];\n      }\n    }\n    return [igoList, selectedItem];\n  }\n\n  adjustTopPanel(elemSource, elem) {\n    if (!this.isScrolledIntoView(elemSource, elem)) {\n      elemSource.scrollTop =\n        elem.offsetTop +\n        elem.children[0].offsetHeight -\n        elemSource.clientHeight;\n    }\n  }\n\n  toggleTopPanel(event?: MouseEvent) {\n    if (event && (event.target as any)?.className !== 'igo-panel-title') {\n      return;\n    } else {\n      if (this.topPanelState === 'expanded') {\n        this.topPanelState = 'collapsed';\n      } else {\n        this.topPanelState = 'expanded';\n      }\n    }\n  }\n\n  zoomToFeatureExtent() {\n    if (this.feature.geometry) {\n      const localOlFeature = this.format.readFeature(this.feature, {\n        dataProjection: this.feature.projection,\n        featureProjection: this.map.projectionCode\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [localOlFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param result A search result that could be a feature\n   * @param motion A FeatureMotion to trigger when adding the searchresult to the map search overlay\n   */\n  private tryAddFeatureToMap(\n    result: SearchResult,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    if (result.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n    const feature = (result as SearchResult<Feature>).data;\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (!feature.geometry) {\n      return;\n    }\n\n    feature.meta.style = getCommonVectorSelectedStyle(\n      Object.assign(\n        {},\n        { feature },\n        this.searchState.searchOverlayStyleSelection,\n        result.style?.selection ? result.style.selection : {}\n      )\n    );\n\n    this.map.searchResultsOverlay.addFeature(feature, motion);\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const padding = 6;\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight + padding;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  getRoute() {\n    this.toolState.toolbox.activateTool('directions');\n    this.directionState.stopsStore.clearStops();\n    setTimeout(() => {\n      let routingCoordLoaded = false;\n      if (this.getRoute$$) {\n        this.getRoute$$.unsubscribe();\n      }\n      this.getRoute$$ =\n        this.directionState.stopsStore.storeInitialized$.subscribe(\n          (init: boolean) => {\n            if (\n              this.directionState.stopsStore.storeInitialized$.value &&\n              !routingCoordLoaded\n            ) {\n              routingCoordLoaded = true;\n              const stop = this.directionState.stopsStore\n                .all()\n                .find((e) => e.position === 1);\n              let coord;\n              if (this.feature.geometry) {\n                if (this.feature.geometry.type === 'Point') {\n                  coord = [\n                    this.feature.geometry.coordinates[0],\n                    this.feature.geometry.coordinates[1]\n                  ];\n                } else {\n                  const point = pointOnFeature(this.feature.geometry);\n                  coord = [\n                    point.geometry.coordinates[0],\n                    point.geometry.coordinates[1]\n                  ];\n                }\n              }\n              stop.text = this.featureTitle;\n              stop.coordinates = coord;\n              this.directionState.stopsStore.update(stop);\n              if (this.map.geolocationController.position$.value) {\n                const currentPos =\n                  this.map.geolocationController.position$.value;\n                const stop = this.directionState.stopsStore\n                  .all()\n                  .find((e) => e.position === 0);\n                const currentCoord = olProj.transform(\n                  currentPos.position,\n                  currentPos.projection,\n                  'EPSG:4326'\n                );\n                const coord: [number, number] = roundCoordTo(\n                  [currentCoord[0], currentCoord[1]],\n                  6\n                );\n                stop.text = coord.join(',');\n                stop.coordinates = coord;\n                this.directionState.stopsStore.update(stop);\n              }\n            }\n          }\n        );\n    }, 250);\n  }\n}\n","<igo-form\n  *ngIf=\"form$ | async as form\"\n  [form]=\"form\"\n  [formData]=\"data$ | async\"\n  (submitForm)=\"onSubmit($any($event))\"\n>\n  <div *ngIf=\"form.fields.length\" class=\"form-container\">\n    <igo-form-field\n      *ngFor=\"let field of form.fields\"\n      [field]=\"field\"\n    ></igo-form-field>\n  </div>\n\n  <div formButtons class=\"actions-container\">\n    <button\n      mat-stroked-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"clearForm()\"\n    >\n      {{ 'igo.integration.dataIssueReporterTool.reset.button' | translate }}\n    </button>\n    <button\n      mat-flat-button\n      type=\"submit\"\n      color=\"primary\"\n      [disabled]=\"submitDisabled\"\n    >\n      {{ 'igo.integration.dataIssueReporterTool.submit.button' | translate }}\n    </button>\n  </div>\n</igo-form>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\n\nimport { Form, FormService } from '@igo2/common/form';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { IgoMap } from '@igo2/geo';\n\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport type { Subscription } from 'rxjs';\n\nimport { MapState } from '../../map/map.state';\n\ninterface DataIssueReporterData {\n  geometry: object;\n  layer: string;\n  desc: string;\n  email: string;\n}\n\n@ToolComponent({\n  name: 'dataIssueReporter',\n  title: 'igo.integration.tools.dataIssueReporter',\n  icon: 'feedback'\n})\n@Component({\n  selector: 'igo-issue-reporter-tool',\n  templateUrl: './data-issue-reporter-tool.component.html',\n  styleUrls: ['./data-issue-reporter-tool.component.scss']\n})\nexport class DataIssueReporterToolComponent implements OnInit, OnDestroy {\n  /**\n   * Url to report the data issue. Use the Post protocol to send the form.\n   */\n  @Input() url: string;\n\n  /**\n   * Map to link to the form\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private mapState: MapState,\n    private formService: FormService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private httpClient: HttpClient\n  ) {}\n\n  ngOnInit() {\n    combineLatest([this.languageService.language$, this.map.layers$]).subscribe(\n      ([language, layers]) => {\n        const baseLayerOrShownInLayerList = layers\n          .filter((l) => l.baseLayer || l.showInLayerList)\n          .map((l) => {\n            return { value: `${l.title}-${l.id}`, title: l.title };\n          });\n        const fieldConfigs = [\n          {\n            name: 'geometry',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.geometry'\n            ),\n            type: 'geometry',\n            inputs: {\n              map: this.map,\n              geometryTypeField: true,\n              geometryType: 'Polygon',\n              drawGuideField: false,\n              drawGuide: 0,\n              drawGuidePlaceholder: this.languageService.translate.instant(\n                'igo.integration.dataIssueReporterTool.drawGuidePlaceholder'\n              ),\n              drawStyle: new olstyle.Style({\n                stroke: new olstyle.Stroke({\n                  color: [255, 0, 0, 1],\n                  width: 2\n                }),\n                fill: new olstyle.Fill({\n                  color: [255, 0, 0, 0.2]\n                }),\n                image: new olstyle.Circle({\n                  radius: 8,\n                  stroke: new olstyle.Stroke({\n                    color: [255, 0, 0, 1]\n                  }),\n                  fill: new olstyle.Fill({\n                    color: [255, 0, 0, 0.2]\n                  })\n                })\n              }),\n              overlayStyle: new olstyle.Style({\n                stroke: new olstyle.Stroke({\n                  color: [0, 255, 0, 1],\n                  width: 2\n                }),\n                fill: new olstyle.Fill({\n                  color: [0, 255, 0, 0.2]\n                }),\n                image: new olstyle.Circle({\n                  radius: 8,\n                  stroke: new olstyle.Stroke({\n                    color: [0, 255, 0, 1]\n                  }),\n                  fill: new olstyle.Fill({\n                    color: [0, 255, 0, 0.2]\n                  })\n                })\n              })\n            }\n          },\n          {\n            name: 'layer',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.layer'\n            ),\n            type: 'select',\n            options: {\n              cols: 2\n            },\n            inputs: {\n              choices: baseLayerOrShownInLayerList\n            }\n          },\n          {\n            name: 'desc',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.description'\n            ),\n            type: 'textarea',\n            options: {\n              validator: Validators.required\n            }\n          },\n          {\n            name: 'email',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.email'\n            ),\n            options: {\n              validator: Validators.email\n            }\n          }\n        ];\n\n        const fields = fieldConfigs.map((config) =>\n          this.formService.field(config)\n        );\n        const form = this.formService.form(fields, []);\n\n        this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n          this.submitDisabled = !form.control.valid;\n        });\n\n        this.form$.next(form);\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: DataIssueReporterData) {\n    const submitTitle = 'igo.integration.dataIssueReporterTool.submit.title';\n    if (!this.url) {\n      this.messageService.alert(\n        'igo.integration.dataIssueReporterTool.submit.setupMessage',\n        submitTitle\n      );\n      alert(JSON.stringify(data));\n    } else {\n      this.httpClient\n        .post<DataIssueReporterData>(this.url, data)\n        .subscribe(() => {\n          this.messageService.success(\n            'igo.integration.dataIssueReporterTool.submit.message',\n            submitTitle\n          );\n        });\n      this.clearForm();\n    }\n  }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Subscription, fromEvent } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoContextMenu]',\n  standalone: true\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('longpress', ['$event'])\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\n    let x;\n    let y;\n    if (e instanceof MouseEvent) {\n      x = e.x;\n      y = e.y;\n    } else if (e instanceof TouchEvent) {\n      x = e.touches[0].pageX;\n      y = e.touches[0].pageY;\n    }\n    if (!x || !y) {\n      return;\n    }\n\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\n\n/**\n * IgoLongPress trigger longpress event after a define duration.\n * This directive exist to patch the unavailable contextmenu event on iOS.\n * @param touchDuration touch duration in ms, default value is 400ms\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\n */\n@Directive({\n  selector: '[igoLongPress]',\n  standalone: true\n})\nexport class LongPressDirective {\n  private touchTimeout: any;\n  @Input() touchDuration: number = 400;\n  @Input() onlyIOS: boolean = true;\n  @Output() longpress = new EventEmitter();\n\n  constructor() {}\n\n  @HostListener('touchstart', ['$event'])\n  public touchstart(e: TouchEvent) {\n    if (e.touches.length > 1) {\n      this.touchEnd();\n      return;\n    }\n    this.touchTimeout = setTimeout(() => {\n      if (this.onlyIOS) {\n        if (userAgent.getOSName() === 'iOS') {\n          this.longpress.emit(e);\n        }\n      } else {\n        this.longpress.emit(e);\n      }\n    }, this.touchDuration);\n  }\n  @HostListener('touchmove')\n  @HostListener('touchcancel')\n  @HostListener('touchend')\n  public touchend() {\n    this.touchEnd();\n  }\n\n  private touchEnd() {\n    clearTimeout(this.touchTimeout);\n  }\n}\n","<app-doc-viewer\n  title=\"Search\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/search\" configFolder=\"environments\">\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      Pointer activated: {{ igoSearchPointerSummaryEnabled }} (F2\n      activate/deactivate the pointer location).\n    </span>\n    <igo-map-browser\n      #mapBrowser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      [igoContextMenu]=\"actionbarMenu\"\n      igoLongPress\n      igoSearchPointerSummary\n      [igoSearchPointerSummaryDelay]=\"500\"\n      [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n      (menuPosition)=\"onContextMenuOpen($event)\"\n    >\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Search\">\n      <igo-search-bar\n        [term]=\"term\"\n        (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n        [searchSettings]=\"true\"\n        [store]=\"searchStore\"\n        [termSplitter]=\"termSplitter\"\n        (searchTermChange)=\"onSearchTermChange($event)\"\n        (search)=\"onSearch($event)\"\n        (clearFeature)=\"removeFeatureFromMap()\"\n        (searchSettingsChange)=\"onSearchSettingsChange()\"\n        [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n        (reverseSearchCoordsFormatStatus)=\"\n          onReverseCoordsFormatStatusChange($event)\n        \"\n      >\n      </igo-search-bar>\n\n      <igo-search-results\n        [store]=\"searchStore\"\n        [term]=\"term\"\n        [termSplitter]=\"termSplitter\"\n        placeholder=\"false\"\n        [settingsChange$]=\"settingsChange$\"\n        (resultFocus)=\"onResultFocus($any($event))\"\n        (resultSelect)=\"onResultSelect($any($event))\"\n        (moreResults)=\"onSearch($event)\"\n      >\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button [map]=\"map\" [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n      </igo-search-results>\n    </igo-panel>\n\n    <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n      <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n    </igo-panel>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"false\"\n        [horizontal]=\"true\"\n        [mode]=\"actionBarMode\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgIf } from '@angular/common';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  ActionStore,\n  ActionbarComponent,\n  ActionbarMode\n} from '@igo2/common/action';\nimport { CONTEXT_MENU_DIRECTIVES } from '@igo2/common/context-menu';\nimport { EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  FEATURE,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  IgoSearchModule,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapService,\n  MapViewOptions,\n  Research,\n  SEARCH_RESULTS_DIRECTIVES,\n  SearchResult,\n  ZoomButtonComponent,\n  provideSearch,\n  withIChercheSource,\n  withWorkspaceSource\n} from '@igo2/geo';\nimport { SearchState } from '@igo2/integration';\n\nimport { Coordinate } from 'ol/coordinate';\nimport { Pixel } from 'ol/pixel';\nimport * as proj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    NgIf,\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    CONTEXT_MENU_DIRECTIVES,\n    IgoSearchModule,\n    PanelComponent,\n    SEARCH_RESULTS_DIRECTIVES,\n    ActionbarComponent,\n    FeatureDetailsComponent\n  ],\n  providers: [\n    provideSearch([withIChercheSource(), withWorkspaceSource()], {\n      analytics: true\n    }),\n    SearchState\n  ]\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store: ActionStore = new ActionStore([]);\n  actionBarMode = ActionbarMode.Context;\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map: IgoMap = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true })\n  mapBrowser: ElementRef;\n\n  public lonlat: Coordinate;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n  public igoReverseSearchCoordsFormatEnabled: boolean;\n\n  constructor(\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer) => this.map.addLayer(layer));\n\n    this.igoReverseSearchCoordsFormatEnabled =\n      Boolean(this.storageService.get('reverseSearchCoordsFormatEnabled')) ||\n      false;\n  }\n\n  onPointerSummaryStatusChange(value: boolean): void {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term?: string): void {\n    this.term = term;\n    this.searchState.setSearchTerm(term);\n    const termWithoutHashtag: string = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }): void {\n    const results: SearchResult[] = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults: SearchResult[] = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onReverseCoordsFormatStatusChange(value: boolean): void {\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\n    this.igoReverseSearchCoordsFormatEnabled = value;\n  }\n\n  onSearchSettingsChange(): void {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult<Feature>): void {\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.focus);\n    this.selectedFeature = result.data;\n  }\n  /**\n   * Try to add a feature to the map when it's being selected\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultSelect(result: SearchResult<Feature>): void {\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.selected);\n    this.selectedFeature = result.data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(\n    layer: SearchResult<Feature>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ): void | undefined {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures([layer.data], motion);\n  }\n\n  ngOnInit(): void {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: () => this.searchCoordinate(this.lonlat)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: () => this.openGoogleMaps(this.lonlat)\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: () => this.openGoogleStreetView(this.lonlat)\n      }\n    ]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap(): void {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }): void {\n    const position: Pixel = this.mapPosition(event);\n    const coord: Coordinate = this.mapService\n      .getMap()\n      .ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projectionCode;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }): Pixel {\n    const contextmenuPoint: { x: number; y: number } = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position: Pixel = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  searchCoordinate(lonlat: Coordinate): void {\n    this.searchStore.clear();\n    this.term = !this.igoReverseSearchCoordsFormatEnabled\n      ? lonlat.map((c: number) => c.toFixed(6)).join(', ')\n      : lonlat\n          .reverse()\n          .map((c: number) => c.toFixed(6))\n          .join(', ');\n  }\n\n  openGoogleMaps(lonlat: Coordinate): void {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\n  }\n\n  openGoogleStreetView(lonlat: Coordinate): void {\n    window.open(GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1]));\n  }\n}\n","<app-doc-viewer\n  title=\"Simple Map\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/simple-map\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoPointerPosition\n      [pointerPositionDelay]=\"pointerCoordDelay\"\n      (pointerPositionCoord)=\"onPointerMove($event)\"\n    >\n      <igo-info-section\n        [infoContent]=\"pointerCoord?.toString()\"\n      ></igo-info-section>\n      <div class=\"map-actions --vertical --top --right\">\n        <div class=\"spinner-spacer\"></div>\n        <igo-rotation-button\n          class=\"mat-elevation-z2\"\n          [showIfNoRotation]=\"true\"\n          [map]=\"map\"\n          color=\"primary\"\n        ></igo-rotation-button>\n      </div>\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-home-extent-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-home-extent-button>\n        <igo-wake-lock-button></igo-wake-lock-button>\n        <igo-geolocate-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-geolocate-button>\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n    <p *ngIf=\"!isTouchScreen\">{{ pointerCoord }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgIf } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\nimport {\n  DataSourceService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MAP_DIRECTIVES, NgIf]\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord: [number, number];\n  public pointerCoordDelay: number = 0;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            visible: true,\n            baseLayer: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  onPointerMove(event: [number, number]): void {\n    this.pointerCoord = event;\n  }\n}\n","<app-doc-viewer\n  title=\"Spatial Filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/spatial-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          [map]=\"map\"\n          [view]=\"view\"\n          igoOverlay\n          igoQuery\n          [queryFeatures]=\"true\"\n        >\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel class=\"w-100\">\n            <igo-spatial-filter-type\n              [store]=\"spatialListStore\"\n              [selectedQueryType]=\"queryType\"\n              [zone]=\"zone\"\n              [layers]=\"activeLayers\"\n              (eventType)=\"getOutputType($event)\"\n              (eventQueryType)=\"getOutputQueryType($event)\"\n              (zoneChange)=\"onZoneChange($event)\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (bufferChange)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n            >\n            </igo-spatial-filter-type>\n\n            <igo-spatial-filter-item\n              [type]=\"type\"\n              [queryType]=\"queryType\"\n              [map]=\"map\"\n              [zone]=\"zone\"\n              [loading]=\"loading\"\n              [store]=\"$any(store)\"\n              [layers]=\"activeLayers\"\n              [allLayers]=\"layers\"\n              [thematicLength]=\"thematicLength\"\n              (radiusEvent)=\"buffer = $event\"\n              (bufferEvent)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n              (freehandControl)=\"freehandDrawIsActive = $event\"\n              (drawZoneEvent)=\"zone = $event\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (itemTypeChange)=\"itemType = $event\"\n              (thematicChange)=\"thematics = $event\"\n              (toggleSearch)=\"getOutputToggleSearch()\"\n              (clearButtonEvent)=\"clearMap()\"\n              (clearSearchEvent)=\"getOutputClearSearch()\"\n            >\n            </igo-spatial-filter-item>\n          </igo-panel>\n\n          <igo-panel class=\"w-100\">\n            <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n              <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n            </ng-container>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { EntityKey, EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  DataSourceService,\n  FEATURE_DETAILS_DIRECTIVES,\n  FILTER_DIRECTIVES,\n  Feature,\n  FeatureMotion,\n  IgoMap,\n  IgoQueryModule,\n  Layer,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  MeasureLengthUnit,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterService,\n  SpatialFilterThematic,\n  SpatialFilterType,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  featureToOl,\n  moveToOlFeatures\n} from '@igo2/geo';\n\nimport { Coordinate } from 'ol/coordinate';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport * as olstyle from 'ol/style';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport { take, takeUntil, tap } from 'rxjs/operators';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    IgoQueryModule,\n    PanelComponent,\n    FILTER_DIRECTIVES,\n    NgIf,\n    FEATURE_DETAILS_DIRECTIVES,\n    AsyncPipe\n  ]\n})\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer: number = 0;\n\n  public iterator: number = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format: olFormatGeoJSON = new olFormatGeoJSON();\n\n  public store: EntityStore = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading: boolean = false;\n\n  public thematicLength: number = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  ngOnInit(): void {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType): void {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType): void {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList(): void {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch(): void {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch(): void {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap(): void {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics(): void {\n    this.loading = true;\n    let zeroResults: boolean = true;\n    let thematics: SpatialFilterThematic[];\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic: SpatialFilterThematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint: EntityKey;\n              let idLinePoly: EntityKey;\n              features.forEach((feature: Feature) => {\n                if (feature.geometry.type === SpatialFilterType.Point) {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean): void {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean): void {\n    let i: number = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index: number = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index: number = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index: number = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates: Coordinate = features[0].geometry.coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: QueryableDataSource) => {\n          const olLayer: VectorLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id: EntityKey): void {\n    let i: number = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon: string = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer: Layer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          const ol: olSourceCluster = dataSource.ol;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer: Layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer: Layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon: string): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry\n      .getNamedSvgIcon(icon)\n      .subscribe((svgObj: SVGElement) => {\n        const xmlSerializer: XMLSerializer = new XMLSerializer();\n        svgObj.setAttribute('width', '30');\n        svgObj.setAttribute('height', '30');\n        svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n        svgObj.setAttribute('stroke', 'white');\n        const svg: string = xmlSerializer.serializeToString(svgObj);\n        style = new olstyle.Style({\n          image: new olstyle.Icon({\n            src: 'data:image/svg+xml;utf8,' + svg\n          })\n        });\n      });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id: EntityKey): void {\n    let i: number = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: QueryableDataSource) => {\n          const olLayer: Layer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          const ol = dataSource.ol as olSourceVector;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer: Layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer: Layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature: Feature): void {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projectionCode\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer: Layer): void {\n    for (const activeLayer of this.activeLayers) {\n      if (activeLayer.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  FILTER_DIRECTIVES,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  TimeFilterStyle,\n  TimeFilterType,\n  TimeFilterableDataSource,\n  TimeFilterableDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppTimeFilterComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe((dataSource: TimeFilterableDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Time filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/time-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Workspace\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/workspace\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\" class=\"m-b-16\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-workspace-selector\n      igoWorkspaceSelector\n      [store]=\"workspaceStore\"\n      [map]=\"map\"\n    >\n    </igo-workspace-selector>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-entity-table-paginator\n        *ngIf=\"$any(workspace).inResolutionRange$ | async\"\n        [store]=\"workspace.entityStore\"\n        [paginatorOptions]=\"paginatorOptions\"\n        [entitySortChange$]=\"entitySortChange$\"\n        (paginatorChange)=\"paginatorChange($event)\"\n      >\n      </igo-entity-table-paginator>\n    </ng-container>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-actionbar\n        *ngIf=\"workspace.actionStore\"\n        [store]=\"workspace.actionStore\"\n        [horizontal]=\"true\"\n        [withToggleButton]=\"true\"\n        [withTitle]=\"true\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <igo-entity-table\n        *ngIf=\"\n          workspace.entityStore &&\n          workspace.meta &&\n          workspace.meta.tableTemplate &&\n          ($any(workspace).inResolutionRange$ | async)\n        \"\n        class=\"table-compact table-centered\"\n        [paginator]=\"workspacePaginator\"\n        [scrollBehavior]=\"scrollBehavior\"\n        [store]=\"workspace.entityStore\"\n        [template]=\"workspace.meta.tableTemplate\"\n      >\n      </igo-entity-table>\n      <mat-card-content\n        *ngIf=\"($any(workspace).inResolutionRange$ | async) === false\"\n      >\n        No data available at this scale. Please zoom in.\n      </mat-card-content>\n\n      <igo-workspace-widget-outlet\n        [workspace]=\"workspace\"\n      ></igo-workspace-widget-outlet>\n    </ng-container>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppCatalogComponent } from './catalog/catalog.component';\nimport { AppDirectionsComponent } from './directions/directions.component';\nimport { AppDrawComponent } from './draw/draw.component';\nimport { AppFeatureComponent } from './feature/feature.component';\nimport { AppGeometryComponent } from './geometry/geometry.component';\nimport { AppHoverComponent } from './hover/hover.component';\nimport { AppImportExportComponent } from './import-export/import-export.component';\nimport { AppLayerComponent } from './layer/layer.component';\nimport { AppLegendComponent } from './legend/legend.component';\nimport { AppMeasureComponent } from './measure/measure.component';\nimport { AppOgcFilterComponent } from './ogc-filter/ogc-filter.component';\nimport { AppOverlayComponent } from './overlay/overlay.component';\nimport { AppPrintComponent } from './print/print.component';\nimport { AppQueryComponent } from './query/query.component';\nimport { AppSearchComponent } from './search/search.component';\nimport { AppSimpleMapComponent } from './simple-map/simple-map.component';\nimport { AppSpatialFilterComponent } from './spatial-filter/spatial-filter.component';\nimport { AppTimeFilterComponent } from './time-filter/time-filter.component';\nimport { AppWorkspaceComponent } from './workspace/workspace.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'activity', pathMatch: 'full' },\n  {\n    title: 'Simple map',\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  },\n  {\n    title: 'Layer',\n    path: 'layer',\n    component: AppLayerComponent\n  },\n  {\n    title: 'Legend',\n    path: 'legend',\n    component: AppLegendComponent\n  },\n  {\n    title: 'Overlay',\n    path: 'overlay',\n    component: AppOverlayComponent\n  },\n  {\n    title: 'Geometry',\n    path: 'geometry',\n    component: AppGeometryComponent\n  },\n  {\n    title: 'Feature',\n    path: 'feature',\n    component: AppFeatureComponent\n  },\n  {\n    title: 'Hover',\n    path: 'hover',\n    component: AppHoverComponent\n  },\n  {\n    title: 'Measure',\n    path: 'measure',\n    component: AppMeasureComponent\n  },\n  {\n    title: 'Draw',\n    path: 'draw',\n    component: AppDrawComponent\n  },\n  {\n    title: 'Query',\n    path: 'query',\n    component: AppQueryComponent\n  },\n  {\n    title: 'Catalog',\n    path: 'catalog',\n    component: AppCatalogComponent\n  },\n  {\n    title: 'Search',\n    path: 'search',\n    component: AppSearchComponent\n  },\n  {\n    title: 'Print',\n    path: 'print',\n    component: AppPrintComponent\n  },\n  {\n    title: 'Import/Export',\n    path: 'import-export',\n    component: AppImportExportComponent\n  },\n  {\n    title: 'Directions',\n    path: 'directions',\n    component: AppDirectionsComponent\n  },\n  {\n    title: 'Time Filter',\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  },\n  {\n    title: 'OGC Filter',\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  },\n  {\n    title: 'Spatial Filter',\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  },\n  {\n    title: 'Workspace',\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnInit } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatPaginator } from '@angular/material/paginator';\n\nimport { Action, ActionbarComponent, ActionbarMode } from '@igo2/common/action';\nimport {\n  EntityRecord,\n  EntityTableComponent,\n  EntityTablePaginatorComponent,\n  EntityTablePaginatorOptions,\n  EntityTableScrollBehavior\n} from '@igo2/common/entity';\nimport {\n  Workspace,\n  WorkspaceSelectorComponent,\n  WorkspaceStore,\n  WorkspaceWidgetOutletComponent\n} from '@igo2/common/workspace';\nimport {\n  DataSourceService,\n  IgoGeoWorkspaceModule,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WorkspaceSelectorDirective\n} from '@igo2/geo';\nimport { WorkspaceState } from '@igo2/integration';\n\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss'],\n  standalone: true,\n  imports: [\n    AsyncPipe,\n    DocViewerComponent,\n    ExampleViewerComponent,\n    EntityTableComponent,\n    ActionbarComponent,\n    EntityTablePaginatorComponent,\n    IgoGeoWorkspaceModule,\n    MAP_DIRECTIVES,\n    WorkspaceSelectorComponent,\n    WorkspaceSelectorDirective,\n    WorkspaceWidgetOutletComponent,\n    MatCardModule,\n    NgIf\n  ]\n})\nexport class AppWorkspaceComponent implements OnInit {\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode: ActionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior: EntityTableScrollBehavior =\n    EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity: Workspace =\n            record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The button triggers a tool (importExport) and this tool is not available in the igo2-lib demo.\n            // This is why it has been removed from the actions list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action: Action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n\n  paginatorChange(event: MatPaginator): void {\n    this.workspacePaginator = event;\n  }\n}\n","import { CatalogQueryFormatTypes, ICatalog, TooltipType } from '@igo2/geo';\nimport { EnvironmentOptions } from '@igo2/integration';\n\nexport const environment: EnvironmentOptions = {\n  production: true,\n  igo: {\n    directionsSources: {\n      osrm: {\n        name: 'OSRM Québec',\n        baseUrl: '/apis/itineraire/route/v1/',\n        profiles: [\n          {\n            name: 'driving'\n          },\n          {\n            name: 'forestier',\n            authorization: {\n              url: '/apis/igo2/user/igo',\n              property: 'hasOsrmPrivateAccess'\n            }\n          }\n        ]\n      }\n    },\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def: '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      tokenKey: 'testIgo2Lib',\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true,\n      activateInteractiveTour: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            json: ['stations_meteoroutieres', 'histo_stations_meteoroutieres']\n          } as CatalogQueryFormatTypes,\n          queryHtmlTarget: 'iframe',\n          count: 30\n        } as ICatalog,\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n          tooltipType: TooltipType.ABSTRACT\n        }\n      ]\n    },\n    monitoring: {\n      provider: 'sentry',\n      dsn: 'https://examplePublicKey@o0.ingest.sentry.io/0',\n      identifyUser: true\n    },\n    searchSources: {\n      storedqueriesreverse: { enabled: false },\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        },\n        showAdvancedSettings: true\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import {\n  HttpErrorResponse,\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(private messageService: MessageService) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const interceptError = originalReq.headers.get('interceptError');\n    const req = originalReq.clone({\n      headers: originalReq.headers.delete('interceptError')\n    });\n    if (interceptError === 'false') {\n      return next.handle(req);\n    }\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError((error) => this.handleError(error, errorContainer)),\n      finalize(() => {\n        const httpError = errorContainer.httpError;\n        if (!httpError) {\n          return;\n        }\n\n        if (httpError.error.toDisplay) {\n          this.handleCaughtError(httpError);\n        } else if (!httpError.error.caught) {\n          this.handleUncaughtError(httpError);\n        }\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error?.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    this.messageService.error(httpError.error.message, httpError.error.title, {\n      progressBar: false\n    });\n  }\n\n  private handleUncaughtError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    this.messageService.error(\n      'igo.core.errors.uncaught.message',\n      'igo.core.errors.uncaught.title',\n      {\n        progressBar: false\n      }\n    );\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport {\n  ModuleWithProviders,\n  NgModule,\n  Optional,\n  SkipSelf\n} from '@angular/core';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { IgoActivityModule } from '@igo2/core/activity';\nimport { ConfigOptions, provideConfig } from '@igo2/core/config';\nimport { IgoLanguageModule, provideTranslation } from '@igo2/core/language';\nimport { provideMessage } from '@igo2/core/message';\nimport { IgoErrorModule } from '@igo2/core/request';\n\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 2,\n  objectStoresMeta: [\n    {\n      store: 'geoData',\n      storeConfig: { keyPath: 'url', autoIncrement: false },\n      storeSchema: [\n        { name: 'regionID', keypath: 'regionID', options: { unique: false } }\n      ]\n    },\n    {\n      store: 'layerData',\n      storeConfig: { keyPath: 'layerId', autoIncrement: false },\n      storeSchema: [\n        {\n          name: 'layerOptions',\n          keypath: 'layerOptions',\n          options: { unique: false }\n        },\n        {\n          name: 'sourceOptions',\n          keypath: 'sourceOptions',\n          options: { unique: false }\n        }\n      ]\n    }\n  ]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  providers: [provideMessage()],\n  declarations: [],\n  exports: [IgoActivityModule, IgoErrorModule, IgoLanguageModule]\n})\nexport class IgoCoreModule {\n  static forRoot(\n    options: ConfigOptions = {}\n  ): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: [provideConfig(options), provideTranslation()]\n    };\n  }\n\n  constructor() {}\n}\n","import { Route, Routes } from '@angular/router';\n\nimport { routes as authRoutes } from './auth/auth.routing';\nimport { routes as commonRoutes } from './common/common.routing';\nimport { routes as contextRoutes } from './context/context.routing';\nimport { routes as coreRoutes } from './core/core.routing';\nimport { routes as geoRoutes } from './geo/geo.routing';\nimport { AppHomeComponent } from './pages/home/home.component';\n\nexport const routes: Routes = [\n  { title: 'Home', path: 'home', component: AppHomeComponent },\n  {\n    title: 'Auth',\n    path: 'auth',\n    loadChildren: () => import('./auth/auth.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Common',\n    path: 'common',\n    loadChildren: () => import('./common/common.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Context',\n    path: 'context',\n    loadChildren: () =>\n      import('./context/context.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Core',\n    path: 'core',\n    loadChildren: () => import('./core/core.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Geo',\n    path: 'geo',\n    loadChildren: () => import('./geo/geo.routing').then((m) => m.routes)\n  },\n  { path: '**', redirectTo: '/home' }\n];\n\nexport const ROUTES_CONFIG: Routes = [\n  { title: 'Home', path: 'home', redirectTo: '/home', pathMatch: 'full' },\n  {\n    title: 'Core',\n    path: 'core',\n    children: getRoutesConfig(coreRoutes)\n  },\n  {\n    title: 'Auth',\n    path: 'auth',\n    children: getRoutesConfig(authRoutes)\n  },\n  {\n    title: 'Common',\n    path: 'common',\n    children: getRoutesConfig(commonRoutes)\n  },\n  {\n    title: 'Geo',\n    path: 'geo',\n    children: getRoutesConfig(geoRoutes)\n  },\n  {\n    title: 'Context',\n    path: 'context',\n    children: getRoutesConfig(contextRoutes)\n  }\n];\n\nfunction getRoutesConfig(routes: Route[]): Route[] {\n  return routes\n    .filter((route) => route.title)\n    .sort((a, b) => (a.title as string).localeCompare(b.title as string));\n}\n","import { Component } from '@angular/core';\n\nimport {\n  IgoInteractiveTourModule,\n  InteractiveTourService\n} from '@igo2/common/interactive-tour';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, IgoInteractiveTourModule]\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<app-doc-viewer>\n  <div style=\"text-align: center\">\n    <h1 id=\"igo-title\">Welcome to IGO</h1>\n    <img class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\" />\n  </div>\n\n  <p>\n    <igo-interactive-tour\n      tourToStart=\"global\"\n      menuIsOpen=\"true\"\n      styleButton=\"raised\"\n    >\n    </igo-interactive-tour>\n  </p>\n\n  <p class=\"mat-body-1\">\n    IGO2 library contains many components and services that may benefit any web\n    application. <br />\n    IGO2 library is open source project using Angular, Angular Material and\n    OpenLayers.\n  </p>\n\n  <h3>IGO2 library is divided into several elements:</h3>\n  <ul class=\"mat-body-1\">\n    <li>\n      <b>&#64;igo2/utils</b> : Basic utilies without dependency (ex: base64,\n      clipboard, uuid)\n    </li>\n    <li>\n      <b>&#64;igo2/core</b> : Element affecting the core of the application (ex:\n      config, language, message, media, request)\n    </li>\n    <li>\n      <b>&#64;igo2/common</b> : Library containing reusable components (ex:\n      clickout, drag-drop, list, panel, spinner, table)\n    </li>\n    <li>\n      <b>&#64;igo2/auth</b> : Library grouping the authentication and security\n      module\n    </li>\n    <li>\n      <b>&#64;igo2/geo</b> : Library containing the geomatic components. Depends\n      on Openlayers.\n    </li>\n    <li>\n      <b>&#64;igo2/context</b> : Library of components uniting &#64;igo2/geo and\n      &#64;igo2/auth\n    </li>\n    <li><b>&#64;igo2/integration</b> : Library integrate basic components</li>\n  </ul>\n\n  <h2>Here are some links to help you start:</h2>\n  <ul>\n    <li>\n      <h2>\n        <a\n          target=\"_blank\"\n          rel=\"noopener\"\n          href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\"\n          >Installation</a\n        >\n      </h2>\n    </li>\n    <li>\n      <h2>\n        <a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\"\n          >Angular Documentation</a\n        >\n      </h2>\n    </li>\n  </ul>\n\n  <span class=\"mat-body-1\"\n    >*** Modules in <code>&#64;igo2/core</code> must be imported only once</span\n  >\n</app-doc-viewer>\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar mat-elevation-z6\">\n    <button mat-icon-button (click)=\"snav.toggle()\">\n      <mat-icon>menu</mat-icon>\n    </button>\n    <h1>{{ title }}</h1>\n    <h5 class=\"mat-subtitle-1 m-b-0\">{{ version.lib }}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container\n    class=\"example-sidenav-container\"\n    [style.marginTop.px]=\"mobileQuery.matches ? 48 : 0\"\n  >\n    <mat-sidenav\n      #snav\n      opened=\"true\"\n      [mode]=\"mobileQuery.matches ? 'over' : 'side'\"\n      [fixedInViewport]=\"mobileQuery.matches\"\n      fixedTopGap=\"48\"\n    >\n      <mat-accordion displayMode=\"flat\" multi>\n        <ng-container *ngFor=\"let routeConfig of routesConfig\">\n          <ng-container *ngIf=\"!routeConfig.children; else routeWithChildren\">\n            <mat-nav-list>\n              <a\n                mat-list-item\n                [routerLink]=\"routeConfig.path\"\n                [routerLinkActiveOptions]=\"{ exact: true }\"\n                routerLinkActive=\"active-link\"\n                class=\"p-h-24 m-t-8\"\n                >{{ routeConfig.title }}</a\n              >\n            </mat-nav-list>\n            <mat-divider></mat-divider>\n          </ng-container>\n          <ng-template #routeWithChildren>\n            <mat-expansion-panel expanded>\n              <mat-expansion-panel-header>\n                <mat-panel-title> {{ routeConfig.title }} </mat-panel-title>\n              </mat-expansion-panel-header>\n              <mat-nav-list>\n                <a\n                  *ngFor=\"let route of routeConfig.children\"\n                  mat-list-item\n                  [routerLink]=\"routeConfig.path + '/' + route.path\"\n                  routerLinkActive=\"active-link\"\n                  >{{ route.title }}</a\n                >\n              </mat-nav-list>\n            </mat-expansion-panel>\n\n            <mat-divider></mat-divider>\n          </ng-template>\n        </ng-container>\n      </mat-accordion>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n  </mat-sidenav-container>\n</div>\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport { DOCUMENT, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Inject,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport {\n  NavigationEnd,\n  Router,\n  RouterLink,\n  RouterLinkActive,\n  RouterOutlet\n} from '@angular/router';\n\nimport { version } from '@igo2/core/config';\nimport { DomUtils, userAgent } from '@igo2/utils';\n\nimport { delay, first } from 'rxjs';\n\nimport { ROUTES_CONFIG } from './app.routing';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss'],\n  standalone: true,\n  imports: [\n    NgFor,\n    NgIf,\n    MatExpansionModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatSidenavModule,\n    MatListModule,\n    RouterLink,\n    RouterLinkActive,\n    RouterOutlet\n  ]\n})\nexport class AppComponent implements OnInit, OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  routesConfig = ROUTES_CONFIG;\n\n  public title = 'IGO';\n  public version = version;\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    @Inject(DOCUMENT) private document: Document,\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private router: Router\n  ) {\n    this.mobileQuery = this.media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => this.changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnInit(): void {\n    this.handleSplashScreen();\n  }\n\n  private handleSplashScreen(): void {\n    this.router.events\n      .pipe(\n        first((events) => events instanceof NavigationEnd),\n        delay(300)\n      )\n      .subscribe(() => {\n        this._removeSplashScreen();\n      });\n  }\n\n  private _removeSplashScreen(): void {\n    const intro = this.document.getElementById('splash-screen');\n    if (!intro) {\n      return;\n    }\n    intro.classList.add('is-destroying');\n\n    const destroyingAnimationTime = 300;\n    const stylesheet = this.document.getElementById('splash-screen-stylesheet');\n\n    setTimeout(() => {\n      DomUtils.remove(intro);\n      DomUtils.remove(stylesheet);\n    }, destroyingAnimationTime);\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<=11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","import { provideHttpClient, withJsonpSupport } from '@angular/common/http';\nimport { enableProdMode, importProvidersFrom } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport {\n  MAT_TOOLTIP_DEFAULT_OPTIONS,\n  MatTooltipDefaultOptions\n} from '@angular/material/tooltip';\nimport {\n  BrowserModule,\n  HammerModule,\n  bootstrapApplication\n} from '@angular/platform-browser';\nimport { provideAnimations } from '@angular/platform-browser/animations';\nimport {\n  PreloadAllModules,\n  provideRouter,\n  withPreloading\n} from '@angular/router';\n\nimport { provideAuthentification } from '@igo2/auth';\nimport { provideIcon } from '@igo2/common/icon';\nimport { IgoCoreModule } from '@igo2/core';\nimport { provideConfig } from '@igo2/core/config';\nimport { provideTranslation } from '@igo2/core/language';\n\nimport { AppComponent } from './app/app.component';\nimport { routes } from './app/app.routing';\nimport { environment } from './environments/environment';\n\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\n  showDelay: 500,\n  hideDelay: 0,\n  touchendHideDelay: 0,\n  disableTooltipInteractivity: true\n};\n\nif (environment.production) {\n  enableProdMode();\n}\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    importProvidersFrom(\n      IgoCoreModule,\n      BrowserModule,\n      HammerModule,\n      MatButtonModule,\n      MatIconModule,\n      MatListModule,\n      MatSidenavModule,\n      MatToolbarModule\n    ),\n    provideHttpClient(withJsonpSupport()),\n    provideRouter(routes, withPreloading(PreloadAllModules)),\n    provideAnimations(),\n    provideConfig({\n      default: environment.igo\n    }),\n    provideTranslation(),\n    provideAuthentification(),\n    provideIcon(),\n    {\n      provide: MAT_FORM_FIELD_DEFAULT_OPTIONS,\n      useValue: { appearance: 'outline' }\n    },\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions }\n  ]\n}).catch((err) => console.log(err));\n","var map = {\n\t\"./af\": 85637,\n\t\"./af.js\": 85637,\n\t\"./ar\": 6777,\n\t\"./ar-dz\": 74508,\n\t\"./ar-dz.js\": 74508,\n\t\"./ar-kw\": 67504,\n\t\"./ar-kw.js\": 67504,\n\t\"./ar-ly\": 95373,\n\t\"./ar-ly.js\": 95373,\n\t\"./ar-ma\": 92412,\n\t\"./ar-ma.js\": 92412,\n\t\"./ar-ps\": 78823,\n\t\"./ar-ps.js\": 78823,\n\t\"./ar-sa\": 36670,\n\t\"./ar-sa.js\": 36670,\n\t\"./ar-tn\": 36448,\n\t\"./ar-tn.js\": 36448,\n\t\"./ar.js\": 6777,\n\t\"./az\": 23009,\n\t\"./az.js\": 23009,\n\t\"./be\": 28299,\n\t\"./be.js\": 28299,\n\t\"./bg\": 4685,\n\t\"./bg.js\": 4685,\n\t\"./bm\": 11171,\n\t\"./bm.js\": 11171,\n\t\"./bn\": 23590,\n\t\"./bn-bd\": 5841,\n\t\"./bn-bd.js\": 5841,\n\t\"./bn.js\": 23590,\n\t\"./bo\": 54309,\n\t\"./bo.js\": 54309,\n\t\"./br\": 54130,\n\t\"./br.js\": 54130,\n\t\"./bs\": 8033,\n\t\"./bs.js\": 8033,\n\t\"./ca\": 55294,\n\t\"./ca.js\": 55294,\n\t\"./cs\": 53028,\n\t\"./cs.js\": 53028,\n\t\"./cv\": 5807,\n\t\"./cv.js\": 5807,\n\t\"./cy\": 70342,\n\t\"./cy.js\": 70342,\n\t\"./da\": 38269,\n\t\"./da.js\": 38269,\n\t\"./de\": 11489,\n\t\"./de-at\": 42123,\n\t\"./de-at.js\": 42123,\n\t\"./de-ch\": 17757,\n\t\"./de-ch.js\": 17757,\n\t\"./de.js\": 11489,\n\t\"./dv\": 28152,\n\t\"./dv.js\": 28152,\n\t\"./el\": 7687,\n\t\"./el.js\": 7687,\n\t\"./en-au\": 46668,\n\t\"./en-au.js\": 46668,\n\t\"./en-ca\": 76798,\n\t\"./en-ca.js\": 76798,\n\t\"./en-gb\": 53615,\n\t\"./en-gb.js\": 53615,\n\t\"./en-ie\": 91364,\n\t\"./en-ie.js\": 91364,\n\t\"./en-il\": 79907,\n\t\"./en-il.js\": 79907,\n\t\"./en-in\": 70533,\n\t\"./en-in.js\": 70533,\n\t\"./en-nz\": 33190,\n\t\"./en-nz.js\": 33190,\n\t\"./en-sg\": 51096,\n\t\"./en-sg.js\": 51096,\n\t\"./eo\": 3962,\n\t\"./eo.js\": 3962,\n\t\"./es\": 37726,\n\t\"./es-do\": 65010,\n\t\"./es-do.js\": 65010,\n\t\"./es-mx\": 63654,\n\t\"./es-mx.js\": 63654,\n\t\"./es-us\": 59043,\n\t\"./es-us.js\": 59043,\n\t\"./es.js\": 37726,\n\t\"./et\": 25343,\n\t\"./et.js\": 25343,\n\t\"./eu\": 90728,\n\t\"./eu.js\": 90728,\n\t\"./fa\": 60787,\n\t\"./fa.js\": 60787,\n\t\"./fi\": 71771,\n\t\"./fi.js\": 71771,\n\t\"./fil\": 45335,\n\t\"./fil.js\": 45335,\n\t\"./fo\": 69761,\n\t\"./fo.js\": 69761,\n\t\"./fr\": 1670,\n\t\"./fr-ca\": 28991,\n\t\"./fr-ca.js\": 28991,\n\t\"./fr-ch\": 97280,\n\t\"./fr-ch.js\": 97280,\n\t\"./fr.js\": 1670,\n\t\"./fy\": 24203,\n\t\"./fy.js\": 24203,\n\t\"./ga\": 69858,\n\t\"./ga.js\": 69858,\n\t\"./gd\": 38605,\n\t\"./gd.js\": 38605,\n\t\"./gl\": 27365,\n\t\"./gl.js\": 27365,\n\t\"./gom-deva\": 33896,\n\t\"./gom-deva.js\": 33896,\n\t\"./gom-latn\": 95587,\n\t\"./gom-latn.js\": 95587,\n\t\"./gu\": 97950,\n\t\"./gu.js\": 97950,\n\t\"./he\": 92029,\n\t\"./he.js\": 92029,\n\t\"./hi\": 51897,\n\t\"./hi.js\": 51897,\n\t\"./hr\": 29816,\n\t\"./hr.js\": 29816,\n\t\"./hu\": 22253,\n\t\"./hu.js\": 22253,\n\t\"./hy-am\": 28196,\n\t\"./hy-am.js\": 28196,\n\t\"./id\": 73688,\n\t\"./id.js\": 73688,\n\t\"./is\": 95474,\n\t\"./is.js\": 95474,\n\t\"./it\": 23099,\n\t\"./it-ch\": 45807,\n\t\"./it-ch.js\": 45807,\n\t\"./it.js\": 23099,\n\t\"./ja\": 19127,\n\t\"./ja.js\": 19127,\n\t\"./jv\": 30182,\n\t\"./jv.js\": 30182,\n\t\"./ka\": 10758,\n\t\"./ka.js\": 10758,\n\t\"./kk\": 93444,\n\t\"./kk.js\": 93444,\n\t\"./km\": 72034,\n\t\"./km.js\": 72034,\n\t\"./kn\": 46223,\n\t\"./kn.js\": 46223,\n\t\"./ko\": 83064,\n\t\"./ko.js\": 83064,\n\t\"./ku\": 8714,\n\t\"./ku-kmr\": 10961,\n\t\"./ku-kmr.js\": 10961,\n\t\"./ku.js\": 8714,\n\t\"./ky\": 12062,\n\t\"./ky.js\": 12062,\n\t\"./lb\": 84796,\n\t\"./lb.js\": 84796,\n\t\"./lo\": 19279,\n\t\"./lo.js\": 19279,\n\t\"./lt\": 106,\n\t\"./lt.js\": 106,\n\t\"./lv\": 11840,\n\t\"./lv.js\": 11840,\n\t\"./me\": 42240,\n\t\"./me.js\": 42240,\n\t\"./mi\": 13588,\n\t\"./mi.js\": 13588,\n\t\"./mk\": 15518,\n\t\"./mk.js\": 15518,\n\t\"./ml\": 37823,\n\t\"./ml.js\": 37823,\n\t\"./mn\": 98657,\n\t\"./mn.js\": 98657,\n\t\"./mr\": 61285,\n\t\"./mr.js\": 61285,\n\t\"./ms\": 43014,\n\t\"./ms-my\": 86253,\n\t\"./ms-my.js\": 86253,\n\t\"./ms.js\": 43014,\n\t\"./mt\": 20167,\n\t\"./mt.js\": 20167,\n\t\"./my\": 47940,\n\t\"./my.js\": 47940,\n\t\"./nb\": 50014,\n\t\"./nb.js\": 50014,\n\t\"./ne\": 49023,\n\t\"./ne.js\": 49023,\n\t\"./nl\": 34208,\n\t\"./nl-be\": 71412,\n\t\"./nl-be.js\": 71412,\n\t\"./nl.js\": 34208,\n\t\"./nn\": 81354,\n\t\"./nn.js\": 81354,\n\t\"./oc-lnc\": 40870,\n\t\"./oc-lnc.js\": 40870,\n\t\"./pa-in\": 80389,\n\t\"./pa-in.js\": 80389,\n\t\"./pl\": 7342,\n\t\"./pl.js\": 7342,\n\t\"./pt\": 34774,\n\t\"./pt-br\": 73003,\n\t\"./pt-br.js\": 73003,\n\t\"./pt.js\": 34774,\n\t\"./ro\": 85333,\n\t\"./ro.js\": 85333,\n\t\"./ru\": 73451,\n\t\"./ru.js\": 73451,\n\t\"./sd\": 43921,\n\t\"./sd.js\": 43921,\n\t\"./se\": 59682,\n\t\"./se.js\": 59682,\n\t\"./si\": 80582,\n\t\"./si.js\": 80582,\n\t\"./sk\": 4348,\n\t\"./sk.js\": 4348,\n\t\"./sl\": 95337,\n\t\"./sl.js\": 95337,\n\t\"./sq\": 39358,\n\t\"./sq.js\": 39358,\n\t\"./sr\": 50683,\n\t\"./sr-cyrl\": 69382,\n\t\"./sr-cyrl.js\": 69382,\n\t\"./sr.js\": 50683,\n\t\"./ss\": 51156,\n\t\"./ss.js\": 51156,\n\t\"./sv\": 29855,\n\t\"./sv.js\": 29855,\n\t\"./sw\": 18536,\n\t\"./sw.js\": 18536,\n\t\"./ta\": 15373,\n\t\"./ta.js\": 15373,\n\t\"./te\": 37809,\n\t\"./te.js\": 37809,\n\t\"./tet\": 61297,\n\t\"./tet.js\": 61297,\n\t\"./tg\": 92527,\n\t\"./tg.js\": 92527,\n\t\"./th\": 85862,\n\t\"./th.js\": 85862,\n\t\"./tk\": 79331,\n\t\"./tk.js\": 79331,\n\t\"./tl-ph\": 44387,\n\t\"./tl-ph.js\": 44387,\n\t\"./tlh\": 3592,\n\t\"./tlh.js\": 3592,\n\t\"./tr\": 79732,\n\t\"./tr.js\": 79732,\n\t\"./tzl\": 99570,\n\t\"./tzl.js\": 99570,\n\t\"./tzm\": 83553,\n\t\"./tzm-latn\": 7699,\n\t\"./tzm-latn.js\": 7699,\n\t\"./tzm.js\": 83553,\n\t\"./ug-cn\": 25674,\n\t\"./ug-cn.js\": 25674,\n\t\"./uk\": 69974,\n\t\"./uk.js\": 69974,\n\t\"./ur\": 45773,\n\t\"./ur.js\": 45773,\n\t\"./uz\": 357,\n\t\"./uz-latn\": 77135,\n\t\"./uz-latn.js\": 77135,\n\t\"./uz.js\": 357,\n\t\"./vi\": 20043,\n\t\"./vi.js\": 20043,\n\t\"./x-pseudo\": 40767,\n\t\"./x-pseudo.js\": 40767,\n\t\"./yo\": 80150,\n\t\"./yo.js\": 80150,\n\t\"./zh-cn\": 21828,\n\t\"./zh-cn.js\": 21828,\n\t\"./zh-hk\": 86644,\n\t\"./zh-hk.js\": 86644,\n\t\"./zh-mo\": 79305,\n\t\"./zh-mo.js\": 79305,\n\t\"./zh-tw\": 31860,\n\t\"./zh-tw.js\": 31860\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 35358;"],"x_google_ignoreList":[734]}