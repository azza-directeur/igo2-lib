{"version":3,"file":"main.2bc4ec3af0f0ff86.js","mappings":"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AC,KACAJ,KACA8yQ,KACAD,OAAgB,EAElBS,SAAkBC,UAAkB,EACpCC,MAAcxrG,MAAQyrG,MAAeC,QAAkB,EACvDC,SAAiB,EACjB37M,MAAc,CACZ/Y,QAASorM,KAAY4B,OACtB,EACD1yL,SAAkB,EAClB3+D,SAAuB,EACvBw/B,QACA,CACEr/B,QAAS64Q,KACT37M,SAAU,CAAEg1F,WAAY,YAE1B,CAAElyJ,QAAS84Q,KAA6B57M,SApCmB,CAC7D67M,UAAW,IACXC,UAAW,EACXC,kBAAmB,EACnBC,6BAA6B,OAkC5Bx5H,MAAOhmJ,IAAQ6iE,QAAQK,IAAIljE,wBCxE9B,IAAAwd,EAAA,CACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,kBACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,mBACA,sBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,WACA,cACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,iBACA,oBACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,iBACA,oBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,mBAIA,SAAAiiQ,EAAA77Q,GACA,IAAAqL,EAAAywQ,EAAA97Q,GACA,OAAA24Q,EAAAttQ,EACA,CACA,SAAAywQ,EAAA97Q,GACA,IAAA24Q,EAAAzpH,EAAAt1I,EAAA5Z,GAAA,CACA,IAAAimC,EAAA,IAAA9qB,MAAA,uBAAAnb,EAAA,KACA,MAAAimC,EAAAy/E,KAAA,mBACAz/E,CACA,CACA,OAAArsB,EAAA5Z,EACA,CACA67Q,EAAAn9Q,KAAA,WACA,OAAAD,OAAAC,KAAAkb,EACA,EACAiiQ,EAAA1yO,QAAA2yO,EACAC,GAAAC,QAAAH,EACAA,EAAAxwQ,GAAA","names":["TokenService","injector","options","tokenKey","constructor","this","config","get","ConfigService","getConfig","set","token","localStorage","setItem","remove","removeItem","getItem","decode","jwtDecode","isExpired","jwt","currentTime","Date","getTime","exp","i0","factory","ɵfac","providedIn","AuthService","http","tokenService","languageService","messageService","router","authenticate$","BehaviorSubject","undefined","logged$","redirectUrl","languageForce","anonymous","authOptions","hasAuthService","url","user","decodedToken","decodeToken","next","authenticated","subscribe","globalCacheBusterNotifier","login","username","password","myHeader","HttpHeaders","body","encodePassword","loginCall","loginWithToken","type","infosUser","typeConnection","loginAnonymous","of","refresh","post","pipe","tap","data","catchError","err","error","caught","logout","isAuthenticated","getToken","goToRedirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","patch","Base64","encode","logged","isAnonymous","isAdmin","headers","tokenDecoded","locale","setLanguage","alert","i1","i2","i3","i4","i5","i6","AuthStorageService","BaseStorage","authService","super","userIgo","preference","key","Object","keys","value","scope","StorageScope","LOCAL","clear","params","mergePreference","AuthInterceptor","refreshInProgress","trustHosts","hostsWithCredentials","hostsWithAuthByKey","push","window","location","hostname","hostsByKey","intercept","originalReq","withCredentials","handleHostsWithCredentials","req","clone","hostWithKey","handleHostsAuthByKey","handle","refreshToken","element","document","createElement","href","host","indexOf","authReq","sourceId","hashUser","Md5","hashStr","delete","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","split","urlWithKeyAdded","shift","paramsToKeep","filter","p","length","join","reqUrl","hostWithCredentials","RegExp","domainRegFilters","test","hostWithAuthByKey","keyProperty","keyValue","provideAuthentification","features","providers","provide","HTTP_INTERCEPTORS","useClass","multi","StorageService","feature","makeEnvironmentProviders","ActionbarMode","Dock","Overlay","Context","ActionStore","EntityStore","ctx_r2","color","disabled$","isObservable","action","icon","ctx_r3","title","_r5","ctx_r4","onClick","ActionbarItemComponent_mat_list_item_0_button_4_Template","ActionbarItemComponent_mat_list_item_0_span_5_Template","ctx_r0","withTooltip","tooltip$","ngClass$","withIcon","withTitle","_r8","ctx_r7","handler","ctx_r6","checkCondition$","ActionbarItemComponent_mat_list_item_1_mat_checkbox_4_Template","ctx_r1","ActionbarItemComponent","noDisplay$","ngClass$$","disabled$$","availability$$","checkCondition$$","tooltip$$","noDisplay$$","display$$","disabled","noDisplay","trigger","EventEmitter","ngOnInit","args","ngClass","updateNgClass","checkCondition","updateCheckCondition","tooltip","updateTooltip","availability","available","display","ngOnDestroy","unsubscribe","emit","assign","selectors","inputs","outputs","standalone","decls","vars","consts","template","rf","ctx","ActionbarItemComponent_mat_list_item_0_Template","ActionbarItemComponent_mat_list_item_1_Template","checkbox","NgIf","MatListModule","MatTooltipModule","NgClass","MatButtonModule","MatIconModule","MatCheckboxModule","AsyncPipe","IgoLanguageModule","IgoIconComponent","styles","changeDetection","_r6","ctx_r5","scrollUp","_r10","ctx_r9","onTriggerAction","toggleCollapseAction","store","view","empty","action_r13","_r15","$implicit","ctx_r14","ctx_r11","state","ActionbarComponent_mat_list_1_2_ng_template_0_Template","ctx_r8","all$","ActionbarComponent_mat_list_1_igo_actionbar_item_1_Template","ActionbarComponent_mat_list_1_2_Template","withToggleButton","collapsed","_r17","ctx_r16","scrollDown","action_r20","_r22","ctx_r21","ctx_r19","ActionbarComponent_div_3_ng_template_8_Template","_r18","iconColor","overlayClass","xPosition","yPosition","action_r24","_r26","ctx_r25","ctx_r23","ActionbarComponent_mat_card_4_ng_template_2_Template","ActionbarComponent","overlay","elRef","cdRef","mediaService","actionbarMode","id","watcher","heightCondition$","positionConditionTop$","positionConditionLow$","mode","horizontal","scrollActive","_overlayClass","isCollapsed","withTitleClass","withIconClass","horizontalClass","heightCondition","el","nativeElement","clientHeight","scrollHeight","positionConditionTop","scrollTop","positionConditionLow","isDesktop","getMedia","Media","Desktop","ngOnChanges","changes","currentValue","previousValue","destroy","EntityStoreWatcher","scrollBy","hostVars","hostBindings","ActionbarComponent_div_0_Template","ActionbarComponent_mat_list_1_Template","ActionbarComponent_div_2_Template","ActionbarComponent_div_3_Template","ActionbarComponent_mat_card_4_Template","NgFor","MatMenuModule","i7","MatCardModule","i8","i9","IgoBadgeIconDirective","igoMatBadgeIcon","html","updateHtml","matBadgeHidden","hidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","inverseColor","updateColor","igoMatBadgeInheritColor","inheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","querySelector","originalColor","style","alignItems","justifyContent","innerHTML","background","getComputedStyle","getPropertyValue","CollapseDirective","renderer","target","_target","_collapsed","collapseTarget","expandTarget","toggle","click","addClass","removeClass","CollapsibleComponent","_title","ngContentSelectors","_c0","$event","_r0","ConfirmDialogComponent","dialogRef","confirmMessage","titleKey","proccessKey","cancelKey","close","MatDialogTitle","MatDialogContent","MatDialogActions","ConfirmDialogService","dialog","open","message","_options","modeYesNo","disableClose","componentInstance","afterClosed","IgoConfirmDialogModule","forRoot","ngModule","imports","SanitizeHtmlPipe","_sanitizer","transform","v","bypassSecurityTrustHtml","pure","CustomHtmlComponent","_html","DynamicComponent","componentFactory","componentRef","subscriptions","inputs$$","subscribers","setTarget","createComponent","updateInputs","updateSubscribers","unobserveAllInputs","unsubscribeAll","instance","forEach","propName","unobserveInput","inputValue","hasOwnProperty","Observable","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","call","emitter","subscriber","Array","isArray","_subscriber","observable","values","s","DynamicComponentService","resolver","create","componentCls","resolveComponentFactory","DynamicOutletComponent","dynamicComponentService","component","dynamicComponent","eq","ObjectUtils","objectsAreEquivalent","inputsAreEquivalents","subscribersAreEquivalents","detectChanges","renderComponent","viewQuery","ViewContainerRef","DynamicOutletComponent_ng_template_0_Template","EntityTableColumnRenderer","Default","HTML","UnsanitizedHTML","Editable","Icon","ButtonGroup","EntityTableScrollBehavior","Auto","Instant","Smooth","EntityTableSelectionState","None","All","Some","getEntityProperty","entity","property","t","safeObject","getEntityId","meta","idProperty","getEntityTitle","titleProperty","getEntityTitleHtml","titleHtml","titleHtmlProperty","getEntityIcon","iconProperty","getEntityRevision","revision","EntityStateManager","index","Map","change$","ReplaySubject","getKey","size","setMany","entities","setAll","from","update","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","currentState","reduce","acc","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","map","Set","concat","some","changeKey","entries","bunch","storeKeys","EntityView","source$","values$","values$$","lifted","joins","filter$","filters$","filterIndex","sort$","getKey$","count$","count","empty$","_index","Error","all","firstBy","clause","find","firstBy$","manyBy","manyBy$","sort","createIndex","addFilter","uuid","removeFilter","lift","observables$","liftJoinedSource","liftSource","combineLatest","skip","debounceTime","_values","filters","processValues","setValues","sources$","source","joinData","computeJoinedValue","joinIndex","slice","filterValues","sortValues","clauses","every","v1","v2","naturalCompare","valueAccessor","direction","nullsFirst","generateIndex","entities$","stateView","getProperty","pristine","_pristine","strategies","createStateManager","createDataView","createStateView","load","softClear","updateCount","insert","insertMany","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","splice","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","deleteMany","currentRecord","statesAreTheSame","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","innerStateIndex","entities$$","state$$","setChangeDetector","setStore","teardownObservers","setupObservers","onEntitiesChange","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","emptyValue","emptyText","multiSelectValue","multiText$","record_r3","titleAccessor","EntitySelectorComponent","selected$","selected$$","multiAllText","multiNoneText","placeholder","selectedChange","records","onSelectFromStore","onSelectionChange","event","multiSelect","_value","updateMultiToggleWithEntities","EntitySelectorComponent_mat_option_3_Template","EntitySelectorComponent_mat_option_4_Template","EntitySelectorComponent_ng_template_5_Template","MatFormFieldModule","MatSelectModule","MatOptionModule","EntityTablePaginatorComponent","hidePageSize","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","count$$","entitySortChange$$","paginationLabelTranslation$$","entitySortChange$","paginatorOptions","page","paginatorChange","paginator","emitPaginator","firstPage","initPaginatorOptions","translateLabels","isMobile","translate","label","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","startIndex","Math","max","min","sub","MatPaginator","MatPaginatorModule","EntityTableRowDirective","static","selection","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","scrollBehavior","select","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","onToggleRows","checked","selectionState_r8","entityTableSelectionState","EntityTableComponent_th_3_ng_container_1_ng_container_1_Template","selectionState$","EntityTableComponent_th_3_ng_container_1_Template","selectMany","shiftKey","preventDefault","row_r11","_r14","ctx_r13","onShiftToggleRow","rowIsSelected","stopPropagation","ctx_r15","onToggleRow","column_r16","EntityTableComponent_ng_container_5_ng_container_1_th_1_Template","EntityTableComponent_ng_container_5_ng_container_2_th_1_Template","row_r31","cellData","name","class","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_ng_template_3_Template","isImg","_r39","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_Template","isUrl","_r34","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_Template","row_r47","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_ng_template_3_Template","_r55","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_Template","_r50","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_Template","_r79","row_r63","ctx_r77","onDateChange","_r76","_r85","onFocus","onChange","onBlur","_r93","ctx_r91","onValueChange","step","ctx_r69","getValidationAttributeValue","_r99","ctx_r97","ctx_r70","_r105","ctx_r103","onBooleanValueChange","option_r110","_r113","ctx_r111","onSelectValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_mat_option_1_Template","ctx_r72","multiple","domainValues","ctx_r73","_r74","option_r119","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_div_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_checkbox_5_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_7_Template","_r122","ctx_r120","onAutocompleteValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_option_10_Template","ctx_r64","formGroup","filteredOptions","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_ng_template_3_Template","_r133","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_td_0_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_Template","_r128","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_Template","ctx_r62","isEdition","_r66","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_Template","_r147","row_r142","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_Template","_r162","button_r156","row_r154","ctx_r160","onButtonClick","_r167","ctx_r165","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_Template","ctx_r155","editMode","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_Template","columnRenderer_r24","entityTableColumnRenderer","EntityTableComponent_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_Template","columnIsSortable","getColumnRenderer","getHeaderClass","row_r173","_r175","ctx_r174","onRowSelect","ctx_r176","onRowClick","getRowClass","_r178","ctx_r177","EntityTableComponent","formBuilder","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","selection$$","dataSource$$","lastRecordCheckedKey","_paginator","dataSource","sortNullsFirst","withPaginator","entityClick","entitySelectChange","entitySortChange","columns","column","visible","selectionCheckbox","MatTableDataSource","fixedHeader","tableHeight","setLocale","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","controls","setValue","option","viewValue","moment","format","enableEdit","item","validation","mandatory","includes","JSON","parse","toLowerCase","setControl","control","parseInt","valueChanges","filterNormalized","normalize","replace","formControlValue","StringUtils","isValidNumber","isOctalNumber","linkColumnForce","date","utc","newKey","disable","unsubscribeStore","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","computeSelectionState","getValue","getCellClass","getTrackByFunction","row","onSort","c","added","range","createRange","selectNode","getSelection","removeAllRanges","addRange","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","sortable","pop","list_id","match","Number","list_option","edition","validationType","getTableClass","func","headerClassFunc","Function","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","MatFormFieldControl","useExisting","provideMomentDateAdapter","EntityTableComponent_th_3_Template","EntityTableComponent_td_4_Template","EntityTableComponent_ng_container_5_Template","EntityTableComponent_tr_6_Template","EntityTableComponent_tr_7_Template","EntityTableComponent_igo_entity_table_paginator_8_Template","FormsModule","ImageErrorDirective","MatAutocompleteModule","MatDatepickerModule","MatInputModule","i10","MatNativeDateModule","i11","MatSortModule","i12","MatTableModule","i13","i14","NgStyle","ReactiveFormsModule","SecureImagePipe","StopPropagationDirective","i15","FlexibleComponent","main","initial","_initial","expanded","_expanded","initialMobile","_initialMobile","collapsedMobile","_collapsedMobile","expandedMobile","_expandedMobile","_direction","_state","sizes","setSize","setTimeout","transitionTime","mediaService$$","className","media$","media","height","width","getFieldComponent","getFieldInputs","getFieldSubscribers","FormFieldComponent","formFieldService","field","fieldInputs","fieldSubscribers","fieldOptions","getFieldByType","errors","disableSwitch","formControl","getDefaultErrorMessages","FormFieldComponent_ng_container_0_Template","FormComponent","form","formData","autocomplete","submitForm","buttons","hasButtons","children","setData","onSubmit","getData","getAllFormFields","updateDataWithFormField","fields","groups","group","reset","_c2","IgoFormFieldComponent","compType","FormFieldService","register","choice_r3","onDisableSwitchClick","getErrorMessage","FormFieldSelectComponent","choices","choices$","required","formControlIsRequired","getControlErrorMessage","toggleDisabled","enable","FormFieldSelectComponent_mat_option_2_Template","FormFieldSelectComponent_mat_icon_4_Template","FormFieldSelectComponent_mat_error_5_Template","encapsulation","__decorate","_r4","togglePassword","hide","FormFieldTextComponent","lastTimeoutRequest","isPassword","delayedHide","delayMS","clearTimeout","FormFieldTextComponent_mat_icon_2_Template","FormFieldTextComponent_button_3_Template","FormFieldTextComponent_mat_error_4_Template","_r3","tslib_es6","YR","ChangeDetectorRef","FormFieldTextareaComponent","FormFieldTextareaComponent_mat_icon_3_Template","FormFieldTextareaComponent_mat_error_4_Template","getFieldNgClass","field_r3","FormGroupComponent_div_0_div_1_Template","FormGroupComponent","getFieldColSpan","colSpan","cols","FormGroupComponent_div_0_Template","FormGroupComponent_mat_error_3_Template","FormService","addControl","validator","validators","getValidators","setValidators","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","Validators","FormDialogComponent_igo_form_3_div_2_igo_form_field_1_Template","FormDialogComponent_igo_form_3_div_2_igo_form_group_2_Template","form_r2","FormDialogComponent_igo_form_3_div_2_Template","cancel","data$","cancelButtonText","processButtonText","notice","FormDialogComponent","formService","form$","formFieldConfigs","formGroupsConfigs","formGroupsConfig","valid","k","markAsTouched","updateValueAndValidity","f","MAT_DIALOG_DATA","FormDialogComponent_igo_form_3_Template","FormDialogComponent_igo_custom_html_6_Template","FormDialogService","formDialogConfig","IgoFormDialogModule","MatDialogModule","email","messages","errorMessages","MAGNIFY_SCAN_ICON","svg","MICROSOFT_ICON","KEYBOARD_ESC_ICON","ENGINE_ICON","SELECTION_MARKER_ICON","PRESENTATION_PLAY_ICON","LAYER_PLUS_ICON","IconService","iconRegistry","sanitizer","registerSvg","addSvgIconLiteral","provideIcon","APP_INITIALIZER","useFactory","setDefaultFontSetClass","deps","MatIconRegistry","iconService","isSvg","_icon","IgoIconComponent_Conditional_0_Template","IgoIconComponent_Conditional_1_Template","errorImageUrl","hideError","onError","src","configService","activityInterceptor","interceptError","regexDepot","responseType","toDisplay","switchMap","blob","observer","reader","FileReader","readAsDataURL","onloadend","result","complete","Cacheable","maxCacheCount","String","startInteractiveTour","getClass","disabledTourButton","presentationIcon","_r7","discoverTitleInLocale$","InteractiveTourComponent_ng_container_0_button_1_Template","InteractiveTourComponent_ng_container_0_ng_template_2_Template","styleButton","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","toolbox","getTourToStart","activeToolName","isActiveTool","activeTool$","isToolHaveTour","isToolHaveTourConfig","showTourButton","haveTour","inMobileAndShow","isTourDisplayInMobile","tour","startTour","InteractiveTourComponent_ng_container_0_Template","InteractiveTourLoader","jsonURL","allToursOptions","getPathToConfigFile","loadConfigTour","getJSON","e","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","interactiveTourLoader","shepherdService","previousStep","nextIndex","isAppHaveTour","stepConfig","conditions","condition","showInMobile","getButtons","buttonKind","classes","text","instant","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","innerText","insertBefore","checkNext","service","nextStep","_setupModal","show","executeAction","actionConfig","charAt","executeActionPromise","Promise","resolve","waitFor","maxTry","maxWait","getShepherdSteps","tourConfig","shepherdSteps","i","position","on","floatingUIOptions","middleware","autoPlacement","offset","mainAxis","Boolean","beforeShowPromise","beforeChange","beforeShow","noBackButton","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","onHide","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","IgoInteractiveTourModule","ListItemDirective","_color","focused","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","getOffsetTop","offsetTop","padding","focusedCls","disabledCls","ClickoutDirective","clickout","handleMouseClick","contains","ListComponent","navigation","_navigation","_selection","selectedItem","_selectedItem","focusedItem","_focusedItem","navigationEnabled","listItems$$","listItems","handleKeyboardEvent","navigate","enableNavigation","ngAfterViewInit","init","items","focusNext","toArray","igoList","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","disableNavigation","scrollToItem","elem","docViewTop","elemTop","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","findIndex","contentQueries","dirIndex","cursorPointer","PanelComponent","withHeader","_withHeader","PanelComponent_div_0_Template","SpinnerComponent","shown$","shown","MatProgressSpinner","Toolbox","toolbar$","activeTool$$","activeToolHistory","previousToolName","currentToolName","tool","tools$","setToolbar","toolbar","initStore","getTool","getTools","setTools","tools","getToolbar","activateTool","activatePreviousTool","deactivateTool","previous","current","getCurrentPreviousToolName","clearActiveToolHistory","setActiveTool","ToolService","ToolComponent","toolSlideInOut","speed","transition","animate","actionStore","toolbarWithTitle$","onAnimationStart","onAnimationComplete","animation$","tool_r2","getToolInputs","ToolboxComponent","isActive","toolbar$$","animating$","animating$$","classColorGrey","classColorPrimary","onToolbarChange","onActiveToolChange","onAnimate","actions","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","callback","unAnimate","animation","ToolboxComponent_igo_actionbar_0_Template","ToolboxComponent_div_2_Template","WidgetService","widgetCls","IgoWidgetOutletModule","IgoWidgetModule","widget","getEffectiveSubscribers","WidgetOutletComponent","baseSubscribers","onCancel","onComplete","destroyWidget","baseSubscriber","WidgetOutletComponent_igo_dynamic_outlet_0_Template","WorkspaceStore","activeWorkspace$","activateWorkspace","workspace","deactivateWorkspace","Workspace","widget$","widgetInputs$","widgetSubscribers$","change","Subject","entityStore","hasWidget","deactivateWidget","activateWidget","WorkspaceSelectorComponent","getWorkspaceTitle","onSelectedChange","widget_r1","ngIf","onWidgetCancel","onWidgetComplete","WorkspaceWidgetOutletComponent","WorkspaceWidgetOutletComponent_ng_container_0_Template","TypePermission","null","read","write","ContextService","storageService","exportService","route","context$","contexts$","ours","defaultContextId$","editedContext$","importedContext","toolsChanged$","mapViewFromRoute","baseUrl","defaultContextUri","_defaultContextUri","uri","basePath","contextListFile","readParamsFromRoute","first","handleContextsChange","loadContexts","permissions","getById","getDetails","res","handleError","getDefault","context","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","unshift","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getPath","getLocalContext","mergeMap","base","urlBase","resBase","resMerge","mergeDeep","layers","l","l2","t2","err2","request","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextKey","queryParams","contextParam","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","getContextFromMap","igoMap","ol","getView","proj","getProjection","getCode","center","olPoint","getCenter","getCoordinates","zoom","getZoom","projection","maxZoomOnExtent","viewController","layers$","lay","baseLayer","a","b","zIndex","layer","layerOptions","security","opacity","opts","sourceOptions","queryable","global","getContextFromLayers","extraFeatures","currentLayers","layerFound","contextLayer","layerFoundAs","layerStyle","igoStyle","styleByAttribute","clusterBaseStyle","getSource","olVectorSource","getExtraFeatures","catalogLayer","writer","GeoJSON","olFeatures","Cluster","getFeatures","flatMap","cluster","cleanedOlFeatures","generateFeature","writeFeatures","dataProjection","featureProjection","removeAllAreNotError","contextToLoad","getContextLayers","mapLayers","centerKey","projectionKey","zoomKey","file","permissionError","obj","titleContext","keepCurrentContext","editedContext","findContext","newContext","editedFound","public","found","ExportError","ExportNothingToExportError","setPrototypeOf","ContextExportService","export","exportAsync","nothingToExport","contextJSON","stringify","downloadContent","ImportError","ImportInvalidFileError","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","handleInvalidFileImportError","mimeType","handleSizeFileImportError","sizeMb","handleUnreadbleFileImportError","collectFeaturesFromExtraFeatures","featureCollection","readFeatures","ContextImportService","clientSideFileSizeMax","configFileSizeMb","pow","import","importAsync","getFileImporter","extension","getFileExtension","allowedMimeTypes","allowedExtensions","importFile","importer","onload","parseContextFromFile","onerror","evt","readAsText","_r2","importFiles","files","loading$","fileSizeMb","layer_r9","_r11","ctx_r10","selectAll","ContextImportExportComponent_form_9_mat_option_18_Template","ctx_r12","handleExportFormSubmit","userControlledLayerList","ContextImportExportComponent","contextImportService","contextExportService","contextService","inputProj","forceNaming","layerList","activeImportExport","layers$$","buildForm","showInLayerList","take","onFileImportSuccess","onFileImportError","contextOptions","onFileExportError","onFileExportSuccess","handleFileImportSuccess","handleNothingToImportError","contextTitle","computeLayerTitleFromFile","substr","lastIndexOf","addContextToContextList","success","handleFileImportError","handleFileExportError","handleNothingToExportError","handleFileExportSuccess","onImportExportChange","ContextImportExportComponent_div_8_Template","ContextImportExportComponent_form_9_Template","MatButtonToggleModule","MatDividerModule","prefix","ContextFormComponent","btnSubmitText","_btnSubmitText","handleFormSubmit","removeNull","copyTextToClipboard","Clipboard","copy","uriSplit","ContextFormComponent_span_8_Template","ContextEditComponent","cd","ContextEditComponent_igo_context_form_0_Template","iconImage","favoriteClick","ContextItemComponent_button_1_mat_icon_2_Template","ContextItemComponent_button_1_img_3_Template","auth","default","ctx_r17","save","_r20","managePermissions","_r24","edit","_r28","ctx_r27","_r30","ctx_r29","ContextItemComponent_div_5_button_1_Template","ContextItemComponent_div_5_button_4_Template","ContextItemComponent_div_5_button_5_Template","ContextItemComponent_div_5_button_6_Template","ContextItemComponent_div_5_button_7_Template","ContextItemComponent_div_5_button_8_Template","ContextItemComponent_div_5_button_9_Template","_r32","ctx_r31","canShare","ContextItemComponent","showFavorite","favorite","manageTools","ContextItemComponent_button_1_Template","ContextItemComponent_button_2_Template","ContextItemComponent_div_5_Template","BookmarkDialogComponent","ContextListControlsEnum","always","never","_r9","clearFilter","term","ContextListComponent_mat_form_field_2_button_6_Template","_r19","user_r12","handleToggleCategory","getPermission","indeterminate","child_r23","ctx_r22","_r31","ContextListComponent_ng_container_12_ng_template_2_button_6_Template","_r21","childs","ContextListComponent_ng_container_12_button_1_Template","ContextListComponent_ng_container_12_ng_template_2_Template","context_r37","ctx_r38","ctx_r40","ctx_r41","ctx_r42","ctx_r43","ctx_r44","ctx_r45","ctx_r46","ctx_r47","ctx_r48","ctx_r49","ctx_r36","selectedContext","_r51","groupContexts_r33","ctx_r50","titleMapping","ContextListComponent_ng_template_18_igo_collapsible_0_ng_template_2_Template","ctx_r34","context_r55","_r57","ctx_r56","ctx_r58","ctx_r59","ctx_r54","contextConfigs","ContextListComponent_ng_template_18_1_ng_template_0_Template","ContextListComponent_ng_template_18_igo_collapsible_0_Template","ContextListComponent_ng_template_18_1_Template","ContextListComponent","contextsInitial","change$$","_contexts","_defaultContextId","showHiddenContexts","filterPermissionsChanged","shared","users","showHidden","_term","sortedAlpha","_sortedAlpha","showContextFilter","thresholdToFilter","isEmpty","debounce","timer","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","totalLength","contextsList","str","toggleSort","parentPermission","childrenPermission","ContextListComponent_mat_form_field_2_Template","ContextListComponent_igo_actionbar_8_Template","ContextListComponent_button_9_Template","ContextListComponent_ng_container_12_Template","ContextListComponent_ng_template_18_Template","ContextListComponent_div_21_Template","KeyValuePipe","scopeChanged","ContextPermissionsComponent_div_0_div_2_mat_radio_button_8_Template","profil_r11","_r13","onProfilSelected","ContextPermissionsComponent_div_0_form_3_mat_option_6_Template","displayFn","profils","_r23","permission_r19","removePermission","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_button_8_Template","profilTitle","ctx_r18","canWrite","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_Template","groupPermissions_r16","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_Template","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_Template","ContextPermissionsComponent_div_0_div_1_Template","ContextPermissionsComponent_div_0_div_2_Template","ContextPermissionsComponent_div_0_form_3_Template","ContextPermissionsComponent_div_0_igo_list_4_Template","ContextPermissionsComponent","_permissions","_profils","baseUrlProfils","UntypedFormControl","formValueChanges$$","addPermission","profilTitleNormalized","ContextPermissionsComponent_div_0_Template","MatRadioModule","ShareMapService","language","lang","getUrlWithApi","formValues","origin","pathname","createContextShared","updateContextShared","getUrlWithoutApi","publicShareOption","visibleOnLayersKey","visibleOffLayersKey","llc","layerlistControls","querystring","visibleKey","invisibleKey","visibleLayers","isIgoInternalLayer","invisibleLayers","layersUrl","layersToLoop","contextLayersID","contextLayers","addedLayersQueryParamsWms","makeLayersByService","addedLayersQueryParamsWmts","addedLayersQueryParamsArcgisRest","addedLayersQueryParamsImageArcgisRest","addedLayersQueryParamsTileArcgisRest","arrayCenter","toFixed","endsWith","typeService","addedLayersByService","layerVersion","linkUrl","encodeURIComponent","addedLayer","datasourceOptions","LAYERS","VERSION","addedLayerPosition","version","operator","definedUrl","addedLayersQueryParams","linkUrlKey","layersKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","linkUrlQueryParams","layersQueryParams","userId","ShareMapApiComponent","shareMapService","idContextShared","toString","createUrl","rep","showError","textArea","ShareMapApiComponent_span_10_Template","ShareMapApiComponent_button_18_Template","ShareMapApiComponent_button_19_Template","ShareMapApiComponent_div_20_Template","ShareMapUrlComponent_div_14_h4_1_Template","ShareMapUrlComponent_div_14_li_4_Template","ShareMapUrlComponent_div_14_li_6_Template","ShareMapUrlComponent_div_14_li_8_Template","ShareMapUrlComponent_div_14_li_10_Template","ShareMapUrlComponent_div_14_li_12_Template","ShareMapUrlComponent_div_14_h4_14_Template","ShareMapUrlComponent_div_14_li_17_Template","ShareMapUrlComponent_div_14_li_19_Template","ShareMapUrlComponent_div_14_li_21_Template","ShareMapUrlComponent_div_14_li_23_Template","ShareMapUrlComponent","mapState$$","resetUrl","state$","status$","ShareMapUrlComponent_div_14_Template","ShareMapUrlComponent_igo_custom_html_16_Template","ShareMapComponent","hasApi","ShareMapComponent_mat_tab_group_0_Template","ShareMapComponent_igo_share_map_url_1_Template","MatTabsModule","LayerContextDirective","layerService","styleListService","styleService","context$$","removeLayersOnContextChange","handleContextChange","removeAllLayers","removeLayers","layersAndIndex$","merge","createAsyncLayer","buffer","handleAddLayers","importWithStyle","addImportedFeaturesStyledToMap","distance","getStyleList","resolution","createStyleByAttribute","clusterParam","baseStyle","createStyle","createClusterStyle","ClusterDataSource","addFeatures","FeatureDataSource","VectorLayer","addLayer","addImportedFeaturesToMap","randomStyle","editable","featureKeys","getKeys","featureRandomStyleFunction","featureRandomStyle","createAsyncIdbLayers","computeLayerVisibilityFromUrl","addLayers","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","HttpClientModule","MapContextDirective","viewContext","geolocationController","updateGeolocationOptions","controlsContext","scaleLine","scaleLineOption","minWidth","ContextListBindingDirective","mapService","confirmDialogService","contexts$$","selectedContext$$","defaultContextId$$","previousMessageId","onSelect","onEdit","onSave","getMap","contextFromMap","msgSuccess","onFavorite","messageObj","toastId","onManageTools","onManagePermissions","onDelete","confirm","info","onClone","onCreate","onShowContext","onHideContext","storedContextUri","authenticate","profilsAcc","cur","ContextEditBindingDirective","editedContext$$","submitSuccessed","handleEditedContextChange","ContextPermissionsBindingDirective","onAddPermission","onRemovePermission","onScopeChanged","permissionsArray","ActivityInterceptor","activityService","activity","actReq","finalize","unregister","IgoActivityModule","ActivityService","counter$","ids","AnalyticsService","paq","_paq","provider","initMatomo","g","getElementsByTagName","async","defer","parentNode","setUser","firstName","lastName","trackSearch","nbResults","trackEvent","category","trackLayer","parameters","CONFIG_DEPRECATED","showMenuButton","alternativeKey","mayBeRemoveIn","menuButtonReverseColor","hasGeolocateButton","ALTERNATE_CONFIG_FROM_DEPRECATION","_","deprecatedKey","lib","releaseDate","httpClient","configDeprecated","_isLoaded$","isLoaded$","asObservable","HttpClient","getConfigs","handleDeprecatedConfig","defaultValue","handleDeprecationPossibility","console","warn","baseConfig","path","_reject","log","throwError","configResponse","CONFIG_OPTIONS","InjectionToken","provideConfig","useValue","configFactory","TranslateModule","LanguageLoader","suffix","getTranslation","igoLocale$","isLoaded","appLocale$","forkJoin","translations","LanguageService","language$","getBrowserLang","getLanguage","setDefaultLang","use","reloadLang","IgoMissingTranslationHandler","translateService","langs","TIMEOUT_DURATION","provideTranslation","loader","importProvidersFrom","setTranslationConfig","currentLoader","timeout","defaultLanguage","DEFAULT_LANGUAGE_LOADER","missingTranslationHandler","MissingTranslationHandler","TranslateLoader","defaultLanguageLoader","HttpBackend","Mobile","Tablet","MediaOrientation","Portrait","Landscape","MediaService","orientation$","breakpointObserver","observe","Breakpoints","HandsetLandscape","matches","HandsetPortrait","TabletLandscape","TabletPortrait","WebLandscape","WebPortrait","getOrientation","isTouchScreen","documentElement","TOASTR_CONFIG","positionClass","timeOut","extendedTimeOut","titleClass","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","provideMessage","provideToastr","IgoMessageModule","MessageType","ERROR","ALERT","WARNING","INFO","SUCCESS","SHOW","MessageService","messages$","activeMessageTranslations","r","toastr","toasts","toast","activeMessageTranslation","amt","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","textKey","toastRef","ToastrService","httpError","messageType","toastrConfig","iconClasses","currentDate","to","showIcon","handleTemplate","messageShown","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","mess","Injector","NetworkService","stateChangeEventEmitter","onlineSubscription","offlineSubscription","connection","navigator","onLine","checkNetworkState","fromEvent","emitEvent","reportState","startWith","ROUTE_SERVICE_OPTIONS","RouteService","searchKey","directionsCoordKey","directionsOptionsKey","toolKey","vectorKey","decodeURIComponent","search","pair","SESSION","StorageServiceEventEnum","ADDED","MODIFIED","REMOVED","CLEARED","storageChange$","sessionStorage","TypeCapabilities","wms","wmts","arcgisrest","imagearcgisrest","tilearcgisrest","ArcGISRestCapabilitiesLayerTypes","FeatureLayer","RasterLayer","GroupLayer","CapabilitiesService","parsers","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","baseOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","account","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","legend","parseTileOrImageArcgisOptions","getTileArcgisOptions","legendInfo","HttpParams","fromObject","toUpperCase","_i","findDataSourceInCapabilities","Capability","Layer","metadata","DataURL","abstract","Abstract","keywordList","KeywordList","timeFilter","getTimeFilter","timeFilterable","legendOptions","Style","getStyle","isExtentInGeographic","EX_GeographicBoundingBox","coord","extent","olproj","queryFormat","queryFormatMimeTypePriority","QueryFormatMimeType","GEOJSON","GEOJSON2","GML3","GML2","Request","GetFeatureInfo","Format","keyEnum","QueryFormat","removeUndefined","_layerOptionsFromSource","Title","maxResolution","getResolutionFromScale","MaxScaleDenominator","minResolution","MinScaleDenominator","OnlineResource","extern","minDate","maxDate","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","drawingInfo","EsriStyleGenerator","generateStyle","units","attributions","olAttribution","copyrightText","timeExtent","timeInfo","time","setTime","toUTCString","TimeFilterType","DATETIME","TimeFilterStyle","CALENDAR","maxScale","minScale","description","serviceDescription","sourceFields","queryTitle","displayField","x","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","tslib__WEBPACK_IMPORTED_MODULE_19__","OptionsService","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","authInterceptor","datasources$","createAsyncDataSource","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","removeDuplicateCaseInsensitive","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","d","OSMDataSource","WebSocketDataSource","WFSDataSource","observables","optionsFromApi","optionsMerged","WMSDataSource","WMTSDataSource","XYZDataSource","TileDebugDataSource","CartoDataSource","getArcgisRestOptions","ArcGISRestDataSource","ImageArcGISRestDataSource","TileArcGISRestDataSource","MVTDataSource","createOlSource","getSourceFormatFromOptions","olSourceCluster","generateId","onUnwatch","DataSource","dataService","generateIdFromSourceOptions","getLegend","setLegend","olSourceVector","olFormatCls","formatType","olformat","formatOptions","olSourceOSM","olSourceXYZ","wfsService","ogcFilters","checkWfsParams","fieldNameGeometry","paramsWFS","defaultFieldNameGeometry","ogcFilterWriter","OgcFilterWriter","defineOgcFiltersDefaultOptions","sf","getSourceFieldsFromWFS","pushButtons","selectorType","checkboxes","radioButtons","setOgcFilters","getFormatFromOptions","OlLoadingStrategy","triggerEvent","notify","tileGrid","createDefaultTileGrid","olSourceWMTS","mapLabel","queryHtmlTarget","QueryHtmlTarget","BLANK","crossOrigin","olSourceCarto","htmlString","types","oneType","cartocss","colors","j","layer_name","esrijsonFormat","olFormatEsriJSON","overlaps","customParams","bind","olloadingstrategy","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","stroke","strokeWidth","outlineColor","outline","fill","renderingRule","ImageArcGISRest","ratio","layerId","TileGrid","TileDebug","ws","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onopen","onOpen","featureAdded","readFeature","featureToRemove","getFeatureById","getId","removeFeature","addFeature","mvtFormat","featureClass","olFormatMVT","olSourceVectorTile","olSourceTileArcGISRest","DataService","WFSService","dataSourceOptions","defineFieldAndValuefromWFS","getfeatureSourceField","sourcefield","alias","wfsGetFeature","nb","defaultMaxFeatures","epsgCode","defaultEpsg","propertyName","forceDefaultOutputFormat","formatWFSQueryString","outputFormat","gmlRegex","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","concatMap","allowGml","firstFeature","getGeometryName","processingArray","maxFeatures","chunkSize","srsName","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","timeFilter$","sourceParams","dpi","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","download","dynamicUrl","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","advancedOgcFilters","calendarModeYear","filterQueryString","handleOgcFiltersAppliedValue","FILTER","updateParams","timeFilterableDataSourceOptions","setTimeFilter","igoRefresh","random","asWFSDataSourceOptions","olSourceImageWMS","scale","projParam","contentDependent","contentDependentLegend","separator","currentStyle","defaultWfsVersion","buildUrl","randomParam","queryStringValues","igoFilters","filterOrBox","buildFilter","geometryName","filterOrPush","xmlFilter","epsg","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","featureTypes","paramMaxFeatures","cnt","srs","valueReference","fieldsNames","getFeature","getpropertyvalue","wfsDataSourceOptions","srcType","wfsOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","projectionExtent","getExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","resetStops","zoomRoute","copyDirectionsToClipboard","_r12","copyLinkToClipboard","printDirections","DirectionsButtonsComponent","directionsService","activeRoute","routesFeatureStore","contextUri","zoomToActiveRoute$","stopsStore","stepFeatureStore","clearStops","addStop","addStopToStore","getUrl","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","summary","formatDistance","formatDuration","duration","wayPointsCnt","stop","stopText","roundCoordTo","coordinates","toLocaleString","localCnt","instruction","formatStep","formatInstruction","maneuver","modifier","bearing_after","exit","pos","routingOptions","directionsKey","stopsCoordinates","directionsUrl","downloadDirection","DirectionsButtonsComponent_button_5_Template","DirectionsButtonsComponent_button_8_Template","DirectionsButtonsComponent_button_10_Template","DirectionsButtonsComponent_button_12_Template","DirectionsButtonsComponent_button_14_Template","stop_r1","clearStop","result_r12","DirectionsInputsComponent_div_1_mat_optgroup_9_mat_option_1_Template","source_r10","_r16","removeStop","DirectionsInputsComponent_div_1_div_10_button_5_Template","onStopEnter","onStopLeave","ctx_r20","stopIsDragged","ctx_r24","onInputFocus","ctx_r26","setStopText","DirectionsInputsComponent_div_1_button_6_Template","ctx_r28","chooseProposal","DirectionsInputsComponent_div_1_mat_optgroup_9_Template","DirectionsInputsComponent_div_1_div_10_Template","getNgClass","getPlaceholder","stopWithHover","getOptionText","searchProposals","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopsFeatureStore","coordRoundedDecimals","stopInputHasFocus","unlistenMapSingleClick","geomCoord","geom","geometry","point","pointOnFeature","validateTerm","keyIsValid","extra","relativePosition","DirectionRelativePositionType","Intermediate","removeStopFromStore","drop","moveStops","previousIndex","currentIndex","fromIndex","toIndex","stops","moveItemInArray","computeRelativePosition","updateStoreSorting","listenMapSingleClick","once","clickCoordinates","olProj","coordinate","roundedCoord","olObservable","DirectionsInputsComponent_div_1_Template","CdkDropList","CdkDrag","CdkDragHandle","direction_r5","cnt_r6","changeRoute","activeDirection","DirectionsResultsComponent_div_0_mat_form_field_1_mat_option_6_Template","directions","step_r10","showSegment","cnt_r11","cssClass","image","DirectionsResultsComponent_div_0_mat_form_field_1_Template","DirectionsResultsComponent_div_0_mat_divider_2_Template","onStepsListBlur","DirectionsResultsComponent_div_0_mat_list_item_8_Template","DirectionsResultsComponent","activeFeatureWithDirection","zoomToExtent","showRouteSegmentGeometry","vertexId","lastPoint","olGeom","olFeature","geojsonGeom","OlGeoJSON","writeGeometryObject","previousVertex","FEATURE","DirectionType","Vertex","getGeometry","DirectionsResultsComponent_div_0_Template","DirectionsSource","onTogglePrivateModeControl","enabledProfileHasAuthorization","DirectionsComponent","directionsSourceService","searchService","queryService","hasOsrmPrivateAccess","twoSourcesAvailable","zoomRoute$$","storeEmpty$$","storeChange$$","routesQueries$$","selectStopInteraction","translateStop","selectedRoute","focusOnStop","isTranslating","previousStops","searchs$$","authenticated$$","authenticated$","directionControlIsActive","queryEnabled","interactions","sources","getEnabledProfile","authorization","profileWithAuth","getProfileWithAuthorization","profiles","initEntityStores","initStopsFeatureStore","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","u","freezeStores","interaction","removeInteraction","FeatureStoreLoadingStrategy","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","olInteraction","hitTolerance","dragging","executeStopTranslation","olCondition","Route","selectCoordinates","mapBrowserEvent","addedStop","addInteraction","onStopInputHasFocusChange","getLength","getArray","translatedStopId","translationCoordinates","translatedStop","distinctUntilChanged","storeInitialized$","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","diff","ChangeUtils","findChanges","stopIdToProcess","modified","changedStop","newValue","response","stringToLonLat","researches","isCoord","lonLat","searchType","requests$","sp","ProposalType","Coord","Text","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","addDirectionToRoutesFeatureStore","addStopToStopsFeatureStore","onToggleDirectionsControl","profile","DirectionsComponent_mat_slide_toggle_4_Template","CommonModule","MatSlideToggleModule","DirectionsSourceService","directionsSourceServiceFactory","provideDirectionsSourceService","DirectionsFormat","SourceDirectionsType","Trip","Stop","Start","End","DirectionsService","printService","directionsOptions","routeSource","_this","activityId","doc","jsPDF","orientation","unit","pageWidth","pageHeight","internal","margins","imageDimensions","align","addMap","PrintLegendPosition","none","_ref","_asyncToGenerator","status","SubjectStatus","Done","addInstructions","setPageHeaderFooter","returnPromise","_x","apply","arguments","setHTMLTableContent","_this2","directionsInstruction","table","tblBody","cellImage","cellText","img","span","appendChild","spanDistance","verticalAlign","append","_this3","matListItem","iconsArray","iconName","getAttribute","iconCanvas","html2canvas","toDataURL","formattedDirection","_this4","addPage","HTMLtable","autoTable","startY","titlePosition","margin","top","bottom","columnStyles","cellWidth","theme","fontSize","didDrawCell","cell","section","raw","addImage","y","pageCount","getNumberOfPages","now","logo","setPage","setFontSize","getHeight","getWidth","baseline","getCurrentPageInfo","pageNumber","DOCUMENT","positions","maxPosition","insertPosition","lastPosition","stopToUpdate","computeStopsPosition","stopsToComputePosition","directionsStyle","vertexStyle","olStyle","radius","stopStyle","createOverlayMarkerStyle","markerColor","markerOutlineColor","routeStyle","loadingStrategy","motion","FeatureMotion","stopsLayer","linkedLayers","linkId","links","syncedDelete","linkedIds","exportable","browsable","tryBindStoreLayer","tryAddLoadingStrategy","routeLayer","stepLayer","stopColor","previousStop","stopFeatureStore","stopOpacity","moveToExtent","previousRoute","routeFeatureStore","NumberUtils","roundToNDecimal","round","hour","minute","stepPosition","lastStep","directive","translatedDirection","translateBearing","bearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","StopsStore","StopsFeatureStore","FeatureStore","RoutesFeatureStore","StepFeatureStore","property_r3","openSecureUrl","getEmbeddedLinkText","_r29","FeatureDetailsComponent_table_0_tr_2_td_1_Template","FeatureDetailsComponent_table_0_tr_2_td_2_Template","FeatureDetailsComponent_table_0_tr_2_td_3_Template","FeatureDetailsComponent_table_0_tr_2_td_4_Template","FeatureDetailsComponent_table_0_tr_2_td_5_Template","FeatureDetailsComponent_table_0_tr_2_td_6_Template","FeatureDetailsComponent_table_0_tr_2_td_7_Template","FeatureDetailsComponent_table_0_tr_2_td_8_Template","isObject","isEmbeddedLink","isDoc","FeatureDetailsComponent_table_0_tr_2_Template","filterFeatureProperties","htmlSanitizer","urlSanitizer","FeatureDetailsComponent","networkService","unsubscribe$","ready","_source","_feature","selectFeature","routeEvent","htmlDisplayEvent","takeUntil","bypassSecurityTrustResourceUrl","isHtmlDisplay","URL","docOrImage","fileUrl","createObjectURL","div","allowedFieldsAndAlias","offlineButtonState","forcedOffline$","excludeAttributeOffline","attribute","excludeAttribute","FeatureDetailsComponent_table_0_Template","FeatureDetailsComponent_iframe_1_Template","JsonPipe","FeatureDetailsDirective","feature$","routingEvent","setFeature","bindClicking","routeElement","addEventListener","FEATURE_DETAILS_DIRECTIVES","FeatureFormComponent","igoForm","formDataToFeature","entry","startsWith","propertyPrefix","bindLayer","Move","Zoom","featureToOl","projectionOut","OlFormatGeoJSON","setId","mapTitle","renderFeatureFromOl","olRenderFeature","projectionIn","olLayer","exclude","excludeOffline","olFormat","geometryType","getType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","featureFromOl","idColumn","getRevision","computeOlFeaturesExtent","olextent","featureExtent","computeOlFeatureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","scaleExtent","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","featuresAreTooDeepInView","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","moveToOlFeatures","getOlProjection","hideOlFeature","setStyle","olstyle","computeOlFeaturesDiff","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","FeatureStoreInMapResolutionStrategy","stores$$","resolution$$","empty$$","watchStore","updateEntitiesInResolution","getResolution","unwatchStore","unwatchAll","resolution$","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","states$$","updateEntitiesPropertiesState","pairwise","prevLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","so","LAYER","potentialLayerId","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingLayerStrategy","onSourceChanges","setStoreOlFeatures","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","searchDocument","FlexSearchDocument","tokenize","skipWhile","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","n","propertiesToIndex","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","clearLayer","olSource","removeOlFeaturesFromLayer","addOlFeaturesToLayer","setLayerExtent","viewProjection","setExtent","tryAddSelectionStrategy","FeatureStoreSelectionStrategy","FeatureStoreInMapExtentStrategy","updateEntitiesInExtent","inMapExtent","entitiesInMapExtent","getFeaturesInExtent","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","OlDragSelectInteraction","OlDragBoxInteraction","mapClickListener","olDragSelectInteraction","olDragSelectInteractionEndKey","overlayStore","_overlayStore","createOverlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","onMapClick","unByKey","ctrlKeyDown","getFeaturesAtPixel","pixel","layerFilter","onSelectFromMap","olInteractions","getInteractions","onDragBoxEnd","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","removeLayer","OgcFilterOperatorType","BasicNumericOperator","Basic","BasicAndSpatial","Spatial","Time","OgcFilterOperator","BBOX","PropertyIsBetween","Contains","During","PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","Intersects","PropertyIsNull","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsLike","PropertyIsNotEqualTo","Within","And","Or","Not","filterSequence","operators","spatial","fieldRestrict","ogcFiltersOptions","ogcFiltersDefaultValue","ourBboxFilter","enableBbox","filterAssembly","olfilter","checkIgoFiltersProperties","bundleFilter","featureNS","featurePrefix","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","logical","filterOptions","wfsPropertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","wfsEnd","end","wfsExpression","expression","olFormatWKT","readGeometry","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","copyDeep","selectorGroup","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","formatProcessedOgcFilter","enableds","list","selectorBundle","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","parseDateOperation","isValid","operationSplitted","leftOperand","rightOperand","rightUnitOperand","endOf","subtract","DATE","TIME","YEAR","SLIDER","DrawControl","start$","end$","changes$","modify$","select$","abort$","freehand$","ispredefinedRadius$","predefinedRadius$","radiusDrawEnd$","keyDown$$","olGeometryType","olInteractionStyle","olMap","olDrawingLayer","olDrawInteraction","olSelectInteraction","olModifyInteraction","onDrawStartKey","onDrawEndKey","onDrawAbortKey","onDrawKey","mousePosition","radiusVal","radiusValData","radiusCercle","olDrawingLayerSource","drawingLayer","createOlInnerOverlayLayer","interactionStyle","setOlMap","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","OlDraw","maxPoints","freehand","stopClick","freehandCondition","onDrawStart","onDrawEnd","OlModify","OlSelect","doubleClick","unsubscribeKeyDown","olGeometryEvent","getMousePositionFromOlGeometryEvent","subscribeKeyDown","removeLastPoint","finishDrawing","abortDrawing","ModifyControl","olOverlayLayer","onModifyStartKey","onModifyEndKey","onModifyKey","olModifyInteractionIsActive","olTranslateInteraction","onTranslateStartKey","onTranslateEndKey","onTranslateKey","olTranslateInteractionIsActive","olDrawInteractionIsActive","drawKeyUp$$","drawKeyDown$$","removedOlInteractions","olLinearRingsLayer","olOuterGeometry","olOverlaySource","olLinearRingsSource","modify","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","OlFeature","createDrawHoleInteractionStyle","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStart","onModifyEnd","subscribeToKeyDown","unsubscribeToKeyDown","OlTranslate","deactivateTranslateInteraction","onTranslateStart","onTranslateEnd","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","olLinearRing","OlLinearRing","addLinearRingToOlPolygon","newCoordinates","getLinearRings","setCoordinates","createDrawInteractionStyle","olPolygon","appendLinearRing","olEvent","computeMVTOptionsOnHover","vectorTileLayerOptions","hoverStyle","LayerDBService","ngxIndexedDBService","dbName","layerDBData","subject","getByID","dbObject","customUpdate","deleteRequest","deleteByKey","isDeleted","object","getAll","LayerService","dataSourceService","geoNetworkService","layerDBService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","ImageLayer","TileLayer","igoLayer","handleLegacyStyles","igoStyleObject","idbInfo","storeToIdb","parseStyle","serviceStyle","geoDBService","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","VectorTileLayer","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","layersOptions","idbl","ImageWatcher","valStatus","olLoadingProblem","createOlLayer","olOptions","olLayerImage","setImageLoadFunction","tile","customLoader","setMap","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","Uint8Array","TextDecoder","Blob","imageUrl","send","TileWatcher","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","vectorTile","olLayerVectorTile","vectorTileSource","getFormat","onLoad","setLoader","failure","responseText","responseXML","DOMParser","parseFromString","readProjection","LinkedProperties","OPACITY","VISIBLE","OGCFILTERS","MINRESOLUTION","MAXRESOLUTION","ZINDEX","TIMEFILTER","TooltipType","TITLE","ABSTRACT","CUSTOM","legendCollapsed","firstLoadComponent","hasBeenVisible$","hasBeenVisible$$","getZIndex","setZIndex","setOpacity","isInResolutionsRange","isInResolutionsRange$","setMaxResolution","Infinity","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","visible$","m","showOnEachLayerVisibility","showMessage","displayed","displayed$","maxScaleDenom","minScaleDenom","unobserveResolution","observeResolution","previousLoadExtent","previousLoadResolution","previousOgcFilters","xhrAccumulator","trackFeatureListenerId","VectorWatcher","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","preload","bypassResolution","bypassVisible","flash","firstLoad","maintainFeaturesInIdb","trackFeature","enableTrackFeature","vector","olLayerVector","vectorSource","customWFSLoader","idbLoader","customIDBLoader","maintainOptionsInIdb","removeLayerFromIDB","zip","olStyleToBasicIgoStyle","layerOlStyle","getFill","getColor","getStroke","circle","layerData","insertEvent","dsFeatures","geojsonObject","InsertSourceInsertDBEnum","User","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","elapsed","elapsedRatio","easeOut","newColor","ColorAsArray","getStyleFunction","style2","styleClone","getRadius","setRadius","setColor","setWidth","setText","drawGeometry","render","stopAnimation","un","centerMapOnFeature","feat","setCenter","disableTrackFeature","wfsProj","olProjection","code","currentExtent","removeLoadedExtent","alteredUrl","nbOfFeature","delay","content","layerID","Watcher","loaded","loading","watch","handleLoadStart","handleLoadEnd","handleLoadError","unwatch","__watchers__","Working","watcherIndex","params_","baseLayersSwitcherSlideInOut","overflow","baseLayer_r4","baseLayers","expand","i_r5","useStaticIcon","showButton","collapseOrExpand","BaseLayersSwitcherComponent_div_0_div_1_Template","BaseLayersSwitcherComponent_div_0_igo_mini_basemap_3_Template","BaseLayersSwitcherComponent_div_0_div_4_Template","hasMoreThanTwo","BaseLayersSwitcherComponent","_baseLayers","arrayLayers","mapZoom","bl","maxZoom","minZoom","blHidden","BaseLayersSwitcherComponent_div_0_Template","MiniBaseMapComponent","changeBaseLayer","MiniBaseMapComponent_div_1_div_2_Template","basemap","appRef","_display","changed","_baseLayer","handleBaseLayerChanged","IgoMap","handleMainMapViewChange","olView","tick","mainMapView","mainMapViewProperties","setResolution","setRotation","rotation","baselayer","handleLinkedBaseLayer","link","linkedId","layerToApply","linkedLayerOptions","showInMiniBaseMap","MiniBaseMapComponent_div_1_Template","MapBrowserComponent","onGeolocationClick","tracking","icon$","GeolocateButtonComponent","tracking$$","_map","ngAfterContentInit","tracking$","GeolocateButtonComponent_div_0_Template","HomeExtentButtonComponent","extentOverride","centerOverride","zoomOverride","homeExtentButtonExtent","homeExtentButtonCenter","homeExtentButtonZoom","computeHomeExtent","homeExtentButtonOptions","homeExtButtonExtent","homeExtButtonCenter","homeExtButtonZoom","onToggleClick","zoomTo","infoContent","InfoSectionComponent","InfoSectionComponent_div_0_Template","status$$","_view","updateView","_controls","updateControls","handleStatusChange","MapCenterComponent","displayCenter$$","mapCenter$","getElementById","visibility","letZoom","deltaY","zoomOut","zoomIn","MenuButtonComponent","sidenavOpened","_sidenavOpenend","getClassMenuButton","openSidenav","useThemeColor","menuButtonClass","configValue","onToggleSidenavClick","OfflineButtonComponent","btnStyle","handleButtonStyle","resetRotation","rotated$","azimuthRounded","rotationRounded","currentStyle$","RotationButtonComponent","showIfNoRotation","rotation$","radians","deg","PI","bearingToAzimuth","RotationButtonComponent_div_0_Template","MapController","observerKeys","getOlMap","GeolocationOverlayType","Position","PositionDirection","Accuracy","Buffer","MapGeolocationController","arrowRotation","subscriptions$$","geolocationOverlay","positionFeatureStyle","accuracyFeatureStyle","bufferStyle","bufferStroke","bufferFill","textAlign","offsetX","offsetY","font","showBufferRadius","bufferRadius","arrowStyle","points","displacement","rotateWithView","geolocation","emissionIntervalSeconds$","position$","followPosition$","_buffer","handleFeatureCreation","accuracyThreshold","_accuracyThreshold","olGeolocation","getTracking","setTracking","followPosition","_followPosition","deleteGeolocationFeatures","deleteFeatureByType","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","interval","updateArrowFeatureOrientation","position4326","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","setGeometry","addOlFeature","bufferFeature","bufferFeatureExists","bufferGeometry","edgeRatios","areOutOfView","MapViewController","maxLayerZoomExtent","extent$","extent$$","states","stateIndex","stateHistory","setPadding","right","left","onMoveEnd","monitorRotation","getRotation","calculateExtent","getSize","getScale","getScaleFromResolution","getUnits","cancelAnimations","easing","oleasing","MapViewAction","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","fit","isFinished","setState","viewStatesAreEqual","HoverFeatureDirective","pointerHoverFeatureStore","store$$","selectionLayer","selectionMVT","mvtStyleOptions","pointerMoveListener","singleClickMapListener","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","mapProjection","listenToMapPointerMove","subscribeToPointerStore","hoverFeatureMarkerStyle","renderMode","declutter","olVectorTileSource","createHoverStyle","localHoverStyle","hasLabelStyle","textBaseline","backgroundFill","backgroundStroke","unlistenToMapPointerMove","unsubscribeToPointerStore","unlistenToMapSingleClick","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","getLayerByOlUId","ol_uid","canProcessHover","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","myLayerVectorTile","setSource","then","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","getOrientedFlatCoordinates","coords","flatCoords","idx","parseFloat","getLinkedLayersOptions","getIgoLayerByLinkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","layerHasLinkWithProperty","hasLinkWithProperty","layerLLOptions","currentLinkId","parents","pl","getDirectChildLayersByProperty","lid","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","getRootParentByDeletion","getDirectParentLayerByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","initLayerSyncFromRootParentLayers","rootLayersByProperty","plbp","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","PointerPositionDirective","pointerPositionDelay","pointerPositionCoord","onPointerEvent","lonlat","MapService","LayerWatcher","propertyChange$","unwatchLayer","setPropertyChange","watchLayer","layer$$","Waiting","layersAddedByClick$","queryResultsOverlay","searchResultsOverlay","swipeEnabled$","selectedFeatures$","bufferDataSource","layerWatcher","mapViewOptions","defaultOptions","attribution","projectionCode","olproj4","proj4","olControlAttribution","olControlScaleLine","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","pc","viewOptions","constrainResolution","getControls","removeControl","getBaseLayers","setMinZoom","setMaxZoom","getLayerById","getLayerByAlias","olUId","getLayerByOlLayer","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","newLayers","layersToRemove","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","clbd","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","_layer","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","conf","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","convertDMSToDD","epsgUtm","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","decimal","lonLatDMS","ceil","int","state1","state2","tolerance","trunc","formatScale","inchesPerMeter","originalEvent","altKey","MAC","metaKey","ctrlKey","roundCoordToString","lonLatConversion","projections","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZone","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZone","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","MapOfflineDirective","initialOnline","forcedOffline","online","handleLayersOnlineState","handleNonOfflinableLayerResolution","offlinableByUrlSourceOptions","pathOffline","setUrl","ProjectionService","registerProjection","def","lon0","defs","zoneMtm","lonMin","deltaLon","zoneUtm","computeProjectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","detectFileEPSG","nbLines","geojson","crs","lines","line","SwipeControlComponent","pos1","pos3","inDragAction","swipeEnabled$$","boundPrerender","prerender","getListOfLayers","displaySwipe","displaySwipeOff","swipeId","postrender","dragDown","clientX","mouseSwipe","onmouseup","closeDragMouseElement","touches","touchSwipe","ontouchend","closeDragTouchElement","offsetLeft","changedTouches","onmousemove","ontouchmove","mapSize","tl","getRenderPixel","tr","br","beginPath","moveTo","lineTo","closePath","clip","restore","WakeLockButtonComponent","noSleep","NoSleep","userAgent","satisfies","ie","edge","chrome","firefox","opera","safari","disableWakeLock","enableWakeLock","toggleWakeLock","ZoomButtonComponent","getMinZoom","getMaxZoom","MeasureFormatPipe","unitAbbr","out","MeasureAreaUnit","squareMetersToUnit","MeasureLengthUnit","metersToUnit","formatMeasure","measureLengthUnit","Meters","Kilometers","Miles","Feet","area","measureAreaUnit","SquareMeters","SquareKilometers","SquareMiles","Acres","Hectares","perimeter","MeasurerDialogComponent","onNoClick","MeasurerDialogComponent_table_4_Template","MeasurerDialogComponent_table_5_Template","measureUnit_r1","MeasurerItemComponent","measure$","measure$$","measureType","measureUnit","measure","auto","toggleAutoUnit","_auto","measureUnitChange","measureUnits","MeasureType","Area","onMeasureUnitChange","computeBestMeasureUnit","computeBestAreaUnit","Length","computeBestLengthUnit","MeasurerItemComponent_mat_option_8_Template","onToggleDisplayLines","displayLines","onToggleDisplayDistance","displayDistance","onToggleDisplayAreas","displayAreas","onLengthUnitChange","activeLengthUnit","measure_r17","measureUnitsAuto","activeMeasureType","onAreaUnitChange","activeAreaUnit","MeasurerComponent_ng_container_29_igo_measurer_item_1_Template","MeasurerComponent_ng_container_29_igo_measurer_item_2_Template","_r27","onCalculateClick","onDeleteClick","MeasurerComponent","tableTemplate","hasLine$","hasArea$","showTooltips","drawControlIsDisabled","drawLineControl","drawPolygonControl","modifyControl","activeOlGeometry","onFeatureAddedKey","onFeatureRemovedKey","activeDrawControl","drawStart$$","drawEnd$$","drawChanges$$","modifyStart$$","modifyEnd$$","modifyChanges$$","selectedFeatures$$","olDrawSource","setActiveMeasureType","_activeMeasureType","minSegmentLength","drawControlIsActive","getSavedUnits","createDrawLineControl","createDrawPolygonControl","createModifyControl","toggleDrawControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleDrawControl","deactivateDrawControl","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","elements","getElementsByClassName","saveCurrentUnits","refreshTableAndTooltip","updateTooltipsOfOlGeometry","sum","openDialog","selectedFeature","drawingLayerFeature","onModifyClick","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","createMeasureLayerStyle","many","updateMeasureOfOlGeometry","objectsExists","objectExist","createMeasureInteractionStyle","OlStyle","activateDrawControl","drawControl","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","addFeatureToStore","measureOlGeometry","onModifyChanges","_measure","featureId","lengths","olMidpointsTooltips","updateOlTooltipsAtMidpoints","updateOlTooltip","updateOlTooltipAtCenter","showTooltipsOfOlGeometry","getTooltipsOfOlGeometry","olTooltip","shouldShowTooltip","addOverlay","removeOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","distanceUnit","areaUnit","MeasurerComponent_mat_divider_13_Template","MeasurerComponent_mat_slide_toggle_15_Template","MeasurerComponent_mat_divider_17_Template","MeasurerComponent_mat_slide_toggle_20_Template","MeasurerComponent_mat_slide_toggle_22_Template","MeasurerComponent_mat_divider_24_Template","MeasurerComponent_ng_container_29_Template","MeasurerComponent_mat_divider_31_Template","MeasurerComponent_button_35_Template","MeasurerComponent_button_38_Template","MeasureLengthUnitAbbreviation","SquareFeet","MeasureAreaUnitAbbreviation","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","conversion","val","parts","minimumFractionDigits","maximumFractionDigits","converted","possibleUnits","lineDash","measureOlGeometryLength","olGetLength","measureOlGeometryArea","olGetArea","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","expectedNumber","clearOlMidpointTooltip","typeGeom","createOlTooltipAtPoint","setPosition","olCenter","updateOlGeometryCenter","centerCoordinate","olGetCenter","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","srcGeomType","OlOverlay","stopEvent","System","GeoDBService","collisionsMap","_newData","compression","Compression","regionID","insertSource","compress","geoDBData","object$","compressBlob","compressed","currentRegionID","collisions","decompressBlob","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","DBMode","readonly","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","newData","GeoNetworkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","setFeatures","removeOlFeature","addOlFeatures","removeFeatures","overlayDataSource","createOverlayLayerStyle","jsGeoPdfPlugin","jsPDFAPI","setGeoArea","pdfExt","geoExt","bbox","minx","maxx","maxy","miny","bounds","bbox_obj","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","toLocaleDateString","events","bbox_id","PrintService","zipFile","nbFileToProcess","mapPrintExtent","imgSizeAdded","TEXTPDFFONT","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","legendPostion","legendPosition","GeoPdfPlugin","API","baseMargins","titleSizes","subtitleSizes","subtitle","PrintPaperFormat","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","addTextInPdfDoc","marginLeft","comment","addComment","showProjection","showScale","addProjScale","handleMeasureLayer","addGeoRef","addLegendSamePage","addLegend","saveDoc","docHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","addCanvas","getLayersLegendHtml","legends","getLayersLegends","legendUrls","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","toPromise","canvas","useCORS","catch","removeHtmlElement","generateCanvaFileToZip","saveCanvasImageAsFile","removeChild","fontStyle","setFont","textMarginLeft","textDimensions","getTextDimensions","w","h","verticalSpacing","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","textProjScale","scaleText","mapScale","imageSize","pourcentageReduction","imgData","_this5","marginsLegend","defineNbFileToProcess","ms","getImageSizeToFitPdf","rect","_this6","viewResolution","dimensionPixels","setMapResolution","_ref2","mapCanvas","getViewport","mapResultCanvas","drawMap","resetOriginalMapSize","drawMapControls","mapStatus$$","mapStatus","_x2","initialSize","widthPixels","heightPixels","scaling","updateSize","renderSync","_this7","handleCanvas","mapContextResult","getContext","parentElement","globalAlpha","matrix","CanvasRenderingContext2D","setTransform","fillStyle","fillRect","drawImage","_this8","mapOverlayHTML","getOverlayContainerStopEvent","cloneNode","addNorthDirection","addAttribution","canvasOverlayHTML","allowTaint","northDirection","HTMLButton","HTMLattribution","setAttribute","downloadMapImage","printResolution","_this9","initialMapSize","_ref3","addLegendToImage","newCanvas","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","fileNameWithExt","tfwFileNameWithExt","substring","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","_x3","setMapImageResolution","scaleFactor","newMapSize","_this10","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","renderMap","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","that","toBlob","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","PrintOutputFormat","strEnum","PrintOrientation","PrintResolution","PrintSaveImageFormat","QueryDirective","queries$$","queryFeatures","queryFeaturesHitTolerance","queryFeaturesCondition","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","layerIsQueryable","query$","clickedFeatures","featureOL","values_","queryFormatAsWms","newFeature","nom","id_","sourceTitle","getAllowedFieldsAndAlias","OlRenderFeature","getQueryTitle","olLayerFeatureIsQueryable","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","ESRIJSON","TEXT","HTMLGML2","IFRAME","QueryService","defaultFeatureCount","featureCount","previousMessageIds","queryLayer","getQueryUrl","urlGml","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","olgeom","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","o","lower","upper","imposedGeometry","queryDataSource","extractGML3Data","extractGeoJSONData","extractEsriJSONData","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","order","searchParams","bboxRaw","threshold","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","bodyTagStart","bodyTagEnd","striptags","queryString","pairs","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","tileArcGISRestDatasource","deltaX","mime","getLabelMatch","labelMatch","labelToGet","matchAll","layerFeatureIsQueryable","queryLayerFeatures","onClearButtonClick","handleSearch","onSearchTypeChange","searchTypes","searchType$","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","onSearchSettingsChange","pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","SearchBarComponent","searchSourceService","placeholder$","term$$","stream$","stream$$","searchType$$","researches$$","showSearchButton","SEARCH_TYPES","withDivider","setSearchType","setTerm","term$","_reverseSearchCoordsFormatEnabled","floatLabel","appearance","termSplitter","minLength","searchSelector","searchSettings","searchTermChange","searchTypeChange","clearFeature","searchSettingsChange","input","onSetTerm","handlePlaceholder","onSetSearchType","onKeyup","doSearch","reverseCoordEvent","slug","getEnabledSources","ss","rawTerm","terms","research","onResearchCompleted","newResults","SearchBarComponent_mat_label_3_Template","SearchBarComponent_button_10_Template","SearchBarComponent_mat_divider_12_Template","SearchBarComponent_button_14_Template","SearchBarComponent_igo_search_selector_15_Template","SearchBarComponent_igo_search_settings_16_Template","_c1","SearchSelectorComponent","SearchSettingsComponent","layer_r2","SaveFeatureDialogComponent","filteredLayers$","SaveFeatureDialogComponent_mat_option_13_Template","SearchResultsItemComponent","onMouseEvent","computeTooltip","isPreview$","getBadgeIcon","inRange$","isVisible$","addFeatureToLayer","addFeatureToLayerTooltip$","SearchResultAddButtonComponent","layersSubcriptions","mouseInsideAdd","saveSearchResultInLayer","allLayers","dataType","isVisible","currEvent","addLayerToMap","removeLayerFromMap","oLayer","activeStore","layerTitle","Circle","Stroke","Fill","layerCounterID","numberId","searchLayer","clearLabelsOfOlGeometry","SearchResultAddButtonComponent_button_0_Template","SearchResultAddButtonComponent_button_1_Template","MatBadgeModule","showIcons","tooltipHtml","SearchResultsItemComponent_ng_template_3_span_0_Template","onZoomHandler","withZoomButton","zoomEvent","olFormatGeoJSON","hideBtn","showBtn","SearchResultsItemComponent_mat_icon_1_Template","SearchResultsItemComponent_div_2_Template","SearchResultsItemComponent_ng_template_3_Template","SearchResultsItemComponent_button_6_Template","group_r4","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_ng_container_1_Template","computeGroupTitle","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_ng_container_0_Template","result_r20","resultFocus","resultUnfocus","onResultSelect","templateSearchToolbar","displayMoreResults","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_ng_template_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_span_1_Template","results_r17","isMoreResults","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_Template","searchResultMode","Grouped","SearchResultsComponent_igo_list_0_ng_template_1_Template","results$","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_ng_container_1_Template","group_r39","_r37","_c3","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_Template","ctx_r32","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_ng_container_0_Template","group_r42","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_Template","result_r47","_r49","ctx_r51","ctx_r52","ctx_r53","_r56","group_r44","SearchResultsComponent_igo_list_1_ng_template_6_ng_template_0_Template","SearchResultsComponent_igo_list_1_ng_template_6_span_1_Template","SearchResultsComponent_igo_list_1_ng_container_1_Template","SearchResultsComponent_igo_list_1_ng_template_2_Template","SearchResultsComponent_igo_list_1_ng_template_4_Template","SearchResultsComponent_igo_list_1_ng_template_6_Template","_r33","_r35","SearchResultMode","Flat","SearchResultsComponent","showResultsCount","settingsChange$$","pageIterator","tabsMode","settingsChange$","resultSelect","moreResults","resultMouseenter","resultMouseleave","_results$","liftResults","EMPTY","groupResults","sortByOrder","r1","r2","displayOrder","grouped","sourceResults","limit","nextPage","SearchResultsComponent_igo_list_0_Template","SearchResultsComponent_igo_list_1_Template","NgTemplateOutlet","searchType_r2","getSearchTypeTitle","enableSourcesByType","SearchSelectorComponent_mat_radio_button_9_Template","checkUncheckAllSources","searchSourcesAllEnabled","source_r6","settingValue_r18","setting_r13","settingsValueCheckedRadioButton","getAvailableHashtagsValues","SearchSettingsComponent_ng_container_8_ng_container_7_span_6_mat_radio_button_2_Template","checkUncheckAll","allEnabled","settingValue_r32","_r36","settingsValueCheckedCheckbox","displayBlock","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_div_1_Template","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_div_2_Template","getAvailableValues","SearchSettingsComponent_ng_container_8_ng_container_7_span_6_Template","SearchSettingsComponent_ng_container_8_ng_container_7_span_7_Template","_r42","onCheckSearchSource","SearchSettingsComponent_ng_container_8_button_3_Template","SearchSettingsComponent_ng_container_8_button_4_Template","SearchSettingsComponent_ng_container_8_ng_container_7_Template","settings","_r44","changePointerReverseSearch","hasPointerReverseSearchSource","lastKeyTime","searchSourceChange","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","getSources","sourceCanSearch","showInSettings","reverseSearchSources","sourceCanReverseSearch","computeSourcesCheckAllBehavior","sourceCanReverseSearchAsSummary","setting","settingValue","setParamFromSetting","computeSettingCheckAllBehavior","enabledSourcesCnt","disabledSourcesCnt","storage","hashtags","changeSearchResultsGeometry","reverseSearchCoordsFormat","SearchSettingsComponent_div_7_Template","SearchSettingsComponent_ng_container_8_Template","SearchSettingsComponent_mat_slide_toggle_12_Template","NgSwitch","NgSwitchCase","SearchPointerSummaryDirective","pointerSearchStore","reverseSearch$$","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","mouseleave","pointerPositionSummaryMarkerStyle","ngAfterContentChecked","unsubscribeReverseSearch","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","pointerSummaryTitle","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","reverseSearch","_results","onSearch","pointerSummary","SearchSourceService","setWorkspaces","workspaces","SearchService","analyticsService","searchTerm","signal","analytics","handleAnalytics","effect","termIsValid","getEnabledOnly","searchSources","asPointerSummary","reverseSourceFonction","showInPointerSummary","findDiff","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","delta","SearchSource","getDefaultOptions","searchUrl","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","fw","datasets","saveInStorage","confValue","storageOptions","getHashtagsValid","settingsName","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","_converters","_renderers","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertPointToPixel","_transformColor","_getResolutionForScale","mpu","_transformAngle","angle","weight","family","verticalAlignment","horizontalAlignment","xoffset","yoffset","_convertOutline","ol3Rad","radius2","_convertLabelingInfo","labelingInfo","mapUnits","ii","labelExpression","getText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","hash","layerInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","customStyle","isValidJSON","cos","StyleService","olStyles","svgIconColor","svgOutlineColor","newOutlineColor","anchor","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","parsedStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","guessTypeFeature","labelStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","image_","radiusCalc","generateWMSIdFromSourceOptions","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","generateArcgisRestIdFromSourceOptions","osm","tiledebug","chain","standardizeUrl","urlStandardized","IgoDirectionsModule","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","year","years","getFullYear","month","getMonth","day","getUTCDate","getUTCHours","getUTCMinutes","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","interfaceOgcFilters","setOgcWMSFiltersOptions","filtered","SpatialFilterType","Predefined","Polygon","SpatialFilterItemType","Address","Thematics","SpatialFilterService","urlFilterList","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","getKeyByValue","loadFilterList","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","DownloadButtonComponent_button_0_Template","item_r6","toggleLegendItem","computeItemTitle","style_r18","onChangeStyle","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_mat_option_4_Template","onLoadImage","imgGraphValue","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_img_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_small_2_Template","imagesHeight","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_mat_list_item_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_Template","items_r1","LayerLegendComponent_ng_container_0_ng_container_1_Template","LayerLegendComponent_ng_container_0_ng_template_2_Template","LayerLegendComponent","updateLegendOnResolutionChange","legendItems$","renderedLegends","lastlLegend","listStyles","STYLES","onViewControllerStateChange","getLegendGraphic","obsLegGraph","leg","transfertToggleLegendItem","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegend","LayerLegendComponent_ng_container_0_Template","WktService","wktToFeature","wkt","wktProj","featureProj","olWKT","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","array","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","OGCFilterTimeService","defaultStepMillisecond","currentFilter","stepMillisecond","asMilliseconds","stepIsYearDuration","months","weeks","days","hours","stepIsMonthDuration","stepIsWeekDuration","week","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","dateToNumber","newDate","addStep","toDate","subtractStep","OgcFilterTimeSliderComponent","ogcFilterTimeService","changeProperty","slider","sliderValue","calculatedStep","_defaultDisplayFormat","_defaultSliderInterval","playIcon","resetIcon","sliderInterval","displayFormat","beginMillisecond","maxMillisecond","sliderDisplayWith","calculateStep","handleSliderInput","dateTmp","toAdd","playFilter","stopFilter","_emitInputEvent","resetFilter","matSliderChange","dateBeginTmp","dateEndTmp","toISOString","refreshFilter","startOf","MatSlider","_r1","MatSliderModule","sliderMode","modeChange","changePropertyByPass","beginValue","restrictedToStep","endValue","yearOnlyInputChange","yearSelected","toggleFilterState","onlyYearBegin","filterStateDisable","calendarView","handleDate","onlyYearEnd","hour_r27","minute_r28","changeTemporalProperty","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_12_Template","beginHourFormControl","beginHours","beginMinuteFormControl","beginMinutes","hour_r37","minute_r38","_r40","ctx_r39","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_12_Template","endHourFormControl","endHours","endMinuteFormControl","endMinutes","_r43","monthSelected","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_Template","filterEndFunction","calendarType","_r47","OgcFilterTimeComponent_div_3_div_2_div_10_Template","OgcFilterTimeComponent_div_3_div_2_div_11_Template","filterBeginFunction","OgcFilterTimeComponent_div_3_div_1_Template","OgcFilterTimeComponent_div_3_div_2_Template","calendarTypeYear","OgcFilterTimeComponent","_beginValue","_endValue","_defaultMin","_defaultMax","_defaultSliderModeEnabled","ogcFilterOperator","endDatepickerTime","beginDatepickerTime","beginTime","endTime","filterOriginConfig","stepMilliseconds","parseFilter","handleMin","handleMax","getUTCFullYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","isNaN","intervalInt","_now","getDateFromStringWithoutTime","valueTmp","getDateTime","dateStringFromYearNotime","changeEvent","datePicker","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","setHours","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","getHours","fullEndHoursArray","fullBeginMinutesArray","getMinutes","fullEndMinutesArray","beginTmp","endTmp","restrictToStep","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","OgcFilterTimeComponent_mat_slide_toggle_1_Template","OgcFilterTimeComponent_div_2_Template","OgcFilterTimeComponent_div_3_Template","field_r12","clearSelectedField","inputClearable","updateFieldsList","changeField","OgcFilterFormComponent_mat_form_field_14_mat_option_10_Template","OgcFilterFormComponent_mat_form_field_14_button_12_Template","selectedField$","filteredFields$","operator_r20","igoSpatialSelector_r22","changeSpatialSelector","OgcFilterFormComponent_mat_form_field_28_mat_option_2_Template","igoSpatialSelectors","value_r28","clearProperty","ctx_r33","updateValuesList","ctx_r35","OgcFilterFormComponent_mat_form_field_30_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_30_button_7_Template","_r25","detectProperty","filteredValues$","isClearable","_r38","ctx_r37","changeSNRC","OgcFilterFormComponent_mat_form_field_36_button_3_Template","_r45","changeMapExtentGeometry","OgcFilterFormComponent_ng_container_38_button_1_Template","value_r49","_r53","ctx_r55","changeNumericProperty","OgcFilterFormComponent_mat_form_field_41_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_41_button_7_Template","_r46","value_r60","_r62","ctx_r61","_r64","ctx_r63","ctx_r65","ctx_r66","ctx_r67","OgcFilterFormComponent_mat_form_field_42_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_42_button_7_Template","_r69","ctx_r68","OgcFilterFormComponent","wktService","allOgcFilterOperators","ogcFilterOperators$","inputOperator","fields$","currentFilterIsSpatial$","refreshFilters","_snrc","activeFilters","sFields","excludeFromOgcFilters","sfs","currentFilterIsSpatial","_filterFields","_filterValues","keywordRegex","detectedProperty","deleteFilter","changeLogical","changeOperator","changeCaseSensitive","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterFormComponent_mat_form_field_14_Template","OgcFilterFormComponent_mat_option_25_Template","OgcFilterFormComponent_mat_form_field_28_Template","OgcFilterFormComponent_mat_form_field_30_Template","OgcFilterFormComponent_mat_form_field_36_Template","OgcFilterFormComponent_ng_container_38_Template","OgcFilterFormComponent_mat_form_field_41_Template","OgcFilterFormComponent_mat_form_field_42_Template","OgcFilterFormComponent_igo_ogc_filter_time_43_Template","_c4","DOMService","getDom","dom","selectorGroup_r11","currentPushButtonsGroup","OgcFilterSelectionComponent_div_1_div_1_div_2_mat_option_4_Template","getPushButtonsGroups","ogcPushButton_r16","selector_r2","getToolTip","getButtonColor","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_mat_button_toggle_4_Template","bundle_r14","bundleIsVertical","OgcFilterSelectionComponent_div_1_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_Template","selectorGroup_r23","currentCheckboxesGroup","OgcFilterSelectionComponent_div_1_div_2_div_2_mat_option_4_Template","getCheckboxesGroups","ogcCheckbox_r29","ctx_r30","displayLessResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_1_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_2_Template","isLessResults","bundle_r26","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_Template","OgcFilterSelectionComponent_div_1_div_2_div_2_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_Template","selectorGroup_r43","currentRadioButtonsGroup","OgcFilterSelectionComponent_div_1_div_3_div_2_mat_option_4_Template","getRadioButtonsGroups","emptyRadioButtons","ogcRadioButton_r52","_r54","_r59","_r61","ctx_r60","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_1_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_2_Template","bundle_r46","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_4_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_5_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_Template","unfiltered","OgcFilterSelectionComponent_div_1_div_3_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_Template","selectorGroup_r66","_r68","currentSelectGroup","OgcFilterSelectionComponent_div_1_div_4_div_2_mat_option_4_Template","getSelectGroups","_r75","ctx_r74","emptySelect","_r80","ctx_r79","selectAllSelected","ctx_r81","toggleAllSelection","bundle_r69","ctx_r83","selectOptionClick","ctx_r78","ogcSelect_r82","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_option_5_Template","_r91","ctx_r89","ctx_r87","ogcSelect_r88","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_mat_option_1_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_Template","_r73","OgcFilterSelectionComponent_div_1_div_4_div_2_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_Template","autocompleteGroup_r96","_r98","currentAutocompleteGroup","OgcFilterSelectionComponent_div_1_div_5_div_2_mat_option_4_Template","ctx_r93","getAutocompleteGroups","_r103","ctx_r102","emptyAutocomplete","ogcAutocomplete_r108","_r110","ctx_r109","autocompleteOptionClick","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_option_6_Template","bundle_r99","ctx_r101","filteredOgcAutocomplete","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_Template","ctx_r94","OgcFilterSelectionComponent_div_1_div_5_div_2_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_Template","OgcFilterSelectionComponent_div_1_div_1_Template","OgcFilterSelectionComponent_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_Template","OgcFilterSelectionComponent_div_1_div_4_Template","OgcFilterSelectionComponent_div_1_div_5_Template","ctx_r113","OgcFilterSelectionComponent_div_2_h3_2_Template","OgcFilterSelectionComponent_div_2_h3_3_Template","_r115","ctx_r114","OgcFilterSelectionComponent","ogcFilterService","domService","sel","checkboxesIndex","radioButtonsIndex","baseIndex","_currentFilter","selectEnabled$","selectEnableds$","autocompleteEnabled$","applyFiltersTimeout","ogcFiltersSelectors","ogcSelector","patchValue","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","compSelect","applyFilters","selectEnableds","autocompleteEnabled","selectMulti","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","toolTip","domSelectors","domValues","domSelector","filterDOM","domOptions","newBundle","comp","pushButton","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","currentGroups","currentGroup","selectorsLength","OgcFilterSelectionComponent_div_1_Template","OgcFilterSelectionComponent_div_2_Template","i16","refreshFunc","currentFilter_r3","OgcFilterableFormComponent_1_ng_template_0_Template","OgcFilterableFormComponent","MAT_SELECT_CONFIG","overlayPanelClass","MAT_AUTOCOMPLETE_DEFAULT_OPTIONS","OgcFilterableFormComponent_igo_ogc_filter_selection_0_Template","OgcFilterableFormComponent_1_Template","toggleFiltersCollapsed","filtersCollapsed","toggleLegendOnClick","addFilterToSequence","addFilterDisabled","inResolutionRange$","OgcFilterableItemComponent_div_9_igo_layer_legend_2_Template","showLegend$","changeOgcFilterType","OgcFilterableItemComponent","lastRunOgcFilter","defaultLogicalParent","hasActiveSpatialFilter","filtersAreEditable","hasSelector","arr","lastLevel","firstFieldName","includedFields","firstOperatorName","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","toggleLegend","OgcFilterableItemComponent_mat_icon_2_Template","OgcFilterableItemComponent_span_3_Template","OgcFilterableItemComponent_button_5_Template","OgcFilterableItemComponent_button_6_Template","OgcFilterableItemComponent_div_9_Template","OgcFilterableItemComponent_section_11_Template","OgcFilterButtonComponent_div_1_igo_ogc_filterable_item_2_Template","ogcFilterCollapse","OgcFilterButtonComponent","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","cntRadioButtons","radio","cntSelect","cntAutocomplete","filterActiveValue","OgcFilterButtonComponent_button_0_Template","OgcFilterButtonComponent_div_1_Template","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","OgcFilterableListComponent","OgcFilterableListComponent_div_1_Template","OgcFilterableListComponent_ng_template_3_Template","OgcFilterableListBindingDirective","GeometryType","LineString","LabelType","Coordinates","Custom","CoordinatesUnit","DecimalDegree","DegreesMinutesSeconds","DrawIconService","icons","getIconsList","getIcons","createInteractionStyle","Olstyle","DDtoDMS","numVal","FontType","Arial","ArialBlack","Verdana","Tahoma","TrebuchetMS","Impact","TimesNewRoman","Georgia","AmericanTypewriter","Courier","LucidaConsole","BrushScriptMT","ComicSansMS","handleChange","handleClick","colorPicker","ColorPickerFormFieldComponent","isOpen","formatColor","onTouch","colorChange","writeValue","registerOnChange","fn","registerOnTouched","rgb","tinycolor","toHexString","toRgbString","toHsvString","NG_VALUE_ACCESSOR","forwardRef","ColorPickerFormFieldComponent_ng_template_5_Template","CdkOverlayOrigin","CdkConnectedOverlay","ColorChromeModule","DrawStyleService","labelsAreShown","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","getFontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","textToShow","textIgoStyleObject","flatCoordinates","fontSelect_r6","StyleModalDrawingComponent","drawStyleService","confirmFlag","styleModalData","linestringOnly","buildStyleData","getFeatureFillColor","getFeatureStrokeColor","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureOffsetX","getFeatureOffsetY","cancelDrawing","openPicker","closePicker","StyleModalDrawingComponent_ng_container_6_Template","StyleModalDrawingComponent_mat_option_28_Template","DrawLayerPopupComponent","labelString","onLabelTypeChange","option_r8","optionAvailable","getProperLengthLabel","DrawPopupComponent_ng_container_3_mat_radio_group_14_mat_radio_button_1_Template","arrayBuiltInType","option_r12","DrawPopupComponent_ng_container_3_ng_container_15_mat_checkbox_1_Template","unit_r17","onChangeCoordinateUnit","DrawPopupComponent_ng_container_3_div_16_mat_option_8_Template","currentCoordinates","coordinatesMeasureUnit","allCoordinatesUnits","unit_r22","getLengthUnitEnum","onChangeLengthUnit","DrawPopupComponent_ng_container_3_div_17_mat_option_8_Template","lengthLabelT","currentLength","lengthMeasureUnit","allLengthUnits","unit_r27","getAreaUnitEnum","onChangeAreaUnit","DrawPopupComponent_ng_container_3_div_18_mat_option_10_Template","currentArea","areaMeasureUnit","allAreaUnits","DrawPopupComponent_ng_container_3_mat_radio_group_14_Template","DrawPopupComponent_ng_container_3_ng_container_15_Template","DrawPopupComponent_ng_container_3_div_16_Template","DrawPopupComponent_ng_container_3_div_17_Template","DrawPopupComponent_ng_container_3_div_18_Template","customOrPredefined","labelType","labelFlag","polygonCheck","noLabelButton","getLabelLength","currentLabel","DrawPopupComponent","lengthInMeters","areaInMetersSquare","coordinatesInDD","currentCoordinatesUnit","longlatDD","labelLength","longitudeLatitude","longitude","latitude","point4326","circularPolygon","buildArrayType","lengthUnit","coordinatesUnit","selectOptions","currentOption","DrawPopupComponent_ng_container_3_Template","DrawPopupComponent_ng_container_4_Template","DrawShorcutsComponent","svgIcon","MatDialogClose","onToggleFreehandMode","freehandMode","measureUnit_r12","DrawComponent_div_23_mat_option_6_Template","radiusFormControl","layer_r15","activeDrawingLayer","deleteDrawings","icon_html_r22","onIconChange","DrawComponent_mat_form_field_44_div_6_Template","DrawComponent_mat_form_field_44_mat_option_10_Template","openStyleModalDialog","DrawComponent","drawIconService","_stores","drawControls","_drawControls","_activeDrawingLayer","activeLayerChange","drawControlsEvent","layersIDEvent","draw$","activeDrawingLayerSource","drawSelect$$","fillForm","strokeForm","radiusFormControlChange$$","Subscription","numberOfDrawings","isCreatingNewLayer","currGeometryType","draw","editLabelDrawing","dc","onLayerChange","createDrawControl","changeRadius","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","extent4326","getDistance","setupLayer","onToggleLabels","selectionChange","olGeometryFeature","openShorcutsDialog","elementStyle","toggleIsChecked","isCircle","currLayer","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","updateActiveLayer","isPoint","isLineString","isPolygon","radiusMeters","pointStyle","selectedMeasureUnit","DrawComponent_mat_slide_toggle_22_Template","DrawComponent_div_23_Template","DrawComponent_mat_option_32_Template","DrawComponent_button_36_Template","DrawComponent_button_39_Template","DrawComponent_mat_form_field_44_Template","DrawComponent_button_50_Template","i17","GeometryFormFieldInputComponent","olGeoJSON","defaultDrawStyleRadius","olGeometryEnds$$","olGeometryChanges$$","createMeasureTooltip","activeControl","_geometryType","deactivateControl","freehandDrawIsActive","toggleControl","drawGuide","_drawControlIsActive","_freehandDrawIsActive","predefinedRadius","_predefinedRadius","controlOptions","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","overlayStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","onTouched","updateDrawStyleWithDrawGuide","activateControl","onOlGeometryEnds","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","GeometryFormFieldInputComponent_ng_template_0_Template","onDrawControlChange","onfreehandControlChange","measureUnit_r15","SpatialFilterItemComponent_div_7_mat_option_6_Template","bufferFormControl","measureUnit_r19","SpatialFilterItemComponent_div_8_mat_option_6_Template","onItemTypeChange","item_r23","masterToggle","isAllSelected","selectedThematics","hasValue","node_r35","onToggleChange","isSelected","node_r39","_r41","childrensToggle","treeControl","isExpanded","hasChildrenSelected","SpatialFilterItemComponent_div_14_mat_header_cell_3_Template","SpatialFilterItemComponent_div_14_mat_header_cell_5_Template","SpatialFilterItemComponent_div_14_mat_header_row_6_Template","SpatialFilterItemComponent_div_14_mat_row_7_Template","SpatialFilterItemComponent_div_14_mat_tree_node_9_Template","SpatialFilterItemComponent_div_14_mat_nested_tree_node_10_Template","displayedColumns","hasChild","clearSearch","disabledClearSearch","clearDrawZone","_r48","toggleVisibleList","SpatialFilterItemComponent_div_28_button_1_Template","entityChange","listIsVisible","SpatialFilterItemComponent","spatialFilterService","geometryTypes","drawGuide$","drawStyle$","PointStyle","PolyStyle","overlayStyle$","queryType","_store","thematicLength","_thematicLength","toggleSearch","itemTypeChange","thematicChange","drawZoneEvent","bufferEvent","zoneWithBufferChange","radiusEvent","freehandControl","clearButtonEvent","clearSearchEvent","openWorkspace","selectedItemType","selectedSourceAddress","NestedTreeControl","node","childrens","thematics","MatTreeNestedDataSource","SelectionModel","value$","value$$","radiusChanges$$","bufferChanges$$","geometryTypeField","drawGuideField","drawGuidePlaceholder","drawZone","zoneWithBuffer","localeCompare","limits","child","featureGeom","selectedRecordStrategy","selectionStrategy","detach","isPredefined","collapse","numSelected","numNodes","bool","selectedThematicsName","nodeSelected","toggleSearchButton","createTableTemplate","clearButton","disableSearchButton","formValue","typeColumn","nameColumn","SpatialFilterItemComponent_mat_slide_toggle_5_Template","SpatialFilterItemComponent_mat_slide_toggle_6_Template","SpatialFilterItemComponent_div_7_Template","SpatialFilterItemComponent_div_8_Template","SpatialFilterItemComponent_mat_radio_button_13_Template","SpatialFilterItemComponent_div_14_Template","SpatialFilterItemComponent_button_16_Template","SpatialFilterItemComponent_button_17_Template","SpatialFilterItemComponent_button_27_Template","SpatialFilterItemComponent_div_28_Template","MatTreeModule","entities_r4","measureUnit_r5","SpatialFilterListComponent","_queryType","_zone","selectedZone","zoneChange","bufferChange","bufferValueChanges$$","onZoneChange","SpatialFilterListComponent_mat_option_10_Template","SpatialFilterListComponent_mat_option_22_Template","queryType_r1","SpatialFilterTypeComponent","selectedTypeIndex","spatialType","activeDrawType","selectedQueryType","eventType","eventQueryType","onTypeChange","onDrawTypeChange","SpatialFilterTypeComponent_mat_option_8_Template","handleDateChange","startDate","endDate","getRangeMaxDate","getRangeMinDate","TimeFilterFormComponent_div_0_div_1_Template","TimeFilterFormComponent_div_0_div_2_Template","isRange","year_r21","handleYearChange","TimeFilterFormComponent_div_1_div_1_mat_option_4_Template","listYears","startYear_r27","endYear_r28","startYear","TimeFilterFormComponent_div_1_div_2_mat_option_5_Template","endYear","TimeFilterFormComponent_div_1_div_2_mat_option_10_Template","startListYears","endListYears","TimeFilterFormComponent_div_1_div_1_Template","TimeFilterFormComponent_div_1_div_2_Template","handleSliderYearChange","TimeFilterFormComponent_div_3_p_9_Template","playYear","handleSliderValue","handleSliderDateChange","handleSliderTooltip","TimeFilterFormComponent","initStartYear","initEndYear","valueArray","valueOf","yearChange","mySlider","getStepDefinition","timeInterval","getTimezoneOffset","is","checkFilterValue","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","setSliderThumbLabel","thumbLabel","findThumbLabel","childNodes","textContent","newMinDateNumber","maxDateNumber","getRoundedDate","toDateString","toTimeString","setSeconds","setMinutes","getDay","selectedHour","selectedMinute","atMinute","coeff","TimeFilterFormComponent_div_0_Template","TimeFilterFormComponent_div_1_Template","TimeFilterFormComponent_div_3_Template","TimeFilterFormComponent_div_4_Template","MatDatetimepickerModule","TimeFilterItemComponent_mat_list_item_0_button_5_Template","TimeFilterItemComponent","timeFilterService","TimeFilterItemComponent_mat_list_item_0_Template","TimeFilterItemComponent_igo_layer_legend_5_Template","TimeFilterButtonComponent_div_1_igo_time_filter_item_2_Template","timeFilterCollapse","TimeFilterButtonComponent","TimeFilterButtonComponent_button_0_Template","TimeFilterButtonComponent_div_1_Template","layer_r1","TimeFilterListComponent","_layers","TimeFilterListComponent_ng_template_1_Template","TimeFilterListBindingDirective","ExportButtonComponent","layerIsExportable","workspaceId","ExportButtonComponent_button_0_Template","StyleListService","styleList","baseStyleList","styleListResponse","ExportInvalidFileError","ExportFormat","EncodingFormat","ExportService","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon","ogreUrl","aggregateInComment","gpxAggregateInComment","encoding","exportOlFeatures","excludePrefix","generateAggregatedFeature","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","featuresText","fileName","encodingType","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","fromCharCode","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","ImportSRSError","ImportOgreServerError","padTo2Digits","num","padStart","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","addLayerAndFeaturesToMap","searchIndexEnabled","handleSRSImportError","handleOgreServerImportError","ImportService","importConfig","clientSideFileSizeMaxMb","formats","formatExtensionAssociation","zipMimeTypes","allowedZipMimeTypes","importFileWithOgre","parseFeaturesFromFile","FormData","parseFeaturesFromGeoJSON","errMsg","msg","writeFeatureObject","projection_r6","translateKey","ImportExportComponent_form_8_mat_option_7_p_1_Template","ImportExportComponent_form_8_mat_option_7_p_2_Template","ImportExportComponent_form_8_mat_option_7_Template","importForm","projections$","invalid","importHtmlClarifications","ImportExportComponent_section_9_div_1_Template","ImportExportComponent_section_9_igo_custom_html_2_Template","layer_r29","onlySelectedClick","inLayersIdToExportSelectionOnly","onlySelected","ImportExportComponent_form_12_mat_option_10_mat_slide_toggle_4_Template","layerHasSelectedFeatures","format_r40","ImportExportComponent_form_12_ng_container_18_mat_option_1_Template","formats$","encoding_r43","ImportExportComponent_form_12_div_23_ng_container_6_mat_option_1_Template","encodings$","ImportExportComponent_form_12_div_23_ng_container_6_Template","exportHtmlClarifications","ImportExportComponent_form_12_span_9_Template","ImportExportComponent_form_12_mat_option_10_Template","ImportExportComponent_form_12_ng_container_18_Template","ImportExportComponent_form_12_mat_option_20_Template","ImportExportComponent_form_12_div_22_Template","ImportExportComponent_form_12_div_23_Template","ImportExportComponent_form_12_div_24_Template","ImportExportComponent_form_12_div_25_Template","ImportExportComponent_form_12_div_26_Template","ImportExportComponent_form_12_igo_custom_html_36_Template","getLayerTitleById","exportableLayers$","combineLayers","ImportExportComponent","importService","controlFormat","exportableLayers$$","formats$$","encodings$$","formLayer$$","exportOptions$$","espgCodeRegex","projectionsConstraints","popupChecked","previousLayerSpecs$","selectFirstProj","_projectionsLimitations","computeProjections","selectedMode","selectMode","exportOptions$","exportOptionsChange","popupAllowed","loadConfig","exportOptions","computeFormats","handlePopup","handlePreviousLayerSpecs","selectedLayers","previousSpecs","encodings","configProjection","getWorkspaceByLayerId","wksFromLayerId","wksFromLayer","layersWithSelection","specs","previousLayer","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","extraMessage","forceNamingConfig","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","validateListFormat","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","ImportExportComponent_form_8_Template","ImportExportComponent_section_9_Template","ImportExportComponent_section_10_Template","ImportExportComponent_form_12_Template","i18","i19","i20","i21","check","layerCheck","toggleVisibility","eyeTooltip","queryBadgeHidden$","toggleLayerTool","LayerItemComponent","activeLayer","_activeLayer","selectionMode","layerTool$","tooltipText","_selectAll","network$$","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","updateQueryBadge","onResolutionChange","layerTooltip","layerMetadata","inResolutionRange","LayerItemComponent_mat_checkbox_1_Template","LayerItemComponent_button_5_Template","LayerItemComponent_button_6_Template","LayerItemComponent_button_7_Template","LayerItemComponent_igo_layer_legend_10_Template","LayerLegendItemComponent","toggleShowAllLegends","showAllLegendsValue","LayerLegendListComponent_ng_template_6_igo_layer_legend_item_0_Template","excludeBaseLayers","LayerLegendListComponent","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegend","allowShowAllLegends","allLegendsShown","computeShownLayers","shownLayers","sortLayersByZindex","LayerLegendListComponent_mat_slide_toggle_1_Template","LayerLegendListComponent_mat_divider_3_Template","LayerLegendListComponent_ng_template_6_Template","LayerLegendListComponent_p_8_Template","LayerLegendListComponent_p_12_Template","LayerLegendListComponent_p_16_Template","LayerLegendListComponent_p_20_Template","LayerLegendListBindingDirective","layersOrResolutionChange$$","layersVisibility$$","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","onlyVisible$$","sortAlpha$$","layersAreAllVisible","onlyVisible","sortAlpha","appliedFilterAndSort","keyword","toggleSortAlpha","toggleOnlyVisible","toggleSelectionMode","LayerListToolComponent_button_4_Template","LayerListControlsEnum","LayerListSelectVisibleEnum","ALL_VISIBLE","ALL_HIDDEN","MIXED","NULL","LayerListDisplacement","Raise","Lower","onAppliedFilterAndSortChange","layerFilterAndSortOptions","selectAllCheck","layersChecked","layersCheck","layer_r11","getLowerLayer","getUpperLayer","expandLegendOfVisibleLayers","layerItemChangeDetection$","LayerListComponent_ng_template_6_igo_layer_item_0_Template","zoomLayerExtents","magnifyIcon","LayerListComponent_igo_panel_8_button_2_Template","moveActiveLayer","layerListDisplacement","changeOpacity","LayerListComponent_igo_panel_8_button_24_Template","isLayerRemovable","badgeOpacity","activeLayerExtentIsValid","templateLayerToolbar","checkOpacity","zoomLayersExtents","LayerListComponent_igo_panel_9_mat_slider_30_Template","LayerListComponent_igo_panel_9_button_31_Template","isAllLayersRemovable","statusSelectedLayersCheck","lowerDisabledSelection","raiseDisabledSelection","activeLayersExtentAreValid","LayerListComponent","thresholdToFilterAndSort","showToolbar$","layerTool","hideSelectedLayers","activeLayer$","ogcButton","timeButton","removeProblemLayerInList","_keyword","_onlyVisible","isUpperBaselayer","isLowerBaselayer","raisableLayers","lowerableLayers","layersCheckedOpacity","toggleOpacity","selectAllCheck$","selectAllCheck$$","computeShowToolbar","computeLayers","checks","showButtonZoomToExtent","layerExtent","layersExtent","clearKeyword","prev","actiontype","fromUi","sortedLayersToMove","layersToMove","mapIndex","currentLayer","raisableLayer","layersToRaise","checkItems","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","onKeywordChange","showToolbar","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordInList","removable","statusSelectedLayers","findTrue","findFalse","eventMapIndex","elemSource","layersList","LayerListComponent_igo_layer_list_tool_0_Template","LayerListComponent_div_2_Template","LayerListComponent_ng_template_6_Template","LayerListComponent_igo_panel_8_Template","LayerListComponent_igo_panel_9_Template","LayerListBindingDirective","setLayersVisibilityStatus","visibles","allLayersAreVisible","toggleTrackFeature","TrackFeatureButtonComponent","TrackFeatureButtonComponent_button_0_Template","MetadataService","openMetadata","MetadataButtonComponent","metadataService","MetadataAbstractComponent","MetadataButtonComponent_button_0_Template","MetadataAbstractComponent_mat_dialog_content_4_Template","MetadataAbstractComponent_mat_dialog_content_5_Template","QuerySearchSource","querySearchSourceFactory","IgoQueryModule","IgoSearchBarModule","IgoSearchResultsModule","IgoSearchSelectorModule","IgoSearchSettingsModule","searchSourceServiceFactory","provideSearchSourceService","GoogleLinks","getGoogleMapsCoordLink","getGoogleStreetViewLink","getGoogleMapsNameLink","encodeURI","OsmLinks","getOpenStreetMapLink","getOpenStreetCamLink","CoordinatesSearchResultFormatter","formatResult","CoordinatesReverseSearchSource","title$","dataToResult","dataDMS","roundedCoordString","roundedCoordStringDMS","subtitleHtml","circleGeometry","polygonGeometry","writeGeometry","GoogleMaps","GoogleStreetView","OpenStreetMap","score","coordinates_CoordinatesReverseSearchSource","SearchSourceKind","ICherche","IChercheReverse","Cadastre","CoordinatesReverse","ILayer","Nominatim","StoredQueries","StoredQueriesReverse","defaultCoordinatesSearchResultFormatterFactory","ICHERCHE_ICONS","city","bank","engine","hospital","pharmacy","parking","tree","terrain","IChercheSearchResultFormatter","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","hashtagsLieuxToKeep","getAllowedTypes","ecmax","showAdvancedParams","showAdvancedSettings","computeRequestParams","getSearch","extractResults","typeSetting","regex","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","computeProperties","highlight","title2","subtitleHtml2","title3","removeKeys","propertiesBlacklist","googleLinksProperties","googleMaps","googleMapsNom","municipalite","routing","keep","cacheHasher","customCacheHasher","IChercheReverseSearchSource","getReverseSearch","getSubtitle","computeExtent","defaultIChercheSearchResultFormatterFactory","provideDefaultIChercheSearchResultFormatter","ichercheSearchSourceFactory","withIChercheSource","kind","icherche_IChercheReverseSearchSource","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","metadataUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayer_ILayerSearchSource","IgoSearchModule","setLayerFillColor","StyleModalLayerComponent","initialValues","defaultValues","getLayerFillColor","getLayerStrokeColor","arrayColor","cAA","setLayerStrokeColor","StyleModalLayerComponent_div_6_Template","StyleModalLayerButtonComponent","OgcFilterComponent","IgoOgcFilterModule","OgcFilterWidget","ogcFilterWidgetFactory","widgetService","provideOgcFilterWidget","IgoWorkspaceSelectorModule","IgoGeoWorkspaceModule","CatalogItemType","Group","TypeCatalog","baselayers","composite","Catalog","externalProvider","forcedProperties","matrixSet","requestEncoding","regFilters","groupImpose","groupSeparator","tooltipType","sortDirection","setCrossOriginAnonymous","showLegend","WMSCatalog","_collectCatlogItems","collectCatalogItems","WMTSCatalog","BaselayersCatalog","ArcGISRestCatalog","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","baseLayersCatalog","catalogsFromApi$","catalogs","_response","loadCatalogItems","catalog","newCatalog","CatalogFactory","createInstanceCatalog","loadCatalogBaseLayerItems","getCatalogBaseLayersOptions","loadCatalogWMSLayerItems","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","loadCatalogWMTSLayerItems","getWMTSItems","loadCatalogArcGISRestItems","getArcGISRESTItems","loadCatalogCompositeLayerItems","compositeCatalog","catalogsFromInstance","request1$","request2$","flatDeepLayer","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","output","recursiveGroupByLayerAddress","keyFn","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","returnProperty","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","baseSourceOptions","propertiesToForce","baseAbstract","layerOnlineResource","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","subLayerIds","groupHandledLayersIds","groupedItems","TitleOrId","nonHandledLayers","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","catalogService","igoLayer$","CatalogBrowserLayerComponent","isPreview$$","layerLegendShown$","catalogAllowLegend","addedChange","addedLayerIsPreview","computeTitleTooltip","askForLegend","haveGroup","CatalogBrowserLayerComponent_mat_icon_1_Template","CatalogBrowserLayerComponent_button_5_Template","CatalogBrowserLayerComponent_igo_layer_legend_21_Template","CatalogBrowserGroupComponent_button_6_mat_icon_1_Template","onLayerPreview","onLayerAddedChange","item_r12","CatalogBrowserGroupComponent_ng_template_14_ng_container_0_Template","CatalogBrowserGroupComponent_ng_template_14_ng_container_1_Template","isGroup","isLayer","CatalogBrowserGroupComponent","added$","preview$","toggleCollapsed","layerAddedChange","evaluateAdded","evaluateDisabled","onToggleCollapsed","tryToggleGroup","onTitleClick","CatalogBrowserGroupComponent_button_6_Template","CatalogBrowserGroupComponent_ng_container_7_Template","CatalogBrowserGroupComponent_ng_template_10_Template","CatalogBrowserGroupComponent_ng_template_14_Template","onGroupAddedChange","item_r1","toggleCollapsedGroup","CatalogBrowserComponent_ng_template_1_ng_container_0_Template","CatalogBrowserComponent_ng_template_1_ng_container_1_Template","CatalogBrowserComponent","currentItems","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","sortCatalogItemsByTitle","returnItem","titleA","titleB","CatalogBrowserComponent_ng_template_1_Template","predefinedCatalog_r7","predefinedCatalog_r8","type_r9","addedCatalog","emailAddress","AddCatalogDialogComponent","defaultAddedCatalogType","addedCatalogType$$","predefinedCatalogsList$","typeCapabilities","predefinedCatalogs","storeViewAll$$","computePredefinedCatalogList","changeUrlOrTitle","addCatalog","AddCatalogDialogComponent_mat_option_11_Template","AddCatalogDialogComponent_mat_option_18_Template","AddCatalogDialogComponent_mat_option_23_Template","AddCatalogDialogComponent_span_24_Template","AddCatalogDialogComponent_span_25_Template","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","CatalogLibaryItemComponent_mat_icon_4_Template","CatalogLibaryItemComponent_button_5_Template","CatalogLibaryItemComponent_button_6_Template","catalog_r2","onCatalogRemove","onCatalogSelect","addCatalogDialog","layerPlusIcon","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","submitDisabled","addingCatalog$$","addedCatalogs","selectedCatalogId","selectedCatalog","getCatalogs","unsubscribeAddingCatalog","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","CatalogLibaryComponent_ng_template_1_Template","CatalogLibaryComponent_div_3_Template","GeometryFormFieldComponent","geometryType$","GeometryFormFieldComponent_div_3_Template","GeometryFormFieldComponent_mat_form_field_4_Template","IgoMapModule","maxLength","legendPosition_r9","PrintFormComponent_mat_option_43_ng_container_1_Template","PrintFormComponent_mat_option_43_ng_container_2_Template","outputFormat_r13","paperFormat_r14","imageFormat_r15","resolution_r16","orientation_r17","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintFormComponent_mat_error_8_Template","PrintFormComponent_mat_error_16_Template","PrintFormComponent_mat_error_24_Template","PrintFormComponent_mat_option_43_Template","PrintFormComponent_mat_option_52_Template","PrintFormComponent_mat_option_61_Template","PrintFormComponent_mat_option_70_Template","PrintFormComponent_mat_option_80_Template","PrintFormComponent_mat_option_88_Template","maxlength","PrintComponent","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","provideDirection","DirectionSourceKind","OSRM","OsrmDirectionsSource","_http","_config","sourceName","getSourceName","directionsParams","getRouteParams","getRoute","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","osrmDirectionsSourcesFactory","withOsrmSource","OverlayAction","ZoomIfOutMapExtent","OverlayService","features$","OverlayDirective","overlayService","features$$","handleFeatures","provideSearch","CadastreSearchSource","getCadastre","numero","lot","computeGeometry","NoLot","cadastre_CadastreSearchSource","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatim_NominatimSearchSource","StoredQueriesSearchSource","resultTitle","storedQueriesOptions","multipleFieldsQuery","storedquery_id","splitPrefix","outputformat","srsname","storedqueriesParams","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","storedqueries_StoredQueriesSearchSource","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueries_StoredQueriesReverseSearchSource","WorkspaceSearchSource","limitValue","fswi","termToUse","foundIn","gettedIndex","sortedResultToProcess","resultsCnt","workspaceSearchSourceFactory","withWorkspaceSource","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","RegexService","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","mapExtentStrategyActiveToolTip","noElementSelected","addOrRemoveLayer","addedLayerId","ws$","geoServiceAction","getGeoServiceAction","geoServiceProperties","relations","columnsFromFeatures","col","cellClass","relationsColumn","relation","class_icon","createFilterInMapExtentOrResolutionStrategy","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","adding$","getDomainValues","modifyStyle","newFeaturefilterClauseFunc","editFeaturefilterClauseFunc","deleteFeature","deleteUrl","columnName","primary","editFeature","editionOpt","original_properties","original_geometry","idkey","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","unique","EditionWorkspaceService","relationLayers$","rowsInMapExtentCheckCondition$","wktFormat","WKT","geoJsonFormat","wksConfig","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","workspaceLayer","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","refreshMap","removeZ","relationLayers","fromSave","wfsOlLayer","wmsOlLayer","_t","WmsWorkspaceService","printable","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","editionWorkspaceService","featureWorkspaceService","changeWorkspace","rowsInMapExtentCheckCondition","workspaceStore","onLayersChange","adding","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","getByte","charCodeAt","getByte64","ALPHA","b10","pads","imax","PADCHAR","param","Bowser","successful","createTextArea","selectText","destroyTextArea","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","contenteditable","selectNodeContents","setSelectionRange","compareVersion","execCommand","getNumber","endposition","base64Index","indexBase64","generateBase64Index","base64","text64","compressStringBase64","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","bits","chr","rem","ChangeType","DELETED","s1","s2","changeData","getChanges","nextS","mtc","ins","sbs","nextThis","del","getMatchingSubstring","slen","fis","isThisLonger","longer","shorter","bi","len","fil","rc","rotateArray","obj1","obj2","ignoreKeys","deleted","obj1Clone","obj2Clone","fromItem","toItem","fromItemClone","toItemClone","keysChanged","compareObject","oldValue","itemAdded","baseKey","keyString","DomUtils","tagName","downloadFromUri","jsonString","keysArray","ignoreUndefined","H","prop","summaryCapitalizeObject","capitalizeObject","upperCaseCount","upperCaseProperty","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","nullScore","ax","bx","$1","$2","an","bn","nn","obj1Props","getOwnPropertyNames","obj2Props","_obj","roundFactor","PATH_PREBUILT_THEMES","LINK_ID","loadTheme","themeName","head","themeLink","createHtmlLink","rel","S4","_status","AuthInternComponent","allowAnonymous","_allowAnonymous","fb","loginUser","errorMsg","AuthInternComponent_button_18_Template","AuthInternComponent_div_19_Template","AuthInternComponent_div_20_Template","AuthMicrosoftComponent","msalService","msalGuardConfig","_destroying$","broadcastService","PublicClientApplication","cache","cacheLocation","MsalBroadcastService","clientId","inProgress$","InteractionStatus","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","acquireTokenSilent","accessToken","tokenId","idToken","InteractionRequiredAuthError","acquireTokenPopup","MSAL_GUARD_CONFIG","MsalServiceb2c","redirectHash","logger","initializeWrapperLibrary","WrapperSKU","Angular","initialize","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","_inProgress","Startup","addEventCallback","EventMessageUtils","getInteractionStatusFromEvent","verbose","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","fjs","js","AuthGoogleComponent","apiKey","loadSDKGoogle","loadPlatform","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","btn","onLogin","AuthFormComponent_div_0_div_2_igo_auth_google_4_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoft_5_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoftb2c_6_Template","AuthFormComponent_div_0_div_2_igo_auth_facebook_7_Template","AuthFormComponent_div_0_div_2_igo_auth_intern_8_Template","google","microsoft","microsoftb2c","facebook","intern","home","AuthFormComponent_div_0_div_4_button_4_Template","AuthFormComponent_div_0_div_1_Template","AuthFormComponent_div_0_div_2_Template","AuthFormComponent_div_0_div_3_Template","AuthFormComponent_div_0_div_4_Template","backgroundDisable","showLoginDiv","showAlreadyConnectedDiv","showLogoutDiv","AuthFormComponent","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","analyzeRoute","getName","logoutRoute","NavigationStart","currentRoute","AuthFormComponent_div_0_Template","redirectTo","pathMatch","AppAuthFormComponent","_authService","logged$$","DocViewerComponent","ExampleViewerComponent","AppActionComponent","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_container_1_ng_container_1_Template","property_r6","baseKey_r4","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_container_1_Template","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_ng_template_2_Template","JsonDialogComponent_ng_template_4_ng_container_0_ng_container_1_Template","JsonDialogComponent_ng_template_4_ng_container_0_Template","JsonDialogComponent","JsonDialogComponent_ng_container_3_Template","JsonDialogComponent_ng_template_4_Template","JsonDialogService","IgoJsonDialogModule","SelectValueDialogType","Radio","Checkbox","SelectValueCheckRadioDialogComponent_5_ng_template_0_Template","choice_r6","SelectValueCheckRadioDialogComponent_mat_radio_group_6_mat_radio_button_1_Template","SelectValueCheckRadioDialogComponent","isDisabled$","getFg","selectFieldText","canProcess","selectedIds","selectedChoices","SelectValueCheckRadioDialogComponent_5_Template","SelectValueCheckRadioDialogComponent_mat_radio_group_6_Template","SelectValueDialogService","IgoSelectValueDialogModule","AppDialogComponent","selectValueDialogService","jsonDialogService","formDialogService","yesno","json","isbn","author","lastname","firstname","editor","compose","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentComponent","toggleComponent","selectedEntity$","AppEntitySelectorComponent","entityIsSelected","getTitle","AppEntitySelectorComponent_div_3_Template","AppEntityTableComponent","clearForm","form_r1","AppFormComponent","valueChanges$$","AppFormComponent_igo_form_2_Template","AppIconComponent","exampleIndexHtml","EXAMPLE_INDEX_HTML","exampleStyleVariable","EXAMPLE_STYLE_VARIABLE","exampleProvider","EXAMPLE_PROVIDER","nameControl","FormControl","TableActionColor","accent","TableDataSource","_database","_model","_sort","_filterChange","connect","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","row_r12","TableComponent_ng_container_8_ng_container_1_th_1_Template","TableComponent_ng_container_8_ng_container_2_th_1_Template","model","row_r27","TableComponent_ng_container_8_ng_container_3_td_1_Template","row_r30","TableComponent_ng_container_8_ng_template_4_td_0_Template","TableComponent_ng_container_8_ng_container_1_Template","TableComponent_ng_container_8_ng_container_2_Template","TableComponent_ng_container_8_ng_container_3_Template","TableComponent_ng_container_8_ng_template_4_Template","action_r34","row_r32","handleClickAction","getActionColor","TableComponent_td_11_button_1_Template","row_r38","TableComponent","database","hasFilterInput","_hasFIlterInput","colorId","MatSort","TableComponent_div_1_Template","TableComponent_th_6_Template","TableComponent_td_7_Template","TableComponent_ng_container_8_Template","TableComponent_th_10_Template","TableComponent_td_11_Template","TableComponent_tr_12_Template","TableComponent_tr_13_Template","TableDatabase","copiedData","AppTableComponent","showName","handleSelect","rows","AppSalutationToolComponent","AppAboutToolComponent","AppToolComponent","panelTitle","activateSalutationTool","AppToolComponent_button_3_Template","AppToolComponent_button_5_Template","AppSalutationWidgetComponent","AppWidgetComponent","dep_r2","DocViewerComponent_ng_container_5_li_4_Template","dependencies","DocViewerComponent_ng_container_5_Template","codeUrl","configUrl","SRC_PATH","codeFolder","configFolder","ExampleViewerComponent_a_5_Template","ExampleViewerComponent_a_6_Template","AppContextComponent","AppContextComponent_ng_template_18_Template","MatGridListModule","AppActivityComponent","idsActivity","counter","AppConfigComponent","configLanguage","AppLanguageComponent","app","changeLanguage","AppMediaComponent","AppMessageComponent","isTracingEnabled","enableTracing","tracesSampleRate","tracesSampler","MONITORING_OPTIONS","provideMonitoring","getCurrentHub","getClient","tracingEnabled","dsn","environment","release","integrations","BrowserTracing","routingInstrumentation","instrumentAngularRouting","enableReplay","Replay","initSentry","ErrorHandler","createErrorHandler","logErrors","errorHandlerOptions","createSentryErrorHandler","TraceService","Router","provideSentryMonitoring","AuthMonitoringService","monitoringOptions","identifyUser","_identifyUser","identifySentryUser","provideAuthUserMonitoring","AppMonitoringComponent","exampleProviderCode","throwTestError","getBasicConfigExample","codeExample","igo","monitoring","AppRequestComponent","callHttp","callHttpError","theme_r1","AppThemeComponent","isDark","themes","matSelectChange","AppThemeComponent_mat_option_7_Template","AppCatalogComponent","catalogStore","catalogItemStore","onCatalogSelectChange","AppDirectionsComponent","AppDrawComponent","AppFeatureComponent","AppGeometryComponent","AppGeometryComponent_igo_form_6_Template","AppHoverComponent","pointerCoordDelay","pointerHoverFeatureDelay","AppImportExportComponent","AppLayerComponent","AppLayerComponent_ng_template_11_Template","AppLegendComponent","AppMeasureComponent","AppOgcFilterComponent","AppOverlayComponent","AppPrintComponent","feature_r3","AppQueryComponent_ng_container_6_div_1_Template","features_r1","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryComponent_ng_container_6_Template","openGuide","guide_r7","formatFileName","headerHtml","AboutToolComponent","configOptions","_headerHtml","_discoverTitleInLocale","discoverTitleInLocale","trainingGuideURLs","effectiveVersion","baseUrlProfil","baseUrlGuide","configVersion","depot","guideUrl","guides","trainingGuides","guide","AboutToolComponent_button_2_Template","AboutToolComponent_button_3_Template","AboutToolComponent_button_6_Template","AboutToolComponent_igo_custom_html_7_Template","MapState","projectionService","_legendToolShowAll","CatalogState","_catalogStore","catalogItemsStores","clearCatalogItemsStores","getCatalogItemsStore","setCatalogItemsStore","store_r1","CatalogBrowserToolComponent","catalogState","mapState","store$","catalog$$","catalog$","CatalogBrowserToolComponent_igo_catalog_browser_0_Template","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","openSidenav$","toolToActivateFromOptions","toolToActivate","CatalogLibraryToolComponent","toolState","currentTool","lastTool","ContextEditorToolComponent","ContextManagerToolComponent","toolToOpenOnContextChange","editContext","ContextPermissionManagerToolComponent","LayerListToolState","keyword$","selectedTab$","setKeyword","setSortAlpha","setOnlyVisible","setSelectedTab","tab","getLayerListControls","ContextShareToolComponent","layerListToolState","layerListControls","ContextState","onContextChange","updateTools","contextTool","baseTool","parentIndex","DirectionState","DirectionsToolComponent","directionState","contextState","currentContextUri","DrawState","layersID","deletedStore","drawControlIndex","DrawingToolComponent","drawState","addLayersID","addDrawControls","ActiveOgcFilterToolComponent","ActiveTimeFilterToolComponent","OgcFilterToolComponent","StorageState","igoStorageService","handleZoomAuto","getWorkspaceActions","selectOnlyCheckCondition$","ogcFilterWidget","zoomAuto$","maximize$","filterStrategy","dateTransform","totalPagesExp","tableWidth","horizontalPageBreak","cellPadding","minCellWidth","didDrawPage","putTotalPages","returnActions","EditionActionsService","storageState","storageChange$$","loadActions","buildActions","storageChange","FeatureActionsService","WfsActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","workspaceEnabled$","workspaceMaximize$","actionMaximize$$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","workspace$","workspaceSelection","workspaceSelection$","initWorkspaces","maximized","setWorkspaceIsMaximized","rowsInMapExtent","selectOnly","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","feature_r1","SpatialFilterToolComponent","matIconRegistry","workspaceState","activeLayers","iterator","selectedFeature$","spatialListStore","moveendKey","getOutputType","getOutputQueryType","activateExportTool","re","layerToOpenWks","zeroResults","selectWorkspaceEntity","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","getNamedSvgIcon","svgObj","xmlSerializer","SpatialFilterToolComponent_ng_container_2_Template","TimeFilterToolComponent","ImportExportToolComponent","importExportType","importExportShowBothType","selectType","userSelectedType","userSelectedMode","importExportTypeChange","ImportExportToolComponent_mat_tab_group_0_Template","ImportExportToolComponent_igo_import_export_1_Template","ImportExportToolComponent_igo_context_import_export_2_Template","projection_r11","translatedValue","AdvancedCoordinatesComponent","formattedScale$","currentCenterDefaultProj","inMtmZone","inLambert2","formStatus$$","defaultProj","currentZones","setScaleValue","updateCoordinates","tempInputProj","positionInList","updateZoneMtmUtm","currentMtmZone","currentUtmZone","back2quebec","updateProjectionsZoneChange","checkLambert","displayCenter","modifiedProj","pushMtm","tk","iter","currentExtentWGS","AdvancedCoordinatesComponent_mat_form_field_2_Template","AdvancedCoordinatesComponent_ng_template_3_Template","AdvancedCoordinatesComponent_mat_form_field_5_Template","AdvancedCoordinatesComponent_ng_template_6_Template","AdvancedCoordinatesComponent_mat_option_19_Template","DecimalPipe","applyNewLayers","layer_r5","AdvancedSwipeComponent_div_0_mat_option_12_Template","startSwipe","swipe","searchEmit","catalogEmit","contextEmit","AdvancedSwipeComponent","listForSwipe","AdvancedSwipeComponent_div_0_Template","AdvancedSwipeComponent_ng_template_1_Template","AdvancedMapToolComponent","toggleTracking","toggleFollow","WorkspaceButtonComponent","hasWorkspace$","hasWorkspace$$","layer$","WorkspaceButtonComponent_button_0_Template","activateExport","MapDetailsToolComponent_igo_layer_list_0_ng_template_1_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_p_4_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_5_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_6_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_7_Template","layerAdditionAllowed","searchToolInToolbar","catalogToolInToolbar","contextToolInToolbar","MapDetailsToolComponent_ng_template_2_mat_list_0_Template","delayedShowEmptyMapContent","MapDetailsToolComponent","filterSortOptions","MapDetailsToolComponent_igo_layer_list_0_Template","MapDetailsToolComponent_ng_template_2_Template","onShowAllLegends","showAllLegendsValue$","MapLegendToolComponent_1_ng_template_0_Template","visibleLayers$","MapLegendToolComponent_ng_template_6_mat_list_0_p_4_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_5_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_6_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_7_Template","MapLegendToolComponent_ng_template_6_mat_list_0_Template","MapLegendToolComponent","visibleOrInRangeLayers$$","visibleOrInRangeLayers$","visibleOrInRangeLayers","MapLegendToolComponent_igo_layer_legend_list_0_Template","MapLegendToolComponent_1_Template","MapLegendToolComponent_p_3_Template","MapLegendToolComponent_ng_template_6_Template","MapProximityState","defaultProximityRadiusValue","enabled$","proximityRadiusValue$","proximitylocationType$","proximityFeatureStore","subs$$","currentPositionCoordinate$","subscribeProximityMonitor","currentPos","locationType","proximityRadiusValue","coordLonLat","roundedCoordLonLat","layerToMonitor","layerSource","olFeaturesAtCoordinate","getFeaturesAtCoordinate","olFeatureAtCoordinate","featureAtThisPosition","closestOlFeature","getClosestFeatureToCoordinate","closestOlGeom","closestFeature","geometryClosestPoint","getClosestPoint","linebetween","lineLength","coordFromCalculatedDistance","layerSrcId","layerSrcTitle","coord_r4","coord2_r6","MapProximityToolComponent","mapProximityState","maxDistance","userDefinedMapCenter","userDefinedFollowPosition","onLocationTypeChange","MapProximityToolComponent_mat_form_field_3_Template","MapProximityToolComponent_mat_form_field_5_Template","MapProximityToolComponent_button_7_Template","MapToolComponent","MapToolComponent_ng_template_4_Template","activateTimeFilter","activateOgcFilter","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_style_modal_layer_button_0_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_time_filter_button_3_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_ogc_filter_button_4_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_export_button_5_Template","isStyleEditButton","isTimeFilterButton","isOGCFilterButton","isExportButton","onLayerListChange","MapToolsComponent_igo_layer_list_5_ng_template_1_Template","MapToolsComponent_10_ng_template_0_Template","MapToolsComponent_ng_template_15_mat_list_0_p_4_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_5_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_6_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_7_Template","MapToolsComponent_ng_template_15_mat_list_0_Template","MapToolsComponent","selectedTabAtOpening","_layerListControls","stateOptions","stateKeyword","stateOnlyVisible","stateSortAlpha","tabGroup","selectedTab","userSelectedTab","tabChanged","appliedFilters","MapToolsComponent_igo_layer_list_5_Template","MapToolsComponent_igo_layer_legend_list_9_Template","MapToolsComponent_10_Template","MapToolsComponent_p_12_Template","MapToolsComponent_ng_template_15_Template","MeasureState","getOverlays","MeasurerToolComponent","measureState","PrintToolComponent","SearchState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","focusedOrResolution$$","selectedOrResolution$$","featureMotion","searchTermSplitter$","searchTerm$","searchDisabled$","searchResultsGeometryEnabled$","searchSettingsChange$","selectedResult$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","disableSearch","setSearchTerm","setSearchSettingsChange","setSelectedResult","setSearchResultsGeometryStatus","result_r6","isSelectedResultOutOfView$","toggleTopPanel","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_button_5_Template","featureTitle","topPanelState$","onResultFocus","onResultUnfocus","SearchResultsToolComponent_igo_flexible_2_ng_template_5_Template","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_Template","topPanelState","SearchResultsToolComponent","searchState","topPanelStateDefault","hasFeatureEmphasisOnSelection","showResultsGeometries$$","getRoute$$","shownResultsGeometries","shownResultsEmphasisGeometries","focusedResult$","isSelectedResultOutOfView$$","abstractFocusedResult","abstractSelectedResult","debouncedEmpty$","debouncedEmpty$$","searchTerm$$","topPanelState$$","computeElementRef","adjustTopPanel","buildResultEmphasis","monitorResultOutOfView","searchResults","clearFeatureEmphasis","selectedResult","selectedOlFeature","selectedOlFeatureExtent","abstractResult","computedStyle","zIndexOffset","shownResult","tryAddFeatureToMap","routingCoordLoaded","currentCoord","SearchResultsToolComponent_div_0_Template","SearchResultsToolComponent_igo_flexible_2_Template","ElementRef","DataIssueReporterToolComponent_igo_form_0_div_2_igo_form_field_1_Template","DataIssueReporterToolComponent_igo_form_0_div_2_Template","DataIssueReporterToolComponent","baseLayerOrShownInLayerList","submitTitle","DataIssueReporterToolComponent_igo_form_0_Template","ContextMenuDirective","viewContainerRef","elementRef","overlayRef","menuContext","menuPosition","onContextMenu","MouseEvent","TouchEvent","pageX","pageY","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","clickTarget","overlayElement","dispose","LongPressDirective","touchTimeout","touchDuration","onlyIOS","longpress","touchstart","touchEnd","touchend","result_r7","actionBarMode","AppSearchComponent","mapBrowser","searchStore","igoReverseSearchCoordsFormatEnabled","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","getBoundingClientRect","scrollY","scrollX","AppSearchComponent_span_2_Template","AppSearchComponent_ng_template_10_Template","AppSearchComponent_igo_panel_12_Template","AppSearchComponent_ng_template_13_Template","pointerCoord","AppSimpleMapComponent","onPointerMove","AppSimpleMapComponent_p_12_Template","AppSpatialFilterComponent","AppSpatialFilterComponent_ng_container_13_Template","AppTimeFilterComponent","workspace_r2","AppWorkspaceComponent_ng_container_6_igo_entity_table_paginator_1_Template","workspace_r7","workspacePaginator","AppWorkspaceComponent_ng_container_8_igo_actionbar_1_Template","AppWorkspaceComponent_ng_container_8_igo_entity_table_2_Template","AppWorkspaceComponent_ng_container_8_mat_card_content_4_Template","AppWorkspaceComponent","selectedWorkspace$","AppWorkspaceComponent_ng_container_6_Template","AppWorkspaceComponent_ng_container_8_Template","production","directionsSources","osrm","interactiveTour","tourInMobile","activateInteractiveTour","importExport","storedqueriesreverse","nominatim","icherche","coordinatesreverse","icherchereverse","ilayer","ErrorInterceptor","errorContainer","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","IgoErrorModule","parentModule","dbConfig","objectStoresMeta","storeConfig","keyPath","autoIncrement","storeSchema","keypath","IgoCoreModule","NgxIndexedDBModule","AppHomeComponent","loadChildren","__webpack_require__","ROUTES_CONFIG","getRoutesConfig","coreRoutes","authRoutes","commonRoutes","geoRoutes","contextRoutes","routeConfig_r2","route_r8","AppComponent_ng_container_13_ng_template_2_a_5_Template","AppComponent_ng_container_13_ng_container_1_Template","AppComponent_ng_container_13_ng_template_2_Template","AppComponent","changeDetectorRef","mobileQuery","routesConfig","_mobileQueryListener","matchMedia","detectOldBrowser","handleSplashScreen","NavigationEnd","_removeSplashScreen","intro","stylesheet","removeEventListener","getBrowser","AppComponent_ng_container_13_Template","MatExpansionModule","MatToolbarModule","MatSidenavModule","RouterLink","RouterLinkActive","RouterOutlet","enableProdMode","bootstrapApplication","BrowserModule","HammerModule","provideHttpClient","withJsonpSupport","provideRouter","withPreloading","PreloadAllModules","provideAnimations","MAT_FORM_FIELD_DEFAULT_OPTIONS","MAT_TOOLTIP_DEFAULT_OPTIONS","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","webpackContext","webpackContextResolve","module","exports"],"sourceRoot":"webpack:///","sources":["./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/shared/auth-storage.service.ts","./packages/auth/src/lib/shared/auth.interface.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/auth.provider.ts","./packages/common/action/src/shared/action.enums.ts","./packages/common/action/src/shared/store.ts","./packages/common/action/src/actionbar/actionbar-item.component.html","./packages/common/action/src/actionbar/actionbar-item.component.ts","./packages/common/action/src/actionbar/actionbar.component.html","./packages/common/action/src/actionbar/actionbar.component.ts","./packages/common/badge/src/badge-icon.directive.ts","./packages/common/collapsible/src/collapse.directive.ts","./packages/common/collapsible/src/collapsible.component.ts","./packages/common/collapsible/src/collapsible.component.html","./packages/common/confirm-dialog/src/confirm-dialog.component.ts","./packages/common/confirm-dialog/src/confirm-dialog.component.html","./packages/common/confirm-dialog/src/confirm-dialog.service.ts","./packages/common/confirm-dialog/src/confirm-dialog.module.ts","./packages/common/custom-html/src/custom-html.pipe.ts","./packages/common/custom-html/src/custom-html.component.ts","./packages/common/custom-html/src/custom-html.component.html","./packages/common/dynamic-component/src/shared/dynamic-component.ts","./packages/common/dynamic-component/src/shared/dynamic-component.service.ts","./packages/common/dynamic-component/src/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/dynamic-component/src/dynamic-outlet/dynamic-outlet.component.html","./packages/common/entity/src/shared/entity.enums.ts","./packages/common/entity/src/shared/entity.utils.ts","./packages/common/entity/src/shared/state.ts","./packages/common/entity/src/shared/view.ts","./packages/common/entity/src/shared/store.ts","./packages/common/entity/src/shared/watcher.ts","./packages/common/entity/src/shared/strategies/strategy.ts","./packages/common/entity/src/shared/strategies/filter-custom-function.ts","./packages/common/entity/src/shared/strategies/filter-selection.ts","./packages/common/entity/src/entity-selector/entity-selector.component.html","./packages/common/entity/src/entity-selector/entity-selector.component.ts","./packages/common/entity/src/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/entity/src/entity-table-paginator/entity-table-paginator.component.html","./packages/common/entity/src/entity-table/entity-table-row.directive.ts","./packages/common/entity/src/entity-table/entity-table.component.html","./packages/common/entity/src/entity-table/entity-table.component.ts","./packages/common/flexible/src/flexible.component.ts","./packages/common/flexible/src/flexible.component.html","./packages/common/form/src/form-field/form-field.component.html","./packages/common/form/src/form-field/form-field.component.ts","./packages/common/form/src/form/form.component.ts","./packages/common/form/src/form/form.component.html","./packages/common/form/src/shared/form-field-component.ts","./packages/common/form/src/form-field/form-field-select.component.html","./packages/common/form/src/form-field/form-field-select.component.ts","./packages/common/form/src/form-field/form-field-text.component.html","./packages/common/form/src/form-field/form-field-text.component.ts","./packages/common/form/src/form-field/form-field-textarea.component.html","./packages/common/form/src/form-field/form-field-textarea.component.ts","./packages/common/form/src/form-group/form-group.component.html","./packages/common/form/src/form-group/form-group.component.ts","./packages/common/form/src/shared/form.service.ts","./packages/common/form/src/form-dialog/form-dialog.component.html","./packages/common/form/src/form-dialog/form-dialog.component.ts","./packages/common/form/src/form-dialog/form-dialog.service.ts","./packages/common/form/src/form-dialog/form-dialog.module.ts","./packages/common/form/src/shared/form-field.service.ts","./packages/common/form/src/shared/form.utils.ts","./packages/common/icon/src/shared/icons.ts","./packages/common/icon/src/shared/icon.service.ts","./packages/common/icon/src/icon.provider.ts","./packages/common/icon/src/icon/icon.component.html","./packages/common/icon/src/icon/icon.component.ts","./packages/common/image/src/image-error.directive.ts","./packages/common/image/src/secure-image.pipe.ts","./packages/common/interactive-tour/src/interactive-tour.component.html","./packages/common/interactive-tour/src/interactive-tour.component.ts","./packages/common/interactive-tour/src/interactive-tour.loader.ts","./packages/common/interactive-tour/src/interactive-tour.service.ts","./packages/common/interactive-tour/src/interactive-tour.module.ts","./packages/common/list/src/list-item.directive.ts","./packages/common/clickout/src/clickout.directive.ts","./packages/common/list/src/list.component.ts","./packages/common/list/src/list.component.html","./packages/common/panel/src/panel.component.html","./packages/common/panel/src/panel.component.ts","./packages/common/spinner/src/spinner.component.ts","./packages/common/spinner/src/spinner.component.html","./packages/common/stop-propagation/src/stop-drop-propagation.directive.ts","./packages/common/stop-propagation/src/stop-propagation.directive.ts","./packages/common/tool/src/shared/toolbox.ts","./packages/common/tool/src/shared/tool.service.ts","./packages/common/tool/src/shared/tool-component.ts","./packages/common/tool/src/toolbox/toolbox.animation.ts","./packages/common/tool/src/toolbox/toolbox.component.html","./packages/common/tool/src/toolbox/toolbox.component.ts","./packages/common/widget/src/shared/widget.service.ts","./packages/common/widget/src/widget-outlet/widget-outlet.module.ts","./packages/common/widget/src/widget.module.ts","./packages/common/widget/src/widget-outlet/widget-outlet.component.html","./packages/common/widget/src/widget-outlet/widget-outlet.component.ts","./packages/common/workspace/src/shared/store.ts","./packages/common/workspace/src/shared/workspace.ts","./packages/common/workspace/src/workspace-selector/workspace-selector.component.ts","./packages/common/workspace/src/workspace-selector/workspace-selector.component.html","./packages/common/workspace/src/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/workspace/src/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-export.service.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-import-export/shared/context-import.service.ts","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.html","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.ts","./packages/context/src/lib/context-import-export/shared/context-export.utils.ts","./packages/context/src/lib/context-manager/context-form/context-form.component.html","./packages/context/src/lib/context-manager/context-form/context-form.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit.component.html","./packages/context/src/lib/context-manager/context-edit/context-edit.component.ts","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.html","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.ts","./packages/context/src/lib/context-map-button/user-button/user-button.component.ts","./packages/context/src/lib/share-map/shared/share-map.service.ts","./packages/context/src/lib/share-map/share-map/share-map-api.component.html","./packages/context/src/lib/share-map/share-map/share-map-api.component.ts","./packages/context/src/lib/share-map/share-map/share-map-url.component.html","./packages/context/src/lib/share-map/share-map/share-map-url.component.ts","./packages/context/src/lib/share-map/share-map/share-map.component.html","./packages/context/src/lib/share-map/share-map/share-map.component.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-manager/context-edit/context-edit-binding.directive.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions-binding.directive.ts","./packages/core/activity/src/activity.interceptor.ts","./packages/core/activity/src/activity.module.ts","./packages/core/activity/src/activity.service.ts","./packages/core/analytics/src/analytics.service.ts","./packages/core/config/src/config-deprecated.ts","./packages/core/config/src/version.ts","./packages/core/config/src/config.service.ts","./packages/core/config/src/config.provider.ts","./packages/core/language/src/language.module.ts","./packages/core/language/src/shared/language.loader.ts","./packages/core/language/src/shared/language.service.ts","./packages/core/language/src/shared/missing-translation.guard.ts","./packages/core/language/src/shared/language.provider.ts","./packages/core/media/src/media.enum.ts","./packages/core/media/src/media.service.ts","./packages/core/message/src/shared/message.provider.ts","./packages/core/message/src/message.module.ts","./packages/core/message/src/shared/message.enum.ts","./packages/core/message/src/shared/message.service.ts","./packages/core/network/src/network.service.ts","./packages/core/route/src/route.service.ts","./packages/core/storage/src/storage.interface.ts","./packages/core/storage/src/storage.ts","./packages/core/storage/src/storage.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.interface.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.component.ts","./packages/geo/src/lib/feature/feature-form/feature-form.component.html","./packages/geo/src/lib/feature/shared/feature-store.utils.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/geometry/shared/geometry.errors.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/map-center/map-center.component.ts","./packages/geo/src/lib/map/map-center/map-center.component.html","./packages/geo/src/lib/map/menu-button/menu-button.component.ts","./packages/geo/src/lib/map/menu-button/menu-button.component.html","./packages/geo/src/lib/map/offline-button/offline-button.component.ts","./packages/geo/src/lib/map/offline-button/offline-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.interface.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/map/shared/mapOffline.directive.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/map/swipe-control/swipe-control.component.ts","./packages/geo/src/lib/map/swipe-control/swipe-control.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/common/dom/src/dom.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/common/color/src/color-picker-form-field/color-picker-form-field.component.html","./packages/common/color/src/color-picker-form-field/color-picker-form-field.component.ts","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","./packages/geo/src/lib/import-export/export-button/export-button.component.html","./packages/geo/src/lib/import-export/export-button/export-button.component.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/source.interfaces.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche-icons.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.html","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.html","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/catalog/shared/catalogs.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/directions/directions.provider.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.interface.ts","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/search/shared/search.provider.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/core/regex/src/regex.service.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/cache.utils.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/compression/compression.utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/dom.utils.ts","./packages/utils/src/lib/file.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/theme.utils.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/auth/internal/src/auth-intern/auth-intern.component.html","./packages/auth/internal/src/auth-intern/auth-intern.component.ts","./packages/auth/microsoft/src/auth-microsoft/auth-microsoft.component.ts","./packages/auth/microsoft/src/auth-microsoft/auth-microsoft.component.html","./packages/auth/microsoft/src/auth-microsoftb2c/auth-msalServiceb2c.service.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-microsoftb2c.component.ts","./packages/auth/microsoft/src/auth-microsoftb2c/auth-microsoftb2c.component.html","./packages/auth/facebook/src/auth-facebook/auth-facebook.component.ts","./packages/auth/facebook/src/auth-facebook/auth-facebook.component.html","./packages/auth/google/src/auth-google/auth-google.component.ts","./packages/auth/google/src/auth-google/auth-google.component.html","./packages/auth/form/src/auth-form/auth-form.component.html","./packages/auth/form/src/auth-form/auth-form.component.ts","./projects/demo/src/app/auth/auth.routing.ts","./projects/demo/src/app/auth/auth-form/auth-form.component.ts","./projects/demo/src/app/auth/auth-form/auth-form.component.html","./projects/demo/src/app/common/action/action.component.ts","./projects/demo/src/app/common/action/action.component.html","./packages/common/json-dialog/src/json-dialog.component.html","./packages/common/json-dialog/src/json-dialog.component.ts","./packages/common/json-dialog/src/json-dialog.service.ts","./packages/common/json-dialog/src/json-dialog.module.ts","./packages/common/select-value-dialog/src/select-value-dialog.enums.ts","./packages/common/select-value-dialog/src/select-value-check-radio-dialog.component.html","./packages/common/select-value-dialog/src/select-value-check-radio-dialog.component.ts","./packages/common/select-value-dialog/src/select-value-dialog.service.ts","./packages/common/select-value-dialog/src/select-value-dialog.module.ts","./projects/demo/src/app/common/dialog/dialog.component.ts","./projects/demo/src/app/common/dialog/dialog.component.html","./projects/demo/src/app/common/dynamic-component/dynamic-component.component.ts","./projects/demo/src/app/common/dynamic-component/dynamic-component.component.html","./projects/demo/src/app/common/entity-selector/entity-selector.component.html","./projects/demo/src/app/common/entity-selector/entity-selector.component.ts","./projects/demo/src/app/common/entity-table/entity-table.component.ts","./projects/demo/src/app/common/entity-table/entity-table.component.html","./projects/demo/src/app/common/form/form.component.html","./projects/demo/src/app/common/form/form.component.ts","./projects/demo/src/app/common/icon/icon.component.ts","./projects/demo/src/app/common/icon/icon.component.html","./packages/common/table/src/table-action-color.enum.ts","./packages/common/table/src/table-datasource.ts","./packages/common/table/src/table.component.html","./packages/common/table/src/table.component.ts","./packages/common/table/src/table-database.ts","./projects/demo/src/app/common/table/table.component.ts","./projects/demo/src/app/common/table/table.component.html","./projects/demo/src/app/common/tool/tool.component.html","./projects/demo/src/app/common/tool/tool.component.ts","./projects/demo/src/app/common/widget/widget.component.ts","./projects/demo/src/app/common/common.routing.ts","./projects/demo/src/app/common/widget/widget.component.html","./projects/demo/src/app/components/doc-viewer/doc-viewer.component.html","./projects/demo/src/app/components/doc-viewer/doc-viewer.component.ts","./projects/demo/src/app/components/example/example-viewer/example-viewer.component.html","./projects/demo/src/app/components/example/example-viewer/example-viewer.component.ts","./projects/demo/src/app/context/context/context.component.html","./projects/demo/src/app/context/context.routing.ts","./projects/demo/src/app/context/context/context.component.ts","./projects/demo/src/app/core/activity/activity.component.ts","./projects/demo/src/app/core/activity/activity.component.html","./projects/demo/src/app/core/config/config.component.ts","./projects/demo/src/app/core/config/config.component.html","./projects/demo/src/app/core/language/language.component.ts","./projects/demo/src/app/core/language/language.component.html","./projects/demo/src/app/core/media/media.component.ts","./projects/demo/src/app/core/media/media.component.html","./projects/demo/src/app/core/message/message.component.ts","./projects/demo/src/app/core/message/message.component.html","./packages/core/monitoring/src/sentry/sentry.utils.ts","./packages/core/monitoring/src/sentry/sentry.ts","./packages/core/monitoring/src/monitoring.provider.ts","./packages/core/monitoring/src/sentry/sentry.provider.ts","./packages/auth/monitoring/src/auth-monitoring/auth-monitoring.service.ts","./packages/auth/monitoring/src/auth-monitoring/auth-monitoring.provider.ts","./projects/demo/src/app/core/monitoring/monitoring.component.ts","./projects/demo/src/app/core/monitoring/monitoring.component.html","./projects/demo/src/app/core/request/request.component.ts","./projects/demo/src/app/core/request/request.component.html","./projects/demo/src/app/core/theme/theme.component.html","./projects/demo/src/app/core/core.routing.ts","./projects/demo/src/app/core/theme/theme.component.ts","./projects/demo/src/app/geo/catalog/catalog.component.ts","./projects/demo/src/app/geo/catalog/catalog.component.html","./projects/demo/src/app/geo/directions/directions.component.ts","./projects/demo/src/app/geo/directions/directions.component.html","./projects/demo/src/app/geo/draw/draw.component.ts","./projects/demo/src/app/geo/draw/draw.component.html","./projects/demo/src/app/geo/feature/feature.component.ts","./projects/demo/src/app/geo/feature/feature.component.html","./projects/demo/src/app/geo/geometry/geometry.component.html","./projects/demo/src/app/geo/geometry/geometry.component.ts","./projects/demo/src/app/geo/hover/hover.component.ts","./projects/demo/src/app/geo/hover/hover.component.html","./projects/demo/src/app/geo/import-export/import-export.component.ts","./projects/demo/src/app/geo/import-export/import-export.component.html","./projects/demo/src/app/geo/layer/layer.component.html","./projects/demo/src/app/geo/layer/layer.component.ts","./projects/demo/src/app/geo/legend/legend.component.ts","./projects/demo/src/app/geo/legend/legend.component.html","./projects/demo/src/app/geo/measure/measure.component.ts","./projects/demo/src/app/geo/measure/measure.component.html","./projects/demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./projects/demo/src/app/geo/ogc-filter/ogc-filter.component.html","./projects/demo/src/app/geo/overlay/overlay.component.ts","./projects/demo/src/app/geo/overlay/overlay.component.html","./projects/demo/src/app/geo/print/print.component.ts","./projects/demo/src/app/geo/print/print.component.html","./projects/demo/src/app/geo/query/query.component.html","./projects/demo/src/app/geo/query/query.component.ts","./packages/integration/src/lib/about/about-tool/about-tool.component.html","./packages/integration/src/lib/about/about-tool/about-tool.component.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/catalog/catalog.state.ts","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.html","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.html","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.ts","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.html","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.html","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.ts","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.html","./packages/integration/src/lib/map/layer-list-tool.state.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.html","./packages/integration/src/lib/context/context.state.ts","./packages/integration/src/lib/directions/directions.state.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.html","./packages/integration/src/lib/directions/directions.module.ts","./packages/integration/src/lib/draw/draw.state.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.html","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.html","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.html","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.html","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.ts","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.html","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.ts","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.html","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.ts","./packages/integration/src/lib/map/map-proximity.state.ts","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.html","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.ts","./packages/integration/src/lib/map/map-tool/map-tool.component.html","./packages/integration/src/lib/map/map-tool/map-tool.component.ts","./packages/integration/src/lib/map/map-tools/map-tools.component.html","./packages/integration/src/lib/map/map-tools/map-tools.component.ts","./packages/integration/src/lib/map/map.module.ts","./packages/integration/src/lib/measure/measure.state.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.html","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.module.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.html","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.ts","./packages/integration/src/lib/geometry-form/data-issue-reporter-tool/data-issue-reporter-tool.component.html","./packages/integration/src/lib/geometry-form/data-issue-reporter-tool/data-issue-reporter-tool.component.ts","./packages/common/context-menu/src/context-menu.directive.ts","./packages/common/context-menu/src/long-press.directive.ts","./projects/demo/src/app/geo/search/search.component.html","./projects/demo/src/app/geo/search/search.component.ts","./projects/demo/src/app/geo/simple-map/simple-map.component.html","./projects/demo/src/app/geo/simple-map/simple-map.component.ts","./projects/demo/src/app/geo/spatial-filter/spatial-filter.component.html","./projects/demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./projects/demo/src/app/geo/time-filter/time-filter.component.ts","./projects/demo/src/app/geo/time-filter/time-filter.component.html","./projects/demo/src/app/geo/workspace/workspace.component.html","./projects/demo/src/app/geo/geo.routing.ts","./projects/demo/src/app/geo/workspace/workspace.component.ts","./projects/demo/src/environments/environment.prod.ts","./packages/core/request/src/error.interceptor.ts","./packages/core/request/src/error.module.ts","./packages/core/src/lib/core.module.ts","./projects/demo/src/app/app.routing.ts","./projects/demo/src/app/pages/home/home.component.ts","./projects/demo/src/app/pages/home/home.component.html","./projects/demo/src/app/app.component.html","./projects/demo/src/app/app.component.ts","./projects/demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["import { Injectable, Injector } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { jwtDecode } from 'jwt-decode';\n\nimport { AuthOptions } from './auth.interface';\nimport { IgoJwtPayload } from './token.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options?: AuthOptions;\n  private tokenKey: string;\n\n  constructor(private injector: Injector) {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth');\n    this.tokenKey = this.options?.tokenKey;\n  }\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode(): IgoJwtPayload | null {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token) satisfies IgoJwtPayload;\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\nimport { Router } from '@angular/router';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Base64 } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { AuthOptions, IInfosUser, User } from './auth.interface';\nimport { IgoJwtPayload } from './token.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  public languageForce = false;\n  private anonymous = false;\n  private authOptions: AuthOptions;\n\n  get hasAuthService() {\n    return this.authOptions?.url !== undefined;\n  }\n\n  get user(): User | null {\n    const decodedToken = this.decodeToken();\n    return decodedToken?.user ? decodedToken.user : null;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authOptions = this.config.getConfig('auth');\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(\n    token: string,\n    type: string,\n    infosUser?: IInfosUser\n  ): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    return this.http.post(`${this.authOptions?.url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken(): IgoJwtPayload | null {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    if (redirectUrl === this.authOptions.loginRoute) {\n      const homeRoute = this.authOptions.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.authOptions?.url + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    return this.http.get<{ profils: string[] }>(\n      `${this.authOptions?.url}/profils`\n    );\n  }\n\n  updateUser(user: User): Observable<User> {\n    return this.http.patch<User>(this.authOptions?.url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token?.user?.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    return this.http\n      .post(`${this.authOptions?.url}/login`, body, { headers })\n      .pipe(\n        tap((data: any) => {\n          this.tokenService.set(data.token);\n          const tokenDecoded = this.decodeToken();\n          if (tokenDecoded?.user) {\n            if (tokenDecoded.user.locale && !this.languageForce) {\n              this.languageService.setLanguage(tokenDecoded.user.locale);\n            }\n            if (tokenDecoded.user.isExpired) {\n              this.messageService.alert('igo.auth.error.Password expired');\n            }\n          }\n          this.authenticate$.next(true);\n        }),\n        catchError((err) => {\n          err.error.caught = true;\n          throw err;\n        })\n      );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { BaseStorage, StorageScope } from '@igo2/core/storage';\n\nimport { AuthStorageOptions } from './auth-storage.interface';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends BaseStorage<AuthStorageOptions> {\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe((isAuthenticated) => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .patch(\n          this.options.url,\n          { preference: {} },\n          {\n            params: {\n              mergePreference: 'false'\n            }\n          }\n        )\n        .subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { Provider } from '@angular/core';\n\nimport { BaseUser } from '@igo2/core/user';\n\nexport interface User extends BaseUser {\n  source?: string;\n  sourceId?: string;\n  locale?: string;\n  isExpired?: boolean;\n  isAdmin?: boolean;\n  defaultContextId?: string;\n}\n\nexport interface IInfosUser {\n  tokenId: string;\n}\n\nexport type AuthOptions = {\n  url?: string;\n  tokenKey?: string;\n  allowAnonymous?: boolean;\n  loginRoute?: string;\n  logoutRoute?: string;\n  homeRoute?: string;\n  trustHosts?: string[];\n  profilsGuard?: string[];\n  hostsWithCredentials?: WithCredentialsOptions[];\n  hostsByKey?: AuthByKeyOptions[];\n  intern?: AuthInternOptions;\n};\n\nexport interface AuthByKeyOptions {\n  domainRegFilters?: string;\n  keyProperty?: string;\n  keyValue?: string;\n}\nexport interface WithCredentialsOptions {\n  withCredentials?: boolean;\n  domainRegFilters?: string;\n}\n\nexport interface AuthInternOptions {\n  enabled?: boolean;\n}\n\nexport interface AuthFeature<KindT extends AuthFeatureKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum AuthFeatureKind {\n  Microsoft = 0\n}\n","import { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport {\n  AuthByKeyOptions,\n  AuthOptions,\n  WithCredentialsOptions\n} from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private authOptions: AuthOptions;\n  private refreshInProgress = false;\n  private trustHosts: string[];\n  private hostsWithCredentials: WithCredentialsOptions[];\n  private hostsWithAuthByKey: AuthByKeyOptions[];\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {\n    this.authOptions = this.config.getConfig('auth') as AuthOptions;\n\n    this.trustHosts = this.authOptions?.trustHosts || [];\n    this.trustHosts.push(window.location.hostname);\n\n    this.hostsWithCredentials = this.authOptions?.hostsWithCredentials || [];\n    this.hostsWithAuthByKey = this.authOptions?.hostsByKey || [];\n  }\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n      return next.handle(req);\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded = this.tokenService.decode();\n    if (authReq.params.get('_i') === 'true' && tokenDecoded?.user?.sourceId) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n      xhr.withCredentials = withCredentials;\n      return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter((p) => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials =\n          hostWithCredentials.withCredentials !== undefined\n            ? hostWithCredentials.withCredentials\n            : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): { key: string; value: string } {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace, 'gm');\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {\n            key: hostWithAuthByKey.keyProperty,\n            value: hostWithAuthByKey.keyValue\n          };\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.authOptions?.url;\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        (err) => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport {\n  EnvironmentProviders,\n  Provider,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\n\nimport {\n  AuthFeature,\n  AuthFeatureKind,\n  AuthInterceptor,\n  AuthStorageService\n} from './shared';\n\nexport function provideAuthentification(\n  ...features: AuthFeature<AuthFeatureKind>[]\n): EnvironmentProviders {\n  const providers: Provider[] = [\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: AuthInterceptor,\n      multi: true\n    },\n    {\n      provide: StorageService,\n      useClass: AuthStorageService\n    }\n  ];\n\n  for (const feature of features) {\n    providers.push(...feature.providers);\n  }\n\n  return makeEnvironmentProviders(providers);\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {}\n","<mat-list-item\n  *ngIf=\"!action.checkbox\"\n  class=\"actionbar-item\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\"\n>\n  <button\n    *ngIf=\"withIcon\"\n    matListItemAvatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\"\n    [disableRipple]=\"true\"\n  >\n    <igo-icon\n      [icon]=\"isObservable(action.icon) ? (action.icon | async) : action.icon\"\n    ></igo-icon>\n  </button>\n  <span *ngIf=\"withTitle\" matLine>{{ title | translate }}</span>\n</mat-list-item>\n\n<mat-list-item\n  class=\"item-checkbox\"\n  *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n>\n  <mat-checkbox\n    *ngIf=\"withTitle\"\n    (change)=\"action.handler()\"\n    [checked]=\"checkCondition$ | async\"\n  >\n    {{ title | translate }}\n  </mat-checkbox>\n</mat-list-item>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoIconComponent } from '@igo2/common/icon';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n/**\n * An action button\n */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatListModule,\n    MatTooltipModule,\n    NgClass,\n    MatButtonModule,\n    MatIconModule,\n    MatCheckboxModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{ [key: string]: boolean }> =\n    new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  isObservable = isObservable;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) {\n    this.noDisplay$.next(value);\n  }\n  get noDisplay(): boolean {\n    return this.noDisplay$.value;\n  }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.action.title;\n  }\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action\n        .ngClass(...args)\n        .subscribe((ngClass: { [key: string]: boolean }) =>\n          this.updateNgClass(ngClass)\n        );\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition.subscribe(\n        (checkCondition: boolean) => this.updateCheckCondition(checkCondition)\n      );\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip.subscribe((tooltip: string) =>\n        this.updateTooltip(tooltip)\n      );\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action\n        .availability(...args)\n        .subscribe((available: boolean) => (this.disabled = !available));\n    }\n\n    this.disabled$$ = this.disabled$.subscribe((disabled: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-disabled': disabled })\n    );\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action\n        .display(...args)\n        .subscribe((display: boolean) => (this.noDisplay = !display));\n    }\n\n    this.noDisplay$$ = this.noDisplay$.subscribe((noDisplay: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-no-display': noDisplay })\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: { [key: string]: boolean }) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n}\n","<div\n  *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n  id=\"topChevron\"\n>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n    (click)=\"scrollUp()\"\n  >\n    <mat-icon>expand_less</mat-icon>\n  </button>\n</div>\n<mat-list *ngIf=\"mode === actionbarMode.Dock\" matListItemIcon>\n  <igo-actionbar-item\n    *ngIf=\"withToggleButton\"\n    color=\"accent\"\n    [withTitle]=\"false\"\n    [withIcon]=\"true\"\n    [color]=\"color\"\n    [disabled]=\"store.view.empty\"\n    [action]=\"toggleCollapseAction\"\n    (trigger)=\"onTriggerAction(toggleCollapseAction)\"\n  >\n  </igo-actionbar-item>\n\n  <ng-template\n    #buttonContent\n    *ngIf=\"!collapsed\"\n    ngFor\n    let-action\n    [ngForOf]=\"store.view.all$() | async\"\n  >\n    <igo-actionbar-item\n      color=\"accent\"\n      [withTitle]=\"withTitle\"\n      [withIcon]=\"withIcon\"\n      [withTooltip]=\"withTooltip\"\n      [color]=\"color\"\n      [disabled]=\"store.state.get(action).disabled\"\n      [action]=\"action\"\n      (trigger)=\"onTriggerAction(action)\"\n    >\n    </igo-actionbar-item>\n  </ng-template>\n</mat-list>\n\n<div\n  *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n  id=\"lowChevron\"\n>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n    (click)=\"scrollDown()\"\n  >\n    <mat-icon>expand_more</mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button\n    class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\"\n  >\n    <mat-icon>{{ icon }}</mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\"\n  >\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\"\n        >\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card\n  *ngIf=\"mode === actionbarMode.Context\"\n  class=\"context-menu-card mat-elevation-z4\"\n>\n  <mat-list>\n    <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [color]=\"color\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\"\n      >\n      </igo-actionbar-item>\n      <br />\n    </ng-template>\n  </mat-list>\n</mat-card>\n","import { Overlay } from '@angular/cdk/overlay';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostBinding,\n  Input,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport {\n  MatMenuModule,\n  MenuPositionX,\n  MenuPositionY\n} from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStoreWatcher } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { ActionbarMode } from '../shared/action.enums';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionStore } from '../shared/store';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    ActionbarItemComponent,\n    NgFor,\n    MatMenuModule,\n    MatCardModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'more_vert',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'more_horiz';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition: MenuPositionX = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition: MenuPositionY = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  @HostBinding('class.is-collapsed') isCollapsed = this.collapsed;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= el.scrollHeight - el.clientHeight) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n}\n","import { Directive, ElementRef, Input, OnInit } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]',\n  standalone: true,\n  providers: [MatIconModule]\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.html = `\n      <mat-icon class=\"mat-icon material-symbols-outlined\" style=\"height: 16px; width: 16px; font-size: 16px;\">${value}</mat-icon>\n    `;\n    this.updateHtml();\n  }\n  private html: string;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  @Input()\n  set igoMatBadgeColor(value: string) {\n    this.color = value;\n    this.updateColor();\n  }\n  private color;\n\n  @Input()\n  set igoMatBadgeBackgroundColor(value: string) {\n    this.backgroundColor = value;\n    this.updateColor();\n  }\n  private backgroundColor;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateHtml();\n  }\n\n  private updateHtml() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.html) {\n      this.badge.innerHTML = this.html;\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.color || this.backgroundColor) {\n      this.badge.style.color = this.color ? this.color : '';\n      this.badge.style.background = this.backgroundColor\n        ? this.backgroundColor\n        : '';\n    } else if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else if (!this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]',\n  standalone: true\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss'],\n  standalone: true,\n  imports: [MatListModule, MatIconModule, CollapseDirective]\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\"\n  >\n    expand_less\n  </mat-icon>\n  <span matListItemTitle>{{ title }}</span>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n  public titleKey: string = 'igo.common.confirmDialog.title';\n  public proccessKey: string = 'igo.common.confirmDialog.confirmBtn';\n  public cancelKey: string = 'igo.common.confirmDialog.cancelBtn';\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ titleKey | translate }}\n</h2>\n<div mat-dialog-content class=\"mat-typography\">\n  {{ confirmMessage | translate }}\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"dialogRef.close(true)\">\n    {{ proccessKey | translate }}\n  </button>\n  <button mat-flat-button (click)=\"dialogRef.close(false)\">\n    {{ cancelKey | translate }}\n  </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogOptions } from './confirm-dialog.interface';\n\n@Injectable({ providedIn: 'root' })\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    message: string,\n    options?: ConfirmDialogOptions\n  ): Observable<boolean> {\n    const _options: ConfirmDialogOptions = {\n      title: 'igo.common.confirmDialog.title',\n      modeYesNo: false,\n      ...options\n    };\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = message;\n    dialogRef.componentInstance.titleKey = _options.title;\n    if (_options.modeYesNo) {\n      dialogRef.componentInstance.proccessKey = 'igo.common.confirmDialog.yes';\n      dialogRef.componentInstance.cancelKey = 'igo.common.confirmDialog.no';\n    }\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  /**\n   * @deprecated this has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({\n  name: 'sanitizeHtml',\n  standalone: true\n})\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {}\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss'],\n  standalone: true,\n  imports: [SanitizeHtmlPipe]\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: { [key: string]: any } = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: { [key: string]: Subscription } = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: { [key: string]: (event: any) => void } = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: { [key: string]: any }) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n\n        this.unobserveInput(key);\n\n        const inputValue = inputs[key];\n        if (inputs.hasOwnProperty(key)) {\n          if (inputValue instanceof Observable) {\n            this.observeInput(key, inputValue);\n          } else {\n            this.setInputValue(instance, key, inputValue);\n          }\n        }\n      }\n    );\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: { [key: string]: (event: any) => void }) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n        if (subscribers.hasOwnProperty(key)) {\n          const emitter = instance[key];\n          const subscriber = subscribers[key];\n          if (Array.isArray(subscriber)) {\n            subscriber.forEach((_subscriber) => {\n              this.subscriptions.push(emitter.subscribe(_subscriber));\n            });\n          } else {\n            this.subscriptions.push(emitter.subscribe(subscriber));\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n}\n","import { ComponentFactoryResolver, Injectable } from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title\n    ? meta.title\n    : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml\n    ? meta.titleHtml\n    : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon\n    ? meta.icon\n    : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\n\ninterface EntityStateManagerOptions<E extends object> {\n  getKey?: (entity: object) => EntityKey;\n  index?: Map<EntityKey, E>;\n}\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<\n  E extends object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  constructor(private options: EntityStateManagerOptions<E> = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce(\n        (acc: { [key: string]: boolean }, key: string) => {\n          acc[key] = currentState[key] || false;\n          return acc;\n        },\n        {}\n      ) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || ({} as S);\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some(\n          (changeKey: string) => {\n            return (\n              state[changeKey] !== undefined &&\n              state[changeKey] !== reverseChanges[changeKey]\n            );\n          }\n        );\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce(\n      (reverseChanges: Partial<S>, bunch: [string, any]) => {\n        const [changeKey, value] = bunch;\n        if (typeof value === typeof true) {\n          (reverseChanges as object)[changeKey] = !value;\n        }\n        return reverseChanges;\n      },\n      {}\n    );\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = Array.from(this.options?.index?.keys() ?? []);\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport {\n  EntityFilterClause,\n  EntityJoinClause,\n  EntityKey,\n  EntitySortClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject(\n    []\n  );\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey {\n    return this.getKey$.value;\n  }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error(\n        'This view has no index, therefore, this method is unavailable.'\n      );\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error(\n        'This view has already been lifted, therefore, no join is allowed.'\n      );\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ =\n      this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: any[]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [\n      this.source$,\n      combineLatest(this.joins.map((join: EntityJoinClause) => join.source))\n    ];\n\n    return combineLatest(sources$).pipe(\n      map((bunch: [E[], any[]]) => {\n        const [entities, joinData] = bunch;\n        return entities.reduce((values: V[], entity: E) => {\n          const value = this.computeJoinedValue(entity, joinData);\n          if (value !== undefined) {\n            values.push(value);\n          }\n          return values;\n        }, []);\n      })\n    );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[],\n    filters: EntityFilterClause[],\n    filter: EntityFilterClause,\n    sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) {\n      return values;\n    }\n\n    return values.filter((value: V) => {\n      return clauses\n        .filter((clause: EntityFilterClause) => clause !== undefined)\n        .every((clause: EntityFilterClause) => clause(value));\n    });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) {\n      return values;\n    }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityKey, EntityRecord, EntityState } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStateManager } from './state';\nimport type { EntityStoreStrategy } from './strategies/strategy';\nimport { EntityView } from './view';\n\nexport interface EntityStoreOptions {\n  getKey?: (entity: object) => EntityKey;\n  getProperty?: (entity: object, property: string) => any;\n}\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<\n  E extends object = object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean {\n    return this._pristine;\n  }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty\n      ? options.getProperty\n      : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(\n    strategy: EntityStoreStrategy,\n    activate: boolean = false\n  ): EntityStore {\n    const existingStrategy = this.strategies.find(\n      (_strategy: EntityStoreStrategy) => {\n        return strategy.constructor === _strategy.constructor;\n      }\n    );\n    if (existingStrategy !== undefined) {\n      throw new Error(\n        'A strategy of this type already exists on that EntityStore.'\n      );\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({\n      getKey: this.getKey,\n      index: this.index\n    });\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return { entity, state, revision, ref };\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { EntityKey } from './entity.interfaces';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, { [key: string]: any }>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$.subscribe((entities: E[]) =>\n      this.onEntitiesChange(entities)\n    );\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport type { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(\n      store,\n      store.stateView.addFilter(this.options.filterClauseFunc)\n    );\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\" subscriptSizing=\"dynamic\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\"\n  >\n    <mat-option\n      *ngIf=\"emptyText !== undefined && multi === false\"\n      [value]=\"emptyValue\"\n      >{{ emptyText }}</mat-option\n    >\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{\n      multiText$ | async\n    }}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{ titleAccessor(record.entity) }}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { getEntityTitle } from '../shared/entity.utils';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\n\nexport interface EntitySelectorChange<T = any> {\n  selected: boolean;\n  value: T;\n}\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatSelectModule,\n    NgIf,\n    MatOptionModule,\n    NgFor,\n    AsyncPipe\n  ]\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = { id: 'IGO_MULTI_SELECT' };\n\n  readonly emptyValue = { id: 'IGO_EMPTY_SELECT' };\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<EntitySelectorChange>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map(\n          (record: EntityRecord<object>) => record.entity\n        );\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: { value: object | undefined }) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find(\n      (_value: object) => _value === this.multiSelectValue\n    );\n    let entities = values.filter(\n      (_value: object) => _value !== this.multiSelectValue\n    );\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({ selected: false });\n    } else {\n      this.store.state.updateMany(entities, { selected: true }, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({ selected: true, value });\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (\n      entities.length === this.store.count &&\n      this.multiText$.value !== this.multiNoneText\n    ) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (\n      entities.length < this.store.count &&\n      this.multiText$.value !== this.multiAllText\n    ) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  MatPaginator,\n  MatPaginatorModule,\n  PageEvent\n} from '@angular/material/paginator';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityStore } from '../shared';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatPaginatorModule]\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> =\n    new EventEmitter<MatPaginator>();\n\n  constructor(\n    private languageService: LanguageService,\n    private mediaService: MediaService\n  ) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions =\n      this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons =\n        this.paginatorOptions?.showFirstLastButtons ||\n        this.showFirstLastButtons;\n      this.hidePageSize =\n        this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.firstPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.firstPageLabel = label;\n        })\n    );\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.itemsPerPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.itemsPerPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.lastPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.lastPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.nextPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.nextPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.previousPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.previousPageLabel = label;\n        })\n    );\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.of')\n        .subscribe((label: string) => {\n          of.next(label);\n        })\n    );\n    if (length === 0 || pageSize === 0) {\n      return `0 ${of.value} ${length}`;\n    }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex =\n      startIndex < length\n        ? Math.min(startIndex + pageSize, length)\n        : startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  };\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map((sub) => sub.unsubscribe());\n    if (this.count$$) {\n      this.count$$.unsubscribe();\n    }\n    if (this.entitySortChange$$) {\n      this.entitySortChange$$.unsubscribe();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator\n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\"\n>\n</mat-paginator>\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]',\n  standalone: true\n})\nexport class EntityTableRowDirective {\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n    if (value === this._selected) {\n      return;\n    }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","<div class=\"table-container\" [ngStyle]=\"{ height: tableHeight }\">\n  <table\n    id=\"currentWorkspaceTable\"\n    mat-table\n    matSort\n    [ngClass]=\"getTableClass()\"\n    [dataSource]=\"dataSource\"\n    [trackBy]=\"getTrackByFunction()\"\n    (matSortChange)=\"onSort($event)\"\n  >\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n      <th mat-header-cell *matHeaderCellDef>\n        <ng-container *ngIf=\"selectMany\">\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n            <mat-checkbox\n              (change)=\"onToggleRows($event.checked)\"\n              [checked]=\"selectionState === entityTableSelectionState.All\"\n              [indeterminate]=\"\n                selectionState === entityTableSelectionState.Some\n              \"\n            >\n            </mat-checkbox>\n          </ng-container>\n        </ng-container>\n      </th>\n      <td mat-cell *matCellDef=\"let row\">\n        <mat-checkbox\n          (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\n          (click)=\"\n            $event.shiftKey\n              ? onShiftToggleRow(!rowIsSelected(row.record), row.record, $event)\n              : $event.stopPropagation()\n          \"\n          (change)=\"onToggleRow($event.checked, row.record)\"\n          [checked]=\"rowIsSelected(row.record)\"\n        >\n        </mat-checkbox>\n      </td>\n    </ng-container>\n\n    <ng-container\n      [matColumnDef]=\"column.name\"\n      *ngFor=\"let column of template.columns\"\n    >\n      <ng-container *ngIf=\"columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          mat-sort-header\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlDefault\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              {{ row.cellData[column.name].value }}\n            </td>\n            <ng-template #isAnUrlDefault>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"row.cellData[column.name].class\"\n              >\n                <a\n                  href=\"{{ row.cellData[column.name].value }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                    src=\"{{\n                      row.cellData[column.name].value | secureImage | async\n                    }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.common.entity-table.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!row.cellData[column.name].isUrl; else isAnUrlHTML\"\n              [ngClass]=\"row.cellData[column.name].class\"\n              [innerHTML]=\"row.cellData[column.name].value\"\n            ></td>\n            <ng-template #isAnUrlHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"row.cellData[column.name].class\"\n              >\n                <a\n                  href=\"{{ row.cellData[column.name].value }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                    src=\"{{\n                      row.cellData[column.name].value | secureImage | async\n                    }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text edition\"\n              [formGroup]=\"formGroup\"\n              *ngIf=\"isEdition(row.record); else isUnsanitizedHTML\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                <mat-datepicker-toggle\n                  matSuffix\n                  [for]=\"picker\"\n                ></mat-datepicker-toggle>\n                <input\n                  matInput\n                  [matDatepicker]=\"picker\"\n                  [formControlName]=\"column.name\"\n                  value=\"{{ row.cellData[column.name].value }}\"\n                  (dateChange)=\"onDateChange(column.name, row.record, $event)\"\n                />\n                <mat-datepicker #picker></mat-datepicker>\n              </div>\n              <input\n                matInput\n                type=\"time\"\n                *ngIf=\"column.type === 'time'\"\n                [formControlName]=\"column.name\"\n                step=\"900\"\n                (focus)=\"column.onFocus($event)\"\n                (keypress)=\"column.onChange($event)\"\n                (blur)=\"column.onBlur($event)\"\n              />\n              <input\n                matInput\n                type=\"number\"\n                class=\"class_number_edition\"\n                *ngIf=\"column.type === 'number'\"\n                [formControlName]=\"column.name\"\n                step=\"{{ column.step }}\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                (input)=\"onValueChange(column.name, row.record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                min=\"{{ getValidationAttributeValue(column, 'minValue') }}\"\n                max=\"{{ getValidationAttributeValue(column, 'maxValue') }}\"\n              />\n              <input\n                matInput\n                type=\"text\"\n                *ngIf=\"!column.type || column.type === 'string'\"\n                [formControlName]=\"column.name\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                (input)=\"onValueChange(column.name, row.record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n              />\n              <mat-checkbox\n                *ngIf=\"column.type === 'boolean'\"\n                [formControlName]=\"column.name\"\n                [checked]=\"row.cellData[column.name].value\"\n                (change)=\"onBooleanValueChange(column.name, row.record, $event)\"\n              ></mat-checkbox>\n              <mat-select\n                *ngIf=\"column.type === 'list'\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                [formControlName]=\"column.name\"\n                [multiple]=\"column.multiple\"\n                (selectionChange)=\"\n                  onSelectValueChange(column.name, row.record, $event)\n                \"\n                [value]=\"row.cellData[column.name].value\"\n              >\n                <mat-option\n                  *ngFor=\"let option of column.domainValues\"\n                  [value]=\"option.id\"\n                  [disabled]=\"option.disabled\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-select>\n              <input\n                matInput\n                type=\"text\"\n                [formControlName]=\"column.name\"\n                *ngIf=\"column.type === 'autocomplete'\"\n                [matAutocomplete]=\"auto\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                value=\"{{ row.cellData[column.name].value }}\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n              />\n              <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"\n                  onAutocompleteValueChange(column, row.record, $event)\n                \"\n                panelWidth=\"430px\"\n              >\n                <mat-option\n                  *ngFor=\"let option of filteredOptions[column.name] | async\"\n                  [value]=\"option.id\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-autocomplete>\n            </td>\n            <ng-template #isUnsanitizedHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                *ngIf=\"\n                  !row.cellData[column.name].isUrl;\n                  else isAnUrlUnsanitizedHTML\n                \"\n                [ngClass]=\"row.cellData[column.name].class\"\n                [innerHTML]=\"row.cellData[column.name].value | sanitizeHtml\"\n              ></td>\n              <ng-template #isAnUrlUnsanitizedHTML>\n                <td\n                  mat-cell\n                  class=\"mat-cell-text\"\n                  [ngClass]=\"row.cellData[column.name].class\"\n                >\n                  <a\n                    href=\"{{ row.cellData[column.name].value }}\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    (click)=\"$event.stopPropagation()\"\n                  >\n                    <img\n                      igoImageError\n                      *ngIf=\"row.cellData[column.name].isImg; else notImg\"\n                      src=\"{{\n                        row.cellData[column.name].value | secureImage | async\n                      }}\"\n                      width=\"50\"\n                      heigth=\"auto\"\n                    />\n                    <ng-template #notImg\n                      ><span\n                        >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                      </span></ng-template\n                    >\n                  </a>\n                </td>\n              </ng-template>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"row.cellData[column.name].class\"\n          >\n            <mat-icon *ngIf=\"column.onClick\" (click)=\"column.onClick($event)\">{{\n              row.cellData[column.name].value || column.icon\n            }}</mat-icon>\n            <mat-icon *ngIf=\"!column.onClick\">{{\n              row.cellData[column.name].value || column.icon\n            }}</mat-icon>\n          </td>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\"\n        >\n          <ng-container *matCellDef=\"let row\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              [ngClass]=\"row.cellData[column.name].class\"\n            >\n              <span *ngFor=\"let button of row.cellData[column.name].value\">\n                <ng-container\n                  *ngIf=\"\n                    isEdition(row.record) === button.editMode ||\n                    button.editMode === undefined\n                  \"\n                >\n                  <button\n                    *ngIf=\"button.style === 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-icon-button\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon>{{ button.icon }}</mat-icon>\n                  </button>\n                  <button\n                    *ngIf=\"button.style !== 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-mini-fab\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, row.record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon>{{ button.icon }}</mat-icon>\n                  </button>\n                </ng-container>\n              </span>\n            </td>\n          </ng-container>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      mat-header-row\n      *matHeaderRowDef=\"headers; sticky: fixedHeader\"\n      [ngClass]=\"getHeaderClass()\"\n    ></tr>\n    <tr\n      mat-row\n      igoEntityTableRow\n      *matRowDef=\"let row; columns: headers\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [ngClass]=\"getRowClass(row.record)\"\n      [selection]=\"selection\"\n      [selected]=\"rowIsSelected(row.record)\"\n      (select)=\"onRowSelect(row.record)\"\n      (click)=\"onRowClick(row.record)\"\n    ></tr>\n  </table>\n  <igo-entity-table-paginator\n    *ngIf=\"withPaginator\"\n    [store]=\"store\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [entitySortChange$]=\"entitySortChange$\"\n    (paginatorChange)=\"paginatorChange($event)\"\n  >\n  </igo-entity-table-paginator>\n</div>\n","import { FocusMonitor } from '@angular/cdk/a11y';\nimport { AsyncPipe, NgClass, NgFor, NgIf, NgStyle } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Output,\n  Self,\n  SimpleChanges,\n  TrackByFunction\n} from '@angular/core';\nimport {\n  FormControlName,\n  FormsModule,\n  NgControl,\n  NgForm,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { provideMomentDateAdapter } from '@angular/material-moment-adapter';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport {\n  DateAdapter,\n  ErrorStateMatcher,\n  MatNativeDateModule,\n  MatOptionModule\n} from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport {\n  MatFormFieldControl,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableDataSource, MatTableModule } from '@angular/material/table';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StringUtils } from '@igo2/utils';\n\nimport { default as moment } from 'moment';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { EntityTablePaginatorComponent } from '../entity-table-paginator/entity-table-paginator.component';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableScrollBehavior,\n  EntityTableSelectionState,\n  EntityTableTemplate\n} from '../shared';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\n\ninterface CellData {\n  [key: string]: {\n    value: any;\n    class: { [key: string]: boolean };\n    isUrl: boolean;\n    isImg: boolean;\n  };\n}\n\ninterface RowData {\n  record: EntityRecord<object, EntityState>;\n  cellData: CellData;\n}\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    { provide: MatFormFieldControl, useExisting: EntityTableComponent },\n    provideMomentDateAdapter()\n  ],\n  standalone: true,\n  imports: [\n    AsyncPipe,\n    EntityTablePaginatorComponent,\n    EntityTableRowDirective,\n    FormsModule,\n    ImageErrorDirective,\n    MatAutocompleteModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatDatepickerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatInputModule,\n    MatNativeDateModule, // For the DateAdapter provider\n    MatOptionModule,\n    MatSelectModule,\n    MatSortModule,\n    MatTableModule,\n    MatTooltipModule,\n    NgClass,\n    NgFor,\n    NgIf,\n    NgStyle,\n    ReactiveFormsModule,\n    SanitizeHtmlPipe,\n    SecureImagePipe,\n    StopPropagationDirective,\n    IgoLanguageModule\n  ]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\n\n  public filteredOptions = {};\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> =\n    new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{\n    column: EntityTableColumn;\n    direction: string;\n  }> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<RowData>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean {\n    return this.template.selection || false;\n  }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean {\n    return this.template.selectionCheckbox || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean {\n    return this.template.selectMany || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean {\n    return this.template.fixedHeader === undefined\n      ? true\n      : this.template.fixedHeader;\n  }\n\n  get tableHeight(): string {\n    return this.template.tableHeight ? this.template.tableHeight : 'auto';\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private formBuilder: UntypedFormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n    this.store.state.change$.pipe(debounceTime(100)).subscribe(() => {\n      this.handleDatasource();\n      this.refresh();\n    });\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(\n    column: EntityTableColumn,\n    record: EntityRecord<any>,\n    event\n  ) {\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = 'YYYY-MM-DD';\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach((column) => {\n      column.title =\n        column.validation?.mandatory && !column.title.includes('*')\n          ? column.title + ' *'\n          : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control([item[key]])\n          );\n        } else {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control(item[key])\n          );\n\n          typeof item[key] === 'string'\n            ? this.formGroup.controls[column.name].setValue(parseInt(item[key]))\n            : this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n\n        this.filteredOptions[column.name] = new Observable<any[]>();\n        this.filteredOptions[column.name] = this.formGroup.controls[\n          column.name\n        ].valueChanges.pipe(\n          map((value) => {\n            if (value?.length) {\n              return column.domainValues?.filter((option) => {\n                const filterNormalized = value\n                  ? value\n                      .toLowerCase()\n                      .normalize('NFD')\n                      .replace(/[\\u0300-\\u036f]/g, '')\n                  : '';\n                const featureNameNormalized = option.value\n                  .toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach((option) => {\n          if (\n            typeof formControlValue === 'string' &&\n            StringUtils.isValidNumber(formControlValue) &&\n            !StringUtils.isOctalNumber(formControlValue)\n          ) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (\n            option.value === formControlValue ||\n            option.id === formControlValue\n          ) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible !== false) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(item[key])\n            );\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(null)\n            );\n          }\n        }\n      } else {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      }\n\n      if (\n        this.formGroup.controls[column.name] &&\n        this.getValidationAttributeValue(column, 'readonly')\n      ) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView\n          .all()\n          .indexOf(firstSelected);\n        const pageMax = this.paginator\n          ? this.paginator.pageSize * (this.paginator.pageIndex + 1)\n          : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n            firstSelectedStateviewPosition >= pageMax)\n        ) {\n          const pageToReach = Math.floor(\n            firstSelectedStateviewPosition / this.paginator.pageSize\n          );\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all.map((record) => {\n        return {\n          record,\n          cellData: this.template.columns.reduce(\n            (cellData: CellData, column) => {\n              const value = this.getValue(record, column);\n              cellData[column.name] = {\n                class: this.getCellClass(record, column),\n                value,\n                isUrl: this.isUrl(value),\n                isImg: this.isImg(value)\n              };\n              return cellData;\n            },\n            {}\n          )\n        };\n      });\n    });\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction(): TrackByFunction<RowData> {\n    return (_index, row) => row.record.ref;\n  }\n  /**\n   * Trigger a refresh of the table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: { active: string; direction: string }) {\n    const direction = event.direction;\n    const column = this.template.columns.find(\n      (c: EntityTableColumn) => c.name === event.active\n    );\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) =>\n          this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({ column, direction });\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    this.store.state.update(entity, { selected: true }, true);\n    this.entitySelectChange.emit({ added: [entity] });\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entities = this.store.view.all();\n    this.entitySelectChange.emit({ added: [entities] });\n    this.store.state.updateMany(entities, { selected: toggle });\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, { selected: toggle }, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: [entity] });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(\n    toggle: boolean,\n    record: EntityRecord<object>,\n    event: MouseEvent\n  ) {\n    if (this.selection === false) {\n      return;\n    }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(\n      this.lastRecordCheckedKey\n    );\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(\n      Math.min(...indexes),\n      Math.max(...indexes) + 1\n    );\n\n    const entities = selectRecords.map(\n      (_record: EntityRecord<object>) => _record.entity\n    );\n    this.store.state.updateMany(entities, { selected: toggle });\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: entities });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(\n    selectedRecords: EntityRecord<object>[]\n  ): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0\n      ? states.None\n      : selectionCount === this.store.stateView.count\n        ? states.All\n        : states.Some;\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !==\n        -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number') {\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)) {\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string'\n          ? (list_id = value.match(/[\\w.-]+/g).map(Number))\n          : (list_id = value);\n        let list_option = [];\n\n        column.domainValues.forEach((option) => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? (value = list_id) : (value = list_option);\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value =\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ];\n        } else {\n          column.domainValues.forEach((option) => {\n            if (\n              typeof value === 'string' &&\n              StringUtils.isValidNumber(value) &&\n              !StringUtils.isOctalNumber(value)\n            ) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record)\n                ? (value = option.id)\n                : (value = option.value);\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value =\n          entity?.properties[\n            this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n          ];\n      } else {\n        column.domainValues.forEach((option) => {\n          if (\n            typeof value === 'string' &&\n            StringUtils.isValidNumber(value) &&\n            !StringUtils.isOctalNumber(value)\n          ) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = '';\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(\n    column: EntityTableColumn,\n    validationType: string\n  ): any {\n    if (\n      column.validation !== undefined &&\n      column.validation[validationType] !== undefined\n    ) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): { [key: string]: boolean } {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): { [key: string]: boolean } {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): { [key: string]: boolean } {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(\n    record: EntityRecord<object>,\n    column: EntityTableColumn\n  ): { [key: string]: boolean } {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n}\n","import {\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { Subscription } from 'rxjs';\n\nimport { FlexibleDirection, FlexibleState } from './flexible.type';\n\n@Component({\n  selector: 'igo-flexible',\n  templateUrl: './flexible.component.html',\n  styleUrls: ['./flexible.component.scss'],\n  standalone: true\n})\nexport class FlexibleComponent implements OnInit, OnDestroy {\n  static transitionTime = 250;\n\n  @ViewChild('flexibleMain', { static: true }) main;\n\n  @Input()\n  get initial(): string {\n    return this._initial;\n  }\n  set initial(value: string) {\n    this._initial = value;\n  }\n  private _initial = '0';\n\n  @Input()\n  get collapsed(): string {\n    return this._collapsed;\n  }\n  set collapsed(value: string) {\n    this._collapsed = value;\n  }\n  private _collapsed = '0';\n\n  @Input()\n  get expanded(): string {\n    return this._expanded;\n  }\n  set expanded(value: string) {\n    this._expanded = value;\n  }\n  private _expanded = '100%';\n\n  @Input()\n  get initialMobile(): string {\n    return this._initialMobile;\n  }\n  set initialMobile(value: string) {\n    this._initialMobile = value;\n  }\n  private _initialMobile: string = this.expanded;\n\n  @Input()\n  get collapsedMobile(): string {\n    return this._collapsedMobile;\n  }\n  set collapsedMobile(value: string) {\n    this._collapsedMobile = value;\n  }\n  private _collapsedMobile: string = this.collapsed;\n\n  @Input()\n  get expandedMobile(): string {\n    return this._expandedMobile;\n  }\n  set expandedMobile(value: string) {\n    this._expandedMobile = value;\n  }\n  private _expandedMobile: string = this.expanded;\n\n  @Input()\n  get direction(): FlexibleDirection {\n    return this._direction;\n  }\n  set direction(value: FlexibleDirection) {\n    this._direction = value;\n  }\n  private _direction: FlexibleDirection = 'column';\n\n  @Input()\n  get state(): FlexibleState {\n    return this._state;\n  }\n  set state(value: FlexibleState) {\n    const sizes = {\n      initial: this.initial,\n      collapsed: this.collapsed,\n      expanded: this.expanded\n    };\n\n    if (this.mediaService.isMobile()) {\n      Object.assign(sizes, {\n        initial: this.initialMobile,\n        collapsed: this.collapsedMobile,\n        expanded: this.expandedMobile\n      });\n    }\n\n    const size = sizes[value];\n    if (size !== undefined) {\n      this.setSize(size);\n      setTimeout(() => {\n        this._state = value;\n      }, FlexibleComponent.transitionTime);\n    }\n  }\n  private _state: FlexibleState = 'initial';\n\n  private mediaService$$: Subscription;\n\n  constructor(\n    private el: ElementRef,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnInit() {\n    this.el.nativeElement.className += this.direction;\n\n    // Since this component supports different sizes\n    // on mobile, force a redraw when the media changes\n    this.mediaService$$ = this.mediaService.media$.subscribe(\n      (media: Media) => (this.state = this.state)\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  private setSize(size: string) {\n    this._state = 'transition';\n\n    if (this.direction === 'column') {\n      this.main.nativeElement.style.height = size;\n    } else if (this.direction === 'row') {\n      this.main.nativeElement.style.width = size;\n    }\n  }\n}\n","<div #flexibleMain class=\"igo-flexible-main {{ state }} {{ direction }}\">\n  <div class=\"igo-container\">\n    <ng-content></ng-content>\n  </div>\n</div>\n<div class=\"igo-flexible-fill\">\n  <div>\n    <div class=\"igo-container\">\n      <ng-content select=\"[igoFlexibleFill]\"></ng-content>\n    </div>\n  </div>\n</div>\n","<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\"\n  >\n  </igo-dynamic-outlet>\n</ng-container>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\n\nimport { DynamicOutletComponent } from '@igo2/common/dynamic-component';\n\nimport { getDefaultErrorMessages } from '../shared';\nimport { FormFieldService } from '../shared/form-field.service';\nimport {\n  FormField,\n  FormFieldInputs,\n  FormFieldOptions,\n  FormFieldSubscribers\n} from '../shared/form.interfaces';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, DynamicOutletComponent]\n})\nexport class FormFieldComponent {\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: FormFieldSubscribers = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): FormFieldSubscribers {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgClass } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { t } from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [FormsModule, ReactiveFormsModule, NgClass]\n})\nexport class FormComponent implements OnChanges {\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any };\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{ [key: string]: any }>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any } {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: { [key: string]: any }) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(\n    data: { [key: string]: any },\n    field: FormField\n  ) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n}\n","<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\"\n>\n  <div\n    class=\"igo-form-body\"\n    [ngClass]=\"{ 'igo-form-body-with-buttons': hasButtons }\"\n  >\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { FormFieldService } from './form-field.service';\n\nexport function IgoFormFieldComponent(type: string): (cls: any) => any {\n  return (compType: any) => {\n    FormFieldService.register(type, compType);\n  };\n}\n","<mat-form-field>\n  <mat-select\n    [multiple]=\"multiple\"\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n    <mat-option *ngFor=\"let choice of choices$ | async\" [value]=\"choice.value\">\n      {{ choice.title }}\n    </mat-option>\n  </mat-select>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport { FormFieldSelectChoice } from '../shared/form.interfaces';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a select field\n */\n@IgoFormFieldComponent('select')\n@Component({\n  selector: 'igo-form-field-select',\n  templateUrl: './form-field-select.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatSelectModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    NgIf,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldSelectComponent implements OnInit {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Select input choices\n   */\n  @Input()\n  set choices(value: FormFieldSelectChoice[]) {\n    this.choices$.next(value);\n  }\n  get choices(): FormFieldSelectChoice[] {\n    return this.choices$.value;\n  }\n  readonly choices$: BehaviorSubject<FormFieldSelectChoice[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * If the select allow multiple selections\n   */\n  @Input() multiple: boolean = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","<mat-form-field>\n  <input\n    matInput\n    (blur)=\"delayedHide(0)\"\n    [type]=\"isPassword ? (hide ? 'password' : 'text') : 'text'\"\n    [required]=\"isPassword ? 'true' : required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n    (change)=\"delayedHide()\"\n  />\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n\n  <button\n    type=\"button\"\n    *ngIf=\"isPassword\"\n    matSuffix\n    mat-icon-button\n    (click)=\"togglePassword()\"\n  >\n    <mat-icon color=\"primary\">{{\n      hide ? 'visibility_off' : 'visibility'\n    }}</mat-icon>\n  </button>\n\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a text field\n */\n@IgoFormFieldComponent('text')\n@Component({\n  selector: 'igo-form-field-text',\n  templateUrl: './form-field-text.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldTextComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  hide: boolean = true;\n  private lastTimeoutRequest;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * if the input is a password\n   */\n  @Input() isPassword: boolean;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n\n  togglePassword() {\n    this.hide = !this.hide;\n    this.delayedHide();\n  }\n  delayedHide(delayMS: number = 10000) {\n    if (this.isPassword && !this.hide) {\n      if (this.lastTimeoutRequest) {\n        clearTimeout(this.lastTimeoutRequest);\n      }\n      this.lastTimeoutRequest = setTimeout(() => {\n        this.hide = true;\n        this.cdRef.detectChanges();\n      }, delayMS);\n    }\n  }\n}\n","<mat-form-field>\n  <textarea\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n  </textarea>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n    >{{\n      (disabled$ | async) === true ? 'check_box_outline_blank' : 'check_box'\n    }}\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport type { UntypedFormControl } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\n\n/**\n * This component renders a textarea field\n */\n@IgoFormFieldComponent('textarea')\n@Component({\n  selector: 'igo-form-field-textarea',\n  templateUrl: './form-field-textarea.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormFieldTextareaComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","<div *ngIf=\"group && group.fields.length > 0\" class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\"\n  >\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{\n  getErrorMessage() | translate\n}}</mat-error>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { UntypedFormGroup } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { FormFieldComponent } from '../form-field/form-field.component';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getControlErrorMessage } from '../shared/form.utils';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    NgClass,\n    FormFieldComponent,\n    MatFormFieldModule,\n    IgoLanguageModule\n  ]\n})\nexport class FormGroupComponent {\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Form group control\n   */\n  get formControl(): UntypedFormGroup {\n    return this.group.control;\n  }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): { [key: string]: boolean } {\n    const colspan = this.getFieldColSpan(field);\n    return { [`igo-form-field-colspan-${colspan}`]: true };\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { UntypedFormBuilder, ValidatorFn, Validators } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n  constructor(private formBuilder: UntypedFormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return { fields, groups, control };\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, { fields, control }) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({ type: 'text' }, config, { control }) as FormField;\n  }\n\n  extendFieldConfig(\n    config: FormFieldConfig,\n    partial: Partial<FormFieldConfig>\n  ): FormFieldConfig {\n    const options = Object.assign(\n      {},\n      config.options || {},\n      partial.options || {}\n    );\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign(\n      {},\n      config.subscribers || {},\n      partial.subscribers || {}\n    );\n    return Object.assign({}, config, { options, inputs, subscribers });\n  }\n\n  private getValidators(\n    validatorOption: string | string[] | ValidatorFn\n  ): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n}\n","<h1 mat-dialog-title>{{ data.title | translate }}</h1>\n\n<igo-form\n  *ngIf=\"form$ | async as form\"\n  [form]=\"form\"\n  [formData]=\"data$ | async\"\n  (submitForm)=\"onSubmit($event)\"\n>\n  <div *ngIf=\"form.fields.length\" class=\"form-dialog-container\">\n    <igo-form-field\n      *ngFor=\"let field of form.fields\"\n      [field]=\"field\"\n    ></igo-form-field>\n    <igo-form-group\n      *ngFor=\"let group of form.groups\"\n      [group]=\"group\"\n    ></igo-form-group>\n  </div>\n\n  <div formButtons mat-dialog-actions>\n    <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"cancel()\">\n      {{ data.cancelButtonText | translate }}\n    </button>\n    <button mat-flat-button type=\"submit\" color=\"primary\">\n      {{ data.processButtonText | translate }}\n    </button>\n  </div>\n</igo-form>\n<div>\n  <igo-custom-html\n    *ngIf=\"data.notice && data.notice !== ''\"\n    [html]=\"data.notice\"\n  >\n  </igo-custom-html>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FormComponent } from '../form';\nimport { FormFieldComponent } from '../form-field';\nimport { FormGroupComponent } from '../form-group';\nimport {\n  Form,\n  FormField,\n  FormFieldGroup,\n  FormFieldInputs,\n  FormService\n} from '../shared';\nimport { FormDialogData } from './form-dialog.interface';\n\n@Component({\n  selector: 'igo-form-dialog',\n  templateUrl: './form-dialog.component.html',\n  styleUrls: ['./form-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    NgIf,\n    FormComponent,\n    NgFor,\n    FormFieldComponent,\n    FormGroupComponent,\n    MatDialogActions,\n    MatButtonModule,\n    CustomHtmlComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class FormDialogComponent {\n  form$ = new BehaviorSubject<Form>(undefined);\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n  constructor(\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<FormDialogComponent>,\n    private formService: FormService,\n    @Inject(MAT_DIALOG_DATA)\n    public data: FormDialogData\n  ) {\n    this.data.processButtonText =\n      this.data.processButtonText ?? 'igo.common.formDialog.processButtonText';\n    this.data.cancelButtonText =\n      this.data.cancelButtonText ?? 'igo.common.formDialog.cancelButtonText';\n    this.data.title = this.data.title ?? 'igo.common.formDialog.title';\n    this.data$ = this.data.data$;\n\n    let fields: FormField<FormFieldInputs>[] = [];\n    let groups: FormFieldGroup[] = [];\n    this.data.formFieldConfigs?.map((config) =>\n      fields.push(this.formService.field(config))\n    );\n\n    this.data.formGroupsConfigs?.map((formGroupsConfig) => {\n      const fields = formGroupsConfig.formFieldConfigs?.map((config) =>\n        this.formService.field(config)\n      );\n      groups.push(\n        this.formService.group({ name: formGroupsConfig.name }, fields)\n      );\n    });\n    const form = this.formService.form(fields, groups);\n\n    this.form$.next(form);\n  }\n\n  onSubmit(data: { [key: string]: any }) {\n    const form = this.form$.getValue();\n    if (form.control.valid) {\n      this.dialogRef.close(data);\n    } else {\n      if (form.groups?.length) {\n        form.groups.map((group) => {\n          Object.keys(group.control.controls).map((k) => {\n            group.control.controls[k].markAsTouched();\n            group.control.controls[k].updateValueAndValidity();\n          });\n        });\n      } else {\n        form.fields.map((f) => {\n          f.control.markAsTouched();\n          f.control.updateValueAndValidity();\n        });\n      }\n    }\n  }\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { FormDialogComponent } from './form-dialog.component';\nimport {\n  FormDialogData,\n  FormDialogFormConfig,\n  FormDialogOptions\n} from './form-dialog.interface';\n\n@Injectable()\nexport class FormDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    formDialogConfig?: FormDialogFormConfig,\n    options?: FormDialogOptions\n  ): Observable<{ [key: string]: any }> {\n    const data: FormDialogData = {\n      formFieldConfigs: formDialogConfig.formFieldConfigs,\n      formGroupsConfigs: formDialogConfig.formGroupsConfigs,\n      ...options\n    };\n    const dialogRef = this.dialog.open(FormDialogComponent, {\n      disableClose: false,\n      data,\n      ...options\n    });\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { FormDialogComponent } from './form-dialog.component';\nimport { FormDialogService } from './form-dialog.service';\n\n/**\n * @deprecated import the FlexibleComponent directly\n */\n@NgModule({\n  imports: [MatDialogModule, FormDialogComponent],\n  exports: [FormDialogComponent],\n  providers: [FormDialogService]\n})\nexport class IgoFormDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoFormDialogModule> {\n    return {\n      ngModule: IgoFormDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n  static fields: { [key: string]: any } = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find(\n      (key: string) => {\n        return formControlIsRequired((control as any).controls[key]);\n      }\n    );\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): { [key: string]: string } {\n  return {\n    required: 'igo.common.form.errors.required',\n    email: 'igo.common.form.errors.email'\n  };\n}\n\nexport function getControlErrorMessage(\n  control: AbstractControl,\n  messages: { [key: string]: string }\n): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","import { IconSvg } from './icon.interface';\n\n/**\n * Source: https://pictogrammers.com/library/mdi/\n */\nexport const MAGNIFY_SCAN_ICON: IconSvg = {\n  name: 'magnify-scan',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>magnify-scan</title><path d=\"M17 22V20H20V17H22V20.5C22 20.89 21.84 21.24 21.54 21.54C21.24 21.84 20.89 22 20.5 22H17M7 22H3.5C3.11 22 2.76 21.84 2.46 21.54C2.16 21.24 2 20.89 2 20.5V17H4V20H7V22M17 2H20.5C20.89 2 21.24 2.16 21.54 2.46C21.84 2.76 22 3.11 22 3.5V7H20V4H17V2M7 2V4H4V7H2V3.5C2 3.11 2.16 2.76 2.46 2.46C2.76 2.16 3.11 2 3.5 2H7M10.5 6C13 6 15 8 15 10.5C15 11.38 14.75 12.2 14.31 12.9L17.57 16.16L16.16 17.57L12.9 14.31C12.2 14.75 11.38 15 10.5 15C8 15 6 13 6 10.5C6 8 8 6 10.5 6M10.5 8C9.12 8 8 9.12 8 10.5C8 11.88 9.12 13 10.5 13C11.88 13 13 11.88 13 10.5C13 9.12 11.88 8 10.5 8Z\" /></svg>\n`\n};\n\nexport const MICROSOFT_ICON: IconSvg = {\n  name: 'microsoft',\n  svg: `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>microsoft</title><path d=\"M2,3H11V12H2V3M11,22H2V13H11V22M21,3V12H12V3H21M21,22H12V13H21V22Z\" /></svg>\n`\n};\n\nexport const KEYBOARD_ESC_ICON: IconSvg = {\n  name: 'keyboard-esc',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>keyboard-esc</title><path d=\"M1 7H7V9H3V11H7V13H3V15H7V17H1V7M11 7H15V9H11V11H13C14.11 11 15 11.9 15 13V15C15 16.11 14.11 17 13 17H9V15H13V13H11C9.9 13 9 12.11 9 11V9C9 7.9 9.9 7 11 7M19 7H21C22.11 7 23 7.9 23 9V10H21V9H19V15H21V14H23V15C23 16.11 22.11 17 21 17H19C17.9 17 17 16.11 17 15V9C17 7.9 17.9 7 19 7Z\" /></svg>\n`\n};\n\nexport const ENGINE_ICON: IconSvg = {\n  name: 'engine',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>engine</title><path d=\"M7,4V6H10V8H7L5,10V13H3V10H1V18H3V15H5V18H8L10,20H18V16H20V19H23V9H20V12H18V8H12V6H15V4H7Z\" /></svg>\n`\n};\n\nexport const SELECTION_MARKER_ICON: IconSvg = {\n  name: 'selection-marker',\n  svg: `\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>selection-marker</title><path d=\"M2 4C2 2.89 2.9 2 4 2H7V4H4V7H2V4M22 4V7H20V4H17V2H20C21.1 2 22 2.89 22 4M2 20V17H4V20H7V22H4C2.9 22 2 21.11 2 20M10 2H14V4H10V2M10 20H14V22H10V20M2 10H4V14H2V10M18.5 13C20.4 13 22 14.6 22 16.5C22 19.1 18.5 23 18.5 23C18.5 23 15 19.1 15 16.5C15 14.6 16.6 13 18.5 13M18.5 17.8C19.2 17.8 19.8 17.2 19.7 16.6C19.7 16 19.1 15.4 18.5 15.4C17.9 15.4 17.3 15.9 17.3 16.6C17.3 17.2 17.8 17.8 18.5 17.8M20 10H22V12.34C21.42 11.84 20.74 11.45 20 11.23V10Z\" /></svg>\n`\n};\n\nexport const PRESENTATION_PLAY_ICON: IconSvg = {\n  name: 'presentation-play',\n  svg: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>presentation-play</title><path d=\"M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z\" /></svg>`\n};\n\n\nexport const LAYER_PLUS_ICON: IconSvg = {\n  name: 'layers-plus',\n  svg: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><title>layers-plus</title><path d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\" /></svg>`\n};\n","import { Injectable } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { DomSanitizer } from '@angular/platform-browser';\n\nimport { IconSvg } from './icon.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class IconService {\n  constructor(\n    private iconRegistry: MatIconRegistry,\n    private sanitizer: DomSanitizer\n  ) {}\n\n  registerSvg(icon: IconSvg): void {\n    this.iconRegistry.addSvgIconLiteral(\n      icon.name,\n      this.sanitizer.bypassSecurityTrustHtml(icon.svg)\n    );\n  }\n}\n","import {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  makeEnvironmentProviders\n} from '@angular/core';\nimport { MatIconModule, MatIconRegistry } from '@angular/material/icon';\n\ntype MaterialSymbolStyle = 'outlined' | 'rounded' | 'sharp';\n\nexport function provideIcon(\n  style: MaterialSymbolStyle = 'outlined'\n): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    MatIconModule,\n    {\n      provide: APP_INITIALIZER,\n      useFactory: (iconRegistry: MatIconRegistry) => () =>\n        iconRegistry.setDefaultFontSetClass(`material-symbols-${style}`),\n      deps: [MatIconRegistry],\n      multi: true\n    }\n  ]);\n}\n","@if (isSvg(icon)) {\n  <mat-icon [svgIcon]=\"icon.name\"></mat-icon>\n} @else {\n  <mat-icon>{{ icon }}</mat-icon>\n}\n","import { Component, Input } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IconSvg } from '../shared';\nimport { IconService } from '../shared/icon.service';\n\n@Component({\n  selector: 'igo-icon',\n  standalone: true,\n  imports: [MatIconModule],\n  templateUrl: './icon.component.html'\n})\nexport class IgoIconComponent {\n  @Input({ required: true })\n  set icon(icon: string | IconSvg) {\n    if (this.isSvg(icon)) {\n      this.registerSvg(icon);\n    }\n\n    this._icon = icon;\n  }\n  get icon(): string | IconSvg {\n    return this._icon;\n  }\n  private _icon: string | IconSvg;\n\n  constructor(private iconService: IconService) {}\n\n  registerSvg(icon: IconSvg): void {\n    this.iconService.registerSvg(icon);\n  }\n\n  isSvg(icon: string | IconSvg): icon is IconSvg {\n    return typeof icon != 'string';\n  }\n}\n","import { Directive, ElementRef, HostListener, Input } from '@angular/core';\n\n@Directive({\n  selector: '[igoImageError]',\n  standalone: true\n})\nexport class ImageErrorDirective {\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\n  @Input() hideError: boolean = false;\n\n  constructor(private el: ElementRef) {}\n\n  @HostListener('error', ['$event'])\n  public onError(event: any): void {\n    if (this.hideError) {\n      this.el.nativeElement.style.display = 'none';\n    } else {\n      event.target.src = this.errorImageUrl;\n    }\n  }\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Pipe, PipeTransform } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\n@Pipe({\n  name: 'secureImage',\n  standalone: true\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService\n  ) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false',\n      interceptError: 'false'\n    });\n\n    const regexDepot = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\n    );\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        catchError((err) => {\n          err.error.caught = true;\n          err.error.toDisplay = false;\n          throw err;\n        }),\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","<ng-container *ngIf=\"showTourButton\">\n  <button\n    *ngIf=\"styleButton === 'icon'; else raisedButton\"\n    (click)=\"startInteractiveTour()\"\n    [ngClass]=\"getClass()\"\n    color=\"primary\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      disabledTourButton\n        ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n          | translate)\n        : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n    \"\n    [disabled]=\"disabledTourButton\"\n  >\n    <igo-icon [icon]=\"presentationIcon\" iconPositionEnd />\n  </button>\n\n  <ng-template #raisedButton>\n    <button\n      (click)=\"startInteractiveTour()\"\n      [ngClass]=\"getClass()\"\n      color=\"primary\"\n      mat-raised-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"disabledTourButton\"\n    >\n      {{ 'igo.common.interactiveTour.buttonTitle' | translate }}\n      {{ discoverTitleInLocale$ | async | translate }}\n      <mat-icon\n        [svgIcon]=\"presentationIcon.name\"\n        iconPositionEnd\n        [matTooltip]=\"\n          disabledTourButton\n            ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n              | translate)\n            : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n        \"\n        >\n      </mat-icon>\n    </button>\n  </ng-template>\n</ng-container>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport { Component, Input, ViewEncapsulation } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IconService,\n  IgoIconComponent,\n  PRESENTATION_PLAY_ICON\n} from '@igo2/common/icon';\nimport { ToolService } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Observable, of } from 'rxjs';\n\nimport { InteractiveTourService } from './interactive-tour.service';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    NgClass,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class InteractiveTourComponent {\n  presentationIcon = PRESENTATION_PLAY_ICON;\n\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: 'icon' | 'raised';\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService,\n    private iconService: IconService\n  ) {\n    this.iconService.registerSvg(this.presentationIcon);\n  }\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { InteractiveTourOptions } from './interactive-tour.interface';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(\n    private http: HttpClient,\n    private configService: ConfigService\n  ) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n  public loadConfigTour() {\n    this.getJSON().subscribe(\n      (data) => {\n        this.allToursOptions = data;\n      },\n      (err) => {\n        throw new Error(\n          `Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`\n        );\n      }\n    );\n  }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { autoPlacement, offset } from '@floating-ui/dom';\nimport { ShepherdService } from 'angular-shepherd';\nimport Shepherd from 'shepherd.js';\n\nimport {\n  InteractiveTourAction,\n  InteractiveTourOptions,\n  InteractiveTourStep\n} from './interactive-tour.interface';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig(\n      'interactiveTour.activateInteractiveTour'\n    );\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n\n    return showInMobile === undefined ? true : showInMobile;\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (\n          self.getCurrentStep().options.attachTo.element &&\n          !document.querySelector(\n            self.getCurrentStep().options.attachTo.element\n          )\n        ) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll(\n              '.shepherd-content, .shepherd-text'\n            );\n            shepherdList.forEach((element) => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (\n        tour.getCurrentStep().options.attachTo.element &&\n        document.querySelector(tour.getCurrentStep().options.attachTo.element)\n      ) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (\n        nextStep.options.attachTo.element &&\n        !document.querySelector(nextStep.options.attachTo.element)\n      ) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(tourConfig: InteractiveTourOptions) {\n    const shepherdSteps: Shepherd.Step.StepOptions[] = [];\n\n    let i = 0;\n    for (const step of tourConfig.steps) {\n      const position = step.position ?? tourConfig.position;\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: position as any // PopperPlacement\n        },\n        floatingUIOptions: {\n          middleware: [\n            position === 'auto' && autoPlacement(),\n            offset({ mainAxis: 15 })\n          ].filter(Boolean)\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === tourConfig.steps.length\n              ? 'last'\n              : tourConfig.steps[i].noBackButton\n                ? 'noBackButton'\n                : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || tourConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || tourConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      } satisfies Shepherd.Step.StepOptions);\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions =\n      this.interactiveTourLoader.getTourOptionData(toolName);\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) => {\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport { InteractiveTourService } from './interactive-tour.service';\n\n@NgModule({\n  imports: [InteractiveTourComponent],\n  exports: [InteractiveTourComponent],\n  providers: [InteractiveTourService, InteractiveTourLoader]\n})\nexport class IgoInteractiveTourModule {}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]',\n  standalone: true\n})\nexport class ListItemDirective {\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(\n    public renderer: Renderer2,\n    public el: ElementRef\n  ) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]',\n  standalone: true\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgClass } from '@angular/common';\nimport {\n  AfterViewInit,\n  Component,\n  ContentChildren,\n  ElementRef,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ClickoutDirective } from '@igo2/common/clickout';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss'],\n  standalone: true,\n  imports: [MatListModule, ClickoutDirective, NgClass]\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach((item) => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find((item) => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find((item) => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex((item) => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{ selectable: selection }\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\"\n>\n  <ng-content></ng-content>\n</mat-list>\n","<div\n  *ngIf=\"withHeader\"\n  class=\"igo-panel-header\"\n  title=\"\"\n  [ngClass]=\"{ 'igo-cursor-pointer': cursorPointer === true }\"\n>\n  <div class=\"panel-left\">\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n  </div>\n  <h3 class=\"igo-panel-title\">\n    {{ title }}\n    <ng-content select=\"[panelHeader]\"></ng-content>\n  </h3>\n  <div class=\"panel-right\">\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </div>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import { NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  HostBinding,\n  Input\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, NgClass]\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","import { AsyncPipe, NgClass } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatProgressSpinner } from '@angular/material/progress-spinner';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss'],\n  standalone: true,\n  imports: [NgClass, MatProgressSpinner, AsyncPipe]\n})\nexport class SpinnerComponent {\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) {\n    this.shown$.next(value);\n  }\n  get shown(): boolean {\n    return this.shown$.value;\n  }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{\n    'igo-spinner-container': true,\n    'igo-spinner-shown': (shown$ | async)\n  }\"\n>\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner\n    diameter=\"40\"\n    mode=\"indeterminate\"\n  ></mat-progress-spinner>\n</div>\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopDropPropagation]',\n  standalone: true\n})\nexport class StopDropPropagationDirective {\n  @HostListener('drop', ['$event'])\n  public onDrop(event: any): void {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]',\n  standalone: true\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import { EntityRecord, EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { Tool, ToolboxOptions } from './tool.interface';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n  private previousToolName: string;\n  private currentToolName: string;\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  getCurrentPreviousToolName(): [string, string] {\n    return [this.previousToolName, this.currentToolName];\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n\n      this.previousToolName = this.currentToolName;\n      this.currentToolName =\n        this.activeToolHistory[this.activeToolHistory.length - 1];\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(\n      Object.assign({}, tool, {\n        component: compType\n      } as Tool)\n    );\n  };\n}\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\"\n>\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container mat-body-1\"\n  [ngClass]=\"{\n    'igo-tool-container-with-toolbar': !actionStore.empty,\n    'igo-tool-container-with-animation': animate\n  }\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\"\n>\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\"\n  >\n  </igo-dynamic-outlet>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  HostBinding,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { Action, ActionStore, ActionbarComponent } from '@igo2/common/action';\nimport { DynamicOutletComponent } from '@igo2/common/dynamic-component';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Tool } from '../shared/tool.interface';\nimport { Toolbox } from '../shared/toolbox';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    ActionbarComponent,\n    NgClass,\n    DynamicOutletComponent,\n    AsyncPipe\n  ]\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  get isActive(): boolean {\n    return !!this.activeTool$.value;\n  }\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = 'white';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === 'grey';\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === 'primary';\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '@igo2/common/dynamic-component';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @deprecated import the WidgetOutletComponent directly\n */\n@NgModule({\n  imports: [WidgetOutletComponent],\n  exports: [WidgetOutletComponent]\n})\nexport class IgoWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\n\nimport { WidgetService } from './shared/widget.service';\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\n\n/**\n * @deprecated import the WidgetOutletComponent directly\n */\n@NgModule({\n  imports: [IgoWidgetOutletModule],\n  exports: [IgoWidgetOutletModule],\n  declarations: [],\n  providers: [WidgetService]\n})\nexport class IgoWidgetModule {}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\"\n>\n</igo-dynamic-outlet>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\n\nimport {\n  DynamicComponent,\n  DynamicOutletComponent\n} from '@igo2/common/dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, DynamicOutletComponent]\n})\nexport class WidgetOutletComponent implements OnDestroy {\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: { [key: string]: any };\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): { [key: string]: (event: any) => void } {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Workspace } from './workspace';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, { active: true, selected: true }, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n}\n","import { ActionStore } from '@igo2/common/action';\nimport { EntityStore } from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{ [key: string]: any }>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string {\n    return this.options.id;\n  }\n\n  /**\n   * Workspace title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Workspace title\n   */\n  get meta(): { [key: string]: any } {\n    return this.options.meta || {};\n  }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> {\n    return this.options.entityStore as EntityStore<E>;\n  }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore {\n    return this.options.actionStore;\n  }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget {\n    return this.widget$.value;\n  }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean {\n    return this.widget !== undefined;\n  }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView\n        .all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: { [key: string]: any } = {},\n    subscribers: { [key: string]: (event: any) => void } = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport {\n  EntitySelectorChange,\n  EntitySelectorComponent,\n  getEntityTitle\n} from '@igo2/common/entity';\n\nimport { WorkspaceStore } from '../shared/store';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [EntitySelectorComponent]\n})\nexport class WorkspaceSelectorComponent {\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: EntitySelectorChange<Workspace>) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({ selected: true, value: workspace });\n  }\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\"\n>\n</igo-entity-selector>\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\"\n  >\n  </igo-widget-outlet>\n</ng-container>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { Widget, WidgetOutletComponent } from '@igo2/common/widget';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, WidgetOutletComponent, AsyncPipe]\n})\nexport class WorkspaceWidgetOutletComponent {\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> {\n    return this.workspace.widget$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{ [key: string]: any }> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { Tool } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { Message, MessageService } from '@igo2/core/message';\nimport { RouteService } from '@igo2/core/route';\nimport { StorageService } from '@igo2/core/storage';\nimport type {\n  AnyLayerOptions,\n  IgoMap,\n  Layer,\n  VectorLayerOptions,\n  VectorTileLayerOptions\n} from '@igo2/geo';\nimport { ExportService } from '@igo2/geo';\nimport { ObjectUtils, uuid } from '@igo2/utils';\n\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { Geometry } from 'ol/geom';\nimport olPoint from 'ol/geom/Point';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Feature } from 'ol';\nimport { BehaviorSubject, Observable, Subject, of } from 'rxjs';\nimport {\n  catchError,\n  debounceTime,\n  first,\n  map,\n  mergeMap,\n  skip,\n  tap\n} from 'rxjs/operators';\n\nimport { TypePermission } from './context.enum';\nimport {\n  Context,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils,\n  ContextServiceOptions,\n  ContextsList,\n  DetailedContext,\n  ExtraFeatures\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return (\n      (this.storageService.get('favorite.context.uri') as string) ||\n      this._defaultContextUri ||\n      this.options.defaultContextUri\n    );\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private exportService: ExportService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url ?? '';\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context: DetailedContext = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$\n        .getValue()\n        .filter((lay) => !lay.id.includes('WfsWorkspaceTableDest'))\n        .sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const layer of layers) {\n      const layerOptions: AnyLayerOptions = {\n        title: layer.options.title,\n        zIndex: ++i,\n        visible: layer.visible,\n        security: layer.options.security,\n        opacity: layer.opacity\n      };\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions,\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return {\n        id: String(tool.id),\n        global: tool.global\n      } as Tool;\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string,\n    keepCurrentView?: boolean\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context: DetailedContext = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          keepCurrentView\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      // Do not seem to work properly. layerFound is always undefined.\n      const layerFound = currentContext.layers.find((contextLayer) => {\n        const source = contextLayer.source;\n        return source && layer.id === source.id && !contextLayer.baseLayer;\n      });\n      if (layerFound) {\n        let layerFoundAs = layerFound as\n          | VectorLayerOptions\n          | VectorTileLayerOptions;\n        let layerStyle = layerFoundAs.style;\n        if (layerFoundAs.igoStyle?.styleByAttribute) {\n          layerStyle = undefined;\n        } else if (layerFoundAs.igoStyle?.clusterBaseStyle) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        delete layerFound.source;\n        const opts: AnyLayerOptions = {\n          ...layerFound,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          style: layerStyle,\n          visible: layer.visible,\n          opacity: layer.opacity\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          (catalogLayer.visible = layer.visible),\n            (catalogLayer.opacity = layer.opacity);\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          const extraFeatures = this.getExtraFeatures(layer);\n          extraFeatures.name = layer.options.title;\n          extraFeatures.opacity = layer.opacity;\n          extraFeatures.visible = layer.visible;\n          context.extraFeatures.push(extraFeatures);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  private getExtraFeatures(layer: Layer): ExtraFeatures {\n    const writer = new GeoJSON();\n    let olFeatures: Feature<Geometry>[];\n    if (layer.ol.getSource() instanceof Cluster) {\n      const clusterSource = layer.ol.getSource() as Cluster;\n      olFeatures = clusterSource.getFeatures();\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    } else {\n      const source = layer.ol.getSource() as olVectorSource;\n      olFeatures = source.getFeatures();\n    }\n    const cleanedOlFeatures = this.exportService.generateFeature(\n      olFeatures,\n      'GeoJSON',\n      '_featureStore'\n    );\n    const features = writer.writeFeatures(cleanedOlFeatures, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:3857'\n    });\n    return JSON.parse(features);\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (\n      this.context$.value &&\n      context.uri &&\n      this.context$.value.uri !== context.uri\n    ) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map((message) => {\n      if (message) {\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(\n      'igo.context.contextManager.errors.addPermission',\n      'igo.context.contextManager.errors.addPermissionTitle'\n    );\n  }\n\n  private handleContextsChange(keepCurrentContext = true) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe((newContext: DetailedContext) => {\n          this.toolsChanged$.next(newContext);\n        });\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ExportNothingToExportError } from './context-export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextExportService {\n  export(res: DetailedContext): Observable<void> {\n    return this.exportAsync(res);\n  }\n\n  protected exportAsync(res: DetailedContext): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(res);\n      if (nothingToExport === true) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n      const contextJSON = JSON.stringify(res);\n      downloadContent(\n        contextJSON,\n        'text/json;charset=utf-8',\n        `${res.uri}.json`\n      );\n      observer.complete();\n    };\n    return new Observable(doExport);\n  }\n\n  protected nothingToExport(res: DetailedContext): boolean {\n    if (res.map === undefined) {\n      return true;\n    }\n    return false;\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","import { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  ClusterDataSourceOptions,\n  ClusterParam,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  QueryableDataSourceOptions,\n  StyleByAttribute,\n  StyleListService,\n  StyleService,\n  VectorLayer,\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '@igo2/geo';\n\nimport OlFeature from 'ol/Feature';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DetailedContext,\n  ExtraFeatures\n} from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  messageService.success(\n    'igo.context.contextImportExport.import.success.text',\n    'igo.context.contextImportExport.import.success.title',\n    undefined,\n    {\n      value: contextTitle\n    }\n  );\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.invalid.text',\n    'igo.context.contextImportExport.import.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    'igo.context.contextImportExport.import.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.unreadable.text',\n    'igo.context.contextImportExport.import.unreadable.title',\n    undefined,\n    {\n      value: file.name\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.empty.text',\n    'igo.context.contextImportExport.import.empty.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap\n): VectorLayer {\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n\n  let randomStyle;\n  let editable: boolean = false;\n  const featureKeys = olFeatures[0]?.getKeys() ?? [];\n  if (featureKeys.includes('_style') || featureKeys.includes('_mapTitle')) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    style: randomStyle,\n    visible: extraFeatures.visible,\n    opacity: extraFeatures.opacity\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (styleListService.getStyleList(extraFeatures.name + '.styleByAttribute')) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      extraFeatures.name + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(extraFeatures.name + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      extraFeatures.name + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(extraFeatures.name + '.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(extraFeatures.name + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.style'),\n        feature,\n        resolution\n      );\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n  let source;\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  if (styleListService.getStyleList(extraFeatures.name + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    style,\n    opacity: extraFeatures.opacity,\n    visible: extraFeatures.visible\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nfunction collectFeaturesFromExtraFeatures(\n  featureCollection: ExtraFeatures\n): OlFeature<OlGeometry>[] {\n  const format = new GeoJSON();\n  const features = format.readFeatures(featureCollection, {\n    dataProjection: 'EPSG:4326',\n    featureProjection: 'EPSG:3857'\n  });\n  return features;\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport {\n  ImportInvalidFileError,\n  ImportSizeError,\n  ImportUnreadableFileError\n} from './context-import.errors';\nimport { getFileExtension } from './context-import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextImportService {\n  static allowedMimeTypes = ['application/json'];\n\n  static allowedExtensions = 'json';\n\n  private clientSideFileSizeMax: number;\n\n  constructor(private config: ConfigService) {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(file: File): Observable<DetailedContext> {\n    return this.importAsync(file);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<DetailedContext>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [...ContextImportService.allowedMimeTypes];\n    const allowedExtensions = ContextImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      extension === ContextImportService.allowedExtensions\n    ) {\n      return this.importFile;\n    }\n    return undefined;\n  }\n\n  private importAsync(file: File): Observable<DetailedContext> {\n    const doImport = (observer: Observer<DetailedContext>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(file: File, observer: Observer<DetailedContext>) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const context = this.parseContextFromFile(file, event.target.result);\n        observer.next(context);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private parseContextFromFile(file: File, data: string): DetailedContext {\n    const context: DetailedContext = JSON.parse(data);\n    return context;\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"activeImportExport\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"activeImportExport === 'import'\">\n  <form class=\"igo-form\">\n    <div class=\"igo-form-button-group\">\n      <button\n        mat-raised-button\n        type=\"button\"\n        (click)=\"fileInput.click()\"\n        [disabled]=\"loading$ | async\"\n      >\n        {{ 'igo.geo.importExportForm.importButton' | translate }}\n      </button>\n      <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n      <input\n        #fileInput\n        type=\"file\"\n        [style.display]=\"'none'\"\n        (click)=\"fileInput.value = null\"\n        (change)=\"importFiles($any($event.target).files)\"\n      />\n    </div>\n  </form>\n  <section class=\"mat-typography\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n    </ul>\n  </section>\n</div>\n\n<form\n  class=\"igo-form\"\n  *ngIf=\"activeImportExport === 'export'\"\n  [formGroup]=\"form\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field class=\"example-full-width\">\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportContextName' | translate\n      }}</mat-label>\n      <input formControlName=\"name\" matInput [value]=\"\" />\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportPlaceHolder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.context.contextImportExport.export.exportSelectAll' | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{ 'igo.geo.importExportForm.exportButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n</form>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Layer, VectorLayer } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport { ContextExportService } from '../shared/context-export.service';\nimport { handleFileExportError } from '../shared/context-export.utils';\nimport { handleFileExportSuccess } from '../shared/context-export.utils';\nimport { ContextImportService } from '../shared/context-import.service';\nimport {\n  handleFileImportError,\n  handleFileImportSuccess\n} from '../shared/context-import.utils';\n\n@Component({\n  selector: 'igo-context-import-export',\n  templateUrl: './context-import-export.component.html',\n  styleUrls: ['./context-import-export.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    NgIf,\n    FormsModule,\n    MatButtonModule,\n    SpinnerComponent,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDividerModule,\n    NgFor,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ContextImportExportComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public inputProj: string = 'EPSG:4326';\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public res: DetailedContext;\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n  public activeImportExport: string = 'import';\n\n  private layers$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  constructor(\n    private contextImportService: ContextImportService,\n    private contextExportService: ContextExportService,\n    private messageService: MessageService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private contextService: ContextService\n  ) {\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.layerList = this.contextService.getContextLayers(this.map);\n      this.userControlledLayerList = this.layerList.filter(\n        (layer) => layer.showInLayerList\n      );\n    });\n  }\n\n  importFiles(files: File[]) {\n    this.loading$.next(true);\n    for (const file of files) {\n      this.contextImportService\n        .import(file)\n        .pipe(take(1))\n        .subscribe(\n          (context: DetailedContext) => this.onFileImportSuccess(file, context),\n          (error: Error) => this.onFileImportError(file, error),\n          () => {\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  handleExportFormSubmit(contextOptions) {\n    this.loading$.next(true);\n    this.res = this.contextService.getContextFromLayers(\n      this.map,\n      contextOptions.layers,\n      contextOptions.name,\n      false\n    );\n    this.res.imported = true;\n    this.contextExportService\n      .export(this.res)\n      .pipe(take(1))\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n          this.loading$.next(false);\n        }\n      );\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]],\n      name: ['', [Validators.required]]\n    });\n  }\n\n  private onFileImportSuccess(file: File, context: DetailedContext) {\n    handleFileImportSuccess(\n      file,\n      context,\n      this.messageService,\n      this.contextService\n    );\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    }\n    if (e._selected === false) {\n      this.form.controls.layers.setValue([]);\n    }\n  }\n\n  onImportExportChange(event) {\n    this.activeImportExport = event.value;\n  }\n\n  ngOnDestroy(): void {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { MessageService } from '@igo2/core/message';\n\nimport { ExportNothingToExportError } from './context-export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    this.handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.context.contextImportExport.export.failed.text',\n    'igo.context.contextImportExport.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.context.contextImportExport.export.success.text',\n    'igo.context.contextImportExport.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.context.contextImportExport.export.nothing.text',\n    'igo.context.contextImportExport.export.nothing.title'\n  );\n}\n","<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  (ngSubmit)=\"handleFormSubmit(form.value)\"\n>\n  <mat-form-field class=\"full-width\">\n    <input\n      matInput\n      required\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n      formControlName=\"title\"\n    />\n    <mat-error>\n      {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n    </mat-error>\n  </mat-form-field>\n\n  <mat-form-field id=\"uriInput\" class=\"full-width\">\n    <span *ngIf=\"prefix\" class=\"prefix\">{{ prefix }}-</span>\n    <span class=\"fieldWrapper\">\n      <input\n        matInput\n        maxlength=\"64\"\n        floatLabel=\"always\"\n        [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n        formControlName=\"uri\"\n      />\n    </span>\n  </mat-form-field>\n\n  <button\n    id=\"copyButton\"\n    type=\"button\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.context.contextManager.form.copy' | translate\"\n    color=\"primary\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon>content_copy</mat-icon>\n  </button>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid || disabled\"\n    >\n      {{ 'igo.context.contextManager.form.edit' | translate }}\n    </button>\n  </div>\n</form>\n","import { NgIf } from '@angular/common';\nimport { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Clipboard, ObjectUtils } from '@igo2/utils';\n\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-form',\n  templateUrl: './context-form.component.html',\n  styleUrls: ['./context-form.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ContextFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public prefix: string;\n\n  @Input()\n  get btnSubmitText(): string {\n    return this._btnSubmitText;\n  }\n  set btnSubmitText(value: string) {\n    this._btnSubmitText = value;\n  }\n  private _btnSubmitText: string;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.buildForm();\n  }\n  private _context: Context;\n\n  @Input()\n  get disabled(): boolean {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    this._disabled = value;\n  }\n  private _disabled = false;\n\n  // TODO: replace any by ContextOptions or Context\n  @Output() submitForm: EventEmitter<any> = new EventEmitter();\n  @Output() clone: EventEmitter<any> = new EventEmitter();\n  @Output() delete: EventEmitter<any> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n  }\n\n  public handleFormSubmit(value) {\n    let inputs = Object.assign({}, value);\n    inputs = ObjectUtils.removeNull(inputs);\n    inputs.uri = inputs.uri.replace(' ', '');\n    if (inputs.uri) {\n      inputs.uri = this.prefix + '-' + inputs.uri;\n    } else {\n      inputs.uri = this.prefix;\n    }\n    this.submitForm.emit(inputs);\n  }\n\n  public copyTextToClipboard() {\n    const text = this.prefix + '-' + this.form.value.uri.replace(' ', '');\n    const successful = Clipboard.copy(text);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.copyMsg',\n        'igo.context.contextManager.dialog.copyTitle'\n      );\n    }\n  }\n\n  private buildForm(): void {\n    const context: any = this.context || {};\n\n    const uriSplit = context.uri.split('-');\n    this.prefix = uriSplit.shift();\n    const uri = uriSplit.join('-');\n\n    this.form = this.formBuilder.group({\n      title: [context.title],\n      uri: [uri || ' ']\n    });\n  }\n}\n","<igo-context-form\n  *ngIf=\"context\"\n  [btnSubmitText]=\"'igo.context.contextManager.save' | translate\"\n  [context]=\"context\"\n  (submitForm)=\"submitForm.emit($event)\"\n>\n</igo-context-form>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { ContextFormComponent } from '../context-form/context-form.component';\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-edit',\n  templateUrl: './context-edit.component.html',\n  standalone: true,\n  imports: [NgIf, ContextFormComponent, IgoLanguageModule]\n})\nexport class ContextEditComponent {\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.refresh();\n  }\n  private _context: Context;\n\n  @Output() submitForm: EventEmitter<Context> = new EventEmitter();\n\n  constructor(private cd: ChangeDetectorRef) {}\n\n  refresh() {\n    this.cd.detectChanges();\n  }\n}\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{ 'mat-list-item-light': hidden }\"\n>\n  <button\n    *ngIf=\"auth.authenticated\"\n    matListItemAvatar\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"\n      auth.authenticated\n        ? ('igo.context.contextManager.favorite' | translate)\n        : ''\n    \"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon *ngIf=\"!context.iconImage\">{{\n      context.icon\n        ? context.icon\n        : context.scope === 'public'\n          ? 'public'\n          : 'star'\n    }}</mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\" />\n  </button>\n  <button\n    matListItemAvatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon>star</mat-icon>\n  </button>\n  <span matListItemTitle>{{ context.title }}</span>\n\n  <div\n    *ngIf=\"auth.authenticated\"\n    matListItemMeta\n    igoStopPropagation\n    class=\"igo-actions-container\"\n  >\n    <button\n      *ngIf=\"\n        collapsed &&\n        selected &&\n        (context.permission === typePermission[typePermission.write] ||\n          context.imported)\n      \"\n      class=\"save-button\"\n      mat-icon-button\n      [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n      matTooltipShowDelay=\"500\"\n      [color]=\"color\"\n      (click)=\"save.emit(context)\"\n    >\n      <mat-icon>save</mat-icon>\n    </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n      <button\n        *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.managePermissions' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\"\n      >\n        <mat-icon>manage_accounts</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\"\n      >\n        <mat-icon>content_copy</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] &&\n          !context.imported\n        \"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\"\n      >\n        <mat-icon>edit</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\"\n      >\n        <mat-icon>visibility</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\"\n      >\n        <mat-icon>visibility_off</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] ||\n          context.imported\n        \"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=\"collapsed\"\n      (click)=\"collapsed = !collapsed\"\n    >\n      <mat-icon>more_horiz</mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import { NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgClass,\n    NgIf,\n    MatButtonModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    MatIconModule,\n    CollapseDirective,\n    IgoLanguageModule\n  ]\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","import { Component } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html',\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.context.bookmarkButton.dialog.title' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input\n      matInput\n      required\n      autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"\n        'igo.context.bookmarkButton.dialog.placeholder' | translate\n      \"\n      [(ngModel)]=\"title\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-button\n    color=\"primary\"\n    [disabled]=\"!title\"\n    (click)=\"dialogRef.close(title)\"\n  >\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","<igo-list [navigation]=\"true\">\n  <div class=\"context-filter-container\">\n    <mat-form-field *ngIf=\"showFilter()\" floatLabel=\"always\">\n      <mat-label>{{\n        'igo.context.contextManager.filterPlaceHolder' | translate\n      }}</mat-label>\n      <input\n        matInput\n        type=\"text\"\n        [placeholder]=\"\n          'igo.context.contextManager.filterPlaceHolder' | translate\n        \"\n        [(ngModel)]=\"term\"\n      />\n      <button\n        mat-icon-button\n        matSuffix\n        class=\"clear-button\"\n        *ngIf=\"term.length\"\n        aria-label=\"Clear\"\n        color=\"warn\"\n        (click)=\"clearFilter()\"\n      >\n        <mat-icon>close</mat-icon>\n      </button>\n    </mat-form-field>\n\n    <div class=\"actions-container\">\n      <button\n        class=\"sort-alpha\"\n        [class.--active]=\"sortedAlpha\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.sortAlphabetically' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"toggleSort()\"\n      >\n        <mat-icon color=\"primary\">sort_by_alpha</mat-icon>\n      </button>\n\n      <igo-actionbar\n        *ngIf=\"auth.authenticated && contextConfigs\"\n        class=\"add-context-button\"\n        [iconColor]=\"color\"\n        [store]=\"actionStore\"\n        [withIcon]=\"true\"\n        icon=\"add\"\n        [withTitle]=\"actionbarMode === 'overlay'\"\n        [horizontal]=\"false\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <button\n        *ngIf=\"auth.authenticated && contextConfigs\"\n        class=\"users-filter\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n        matTooltipShowDelay=\"500\"\n        [matMenuTriggerFor]=\"accountMenu\"\n      >\n        <mat-icon color=\"primary\">fitler_alt</mat-icon>\n      </button>\n      <mat-menu #accountMenu=\"matMenu\">\n        <ng-container *ngFor=\"let user of users\">\n          <button\n            *ngIf=\"!user.childs; else withSubMenu\"\n            mat-menu-item\n            class=\"profil-menu\"\n          >\n            <mat-checkbox\n              [checked]=\"getPermission(user).checked\"\n              [indeterminate]=\"getPermission(user).indeterminate\"\n              (click)=\"$event.stopPropagation()\"\n              (change)=\"handleToggleCategory(user)\"\n            >\n            </mat-checkbox>\n            <span>{{ user.title }}</span>\n          </button>\n          <ng-template #withSubMenu>\n            <button\n              mat-menu-item\n              [matMenuTriggerFor]=\"subAccountMenu\"\n              class=\"profil-menu\"\n            >\n              <mat-checkbox\n                [checked]=\"getPermission(user).checked\"\n                [indeterminate]=\"getPermission(user).indeterminate\"\n                (click)=\"$event.stopPropagation()\"\n                (change)=\"handleToggleCategory(user)\"\n              >\n              </mat-checkbox>\n              <span>{{ user.title }}</span>\n            </button>\n\n            <mat-menu #subAccountMenu=\"matMenu\">\n              <button\n                mat-menu-item\n                *ngFor=\"let child of user.childs\"\n                class=\"profil-menu\"\n              >\n                <mat-checkbox\n                  [checked]=\"getPermission(child).checked\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"handleToggleCategory(child, user)\"\n                >\n                  {{ child.title }}\n                </mat-checkbox>\n              </button>\n            </mat-menu>\n          </ng-template>\n        </ng-container>\n\n        <button mat-menu-item class=\"profil-menu\">\n          <mat-checkbox\n            [checked]=\"showHidden\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"showHiddenContexts.emit()\"\n          >\n          </mat-checkbox>\n          <span>\n            {{ 'igo.context.contextManager.showHidden' | translate }}\n          </span>\n        </button>\n      </mat-menu>\n    </div>\n  </div>\n\n  <ng-template\n    ngFor\n    let-groupContexts\n    [ngForOf]=\"$any(contexts$ | async) | keyvalue\"\n  >\n    <igo-collapsible\n      *ngIf=\"$any(groupContexts).value.length && auth.authenticated\"\n      [title]=\"titleMapping[$any(groupContexts).key] | translate\"\n      [collapsed]=\"$any(collapsed[titleMapping[$any(groupContexts).key]])\"\n      (toggle)=\"collapsed[titleMapping[$any(groupContexts).key]] = $any($event)\"\n    >\n      <ng-template ngFor let-context [ngForOf]=\"$any(groupContexts).value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"\n            context.id &&\n            this.defaultContextId &&\n            this.defaultContextId === context.id\n          \"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\"\n        >\n        </igo-context-item>\n      </ng-template>\n    </igo-collapsible>\n\n    <ng-template\n      *ngIf=\"$any(groupContexts).value.length && !auth.authenticated\"\n      ngFor\n      let-context\n      [ngForOf]=\"$any(groupContexts).value\"\n    >\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"\n          configService.getConfig('favoriteContext4NonAuthenticated')\n        \"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"\n          contextConfigs\n            ? defaultContextId === context.id\n            : defaultContextId === context.uri\n        \"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\"\n      >\n      </igo-context-item>\n    </ng-template>\n  </ng-template>\n\n  <div *ngIf=\"isEmpty\" class=\"no-result\">\n    {{ 'igo.context.contextManager.noResult' | translate }}\n  </div>\n</igo-list>\n","import { AsyncPipe, KeyValuePipe, NgFor, NgIf } from '@angular/common';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output\r\n} from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport {\r\n  ActionStore,\r\n  ActionbarComponent,\r\n  ActionbarMode\r\n} from '@igo2/common/action';\r\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\r\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport { LanguageService } from '@igo2/core/language';\r\nimport { IgoLanguageModule } from '@igo2/core/language';\r\nimport { StorageService } from '@igo2/core/storage';\r\nimport type { IgoMap } from '@igo2/geo';\r\n\r\nimport { BehaviorSubject, ReplaySubject, Subscription, timer } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\r\nimport { ContextItemComponent } from '../context-item/context-item.component';\r\nimport {\r\n  ContextProfils,\r\n  ContextServiceOptions,\r\n  ContextUserPermission,\r\n  ContextsList,\r\n  DetailedContext\r\n} from '../shared/context.interface';\r\nimport { ContextListControlsEnum } from './context-list.enum';\r\n\r\n@Component({\r\n  selector: 'igo-context-list',\r\n  templateUrl: './context-list.component.html',\r\n  styleUrls: ['./context-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  standalone: true,\r\n  imports: [\r\n    ListComponent,\r\n    NgIf,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    FormsModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    ActionbarComponent,\r\n    MatMenuModule,\r\n    NgFor,\r\n    MatCheckboxModule,\r\n    CollapsibleComponent,\r\n    ContextItemComponent,\r\n    ListItemDirective,\r\n    AsyncPipe,\r\n    KeyValuePipe,\r\n    IgoLanguageModule\r\n  ]\r\n})\r\nexport class ContextListComponent implements OnInit, OnDestroy {\r\n  public contextConfigs: ContextServiceOptions;\r\n  private contextsInitial: ContextsList = { ours: [] };\r\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\r\n    this.contextsInitial\r\n  );\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  private change$$: Subscription;\r\n\r\n  @Input()\r\n  get contexts(): ContextsList {\r\n    return this._contexts;\r\n  }\r\n  set contexts(value: ContextsList) {\r\n    this._contexts = value;\r\n    this.next();\r\n  }\r\n  private _contexts: ContextsList = { ours: [] };\r\n\r\n  @Input() selectedContext: DetailedContext;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get defaultContextId(): string {\r\n    return this.contextConfigs\r\n      ? this._defaultContextId\r\n      : (this.storageService.get('favorite.context.uri') as string) ||\r\n          this._defaultContextId;\r\n  }\r\n  set defaultContextId(value: string) {\r\n    this._defaultContextId = value;\r\n  }\r\n  private _defaultContextId: string;\r\n\r\n  public collapsed: { contextScope }[] = [];\r\n\r\n  @Output() select = new EventEmitter<DetailedContext>();\r\n  @Output() unselect = new EventEmitter<DetailedContext>();\r\n  @Output() edit = new EventEmitter<DetailedContext>();\r\n  @Output() delete = new EventEmitter<DetailedContext>();\r\n  @Output() save = new EventEmitter<DetailedContext>();\r\n  @Output() clone = new EventEmitter<DetailedContext>();\r\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\r\n  @Output() hide = new EventEmitter<DetailedContext>();\r\n  @Output() show = new EventEmitter<DetailedContext>();\r\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\r\n  @Output() favorite = new EventEmitter<DetailedContext>();\r\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\r\n  @Output() manageTools = new EventEmitter<DetailedContext>();\r\n  @Output() filterPermissionsChanged = new EventEmitter<\r\n    ContextUserPermission[]\r\n  >();\r\n\r\n  public titleMapping = {\r\n    ours: 'igo.context.contextManager.ourContexts',\r\n    shared: 'igo.context.contextManager.sharedContexts',\r\n    public: 'igo.context.contextManager.publicContexts'\r\n  };\r\n\r\n  public users: ContextProfils[];\r\n  public permissions: ContextUserPermission[] = [];\r\n\r\n  public actionStore = new ActionStore([]);\r\n  public actionbarMode = ActionbarMode.Overlay;\r\n\r\n  public color = 'primary';\r\n\r\n  public showHidden = false;\r\n\r\n  /**\r\n   * Context filter term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.next();\r\n  }\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  public _term: string = '';\r\n\r\n  get sortedAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortedAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha: boolean = undefined;\r\n\r\n  public showContextFilter = ContextListControlsEnum.always;\r\n\r\n  public thresholdToFilter = 5;\r\n\r\n  get isEmpty(): boolean {\r\n    return (\r\n      !this.contexts.ours.length &&\r\n      !this.contexts.public?.length &&\r\n      !this.contexts.shared?.length\r\n    );\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    public configService: ConfigService,\r\n    public auth: AuthService,\r\n    private dialog: MatDialog,\r\n    private languageService: LanguageService,\r\n    private storageService: StorageService\r\n  ) {\r\n    this.contextConfigs = this.configService.getConfig('context');\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.change$$ = this.change$\r\n      .pipe(debounce(() => timer(50)))\r\n      .subscribe(() => {\r\n        this.contexts$.next(this.filterContextsList(this.contexts));\r\n      });\r\n\r\n    this.actionStore.load([\r\n      {\r\n        id: 'emptyContext',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContext'\r\n        ),\r\n        icon: 'star',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.emptyContextTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(true);\r\n        }\r\n      },\r\n      {\r\n        id: 'contextFromMap',\r\n        title: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMap'\r\n        ),\r\n        icon: 'map',\r\n        tooltip: this.languageService.translate.instant(\r\n          'igo.context.contextManager.contextMapTooltip'\r\n        ),\r\n        handler: () => {\r\n          this.createContext(false);\r\n        }\r\n      }\r\n    ]);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private filterContextsList(contexts: ContextsList): ContextsList {\r\n    if (this.term === '') {\r\n      if (this.sortedAlpha) {\r\n        contexts = this.sortContextsList(contexts);\r\n      }\r\n      return contexts;\r\n    } else {\r\n      const ours = contexts.ours.filter((context) => {\r\n        const filterNormalized = this.term\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const contextTitleNormalized = context.title\r\n          .toLowerCase()\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        return contextTitleNormalized.includes(filterNormalized);\r\n      });\r\n\r\n      let updateContexts: ContextsList = {\r\n        ours\r\n      };\r\n\r\n      if (this.contexts.public) {\r\n        const publics = contexts.public.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.public = publics;\r\n      }\r\n\r\n      if (this.contexts.shared) {\r\n        const shared = contexts.shared.filter((context) => {\r\n          const filterNormalized = this.term\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          const contextTitleNormalized = context.title\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '');\r\n          return contextTitleNormalized.includes(filterNormalized);\r\n        });\r\n        updateContexts.shared = shared;\r\n      }\r\n\r\n      if (this.sortedAlpha) {\r\n        updateContexts = this.sortContextsList(updateContexts);\r\n      }\r\n      return updateContexts;\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  public showFilter() {\r\n    switch (this.showContextFilter) {\r\n      case ContextListControlsEnum.always:\r\n        return true;\r\n      case ContextListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        let totalLength = this.contexts.ours.length;\r\n        this.contexts.public\r\n          ? (totalLength += this.contexts.public.length)\r\n          : (totalLength += 0);\r\n        this.contexts.shared\r\n          ? (totalLength += this.contexts.shared.length)\r\n          : (totalLength += 0);\r\n        if (totalLength >= this.thresholdToFilter) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  sortContextsList(contexts: ContextsList) {\r\n    if (contexts) {\r\n      const contextsList = JSON.parse(JSON.stringify(contexts));\r\n      contextsList.ours.sort((a, b) => {\r\n        if (this.normalize(a.title) < this.normalize(b.title)) {\r\n          return -1;\r\n        }\r\n        if (this.normalize(a.title) > this.normalize(b.title)) {\r\n          return 1;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      if (contextsList.shared) {\r\n        contextsList.shared.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      } else if (contextsList.public) {\r\n        contextsList.public.sort((a, b) => {\r\n          if (this.normalize(a.title) < this.normalize(b.title)) {\r\n            return -1;\r\n          }\r\n          if (this.normalize(a.title) > this.normalize(b.title)) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        });\r\n      }\r\n      return contextsList;\r\n    }\r\n  }\r\n\r\n  normalize(str: string) {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .toLowerCase();\r\n  }\r\n\r\n  toggleSort() {\r\n    this.sortedAlpha = !this.sortedAlpha;\r\n  }\r\n\r\n  clearFilter() {\r\n    this.term = '';\r\n  }\r\n\r\n  createContext(empty?: boolean) {\r\n    this.dialog\r\n      .open(BookmarkDialogComponent, { disableClose: false })\r\n      .afterClosed()\r\n      .pipe(take(1))\r\n      .subscribe((title: string) => {\r\n        if (title) {\r\n          this.create.emit({ title, empty });\r\n        }\r\n      });\r\n  }\r\n\r\n  getPermission(user?): ContextUserPermission {\r\n    if (user) {\r\n      const permission = this.permissions.find((p) => p.name === user.name);\r\n      return permission;\r\n    }\r\n  }\r\n\r\n  handleToggleCategory(user, parent?) {\r\n    const permission = this.getPermission(user);\r\n    if (permission) {\r\n      permission.checked = !permission.checked;\r\n      this.storageService.set(\r\n        'contexts.permissions.' + permission.name,\r\n        permission.checked\r\n      );\r\n      permission.indeterminate = false;\r\n    }\r\n\r\n    if (parent) {\r\n      let indeterminate = false;\r\n\r\n      for (const c of parent.childs) {\r\n        const cPermission = this.getPermission(c);\r\n        if (cPermission.checked !== permission.checked) {\r\n          indeterminate = true;\r\n          break;\r\n        }\r\n      }\r\n      const parentPermission = this.getPermission(parent);\r\n      if (parentPermission) {\r\n        parentPermission.checked = permission.checked;\r\n        this.storageService.set(\r\n          'contexts.permissions.' + parentPermission.name,\r\n          permission.checked\r\n        );\r\n        parentPermission.indeterminate = indeterminate;\r\n      }\r\n    }\r\n\r\n    if (user.childs) {\r\n      for (const c of user.childs) {\r\n        const childrenPermission = this.getPermission(c);\r\n        if (\r\n          childrenPermission &&\r\n          childrenPermission.checked !== permission.checked\r\n        ) {\r\n          childrenPermission.checked = permission.checked;\r\n          this.storageService.set(\r\n            'contexts.permissions.' + childrenPermission.name,\r\n            permission.checked\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this.filterPermissionsChanged.emit(this.permissions);\r\n  }\r\n\r\n  hideContext(context: DetailedContext) {\r\n    context.hidden = true;\r\n    if (!this.showHidden) {\r\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\r\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\r\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\r\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\r\n      this.contexts = contexts;\r\n    }\r\n    this.hide.emit(context);\r\n  }\r\n\r\n  showContext(context: DetailedContext) {\r\n    context.hidden = false;\r\n    this.show.emit(context);\r\n  }\r\n}\r\n","<div *ngIf=\"context\">\n  <div *ngIf=\"!canWrite\" class=\"scopeForm\">\n    <h4>{{ 'igo.context.permission.readOnlyTitle' | translate }}</h4>\n    <p>{{ 'igo.context.permission.readOnlyMsg' | translate }}</p>\n  </div>\n\n  <div *ngIf=\"canWrite\" class=\"scopeForm\">\n    <mat-radio-group\n      [(ngModel)]=\"context.scope\"\n      (change)=\"scopeChanged.emit(context)\"\n    >\n      <mat-radio-button value=\"private\">\n        {{ 'igo.context.permission.scope.private' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"protected\">\n        {{ 'igo.context.permission.scope.shared' | translate }}\n      </mat-radio-button>\n      <mat-radio-button *ngIf=\"authService.isAdmin\" value=\"public\">\n        {{ 'igo.context.permission.scope.public' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </div>\n\n  <form\n    *ngIf=\"context.scope !== 'private' && canWrite\"\n    [formGroup]=\"form\"\n    (ngSubmit)=\"handleFormSubmit(form.value)\"\n  >\n    <mat-form-field class=\"full-width\">\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.permission.user' | translate\"\n        [formControl]=\"formControl\"\n        [matAutocomplete]=\"auto\"\n      />\n      <mat-autocomplete\n        #auto=\"matAutocomplete\"\n        (optionSelected)=\"onProfilSelected($event.option.value)\"\n        [displayWith]=\"displayFn\"\n      >\n        <mat-option *ngFor=\"let profil of this.profils\" [value]=\"profil\">\n          {{ profil.title }}<br />\n          <small class=\"mat-typography\">{{ profil.name }}</small>\n        </mat-option>\n      </mat-autocomplete>\n      <mat-error>\n        {{ 'igo.context.permission.profilRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n\n    <mat-radio-group formControlName=\"typePermission\">\n      <mat-radio-button value=\"read\">\n        {{ 'igo.context.permission.read' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"write\">\n        {{ 'igo.context.permission.write' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n\n    <div class=\"igo-form-button-group\">\n      <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid\">\n        {{ 'igo.context.permission.addBtn' | translate }}\n      </button>\n    </div>\n  </form>\n\n  <igo-list *ngIf=\"permissions && context.scope !== 'private'\">\n    <ng-template ngFor let-groupPermissions [ngForOf]=\"permissions | keyvalue\">\n      <igo-collapsible\n        *ngIf=\"groupPermissions.value.length\"\n        [title]=\"'igo.context.permission.' + groupPermissions.key | translate\"\n      >\n        <ng-template ngFor let-permission [ngForOf]=\"groupPermissions.value\">\n          <mat-list-item>\n            <mat-icon matListItemIcon>person</mat-icon>\n            <h4 matListItemTitle>\n              {{ permission.profilTitle }}\n              <small class=\"mat-typography\">{{ permission.profil }}</small>\n            </h4>\n\n            <div\n              matListItemMeta\n              igoStopPropagation\n              class=\"igo-actions-container\"\n            >\n              <button\n                *ngIf=\"\n                  canWrite ||\n                  permission.profil === authService.decodeToken().user.sourceId\n                \"\n                mat-icon-button\n                [matTooltip]=\"'igo.context.permission.delete' | translate\"\n                matTooltipShowDelay=\"500\"\n                color=\"warn\"\n                (click)=\"removePermission.emit(permission)\"\n              >\n                <mat-icon>delete</mat-icon>\n              </button>\n            </div>\n          </mat-list-item>\n        </ng-template>\n      </igo-collapsible>\n    </ng-template>\n  </igo-list>\n</div>\n","import { KeyValuePipe, NgFor, NgIf } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\nimport { ListComponent } from '@igo2/common/list';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Subscription } from 'rxjs';\n\nimport { TypePermission } from '../shared/context.enum';\nimport {\n  Context,\n  ContextPermission,\n  ContextPermissionsList,\n  ContextProfils\n} from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-permissions',\n  templateUrl: './context-permissions.component.html',\n  styleUrls: ['./context-permissions.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatRadioModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatButtonModule,\n    ListComponent,\n    CollapsibleComponent,\n    MatListModule,\n    MatIconModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class ContextPermissionsComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.cd.detectChanges();\n  }\n  private _context: Context;\n\n  @Input()\n  get permissions(): ContextPermissionsList {\n    return this._permissions;\n  }\n  set permissions(value: ContextPermissionsList) {\n    this._permissions = value;\n    this.cd.detectChanges();\n  }\n  private _permissions: ContextPermissionsList;\n\n  get profils(): ContextProfils[] {\n    return this._profils;\n  }\n  set profils(value: ContextProfils[]) {\n    this._profils = value;\n    this.cd.detectChanges();\n  }\n  private _profils: ContextProfils[] = [];\n\n  get canWrite(): boolean {\n    return this.context.permission === TypePermission[TypePermission.write];\n  }\n\n  private baseUrlProfils;\n\n  public formControl = new UntypedFormControl();\n  formValueChanges$$: Subscription;\n\n  @Output() addPermission: EventEmitter<ContextPermission> = new EventEmitter();\n  @Output() removePermission: EventEmitter<ContextPermission> =\n    new EventEmitter();\n  @Output() scopeChanged: EventEmitter<Context> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private cd: ChangeDetectorRef,\n    private http: HttpClient,\n    public authService: AuthService,\n    private config: ConfigService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n\n    this.baseUrlProfils =\n      this.config.getConfig('context.url') + '/profils-users?';\n\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.http\n            .get(this.baseUrlProfils + 'q=' + value)\n            .subscribe((profils) => {\n              this.profils = profils as ContextProfils[];\n            });\n          this.profils.filter((profil) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilTitleNormalized = profil.title\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNameNormalized = profil.name\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNormalized =\n              profilNameNormalized + profilTitleNormalized;\n            return profilNormalized.includes(filterNormalized);\n          });\n        } else {\n          this.profils = [];\n        }\n      }\n    );\n  }\n\n  displayFn(profil?: ContextProfils): string | undefined {\n    return profil ? profil.title : undefined;\n  }\n\n  public handleFormSubmit(value) {\n    this.addPermission.emit(value);\n  }\n\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      profil: [],\n      typePermission: ['read']\n    });\n  }\n\n  onProfilSelected(value) {\n    this.form.setValue({\n      profil: value.name,\n      typePermission: this.form.value.typePermission\n    });\n  }\n}\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { PoiButtonComponent } from '../poi-button/poi-button.component';\nimport { userButtonSlideInOut } from './user-button.animation';\nimport { UserDialogComponent } from './user-dialog.component';\n\n@Component({\n  selector: 'igo-user-button',\n  templateUrl: './user-button.component.html',\n  styleUrls: ['./user-button.component.scss'],\n  animations: [userButtonSlideInOut()],\n  standalone: true,\n  imports: [\n    NgIf,\n    PoiButtonComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class UserButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  public expand = false;\n  public visible = false;\n  public hasApi = false;\n\n  constructor(\n    private dialog: MatDialog,\n    private config: ConfigService,\n    public auth: AuthService\n  ) {\n    this.visible = this.config.getConfig('auth') ? true : false;\n    this.hasApi = this.config.getConfig('context.url') !== undefined;\n  }\n\n  accountClick() {\n    if (this.auth.authenticated) {\n      this.expand = !this.expand;\n    } else {\n      this.auth.logout();\n    }\n  }\n\n  logout() {\n    this.expand = false;\n    this.auth.logout();\n  }\n\n  infoUser() {\n    this.dialog.open(UserDialogComponent, { disableClose: false });\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\n\nimport { RouteService } from '@igo2/core/route';\nimport { Layer, WMSDataSourceOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShareMapService {\n  private language = '';\n\n  constructor(\n    private contextService: ContextService,\n    @Optional() private route: RouteService\n  ) {\n    this.route.queryParams.subscribe((params) => {\n      if (params['lang']) {\n        this.language = params['lang'];\n      }\n    });\n  }\n\n  getUrlWithApi(formValues) {\n    return this.language\n      ? `${location.origin + location.pathname}?context=${\n          formValues.uri\n        }&lang=${this.language}`\n      : `${location.origin + location.pathname}?context=${formValues.uri}`;\n  }\n\n  createContextShared(map: IgoMap, formValues) {\n    const context = this.contextService.getContextFromMap(map);\n    context.scope = 'public';\n    context.title = formValues.title;\n    context.uri = formValues.uri;\n    return this.contextService.create(context);\n  }\n\n  updateContextShared(map: IgoMap, formValues, id: string) {\n    const context = this.contextService.getContextFromMap(map);\n    return this.contextService.update(id, {\n      title: formValues.title,\n      map: context.map\n    } as DetailedContext);\n  }\n\n  getUrlWithoutApi(map: IgoMap, publicShareOption) {\n    if (\n      !this.route ||\n      !this.route.options.visibleOnLayersKey ||\n      !this.route.options.visibleOffLayersKey ||\n      !map.viewController.getZoom()\n    ) {\n      return;\n    }\n    const llc = publicShareOption.layerlistControls.querystring;\n\n    let visibleKey = this.route.options.visibleOnLayersKey;\n    let invisibleKey = this.route.options.visibleOffLayersKey;\n    const layers = map.layers;\n\n    const visibleLayers = layers.filter(\n      (lay) => lay.visible && !lay.isIgoInternalLayer\n    );\n    const invisibleLayers = layers.filter(\n      (lay) => !lay.visible && !lay.isIgoInternalLayer\n    );\n\n    if (visibleLayers.length === 0) {\n      visibleKey = '';\n    }\n    if (invisibleLayers.length === 0) {\n      invisibleKey = '';\n    }\n\n    let layersUrl = '';\n    let layersToLoop = [];\n    if (visibleLayers.length > invisibleLayers.length) {\n      layersUrl = `${visibleKey}=*&${invisibleKey}=`;\n      layersToLoop = invisibleLayers;\n    } else {\n      layersUrl = `${invisibleKey}=*&${visibleKey}=`;\n      layersToLoop = visibleLayers;\n    }\n\n    for (const layer of layersToLoop) {\n      if (layer.id) {\n        layersUrl += layer.id + ',';\n      }\n    }\n    const contextLayersID = [];\n    const contextLayers = this.contextService.context$.value.layers;\n    for (const contextLayer of contextLayers) {\n      if (\n        typeof contextLayer.id !== 'undefined' ||\n        typeof contextLayer.source !== 'undefined'\n      ) {\n        contextLayersID.push(contextLayer.id || contextLayer.source.id);\n      }\n    }\n\n    const addedLayersQueryParamsWms = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wms'\n    );\n    const addedLayersQueryParamsWmts = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wmts'\n    );\n    const addedLayersQueryParamsArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'arcgisrest'\n    );\n    const addedLayersQueryParamsImageArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'imagearcgisrest'\n    );\n    const addedLayersQueryParamsTileArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'tilearcgisrest'\n    );\n\n    layersUrl = layersUrl.substr(0, layersUrl.length - 1);\n\n    const zoomKey = this.route.options.zoomKey;\n    const centerKey = this.route.options.centerKey;\n    const contextKey = this.route.options.contextKey;\n\n    const zoom = `${zoomKey}=${map.viewController.getZoom()}`;\n    const arrayCenter = map.viewController.getCenter('EPSG:4326') || [];\n    const long = arrayCenter[0].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const lat = arrayCenter[1].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const center = `${centerKey}=${long},${lat}`.replace(/.00000/g, '');\n    let context = '';\n    if (this.contextService.context$.value) {\n      context = `${contextKey}=${this.contextService.context$.value.uri}`;\n    }\n\n    let url = this.language\n      ? `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}&lang=${this.language}`\n      : `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}`;\n    for (let i = 0; i < 5; i++) {\n      url = url.replace(/&&/g, '&');\n      url = url.endsWith('&') ? url.slice(0, -1) : url;\n    }\n    url = url.endsWith('&') ? url.slice(0, -1) : url;\n    url = url.replace('?&wm', '&wm');\n    url = url.replace('?&', '?');\n\n    return url;\n  }\n\n  private makeLayersByService(\n    layers: Layer[],\n    contextLayersID: any[],\n    typeService: string\n  ): string {\n    const addedLayersByService = [];\n    for (const layer of layers.filter(\n      (l) => l.dataSource.options?.type === typeService\n    )) {\n      if (contextLayersID.indexOf(layer.id) === -1) {\n        let linkUrl = encodeURIComponent((layer.dataSource.options as any).url);\n        let addedLayer = '';\n        let layerVersion: string;\n        switch (layer.dataSource.options.type.toLowerCase()) {\n          case 'wms':\n            const datasourceOptions = layer.dataSource\n              .options as WMSDataSourceOptions;\n            addedLayer = encodeURIComponent(datasourceOptions.params.LAYERS);\n            layerVersion =\n              datasourceOptions.params.VERSION === '1.3.0'\n                ? layerVersion\n                : datasourceOptions.params.VERSION;\n            break;\n          case 'wmts':\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            addedLayer = encodeURIComponent(\n              (layer.dataSource.options as any).layer\n            );\n            break;\n        }\n        const addedLayerPosition = `${addedLayer}:igoz${layer.zIndex}`;\n\n        let version = '';\n        if (layerVersion) {\n          const operator =\n            (layer.dataSource.options as any).url.indexOf('?') === -1\n              ? '?'\n              : '&';\n          version = encodeURIComponent(`${operator}VERSION=${layerVersion}`);\n        }\n        linkUrl = `${linkUrl}${version}`;\n\n        if (\n          !addedLayersByService.find((definedUrl) => definedUrl.url === linkUrl)\n        ) {\n          addedLayersByService.push({\n            url: linkUrl,\n            layers: [addedLayerPosition]\n          });\n        } else {\n          addedLayersByService.forEach((service) => {\n            if (service.url === linkUrl) {\n              service.layers.push(addedLayerPosition);\n            }\n          });\n        }\n      }\n    }\n\n    let addedLayersQueryParams = '';\n    if (addedLayersByService.length >= 1) {\n      let linkUrlKey;\n      let layersKey;\n      /*\n      const linkUrlKey = (typeService === 'wms') ? this.route.options.wmsUrlKey :\n        (typeService === 'wmts') ? this.route.options.wmtsUrlKey : '' ;\n      const layersKey = (typeService === 'wms') ? this.route.options.wmsLayersKey :\n        (typeService === 'wmts') ? this.route.options.wmtsLayersKey : '' ;\n*/\n      switch (typeService.toLowerCase()) {\n        case 'wms':\n          linkUrlKey = this.route.options.wmsUrlKey;\n          layersKey = this.route.options.wmsLayersKey;\n          break;\n        case 'wmts':\n          linkUrlKey = this.route.options.wmtsUrlKey;\n          layersKey = this.route.options.wmtsLayersKey;\n          break;\n        case 'arcgisrest':\n          linkUrlKey = this.route.options.arcgisUrlKey;\n          layersKey = this.route.options.arcgisLayersKey;\n          break;\n        case 'imagearcgisrest':\n          linkUrlKey = this.route.options.iarcgisUrlKey;\n          layersKey = this.route.options.iarcgisLayersKey;\n          break;\n        case 'tilearcgisrest':\n          linkUrlKey = this.route.options.tarcgisUrlKey;\n          layersKey = this.route.options.tarcgisLayersKey;\n          break;\n        default:\n          linkUrlKey = '';\n          layersKey = '';\n      }\n\n      let linkUrlQueryParams = '';\n      let layersQueryParams = '';\n      addedLayersByService.forEach((service) => {\n        linkUrlQueryParams += `${service.url},`;\n        layersQueryParams += `(${service.layers.join(',')}),`;\n      });\n      linkUrlQueryParams = linkUrlQueryParams.endsWith(',')\n        ? linkUrlQueryParams.slice(0, -1)\n        : linkUrlQueryParams;\n      layersQueryParams = layersQueryParams.endsWith(',')\n        ? layersQueryParams.slice(0, -1)\n        : layersQueryParams;\n      addedLayersQueryParams = `${linkUrlKey}=${linkUrlQueryParams}&${layersKey}=${layersQueryParams}`;\n    }\n\n    return addedLayersQueryParams;\n  }\n}\n","<form class=\"igo-form\" [formGroup]=\"form\" (ngSubmit)=\"createUrl(form.value)\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n        formControlName=\"title\"\n      />\n      <mat-error>\n        {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div id=\"uriInput\" class=\"igo-input-container\">\n    <mat-form-field>\n      <span *ngIf=\"userId\" class=\"prefix\">{{ userId }}-</span>\n      <span class=\"fieldWrapper\">\n        <input\n          matInput\n          required\n          [readonly]=\"!userId\"\n          [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n          formControlName=\"uri\"\n        />\n      </span>\n      <mat-error>\n        {{ 'igo.context.contextManager.form.uriRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      *ngIf=\"!url\"\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid\"\n    >\n      {{ 'igo.context.shareMap.button' | translate }}\n    </button>\n    <button\n      *ngIf=\"url\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"updateContextShared(form.value)\"\n    >\n      {{ 'igo.context.shareMap.refreshBtn' | translate }}\n    </button>\n  </div>\n</form>\n\n<div *ngIf=\"url\" class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      class=\"textAreaWithButton\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.context.shareMap.copy' | translate\"\n      color=\"primary\"\n      (click)=\"copyTextToClipboard(textArea)\"\n    >\n      <mat-icon>content_copy</mat-icon>\n    </button>\n  </mat-form-field>\n  <div></div>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport type { IgoMap } from '@igo2/geo';\nimport { Clipboard, uuid } from '@igo2/utils';\n\nimport { ShareMapService } from '../shared/share-map.service';\n\n@Component({\n  selector: 'igo-share-map-api',\n  templateUrl: './share-map-api.component.html',\n  styleUrls: ['./share-map-api.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapApiComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public userId: string;\n  public idContextShared: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private shareMapService: ShareMapService,\n    private formBuilder: UntypedFormBuilder\n  ) {}\n\n  ngOnInit(): void {\n    this.auth.authenticate$.subscribe((auth) => {\n      const decodeToken = this.auth.decodeToken();\n      this.userId = decodeToken?.user?.id.toString();\n      this.buildForm();\n    });\n  }\n\n  createUrl(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.url = this.shareMapService.getUrlWithApi(inputs);\n    this.shareMapService.createContextShared(this.map, inputs).subscribe(\n      (rep) => {\n        this.idContextShared = rep.id;\n        this.messageService.success(\n          'igo.context.contextManager.dialog.saveMsg',\n          'igo.context.contextManager.dialog.saveTitle',\n          undefined,\n          { value: inputs.title }\n        );\n      },\n      (err) => {\n        err.error.title = this.languageService.translate.instant(\n          'igo.context.shareMap.errorTitle'\n        );\n        this.messageService.showError(err);\n      }\n    );\n  }\n\n  updateContextShared(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.shareMapService\n      .updateContextShared(this.map, inputs, this.idContextShared)\n      .subscribe(\n        (rep) => {\n          this.messageService.success(\n            'igo.context.contextManager.dialog.saveMsg',\n            'igo.context.contextManager.dialog.saveTitle',\n            undefined,\n            { value: inputs.title }\n          );\n        },\n        (err) => {\n          err.error.title = this.languageService.translate.instant(\n            'igo.context.shareMap.errorTitle'\n          );\n          this.messageService.showError(err);\n        }\n      );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n\n  buildForm(): void {\n    this.url = undefined;\n    const id = uuid();\n    let title = 'Partage ';\n    title += this.userId ? `(${this.userId}-${id})` : `(${id})`;\n    this.form = this.formBuilder.group({\n      title: [title],\n      uri: [id]\n    });\n  }\n}\n","<div class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n  </mat-form-field>\n\n  <div class=\"igo-form-button-group\">\n    <button mat-raised-button (click)=\"copyTextToClipboard(textArea)\">\n      <mat-icon>content_copy</mat-icon>\n      {{ 'igo.context.shareMap.copy' | translate }}\n    </button>\n  </div>\n  <div>\n    <br />\n    <section class=\"mat-typography\">\n      <div\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) === ''\"\n      >\n        <h4 *ngIf=\"('igo.context.shareMap.included' | translate) !== ''\">\n          {{ 'igo.context.shareMap.included' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.context' | translate) !== ''\">\n            {{ 'igo.context.shareMap.context' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.center' | translate) !== ''\">\n            {{ 'igo.context.shareMap.center' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.zoom' | translate) !== ''\">\n            {{ 'igo.context.shareMap.zoom' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.addedLayers' | translate) !== ''\">\n            {{ 'igo.context.shareMap.addedLayers' | translate }}\n          </li>\n          <li\n            *ngIf=\"('igo.context.shareMap.visibleInvisible' | translate) !== ''\"\n          >\n            {{ 'igo.context.shareMap.visibleInvisible' | translate }}\n          </li>\n        </ul>\n\n        <h4 *ngIf=\"('igo.context.shareMap.excluded' | translate) !== ''\">\n          {{ 'igo.context.shareMap.excluded' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.order' | translate) !== ''\">\n            {{ 'igo.context.shareMap.order' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.opacity' | translate) !== ''\">\n            {{ 'igo.context.shareMap.opacity' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterOgc' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterOgc' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterTime' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterTime' | translate }}\n          </li>\n        </ul>\n      </div>\n      <igo-custom-html\n        class=\"shareCustomPadding\"\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) !== ''\"\n        class=\"mat-typography\"\n        [html]=\"'igo.context.shareMap.htmlClarifications' | translate\"\n      >\n      </igo-custom-html>\n    </section>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport type { IgoMap } from '@igo2/geo';\nimport { Clipboard } from '@igo2/utils';\n\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { ShareMapService } from '../shared/share-map.service';\n\n@Component({\n  selector: 'igo-share-map-url',\n  templateUrl: './share-map-url.component.html',\n  styleUrls: ['./share-map-url.component.scss'],\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    NgIf,\n    CustomHtmlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapUrlComponent implements AfterViewInit, OnInit, OnDestroy {\n  private mapState$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public publicShareOption = {\n    layerlistControls: { querystring: '' }\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private shareMapService: ShareMapService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resetUrl();\n    this.mapState$$ = combineLatest([\n      this.map.viewController.state$,\n      this.map.status$\n    ]).subscribe((c) => {\n      this.resetUrl();\n      this.cdRef.detectChanges();\n    });\n  }\n\n  ngAfterViewInit(): void {\n    this.resetUrl();\n  }\n\n  ngOnDestroy(): void {\n    this.mapState$$.unsubscribe();\n  }\n\n  resetUrl(values: any = {}) {\n    this.url = this.shareMapService.getUrlWithoutApi(\n      this.map,\n      this.publicShareOption\n    );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n}\n","<mat-tab-group *ngIf=\"hasApi\">\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithApi' | translate\">\n    <igo-share-map-api [map]=\"map\"></igo-share-map-api>\n  </mat-tab>\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithUrl' | translate\">\n    <igo-share-map-url [map]=\"map\"></igo-share-map-url>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-share-map-url *ngIf=\"!hasApi\" [map]=\"map\"></igo-share-map-url>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ShareMapApiComponent } from './share-map-api.component';\nimport { ShareMapUrlComponent } from './share-map-url.component';\n\n@Component({\n  selector: 'igo-share-map',\n  templateUrl: './share-map.component.html',\n  styleUrls: ['./share-map.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTabsModule,\n    ShareMapApiComponent,\n    ShareMapUrlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class ShareMapComponent {\n  @Input() map: IgoMap;\n\n  public hasApi = false;\n\n  constructor(private config: ConfigService) {\n    this.hasApi = this.config.getConfig('context.url') ? true : false;\n  }\n}\n","import { HttpClientModule } from '@angular/common/http';\nimport { Directive, Input, OnDestroy, OnInit, Optional } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { RouteService } from '@igo2/core/route';\nimport {\n  Layer,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter, first } from 'rxjs/operators';\n\nimport {\n  addImportedFeaturesStyledToMap,\n  addImportedFeaturesToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport { DetailedContext } from './context.interface';\nimport { ContextService } from './context.service';\n\n@Directive({\n  selector: '[igoLayerContext]',\n  standalone: true,\n  providers: [HttpClientModule]\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      this.route.queryParams\n        .pipe(first((params) => !ObjectUtils.isEmpty(params)))\n        .subscribe((params) => {\n          this.queryParams = params;\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        this.handleAddLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const importExportOptions =\n              this.configService.getConfig('importExport');\n            if (!importExportOptions?.importWithStyle) {\n              addImportedFeaturesToMap(featureCollection, this.map);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n\n    this.layerService\n      .createAsyncIdbLayers(context.uri)\n      .pipe(debounceTime(500))\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\n  }\n\n  private handleAddLayers(layers: Layer[]) {\n    layers = layers\n      .filter((layer: Layer) => layer !== undefined)\n      .map((layer) => {\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\n        layer.zIndex = layer.zIndex;\n\n        return layer;\n      });\n    this.contextLayers.concat(layers);\n    this.map.addLayers(layers);\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (\n        visiblelayers.indexOf(currentLayerid) > -1 ||\n        visiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = true;\n      }\n      if (\n        invisiblelayers.indexOf(currentLayerid) > -1 ||\n        invisiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import { Directive, OnDestroy, OnInit } from '@angular/core';\n\nimport { MediaService } from '@igo2/core/media';\nimport {\n  MapBrowserComponent,\n  MapControlsOptions,\n  MapScaleLineOptions,\n  MapViewOptions\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { ContextMapView, DetailedContext } from './context.interface';\nimport { ContextService } from './context.service';\n\n@Directive({\n  selector: '[igoMapContext]',\n  standalone: true\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (\n      !this.component.view ||\n      viewContext.keepCurrentView !== true ||\n      context.map.view.projection !== this.map.projection\n    ) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(\n        viewContext\n      );\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof controlsContext.scaleLine !== 'boolean') {\n          const scaleLineOption =\n            controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import {\n  ChangeDetectorRef,\n  Directive,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\nimport { MapService } from '@igo2/geo';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  Context,\n  ContextUserPermission,\n  ContextsList,\n  DetailedContext\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]',\n  standalone: true,\n  providers: [ConfirmDialogService]\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const messageObj = this.messageService.success(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        'igo.context.contextManager.dialog.favoriteTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              this.messageService.info(\n                'igo.context.contextManager.dialog.deleteMsg',\n                'igo.context.contextManager.dialog.deleteTitle',\n                undefined,\n                { value: context.title }\n              );\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.cloneMsg',\n        'igo.context.contextManager.dialog.cloneTitle',\n        undefined,\n        { value: context.title }\n      );\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        'igo.context.bookmarkButton.dialog.createTitle',\n        undefined,\n        { value: context.title }\n      );\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get(\n      'favorite.context.uri'\n    ) as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\n\nimport { Context, DetailedContext } from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextEditComponent } from './context-edit.component';\n\n@Directive({\n  selector: '[igoContextEditBinding]',\n  standalone: true\n})\nexport class ContextEditBindingDirective implements OnInit, OnDestroy {\n  private component: ContextEditComponent;\n  private editedContext$$: Subscription;\n\n  @Output() submitSuccessed: EventEmitter<Context> = new EventEmitter();\n\n  @HostListener('submitForm', ['$event'])\n  onEdit(context: Context) {\n    const id = this.component.context.id;\n    this.contextService.update(id, context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title || this.component.context.title\n        }\n      );\n      this.contextService.setEditedContext(undefined);\n      this.submitSuccessed.emit(context);\n    });\n  }\n\n  constructor(\n    @Self() component: ContextEditComponent,\n    private contextService: ContextService,\n    private messageService: MessageService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n  }\n}\n","import {\n  ChangeDetectorRef,\n  Directive,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\n\nimport {\n  Context,\n  ContextPermission,\n  DetailedContext\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextPermissionsComponent } from './context-permissions.component';\n\n@Directive({\n  selector: '[igoContextPermissionsBinding]',\n  standalone: true\n})\nexport class ContextPermissionsBindingDirective implements OnInit, OnDestroy {\n  private component: ContextPermissionsComponent;\n  private editedContext$$: Subscription;\n\n  @HostListener('addPermission', ['$event'])\n  onAddPermission(permission: ContextPermission) {\n    if (!permission.profil) {\n      this.messageService.error(\n        'igo.context.contextManager.errors.addPermissionEmpty',\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      return;\n    }\n    const contextId = this.component.context.id;\n    this.contextService\n      .addPermissionAssociation(\n        contextId,\n        permission.profil,\n        permission.typePermission\n      )\n      .subscribe((profils) => {\n        for (const p of profils) {\n          this.component.permissions[permission.typePermission].push(p);\n        }\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.addMsg',\n          'igo.context.permission.dialog.addTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('removePermission', ['$event'])\n  onRemovePermission(permission: ContextPermission) {\n    const contextId = this.component.context.id;\n    this.contextService\n      .deletePermissionAssociation(contextId, permission.id)\n      .subscribe(() => {\n        const index = this.component.permissions[\n          permission.typePermission\n        ].findIndex((p) => {\n          return p.id === permission.id;\n        });\n        this.component.permissions[permission.typePermission].splice(index, 1);\n\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.deleteMsg',\n          'igo.context.permission.dialog.deleteTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('scopeChanged', ['$event'])\n  onScopeChanged(context: Context) {\n    const scope = context.scope;\n    this.contextService.update(context.id, { scope }).subscribe(() => {\n      this.messageService.success(\n        'igo.context.permission.dialog.scopeChangedMsg',\n        'igo.context.permission.dialog.scopeChangedTitle',\n        undefined,\n        { value: 'igo.context.permission.scope.' + scope }\n      );\n    });\n  }\n\n  constructor(\n    @Self() component: ContextPermissionsComponent,\n    private contextService: ContextService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cd: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n    this.contextService.editedContext$.next(undefined);\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n\n    if (context) {\n      this.contextService\n        .getPermissions(context.id)\n        .subscribe((permissionsArray) => {\n          permissionsArray = permissionsArray || [];\n          const permissions = {\n            read: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'read';\n            }),\n            write: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'write';\n            })\n          };\n          return (this.component.permissions = permissions);\n        });\n    }\n  }\n}\n","import {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { uuid } from '@igo2/utils';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { AnalyticsBaseUser, AnalyticsOptions } from './analytics.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AnalyticsService {\n  private options: AnalyticsOptions;\n\n  get paq() {\n    return ((window as any)._paq = (window as any)._paq || []);\n  }\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('analytics') || {};\n\n    if (this.options.provider === 'matomo') {\n      this.initMatomo();\n    }\n  }\n\n  private initMatomo() {\n    if (!this.options.url || !this.options.id) {\n      return;\n    }\n    const url =\n      this.options.url.substr(-1) === '/'\n        ? this.options.url + 'matomo'\n        : this.options.url;\n\n    // this.paq.push(['trackPageView']);\n    // this.paq.push(['enableLinkTracking']);\n    (() => {\n      this.paq.push(['setTrackerUrl', url + '.php']);\n      this.paq.push(['setSiteId', this.options.id]);\n      const g = document.createElement('script');\n      const s = document.getElementsByTagName('script')[0];\n      g.type = 'text/javascript';\n      g.async = true;\n      g.defer = true;\n      g.src = url + '.js';\n      s.parentNode.insertBefore(g, s);\n    })();\n  }\n\n  /**\n   * Pass `null` to unset the user.\n   */\n  public setUser(user: AnalyticsBaseUser | null, profils?: string[]) {\n    if (this.options.provider === 'matomo') {\n      if (!user) {\n        this.paq.push(['resetUserId']);\n        this.paq.push(['deleteCustomVariable', 1, 'user']);\n        this.paq.push(['deleteCustomVariable', 2, 'name']);\n        this.paq.push(['deleteCustomVariable', 3, 'profils']);\n      } else {\n        this.paq.push(['setUserId', user.id]);\n\n        const name = `${user.firstName} ${user.lastName}`;\n        this.paq.push(['setCustomVariable', 1, 'user', user.sourceId, 'visit']);\n        this.paq.push(['setCustomVariable', 2, 'name', name, 'visit']);\n        this.paq.push(['setCustomVariable', 3, 'profils', profils, 'visit']);\n      }\n\n      this.paq.push(['trackPageView']);\n      this.paq.push(['enableLinkTracking']);\n    }\n  }\n\n  public trackSearch(term: string, nbResults: number) {\n    if (this.options.provider === 'matomo') {\n      this.paq.push(['trackSiteSearch', term, false, nbResults]);\n    }\n  }\n\n  public trackEvent(category: string, action: string, name: string) {\n    if (this.options.provider === 'matomo') {\n      this.paq.push(['trackEvent', category, action, name]);\n    }\n  }\n\n  /**\n   * Function that tracks layers added to the map\n   */\n  public trackLayer(category: string, action: string, parameters: any) {\n    if (this.options.provider === 'matomo')\n      this.paq.push(['trackEvent', category, action, parameters]);\n  }\n}\n","import { AlternateConfigOptions, DeprecatedOptions } from './config.interface';\n\nexport const CONFIG_DEPRECATED: { [key: string]: DeprecatedOptions } = {\n  showMenuButton: {\n    alternativeKey: 'menu.button.visible',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  menuButtonReverseColor: {\n    alternativeKey: 'menu.button.useThemeColor',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  importWithStyle: {\n    alternativeKey: 'importExport.importWithStyle',\n    mayBeRemoveIn: new Date('2024-06-06')\n  },\n  hasGeolocateButton: {\n    alternativeKey: 'geolocate.button.visible',\n    mayBeRemoveIn: new Date('2024-06-06')\n  }\n};\n\nexport const ALTERNATE_CONFIG_FROM_DEPRECATION = new Map<\n  string,\n  AlternateConfigOptions\n>(\n  Object.entries(CONFIG_DEPRECATED)\n    .filter(([_, options]) => options.alternativeKey)\n    .map(([key, options]) => [\n      options.alternativeKey,\n      {\n        deprecatedKey: key\n      } satisfies AlternateConfigOptions\n    ])\n);\n","export interface Version {\r\n  app?: string;\r\n  lib?: string;\r\n  releaseDateApp?: number;\r\n  releaseDate?: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '17.0.0-next.7',\r\n  releaseDate: 1715874406030\r\n};\r\n","import { HttpBackend, HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport {\n  ALTERNATE_CONFIG_FROM_DEPRECATION,\n  CONFIG_DEPRECATED\n} from './config-deprecated';\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService<T extends object = { [key: string]: any }> {\n  private config: T | null;\n  private httpClient: HttpClient;\n  private configDeprecated = new Map(Object.entries(CONFIG_DEPRECATED));\n\n  private _isLoaded$ = new BehaviorSubject<boolean>(null);\n  isLoaded$ = this._isLoaded$.asObservable();\n\n  constructor(handler: HttpBackend) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  /**\n   * Use to get the all config file (merge from environnement.ts and config.json)\n   */\n  public getConfigs(): any {\n    Array.from(this.configDeprecated.keys()).map((deprecatedKey) => {\n      const deprecatedValue = ObjectUtils.resolve(this.config, deprecatedKey);\n      if (deprecatedValue !== undefined) {\n        this.handleDeprecatedConfig(deprecatedKey);\n      }\n    });\n    return this.config;\n  }\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig<T = any>(key: string, defaultValue?: unknown): T {\n    let value = ObjectUtils.resolve(this.config, key);\n\n    const isDeprecated = this.configDeprecated.get(key);\n    if (isDeprecated && value !== undefined) {\n      this.handleDeprecatedConfig(key);\n    } else if (value === undefined) {\n      value = this.handleDeprecationPossibility(key);\n    }\n\n    return value ?? defaultValue;\n  }\n\n  private handleDeprecatedConfig(key: string): void {\n    const options = this.configDeprecated.get(key);\n\n    let message = `This config (${key}) is deprecated and will be removed shortly`;\n    if (options.alternativeKey) {\n      message += ` You should use this key (${options.alternativeKey}) as an alternate solution`;\n    }\n\n    const currentDate = new Date();\n    currentDate >= options.mayBeRemoveIn\n      ? console.error(message)\n      : console.warn(message);\n  }\n\n  private handleDeprecationPossibility(key: string): any {\n    const options = ALTERNATE_CONFIG_FROM_DEPRECATION.get(key);\n    if (!options) {\n      return;\n    }\n\n    return this.getConfig(options.deprecatedKey);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions<T>) {\n    const baseConfig = options.default;\n    if (!options.path) {\n      this.config = baseConfig;\n      this._isLoaded$.next(true);\n      return true;\n    }\n\n    return new Promise((resolve, _reject) => {\n      this.httpClient\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            this._isLoaded$.next(false);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          this._isLoaded$.next(true);\n          resolve(true);\n        });\n    });\n  }\n}\n","import {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  InjectionToken,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { ConfigOptions } from './config.interface';\nimport { ConfigService } from './config.service';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfig(options: ConfigOptions): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    {\n      provide: CONFIG_OPTIONS,\n      useValue: options\n    },\n    {\n      provide: APP_INITIALIZER,\n      useFactory: configFactory,\n      multi: true,\n      deps: [ConfigService, CONFIG_OPTIONS]\n    }\n  ]);\n}\n\nfunction configFactory(configService: ConfigService, options: ConfigOptions) {\n  return () => configService.load(options);\n}\n","import { NgModule } from '@angular/core';\n\nimport { TranslateModule } from '@ngx-translate/core';\n\n@NgModule({\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, first, forkJoin, map, switchMap, tap } from 'rxjs';\n\nimport { LanguageLoaderBase } from './language.interface';\n\nexport class LanguageLoader implements LanguageLoaderBase {\n  private httpClient: HttpClient;\n\n  private _isLoaded$ = new BehaviorSubject<boolean>(null);\n  isLoaded$ = this._isLoaded$.asObservable();\n\n  constructor(\n    handler: HttpBackend,\n    private configService: ConfigService,\n    private prefix?: string | string[],\n    private suffix: string = '.json'\n  ) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  public getTranslation(lang: string): any {\n    const igoLocale$ = this.httpClient.get(`locale/libs_locale/${lang}.json`);\n    return this.configService.isLoaded$.pipe(\n      first((isLoaded) => isLoaded),\n      switchMap(() => {\n        if (this.configService && !this.prefix) {\n          const prefix = this.configService.getConfig('language.prefix');\n          this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n        }\n\n        if (!this.prefix || this.prefix.length === 0) {\n          this._isLoaded$.next(true);\n          return igoLocale$;\n        }\n\n        const appLocale$ = (this.prefix as string[]).map((prefix) =>\n          this.httpClient.get(`${prefix}${lang}${this.suffix}`)\n        );\n\n        const locale$ = forkJoin([igoLocale$, ...appLocale$]);\n\n        return locale$.pipe(\n          map((translations) => {\n            return translations.reduce(\n              (acc, current) => ObjectUtils.mergeDeep(acc, current),\n              {}\n            );\n          }),\n          tap(() => {\n            this._isLoaded$.next(true);\n          })\n        );\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string;\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  constructor(public translate: TranslateService) {\n    this.language = this.translate.getBrowserLang();\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n    this.language$.next(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    combineLatest([\n      this.translate.use(this.language),\n      this.translate.reloadLang(this.language)\n    ]).subscribe(() => {\n      this.language$.next(this.language);\n    });\n  }\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { HttpBackend } from '@angular/common/http';\nimport {\n  APP_INITIALIZER,\n  EnvironmentProviders,\n  Provider,\n  importProvidersFrom,\n  makeEnvironmentProviders\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport {\n  MissingTranslationHandler,\n  TranslateLoader,\n  TranslateModule,\n  TranslateModuleConfig\n} from '@ngx-translate/core';\nimport { first } from 'rxjs';\nimport { catchError, timeout } from 'rxjs/operators';\n\nimport { LanguageLoaderBase } from './language.interface';\nimport { LanguageLoader } from './language.loader';\nimport { LanguageService } from './language.service';\nimport { IgoMissingTranslationHandler } from './missing-translation.guard';\n\n// 5 seconds\nconst TIMEOUT_DURATION = 5000;\n\n/**\n * Make sure you only call this method in the root module of your application, most of the time called AppModule.\n */\nexport function provideTranslation(loader?: Provider): EnvironmentProviders {\n  return makeEnvironmentProviders([\n    importProvidersFrom(TranslateModule.forRoot(setTranslationConfig(loader))),\n    {\n      provide: APP_INITIALIZER,\n      useFactory: (languageService: LanguageService) => () => {\n        return (\n          languageService.translate.currentLoader as LanguageLoaderBase\n        ).isLoaded$?.pipe(\n          timeout(TIMEOUT_DURATION),\n          first((isLoaded) => isLoaded === true),\n          catchError((error) => {\n            error.message += ` - Request timed out for language loader after: ${TIMEOUT_DURATION}`;\n            throw error;\n          })\n        );\n      },\n      deps: [LanguageService],\n      multi: true\n    }\n  ]);\n}\n\nexport const setTranslationConfig = (\n  loader?: Provider\n): TranslateModuleConfig => ({\n  defaultLanguage: 'fr',\n  loader: loader ?? DEFAULT_LANGUAGE_LOADER,\n  missingTranslationHandler: {\n    provide: MissingTranslationHandler,\n    useClass: IgoMissingTranslationHandler\n  }\n});\n\nexport const DEFAULT_LANGUAGE_LOADER: Provider = {\n  provide: TranslateLoader,\n  useFactory: defaultLanguageLoader,\n  deps: [HttpBackend, ConfigService]\n};\n\nfunction defaultLanguageLoader(http: HttpBackend, config?: ConfigService) {\n  return new LanguageLoader(http, config, undefined, undefined);\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';\nimport { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.HandsetPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","import { EnvironmentProviders, makeEnvironmentProviders } from '@angular/core';\n\nimport { GlobalConfig, provideToastr } from 'ngx-toastr';\n\nconst TOASTR_CONFIG: Partial<GlobalConfig> = {\n  positionClass: 'toast-bottom-right',\n  timeOut: 10000,\n  extendedTimeOut: 10000,\n  titleClass: 'mat-subtitle-2',\n  messageClass: 'toast-message',\n  closeButton: true,\n  progressBar: true,\n  enableHtml: true,\n  tapToDismiss: true,\n  maxOpened: 4,\n  preventDuplicates: true,\n  resetTimeoutOnDuplicate: true,\n  countDuplicates: false,\n  includeTitleDuplicates: true\n};\n\nexport function provideMessage(): EnvironmentProviders {\n  return makeEnvironmentProviders([provideToastr(TOASTR_CONFIG)]);\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { provideMessage } from './shared/message.provider';\n\n/**\n * @deprecated import the provideMessage directly\n */\n@NgModule({\n  imports: [],\n  providers: [provideMessage()],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { Inject, Injectable, Injector } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { BehaviorSubject, forkJoin } from 'rxjs';\nimport { debounceTime, first } from 'rxjs/operators';\n\nimport { MessageType } from './message.enum';\nimport { Message, MessageOptions } from './message.interface';\n\ninterface ActiveMessageTranslation {\n  id: number;\n  titleKey: string;\n  textKey: string;\n  textInterpolateParams?: Object;\n  titleInterpolateParams?: Object;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options?: MessageOptions;\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message');\n    this.languageService.language$.pipe(debounceTime(500)).subscribe((r) => {\n      if (this.toastr.toasts.length === 0) {\n        this.activeMessageTranslations = [];\n      }\n      this.toastr.toasts.map((toast) => {\n        const activeMessageTranslation = this.activeMessageTranslations.find(\n          (amt) => amt.id === toast.toastId\n        );\n        if (activeMessageTranslation) {\n          const translatedTextInterpolateParams = {\n            ...activeMessageTranslation.textInterpolateParams\n          };\n          const translatedTitleInterpolateParams = {\n            ...activeMessageTranslation.titleInterpolateParams\n          };\n\n          if (activeMessageTranslation.textInterpolateParams) {\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTextInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.textInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n          if (activeMessageTranslation.titleInterpolateParams) {\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTitleInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.titleInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n\n          forkJoin([\n            this.languageService.translate.get(\n              activeMessageTranslation.textKey,\n              translatedTextInterpolateParams\n            ),\n            this.languageService.translate.get(\n              activeMessageTranslation.titleKey,\n              translatedTitleInterpolateParams\n            )\n          ])\n            .pipe(first())\n            .subscribe((res: [string, string]) => {\n              toast.toastRef.componentInstance.message = res[0];\n              toast.toastRef.componentInstance.title = res[1];\n            });\n        }\n      });\n    });\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    const messageType = message.type;\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\n\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || ({} as MessageOptions);\n    const currentDate = new Date();\n\n    message.options.from = message.options.from\n      ? message.options.from\n      : new Date('1 jan 1900');\n    message.options.to = message.options.to\n      ? message.options.to\n      : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(\n        Date.parse(message.options.from.replace(/-/g, ' '))\n      );\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(\n        Date.parse(message.options.to.replace(/-/g, ' '))\n      );\n    }\n    if (\n      currentDate > message.options.from &&\n      currentDate < message.options.to\n    ) {\n      if (message.showIcon === false) {\n        this.toastr.toastrConfig.iconClasses[messageType] =\n          `toast-${messageType} toast-no-icon`;\n      }\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.SHOW:\n            messageShown = this.show(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          default:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(\n    text: string,\n    title: string = 'igo.core.message.success',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'success',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  error(\n    text: string,\n    title: string = 'igo.core.message.error',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'error',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  info(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'info',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  alert(\n    text: string,\n    title: string = 'igo.core.message.alert',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'alert',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  show(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'show',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  private handleNgxToastr(\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\n    text: string,\n    title: string,\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    const translatedTextInterpolateParams = { ...textInterpolateParams };\n    const translatedTitlenterpolateParams = { ...titleInterpolateParams };\n\n    if (textInterpolateParams) {\n      Object.keys(textInterpolateParams).map((k) => {\n        const value = textInterpolateParams[k];\n        if (value) {\n          translatedTextInterpolateParams[k] =\n            typeof value === 'string'\n              ? this.languageService.translate.instant(value)\n              : value;\n        }\n      });\n    }\n    if (titleInterpolateParams) {\n      Object.keys(titleInterpolateParams).map((k) => {\n        if (k) {\n          const value = titleInterpolateParams[k];\n          translatedTitlenterpolateParams[k] =\n            typeof value === 'string'\n              ? this.languageService.translate.instant(value)\n              : value;\n        }\n      });\n    }\n\n    const message = this.languageService.translate.instant(\n      text,\n      translatedTextInterpolateParams\n    );\n    const translatedTitle = this.languageService.translate.instant(\n      title,\n      translatedTitlenterpolateParams\n    );\n\n    let activeToast;\n    switch (type) {\n      case 'success':\n        activeToast = this.toastr.success(message, translatedTitle, options);\n        break;\n      case 'error':\n        activeToast = this.toastr.error(message, translatedTitle, options);\n        break;\n      case 'show':\n      case 'info':\n        activeToast = this.toastr.info(message, translatedTitle, options);\n        break;\n      case 'alert':\n        activeToast = this.toastr.warning(message, translatedTitle, options);\n        break;\n    }\n    this.activeMessageTranslations.push({\n      id: activeToast.toastId,\n      titleKey: title,\n      textKey: text,\n      textInterpolateParams,\n      titleInterpolateParams\n    });\n    return activeToast;\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options?.template || message.html) {\n      return message;\n    }\n\n    let html = this.options?.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { EventEmitter, Injectable, Injector, OnDestroy } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n    this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.online.message',\n        'igo.core.network.online.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.offline.message',\n        'igo.core.network.offline.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\n\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey: 'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey: 'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey: 'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey: 'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey: 'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('¢er=')) {\n      url = url.replace('¢er', '&center');\n      const queryParams: any = url\n        .slice(1)\n        .split('&')\n        .map((p) => p.split('='))\n        .reduce((obj, pair) => {\n          const [key, value] = pair.map(decodeURIComponent);\n          obj[key] = value;\n          return obj;\n        }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { ConfigService } from '@igo2/core/config';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  StorageOptions,\n  StorageScope,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from './storage.interface';\n\nexport abstract class BaseStorage<T extends StorageOptions = StorageOptions> {\n  protected options?: T;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> =\n    new BehaviorSubject(undefined);\n\n  constructor(config: ConfigService) {\n    this.options = config.getConfig<T>('storage') || ({ key: 'igo' } as T);\n  }\n\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key,\n        scope,\n        event:\n          previousValue !== undefined\n            ? StorageServiceEventEnum.MODIFIED\n            : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({\n      key,\n      scope,\n      event: StorageServiceEventEnum.REMOVED,\n      previousValue\n    });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({ scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { BaseStorage } from './storage';\nimport { StorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService extends BaseStorage<StorageOptions> {\n  constructor(private config: ConfigService) {\n    super(config);\n  }\n}\n","export enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\nexport interface ArcGISRestCapabilitiesLayer {\n  id: number;\n  name: string;\n  parentLayerId: number;\n  defaultVisibility?: boolean;\n  subLayerIds: number[];\n  minScale: number;\n  maxScale: number;\n  type: ArcGISRestCapabilitiesLayerTypes;\n  geometryType?: string;\n}\n\nexport enum ArcGISRestCapabilitiesLayerTypes {\n  FeatureLayer = 'Feature Layer',\n  RasterLayer = 'Raster Layer',\n  GroupLayer = 'Group Layer'\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olAttribution from 'ol/control/Attribution';\nimport { EsriJSON, WMSCapabilities, WMTSCapabilities } from 'ol/format';\nimport * as olproj from 'ol/proj';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\n\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport {\n  TimeFilterStyle,\n  TimeFilterType\n} from '../../filter/shared/time-filter.enum';\nimport {\n  ItemStyleOptions,\n  LegendOptions\n} from '../../layer/shared/layers/legend.interface';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\nimport {\n  TypeCapabilities,\n  TypeCapabilitiesStrings\n} from './capabilities.interface';\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  CartoDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions,\n  WMTSDataSourceOptions\n} from './datasources';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(\n    private http: HttpClient,\n    private mapService: MapService\n  ) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'arcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getImageArcgisOptions(\n    baseOptions:\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'imagearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(\n          baseOptions,\n          res[0],\n          res[1],\n          res[2]\n        );\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'tilearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic\n      ? olproj.transformExtent(\n          layer.EX_GeographicBoundingBox,\n          'EPSG:4326',\n          this.mapService.getMap().projection\n        )\n      : undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions:\n      | TileArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers\n      ? legend.layers.find((x) => x.layerName === title)\n      : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions:\n      | ArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<\n    | ArcGISRestDataSourceOptions\n    | ArcGISRestImageDataSourceOptions\n    | TileArcGISRestDataSourceOptions\n  >;\n}\n","import { Injectable, Optional } from '@angular/core';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, forkJoin, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport {\n  AnyDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions,\n  DataSource,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  ImageArcGISRestDataSource,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WebSocketDataSource,\n  XYZDataSource,\n  XYZDataSourceOptions\n} from './datasources';\nimport { WFSService } from './datasources/wfs.service';\nimport { OptionsService } from './options/options.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(\n    context: AnyDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(\n          context as TileDebugDataSource\n        );\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable((d) => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable((d) => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable((d) => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable((d) =>\n      d.next(\n        new WFSDataSource(\n          context,\n          this.wfsDataSourceService,\n          this.authInterceptor\n        )\n      )\n    );\n  }\n\n  private createWMSDataSource(\n    context: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError((e) => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.layer }\n          );\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable((d) => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable((d) => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable((d) => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable((d) => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.layer }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable((d) => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable((d) => d.next(new ClusterDataSource(context)));\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport olSourceCluster from 'ol/source/Cluster';\n\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\nimport { FeatureDataSource } from './feature-datasource';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public declare options: ClusterDataSourceOptions;\n  public declare ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import olClusterSource from 'ol/source/Cluster';\nimport olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\n\nimport {\n  LegendMapViewOptions,\n  LegendOptions\n} from '../../../layer/shared/layers/legend.interface';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { DataService } from './data.service';\nimport { DataSourceOptions, Legend } from './datasource.interface';\n\nexport abstract class DataSource {\n  public id: string;\n  public ol: olSource | olVectorSource | olClusterSource;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url }];\n    } else if (options.html) {\n      this.legend = [{ html: options.html }];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","import * as olformat from 'ol/format';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public declare options: FeatureDataSourceOptions;\n  public declare ol: olSourceVector;\n  protected createOlSource(): olSourceVector {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public declare options: OSMDataSourceOptions;\n  public declare ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public declare options: XYZDataSourceOptions;\n  public declare ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import { AuthInterceptor } from '@igo2/auth';\n\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\nimport {\n  checkWfsParams,\n  defaultFieldNameGeometry,\n  getFormatFromOptions\n} from './wms-wfs.utils';\n\nexport class WFSDataSource extends DataSource {\n  public declare ol: olSourceVector;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const fieldNameGeometry =\n      this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        ogcFilters,\n        fieldNameGeometry\n      );\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons) {\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes) {\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons) {\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select) {\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete) {\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters(\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters,\n      true\n    );\n  }\n\n  protected createOlSource(): olSourceVector {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public declare options: WMTSDataSourceOptions;\n  public declare ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\n\nexport class CartoDataSource extends DataSource {\n  public declare ol: olSourceCarto;\n  public declare options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend) {\n      this.options.config.layers[0].legend.items.forEach((f) => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceVector;\n  public declare options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function (extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach((element) => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(\n          legendElement.contentType,\n          legendElement.imageData\n        );\n        label = legendElement.label\n          ? legendElement.label.replace('<Null>', 'Null')\n          : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === 'uniqueValue') {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(\n            legendElement.symbol.contentType,\n            legendElement.symbol.imageData\n          );\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString +=\n            `<tr><td align='left'>` +\n            svg +\n            `</td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === 'simple') {\n      label = legendInfo.label\n        ? legendInfo.label.replace('<Null>', 'Null')\n        : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(\n          legendInfo.symbol.contentType,\n          legendInfo.symbol.imageData\n        );\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString +=\n          `<tr><td align='left'>` +\n          svg +\n          `</td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string =\n        `stroke:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\" ` +\n          strokeDashArray +\n          `/></svg>`;\n      }\n    } else if (\n      symbol.style === 'esriSMSCircle' ||\n      symbol.style === 'esriSFSSolid'\n    ) {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke =\n        `stroke:rgba(` +\n        outlineColor[0] +\n        ',' +\n        outlineColor[1] +\n        ',' +\n        outlineColor[2] +\n        ',' +\n        outlineColor[3] +\n        ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill =\n        `fill:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` +\n          size / 2 +\n          `\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      } else {\n        svg =\n          `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\n\nexport class ImageArcGISRestDataSource extends DataSource {\n  public declare ol: ImageArcGISRest;\n  public declare options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params =\n      this.options.layer === undefined\n        ? this.options.params\n        : Object.assign(\n            { LAYERS: `show:${this.options.layer}` },\n            this.options.params\n          );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public declare options: TileDebugDataSourceOptions;\n  public declare ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olFeature from 'ol/Feature';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public declare options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(\n      event.data\n    ) as olFeature;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport feature from 'ol/Feature';\nimport olFormatMVT from 'ol/format/MVT';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { Md5 } from 'ts-md5';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public declare options: MVTDataSourceOptions;\n  public declare ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({ featureClass: feature });\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n      return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceTileArcGISRest;\n  public declare options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","export abstract class DataService {\n  abstract getData(): string;\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, combineLatest, of } from 'rxjs';\nimport { concatMap } from 'rxjs/operators';\n\nimport { DataService } from './data.service';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport {\n  defaultEpsg,\n  defaultMaxFeatures,\n  formatWFSQueryString,\n  getFormatFromOptions,\n  gmlRegex\n} from './wms-wfs.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ) {\n    if (\n      !dataSourceOptions.sourceFields ||\n      dataSourceOptions.sourceFields.length === 0\n    ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields = getfeatureSourceField;\n        }\n      );\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields.forEach((sourcefield) => {\n            if (sourcefield.alias === undefined) {\n              sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n            }\n            if (\n              sourcefield.values === undefined ||\n              sourcefield.values.length === 0\n            ) {\n              sourcefield.values = getfeatureSourceField.find(\n                (sf) => sf.name === sourcefield.name\n              ).values;\n            }\n          });\n        }\n      );\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(\n      dataSourceOptions,\n      nb,\n      epsgCode,\n      propertyName,\n      startIndex,\n      forceDefaultOutputFormat\n    );\n    const baseUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (\n      forceDefaultOutputFormat ||\n      gmlRegex.test(outputFormat) ||\n      !outputFormat\n    ) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable((d) => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions =\n        JSON.parse(JSON.stringify(dataSourceOptions));\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields\n        ?.filter((f) => !f.values)\n        .map((f) => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true)\n        .pipe(\n          concatMap((res) =>\n            String(res).toLowerCase().includes('exception')\n              ? of(false)\n              : of(true)\n          ),\n          concatMap((allowGml) => {\n            // If the service return GML (return no exception)\n            return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n              concatMap((firstFeature) => {\n                const features = olFormats.readFeatures(firstFeature);\n                fieldList = features[0].getKeys();\n                if (\n                  dataSourceOptions.sourceFields ||\n                  dataSourceOptions.sourceFields.length === 0\n                ) {\n                  sourceFieldsToRetrieveValues = fieldList;\n                }\n                fieldListWoGeom = fieldList.filter(\n                  (field) =>\n                    sourceFieldsToRetrieveValues.includes(field) &&\n                    field !== features[0].getGeometryName() &&\n                    !field.match(/boundedby/gi)\n                );\n                fieldListWoGeomStr = fieldListWoGeom.join(',');\n                const processingArray = [];\n                let startIndex = 0;\n                // If the service do not allow gml return, dice the call in multiple\n                // calls by increment of chunkSize with the original outputFormat\n                if (\n                  !allowGml &&\n                  dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                  dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures\n                ) {\n                  const chunkSize = 1000;\n                  while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                    processingArray.push(\n                      this.wfsGetFeature(\n                        dataSourceOptions,\n                        chunkSize,\n                        dataSourceOptions.paramsWFS.srsName,\n                        fieldListWoGeomStr,\n                        startIndex\n                      )\n                    );\n                    startIndex += chunkSize;\n                  }\n                  effectiveOlFormats = olFormats;\n                } else {\n                  processingArray.push(\n                    this.wfsGetFeature(\n                      dataSourceOptions,\n                      dataSourceOptions.paramsWFS.maxFeatures ||\n                        defaultMaxFeatures,\n                      dataSourceOptions.paramsWFS.srsName,\n                      fieldListWoGeomStr,\n                      0,\n                      true\n                    )\n                  );\n                }\n                return combineLatest(processingArray);\n              })\n            );\n          })\n        )\n        .subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach((element) => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields\n            .filter((f) => f.name === key)\n            .forEach((v) => {\n              if (v.values.indexOf(featureProperties[key]) === -1) {\n                v.values.push(featureProperties[key]);\n              }\n            });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import { ObjectUtils } from '@igo2/utils';\n\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterDuringOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/legend.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WFSService } from './wfs.service';\nimport {\n  TimeFilterableDataSourceOptions,\n  WMSDataSourceOptions\n} from './wms-datasource.interface';\nimport {\n  checkWfsParams,\n  defaultFieldNameGeometry,\n  formatWFSQueryString\n} from './wms-wfs.utils';\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n\nexport class WMSDataSource extends DataSource {\n  public declare ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  set timeFilter(value: TimeFilterOptions) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> =\n    new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach((sourceField) => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters =\n        ogcFilterWriter.defineOgcFiltersDefaultOptions(\n          initOgcFilters,\n          fieldNameGeometry,\n          'wms'\n        );\n    } else {\n      initOgcFilters.advancedOgcFilters =\n        initOgcFilters.pushButtons ||\n        initOgcFilters.checkboxes ||\n        initOgcFilters.radioButtons ||\n        initOgcFilters.select ||\n        initOgcFilters.autocomplete\n          ? false\n          : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n        const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n        if (filterDuring.calendarModeYear) {\n          initOgcFilters.advancedOgcFilters = false;\n        }\n      }\n      if (initOgcFilters.pushButtons) {\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes) {\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons) {\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select) {\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete) {\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.ol.updateParams({ FILTER: sourceParams.FILTER });\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions =\n      options as TimeFilterableDataSourceOptions;\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter\n    ) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ ratio: 1 }, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n      this.ol.notify('timeFilter', this.ogcFilters);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && style === undefined && !view?.scale) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (\n      view?.size &&\n      view?.extent &&\n      view?.projection &&\n      this.options.contentDependentLegend\n    ) {\n      projParam =\n        this.params.VERSION === '1.3.0' || this.params.VERSION === undefined\n          ? 'CRS'\n          : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : (style as string)\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n","import { Extent } from 'ol/extent';\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent: Extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean\n): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(\n    options,\n    undefined,\n    options.paramsWFS.srsName\n  );\n  let igoFilters;\n  if (ogcFilters?.enabled) {\n    igoFilters = ogcFilters?.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(\n    igoFilters,\n    extent,\n    proj,\n    ogcFilters?.geometryName,\n    options\n  );\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(\n    options,\n    ogcFilters?.geometryName,\n    extent,\n    proj\n  );\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters?.advancedOgcFilters\n    ? filterOrBox\n    : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find((f) => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter)\n    ? `${baseUrl}&${paramsWFS.xmlFilter}`\n    : baseUrl;\n  options.download = Object.assign({}, options.download, {\n    dynamicUrl: baseUrl\n  });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex =\n    paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n      ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n      : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n    outputFormat = '';\n    version = 'version=1.1.0';\n    cnt = cnt.replace('count', 'maxFeatures');\n  }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n      ? 'srsname=' + paramsWFS.srsName\n      : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach((sourcefield) => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML2 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML32 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML3 }\n    });\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\nimport * as olproj from 'ol/proj';\nimport olTileGridWMTS from 'ol/tilegrid/WMTS';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","<div class=\"igo-form-button-group\">\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\"\n    color=\"primary\"\n    (click)=\"addStop()\"\n  >\n    <mat-icon>add_location_alt</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"\n      (routesFeatureStore.count$ | async) >= 1 ||\n      (stopsStore.count$ | async) >= 1\n    \"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\"\n    color=\"warn\"\n    (click)=\"resetStops()\"\n  >\n    <mat-icon>restore_page</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>zoom_in</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>content_copy</mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyLinkToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>link</mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"printDirections()\"\n    [disabled]=\"disabled$ | async\"\n    [matTooltip]=\"'igo.geo.directionsForm.print' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon>print</mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, Input, Optional } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { RouteService } from '@igo2/core/route';\nimport { Clipboard } from '@igo2/utils';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { DirectionsService } from '../shared';\nimport { FeatureWithDirection } from '../shared/directions.interface';\nimport {\n  addStopToStore,\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsStore\n} from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    NgIf,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsButtonsComponent {\n  get activeRoute() {\n    return this.routesFeatureStore\n      .all()\n      .find((route) => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  public disabled$ = new BehaviorSubject(false);\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService,\n    private directionsService: DirectionsService\n  ) {}\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsgLink',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsg',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach((stop) => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(',');\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach((step) => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore\n      .all()\n      .map((direction: FeatureWithDirection) => direction.properties.id)\n      .indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view\n      .all()\n      .map((stop) => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n\n  printDirections() {\n    this.stepFeatureStore.clear();\n    this.disabled$.next(true);\n    this.directionsService\n      .downloadDirection(\n        this.routesFeatureStore.map,\n        this.activeRoute.properties.direction\n      )\n      .subscribe(() => {\n        this.disabled$.next(false);\n      });\n  }\n}\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div\n    touchleave\n    (touchenter)=\"onStopEnter(stop)\"\n    (touchleave)=\"onStopLeave()\"\n    (mouseover)=\"onStopEnter(stop)\"\n    (mouseleave)=\"onStopLeave()\"\n    (cdkDragStarted)=\"stopIsDragged = true\"\n    (cdkDragEnded)=\"stopIsDragged = false\"\n    cdkDragLockAxis=\"y\"\n    class=\"stop-box\"\n    *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index\"\n    cdkDrag\n  >\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>{{ getPlaceholder(stop) }}</mat-label>\n        <input\n          id=\"{{ stop.id }}\"\n          type=\"text\"\n          [placeholder]=\"getPlaceholder(stop)\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"stop.text\"\n          aria-label=\"Number\"\n          matInput\n          (focus)=\"onInputFocus(stop)\"\n          [(ngModel)]=\"stop.text\"\n          (keyup)=\"setStopText($event, stop)\"\n          (keydown.enter)=\"$event.preventDefault()\"\n          [matAutocomplete]=\"auto\"\n        />\n        <button\n          *ngIf=\"\n            (stop.text || stop.coordinates) &&\n            stopWithHover &&\n            stop.id === stopWithHover.id\n          \"\n          mat-icon-button\n          matSuffix\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n          color=\"warn\"\n          aria-label=\"Clear\"\n          (click)=\"clearStop(stop)\"\n        >\n          <mat-icon>close</mat-icon>\n        </button>\n\n        <mat-autocomplete\n          [displayWith]=\"getOptionText\"\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"chooseProposal($event, stop)\"\n        >\n          <mat-optgroup\n            *ngFor=\"let source of stop.searchProposals\"\n            [label]=\"source.source.title\"\n            [disabled]=\"source.source.enabled === false\"\n          >\n            <mat-option\n              *ngFor=\"let result of source.results\"\n              [value]=\"result\"\n              matTooltipShowDelay=\"500\"\n              [matTooltip]=\"result.meta ? result.meta.title : ''\"\n            >\n              {{ result.meta ? result.meta.title : '' }}\n            </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n    <div\n      *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\"\n      class=\"igo-form-button-group\"\n    >\n      <button\n        class=\"swipe-vertical\"\n        cdkDragHandle\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\"\n        color=\"primary\"\n      >\n        <mat-icon>drag_indicator</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"(stopsStore.count$ | async) > 2\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\n        color=\"warn\"\n        (click)=\"removeStop(stop)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </div>\n  </div>\n</div>\n","import {\n  CdkDrag,\n  CdkDragDrop,\n  CdkDragHandle,\n  CdkDropList,\n  moveItemInArray\n} from '@angular/cdk/drag-drop';\nimport { AsyncPipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport {\n  MatAutocomplete,\n  MatAutocompleteModule\n} from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOption, MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olObservable from 'ol/Observable';\nimport * as olProj from 'ol/proj';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\nimport { Stop } from '../shared/directions.interface';\nimport {\n  computeRelativePosition,\n  removeStopFromStore,\n  updateStoreSorting\n} from '../shared/directions.utils';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss'],\n  standalone: true,\n  imports: [\n    CdkDropList,\n    NgFor,\n    CdkDrag,\n    NgClass,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatAutocompleteModule,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    MatOptionModule,\n    CdkDragHandle,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> =\n    new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) {}\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(\n    event: { source: MatAutocomplete; option: MatOption },\n    stop: Stop\n  ) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find((value) => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (\n        stop.relativePosition === DirectionRelativePositionType.Intermediate\n      ) {\n        extra = ' #' + stop.position;\n      }\n      return (\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.' + stop.relativePosition\n        ) + extra\n      );\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({\n      id: stop.id,\n      relativePosition: stop.relativePosition,\n      position: stop.position\n    });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once(\n      'singleclick',\n      (event) => {\n        const clickCoordinates = olProj.transform(\n          event.coordinate,\n          this.stopsFeatureStore.layer.map.projection,\n          this.projection\n        );\n        const roundedCoord = roundCoordTo(\n          clickCoordinates as [number, number],\n          this.coordRoundedDecimals\n        );\n        stop.text = roundedCoord.join(',');\n        stop.coordinates = roundedCoord;\n        this.stopsStore.update(stop);\n        setTimeout(() => {\n          this.stopInputHasFocus.emit(false);\n        }, 500);\n      }\n    );\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map((key) => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n  <mat-form-field *ngIf=\"directions && directions.length > 1\">\n    <mat-label>{{\n      'igo.geo.directionsForm.drivingOptions' | translate\n    }}</mat-label>\n    <mat-select\n      placeholder=\"{{ 'igo.geo.directionsForm.drivingOptions' | translate }}\"\n      (selectionChange)=\"changeRoute()\"\n      [(ngModel)]=\"activeDirection\"\n    >\n      <mat-option\n        *ngFor=\"let direction of directions; let cnt = index\"\n        [value]=\"direction\"\n      >\n        Option {{ cnt + 1 }} : {{ formatDistance(direction.distance) }} ({{\n          formatDuration(direction.duration)\n        }})\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n  <mat-list (mouseleave)=\"onStepsListBlur()\">\n    <h2 mat-header class=\"igo-route-title\">{{ activeDirection.title }}</h2>\n    <span class=\"mat-caption\">\n      {{ formatDistance(activeDirection.distance) }},\n      {{ formatDuration(activeDirection.duration) }}\n    </span>\n    <mat-list-item\n      class=\"igo-steps\"\n      (mouseenter)=\"showSegment(step)\"\n      (click)=\"showSegment(step, true)\"\n      *ngFor=\"let step of activeDirection.steps; let cnt = index\"\n      igoListItem\n    >\n      <mat-icon [ngClass]=\"formatStep(step, cnt).cssClass\" matListItemIcon\n        >{{ formatStep(step, cnt).image }}\n      </mat-icon>\n\n      <span class=\"igo-step-text\">\n        {{ cnt + 1 }}. {{ formatStep(step, cnt).instruction }}\n      </span>\n      <span matListItemMeta>\n        {{ formatDistance(step.distance) }}\n      </span>\n    </mat-list-item>\n\n    <mat-divider></mat-divider>\n  </mat-list>\n</div>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionType } from '../shared/directions.enum';\nimport {\n  Direction,\n  FeatureWithStep,\n  IgoStep\n} from '../shared/directions.interface';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatSelectModule,\n    FormsModule,\n    NgFor,\n    MatOptionModule,\n    MatDividerModule,\n    MatListModule,\n    MatIconModule,\n    NgClass,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe((entities) => {\n        const activeFeatureWithDirection = entities.find(\n          (entity) => entity.properties.active\n        );\n        this.directions = entities.map((entity) => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection =\n            activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(\n      (entity) => (entity.properties.active = !entity.properties.active)\n    );\n    this.routesFeatureStore.layer.ol\n      .getSource()\n      .getFeatures()\n      .map((feature) => feature.set('active', !feature.get('active')));\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (\n      geometryMapProjection as any\n    ).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(\n        feature.getGeometry().getExtent() as [number, number, number, number]\n      );\n    }\n  }\n}\n","import { Position } from 'geojson';\nimport { Observable } from 'rxjs';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { BaseDirectionsSourceOptionsProfile } from './directions-source.interface';\n\nexport abstract class DirectionsSource {\n  abstract profiles: BaseDirectionsSourceOptionsProfile[];\n  abstract getSourceName(): string;\n  abstract getEnabledProfile(): BaseDirectionsSourceOptionsProfile;\n  abstract getProfileWithAuthorization(): BaseDirectionsSourceOptionsProfile;\n  abstract route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions\n  ): Observable<Direction[]>;\n}\n","<div class=\"directions-options\">\n  <mat-slide-toggle\n    [checked]=\"directionControlIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onToggleDirectionsControl($event.checked)\"\n  >\n    {{ 'igo.geo.directionsForm.toggleActive' | translate }}\n  </mat-slide-toggle>\n  <mat-slide-toggle\n    *ngIf=\"hasOsrmPrivateAccess && twoSourcesAvailable\"\n    [checked]=\"enabledProfileHasAuthorization\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onTogglePrivateModeControl($event.checked)\"\n  >\n    {{ 'igo.geo.directionsForm.toggleType' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<igo-directions-buttons\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [contextUri]=\"contextUri\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [stopsStore]=\"stopsStore\"\n></igo-directions-buttons>\n\n<igo-directions-inputs\n  (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\"\n  [coordRoundedDecimals]=\"coordRoundedDecimals\"\n  [projection]=\"projection\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stopsStore]=\"stopsStore\"\n  [debounce]=\"debounce\"\n  [length]=\"length\"\n></igo-directions-inputs>\n\n<igo-directions-results\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n></igo-directions-results>\n","import { CommonModule } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { EntityStoreWatcher } from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\n\nimport Collection from 'ol/Collection';\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport { SelectEvent } from 'ol/interaction/Select';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport * as olProj from 'ol/proj';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { QueryService } from '../query/shared/query.service';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { SearchService } from '../search/shared/search.service';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\nimport { BaseDirectionsSourceOptionsProfile } from './directions-sources';\nimport { DirectionsSourceService } from './shared/directions-source.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport {\n  DirectionOptions,\n  FeatureWithStopProperties,\n  Stop\n} from './shared/directions.interface';\nimport { DirectionsService } from './shared/directions.service';\nimport {\n  addDirectionToRoutesFeatureStore,\n  addStopToStopsFeatureStore,\n  addStopToStore,\n  initRoutesFeatureStore,\n  initStepFeatureStore,\n  initStopsFeatureStore,\n  updateStoreSorting\n} from './shared/directions.utils';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from './shared/store';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss'],\n  standalone: true,\n  imports: [\n    CommonModule,\n    MatSlideToggleModule,\n    DirectionsButtonsComponent,\n    DirectionsInputsComponent,\n    DirectionsResultsComponent,\n    IgoLanguageModule\n  ]\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n  public hasOsrmPrivateAccess: boolean = false;\n  public twoSourcesAvailable: boolean = false;\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute: olInteraction.Select;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n  private authenticated$$: Subscription;\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() authenticated$: BehaviorSubject<boolean>;\n\n  /**\n   * Wheter one of the direction control is active\n   * @internal\n   */\n  get directionControlIsActive(): boolean {\n    return !this.queryService.queryEnabled;\n  }\n\n  get interactions(): olInteraction.Interaction[] {\n    return [this.selectStopInteraction, this.translateStop, this.selectedRoute];\n  }\n\n  get enabledProfileHasAuthorization() {\n    return this.directionsSourceService.sources[0].getEnabledProfile()\n      .authorization;\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private directionsSourceService: DirectionsSourceService,\n    private searchService: SearchService,\n    private queryService: QueryService,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit(): void {\n    this.authenticated$$ = this.authenticated$.subscribe(\n      (authenticated: boolean) => {\n        if (authenticated) {\n          const profileWithAuth: BaseDirectionsSourceOptionsProfile =\n            this.directionsSourceService.sources[0].getProfileWithAuthorization();\n          if (profileWithAuth) {\n            this.http\n              .get(profileWithAuth.authorization.url)\n              .subscribe((user) => {\n                this.hasOsrmPrivateAccess =\n                  user[profileWithAuth.authorization.property];\n              });\n          }\n        }\n      }\n    );\n    this.twoSourcesAvailable =\n      this.directionsSourceService.sources[0].profiles.length === 2\n        ? true\n        : false;\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.authenticated$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.interactions.map((interaction) =>\n      this.routesFeatureStore.layer.map.ol.removeInteraction(interaction)\n    );\n    this.stopsFeatureStore.deactivateStrategyOfType(\n      FeatureStoreLoadingStrategy\n    );\n    this.routesFeatureStore.deactivateStrategyOfType(\n      FeatureStoreLoadingStrategy\n    );\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore\n          .all()\n          .find((route) => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(\n            routeExtent as [number, number, number, number]\n          );\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: (feature) => {\n        return (\n          feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating\n        );\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number],\n          this.coordRoundedDecimals\n        );\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.interactions.map((interaction) =>\n      this.routesFeatureStore.layer.map.ol.addInteraction(interaction)\n    );\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus\n      ? this.routesFeatureStore.layer.map.ol.removeInteraction(\n          this.selectedRoute\n        )\n      : this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(features: Collection<any>) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(\n      translationCoordinates as [number, number],\n      this.coordRoundedDecimals\n    );\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(distinctUntilChanged())\n      .subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map((s) => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({\n        ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates }\n      });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, [\n      'coordinates'\n    ]);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = change.newValue as Stop;\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(\n            term,\n            this.stopsFeatureStore.layer.map.projection\n          );\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, {\n            searchType: 'Feature'\n          });\n          this.cancelSearch();\n          const requests$ = researches.map((res) =>\n            res.request.pipe(\n              map((results: SearchResult[]) =>\n                results.filter((r) =>\n                  isCoord\n                    ? r.data.geometry.type === 'Point' && r.data.geometry\n                    : r.data.geometry\n                )\n              )\n            )\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request\n              .pipe(\n                map((results: SearchResult[]) =>\n                  results.filter((r) =>\n                    isCoord\n                      ? r.data.geometry.type === 'Point' && r.data.geometry\n                      : r.data.geometry\n                  )\n                )\n              )\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map((r) => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(\n                    (sp) =>\n                      sp.type ===\n                      (isCoord ? ProposalType.Coord : ProposalType.Text)\n                  );\n                  let storedSource = stop.searchProposals.find(\n                    (sp) => sp.source === source\n                  );\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter((stop) => stop.coordinates);\n    stopsWithCoordinates.map((stop) => this.addStopOverlay(stop));\n    this.stopsFeatureStore\n      .all()\n      .map((stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter((stop) => !stop.coordinates);\n    stopsWithoutCoordinates.map((stop) => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter((stop) => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(\n        stop.coordinates,\n        this.coordRoundedDecimals\n      );\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      this.routesQueries$$.push(\n        routeResponse.subscribe((directions) => {\n          this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n          directions.map((direction) =>\n            addDirectionToRoutesFeatureStore(\n              this.routesFeatureStore,\n              direction,\n              this.projection,\n              direction === directions[0] ? true : false\n            )\n          );\n        })\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(\n      stop,\n      this.stopsStore,\n      this.stopsFeatureStore,\n      this.projection,\n      this.languageService\n    );\n  }\n\n  onToggleDirectionsControl(isActive: boolean) {\n    this.queryService.queryEnabled = !isActive;\n    const ol = this.routesFeatureStore.layer.map.ol;\n    this.interactions.map((interaction) =>\n      isActive\n        ? ol.addInteraction(interaction)\n        : ol.removeInteraction(interaction)\n    );\n  }\n\n  onTogglePrivateModeControl(isActive: boolean) {\n    this.directionsSourceService.sources[0].profiles.forEach(\n      (profile) => (profile.enabled = false)\n    );\n    if (isActive) {\n      this.directionsSourceService.sources[0].profiles.find(\n        (profile) => profile.authorization\n      ).enabled = true;\n      this.messageService.alert(\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.forestRoadsWarning.text'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.forestRoadsWarning.title'\n        )\n      );\n    } else {\n      this.directionsSourceService.sources[0].profiles.find(\n        (profile) => !profile.authorization\n      ).enabled = true;\n    }\n    this.getRoutes();\n  }\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\r\n\r\nexport class DirectionsSourceService {\r\n  constructor(public sources: DirectionsSource[]) {}\r\n}\r\n\r\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\r\n  return new DirectionsSourceService(sources);\r\n}\r\n\r\nexport function provideDirectionsSourceService() {\r\n  return {\r\n    provide: DirectionsSourceService,\r\n    useFactory: directionsSourceServiceFactory,\r\n    deps: [DirectionsSource]\r\n  };\r\n}\r\n","export enum DirectionsFormat {\r\n  GeoJSON,\r\n  JSON\r\n}\r\nexport enum SourceDirectionsType {\r\n  Route = 'route',\r\n  Trip = 'trip'\r\n}\r\n\r\nexport enum ProposalType {\r\n  Coord = 'coord',\r\n  Text = 'text'\r\n}\r\n\r\nexport enum DirectionType {\r\n  Stop = 'stop',\r\n  Route = 'route',\r\n  Vertex = 'vertex'\r\n}\r\n\r\nexport enum DirectionRelativePositionType {\r\n  Start = 'start',\r\n  Intermediate = 'intermediate',\r\n  End = 'end'\r\n}\r\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core/activity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Position } from 'geojson';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport { UserOptions } from 'jspdf-autotable';\nimport moment from 'moment';\nimport { Observable, Subject } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintService } from '../../print/shared/print.service';\nimport { PrintLegendPosition } from '../../print/shared/print.type';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSourceService } from './directions-source.service';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from './directions.utils';\n\n@Injectable()\nexport class DirectionsService {\n  constructor(\n    private directionsSourceService: DirectionsSourceService,\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private printService: PrintService,\n    @Inject(DOCUMENT) private document: Document,\n    private activityService: ActivityService\n  ) {}\n\n  route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.routeSource(\n      this.directionsSourceService.sources[0],\n      coordinates,\n      directionsOptions\n    );\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions);\n    return request;\n  }\n\n  downloadDirection(\n    map: IgoMap,\n    direction: Direction\n  ): Observable<SubjectStatus> {\n    const activityId = this.activityService.register();\n    const status$ = new Subject<SubjectStatus>();\n\n    const doc: jsPDF = new jsPDF({\n      orientation: 'p',\n      format: 'Letter',\n      unit: 'mm' // default\n    });\n\n    const { width: pageWidth, height: pageHeight } = doc.internal.pageSize;\n\n    /** top | right | bottom | left */\n    const margins: [number, number, number, number] = [20, 10, 20, 10];\n    const width = pageWidth - margins[3] - margins[1];\n    const height = pageHeight - margins[0] - margins[2];\n    const imageDimensions: [number, number] = [width, height];\n\n    const title = `${direction.title} (${formatDistance(\n      direction.distance\n    )}, ${formatDuration(direction.duration)})`;\n    const titlePosition = 25;\n\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n\n    const resolution = 96; // Default is 96\n    this.printService\n      .addMap(\n        doc,\n        map,\n        resolution,\n        imageDimensions,\n        margins,\n        PrintLegendPosition.none\n      )\n      .subscribe(async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addInstructions(doc, direction, title);\n          this.setPageHeaderFooter(doc);\n          await doc.save(`${title}.pdf`, { returnPromise: true });\n        }\n\n        this.activityService.unregister(activityId);\n        status$.next(status);\n      });\n\n    return status$;\n  }\n\n  private async setHTMLTableContent(\n    direction: Direction\n  ): Promise<HTMLTableElement> {\n    const data = await this.directionsInstruction(direction);\n    const table = document.createElement('table');\n    const tblBody = document.createElement('tbody');\n    for (let index = 0; index < data.length; index++) {\n      const element = data[index];\n      var row = document.createElement('tr');\n      var cellImage = document.createElement('td');\n      var cellText = document.createElement('td');\n      // icon\n      const img = document.createElement('img') as HTMLImageElement;\n      img.src = element.icon;\n      // instruction text\n      const span = document.createElement('span') as HTMLElement;\n      span.innerHTML = element.instruction;\n      cellImage.appendChild(img);\n      cellText.appendChild(span);\n      if (element.distance) {\n        const spanDistance = document.createElement('span') as HTMLElement;\n        spanDistance.style.verticalAlign = 'middle';\n        spanDistance.innerHTML =\n          '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element.distance;\n        cellText.appendChild(spanDistance);\n      }\n      row.append(cellImage);\n      row.append(cellText);\n      tblBody.appendChild(row);\n    }\n    table.appendChild(tblBody);\n    return table;\n  }\n\n  private async directionsInstruction(\n    direction: Direction\n  ): Promise<Array<{ instruction: string; icon: string; distance: string }>> {\n    const matListItems = this.document\n      .getElementsByTagName('igo-directions-results')[0]\n      .getElementsByTagName('mat-list')[0];\n    const matListItem = matListItems.getElementsByTagName('mat-list-item');\n    // convert icon list to base64\n    let iconsArray: Array<{ name: string; icon: string }> = [];\n    for (let index = 0; index < matListItem.length; index++) {\n      const element = matListItem[index];\n      const icon = element.getElementsByTagName('mat-icon')[0] as HTMLElement;\n      const iconName = icon.getAttribute('data-mat-icon-name') as string;\n      const found = iconsArray.some((el) => el.name === iconName);\n      if (!found) {\n        const iconCanvas = await html2canvas(icon, { scale: 3 });\n        iconsArray.push({ name: iconName, icon: iconCanvas.toDataURL() });\n      }\n    }\n\n    let formattedDirection: Array<{\n      instruction: string;\n      icon: string;\n      distance: string;\n    }> = [];\n    for (let i = 0; i < direction.steps.length; i++) {\n      const step = direction.steps[i];\n      const instruction = formatInstruction(\n        step.maneuver.type,\n        step.maneuver.modifier,\n        step.name,\n        step.maneuver.bearing_after,\n        i,\n        (step.maneuver as any).exit,\n        this.languageService,\n        i === direction.steps.length - 1\n      );\n\n      const distance = formatDistance(step.distance);\n      formattedDirection.push({\n        instruction: i + 1 + '. ' + instruction.instruction,\n        icon: iconsArray.find((icon) => icon.name === instruction.image).icon,\n        distance: distance ? '(' + distance + ')' : undefined\n      });\n    }\n    return formattedDirection;\n  }\n\n  private async addInstructions(\n    doc: jsPDF,\n    direction: Direction,\n    title: string\n  ) {\n    doc.addPage();\n    const titlePosition = 25;\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n    const HTMLtable = await this.setHTMLTableContent(direction);\n    const tablePos = titlePosition + 5;\n    (doc as any).autoTable({\n      html: HTMLtable,\n      startY: tablePos,\n      margin: { top: 20, bottom: 20 },\n      columnStyles: {\n        0: { cellWidth: 10 }\n      },\n      theme: 'plain',\n      styles: {\n        fontSize: 12\n      },\n      didDrawCell: function (data) {\n        if (data.column.index === 0 && data.cell.section === 'body') {\n          data.row.height = 10;\n          const td = data.cell.raw as HTMLElement;\n          const img = td.getElementsByTagName('img')[0];\n          doc.addImage(img.src, data.cell.x, data.cell.y, 8, 8);\n        }\n      }\n    } satisfies UserOptions);\n  }\n\n  private setPageHeaderFooter(doc: jsPDF) {\n    const pageCount = doc.getNumberOfPages();\n    const date = moment(Date.now()).format('DD/MM/YYYY hh:mm').toString();\n\n    const logoConfig = this.configService.getConfig('directionsSources.logo');\n    const logo = logoConfig ? logoConfig : 'assets/logo.png';\n\n    for (let index = 0; index < pageCount; index++) {\n      doc.setPage(index);\n      doc.setFontSize(8);\n      const pageSize = doc.internal.pageSize;\n      const pageHeight = pageSize.height\n        ? pageSize.height\n        : pageSize.getHeight();\n      const width = pageSize.width ? pageSize.width : pageSize.getWidth();\n      doc.text(date, 10, 10, { baseline: 'top' });\n      doc.addImage(logo, 'PNG', width - 20, 5, 10, 10);\n      doc.text(date, 10, pageHeight - 10);\n      doc.text(\n        'Page ' + doc.getCurrentPageInfo().pageNumber + ' / ' + pageCount,\n        width - 20,\n        pageHeight - 10\n      );\n    }\n  }\n}\n","import { LanguageService } from '@igo2/core/language';\nimport { NumberUtils, uuid } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olProj from 'ol/proj';\nimport * as olStyle from 'ol/style';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\nimport {\n  DirectionRelativePositionType,\n  DirectionType\n} from './directions.enum';\nimport {\n  Direction,\n  FeatureWithDirection,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(\n  stopsStore: StopsStore,\n  direction: 'asc' | 'desc' = 'asc',\n  field = 'position'\n) {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(\n  index: number,\n  totalLength\n): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(\n      stop.position,\n      stopsToComputePosition.length\n    );\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map((stop) => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore\n    .all()\n    .find((stop) => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(\n      lastPosition,\n      stopsStore.count + 1\n    );\n  }\n\n  stopsStore.insert({\n    id,\n    position: insertPosition,\n    relativePosition: computeRelativePosition(\n      insertPosition,\n      stopsStore.count + 1\n    )\n  });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`,\n        width: 10\n      })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`,\n        width: 6\n      })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(\n  stopsFeatureStore: StopsFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.stopLayer'\n    ),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.routeLayer'\n    ),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService\n) {\n  let stopColor;\n  let stopText;\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.start'\n      );\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.end'\n      );\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText =\n        languageService.translate.instant(\n          'igo.geo.directionsForm.intermediate'\n        ) +\n        ' #' +\n        stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(\n      stop.coordinates,\n      projection,\n      stopsFeatureStore.map.projection\n    )\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false\n) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  if (distance >= 1000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route: string = 'Voie',\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'arrow_forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix =\n    modifier === 'straight'\n      ? ''\n      : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory_arrow_right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory_arrow_right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'arrow_forward';\n  } else if (modifier === 'slight left') {\n    image = 'arrow_forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory_arrow_left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory_arrow_left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', {\n        route\n      });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', {\n        route,\n        aggregatedDirection,\n        translatedModifier\n      });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', {\n      route,\n      translatedDirection\n    });\n    image = 'explore';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', {\n      route,\n      translatedDirection\n    });\n    image = 'explore';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', {\n        coma,\n        aggregatedDirection\n      });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', {\n        route\n      });\n      image = 'location_on';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', {\n      translatedModifier,\n      route\n    });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', {\n      route\n    });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix =\n      exit === 1\n        ? translate.instant('igo.geo.directions.cntSuffix.first')\n        : translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', {\n      exit,\n      cntSuffix,\n      route\n    });\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'donut_large';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', {\n      route\n    });\n    image = 'arrow_forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', {\n      translatedDirection,\n      route\n    });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'explore' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(\n  bearing: number,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n","import { EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FeatureStore } from '../../feature/shared/store';\nimport {\n  FeatureWithDirection,\n  FeatureWithStep,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n  public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  public clearStops() {\n    this.storeInitialized$.next(false);\n    this.clear();\n  }\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {}\n","<table\n  class=\"igo-striped mat-typography\"\n  *ngIf=\"\n    ready &&\n    feature &&\n    isObject(feature.properties) &&\n    feature.properties.target !== 'iframe'\n  \"\n>\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <mat-icon matListItemIcon>{{ icon }}</mat-icon>\n      </td>\n\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          {{ 'igo.geo.targetHtmlUrl' | translate }} {{ title }}</a\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon>content_copy</mat-icon>\n        </button>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{ property.key }}\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          !isUrl(property.value) &&\n          !isEmbeddedLink(property.value)\n        \"\n        [innerHTML]=\"property.value\"\n      ></td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          isEmbeddedLink(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ getEmbeddedLinkText(property.value) }}</u\n        >\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          (isDoc(property.value) || isUrl(property.value)) &&\n          !isImg(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ 'igo.geo.targetHtmlUrl' | translate }}</u\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon>content_copy</mat-icon>\n        </button>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          isUrl(property.value) &&\n          isImg(property.value)\n        \"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          (click)=\"openSecureUrl(property.value)\"\n          rel=\"noopener noreferrer\"\n        >\n          <img\n            igoImageError\n            src=\"{{ property.value | secureImage | async }}\"\n            width=\"225\"\n            height=\"auto\"\n          />\n        </a>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined && isObject(property.value)\n        \"\n        [innerHTML]=\"property.value | json\"\n      ></td>\n    </tr>\n  </tbody>\n</table>\n\n<iframe\n  *ngIf=\"isHtmlDisplay()\"\n  [srcdoc]=\"htmlSanitizer(feature.properties)\"\n  [src]=\"urlSanitizer(feature.properties.url)\"\n></iframe>\n","import {\n  AsyncPipe,\n  JsonPipe,\n  KeyValuePipe,\n  NgFor,\n  NgIf,\n  NgStyle\n} from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n\nimport { getEntityIcon, getEntityTitle } from '@igo2/common/entity';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport type { Toolbox } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\nimport { Clipboard } from '@igo2/utils';\n\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { Feature } from '../shared';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    MatIconModule,\n    NgStyle,\n    ImageErrorDirective,\n    AsyncPipe,\n    JsonPipe,\n    KeyValuePipe,\n    IgoLanguageModule,\n    SecureImagePipe\n  ]\n})\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private configService: ConfigService\n  ) {\n    this.networkService\n      .currentState()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n      });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n  isHtmlDisplay(): boolean {\n    if (\n      this.feature &&\n      this.isObject(this.feature.properties) &&\n      this.feature.properties.target === 'iframe'\n    ) {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body) {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace(\n        '<head>',\n        `<head><base href=\"${url.origin}\">`\n      );\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\n    );\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http\n        .get(url, {\n          responseType: 'blob'\n        })\n        .subscribe(\n          (docOrImage) => {\n            const fileUrl = URL.createObjectURL(docOrImage);\n            window.open(fileUrl, '_blank');\n            this.cdRef.detectChanges();\n          },\n          (error: Error) => {\n            this.messageService.error(\n              'igo.geo.targetHtmlUrlUnauthorized',\n              'igo.geo.targetHtmlUrlUnauthorizedTitle'\n            );\n          }\n        );\n    } else {\n      let url = value;\n      if (this.isEmbeddedLink(value)) {\n        var div = document.createElement('div');\n        div.innerHTML = value;\n        url = div.children[0].getAttribute('href');\n      }\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n      const matchRegex = /<a/g;\n      const match = value.match(matchRegex) || [];\n      const count = match.length;\n      if (count === 1) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n    return false;\n  }\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?:>).*?(?=<|$)/;\n    let text = value.match(regex)[0] as string;\n    text = text.replace(/>/g, '');\n    return text;\n  }\n\n  filterFeatureProperties(feature): { [key: string]: any } {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.forcedOffline$\n        .pipe(takeUntil(this.unsubscribe$))\n        .subscribe((state) => {\n          offlineButtonState = state;\n        });\n    }\n\n    if (\n      feature.properties &&\n      feature.properties.Route &&\n      this.toolbox &&\n      !this.toolbox.getTool('directions')\n    ) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach((field) => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (\n          this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttribute\n        ) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        } else if (\n          !this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttributeOffline\n        ) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (\n        this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttribute\n      ) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      } else if (\n        !this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttributeOffline\n      ) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n\n  /**\n   * Copy the url to a clipboard\n   */\n  copyTextToClipboard(value: string): void {\n    const successful = Clipboard.copy(value);\n    if (successful) {\n      this.messageService.success('igo.geo.query.link.message');\n    }\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\n\n@Directive({\n  // This directive allow to view the route between the user coordinates and the feature\n  selector: '[igoFeatureDetailsDirective]',\n  standalone: true\n})\nexport class FeatureDetailsDirective implements OnInit {\n  private component: FeatureDetailsComponent;\n\n  get feature() {\n    return this.component.feature;\n  }\n  feature$ = new BehaviorSubject(undefined);\n\n  @Output() routingEvent = new EventEmitter<void>();\n\n  @HostListener('selectFeature')\n  setFeature() {\n    this.feature$.next(this.feature);\n  }\n\n  constructor(\n    @Self() component: FeatureDetailsComponent,\n    private el: ElementRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.feature$.subscribe(() => {\n      if (this.feature.geometry) {\n        this.bindClicking();\n      }\n    });\n  }\n\n  bindClicking() {\n    setTimeout(() => {\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\n      if (routeElement) {\n        routeElement.addEventListener('click', () => {\n          this.routingEvent.emit();\n        });\n      }\n    }, 1);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\nexport const FEATURE_DETAILS_DIRECTIVES = [\n  FeatureDetailsComponent,\n  FeatureDetailsDirective\n] as const;\n\n/**\n * @deprecated import the FeatureDetailsComponent, FeatureDetailsDirective directly or the FEATURE_DETAILS_DIRECTIVES for all\n */\n@NgModule({\n  imports: [...FEATURE_DETAILS_DIRECTIVES],\n  exports: [...FEATURE_DETAILS_DIRECTIVES]\n})\nexport class IgoFeatureDetailsModule {}\n","import { AsyncPipe } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output,\n  ViewChild\n} from '@angular/core';\n\nimport { getEntityRevision } from '@igo2/common/entity';\nimport { Form, FormComponent } from '@igo2/common/form';\nimport { uuid } from '@igo2/utils';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { FEATURE } from '../shared/feature.enums';\nimport { Feature, FeatureMeta } from '../shared/feature.interfaces';\n\n/**\n * A configurable form, optionnally bound to a feature.\n * This component creates an entity form and, on submit,\n * returns a feature made out of the submitted data. It also\n * does things like managing the feature visibility while it's being updated\n * as well as disabling the selection of another feature.\n */\n@Component({\n  selector: 'igo-feature-form',\n  templateUrl: './feature-form.component.html',\n  styleUrls: ['./feature-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [FormComponent, AsyncPipe]\n})\nexport class FeatureFormComponent {\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Feature to update\n   */\n  @Input()\n  set feature(value: Feature | undefined) {\n    this.feature$.next(value);\n  }\n  get feature(): Feature | undefined {\n    return this.feature$.value;\n  }\n  readonly feature$: BehaviorSubject<Feature> = new BehaviorSubject(undefined);\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<Feature>();\n\n  @ViewChild('igoForm', { static: true }) igoForm: FormComponent;\n\n  constructor() {}\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit(data: { [key: string]: any }) {\n    const feature = this.formDataToFeature(data);\n    this.submitForm.emit(feature);\n  }\n\n  getData(): Feature {\n    return this.formDataToFeature(this.igoForm.getData());\n  }\n\n  /**\n   * Transform the form data to a feature\n   * @param data Form data\n   * @returns A feature\n   */\n  private formDataToFeature(data: { [key: string]: any }): Feature {\n    const properties = {};\n    const meta = {};\n    if (this.feature === undefined) {\n      (meta as any).id = uuid();\n    } else {\n      Object.assign(properties, this.feature.properties);\n      Object.assign(meta, this.feature.meta, {\n        revision: getEntityRevision(this.feature) + 1\n      });\n    }\n\n    const propertyPrefix = 'properties.';\n    Object.entries(data).forEach((entry: [string, any]) => {\n      const [key, value] = entry;\n      if (key.startsWith(propertyPrefix)) {\n        const property = key.substr(propertyPrefix.length);\n        properties[property] = value;\n      }\n    });\n\n    let geometry = data.geometry;\n    if (geometry === undefined && this.feature !== undefined) {\n      geometry = this.feature.geometry;\n    }\n\n    return {\n      meta: meta as FeatureMeta,\n      type: FEATURE,\n      geometry,\n      projection: 'EPSG:4326',\n      properties\n    };\n  }\n}\n","<igo-form\n  #igoForm\n  [form]=\"form\"\n  [formData]=\"feature$ | async\"\n  (submitForm)=\"onSubmit($event)\"\n>\n  <ng-content></ng-content>\n\n  <ng-content select=\"[formButtons]\" formButtons></ng-content>\n</igo-form>\n","import { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureStore } from './store';\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n","export const FEATURE = 'Feature';\r\n\r\nexport enum FeatureMotion {\r\n  None,\r\n  Move,\r\n  Zoom,\r\n  Default\r\n}\r\n","import {\n  EntityKey,\n  getEntityIcon,\n  getEntityId,\n  getEntityProperty,\n  getEntityRevision,\n  getEntityTitle\n} from '@igo2/common/entity';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport type { GeometryLayout } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLayer from 'ol/layer/Layer';\nimport * as olproj from 'ol/proj';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlSource from 'ol/source/Source';\nimport * as olstyle from 'ol/style';\n\nimport { MapViewController } from '../../map/shared/controllers/view';\nimport { MapExtent } from '../../map/shared/map.interface';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(\n    olRenderFeature.getExtent(),\n    projectionIn,\n    projectionOut\n  ) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        (sourceOptions.type === 'arcgisrest' ||\n        sourceOptions.type === 'tilearcgisrest'\n          ? 'OBJECTID'\n          : undefined);\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId()\n    ? olFeature.getId()\n    : olFeature.get(idColumn)\n      ? olFeature.get(idColumn)\n      : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  olFeature: OlFeature<OlGeometry>,\n  projection: olproj.Projection\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  olFeatures: OlFeature<OlGeometry>[],\n  projection: olproj.Projection\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(olFeature, projection);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * By default, we define the edge as 5% (0.05) of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param edgeRatio Number or Number[] Single value OR an array =>\n *  [top,right,bottom,left] directions, in that order\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  extent: MapExtent,\n  featuresExtent: [number, number, number, number],\n  edgeRatio: number | number[] = 0.05\n) {\n  const edgesRatio = Array.isArray(edgeRatio)\n    ? edgeRatio\n    : [edgeRatio, edgeRatio, edgeRatio, edgeRatio];\n  const scale = [-1, -1, -1, -1].map((x, i) => x * edgesRatio[i]);\n  const viewExtent = scaleExtent(\n    extent,\n    scale as [number, number, number, number]\n  );\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  viewController: MapViewController,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  viewController: MapViewController,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const extent = viewController.getExtent();\n  const projection = viewController.getOlProjection();\n  const featuresExtent = computeOlFeaturesExtent(olFeatures, projection);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(extent, featuresExtent) ||\n      featuresAreTooDeepInView(viewController, featuresExtent, areaRatio)\n    ) {\n      viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { Subscription, debounceTime } from 'rxjs';\n\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$.subscribe(() =>\n      this.updateEntitiesInResolution(\n        store,\n        store.layer.map.viewController.getResolution()\n      )\n    );\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(\n      store,\n      store.layer.map.viewController.getResolution()\n    );\n    this.resolution$$.push(\n      store.layer.map.viewController.resolution$\n        .pipe(debounceTime(250))\n        .subscribe((res) => {\n          this.updateEntitiesInResolution(store, res);\n        })\n    );\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (\n      mapResolution > store.layer.minResolution &&\n      mapResolution < store.layer.maxResolution\n    ) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\n\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { GeoServiceDefinition } from '../../../utils/propertyTypeDetector/propertyTypeDetector.interface';\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport {\n  Feature,\n  FeatureStorePropertyTypeStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated to detect geoproperties\n * (wms/arcgis... layer and url).\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\n */\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  /**\n   * The map the layer is bound to\n   */\n  private readonly map: IgoMap;\n\n  constructor(\n    protected options: FeatureStorePropertyTypeStrategyOptions,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {\n    super(options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesPropertiesState(store);\n    this.states$$.push(\n      this.map.layers$\n        .pipe(debounceTime(250), pairwise())\n        .subscribe(([prevLayers, currentLayers]) => {\n          let prevLayersId;\n          if (prevLayers) {\n            prevLayersId = prevLayers.map((l) => l.id);\n          }\n          const layers = currentLayers.filter(\n            (l) => !prevLayersId.includes(l.id)\n          );\n          this.updateEntitiesPropertiesState(store, layers);\n        })\n    );\n    this.states$$.push(\n      store.entities$.pipe(debounceTime(250)).subscribe((a) => {\n        this.updateEntitiesPropertiesState(store);\n      })\n    );\n  }\n\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\n    const layersId = this.map.layers.map((l) => l.id);\n    let entities: Feature[] = [];\n    if (layers) {\n      entities = store.entities$.value;\n    } else {\n      const allSV = store.stateView.all();\n      entities = allSV.length\n        ? store.stateView\n            .all()\n            .filter((s) => !s.state.geoService)\n            .map((e) => e.entity)\n        : store.entities$.value;\n    }\n    const sampling = entities.length >= 250 ? 250 : entities.length;\n    const firstN = entities.slice(0, sampling);\n    let allKeys = [];\n    firstN.map((e) => {\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\n    });\n    allKeys = [...new Set(allKeys)];\n    const distinctValues = {};\n    allKeys.map((k) => {\n      distinctValues[k] = [\n        ...new Set(entities.map((item) => item.properties[k]))\n      ];\n    });\n    const containGeoServices = {};\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      const valuedAreGeoservices = values.filter((value) =>\n        this.propertyTypeDetectorService.isGeoService(value)\n      );\n      if (valuedAreGeoservices?.length) {\n        containGeoServices[key] = valuedAreGeoservices;\n      }\n    });\n    interface GeoServiceAssociation {\n      url: string;\n      layerNameProperty: string;\n      urlProperty: string;\n      geoService: GeoServiceDefinition;\n    }\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      values.map((value) => {\n        const geoService = this.propertyTypeDetectorService.getGeoService(\n          value,\n          allKeys\n        );\n        if (geoService) {\n          const propertiesForLayerName = allKeys.filter((p) =>\n            geoService.propertiesForLayerName.includes(p)\n          );\n          // providing the the first matching regex;\n          const propertyForLayerName = propertiesForLayerName.length\n            ? propertiesForLayerName[0]\n            : undefined;\n          if (propertyForLayerName) {\n            geoServiceAssociations.push({\n              url: value,\n              urlProperty: key,\n              layerNameProperty: propertyForLayerName,\n              geoService\n            });\n          }\n        }\n      });\n    });\n    const geoServiceStates: {\n      geoServiceAssociation: GeoServiceAssociation;\n      state: any;\n    }[] = [];\n    geoServiceAssociations.map((geoServiceAssociation) => {\n      const url = geoServiceAssociation.url;\n      const type = geoServiceAssociation.geoService.type || 'wms';\n      distinctValues[geoServiceAssociation.layerNameProperty].map(\n        (layerName) => {\n          let appliedLayerName = layerName;\n          let arcgisLayerName = undefined;\n          if (\n            ['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)\n          ) {\n            appliedLayerName = undefined;\n            arcgisLayerName = layerName;\n          }\n          const so = ObjectUtils.removeUndefined({\n            sourceOptions: {\n              type: type || 'wms',\n              url,\n              optionsFromCapabilities: true,\n              optionsFromApi: true,\n              params: {\n                LAYERS: appliedLayerName,\n                LAYER: arcgisLayerName\n              }\n            }\n          });\n          const potentialLayerId = generateIdFromSourceOptions(\n            so.sourceOptions\n          );\n          geoServiceStates.push({\n            geoServiceAssociation,\n            state: {\n              added: layersId.find((l) => l === potentialLayerId) !== undefined,\n              haveGeoServiceProperties: true,\n              type,\n              url,\n              layerName\n            }\n          });\n        }\n      );\n    });\n    geoServiceStates.map((geoServiceState) => {\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\n      const layerNameProperty =\n        geoServiceState.geoServiceAssociation.layerNameProperty;\n\n      const urlValue = geoServiceState.state.url;\n      const layerNameValue = geoServiceState.state.layerName;\n      const entitiesToProcess = entities.filter(\n        (e) =>\n          e.properties[urlProperty] === urlValue &&\n          e.properties[layerNameProperty] === layerNameValue\n      );\n      const ns = {\n        geoService: geoServiceState.state\n      };\n      store.state.updateMany(entitiesToProcess, ns, true);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport OlEvent from 'ol/events/Event';\n\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { DocumentOptions, Document as FlexSearchDocument } from 'flexsearch';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n *\n * This strategy loads a layer's features's properties into a searchable index.\n */\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  private initStoreSearchIndex(store) {\n    store.searchDocument = new FlexSearchDocument({ tokenize: 'full' });\n  }\n\n  /**\n   * Watch for a store's entities changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n    this.initStoreSearchIndex(store);\n\n    store.entities$\n      .pipe(skipWhile((e) => !e.length))\n      .subscribe(() => this.onEntitiesChanges(store));\n  }\n\n  /**\n   * Stop watching for a store's entities changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      store.searchDocument = undefined;\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Maintain searcahble index for every loaded entities\n   * @param store Feature store\n   */\n  private onEntitiesChanges(store: FeatureStore) {\n    const ratio = this.options.percentDistinctValueRatio || 2;\n    const featuresProperties = [];\n    store.index.forEach((value, key) => {\n      const fp = value.properties;\n      fp.igoSearchID = key;\n      featuresProperties.push(fp);\n    });\n    const toIndex = [];\n    let columnsToNotIndex = [];\n    let contentToIndex = [];\n    if (this.options.sourceFields) {\n      columnsToNotIndex = this.options.sourceFields.filter(\n        (sf) => !sf.searchIndex?.enabled\n      );\n      contentToIndex = this.options.sourceFields\n        .filter((sf) => sf.searchIndex?.enabled)\n        .map((sf2) => {\n          return Object.assign(\n            {},\n            { field: sf2.name, tokenize: 'full' },\n            sf2.searchIndex\n          );\n        });\n    } else {\n      if (featuresProperties.length) {\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\n        const columns = Object.keys(featuresProperties[0]);\n        const columnsToIndex = [];\n        columnsToNotIndex = columns\n          .map((column) => {\n            const distinctValues = [\n              ...new Set(featuresProperties.map((item) => item[column]))\n            ];\n            // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\n            if (\n              (distinctValues.length / featuresProperties.length) * 100 <=\n                ratio ||\n              distinctValues.every((n) => Number(n) === n && n % 1 !== 0)\n            ) {\n              columnsToNotIndex.push(column);\n            } else {\n              columnsToIndex.push(column);\n            }\n          })\n          .filter((f) => f);\n        const keysToIndex = columnsToIndex.filter((f) => f !== 'igoSearchID');\n        contentToIndex = keysToIndex.map((key) => {\n          return { field: key, tokenize: 'full' };\n        });\n      }\n    }\n    store.index.forEach((value, key) => {\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\n      columnsToNotIndex.map((c) => delete propertiesToIndex[c]);\n      if (Object.keys(propertiesToIndex).length) {\n        toIndex.push(propertiesToIndex);\n      }\n    });\n\n    if (toIndex.length === 0) {\n      this.initStoreSearchIndex(store);\n    } else {\n      store.searchDocument = new FlexSearchDocument({\n        document: {\n          id: 'igoSearchID',\n          index: contentToIndex\n        } as DocumentOptions<any>\n      });\n      toIndex.map((i) => {\n        store.searchDocument.add(i.igoSearchID, i);\n      });\n    }\n  }\n}\n","import { EntityKey, EntityStore, getEntityId } from '@igo2/common/entity';\n\nimport OlFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Document } from 'flexsearch';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap, MapExtent } from '../../map/shared';\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport {\n  computeOlFeaturesDiff,\n  computeOlFeaturesExtent,\n  featureFromOl,\n  featureToOl,\n  moveToOlFeatures\n} from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer\n      ? (this.layer.dataSource as FeatureDataSource)\n      : undefined;\n  }\n\n  /**\n   * The searchable index of loaded feature. Computed if strategy is provided\n   */\n  set searchDocument(v: Document<T>) {\n    this._searchDocument = v;\n  }\n\n  get searchDocument(): Document<T> {\n    return this._searchDocument;\n  }\n  private _searchDocument: Document<T>;\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features.map((feature: Feature) =>\n      featureToOl(feature, this.map.projection, getId)\n    );\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(\n        this.map.viewController,\n        diff.add,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(\n        this.map.viewController,\n        olFeatures,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    }\n  }\n\n  setLayerExtent(): void {\n    let features = this.entities$.getValue();\n    let extent = olextent.createEmpty() as MapExtent;\n    let olFeatures = [];\n\n    features.forEach((feature) => {\n      olFeatures.push(featureToOl(feature, this.map.projection));\n    });\n    const featuresExtent = computeOlFeaturesExtent(\n      olFeatures,\n      this.map.viewProjection\n    );\n    olextent.extend(extent, featuresExtent);\n    this.layer.setExtent(extent);\n  }\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport * as olextent from 'ol/extent';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime, skipWhile } from 'rxjs/operators';\n\nimport { MapExtent } from '../../../map/shared/map.interface';\nimport {\n  Feature,\n  FeatureStoreInMapExtentStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(\n      store.layer.map.viewController.state$\n        .pipe(debounceTime(250))\n        .subscribe(() => this.updateEntitiesInExtent(store))\n    );\n  }\n\n  private updateEntitiesInExtent(store: FeatureStore) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      const features = store.entities$.value;\n      const entitiesInMapExtent = this.getFeaturesInExtent(features, mapExtent);\n      store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n    }\n  }\n\n  private getFeaturesInExtent(\n    features: Feature<any>[],\n    extent: MapExtent\n  ): Feature[] {\n    return features.reduce((acc, feature) => {\n      const geom = feature.ol?.getGeometry();\n      if (geom) {\n        const featureExtent = geom.getExtent();\n\n        if (olextent.intersects(featureExtent, extent)) {\n          acc.push(feature);\n        }\n      } else {\n        // By default, keep entity with no geometry\n        acc.push(feature);\n      }\n      return acc;\n    }, []);\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common/entity';\n\nimport { Subscription } from 'rxjs';\n\nimport { FeatureMotion } from '../feature.enums';\nimport {\n  Feature,\n  FeatureStoreLoadingStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view\n      .all$()\n      .subscribe((features: Feature[]) =>\n        this.onFeaturesChange(features, store)\n      );\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, Subscription]) => {\n        entries[1].unsubscribe();\n      }\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) {\n      return this.motion;\n    }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import {\n  EntityKey,\n  EntityRecord,\n  EntityStoreStrategy\n} from '@igo2/common/entity';\n\nimport OlFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\nimport { FeatureMotion } from '../feature.enums';\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: (olLayer) => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer?.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map(\n      (olFeature: OlFeature<OlGeometry>) => olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","export enum OgcFilterOperatorType {\n  BasicNumericOperator = 'basicnumericoperator',\n  Basic = 'basic',\n  BasicAndSpatial = 'basicandspatial',\n  Spatial = 'spatial',\n  All = 'all',\n  Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n  BBOX = 'BBox',\n  PropertyIsBetween = 'PropertyIsBetween',\n  Contains = 'Contains',\n  During = 'During',\n  PropertyIsEqualTo = 'PropertyIsEqualTo',\n  PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n  PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n  Intersects = 'Intersects',\n  PropertyIsNull = 'PropertyIsNull',\n  PropertyIsLessThan = 'PropertyIsLessThan',\n  PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n  PropertyIsLike = 'PropertyIsLike',\n  PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n  Within = 'Within',\n  And = 'And',\n  Or = 'Or',\n  Not = 'Not'\n}\n","import { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { Extent } from 'ol/extent';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olFormatWKT from 'ol/format/WKT';\nimport * as olfilter from 'ol/format/filter';\nimport olGeometry from 'ol/geom/Geometry';\nimport olProjection from 'ol/proj/Projection';\n\nimport { default as moment } from 'moment';\n\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator, OgcFilterOperatorType } from './ogc-filter.enum';\nimport {\n  AnyBaseOgcFilterOptions,\n  IgoOgcFilterObject,\n  IgoOgcSelector,\n  OgcFilter,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions,\n  OgcSelectorBundle,\n  SelectorGroup\n} from './ogc-filter.interface';\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (\n      ogcFiltersOptions.enabled &&\n      (ogcFiltersOptions.pushButtons ||\n        ogcFiltersOptions.checkboxes ||\n        ogcFiltersOptions.radioButtons ||\n        ogcFiltersOptions.select ||\n        ogcFiltersOptions.autocomplete)\n    ) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: Extent,\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40 * -1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern\n            ? wfsPattern.replace(/[()_]/gi, wfsSingleChar)\n            : wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n        ? proj.getCode()\n        : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error('You must set an id for each of your bundles');\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: Extent,\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (\n      ogcFilters.enabled &&\n      (ogcFilters.pushButtons ||\n        ogcFilters.checkboxes ||\n        ogcFilters.radioButtons ||\n        ogcFilters.select ||\n        ogcFilters.autocomplete)\n    ) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach((bundle) => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce(\n          (list, filter, index) =>\n            filter.enabled === true ? list.concat(index) : list,\n          []\n        );\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach((index) => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(selectors);\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) =>\n          bundleCondition.push(enabledSelector.filters)\n        );\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n    if (!processedFilter) {\n      return undefined;\n    }\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (\n      value.toLowerCase().includes('now') ||\n      value.toLowerCase().includes('today')\n    ) {\n      return this.parseDateOperation(value);\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n  /**\n   * this function to parse date with specific format\n   * exemple 'today + 1 days' or 'now + 1 years'\n   * @param value string date\n   * @returns date\n   */\n  private parseDateOperation(value: string): string {\n    const operationSplitted = value.toLowerCase().split(' ');\n    const leftOperand = operationSplitted[0];\n    const operator = ['+', '-'].includes(operationSplitted[1])\n      ? operationSplitted[1]\n      : undefined;\n    const rightOperand = /^[0-9]*$/.test(operationSplitted[2])\n      ? operationSplitted[2]\n      : undefined;\n    const rightUnitOperand = (\n      ['years', 'months', 'weeks', 'days', 'hours', 'seconds'].includes(\n        operationSplitted[3]\n      )\n        ? operationSplitted[3]\n        : undefined\n    ) as moment.DurationInputArg2;\n\n    if (!operator || !rightUnitOperand || !rightOperand) {\n      return leftOperand === 'now'\n        ? moment().format()\n        : moment().endOf('day').format();\n    }\n\n    if (operator === '+') {\n      return leftOperand === 'now'\n        ? moment().add(parseInt(rightOperand, 10), rightUnitOperand).format()\n        : moment()\n            .endOf('day')\n            .add(parseInt(rightOperand, 10), rightUnitOperand)\n            .format();\n    } else {\n      return leftOperand === 'now'\n        ? moment()\n            .subtract(parseInt(rightOperand, 10), rightUnitOperand)\n            .format()\n        : moment()\n            .endOf('day')\n            .subtract(parseInt(rightOperand, 10), rightUnitOperand)\n            .format();\n    }\n  }\n}\n","export enum TimeFilterType {\n  DATE = 'date',\n  TIME = 'time',\n  DATETIME = 'datetime',\n  YEAR = 'year'\n}\n\nexport enum TimeFilterStyle {\n  CALENDAR = 'calendar',\n  SLIDER = 'slider'\n}\n","import OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport BasicEvent from 'ol/events/Event';\nimport { doubleClick } from 'ol/events/condition';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDraw from 'ol/interaction/Draw';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { BehaviorSubject, Subject, Subscription, fromEvent } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: Type | string;\n  drawingLayerSource?: OlVectorSource;\n  drawingLayer?: OlVectorLayer<OlVectorSource>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n  public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Observables from predefined radius (defaults to false and undefined)\n   */\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometry | undefined | string;\n  private olInteractionStyle: OlStyleLike;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n  public radius: number;\n\n  private mousePosition: [number, number];\n\n  /**\n   * take the value of radius\n   */\n  get radiusVal(): number {\n    return this.predefinedRadius$.getValue();\n  }\n  set radiusValData(radiusCercle: number) {\n    this.predefinedRadius$.next(radiusCercle);\n  }\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer\n      ? options.drawingLayer\n      : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n    this.olInteractionStyle = this.options.interactionStyle;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource {\n    return this.olDrawingLayerSource;\n  }\n\n  setOlInteractionStyle(style) {\n    this.olInteractionStyle = style;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: Type) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Get the current geometry type\n   */\n  getGeometryType() {\n    return this.olGeometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource\n        ? this.options.drawingLayerSource\n        : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      if (!this.ispredefinedRadius$.getValue()) {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: 'Point',\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      }\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          style:\n            typeof this.olInteractionStyle === 'function'\n              ? undefined\n              : this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n    this.onDrawStartKey = olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) =>\n      this.onDrawEnd(event)\n    );\n    this.onDrawAbortKey = olDrawInteraction.on(\n      'drawabort',\n      (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry())\n    );\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) =>\n          this.onSelect(event)\n        );\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([\n      this.onDrawStartKey,\n      this.onDrawEndKey,\n      this.onDrawKey,\n      this.onDrawAbortKey\n    ]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    if (event.feature.getGeometry().getType() === 'Point') {\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\n    }\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        // On Escape or 'c' keydowns, abort the current drawing\n        if (event.key === 'Escape') {\n          this.olDrawInteraction.abortDrawing();\n          return;\n        }\n\n        // On Backspace or 'u' keydowns, remove last vertex of current drawing\n        if (event.key === 'Backspace') {\n          this.olDrawInteraction.removeLastPoint();\n        }\n\n        // On Enter or 'f' keydowns, finish current drawing\n        if (event.key === 'Enter') {\n          this.olDrawInteraction.finishDrawing();\n        }\n\n        // On space bar key down, pan to the current mouse position\n        if (event.key === ' ') {\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 100\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport OlMap from 'ol/Map';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport BasicEvent from 'ol/events/Event';\nimport OlCircle from 'ol/geom/Circle';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport OlDraw from 'ol/interaction/Draw';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlModify from 'ol/interaction/Modify';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition =\n          getMousePositionFromOlGeometryEvent(olGeometryEvent);\n        this.changes$.next(\n          olGeometryEvent.target as OlLineString | OlCircle | OlPolygon\n        );\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = (\n      (olGeometry as any).getLinearRing() as any\n    ).getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n      const _linearRingCoordinates = olGeometryTarget\n        .getLinearRing(0)\n        .getCoordinates();\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n      this.changes$.next(this.getOlGeometry());\n    });\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = (\n      (event.feature.getGeometry() as any).getLinearRing() as any\n    ).getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super(\"Can't slice a MultiPolygon.\");\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super(\"Can't slice with a line that has more than 2 points.\");\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super(\n      'More than 2 intersections found between the target polygon and the slicing line.'\n    );\n    Object.setPrototypeOf(\n      this,\n      GeometrySliceTooManyIntersectionError.prototype\n    );\n  }\n}\n","import BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport * as olstyle from 'ol/style';\n\nimport { lineString } from '@turf/helpers';\nimport lineIntersect from '@turf/line-intersect';\n\nimport {\n  GeometrySliceLineStringError,\n  GeometrySliceMultiPolygonError,\n  GeometrySliceTooManyIntersectionError\n} from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(\n  color?: [number, number, number]\n): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(\n  olLineString: OlLineString,\n  olSlicer: OlLineString\n): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(\n  olPolygon: OlPolygon,\n  olSlicer: OlLineString\n): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(\n  olPolygon: OlPolygon,\n  olLinearRing: OlLinearRing\n) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(olEvent: BasicEvent) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","export const LAYER = 'Layer';\n","import { AnyLayerOptions } from '../shared/layers/any-layer.interface';\nimport { VectorTileLayerOptions } from '../shared/layers/vectortile-layer.interface';\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle ||\n      vectorTileLayerOptions.igoStyle?.hoverStyle)\n  ) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import { Injectable } from '@angular/core';\n\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, Subject, of } from 'rxjs';\nimport { concatMap, first } from 'rxjs/operators';\n\nimport { LayerDBData } from './layerDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerDBService {\n  readonly dbName: string = 'layerData';\n\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\n\n  /**\n   * This method allow to update the stored layer into the indexeddb (layerData)\n   * @param layerDBData\n   * @returns\n   */\n  update(layerDBData: LayerDBData): Observable<any> {\n    const subject: Subject<LayerDBData> = new Subject();\n    this.ngxIndexedDBService\n      .getByID(this.dbName, layerDBData.layerId)\n      .pipe(\n        first(),\n        concatMap((dbObject: LayerDBData) => {\n          if (!dbObject) {\n            return this.ngxIndexedDBService.add(this.dbName, layerDBData);\n          } else {\n            return this.customUpdate(layerDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\n    const subject: Subject<LayerDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      layerDBData.layerId\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, layerDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  /**\n   * This method retrieve an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getByID(layerId: string): Observable<LayerDBData> {\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\n  }\n\n  /**\n   * This method delete an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  deleteByKey(layerId: string): Observable<boolean> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\n  }\n\n  /**\n   * This method retrive all idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getAll(): Observable<LayerDBData[]> {\n    return this.ngxIndexedDBService.getAll(this.dbName);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable, Optional } from '@angular/core';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport { Style } from 'ol/style';\nimport * as olStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { stylefunction } from 'ol-mapbox-style';\nimport { Observable, combineLatest, of } from 'rxjs';\nimport { catchError, concatMap, map } from 'rxjs/operators';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\nimport {\n  ArcGISRestDataSource,\n  CartoDataSource,\n  ClusterDataSource,\n  FeatureDataSource,\n  ImageArcGISRestDataSource,\n  MVTDataSource,\n  OSMDataSource,\n  TileArcGISRestDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMSDataSource,\n  WMTSDataSource,\n  WebSocketDataSource,\n  XYZDataSource\n} from '../../datasource/shared/datasources';\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport {\n  AnyLayerOptions,\n  ImageLayer,\n  ImageLayerOptions,\n  Layer,\n  LayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetworkService: GeoNetworkService,\n    private messageService: MessageService,\n    private layerDBService: LayerDBService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(\n    _layerOptions: AnyLayerOptions,\n    detailedContextUri?: string\n  ): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable((d) => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map((source) => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\n    let igoLayer: VectorLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'clusterBaseStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n    if (\n      layerOptions.igoStyle.igoStyleObject &&\n      !layerOptions.idbInfo?.storeToIdb\n    ) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    } else if (\n      layerOptions.igoStyle.igoStyleObject &&\n      layerOptions.idbInfo?.storeToIdb\n    ) {\n      // temporary fix todo : handle it with geostyler.\n      style = this.styleService.parseStyle(\n        'style',\n        layerOptions.igoStyle.igoStyleObject\n      );\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\n    legacyStyleOptions.map((legacyOption) => {\n      if (layerOptions[legacyOption]) {\n        let newKey = legacyOption;\n        if (legacyOption === 'style') {\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\n            return;\n          }\n          if (typeof layerOptions[legacyOption] === 'object') {\n            newKey = 'igoStyleObject';\n          } else {\n            return;\n          }\n        }\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\n        delete layerOptions[legacyOption];\n        console.warn(`\n        The location of this style option (${legacyOption}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `);\n      }\n    });\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n\n    if (layerOptions.igoStyle.igoStyleObject) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    }\n\n    if (layerOptions.igoStyle.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.igoStyle?.mapboxStyle) {\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe((res) => {\n        if (res.sprite) {\n          const url = this.getAbsoluteUrl(\n            layerOptions.igoStyle.mapboxStyle.url,\n            res.sprite\n          );\n          this.getStuff(url + '.json').subscribe((res2) => {\n            stylefunction(\n              layer.ol as olLayerVectorTile,\n              res,\n              layerOptions.igoStyle.mapboxStyle.source,\n              undefined,\n              res2,\n              url + '.png'\n            );\n          });\n        } else {\n          stylefunction(\n            layer.ol as olLayerVectorTile,\n            res,\n            layerOptions.igoStyle.mapboxStyle.source\n          );\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|//', 'i');\n    if (r.test(url)) {\n      return url;\n    } else {\n      if (source.substr(source.length - 1) === '/') {\n        return source + url;\n      } else {\n        return source + '/' + url;\n      }\n    }\n  }\n\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\n    return this.layerDBService.getAll().pipe(\n      concatMap((res) => {\n        const idbLayers =\n          contextUri !== '*'\n            ? res.filter((l) => l.detailedContextUri === contextUri)\n            : res;\n        const layersOptions: LayerOptions[] = idbLayers.map((idbl) =>\n          Object.assign({}, idbl.layerOptions, {\n            sourceOptions: idbl.sourceOptions\n          })\n        );\n        return combineLatest(\n          layersOptions.map((layerOptions) =>\n            this.createAsyncLayer(layerOptions)\n          )\n        );\n      })\n    );\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ImageWatcher } from '../../utils/image-watcher';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { Layer } from './layer';\n\nexport class ImageLayer extends Layer {\n  public declare dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public declare options: ImageLayerOptions;\n  public declare ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe((valStatus) => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(\n    tile,\n    src: string,\n    interceptor: AuthInterceptor,\n    messageService: MessageService\n  ) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function () {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(\n          'igo.geo.dataSource.optionsApiUnavailable',\n          'igo.geo.dataSource.unavailableTitle'\n        );\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport Tile from 'ol/Tile';\nimport olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\n\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { TileWatcher } from '../../utils/tile-watcher';\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nexport class TileLayer extends Layer {\n  public declare dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public declare options: TileLayerOptions;\n  public declare ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor) {\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\n\nimport VectorTile from 'ol/VectorTile';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { TileWatcher } from '../../utils/tile-watcher';\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\n\nexport class VectorTileLayer extends Layer {\n  public declare dataSource: MVTDataSource;\n  public declare options: VectorTileLayerOptions;\n  public declare ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(\n        url,\n        tile.getFormat(),\n        this.authInterceptor,\n        tile.onLoad.bind(tile)\n      );\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    });\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return (extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open('GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(\n              this,\n              format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              }),\n              format.readProjection(source)\n            );\n          } else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    };\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { Message } from '@igo2/core/message';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { MapExtent } from '../../../map/shared/map.interface';\nimport { LegendOptions } from './legend.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  security?: LayerSecurityOptions;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n  showButtonZoomToExtent?: boolean;\n}\n\nexport interface LayerSecurityOptions {\n  profils?: string[];\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n  searchIndexEnabled?: boolean;\n  printable?: boolean;\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  /** Default value is true */\n  showInMiniBaseMap?: boolean;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { Message, MessageService } from '@igo2/core/message';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { Legend } from '../../../datasource/shared/datasources/datasource.interface';\nimport type { MapBase } from '../../../map/shared/map.abstract';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport { LayerOptions } from './layer.interface';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: MapBase;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value) {\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter((m) => m.options?.showOnEachLayerVisibility)\n        .map((message) => this.showMessage(message));\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor,\n    protected geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution =\n      options.maxResolution ||\n      getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution =\n      options.minResolution ||\n      getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(map: MapBase | undefined) {\n    this.map = map;\n\n    this.unobserveResolution();\n    if (map !== undefined) {\n      this.observeResolution();\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map((message) => {\n            this.showMessage(message);\n          });\n        }\n      });\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution =\n        this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange =\n        resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport OlFeature from 'ol/Feature';\nimport { unByKey } from 'ol/Observable';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { easeOut } from 'ol/easing';\nimport BaseEvent from 'ol/events/Event';\nimport { Extent } from 'ol/extent';\nimport { FeatureLoader } from 'ol/featureloader';\nimport * as olformat from 'ol/format';\nimport olLayerVector from 'ol/layer/Vector';\nimport * as olproj from 'ol/proj';\nimport olProjection from 'ol/proj/Projection';\nimport { getVectorContext } from 'ol/render';\nimport olSourceVector from 'ol/source/Vector';\n\nimport { fromEvent, of, zip } from 'rxjs';\nimport {\n  catchError,\n  concatMap,\n  debounceTime,\n  delay,\n  first\n} from 'rxjs/operators';\n\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  buildUrl,\n  defaultMaxFeatures\n} from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map/shared';\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBData } from '../../../offline/layerDB/layerDB.interface';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport {\n  GeoNetworkService,\n  SimpleGetOptions\n} from '../../../offline/shared/geo-network.service';\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\nimport { VectorWatcher } from '../../utils/vector-watcher';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\n\nexport class VectorLayer extends Layer {\n  private previousLoadExtent: Extent;\n  private previousLoadResolution: number;\n  private previousOgcFilters: OgcFiltersOptions;\n  private xhrAccumulator: XMLHttpRequest[] = [];\n  public declare dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public declare options: VectorLayerOptions;\n  public declare ol: olLayerVector<olSourceVector>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    public geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    super(\n      options,\n      messageService,\n      authInterceptor,\n      geoDBService,\n      layerDBService\n    );\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector> {\n    const initialOpacityValue = this.options.opacity || 1;\n    const initialVisibleValue = this.options.visible !== false;\n    const initialMinResValue =\n      this.options.minResolution ||\n      getResolutionFromScale(Number(this.options.minScaleDenom));\n    const initialMaxResValue =\n      this.options.maxResolution ||\n      getResolutionFromScale(Number(this.options.maxScaleDenom));\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\n    if (this.dataSource instanceof FeatureDataSource) {\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\n        this.options.opacity = 0;\n        if (\n          so.preload.bypassResolution &&\n          (this.options.minResolution || this.options.maxResolution)\n        ) {\n          this.options.minResolution = 0;\n          this.options.maxResolution = Infinity;\n        }\n        if (so.preload.bypassVisible && !initialVisibleValue) {\n          this.options.visible = true;\n        }\n      }\n    }\n\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector,\n      sourceOptions: this.options.sourceOptions || this.options.source.options\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function (e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      if (this.options.idbInfo.firstLoad) {\n        this.maintainFeaturesInIdb();\n      }\n      this.dataSource.ol.once('featuresloadend', () => {\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('changefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('removefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n      });\n    }\n\n    if (\n      this.dataSource instanceof FeatureDataSource &&\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)\n    ) {\n      this.dataSource.ol.once('featuresloadend', () => {\n        if (initialOpacityValue) {\n          this.opacity = initialOpacityValue;\n        }\n        if (so.preload.bypassResolution) {\n          this.minResolution = initialMinResValue;\n          this.maxResolution = initialMaxResValue;\n        }\n        if (so.preload.bypassVisible) {\n          this.visible = initialVisibleValue;\n        }\n      });\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector;\n    const url = vectorSource.getUrl();\n    if (typeof url === 'function') {\n      return vector;\n    }\n    if (url || olOptions.sourceOptions?.type === 'wfs') {\n      let loader: FeatureLoader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (\n        wfsOptions?.type === 'wfs' &&\n        (wfsOptions.params || wfsOptions.paramsWFS)\n      ) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      const idbLoader = (extent, resolution, proj, success, failure) => {\n        this.customIDBLoader(\n          vectorSource,\n          olOptions.id,\n          extent,\n          proj,\n          success,\n          failure\n        );\n      };\n      if (idbLoader) {\n        vectorSource.setLoader(idbLoader);\n      }\n    }\n\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      vector.once('sourceready', () => {\n        if (this.options.idbInfo.firstLoad) {\n          this.maintainOptionsInIdb();\n        }\n        fromEvent<BaseEvent>(vector, 'change')\n          .pipe(debounceTime(750))\n          .subscribe(() => this.maintainOptionsInIdb());\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\n      });\n    }\n    return vector;\n  }\n\n  removeLayerFromIDB() {\n    if (this.geoDBService && this.layerDBService) {\n      zip(\n        this.geoDBService.deleteByKey(this.id),\n        this.layerDBService.deleteByKey(this.id)\n      ).subscribe();\n    }\n  }\n\n  private maintainOptionsInIdb() {\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\n      layerId: this.id,\n      detailedContextUri: this.options.idbInfo.contextUri,\n      sourceOptions: {\n        id: this.id,\n        type: 'vector',\n        queryable: true\n      },\n      layerOptions: {\n        workspace: this.options.workspace,\n        zIndex: this.ol ? this.zIndex : 1000000,\n        id: this.id,\n        isIgoInternalLayer: this.isIgoInternalLayer,\n        title: this.title,\n        igoStyle: this.options.igoStyle,\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\n      },\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\n    });\n    this.layerDBService.update(layerData);\n  }\n\n  private maintainFeaturesInIdb() {\n    const dsFeatures = this.dataSource.ol.getFeatures();\n    const geojsonObject = JSON.parse(\n      new olformat.GeoJSON().writeFeatures(dsFeatures, {\n        dataProjection: 'EPSG:4326',\n        featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\n      })\n    );\n    this.geoDBService.update(\n      this.id,\n      this.id,\n      geojsonObject,\n      InsertSourceInsertDBEnum.User,\n      `${this.title}-${this.id}-${new Date()}`\n    );\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if (\n            styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'\n          ) {\n            const radius =\n              easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public setExtent(extent: MapExtent): void {\n    this.options.extent = extent;\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function (e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol\n        .getView()\n        .setCenter((feat.getGeometry() as any).getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource: olSourceVector,\n    options: WFSDataSourceOptions,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    resolution: number,\n    proj: olProjection,\n    success: (features: olFeature[]) => void,\n    failure: () => void,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName\n        ? new olProjection({ code: paramsWFS.srsName })\n        : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      const ogcFilters = (options as OgcFilterableDataSourceOptions).ogcFilters;\n\n      if (\n        (this.previousLoadExtent &&\n          this.previousLoadExtent !== currentExtent) ||\n        (this.previousLoadResolution &&\n          this.previousLoadResolution !== resolution) ||\n        (this.previousOgcFilters && this.previousOgcFilters !== ogcFilters)\n      ) {\n        vectorSource.removeLoadedExtent(this.previousLoadExtent);\n        for (let xhr of this.xhrAccumulator) {\n          xhr.abort();\n        }\n      }\n\n      this.previousLoadExtent = currentExtent;\n      this.previousLoadResolution = resolution;\n      this.previousOgcFilters = ogcFilters;\n\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        ogcFilters,\n        randomParam\n      );\n      let startIndex = 0;\n      if (\n        paramsWFS.version === '2.0.0' &&\n        paramsWFS.maxFeatures > defaultMaxFeatures\n      ) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace(\n            'count=' + paramsWFS.maxFeatures,\n            'count=' + nbOfFeature\n          );\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(\n            vectorSource,\n            interceptor,\n            currentExtent,\n            wfsProj,\n            proj,\n            alteredUrl,\n            success,\n            failure\n          );\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(\n          vectorSource,\n          interceptor,\n          currentExtent,\n          wfsProj,\n          proj,\n          url,\n          success,\n          failure\n        );\n      }\n    }\n  }\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    dataProjection: olProjection,\n    featureProjection: olProjection,\n    url: string,\n    success: (features: olFeature[]) => void,\n    failure: () => void\n  ) {\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features = vectorSource\n          .getFormat()\n          .readFeatures(xhr.responseText, {\n            dataProjection,\n            featureProjection\n          }) as olFeature[];\n        if (features) {\n          vectorSource.addFeatures(features);\n          success(features);\n        } else {\n          success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    this.xhrAccumulator.push(xhr);\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource: olSourceVector,\n    url: string,\n    interceptor: AuthInterceptor,\n    extent: Extent,\n    resolution: number,\n    projection: olProjection,\n    success: (features: olFeature[]) => void,\n    failure: () => void\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService\n        .get(url)\n        .pipe(delay(750))\n        .pipe(\n          concatMap((r) =>\n            r\n              ? of(r)\n              : this.geoNetworkService.get(modifiedUrl as string, options).pipe(\n                  first(),\n                  catchError((res) => {\n                    onError();\n                    throw res;\n                  })\n                )\n          )\n        )\n        .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              }) as OlFeature[];\n              vectorSource.addFeatures(features);\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n    } else {\n      xhr.open('GET', modifiedUrl as string);\n      const format = vectorSource.getFormat();\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl as string);\n      }\n\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      xhr.onerror = onError;\n      xhr.onload = () => {\n        // status will be 0 for file:// urls\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }) as OlFeature[];\n            vectorSource.addFeatures(features);\n            success(features);\n          } else {\n            onError();\n          }\n        } else {\n          onError();\n        }\n      };\n      xhr.send();\n    }\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param layerID the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customIDBLoader(\n    vectorSource,\n    layerID,\n    extent,\n    projection,\n    success,\n    failure\n  ) {\n    if (this.geoNetworkService) {\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      this.geoNetworkService.geoDBService.get(layerID).subscribe((content) => {\n        if (content) {\n          const format = vectorSource.getFormat();\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = content;\n          } else if (type === 'xml') {\n            source = content;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                content,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = content;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            });\n            vectorSource.addFeatures(features, format.readProjection(source));\n            success(features);\n          } else {\n            onError();\n          }\n        }\n      });\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\n\nexport function olStyleToBasicIgoStyle(layer: olLayerVector<olSourceVector>) {\n  const layerOlStyle = layer.getStyle();\n  if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\n    return;\n  }\n\n  const rStyle = {\n    fill: {\n      color: layerOlStyle.getFill().getColor()\n    },\n    stroke: {\n      color: layerOlStyle.getStroke().getColor(),\n      width: 2\n    },\n    circle: {\n      fill: {\n        color: (layerOlStyle.getImage() as any).getFill().getColor()\n      },\n      stroke: {\n        color: (layerOlStyle.getImage() as any).getStroke().getColor(),\n        width: 2\n      },\n      radius: 5\n    }\n  };\n  return rStyle;\n}\n","import { MessageService } from '@igo2/core/message';\nimport { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport olSourceImage from 'ol/source/Image';\n\nimport type { ImageLayer } from '../shared/layers/image-layer';\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n    this.messageService.error(\n      'igo.geo.dataSource.unavailable',\n      'igo.geo.dataSource.unavailableTitle',\n      undefined,\n      { value: event.target.params_.LAYERS }\n    );\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n  }\n}\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport olSourceTile from 'ol/source/Tile';\n\nimport type { TileLayer } from '../shared/layers/tile-layer';\nimport type { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { SubjectStatus, Watcher, uuid } from '@igo2/utils';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport type { VectorLayer } from '../shared/layers/vector-layer';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '80px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","<div\n  *ngIf=\"baseLayers.length > 0\"\n  class=\"igo-baselayers-switcher-container\"\n  [ngClass]=\"{ 'container-expand': expand }\"\n  [@baseLayerSwitcherState]=\"\n    expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\n  \"\n  (@baseLayerSwitcherState.start)=\"showButton = false\"\n  (@baseLayerSwitcherState.done)=\"showButton = true\"\n  (click)=\"collapseOrExpand()\"\n>\n  <div\n    *ngIf=\"useStaticIcon && !expand && showButton\"\n    class=\"igo-baselayers-switcher-button-container\"\n  >\n    <button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n      matTooltipPosition=\"right\"\n      color=\"primary\"\n    >\n      <mat-icon>photo_library</mat-icon>\n    </button>\n  </div>\n\n  <div class=\"basemap-list\">\n    <igo-mini-basemap\n      *ngFor=\"let baseLayer of baseLayers; let i = index\"\n      [map]=\"map\"\n      [baseLayer]=\"baseLayer\"\n      [title]=\"\n        baseLayers.length > 2 && !expand\n          ? ('igo.geo.baselayersSwitcher.title' | translate)\n          : baseLayer.title\n      \"\n      [display]=\"expand || (i === 0 && !useStaticIcon)\"\n      [disabled]=\"!expand && baseLayers.length > 1\"\n    >\n    </igo-mini-basemap>\n  </div>\n\n  <div *ngIf=\"hasMoreThanTwo\" class=\"more-baselayers\">\n    <mat-icon class=\"material-icons mat-icon\" color=\"primary\"\n      >arrow_drop_down</mat-icon\n    >\n  </div>\n</div>\n","import { NgClass, NgFor, NgIf } from '@angular/common';\nimport { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport { Subscription } from 'rxjs';\n\nimport { Layer } from '../../layer/shared';\nimport { IgoMap } from '../shared/map';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\nimport { MiniBaseMapComponent } from './mini-basemap.component';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()],\n  standalone: true,\n  imports: [\n    NgIf,\n    NgClass,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    NgFor,\n    MiniBaseMapComponent,\n    IgoLanguageModule\n  ]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  get hasMoreThanTwo(): boolean {\n    return this.baseLayers.length > 1;\n  }\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe((arrayLayers) => {\n      this._baseLayers = arrayLayers.filter((l) => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.hasMoreThanTwo || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter((l) => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution ||\n          mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom ||\n          mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom ||\n          mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter((l) => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","<div class=\"igo-mini-basemap-container\">\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf=\"title\" class=\"igo-mini-basemap-title\">{{ title }}</div>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy\n} from '@angular/core';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\nimport {\n  Layer,\n  LayerOptions,\n  LayersLink,\n  LayersLinkProperties\n} from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, MapBrowserComponent]\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() title: string;\n\n  @Input()\n  get display(): boolean {\n    return this._display;\n  }\n  set display(value: boolean) {\n    this._display = value;\n    this.basemap.ol.getView().changed();\n  }\n  private _display: boolean;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) {}\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', (change) => {\n      this.handleMainMapViewChange(change.target as OlView);\n    });\n    this.map.ol.on('pointerdrag', (change) => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', (change) => {\n      this.handleMainMapViewChange(change.target as OlView);\n    });\n    this.map.ol.un('pointerdrag', (change) => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(\n      mainMapViewProperties.resolution\n    );\n    this.basemap.viewController.olView.setRotation(\n      mainMapViewProperties.rotation\n    );\n    this.basemap.viewController.olView.setCenter(\n      this.map.viewController.getCenter()\n    );\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer): void {\n    const linkedLayers: LayersLink = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const links: LayersLinkProperties[] = linkedLayers.links;\n    const isParentLayer: boolean = links ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      links.map((link: LayersLinkProperties) => {\n        link.linkedIds.map((linkedId: string) => {\n          const layerToApply: Layer = this.map.layers.find(\n            (layer: Layer) => layer.options.linkedLayers?.linkId === linkedId\n          );\n          if (layerToApply) {\n            const linkedLayerOptions: LayerOptions = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible:\n                  layerToApply.options.linkedLayers?.showInMiniBaseMap ?? true,\n                baseLayer: false\n              } as LayerOptions\n            );\n            this.basemap.addLayer(\n              this.layerService.createLayer(linkedLayerOptions)\n            );\n          }\n        });\n      });\n    }\n  }\n}\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      map.geolocationController.tracking\n        ? ('igo.geo.mapButtons.geolocateInactive' | translate)\n        : ('igo.geo.mapButtons.geolocate' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\"\n  >\n    <mat-icon>{{ icon$ | async }}</mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('my_location');\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor(private configService: ConfigService) {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ = this.map.geolocationController.tracking$.subscribe(\n        (tracking) => {\n          if (tracking) {\n            this.icon$.next('my_location');\n          } else {\n            this.configService.getConfig('geolocate.basic')\n              ? this.icon$.next('my_location')\n              : this.icon$.next('location_searching');\n          }\n        }\n      );\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olproj from 'ol/proj';\n\nimport { IgoMap } from '../shared/map';\nimport { MapExtent } from '../shared/map.interface';\nimport { HomeExtentButtonOptions } from './home-extent-button.interface';\n\n/*\nButton to center the map to the home extent\n*/\n@Component({\n  selector: 'igo-home-extent-button',\n  templateUrl: './home-extent-button.component.html',\n  styleUrls: ['./home-extent-button.component.scss'],\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class HomeExtentButtonComponent {\n  @Input() map: IgoMap;\n  @Input() color: string;\n  @Input() extentOverride?: MapExtent;\n  @Input() centerOverride?: [number, number];\n  @Input() zoomOverride?: number;\n\n  private homeExtentButtonExtent;\n  private homeExtentButtonCenter;\n  private homeExtentButtonZoom;\n\n  constructor(public configService: ConfigService) {\n    this.computeHomeExtent();\n  }\n\n  computeHomeExtent() {\n    const homeExtentButtonOptions: HomeExtentButtonOptions =\n      this.configService.getConfig('homeExtentButton');\n\n    this.homeExtentButtonExtent =\n      this.extentOverride || homeExtentButtonOptions?.homeExtButtonExtent;\n    this.homeExtentButtonCenter =\n      this.centerOverride || homeExtentButtonOptions?.homeExtButtonCenter;\n    this.homeExtentButtonZoom =\n      this.zoomOverride || homeExtentButtonOptions?.homeExtButtonZoom;\n\n    // priority over extent if these 2 properties are defined;\n    if (this.centerOverride && this.zoomOverride) {\n      this.homeExtentButtonExtent = undefined;\n    }\n  }\n\n  onToggleClick() {\n    this.computeHomeExtent();\n    if (this.homeExtentButtonExtent) {\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\n      const center = olproj.fromLonLat(\n        this.homeExtentButtonCenter,\n        this.map.viewController.olView.getProjection().getCode()\n      );\n      this.map.viewController.olView.setCenter(center);\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\n    }\n  }\n}\n","<div class=\"igo-home-extent-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onToggleClick()\"\n  >\n    <mat-icon>home</mat-icon>\n  </button>\n</div>\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n  <pre>{{ infoContent }}</pre>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss'],\n  standalone: true,\n  imports: [NgIf]\n})\nexport class InfoSectionComponent {\n  @Input() infoContent: string = '';\n\n  constructor() {}\n}\n","import {\n  AfterViewInit,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { ActivityService } from '@igo2/core/activity';\nimport { SubjectStatus, uuid } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss'],\n  standalone: true\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${uuid()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe((status) =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n/**\n * Tool to display the center of the map\n */\n@Component({\n  selector: 'igo-map-center',\n  templateUrl: './map-center.component.html',\n  styleUrls: ['./map-center.component.scss'],\n  standalone: true\n})\nexport class MapCenterComponent implements AfterViewInit, OnDestroy {\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private displayCenter$$: Subscription;\n  constructor() {}\n\n  /**\n   * Set a visibility for cursor of the center of the map\n   */\n  ngAfterViewInit() {\n    if (this.map) {\n      this.displayCenter$$ = this.map.mapCenter$.subscribe((value) => {\n        value\n          ? (document.getElementById('mapCenter').style.visibility = 'visible')\n          : (document.getElementById('mapCenter').style.visibility = 'hidden');\n      });\n    }\n    this.letZoom();\n  }\n\n  /**\n   * Destroyer of a component\n   */\n  ngOnDestroy() {\n    if (this.displayCenter$$) {\n      this.displayCenter$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('mapCenter').addEventListener(\n      'wheel',\n      (event) => {\n        event.deltaY > 0\n          ? this.map.viewController.zoomOut()\n          : this.map.viewController.zoomIn();\n      },\n      true\n    );\n  }\n}\n","<div class=\"mapCenter\" id=\"mapCenter\">\n  <div class=\"vertical\"></div>\n  <div class=\"horizontal\"></div>\n</div>\n","import { NgClass } from '@angular/common';\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-menu-button',\n  templateUrl: './menu-button.component.html',\n  styleUrls: ['./menu-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    NgClass,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class MenuButtonComponent {\n  @Input()\n  get sidenavOpened(): boolean {\n    return this._sidenavOpenend;\n  }\n  set sidenavOpened(value: boolean) {\n    this._sidenavOpenend = value;\n    this.getClassMenuButton();\n  }\n  private _sidenavOpenend: boolean;\n\n  @Output() openSidenav = new EventEmitter<any>();\n\n  public useThemeColor: boolean;\n\n  public menuButtonClass;\n\n  constructor(public configService: ConfigService) {\n    const configValue = this.configService.getConfig(\n      'menu.button.useThemeColor'\n    );\n    this.useThemeColor = configValue !== undefined ? configValue : false;\n  }\n\n  getClassMenuButton() {\n    this.menuButtonClass = {\n      'menu-button-white-background': !this.useThemeColor\n    };\n  }\n\n  onToggleSidenavClick() {\n    this.openSidenav.emit();\n  }\n}\n","<button\n  mat-icon-button\n  id=\"menu-button\"\n  [ngClass]=\"menuButtonClass\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(sidenavOpened ? 'menu.close' : 'menu.open') | translate\"\n  (click)=\"onToggleSidenavClick()\"\n>\n  <mat-icon>menu</mat-icon>\n</button>\n","import { NgClass } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-offline-button',\n  templateUrl: './offline-button.component.html',\n  styleUrls: ['./offline-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    NgClass,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class OfflineButtonComponent implements OnInit {\n  btnStyle: string = 'onlineStyle';\n\n  @Input() map: IgoMap;\n  @Input() color: string;\n  @Input() enabled: boolean = false;\n\n  constructor() {}\n\n  ngOnInit(): void {\n    this.map.forcedOffline$.next(this.enabled);\n  }\n\n  onClick() {\n    this.enabled = !this.enabled;\n    this.handleButtonStyle();\n    this.map.forcedOffline$.next(this.enabled);\n  }\n\n  private handleButtonStyle() {\n    if (this.enabled) {\n      this.btnStyle = 'offlineStyle';\n    } else {\n      this.btnStyle = 'onlineStyle';\n    }\n  }\n}\n","<div class=\"igo-user-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.online' | translate)\n        : ('igo.geo.mapButtons.offline' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [ngClass]=\"[btnStyle]\"\n    [color]=\"enabled ? color : null\"\n    (click)=\"onClick()\"\n  >\n    <mat-icon>wifi_off</mat-icon>\n  </button>\n</div>\n","<div\n  *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\"\n  class=\"igo-rotation-button-container\"\n  [matTooltip]=\"\n    (rotated$ | async)\n      ? ('igo.geo.mapButtons.resetRotation'\n        | translate: { azimuth: azimuthRounded, rotation: rotationRounded })\n      : ('igo.geo.mapButtons.tipRotation' | translate)\n  \"\n  matTooltipPosition=\"left\"\n>\n  <button\n    mat-icon-button\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\"\n  >\n    <mat-icon [ngStyle]=\"currentStyle$ | async\">navigation </mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgIf, NgStyle } from '@angular/common';\nimport { AfterContentInit, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { bearingToAzimuth } from '@turf/helpers';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    NgStyle,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class RotationButtonComponent implements AfterContentInit {\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\n  public azimuthRounded: number = 0;\n  public rotationRounded: number = 0;\n  readonly currentStyle$ = new BehaviorSubject<{}>({\n    transform: 'rotate(0rad)'\n  });\n\n  @Input() map: IgoMap;\n  @Input() showIfNoRotation: boolean;\n  @Input() color: string;\n\n  constructor() {}\n\n  ngAfterContentInit() {\n    this.map.viewController.rotation$.subscribe((r) => {\n      const radians = r || 0;\n      const deg = (radians * 180) / Math.PI;\n      this.rotationRounded = Math.round(deg);\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\n      this.currentStyle$.next({\n        transform: 'rotate(' + radians + 'rad)'\n      });\n      this.rotated$.next(radians !== 0);\n    });\n  }\n}\n","import OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\n\n/**\n * Base map controller\n */\nexport class MapController {\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n}\n","import { ProjectionLike } from 'ol/proj';\n\nexport interface GeolocationOptions {\n  activateDefault?: boolean;\n  basic?: boolean; // to control the button icon.\n  followPosition?: boolean; // to overide the followPosition define at the context level.\n  button?: {\n    visible: boolean;\n  };\n}\n\nexport interface MapGeolocationControllerOptions {\n  projection: ProjectionLike;\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\n\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\nexport enum GeolocationOverlayType {\n  Position = 'position',\n  PositionDirection = 'positionDirection',\n  Accuracy = 'accuracy',\n  Buffer = 'buffer'\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport olFeature from 'ol/Feature';\nimport olGeolocation from 'ol/Geolocation';\nimport OlMap from 'ol/Map';\nimport { Point, Polygon } from 'ol/geom';\nimport OlCircle from 'ol/geom/Circle';\nimport Geometry from 'ol/geom/Geometry';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\nimport * as olSphere from 'ol/sphere';\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription, interval } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport {\n  computeOlFeaturesExtent,\n  featuresAreOutOfView,\n  hideOlFeature,\n  moveToOlFeatures\n} from '../../../feature/shared/feature.utils';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport type { MapBase } from '../map.abstract';\nimport { MapViewOptions } from '../map.interface';\nimport { MapController } from './controller';\nimport {\n  GeolocationBuffer,\n  GeolocationOverlayType,\n  MapGeolocationControllerOptions,\n  MapGeolocationState\n} from './geolocation.interface';\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n  private arrowRotation: number;\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      image: new olstyle.Circle({\n        radius: 6,\n        fill: new olstyle.Fill({\n          color: '#3399CC'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 2\n        })\n      })\n    });\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      stroke: new olstyle.Stroke({\n        color: 'rgba(120, 120, 120, 0.4)',\n        width: 1\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(120, 120, 120, 0.4)'\n      })\n    });\n\n  private get bufferStyle(): olstyle.Style {\n    return new olstyle.Style({\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n      text: new olstyle.Text({\n        textAlign: 'left',\n        offsetX: 10,\n        offsetY: -10,\n        font: '12px Calibri,sans-serif',\n        text: this.buffer.showBufferRadius\n          ? `${this.buffer.bufferRadius}m`\n          : '',\n        fill: new olstyle.Fill({ color: '#000' }),\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n      })\n    });\n  }\n\n  private get arrowStyle(): olstyle.Style {\n    return new olstyle.Style({\n      image: new olstyle.RegularShape({\n        radius: 5.5,\n        fill: new olstyle.Fill({\n          color: 'rgba(0, 132, 202)'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 1.5\n        }),\n        points: 3,\n        displacement: [0, 9],\n        rotation: this.arrowRotation,\n        rotateWithView: true\n      })\n    });\n  }\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> =\n    new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(\n    undefined\n  );\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n  private lastPosition: { coordinates: number[]; dateTime: Date };\n\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n  set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n  get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold;\n\n  get olGeolocation() {\n    return this.geolocation;\n  }\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n  /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n  private _followPosition;\n\n  constructor(\n    private map: MapBase,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n    this._followPosition =\n      this.options && this.options.followPosition\n        ? this.options.followPosition\n        : false;\n\n    this._buffer =\n      this.options && this.options.buffer ? this.options.buffer : undefined;\n    this._accuracyThreshold =\n      this.options && this.options.accuracyThreshold\n        ? this.options.accuracyThreshold\n        : 5000;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe((tracking) => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection\n    });\n    let tracking = false;\n    this.subscriptions$$.push(\n      this.emissionIntervalSeconds$\n        .pipe(switchMap((value) => interval(value * 1000)))\n        .subscribe(() => {\n          if (tracking === this.tracking) {\n            this.onPositionChange(true);\n          } else {\n            tracking = this.tracking;\n            this.onPositionChange(true, true);\n          }\n        })\n    );\n\n    this.geolocation.on('change', (evt) => {\n      this.onPositionChange(false, false);\n    });\n  }\n\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\n    const position4326 = olproj.transform(\n      position.position,\n      position.projection,\n      'EPSG:4326'\n    );\n    if (!this.lastPosition) {\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n      return;\n    }\n    const arrowFeature = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    const isMoving =\n      position?.speed > 1.25 &&\n      this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) >\n        0.003;\n    if (position.accuracy <= this.accuracyThreshold && isMoving) {\n      // Calculate the heading using current position and last recorded\n      // because ol heading not returning right value\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\n      var theta = Math.atan2(dy, dx);\n      if (theta < 0) theta = 2 * Math.PI + theta;\n      this.arrowRotation = theta;\n      if (arrowFeature) {\n        arrowFeature.setStyle(this.arrowStyle);\n      }\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n    } else {\n      if (\n        arrowFeature &&\n        new Date().getTime() - this.lastPosition.dateTime.getTime() > 3000\n      )\n        hideOlFeature(arrowFeature);\n    }\n  }\n\n  /**\n   * @returns distance in km between coord1 and coord2\n   */\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number {\n    return olSphere.getDistance(coord1, coord2) / 1000;\n  }\n\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\n    let listener = () => {\n      event(this.geolocation);\n    };\n    this.geolocation.on('change', listener);\n    return listener;\n  }\n\n  public deleteChangedListener(event: () => any) {\n    this.geolocation.un('change', event);\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) {\n      return;\n    }\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get(\n        'geolocation.tracking'\n      ) as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get(\n        'geolocation.followPosition'\n      ) as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map((s) => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(\n    emitEvent: boolean = false,\n    zoomTo: boolean = false\n  ) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions\n        ?.enableHighAccuracy\n        ? true\n        : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position);\n    this.handleViewFromFeatures(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n    }\n  }\n\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById =\n      this.geolocationOverlay?.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState) {\n    if (!position || !position.position) {\n      return;\n    }\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(\n      new OlCircle(position.position, position.accuracy || 0)\n    );\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    const positionFeatureExists = positionFeature ? true : false;\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\n    const accuracyFeatureExists = accuracyFeature ? true : false;\n    if (!positionFeatureArrowExists) {\n      positionFeatureArrow = new olFeature<Point>({\n        geometry: positionGeometry\n      });\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\n      hideOlFeature(positionFeatureArrow);\n    }\n    if (!positionFeatureExists) {\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n    }\n    if (!accuracyFeatureExists) {\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\n    }\n\n    if (positionGeometry) {\n      positionFeatureExists\n        ? positionFeature.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeature,\n            FeatureMotion.None\n          );\n      positionFeatureArrowExists\n        ? positionFeatureArrow.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeatureArrow,\n            FeatureMotion.None\n          );\n      this.updateArrowFeatureOrientation(position);\n      accuracyFeatureExists\n        ? accuracyFeature.setGeometry(accuracyGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            accuracyFeature,\n            FeatureMotion.None\n          );\n\n      if (this.buffer) {\n        let bufferFeature = this.getFeatureByType(\n          GeolocationOverlayType.Buffer\n        );\n        const bufferFeatureExists = bufferFeature ? true : false;\n        const bufferGeometry = new OlCircle(\n          position.position,\n          this.buffer.bufferRadius\n        );\n        if (!bufferFeatureExists) {\n          bufferFeature = new olFeature(bufferGeometry);\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\n          bufferFeature.setStyle(this.positionFeatureStyle);\n        }\n        bufferFeature.setStyle(this.bufferStyle);\n        bufferFeatureExists\n          ? bufferFeature.setGeometry(bufferGeometry)\n          : this.geolocationOverlay.addOlFeature(\n              bufferFeature,\n              FeatureMotion.None\n            );\n      }\n    }\n  }\n  handleViewFromFeatures(\n    position: MapGeolocationState,\n    zoomTo: boolean = false\n  ) {\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\n    const features = [\n      positionFeature,\n      positionFeatureArrow,\n      accuracyFeature,\n      bufferFeature\n    ].filter((f) => f);\n    if (features.length > 0) {\n      const featuresExtent = computeOlFeaturesExtent(\n        features,\n        this.map.viewProjection\n      );\n      const edgeRatios =\n        position?.speed > 12.5\n          ? [0.25, 0.25, 0.25, 0.25]\n          : [0.15, 0.1, 0.1, 0.1];\n      const areOutOfView = featuresAreOutOfView(\n        this.map.getExtent(),\n        featuresExtent,\n        edgeRatios\n      );\n      let motion =\n        this.followPosition && areOutOfView\n          ? FeatureMotion.Move\n          : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      motion !== FeatureMotion.None\n        ? moveToOlFeatures(this.map.viewController, features, motion)\n        : undefined;\n    }\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\nimport { ObjectEvent } from 'ol/Object';\nimport OlView from 'ol/View';\nimport * as oleasing from 'ol/easing';\nimport { EventsKey } from 'ol/events';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current rotation in radians\n   */\n  readonly rotation$ = new BehaviorSubject<number>(0);\n\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) =>\n          this.onMoveEnd(event)\n        ) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  monitorRotation() {\n    this.observerKeys.push(\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\n        this.rotation$.next(evt.target.getRotation());\n      }) as EventsKey\n    );\n    this.rotation$.next(this.getRotation());\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [\n        number,\n        number\n      ];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in radians\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import {\n  Directive,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { MediaService } from '@igo2/core/media';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport * as OlGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olLayerVector from 'ol/layer/Vector';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport RenderFeature from 'ol/render/Feature';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { Layer, VectorLayer, VectorTileLayer } from '../../layer/shared/layers';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleService } from '../../style/style-service/style.service';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]',\n  standalone: true\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> =\n    new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n        this.listenToMapPointerMove();\n        this.subscribeToPointerStore();\n        this.listenToMapClick();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find((l) => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: 'vector',\n      declutter: true,\n      source: new olVectorTileSource({ projection: this.map.projection }),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(\n            feature,\n            this.mvtStyleOptions,\n            resolution\n          );\n        }\n      }\n    });\n  }\n\n  createHoverStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    hoverStyle: StyleByAttribute,\n    resolution: number\n  ) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style = {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(\n      feature,\n      localHoverStyle,\n      resolution\n    );\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.addFeatureOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          if (!layerOL) {\n            return;\n          }\n          const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n          if (!this.canProcessHover(igoLayer as any)) {\n            return;\n          }\n          if (igoLayer.zIndex <= maximumZindex) {\n            return;\n          }\n          maximumZindex = igoLayer.zIndex;\n          topMostOlLayer = layerOL;\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) =>\n            olLayer instanceof olLayerVector ||\n            olLayer instanceof olLayerVectorTile\n        }\n      );\n      if (!topMostOlLayer) {\n        // To clear label\n        this.clearLayer();\n        this.pointerHoverFeatureStore.clear();\n        return;\n      }\n\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          // To avoid flashing feature\n          if (\n            mapFeature.get('hoverSummary') === undefined &&\n            mapFeature.getProperties() !==\n              this.pointerHoverFeatureStore.all()[0]?.getProperties()\n          ) {\n            this.clearLayer();\n            let igoLayer;\n            if (layerOL instanceof olLayerVector) {\n              const myLayerVector = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorLayer;\n              if (!this.canProcessHover(myLayerVector)) {\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(mapFeature);\n              this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\n              const featuresToLoad = [localOlFeature];\n              localOlFeature.set('_isLabel', false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n                localOlFeature.getGeometry().getType() === 'Point'\n                  ? localOlFeature.getGeometry()\n                  : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set('_isLabel', true);\n              this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\n              featuresToLoad.push(myLabelOlFeature);\n              this.pointerHoverFeatureStore.load(featuresToLoad);\n              igoLayer = myLayerVector;\n              return true;\n            }\n            if (layerOL instanceof olLayerVectorTile) {\n              const myLayerVectorTile = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorTileLayer;\n              if (!this.canProcessHover(myLayerVectorTile)) {\n                return;\n              }\n              if (\n                myLayerVectorTile?.options?.igoStyle?.styleByAttribute\n                  ?.hoverStyle\n              ) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\n              } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.hoverStyle;\n              }\n              this.selectionLayer.setSource(layerOL.getSource());\n              layerOL\n                .getFeatures(event.pixel)\n                .then(\n                  (mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n                    if (!mvtFeatures.length) {\n                      this.selectionMVT = {};\n                      this.selectionLayer.changed();\n                      this.clearLayer();\n                      return;\n                    }\n                    const feature = mvtFeatures[0];\n                    if (!feature) {\n                      this.clearLayer();\n                      return;\n                    }\n                    let localOlFeature = this.handleRenderFeature(feature);\n                    localOlFeature.set('_isLabel', false);\n                    const myLabelOlFeature = new OlFeature();\n                    myLabelOlFeature.setProperties(\n                      localOlFeature.getProperties()\n                    );\n                    const labelGeom =\n                      localOlFeature.getGeometry().getType() === 'Point'\n                        ? localOlFeature.getGeometry()\n                        : new OlGeom.Point(event.coordinate);\n                    myLabelOlFeature.setGeometry(labelGeom);\n                    myLabelOlFeature.setId(localOlFeature.getId());\n                    myLabelOlFeature.set('_isLabel', true);\n                    this.setLayerStyleFromOptions(\n                      myLayerVectorTile,\n                      myLabelOlFeature\n                    );\n                    this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n                    this.selectionMVT[feature.getId()] = localOlFeature;\n                    this.selectionLayer.changed();\n                  }\n                );\n              igoLayer = myLayerVectorTile;\n            }\n          }\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) => olLayer === topMostOlLayer\n        }\n      );\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (\n      !igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n\n    if (\n      igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(\n    feature: RenderFeature | OlFeature<OlGeometry>\n  ): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    localFeature.setProperties(feature.getProperties());\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n    if (hoverEntity.length > 0) {\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(\n    igoLayer: VectorLayer | VectorTileLayer,\n    feature: OlFeature<OlGeometry>\n  ) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.styleByAttribute.hoverStyle,\n          resolution\n        )\n      );\n      return;\n    }\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.hoverStyle,\n          resolution\n        )\n      );\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([\n            parseFloat(coords[idx]),\n            parseFloat(coords[idx + 1])\n          ]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { ObjectEvent } from 'ol/Object';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport { getUid } from 'ol/util';\n\nimport {\n  TimeFilterableDataSource,\n  TimeFilterableDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSource,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport type { MapBase } from '../shared/map.abstract';\n\nexport function getLinkedLayersOptions(layer: Layer) {\n  return layer.options.linkedLayers;\n}\n\nexport function getIgoLayerByLinkId(map: MapBase, id: string) {\n  return map.layers.find((l) => l.options.linkedLayers?.linkId === id);\n}\n\nexport function layerHasLinkWithProperty(\n  layer: Layer,\n  property: LinkedProperties\n): boolean {\n  let hasLinkWithProperty = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) =>\n      l.properties.includes(property)\n    );\n    hasLinkWithProperty = link ? true : false;\n  }\n  return hasLinkWithProperty;\n}\n\nexport function layerHasLinkDeletion(layer: Layer): boolean {\n  let hasLinkWithSyncedDelete = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) => l.syncedDelete);\n    hasLinkWithSyncedDelete = link ? true : false;\n  }\n  return hasLinkWithSyncedDelete;\n}\n\nexport function getRootParentByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkWithProperty(layerToUse, property)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  if (layer?.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) =>\n            l.linkedIds.includes(currentLinkId) &&\n            l.properties.includes(property)\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n            , The first parent (${\n              parents[0].title || parents[0].id\n            }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.properties.includes(property))\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[],\n  property: LinkedProperties\n): Layer[] {\n  let childLayers = getDirectChildLayersByProperty(map, layer, property);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\n    if (directChildLayers) {\n      getAllChildLayersByProperty(map, cl, knownChildLayers, property);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function getRootParentByDeletion(map: MapBase, layer: Layer): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkDeletion(layerToUse)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer {\n  if (layer.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) => l.linkedIds.includes(currentLinkId) && l.syncedDelete\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n          , The first parent (${\n            parents[0].title || parents[0].id\n          }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.syncedDelete)\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[]\n): Layer[] {\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByDeletion(map, cl);\n    if (directChildLayers) {\n      getAllChildLayersByDeletion(map, cl, knownChildLayers);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function initLayerSyncFromRootParentLayers(\n  map: MapBase,\n  layers: Layer[]\n) {\n  const rootLayersByProperty = {};\n  const keys = Object.keys(LinkedProperties);\n  keys.map((k) => {\n    rootLayersByProperty[LinkedProperties[k]] = [];\n  });\n  layers\n    .filter((l) => getLinkedLayersOptions(l))\n    .map((l) => {\n      keys.map((key) => {\n        const k = LinkedProperties[key];\n        const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\n        const layers = rootLayersByProperty[k];\n        const layersId = layers.map((l) => l.id);\n        if (plbp && !layersId.includes(plbp.id)) {\n          rootLayersByProperty[k].push(plbp);\n        }\n      });\n    });\n  Object.keys(rootLayersByProperty).map((k) => {\n    const layers = rootLayersByProperty[k];\n    layers.map((l: Layer) => l.ol.notify(k, undefined));\n  });\n}\n\nexport function handleLayerPropertyChange(\n  map: MapBase,\n  propertyChange: ObjectEvent,\n  initiatorIgoLayer: Layer\n) {\n  if (!propertyChange) {\n    return;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  let isLayerProperty = true;\n  let isDatasourceProperty = true;\n  const key = propertyChange.key;\n  let newValue;\n  if (key === 'ogcFilters') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions\n    ).ogcFilters;\n  } else if (key === 'timeFilter') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions\n    ).timeFilter;\n  } else {\n    isLayerProperty = true;\n    isDatasourceProperty = false;\n    newValue = initiatorIgoLayer.ol.get(key);\n  }\n\n  const initiatorLinkedLayersOptions =\n    getLinkedLayersOptions(initiatorIgoLayer);\n  if (initiatorLinkedLayersOptions) {\n    let rootParentByProperty = getRootParentByProperty(\n      map,\n      initiatorIgoLayer,\n      key as LinkedProperties\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = initiatorIgoLayer;\n    }\n\n    const clbp = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      map,\n      rootParentByProperty,\n      clbp,\n      key as LinkedProperties\n    );\n\n    let resolutionPropertyHasChanged = false;\n    const initiatorIgoLayerSourceType =\n      initiatorIgoLayer.options.source.options.type;\n    const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer\n      .dataSource.options as OgcFilterableDataSourceOptions;\n    clbp.map((l) => {\n      if (\n        initiatorIgoLayer &&\n        l &&\n        getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)\n      ) {\n        const lLayerType = l.options.source.options.type;\n        if (isLayerProperty) {\n          l.ol.set(key, newValue, true);\n          if (key === 'visible') {\n            l.visible$.next(newValue);\n          }\n          if (key === 'minResolution' || key === 'maxResolution') {\n            resolutionPropertyHasChanged = true;\n          }\n        } else if (isDatasourceProperty) {\n          if (key === 'ogcFilters') {\n            (l.dataSource as OgcFilterableDataSource).setOgcFilters(\n              newValue,\n              false\n            );\n            if (lLayerType === 'wfs') {\n              l.ol.getSource().refresh();\n            }\n            if (lLayerType === 'wms') {\n              let appliedOgcFilter;\n              if (initiatorIgoLayerSourceType === 'wfs') {\n                appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\n                  initiatorIgoLayerOgcFilterableDataSourceOptions,\n                  (initiatorIgoLayer.dataSource.options as any)\n                    .fieldNameGeometry,\n                  undefined,\n                  map.viewController.getOlProjection()\n                );\n              } else if (initiatorIgoLayerSourceType === 'wms') {\n                appliedOgcFilter = (\n                  initiatorIgoLayer.dataSource as WMSDataSource\n                ).ol.getParams().FILTER;\n              }\n              (l.dataSource as WMSDataSource).ol.updateParams({\n                FILTER: appliedOgcFilter\n              });\n            }\n          } else if (\n            l.dataSource instanceof WMSDataSource &&\n            key === 'timeFilter'\n          ) {\n            (l.dataSource as TimeFilterableDataSource).setTimeFilter(\n              newValue,\n              false\n            );\n            const appliedTimeFilter = (\n              initiatorIgoLayer.ol.getSource() as olSourceImageWMS\n            ).getParams().TIME;\n            l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\n          }\n        }\n      }\n    });\n    if (resolutionPropertyHasChanged) {\n      map.viewController.resolution$.next(map.viewController.resolution$.value);\n    }\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Self\n} from '@angular/core';\n\nimport { MediaService } from '@igo2/core/media';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { transform } from 'ol/proj';\n\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\n\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]',\n  standalone: true\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) =>\n        this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { SubjectStatus, Watcher } from '@igo2/utils';\n\nimport { ObjectEvent } from 'ol/Object';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  public propertyChange$: BehaviorSubject<{\n    event: ObjectEvent;\n    layer: Layer;\n  }> = new BehaviorSubject(undefined);\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach((layer) => this.unwatchLayer(layer), this);\n  }\n\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\n    if (\n      ![\n        LinkedProperties.TIMEFILTER,\n        LinkedProperties.OGCFILTERS,\n        LinkedProperties.VISIBLE,\n        LinkedProperties.OPACITY,\n        LinkedProperties.MINRESOLUTION,\n        LinkedProperties.MAXRESOLUTION\n      ].includes(change.key as any)\n    ) {\n      return;\n    }\n    this.propertyChange$.next({ event: change, layer });\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n    layer.ol.on('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.on('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status) => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.ol.un('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.un('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olMap from 'ol/Map';\nimport { ObjectEvent } from 'ol/Object';\nimport olView, { ViewOptions } from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olinteraction from 'ol/interaction';\nimport olLayer from 'ol/layer/Layer';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olproj4 from 'ol/proj/proj4';\nimport olSource from 'ol/source/Source';\nimport { getUid } from 'ol/util';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject, pairwise, skipWhile } from 'rxjs';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { MapViewController } from './controllers/view';\nimport {\n  getAllChildLayersByDeletion,\n  getRootParentByDeletion,\n  handleLayerPropertyChange,\n  initLayerSyncFromRootParentLayers\n} from './linkedLayers.utils';\nimport type { MapBase } from './map.abstract';\nimport {\n  MapAttributionOptions,\n  MapControlsOptions,\n  MapExtent,\n  MapOptions,\n  MapScaleLineOptions,\n  MapViewOptions\n} from './map.interface';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap implements MapBase {\n  public ol: olMap;\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\n  public status$: Subject<SubjectStatus>;\n  public propertyChange$: Subject<{ event: ObjectEvent; layer: Layer }>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  /** @deprecated use projectionCode */\n  get projection(): string {\n    return this.projectionCode;\n  }\n\n  get viewProjection(): olproj.Projection {\n    return this.viewController.getOlProjection();\n  }\n\n  get projectionCode(): string {\n    return this.viewProjection.getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (\n          this.options.controls.attribution === true\n            ? {}\n            : this.options.controls.attribution\n        ) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (\n          this.options.controls.scaleLine === true\n            ? {}\n            : this.options.controls.scaleLine\n        ) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService\n      );\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(\n          this.mapViewOptions\n        );\n      }\n      this.layers$.pipe(pairwise()).subscribe(([prevLayers, currentLayers]) => {\n        let prevLayersId;\n        if (prevLayers) {\n          prevLayersId = prevLayers.map((l) => l.id);\n        }\n        const layers = currentLayers.filter(\n          (l) => !prevLayersId.includes(l.id)\n        );\n\n        for (const layer of layers) {\n          if (layer.options.linkedLayers) {\n            layer.ol.once('postrender', () => {\n              initLayerSyncFromRootParentLayers(this, layers);\n            });\n          }\n        }\n      });\n      this.viewController.monitorRotation();\n    });\n    this.propertyChange$\n      .pipe(skipWhile((pc) => !pc))\n      .subscribe((p) => handleLayerPropertyChange(this, p.event, p.layer));\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => {}, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions: MapViewOptions = {\n      ...currentView.getProperties(),\n      ...options\n    };\n\n    if (options.zoom && options.resolution == null) {\n      viewOptions.resolution = undefined;\n    }\n\n    this.setView(viewOptions);\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    const viewOptions: ViewOptions = { constrainResolution: true, ...options };\n    if (options.center) {\n      viewOptions.center = olproj.fromLonLat(\n        options.center,\n        options.projection\n      );\n    }\n\n    this.ol.setView(new olView(viewOptions));\n\n    if (options.maxLayerZoomExtent) {\n      this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (\n        value.attribution === true ? {} : value.attribution\n      ) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (\n        value.scaleLine === true ? {} : value.scaleLine\n      ) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach((control) => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach((control) => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n  /**\n   * @deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\n    );\n  }\n\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\n    const olUId = getUid(olLayer);\n    return this.getLayerByOlUId(olUId);\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) {\n          return;\n        }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      if (layer instanceof VectorLayer) {\n        layer.removeLayerFromIDB();\n      }\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map((linkedLayer) => {\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\n    if (!rootParentByDeletion) {\n      rootParentByDeletion = srcLayer;\n    }\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [\n      rootParentByDeletion\n    ]);\n    for (const layer of clbd) {\n      layersToRemove.push(layer);\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n}\n","import { NumberUtils } from '@igo2/utils';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\nimport * as olproj from 'ol/proj';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n  /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map((s) => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [, negativeLon, lon, , decimalLon, negativeLat, lat, , decimalLat] =\n      coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    lonLat[0] > 180 ||\n    lonLat[0] < -180 ||\n    lonLat[1] > 90 ||\n    lonLat[1] < -90\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number],\n  decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach((dd) => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(\n  coord: [number, number],\n  decimal: number = 3\n): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)\n  ] as [number, number];\n}\n\nexport function roundCoordToString(\n  coord: [number, number],\n  decimal: number = 3\n): [string, string] {\n  return roundCoordTo(coord, decimal).map((r) => r.toString()) as [\n    string,\n    string\n  ];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [\n    number,\n    number\n  ];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [\n    number,\n    number\n  ];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [\n      number,\n      number\n    ];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach((projection) => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [\n      number,\n      number\n    ];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import { AfterViewInit, Directive } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { combineLatest } from 'rxjs';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { IgoMap } from './map';\n\ninterface OfflinableSourceOptions extends DataSourceOptions {\n  pathOffline?: string;\n}\n\n@Directive({\n  selector: '[igoMapOffline]',\n  standalone: true\n})\nexport class MapOfflineDirective implements AfterViewInit {\n  private component: MapBrowserComponent;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  private previousMessageId;\n\n  constructor(\n    component: MapBrowserComponent,\n    private networkService: NetworkService,\n    private messageService: MessageService\n  ) {\n    this.component = component;\n  }\n\n  ngAfterViewInit() {\n    const initialOnline = window.navigator.onLine;\n    this.map.forcedOffline$.subscribe((forcedOffline: boolean) => {\n      const online = window.navigator.onLine;\n      // prevent first online message if no state change.\n      if (initialOnline && initialOnline === online && !forcedOffline) {\n        return;\n      }\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      if (!forcedOffline && online) {\n        const messageObj = this.messageService.info(\n          'igo.geo.network.online.message',\n          'igo.geo.network.online.title'\n        );\n        this.previousMessageId = messageObj.toastId;\n      } else if (forcedOffline) {\n        const messageObj = this.messageService.info(\n          'igo.geo.network.offline.message',\n          'igo.geo.network.offline.title'\n        );\n        this.previousMessageId = messageObj.toastId;\n      }\n    });\n\n    combineLatest([\n      this.networkService.currentState(),\n      this.map.forcedOffline$,\n      this.map.layers$\n    ]).subscribe((bunch: [ConnectionState, boolean, Layer[]]) => {\n      const online = bunch[0].connection;\n      const forcedOffline = bunch[1];\n      const layers = bunch[2];\n      this.handleLayersOnlineState(online, forcedOffline, layers);\n    });\n  }\n\n  private handleNonOfflinableLayerResolution(\n    online: boolean,\n    forcedOffline: boolean,\n    layer: Layer\n  ) {\n    if (!online || forcedOffline) {\n      layer.maxResolution = 0;\n    } else if (online || !forcedOffline) {\n      layer.maxResolution = layer.options.maxResolution || Infinity;\n    }\n  }\n\n  private handleLayersOnlineState(\n    online: boolean,\n    forcedOffline: boolean,\n    layers: Layer[]\n  ) {\n    layers.forEach((layer) => {\n      let offlinableByUrlSourceOptions;\n      if (layer.isIgoInternalLayer) {\n        return;\n      }\n      // detect if layer/source are offlinable by url/pathOffline properties\n      if (\n        (layer.options.sourceOptions as OfflinableSourceOptions)?.pathOffline\n      ) {\n        offlinableByUrlSourceOptions = layer.options.sourceOptions;\n      }\n      if (offlinableByUrlSourceOptions) {\n        const type = offlinableByUrlSourceOptions.type;\n        if (type === 'mvt') {\n          layer.ol.getSource().refresh();\n        }\n        if (!online || forcedOffline) {\n          if (['vector', 'cluster'].includes(type)) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(\n            offlinableByUrlSourceOptions.pathOffline\n          );\n        } else if (!online || !forcedOffline) {\n          if (['vector', 'cluster'].includes(type)) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(\n            offlinableByUrlSourceOptions.url\n          );\n        } else {\n          this.handleNonOfflinableLayerResolution(online, forcedOffline, layer);\n        }\n      } else {\n        // FOR ALL NON OFFLINABLE SOURCE (i.e. EXCEPT PREVIOUS);\n        this.handleNonOfflinableLayerResolution(online, forcedOffline, layer);\n        return;\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport proj4 from 'proj4';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n  constructor(private config: ConfigService) {\n    const projections: Projection[] =\n      this.config.getConfig('projections') || [];\n    projections.forEach((projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code =\n        mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n}\n","import { Observable, from } from 'rxjs';\n\nimport { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n  let lonMin = -54;\n  const lonMax = -81;\n  if (lon < lonMax || lon > lonMin) {\n    return 0;\n  } else {\n    const deltaLon = 3;\n    let zone = 2;\n    while (Math.abs(lon - lonMin) > deltaLon) {\n      lonMin = lonMin - deltaLon;\n      zone++;\n    }\n    return zone;\n  }\n}\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n  projectionsLimitations: ProjectionsLimitationsOptions\n): ProjectionsLimitationsOptions {\n  const mtmZone = projectionsLimitations.mtmZone;\n  const utmZone = projectionsLimitations.utmZone;\n  const projectionsConstraints = {\n    projFromConfig:\n      projectionsLimitations.projFromConfig === false ? false : true,\n    nad83: projectionsLimitations.nad83 === false ? false : true,\n    wgs84: projectionsLimitations.wgs84 === false ? false : true,\n    webMercator: projectionsLimitations.webMercator === false ? false : true,\n    utm: projectionsLimitations.utm === false ? false : true,\n    mtm: projectionsLimitations.mtm === false ? false : true,\n    utmZone: {\n      minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n      maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21\n    },\n    mtmZone: {\n      minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n      maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10\n    }\n  };\n  return projectionsConstraints;\n}\n/**\n * Method allowing to read the file and try to detect projection/Coord system\n * Only geojson/json/gml could be detected at this moment.\n * @param options A file and an optional number of line to read the EPSG Code. Used only for GML files\n * @returns Observable string, epsgNotDefined if the EPSG is not detected or a EPSG string ex: EPSG:3857\n */\nexport function detectFileEPSG(options: {\n  file: File;\n  nbLines?: number;\n}): Observable<string> {\n  const file = options.file;\n  const nbLines = options.nbLines ?? 500;\n\n  const reader = new FileReader();\n  return from(\n    new Promise<string>((resolve) => {\n      if (\n        !file.name.toLowerCase().endsWith('.geojson') &&\n        !file.name.toLowerCase().endsWith('.json') &&\n        !file.name.toLowerCase().endsWith('.gml')\n      ) {\n        resolve('epsgNotDefined');\n        return;\n      }\n\n      reader.onload = (e) => {\n        if (\n          file.name.toLowerCase().endsWith('.geojson') ||\n          file.name.toLowerCase().endsWith('.json')\n        ) {\n          const geojson = JSON.parse(reader.result as string);\n          if (geojson.crs?.properties?.name) {\n            const epsg =\n              geojson.crs.properties.name.match(/EPSG:{1,2}\\d{0,6}/gm);\n            if (epsg !== null && epsg.length) {\n              resolve(epsg[0].replace(/::/g, ':'));\n              return;\n            } else {\n              resolve('epsgNotDefined');\n              return;\n            }\n          } else {\n            resolve('epsgNotDefined');\n            return;\n          }\n        } else if (file.name.toLowerCase().endsWith('.gml')) {\n          const text = reader.result as string;\n          const lines = (text as string).split('\\n');\n          for (let line = 0; line <= nbLines; line++) {\n            const epsg = lines[line].match(/EPSG:\\d{0,6}/gm);\n            if (epsg !== null && epsg.length) {\n              resolve(epsg[0]);\n              break;\n            } else {\n              resolve(undefined);\n            }\n          }\n        } else {\n          resolve('epsgNotDefined');\n        }\n      };\n      reader.readAsText(file, 'UTF-8');\n    })\n  );\n}\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\n\nimport { getRenderPixel } from 'ol/render';\n\nimport { Subscription } from 'rxjs';\n\nimport { Layer } from '../../layer/shared';\nimport { IgoMap } from '../shared/map';\n\n/**\n * Tool to swipe the layers\n */\n@Component({\n  selector: 'igo-swipe-control',\n  templateUrl: './swipe-control.component.html',\n  styleUrls: ['./swipe-control.component.scss'],\n  standalone: true\n})\nexport class SwipeControlComponent implements AfterViewInit, OnDestroy {\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The list of layers for swipe\n   */\n  private layers: Layer[];\n\n  /**\n   * Final position of the swiped element\n   */\n  private pos1: number;\n\n  /**\n   * Intermediate position of the swiped element\n   */\n  private pos3: number;\n\n  /**\n   * State of draggable action\n   */\n  private inDragAction: boolean = false;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private swipeEnabled$$: Subscription;\n\n  /**\n   * Binder of prerender on the same element\n   */\n  private boundPrerender = this.prerender.bind(this);\n\n  constructor() {}\n\n  /**\n   * Get the list of layers for swipe and activate of deactivate the swipe\n   * @internal\n   */\n  ngAfterViewInit(): void {\n    this.getListOfLayers();\n    this.swipeEnabled$$ = this.map.swipeEnabled$.subscribe((value) => {\n      value ? this.displaySwipe() : this.displaySwipeOff();\n    });\n    this.letZoom();\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy(): void {\n    this.swipeEnabled$$.unsubscribe();\n    this.map.swipeEnabled$.unsubscribe();\n    this.displaySwipeOff();\n  }\n\n  /**\n   * Display a swipe-element and render the layers\n   */\n  displaySwipe() {\n    if (this.swipeId) {\n      this.swipeId.style.visibility = 'visible';\n    }\n    this.layers.map((layer) => layer.ol.on('prerender', this.boundPrerender));\n    this.layers.map((layer) => layer.ol.on('postrender', this.postrender));\n    this.map.ol.render();\n  }\n\n  /**\n   * Clear a swipe-element and render the layers on the initial state\n   */\n  displaySwipeOff() {\n    if (this.swipeId) {\n      this.swipeId.style.visibility = 'hidden';\n    }\n    this.layers.map((layer) => layer.ol.un('prerender', this.boundPrerender));\n    this.layers.map((layer) => layer.ol.un('postrender', this.postrender));\n    this.map.ol.render();\n    this.layers = [];\n  }\n\n  /**\n   * Getter of element\n   */\n  get swipeId() {\n    return document.getElementById('igo-layer-swipe');\n  }\n\n  /**\n   * Get the list of layers for swipe\n   */\n  getListOfLayers() {\n    this.map.selectedFeatures$.subscribe((layers) => {\n      this.layers = [];\n      if (layers !== null) {\n        for (const layer of layers) {\n          if (!this.layers.includes(layer)) {\n            this.layers.push(layer);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Get a position of click or touch\n   */\n  dragDown(event) {\n    this.inDragAction = true;\n    event.preventDefault();\n    if (event.type === 'mousedown') {\n      this.pos3 = event.clientX;\n      this.mouseSwipe();\n      document.onmouseup = this.closeDragMouseElement;\n    } else if (event.type === 'touchstart') {\n      document.getElementById('arrows').style.visibility = 'hidden';\n      this.pos3 = event.touches[0].clientX;\n      this.touchSwipe();\n      document.ontouchend = this.closeDragTouchElement;\n    }\n  }\n\n  /**\n   * Moving a line with a mouse\n   */\n  mouseSwipe() {\n    document.addEventListener('mousemove', (event) => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        this.pos1 = this.pos3 - event.clientX;\n        this.pos3 = event.clientX;\n        this.swipeId.style.left = this.swipeId.offsetLeft - this.pos1 + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Moving a line with a touch\n   */\n  touchSwipe() {\n    document.addEventListener('touchmove', (event) => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos1 = this.pos3 - event.changedTouches[0].clientX;\n        this.pos3 = event.changedTouches[0].clientX;\n        this.swipeId.style.left = this.swipeId.offsetLeft - this.pos1 + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Deactivate a listener of a mouse-action\n   */\n  closeDragMouseElement() {\n    document.onmouseup = null;\n    document.onmousemove = null;\n    this.inDragAction = false;\n  }\n\n  /**\n   * Deactivate a listener of a touch-action\n   */\n  closeDragTouchElement() {\n    document.ontouchend = null;\n    document.ontouchmove = null;\n    document.getElementById('arrows').style.visibility = 'visible';\n    this.inDragAction = false;\n  }\n\n  /**\n   * Cut the image of a layer by the position of swiped-element\n   */\n  prerender(event) {\n    const ctx = event.context;\n    const mapSize = this.map.ol.getSize();\n    const width = this.swipeId.offsetLeft;\n    const tl = getRenderPixel(event, [width, 0]);\n    const tr = getRenderPixel(event, [0, 0]);\n    const bl = getRenderPixel(event, [width, mapSize[1]]);\n    const br = getRenderPixel(event, [0, mapSize[1]]);\n    ctx.save();\n    ctx.beginPath();\n    ctx.moveTo(tl[0], tl[1]);\n    ctx.lineTo(bl[0], bl[1]);\n    ctx.lineTo(br[0], br[1]);\n    ctx.lineTo(tr[0], tr[1]);\n    ctx.closePath();\n    ctx.clip();\n  }\n\n  /**\n   * Save a current state of the context\n   */\n  postrender(event) {\n    event.context.restore();\n    event.context.save();\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('igo-layer-swipe').addEventListener(\n      'wheel',\n      (event) => {\n        event.deltaY > 0\n          ? this.map.viewController.zoomOut()\n          : this.map.viewController.zoomIn();\n      },\n      true\n    );\n  }\n}\n","<div\n  class=\"igo-swipe-control-container\"\n  id=\"igo-layer-swipe\"\n  (mousedown)=\"dragDown($event)\"\n  (mouseup)=\"closeDragMouseElement()\"\n  (touchstart)=\"dragDown($event)\"\n  (touchend)=\"closeDragTouchElement()\"\n>\n  <div class=\"igo-swipe-control-line\"></div>\n\n  <div class=\"igo-swipe-control-arrows\" id=\"arrows\">\n    <div class=\"igo-arrow-left\"></div>\n    <div class=\"igo-arrow-right\"></div>\n  </div>\n</div>\n","import { AsyncPipe } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { userAgent } from '@igo2/utils';\n\nimport NoSleep from 'nosleep.js';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n  @Input() color: string = 'primary';\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('bedtime');\n  public visible = false;\n\n  constructor(private storageService: StorageService) {\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.addEventListener('blur', () => {\n        this.disableWakeLock();\n        this.enabled = false;\n      });\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('bedtime_off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('bedtime');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div class=\"igo-wake-lock-button-container\">\n  <button\n    [color]=\"color\"\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.preventScreenLock' | translate)\n        : ('igo.geo.mapButtons.letScreenLock' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    (click)=\"toggleWakeLock()\"\n  >\n    <mat-icon>{{ icon$ | async }}</mat-icon>\n  </button>\n</div>\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss'],\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class ZoomButtonComponent {\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number {\n    return this.map.viewController.getZoom();\n  }\n\n  get minZoom(): number {\n    return this.map.viewController.olView.getMinZoom() || 1;\n  }\n\n  get maxZoom(): number {\n    return this.map.viewController.olView.getMaxZoom();\n  }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: { zoom: zoom + 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\"\n  >\n    <mat-icon>add</mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: { zoom: zoom - 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\"\n  >\n    <mat-icon>remove</mat-icon>\n  </button>\n</div>\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport {\n  formatMeasure,\n  metersToUnit,\n  squareMetersToUnit\n} from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat',\n  standalone: true\n})\nexport class MeasureFormatPipe implements PipeTransform {\n  /**\n   * @ignore\n   */\n  transform(\n    value: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (\n      Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0\n    ) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out\n      ? formatMeasure(out, {\n          decimal: 1,\n          unit,\n          unitAbbr,\n          locale: 'fr'\n        })\n      : out;\n  }\n}\n","<h3 mat-dialog-title>{{ 'igo.geo.measure.dialog.title' | translate }}</h3>\n<div mat-dialog-content>\n  <table *ngIf=\"data.length > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.length.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Meters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.length | measureFormat: measureLengthUnit.Kilometers }}\n        </td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInKilometers' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Miles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Feet }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInFeet' | translate }}</td>\n      </tr>\n    </tbody>\n  </table>\n\n  <table *ngIf=\"data.area > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.area.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMeters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.area | measureFormat: measureAreaUnit.SquareKilometers }}\n        </td>\n        <td>\n          {{ 'igo.geo.measure.dialog.areaInSquareKilometers' | translate }}\n        </td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMiles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Acres }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInAcres' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Hectares }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInHectares' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ 'igo.geo.measure.dialog.perimeterInMeters' | translate }}</td>\n        <td>{{ data.perimeter | measureFormat: measureLengthUnit.Meters }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Inject } from '@angular/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\nimport { MeasureFormatPipe } from './measure-format.pipe';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    NgIf,\n    IgoLanguageModule,\n    MeasureFormatPipe\n  ]\n})\nexport class MeasurerDialogComponent {\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n}\n","<mat-form-field class=\"measure-field\" floatLabel=\"always\">\n  <mat-label>{{ placeholder }}</mat-label>\n  <input\n    matInput\n    [disabled]=\"true\"\n    [readonly]=\"true\"\n    [value]=\"(measure$ | async) || 0 | measureFormat: measureUnit\"\n  />\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\"\n  >\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{ 'igo.geo.measure.' + measureUnit | translate }}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n  MeasureType\n} from '../shared/measure.enum';\nimport {\n  computeBestAreaUnit,\n  computeBestLengthUnit\n} from '../shared/measure.utils';\nimport { MeasureFormatPipe } from './measure-format.pipe';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    AsyncPipe,\n    IgoLanguageModule,\n    MeasureFormatPipe\n  ]\n})\nexport class MeasurerItemComponent implements OnDestroy {\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number {\n    return this.measure$.value;\n  }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) {\n    this.toggleAutoUnit(value);\n  }\n  get auto(): boolean {\n    return this._auto;\n  }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<\n    MeasureAreaUnit | MeasureLengthUnit\n  >();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\"\n    >\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{ 'igo.geo.measure.' + measureType.Length | translate }}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{ 'igo.geo.measure.' + measureType.Area | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleActive' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasLine$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasLine$ | async\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayLines' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayDistance' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayAreas' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasArea$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleAutoUnits' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item\n      *ngIf=\"\n        activeMeasureType === measureType.Length ||\n        activeMeasureType === measureType.Area\n      \"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"activeLengthUnit\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"\n        (activeMeasureType === measureType.Area\n          ? 'igo.geo.measure.perimeter'\n          : 'igo.geo.measure.length'\n        ) | translate\n      \"\n      (measureUnitChange)=\"onLengthUnitChange($any($event))\"\n    >\n    </igo-measurer-item>\n\n    <igo-measurer-item\n      *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"activeAreaUnit\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($any($event))\"\n    >\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\"\n    >\n      <mat-icon>calculate</mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\"\n  >\n  </igo-entity-table>\n</div>\n","import { AsyncPipe, DOCUMENT, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  EntityRecord,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport { unByKey } from 'ol/Observable';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlStyle from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n  MeasureType\n} from '../shared/measure.enum';\nimport {\n  FeatureWithMeasure,\n  Measure,\n  MeasurerDialogData\n} from '../shared/measure.interfaces';\nimport {\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  formatMeasure,\n  getTooltipsOfOlGeometry,\n  measureOlGeometry,\n  metersToUnit,\n  squareMetersToUnit,\n  updateOlTooltipAtCenter,\n  updateOlTooltipsAtMidpoints\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\nimport { MeasurerItemComponent } from './measurer-item.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    MatSlideToggleModule,\n    NgIf,\n    MatDividerModule,\n    MeasurerItemComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    EntityTableComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n  public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  public activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  public activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) {\n    this.setActiveMeasureType(value);\n  }\n  get activeMeasureType(): MeasureType {\n    return this._activeMeasureType;\n  }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService,\n    @Inject(DOCUMENT) private document: Document\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      columns: [\n        {\n          name: 'length',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.lengthHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeLengthUnit;\n            const measure = metersToUnit(\n              localFeature.properties.measure.length,\n              unit\n            );\n            return formatMeasure(measure, {\n              decimal: 1,\n              unit,\n              unitAbbr: false,\n              locale: 'fr'\n            });\n          }\n        },\n        {\n          name: 'area',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.areaHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeAreaUnit;\n            const measure = squareMetersToUnit(\n              localFeature.properties.measure.area,\n              unit\n            );\n            return measure\n              ? formatMeasure(measure, {\n                  decimal: 1,\n                  unit,\n                  unitAbbr: false,\n                  locale: 'fr'\n                })\n              : '';\n          }\n        }\n      ]\n    };\n  }\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.getSavedUnits();\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle\n      ? this.storageService.set('distanceToggle', true, StorageScope.SESSION)\n      : this.storageService.set('distanceToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle\n      ? this.storageService.set('linesToggle', true, StorageScope.SESSION)\n      : this.storageService.set('linesToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle\n      ? this.storageService.set('areasToggle', true, StorageScope.SESSION)\n      : this.storageService.set('areasToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle() {\n    if (this.storageService.get('distanceToggle') === false) {\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false) {\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false) {\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName(\n        'igo-map-tooltip-measure-polygone-segments'\n      );\n    if (this.displayDistance) {\n      Array.from(elements).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(elements).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden')\n      );\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName(\n        'igo-map-tooltip-measure-line-segments'\n      );\n\n    if (this.displayLines) {\n      Array.from(elements).map((value: Element) => {\n        value.classList.remove('igo-map-tooltip-hidden');\n      });\n    } else {\n      Array.from(elements).map((value: Element) => {\n        value.classList.add('igo-map-tooltip-hidden');\n      });\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    const elements: HTMLCollectionOf<Element> =\n      this.document.getElementsByClassName('igo-map-tooltip-measure-area');\n\n    if (this.displayAreas) {\n      Array.from(elements).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(elements).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden')\n      );\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.saveCurrentUnits();\n    this.refreshTableAndTooltip();\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.saveCurrentUnits();\n    this.refreshTableAndTooltip();\n  }\n\n  private refreshTableAndTooltip(): void {\n    this.store.stateView.clear();\n\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        return sum + localFeature.properties.measure.area || 0;\n      },\n      0\n    );\n    const length = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'Polygon') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n    const perimeter = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'LineString') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.olDrawSource.getFeatures().forEach((drawingLayerFeature) => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) {\n      return;\n    }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as OlLineString | OlPolygon);\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, { data });\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant(\n        'igo.geo.measure.layerTitle'\n      ),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe((visible) => {\n      const elements: HTMLCollectionOf<Element> =\n        this.document.getElementsByClassName('igo-map-tooltip-measure');\n\n      if (visible) {\n        Array.from(elements).map((value: Element) =>\n          value.classList.remove('igo-map-tooltip-measure-by-display')\n        );\n      } else {\n        Array.from(elements).map((value: Element) =>\n          value.classList.add('igo-map-tooltip-measure-by-display')\n        );\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(\n      store,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        many: true\n      })\n    );\n\n    this.onFeatureAddedKey = store.source.ol.on(\n      'addfeature',\n      (event: OlVectorSourceEvent) => {\n        const localFeature = event.feature;\n        const olGeometry = localFeature.getGeometry() as any;\n        this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n        this.onDisplayDistance();\n        this.onDisplayLines();\n        this.onDisplayAreas();\n      }\n    );\n\n    this.onFeatureRemovedKey = store.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent) => {\n        const olGeometry = event.feature.getGeometry() as any;\n        this.clearTooltipsOfOlGeometry(olGeometry);\n      }\n    );\n\n    this.selectedFeatures$$ = store.stateView\n      .manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n        return record.state.selected === true;\n      })\n      .pipe(\n        skip(1) // Skip initial emission\n      )\n      .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n        if (this.modifyControl.active === true) {\n          this.deactivateModifyControl();\n        }\n        this.selectedFeatures$.next(records.map((record) => record.entity));\n      });\n\n    this.subscriptions$$.push(\n      this.store.entities$.subscribe((objectsExists) => {\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'Polygon'\n          )\n        ) {\n          this.hasArea$.next(true);\n        } else {\n          this.hasArea$.next(false);\n        }\n\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'LineString'\n          )\n        ) {\n          this.hasLine$.next(true);\n        } else {\n          this.hasLine$.next(false);\n        }\n      })\n    );\n\n    this.subscriptions$$.push(\n      this.store.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.store.layer.options.showInLayerList = true)\n          : (this.store.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry)\n    );\n    this.drawEnd$$ = drawControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.abort$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      }\n    );\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined) {\n      this.drawStart$$.unsubscribe();\n    }\n    if (this.drawEnd$$ !== undefined) {\n      this.drawEnd$$.unsubscribe();\n    }\n    if (this.drawChanges$$ !== undefined) {\n      this.drawChanges$$.unsubscribe();\n    }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(\n      olGeometry,\n      Object.assign({}, measure, {\n        area: undefined // We don't want to display an area tooltip while drawing.\n      })\n    );\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(\n      FeatureStoreSelectionStrategy\n    ) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry)\n    );\n    this.modifyEnd$$ = this.modifyControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry)\n    );\n    this.modifyChanges$$ = this.modifyControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry)\n    );\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined) {\n      this.modifyStart$$.unsubscribe();\n    }\n    if (this.modifyEnd$$ !== undefined) {\n      this.modifyEnd$$.unsubscribe();\n    }\n    if (this.modifyChanges$$ !== undefined) {\n      this.modifyChanges$$.unsubscribe();\n    }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(\n    olGeometry: OlLineString | OlPolygon,\n    measure: Measure\n  ) {\n    olGeometry.setProperties({ _measure: measure }, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature\n      ? localFeature.properties.id\n      : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (this.shouldShowTooltip(olTooltip)) {\n          this.map.ol.addOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource) {\n    olSource.forEachFeature((olFeature: OlFeature) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties(\n      { _measure: measure, _unit: unit, _type: type },\n      true\n    );\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(\n      properties._measure,\n      {\n        decimal: 1,\n        unit: properties._unit,\n        unitAbbr: true,\n        locale: 'fr'\n      },\n      this.languageService\n    );\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength =\n        metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n\n  private saveCurrentUnits() {\n    this.storageService.set(\n      'distanceUnit',\n      this.activeLengthUnit,\n      StorageScope.SESSION\n    );\n    this.storageService.set(\n      'areaUnit',\n      this.activeAreaUnit,\n      StorageScope.SESSION\n    );\n  }\n\n  private getSavedUnits() {\n    const distanceUnit = this.storageService.get(\n      'distanceUnit'\n    ) as MeasureLengthUnit;\n    const areaUnit = this.storageService.get('areaUnit') as MeasureAreaUnit;\n\n    this.activeLengthUnit = distanceUnit ? distanceUnit : this.activeLengthUnit;\n    this.activeAreaUnit = areaUnit ? areaUnit : this.activeAreaUnit;\n  }\n}\n","export const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core/language';\n\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport { getArea as olGetArea, getLength as olGetLength } from 'ol/sphere';\nimport * as olstyle from 'ol/style';\n\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\nimport { Measure } from './measure.interfaces';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(\n  value: number,\n  unit: MeasureLengthUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(\n  value: number,\n  unit: MeasureAreaUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService\n) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(\n      measure.toLocaleString(options.locale, {\n        minimumFractionDigits: decimal,\n        maximumFractionDigits: decimal\n      })\n    );\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit]\n          ? languageService.translate.instant(\n              'igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]\n            )\n          : languageService.translate.instant(\n              'igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit]\n            )\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ||\n          MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter((p) => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33'\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, { projection });\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, { projection });\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max(\n      olGeometry.getFlatCoordinates().length / 2 - 1,\n      0\n    );\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n    typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(\n  olPoint: OlPoint,\n  center: boolean = false,\n  srcGeomType: string = ''\n): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center\n      ? [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          'igo-map-tooltip-measure-area'\n        ]\n      : [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          `igo-map-tooltip-measure-${srcGeomType}segments`\n        ]\n    ).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","export enum InsertSourceInsertDBEnum {\n  System = 'system',\n  User = 'user'\n}\n","import { Injectable } from '@angular/core';\n\nimport { Compression } from '@igo2/utils';\n\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, Subject, of } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\n\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\nimport { GeoDBData } from './geoDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newData: number = 0;\n  private compression = new Compression();\n\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\n\n  /**\n   * Only blob can be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(\n    url: string,\n    regionID: any,\n    object: any,\n    insertSource: InsertSourceInsertDBEnum,\n    insertEvent: string\n  ): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$\n      .pipe(\n        first(),\n        concatMap((object) => {\n          geoDBData = {\n            url,\n            regionID,\n            object: object,\n            compressed: compress,\n            insertSource,\n            insertEvent\n          };\n          return this.ngxIndexedDBService.getByID(this.dbName, url);\n        }),\n        concatMap((dbObject: GeoDBData) => {\n          if (!dbObject) {\n            this._newData++;\n            return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n          } else {\n            const currentRegionID = dbObject.regionID;\n            if (currentRegionID !== regionID) {\n              const collisions = this.collisionsMap.get(currentRegionID);\n              if (collisions !== undefined) {\n                collisions.push(dbObject.url);\n                this.collisionsMap.set(currentRegionID, collisions);\n              } else {\n                this.collisionsMap.set(currentRegionID, [dbObject.url]);\n              }\n            }\n            return this.customUpdate(geoDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      geoDBData.url\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, geoDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getByID(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\n  }\n\n  deleteByKey(url: string): Observable<any> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\n  }\n\n  getRegionCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id).subscribe((datas) => {\n      subject.next(datas.length);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    dbRequest.subscribe((datas: GeoDBData[]) => {\n      datas.forEach((data) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(\n      this.dbName,\n      'regionID',\n      keyRange,\n      mode\n    );\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newData = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService\n          .getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newData(): number {\n    return this._newData;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { Type } from 'ol/format/Feature';\n\nimport { Observable } from 'rxjs';\n\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer = 'arraybuffer',\n  Blob = 'blob',\n  Text = 'text',\n  Json = 'json'\n}\nexport interface SimpleGetOptions {\n  responseType: Type;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(\n    url: string,\n    simpleGetOptions: SimpleGetOptions\n  ): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      case 'arraybuffer':\n        request = this.http.get(url, {\n          responseType: 'arraybuffer',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'text':\n        request = this.http.get(url, {\n          responseType: 'text',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'json':\n        request = this.http.get(url, {\n          responseType: 'json',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      default:\n        request = this.http.get(url, {\n          responseType: 'blob',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport type { MapBase } from '../../map/shared/map.abstract';\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay<T extends MapBase = MapBase> {\n  /**\n   * The map to add the layer to\n   */\n  private map: T;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: T) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: T) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view (default on FeatureMotion.Default)\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map.viewController, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(\n            this.dataSource.ol.getFeatureById(feature.meta.id)\n          );\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { FeatureDataSource } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n  const setGeoArea = function (pdfExt, geoExt) {\n    const bbox = pdfExt.join(' ');\n    // the ordering may seem odd here but PDF\n    //  flips the Y axis upside down and this accounts for that\n    //  change.\n    const minx = geoExt[0];\n    const maxx = geoExt[2];\n    const maxy = geoExt[1];\n    const miny = geoExt[3];\n    const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n    const bbox_obj = this.internal.newAdditionalObject();\n    const bounds_obj = this.internal.newAdditionalObject();\n    const proj_obj = this.internal.newAdditionalObject();\n\n    proj_obj.content =\n      '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"' +\n      ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]' +\n      ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]' +\n      ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]' +\n      ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n    bounds_obj.content =\n      '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n      proj_obj.objId +\n      ' 0 R /GPTS [ ' +\n      bounds +\n      ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n    bbox_obj.content =\n      '<< /BBox [ ' +\n      bbox +\n      ' ] /Measure ' +\n      bounds_obj.objId +\n      ' 0 R /Name (Layer) /Type /Viewport >>';\n\n    const title_obj = this.internal.newAdditionalObject();\n    const date = new Date().toLocaleDateString('en-CA');\n    title_obj.content = '<< /Name IGO2 /Type /OCG /Date ' + date + ' >>';\n\n    return bbox_obj.objId;\n  };\n\n  jsPDFAPI.setGeoArea = function (pdfExt, geoExt) {\n    this.internal.events.subscribe('putPage', function () {\n      const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n      this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n    });\n  };\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { SecureImagePipe } from '@igo2/common/image';\nimport { ActivityService } from '@igo2/core/activity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { saveAs } from 'file-saver';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport { default as JSZip } from 'jszip';\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { LegendMapViewOptions } from '../../layer/shared/layers/legend.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport GeoPdfPlugin from './geopdf';\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\nimport {\n  PrintLegendPosition,\n  PrintPaperFormat,\n  PrintResolution\n} from './print.type';\n\ndeclare global {\n  interface Navigator {\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean;\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  mapPrintExtent: Array<number>;\n  imgSizeAdded: Array<number>;\n\n  TEXTPDFFONT = {\n    titleFont: 'times',\n    titleFontStyle: 'bold',\n    subtitleFont: 'times',\n    subtitleFontStyle: 'bold',\n    commentFont: 'times',\n    commentFontStyle: 'normal',\n    commentFontSize: 12\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n    this.activityId = this.activityService.register();\n\n    GeoPdfPlugin(jsPDF.API);\n\n    const doc = new jsPDF({\n      orientation,\n      format: paperFormat.toLowerCase(),\n      unit: 'mm' // default\n    });\n\n    const { width: pageWidth, height: pageHeight } = doc.internal.pageSize;\n\n    /** top | right | bottom | left */\n    const baseMargins: [number, number, number, number] = [10, 10, 10, 10];\n\n    let titleSizes: TextPdfSizeAndMargin;\n    let subtitleSizes: TextPdfSizeAndMargin;\n\n    // if paper format A1 or A0 add margin top\n    if (\n      (options.title !== '' || options.subtitle !== '') &&\n      (paperFormat === PrintPaperFormat.A1 ||\n        paperFormat === PrintPaperFormat.A0)\n    ) {\n      baseMargins[0] += 10;\n    }\n    // PDF title\n    const fontSizeInPt = Math.round(2 * (pageHeight + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\n    if (options.title !== undefined && options.title !== '') {\n      titleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.title,\n        baseMargins,\n        this.TEXTPDFFONT.titleFont,\n        fontSizeInPt,\n        this.TEXTPDFFONT.titleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.title,\n        this.TEXTPDFFONT.titleFont,\n        this.TEXTPDFFONT.titleFontStyle,\n        titleSizes.fontSize,\n        titleSizes.marginLeft + baseMargins[3],\n        baseMargins[0]\n      );\n\n      baseMargins[0] = titleSizes.height + baseMargins[0]; // cumulative margin top for next elem to place in pdf doc\n    }\n\n    // PDF subtitle\n    if (options.subtitle !== undefined && options.subtitle !== '') {\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.subtitle,\n        baseMargins,\n        this.TEXTPDFFONT.subtitleFont,\n        options.title !== '' ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\n        this.TEXTPDFFONT.subtitleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.subtitle,\n        this.TEXTPDFFONT.subtitleFont,\n        this.TEXTPDFFONT.subtitleFontStyle,\n        subtitleSizes.fontSize,\n        subtitleSizes.marginLeft + baseMargins[3],\n        baseMargins[0]\n      );\n\n      baseMargins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\n    }\n\n    const verticalSpacing: number = 5;\n    if (options.comment !== undefined && options.comment !== '') {\n      this.addComment(doc, options.comment, baseMargins, verticalSpacing);\n    }\n\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale,\n        baseMargins,\n        verticalSpacing\n      );\n    }\n\n    const width = pageWidth - baseMargins[3] - baseMargins[1];\n    const height = pageHeight - baseMargins[0] - baseMargins[2];\n    const size: [number, number] = [width, height];\n\n    this.addMap(\n      doc,\n      map,\n      resolution,\n      size,\n      baseMargins,\n      legendPostion\n    ).subscribe(async (status: SubjectStatus) => {\n      if (status === SubjectStatus.Done) {\n        await this.handleMeasureLayer(doc, map, baseMargins);\n        const width = this.imgSizeAdded[0];\n        const height = this.imgSizeAdded[1];\n        this.addGeoRef(doc, map, width, height, baseMargins);\n\n        if (options.legendPosition !== 'none') {\n          if (\n            ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n              options.legendPosition\n            ) > -1\n          ) {\n            await this.addLegendSamePage(\n              doc,\n              map,\n              baseMargins,\n              resolution,\n              options.legendPosition\n            );\n          } else if (options.legendPosition === 'newpage') {\n            await this.addLegend(doc, map, baseMargins, resolution);\n          }\n        } else {\n          await this.saveDoc(doc);\n        }\n      }\n\n      if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n        this.activityService.unregister(this.activityId);\n        status$.next(SubjectStatus.Done);\n      }\n    });\n\n    return status$;\n  }\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\n  addGeoRef(\n    doc,\n    map: IgoMap,\n    width: number,\n    height: number,\n    baseMargins: [number, number, number, number]\n  ) {\n    const unit = 'mm';\n    const docHeight = doc.internal.pageSize.getHeight();\n\n    // x,y = margin left-bottom corner for img in pdf doc\n    const x = baseMargins[3];\n    const y = docHeight - baseMargins[0] - height;\n\n    let pdf_extents = [x, y, x + width, y + height];\n    for (let i = 0; i < pdf_extents.length; i++) {\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\n    }\n    doc.setGeoArea(pdf_extents, this.mapPrintExtent);\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  baseMargins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jsPDF,\n    map: IgoMap,\n    baseMargins: [number, number, number, number]\n  ) {\n    if (\n      map.layers.find(\n        (layer) => layer.visible && layer.id.startsWith('igo-measures-')\n      )\n    ) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then((e) => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, baseMargins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(map.layers, {\n        resolution: map.viewController.getResolution(),\n        extent: map.viewController.getExtent(),\n        projection: map.viewController.getOlProjection().getCode(),\n        // scale: map.viewController.getScale(resolution),\n        size: map.ol.getSize()\n      } as LegendMapViewOptions);\n\n      if (legends.filter((l) => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html +=\n        '.html2canvas-container { width: ' +\n        width +\n        'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html +=\n        'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends\n        .filter((l) => l.display && l.isInResolutionsRange === true)\n        .map((legend) =>\n          this.getDataImage(legend.url).pipe(\n            rxMap((dataImage) => {\n              let htmlImg =\n                '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n              htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n              return htmlImg;\n            })\n          )\n        );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  private removeHtmlElement(element: HTMLElement) {\n    element.parentNode.removeChild(element);\n  }\n\n  getTextPdfObjectSizeAndMarg(\n    text: string,\n    margins,\n    font: string,\n    fontSizeInPt: number,\n    fontStyle: string,\n    doc: jsPDF\n  ): TextPdfSizeAndMargin {\n    const pdfResolution = 96;\n    const docWidth = doc.internal.pageSize.getWidth();\n    const pageWidth = docWidth - margins[1] - margins[3];\n\n    // important to set it first, the textDimension change when font change!\n    doc.setFont(font, fontStyle);\n    doc.setFontSize(fontSizeInPt);\n\n    let textDimensions = doc.getTextDimensions(text);\n    let textMarginLeft: number;\n\n    if (textDimensions.w > pageWidth) {\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\n      textMarginLeft = 0;\n      fontSizeInPt = fontSizeInPt * 0.7;\n      doc.setFontSize(fontSizeInPt);\n      textDimensions = doc.getTextDimensions(text);\n    } else {\n      textMarginLeft = (pageWidth - textDimensions.w) / 2;\n    }\n\n    return {\n      fontSize: fontSizeInPt,\n      marginLeft: textMarginLeft,\n      height: textDimensions.h\n    };\n  }\n\n  /**\n   * Add comment to the document\n   * @param  doc - pdf document\n   * @param  comment - Comment to add in the document\n   * @param baseMargins - top | right | bottom | left\n   * @param verticalSpacing - calculate text position and map height\n   */\n  private addComment(\n    doc: jsPDF,\n    comment: string,\n    baseMargins: [number, number, number, number],\n    verticalSpacing: number\n  ) {\n    // calculate map image height\n    baseMargins[2] += verticalSpacing;\n\n    const xPosition = baseMargins[3]; //margin left and bottom is fix\n    const marginBottom = baseMargins[2];\n    // calculate text position Y\n    const yPosition =\n      doc.internal.pageSize.height - marginBottom + verticalSpacing;\n\n    this.addTextInPdfDoc(\n      doc,\n      comment,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      xPosition,\n      yPosition,\n      true\n    );\n  }\n\n  private addTextInPdfDoc(\n    doc: jsPDF,\n    textToAdd: string,\n    textFont: string,\n    textFontStyle: string,\n    textFontSize: number,\n    textMarginLeft: number,\n    textMarginTop: number,\n    isComment: boolean = false\n  ) {\n    doc.setFont(textFont, textFontStyle);\n    doc.setFontSize(textFontSize);\n\n    if (isComment) {\n      textToAdd = doc.splitTextToSize(\n        textToAdd,\n        doc.internal.pageSize.getWidth() - textMarginLeft * 3\n      );\n    }\n    doc.text(textToAdd, textMarginLeft, textMarginTop);\n  }\n\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   * @param baseMargins - top | right | bottom | left\n   * @param verticalSpacing - calculate text position and map height\n   */\n  private addProjScale(\n    doc: jsPDF,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean,\n    baseMargins: [number, number, number, number],\n    verticalSpacing: number\n  ) {\n    // calculate map image height\n    baseMargins[2] += verticalSpacing;\n    const translate = this.languageService.translate;\n    const projScaleSize = 12;\n    const xPosition = baseMargins[3];\n    const marginBottom = baseMargins[2];\n    // calculate text position Y\n    const yPosition =\n      doc.internal.pageSize.height - marginBottom + verticalSpacing;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont(this.TEXTPDFFONT.commentFont);\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, xPosition, yPosition);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n    }\n\n    await this.saveDoc(doc);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  baseMargins - Page margins\n   */\n  private async addLegendSamePage(\n    doc: jsPDF,\n    map: IgoMap,\n    baseMargins: [number, number, number, number],\n    resolution: number,\n    legendPosition: string\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    let marginsLegend;\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      // Move the legend to the correct position on the page\n      if (legendPosition === 'bottomright') {\n        marginsLegend = [\n          doc.internal.pageSize.height - baseMargins[2] - imageSize[1],\n          baseMargins[1],\n          baseMargins[2],\n          doc.internal.pageSize.width - baseMargins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'topright') {\n        marginsLegend = [\n          baseMargins[0],\n          baseMargins[1],\n          doc.internal.pageSize.height - baseMargins[0] - imageSize[1],\n          doc.internal.pageSize.width - baseMargins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'bottomleft') {\n        // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n        marginsLegend = [\n          doc.internal.pageSize.height - baseMargins[2] - imageSize[1],\n          doc.internal.pageSize.width - baseMargins[3] - imageSize[0],\n          baseMargins[2],\n          baseMargins[3]\n        ];\n      } else if (legendPosition === 'topleft') {\n        marginsLegend = [\n          baseMargins[0],\n          doc.internal.pageSize.width - baseMargins[3] - imageSize[0],\n          doc.internal.pageSize.height - baseMargins[0] - imageSize[1],\n          baseMargins[3]\n        ];\n      }\n      this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n      await this.saveDoc(doc);\n    }\n  }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jsPDF,\n    canvas: HTMLCanvasElement,\n    baseMargins: [number, number, number, number]\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      if (image.length < 20) {\n        console.log('Warning: An image cannot be print in pdf file');\n        return;\n      }\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, baseMargins);\n      doc.addImage(\n        image,\n        'PNG',\n        baseMargins[3],\n        baseMargins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(baseMargins[3], baseMargins[0], imageSize[0], imageSize[1]);\n      this.imgSizeAdded = imageSize; // keep img size for georef later\n    }\n  }\n\n  // TODO fix printing with image resolution\n  addMap(\n    doc: jsPDF,\n    map: IgoMap,\n    resolution: number,\n    imageDimensions: [number, number],\n    baseMargins: [number, number, number, number],\n    legendPostion: PrintLegendPosition\n  ) {\n    const mapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n    const dimensionPixels = this.setMapResolution(\n      map,\n      imageDimensions,\n      resolution,\n      viewResolution\n    );\n    const status$ = new Subject();\n\n    let timeout;\n    map.ol.once('rendercomplete', async (event: any) => {\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n\n      const mapResultCanvas = await this.drawMap(dimensionPixels, mapCanvas);\n\n      this.mapPrintExtent = map.viewController.getExtent('EPSG:3857');\n\n      this.resetOriginalMapSize(map, mapSize, viewResolution);\n\n      await this.drawMapControls(map, mapResultCanvas, legendPostion);\n\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n        mapStatus$$.unsubscribe();\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, baseMargins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, baseMargins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        this.resetOriginalMapSize(map, mapSize, viewResolution);\n        status$.next(status);\n      }, 200);\n    });\n\n    return status$;\n  }\n\n  private setMapResolution(\n    map: IgoMap,\n    initialSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): [number, number] {\n    const mapSize = map.ol.getSize();\n    const widthPixels = Math.round((initialSize[0] * resolution) / 25.4);\n    const heightPixels = Math.round((initialSize[1] * resolution) / 25.4);\n\n    // Set print size\n    const printSize = [widthPixels, heightPixels];\n    map.ol.setSize(printSize);\n    const scaling = Math.min(\n      widthPixels / mapSize[0],\n      heightPixels / mapSize[1]\n    );\n    map.ol.getView().setResolution(viewResolution / scaling);\n\n    return [widthPixels, heightPixels];\n  }\n\n  private resetOriginalMapSize(\n    map: IgoMap,\n    initialSize: [number, number],\n    viewResolution: number\n  ) {\n    map.ol.setSize(initialSize);\n    map.ol.getView().setResolution(viewResolution);\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  async drawMap(\n    size: Array<number>,\n    mapCanvas: HTMLCollectionOf<HTMLCanvasElement>\n  ): Promise<HTMLCanvasElement> {\n    const mapResultCanvas = document.createElement('canvas');\n    mapResultCanvas.width = size[0];\n    mapResultCanvas.height = size[1];\n\n    for (let index = 0; index < mapCanvas.length; index++) {\n      const canvas = mapCanvas[index];\n      if (canvas.width > 0) {\n        this.handleCanvas(canvas, mapResultCanvas);\n      }\n    }\n    return mapResultCanvas;\n  }\n\n  private handleCanvas(\n    canvas: HTMLCanvasElement,\n    mapResultCanvas: HTMLCanvasElement\n  ) {\n    const mapContextResult = mapResultCanvas.getContext('2d');\n    const opacity = canvas.parentElement.style.opacity || canvas.style.opacity;\n    mapContextResult.globalAlpha = opacity === '' ? 1 : Number(opacity);\n    const transform = canvas.style.transform;\n    let matrix: number[];\n    if (transform) {\n      // Get the transform parameters from the style's transform matrix\n      matrix = transform\n        .match(/^matrix\\(([^\\(]*)\\)$/)[1]\n        .split(',')\n        .map(Number);\n    } else {\n      matrix = [\n        parseFloat(canvas.style.width) / canvas.width,\n        0,\n        0,\n        parseFloat(canvas.style.height) / canvas.height,\n        0,\n        0\n      ];\n    }\n    CanvasRenderingContext2D.prototype.setTransform.apply(\n      mapContextResult,\n      matrix\n    );\n    const backgroundColor = canvas.parentElement.style.backgroundColor;\n    if (backgroundColor) {\n      mapContextResult.fillStyle = backgroundColor;\n      mapContextResult.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    mapContextResult.drawImage(canvas, 0, 0);\n    mapContextResult.globalAlpha = 1;\n    // reset canvas transform to initial\n    mapContextResult.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  async drawMapControls(\n    map: IgoMap,\n    canvas: HTMLCanvasElement,\n    position: PrintLegendPosition\n  ): Promise<void> {\n    const context = canvas.getContext('2d');\n    // Get the scale and attribution\n    // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n    const mapOverlayHTML = map.ol\n      .getOverlayContainerStopEvent()\n      .cloneNode(true) as HTMLElement;\n    // add North Direction to mapOverly\n    await this.addNorthDirection(mapOverlayHTML, position);\n    // add map Attribution designe to print\n    await this.addAttribution(mapOverlayHTML);\n\n    // set 'OverlayContainer' size to print size\n    mapOverlayHTML.style.width = canvas.width + 'px';\n    mapOverlayHTML.style.height = canvas.height + 'px';\n    // we add zindex -1 to not show modification to the user\n    mapOverlayHTML.style.zIndex = '-1';\n    // and make sure html2canvas to render the image correctly\n    document\n      .getElementsByClassName('ol-viewport')[0]\n      .appendChild(mapOverlayHTML);\n    // Change the styles of hyperlink in the printed version\n    // Transform the Overlay into a canvas\n    // scale is necessary to make it in google chrome\n    // background as null because otherwise it is white and cover the map\n    // allowtaint is to allow rendering images in the attributions\n    // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n    const canvasOverlayHTML = await html2canvas(mapOverlayHTML, {\n      scale: 1,\n      backgroundColor: null,\n      allowTaint: true,\n      useCORS: true\n    });\n\n    if (canvasOverlayHTML.width !== 0 && canvasOverlayHTML.height !== 0) {\n      context.drawImage(canvasOverlayHTML, 0, 0);\n    }\n\n    // remove 'mapOverlayHTML' after generating canvas\n    mapOverlayHTML.remove();\n  }\n\n  private async addNorthDirection(\n    mapOverlayHTML: HTMLElement,\n    position: PrintLegendPosition\n  ): Promise<void> {\n    const northDirection = document\n      .getElementsByTagName('igo-rotation-button')[0]\n      .cloneNode(true) as HTMLElement;\n    const HTMLButton = northDirection.getElementsByTagName(\n      'button'\n    )[0] as HTMLElement;\n    if (!HTMLButton) {\n      return null;\n    }\n    // in case legend position is topright\n    // we change rotate btn to topleft\n    if (position === 'topright') {\n      northDirection.style.width = 'inherit';\n      northDirection.style.left = '10px';\n    }\n    HTMLButton.parentElement.style.background = 'transparent';\n    HTMLButton.style.color = '#000';\n    mapOverlayHTML.appendChild(northDirection);\n  }\n\n  private async addAttribution(mapOverlayHTML: HTMLElement): Promise<void> {\n    const HTMLattribution =\n      mapOverlayHTML.getElementsByClassName('ol-attribution')[0];\n    const HTMLButton = HTMLattribution.getElementsByTagName('button')[0];\n    if (!HTMLButton) {\n      return null;\n    }\n    HTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n    const olCollapsed: boolean =\n      HTMLattribution.classList.contains('ol-collapsed');\n    if (olCollapsed) {\n      HTMLattribution.classList.remove('ol-collapsed');\n    }\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    printResolution: PrintResolution,\n    format = 'png',\n    projection = false,\n    scale = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true,\n    legendPosition: PrintLegendPosition\n  ) {\n    const status$ = new Subject();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    format = format.toLowerCase();\n    const resolution = +printResolution;\n    const initialMapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n\n    map.ol.once('rendercomplete', async (event: any) => {\n      const size = map.ol.getSize();\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n      const mapResultCanvas = await this.drawMap(size, mapCanvas);\n\n      this.resetOriginalMapSize(map, initialMapSize, viewResolution);\n\n      await this.drawMapControls(map, mapResultCanvas, legendPosition);\n      // Check the legendPosition\n      if (legendPosition !== 'none') {\n        if (\n          ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n            legendPosition\n          ) > -1\n        ) {\n          await this.addLegendToImage(\n            mapResultCanvas,\n            map,\n            resolution,\n            legendPosition,\n            format\n          );\n        } else if (legendPosition === 'newpage') {\n          await this.getLayersLegendImage(map, format, doZipFile, resolution);\n        }\n      }\n      // add other information to final canvas before exporting\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Get height/width of map canvas\n      const width = mapResultCanvas.width;\n      let height = mapResultCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n\n      if (['bmp', 'gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\n        // Patch Jpeg default black background to white\n        if (\n          format === 'jpeg' ||\n          title !== '' ||\n          subtitle !== '' ||\n          comment !== '' ||\n          projection !== false ||\n          scale !== false\n        ) {\n          newContext.fillStyle = '#ffffff';\n          newContext.fillRect(0, 0, width, height);\n          newContext.fillStyle = '#000000';\n        }\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection or/end scale need to be added to canvas\n      if (projection !== false || scale !== false) {\n        let projectionScaleText = '';\n        if (projection !== false) {\n          const projText = translate.instant('igo.geo.printForm.projection');\n          projectionScaleText = projText + ': ' + map.projection + '         ';\n        }\n\n        if (scale !== false) {\n          const scaleText = translate.instant('igo.geo.printForm.scale');\n          const mapScale = map.viewController.getScale(resolution);\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n        }\n        newContext.textAlign = 'center';\n        newContext.fillText(\n          projectionScaleText,\n          width / 2,\n          positionHProjScale,\n          width * 0.9\n        );\n      }\n\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n\n      newContext.drawImage(mapResultCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt =\n          'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt =\n          fileNameWithExt.substring(\n            0,\n            fileNameWithExt.toLowerCase().indexOf('.tiff')\n          ) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt, blob);\n        }\n      }\n    });\n\n    this.setMapImageResolution(map, initialMapSize, resolution, viewResolution);\n\n    return status$;\n  }\n\n  private setMapImageResolution(\n    map: IgoMap,\n    initialMapSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): void {\n    const scaleFactor = resolution / 96;\n    const newMapSize = [\n      Math.round(initialMapSize[0] * scaleFactor), // width\n      Math.round(initialMapSize[1] * scaleFactor) // height\n    ];\n    map.ol.setSize(newMapSize);\n    const scaling = Math.min(\n      newMapSize[0] / initialMapSize[0],\n      newMapSize[1] / initialMapSize[1]\n    );\n    const view = map.ol.getView();\n    view.setResolution(viewResolution / scaling);\n    map.ol.renderSync();\n  }\n\n  /**\n   * Create and Add Legend to the map canvas\n   * @param  canvas Canvas of the map\n   * @param  map Map of the app\n   * @param  resolution Resolution of map\n   * @param  legendPosition Legend position\n   * @param  format Image format\n   */\n  private async addLegendToImage(\n    canvas: HTMLCanvasElement,\n    map: IgoMap,\n    resolution: number,\n    legendPosition: string,\n    format: string\n  ) {\n    const fileNameWithExt = 'map.' + format;\n    const context = canvas.getContext('2d');\n\n    // Get html code for the legend\n    const html = await this.getLayersLegendHtml(\n      map,\n      canvas.width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch(\n      (e) => {\n        console.log(e);\n      }\n    );\n\n    if (canvasLegend) {\n      const canvasHeight = canvas.height;\n      const canvasWidth = canvas.width;\n      const legendHeight = canvasLegend.height;\n      const legendWidth = canvasLegend.width;\n      // Move the legend to the correct position on the page\n      const offset = canvasHeight * 0.01;\n      let legendX: number;\n      let legendY: number;\n\n      if (legendPosition === 'bottomright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = offset;\n      } else if (legendPosition === 'bottomleft') {\n        legendX = offset;\n        legendY = canvasHeight - legendHeight - offset - 15;\n      } else if (legendPosition === 'topleft') {\n        legendX = offset;\n        legendY = offset;\n      }\n\n      context.drawImage(\n        canvasLegend,\n        legendX,\n        legendY,\n        legendWidth,\n        legendHeight\n      );\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\n      this.removeHtmlElement(div);\n      return true;\n    }\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jsPDF) {\n    await doc.save('map_georef.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\n\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      canvas.toBlob((blob) => {\n        // download image\n        saveAs(blob, nameWithExt);\n        that.saveFileProcessing();\n      }, blobFormat);\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n\n  private pdf_units2points(n, unit): number {\n    let k = 1;\n\n    // this code is borrowed from jsPDF\n    //  as it does not expose a public API\n    //  for converting units to points.\n    switch (unit) {\n      case 'pt':\n        k = 1;\n        break;\n      case 'mm':\n        k = 72 / 25.4;\n        break;\n      case 'cm':\n        k = 72 / 2.54;\n        break;\n      case 'in':\n        k = 72;\n        break;\n      case 'px':\n        k = 96 / 72;\n        break;\n      case 'pc':\n        k = 12;\n        break;\n      case 'em':\n        k = 12;\n        break;\n      case 'ex':\n        k = 6;\n        break;\n      default:\n        throw new Error('Invalid unit: ' + unit);\n    }\n\n    return n * k;\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport {\n  LegendMapViewOptions,\n  OutputLayerLegend\n} from '../shared/layers/legend.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(\n  layers: Layer[],\n  view?: LegendMapViewOptions\n): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) {\n      continue;\n    }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) {\n        continue;\n      }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display:\n          legendOptions?.display === undefined ? true : legendOptions.display,\n        isInResolutionsRange: layer.isInResolutionsRange\n      });\n    }\n  }\n\n  return legends;\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = ['72', '96', '150', '300'] as const;\nexport type PrintResolution = (typeof PrintResolution)[number];\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import {\n  AfterViewInit,\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output,\n  Self\n} from '@angular/core';\n\nimport OlFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport { EventsKey } from 'ol/events';\nimport OlLayer from 'ol/layer/Layer';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Observable, Subscription, of, zip } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { QueryableDataSourceOptions } from './query.interfaces';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]',\n  standalone: true\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map as any as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if (\n            (layer.dataSource.options as QueryableDataSourceOptions)\n              .queryFormatAsWms\n          ) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer)\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter((layer) => layer instanceof VectorLayer && layer.visible)\n        .map((layer) => {\n          const featuresOL = layer.dataSource.ol as olVectorSource;\n          featuresOL.forEachFeatureIntersectingExtent(\n            dragExtent,\n            (olFeature: any) => {\n              const newFeature: Feature = featureFromOl(\n                olFeature,\n                this.map.projection,\n                layer.ol\n              );\n              newFeature.meta = {\n                id: layer.id + '.' + olFeature.getId(),\n                icon: olFeature.values_._icon,\n                sourceTitle: layer.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          );\n        });\n    }\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","export enum QueryFormat {\r\n  GML2 = 'gml2',\r\n  GML3 = 'gml3',\r\n  JSON = 'json',\r\n  GEOJSON = 'geojson',\r\n  GEOJSON2 = 'geojson2',\r\n  ESRIJSON = 'esrijson',\r\n  TEXT = 'text',\r\n  HTML = 'html',\r\n  HTMLGML2 = 'htmlgml2'\r\n}\r\n\r\nexport enum QueryFormatMimeType {\r\n  GML2 = 'application/vnd.ogc.gml',\r\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\r\n  JSON = 'application/json',\r\n  GEOJSON = 'application/geojson',\r\n  GEOJSON2 = 'geojson',\r\n  ESRIJSON = 'application/json',\r\n  TEXT = 'text/plain',\r\n  HTML = 'text/html',\r\n  HTMLGML2 = 'text/html'\r\n}\r\n\r\nexport enum QueryHtmlTarget {\r\n  IFRAME = 'iframe',\r\n  BLANK = '_blank'\r\n}\r\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\nimport { uuid } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport * as olextent from 'ol/extent';\nimport * as olformat from 'ol/format';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport * as olgeom from 'ol/geom';\n\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport { default as striptags } from 'striptags';\n\nimport {\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../feature/shared/feature.interfaces';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapExtent } from '../../map/shared/map.interface';\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryUrlData,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService\n  ) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach((id) => {\n        this.messageService.remove(id);\n      });\n    }\n\n    const newLayers = layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n    // the directive accept array in this format [observable, observable...]\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\n    // so we need to flat the array\n    let flatArray = [].concat.apply([], newLayers);\n    return flatArray;\n  }\n\n  queryLayer(\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> | Observable<Feature[]>[] {\n    const url = this.getQueryUrl(\n      layer.dataSource,\n      options,\n      false,\n      layer.map.viewController.getExtent()\n    );\n    if (!url) {\n      return of([]);\n    }\n\n    const resolution: number = layer.map.viewController.getResolution();\n    const scale: number = layer.map.viewController.getScale();\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      if (typeof url === 'string') {\n        const urlGml = this.getQueryUrl(\n          layer.dataSource,\n          options,\n          true\n        ) as string;\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\n          mergeMap((gmlRes) => {\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\n            const imposedGeom = mergedGML[0];\n            const imposedProperties = mergedGML[1];\n            return this.http\n              .get(url, { responseType: 'text' })\n              .pipe(\n                map((res) =>\n                  this.extractData(\n                    res,\n                    layer,\n                    options,\n                    url,\n                    imposedGeom,\n                    imposedProperties\n                  )\n                )\n              );\n          })\n        );\n      }\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\n      let observables: any = [];\n      for (let i = 0; i < urlGmls.length; i++) {\n        const element = urlGmls[i] as QueryUrlData;\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          observables.push(\n            this.requestDataForHTMLGML2(element.url, url[i].url, layer, options)\n          );\n        }\n      }\n      return observables;\n    } else {\n      if (typeof url === 'string') {\n        const request = this.http.get(url, { responseType: 'text' });\n        return request.pipe(\n          map((res) => this.extractData(res, layer, options, url))\n        );\n      }\n      let observables: any = [];\n      for (let i = 0; i < url.length; i++) {\n        const element: QueryUrlData = url[i];\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          const request = this.http.get(element.url, { responseType: 'text' });\n          observables.push(\n            request.pipe(\n              map((res) => this.extractData(res, layer, options, element.url))\n            )\n          );\n        }\n      }\n      return observables;\n    }\n  }\n\n  private requestDataForHTMLGML2(\n    urlGml: string,\n    url: string,\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> {\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\n      mergeMap((gmlRes) => {\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\n        const imposedGeom = mergedGML[0];\n        const imposedProperties = mergedGML[1];\n        return this.http\n          .get(url, { responseType: 'text' })\n          .pipe(\n            map((res) =>\n              this.extractData(\n                res,\n                layer,\n                options,\n                url,\n                imposedGeom,\n                imposedProperties\n              )\n            )\n          );\n      })\n    );\n  }\n\n  private checkScaleAndResolution(\n    resolution: number,\n    scale: number,\n    element: QueryUrlData\n  ): boolean {\n    let checkScale: boolean;\n    let checkResolution: boolean;\n\n    if (\n      !element.minResolution &&\n      !element.maxResolution &&\n      !element.minScale &&\n      !element.maxScale\n    ) {\n      return true;\n    } else {\n      /******************* checking Resolution *******************/\n      if (element.minResolution && element.maxResolution) {\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\n        if (\n          resolution >= element.minResolution &&\n          resolution <= element.maxResolution\n        ) {\n          checkResolution = true;\n        }\n      } else {\n        // check if \"minResolution\" or \"maxResolution\" exists\n        if (element.minResolution && resolution >= element.minResolution) {\n          checkResolution = true;\n        }\n        if (element.maxResolution && resolution <= element.maxResolution) {\n          checkResolution = true;\n        }\n      }\n\n      /******************* checking Scale *******************/\n      if (element.minScale && element.maxScale) {\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\n        if (scale > element.minScale && scale < element.maxScale) {\n          checkScale = true;\n        }\n      } else {\n        // check if \"minScale\" or \"maxScale\" exists\n        if (element.maxScale && scale <= element.maxScale) {\n          checkScale = true;\n        }\n        if (element.minScale && scale >= element.minScale) {\n          checkScale = true;\n        }\n      }\n\n      /******************* result of checking *******************/\n      if (checkScale === true && checkResolution === true) {\n        return true;\n      } else if (\n        (checkResolution === true && !checkScale) ||\n        (checkScale === true && !checkResolution)\n      ) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  private mergeGML(\n    gmlRes,\n    url,\n    layer: Layer\n  ): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map((feature) => {\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent\n            ? queryTitleContent\n            : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = (\n        feature.getGeometry() as any\n      ).getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n        break;\n      case 'Point':\n        returnGeometry = olmpts;\n        break;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [returnGeometry, imposedProperties];\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n    if (\n      features.length > 0 &&\n      (features[0].geometry === null || !features[0].geometry)\n    ) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT\n      ? new RegExp('FEATURE_COUNT=' + this.featureCount)\n      : new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT &&\n        this.featureCount > 1 &&\n        features.length === this.featureCount) ||\n        (!wmsDatasource.params?.FEATURE_COUNT &&\n          features.length === this.defaultFeatureCount))\n    ) {\n      const messageObj = this.messageService.info(\n        'igo.geo.query.featureCountMax',\n        undefined,\n        undefined,\n        { value: layer.title }\n      );\n      this.previousMessageIds.push(messageObj.toastId);\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(\n      (feature) =>\n        (feature.meta = {\n          id: uuid(),\n          order: 1000 - zIndex,\n          alias: allowedFieldsAndAlias\n        })\n    );\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const body = striptags(\n      res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '')\n    );\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign(\n          { target: htmlTarget, body: res, url },\n          imposedProperties\n        ),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach((pair) => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.SHAPE_S;\n    delete properties.SHAPE_L;\n    delete properties.SHAPE_P;\n    delete properties.the_geom;\n    delete properties.geom;\n    delete properties.geom32198;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string | QueryUrlData[] {\n    let url;\n\n    if (datasource.options.queryUrls) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT:\n            wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision\n          ? tileArcGISRestDatasource.options.queryPrecision\n          : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      (key) => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent\n  ): QueryUrlData[] {\n    const extent = olextent.getForViewAndSize(\n      options.coordinates,\n      options.resolution,\n      0,\n      [101, 101]\n    );\n\n    return datasource.options.queryUrls.map((item) => {\n      let data: QueryUrlData = {\n        url: item.url\n          .replace(/\\{bbox\\}/g, extent.join(','))\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:', ''))\n      };\n\n      // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\n      // we need to check \"mapExtent\" befor replace variables in the url\n      if (mapExtent) {\n        data.url\n          .replace(/\\{xmin\\}/g, mapExtent[0].toString())\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\n      }\n\n      if (item.maxResolution) {\n        data.maxResolution = item.maxResolution;\n      }\n\n      if (item.minResolution) {\n        data.minResolution = item.minResolution;\n      }\n\n      if (item.minScale) {\n        data.minScale = item.minScale;\n      }\n\n      if (item.maxScale) {\n        data.maxScale = item.maxScale;\n      }\n\n      return data;\n    });\n  }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined\n    ? dataSource.options.queryLayerFeatures === true\n    : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined\n    ? false\n    : layerIsQueryable(layer) && layerFeatureIsQueryable(layer);\n}\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{ empty: empty$ | async }\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{ label }}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{ hasSearchIcon: showSearchButton }\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"\n        placeholder\n          ? placeholder\n          : (placeholder$ | async)\n            ? (placeholder$.value | translate)\n            : undefined\n      \"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n    />\n    <button\n      *ngIf=\"(empty$ | async) === false\"\n      mat-icon-button\n      matSuffix\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"withDivider\" [vertical]=\"true\"></mat-divider>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      *ngIf=\"showSearchButton\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"handleSearch()\"\n    >\n      <mat-icon>search</mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\"\n    >\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"\n        reverseSearchCoordsFormatStatus.emit($event)\n      \"\n      (searchSourceChange)=\"onSearchSettingsChange()\"\n    >\n    </igo-search-settings>\n  </div>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { SearchSelectorComponent } from '../search-selector/search-selector.component';\nimport { SearchSettingsComponent } from '../search-settings/search-settings.component';\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { Research, SearchResult } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgClass,\n    MatFormFieldModule,\n    NgIf,\n    MatInputModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatDividerModule,\n    SearchSelectorComponent,\n    SearchSettingsComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * whether to show search button or not\n   */\n\n  public showSearchButton: boolean = false;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  @Input() withDivider: boolean;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format setting is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * When reverse coordinates status change\n   */\n  @Input()\n  get reverseSearchCoordsFormatEnabled(): boolean {\n    return this._reverseSearchCoordsFormatEnabled;\n  }\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\n    this._reverseSearchCoordsFormatEnabled = value;\n    this.setTerm(this.term, true);\n  }\n  private _reverseSearchCoordsFormatEnabled = false;\n\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() appearance: MatFormFieldAppearance = 'fill';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private configService: ConfigService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(debounce(() => timer(this.debounce)))\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n\n    const configValue = this.configService.getConfig(\n      'searchBar.showSearchButton'\n    );\n    this.showSearchButton = configValue !== undefined ? configValue : false;\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string, reverseCoordEvent?: boolean) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term && !reverseCoordEvent) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  handleSearch(): void {\n    this.doSearch(this.term);\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (\n      this.termSplitter &&\n      rawTerm.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = rawTerm\n        .split(this.termSplitter)\n        .filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(\n        this.searchService.search(term, {\n          forceNA: this.forceNA\n        })\n      );\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.layer.saveFeatureInLayer' | translate }}\n</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        [showIcons]=\"true\"\n      >\n      </igo-search-results-item>\n    </igo-list>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          placeholder=\"{{ 'igo.geo.layer.chooseOrSet' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\"\n        />\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option\n            *ngFor=\"let layer of filteredLayers$ | async\"\n            [value]=\"layer\"\n          >\n            <p matListItemTitle>{{ layer.title }}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.layer.cancelBtn' | translate }}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\"\n    >\n      {{ 'igo.geo.layer.saveBtn' | translate }}\n    </button>\n  </div>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport { Component, Inject, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Observable } from 'rxjs';\nimport { map, startWith } from 'rxjs/operators';\n\nimport { Layer } from '../../layer/shared';\nimport { SearchResult } from '../shared';\nimport { SearchResultsItemComponent } from './search-results-item.component';\n\n@Component({\n  selector: 'igo-save-feature-dialog',\n  templateUrl: './save-feature-dialog.component.html',\n  styleUrls: ['./save-feature-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    ListComponent,\n    SearchResultsItemComponent,\n    ListItemDirective,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatListModule,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SaveFeatureDialogComponent implements OnInit {\n  public form: UntypedFormGroup;\n  feature: SearchResult;\n  layers: Layer[] = [];\n  filteredLayers$: Observable<Layer[]>;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { feature: SearchResult; layers: Layer[] }\n  ) {\n    this.form = this.formBuilder.group({\n      layerName: ['', [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.feature = this.data.feature;\n    this.layers = this.data.layers;\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\n      startWith(''),\n      map((val) => this.filter(val))\n    );\n  }\n\n  private filter(val): Layer[] {\n    if (typeof val !== 'string') {\n      return;\n    }\n    return this.layers\n      .map((l) => l)\n      .filter((layer) =>\n        layer?.title?.toLowerCase().includes(val.toLowerCase())\n      );\n  }\n\n  displayFn(layer: Layer): string {\n    return layer && layer.title ? layer.title : '';\n  }\n\n  save() {\n    const data: { layer: string | Layer; feature: SearchResult } = {\n      layer: this.form.value.layerName,\n      feature: this.feature\n    };\n    this.dialogRef.close(data);\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","<button\n  igoStopPropagation\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n  *ngIf=\"layer.meta.dataType === 'Layer'\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"computeTooltip() | translate\"\n  [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n  (click)=\"onToggleClick($event)\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    [igoMatBadgeIcon]=\"getBadgeIcon()\"\n    igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n    igoMatBadgeBackgroundColor=\"none\"\n    [igoMatBadgeInverseColor]=\"true\"\n    [matBadgeHidden]=\"\n      ((inRange$ | async) && (isVisible$ | async) === true) ||\n      ((inRange$ | async) && !added) ||\n      ((inRange$ | async) && (isPreview$ | async))\n    \"\n    [matBadgeDisabled]=\"(inRange$ | async) === false\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    >{{ (isPreview$ | async) ? 'add' : added ? 'delete' : 'add' }}\n  </mat-icon>\n</button>\n\n<button\n  [id]=\"!isMobile ? 'hide-save-search-result-btn' : ''\"\n  igoStopPropagation\n  *ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"addFeatureToLayerTooltip$ | async | translate\"\n  (click)=\"addFeatureToLayer()\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    igoMatBadgeIcon=\"visibility_off\"\n    [igoMatBadgeInverseColor]=\"true\"\n    [matBadgeHidden]=\"inRange$ | async\"\n    [matBadgeDisabled]=\"true\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    >add_to_photos\n  </mat-icon>\n</button>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { EntityStore } from '@igo2/common/entity';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { Media, MediaService } from '@igo2/core/media';\n\nimport OlOverlay from 'ol/Overlay';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport Circle from 'ol/style/Circle';\nimport Fill from 'ol/style/Fill';\nimport Stroke from 'ol/style/Stroke';\nimport Style from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription, take } from 'rxjs';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { getTooltipsOfOlGeometry } from '../../measure';\nimport { QueryableDataSourceOptions } from '../../query/shared';\nimport { SearchResult } from '../shared/search.interfaces';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    StopPropagationDirective,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> =\n    new BehaviorSubject('igo.geo.search.addToLayer');\n\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * show hide save search result in layer button\n   */\n  @Input() saveSearchResultInLayer: boolean = false;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input() stores: FeatureStore<Feature>[] = [];\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-search-layer')\n    );\n  }\n  private mediaService$$: Subscription;\n  public isMobile: boolean = false;\n  constructor(\n    private layerService: LayerService,\n    private dialog: MatDialog,\n    private dataSourceService: DataSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    // check the view if is mobile or not\n    this.mediaService$$ = this.mediaService.media$.subscribe((media: Media) => {\n      if (media === Media.Mobile) {\n        this.isMobile = true;\n      }\n    });\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          (lay) => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (value) => {\n        this.isInResolutionsRange(value);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(currEvent: Event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    const event = currEvent ? currEvent : ({} as Event);\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap(event);\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map((s) => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap(event?: Event) {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService.createAsyncLayer(layerOptions).subscribe((layer) => {\n        if (event.type === 'click') {\n          this.map.layersAddedByClick$.next([layer]);\n        }\n        this.map.addLayer(layer);\n      })\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.data?.sourceOptions?.id) {\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.value) {\n      return this.isVisible$.value ? '' : 'visibility_off';\n    } else {\n      return 'visibility_off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n\n  addFeatureToLayer() {\n    if (this.layer.meta.dataType !== 'Feature') {\n      return;\n    }\n\n    const selectedFeature = this.layer;\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\n      width: '700px',\n      data: {\n        feature: selectedFeature,\n        layers: this.allLayers\n      }\n    });\n\n    dialogRef\n      .afterClosed()\n      .subscribe((data: { layer: string | any; feature: SearchResult }) => {\n        if (data) {\n          if (this.stores.length > 0) {\n            this.stores.map((store) => {\n              store.state.updateAll({ selected: false });\n              if (store?.layer) {\n                store.layer.visible = false;\n              }\n              return store;\n            });\n          }\n          // check if is new layer\n          if (typeof data.layer === 'string') {\n            this.createLayer(data.layer, data.feature);\n          } else {\n            const activeStore = this.stores.find(\n              (store) => store.layer.id === data.layer.id\n            );\n            activeStore.layer.visible = true;\n            activeStore.layer.opacity = 1;\n            this.addFeature(data.feature, activeStore);\n          }\n        }\n      });\n  }\n\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\n      map: this.map\n    });\n\n    const styles = [\n      new Style({\n        image: new Circle({\n          radius: 5,\n          stroke: new Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new Fill({\n            color: 'rgba(143,7,7,1)'\n          })\n        })\n      }),\n      new Style({\n        stroke: new Stroke({\n          width: 1,\n          color: 'rgba(143,7,7,1)'\n        }),\n        fill: new Fill({\n          color: 'rgba(0, 0, 255, 0.1)'\n        })\n      })\n    ];\n\n    // set layer id\n    let layerCounterID: number = 0;\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-search-layer', ''));\n      layerCounterID = Math.max(numberId, layerCounterID);\n    }\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true\n      } as QueryableDataSourceOptions)\n      .pipe(take(1))\n      .subscribe((dataSource: FeatureDataSource) => {\n        let searchLayer: VectorLayer = new VectorLayer({\n          isIgoInternalLayer: true,\n          id: 'igo-search-layer' + ++layerCounterID,\n          title: layerTitle,\n          source: dataSource,\n          igoStyle: {\n            editable: false,\n            igoStyleObject: {\n              fill: { color: 'rgba(255,255,255,0.4)' },\n              stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n              circle: {\n                fill: { color: 'rgba(255,255,255,0.4)' },\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n                radius: 5\n              }\n            }\n          },\n          style: styles,\n          showInLayerList: true,\n          exportable: true,\n          workspace: {\n            enabled: true\n          }\n        });\n\n        tryBindStoreLayer(activeStore, searchLayer);\n        tryAddLoadingStrategy(\n          activeStore,\n          new FeatureStoreLoadingStrategy({\n            motion: FeatureMotion.None\n          })\n        );\n\n        tryAddSelectionStrategy(\n          activeStore,\n          new FeatureStoreSelectionStrategy({\n            map: this.map,\n            motion: FeatureMotion.None,\n            many: true\n          })\n        );\n\n        activeStore.layer.visible = true;\n        activeStore.source.ol.on(\n          'removefeature',\n          (event: OlVectorSourceEvent) => {\n            const olGeometry = event.feature.getGeometry();\n            this.clearLabelsOfOlGeometry(olGeometry);\n          }\n        );\n\n        this.addFeature(selectedFeature, activeStore);\n        this.stores.push(activeStore);\n      });\n  }\n\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\n    const newFeature = {\n      type: feature.data.type,\n      geometry: {\n        coordinates: feature.data.geometry.coordinates,\n        type: feature.data.geometry.type\n      },\n      projection: feature.data.projection,\n      properties: feature.data.properties,\n      meta: {\n        id: feature.meta.id\n      }\n    };\n    delete newFeature.properties.Route;\n    activeStore.update(newFeature);\n    activeStore.setLayerExtent();\n    activeStore.layer.ol.getSource().refresh();\n  }\n\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n}\n","<mat-list-item\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n>\n  <mat-icon *ngIf=\"icon\" matListItemIcon>{{\n    showIcons ? icon : 'blank'\n  }}</mat-icon>\n\n  <div\n    matListItemTitle\n    *ngIf=\"titleHtml; else normalTitle\"\n    [innerHtml]=\"titleHtml\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"tooltipHtml\"\n    matTooltipClass=\"search-result-tooltip\"\n  ></div>\n  <ng-template #normalTitle>\n    <span\n      matListItemTitle\n      *ngIf=\"!titleHtml\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"title\"\n      >{{ title }}</span\n    >\n  </ng-template>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"withZoomButton\"\n      igoStopPropagation\n      mat-icon-button\n      (click)=\"onZoomHandler()\"\n    >\n      <mat-icon>search</mat-icon>\n    </button>\n\n    <ng-content select=\"[igoSearchItemToolbar]\"> </ng-content>\n  </div>\n</mat-list-item>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  getEntityIcon,\n  getEntityTitle,\n  getEntityTitleHtml\n} from '@igo2/common/entity';\nimport { StopPropagationDirective } from '@igo2/common/stop-propagation';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map/shared/map';\nimport { SearchResult } from '../shared/search.interfaces';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    MatTooltipModule,\n    MatButtonModule,\n    StopPropagationDirective\n  ]\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(\n      this.map.viewController,\n      [olFeature],\n      FeatureMotion.Default\n    );\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    const element = event.target;\n    const type = event.type;\n    switch (type) {\n      case 'mouseenter':\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\n        hideBtn\n          ? hideBtn.setAttribute('id', 'show-save-search-result-btn')\n          : null;\n        break;\n      case 'mouseleave':\n        const showBtn = element.querySelector('#show-save-search-result-btn');\n        showBtn\n          ? showBtn.setAttribute('id', 'hide-save-search-result-btn')\n          : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\n  <ng-template #groupTemplate ngFor let-group [ngForOf]=\"results$ | async\">\n    <igo-collapsible\n      [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\"\n    >\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\"\n        >\n          <ng-container\n            igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{ result: result }\"\n          >\n          </ng-container>\n        </igo-search-results-item>\n      </ng-template>\n      <span\n        class=\"moreResults mat-typography\"\n        *ngIf=\"isMoreResults(group)\"\n        (click)=\"displayMoreResults(group)\"\n      >\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n  </ng-template>\n</igo-list>\n\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\n  <ng-container\n    *ngIf=\"\n      mode === searchResultMode.Grouped;\n      then tabsTemplate;\n      else flatTemplate\n    \"\n  ></ng-container>\n\n  <ng-template #tabsTemplate>\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\n      <mat-tab\n        *ngFor=\"let group of results$ | async\"\n        [label]=\"computeGroupTitle(group)\"\n      >\n        <ng-container\n          *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n        ></ng-container>\n      </mat-tab>\n    </mat-tab-group>\n  </ng-template>\n\n  <ng-template #flatTemplate>\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\n      <ng-container\n        *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n      ></ng-container>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #storeItemTemplate let-group=\"group\">\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [map]=\"map\"\n        [result]=\"result\"\n        [showIcons]=\"showIcons\"\n        [withZoomButton]=\"withZoomButton\"\n        [focused]=\"store.state.get(result).focused\"\n        [selected]=\"store.state.get(result).selected\"\n        (focus)=\"resultFocus.emit(result)\"\n        (unfocus)=\"resultUnfocus.emit(result)\"\n        (select)=\"onResultSelect(result)\"\n        (mouseenter)=\"resultFocus.emit(result)\"\n        (mouseleave)=\"resultUnfocus.emit(result)\"\n      >\n        <ng-container\n          igoSearchItemToolbar\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\n          [ngTemplateOutletContext]=\"{ result: result }\"\n        >\n        </ng-container>\n      </igo-search-results-item>\n    </ng-template>\n    <span\n      class=\"moreResults mat-typography\"\n      *ngIf=\"isMoreResults(group)\"\n      (click)=\"displayMoreResults(group)\"\n    >\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n    </span>\n  </ng-template>\n</igo-list>\n","import { AsyncPipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChild,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { CollapsibleComponent } from '@igo2/common/collapsible';\nimport {\n  EntityState,\n  EntityStore,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreWatcher\n} from '@igo2/common/entity';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, EMPTY, Observable, Subscription, timer } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { Research, SearchResult } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSource } from '../shared/sources/source';\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchResultsItemComponent } from './search-results-item.component';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    ListComponent,\n    NgFor,\n    CollapsibleComponent,\n    NgTemplateOutlet,\n    SearchResultsItemComponent,\n    ListItemDirective,\n    MatTabsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  private showResultsCount: boolean = true;\n\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: { sourceId: string }[] = [];\n\n  public collapsed: { sourceId: string }[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * To check if the view for tabsMode for search-result-tools\n   */\n  @Input() tabsMode: boolean = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {})\n  templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  >;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private searchService: SearchService,\n    private configService: ConfigService\n  ) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n\n    if (\n      this.configService.getConfig('searchSources.showResultsCount') === false\n    ) {\n      this.showResultsCount = false;\n    }\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {\n    source: SearchSource;\n    results: SearchResult[];\n  }): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1 && this.showResultsCount) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, { focused: true, selected: true }, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n  private liftResults(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    return this.store.stateView.all$().pipe(\n      debounce((results: { entity: SearchResult; state: EntityState }[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: { entity: SearchResult; state: EntityState }[]) => {\n        return this.groupResults(\n          results.map((r) => r.entity).sort(this.sortByOrder)\n        );\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(\n    results: SearchResult[]\n  ): { source: SearchSource; results: SearchResult[] }[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return { source, results: grouped.get(source) };\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const stategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    const active = stategy?.active || false;\n    if (!active) {\n      return (\n        group.results &&\n        group.results[group.results.length - 1].meta.nextPage === true\n      );\n    } else {\n      return (\n        group.results?.length % +group.source.params.limit === 0 &&\n        +group.source.params.page < 30\n      );\n    }\n  }\n\n  displayMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (\n      this.termSplitter &&\n      this.term.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map((research) => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({ research, results: newResults });\n      });\n    });\n    return;\n  }\n}\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\"\n  >\n    <mat-icon>arrow_drop_down</mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\"\n  >\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\"\n    >\n      <mat-radio-button\n        *ngFor=\"let searchType of searchTypes\"\n        [value]=\"searchType\"\n      >\n        {{ getSearchTypeTitle(searchType) | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SEARCH_TYPES } from '../shared/search.enums';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatIconModule,\n    MatRadioModule,\n    NgFor,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n}\n","<div class=\"igo-search-settings\">\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\"\n  >\n    <mat-icon>expand_more</mat-icon>\n  </button>\n  <mat-menu #searchSettingsMenu=\"matMenu\" class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length > 4\">\n      <button mat-raised-button (click)=\"checkUncheckAllSources($event)\">\n        {{\n          !searchSourcesAllEnabled\n            ? ('igo.geo.search.searchSources.unselectAll' | translate)\n            : ('igo.geo.search.searchSources.selectAll' | translate)\n        }}\n      </button>\n    </div>\n    <ng-container *ngFor=\"let source of getSearchSources()\">\n      <span class=\"igo-search-settings-search-source\">\n        <mat-checkbox\n          class=\"igo-search-settings-checkbox\"\n          [checked]=\"source.enabled\"\n          [value]=\"$any(source)\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"onCheckSearchSource($event, source)\"\n        >\n        </mat-checkbox>\n        <button\n          *ngIf=\"source.settings.length > 0\"\n          [matMenuTriggerFor]=\"sub_menu\"\n          mat-menu-item\n        >\n          {{ source.title }}\n        </button>\n        <button mat-menu-item *ngIf=\"source.settings.length === 0\">\n          {{ source.title }}\n        </button>\n      </span>\n      <mat-menu #sub_menu=\"matMenu\">\n        <ng-container *ngFor=\"let setting of source.settings\">\n          <button mat-menu-item [matMenuTriggerFor]=\"test_sub_menu\">\n            {{\n              'igo.geo.search.searchSources.settings.' + setting.title\n                | translate\n            }}\n          </button>\n          <mat-menu\n            #test_sub_menu=\"matMenu\"\n            [ngSwitch]=\"setting.type\"\n            yPosition=\"above\"\n          >\n            <span *ngSwitchCase=\"'radiobutton'\">\n              <mat-radio-group\n                class=\"igo-search-settings-radio-group\"\n                [value]=\"setting\"\n              >\n                <mat-radio-button\n                  *ngFor=\"let settingValue of setting.values\"\n                  class=\"mat-typography\"\n                  [value]=\"settingValue\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  [checked]=\"settingValue.enabled\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedRadioButton(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-radio-button>\n              </mat-radio-group>\n            </span>\n            <span *ngSwitchCase=\"'checkbox'\">\n              <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                <button\n                  mat-raised-button\n                  (click)=\"checkUncheckAll($event, source, setting)\"\n                >\n                  {{\n                    setting.allEnabled || setting.allEnabled === undefined\n                      ? ('igo.geo.search.searchSources.settings.unselectAll'\n                        | translate)\n                      : ('igo.geo.search.searchSources.settings.selectAll'\n                        | translate)\n                  }}\n                </button>\n              </div>\n              <div\n                class=\"igo-search-settings-sub-menu\"\n                mat-menu-item\n                *ngFor=\"let settingValue of getAvailableValues(setting)\"\n              >\n                <mat-checkbox\n                  [style.display]=\"displayBlock\"\n                  [checked]=\"settingValue.enabled\"\n                  [value]=\"$any(setting)\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedCheckbox(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-checkbox>\n              </div>\n            </span>\n          </mat-menu>\n        </ng-container>\n      </mat-menu>\n    </ng-container>\n    <mat-divider></mat-divider>\n    <span class=\"pointer-summary-slide-toggle-container\">\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changePointerReverseSearch($event)\"\n          tooltip-position=\"below\"\n          *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.pointerSearchSummary.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"pointerSummaryEnabled\"\n        >\n          {{ 'igo.geo.search.pointerSearchSummary.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changeSearchResultsGeometry($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.searchResultsGeometry.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"searchResultsGeometryEnabled\"\n        >\n          {{ 'igo.geo.search.searchResultsGeometry.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"reverseSearchCoordsFormat($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            reverseSearchCoordsFormatEnabled\n              ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n              : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"reverseSearchCoordsFormatEnabled\"\n        >\n          {{ 'igo.geo.search.reverseCoordFormat.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n    </span>\n  </mat-menu>\n</div>\n","import { NgFor, NgIf, NgSwitch, NgSwitchCase } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  HostListener,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatCheckboxChange,\n  MatCheckboxModule\n} from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport {\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch\n} from '../shared/search.utils';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatIconModule,\n    NgIf,\n    NgFor,\n    MatCheckboxModule,\n    NgSwitch,\n    NgSwitchCase,\n    MatRadioModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ]\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource =\n      this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter(\n      (source) => !source.enabled\n    ).length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') ||\n      {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(source.getId() + '.options', storage);\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n\n  reverseSearchCoordsFormat(event) {\n    this.reverseSearchCoordsFormatEnabled = event.checked;\n    this.reverseSearchCoordsFormatStatus.emit(\n      this.reverseSearchCoordsFormatEnabled\n    );\n  }\n}\n","import {\n  AfterContentChecked,\n  Directive,\n  HostListener,\n  Input,\n  OnDestroy,\n  OnInit,\n  Self\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { MediaService } from '@igo2/core/media';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olgeom from 'ol/geom';\nimport { transform } from 'ol/proj';\n\nimport { Subscription, first } from 'rxjs';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research, SearchResult } from './search.interfaces';\nimport { SearchService } from './search.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]',\n  standalone: true\n})\nexport class SearchPointerSummaryDirective\n  implements OnInit, OnDestroy, AfterContentChecked\n{\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> =\n    new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string =\n    'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  @HostListener('mouseleave')\n  mouseleave() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n        this.subscribeToPointerStore();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (\n        this.store &&\n        !layers.find((l) => l.id === 'searchPointerSummaryId')\n      ) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n    if (\n      !this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      this.hasPointerReverseSearchSource = false;\n    } else {\n      this.hasPointerReverseSearchSource = true;\n    }\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map((result) => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance =\n            closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = {\n              distance: result.data.properties.distance,\n              title\n            };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = {\n            distance: result.data.properties.distance,\n            title\n          };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(\n    resultsUnderPointerPosition: SearchResult[]\n  ) {\n    const closestResultByType = this.computeSummaryClosestFeature(\n      resultsUnderPointerPosition\n    );\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map((result) => {\n      const typeIndex = summarizedClosestType.indexOf(\n        result.data.properties.type\n      );\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (\n          processedSummarizedClosestType.indexOf(\n            result.data.properties.type\n          ) === -1\n        ) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map((s) => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(\n      this.lonLat,\n      { params: { geometry: 'false', icon: 'false' } },\n      true\n    );\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          })\n        );\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore\n      .all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { Workspace } from '@igo2/common/workspace';\n\nimport { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\n    source.setWorkspaces(workspaces);\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { LAYER } from '../../layer/shared/layer.enums';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","import {\n  Inject,\n  Injectable,\n  Optional,\n  WritableSignal,\n  effect,\n  signal\n} from '@angular/core';\n\nimport { AnalyticsService } from '@igo2/core/analytics';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { stringToLonLat } from '../../map/shared/map.utils';\nimport { SearchSourceService } from './search-source.service';\nimport { Research, ReverseSearch, TextSearch } from './search.interfaces';\nimport {\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch\n} from './search.utils';\nimport { SearchSource } from './sources/source';\nimport {\n  ReverseSearchOptions,\n  TextSearchOptions\n} from './sources/source.interfaces';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable()\nexport class SearchService {\n  searchTerm: WritableSignal<string> = signal(null);\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService,\n    private storageService: StorageService,\n    private analyticsService: AnalyticsService,\n    @Inject('searchAnalytics')\n    @Optional()\n    analytics: boolean\n  ) {\n    if (analytics) {\n      this.handleAnalytics();\n    }\n  }\n\n  private handleAnalytics(): void {\n    effect(() => {\n      const term = this.searchTerm();\n      if (term != null) {\n        this.analyticsService.trackSearch(term, null);\n      }\n    });\n  }\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    this.searchTerm.set(term);\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, {\n        distance: response.radius,\n        conf: response.conf\n      });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    const reverseSearchCoordsFormat =\n      (this.storageService.get(\n        'reverseSearchCoordsFormatEnabled'\n      ) as boolean) || false;\n\n    return this.reverseSearchSources(\n      sources,\n      lonLat,\n      options || {},\n      reverseSearchCoordsFormat\n    );\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormat: boolean\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as ReverseSearch).reverseSearch(\n          lonLat,\n          options,\n          reverseSearchCoordsFormat\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchResult } from './search.interfaces';\nimport { SearchSource } from './sources/source';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (\n    (source as any).reverseSearch !== undefined &&\n    source.showInPointerSummary === true\n  );\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  if (feature.properties) {\n    delete feature.properties.geometry;\n    delete feature.properties.GEOMETRIE;\n    delete feature.properties.boundedBy;\n    delete feature.properties.shape;\n    delete feature.properties.SHAPE;\n    delete feature.properties.SHAPE_S;\n    delete feature.properties.SHAPE_L;\n    delete feature.properties.SHAPE_P;\n    delete feature.properties.the_geom;\n    delete feature.properties.geom;\n    delete feature.properties.geom32198;\n  }\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'location_on'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string) {\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(\n  from,\n  to,\n  caseSensitive: boolean = false\n): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = (totalDiff.length / termFrom.length) * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { Workspace } from '@igo2/common/workspace';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { FeatureStore } from '../../../feature/shared/store';\nimport {\n  ISearchSourceParams,\n  SearchSourceOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): ISearchSourceParams | null {\n    return this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\n    this._featureStoresWithIndex = storesWithIndex;\n  }\n  get featureStoresWithIndex() {\n    return this._featureStoresWithIndex;\n  }\n  private _featureStoresWithIndex: FeatureStore[];\n\n  setWorkspaces(workspaces: Workspace[]) {\n    if (\n      workspaces.filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n        .length >= 1\n    ) {\n      this.options.available = true;\n    } else {\n      this.options.available = false;\n    }\n    const values = [];\n    this.featureStoresWithIndex = workspaces\n      .filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n      .map((fw) => {\n        values.push({\n          title: fw.title,\n          value: fw.title,\n          enabled: true\n        });\n        return fw.entityStore as FeatureStore;\n      });\n    const datasets = this.options.settings.find((s) => s.title === 'datasets');\n    if (datasets) {\n      datasets.values = values;\n    }\n    this.setParamFromSetting(datasets);\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach((conf) => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter((s) => s.available !== false)\n          .forEach((conf) => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(this.getId() + '.options', {\n        params: this.options.params\n      });\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(\n    options: SearchSourceOptions,\n    private storageService?: StorageService\n  ) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(\n      this.getDefaultOptions(),\n      this.options\n    );\n\n    // Set Default Params from Settings\n    this.settings.forEach((setting) => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-zÀ-ÿ-+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach((hashtag) => {\n      searchSourceSetting.values.forEach((conf) => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (\n          conf.hashtags &&\n          conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1\n        ) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n","import * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function (feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","import { isValidJSON } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport * as olGeom from 'ol/geom';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\n\nimport { StyleService } from '../../style-service/style.service';\n\nexport function featureRandomStyleFunction(): (\n  olFeature: olFeature<OlGeometry>,\n  resolution: number\n) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  return (olFeature: olFeature<OlGeometry>, resolution: number) => {\n    const customStyle = olFeature.get('_style');\n    if (customStyle && isValidJSON(customStyle)) {\n      if (\n        customStyle.circle &&\n        olFeature.get('rad') &&\n        olFeature.get('longitude') &&\n        olFeature.get('latitude')\n      ) {\n        const lonLat: [number, number] = [\n          olFeature.get('longitude'),\n          olFeature.get('latitude')\n        ];\n        const radius =\n          olFeature.get('rad') /\n          Math.cos((Math.PI / 180) * lonLat[1]) /\n          resolution;\n        customStyle.circle.radius = radius;\n      }\n      const styleService = new StyleService();\n      return styleService.createStyle(customStyle, undefined, resolution);\n    }\n    const style = new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      }),\n      text: olFeature.get('_mapTitle')\n        ? new olStyle.Text({\n            text: olFeature.get('_mapTitle').toString(),\n            offsetX: 5,\n            offsetY: -5,\n            font: '12px Calibri,sans-serif',\n            fill: new olStyle.Fill({ color: '#000' }),\n            stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n            overflow: true\n          })\n        : undefined\n    });\n    return style;\n  };\n}\n\nexport function featureRandomStyle(): olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  const style = new olStyle.Style({\n    stroke,\n    fill,\n    image: new olStyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    })\n  });\n  return style;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarkerStyle(\n  feature: olFeature<olGeom.Geometry>,\n  resolution: number\n): olStyle.Style[] {\n  const olStyleText = new olStyle.Style({\n    text: new olStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n  const olStyles = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyles.push(\n        new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 10,\n            stroke: new olStyle.Stroke({\n              color: 'blue',\n              width: 3\n            })\n          })\n        })\n      );\n      break;\n    default:\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'white',\n            width: 5\n          })\n        })\n      );\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      );\n  }\n\n  return olStyles;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarkerStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style {\n  return new olStyle.Style({\n    image: new olStyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg'\n    }),\n\n    text: new olStyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { asArray as ColorAsArray } from 'ol/color';\nimport * as olstyle from 'ol/style';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (\n    newColor.length === 4 &&\n    (typeof markerColor !== 'string' ||\n      /^#[0-9A-F]{8}$/i.test(markerColor as string))\n  ) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\n\nimport { StyleService } from '../../../style/style-service/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nexport function createOverlayLayerStyle(): (\n  olFeature: OlFeature<OlGeometry>,\n  resolution: number\n) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9]\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport RenderFeature from 'ol/render/Feature';\nimport * as olStyle from 'ol/style';\n\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olStyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(\n    options: { [key: string]: any },\n    feature?: RenderFeature | OlFeature<OlGeometry>,\n    resolution?: number\n  ) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale = options.text?.minScaleDenom\n          ? getResolutionFromScale(Number(options.text.minScaleDenom))\n          : undefined;\n        const labelMaxResolutionFromScale = options.text?.maxScaleDenom\n          ? getResolutionFromScale(Number(options.text.maxScaleDenom))\n          : undefined;\n        const minResolution = options.text?.minResolution\n          ? options.text.minResolution\n          : 0;\n        const maxResolution = options.text?.maxResolution\n          ? options.text.maxResolution\n          : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (\n        options.text?.minScaleDenom ||\n        options.text?.maxScaleDenom ||\n        options.text?.minResolution ||\n        options.text?.maxResolution\n      ) {\n        if (\n          feature &&\n          resolution >= labelMinResolution &&\n          resolution <= labelMaxResolution\n        ) {\n          if (feature && options.text.attribute) {\n            parsedStyle\n              .getText()\n              .setText(this.getLabel(feature, options.text.attribute));\n          }\n        } else {\n          parsedStyle.setText();\n        }\n      }\n    }\n    return parsedStyle;\n  }\n\n  public parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach((_key) => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olStyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olStyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olStyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    styleByAttribute: StyleByAttribute,\n    resolution: number\n  ) {\n    let style;\n    const type = styleByAttribute.type\n      ? styleByAttribute.type\n      : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label\n      ? styleByAttribute.label.attribute\n      : undefined;\n    const labelMinResolutionFromScale = styleByAttribute.label?.minScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom))\n      : undefined;\n    const labelMaxResolutionFromScale = styleByAttribute.label?.maxScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom))\n      : undefined;\n    const minResolution = styleByAttribute.label?.minResolution\n      ? styleByAttribute.label.minResolution\n      : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution\n      ? styleByAttribute.label.maxResolution\n      : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style\n      ? this.parseStyle('text', styleByAttribute.label.style)\n      : undefined;\n    if (!labelStyle && label) {\n      labelStyle = new olStyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (\n        resolution >= labelMinResolution &&\n        resolution <= labelMaxResolution\n      ) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          if (icon) {\n            style = [\n              new olStyle.Style({\n                image: new olStyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text:\n                  labelStyle instanceof olStyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              image: new olStyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olStyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olStyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: 4,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olStyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    resolution: number,\n    clusterParam: ClusterParam = {},\n    layerStyle\n  ) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olStyle.Circle;\n\n            if (r.showRange) {\n              const text = new olStyle.Text({\n                text: size.toString(),\n                fill: new olStyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: clusterRadius,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olStyle.Text({\n              text: size.toString(),\n              fill: new olStyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import { uuid } from '@igo2/utils';\n\nimport { Md5 } from 'ts-md5';\n\nimport { WFSDataSourceOptions } from '../datasource/shared/datasources';\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(\n  options: DataSourceOptions\n): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  if (!options.url) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(\n  options: ArcGISRestDataSourceOptions\n) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(\n    (p) => p.length !== 0 && p.charAt(0) !== '_'\n  );\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\nimport { DirectionsComponent } from './directions.component';\n\n@NgModule({\n  imports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ]\n})\nexport class IgoDirectionsModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else {\n      // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(\n      filterString,\n      wmsDatasource.options.params.LAYERS\n    );\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            options.ogcFilters.filters,\n            options.paramsWFS.fieldNameGeometry\n          );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            // With some wms server, this param must be set to make spatials call.\n            options.ogcFilters.filters,\n            options.fieldNameGeometry\n          );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(\n          options.ogcFilters.filters,\n          undefined,\n          undefined,\n          undefined,\n          wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n  AdmRegion = 'AdmRegion',\n  Mun = 'Mun',\n  Arrond = 'Arrond',\n  CircFed = 'CircFed',\n  CircProv = 'CircProv',\n  DirReg = 'DirReg',\n  MRC = 'MRC',\n  RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n  Predefined = 'Predefined',\n  Polygon = 'Polygon',\n  Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n  Address = 'Address',\n  Thematics = 'Thematics'\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find((key) => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{\n          features: Feature[];\n        }>(this.baseUrl + this.urlFilterList[urlPath])\n        .pipe(\n          map((featureCollection) =>\n            featureCollection.features.map((f) => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach((type) => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name =\n                name.substring(0, 1).toUpperCase() +\n                name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group =\n                substr.substring(0, 1).toUpperCase() +\n                substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name =\n                  name.substring(0, 1).toUpperCase() +\n                  name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map((f) => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode, {\n            params: {\n              geometry: '100',\n              bufferOutput: buffer.toString()\n            }\n          })\n          .pipe(\n            map((f) => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map((f) => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport * as olproj from 'ol/proj';\nimport olProjection from 'ol/proj/Projection';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport {\n  OgcFilterWriter,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared';\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n  constructor(private messageService: MessageService) {}\n\n  open(layer: Layer) {\n    this.messageService.success(\n      'igo.geo.download.start',\n      'igo.geo.download.title'\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0) {\n          currentProj = paramsWFS.srsName\n            ? new olProjection({ code: paramsWFS.srsName })\n            : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined\n              ? ''\n              : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (\n          layer.dataSource.options as OgcFilterableDataSourceOptions\n        ).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter().handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj\n        );\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n          filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    options &&\n    options.download &&\n    (options.download['dynamicUrl'] || options.download['url'])\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\"\n>\n  <mat-icon>download</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            matListItemIcon\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"item.collapsed\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            >expand_less\n          </mat-icon>\n          <span matListItemTitle>{{ computeItemTitle(item) | async }} </span>\n        </mat-list-item>\n        <div\n          #legend\n          class=\"igo-layer-legend\"\n          [ngClass]=\"{ 'with-title': item.title }\"\n        >\n          <div *ngIf=\"currentStyle !== undefined\">\n            <mat-form-field>\n              <mat-select\n                tooltip-position=\"below\"\n                matTooltipShowDelay=\"500\"\n                [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n                [(ngModel)]=\"currentStyle\"\n                (selectionChange)=\"onChangeStyle()\"\n              >\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{\n                  style.title\n                }}</mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!item.collapsed\">\n            <div *ngIf=\"item.url\">\n              <img\n                igoImageError\n                *ngIf=\"item.imgGraphValue\"\n                [hideError]=\"true\"\n                #renderedLegend\n                id=\"{{ item.title }}\"\n                (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{ 'igo.geo.layer.legend.loadingLegendText' | translate }}\"\n              />\n              <small *ngIf=\"imagesHeight[item.title] < 16\">\n                {{ 'igo.geo.layer.legend.noLegendScale' | translate }}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\"\n            ></div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{ 'igo.geo.layer.legend.noLegendText' | translate }}\n    </small>\n  </ng-template>\n</ng-container>\n","import { AsyncPipe, NgClass, NgFor, NgIf, NgStyle } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChildren\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { ImageErrorDirective, SecureImagePipe } from '@igo2/common/image';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { Layer } from '../shared/layers/layer';\nimport {\n  ItemStyleOptions,\n  LegendMapViewOptions\n} from '../shared/layers/legend.interface';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    NgFor,\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    NgClass,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatTooltipModule,\n    FormsModule,\n    MatOptionModule,\n    ImageErrorDirective,\n    NgStyle,\n    AsyncPipe,\n    IgoLanguageModule,\n    SanitizeHtmlPipe\n  ]\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(\n        (style) => style.name === sourceOptions.params.STYLES\n      ).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (\n      typeof this.layer.options.legendOptions !== 'undefined' &&\n      this.layer.options.legendOptions.display === false\n    ) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(\n        this.currentStyle,\n        this.view\n      );\n    }\n\n    if (\n      this.updateLegendOnResolutionChange ||\n      (sourceOptions as WMSDataSourceOptions).contentDependentLegend\n    ) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG\n        .transform(item.url)\n        .pipe(\n          catchError((err) => {\n            if (err.error) {\n              err.error.caught = true;\n              this.getLegend = false;\n              this.cdRef.detectChanges();\n              return err;\n            }\n          })\n        )\n        .subscribe((obsLegGraph) => {\n          const idx = this.legendItems$.value.findIndex(\n            (leg) => leg.title === item.title\n          );\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n    }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(\n      (layer) => layer === layerLegend.title\n    );\n    return this.capabilitiesService.getWMSOptions(localLayerOptions).pipe(\n      map((wmsDataSourceOptions) => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      })\n    );\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(\n      this.currentStyle,\n      this.view\n    );\n    if (this.layer.legend && this.layer.legend.length > 1) {\n      legendItems = this.transfertToggleLegendItem(legendItems);\n    }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(\n          layerOptions.legendOptions.stylesAvailable.filter(\n            (sA) =>\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'default' &&\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'defaut'\n          )\n        );\n      }\n      stylesAvailable\n        .filter((sa) => !sa.title)\n        .map((sa) => (sa.title = sa.name));\n      stylesAvailable.map(\n        (s) =>\n          (s.title =\n            s.title.charAt(0).toUpperCase() +\n            s.title.slice(1).replace(/_/g, ' '))\n      );\n      return stylesAvailable;\n    }\n    return;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol\n        .getParams()\n        .LAYERS.split(',')\n        .map((layer) => (STYLES += this.currentStyle + ','));\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(\n        (renderedLegend) => renderedLegend.nativeElement.id === id\n      ).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olWKT from 'ol/format/WKT';\nimport * as olproj from 'ol/proj';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach((element) => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach((element) => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: { ul?: any; lr?: any; ur?: any; ll?: any } = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [coord.ul[0] + unitPerTypeEW, coord.ul[1] - unitPerTypeSN];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { default as moment } from 'moment';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n  readonly defaultStepMillisecond = 60000;\n\n  constructor() {}\n\n  step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n  }\n\n  stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n    const step = moment\n      .duration(this.step(dataSource, currentFilter))\n      .asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  stepIsYearDuration(step: string) {\n    const year = moment.duration(step);\n    return (\n      year.years() !== 0 &&\n      year.months() === 0 &&\n      year.weeks() === 0 &&\n      year.days() === 0 &&\n      year.hours() === 0 &&\n      year.minutes() === 0\n    );\n  }\n\n  stepIsMonthDuration(step: string) {\n    const month = moment.duration(step);\n    return (\n      month.months() !== 0 &&\n      month.weeks() === 0 &&\n      month.days() === 0 &&\n      month.hours() === 0 &&\n      month.minutes() === 0\n    );\n  }\n\n  stepIsWeekDuration(step: string) {\n    const week = moment.duration(step);\n    return (\n      week.weeks() !== 0 &&\n      week.days() === 7 &&\n      week.hours() === 0 &&\n      week.minutes() === 0\n    );\n  }\n\n  stepIsDayDuration(step: string) {\n    const day = moment.duration(step);\n    return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n  }\n\n  stepIsHourDuration(step: string) {\n    const hour = moment.duration(step);\n    return hour.hours() !== 0 && hour.minutes() === 0;\n  }\n\n  stepIsMinuteDuration(step: string) {\n    const minute = moment.duration(step);\n    return minute.minutes() !== 0;\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate = new Date();\n    if (date) {\n      newDate = new Date(date);\n    }\n    return newDate.getTime();\n  }\n\n  public addStep(value, stepMillisecond) {\n    return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n  }\n\n  public subtractStep(value, stepMillisecond) {\n    return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n  }\n}\n","import {\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSlider, MatSliderModule } from '@angular/material/slider';\n\nimport { default as moment } from 'moment';\n\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss'],\n  standalone: true,\n  imports: [MatSliderModule, FormsModule, MatButtonModule, MatIconModule],\n  providers: [OGCFilterTimeService]\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play_circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat) {\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(\n      this.datasource,\n      this.currentFilter\n    );\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit() {\n    this.calculateStep();\n    this.handleSliderInput({ value: 1 });\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(\n      this.beginMillisecond + (value - 1) * this.stepMillisecond\n    );\n\n    if (\n      this.ogcFilterTimeService.stepIsYearDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .years();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'year')\n        .toDate();\n    } else if (\n      this.ogcFilterTimeService.stepIsMonthDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .months();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'month')\n        .toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        (that) => {\n          if (this.slider.step < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n    this.slider.step = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n      if (\n        this.ogcFilterTimeService.stepIsYearDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .years();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'year')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsMonthDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .months();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'month')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsDayDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsHourDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsMinuteDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const dateTmp = new Date(\n          this.beginMillisecond +\n            this.stepMillisecond * (matSliderChange.value - 1)\n        );\n        this.changeProperty.next({\n          value: dateTmp.toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: new Date(\n            this.ogcFilterTimeService.addStep(\n              dateTmp.toISOString(),\n              this.stepMillisecond\n            )\n          ).toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      }\n    }\n  }\n\n  calculateStep() {\n    for (\n      let i = 1;\n      this.maxMillisecond -\n        (this.beginMillisecond + i * this.stepMillisecond) >=\n      -1;\n      i++\n    ) {\n      this.calculatedStep = i;\n    }\n  }\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    thumbLabel\n    #ngSlider\n    ><input\n      matSliderThumb\n      (input)=\"\n        handleSliderInput({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon>{{ playIcon }}</mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon>{{ resetIcon }}</mat-icon>\n  </button>\n</div>\n","<div class=\"datetime-container\">\n  <mat-slide-toggle\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\"\n  >\n    {{ 'igo.geo.filter.sliderModeTitle' | translate }}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\"\n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.startYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearBegin }}\"\n          (change)=\"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"beginDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #beginYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"\n            endValue && !restrictedToStep()\n              ? endValue\n              : handleDate(datasource.options.maxDate)\n          \"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.endYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearEnd }}\"\n          (change)=\"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"endDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #endYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"endValue ? endValue : handleDate(datasource.options.maxDate)\"\n          [min]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n        />\n      </mat-form-field>\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon>{{ resetIcon }}</mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType() !== 'year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"beginDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"\n              endValue && !restrictedToStep()\n                ? endValue\n                : handleDate(datasource.options.maxDate)\n            \"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option\n                *ngFor=\"let minute of beginMinutes\"\n                [value]=\"minute\"\n                >{{ minute }}</mat-option\n              >\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div *ngIf=\"!restrictedToStep()\" class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"endDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #end\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n            [matDatepickerFilter]=\"filterEndFunction\"\n            [value]=\"\n              endValue ? endValue : handleDate(datasource.options.maxDate)\n            \"\n            [min]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [max]=\"handleDate(datasource.options.maxDate)\"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{\n                minute\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon>{{ resetIcon }}</mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n  </div>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { provideMomentDateAdapter } from '@angular/material-moment-adapter';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { default as moment } from 'moment';\n\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterDuringOptions,\n  OgcFilterableDataSource,\n  OgcFilterableDataSourceOptions\n} from '../shared/ogc-filter.interface';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time-slider.component';\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatSlideToggleModule,\n    FormsModule,\n    OgcFilterTimeSliderComponent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatSelectModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    IgoLanguageModule\n  ],\n  providers: [OGCFilterTimeService, provideMomentDateAdapter()]\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new UntypedFormControl();\n  beginMinuteFormControl = new UntypedFormControl();\n  endHourFormControl = new UntypedFormControl();\n  endMinuteFormControl = new UntypedFormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  private filterOriginConfig: OgcFilterDuringOptions;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate\n      ? this.datasource.options.maxDate\n      : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat\n      ? this.currentFilter.displayFormat\n      : this._defaultDisplayFormat;\n  }\n\n  public filterBeginFunction;\n  public filterEndFunction;\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit() {\n    this.filterOriginConfig = this.datasource.options.ogcFilters\n      .filters as OgcFilterDuringOptions;\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled =\n        this.currentFilter.sliderOptions.enabled !== undefined\n          ? this.currentFilter.sliderOptions.enabled\n          : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    this.dateFilter(this.filterBeginFunction, 'begin');\n    this.dateFilter(this.filterEndFunction, 'end');\n  }\n\n  parseFilter(filter): Date {\n    if (!filter) {\n      return new Date();\n    } else if (isNaN(new Date(filter).getTime())) {\n      if (filter.search('now') >= 0) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0) {\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('+') + 1, interval.index),\n            10\n          );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.indexOf('-') + 1, interval.index),\n            10\n          );\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(\n    value: string | Date,\n    position?,\n    refreshFilter = true\n  ) {\n    if (typeof value === 'string') {\n      value = new Date(value);\n    }\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({\n        value: dateStringFromYearNotime,\n        pos: position,\n        refreshFilter\n      });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(\n          this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds),\n          2,\n          refreshFilter\n        );\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({\n      value: valueTmp.toISOString(),\n      pos: position,\n      refreshFilter\n    });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof value === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(\n    year,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (\n        property === 'begin' &&\n        this.restrictedToStep() &&\n        !this.calendarTypeYear\n      ) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        year,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  monthSelected(\n    month,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        month,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  calendarView(): 'month' | 'year' | 'multi-year' {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock' as any;\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string) {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'years',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'years',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asYears() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asYears() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'months',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'months',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asMonths() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asMonths() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'weeks',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'weeks',\n          true\n        );\n        this.filterEndFunction =\n          weekDiffPlus1 % moment.duration(this.step).asWeeks() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          weekDiff % moment.duration(this.step).asWeeks() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'days',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'days',\n          true\n        );\n        const _mod = dayDiffPlus1 % moment.duration(this.step).asDays();\n        this.filterEndFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      } else if (type === 'begin') {\n        const _mod = (dayDiff % moment.duration(this.step).asDays()) + 1;\n        this.filterBeginFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      if (type === 'end') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterEndFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      } else if (type === 'begin') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterBeginFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (type === 'end') {\n        this.filterEndFunction = true;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction = true;\n        return;\n      }\n    }\n\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\n    return;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.beginHourFormControl.value,\n              this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60\n          ? 1\n          : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep\n      : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin\n      ? this.currentFilter.begin\n      : this.datasource.options.minDate\n        ? this.datasource.options.minDate\n        : this._defaultMin;\n  }\n\n  public handleMax() {\n    return this.currentFilter.end\n      ? this.currentFilter.end\n      : this.datasource.options.maxDate\n        ? this.datasource.options.maxDate\n        : this._defaultMax;\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if (this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n      const dateItems = stringDate.split('-');\n      if (dateItems.length !== 3) {\n        throw new Error(\n          'Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY'\n        );\n      } else {\n        year = dateItems[0];\n        month = dateItems[1];\n        day = dateItems[2];\n      }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (this.filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0, 4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${this.filterOriginConfig.end.substring(0, 4)}-01-01`;\n      }\n      minDefaultISOString = `${this.filterOriginConfig.begin.substring(0, 4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(this.filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(this.filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if (\n      this.currentFilter.begin !== minDefaultISOString ||\n      this.currentFilter.end !== maxDefaultISOString\n    ) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","<div class=\"ogc-filter-form-container\">\n  <mat-checkbox\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n    (click)=\"$event.stopPropagation()\"\n    (change)=\"toggleFilterState($event)\"\n    [checked]=\"currentFilter.active\"\n  >\n  </mat-checkbox>\n\n  <mat-form-field\n    [ngClass]=\"{\n      logical:\n        activeFilters.indexOf(currentFilter) !== 0 &&\n        currentFilter.active === true,\n      logicalHidden:\n        activeFilters.indexOf(currentFilter) === 0 ||\n        currentFilter.active !== true\n    }\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.parentLogical\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.parentLogical\n          ? ('igo.geo.operators.tooltip.' + currentFilter.parentLogical\n            | translate)\n          : ''\n      \"\n      (selectionChange)=\"changeLogical($event.value)\"\n    >\n      <mat-option\n        [value]=\"ogcFilterOperator.And\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\"\n      >\n        {{ 'igo.geo.operators.And' | translate }}\n      </mat-option>\n      <mat-option\n        [value]=\"ogcFilterOperator.Or\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\"\n      >\n        {{ 'igo.geo.operators.Or' | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"field\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) === false &&\n      (fields$ | async) &&\n      (fields$ | async).length > 0 &&\n      (fields$ | async)[0].name !== ''\n    \"\n    (mouseenter)=\"inputClearable = 'selectField'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteField\"\n      [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        (selectedField$ | async)\n          ? (selectedField$ | async).alias\n          : ('igo.geo.sourceFields.selectField' | translate)\n      \"\n      (input)=\"updateFieldsList($any($event.target).value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteField=\"matAutocomplete\"\n      (optionSelected)=\"changeField($event.option.id)\"\n    >\n      <mat-option\n        *ngFor=\"let field of filteredFields$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"field.alias\"\n        [id]=\"field.name\"\n        [matTooltip]=\"field.alias\"\n      >\n        {{ field.alias }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        currentFilter.propertyName &&\n        inputClearable === 'selectField' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearSelectedField()\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    [ngClass]=\"{\n      operator: (currentFilterIsSpatial$ | async) === false,\n      dualInput: (currentFilterIsSpatial$ | async)\n    }\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <mat-select\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.operator\n          ? ('igo.geo.operators.tooltip.' + currentFilter.operator | translate)\n          : ('igo.geo.filter.selectOperator' | translate)\n      \"\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.operator\"\n      (selectionChange)=\"changeOperator($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let operator of ogcFilterOperators$ | async | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.' + operator.key | translate\"\n      >\n        {{ 'igo.geo.operators.' + operator.key | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"spatialSelector\"\n    *ngIf=\"currentFilterIsSpatial$ | async\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.igoSpatialSelector\"\n      (selectionChange)=\"changeSpatialSelector($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\"\n      >\n        {{ 'igo.geo.spatialSelector.' + igoSpatialSelector.type | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"singleInput\"\n    *ngIf=\"['expression', 'pattern'].indexOf(detectProperty()) !== -1\"\n    (mouseenter)=\"inputClearable = 'selectProperty'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteValues\"\n      [value]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression\n          : currentFilter.pattern\n      \"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression || ''\n          : currentFilter.pattern || ''\n      \"\n      (input)=\"updateValuesList($any($event.target).value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteValues=\"matAutocomplete\"\n      (optionSelected)=\"changeProperty($event.option.value)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable() &&\n        inputClearable === 'selectProperty' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty()\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <div class=\"igo-layer-button-group\">\n    <button\n      mat-icon-button\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n      color=\"warn\"\n      (click)=\"deleteFilter()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n  </div>\n\n  <mat-form-field\n    class=\"snrc\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'snrc'\n    \"\n    (mouseenter)=\"inputClearable = 'selectSNRC'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n      [value]=\"currentFilter.igoSNRC\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n      (input)=\"changeSNRC($any($event.target).value)\"\n    />\n    <button\n      *ngIf=\"currentFilter.igoSNRC\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"\n        !currentFilter.active &&\n        inputClearable === 'selectSNRC' &&\n        currentFilter.active\n      \"\n      (click)=\"currentFilter.igoSNRC = ''\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <ng-container\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'fixedExtent'\n    \"\n  >\n    <button\n      [disabled]=\"!currentFilter.active\"\n      *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n      matSuffix\n      mat-icon-button\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"changeMapExtentGeometry()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\"\n    >\n      <mat-icon>zoom_out_map</mat-icon>\n    </button>\n  </ng-container>\n</div>\n\n<div class=\"ogc-filter-form-container\">\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['lowerBoundary', 'begin'].indexOf(detectProperty(1)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty1'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(1) === 'lowerBoundary'\n          ? currentFilter.lowerBoundary\n          : currentFilter.begin\n      \"\n      (input)=\"updateValuesList($any($event.target).value, 1)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 1)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(1) &&\n        inputClearable === 'selectProperty1' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['upperBoundary', 'end'].indexOf(detectProperty(2)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty2'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(2) === 'upperBoundary'\n          ? currentFilter.upperBoundary\n          : currentFilter.end\n      \"\n      (input)=\"updateValuesList($any($event.target).value, 2)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 2)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(2) &&\n        inputClearable === 'selectProperty2' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\"\n    >\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-form-field>\n</div>\n\n<igo-ogc-filter-time\n  *ngIf=\"isTemporalOperator()\"\n  [datasource]=\"datasource\"\n  [currentFilter]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n>\n</igo-ogc-filter-time>\n","import { AsyncPipe, KeyValuePipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport { Component, Input, OnInit } from '@angular/core';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  FloatLabelType,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { MapBase } from '../../map';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { OgcFilterTimeComponent } from '../ogc-filter-time/ogc-filter-time.component';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss'],\n  standalone: true,\n  imports: [\n    MatCheckboxModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    NgClass,\n    MatSelectModule,\n    MatOptionModule,\n    NgIf,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatButtonModule,\n    MatIconModule,\n    OgcFilterTimeComponent,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType;\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n          ? of(this.selectedField$.value.values)\n          : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n\n    return this.selectedField$.value?.values?.filter(\n      (val) =>\n        val &&\n        keywordRegex.test(\n          val\n            .toString()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n        )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n            ? 'upperBoundary'\n            : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n            ? 'end'\n            : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n  constructor(private http: HttpClient) {}\n\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\n    const url = dom.url;\n    let result: DOMValue[];\n\n    await this.http\n      .get<any>(url)\n      .pipe(\n        map((response) => {\n          result = response;\n          return response;\n        }),\n        catchError((err: HttpErrorResponse) => {\n          return throwError(err);\n        })\n      )\n      .toPromise();\n\n    return result;\n  }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div\n      class=\"pushButtonGroups\"\n      *ngIf=\"selector.selectorType === 'pushButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\"\n          class=\"mat-typography\"\n          appearance=\"legacy\"\n          vertical=\"{{ bundleIsVertical(bundle) }}\"\n          multiple=\"true\"\n        >\n          <mat-button-toggle\n            *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\"\n            (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\"\n            >{{ ogcPushButton.title }}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox\n            *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\"\n            (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\"\n            >{{ ogcCheckbox.title }}\n          </mat-checkbox>\n        </div>\n        <p\n          *ngIf=\"\n            isLessResults(bundle, 'checkbox') ||\n            isMoreResults(bundle, 'checkbox')\n          \"\n        >\n          <u\n            *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u\n            *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"radioButtonGroups\"\n      *ngIf=\"selector.selectorType === 'radioButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-radio-group formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button\n            *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\"\n            >{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button\n            *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\"\n            (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\"\n            >{{ ogcRadioButton.title }}\n          </mat-radio-button>\n          <p\n            *ngIf=\"\n              isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\n            \"\n          >\n            <u\n              *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\"\n              >{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u\n              *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\"\n              >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\"\n          >\n            <mat-icon>filter_alt_off</mat-icon>\n          </mat-button>\n          <mat-form-field\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection\n                [multiple]=\"bundle.multiple\"\n                [placeholder]=\"bundle.title\"\n                formControlName=\"selectMulti\"\n              >\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox\n                    *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\"\n                    [ngModelOptions]=\"{ standalone: true }\"\n                    (change)=\"toggleAllSelection()\"\n                    >Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle, $event)\n                  \"\n                  [value]=\"ogcSelect\"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle)\n                  \"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"autocompleteGroups\"\n      *ngIf=\"selector.selectorType === 'autocomplete'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\"\n          >\n            <mat-option\n              *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\"\n              >{{ autocompleteGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\"\n          >\n            <mat-icon>filter_alt_off</mat-icon>\n          </mat-button>\n          <mat-form-field\n            *ngIf=\"filteredOgcAutocomplete[bundle.id]\"\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <input\n              matInput\n              type=\"text\"\n              formControlName=\"autocomplete\"\n              #autocomplete\n              class=\"autocomplete\"\n              [matAutocomplete]=\"auto\"\n              [placeholder]=\"bundle.title\"\n            />\n            <mat-autocomplete\n              #auto=\"matAutocomplete\"\n              #autocomplete\n              (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\"\n            >\n              <mat-option\n                *ngFor=\"\n                  let ogcAutocomplete of filteredOgcAutocomplete[bundle.id]\n                    | async\n                \"\n                [value]=\"ogcAutocomplete\"\n              >\n                {{ ogcAutocomplete.value }}\n              </mat-option>\n            </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h3 *ngIf=\"!currentFilter.title\">\n    {{ 'igo.geo.filter.reportingDate' | translate }}\n  </h3>\n  <h3 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h3>\n  <igo-ogc-filter-time\n    [datasource]=\"datasource\"\n    [currentFilter]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n  >\n  </igo-ogc-filter-time>\n</div>\n","import { AsyncPipe, NgFor, NgIf, NgStyle } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOption, MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelect, MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { DOMOptions, DOMService, DOMValue } from '@igo2/common/dom';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport {\n  IgoOgcFilterObject,\n  OgcFilterableDataSource,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n} from '../../filter/shared/ogc-filter.interface';\nimport { MapBase } from '../../map';\nimport { OgcFilterTimeComponent } from '../ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [DOMService],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    NgFor,\n    NgIf,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatOptionModule,\n    MatButtonToggleModule,\n    NgStyle,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatIconModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    OgcFilterTimeComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: UntypedFormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\n  public filteredOgcAutocomplete = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value === selector\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value.includes(selector)\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnabled() {\n    return this.autocompleteEnabled$.value;\n  }\n\n  set autocompleteEnabled(value) {\n    this.autocompleteEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value === selector.title\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: UntypedFormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: ['', [Validators.required]],\n      selectMulti: ['', [Validators.required]],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['', [Validators.required]]\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.getAutocompleteEnabled();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n      .get('pushButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onPushButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('checkboxesGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onCheckboxesChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private getAutocompleteEnabled() {\n    let enabled;\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled = selector.title;\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnabled = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig<DOMOptions[]>(\n            'dom'\n          )) {\n            if (\n              domSelector.id === domOptions.id ||\n              domSelector.name === domOptions.name\n            ) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDom(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find((sel) => sel.title === value.value)\n                  ? (enabled = true)\n                  : (enabled = false);\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled:\n                    this.selectEnabled?.title === value.value ? true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups()\n              .find((group) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (comp) => comp.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n        this.getSelectEnabled();\n      }\n    }\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete\n      .bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig<DOMOptions[]>(\n            'dom'\n          )) {\n            if (\n              domSelector.id === domOptions.id ||\n              domSelector.name === domOptions.name\n            ) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDom(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              selector = {\n                title: value.value,\n                enabled:\n                  this.autocompleteEnabled &&\n                  this.autocompleteEnabled === value.value\n                    ? true\n                    : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: value.id\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups()\n              .find((group) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (comp) => comp.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls[\n          'autocomplete'\n        ].valueChanges.pipe(\n          map((value) => {\n            if (value.length) {\n              return domValues?.filter((option) => {\n                const filterNormalized = value\n                  ? value\n                      .toLowerCase()\n                      .normalize('NFD')\n                      .replace(/[\\u0300-\\u036f]/g, '')\n                  : '';\n                const featureNameNormalized = option.value\n                  .toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map((group) => (group.enabled = false));\n    this.getPushButtonsGroups().find(\n      (group) => group === this.currentPushButtonsGroup\n    ).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map((group) => (group.enabled = false));\n    this.getCheckboxesGroups().find(\n      (group) => group === this.currentCheckboxesGroup\n    ).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map((group) => (group.enabled = false));\n    this.getRadioButtonsGroups().find(\n      (group) => group === this.currentRadioButtonsGroup\n    ).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map((group) => (group.enabled = false));\n    this.getSelectGroups().find(\n      (group) => group === this.currentSelectGroup\n    ).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map((group) => (group.enabled = false));\n    this.getAutocompleteGroups().find(\n      (group) => group === this.currentAutocompleteGroup\n    ).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors.map((selector) => (selector.enabled = false));\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n    });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnabled = undefined;\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n        compSelect.selectors?.forEach((selector) => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  autocompleteOptionClick(value) {\n    this.autocompleteEnabled = value.value;\n  }\n\n  displayFn(dom): string {\n    return dom ? dom.value : undefined;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [\n      this.currentPushButtonsGroup,\n      this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup,\n      this.currentSelectGroup,\n      this.currentAutocompleteGroup\n    ];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map((selectorBundle) => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n            ?.filter((ogcSelector) => ogcSelector.enabled === true)\n            .forEach((enabledSelector) =>\n              bundleCondition.push(enabledSelector.filters)\n            );\n          if (bundleCondition.length >= 1) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({\n                logical: selectorBundle.logical,\n                filters: bundleCondition\n              });\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(\n        this.datasource.options.ogcFilters.interfaceOgcFilters[0]\n      );\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter.buildFilter(\n        conditions.length === 1\n          ? conditions[0]\n          : ({ logical: 'And', filters: conditions } as IgoOgcFilterObject)\n      );\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(\n        this.datasource as WMSDataSource,\n        filterQueryString\n      );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex += 5)\n      : (this.checkboxesIndex += 5);\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex = this.baseIndex)\n      : (this.checkboxesIndex = this.baseIndex);\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (filter) => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n            ? 'upperBoundary'\n            : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n            ? 'end'\n            : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\"\n>\n</igo-ogc-filter-selection>\n\n<ng-template\n  *ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\n  ngFor\n  let-currentFilter\n  [ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\"\n>\n  <igo-ogc-filter-form\n    [currentFilter]=\"currentFilter\"\n    [refreshFilters]=\"refreshFunc\"\n    [datasource]=\"datasource\"\n    [map]=\"map\"\n  >\n  </igo-ogc-filter-form>\n</ng-template>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MAT_AUTOCOMPLETE_DEFAULT_OPTIONS } from '@angular/material/autocomplete';\nimport { MAT_SELECT_CONFIG } from '@angular/material/select';\n\nimport { ListItemDirective } from '@igo2/common/list';\n\nimport { MapBase } from '../../map';\nimport { OgcFilterFormComponent } from '../ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterSelectionComponent } from '../ogc-filter-selection/ogc-filter-selection.component';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html',\n  styles: ['::ng-deep.igo-overlay-panel-width { min-width: fit-content;}'],\n  providers: [\n    {\n      provide: MAT_SELECT_CONFIG,\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\n    },\n    {\n      provide: MAT_AUTOCOMPLETE_DEFAULT_OPTIONS,\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\n    }\n  ],\n  standalone: true,\n  imports: [\n    NgIf,\n    OgcFilterSelectionComponent,\n    ListItemDirective,\n    NgFor,\n    OgcFilterFormComponent\n  ]\n})\nexport class OgcFilterableFormComponent {\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: MapBase;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters\n      ? this.datasource.options.ogcFilters.interfaceOgcFilters[0]\n      : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<div [ngClass]=\"{ 'separate-item': header === true }\">\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      matListItemIcon\n      igoCollapse\n      [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      >expand_less\n    </mat-icon>\n    <span\n      *ngIf=\"header\"\n      matListItemTitle\n      [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n      [matTooltip]=\"layer.title\"\n      matTooltipShowDelay=\"500\"\n      (click)=\"toggleLegendOnClick()\"\n    >\n      {{ layer.title }}\n    </span>\n    <div matListItemMeta>\n      <button\n        *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\"\n        [disabled]=\"addFilterDisabled()\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\"\n        [color]=\"color\"\n        (click)=\"addFilterToSequence()\"\n      >\n        <mat-icon>add</mat-icon>\n      </button>\n      <button\n        *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"\n          layer.visible\n            ? ('igo.geo.layer.hideLayer' | translate)\n            : ('igo.geo.layer.showLayer' | translate)\n        \"\n        (click)=\"layer.visible = !layer.visible\"\n      >\n        <mat-icon\n          [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n          >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n        </mat-icon>\n      </button>\n    </div>\n  </mat-list-item>\n\n  <div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n    <igo-ogc-filterable-form\n      [datasource]=\"datasource\"\n      [map]=\"map\"\n      [refreshFilters]=\"refreshFunc\"\n    >\n    </igo-ogc-filterable-form>\n\n    <section\n      *ngIf=\"hasSelector && filtersAreEditable\"\n      class=\"mat-typography advancedOgcFilters\"\n    >\n      <mat-divider></mat-divider>\n      <mat-checkbox\n        (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\"\n      >\n        {{ 'igo.geo.filter.advancedOgcFilters' | translate }}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>\n","import { AsyncPipe, NgClass, NgIf, NgStyle } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map';\nimport { OgcFilterableFormComponent } from '../ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss'],\n  standalone: true,\n  imports: [\n    NgClass,\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    CollapseDirective,\n    NgStyle,\n    MatTooltipModule,\n    MatButtonModule,\n    LayerLegendComponent,\n    OgcFilterableFormComponent,\n    MatDividerModule,\n    MatCheckboxModule,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ],\n  providers: [OGCFilterService]\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: MapBase;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    if (this.layer.visible) {\n      this.filtersCollapsed = false;\n    }\n\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)\n    ) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter((f) => f.wkt_geometry).length >=\n          1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] =\n      this.datasource.options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(\n      (f) => !f.excludeFromOgcFilters\n    );\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters\n      ? ogcFilters.interfaceOgcFilters.filter((f) => f.active === true)\n      : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        (af) => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters =\n          this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters =\n            this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n              activeFilters\n            );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(\n      ogcFilters,\n      true\n    );\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<button\n  *ngIf=\"\n    header &&\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    >filter_alt</mat-icon\n  >\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n>\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\"\n  >\n  </igo-ogc-filterable-item>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map';\nimport { OgcFilterableItemComponent } from '../ogc-filterable-item/ogc-filterable-item.component';\nimport {\n  IgoOgcSelector,\n  OgcFilterableDataSourceOptions\n} from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    OgcFilterableItemComponent,\n    ListItemDirective,\n    IgoLanguageModule\n  ]\n})\nexport class OgcFilterButtonComponent implements OnInit {\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(\n            (cb) =>\n              (cntPushButtons += (cb.selectors as any)?.filter(\n                (button) => button.enabled\n              ).length)\n          );\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find((gr) => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(\n            (cb) =>\n              (cntCheckboxes += (cb.selectors as any)?.filter(\n                (checkbox) => checkbox.enabled\n              ).length)\n          );\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(\n            (cb) =>\n              (cntRadioButtons += (cb.selectors as any)?.filter(\n                (radio) => radio.enabled\n              ).length)\n          );\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find((gr) => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(\n            (cb) =>\n              (cntSelect += (cb.selectors as any)?.filter(\n                (multi) => multi.enabled\n              ).length)\n          );\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(\n            (cb) =>\n              (cntAutocomplete += (cb.selectors as any)?.filter(\n                (autocomplete) => autocomplete.enabled\n              ).length)\n          );\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (\n      filter.filters &&\n      filter.filters.operator === 'During' &&\n      filter.filters.active &&\n      filter.interfaceOgcFilters &&\n      filter.interfaceOgcFilters[0].active\n    ) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if (\n          filterActiveValue.begin.substring(0, 4) !==\n            this.options.minDate.substring(0, 4) ||\n          filterActiveValue.end.substring(0, 4) !==\n            this.options.maxDate.substring(0, 4)\n        ) {\n          cnt += 1;\n        }\n      } else if (\n        filterActiveValue.begin !== this.options.minDate ||\n        filterActiveValue.end !== this.options.maxDate\n      ) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource\n        .options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: MapBase;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource\n      .options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { TimeFilterableDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource',\n  standalone: true\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)\n    ) {\n      isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div\n    id=\"no-layer-message\"\n    *ngIf=\"(layers | filterableDataSource: 'ogc').length === 0\"\n  >\n    {{ 'igo.geo.filter.noFilterableLayer' | translate }}\n  </div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item\n      igoListItem\n      [header]=\"true\"\n      [layer]=\"layer\"\n      [map]=\"layer.map\"\n    ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import { NgFor, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { MapBase } from '../../map/shared/map.abstract';\nimport { OgcFilterableItemComponent } from '../ogc-filterable-item/ogc-filterable-item.component';\nimport { FilterableDataSourcePipe } from '../shared/filterable-datasource.pipe';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  styleUrls: ['./ogc-filterable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgIf,\n    NgFor,\n    OgcFilterableItemComponent,\n    ListItemDirective,\n    IgoLanguageModule,\n    FilterableDataSourcePipe\n  ]\n})\nexport class OgcFilterableListComponent {\n  @Input() layers: Layer[];\n\n  @Input() map: MapBase;\n\n  constructor() {}\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\n\n@Directive({\n  selector: '[igoOgcFilterableListBinding]',\n  standalone: true\n})\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\n  private component: OgcFilterableListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: OgcFilterableListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers.filter((layer) => layer.showInLayerList);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","export enum GeometryType {\n  Point = 'Point',\n  LineString = 'LineString',\n  Polygon = 'Polygon',\n  Circle = 'Circle'\n}\n\nexport enum LabelType {\n  Coordinates = 'Coordinates',\n  Length = 'Length',\n  Area = 'Area',\n  Predefined = 'Predefined',\n  Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n  DecimalDegree = 'DD',\n  DegreesMinutesSeconds = 'DMS'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawIconService {\n  protected icons: Array<string>;\n\n  constructor(protected config: ConfigService) {\n    this.getIconsList();\n  }\n\n  getIcons() {\n    return this.icons;\n  }\n\n  getPath(): string[] {\n    return this.config.getConfig('drawingTool.icons') || [];\n  }\n\n  getIconsList() {\n    this.icons = this.getPath();\n  }\n}\n","import OlOverlay from 'ol/Overlay';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport * as Olstyle from 'ol/style';\n\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\nimport {\n  updateOlGeometryCenter,\n  updateOlGeometryMidpoints\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit } from './draw.enum';\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(\n  fillColor?: string,\n  strokeColor?: string,\n  strokeWidth?: number,\n  label?: string\n): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(\n  olGeometry: OlLineString | OlPolygon\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: ['igo-map-tooltip', 'igo-map-tooltip-draw'].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n\nexport function DDtoDMS(\n  value: [number, number],\n  unit: CoordinatesUnit\n): string[] | undefined {\n  const conversionMapper = new Map([\n    [\n      CoordinatesUnit.DecimalDegree,\n      (val: [number, number]) => {\n        if (typeof val[0] === 'number') {\n          return roundCoordToString(val, 5) as string[];\n        } else {\n          const numVal: [number, number] = [Number(val[0]), Number(val[1])];\n          return roundCoordToString(numVal, 5) as string[];\n        }\n      }\n    ],\n    [\n      CoordinatesUnit.DegreesMinutesSeconds,\n      (val: [number, number]) => convertDDToDMS(val, 2)\n    ]\n  ]);\n  let conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n","export enum FontType {\n  Arial = 'Arial',\n  ArialBlack = 'Arial Black',\n  Verdana = 'Verdana',\n  Tahoma = 'Tahoma',\n  TrebuchetMS = 'Trebuchet MS',\n  Impact = 'Impact',\n  TimesNewRoman = 'Times New Roman',\n  Georgia = 'Georgia',\n  AmericanTypewriter = 'American Typewriter',\n  Courier = 'Courier',\n  LucidaConsole = 'Lucida Console',\n  BrushScriptMT = 'Brush Script MT',\n  ComicSansMS = 'Comic Sans MS'\n}\n","<mat-form-field\n  class=\"fill-field\"\n  floatLabel=\"always\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  subscriptSizing=\"dynamic\"\n  cdkOverlayOrigin\n  #trigger=\"cdkOverlayOrigin\"\n  (click)=\"isOpen = !isOpen\"\n>\n  <mat-label>{{ colorPicker }}</mat-label>\n  <input\n    type=\"text\"\n    matInput\n    [readonly]=\"true\"\n    [style.background]=\"colorPicker\"\n  />\n</mat-form-field>\n\n<ng-template\n  cdkConnectedOverlay\n  [cdkConnectedOverlayOrigin]=\"trigger\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  [cdkConnectedOverlayHasBackdrop]=\"true\"\n  (backdropClick)=\"isOpen = false\"\n  cdkConnectedOverlayBackdropClass=\"cdk-overlay-transparent-backdrop\"\n>\n  <div class=\"picker\">\n    <color-chrome (onChange)=\"handleChange($event)\" [color]=\"colorPicker\">\n    </color-chrome>\n    <div class=\"buttons\">\n      <button mat-flat-button color=\"primary\" (click)=\"handleClick($event)\">\n        {{ 'igo.common.confirmDialog.applyBtn' | translate }}\n      </button>\n    </div>\n  </div>\n</ng-template>\n","import { CdkConnectedOverlay, CdkOverlayOrigin } from '@angular/cdk/overlay';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  Output,\n  forwardRef\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { ColorEvent } from 'ngx-color';\nimport { ColorChromeModule } from 'ngx-color/chrome';\nimport tinycolor, { ColorInput } from 'tinycolor2';\n\ntype ColorFormat = 'hex' | 'rgba' | 'hsla';\n\n@Component({\n  selector: 'igo-color-picker-form-field',\n  templateUrl: './color-picker-form-field.component.html',\n  styleUrls: ['./color-picker-form-field.component.scss'],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => ColorPickerFormFieldComponent),\n      multi: true\n    }\n  ],\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    CdkOverlayOrigin,\n    MatInputModule,\n    CdkConnectedOverlay,\n    ColorChromeModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class ColorPickerFormFieldComponent implements ControlValueAccessor {\n  isOpen: boolean = false;\n\n  set value(value: string) {\n    this._value = this.formatColor(value ?? '#000');\n    this.colorPicker = this._value;\n\n    this.onChange(this.value);\n    this.onTouch(this.value);\n  }\n  get value(): string {\n    return this._value;\n  }\n  private _value: string;\n\n  @Input() outputFormat: ColorFormat = 'rgba';\n\n  /**\n   * The emitted value represent the current chosen color in the picker\n   * The value is emitted by default in RGBA, or based on the input 'outputFormat' value.\n   */\n  @Output() colorChange: EventEmitter<string> = new EventEmitter<string>();\n\n  colorPicker: string;\n\n  onChange: any = () => {};\n  onTouch: any = () => {};\n\n  writeValue(value: string) {\n    this.value = value;\n  }\n\n  registerOnChange(fn: any) {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: any) {\n    this.onTouch = fn;\n  }\n\n  handleClick(event: MouseEvent) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.isOpen = false;\n    this.value = this.colorPicker;\n  }\n\n  handleChange($event: ColorEvent) {\n    this.colorPicker = this.formatColor($event.color.rgb, 'rgba');\n    this.colorChange.emit(this.formatColor(this.colorPicker));\n  }\n\n  private formatColor(\n    color: ColorInput,\n    format: ColorFormat = this.outputFormat\n  ): string {\n    switch (format) {\n      case 'hex':\n        color = tinycolor(color).toHexString();\n        break;\n      case 'rgba':\n        color = tinycolor(color).toRgbString();\n        break;\n      case 'hsla':\n        color = tinycolor(color).toHsvString();\n        break;\n      default:\n        color = tinycolor(color).toRgbString();\n        break;\n    }\n    return color;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport OlPoint from 'ol/geom/Point';\nimport { ProjectionLike, transform } from 'ol/proj';\nimport * as OlStyle from 'ol/style';\n\nimport { FontType } from '../shared/font.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '15';\n  private fontStyle: string = FontType.Arial.toString();\n  private offsetX: number = 0;\n  private offsetY: number = 0;\n\n  constructor() {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  getOffsetX(): number {\n    return this.offsetX;\n  }\n\n  setOffsetX(offsetX: number) {\n    this.offsetX = offsetX;\n  }\n\n  getOffsetY(): number {\n    return this.offsetY;\n  }\n\n  setOffsetY(offsetY: number) {\n    this.offsetY = offsetY;\n  }\n\n  createIndividualElementStyle(\n    feature,\n    resolution,\n    labelsAreShown: boolean,\n    fontSizeAndStyle: string,\n    fillColor: string,\n    strokeColor: string,\n    offsetX: number,\n    offsetY: number,\n    proj: ProjectionLike,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n    const textToShow = labelsAreShown ? feature.get('draw') : '';\n    feature.set('_mapTitle', textToShow);\n    const textIgoStyleObject = {\n      text: textToShow,\n      stroke: {\n        color: 'white',\n        width: 0.75\n      },\n      fill: { color: 'black' },\n      font: fontSizeAndStyle,\n      overflow: true,\n      offsetX: offsetX,\n      offsetY: offsetY\n    };\n\n    let igoStyleObject;\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(\n        feature.getGeometry().flatCoordinates,\n        proj,\n        'EPSG:4326'\n      );\n      const radius =\n        feature.get('rad') /\n        Math.cos((Math.PI / 180) * coordinates[1]) /\n        resolution;\n      igoStyleObject = {\n        text: textIgoStyleObject,\n        circle: {\n          radius,\n          stroke: {\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: textToShow,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        image: new OlStyle.Circle({\n          radius,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n\n      // if feature is an icon\n    } else if (icon) {\n      this.offsetY = -26;\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        icon: {\n          src: icon\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n      // if feature is a point, a linestring or a polygon\n    } else {\n      this.offsetY = labelsAreOffset ? -15 : 0;\n\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        circle: {\n          radius: 5,\n          stroke: {\n            color: strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div\n  class=\"edition-drawing\"\n  mat-dialog-content\n  [hidden]=\"data.features.length === 0\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"color-picker\">\n      <ng-container *ngIf=\"linestringOnly !== true\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\">format_color_fill</mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n\n        <igo-color-picker-form-field\n          formControlName=\"fill\"\n        ></igo-color-picker-form-field>\n      </ng-container>\n\n      <span>\n        <mat-icon class=\"stroke-palette-icon\">border_color </mat-icon>\n        {{ 'igo.geo.style.stroke' | translate }}\n      </span>\n\n      <igo-color-picker-form-field\n        formControlName=\"stroke\"\n      ></igo-color-picker-form-field>\n    </div>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\n        <input\n          matInput\n          #testFontSize\n          type=\"number\"\n          placeholder=\"10\"\n          min=\"10\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureFontSize()\"\n          (input)=\"styleModalData.fontSize = $any($event.target).value\"\n        />\n        <span matTextSuffix>px</span>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\n        <mat-select\n          #testFontStyle\n          [value]=\"getFeatureFontStyle()\"\n          (selectionChange)=\"styleModalData.fontStyle = $event.value\"\n        >\n          <mat-option\n            *ngFor=\"let fontSelect of allFontStyles\"\n            [value]=\"fontSelect\"\n          >\n            {{ fontSelect }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetXInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetX()\"\n          (input)=\"styleModalData.offsetX = $any($event.target).value\"\n        />\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetYInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetY()\"\n          (input)=\"styleModalData.offsetY = $any($event.target).value\"\n        />\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { ColorPickerFormFieldComponent } from '@igo2/common/color';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { FontType } from '../../shared/font.enum';\nimport { DrawStyleService } from '../../style-service/draw-style.service';\nimport {\n  DrawingMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-drawing',\n  templateUrl: './style-modal-drawing.component.html',\n  styleUrls: ['./style-modal-drawing.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    ColorPickerFormFieldComponent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class StyleModalDrawingComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData\n  ) {}\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.features) {\n      if (feature.geometry.type !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [this.getFeatureFillColor()],\n      stroke: [this.getFeatureStrokeColor()]\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.fill\n          : 'rgba(255,255,255,0.4)',\n      strokeColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.stroke\n          : 'rgba(143,7,7,1)',\n      fontSize:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle\n              .split(' ')[0]\n              .replace('px', '')\n          : '20',\n      fontStyle:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle.substring(\n              this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n            )\n          : FontType.Arial,\n      offsetX:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetX\n          : this.drawStyleService.getOffsetX(),\n      offsetY:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetY\n          : this.drawStyleService.getOffsetY()\n    };\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  getFeatureFontSize(): string {\n    if (!this.styleModalData.fontSize) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle\n            .split(' ')[0]\n            .replace('px', '')\n        : '20';\n    } else {\n      return this.styleModalData.fontSize;\n    }\n  }\n\n  getFeatureFontStyle() {\n    if (!this.styleModalData.fontStyle) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle.substring(\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n          )\n        : FontType.Arial;\n    } else {\n      return this.styleModalData.fontStyle;\n    }\n  }\n\n  private getFeatureFillColor() {\n    if (!this.styleModalData.fillColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)';\n    } else {\n      return this.styleModalData.fillColor;\n    }\n  }\n\n  private getFeatureStrokeColor() {\n    if (!this.styleModalData.strokeColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)';\n    } else {\n      return this.styleModalData.strokeColor;\n    }\n  }\n\n  getFeatureOffsetX() {\n    if (!this.styleModalData.offsetX) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX();\n    } else {\n      return this.styleModalData.offsetX;\n    }\n  }\n\n  getFeatureOffsetY() {\n    if (!this.styleModalData.offsetY) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetY\n        : this.drawStyleService.getOffsetY();\n    } else {\n      return this.styleModalData.offsetY;\n    }\n  }\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogContent,\n    MatFormFieldModule,\n    MatInputModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(public dialogRef: MatDialogRef<DrawLayerPopupComponent>) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.draw.popupTitle' | translate }}\n</h2>\n\n<ng-container *ngIf=\"labelFlag !== labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <div>\n      <p>\n        {{ 'igo.geo.draw.builtInInstructions' | translate }}\n      </p>\n      <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\">\n        <mat-radio-button\n          *ngFor=\"let option of arrayBuiltInType\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.value)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-radio-button>\n      </mat-radio-group>\n      <ng-container *ngIf=\"olGeometryType === 'Polygon'\">\n        <mat-checkbox\n          *ngFor=\"let option of arrayBuiltInType\"\n          class=\"mat-typography\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"\n            onLabelTypeChange($any($event.source.value), $event.checked)\n          \"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-checkbox>\n      </ng-container>\n      <div *ngIf=\"labelFlag === labelType.Coordinates\" class=\"fields-container\">\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>(Latitude, Longitude)</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"(Latitude, Longitude)\"\n            value=\"{{ currentCoordinates }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"coordinatesMeasureUnit\"\n            (selectionChange)=\"onChangeCoordinateUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n              {{ unit }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ lengthLabelT }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ lengthLabelT }}\"\n            value=\"{{ currentLength }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"lengthMeasureUnit\"\n            (selectionChange)=\"onChangeLengthUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n              {{ getLengthUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ 'igo.geo.draw.labelType.Area' | translate }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n            value=\"{{ currentArea }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"areaMeasureUnit\"\n            (selectionChange)=\"onChangeAreaUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n              {{ getAreaUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm()\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"labelFlag === labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <p>\n      {{ 'igo.geo.draw.dialogInstruction' | translate }}\n    </p>\n    <mat-form-field class=\"input\">\n      <mat-label>{{ 'igo.geo.draw.dialogTitle' | translate }}</mat-label>\n      <input\n        #input\n        matInput\n        (select)=\"(true)\"\n        (input)=\"getLabelLength($any($event.target).value)\"\n        placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial\n      />\n    </mat-form-field>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport OlFeature from 'ol/Feature';\nimport Circle from 'ol/geom/Circle';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport { transform } from 'ol/proj';\nimport { getLength } from 'ol/sphere';\n\nimport { IgoMap, roundCoordTo } from '../../map/shared';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from '../../measure/shared/measure.enum';\nimport {\n  measureOlGeometryArea,\n  measureOlGeometryLength,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { DDtoDMS } from '../shared/draw.utils';\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    NgIf,\n    MatDialogContent,\n    MatButtonToggleModule,\n    MatRadioModule,\n    NgFor,\n    MatCheckboxModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\n  @Input() areaMeasureUnit: MeasureAreaUnit;\n\n  public geometryType = GeometryType;\n  public labelType = LabelType;\n  public arrayBuiltInType: any[] = [];\n\n  public currentLabel: string;\n  public currentCoordinates: string;\n  public currentArea: string;\n  public currentLength: string;\n\n  public olGeometryType: GeometryType = undefined;\n  public lengthInMeters: string;\n  public areaInMetersSquare: string;\n  public coordinatesInDD: string;\n  public currentCoordinatesUnit: string;\n\n  private longlatDD: [number, number];\n  private labelLength: number;\n\n  public polygonCheck = 0; // Count for polygon label types checkboxes\n\n  constructor(\n    private languageService: LanguageService,\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any; map: IgoMap }\n  ) {\n    this.currentLabel = this.data.olGeometry.get('draw');\n    this.labelLength = this.currentLabel ? this.currentLabel.length : 0;\n    let olGeometry;\n\n    const projection = this.data.map.ol.getView().getProjection();\n\n    if (this.data.olGeometry instanceof OlFeature) {\n      if (this.data.olGeometry.get('rad')) {\n        const longitudeLatitude = [\n          this.data.olGeometry.get('longitude'),\n          this.data.olGeometry.get('latitude')\n        ];\n        this.olGeometryType = GeometryType.Circle;\n        olGeometry = new Circle(\n          longitudeLatitude,\n          this.data.olGeometry.get('rad')\n        );\n      } else {\n        this.olGeometryType = this.data.olGeometry.getGeometry().getType();\n        olGeometry = this.data.olGeometry.get('geometry');\n      }\n    } else {\n      this.olGeometryType = this.data.olGeometry.getType();\n      olGeometry = this.data.olGeometry;\n    }\n\n    if (\n      this.olGeometryType === GeometryType.Point ||\n      this.olGeometryType === GeometryType.Circle\n    ) {\n      if (this.data.olGeometry instanceof OlFeature) {\n        let longitude = this.data.olGeometry.get('longitude');\n        let latitude = this.data.olGeometry.get('latitude');\n        this.longlatDD = roundCoordTo([longitude, latitude], 5);\n        this.coordinatesInDD = '(' + latitude + ', ' + longitude + ')';\n      } else {\n        let point4326 = transform(\n          this.data.olGeometry.getFlatCoordinates(),\n          projection,\n          'EPSG:4326'\n        );\n        this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\n        this.coordinatesInDD =\n          '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\n      }\n      this.currentCoordinates = this.coordinatesInDD;\n    }\n    if (this.olGeometryType === GeometryType.LineString) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    } else if (this.olGeometryType === GeometryType.Circle) {\n      let circularPolygon = fromCircle(olGeometry, 10000);\n      const radius = this.getRadius(circularPolygon);\n      this.lengthInMeters = radius.toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        circularPolygon,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    }\n\n    if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Coordinates, true);\n      this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Length) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Area) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType')?.length === 2) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\n    }\n    this.buildArrayType();\n  }\n\n  /**\n   * HTML Interactions\n   */\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm(input?: string) {\n    this.confirmFlag = true;\n    if (this.labelFlag === LabelType.Predefined) {\n      this.dialogRef.close();\n    } else if (this.labelFlag === LabelType.Custom) {\n      this.dialogRef.close({\n        label: input\n      });\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.dialogRef.close({\n        label: this.currentCoordinates,\n        measureUnit: this.coordinatesMeasureUnit\n      });\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      if (this.polygonCheck === 2) {\n        this.labelFlag = [LabelType.Length, LabelType.Area];\n        this.dialogRef.close({\n          label:\n            'P: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] +\n            '\\n' +\n            this.languageService.translate.instant('igo.geo.draw.labelType.A') +\n            this.currentArea +\n            ' ' +\n            MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters],\n          measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\n        });\n      } else {\n        this.labelFlag === LabelType.Length\n          ? this.dialogRef.close({\n              label:\n                'P: ' +\n                this.currentLength +\n                ' ' +\n                MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n              measureUnit: this.lengthMeasureUnit\n            })\n          : this.dialogRef.close({\n              label:\n                this.currentArea +\n                ' ' +\n                MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n              measureUnit: this.areaMeasureUnit\n            });\n      }\n    } else if (this.labelFlag === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Circle) {\n        this.dialogRef.close({\n          label:\n            'R: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.dialogRef.close({\n          label:\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n    } else if (this.labelFlag === LabelType.Area) {\n      this.dialogRef.close({\n        label:\n          this.currentArea +\n          ' ' +\n          MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n        measureUnit: this.areaMeasureUnit\n      });\n    }\n  }\n\n  onLabelTypeChange(labelType: LabelType, checked?: boolean) {\n    if (\n      labelType !== LabelType.Predefined &&\n      labelType !== LabelType.Custom &&\n      this.olGeometryType === GeometryType.Polygon\n    ) {\n      this.arrayBuiltInType.find((type) => type.value === labelType)\n        ? (this.arrayBuiltInType.find(\n            (type) => type.value === labelType\n          ).checked = checked)\n        : (this.labelFlag = undefined);\n      checked\n        ? (this.labelFlag = labelType)\n        : (this.labelFlag = this.arrayBuiltInType.find(\n            (type) => type.checked\n          )?.value);\n    } else {\n      this.labelFlag = labelType;\n    }\n\n    if (labelType === LabelType.Predefined) {\n      if (this.olGeometryType === GeometryType.Point) {\n        this.labelFlag = LabelType.Coordinates;\n        this.currentCoordinates = this.coordinatesInDD;\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.labelFlag = LabelType.Length;\n        this.currentLength = this.lengthInMeters;\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n      }\n    } else if (labelType === LabelType.Area) {\n      this.currentArea = this.areaInMetersSquare;\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\n    } else if (labelType === LabelType.Length) {\n      this.currentLength = this.lengthInMeters;\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.currentCoordinates = this.coordinatesInDD;\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n    }\n\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\n    if (\n      this.olGeometryType === GeometryType.Polygon &&\n      labeltypes.includes(labelType)\n    ) {\n      checked ? (this.polygonCheck += 1) : (this.polygonCheck -= 1);\n    } else {\n      this.polygonCheck = 0;\n    }\n  }\n\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit) {\n    this.lengthMeasureUnit = lengthUnit;\n    this.currentLength = metersToUnit(\n      Number(this.lengthInMeters),\n      lengthUnit\n    ).toFixed(2);\n  }\n\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit) {\n    this.areaMeasureUnit = areaUnit;\n    this.currentArea = squareMetersToUnit(\n      Number(this.areaInMetersSquare),\n      areaUnit\n    ).toFixed(2);\n  }\n\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit) {\n    this.coordinatesMeasureUnit = coordinatesUnit;\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\n    this.currentCoordinates =\n      '(' + coordinates[1] + ', ' + coordinates[0] + ')';\n  }\n\n  buildArrayType() {\n    for (const labelType of Object.values(LabelType)) {\n      if (\n        labelType !== LabelType.Custom &&\n        labelType !== LabelType.Predefined\n      ) {\n        this.arrayBuiltInType.push({\n          value: labelType,\n          checked:\n            this.selectOptions(labelType) ||\n            this.labelFlag === labelType ||\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\n        });\n      }\n    }\n  }\n\n  noLabelButton() {\n    if (\n      this.labelFlag === LabelType.Predefined ||\n      (this.labelFlag === LabelType.Custom && this.labelLength === 0)\n    ) {\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\n    }\n\n    return 'OK';\n  }\n\n  get customOrPredefined() {\n    if (this.labelFlag === LabelType.Custom) {\n      return LabelType.Custom;\n    }\n    return LabelType.Predefined;\n  }\n\n  optionAvailable(currentOption: LabelType) {\n    switch (this.olGeometryType) {\n      case GeometryType.Point:\n        if (currentOption === LabelType.Coordinates) {\n          return false;\n        }\n        return true;\n      case GeometryType.LineString:\n        if (currentOption === LabelType.Length) {\n          return false;\n        }\n        return true;\n      case GeometryType.Polygon:\n        if (currentOption === LabelType.Coordinates) {\n          return true;\n        }\n        return false;\n      default:\n        return false;\n    }\n  }\n\n  get allLengthUnits(): MeasureLengthUnit[] {\n    return Object.values(MeasureLengthUnit);\n  }\n\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit) {\n    return MeasureLengthUnitAbbreviation[lengthUnit];\n  }\n\n  get allAreaUnits(): MeasureAreaUnit[] {\n    return Object.values(MeasureAreaUnit);\n  }\n\n  get allCoordinatesUnits(): CoordinatesUnit[] {\n    return Object.values(CoordinatesUnit);\n  }\n\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit) {\n    return MeasureAreaUnitAbbreviation[areaUnit];\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n  get lengthLabelT() {\n    if (this.olGeometryType === GeometryType.Polygon) {\n      return this.languageService.translate.instant(\n        'igo.geo.measure.perimeter'\n      );\n    }\n    if (this.olGeometryType === GeometryType.Circle) {\n      return this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.Length'\n    );\n  }\n\n  getLabelLength(event?) {\n    this.labelLength = event.length;\n  }\n\n  selectOptions(option) {\n    if (this.olGeometryType === GeometryType.Point) {\n      return option === LabelType.Coordinates;\n    } else if (this.olGeometryType === GeometryType.LineString) {\n      return option === LabelType.Length;\n    }\n  }\n\n  getProperLengthLabel(option) {\n    if (option === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Polygon) {\n        return this.languageService.translate.instant(\n          'igo.geo.measure.perimeter'\n        );\n      }\n      if (this.olGeometryType === GeometryType.Circle) {\n        return this.languageService.translate.instant(\n          'igo.geo.search.coordinates.radius'\n        );\n      }\n      return this.languageService.translate.instant(\n        'igo.geo.draw.labelType.Length'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.' + option\n    );\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogClose,\n  MatDialogContent\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IconSvg,\n  IgoIconComponent,\n  KEYBOARD_ESC_ICON\n} from '@igo2/common/icon';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogContent,\n    MatIconModule,\n    MatDialogActions,\n    MatButtonModule,\n    MatDialogClose,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class DrawShorcutsComponent {\n  svgIcon: IconSvg = KEYBOARD_ESC_ICON;\n}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">keyboard_return</mat-icon\n      >{{ 'igo.geo.draw.finish' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">keyboard_backspace</mat-icon\n      >{{ 'igo.geo.draw.undo' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <igo-icon [icon]=\"svgIcon\" />\n      {{ 'igo.geo.draw.abort' | translate }}\n    </span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\">space_bar</mat-icon\n      >{{ 'igo.geo.draw.move' | translate }}</span\n    >\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\"\n      [value]=\"geometryType.Point\"\n    >\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.draw.drawControl' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\"\n    >\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"!isPoint()\"\n      [checked]=\"freehandMode\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleFreehandMode($event)\"\n    >\n      {{ 'igo.geo.draw.freehandMode' | translate }}\n    </mat-slide-toggle>\n\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\n      <mat-form-field class=\"radius\">\n        <input\n          matInput\n          type=\"number\"\n          min=\"0\"\n          placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n          [formControl]=\"radiusFormControl\"\n          [readonly]=\"this.freehandMode\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-divider></mat-divider>\n\n  <div class=\"layer-select-container\">\n    <mat-form-field class=\"layer-select\" subscriptSizing=\"dynamic\">\n      <mat-label>{{ 'igo.geo.draw.layer.title' | translate }}</mat-label>\n      <mat-select\n        #selectedLayer\n        (selectionChange)=\"onLayerChange(selectedLayer.value)\"\n        [value]=\"updateActiveLayer()\"\n      >\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\n          {{ layer.title }}\n        </mat-option>\n        <mat-option id=\"createNewLayer\">\n          {{ 'igo.geo.draw.layer.createNewLayer' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <button\n      *ngIf=\"activeDrawingLayer\"\n      mat-icon-button\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        activeDrawingLayer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\"\n    >\n      <mat-icon>\n        {{ activeDrawingLayer.visible ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n  </div>\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"activeStore.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <div>\n      <igo-entity-table\n        #table\n        class=\"table-compact\"\n        [store]=\"activeStore\"\n        [template]=\"tableTemplate\"\n      >\n      </igo-entity-table>\n    </div>\n  </div>\n\n  <div class=\"icon-options\">\n    <mat-form-field *ngIf=\"icons.length >= 1\">\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n      <mat-select>\n        <mat-select-trigger>\n          <div *ngIf=\"icon\" class=\"box\">\n            <img src=\"{{ icon }}\" />\n          </div>\n        </mat-select-trigger>\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{\n          'igo.geo.draw.noIcon' | translate\n        }}</mat-option>\n        <mat-option\n          *ngFor=\"let icon_html of icons\"\n          [value]=\"icon_html\"\n          (click)=\"onIconChange(icon_html)\"\n        >\n          <div class=\"box\">\n            <img src=\"{{ icon_html }}\" />\n          </div>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"actions-container\">\n    <button\n      mat-icon-button\n      color=\"accent\"\n      disableRipple=\"true\"\n      (click)=\"openShorcutsDialog()\"\n    >\n      <mat-icon\n        class=\"shortcuts-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\n        >keyboard\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectedFeatures$.value.length\"\n      mat-raised-button\n      color=\"primary\"\n      (click)=\"openStyleModalDialog()\"\n      [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\"\n    >\n      {{ 'igo.geo.style.styleModal' | translate }}\n      <mat-icon\n        aria-hidden=\"false\"\n        iconPositionEnd\n        class=\"style-icon\"\n        [matBadge]=\"selectedFeatures$.value.length\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        >palette\n      </mat-icon>\n    </button>\n  </div>\n</div>\n","import {\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  EntityRecord,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport OlFeature from 'ol/Feature';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport type { Type } from 'ol/geom/Geometry';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlPoint from 'ol/geom/Point';\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\nimport { transform } from 'ol/proj';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlVectorSource from 'ol/source/Vector';\nimport { getDistance, getLength } from 'ol/sphere';\nimport * as OlStyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { first, skip } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport {\n  FEATURE,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  featureToOl,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from '../../measure/shared/measure.enum';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport {\n  measureOlGeometryArea,\n  measureOlGeometryLength,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport { FontType } from '../../style/shared/font.enum';\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\nimport { DrawIconService } from '../shared/draw-icon.service';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { DDtoDMS, createInteractionStyle } from '../shared/draw.utils';\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n@Component({\n  selector: 'igo-draw',\n  animations: [\n    trigger('openClose', [\n      state(\n        'open',\n        style({\n          opacity: 1\n        })\n      ),\n      state(\n        'closed',\n        style({\n          opacity: 0\n        })\n      ),\n      transition('open => closed', [animate('600ms ease')]),\n      transition('closed => open', [animate('800ms ease')])\n    ])\n  ],\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    MatSlideToggleModule,\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatDividerModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    EntityTableComponent,\n    MatBadgeModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input()\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this._stores;\n  }\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\n    this._stores = value;\n  }\n  private _stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  @Input()\n  get drawControls(): [string, DrawControl][] {\n    return this._drawControls;\n  }\n  set drawControls(value: [string, DrawControl][]) {\n    this._drawControls = value;\n  }\n  private _drawControls = [];\n\n  @Input()\n  get activeDrawingLayer(): VectorLayer {\n    return this._activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this._activeDrawingLayer = value;\n  }\n  private _activeDrawingLayer: VectorLayer;\n\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\n  @Output() layersIDEvent = new EventEmitter<string>();\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n\n  public activeStore: FeatureStore<FeatureWithDraw>;\n  private layerCounterID: number = 0;\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n  private activeDrawingLayerSource = new OlVectorSource();\n  private activeDrawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  public freehandMode = false;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: UntypedFormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  public radiusFormControl = new UntypedFormControl(1000);\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public radiusFormControlChange$$: Subscription = new Subscription();\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n  private numberOfDrawings: number;\n  public isCreatingNewLayer: boolean = false;\n  private currGeometryType = this.geometryType.Point as any;\n\n  @ViewChild('selectedLayer') select;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      fixedHeader: true,\n      tableHeight: 'auto',\n      columns: [\n        {\n          name: 'Drawing',\n          title: this.languageService.translate.instant('igo.geo.draw.labels'),\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return feature.properties.draw;\n          }\n        },\n        {\n          name: 'Edition',\n          title: '',\n          sort: false,\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return [\n              {\n                editMode: false,\n                icon: 'edit',\n                color: 'primary',\n                click: () => {\n                  this.editLabelDrawing(feature);\n                },\n                style: 'mat-icon-button'\n              }\n            ] as EntityTableButton[];\n          },\n          renderer: EntityTableColumnRenderer.ButtonGroup\n        }\n      ]\n    };\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    if (!this.stores.length) {\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n        map: this.map\n      });\n      this.initStore();\n      this.activeDrawControl = this.createDrawControl(\n        this.fillColor,\n        this.strokeColor,\n        this.strokeWidth\n      );\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\n      this.toggleDrawControl();\n      this.stores.push(this.activeStore);\n      this.drawControls.push([\n        this.activeDrawingLayer.id,\n        this.activeDrawControl\n      ]);\n      this.drawControlsEvent.emit(this.drawControls);\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\n      this.onLayerChange(this.activeDrawingLayer);\n    } else {\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.deactivateDrawControl();\n      this.allLayers.forEach((layer) => {\n        if (layer.id !== this.activeDrawingLayer.id) {\n          layer.opacity = 0;\n        }\n        let store = this.stores.find((s) => s.layer.id === layer.id);\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(first())\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              records.forEach((record) => {\n                record.state.selected = false;\n              });\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              skip(1) // Skip initial emission\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              this.selectedFeatures$.next(\n                records.map((record) => record.entity)\n              );\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.count$.subscribe((cnt) => {\n            cnt >= 1\n              ? (this.activeStore.layer.options.showInLayerList = true)\n              : (this.activeStore.layer.options.showInLayerList = false);\n          })\n        );\n      });\n      this.onLayerChange(this.activeDrawingLayer);\n    }\n\n    this.radiusFormControlChange$$ =\n      this.radiusFormControl.valueChanges.subscribe((value) => {\n        if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\n          this.changeRadius(value);\n        }\n      });\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.allLayers.forEach((layer) => (layer.opacity = 1));\n    this.activeStore.state.updateAll({ selected: false });\n    this.deactivateDrawControl();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n    this.radiusFormControlChange$$.unsubscribe();\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const activeDrawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.activeDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return activeDrawControl;\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\n    this.createLayer(newTitle, isNewLayer);\n    this.subscriptions$$.push(\n      this.activeStore.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n\n    this.subscriptions$$.push(\n      this.activeStore.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.activeStore.layer.options.showInLayerList = true)\n          : (this.activeStore.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\n        disableClose: false,\n        data: {\n          features: this.selectedFeatures$.getValue(),\n          icons: this.icons,\n          icon: this.icon\n        },\n        autoFocus: false\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\n          this.onColorChange(\n            this.labelsAreShown,\n            this.icon ? true : false,\n            data.fillColor,\n            data.strokeColor\n          );\n          this.onOffsetLabelChange(\n            this.labelsAreShown,\n            data.offsetX,\n            data.offsetY\n          );\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: { olGeometry: olGeometry, map: this.map }\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((result) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\n          this.updateLabelType(\n            olGeometry,\n            dialogRef.componentInstance.labelFlag\n          );\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\n\n          if (!(olGeometry instanceof OlFeature)) {\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\n            this.updateFillAndStrokeColor(\n              olGeometry,\n              'rgba(255,255,255,0.4)',\n              'rgba(143,7,7,1)'\n            );\n            this.updateOffset(\n              olGeometry,\n              0,\n              olGeometry instanceof OlPoint ? -15 : 0\n            );\n          }\n\n          isDrawEnd\n            ? this.onDrawEnd(olGeometry)\n            : this.onSelectDraw(olGeometry, result.label, [\n                dialogRef.componentInstance.labelFlag,\n                result.measureUnit\n              ]);\n          this.updateHeightTable();\n        }\n        // deletes the feature\n        else {\n          this.activeDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometry === geometry) {\n                this.activeDrawingLayerSource.removeFeature(\n                  drawingLayerFeature\n                );\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.activeStore.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.activeStore.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        if (entity.properties.labelType === LabelType.Coordinates) {\n          let longLat = DDtoDMS(\n            [entity.properties.longitude, entity.properties.latitude],\n            entity.properties.measureUnit as CoordinatesUnit\n          );\n          this.updateLabelOfOlGeometry(\n            olGeometry,\n            '(' + longLat[1] + ', ' + longLat[0] + ')'\n          );\n        } else if (entity.properties.labelType === LabelType.Length) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            const radius = metersToUnit(\n              this.getRadius(circularPolygon),\n              entity.properties.measureUnit as MeasureLengthUnit\n            );\n            const unit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            const radiusLabel =\n              'R: ' + radius.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\n          } else {\n            let olGeometryLength = measureOlGeometryLength(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureLengthUnit = entity.properties\n              .measureUnit as MeasureLengthUnit;\n            measureUnit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\n            let lengthLabel =\n              olGeometry instanceof Polygon\n                ? 'P: ' +\n                  olGeometryLength.toFixed(2).toString() +\n                  ' ' +\n                  measureUnit\n                : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else if (entity.properties.labelType === LabelType.Area) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            let circleArea = measureOlGeometryArea(\n              circularPolygon,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            const unit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            circleArea = squareMetersToUnit(circleArea, temp);\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\n          } else {\n            let olGeometryArea = measureOlGeometryArea(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            measureUnit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\n            const lengthLabel =\n              olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else {\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        }\n\n        this.updateLabelType(olGeometry, entity.properties.labelType);\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\n        this.updateFontSizeAndStyle(\n          olGeometry,\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\n          entity.properties.fontStyle.substring(\n            entity.properties.fontStyle.indexOf(' ') + 1\n          )\n        );\n        this.updateFillAndStrokeColor(\n          olGeometry,\n          entity.properties.drawingStyle.fill,\n          entity.properties.drawingStyle.stroke\n        );\n        this.updateOffset(\n          olGeometry,\n          entity.properties.offsetX,\n          entity.properties.offsetY\n        );\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(\n    olFeature: OlFeature<OlGeometry>,\n    label: string,\n    labelTypeAndUnit?\n  ) {\n    const entities = this.activeStore.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n      if (olGeometryCoordinates === entityCoordinates) {\n        const fontSize = olFeature\n          .get('fontStyle')\n          .split(' ')[0]\n          .replace('px', '');\n        const fontStyle = olFeature\n          .get('fontStyle')\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\n\n        const fillColor = olFeature.get('drawingStyle').fill;\n        const strokeColor = olFeature.get('drawingStyle').stroke;\n\n        const offsetX = olFeature.get('offsetX');\n        const offsetY = olFeature.get('offsetY');\n\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\n        this.updateOffset(olGeometry, offsetX, offsetY);\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n        this.radiusFormControl.setValue(Math.round(rad));\n      }\n    }\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.activeStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null,\n        fontStyle: olGeometry.get('fontStyle_'),\n        drawingStyle: {\n          fill: olGeometry.get('fillColor_'),\n          stroke: olGeometry.get('strokeColor_')\n        },\n        offsetX: olGeometry.get('offsetX_'),\n        offsetY: olGeometry.get('offsetY_'),\n        labelType: olGeometry.get('labelType_'),\n        measureUnit: olGeometry.get('measureUnit_')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n    this.activeStore.setLayerExtent();\n    this.activeDrawControl.predefinedRadius$.next(undefined);\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  public setupLayer(isNewLayer?: boolean) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\n        disableClose: false\n      });\n      dialogRef.afterClosed().subscribe((label: string) => {\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.activeStore.state.updateAll({ selected: false });\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n            map: this.map\n          });\n          this.activeDrawingLayerSource = new OlVectorSource();\n          this.activeDrawingLayer.opacity = 0;\n          this.deactivateDrawControl();\n          this.initStore(label, isNewLayer);\n          this.activeDrawControl = this.createDrawControl(\n            this.fillColor,\n            this.strokeColor,\n            this.strokeWidth\n          );\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\n          this.toggleDrawControl();\n          this.stores.push(this.activeStore);\n          this.drawControls.push([\n            this.activeDrawingLayer.id,\n            this.activeDrawControl\n          ]);\n          this.drawControlsEvent.emit(this.drawControls);\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\n          this.isCreatingNewLayer = false;\n          if (!this.labelsAreShown) {\n            this.onToggleLabels();\n          }\n          this.activeLayerChange.emit(this.activeDrawingLayer);\n        } else {\n          this.select.value = this.activeDrawingLayer;\n          this.select.selectionChange.emit(this.activeDrawingLayer);\n        }\n      });\n    }, 250);\n  }\n\n  // HTML user interactions\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing(feature) {\n    const olGeometryFeature = featureToOl(\n      feature,\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDrawDialog(olGeometryFeature, false);\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  deleteDrawings() {\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.activeDrawingLayerSource\n        .getFeatures()\n        .forEach((drawingLayerFeature) => {\n          const geometry = drawingLayerFeature.getGeometry() as any;\n          if (selectedFeature.properties.id === geometry.ol_uid) {\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\n          }\n        });\n    });\n    this.updateHeightTable();\n    this.activeStore.setLayerExtent();\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.elementStyle(this.labelsAreShown, true)\n      : this.elementStyle(this.labelsAreShown, false);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  onToggleFreehandMode(event: any) {\n    if (this.isCircle() && !event.checked) {\n      this.activeDrawControl.ispredefinedRadius$.next(true);\n      this.changeRadius(this.radiusFormControl.value);\n    } else {\n      this.activeDrawControl.setOlInteractionStyle(\n        createInteractionStyle(\n          this.fillColor,\n          this.strokeColor,\n          this.strokeWidth\n        )\n      );\n      this.activeDrawControl.ispredefinedRadius$.next(false);\n    }\n    this.freehandMode = event.checked;\n    this.activeDrawControl.freehand$.next(event.checked);\n    this.toggleDrawControl();\n  }\n\n  // User changes properties of a drawing element\n\n  /**\n   * Display the current layer with the current store and the current layerSource\n   */\n\n  public onLayerChange(currLayer?: VectorLayer) {\n    if (currLayer) {\n      this.activeStore.state.updateAll({ selected: false });\n      this.isCreatingNewLayer = false;\n      this.activeDrawingLayer.opacity = 0;\n      this.activeDrawingLayer = currLayer;\n      this.activeDrawingLayer.opacity = 1;\n      this.deactivateDrawControl();\n      if (!this.labelsAreShown) {\n        this.onToggleLabels();\n      }\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.activeDrawingLayerSource =\n        this.activeDrawControl.olDrawingLayerSource;\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\n      this.toggleDrawControl();\n    } else {\n      this.setupLayer(true);\n    }\n    this.activeLayerChange.emit(this.activeDrawingLayer);\n  }\n\n  public createLayer(newTitle?, isNewLayer?) {\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-draw-layer', ''));\n      this.layerCounterID = Math.max(numberId, this.layerCounterID);\n    }\n    this.activeDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer' + ++this.layerCounterID,\n      title: isNewLayer\n        ? newTitle\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\n\n    tryAddLoadingStrategy(\n      this.activeStore,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n\n    tryAddSelectionStrategy(\n      this.activeStore,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.activeStore.layer.visible = true;\n    this.activeStore.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   * @param fillColor which is the filling color\n   * @param strokeColor which is the stroke color\n   */\n  onColorChange(\n    labelsAreShown: boolean,\n    isAnIcon: boolean,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\n\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\n        this.activeStore.update(entity);\n      });\n    }\n\n    this.elementStyle(labelsAreShown, isAnIcon);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFontSizeAndStyle(olFeature, size, style);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\n        olFeature.changed();\n      });\n\n      this.fontSize = size;\n      this.fontStyle = style;\n\n      this.drawStyleService.setFontSize(size);\n      this.drawStyleService.setFontStyle(style);\n\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  /**\n   * Called when the user changes the value of the horizontal/vertical offset\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param offsetX horizontal offset of the label\n   * @param offsetY vertical offset of the label\n   */\n\n  onOffsetLabelChange(\n    labelsAreShown: boolean,\n    offsetX: number,\n    offsetY: number\n  ) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateOffset(olFeature, offsetX, offsetY);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.offsetX = olFeature.get('offsetX_');\n        entity.properties.offsetY = olFeature.get('offsetY_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({\n          offsetX: entity.properties.offsetX,\n          offsetY: entity.properties.offsetY\n        });\n        olFeature.changed();\n      });\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.elementStyle(true, this.icon);\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type) {\n    this.currGeometryType = geometryType;\n    this.activeDrawControl.setGeometryType(geometryType);\n    this.freehandMode\n      ? this.onToggleFreehandMode({ checked: true })\n      : this.onToggleFreehandMode({ checked: false });\n    this.toggleDrawControl();\n  }\n\n  // Updates the properties of olFeature inputted\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param OlFeature the feature\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\n    OlFeature.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  private updateFontSizeAndStyle(\n    olFeature: OlFeature<OlGeometry>,\n    fontSize: string,\n    fontStyle: string\n  ) {\n    olFeature.setProperties(\n      {\n        fontStyle_: `${fontSize}px ${fontStyle}`\n      },\n      true\n    );\n  }\n\n  private updateFillAndStrokeColor(\n    olFeature: OlFeature<OlGeometry>,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    olFeature.setProperties(\n      {\n        fillColor_: fillColor,\n        strokeColor_: strokeColor\n      },\n      true\n    );\n  }\n\n  private updateOffset(\n    olFeature: OlFeature<OlGeometry>,\n    offsetX: number,\n    offsetY: number\n  ) {\n    olFeature.setProperties(\n      {\n        offsetX_: offsetX,\n        offsetY_: offsetY\n      },\n      true\n    );\n  }\n\n  private updateLabelType(\n    olFeature: OlFeature<OlGeometry>,\n    typeOfLabel: LabelType | [LabelType, LabelType]\n  ) {\n    olFeature.setProperties(\n      {\n        labelType_: typeOfLabel\n      },\n      true\n    );\n  }\n\n  private updateMeasureUnit(\n    olFeature: OlFeature<OlGeometry>,\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\n  ) {\n    olFeature.setProperties(\n      {\n        measureUnit_: measureUnit\n      },\n      true\n    );\n  }\n\n  // Updates values of the selected element on the HTML view\n\n  getFeatureFontSize(): string {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '15';\n  }\n\n  getFeatureFontStyle() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n  }\n\n  getFeatureFillColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\n      : 'rgba(255,255,255,0.4)';\n  }\n\n  getFeatureStrokeColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\n      : 'rgba(143,7,7,1)';\n  }\n\n  getFeatureOffsetX() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetX\n      : this.drawStyleService.getOffsetX();\n  }\n\n  getFeatureOffsetY() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetY\n      : '0';\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-draw-layer')\n    );\n  }\n\n  updateHeightTable() {\n    // Check the amount of rows as a possible alternative\n    this.numberOfDrawings = this.activeStore.count$.getValue();\n    this.numberOfDrawings > 10\n      ? (this.tableTemplate.tableHeight = '35vh')\n      : (this.tableTemplate.tableHeight = 'auto');\n  }\n\n  updateActiveLayer() {\n    let currLayer = this.allLayers.find(\n      (layer) => layer.title === this.activeDrawingLayer.title\n    );\n    return currLayer ? currLayer : this.allLayers[0];\n  }\n\n  // Helper methods\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.activeStore.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.activeDrawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.activeDrawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDrawDialog(olGeometry, true);\n      }\n    );\n\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDrawDialog(olFeature, false);\n        }\n      );\n    }\n    this.activeDrawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * get the geometry of design\n   *\n   */\n\n  isPoint() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\n  }\n\n  isLineString() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.LineString\n    );\n  }\n\n  isPolygon() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Polygon\n    );\n  }\n\n  isCircle() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Circle\n    );\n  }\n\n  /**\n   * The fonction to predefine the radius of the user\n   *\n   */\n\n  changeRadius(radius: number) {\n    let radiusMeters: number;\n\n    if (radius) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (radiusMeters = radius)\n        : (radiusMeters = radius * 1000);\n    } else {\n      radiusMeters = undefined;\n    }\n\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n      const geom = feature.getGeometry() as OlPoint;\n      const coordinates = olproj.transform(\n        geom.getCoordinates(),\n        this.map.projection,\n        'EPSG:4326'\n      );\n\n      const radius =\n        radiusMeters / Math.cos((Math.PI / 180) * coordinates[1]) / resolution;\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\n      return new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: radius,\n          stroke: new OlStyle.Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new OlStyle.Fill({\n            color: 'rgba(255,255,255,0.4)'\n          })\n        })\n      });\n    };\n\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\n    this.toggleDrawControl();\n  }\n\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\n    if (selectedMeasureUnit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = selectedMeasureUnit;\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n        : this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n    }\n  }\n\n  /**\n   * Recreates the style of the feature stored\n   */\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\n    if (isAnIcon) {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      });\n    } else {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection\n        );\n      });\n    }\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Self\n} from '@angular/core';\nimport { ControlValueAccessor, NgControl } from '@angular/forms';\n\nimport OlFeature from 'ol/Feature';\nimport OlOverlay from 'ol/Overlay';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlCircle from 'ol/geom/Circle';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\nimport Point from 'ol/geom/Point';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport * as olproj from 'ol/proj';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { Subscription } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MeasureLengthUnit,\n  formatMeasure,\n  measureOlGeometry,\n  updateOlGeometryMidpoints\n} from '../../measure';\nimport {\n  DrawControl,\n  ModifyControl,\n  ModifyControlOptions\n} from '../shared/controls';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { DrawControlOptions } from './../shared/controls/draw';\n\ninterface HasRadius {\n  getRadius: () => number;\n  setRadius: (radius: number) => void;\n}\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class GeometryFormFieldInputComponent\n  implements OnInit, OnDestroy, ControlValueAccessor\n{\n  private olOverlayLayer: OlVectorLayer<OlVectorSource>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: Type) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): Type {\n    return this._geometryType;\n  }\n  private _geometryType: Type;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get predefinedRadius(): boolean {\n    return this._predefinedRadius;\n  }\n  set predefinedRadius(value: boolean) {\n    this._predefinedRadius = value;\n    this.drawControl.ispredefinedRadius$.next(value);\n  }\n  private _predefinedRadius: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._drawStyle;\n  }\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    this._overlayStyle = value;\n  }\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._overlayStyle;\n  }\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry {\n    return this._value;\n  }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$.subscribe((olGeometry: OlGeometry) =>\n      this.onOlGeometryEnds(olGeometry)\n    );\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$.subscribe(\n        (olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) =>\n          this.onOlGeometryChanges(olGeometry)\n      );\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') {\n      // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(\n      center,\n      this.map.projection,\n      'EPSG:4326'\n    );\n    const radius = Math.round(\n      olGeometry.getRadius() * Math.cos((Math.PI / 180) * coordinates[1])\n    );\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: ['igo-map-tooltip', 'igo-map-tooltip-measure'].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex =\n      olGeometry.getType() === 'Polygon'\n        ? lengths.length - 2\n        : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyleLike | OlStyle.RegularShape,\n    resolution: number\n  ) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\n    if (olGuideStyle === undefined) {\n      return;\n    }\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyleLike | OlStyle.RegularShape\n  ): HasRadius | undefined {\n    let baseStyle: unknown;\n    if (Array.isArray(olStyle)) {\n      baseStyle = olStyle[0];\n    } else {\n      baseStyle = olStyle;\n    }\n\n    if (typeof (baseStyle as any).getImage === 'function') {\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\n    }\n\n    let guideStyle: HasRadius;\n    if (typeof (baseStyle as any).setRadius === 'function') {\n      guideStyle = baseStyle as HasRadius;\n    }\n\n    return guideStyle;\n  }\n}\n","<ng-template></ng-template>\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\"\n  [predefinedRadius]=\"$any(predefinedRadius)\"\n>\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"drawControlIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onDrawControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.drawControl' | translate }}\n  </mat-slide-toggle>\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"freehandDrawIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onfreehandControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.freehandControl' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <mat-form-field class=\"buffer\">\n    <input\n      type=\"number\"\n      matInput\n      placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n      [formControl]=\"bufferFormControl\"\n      [value]=\"0\"\n      [readonly]=\"this.formControl.value === null\"\n    />\n  </mat-form-field>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <mat-form-field class=\"radius\">\n    <input\n      type=\"number\"\n      matInput\n      placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n      [formControl]=\"radiusFormControl\"\n      [value]=\"1000\"\n      (input)=\"getRadius()\"\n      [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\"\n    />\n  </mat-form-field>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\"\n  >{{ 'igo.geo.spatialFilter.search' | translate }} :\n</mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n  <mat-radio-button\n    *ngFor=\"let item of itemType\"\n    [value]=\"item\"\n    (change)=\"onItemTypeChange($event)\"\n  >\n    {{ 'igo.geo.spatialFilter.' + item | translate }}\n  </mat-radio-button>\n</mat-radio-group>\n\n<div\n  class=\"thematics\"\n  *ngIf=\"\n    (selectedItemType === 'Thematics' && !tableTemplate) ||\n    (selectedItemType === 'Thematics' && tableTemplate && !listIsVisible)\n  \"\n>\n  <mat-table>\n    <!-- Name Column -->\n    <ng-container matColumnDef=\"name\">\n      <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{\n        'igo.geo.spatialFilter.Thematics' | translate\n      }}</mat-header-cell>\n    </ng-container>\n\n    <!-- Select Column -->\n    <ng-container matColumnDef=\"select\">\n      <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n        <mat-checkbox\n          (change)=\"$event ? masterToggle() : null\"\n          [checked]=\"isAllSelected()\"\n          [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\"\n        >\n        </mat-checkbox>\n      </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns\"></mat-row>\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"$event ? onToggleChange(node) : null\"\n          [checked]=\"selectedThematics.isSelected(node)\"\n        >\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n      <div class=\"mat-tree-node\">\n        <button mat-icon-button (click)=\"onToggleClick(node)\">\n          <mat-icon>{{\n            treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'\n          }}</mat-icon>\n        </button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check-2\"\n          (change)=\"$event ? childrensToggle(node) : null\"\n          [checked]=\"isAllSelected(node)\"\n          [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\"\n        >\n        </mat-checkbox>\n      </div>\n      <ul\n        class=\"tree-ul\"\n        [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\"\n      >\n        <ng-container matTreeNodeOutlet></ng-container>\n      </ul>\n    </mat-nested-tree-node>\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n  <button\n    *ngIf=\"isPredefined()\"\n    mat-raised-button\n    class=\"clear-search-button\"\n    [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearSearch' | translate }}\n  </button>\n\n  <button\n    *ngIf=\"isPolygon() || isPoint()\"\n    mat-raised-button\n    class=\"clear-form-button\"\n    [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearForm' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"search-button\"\n    [disabled]=\"disableSearchButton()\"\n    color=\"primary\"\n    (click)=\"toggleSearchButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.goSearch' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"remove-button\"\n    [disabled]=\"allLayers.length === 0\"\n    (click)=\"clearButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.removeLayer' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"export-button\"\n    [disabled]=\"!store.entities$.getValue().length\"\n    (click)=\"export.emit()\"\n  >\n    {{ 'igo.geo.spatialFilter.exportLayer' | translate }}\n  </button>\n</div>\n\n<button\n  class=\"expand-more\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\"\n>\n  <mat-icon>expand_more</mat-icon>\n</button>\n\n<div\n  class=\"results\"\n  *ngIf=\"store.all().length && tableTemplate && listIsVisible\"\n>\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\"\n  >\n    <mat-icon>expand_less</mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\"\n  >\n  </igo-entity-table>\n</div>\n","import { SelectionModel } from '@angular/cdk/collections';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule, MatTreeNestedDataSource } from '@angular/material/tree';\n\nimport {\n  EntityStore,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlPoint from 'ol/geom/Point';\nimport * as olproj from 'ol/proj';\nimport * as olStyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureDataSource } from '../../../datasource/shared';\nimport { GeometryType } from '../../../draw';\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { GeometryFormFieldInputComponent } from '../../../geometry/geometry-form-field/geometry-form-field-input.component';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { IgoMap } from '../../../map/shared/map';\nimport { MeasureLengthUnit } from '../../../measure';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    GeometryFormFieldInputComponent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatRadioModule,\n    MatTableModule,\n    MatCheckboxModule,\n    MatTreeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    EntityTableComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(\n      (geom) => geom === (this.type as any)\n    );\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (\n        feature: OlFeature<OlGeometry>,\n        resolution: number\n      ) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(\n          geom.getCoordinates(),\n          this.map.projection,\n          'EPSG:4326'\n        );\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius:\n              this.radius /\n              Math.cos((Math.PI / 180) * coordinates[1]) /\n              resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill: new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => {\n      this.cdRef.detectChanges();\n    });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n  @Output() predefinedRadius = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [\n    SpatialFilterItemType.Address,\n    SpatialFilterItemType.Thematics\n  ];\n  public selectedItemType: SpatialFilterItemType =\n    SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> =\n    new NestedTreeControl<SpatialFilterThematic>((node) => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(\n    true,\n    []\n  );\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new UntypedFormControl();\n  public geometryType: GeometryType;\n  public geometryTypeField = false;\n  public geometryTypes: GeometryType[] = [\n    GeometryType.Point,\n    GeometryType.Polygon\n  ];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new UntypedFormControl();\n  public bufferFormControl = new UntypedFormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.spatialFilterService\n      .loadThematicsList()\n      .subscribe((items: SpatialFilterThematic[]) => {\n        for (const item of items) {\n          this.childrens.push(item);\n          this.childrens.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        }\n        this.groups.push(\n          this.languageService.translate.instant('igo.geo.terrapi.limites')\n        );\n        const limits: SpatialFilterThematic = {\n          name: this.groups[0],\n          children: []\n        };\n        this.thematics.push(limits);\n        this.childrens.forEach((child) => {\n          if (child.group && this.groups.indexOf(child.group) === -1) {\n            this.groups.push(child.group);\n            const thematic: SpatialFilterThematic = {\n              name: child.group,\n              children: []\n            };\n            this.thematics.push(thematic);\n          }\n\n          if (!child.group) {\n            if (\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.AdmRegion'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.Arrond'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircFed'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircProv'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.DirReg'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.RegTour'\n                )\n            ) {\n              child.group = limits.name;\n            } else if (\n              child.name ===\n              this.languageService.translate.instant('igo.geo.terrapi.routes')\n            ) {\n              child.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.transport'\n              );\n            } else {\n              const thematic: SpatialFilterThematic = {\n                name: child.name,\n                children: [],\n                source: child.source\n              };\n              this.thematics.push(thematic);\n            }\n          }\n          this.thematics.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        });\n        this.thematics.forEach((thematic) => {\n          for (const child of this.childrens) {\n            if (child.group === thematic.name) {\n              thematic.children.push(child);\n            }\n          }\n        });\n      });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        if (value) {\n          this.value$.next(value);\n          this.drawZone = this.formControl.value as Feature;\n          if (this.buffer !== 0) {\n            this.drawZoneEvent.emit(this.drawZone);\n            this.bufferFormControl.setValue(this.buffer);\n          }\n        } else {\n          this.value$.next(undefined);\n          this.drawZone = undefined;\n        }\n      }\n    );\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500))\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(this.drawZone, SpatialFilterType.Polygon, value)\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.drawZone,\n              SpatialFilterType.Polygon,\n              value * 1000\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.buffer = 0;\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n          : this.bufferFormControl.setValue(\n              this.bufferFormControl.value / 1000\n            );\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n          : this.radiusFormControl.setValue(\n              this.radiusFormControl.value / 1000\n            );\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node)\n      ? this.treeControl.collapse(node)\n      : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.thematics.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach((children) => {\n        if (\n          this.selectedThematics.selected.find(\n            (thematic) => thematic === children\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach((child) => {\n      if (\n        this.selectedThematics.selected.find(\n          (thematic) => thematic.source === child.source\n        )\n      ) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ? this.selectedThematics.clear() : this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.selectedThematics.selected.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach((children) =>\n          this.selectedThematics.select(children)\n        );\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node)\n      ? node.children.forEach((child) => this.selectedThematics.deselect(child))\n      : this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (\n      this.selectedThematics.selected.find(\n        (thematic) => thematic.source === nodeSelected.source\n      ) !== undefined\n    ) {\n      selected = true;\n    }\n\n    this.childrens.forEach((children) => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach((thematic) => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n    if (this.isPoint()) {\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\n      if (this.freehandDrawIsActive) {\n        this.overlayStyle$.next(undefined);\n        this.drawStyle$.next(undefined);\n      }\n    } else {\n      this.predefinedRadius.emit(false);\n    }\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(debounceTime(500)).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.queryType !== undefined &&\n          this.zone !== undefined &&\n          this.selectedThematics.selected.length > 0\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    if (\n      this.type === SpatialFilterType.Polygon ||\n      this.type === SpatialFilterType.Point\n    ) {\n      if (\n        this.selectedItemType === SpatialFilterItemType.Address &&\n        this.formControl.value !== null\n      ) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.selectedThematics.selected.length > 0 &&\n          this.formControl.value !== null\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address\n      ? (disable = this.queryType === undefined)\n      : (disable =\n          this.queryType === undefined &&\n          this.selectedThematics.selected.length === 0);\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (formValue = this.formControl.value.radius)\n        : (formValue = this.formControl.value.radius / 1000);\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters &&\n            this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers &&\n            this.radiusFormControl.value >= 100)\n        ) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.radiusAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters\n            ? this.radiusFormControl.setValue(this.radius)\n            : this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(\n              'igo.geo.spatialFilter.radiusAlert',\n              'igo.geo.spatialFilter.warning'\n            );\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.type'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.searchResults'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"form-list\">\n  <mat-form-field class=\"zone-list\">\n    <mat-label>{{ 'igo.geo.spatialFilter.listLabel' | translate }}</mat-label>\n    <input\n      #input\n      type=\"text\"\n      placeholder=\"{{ 'igo.geo.spatialFilter.listLabel' | translate }}\"\n      matInput\n      [formControl]=\"formControl\"\n      [matAutocomplete]=\"auto\"\n    />\n    <mat-autocomplete\n      #auto=\"matAutocomplete\"\n      (optionSelected)=\"onZoneChange($event.option.value)\"\n      [displayWith]=\"displayFn\"\n    >\n      <mat-option\n        *ngFor=\"let entities of this.store.view.all$() | async\"\n        [value]=\"entities\"\n      >\n        {{ entities.properties.nom }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n  <div>\n    <div class=\"buffer-div\">\n      <mat-form-field class=\"buffer\">\n        <mat-label>{{ 'igo.geo.spatialFilter.buffer' | translate }}</mat-label>\n        <input\n          type=\"number\"\n          matInput\n          placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n          [formControl]=\"bufferFormControl\"\n          [value]=\"0\"\n          [readonly]=\"!zone\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n","import { AsyncPipe, NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\n\nimport { Feature } from '../../../feature';\nimport { Layer } from '../../../layer';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from './../../shared/spatial-filter.enum';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatAutocompleteModule,\n    ReactiveFormsModule,\n    NgFor,\n    MatOptionModule,\n    MatSelectModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new UntypedFormControl();\n\n  public bufferFormControl = new UntypedFormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.store.view.filter((feature) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const featureNameNormalized = feature.properties.nom\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            return featureNameNormalized.includes(filterNormalized);\n          });\n        }\n      }\n    );\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500), distinctUntilChanged())\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value * 1000,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService\n        .loadItemById(feature, this.queryType)\n        .subscribe((featureGeom: Feature) => {\n          this.selectedZone = featureGeom;\n          this.zoneChange.emit(featureGeom);\n        });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n        : this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\"\n>\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.spatialFilter.searchLabel' | translate\n      }}</mat-label>\n      <mat-select\n        (selectionChange)=\"onSelectionChange()\"\n        [(value)]=\"selectedQueryType\"\n      >\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{ 'igo.geo.terrapi.' + queryType | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\"\n    >\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\"\n      >\n        <mat-button-toggle\n          [value]=\"spatialType.Polygon\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\"\n        >\n          <mat-icon>pentagon</mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle\n          [value]=\"spatialType.Point\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\"\n        >\n          <mat-icon>circle</mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n</mat-tab-group>\n","import { NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Feature } from '../../../feature';\nimport { Layer } from '../../../layer';\nimport { MeasureLengthUnit } from '../../../measure';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { SpatialFilterListComponent } from '../spatial-filter-list/spatial-filter-list.component';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    SpatialFilterListComponent,\n    MatButtonToggleModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = [\n    'Arrond',\n    'CircFed',\n    'CircProv',\n    'DirReg',\n    'Mun',\n    'MRC',\n    'AdmRegion',\n    'RegTour'\n  ];\n  public selectedTypeIndex = new UntypedFormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !== 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle\n        class=\"time-filter-mat-datetimepicker-toggle\"\n        [for]=\"datetimePicker\"\n        matSuffix\n      ></mat-datetimepicker-toggle>\n      <mat-datetimepicker\n        #datetimePicker\n        [type]=\"type\"\n        [openOnFocus]=\"true\"\n        [timeInterval]=\"5\"\n      ></mat-datetimepicker>\n      <input\n        matInput\n        autocomplete=\"false\"\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"minDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #minDatetimePicker\n          [type]=\"type\"\n          [openOnFocus]=\"true\"\n          [timeInterval]=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"(startDate)\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"maxDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #maxDatetimePicker\n          [type]=\"type\"\n          [openOnFocus]=\"true\"\n          [timeInterval]=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type === 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-select\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [(ngModel)]=\"year\"\n        (selectionChange)=\"handleYearChange($event)\"\n      >\n        <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{\n          year\n        }}</mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [(ngModel)]=\"startYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option\n            [value]=\"startYear\"\n            *ngFor=\"let startYear of startListYears\"\n            >{{ startYear }}</mat-option\n          >\n        </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [(ngModel)]=\"endYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{\n            endYear\n          }}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<br />\n<div\n  *ngIf=\"!isRange && style === 'slider' && type === 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m mat-typography\"\n>\n  <span>{{ startYear }}</span>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"startYear\"\n    [max]=\"endYear\"\n    [color]=\"color\"\n    thumbLabel\n    [disabled]=\"!options.enabled || !layer.visible\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n      (change)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n    />\n  </mat-slider>\n  <span>{{ endYear }}</span>\n  <p *ngIf=\"options.enabled\" class=\"date-below\">{{ year }}</p>\n  <div #actions class=\"igo-layer-actions-container\">\n    <mat-slide-toggle\n      (change)=\"toggleFilterState()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n      [color]=\"color\"\n      [checked]=\"options.enabled\"\n      [disabled]=\"!layer.visible\"\n    >\n    </mat-slide-toggle>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"playYear($event)\"\n    >\n      <mat-icon>{{ playIcon }}</mat-icon>\n    </button>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"resetFilter($event)\"\n    >\n      <mat-icon>{{ resetIcon }}</mat-icon>\n    </button>\n  </div>\n</div>\n\n<div\n  *ngIf=\"style === 'slider' && type !== 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m\"\n>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"dateToNumber(min)\"\n    [max]=\"dateToNumber(max)\"\n    thumbLabel\n    (selectionChange)=\"handleSliderDateChange($event)\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderDateChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <p class=\"date-below\">{{ handleSliderTooltip() }}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon>{{ playIcon }}</mat-icon>\n  </button>\n</div>\n","import { NgFor, NgIf } from '@angular/common';\nimport {\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  DateAdapter,\n  MatNativeDateModule,\n  MatOptionModule,\n  ThemePalette\n} from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSlider, MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { MatDatetimepickerModule } from '@mat-datetimepicker/core';\nimport { default as moment } from 'moment';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterStyle, TimeFilterType } from '../shared/time-filter.enum';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatDatetimepickerModule,\n    MatNativeDateModule, // For the DateAdapter provider\n    MatInputModule,\n    FormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color: ThemePalette = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play_circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach((value) => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        (that) => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause_circle';\n      this.interval = setInterval(\n        () => {\n          if (this.year + this.mySlider.step > this.max.getFullYear()) {\n            this.stopFilter();\n          } else {\n            this.year = this.year + this.mySlider.step;\n          }\n          this.yearChange.emit(this.year);\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play_circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n  >\n    expand_less\n  </mat-icon>\n\n  <span\n    matListItemTitle\n    (click)=\"toggleLegendOnClick()\"\n    [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n    >{{ layer.title }}</span\n  >\n\n  <button\n    *ngIf=\"header\"\n    mat-icon-button\n    matListItemMeta\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      layer.visible\n        ? ('igo.geo.layer.hideLayer' | translate)\n        : ('igo.geo.layer.showLayer' | translate)\n    \"\n    (click)=\"layer.visible = !layer.visible\"\n  >\n    <mat-icon [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n      >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n    </mat-icon>\n  </button>\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]=\"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\"\n  >\n  </igo-time-filter-form>\n</div>\n","import { AsyncPipe, NgClass, NgIf, NgStyle } from '@angular/common';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { TimeFilterableDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { TimeFilterFormComponent } from '../time-filter-form/time-filter-form.component';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    NgStyle,\n    MatButtonModule,\n    MatTooltipModule,\n    NgClass,\n    LayerLegendComponent,\n    TimeFilterFormComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ],\n  providers: [TimeFilterService]\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<button\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    >history</mat-icon\n  >\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n>\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\"\n  >\n  </igo-time-filter-item>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { TimeFilterableDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { TimeFilterItemComponent } from '../time-filter-item/time-filter-item.component';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    TimeFilterItemComponent,\n    ListItemDirective,\n    IgoLanguageModule\n  ]\n})\nexport class TimeFilterButtonComponent implements OnInit {\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template\n    ngFor\n    let-layer\n    [ngForOf]=\"layers | filterableDataSource: 'time'\"\n  >\n    <igo-time-filter-item\n      [header]=\"true\"\n      igoListItem\n      [layer]=\"layer\"\n    ></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import { NgFor } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input\n} from '@angular/core';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { FilterableDataSourcePipe } from '../shared/filterable-datasource.pipe';\nimport { TimeFilterItemComponent } from '../time-filter-item/time-filter-item.component';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    TimeFilterItemComponent,\n    ListItemDirective,\n    FilterableDataSourcePipe\n  ]\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { TimeFilterListComponent } from './time-filter-list.component';\n\n@Directive({\n  selector: '[igoTimeFilterListBinding]',\n  standalone: true\n})\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\n  private component: TimeFilterListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: TimeFilterListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers;\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon>file_save</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources';\nimport { VectorLayer } from '../../layer/shared';\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-export-button',\n  templateUrl: './export-button.component.html',\n  styleUrls: ['./export-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class ExportButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor() {}\n\n  get options(): DataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n\n  layerIsExportable(): boolean {\n    if (\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\n      (this.layer.dataSource.options.download &&\n        this.layer.dataSource.options.download.url) ||\n      (this.layer.options.workspace?.enabled &&\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n  private httpClient: HttpClient;\n\n  constructor(handler: HttpBackend) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    return new Promise((resolve, _reject) => {\n      this.httpClient\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(\n            baseStyleList,\n            styleListResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","export class ExportError extends Error {}\r\n\r\nexport class ExportInvalidFileError extends ExportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ExportNothingToExportError extends ExportError {\r\n  constructor() {\r\n    super('Nothing to export');\r\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\r\n  }\r\n}\r\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum([\n  'URL',\n  'GeoJSON',\n  'GML',\n  'GPX',\n  'KML',\n  'Shapefile',\n  'CSVcomma',\n  'CSVsemicolon'\n]);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { downloadContent } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, Observer } from 'rxjs';\nimport { encode } from 'windows-1252';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\nimport { EncodingFormat, ExportFormat } from './export.type';\n\nconst SHAPEFILE_FIELD_MAX_LENGHT = 255;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(\n      olFeatures,\n      format,\n      '_featureStore'\n    );\n\n    return this.exportAsync(\n      exportOlFeatures,\n      format,\n      title,\n      encoding,\n      projectionIn,\n      projectionOut\n    );\n  }\n\n  public generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    excludePrefix: string = '_'\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      let keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith(excludePrefix));\n\n      if (format === ExportFormat.Shapefile && olFeature.get('_style')) {\n        const style = JSON.stringify(olFeature.get('_style'));\n        if (style.length > SHAPEFILE_FIELD_MAX_LENGHT)\n          keys = keys.filter((key) => key !== '_style');\n      }\n\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          if (key && key !== 'geometry') {\n            key === 'id' && olFeature.get('draw')\n              ? (comment += key + ':' + olFeature.get('draw') + '   \\r\\n')\n              : (comment += key + ':' + olFeature.get(key) + '   \\r\\n');\n          }\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        {\n          geometry: olFeature.getGeometry()\n        }\n      );\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(\n              olFeatures,\n              observer,\n              format,\n              title,\n              projectionIn,\n              projectionOut\n            );\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(\n          olFeatures,\n          observer,\n          format,\n          title,\n          encoding,\n          projectionIn,\n          projectionOut\n        );\n      } else {\n        this.exportToFile(\n          olFeatures,\n          observer,\n          format,\n          title,\n          projectionIn,\n          projectionOut\n        );\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'attachment/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map((f) => {\n        const encodedProperties = String.fromCharCode.apply(\n          null,\n          encode(JSON.stringify(f.properties), { mode: 'replacement' })\n        );\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName =\n      format === 'Shapefile'\n        ? `${title}.zip`\n        : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .replace(/’/g, \"'\");\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: string\n  ): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find((olFeature) => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(\n            olFeature.getGeometry().getType()\n          ) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n    super('Error 500 with OGRE');\n    Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { MessageService } from '@igo2/core/message';\nimport { uuid } from '@igo2/utils';\n\nimport { first, of } from 'rxjs';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  computeOlFeaturesExtent,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport {\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '../../style/shared/feature/feature-style';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { StyleService } from '../../style/style-service/style.service';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  layerTitle: string,\n  layerService: LayerService,\n  storeToIdb: boolean = false\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const id = uuid();\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    id,\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  let randomStyle;\n  let editable: boolean = false;\n  if (\n    olFeatures[0].getKeys().includes('_style') ||\n    olFeatures[0].getKeys().includes('_mapTitle')\n  ) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = layerService.createLayer({\n    id,\n    title: layerTitle,\n    workspace: { enabled: true, searchIndexEnabled: true },\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\n    style: randomStyle\n  }) as VectorLayer;\n  layer.setExtent(computeOlFeaturesExtent(olFeatures, map.viewProjection));\n  map.addLayer(layer);\n  moveToOlFeatures(map.viewController, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.style'),\n        feature,\n        resolution\n      );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign(\n      {\n        title: layerTitle,\n        id: layerId || uuid(),\n        isIgoInternalLayer: true,\n        source,\n        style\n      },\n      imposedLayerOptions\n    )\n  );\n  map.addLayer(layer);\n  if (zoomTo) {\n    moveToOlFeatures(map.viewController, olFeatures);\n  }\n  return layer;\n}\n\nfunction padTo2Digits(num) {\n  return num.toString().padStart(2, '0');\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  messageService: MessageService,\n  layerService: LayerService,\n  confirmDialogService?: ConfirmDialogService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  let layerTitle = computeLayerTitleFromFile(file);\n\n  const obs$ = confirmDialogService\n    ? confirmDialogService.open('igo.geo.import.promptStoreToIdb')\n    : of(false);\n\n  obs$.pipe(first()).subscribe((confirm) => {\n    const d = new Date();\n    const dformat =\n      [\n        d.getFullYear(),\n        padTo2Digits(d.getMonth() + 1),\n        padTo2Digits(d.getDate())\n      ].join('/') +\n      ' ' +\n      [padTo2Digits(d.getHours()), padTo2Digits(d.getMinutes())].join(':');\n\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\n    if (!styleListService) {\n      addLayerAndFeaturesToMap(\n        features,\n        map,\n        contextUri,\n        layerTitle,\n        layerService,\n        confirm\n      );\n    } else {\n      addLayerAndFeaturesStyledToMap(\n        features,\n        map,\n        layerTitle,\n        styleListService,\n        styleService\n      );\n    }\n\n    messageService.success(\n      'igo.geo.dropGeoFile.success.text',\n      'igo.geo.dropGeoFile.success.title',\n      undefined,\n      { value: layerTitle }\n    );\n  });\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalid.text',\n    'igo.geo.dropGeoFile.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.unreadable.text',\n    'igo.geo.dropGeoFile.unreadable.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.tooLarge.text',\n    'igo.geo.dropGeoFile.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.empty.text',\n    'igo.geo.dropGeoFile.empty.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalidSRS.text',\n    'igo.geo.dropGeoFile.invalidSRS.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.ogreServer.text',\n    'igo.geo.dropGeoFile.ogreServer.title'\n  );\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { uuid } from '@igo2/utils';\n\nimport OlFeature from 'ol/Feature';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportOgreServerError,\n  ImportSRSError,\n  ImportSizeError,\n  ImportUnreadableFileError\n} from './import.errors';\nimport { ImportExportServiceOptions } from './import.interface';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static formatExtensionAssociation = {\n    GeoJSON: 'geojson',\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'zip'\n  };\n\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService\n  ) {\n    const importConfig = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    this.ogreUrl = importConfig.url;\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    if (importConfig.formats) {\n      ImportService.allowedExtensions = importConfig.formats\n        .map((format) => ImportService.formatExtensionAssociation[format])\n        .filter((e) => e);\n      if (ImportService.allowedExtensions.includes('geojson')) {\n        ImportService.allowedExtensions.push('json');\n      }\n    }\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const allowedExtensions = ImportService.allowedExtensions;\n    let zipMimeTypes = [];\n    if (allowedExtensions.includes('zip')) {\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\n    }\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...zipMimeTypes\n    ];\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (\n          errMsg &&\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"selectedMode\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"importForm\"\n  *ngIf=\"selectedMode === 'import'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.importProjPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of projections$ | async\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle *ngIf=\"projection.translateKey\">\n            {{\n              'igo.geo.importExportForm.projections.' + projection.translateKey\n                | translate: projection\n            }}\n          </p>\n          <p matListItemTitle *ngIf=\"!projection.translateKey\">\n            {{ projection.alias }}\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      importForm.invalid\n        ? ('igo.geo.importExportForm.projections.choose' | translate)\n        : ('igo.geo.importExportForm.importButton' | translate)\n    \"\n    class=\"igo-form-button-group\"\n  >\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\"\n    >\n      {{ 'igo.geo.importExportForm.importButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($any($event.target).files)\"\n    />\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n      <li>\n        {{ 'igo.geo.importExportForm.importFormatAuthorized' | translate }}\n      </li>\n      <li>{{ 'igo.geo.importExportForm.importShpZip' | translate }}</li>\n    </ul>\n  </div>\n  <igo-custom-html\n    *ngIf=\"importHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\"\n  >\n  </igo-custom-html>\n</section>\n\n<section\n  class=\"mat-typography\"\n  *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\"\n>\n  <h4>{{ 'igo.geo.importExportForm.exportNoLayersExportable' | translate }}</h4>\n</section>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportLayerPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{ layers.length ? getLayerTitleById(layers[0]) : '' }}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{ layers.length - 1 }}\n            {{\n              (layers?.length === 2\n                ? 'igo.geo.importExportForm.other'\n                : 'igo.geo.importExportForm.others'\n              ) | translate\n            }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of exportableLayers$ | async\"\n          [ngClass]=\"{\n            'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)\n          }\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle>{{ layer.title }}</p>\n          <p matListItemTitle>\n            <mat-slide-toggle\n              *ngIf=\"layerHasSelectedFeatures(layer)\"\n              (click)=\"onlySelectedClick($event, layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event, layer.id)\"\n            >\n              <small>{{\n                'igo.geo.importExportForm.exportSelectedFeature' | translate\n              }}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportFormatPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let format of formats$ | async | keyvalue\"\n            [value]=\"format.key\"\n          >\n            {{ 'igo.geo.export.format.' + format.value | translate }}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{ 'igo.geo.export.noFormat.title' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"forceNaming && form.value.format !== 'URL'\"\n  >\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"name\"\n        placeholder=\"{{\n          'igo.geo.importExportForm.exportFileNamePlaceholder' | translate\n        }}\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"\n      form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\n    \"\n  >\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.encodingPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let encoding of encodings$ | async | keyvalue\"\n            [value]=\"encoding.key\"\n          >\n            {{ 'igo.geo.export.encoding.' + encoding.value | translate }}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"export-combine-layers mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\n    \"\n  >\n    <mat-slide-toggle\n      formControlName=\"combineLayers\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportCombineResults' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-separator mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' ||\n        form.value.format === 'CSVsemicolon') &&\n      form.value.combineLayers\n    \"\n  >\n    <mat-slide-toggle formControlName=\"separator\" [labelPosition]=\"'before'\">\n      {{ 'igo.geo.importExportForm.exportSeparator' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-options mat-typography\"\n    *ngIf=\"form.value.format !== 'URL'\"\n  >\n    <mat-slide-toggle\n      formControlName=\"featureInMapExtent\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportFeatureInExtent' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{\n        form.value.format !== 'URL'\n          ? ('igo.geo.importExportForm.exportButton' | translate)\n          : form.value.layers.length > 1\n            ? ('igo.geo.importExportForm.exportButtonLinks' | translate)\n            : ('igo.geo.importExportForm.exportButtonLink' | translate)\n      }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html\n    *ngIf=\"exportHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\"\n  >\n  </igo-custom-html>\n</form>\n","import { AsyncPipe, KeyValuePipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport {\n  MatSlideToggleChange,\n  MatSlideToggleModule\n} from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConfirmDialogService } from '@igo2/common/confirm-dialog';\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { EntityRecord } from '@igo2/common/entity';\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport type { WorkspaceStore } from '@igo2/common/workspace';\nimport { Workspace } from '@igo2/common/workspace';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\nimport { strEnum } from '@igo2/utils';\n\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\nimport olClusterSource from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { computeProjectionsConstraints } from '../../map/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportService } from '../shared/export.service';\nimport { EncodingFormat, ExportFormat } from '../shared/export.type';\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ImportExportServiceOptions } from '../shared/import.interface';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportError,\n  handleFileImportSuccess\n} from '../shared/import.utils';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss'],\n  standalone: true,\n  imports: [\n    MatButtonToggleModule,\n    NgIf,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatTooltipModule,\n    MatButtonModule,\n    SpinnerComponent,\n    CustomHtmlComponent,\n    NgClass,\n    MatSlideToggleModule,\n    MatInputModule,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ],\n  providers: [ConfirmDialogService]\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: UntypedFormGroup;\n  public importForm: UntypedFormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n  public importHtmlClarifications: string;\n  public exportHtmlClarifications: string;\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  @Input() contextUri: string;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return (\n      (this.storageService.get('importExportPopupAllowed') as boolean) || false\n    );\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService,\n    private layerService: LayerService,\n    private confirmDialogService: ConfirmDialogService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n    this.importHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.importHtmlClarifications'\n    );\n    this.exportHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.exportHtmlClarifications'\n    );\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges.subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)\n        ) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers =\n          layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({\n            encoding: encodings[Object.keys(encodings)[0]]\n          });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (\n        format === ExportFormat.CSVcomma ||\n        format === ExportFormat.CSVsemicolon\n      ) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({\n          inputProj: {\n            translateKey: 'nad83',\n            alias: 'NAD83',\n            code: 'EPSG:4326',\n            zone: ''\n          }\n        });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: '',\n        extent: undefined,\n        def: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code =\n          mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({\n          translateKey: 'mtm',\n          alias: `MTM ${mtmZone}`,\n          code,\n          zone: `${mtmZone}`,\n          extent: undefined,\n          def: undefined\n        });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code =\n          utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({\n          translateKey: 'utm',\n          alias: `UTM ${utmZone}`,\n          code,\n          zone: `${utmZone}`,\n          extent: undefined,\n          def: undefined\n        });\n      }\n    }\n\n    let configProjection: InputProjections[] = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = (this.config.getConfig('projections') ||\n        []) as InputProjections[];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(\n        (workspace) =>\n          (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace)\n            .layer.id === id\n      );\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView.firstBy(\n        (record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        }\n      );\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(\n        (layerId) => layerId !== id\n      );\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find((layerId) => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(\n      (layerId) => layerId === layer.id\n    )\n      ? true\n      : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (\n      !this.popupChecked &&\n      data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 ||\n        data.format === ExportFormat.URL) &&\n      !this.popupAllowed\n    ) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string; features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = '';\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (\n        !(\n          data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma\n        ) ||\n        !data.combineLayers ||\n        data.layers.length === 1\n      ) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant(\n          'igo.geo.export.combinedLayers'\n        );\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (\n        data.format === ExportFormat.URL &&\n        dSOptions.download &&\n        (dSOptions.download.url || dSOptions.download.dynamicUrl)\n      ) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi)\n            ? this.downloadService.open(lay)\n            : window.open(url, '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n        if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          data.featureInMapExtent\n        ) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter(\n              (e: EntityRecord<object>) =>\n                e.state.inMapExtent && e.state.selected\n            )\n            .map((e) => (e.entity as Feature).ol);\n        } else if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          !data.featureInMapExtent\n        ) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.selected)\n            .map((e) => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent)\n            .map((e) => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .map((e) => (e.entity as Feature).ol);\n        }\n      } else {\n        const ol = lay.dataSource.ol as olVectorSource | olClusterSource;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      let geomTypes: { geometryType: string; features: any[] }[] = [];\n      if (\n        data.format === ExportFormat.Shapefile ||\n        data.format === ExportFormat.GPX\n      ) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(\n            (geomType) => geomType.geometryType === featureGeomType\n          );\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({\n              geometryType: featureGeomType,\n              features: [olFeature]\n            });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach((geomType) => {\n        geomType.features.forEach((feature) => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [\n              feature.get('longitude'),\n              feature.get('latitude')\n            ];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter((geomType) =>\n          ['LineString', 'Point'].includes(geomType.geometryType)\n        );\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          this.messageService.error(\n            'igo.geo.export.gpx.error.poly.text',\n            'igo.geo.export.gpx.error.poly.title',\n            { timeOut: 20000 }\n          );\n        }\n      } else if (\n        (data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma) &&\n        data.combineLayers\n      ) {\n        geomTypes.forEach((geomType) => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach((geomType) => {\n            geomType.features.forEach((currentFeature) => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (\n                    currentFeature.get('_featureStore').layer.options.title !==\n                    previousFeature.get('_featureStore').layer.options.title\n                  ) {\n                    const titleEmptyRows = this.createTitleEmptyRows(\n                      previousFeature,\n                      currentFeature\n                    );\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(\n                    currentFeature,\n                    currentFeature\n                  );\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        this.messageService.error(\n          'igo.geo.export.nothing.text',\n          'igo.geo.export.nothing.title',\n          { timeOut: 20000 }\n        );\n      } else {\n        if (\n          !(\n            data.format === ExportFormat.CSVsemicolon ||\n            data.format === ExportFormat.CSVcomma\n          ) ||\n          !data.combineLayers\n        ) {\n          geomTypes.map((geomType) =>\n            this.exportService\n              .export(\n                geomType.features,\n                data.format,\n                filename + geomType.geometryType,\n                data.encoding,\n                this.map.projection\n              )\n              .subscribe(\n                () => {},\n                (error: Error) => this.onFileExportError(error),\n                () => {\n                  this.onFileExportSuccess();\n\n                  geomType.features.forEach((feature) => {\n                    this.circleToPoint(feature);\n                  });\n\n                  this.loading$.next(false);\n                }\n              )\n          );\n        }\n      }\n    }\n    if (\n      (data.format === ExportFormat.CSVsemicolon ||\n        data.format === ExportFormat.CSVcomma) &&\n      data.combineLayers\n    ) {\n      this.exportService\n        .export(\n          featuresCSV,\n          data.format,\n          filename,\n          data.encoding,\n          this.map.projection\n        )\n        .subscribe(\n          () => {},\n          (error: Error) => this.onFileExportError(error),\n          () => {\n            this.onFileExportSuccess();\n\n            featuresCSV.forEach((feature) => {\n              this.circleToPoint(feature);\n            });\n\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach((previousKey) => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach((key) => {\n      const sameKeys: boolean =\n        previousFeatureKeys.length === currentFeatureKeys.length &&\n        previousFeatureKeys.every(\n          (value, index) => value === currentFeatureKeys[index]\n        );\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title +\n            ' ===============>',\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!currentFeatureKeys.includes(key)) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([\n        feature.get('longitude'),\n        feature.get('latitude')\n      ]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]]\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    const importExportOptions = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    const confirmDialogService = importExportOptions?.allowToStoreLayer\n      ? this.confirmDialogService\n      : undefined;\n    if (!importExportOptions?.importWithStyle) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const extraMessage = preCheck\n      ? 'igo.geo.export.popupBlocked.selectAgain'\n      : 'igo.geo.export.popupBlocked.retry';\n    this.messageService.error(\n      'igo.geo.export.popupBlocked.text',\n      'igo.geo.export.popupBlocked.title',\n      { timeOut: 20000 },\n      { extraMessage }\n    );\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private loadConfig() {\n    const forceNamingConfig = this.config.getConfig('importExport.forceNaming');\n    this.forceNaming =\n      forceNamingConfig !== undefined ? forceNamingConfig : false;\n\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (\n      format === ExportFormat.CSVcomma ||\n      format === ExportFormat.CSVsemicolon\n    ) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({\n            layer: layer.title,\n            formats: this.validateListFormat(\n              layer.dataSource.options.download.allowedFormats\n            )\n          });\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url ||\n            layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    const configImportExportFormats = this.config.getConfig(\n      'importExport.formats'\n    );\n    if (configImportExportFormats) {\n      const validatedListFormat = this.validateListFormat(\n        configImportExportFormats\n      );\n      appliedformats = appliedformats.filter((af) =>\n        validatedListFormat.includes(af)\n      );\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map((list) => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter((value) =>\n          previousCustomListFormats.includes(value)\n        );\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter((value) =>\n        appliedformats.includes(value)\n      );\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              'igo.geo.export.customList.text',\n              'igo.geo.export.customList.title',\n              undefined,\n              { value: layersWithCustomFormats.join() }\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          'igo.geo.export.noFormat.text',\n          'igo.geo.export.noFormat.title'\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import {\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  getEntityProperty\n} from '@igo2/common/entity';\nimport { MessageService } from '@igo2/core/message';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.geo.export.failed.text',\n    'igo.geo.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.geo.export.success.text',\n    'igo.geo.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.geo.export.nothing.text',\n    'igo.geo.export.nothing.title'\n  );\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(\n  rows: any[][],\n  fileName: string,\n  separator: string = ';'\n) {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(\n  entities: object[],\n  columns: EntityTableColumn[]\n) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (\n        column.renderer === undefined ||\n        column.renderer === EntityTableColumnRenderer.Default\n      ) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <mat-checkbox\n    *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    matListItemIcon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\"\n  >\n  </mat-checkbox>\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleLegendOnClick()\"\n  >\n    {{ layer.title }}\n  </span>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"!selectionMode\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"eyeTooltip | translate\"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        >{{ (layer.visible$ | async) ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectionMode\"\n      class=\"selection-eye\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        layer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        >{{ layer.visible ? 'visibility' : 'visibility_off' }}\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"!selectionMode\"\n      class=\"actions-button\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.moreOptions' | translate\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"toggleLayerTool()\"\n    >\n      <mat-icon>more_horiz</mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Renderer2\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { LayerLegendComponent } from '../layer-legend/layer-legend.component';\nimport { Layer } from '../shared/layers/layer';\nimport { TooltipType } from '../shared/layers/layer.interface';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatCheckboxModule,\n    MatTooltipModule,\n    MatButtonModule,\n    MatIconModule,\n    MatBadgeModule,\n    NgClass,\n    LayerLegendComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (\n      value &&\n      this.layer &&\n      value.id === this.layer.id &&\n      !this.selectionMode\n    ) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible\n        ? 'igo.geo.layer.hideLayer'\n        : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility(event: Event) {\n    event.stopPropagation();\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({ layer: this.layer, check: this.layerCheck });\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ConnectionState, NetworkService } from '@igo2/core/network';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { LayerLegendComponent } from '../layer-legend/layer-legend.component';\nimport { Layer } from '../shared/layers/layer';\nimport { TooltipType } from '../shared/layers/layer.interface';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatListModule, MatTooltipModule, LayerLegendComponent]\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    >{{ layer.title }}</span\n  >\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n    [checked]=\"showAllLegendsValue\"\n    class=\"mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n    [labelPosition]=\"'before'\"\n    (change)=\"toggleShowAllLegends($event.checked)\"\n  >\n    {{ 'igo.geo.layer.legend.showAll' | translate }}\n  </mat-slide-toggle>\n  <mat-divider\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n  ></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item\n        *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n        igoListItem\n        [layer]=\"layer\"\n        [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      >\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      allowShowAllLegends\n    \"\n  >\n    {{\n      'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate\n    }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisible' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleButZoom' | translate }}\n  </p>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport {\n  BehaviorSubject,\n  EMPTY,\n  ReplaySubject,\n  Subscription,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\nimport { LayerLegendItemComponent } from '../layer-legend-item/layer-legend-item.component';\nimport { Layer } from '../shared/layers/layer';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatSlideToggleModule,\n    MatTooltipModule,\n    MatDividerModule,\n    ListComponent,\n    NgFor,\n    LayerLegendItemComponent,\n    ListItemDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> =\n    new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() {}\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && !layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers\n            .slice(0)\n            .filter(\n              (layer) =>\n                layer.showInLayerList !== false &&\n                (!this.excludeBaseLayers || !layer.baseLayer)\n            )\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter(\n      (layer: Layer) => layer.visible && layer.isInResolutionsRange\n    );\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n    this.showAllLegendsValue = toggle;\n    this.next();\n    this.allLegendsShown.emit(toggle);\n  }\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { LayerLegendListComponent } from './layer-legend-list.component';\n\n@Directive({\n  selector: '[igoLayerLegendListBinding]',\n  standalone: true\n})\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerLegendListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerLegendListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n\n        this.layersVisibility$$ = combineLatest(\n          shownLayers.map((layer: Layer) => layer.visible$)\n        ).subscribe((r) => {\n          this.component.change$.next();\n        });\n      });\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n    [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n    matTooltipShowDelay=\"500\"\n    type=\"text\"\n    [(ngModel)]=\"term\"\n  />\n  <button\n    *ngIf=\"term\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    color=\"warn\"\n    (click)=\"clearTerm()\"\n  >\n    <mat-icon>close</mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"actions-container\">\n  <button\n    class=\"sort-alpha\"\n    [class.--active]=\"sortAlpha\"\n    [color]=\"sortAlpha ? 'warn' : 'primary'\"\n    mat-icon-button\n    [matTooltip]=\"\n      sortAlpha\n        ? ('igo.geo.layer.sortMapOrder' | translate)\n        : ('igo.geo.layer.sortAlphabetically' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSortAlpha()\"\n  >\n    <mat-icon>sort_by_alpha</mat-icon>\n  </button>\n  <button\n    class=\"only-visible\"\n    mat-icon-button\n    [disabled]=\"layersAreAllVisible && !onlyVisible\"\n    [color]=\"onlyVisible ? 'warn' : 'primary'\"\n    [matTooltip]=\"\n      onlyVisible\n        ? ('igo.geo.layer.resetLayersList' | translate)\n        : ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleOnlyVisible()\"\n  >\n    <mat-icon\n      aria-hidden=\"false\"\n      matBadge=\"icon\"\n      igoMatBadgeIcon=\"visibility\"\n      [igoMatBadgeInverseColor]=\"true\"\n      [igoMatBadgeInheritColor]=\"true\"\n    >\n      {{ onlyVisible ? 'filter_alt_off' : 'filter_alt' }}\n    </mat-icon>\n  </button>\n\n  <button\n    class=\"selection-mode\"\n    mat-icon-button\n    color=\"primary\"\n    [matTooltip]=\"\n      selectionMode\n        ? ('igo.geo.layer.deactivateSelectionMode' | translate)\n        : ('igo.geo.layer.activateSelectionMode' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSelectionMode()\"\n  >\n    <mat-icon>{{\n      selectionMode ? 'library_add_check' : 'filter_none'\n    }}</mat-icon>\n  </button>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  FloatLabelType,\n  MatFormFieldModule\n} from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatFormFieldModule,\n    MatInputModule,\n    FormsModule,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    IgoLanguageModule\n  ]\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((keyword) => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe((onlyVisible) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe((sortAlpha) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower'\n}\n","<igo-layer-list-tool\n  *ngIf=\"showToolbar$ | async\"\n  floatLabel=\"auto\"\n  [layersAreAllVisible]=\"layersAreAllVisible\"\n  [term]=\"layerFilterAndSortOptions.keyword\"\n  [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n  [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n  (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n  (selection)=\"toggleSelectionMode($event)\"\n>\n</igo-layer-list-tool>\n\n<div *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"\n  >\n    {{\n      selectAllCheck\n        ? ('igo.geo.layer.deselectAll' | translate)\n        : ('igo.geo.layer.selectAll' | translate)\n    }}\n  </mat-checkbox>\n</div>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item\n      *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\"\n    >\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel\n  *ngIf=\"!selection && layerTool && activeLayer\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"activeLayer.title\"\n>\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Lower, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabled\"\n        >arrow_downward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Raise, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabled\"\n        >arrow_upward</mat-icon\n      >\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"badgeOpacity\"\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        >opacity</mat-icon\n      >\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"panel-opacity-menu\">\n      <mat-slider\n        id=\"opacity-slider\"\n        color=\"primary\"\n        discrete\n        step=\"5\"\n        [min]=\"0\"\n        [max]=\"100\"\n        [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n        (click)=\"$event.stopPropagation()\"\n        matTooltipShowDelay=\"500\"\n        tooltip-position=\"below\"\n        #ngSlider\n        ><input\n          matSliderThumb\n          [value]=\"opacity\"\n          (input)=\"\n            changeOpacity({\n              source: ngSliderThumb,\n              parent: ngSlider,\n              value: ngSliderThumb.value\n            })\n          \"\n          #ngSliderThumb=\"matSliderThumb\"\n        />\n      </mat-slider>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\"\n    >\n      <mat-icon\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        [svgIcon]=\"magnifyIcon.name\"\n      ></mat-icon>\n    </button>\n\n    <ng-container\n      igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{ layer: activeLayer }\"\n    >\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel\n  *ngIf=\"selection && layers.length > 0\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"'igo.geo.layer.tools' | translate\"\n>\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        isAllLayersRemovable(layersChecked)\n          ? ('igo.geo.layer.removeSelectedLayers' | translate)\n          : ('igo.geo.layer.removeSelectedLayersRestriction' | translate)\n      \"\n      (click)=\"removeLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"'!'\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n        >delete</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? ('igo.geo.layer.showSelectedLayers' | translate)\n          : ('igo.geo.layer.hideSelectedLayers' | translate)\n      \"\n      (click)=\"toggleVisibility(layersChecked)\"\n    >\n      <mat-icon>{{\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? 'visibility_off'\n          : 'visibility'\n      }}</mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabledSelection\"\n        >arrow_downward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabledSelection\"\n        >arrow_upward</mat-icon\n      >\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon>opacity</mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <!-- TODO: The 'tickInterval' property no longer exists -->\n        <mat-slider\n          *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          showTickMarks\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click)=\"$event.stopPropagation()\"\n          ><input matSliderThumb />\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"\n        layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\n      \"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\"\n    >\n      <mat-icon [svgIcon]=\"magnifyIcon.name\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import { AsyncPipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ContentChild,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSliderChange, MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IconService, IconSvg, MAGNIFY_SCAN_ICON } from '@igo2/common/icon';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport * as olextent from 'ol/extent';\n\nimport {\n  BehaviorSubject,\n  EMPTY,\n  ReplaySubject,\n  Subscription,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport {\n  getAllChildLayersByProperty,\n  getRootParentByProperty\n} from '../../map/shared/linkedLayers.utils';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  MetadataLayerOptions,\n  MetadataOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerItemComponent } from '../layer-item/layer-item.component';\nimport { LayerListToolComponent } from '../layer-list-tool/layer-list-tool.component';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties } from '../shared/layers/layer.interface';\nimport {\n  LayerListControlsEnum,\n  LayerListDisplacement\n} from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerListToolComponent,\n    MatCheckboxModule,\n    MatDividerModule,\n    ListComponent,\n    NgFor,\n    LayerItemComponent,\n    ListItemDirective,\n    PanelComponent,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatMenuModule,\n    MatSliderModule,\n    NgTemplateOutlet,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n  magnifyIcon: IconSvg = MAGNIFY_SCAN_ICON;\n\n  constructor(\n    private elRef: ElementRef,\n    private iconService: IconService\n  ) {\n    this.iconService.registerSvg(this.magnifyIcon);\n  }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe((valStatus) => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n            this.layers.filter(\n              (lay) => lay.baseLayer !== true && lay.showInLayerList\n            ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerExtentIsValid(layer: Layer): boolean {\n    let valid = false;\n    if (layer.options.showButtonZoomToExtent === false) {\n      return false;\n    }\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layersExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [\n      number,\n      number,\n      number,\n      number\n    ];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange) {\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(\n    activeLayer: Layer,\n    actiontype: LayerListDisplacement,\n    fromUi: boolean = false\n  ) {\n    const sortedLayersToMove = [];\n    getRootParentByProperty(this.map, activeLayer, LinkedProperties.ZINDEX);\n    let rootParentByProperty = getRootParentByProperty(\n      this.map,\n      activeLayer,\n      LinkedProperties.ZINDEX\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = activeLayer;\n    }\n    const layersToMove = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      this.map,\n      rootParentByProperty,\n      layersToMove,\n      LinkedProperties.ZINDEX\n    );\n\n    this.layers.map((layer) => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, fromUi);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, fromUi);\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[0];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[checkItems.length - 1];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every((l) => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","import { Directive, OnDestroy, OnInit, Optional, Self } from '@angular/core';\n\nimport { RouteService } from '@igo2/core/route';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { LayerListComponent } from './layer-list.component';\n\n@Directive({\n  selector: '[igoLayerListBinding]',\n  standalone: true\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n        this.setLayersVisibilityStatus(\n          shownLayers,\n          this.component.excludeBaseLayers\n        );\n      });\n  }\n\n  private setLayersVisibilityStatus(\n    layers: Layer[],\n    excludeBaseLayers: boolean\n  ) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(\n      layers\n        .filter((layer) => layer.baseLayer !== excludeBaseLayers)\n        .map((layer: Layer) => layer.visible$)\n    )\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe(\n        (allLayersAreVisible: boolean) =>\n          (this.component.layersAreAllVisible = allLayersAreVisible)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<button\n  *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\"\n>\n  <mat-icon>my_location</mat-icon>\n</button>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import { Injectable } from '@angular/core';\r\n\r\nimport { MetadataOptions } from './metadata.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MetadataService {\r\n  constructor() {}\r\n\r\n  open(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      window.open(metadata.url, '_blank');\r\n    }\r\n  }\r\n}\r\n","<button\n  *ngIf=\"\n    (options && options.metadata && options.metadata.url) ||\n    (options && options.metadata && options.metadata.abstract)\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\"\n>\n  <mat-icon>info</mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\r\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\r\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\r\n  <h3>{{ data.abstract }}</h3>\r\n</mat-dialog-content>\r\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\r\n  <h3 [innerHTML]=\"data.abstract\"></h3>\r\n</mat-dialog-content>\r\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  Input,\n  ViewEncapsulation\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialog,\n  MatDialogClose,\n  MatDialogContent,\n  MatDialogModule,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  MetadataLayerOptions,\n  MetadataOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ]\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog\n  ) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatButtonModule,\n    MatDialogClose,\n    NgIf,\n    MatDialogContent\n  ]\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\n\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { CommonModule } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core/message';\n\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\n\n@NgModule({\n  imports: [CommonModule, IgoMessageModule, QueryDirective],\n  exports: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { SearchBarComponent } from './search-bar.component';\n\n/**\n * @deprecated import the SearchBarComponent directly\n */\n@NgModule({\n  imports: [SearchBarComponent],\n  exports: [SearchBarComponent]\n})\nexport class IgoSearchBarModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\nimport { SearchResultsComponent } from './search-results.component';\n\n/**\n * @deprecated import the components directly or the SEARCH_RESULTS_DIRECTIVES\n */\n@NgModule({\n  imports: [SearchResultsComponent, SearchResultAddButtonComponent],\n  exports: [SearchResultsComponent, SearchResultAddButtonComponent]\n})\nexport class IgoSearchResultsModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @deprecated import the SearchSelectorComponent directly\n */\n@NgModule({\n  imports: [SearchSelectorComponent],\n  exports: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SearchSettingsComponent } from './search-settings.component';\n\n/**\n * @deprecated import the SearchSettingsComponent directly\n */\n@NgModule({\n  imports: [SearchSettingsComponent],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule {}\n","import { SearchSourceService } from './search-source.service';\nimport { SearchSource } from './sources/source';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat}%2C${lon}`;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return `https://www.google.com/maps/search/?api=1&query=${encodedName}`;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport * as olformat from 'ol/format';\nimport OlCircle from 'ol/geom/Circle';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport {\n  convertDDToDMS,\n  lonLatConversion,\n  roundCoordTo\n} from '../../../map/shared/map.utils';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { OsmLinks } from '../../../utils/osmLinks';\nimport { ReverseSearch, SearchResult } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { ReverseSearchOptions, SearchSourceOptions } from './source.interfaces';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[]\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled?: boolean\n  ): Observable<SearchResult<Feature>[]> {\n    return of([\n      this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)\n    ]);\n  }\n\n  private dataToResult(\n    data: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled: boolean\n  ): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce(\n      (obj, item) => ((obj[item.alias] = item.igo2CoordFormat), obj),\n      {}\n    );\n\n    const roundedCoordString = !reverseSearchCoordsFormatEnabled\n      ? roundCoordTo(data, 6).join(', ')\n      : roundCoordTo(data, 6).reverse().join(', ');\n\n    const roundedCoordStringDMS = !reverseSearchCoordsFormatEnabled\n      ? dataDMS.join(', ')\n      : dataDMS.reverse().join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform(\n        [data[0], data[1]],\n        'EPSG:4326',\n        'EPSG:3857'\n      );\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(\n        writer.writeGeometry(\n          polygonGeometry.transform('EPSG:3857', 'EPSG:4326')\n        )\n      );\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.conf'\n      );\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coord'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoord'\n        );\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coordDMS'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoordDMS'\n        );\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(properties, coords, {\n          GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n          GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n            data[0],\n            data[1]\n          ),\n          OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n          Route:\n            '<span class=\"routing\"> <u>' +\n            this.languageService.translate.instant('igo.geo.seeRouting') +\n            '</u> </span>'\n        }),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'location_on',\n        score: 100 // every coord exists\n      }\n    };\n  }\n}\n","import { Provider } from '@angular/core';\n\nexport interface SearchSourceOptions {\n  title?: string;\n  searchUrl?: string;\n  available?: boolean;\n  enabled?: boolean;\n  order?: number;\n  distance?: number;\n  params?: ISearchSourceParams;\n  settings?: SearchSourceSettings[];\n  showInPointerSummary?: boolean;\n  showInSettings?: boolean;\n  showAdvancedSettings?: boolean;\n}\n\nexport interface SearchSourceSettings {\n  type: 'radiobutton' | 'checkbox';\n  values: SettingOptions[];\n  title: string;\n  name: string;\n  allEnabled?: boolean;\n}\n\nexport interface ISearchSourceParams {\n  limit?: string;\n  datasets?: string;\n  ecmax?: string;\n  page?: string;\n  type?: string;\n}\n\nexport interface SettingOptions {\n  value: string | number;\n  enabled: boolean;\n  title: string;\n  hashtags?: string[];\n  available?: boolean;\n}\n\nexport interface TextSearchOptions {\n  params?: { [key: string]: string };\n  searchType?: 'Feature' | 'Layer'; // refer to search.enum.ts SEARCH_TYPES = [FEATURE, LAYER];\n  getEnabledOnly?: boolean;\n  extent?: [number, number, number, number];\n  page?: number;\n  sourceId?: string;\n  forceNA?: boolean;\n}\n\nexport interface ReverseSearchOptions {\n  distance?: number;\n  conf?: number;\n  zoom?: number;\n  params?: { [key: string]: string };\n}\n\nexport interface SearchSourceFeature<KindT extends SearchSourceKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum SearchSourceKind {\n  ICherche = 0,\n  IChercheReverse = 1,\n  Cadastre = 2,\n  CoordinatesReverse = 3,\n  ILayer = 4,\n  Nominatim = 5,\n  StoredQueries = 6,\n  StoredQueriesReverse = 7,\n  Workspace = 8\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * Coordinate search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the Coordinates search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the Coordinate search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n\nexport function withCoordinatesReverseSource(): SearchSourceFeature<SearchSourceKind.CoordinatesReverse> {\n  return {\n    kind: SearchSourceKind.CoordinatesReverse,\n    providers: [\n      provideCoordinatesReverseSearchSource(),\n      provideDefaultCoordinatesSearchResultFormatter()\n    ]\n  };\n}\n","import { ENGINE_ICON, IconSvg } from '@igo2/common/icon';\n\n/**\n * Icons mappings to be retrocompatible with iCherche\n */\nexport const ICHERCHE_ICONS: {\n  [key: string]: string | IconSvg;\n} = {\n  'map-marker': 'location_on',\n  city: 'location_city',\n  'flag-triangle': 'flag',\n  'map-marker-alert': 'fmd_bad',\n  'map-marker-radius': 'pin_drop',\n  'map-marker-multiple': 'local_post_office',\n  'map-legend': 'map',\n  bank: 'account_balance',\n  'map-search': 'search_insights',\n  'book-open-variant': 'menu_book',\n  'office-building': 'apartment',\n  'table-picnic': 'table_restaurant',\n  flash: 'flash_on',\n  engine: ENGINE_ICON,\n  'road-variant': 'add_road',\n  'baby-face-outline': 'child_care',\n  'home-account': 'location_home',\n  hospital: 'local_hospital',\n  pharmacy: 'local_pharmacy',\n  'police-badge-outline': 'local_police',\n  parking: 'local_parking',\n  tree: 'nature',\n  'home-city': 'home_work',\n  terrain: 'landscape',\n  'panorama-horizontal': 'panorama_horizontal'\n};\n","import {\n  HttpClient,\n  HttpParameterCodec,\n  HttpParams\n} from '@angular/common/http';\nimport { Inject, Injectable, Injector } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg } from '@igo2/common/icon';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { GoogleLinks } from './../../../utils/googleLinks';\nimport { ICHERCHE_ICONS } from './icherche-icons';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { SearchSource } from './source';\nimport {\n  ReverseSearchOptions,\n  SearchSourceOptions,\n  SearchSourceSettings,\n  TextSearchOptions\n} from './source.interfaces';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n      ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n      : [\n          'adresses',\n          'codes-postaux',\n          'routes',\n          'intersections',\n          'municipalites',\n          'mrc',\n          'regadmin',\n          'lieux'\n        ];\n\n    const showAdvancedParams = this.options.showAdvancedSettings;\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cycleStop',\n              value: 'haltes_cyclables',\n              enabled: types.indexOf('haltes_cyclables') !== -1,\n              hashtags: ['haltevelo', 'haltes_cyclables']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.restArea',\n              value: 'haltes_routieres',\n              enabled: types.indexOf('haltes_routieres') !== -1,\n              hashtags: ['halteroute', 'haltes_routieres']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cultpatri',\n              value: 'culture',\n              enabled: types.indexOf('culture') !== -1,\n              hashtags: ['grille', 'culture']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.unites',\n              value: 'unites',\n              enabled: types.indexOf('unites') !== -1,\n              hashtags: ['unites', 'adresse']\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        showAdvancedParams &&\n          ({\n            type: 'radiobutton',\n            title: 'ecmax',\n            name: 'ecmax',\n            values: [\n              {\n                title: '10 %',\n                value: 10,\n                enabled: ecmax === 10\n              },\n              {\n                title: '30 %',\n                value: 30,\n                enabled: ecmax === 30 || !ecmax\n              },\n              {\n                title: '50 %',\n                value: 50,\n                enabled: ecmax === 50\n              },\n              {\n                title: '75 %',\n                value: 75,\n                enabled: ecmax === 75\n              },\n              {\n                title: '100 %',\n                value: 100,\n                enabled: ecmax === 100\n              }\n            ]\n          } satisfies SearchSourceSettings),\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        } satisfies SearchSourceSettings\n      ].filter(Boolean)\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type: 'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(\n    response: IChercheResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(\n        this.dataToResult(data, term, response)\n      );\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    let icon: string | IconSvg = data.icon;\n    if (typeof icon == 'string' && Object.keys(ICHERCHE_ICONS).includes(icon)) {\n      icon = ICHERCHE_ICONS[icon];\n    }\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: icon || 'location_on',\n        score:\n          data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.geometry.coordinates[0],\n          data.geometry.coordinates[1]\n        );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = String(hashtag).substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.unites',\n              value: 'unites',\n              enabled: types.indexOf('unites') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'location_on',\n        pointerSummaryTitle: this.getSubtitle(data) + ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injector, Provider } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport {\n  IChercheReverseSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheSearchSource\n} from './icherche';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter(): Provider {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource(): Provider {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\nexport function withIChercheSource(): SearchSourceFeature<SearchSourceKind.ICherche> {\n  return {\n    kind: SearchSourceKind.ICherche,\n    providers: [\n      provideIChercheSearchSource(),\n      provideDefaultIChercheSearchResultFormatter()\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n\nexport function withIChercheReverseSource(): SearchSourceFeature<SearchSourceKind.IChercheReverse> {\n  return {\n    kind: SearchSourceKind.IChercheReverse,\n    providers: [\n      provideIChercheReverseSearchSource(),\n      provideDefaultIChercheSearchResultFormatter()\n    ]\n  };\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { LAYER } from '../../../layer/shared/layer.enums';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { QueryableDataSourceOptions } from '../../../query/shared/query.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport {\n  QueryFormat,\n  QueryHtmlTarget\n} from './../../../query/shared/query.enums';\nimport {\n  ILayerData,\n  ILayerDataSource,\n  ILayerItemResponse,\n  ILayerSearchSourceOptions,\n  ILayerServiceResponse\n} from './ilayer.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceSettings, TextSearchOptions } from './source.interfaces';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const showAdvancedParams = this.options.showAdvancedSettings;\n\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        } satisfies SearchSourceSettings,\n        showAdvancedParams &&\n          ({\n            type: 'radiobutton',\n            title: 'ecmax',\n            name: 'ecmax',\n            values: [\n              {\n                title: '10 %',\n                value: 10,\n                enabled: ecmax === 10\n              },\n              {\n                title: '30 %',\n                value: 30,\n                enabled: ecmax === 30\n              },\n              {\n                title: '50 %',\n                value: 50,\n                enabled: ecmax === 50 || !ecmax\n              },\n              {\n                title: '75 %',\n                value: 75,\n                enabled: ecmax === 75\n              },\n              {\n                title: '100 %',\n                value: 100,\n                enabled: ecmax === 100\n              }\n            ]\n          } satisfies SearchSourceSettings)\n      ].filter(Boolean)\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) =>\n          this.extractResults(response, term)\n        )\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse,\n    term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n      this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score:\n          data.score ||\n          computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions =\n      this.extractQueryParamsFromSourceUrl(url);\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params:\n          data.properties.format === 'wms'\n            ? { LAYERS: data.properties.name }\n            : undefined,\n        layer:\n          data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(url: string): {\n    queryFormat: QueryFormat;\n    queryHtmlTarget: QueryHtmlTarget;\n  } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = (value as any as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach((urlOpt) => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { ILayerSearchResultFormatter, ILayerSearchSource } from './ilayer';\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      ILayerSearchResultFormatter\n    ]\n  };\n}\n\nexport function withILayerSource(): SearchSourceFeature<SearchSourceKind.ILayer> {\n  return {\n    kind: SearchSourceKind.ILayer,\n    providers: [\n      provideILayerSearchSource(),\n      provideILayerSearchResultFormatter()\n    ]\n  };\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { SearchBarComponent } from './search-bar/search-bar.component';\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { SEARCH_RESULTS_DIRECTIVES } from './search-results';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { SearchSelectorComponent } from './search-selector/search-selector.component';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { SearchSettingsComponent } from './search-settings/search-settings.component';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { SearchService } from './shared/search.service';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nexport const SEARCH_DIRECTIVES = [\n  SearchBarComponent,\n  SearchSelectorComponent,\n  ...SEARCH_RESULTS_DIRECTIVES,\n  SearchSettingsComponent,\n  SearchPointerSummaryDirective\n] as const;\n\n@NgModule({\n  imports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ]\n})\nexport class IgoSearchModule {\n  /**\n   * @deprecated import the provideSearch() directly and add the source in the provider property\n   */\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListOptions } from './style-list.interface';\nimport { StyleListService } from './style-list.service';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>(\n  'styleListOptions'\n);\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div mat-dialog-content>\n  <div class=\"edition-drawing mat-typography\">\n    <form class=\"igo-form\" [formGroup]=\"form\">\n      <div\n        class=\"fill-color-picker mat-typography\"\n        *ngIf=\"linestringOnly !== true\"\n      >\n        <span>\n          <mat-icon class=\"stroke-palette-icon\">format_color_fill</mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"fill\"\n          (colorChange)=\"setLayerFillColor($event)\"\n        ></igo-color-picker-form-field>\n      </div>\n\n      <div class=\"stroke-color-picker mat-typography\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\">border_color</mat-icon>\n          {{ 'igo.geo.style.stroke' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"stroke\"\n          (colorChange)=\"setLayerStrokeColor($event)\"\n        ></igo-color-picker-form-field>\n      </div>\n    </form>\n  </div>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancel()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { NgIf } from '@angular/common';\nimport { Component, Inject, Input, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { ColorPickerFormFieldComponent } from '@igo2/common/color';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { asArray as ColorAsArray } from 'ol/color';\nimport olStyle from 'ol/style/Style';\n\nimport {\n  LayerMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer',\n  templateUrl: './style-modal-layer.component.html',\n  styleUrls: ['./style-modal-layer.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatIconModule,\n    ColorPickerFormFieldComponent,\n    MatDialogActions,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class StyleModalLayerComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  private initialValues: StyleModalData;\n\n  private defaultValues: StyleModalData = {\n    fillColor: 'rgba(255,255,255,0.4)',\n    strokeColor: 'rgba(143,7,7,1)'\n  };\n\n  get layerOlStyle(): olStyle {\n    const style = this.data.layer.ol.getStyle();\n    return style instanceof Function ? undefined : (style as olStyle).clone();\n  }\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalLayerComponent>,\n    private formBuilder: UntypedFormBuilder,\n    @Inject(MAT_DIALOG_DATA) public data: LayerMatDialogData\n  ) {}\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.layer.ol.getSource().getFeatures()) {\n      if (feature.getGeometry()?.getType() !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [this.getLayerFillColor()],\n      stroke: [this.getLayerStrokeColor()]\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n    this.initialValues = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n  }\n\n  private getLayerFillColor() {\n    let fillColor = this.defaultValues.fillColor;\n    const style = this.layerOlStyle;\n    if (style?.getFill()?.getColor()) {\n      const arrayColor = style.getFill().getColor();\n      fillColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 0.4\n      })`;\n    }\n    return fillColor;\n  }\n\n  private getLayerStrokeColor() {\n    let strokeColor = this.defaultValues.strokeColor;\n    const style = this.layerOlStyle;\n    if (style?.getStroke()?.getColor()) {\n      const arrayColor = style.getStroke().getColor();\n      strokeColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 1\n      })`;\n    }\n    return strokeColor;\n  }\n\n  setLayerFillColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getFill().setColor(cAA);\n    s.getFill().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.fillColor = event;\n  }\n\n  setLayerStrokeColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getStroke().setColor(cAA);\n    s.getStroke().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.strokeColor = event;\n  }\n\n  cancel() {\n    this.dialogRef.close();\n    this.setLayerFillColor(this.initialValues.fillColor);\n    this.setLayerStrokeColor(this.initialValues.strokeColor);\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { StyleModalLayerComponent } from '../layer/style-modal-layer.component';\nimport { LayerMatDialogData } from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer-button',\n  templateUrl: './style-modal-layer-button.component.html',\n  styleUrls: ['./style-modal-layer-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, MatTooltipModule, MatIconModule, IgoLanguageModule]\n})\nexport class StyleModalLayerButtonComponent {\n  @Input() layer: VectorLayer;\n  constructor(private dialog: MatDialog) {}\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const data: LayerMatDialogData = { layer: this.layer };\n      const dialogRef = this.dialog.open(StyleModalLayerComponent, {\n        disableClose: false,\n        data,\n        autoFocus: false\n      });\n    }, 250);\n  }\n}\n","<button\n  mat-icon-button\n  color=\"primary\"\n  (click)=\"openStyleModalDialog()\"\n  [matTooltip]=\"'igo.geo.style.styleModalTooltipLayer' | translate\"\n>\n  <mat-icon class=\"style-icon\">palette </mat-icon>\n</button>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common/dynamic-component';\nimport { WidgetComponent } from '@igo2/common/widget';\n\nimport { OgcFilterableItemComponent } from '../../../filter/ogc-filterable-item/ogc-filterable-item.component';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [OgcFilterableItemComponent]\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [map]=\"map\"\n>\n</igo-ogc-filterable-item>\n","import { NgModule } from '@angular/core';\n\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @deprecated import the OgcFilterComponent directly\n */\n@NgModule({\n  imports: [OgcFilterComponent],\n  exports: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common/widget';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @deprecated import the WorkspaceSelectorDirective directly\n */\n@NgModule({\n  imports: [WorkspaceSelectorDirective],\n  exports: [WorkspaceSelectorDirective]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoWidgetModule } from '@igo2/common/widget';\n\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { provideOgcFilterWidget } from './widgets/widgets';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\n\n@NgModule({\n  imports: [\n    IgoWidgetModule,\n    IgoOgcFilterModule,\n    IgoWorkspaceSelectorModule,\n    MatDialogModule\n  ],\n  exports: [IgoOgcFilterModule],\n  providers: [provideOgcFilterWidget()]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { QueryFormat } from '../../query/shared/query.enums';\n\nexport type CatalogQueryFormatTypes = {\n  [key in QueryFormat]: string | string[];\n};\n\nexport enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms,\n  wmts,\n  baselayers,\n  arcgisrest,\n  tilearcgisrest,\n  imagearcgisrest,\n  composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TimeFilterOptions } from '../../filter/shared/time-filter.interface';\nimport { TooltipType } from '../../layer/shared/layers/layer.interface';\nimport { QueryFormat, QueryHtmlTarget } from '../../query/shared/query.enums';\nimport { TypeCatalogStrings } from './catalog.enum';\nimport { CatalogItem, CatalogItemGroup, ICatalog } from './catalog.interface';\n\nexport abstract class Catalog implements ICatalog {\n  id: string;\n  title: string;\n  url: string;\n  removable?: boolean;\n  externalProvider?: boolean;\n  abstract?: string;\n  forcedProperties?: any[];\n  items?: CatalogItem[];\n  type?: TypeCatalogStrings;\n  version?: string;\n  matrixSet?: string;\n  requestEncoding?: string;\n  regFilters?: string[];\n  groupImpose?: CatalogItemGroup;\n  groupSeparator?: string;\n  timeFilter?: TimeFilterOptions;\n  queryFormat?: QueryFormat;\n  queryHtmlTarget?: QueryHtmlTarget;\n  queryParams?: { [key: string]: string };\n  sourceOptions?: { [key: string]: any };\n  count?: number;\n  tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n  sortDirection?: 'asc' | 'desc';\n  setCrossOriginAnonymous?: boolean;\n  showLegend?: boolean;\n  profils?: string[];\n\n  constructor(options: Catalog) {\n    Object.assign(this, options);\n  }\n\n  public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nexport type CollectCatalogItemsFn = (\n  _this: Catalog\n) => Observable<CatalogItem[]>;\n","import { Observable } from 'rxjs';\n\nimport { Catalog, CollectCatalogItemsFn } from './catalog.abstract';\nimport { TypeCatalog } from './catalog.enum';\nimport {\n  CatalogItem,\n  CatalogItemGroup,\n  ICatalog,\n  ICompositeCatalog\n} from './catalog.interface';\n\nexport class WMSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wms];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class WMTSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wmts];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class BaselayersCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.baselayers];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class ArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class TileOrImageArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    public _collectCatlogItems: CollectCatalogItemsFn,\n    typeCatalog: TypeCatalog\n  ) {\n    super(options);\n    this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n  declare composite: ICatalog[];\n\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.composite];\n    this.type = TypeCatalog[sType];\n    this.url = null;\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { ObjectUtils, uuid } from '@igo2/utils';\n\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport {\n  ArcGISRestCapabilitiesLayer,\n  ArcGISRestCapabilitiesLayerTypes\n} from '../../datasource/shared/capabilities.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport {\n  ArcGISRestDataSourceOptions,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions\n} from '../../datasource/shared/datasources';\nimport { ImageLayerOptions, LayerOptions } from '../../layer/shared';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { QueryFormat } from '../../query/shared/query.enums';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { Catalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport {\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogServiceOptions,\n  ForcedProperty\n} from './catalog.interface';\nimport {\n  ArcGISRestCatalog,\n  BaselayersCatalog,\n  CompositeCatalog,\n  TileOrImageArcGISRestCatalog,\n  WMSCatalog,\n  WMTSCatalog\n} from './catalogs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n\n    const catalogConfig: CatalogServiceOptions =\n      this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      if (catalogConfig.baselayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items: CatalogItem[] = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (\n          capabilities.Service &&\n          capabilities.Service.Abstract &&\n          capabilities.Service.Abstract.length\n        ) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(\n          capabilities.Capability.Layer,\n          0,\n          finalLayers,\n          catalog.groupSeparator\n        );\n        const capabilitiesCapabilityLayer = Object.assign(\n          {},\n          capabilities.Capability.Layer\n        );\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(\n          (f) => f.Layer.length !== 0\n        );\n        this.includeRecursiveItems(catalog, capabilitiesCapabilityLayer, items);\n        return items;\n      }),\n      catchError(() => {\n        this.messageService.error(\n          'igo.geo.catalog.unavailable',\n          'igo.geo.catalog.unavailableTitle',\n          undefined,\n          { value: catalog.title }\n        );\n        return EMPTY;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n      const modifiedParent = Object.assign({}, parent);\n      modifiedParent.Layer = [];\n      finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n      const modifiedLayer = Object.assign({}, layer);\n      if (level > 0) {\n        modifiedLayer.Title = parent.Title + separator + layer.Title;\n      }\n      if (layer.Layer) {\n        this.flattenWmsCapabilities(\n          modifiedLayer,\n          level + 1,\n          finalLayers,\n          separator\n        );\n      } else {\n        finalLayers.find((ff) => ff.Title === parent.Title).Layer.push(layer);\n      }\n    }\n  }\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n      );\n    });\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition =\n              indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          this.messageService.error(\n            catalog.title\n              ? 'igo.geo.catalog.unavailable'\n              : 'igo.geo.catalog.someUnavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            catalog.title ? { value: catalog.title } : undefined\n          );\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]\n  ): ForcedProperty {\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(\n      (f) => f.layerName === '*'\n    );\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll =\n          forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll =\n          forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map((forcedProperty) => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(\n      layer.Name,\n      catalog.forcedProperties\n    );\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource =\n      layer?.DataURL && layer?.DataURL.length > 0\n        ? layer?.DataURL[0].OnlineResource\n        : undefined;\n\n    let metadataUrl =\n      propertiesToForce?.metadataUrl ||\n      propertiesToForce?.metadataUrlAll ||\n      layerOnlineResource;\n    let metadataAbstract =\n      propertiesToForce?.metadataAbstract ||\n      propertiesToForce?.metadataAbstractAll ||\n      baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (\n      propertiesToForce?.metadataAbstract &&\n      propertiesToForce?.metadataUrlAll\n    ) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> =\n            this.prepareCatalogItemLayer(\n              layer,\n              idGroup,\n              layersQueryFormat,\n              catalog\n            );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length\n    ) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.Title,\n          catalog.forcedProperties\n        );\n        let extern = true;\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private getArcGISRESTItems(\n    catalog: Catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities || !capabilities.layers) {\n      this.messageService.error(\n        'igo.geo.catalog.someUnavailable',\n        'igo.geo.catalog.unavailableTitle'\n      );\n      return [];\n    }\n    const groups: ArcGISRestCapabilitiesLayer[] = !capabilities.layers\n      ? []\n      : capabilities.layers.filter((layer) => layer.subLayerIds);\n    const layers: ArcGISRestCapabilitiesLayer[] = !capabilities.layers\n      ? []\n      : capabilities.layers.filter(\n          (layer) =>\n            !layer.type ||\n            layer.type === ArcGISRestCapabilitiesLayerTypes.FeatureLayer ||\n            layer.type === ArcGISRestCapabilitiesLayerTypes.RasterLayer\n        );\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (\n      capabilities.serviceDescription &&\n      capabilities.serviceDescription.length\n    ) {\n      const regex = /(<([^>]+)>)/gi;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    const items: CatalogItemLayer[] = layers\n      .map((layer: ArcGISRestCapabilitiesLayer) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.name,\n          catalog.forcedProperties\n        );\n        let baseAbstract = catalog.abstract;\n        let extern = true;\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id.toString(), regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions: ArcGISRestDataSourceOptions &\n          QueryableDataSourceOptions = {\n          type: TypeCatalog[catalog.type] as any,\n          url: catalog.url,\n          layer: layer.id.toString(),\n          queryable: true,\n          queryFormat: QueryFormat.ESRIJSON,\n          optionsFromCapabilities: true\n        };\n        const sourceOptions: ArcGISRestDataSourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        );\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.name,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: catalog.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n    const groupHandledLayersIds: string[] = [];\n    const groupedItems: CatalogItemLayer[] = groups\n      .map((group) => {\n        return {\n          options: undefined,\n          address: `catalog.group.${group.name}`,\n          id: `catalog.group.${group.name}`,\n          type: CatalogItemType.Group,\n          externalProvider: catalog.externalProvider,\n          sortDirection: catalog.sortDirection,\n          title: group.name,\n          items: items\n            .filter((i) => {\n              const subLayerIdsStr = group.subLayerIds.map((r) => r.toString());\n              return subLayerIdsStr.includes(\n                (i.options.sourceOptions as ArcGISRestDataSourceOptions).layer\n              );\n            })\n            .map((i) => {\n              groupHandledLayersIds.push(i.id);\n              return Object.assign({}, i, {\n                address: `catalog.group.${group.name}`\n              });\n            })\n        };\n      })\n      .filter((g) => g.items.length);\n\n    if (groups) {\n      const TitleOrId = catalog.title || catalog.id;\n      const nonHandledLayers = items\n        .filter((i) => !groupHandledLayersIds.includes(i.id))\n        .map((i) =>\n          Object.assign({}, i, {\n            address: `catalog.group.${TitleOrId}`\n          })\n        );\n      if (nonHandledLayers.length) {\n        const nonHandledGroup = {\n          options: undefined,\n          address: `catalog.group.${TitleOrId}`,\n          id: `catalog.group.${TitleOrId}`,\n          type: CatalogItemType.Group,\n          externalProvider: catalog.externalProvider,\n          sortDirection: catalog.sortDirection,\n          title: TitleOrId,\n          items: nonHandledLayers\n        };\n        groupedItems.push(nonHandledGroup);\n      }\n    }\n\n    return groups ? groupedItems : items;\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n\nclass CatalogFactory {\n  public static createInstanceCatalog(\n    options: Catalog,\n    catalogService: CatalogService\n  ): Catalog {\n    let catalog: Catalog;\n    if (options.hasOwnProperty('composite')) {\n      catalog = new CompositeCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogCompositeLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n      catalog = new BaselayersCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogBaseLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n      catalog = new ArcGISRestCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogArcGISRestItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.tilearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.imagearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n      catalog = new WMTSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMTSLayerItems(catalog)\n      );\n    } else {\n      catalog = new WMSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMSLayerItems(catalog)\n      );\n    }\n\n    return catalog;\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    *ngIf=\"haveGroup()\"\n    class=\"catalog-browser-layer-carret\"\n    matListItemIcon\n  ></mat-icon>\n  <span\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [ngClass]=\"catalogAllowLegend ? 'igo-cataloglayer-title' : ''\"\n    (click)=\"askForLegend($event)\"\n    [matTooltip]=\"computeTitleTooltip()\"\n  >\n    {{ title }}\n  </span>\n\n  <div matListItemMeta>\n    <button *ngIf=\"layer.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloglayer-external-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        public\n      </mat-icon>\n    </button>\n    <igo-metadata-button [layer]=\"$any(layer)\"></igo-metadata-button>\n\n    <button\n      (mouseenter)=\"onMouseEvent($event)\"\n      (mouseleave)=\"onMouseEvent($event)\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"computeTooltip() | translate\"\n      [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n      (click)=\"onToggleClick($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"icon\"\n        [igoMatBadgeIcon]=\"getBadgeIcon()\"\n        igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n        igoMatBadgeBackgroundColor=\"none\"\n        [igoMatBadgeInverseColor]=\"true\"\n        [matBadgeHidden]=\"\n          ((inRange$ | async) && (isVisible$ | async) === true) ||\n          ((inRange$ | async) && !added) ||\n          ((inRange$ | async) && (isPreview$ | async))\n        \"\n        [matBadgeDisabled]=\"(inRange$ | async) === false\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n      >\n        {{ (isPreview$ | async) ? 'plus' : added ? 'delete' : 'add' }}\n      </mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"\n      (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\n    \"\n    [layer]=\"igoLayer$ | async\"\n  >\n  </igo-layer-legend>\n</div>\n","import { AsyncPipe, NgClass, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoBadgeIconDirective } from '@igo2/common/badge';\nimport { getEntityIcon, getEntityTitle } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nimport { LayerLegendComponent } from '../../layer/layer-legend/layer-legend.component';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { IgoMap } from '../../map/shared/map';\nimport { MetadataButtonComponent } from '../../metadata/metadata-button/metadata-button.component';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    NgClass,\n    MatTooltipModule,\n    MatButtonModule,\n    MetadataButtonComponent,\n    MatBadgeModule,\n    IgoBadgeIconDirective,\n    LayerLegendComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService) {}\n\n  ngOnInit(): void {\n    this.isPreview$$ = this.isPreview$.subscribe((value) =>\n      this.addedLayerIsPreview.emit(value)\n    );\n\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (resolution) => {\n        this.isInResolutionsRange(resolution);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return getEntityTitle(this.layer);\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService\n      .createAsyncLayer(this.layer.options)\n      .pipe(first())\n      .subscribe((layer) => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove(event);\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove(event);\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer, event });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove(event: Event) {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer, event });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution =\n      !this.layer.options.minResolution ||\n      Number.isNaN(this.layer.options.minResolution)\n        ? 0\n        : this.layer.options.minResolution;\n    const maxResolution =\n      !this.layer.options.maxResolution ||\n      Number.isNaN(this.layer.options.maxResolution)\n        ? Infinity\n        : this.layer.options.maxResolution;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.id) {\n      const oLayer = this.map.getLayerById(this.layer?.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.getValue()) {\n      return this.isVisible$.getValue() ? '' : 'visibility_off';\n    } else {\n      return 'visibility_off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    matListItemIcon\n    igoCollapse\n    class=\"igo-chevron catalog-browser-group-carret\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\"\n  >\n    expand_less\n  </mat-icon>\n\n  <span\n    class=\"igo-catalog-group-title\"\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"title\"\n    (click)=\"onTitleClick()\"\n    >{{ title }}</span\n  >\n\n  <div matListItemMeta>\n    <button *ngIf=\"group.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloggroup-external-icon\"\n        *ngIf=\"group.externalProvider\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        public\n      </mat-icon>\n    </button>\n\n    <ng-container\n      *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\"\n    >\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n        color=\"warn\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon>delete</mat-icon>\n      </button>\n    </ng-container>\n\n    <ng-template #notadded>\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon>add</mat-icon>\n      </button>\n    </ng-template>\n  </div>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"$any(item)\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { CollapseDirective } from '@igo2/common/collapsible';\nimport type { EntityStateManager } from '@igo2/common/entity';\nimport { EntityStore } from '@igo2/common/entity';\nimport { ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    MatIconModule,\n    CollapseDirective,\n    MatTooltipModule,\n    NgIf,\n    MatButtonModule,\n    NgFor,\n    CatalogBrowserLayerComponent,\n    ListItemDirective,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event: Event) {\n    this.added$.value ? this.remove(event) : this.add(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group,\n      event\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove(event: Event) {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group,\n      event\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: AddedChangeEmitter) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every((value) => value === added)) {\n      added ? this.add(event.event) : this.remove(event.event);\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"store.count === 1 ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"$any(item)\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common/entity';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\n\nimport { BehaviorSubject, zip } from 'rxjs';\n\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    NgIf,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent,\n    ListItemDirective,\n    AsyncPipe\n  ]\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n  // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> {\n    return this.map.viewController.resolution$;\n  }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend\n      ? catalogShowLegend\n      : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added\n      ? this.addLayerToMap(layer, event)\n      : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added\n      ? this.addGroupToMap(group, event)\n      : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\n    this.addLayersToMap([layer], event);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(\n    layers: CatalogItemLayer[],\n    event: AddedChangeEmitter | AddedChangeGroupEmitter\n  ) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      if (this.catalog.profils?.length) {\n        layer.options.security = { profils: this.catalog.profils };\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n    zip(...layers$).subscribe((layers: Layer[]) => {\n      if (event.event.type === 'click' && event.added) {\n        this.map.layersAddedByClick$.next(layers);\n      }\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(layers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const currLayer = this.map.getLayerById(layer.options.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      } else {\n        const currLayer = this.map.getLayerById(layer.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(\n    group: CatalogItemGroup,\n    event: AddedChangeGroupEmitter\n  ) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.catalog.library.addTitle' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"title\"\n          placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto2\"\n        />\n        <mat-autocomplete\n          #auto2=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.title }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"url\"\n          placeholder=\"URL\"\n          matInput\n          [matAutocomplete]=\"auto\"\n        />\n        <mat-autocomplete\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.url }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select formControlName=\"type\" placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            <p matListItemTitle>{{ type }}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant(\n          'igo.geo.catalog.externalProvider.unavailableWithEmail',\n          { value: addedCatalog.url, email: emailAddress }\n        )\n      }}\n    </p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant('igo.geo.catalog.unavailable', {\n          value: addedCatalog.url\n        })\n      }}\n    </p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.catalog.library.cancel' | translate }}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\"\n    >\n      {{ 'igo.geo.catalog.library.add' | translate }}\n    </button>\n  </div>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, OnDestroy, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { TypeCapabilities } from '../../datasource/shared/capabilities.interface';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    NgFor,\n    MatOptionModule,\n    MatTooltipModule,\n    MatSelectModule,\n    MatListModule,\n    NgIf,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: {\n      predefinedCatalogs: Catalog[];\n      store: EntityStore<Catalog>;\n      error: boolean;\n      addedCatalog: Catalog;\n    }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<mat-list-item>\n  <span matListItemTitle>\n    {{ title }}\n  </span>\n  <div matListItemMeta>\n    <mat-icon\n      *ngIf=\"catalog.externalProvider\"\n      matListItemIcon\n      class=\"igo-external-provider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n    >\n      public\n    </mat-icon>\n    <button\n      *ngIf=\"catalog.removable\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n      color=\"warn\"\n      (click)=\"removeCatalogFromLibrary($event)\"\n    >\n      <mat-icon>delete</mat-icon>\n    </button>\n\n    <button\n      class=\"igo-blank\"\n      *ngIf=\"!catalog.removable\"\n      disabled=\"true\"\n      mat-icon-button\n    >\n      <mat-icon></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { getEntityTitle } from '@igo2/common/entity';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatListModule,\n    NgIf,\n    MatIconModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogLibaryItemComponent {\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.catalog);\n  }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\"\n    >\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=\"btnAddCatalog\">\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\"\n  >\n    {{ 'igo.geo.catalog.library.addBtn' | translate }}\n    <mat-icon [svgIcon]=\"layerPlusIcon.name\"></mat-icon>\n  </button>\n</div>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { IconService, LAYER_PLUS_ICON } from '@igo2/common/icon';\nimport { ListComponent, ListItemDirective } from '@igo2/common/list';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { IgoMap } from '../../map/shared/map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    ListComponent,\n    NgFor,\n    CatalogLibaryItemComponent,\n    ListItemDirective,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n\n  layerPlusIcon = LAYER_PLUS_ICON;\n\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  get selectedCatalogId() {\n    return this.storageService.get('selectedCatalogId', StorageScope.SESSION);\n  }\n  set selectedCatalogId(id) {\n    this.storageService.set('selectedCatalogId', id, StorageScope.SESSION);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private dialog: MatDialog,\n    private iconService: IconService\n  ) {\n    this.iconService.registerSvg(this.layerPlusIcon);\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    if (this.selectedCatalogId) {\n      const selectedCatalog = this.store\n        .all()\n        .find((item) => item.id === this.selectedCatalogId);\n      if (selectedCatalog) {\n        this.onCatalogSelect(selectedCatalog);\n      }\n    }\n    this.predefinedCatalogs = this.predefinedCatalogs.map((c) => {\n      c.id = Md5.hashStr((c.type || 'wms') + standardizeUrl(c.url)) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.selectedCatalogId = catalog.id;\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      this.messageService.alert(\n        'igo.geo.catalog.library.inlist.message',\n        'igo.geo.catalog.library.inlist.title'\n      );\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n      .getCapabilities(\n        addedCatalog.type as any,\n        addedCatalog.url,\n        addedCatalog.version\n      )\n      .pipe(\n        catchError((e) => {\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          this.messageService.error(\n            'igo.geo.catalog.unavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            { value: addedCatalog.url }\n          );\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign(\n            {},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })\n          ) as Catalog\n        );\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\"\n>\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\"\n  >\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\"\n    >\n      {{ 'igo.geo.geometry.point' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\"\n    >\n      {{ 'igo.geo.geometry.line' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\"\n    >\n      {{ 'igo.geo.geometry.polygon' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\"\n  />\n  <mat-icon matPrefix [color]=\"'primary'\">adjust </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{\n    'igo.geo.measure.meters' | translate\n  }}</span>\n</mat-form-field>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormControl\n} from '@angular/forms';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoFormFieldComponent } from '@igo2/common/form';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport type { Type } from 'ol/geom/Geometry';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map.\n */\n@IgoFormFieldComponent('geometry')\n@Component({\n  selector: 'igo-geometry-form-field',\n  templateUrl: './geometry-form-field.component.html',\n  styleUrls: ['./geometry-form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    GeometryFormFieldInputComponent,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    MatButtonToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(\n    undefined\n  );\n\n  private value$$: Subscription;\n\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  private _drawControlIsActive = true;\n\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  private _freehandDrawIsActive = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  set geometryType(value: Type) {\n    this.geometryType$.next(value);\n  }\n  get geometryType(): Type {\n    return this.geometryType$.value;\n  }\n  readonly geometryType$: BehaviorSubject<Type> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Whether a geometry type toggle should be displayed\n   */\n  @Input() geometryTypeField: boolean = false;\n\n  /**\n   * Available geometry types\n   */\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\n\n  /**\n   * Whether a draw guide field should be displayed\n   */\n  @Input() drawGuideField: boolean = false;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input()\n  set drawGuide(value: number) {\n    this.drawGuide$.next(value);\n  }\n  get drawGuide(): number {\n    return this.drawGuide$.value;\n  }\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\n\n  /**\n   * Draw guide placeholder\n   */\n  @Input() drawGuidePlaceholder: string = '';\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input() drawStyle: OlStyleLike;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input() overlayStyle: OlStyleLike;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Set up a value stream\n   * @internal\n   */\n  ngOnInit() {\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        this.value$.next(value ? value : undefined);\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\n\nexport const MAP_DIRECTIVES = [\n  BaseLayersSwitcherComponent,\n  GeolocateButtonComponent,\n  HomeExtentButtonComponent,\n  HoverFeatureDirective,\n  InfoSectionComponent,\n  MapBrowserComponent,\n  MapCenterComponent,\n  MapOfflineDirective,\n  MenuButtonComponent,\n  MiniBaseMapComponent,\n  OfflineButtonComponent,\n  PointerPositionDirective,\n  RotationButtonComponent,\n  SwipeControlComponent,\n  WakeLockButtonComponent,\n  ZoomButtonComponent\n] as const;\n\n/**\n * @deprecated import the components directly or the MAP_DIRECTIVES for the set\n */\n@NgModule({\n  imports: [...MAP_DIRECTIVES],\n  exports: [...MAP_DIRECTIVES]\n})\nexport class IgoMapModule {}\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.title' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n      />\n      <mat-error *ngIf=\"titleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.title' | translate,\n                value: 130\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.subtitle' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{ 'igo.geo.printForm.subtitle' | translate }}\"\n      />\n      <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.subtitle' | translate,\n                value: 120\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.comment' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{ 'igo.geo.printForm.comment' | translate }}\"\n      />\n      <mat-error *ngIf=\"commentField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.comment' | translate,\n                value: maxLength\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container slide-toggle-container\">\n    <div class=\"print-slide-toggle-container\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showProjection' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showScale' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\"\n      >\n        {{ 'igo.geo.printForm.doZipFile' | translate }}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.printForm.legendPosition' | translate\n      }}</mat-label>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{ 'igo.geo.printForm.legendPosition' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let legendPosition of legendPositions | keyvalue\"\n          [value]=\"legendPosition.key\"\n        >\n          <ng-container\n            *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              'igo.geo.printForm.legendPositions.' + legendPosition.value\n                | translate\n            }}\n          </ng-container>\n\n          <ng-container\n            *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              (outputFormat === 'Pdf'\n                ? 'igo.geo.printForm.legendPositions.newpage'\n                : 'igo.geo.printForm.legendPositions.newimage'\n              ) | translate\n            }}\n          </ng-container>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.outputFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.outputFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let outputFormat of outputFormats | keyvalue\"\n          [value]=\"outputFormat.key\"\n        >\n          {{ outputFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.paperFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"paperFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.paperFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let paperFormat of paperFormats | keyvalue\"\n          [value]=\"paperFormat.key\"\n        >\n          {{\n            'igo.geo.printForm.paperFormats.' + paperFormat.value | translate\n          }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'none' : 'block'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.imageFormat' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.imageFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let imageFormat of imageFormats | keyvalue\"\n          [value]=\"imageFormat.key\"\n        >\n          {{ imageFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label\n        >{{ 'igo.geo.printForm.resolution' | translate }} ({{\n          'igo.geo.printForm.resolutionUnit' | translate\n        }})</mat-label\n      >\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{ 'igo.geo.printForm.resolution' | translate }}\"\n      >\n        <mat-option *ngFor=\"let resolution of resolutions\" [value]=\"resolution\">\n          {{ resolution }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.orientation' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"orientation\"\n        placeholder=\"{{ 'igo.geo.printForm.orientation' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let orientation of orientations | keyvalue\"\n          [value]=\"orientation.key\"\n        >\n          {{ 'igo.geo.printForm.' + orientation.value | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\"\n    >\n      {{ 'igo.geo.printForm.saveBtn' | translate }}\n    </button>\n  </div>\n</form>\n","import { AsyncPipe, KeyValuePipe, NgFor, NgIf } from '@angular/common';\nimport { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\nimport {\n  PrintLegendPosition,\n  PrintOrientation,\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintResolution,\n  PrintSaveImageFormat\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss'],\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    NgIf,\n    MatSlideToggleModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatButtonModule,\n    AsyncPipe,\n    KeyValuePipe,\n    IgoLanguageModule\n  ]\n})\nexport class PrintFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = [...PrintResolution];\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || ('96' satisfies PrintResolution), {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as UntypedFormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as UntypedFormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as UntypedFormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as UntypedFormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as UntypedFormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as UntypedFormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as UntypedFormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as UntypedFormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  maxLength: number = 180;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private mediaService: MediaService\n  ) {\n    this.form = this.formBuilder.group({\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\n      comment: [\n        '',\n        [Validators.minLength(0), Validators.maxLength(this.maxLength)]\n      ],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: ['', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{ hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n    if (this.mediaService.isMobile()) {\n      this.resolutions = this.resolutions.filter(\n        (resolution) => resolution !== '300'\n      );\n    }\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n      this.commentField.clearValidators();\n      this.commentField.updateValueAndValidity();\n    } else {\n      this.isPrintService = true;\n    }\n  }\n\n  changeCommentLength() {\n    switch (this.paperFormat) {\n      case PrintPaperFormat.A0:\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 900 : 600;\n        break;\n      case PrintPaperFormat.A1:\n        // A1, landscape, length 600 | A1, portrait, length 400;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 600 : 400;\n        break;\n      case PrintPaperFormat.A2:\n        // A2, landscape, length 400 | A2, portrait, length 300;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 400 : 300;\n        break;\n      case PrintPaperFormat.A3:\n        // A3, landscape, length 300 | A3, portrait, length 200;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 300 : 200;\n        break;\n      case PrintPaperFormat.A4:\n        // A4, landscape length 200 | A4, portrait length 120;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 100;\n        break;\n      case PrintPaperFormat.A5:\n        // A5, landscape length 120 | A5, portrait length 80;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 120 : 80;\n        break;\n      case PrintPaperFormat.Letter:\n        // lettre, landscape, 180 | lettre, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 180 : 140;\n        break;\n      default:\n        // legal, landscape, 200 | legal, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 140;\n        break;\n    }\n\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]);\n    this.commentField.updateValueAndValidity();\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintFormComponent } from '../print-form/print-form.component';\nimport { PrintOptions } from '../shared/print.interface';\nimport { PrintService } from '../shared/print.service';\nimport {\n  PrintLegendPosition,\n  PrintOrientation,\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintResolution,\n  PrintSaveImageFormat\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html',\n  standalone: true,\n  imports: [PrintFormComponent]\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      if (data.legendPosition === 'newpage') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      this.printService\n        .downloadMapImage(\n          this.map,\n          data.resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile,\n          data.legendPosition\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\"\n>\n</igo-print-form>\n","import { Provider } from '@angular/core';\n\nimport {\n  DirectionSourceFeature,\n  DirectionSourceKind\n} from './directions-sources';\nimport { DirectionsService } from './shared';\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\n\nexport function provideDirection(\n  ...sources: DirectionSourceFeature<DirectionSourceKind>[]\n): Provider[] {\n  const providers: Provider[] = [\n    {\n      provide: DirectionsService,\n      useClass: DirectionsService\n    },\n    provideDirectionsSourceService()\n  ];\n\n  for (const source of sources) {\n    providers.push(...source.providers);\n  }\n\n  return providers;\n}\n","import { Provider } from '@angular/core';\n\nexport interface DirectionsSourceOptions extends BaseDirectionsSourceOptions {\n  osrm?: OsrmDirectionsSourceOptions;\n  logo?: string;\n}\n\nexport type OsrmDirectionsSourceOptions = BaseDirectionsSourceOptions;\n\ninterface BaseDirectionsSourceOptions {\n  name?: string;\n  baseUrl?: string;\n  profiles?: BaseDirectionsSourceOptionsProfile[];\n}\n\nexport interface BaseDirectionsSourceOptionsProfile {\n  enabled?: boolean;\n  name: string;\n  authorization?: BaseDirectionsSourceOptionsProfileAuthorization;\n}\n\nexport interface BaseDirectionsSourceOptionsProfileAuthorization {\n  url: string;\n  property: string;\n}\n\nexport interface DirectionSourceFeature<KindT extends DirectionSourceKind> {\n  kind: KindT;\n  providers: Provider[];\n}\n\nexport enum DirectionSourceKind {\n  OSRM = 0\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { uuid } from '@igo2/utils';\n\nimport { Position } from 'geojson';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  DirectionsFormat,\n  SourceDirectionsType\n} from '../shared/directions.enum';\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from './directions-source';\nimport {\n  BaseDirectionsSourceOptionsProfile,\n  OsrmDirectionsSourceOptions\n} from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get options(): OsrmDirectionsSourceOptions {\n    return this._options;\n  }\n\n  set options(value: OsrmDirectionsSourceOptions) {\n    this._options = value;\n  }\n\n  get sourceName(): string {\n    return this._options.name;\n  }\n\n  set sourceName(value: string) {\n    this._options.name = value;\n  }\n\n  get baseUrl(): string {\n    return this._options.baseUrl;\n  }\n\n  set baseUrl(value: string) {\n    this._options.baseUrl = value;\n  }\n\n  get url(): string {\n    return `${this.baseUrl}${this.getEnabledProfile().name}/`;\n  }\n\n  get profiles(): BaseDirectionsSourceOptionsProfile[] {\n    return this._options.profiles;\n  }\n\n  set profiles(value: BaseDirectionsSourceOptionsProfile[]) {\n    this._options.profiles = value;\n  }\n\n  private _options: OsrmDirectionsSourceOptions;\n\n  constructor(\n    private _http: HttpClient,\n    private _config: ConfigService\n  ) {\n    super();\n    this._options = this._config.getConfig('directionsSources.osrm');\n    if (!this.baseUrl) {\n      this.baseUrl = '/apis/itineraire/route/v1/';\n    }\n\n    if (!this.sourceName) {\n      this.sourceName = 'OSRM Québec';\n    }\n\n    if (!this.profiles) {\n      const profile: BaseDirectionsSourceOptionsProfile = {\n        enabled: true,\n        name: 'driving'\n      };\n      this.profiles = [profile];\n    } else {\n      if (!this.profiles.find((profile) => profile.enabled)) {\n        this.profiles[0].enabled = true;\n      }\n    }\n  }\n\n  getSourceName(): string {\n    return this.sourceName;\n  }\n\n  getEnabledProfile(): BaseDirectionsSourceOptionsProfile {\n    return this.profiles.find((profile) => profile.enabled);\n  }\n\n  getProfileWithAuthorization(): BaseDirectionsSourceOptionsProfile {\n    return this.profiles.find((profile) => profile.authorization);\n  }\n\n  route(\n    coordinates: Position[],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.getRoute(coordinates, directionsParams);\n  }\n\n  private getRoute(\n    coordinates: Position[],\n    params: HttpParams\n  ): Observable<Direction[]> {\n    const url: string = this.url;\n    return this._http\n      .get<JSON[]>(url + coordinates.join(';'), {\n        params\n      })\n      .pipe(map((res) => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach((route) => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n    directionsOptions.alternatives =\n      directionsOptions.alternatives !== undefined\n        ? directionsOptions.alternatives\n        : true;\n    directionsOptions.steps =\n      directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries =\n      directionsOptions.geometries !== undefined\n        ? directionsOptions.geometries\n        : 'geojson';\n    directionsOptions.overview =\n      directionsOptions.overview !== undefined\n        ? directionsOptions.overview\n        : false;\n    directionsOptions.continue_straight =\n      directionsOptions.continue_straight !== undefined\n        ? directionsOptions.continue_straight\n        : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries\n          ? directionsOptions.geometries\n          : 'geojson',\n        continue_straight: directionsOptions.continue_straight\n          ? 'true'\n          : 'false'\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach((leg) => {\n      leg.steps.forEach((step) => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: this.url,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { DirectionsSource } from './directions-source';\nimport {\n  DirectionSourceFeature,\n  DirectionSourceKind\n} from './directions-source.interface';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n\nexport function withOsrmSource(): DirectionSourceFeature<DirectionSourceKind.OSRM> {\n  return {\n    kind: DirectionSourceKind.OSRM,\n    providers: [provideOsrmDirectionsSource()]\n  };\n}\n","export enum OverlayAction {\n  None,\n  Move,\n  Zoom,\n  ZoomIfOutMapExtent\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, OnDestroy, OnInit, Self } from '@angular/core';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { Subscription } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { IgoMap } from '../../map/shared/map';\nimport { OverlayAction } from '../shared/overlay.enum';\nimport { OverlayService } from '../shared/overlay.service';\n\n@Directive({\n  selector: '[igoOverlay]',\n  standalone: true\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe((res) =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { Provider } from '@angular/core';\n\nimport { provideSearchSourceService } from './search-source-service.providers';\nimport { SearchService } from './search.service';\nimport {\n  SearchSourceFeature,\n  SearchSourceKind\n} from './sources/source.interfaces';\n\ninterface ISearchProviderOptions {\n  /** Share the search term with analytics tracking */\n  analytics?: boolean;\n}\n\nexport function provideSearch(\n  sources: SearchSourceFeature<SearchSourceKind>[],\n  options?: ISearchProviderOptions\n): Provider[] {\n  const providers: Provider[] = [\n    options?.analytics && {\n      provide: 'searchAnalytics',\n      useValue: options.analytics\n    },\n    {\n      provide: SearchService,\n      useClass: SearchService\n    },\n    provideSearchSourceService()\n  ].filter(Boolean);\n\n  for (const source of sources) {\n    providers.push(...source.providers);\n  }\n\n  return providers;\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { customCacheHasher } from '@igo2/utils';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { GeoJsonGeometryTypes } from 'geojson';\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.replace(/ /g, '');\n    term = term.replace(/,+/g, ',');\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.getCadastre(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getCadastre(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: string,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'location_on'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\n      coordinates: (feature.getGeometry() as any).getCoordinates()\n    };\n  }\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\nimport { customCacheHasher } from '@igo2/utils';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../../feature/shared/feature.interfaces';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { NominatimData } from './nominatim.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: NominatimData[]) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: NominatimData[],\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(\n    data: NominatimData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'location_on',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach((tag) => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach((settings) => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach((conf) => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach((value) => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient, HttpParams } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport * as olformat from 'ol/format';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { ReverseSearch, SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport {\n  ReverseSearchOptions,\n  SearchSourceOptions,\n  TextSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesFields,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesReverseSearchSourceOptions,\n  StoredQueriesSearchSourceOptions\n} from './storedqueries.interfaces';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource\n  extends SearchSource\n  implements TextSearch\n{\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId =\n      this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    )\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' }).pipe(\n          map((response) => {\n            let resultArray = this.extractResults(\n              this.extractWFSData(response),\n              term\n            );\n            resultArray.sort((a, b) =>\n              a.meta.score > b.meta.score\n                ? 1\n                : a.meta.score === b.meta.score\n                  ? a.meta.titleHtml < b.meta.titleHtml\n                    ? 1\n                    : -1\n                  : -1\n            );\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd =\n                Number(this.options.params.limit) *\n                Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        )\n      : this.http.get(this.searchUrl, { params }).pipe(\n          map((response) => {\n            return this.extractResults(this.extractWFSData(response), term);\n          })\n        );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach((field) => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach((field) => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(\n    data: StoredQueriesData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'location_on',\n        score: data.properties.title\n          ? computeTermSimilarity(term.trim(), data.properties.title)\n          : computeTermSimilarity(term.trim(), data.properties[title])\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      {\n        Route:\n          '<span class=\"routing\"> <u>' +\n          this.languageService.translate.instant('igo.geo.seeRouting') +\n          '</u> </span>'\n      }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n/* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions =\n      options as StoredQueriesReverseSearchSourceOptions;\n\n    if (\n      !this.storedQueriesOptions ||\n      (this.storedQueriesOptions && !this.storedQueriesOptions.available)\n    ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    const isGml = new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    );\n    const request$ = isGml\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' })\n      : this.http.get(this.searchUrl, { params });\n    return request$.pipe(\n      map((response) => {\n        return this.extractResults(this.extractWFSData(response));\n      })\n    );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'location_on'\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesReverseData): {\n    [key: string]: any;\n  } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      properties,\n      { type: data.properties.doc_type },\n      routing\n    );\n  }\n}\n","import { Inject, Injectable } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport { FEATURE } from '../../../feature/shared/feature.enums';\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { WorkspaceData } from './workspace.interfaces';\n\n/**\n * Workspace search source\n */\n@Injectable()\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\n  static id = 'workspace';\n  static type = FEATURE;\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n  }\n\n  getId(): string {\n    return WorkspaceSearchSource.id;\n  }\n\n  getType(): string {\n    return WorkspaceSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit: Number = 5;\n\n    return {\n      title: 'igo.geo.search.workspace.name',\n      searchUrl: undefined,\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'datasets',\n          name: 'datasets',\n          values: []\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            { title: '1', value: 1, enabled: limit === 1 },\n            { title: '5', value: 5, enabled: limit === 5 || !limit },\n            { title: '10', value: 10, enabled: limit === 10 },\n            { title: '25', value: 25, enabled: limit === 25 },\n            { title: '50', value: 50, enabled: limit === 50 }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\n    const limitValue =\n      (limitSetting.values.find((v) => v.enabled).value as number) || 5;\n    this.options.params.limit = limitValue.toLocaleString();\n    const results: WorkspaceData[] = [];\n    this.options.params.page = (options.page || 1).toLocaleString();\n    const page = options.page || 1;\n    const datasets = this.options.params.datasets.split(',');\n    this.featureStoresWithIndex\n      .filter(\n        (fswi) => fswi.searchDocument && datasets.includes(fswi.layer.title)\n      )\n      .map((fswi) => {\n        const termToUse = term;\n        fswi.searchDocument\n          .search(termToUse, { limit: page * limitValue })\n          .map((foundIn) => {\n            const field = foundIn.field;\n            foundIn.result.map((index) => {\n              const feature = fswi.index.get(index);\n              const score = computeTermSimilarity(\n                termToUse.trim(),\n                feature.properties[field]\n              );\n              results.push({ index, feature, layer: fswi.layer, field, score });\n            });\n          });\n      });\n\n    results.sort((a, b) => (a.score > b.score ? -1 : 1));\n    const gettedIndex = [];\n    const sortedResultToProcess: WorkspaceData[] = [];\n    results.map((r) => {\n      if (!gettedIndex.includes(r.index)) {\n        gettedIndex.push(r.index);\n        sortedResultToProcess.push(r);\n      }\n    });\n\n    return of(\n      this.extractResults(\n        sortedResultToProcess\n          .sort((a, b) => (a.score > b.score ? -1 : 1))\n          .slice(0, page * limitValue)\n      )\n    );\n  }\n\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\n    return results.map((result) => this.dataToResult(result, results.length));\n  }\n\n  private dataToResult(\n    data: WorkspaceData,\n    resultsCnt: number\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.index].join('.');\n    const titleHtml = data.feature.properties[data.field];\n    const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.feature.geometry,\n        extent: data.feature.extent,\n        properties,\n        meta: {\n          id,\n          title: data.feature.properties[data.field],\n          alias: this.getAllowedFieldsAndAlias(data.layer)\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.feature.meta.title,\n        titleHtml: titleHtml + subtitleHtml2,\n        icon: 'location_on',\n        score: data.score,\n        nextPage:\n          resultsCnt % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    } as SearchResult<Feature>;\n  }\n\n  private getAllowedFieldsAndAlias(layer: Layer) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  private computeProperties(data: WorkspaceData): { [key: string]: any } {\n    if (!data.feature.geometry) {\n      return Object.assign(\n        { type: data.layer.title + '.' + data.field },\n        data.feature.properties\n      );\n    }\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n    let googleMaps;\n    if (data.feature.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.feature.geometry.coordinates[0],\n        data.feature.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.feature.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a>';\n    if (data.feature.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.feature.geometry.coordinates[0],\n          data.feature.geometry.coordinates[1]\n        );\n    }\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      { type: data.feature.sourceId },\n      data.feature.properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n}\n","import { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { SearchSource } from './source';\nimport { SearchSourceFeature, SearchSourceKind } from './source.interfaces';\nimport { WorkspaceSearchSource } from './workspace';\n\n/**\n * Workspace search source factory\n * @ignore\n */\nexport function workspaceSearchSourceFactory(\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new WorkspaceSearchSource(\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the Workspace search source\n */\nexport function provideWorkspaceSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: workspaceSearchSourceFactory,\n    multi: true,\n    deps: [LanguageService, StorageService, ConfigService]\n  };\n}\n\nexport function withWorkspaceSource(): SearchSourceFeature<SearchSourceKind.Workspace> {\n  return {\n    kind: SearchSourceKind.Workspace,\n    providers: [provideWorkspaceSearchSource()]\n  };\n}\n","import olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\n\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 1,\n  markerOutlineColor = [0, 255, 255],\n  fillColor,\n  fillOpacity = 0.15,\n  strokeColor = [0, 255, 255],\n  strokeOpacity = 0.5,\n  strokeWidth = 4\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 0.5,\n  markerOutlineColor,\n  fillColor = [0, 161, 222],\n  fillOpacity = 0.15,\n  strokeColor = [0, 161, 222],\n  strokeOpacity = 0.5,\n  strokeWidth = 2\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (\n      markerColorAsArray.length === 4 &&\n      (typeof markerColor !== 'string' ||\n        /^#[0-9A-F]{8}$/i.test(markerColor as string))\n    ) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (\n      !(\n        fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(fillColor as string))\n      )\n    ) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (\n      !(\n        strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(strokeColor as string))\n      )\n    ) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\n\nimport { RegexOptions } from './regex.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RegexService {\n  protected options: RegexOptions;\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('regex');\n  }\n\n  getAll() {\n    return this.options;\n  }\n\n  get(key) {\n    if (this.options) {\n      return this.options[key];\n    }\n    return;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { RegexService } from '@igo2/core/regex';\n\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PropertyTypeDetectorService {\n  public geoServiceRegexes: GeoServiceDefinition[] = [];\n\n  constructor(private regexService: RegexService) {\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\n  }\n\n  getPropertyType(value) {\n    return typeof value;\n  }\n\n  private isUrl(value): boolean {\n    const regex = /^https?:\\/\\//;\n    return regex.test(value.toString());\n  }\n\n  isGeoService(value): boolean {\n    let isGeoService = false;\n    if (!this.isUrl) {\n      return;\n    }\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(value)) {\n        isGeoService = true;\n        break;\n      }\n    }\n    return isGeoService;\n  }\n\n  getGeoService(\n    url: string,\n    availableProperties: string[]\n  ): GeoServiceDefinition {\n    if (!this.isGeoService(url)) {\n      return;\n    }\n    let matchingGeoservice: GeoServiceDefinition;\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(url)) {\n        // providing the the first matching regex;\n        const matchingProperties = availableProperties.filter((p) =>\n          geoServiceRegex.propertiesForLayerName.includes(p)\n        );\n        matchingGeoservice = matchingProperties ? geoServiceRegex : undefined;\n        if (matchingGeoservice) {\n          break;\n        }\n      }\n    }\n    return matchingGeoservice;\n  }\n\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\n    return (this.regexService.get('geoservice') ||\n      []) as GeoServiceDefinition[];\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import {\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableButton,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { Workspace } from '@igo2/common/workspace';\nimport { StorageScope } from '@igo2/core/storage';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Observable } from 'rxjs';\nimport { map, skipWhile, take } from 'rxjs/operators';\n\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams\n} from '../../datasource/shared/datasources/datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { WfsWorkspace } from './wfs-workspace';\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean) ||\n    true\n  );\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(\n    `workspace.rowsInMapExtent.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.selectedOnly.${layerId}`) as boolean) ||\n    false\n  );\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(\n    `workspace.selectedOnly.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function mapExtentStrategyActiveToolTip(\n  ws: Workspace\n): Observable<string> {\n  return ws.entityStore\n    .getStrategyOfType(EntityStoreFilterCustomFuncStrategy)\n    .active$.pipe(\n      map((active: boolean) =>\n        active\n          ? 'igo.geo.workspace.inMapExtent.active.tooltip'\n          : 'igo.geo.workspace.inMapExtent.inactive.tooltip'\n      )\n    );\n}\n\nexport function noElementSelected(ws: Workspace): Observable<boolean> {\n  return ws.entityStore.stateView\n    .manyBy$((record: EntityRecord<Feature>) => {\n      return record.state.selected === true;\n    })\n    .pipe(map((entities: EntityRecord<Feature>[]) => entities.length >= 1));\n}\n\nexport function addOrRemoveLayer(\n  action: 'add' | 'remove',\n  map: IgoMap,\n  url: string,\n  type: string,\n  layerName: string,\n  layerService: LayerService\n) {\n  const so = ObjectUtils.removeUndefined({\n    sourceOptions: {\n      type: type,\n      url,\n      optionsFromCapabilities: true,\n      optionsFromApi: true,\n      params: {\n        LAYERS: type === 'wms' ? layerName : undefined,\n        LAYER: type === 'wms' ? undefined : layerName\n      }\n    }\n  });\n  if (action === 'add') {\n    layerService.createAsyncLayer(so).subscribe((layer) => {\n      map.layersAddedByClick$.next([layer]);\n      map.addLayer(layer);\n    });\n  } else if (action === 'remove') {\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\n    map.removeLayer(map.layers.find((l) => l.id === addedLayerId));\n  }\n}\n\nexport function getGeoServiceAction(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layerService: LayerService\n) {\n  const geoServiceAction = [\n    {\n      name: 'geoServiceAction',\n      title: undefined,\n      tooltip: '',\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\n        let geoServiceProperties = record.state.geoService;\n        if (\n          geoServiceProperties &&\n          geoServiceProperties.haveGeoServiceProperties &&\n          geoServiceProperties.url &&\n          geoServiceProperties.layerName\n        ) {\n          if (geoServiceProperties.added) {\n            return [\n              {\n                icon: 'delete',\n                color: 'warn',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'remove',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = false;\n                }\n              }\n            ] as EntityTableButton[];\n          } else {\n            return [\n              {\n                icon: 'add',\n                color: 'primary',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'add',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = true;\n                }\n              }\n            ] as EntityTableButton[];\n          }\n        } else {\n          return [];\n        }\n      }\n    }\n  ];\n  return geoServiceAction;\n}\n\nexport function createTableTemplate(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layer: VectorLayer,\n  layerService: LayerService,\n  ws$\n) {\n  const geoServiceAction = getGeoServiceAction(workspace, layerService);\n  const fields = layer.dataSource.options.sourceFields || [];\n\n  const relations = layer.dataSource.options.relations || [];\n\n  if (fields.length === 0) {\n    workspace.entityStore.entities$\n      .pipe(\n        skipWhile((val) => val.length === 0),\n        take(1)\n      )\n      .subscribe((entities) => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol\n          .getKeys()\n          .filter(\n            (col) =>\n              !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi)\n          )\n          .map((key) => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures,\n          tableHeight: '100%'\n        } as EntityTableTemplate;\n      });\n    return;\n  }\n  const columns = fields.map((field: SourceFieldsOptionsParams) => {\n    return {\n      name: `properties.${field.name}`,\n      title: field.alias ? field.alias : field.name,\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n      tooltip: field.tooltip,\n      cellClassFunc: () => {\n        const cellClass = {};\n        if (field.type) {\n          cellClass[`class_${field.type}`] = true;\n          return cellClass;\n        }\n      }\n    } as EntityTableColumn;\n  });\n\n  const relationsColumn = relations.map((relation: RelationOptions) => {\n    return {\n      name: `properties.${relation.name}`,\n      title: relation.alias ? relation.alias : relation.name,\n      renderer: EntityTableColumnRenderer.Icon,\n      icon: relation.icon,\n      parent: relation.parent,\n      type: 'relation',\n      tooltip: relation.tooltip,\n      onClick: () => {\n        ws$.next(relation.title);\n      },\n      cellClassFunc: () => {\n        return { class_icon: true };\n      }\n    };\n  });\n\n  columns.push(...relationsColumn);\n  columns.unshift(...geoServiceAction);\n  workspace.meta.tableTemplate = {\n    selection: true,\n    sort: true,\n    columns,\n    tableHeight: '100%'\n  };\n}\n\nexport function createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n  const filterClauseFunc = (record: EntityRecord<object>) => {\n    return (\n      record.state.inMapExtent === true && record.state.inMapResolution === true\n    );\n  };\n  return new EntityStoreFilterCustomFuncStrategy({\n    filterClauseFunc\n  } as EntityStoreStrategyFuncOptions);\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport {\n  GeoWorkspaceOptions,\n  LayerService,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions,\n  getCommonVectorSelectedStyle\n} from '../../style/shared';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector';\nimport { WfsWorkspace } from './wfs-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { FeatureDataSource } from '../../datasource/shared/datasources';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSearchIndexStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions,\n  getCommonVectorSelectedStyle\n} from '../../style/shared';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { FeatureWorkspace } from './feature-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\n      percentDistinctValueRatio: 2,\n      sourceFields: layer.dataSource.options.sourceFields\n    });\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    if (layer.options.workspace?.searchIndexEnabled) {\n      store.addStrategy(searchStrategy, true);\n    }\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef\n} from '@angular/material/dialog';\n\nimport { LanguageService } from '@igo2/core/language';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n  selector: 'igo-confirmation-popup-component',\n  templateUrl: './confirmation-popup.component.html',\n  styleUrls: ['./confirmation-popup.component.scss'],\n  standalone: true,\n  imports: [MatDialogContent, MatDialogActions, MatButtonModule]\n})\nexport class ConfirmationPopupComponent {\n  constructor(\n    public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n    public languageService: LanguageService,\n    @Inject(MAT_DIALOG_DATA) public data: { type: string; cancel: boolean }\n  ) {}\n\n  cancelAction() {\n    this.data.cancel = true;\n    this.dialogRef.close(this.data.cancel);\n  }\n\n  confirmedAction() {\n    this.data.cancel = false;\n    this.dialogRef.close(this.data.cancel);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{\n      data.type === 'add'\n        ? languageService.translate.instant('igo.geo.workspace.addConfirmation')\n        : languageService.translate.instant(\n            'igo.geo.workspace.deleteConfirmation'\n          )\n    }}\n  </p>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"confirmedAction()\">\n    Ok\n  </button>\n  <button mat-raised-button (click)=\"cancelAction()\">\n    {{ languageService.translate.instant('igo.geo.workspace.cancel') }}\n  </button>\n</div>\n","import { MatDialog } from '@angular/material/dialog';\n\nimport { EntityRecord } from '@igo2/common/entity';\nimport { Workspace, WorkspaceOptions } from '@igo2/common/workspace';\nimport { ConfigService } from '@igo2/core/config';\n\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { FeatureDataSource, RelationOptions } from '../../datasource/shared';\nimport { GeometryType, createInteractionStyle } from '../../draw/shared';\nimport { featureToOl } from '../../feature/shared';\nimport { DrawControl } from '../../geometry/shared';\nimport { ImageLayer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): ImageLayer | VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    private dialog: MatDialog,\n    private configService: ConfigService,\n    private adding$: BehaviorSubject<boolean>,\n    private getDomainValues: (relation: RelationOptions) => Observable<any>,\n    protected options: EditionWorkspaceOptions\n  ) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: { type: 'delete' }\n      });\n\n      dialogRef.afterClosed().subscribe((result) => {\n        if (result === false) {\n          let id, url;\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl =\n            workspace.layer.dataSource.options.edition.deleteUrl;\n          if (baseUrl.length) {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') +\n                baseUrl +\n                '?' +\n                deleteUrl\n              : baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') + deleteUrl\n              : deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns) {\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.getDomainValues(column.relation).subscribe((result) => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(\n        JSON.stringify(feature.properties)\n      );\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(\n            feature,\n            { newFeature: true },\n            true\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(\n    geometryType: Type,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl(feature, workspace);\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    );\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(\n    feature,\n    workspace: EditionWorkspace,\n    olGeometry?: OlGeometry\n  ) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(\n    olFeature: OlFeature<OlGeometry>,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach((feature) => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import {\n  HttpClient,\n  HttpErrorResponse,\n  HttpHeaders\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ActionStore } from '@igo2/common/action';\nimport {\n  EntityStoreFilterSelectionStrategy,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageService } from '@igo2/core/storage';\n\nimport olFeature from 'ol/Feature';\nimport { FeatureLoader } from 'ol/featureloader';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport WKT from 'ol/format/WKT';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\n\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams,\n  WMSDataSource\n} from '../../datasource/shared/datasources';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy\n} from '../../feature/shared';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  GeoWorkspaceOptions,\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap, MapBase } from '../../map/shared';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { EditionWorkspace } from './edition-workspace';\nimport { createFilterInMapExtentOrResolutionStrategy } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(\n    undefined\n  );\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n  public wktFormat = new WKT();\n  public geoJsonFormat = new GeoJSON();\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (\n      layer.options.workspace?.enabled !== true ||\n      layer.dataSource.options.edition.enabled !== true\n    ) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace(\n          this.dialog,\n          this.configService,\n          this.adding$,\n          (relation: RelationOptions) => this.getDomainValues(relation),\n          {\n            id: layer.id,\n            title: layer.title,\n            layer: workspaceLayer,\n            map,\n            entityStore: this.createFeatureStore(workspaceLayer, map),\n            actionStore: new ActionStore([]),\n            meta: {\n              tableTemplate: undefined\n            }\n          }\n        );\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          wksConfig\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(\n    workspace: EditionWorkspace,\n    layer: VectorLayer\n  ): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [\n      {\n        name: 'edition',\n        title: undefined,\n        renderer: EntityTableColumnRenderer.ButtonGroup,\n        primary: false,\n        valueAccessor: () => {\n          return [\n            {\n              editMode: false,\n              icon: 'edit',\n              color: 'primary',\n              disabled:\n                layer.dataSource.options.edition.modifyButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.editFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: false,\n              icon: 'delete',\n              color: 'warn',\n              disabled:\n                layer.dataSource.options.edition.deleteButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.deleteFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'check',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.saveFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'close',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.cancelEdit(workspace, feature);\n              }\n            }\n          ] as EntityTableButton[];\n        }\n      }\n    ];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$\n        .pipe(\n          skipWhile((val) => val.length === 0),\n          take(1)\n        )\n        .subscribe((entities) => {\n          const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n          const columnsFromFeatures = ol\n            .getKeys()\n            .filter(\n              (col) =>\n                !col.startsWith('_') &&\n                col !== 'geometry' &&\n                col !== ol.getGeometryName() &&\n                !col.match(/boundedby/gi)\n            )\n            .map((key) => {\n              return {\n                name: `properties.${key}`,\n                title: key,\n                renderer: rendererType\n              };\n            });\n          workspace.meta.tableTemplate = {\n            selection: false,\n            sort: true,\n            columns: columnsFromFeatures\n          };\n        });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe((result) => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { class_icon: true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)) {\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n    let url = this.configService.getConfig('edition.url');\n\n    if (!url) {\n      url = baseUrl;\n    } else {\n      url += baseUrl ? baseUrl : '';\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (\n        workspace.layer.dataSource.options.edition.modifyProtocol !== 'post'\n      ) {\n        url +=\n          '?' +\n          workspace.layer.dataSource.options.edition.modifyUrl +\n          feature.idkey;\n      } else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole =\n        workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders =\n        workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any }\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false)\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http\n      .post(`${url}`, feature.properties, { headers: headers })\n      .subscribe(\n        () => {\n          this.loading = false;\n          workspace.entityStore.stateView.clear();\n          workspace.deleteDrawings();\n          workspace.entityStore.delete(feature);\n\n          this.messageService.success('igo.geo.workspace.addSuccess');\n\n          this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n          this.adding$.next(false);\n          this.rowsInMapExtentCheckCondition$.next(true);\n        },\n        (error) => {\n          this.loading = false;\n          error.error.caught = true;\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach((message) => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error('igo.geo.workspace.addError');\n            }\n          } else {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        }\n      );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  public modifyFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any },\n    protocole = 'patch'\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      // Remove 3e dimension\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false) ||\n          property === 'boundedBy'\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, {\n      headers: headers\n    }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        this.messageService.success('igo.geo.workspace.modifySuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url')\n        ? this.configService.getConfig('edition.url') + relation.table\n        : relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map((result) => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: MapBase) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader: FeatureLoader = (\n      extent,\n      resolution,\n      proj,\n      success,\n      failure\n    ) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions as WFSDataSourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(\n          layer.id.substr(0, layer.id.indexOf('.') - 1)\n        ) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      ) {\n        const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n        let params = wmsOlLayer.getParams();\n        params._t = new Date().getTime();\n        wmsOlLayer.updateParams(params);\n      }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    let message;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys(column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (\n                column.validation[type] &&\n                (!feature.properties.hasOwnProperty(key) ||\n                  !feature.properties[key])\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.mandatory',\n                  undefined,\n                  undefined,\n                  { column: column.title }\n                );\n              }\n              break;\n            }\n            case 'minValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n          }\n        });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (\n        column.type === 'list' &&\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]\n      ) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[\n            getColumnKeyWithoutPropertiesTag(column.name)\n          ].toString();\n      }\n    });\n  }\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n\nfunction removeZ(coords: any) {\n  if (coords.length === 0) return coords;\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\n  return coords.map(removeZ);\n}\n","import { Injectable } from '@angular/core';\n\nimport { ActionStore } from '@igo2/common/action';\nimport { EntityStoreFilterSelectionStrategy } from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\n\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\n\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature/shared';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  GeoWorkspaceOptions,\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\nimport {\n  FeatureCommonVectorStyleOptions,\n  OverlayStyleOptions\n} from '../../style/shared/vector/vector-style.interface';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { WfsWorkspace } from './wfs-workspace';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private capabilitiesService: CapabilitiesService,\n    private styleService: StyleService,\n    private configService: ConfigService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(\n        (lay) => lay.id === layer.id + '.WfsWorkspaceTableDest'\n      ) ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    let wks;\n    let wksLayerOption: GeoWorkspaceOptions = {\n      printable: layer.options.workspace?.printable,\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab:\n          layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled\n            ? (dataSource.options as QueryableDataSourceOptions)\n                .queryFormatAsWms\n            : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        createTableTemplate(wks, workspaceLayer, this.layerService, this.ws$);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          enabled: true,\n          srcId: layer.id,\n          workspaceId: workspaceLayer.id,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            ) as FeatureCommonVectorStyleOptions\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\n\nimport {\n  Workspace,\n  WorkspaceSelectorComponent,\n  WorkspaceStore\n} from '@igo2/common/workspace';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  FeatureDataSource,\n  WFSDataSource,\n  WMSDataSource\n} from '../../datasource/shared/datasources';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared';\nimport { ImageLayer, Layer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]',\n  standalone: true\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) => this.onLayersChange(layers));\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.adding$.subscribe((adding) => {\n      this.disableSwitch.emit(adding);\n    });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => {\n      this.relationLayers.emit(layers);\n    });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(\n      (condition) => {\n        this.rowsInMapExtentCheckCondition.emit(condition);\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map((entities) => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore\n      .all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(\n          FeatureStoreInMapExtentStrategy\n        );\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {\n        active: false,\n        selected: false\n      });\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(\n    layer: VectorLayer | ImageLayer\n  ): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (\n      layer.dataSource instanceof WFSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return wfsWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      if (!layer.dataSource.options.paramsWFS) {\n        return;\n      }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable =\n          !inResolutionRange;\n        (\n          wmsWks.layer.dataSource.options as QueryableDataSourceOptions\n        ).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n      layer.dataSource instanceof FeatureDataSource &&\n      (layer as VectorLayer).exportable === true &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return featureWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled === true\n    ) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (\n        dataSourceOptions.ogcFilters?.enabled ||\n        dataSource.options.paramsWFS?.featureTypes !== undefined\n      );\n    }\n\n    return false;\n  }\n}\n","/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - (s.length % 3);\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import { HttpParams } from '@angular/common/http';\n\nexport function customCacheHasher(parameters: unknown[]): unknown[] {\n  return parameters.map((param) => {\n    if (param instanceof HttpParams) {\n      return param.toString();\n    }\n    return param !== undefined ? JSON.parse(JSON.stringify(param)) : param;\n  });\n}\n","import Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","import { Observable, Observer } from 'rxjs';\n\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = (1 << length) - 1;\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\nexport class Compression {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = {\n          length: text64.length,\n          type: blob.type,\n          object: compressed\n        };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], { type: compressedData.type });\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = value << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n    /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n\n  static isValidNumber(value: string): boolean {\n    return !isNaN(Number(value));\n  }\n\n  static isOctalNumber(value: string): boolean {\n    return (\n      StringUtils.isValidNumber(value) &&\n      value.startsWith('0') &&\n      value.length > 1\n    );\n  }\n}\n","import { ChangeType, GroupingChanges } from './change.interface';\nimport { StringUtils } from './string-utils';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex((s) => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map((itemAdded) => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach((key) => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class DomUtils {\n  static create<K extends keyof HTMLElementTagNameMap>(\n    doc: Document,\n    tagName: K,\n    options?: Partial<HTMLElementTagNameMap[K]>\n  ): HTMLElementTagNameMap[K] {\n    const el = doc.createElement(tagName);\n\n    for (const key in options) {\n      el[key] = options[key];\n    }\n\n    return el;\n  }\n\n  static remove(node: HTMLElement | SVGElement): void {\n    if (!node.parentNode) {\n      return;\n    }\n    node.parentNode.removeChild(node);\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(\n  content: string,\n  mimeType: string,\n  fileName: string\n) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n\n/**\n * Validate if string is valid json object\n * @param jsonString\n * @return boolean\n */\nexport function isValidJSON(jsonString: string): boolean {\n  try {\n    return JSON.parse(jsonString) && !!jsonString;\n  } catch (e) {\n    return false;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key.replace(/\\[/g, '.').replace(/\\]/g, '').split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter((key) => !ignoreUndefined || source[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                (f) => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== null)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n            ? 3\n            : b === undefined\n              ? -3\n              : a === null\n                ? 2\n                : b === null\n                  ? -2\n                  : a === ''\n                    ? 1\n                    : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter((key) => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n\n  static isEmpty(obj: object): boolean {\n    return Object.keys(obj).length === 0;\n  }\n}\n","export class NumberUtils {\n  static roundToNDecimal(num: number, decimal: number = 3): number {\n    const roundFactor = Math.pow(10, decimal);\n    return Math.round(num * roundFactor) / roundFactor;\n  }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","import { DomUtils } from './dom.utils';\n\nconst PATH_PREBUILT_THEMES = 'assets/igo2/core/theming/prebuilt-themes';\nconst LINK_ID = 'theme-styles';\n\nexport function loadTheme(\n  doc: Document,\n  themeName: string,\n  path: string = PATH_PREBUILT_THEMES\n): void {\n  const src = `${path}/${themeName}.css`;\n  const head = doc.getElementsByTagName('head')[0];\n\n  let themeLink = doc.getElementById(LINK_ID) as HTMLLinkElement;\n  themeLink ? (themeLink.href = src) : createHtmlLink(doc, src, head);\n}\n\nfunction createHtmlLink(doc: Document, src: string, parent: HTMLElement): void {\n  const element = DomUtils.create(doc, 'link', {\n    id: LINK_ID,\n    rel: 'stylesheet',\n    href: src\n  });\n  parent.appendChild(element);\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.user' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        placeholder=\"{{ 'igo.auth.user' | translate }}\"\n        formControlName=\"username\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.password' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        type=\"password\"\n        placeholder=\"{{ 'igo.auth.password' | translate }}\"\n        formControlName=\"password\"\n      />\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">\n    {{ 'igo.auth.login' | translate }}\n  </button>\n  <button\n    *ngIf=\"allowAnonymous\"\n    mat-raised-button\n    class=\"anonymous\"\n    type=\"button\"\n    (click)=\"loginAnonymous()\"\n  >\n    {{ 'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br />\n    <font size=\"3\" color=\"red\">{{ error }}</font>\n  </div>\n</form>\n\n<div *ngIf=\"loading\" class=\"loading-container\">\n  <mat-spinner [diameter]=\"40\"></mat-spinner>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinner } from '@angular/material/progress-spinner';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default,\n  standalone: true,\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatProgressSpinner,\n    NgIf,\n    IgoLanguageModule\n  ]\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: UntypedFormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: UntypedFormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe((errorMsg) => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Inject,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg, IgoIconComponent, MICROSOFT_ICON } from '@igo2/common/icon';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport {\n  MSAL_GUARD_CONFIG,\n  MsalBroadcastService,\n  MsalService\n} from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  InteractionRequiredAuthError,\n  InteractionStatus,\n  PopupRequest,\n  PublicClientApplication,\n  SilentRequest\n} from '@azure/msal-browser';\nimport { Subject } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\n\nimport {\n  AuthMicrosoftOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth-microsoft.interface';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, IgoLanguageModule, IgoIconComponent]\n})\nexport class AuthMicrosoftComponent {\n  private options?: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  svgIcon: IconSvg = MICROSOFT_ICON;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoft');\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options?.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService\n          .loginWithToken(tokenAccess, 'microsoft', { tokenId })\n          .subscribe(() => {\n            this.appRef.tick();\n            this.login.emit(true);\n          });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n        console.log(error);\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'add')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoft()\"\n>\n  <igo-icon [icon]=\"svgIcon\"></igo-icon>\n  {{ 'igo.auth.microsoft.login' | translate }}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nimport { Location } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\n\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { IMsalService } from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  EndSessionPopupRequest,\n  EndSessionRequest,\n  IPublicClientApplication,\n  Logger,\n  PopupRequest,\n  RedirectRequest,\n  SilentRequest,\n  SsoSilentRequest,\n  WrapperSKU\n} from '@azure/msal-browser';\nimport { Observable, from } from 'rxjs';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n  private redirectHash: string;\n  private logger: Logger;\n  private name = '@azure/msal-angular';\n  private version = '2.0.0-beta.2';\n  constructor(\n    @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n    private location: Location\n  ) {\n    const hash = this.location.path(true).split('#').pop();\n    if (hash) {\n      this.redirectHash = `#${hash}`;\n    }\n    this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n  }\n\n  initialize(): Observable<void> {\n    return from(this.instance.initialize());\n  }\n\n  acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenPopup(request));\n  }\n  acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n    return from(this.instance.acquireTokenRedirect(request));\n  }\n  acquireTokenSilent(\n    silentRequest: SilentRequest\n  ): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenSilent(silentRequest));\n  }\n  handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n    return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n  }\n  loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.loginPopup(request));\n  }\n  loginRedirect(request?: RedirectRequest): Observable<void> {\n    return from(this.instance.loginRedirect(request));\n  }\n  logout(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logout(logoutRequest));\n  }\n  logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logoutRedirect(logoutRequest));\n  }\n  logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n    return from(this.instance.logoutPopup(logoutRequest));\n  }\n  ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n    return from(this.instance.ssoSilent(request));\n  }\n  /**\n   * Gets logger for msal-angular.\n   * If no logger set, returns logger instance created with same options as msal-browser\n   */\n  getLogger(): Logger {\n    if (!this.logger) {\n      this.logger = this.instance.getLogger().clone(this.name, this.version);\n    }\n    return this.logger;\n  }\n  // Create a logger instance for msal-angular with the same options as msal-browser\n  setLogger(logger: Logger): void {\n    this.logger = logger.clone(this.name, this.version);\n    this.instance.setLogger(logger);\n  }\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nimport { Inject, Injectable } from '@angular/core';\n\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport {\n  EventMessage,\n  EventMessageUtils,\n  IPublicClientApplication,\n  InteractionStatus\n} from '@azure/msal-browser';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n  private _msalSubject: Subject<EventMessage>;\n  public msalSubject$: Observable<EventMessage>;\n  private _inProgress: BehaviorSubject<InteractionStatus>;\n  public inProgress$: Observable<InteractionStatus>;\n\n  constructor(\n    @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n    private authService: MsalServiceb2c\n  ) {\n    this._msalSubject = new Subject<EventMessage>();\n    this.msalSubject$ = this._msalSubject.asObservable();\n\n    // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n    this._inProgress = new BehaviorSubject<InteractionStatus>(\n      InteractionStatus.Startup\n    );\n    this.inProgress$ = this._inProgress.asObservable();\n\n    this.msalInstance.addEventCallback((message: EventMessage) => {\n      this._msalSubject.next(message);\n      const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n      if (status !== null) {\n        this.authService\n          .getLogger()\n          .verbose(\n            `BroadcastService - ${message.eventType} results in setting inProgress to ${status}`\n          );\n        this._inProgress.next(status);\n      }\n    });\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Inject,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { IconSvg, IgoIconComponent, MICROSOFT_ICON } from '@igo2/common/icon';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  AuthenticationResult,\n  InteractionRequiredAuthError,\n  InteractionStatus,\n  PopupRequest,\n  PublicClientApplication,\n  SilentRequest\n} from '@azure/msal-browser';\nimport { Subject } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\n\nimport {\n  AuthMicrosoftb2cOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth-microsoft.interface';\nimport { MsalBroadcastServiceb2c } from './auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule, IgoLanguageModule, IgoIconComponent],\n  providers: [MsalServiceb2c]\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  svgIcon: IconSvg = MICROSOFT_ICON;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'b2c')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoftb2c()\"\n>\n  <igo-icon [icon]=\"svgIcon\"></igo-icon>\n  {{ 'igo.auth.microsoftb2c.login' | translate }}\n</button>\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Output\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\n\nimport { AuthFacebookOptions } from '../shared/auth-facebook.interface';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AuthFacebookComponent {\n  private options?: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook');\n\n    if (this.options?.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', (rep) => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options?.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  scope=\"public_profile,email\"\n  class=\"fb-login-button\"\n  data-max-rows=\"1\"\n  data-size=\"large\"\n  data-button-type=\"login_with\"\n  data-show-faces=\"false\"\n  data-auto-logout-link=\"false\"\n  data-use-continue-as=\"false\"\n></div>\n","import {\n  ApplicationRef,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Output\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { AuthGoogleOptions } from '../shared/auth-google.interface';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AuthGoogleComponent {\n  private options?: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google');\n\n    if (this.options?.apiKey && this.options?.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn(\n        'Google authentification needs \"apiKey\" and \"clientId\" options'\n      );\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options?.apiKey,\n        clientId: this.options?.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2\n          .getAuthInstance()\n          .isSignedIn.listen((rep) => {\n            this.updateSigninStatus(rep);\n          });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.login'\n        );\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.logged'\n        );\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  class=\"g-signin2 google-login-button\"\n  data-height=\"40\"\n  data-width=\"265\"\n  data-longtitle=\"true\"\n></div>\n","<div *ngIf=\"visible\">\n  <div\n    *ngIf=\"!auth.logged && backgroundDisable\"\n    class=\"backgroundDisable\"\n  ></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{ 'igo.auth.connection' | translate }}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-google>\n\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoft>\n\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoftb2c>\n\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-facebook>\n\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-intern>\n  </div>\n\n  <div\n    *ngIf=\"auth.logged && showAlreadyConnectedDiv\"\n    class=\"login center-block\"\n  >\n    <p>{{ 'igo.auth.welcome' | translate: user }}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">\n      {{ 'igo.auth.signOut' | translate }}\n    </button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{ 'igo.auth.deconnection' | translate }}</p>\n    <button\n      *ngIf=\"options.homeRoute\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"home()\"\n    >\n      {{ 'igo.auth.home' | translate }}\n    </button>\n  </div>\n</div>\n","import { NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Optional,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { NavigationStart, Router } from '@angular/router';\n\nimport { AuthOptions, AuthService } from '@igo2/auth';\nimport { AuthFacebookComponent } from '@igo2/auth/facebook';\nimport { AuthGoogleComponent } from '@igo2/auth/google';\nimport { AuthInternComponent } from '@igo2/auth/internal';\nimport {\n  AuthMicrosoftComponent,\n  AuthMicrosoftb2cComponent\n} from '@igo2/auth/microsoft';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { filter } from 'rxjs/operators';\n\nimport { AuthFormOptions } from '../shared';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default,\n  standalone: true,\n  imports: [\n    NgIf,\n    AuthGoogleComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    AuthFacebookComponent,\n    AuthInternComponent,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options?: AuthOptions & AuthFormOptions;\n  public user;\n\n  public visible = true;\n\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth');\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options?.logoutRoute) {\n          this.router.navigate([this.options?.logoutRoute]);\n        } else if (this.options?.homeRoute) {\n          this.router.navigate([this.options?.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options?.homeRoute) {\n      this.router.navigate([this.options?.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options?.logoutRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Routes } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form/auth-form.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'form', pathMatch: 'full' },\n  {\n    title: 'Authentification',\n    path: 'form',\n    component: AppAuthFormComponent\n  }\n];\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { AuthService } from '@igo2/auth';\nimport { AuthFormComponent } from '@igo2/auth/form';\n\nimport { Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    AuthFormComponent,\n    MatButtonModule\n  ]\n})\nexport class AppAuthFormComponent implements OnInit, OnDestroy {\n  public logged: boolean = false;\n  public logged$$: Subscription;\n  constructor(private _authService: AuthService) {}\n\n  ngOnInit() {\n    this.logged$$ = this._authService.logged$.subscribe((logged: boolean) => {\n      this.logged = logged;\n    });\n  }\n\n  logout() {\n    this._authService.logout();\n  }\n\n  ngOnDestroy() {\n    this.logged$$.unsubscribe();\n  }\n}\n","<app-doc-viewer\n  title=\"Authentification\"\n  subtitle=\"Auth\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"auth/auth-form\" configFolder=\"environments\">\n    The dialog opens automatically if you are not logged in\n    <br />\n    <button\n      mat-raised-button\n      color=\"primary\"\n      [disabled]=\"!logged\"\n      (click)=\"logout()\"\n    >\n      Log out\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n<igo-auth-form></igo-auth-form>\n","import { Overlay } from '@angular/cdk/overlay';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport {\n  ActionStore,\n  ActionbarComponent,\n  ActionbarMode\n} from '@igo2/common/action';\nimport { Media, MediaOrientation, MediaService } from '@igo2/core/media';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, ActionbarComponent]\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store: ActionStore = new ActionStore([]);\n\n  private added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media: Media = this.mediaService.media$.value;\n    const orientation: MediaOrientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnInit(): void {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'add',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'edit',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Action\" subtitle=\"Common\">\n  <app-example-viewer title=\"Action Bar\" codeFolder=\"common/action\">\n    <igo-actionbar\n      [store]=\"store\"\n      [withIcon]=\"true\"\n      [withTitle]=\"actionbarMode === 'overlay'\"\n      [horizontal]=\"true\"\n      [mode]=\"actionbarMode\"\n    >\n    </igo-actionbar>\n  </app-example-viewer>\n\n  <!-- <app-example-viewer title=\"Action context-menu\" codeFolder=\"common/action\">\n    <mat-card [igoContextMenu]=\"actionbarMenu\">\n      <mat-card-header>\n        <mat-card-subtitle>Common</mat-card-subtitle>\n        <mat-card-title>Action context-menu</mat-card-title>\n      </mat-card-header>\n      <div></div>\n    </mat-card>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"true\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer> -->\n</app-doc-viewer>\n","<h1 mat-dialog-title class=\"mat-typography\">{{ title }}</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <ng-container\n    *ngTemplateOutlet=\"loopObject; context: { obj: data }\"\n  ></ng-container>\n\n  <ng-template #loopObject let-obj=\"obj\" let-baseKey=\"baseKey\">\n    <ng-container *ngFor=\"let property of obj | keyvalue\">\n      <ng-container\n        *ngIf=\"ignoreKeys.indexOf(getKey(baseKey, property.key)) === -1\"\n      >\n        <ng-container *ngIf=\"isObject(property.value); else notObject\">\n          <ng-container\n            *ngTemplateOutlet=\"\n              loopObject;\n              context: {\n                obj: property.value,\n                baseKey: getKey(baseKey, property.key)\n              }\n            \"\n          ></ng-container>\n        </ng-container>\n\n        <ng-template #notObject>\n          <p>\n            <span\n              ><b>{{ getKey(baseKey, property.key) }}</b> : </span\n            ><span class=\"propertyValue\" [innerHtml]=\"property.value\"></span>\n          </p>\n        </ng-template>\n      </ng-container>\n    </ng-container>\n  </ng-template>\n</div>\n\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(false)\">\n    OK\n  </button>\n</div>\n","import { KeyValuePipe, NgFor, NgIf, NgTemplateOutlet } from '@angular/common';\nimport { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport {\n  MatDialogActions,\n  MatDialogContent,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-json-dialog',\n  templateUrl: './json-dialog.component.html',\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    MatDialogContent,\n    NgTemplateOutlet,\n    NgFor,\n    NgIf,\n    MatDialogActions,\n    MatButtonModule,\n    KeyValuePipe\n  ]\n})\nexport class JsonDialogComponent {\n  public title: string;\n  public data: any;\n  public ignoreKeys: string[];\n\n  constructor(public dialogRef: MatDialogRef<JsonDialogComponent>) {}\n\n  isObject(val) {\n    return typeof val === 'object' && !Array.isArray(val);\n  }\n\n  getKey(baseKey, key) {\n    return (baseKey ? baseKey + '.' : '') + key;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { JsonDialogComponent } from './json-dialog.component';\n\n@Injectable()\nexport class JsonDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(title: any, data, ignoreKeys?: string[]): Observable<any> {\n    const dialogRef = this.dialog.open(JsonDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.data = data;\n    dialogRef.componentInstance.title = title;\n    dialogRef.componentInstance.ignoreKeys = ignoreKeys ?? [];\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { JsonDialogComponent } from './json-dialog.component';\nimport { JsonDialogService } from './json-dialog.service';\n\n@NgModule({\n  imports: [JsonDialogComponent],\n  exports: [JsonDialogComponent],\n  providers: [JsonDialogService]\n})\nexport class IgoJsonDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoJsonDialogModule> {\n    return {\n      ngModule: IgoJsonDialogModule\n    };\n  }\n}\n","export enum SelectValueDialogType {\n  Radio = 'radio',\n  Checkbox = 'checkbox'\n}\n","<h1 mat-dialog-title>{{ data.title | translate }}</h1>\n\n<form class=\"igo-form\" [formGroup]=\"formGroup\">\n  <section class=\"choices-section\">\n    <ng-template\n      *ngIf=\"data.type === 'checkbox'\"\n      ngFor\n      let-choice\n      let-i=\"index\"\n      [ngForOf]=\"data.choices\"\n    >\n      <mat-checkbox formControlName=\"{{ choice.value }}\">{{\n        choice.title || choice.value\n      }}</mat-checkbox>\n    </ng-template>\n\n    <mat-radio-group *ngIf=\"data.type === 'radio'\" (change)=\"onChange($event)\">\n      <mat-radio-button\n        *ngFor=\"let choice of data.choices\"\n        [value]=\"choice.value\"\n      >\n        {{ choice.title || choice.value }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </section>\n  <div mat-dialog-actions>\n    <div class=\"button-group\">\n      <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n        {{ data.cancelButtonText | translate }}\n      </button>\n      <button\n        [disabled]=\"isDisabled$ | async\"\n        id=\"processBtnDialog\"\n        mat-raised-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"save()\"\n      >\n        {{ data.processButtonText | translate }}\n      </button>\n    </div>\n  </div>\n</form>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component, Inject, OnInit, Optional } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport {\n  MAT_DIALOG_DATA,\n  MatDialogActions,\n  MatDialogRef,\n  MatDialogTitle\n} from '@angular/material/dialog';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { SelectValueDialogType } from './select-value-dialog.enums';\nimport { SelectValueData } from './select-value-dialog.interface';\n\n@Component({\n  selector: 'igo-select-value-check-radio-dialog',\n  templateUrl: './select-value-check-radio-dialog.component.html',\n  styleUrls: ['./select-value-check-radio-dialog.component.scss'],\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    FormsModule,\n    ReactiveFormsModule,\n    NgIf,\n    NgFor,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogActions,\n    MatButtonModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class SelectValueCheckRadioDialogComponent implements OnInit {\n  public formGroup: UntypedFormGroup;\n  public isDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SelectValueCheckRadioDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: SelectValueData\n  ) {\n    this.formGroup = this.formBuilder.group(this.getFg());\n    this.data.selectFieldText =\n      this.data.selectFieldText ??\n      'igo.common.selectValueDialog.selectFieldText';\n    this.data.processButtonText =\n      this.data.processButtonText ??\n      'igo.common.selectValueDialog.processButtonText';\n    this.data.cancelButtonText =\n      this.data.cancelButtonText ??\n      'igo.common.selectValueDialog.cancelButtonText';\n    this.data.title =\n      this.data.title ?? 'igo.common.selectValueDialog.multipleTitle';\n    if (this.data.type === SelectValueDialogType.Radio) {\n      this.data.title = 'igo.common.selectValueDialog.title';\n    }\n  }\n\n  ngOnInit() {\n    this.formGroup.valueChanges.subscribe(() => this.canProcess());\n  }\n\n  getFg() {\n    const a = {};\n    this.data.choices.map((l) => (a[l.value] = false));\n    return a;\n  }\n\n  canProcess() {\n    const choices = this.data.choices.map((l) => l.value);\n    const selectedIds = [];\n    choices.map((l) =>\n      this.formGroup.value[l] ? selectedIds.push(l) : undefined\n    );\n    selectedIds.length\n      ? this.isDisabled$.next(false)\n      : this.isDisabled$.next(true);\n  }\n\n  save() {\n    const choices = this.data.choices.map((l) => l.value);\n\n    const selectedChoices = [];\n    choices.map((l) =>\n      this.formGroup.value[l] ? selectedChoices.push(l) : undefined\n    );\n    this.dialogRef.close({ choices: selectedChoices });\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n\n  onChange(e: MatRadioChange) {\n    const choices = {};\n    this.data.choices.map((l) => (choices[l.value] = false));\n    choices[e.value] = true;\n    this.formGroup.setValue(choices);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { SelectValueCheckRadioDialogComponent } from './select-value-check-radio-dialog.component';\nimport {\n  Choice,\n  SelectValueData,\n  SelectValueDialogOptions\n} from './select-value-dialog.interface';\n\n@Injectable()\nexport class SelectValueDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(\n    choices: Choice[],\n    options?: SelectValueDialogOptions\n  ): Observable<any> {\n    const data: SelectValueData = {\n      choices,\n      ...options\n    };\n\n    const dialogRef = this.dialog.open(SelectValueCheckRadioDialogComponent, {\n      disableClose: false,\n      data,\n      ...options\n    });\n    return dialogRef.afterClosed();\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { SelectValueCheckRadioDialogComponent } from './select-value-check-radio-dialog.component';\nimport { SelectValueDialogService } from './select-value-dialog.service';\n\n@NgModule({\n  imports: [SelectValueCheckRadioDialogComponent],\n  exports: [SelectValueCheckRadioDialogComponent],\n  providers: [SelectValueDialogService]\n})\nexport class IgoSelectValueDialogModule {\n  /**\n   * @deprecated it has no effect\n   */\n  static forRoot(): ModuleWithProviders<IgoSelectValueDialogModule> {\n    return {\n      ngModule: IgoSelectValueDialogModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport {\n  ConfirmDialogService,\n  IgoConfirmDialogModule\n} from '@igo2/common/confirm-dialog';\nimport {\n  FormDialogService,\n  FormFieldConfig,\n  FormGroupsConfig,\n  IgoFormDialogModule\n} from '@igo2/common/form';\nimport {\n  IgoJsonDialogModule,\n  JsonDialogService\n} from '@igo2/common/json-dialog';\nimport {\n  Choice,\n  IgoSelectValueDialogModule,\n  SelectValueDialogService,\n  SelectValueDialogType\n} from '@igo2/common/select-value-dialog';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-dialog',\n  templateUrl: './dialog.component.html',\n  styleUrls: ['./dialog.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    IgoConfirmDialogModule,\n    IgoSelectValueDialogModule,\n    IgoFormDialogModule,\n    IgoJsonDialogModule,\n    MatButtonModule,\n    MatDividerModule\n  ]\n})\nexport class AppDialogComponent {\n  constructor(\n    private confirmDialogService: ConfirmDialogService,\n    private selectValueDialogService: SelectValueDialogService,\n    private jsonDialogService: JsonDialogService,\n    private formDialogService: FormDialogService\n  ) {}\n\n  confirm(): void {\n    this.confirmDialogService\n      .open('Do you want to continue?')\n      .subscribe((r) => {\n        alert(`Your choice is: ${r}`);\n      });\n  }\n  yesno(): void {\n    this.confirmDialogService\n      .open('Is the sky blue today? ', { modeYesNo: true })\n      .subscribe((r) => {\n        alert(`Your choice is: ${r}`);\n      });\n  }\n\n  private select(type: SelectValueDialogType): void {\n    const choices: Choice[] = [\n      { value: '1', title: 'Chocolate' },\n      { value: '2', title: 'Candy' },\n      { value: 3, title: 'Cake' }\n    ];\n\n    this.selectValueDialogService.open(choices, { type }).subscribe((r) => {\n      if (r?.choices) {\n        if (r.choices.length > 1) {\n          alert(`Your choice(s) are: ${r.choices}`);\n        } else {\n          alert(`Your choice is: ${r.choices}`);\n        }\n      }\n    });\n  }\n\n  check(): void {\n    this.select(SelectValueDialogType.Checkbox);\n  }\n  radio(): void {\n    this.select(SelectValueDialogType.Radio);\n  }\n\n  json(): void {\n    this.jsonDialogService.open(\n      'A JSON viewer',\n      {\n        isbn: '123-456-222',\n        author: {\n          lastname: 'Doe',\n          firstname: 'Jane'\n        },\n        editor: {\n          lastname: 'Smith',\n          firstname: 'Jane'\n        },\n        title: 'The Ultimate Database Study Guide',\n        category: ['Non-Fiction', 'Technology']\n      },\n      ['category']\n    );\n  }\n  form(): void {\n    const formFieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'country',\n        title: 'Country',\n        options: {\n          cols: 1\n        }\n      }\n    ];\n\n    const formFieldConfigs1: FormFieldConfig[] = [\n      {\n        name: 'city',\n        title: 'City',\n        options: {\n          cols: 1\n        }\n      }\n    ];\n    const formFieldConfigs2: FormFieldConfig[] = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            { value: 1, title: 'Single' },\n            { value: 2, title: 'Married' }\n          ]\n        }\n      }\n    ];\n\n    const formGroupsConfigs: FormGroupsConfig[] = [\n      { name: 'country', formFieldConfigs: formFieldConfigs1 },\n      { name: 'city', formFieldConfigs: formFieldConfigs2 }\n    ];\n\n    this.formDialogService\n      .open({ formFieldConfigs, formGroupsConfigs }, { minWidth: '50vh' })\n      .subscribe((data: any) => {\n        if (data) {\n          alert(JSON.stringify(data));\n        }\n      });\n  }\n\n  email(): void {\n    const formFieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'email',\n        title: 'Email',\n        options: {\n          cols: 2,\n          validator: Validators.compose([Validators.required, Validators.email])\n        }\n      },\n      {\n        name: 'password',\n        title: 'Password',\n        options: {\n          cols: 2,\n          validator: Validators.required\n        },\n        inputs: {\n          isPassword: true\n        }\n      }\n    ];\n\n    this.formDialogService.open({ formFieldConfigs }).subscribe((data: any) => {\n      if (data) {\n        data.password = '°°°°°°°°°°';\n        alert(JSON.stringify(data));\n      }\n    });\n  }\n}\n","<app-doc-viewer title=\"Various dialogs\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dialog\">\n    <section>\n      <div class=\"example-label\">Confirmation</div>\n      <div class=\"example-button-row\">\n        <button\n          mat-flat-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"confirm()\"\n        >\n          Base dialog\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"yesno()\">\n          Yes/no confirm dialog\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n\n    <section>\n      <div class=\"example-label\">Custom selectors</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"check()\">\n          Open a dialog to select values by checkboxes\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"radio()\">\n          Open a dialog to select values by radio buttons\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n    <section>\n      <div class=\"example-label\">Form based</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"form()\">\n          Basic form\n        </button>\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"email()\">\n          Email\n        </button>\n      </div>\n    </section>\n    <mat-divider></mat-divider>\n    <section>\n      <div class=\"example-label\">Renderer</div>\n      <div class=\"example-button-row\">\n        <button mat-flat-button type=\"button\" color=\"primary\" (click)=\"json()\">\n          Open a dialog to open a json\n        </button>\n      </div>\n    </section>\n  </app-example-viewer>\n</app-doc-viewer>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  DynamicOutletComponent,\n  OnUpdateInputs\n} from '@igo2/common/dynamic-component';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template:\n    '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    DynamicOutletComponent,\n    MatButtonModule\n  ]\n})\nexport class AppDynamicComponentComponent {\n  component: any = AppSalutationComponent;\n\n  inputs = { name: 'Bob' };\n\n  toggleComponent() {\n    this.component =\n      this.component === AppSalutationComponent\n        ? AppExplanationComponent\n        : AppSalutationComponent;\n  }\n}\n","<app-doc-viewer title=\"Dynamic Component\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dynamic-component\">\n    <igo-dynamic-outlet [component]=\"component\" [inputs]=\"inputs\">\n    </igo-dynamic-outlet>\n\n    <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">\n      Toggle Component\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Entity Selector\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-selector\">\n    <igo-entity-selector\n      [store]=\"store\"\n      [titleAccessor]=\"getTitle\"\n      [emptyText]=\"''\"\n      [placeholder]=\"'Select an entity'\"\n      (selectedChange)=\"onSelectedChange($event)\"\n    >\n    </igo-entity-selector>\n\n    <div *ngIf=\"entityIsSelected\">\n      <p>ID: {{ (selectedEntity$ | async).id }}</p>\n      <p>Name: {{ (selectedEntity$ | async).name }}</p>\n      <p>Description: <span [innerHtml]=\"(selectedEntity$ | async).description\"></span></p>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport { EntitySelectorComponent, EntityStore } from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    EntitySelectorComponent,\n    NgIf,\n    AsyncPipe\n  ]\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n  public store: EntityStore = new EntityStore([]);\n\n  public selectedEntity$: BehaviorSubject<DemoEntity> =\n    new BehaviorSubject<DemoEntity>(undefined);\n  public entityIsSelected: boolean;\n\n  constructor() {}\n\n  ngOnInit(): void {\n    this.store.load([\n      { id: '2', name: 'Name 2', description: '<b>Description 2</b>' },\n      { id: '1', name: 'Name 1', description: '<b>Description 1</b>' },\n      { id: '3', name: 'Name 3', description: '<b>Description 3</b>' }\n    ] satisfies DemoEntity[]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: { selected: boolean; value: DemoEntity }): void {\n    this.entityIsSelected = event.value.id ? true : false;\n    this.selectedEntity$.next(event.value);\n  }\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\n\nimport {\n  EntityStore,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableComponent,\n  EntityTablePaginatorOptions,\n  EntityTableTemplate,\n  getEntityProperty\n} from '@igo2/common/entity';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, EntityTableComponent]\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store: EntityStore = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = { pageSize: 10 };\n\n  public template: EntityTableTemplate = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radio_button_checked'\n            : 'radio_button_unchecked';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'date',\n        title: 'Date',\n        type: 'date'\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: () => {\n          return [\n            {\n              icon: 'home',\n              color: 'warn',\n              click: (row) => {\n                console.log(row);\n              }\n            }\n          ] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor() {}\n\n  ngOnInit(): void {\n    const ids: number[] = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities: object[] = ids.map((id: number) => {\n      if (id === 3) {\n        return {\n          id,\n          name: `Name ${id}`,\n          description: `<b>Description ${id}</b>`,\n          date: new Date(),\n          url: 'https://igouverte.org',\n          image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'\n        };\n      }\n      return {\n        id,\n        name: `Name ${id}`,\n        description: `<b>Description ${id}</b>`,\n        date: new Date(),\n        url: 'https://igouverte.org',\n        image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'\n      };\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange(): void {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator): void {\n    this.paginator = event;\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Entity Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-table\">\n    <igo-entity-table\n      [store]=\"store\"\n      [withPaginator]=\"true\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [template]=\"template\"\n      (entitySortChange)=\"entitySortChange()\"\n    >\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Form\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/form\">\n    <igo-form\n      *ngIf=\"form$ | async as form\"\n      [form]=\"form\"\n      [formData]=\"data$ | async\"\n      (submitForm)=\"onSubmit($event)\"\n    >\n      <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n      <div formButtons class=\"actions-container\">\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"fillForm()\"\n        >\n          Fill Form\n        </button>\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"clearForm()\"\n        >\n          Clear Form\n        </button>\n        <button\n          mat-flat-button\n          type=\"submit\"\n          color=\"primary\"\n          [disabled]=\"submitDisabled\"\n        >\n          Submit\n        </button>\n      </div>\n    </igo-form>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  Form,\n  FormComponent,\n  FormField,\n  FormFieldConfig,\n  FormGroupComponent,\n  FormService\n} from '@igo2/common/form';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    NgIf,\n    FormComponent,\n    FormGroupComponent,\n    MatButtonModule,\n    AsyncPipe\n  ]\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n  form$: BehaviorSubject<Form> = new BehaviorSubject<Form>(undefined);\n\n  data$: BehaviorSubject<object> = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(private formService: FormService) {}\n\n  ngOnInit() {\n    const fieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            { value: 1, title: 'Single' },\n            { value: 2, title: 'Married' }\n          ]\n        }\n      }\n    ];\n\n    const fields: FormField[] = fieldConfigs.map((config: FormFieldConfig) =>\n      this.formService.field(config)\n    );\n    const form: Form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy(): void {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm(): void {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm(): void {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: object): void {\n    alert(JSON.stringify(data));\n  }\n}\n","import { Component } from '@angular/core';\nimport { FormControl, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoIconComponent } from '@igo2/common/icon';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-icon',\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    IgoIconComponent,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule\n  ],\n  templateUrl: './icon.component.html',\n  styleUrl: './icon.component.scss'\n})\nexport class AppIconComponent {\n  exampleIndexHtml: string = EXAMPLE_INDEX_HTML;\n  exampleStyleVariable: string = EXAMPLE_STYLE_VARIABLE;\n  exampleProvider: string = EXAMPLE_PROVIDER;\n\n  nameControl = new FormControl<string>('shopping_cart_checkout');\n}\n\nconst EXAMPLE_INDEX_HTML = `<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\" />`;\n\nconst EXAMPLE_STYLE_VARIABLE = `.material-symbols-outlined {\n  font-variation-settings:\n  'FILL' 0,\n  'wght' 400,\n  'GRAD' 0,\n  'opsz' 24\n}`;\n\nconst EXAMPLE_PROVIDER = `import { provideIcon } from '@igo2/common/icon';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideIcon(),\n  ]\n})\n`;\n","<app-doc-viewer title=\"Icon\" subtitle=\"Common\">\n  <section>\n    <p>\n      The <code>icon</code> is a core concept for many packages of the IGO2\n      library. The icon system is base on\n      <a href=\"https://fonts.google.com/icons\" target=\"_blank\"\n        >Google Font - Material Symbol</a\n      >\n      who use font ligature to configure the icon\n    </p>\n  </section>\n\n  <section>\n    <h3>Getting started</h3>\n    <ol>\n      <li>\n        In your\n        <code>index.html</code>\n        file, add the variable font stylesheet request to your head tag and\n        <pre><code>{{exampleIndexHtml}}</code></pre>\n      </li>\n      <li>\n        Then add the current class with variable axes configuration to icons in\n        your <code>style.scss</code> file.\n        <pre><code>{{exampleStyleVariable}}</code></pre>\n      </li>\n      <li>\n        Finally, add the icon provider configuration in your main file\n        <code>main.ts</code>\n        <pre><code>{{exampleProvider}}</code></pre>\n      </li>\n    </ol>\n  </section>\n\n  <app-example-viewer title=\"Icon\" codeFolder=\"common/icon\">\n    <p>\n      Enter a name from the\n      <a href=\"https://fonts.google.com/icons\" target=\"_blank\"\n        >Google Font - Material Symbol</a\n      >\n    </p>\n    <div class=\"field-container\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>Icon Name</mat-label>\n        <input matInput type=\"text\" [formControl]=\"nameControl\" />\n      </mat-form-field>\n      <igo-icon icon=\"equal\" class=\"m-h-12\"></igo-icon>\n      <igo-icon [icon]=\"nameControl.value\"></igo-icon>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { BehaviorSubject, Observable, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { TableDatabase } from './table-database';\nimport { TableModel } from './table-model.interface';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map((data) => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter((c) => c.filterable)\n        .map((c) => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","<div class=\"table-box\">\n  <div class=\"table-header\" *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder=\"never\">\n      <input\n        matInput\n        #filter\n        [placeholder]=\"'igo.common.table.filter' | translate\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div class=\"table-container\">\n    <table mat-table #table [dataSource]=\"dataSource\" matSort>\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox\n            (change)=\"$event ? masterToggle() : null\"\n            [checked]=\"selection.hasValue() && isAllSelected()\"\n            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\n          >\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"$event ? selection.toggle(row) : null\"\n            [checked]=\"selection.isSelected(row)\"\n          >\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container\n        [matColumnDef]=\"column.name\"\n        *ngFor=\"let column of model.columns\"\n      >\n        <ng-container *ngIf=\"column.sortable\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>\n            {{ column.title }}\n          </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.sortable\">\n          <th mat-header-cell *matHeaderCellDef>{{ column.title }}</th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n          >\n            {{ getValue(row, column.name) }}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n            [innerHTML]=\"getValue(row, column.name)\"\n          ></td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef=\"action\">\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef=\"let row\">\n          <button\n            *ngFor=\"let action of model.actions\"\n            mat-mini-fab\n            [color]=\"getActionColor(action.color)\"\n            (click)=\"handleClickAction($event, action, row)\"\n          >\n            <mat-icon>{{ action.icon }}</mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n      <tr\n        mat-row\n        *matRowDef=\"let row; columns: displayedColumns\"\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\"\n      ></tr>\n    </table>\n  </div>\n</div>\n","import { SelectionModel } from '@angular/cdk/collections';\nimport { NgClass, NgFor, NgIf } from '@angular/common';\nimport {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSort, MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { fromEvent } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\n\nimport { TableActionColor } from './table-action-color.enum';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableModel } from './table-model.interface';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatTableModule,\n    MatSortModule,\n    MatCheckboxModule,\n    NgFor,\n    NgClass,\n    MatButtonModule,\n    MatIconModule,\n    IgoLanguageModule\n  ]\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter((c) => c.displayed !== false)\n        .map((c) => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe((e) => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(debounceTime(150), distinctUntilChanged())\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach((row) => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport {\n  TableActionColor,\n  TableComponent,\n  TableDatabase,\n  TableModel\n} from '@igo2/common/table';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, TableComponent]\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model: TableModel = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'description',\n        color: TableActionColor.primary,\n        click: (row) => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor() {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name: string): void {\n    alert(name);\n  }\n\n  handleSelect(rows: any): void {\n    console.log(rows);\n  }\n}\n","<app-doc-viewer title=\"Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/table\">\n    <igo-table\n      [database]=\"database\"\n      [model]=\"model\"\n      [hasFilterInput]=\"true\"\n      (select)=\"handleSelect($event)\"\n    >\n    </igo-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Tool\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/tool\">\n    <igo-panel [title]=\"panelTitle\">\n      <button\n        mat-icon-button\n        panelLeftButton\n        (click)=\"toolbox.activatePreviousTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon>arrow_back</mat-icon>\n      </button>\n\n      <button\n        mat-icon-button\n        panelRightButton\n        (click)=\"toolbox.deactivateTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon>menu</mat-icon>\n      </button>\n\n      <igo-toolbox\n        [toolbox]=\"toolbox\"\n        [animate]=\"true\"\n        color=\"primary\"\n      ></igo-toolbox>\n    </igo-panel>\n\n    <button\n      mat-flat-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"activateSalutationTool()\"\n    >\n      Activate Salutation Tool\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { OnUpdateInputs } from '@igo2/common/dynamic-component';\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  Tool,\n  ToolComponent,\n  ToolService,\n  Toolbox,\n  ToolboxComponent\n} from '@igo2/common/tool';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'person',\n  options: { name: 'Jack' }\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: ` <p>Hello, my name is {{ name }}.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: ` <p>I'm a tool inside a toolbox.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    PanelComponent,\n    NgIf,\n    MatButtonModule,\n    MatIconModule,\n    ToolboxComponent,\n    AsyncPipe\n  ]\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n  toolbox: Toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(private toolService: ToolService) {}\n\n  ngOnInit(): void {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy(): void {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool(): void {\n    this.toolbox.activateTool('demo-salutation', { name: 'Bob' });\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  DynamicComponent,\n  OnUpdateInputs\n} from '@igo2/common/dynamic-component';\nimport {\n  IgoWidgetOutletModule,\n  WidgetComponent,\n  WidgetService\n} from '@igo2/common/widget';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{ name }}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">\n      Nice to meet you\n    </button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatButtonModule]\n})\nexport class AppSalutationWidgetComponent\n  implements OnUpdateInputs, WidgetComponent\n{\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, IgoWidgetOutletModule]\n})\nexport class AppWidgetComponent {\n  widget: DynamicComponent<WidgetComponent>;\n\n  inputs = { name: 'Bob' };\n\n  constructor(private widgetService: WidgetService) {\n    this.widget = this.widgetService.create(AppSalutationWidgetComponent);\n  }\n\n  onWidgetComplete(name: string): void {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel(): void {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n}\n","import { Routes } from '@angular/router';\n\nimport { AppActionComponent } from './action/action.component';\nimport { AppDialogComponent } from './dialog/dialog.component';\nimport { AppDynamicComponentComponent } from './dynamic-component/dynamic-component.component';\nimport { AppEntitySelectorComponent } from './entity-selector/entity-selector.component';\nimport { AppEntityTableComponent } from './entity-table/entity-table.component';\nimport { AppFormComponent } from './form/form.component';\nimport { AppIconComponent } from './icon/icon.component';\nimport { AppTableComponent } from './table/table.component';\nimport { AppToolComponent } from './tool/tool.component';\nimport { AppWidgetComponent } from './widget/widget.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'action', pathMatch: 'full' },\n  {\n    title: 'Action',\n    path: 'action',\n    component: AppActionComponent\n  },\n  {\n    title: 'Dialogs',\n    path: 'dialog',\n    component: AppDialogComponent\n  },\n  {\n    title: 'Dynamic Component',\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  },\n  {\n    title: 'Entity Table',\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  },\n  {\n    title: 'Entity Selector',\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  },\n  {\n    title: 'Form',\n    path: 'form',\n    component: AppFormComponent\n  },\n  {\n    title: 'Icon',\n    path: 'icon',\n    component: AppIconComponent\n  },\n  {\n    title: 'Table',\n    path: 'table',\n    component: AppTableComponent\n  },\n  {\n    title: 'Tool',\n    path: 'tool',\n    component: AppToolComponent\n  },\n  {\n    title: 'Widget',\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n","<app-doc-viewer title=\"Widget\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/widget\">\n    <igo-widget-outlet\n      [widget]=\"widget\"\n      [inputs]=\"inputs\"\n      (complete)=\"onWidgetComplete($event)\"\n      (cancel)=\"onWidgetCancel()\"\n    >\n    </igo-widget-outlet>\n  </app-example-viewer>\n</app-doc-viewer>\n","<h6 class=\"mat-subtitle-2 m-b-0\">{{ subtitle }}</h6>\n<h2>{{ title }}</h2>\n\n<div class=\"mat-body-1\">\n  <ng-container *ngIf=\"dependencies?.length\">\n    <label for=\"\">Dependencies:</label>\n    <ul>\n      <li *ngFor=\"let dep of dependencies\">{{ dep }}</li>\n    </ul>\n  </ng-container>\n  <ng-content></ng-content>\n</div>\n<!-- <mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>{{subtitle}}</mat-card-subtitle>\n    <mat-card-title>{{title}}</mat-card-title>\n  </mat-card-header>\n  <mat-card-content>\n    <ng-container *ngIf=\"dependencies?.length\">\n        <label for=\"\">Dependencies:</label>\n        <ul>\n            <li *ngFor=\"let dep of dependencies\">{{dep}}</li>\n        </ul>\n        <br />\n    </ng-container>\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card> -->\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'app-doc-viewer',\n  templateUrl: './doc-viewer.component.html',\n  styleUrls: ['./doc-viewer.component.scss'],\n  standalone: true,\n  imports: [NgIf, NgFor]\n})\nexport class DocViewerComponent {\n  @Input() title: string;\n  @Input() subtitle: string;\n  @Input() dependencies: string[];\n}\n","<mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>\n      {{ title }}\n    </mat-card-subtitle>\n    <div class=\"actions\">\n      <a\n        *ngIf=\"codeFolder\"\n        mat-icon-button\n        [href]=\"codeUrl\"\n        target=\"_blank\"\n        matTooltip=\"View code example\"\n      >\n        <mat-icon>code-tags</mat-icon>\n      </a>\n      <a\n        *ngIf=\"configFolder\"\n        mat-icon-button\n        [href]=\"configUrl\"\n        target=\"_blank\"\n        matTooltip=\"View config example\"\n      >\n        <mat-icon>settings</mat-icon>\n      </a>\n    </div>\n  </mat-card-header>\n\n  <mat-divider class=\"m-b-16\"></mat-divider>\n\n  <mat-card-content class=\"mat-body-1\">\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card>\n","import { NgIf } from '@angular/common';\nimport { Component, Input } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nconst SRC_PATH =\n  'https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src';\n\n@Component({\n  selector: 'app-example-viewer',\n  templateUrl: './example-viewer.component.html',\n  styleUrls: ['./example-viewer.component.scss'],\n  standalone: true,\n  imports: [\n    MatCardModule,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatDividerModule\n  ]\n})\nexport class ExampleViewerComponent {\n  @Input() title: string;\n  @Input() codeFolder: string;\n  @Input() configFolder: string;\n\n  get codeUrl() {\n    return `${SRC_PATH}/app/${this.codeFolder}`;\n  }\n\n  get configUrl() {\n    return `${SRC_PATH}/${this.configFolder}`;\n  }\n}\n","<app-doc-viewer\n  title=\"Context\"\n  subtitle=\"Context\"\n  [dependencies]=\"['HttpClientModule']\"\n>\n  <app-example-viewer codeFolder=\"context/context\" configFolder=\"contexts\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          igoMapContext\n          igoLayerContext\n          [map]=\"map\"\n          [view]=\"view\"\n        >\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100\">\n          <igo-panel title=\"Contexts list\" class=\"h-100 w-100\">\n            <igo-context-list\n              igoContextListBinding\n              [map]=\"map\"\n            ></igo-context-list>\n          </igo-panel>\n\n          <igo-panel title=\"Layers\" class=\"h-100 w-100\">\n            <igo-layer-list igoLayerListBinding [map]=\"map\">\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n\n  <app-example-viewer\n    title=\"Import/Export context\"\n    codeFolder=\"context/context\"\n    configFolder=\"contexts\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppContextComponent } from './context/context.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'context', pathMatch: 'full' },\n  {\n    title: 'Context',\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  CONTEXT_MANAGER_DIRECTIVES,\n  ContextImportExportComponent,\n  ContextService\n} from '@igo2/context';\nimport {\n  IgoMap,\n  LAYER_DIRECTIVES,\n  MAP_DIRECTIVES,\n  METADATA_DIRECTIVES,\n  MapService,\n  MapViewOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    CONTEXT_MANAGER_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES,\n    METADATA_DIRECTIVES,\n    ContextImportExportComponent\n  ]\n})\nexport class AppContextComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private mapService: MapService,\n    private contextService: ContextService\n  ) {\n    this.mapService.setMap(this.map);\n    this.contextService.loadDefaultContext();\n    this.contextService.loadContexts();\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { SpinnerComponent } from '@igo2/common/spinner';\nimport { ActivityService } from '@igo2/core/activity';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    SpinnerComponent,\n    MatButtonModule\n  ]\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter(): number {\n    return this.activityService.counter$.value;\n  }\n}\n","<app-doc-viewer title=\"Activity\" subtitle=\"Core\">\n  <p>Register activities in service. Use to display a loading icon</p>\n\n  <li>\n    Import <code>IgoActivityModule</code> only if you want register HTTP calls\n  </li>\n  <li>Import <code>IgoActivityModule</code> only once</li>\n\n  <app-example-viewer codeFolder=\"core/activity\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"register()\">Register</button>\n      <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n    </div>\n\n    <div class=\"mat-body-1 sub-content\">\n      <p>Counter: {{ counter }}</p>\n\n      <igo-spinner igoSpinnerActivity></igo-spinner>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { JsonPipe } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageOptions } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, JsonPipe]\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<app-doc-viewer title=\"Config\" subtitle=\"Core\">\n  <p>Load config in your angular application</p>\n\n  <li>Import <code>IgoConfigModule</code> only once</li>\n\n  <app-example-viewer\n    title=\"Simple config\"\n    codeFolder=\"core/config\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">Config language: {{ configLanguage | json }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule, LanguageService } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatButtonModule,\n    IgoLanguageModule\n  ]\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<app-doc-viewer title=\"Language\" subtitle=\"Core\">\n  <p>Translate your angular application</p>\n\n  <li>Import <code>IgoLanguageModule</code> only once</li>\n  <li>\n    Configure the\n    <a\n      href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale\"\n      >locale files</a\n    >\n  </li>\n\n  <app-example-viewer codeFolder=\"core/language\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n      <button mat-raised-button (click)=\"changeLanguage('fr')\">Français</button>\n    </div>\n\n    <div class=\"m-t-12\">\n      {{ 'welcome' | translate: app }}\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport { Media, MediaOrientation, MediaService } from '@igo2/core/media';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent]\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation(): MediaOrientation {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n}\n","<app-doc-viewer title=\"Media\" subtitle=\"Core\">\n  <p>Detect type of media (mobile, tablet, desktop)</p>\n\n  <app-example-viewer codeFolder=\"core/media\">\n    <p>Current media: {{ media }}</p>\n    <p>Current orientation: {{ orientation }}</p>\n    <p>\n      Device mode:\n      {{ isTouchScreen ? 'Touch device' : 'Not a touch device ' }}\n    </p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MatButtonModule]\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success(): void {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info(): void {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert(): void {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error(): void {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<app-doc-viewer title=\"Message\" subtitle=\"Core\">\n  <p>Show message to user.</p>\n\n  <li>Import <code>IgoMessageModule</code> only once</li>\n  <li>Dependencies: BrowserAnimationsModule</li>\n\n  <app-example-viewer codeFolder=\"core/message\">\n    <div class=\"d-flex m-t-16 actions-container\">\n      <button mat-raised-button (click)=\"success()\">Success message</button>\n      <button mat-raised-button color=\"primary\" (click)=\"info()\">\n        Info message\n      </button>\n      <button mat-raised-button color=\"accent\" (click)=\"alert()\">\n        Alert message\n      </button>\n      <button mat-raised-button color=\"warn\" (click)=\"error()\">\n        Error message\n      </button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { BaseUser } from '@igo2/core/user';\n\nimport { setUser } from '@sentry/angular-ivy';\n\nimport { SentryMonitoringOptions } from './sentry.interface';\n\nexport const isTracingEnabled = (options: SentryMonitoringOptions): boolean =>\n  options.enableTracing ||\n  !!options.tracesSampleRate ||\n  !!options.tracesSampler;\n\nexport const identifySentryUser = (user: BaseUser | null): void => {\n  setUser(\n    user\n      ? {\n          id: user.id,\n          username: `${user.firstName} ${user.lastName}`,\n          email: user.email\n        }\n      : null\n  );\n};\n","import {\n  BrowserOptions,\n  BrowserTracing,\n  Replay,\n  SentryErrorHandler,\n  createErrorHandler,\n  getCurrentHub,\n  init,\n  instrumentAngularRouting\n} from '@sentry/angular-ivy';\n\nimport { SentryMonitoringOptions } from './sentry.interface';\nimport { isTracingEnabled } from './sentry.utils';\n\nexport const createSentryErrorHandler = (\n  options: SentryMonitoringOptions\n): SentryErrorHandler => {\n  return createErrorHandler({\n    logErrors: options.logErrors,\n    ...(options.errorHandlerOptions ?? {})\n  });\n};\n\nexport const initSentry = (options: SentryMonitoringOptions): void => {\n  const client = getCurrentHub().getClient();\n  if (client) {\n    return;\n  }\n\n  const tracingEnabled = isTracingEnabled(options);\n  const baseConfig: BrowserOptions = {\n    dsn: options.dsn,\n    environment: options.environment,\n    release: options.release,\n    integrations: [\n      tracingEnabled &&\n        new BrowserTracing({\n          routingInstrumentation: instrumentAngularRouting\n        }),\n      options.enableReplay && new Replay()\n    ].filter(Boolean)\n  };\n\n  init(baseConfig);\n};\n","import { InjectionToken, Provider } from '@angular/core';\n\nimport { provideSentryMonitoring } from './sentry/sentry.provider';\nimport { AnyMonitoringOptions, MonitoringOptions } from './shared';\n\nexport const MONITORING_OPTIONS = new InjectionToken<MonitoringOptions | null>(\n  'monitoring.options'\n);\n\nexport function provideMonitoring(\n  options: AnyMonitoringOptions | null\n): Provider[] {\n  if (!options) {\n    return [];\n  }\n\n  const providers: Provider[] = [\n    { provide: MONITORING_OPTIONS, useValue: options }\n  ];\n\n  switch (options.provider) {\n    case 'sentry':\n      providers.push(...provideSentryMonitoring(options));\n      break;\n    default:\n      break;\n  }\n\n  return providers;\n}\n","import {\n  APP_INITIALIZER,\n  ConstructorProvider,\n  ErrorHandler,\n  FactoryProvider\n} from '@angular/core';\nimport { Router } from '@angular/router';\n\nimport { TraceService } from '@sentry/angular-ivy';\n\nimport { createSentryErrorHandler, initSentry } from './sentry';\nimport { SentryMonitoringOptions } from './sentry.interface';\nimport { isTracingEnabled } from './sentry.utils';\n\nexport const provideSentryMonitoring = (\n  options: SentryMonitoringOptions\n): (FactoryProvider | ConstructorProvider)[] => {\n  const isEnabled = options.enabled !== undefined ? options.enabled : true;\n  if (!isEnabled) {\n    return [];\n  }\n\n  initSentry(options);\n\n  const tracingEnabled = isTracingEnabled(options);\n\n  return [\n    {\n      provide: ErrorHandler,\n      useFactory: () => createSentryErrorHandler(options)\n    },\n    tracingEnabled && {\n      provide: TraceService,\n      deps: [Router]\n    },\n    // Force instantiate TraceService to avoid require it in any constructor.\n    tracingEnabled && {\n      provide: APP_INITIALIZER,\n      useFactory: () => () => {},\n      deps: [TraceService],\n      multi: true\n    }\n  ].filter(Boolean);\n};\n","import { Inject, Injectable, Injector, Optional } from '@angular/core';\r\n\r\nimport { AuthService, User } from '@igo2/auth';\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS,\r\n  identifySentryUser\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { first, switchMap } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthMonitoringService {\r\n  // The AuthService need to be lazy provided because this service is provided in the APP_INITIALIZER\r\n  authService?: AuthService;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    @Optional()\r\n    @Inject(MONITORING_OPTIONS)\r\n    private monitoringOptions: AnyMonitoringOptions | null,\r\n    private injector: Injector\r\n  ) {\r\n    if (!this.monitoringOptions?.identifyUser) {\r\n      return;\r\n    }\r\n\r\n    this.configService.isLoaded$\r\n      .pipe(\r\n        first((isLoaded) => isLoaded),\r\n        switchMap(() => {\r\n          this.authService = this.injector.get(AuthService);\r\n          return this.authService?.authenticate$;\r\n        })\r\n      )\r\n      .subscribe((isAuthenticated) => {\r\n        const user = isAuthenticated ? this.authService.user : null;\r\n        this._identifyUser(user);\r\n      });\r\n  }\r\n\r\n  private _identifyUser(user: User | null): void {\r\n    switch (this.monitoringOptions.provider) {\r\n      case 'sentry':\r\n        identifySentryUser(user);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n","import { APP_INITIALIZER, Injector, Provider } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core/config';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { AuthMonitoringService } from './auth-monitoring.service';\r\n\r\nexport function provideAuthUserMonitoring(\r\n  options: AnyMonitoringOptions | null\r\n): Provider[] {\r\n  if (!options) {\r\n    return [];\r\n  }\r\n\r\n  return [\r\n    {\r\n      provide: AuthMonitoringService,\r\n      useClass: AuthMonitoringService,\r\n      deps: [ConfigService, MONITORING_OPTIONS, Injector]\r\n    },\r\n    // Force instantiate Tracing service to avoid require it in any constructor.\r\n    {\r\n      provide: APP_INITIALIZER,\r\n      useFactory: () => () => {},\r\n      deps: [AuthMonitoringService],\r\n      multi: true\r\n    }\r\n  ];\r\n}\r\n","import { JsonPipe } from '@angular/common';\r\nimport { Component, Inject } from '@angular/core';\r\nimport { MatButtonModule } from '@angular/material/button';\r\n\r\nimport { provideAuthUserMonitoring } from '@igo2/auth/monitoring';\r\nimport {\r\n  AnyMonitoringOptions,\r\n  MONITORING_OPTIONS,\r\n  provideMonitoring\r\n} from '@igo2/core/monitoring';\r\n\r\nimport { environment } from 'projects/demo/src/environments/environment';\r\n\r\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\r\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\r\n\r\n@Component({\r\n  selector: 'app-monitoring',\r\n  templateUrl: './monitoring.component.html',\r\n  styleUrls: ['./monitoring.component.scss'],\r\n  providers: [\r\n    JsonPipe,\r\n    ...provideMonitoring(environment.igo.monitoring),\r\n    ...provideAuthUserMonitoring(environment.igo.monitoring)\r\n  ],\r\n  standalone: true,\r\n  imports: [DocViewerComponent, ExampleViewerComponent, MatButtonModule]\r\n})\r\nexport class AppMonitoringComponent {\r\n  exampleProviderCode: string = EXAMPLE_PROVIDER;\r\n  constructor(\r\n    @Inject(MONITORING_OPTIONS)\r\n    public options: AnyMonitoringOptions | null,\r\n    private json: JsonPipe\r\n  ) {}\r\n\r\n  throwTestError(): void {\r\n    throw new Error('Sentry Test Error');\r\n  }\r\n\r\n  getBasicConfigExample(): string {\r\n    const codeExample = `{\"igo\": {\"monitoring\": ${JSON.stringify(\r\n      this.options,\r\n      null,\r\n      2\r\n    )}}}`;\r\n    return this.json.transform(JSON.parse(codeExample));\r\n  }\r\n}\r\n\r\nconst EXAMPLE_PROVIDER = `bootstrapApplication(AppComponent, {\r\n  providers: [\r\n    ...provideMonitoring(environment.igo.monitoring),\r\n\r\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \r\n    ...provideAuthUserMonitoring(environment.igo.monitoring)\r\n  ]\r\n})\r\n`;\r\n","<app-doc-viewer title=\"Monitoring\" subtitle=\"Core\">\n  <section>\n    <p>\n      The <code>monitoring</code> package provides a set of configuration for\n      managing application monitoring\n    </p>\n    <ul>\n      <li>Error montioring, report application exception</li>\n      <li>Custom event reporting, like tracking use of code deprecation</li>\n    </ul>\n  </section>\n\n  <section>\n    <h3>Getting started</h3>\n    <p>\n      Start by configure the monitoring options in your\n      <code>environnment.ts</code> file. You can complement this configuration\n      with your provider options. To get the basic options, for Sentry consult\n      the\n      <a\n        href=\"https://docs.sentry.io/platforms/javascript/configuration/options\"\n        target=\"_blank\"\n        >documentation</a\n      >\n    </p>\n    <pre><code>{{getBasicConfigExample()}}</code></pre>\n  </section>\n\n  <section>\n    <h3>Identify user information with the event</h3>\n    <p>\n      If you yant to identify the user with the monitoring event, you need to\n      configure <code>identifyUser</code> to true in the monitoring options.\n      Then import the <code>provideAuthUserMonitoring</code> to your main file.\n    </p>\n  </section>\n\n  <section>\n    <h3>Add Readable Stack Traces to Errors for your application</h3>\n    <p>\n      Follow the instruction\n      <a\n        href=\"https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/\"\n        target=\"_blank\"\n        >Sentry - Source Maps</a\n      >\n    </p>\n  </section>\n\n  <section>\n    <h3>Initialize monitoring</h3>\n    <p>\n      Then import the <code>provideMonitoring</code> providers into your main\n      file\n    </p>\n    <pre><code [innerHTML]=\"exampleProviderCode\"></code></pre>\n  </section>\n\n  <app-example-viewer\n    title=\"Sentry\"\n    codeFolder=\"core/monitoring\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">\n      Trigger a test error somewhere in your Angular app, for example in your\n      main app component. Once triggered, an error event should be sent on your\n      Sentry application\n    </p>\n    <button mat-raised-button color=\"warn\" (click)=\"throwTestError()\">\n      Throw Test Error\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { HttpClient } from '@angular/common/http';\nimport { Component } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { LanguageService } from '@igo2/core/language';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss'],\n  standalone: true,\n  imports: [\n    // IgoErrorModule,\n    // IgoLoggingModule, // Import in your root module or main.ts, only if you want register http calls in console\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatButtonModule\n  ]\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n}\n","<app-doc-viewer title=\"Request\" subtitle=\"Core\">\n  <p>Register http calls in console</p>\n\n  <li>\n    Import <code>IgoLoggingModule</code> only if you want register HTTP calls in\n    console\n  </li>\n  <li>\n    Import <code>IgoErrorModule</code> only if you want register errors from\n    HTTP calls in console\n  </li>\n  <li>Import modules only once</li>\n\n  <app-example-viewer codeFolder=\"core/core\">\n    <div class=\"actions-container\">\n      <button mat-raised-button (click)=\"callHttp()\">Log</button>\n      <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Theme\" subtitle=\"Core\">\n  <p>Change the app theme</p>\n\n  <app-example-viewer codeFolder=\"core/theme\">\n    <div class=\"actions-container\">\n      <mat-form-field>\n        <mat-select\n          (selectionChange)=\"loadTheme($event)\"\n          placeholder=\"Select a theme\"\n        >\n          <mat-option *ngFor=\"let theme of themes\" [value]=\"theme.value\">\n            {{ theme.title }}\n          </mat-option>\n          <mat-option value=\"dark-demo-test\"> Dark theme </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppActivityComponent } from './activity/activity.component';\nimport { AppConfigComponent } from './config/config.component';\nimport { AppLanguageComponent } from './language/language.component';\nimport { AppMediaComponent } from './media/media.component';\nimport { AppMessageComponent } from './message/message.component';\nimport { AppMonitoringComponent } from './monitoring/monitoring.component';\nimport { AppRequestComponent } from './request/request.component';\nimport { AppThemeComponent } from './theme/theme.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'activity', pathMatch: 'full' },\n  {\n    title: 'Activity',\n    path: 'activity',\n    component: AppActivityComponent\n  },\n  {\n    title: 'Config',\n    path: 'config',\n    component: AppConfigComponent\n  },\n  {\n    title: 'Language',\n    path: 'language',\n    component: AppLanguageComponent\n  },\n  {\n    title: 'Media',\n    path: 'media',\n    component: AppMediaComponent\n  },\n  {\n    title: 'Message',\n    path: 'message',\n    component: AppMessageComponent\n  },\n  {\n    title: 'Monitoring',\n    path: 'monitoring',\n    component: AppMonitoringComponent\n  },\n  {\n    title: 'Request',\n    path: 'request',\n    component: AppRequestComponent\n  },\n  {\n    title: 'Themes',\n    path: 'theme',\n    component: AppThemeComponent\n  }\n];\n","import { NgFor } from '@angular/common';\nimport { Component, Renderer2 } from '@angular/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectChange, MatSelectModule } from '@angular/material/select';\n\nimport { LanguageService } from '@igo2/core/language';\nimport { loadTheme } from '@igo2/utils';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-theme',\n  templateUrl: './theme.component.html',\n  styleUrls: ['./theme.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatFormFieldModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule\n  ]\n})\nexport class AppThemeComponent {\n  isDark: boolean;\n  themes = [\n    { value: 'blue', title: 'Blue' },\n    { value: 'bluedark', title: 'Blue-dark' },\n    { value: 'bluedq', title: 'Données Québec' },\n    { value: 'bluegrey', title: 'Blue grey' },\n    { value: 'dark', title: 'Dark' },\n    { value: 'deeppurple', title: 'Purple' },\n    { value: 'indigo', title: 'Indigo' },\n    { value: 'orange', title: 'Orange' },\n    { value: 'teal', title: 'Teal' }\n  ];\n\n  constructor(\n    public languageService: LanguageService,\n    private renderer: Renderer2\n  ) {}\n\n  loadTheme(matSelectChange: MatSelectChange): void {\n    if (matSelectChange.value === 'dark-demo-test') {\n      this.isDark = true;\n      this.renderer.addClass(document.body, 'dark-theme');\n      return;\n    }\n\n    if (this.isDark) {\n      this.renderer.removeClass(document.body, 'dark-theme');\n    }\n\n    loadTheme(window.document, matSelectChange.value + '-theme');\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { EntityRecord, EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  Catalog,\n  CatalogBrowserComponent,\n  CatalogItem,\n  CatalogLibaryComponent,\n  CatalogService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapService,\n  MapViewOptions,\n  TileLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    CatalogLibaryComponent,\n    CatalogBrowserComponent\n  ]\n})\nexport class AppCatalogComponent implements OnInit {\n  catalog: Catalog;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore: EntityStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore: EntityStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n\n    this.mapService.setMap(this.map);\n    this.catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog: Catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n  }\n\n  /**\n   * When the selected catalog changes, toggle the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }): void {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs(): void {\n    this.catalogService.loadCatalogs().subscribe((catalogs: Catalog[]) => {\n      this.catalogStore.clear();\n      this.catalogStore.load(\n        catalogs.concat(\n          (this.storageService.get('addedCatalogs') || []) as Catalog[]\n        )\n      );\n    });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog): void {\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Catalog\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/catalog\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Catalog Library\">\n      <igo-catalog-library\n        [store]=\"$any(catalogStore)\"\n        (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n      >\n      </igo-catalog-library>\n    </igo-panel>\n\n    <igo-panel title=\"Catalog Browser\">\n      <igo-catalog-browser\n        [catalog]=\"catalog\"\n        [store]=\"$any(catalogItemStore)\"\n        [map]=\"map\"\n      >\n      </igo-catalog-browser>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { AuthService } from '@igo2/auth';\nimport {\n  IgoDirectionsModule,\n  IgoMap,\n  IgoSearchModule,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapService,\n  MapViewOptions,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore,\n  TileLayer,\n  TileLayerOptions,\n  provideDirection,\n  withOsrmSource\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    IgoDirectionsModule,\n    IgoSearchModule\n  ],\n  providers: [provideDirection(withOsrmSource())]\n})\nexport class AppDirectionsComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], {\n    map: this.map\n  });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], {\n    map: this.map\n  });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], {\n    map: this.map\n  });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  public authenticated$: BehaviorSubject<boolean>;\n\n  constructor(\n    private layerService: LayerService,\n    private mapService: MapService,\n    private authService: AuthService\n  ) {\n    this.authenticated$ = this.authService.authenticate$;\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: '/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png',\n          crossOrigin: 'anonymous'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Directions\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/directions\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-directions\n            class=\"w-100\"\n            [stopsStore]=\"stopsStore\"\n            [stopsFeatureStore]=\"stopsFeatureStore\"\n            [stepFeatureStore]=\"stepFeatureStore\"\n            [routesFeatureStore]=\"routesFeatureStore\"\n            [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n            [authenticated$]=\"authenticated$\"\n          >\n          </igo-directions>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport {\n  DataSourceService,\n  DrawComponent,\n  FeatureStore,\n  FeatureWithDraw,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapService,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  ZoomButtonComponent\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  standalone: true,\n  imports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    DrawComponent,\n    DocViewerComponent,\n    ExampleViewerComponent\n  ]\n})\nexport class AppDrawComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Draw\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/draw\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component, OnDestroy, OnInit } from '@angular/core';\n\nimport { EntityTableComponent, EntityTableTemplate } from '@igo2/common/entity';\nimport {\n  DataSourceService,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    EntityTableComponent\n  ]\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store: FeatureStore = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    const loadingStrategy: FeatureStoreLoadingStrategy =\n      new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy: FeatureStoreSelectionStrategy =\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.Default\n      });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },\n      {\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [\n            [-72, 47.8],\n            [-73.5, 47.4],\n            [-72.4, 48.6]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [\n            [\n              [-71, 46.8],\n              [-73, 47],\n              [-71.2, 46.6]\n            ]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      } satisfies FeatureDataSourceOptions)\n      .subscribe((dataSource: FeatureDataSource) => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          igoStyle: {\n            mapboxStyle: {\n              url: 'assets/mapboxStyleExample-feature.json',\n              source: 'source_nameX'\n            }\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Feature\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/feature\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-entity-table [store]=\"store\" [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Geometry Form\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/geometry\">\n    <div class=\"container\">\n      <igo-map-browser [map]=\"map\" [view]=\"view\">\n        <div class=\"map-actions --vertical --bottom --right\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n        </div>\n      </igo-map-browser>\n\n      <igo-form\n        *ngIf=\"form$ | async as form\"\n        [form]=\"form\"\n        [formData]=\"data$ | async\"\n        (submitForm)=\"onSubmit($event)\"\n      >\n        <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n        <div formButtons class=\"actions-container\">\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"fillForm()\"\n          >\n            Fill Form\n          </button>\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"clearForm()\"\n          >\n            Clear Form\n          </button>\n          <button\n            mat-flat-button\n            type=\"submit\"\n            color=\"primary\"\n            [disabled]=\"submitDisabled\"\n          >\n            Submit\n          </button>\n        </div>\n      </igo-form>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport {\n  Form,\n  FormComponent,\n  FormField,\n  FormFieldConfig,\n  FormGroupComponent,\n  FormService\n} from '@igo2/common/form';\nimport {\n  DataSourceService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    NgIf,\n    FormComponent,\n    FormGroupComponent,\n    MatButtonModule,\n    AsyncPipe\n  ]\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n  map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$: BehaviorSubject<Form> = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled: boolean = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    const fieldConfigs: FormFieldConfig[] = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options: {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill: new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields: FormField[] = fieldConfigs.map((config: FormFieldConfig) =>\n      this.formService.field(config)\n    );\n    const form: Form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy(): void {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm(): void {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-106, 42],\n            [-107, 31],\n            [-81, 32],\n            [-82, 42],\n            [-106, 42]\n          ]\n        ]\n      })\n    });\n  }\n\n  clearForm(): void {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: { [key: string]: any }): void {\n    alert(JSON.stringify(data));\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\nimport {\n  DataSourceService,\n  IgoMap,\n  IgoMapModule,\n  LayerService,\n  MapViewOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, IgoMapModule]\n})\nexport class AppHoverComponent {\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: 'https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    interface WFSDataOptions extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n      params: {\n        featureTypes: 'MSP_CASERNE_PUBLIC',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'Casernes',\n          visible: true,\n          source: dataSource,\n          igoStyle: {\n            styleByAttribute: {\n              attribute: 'en_caserne',\n              data: ['true', 'false'],\n              stroke: ['red', 'blue'],\n              fill: ['#ffffff', '#ffffff'],\n              radius: [7, 7],\n              width: [2, 2]\n            },\n            hoverStyle: {\n              label: {\n                attribute: 'Caserne: ${no_caserne} \\nMun: ${nom_ssi}',\n                style: {\n                  textAlign: 'left',\n                  textBaseline: 'top',\n                  font: '12px Calibri,sans-serif',\n                  fill: { color: '#000' },\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                  backgroundStroke: {\n                    color: 'rgba(200, 200, 200, 0.75)',\n                    width: 2\n                  },\n                  stroke: { color: '#fff', width: 3 },\n                  overflow: true,\n                  offsetX: 20,\n                  offsetY: 10,\n                  padding: [2.5, 2.5, 2.5, 2.5]\n                }\n              },\n              baseStyle: {\n                circle: {\n                  stroke: {\n                    color: 'orange',\n                    width: 5\n                  },\n                  radius: 15\n                }\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Hover\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/hover\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoHoverFeature\n      [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n      [igoHoverFeatureEnabled]=\"true\"\n    >\n      <div class=\"map-actions --vertical --top --right\">\n        <div class=\"spinner-spacer\"></div>\n        <igo-rotation-button\n          class=\"mat-elevation-z2\"\n          [showIfNoRotation]=\"true\"\n          [map]=\"map\"\n          color=\"primary\"\n        ></igo-rotation-button>\n      </div>\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-home-extent-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-home-extent-button>\n        <igo-geolocate-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-geolocate-button>\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { WorkspaceStore } from '@igo2/common/workspace';\nimport {\n  IMPORT_EXPORT_DIRECTIVES,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  TileLayer\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    IMPORT_EXPORT_DIRECTIVES\n  ]\n})\nexport class AppImportExportComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store: WorkspaceStore = new WorkspaceStore([]);\n\n  constructor(private layerService: LayerService) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Import / Export\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/import-export\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-import-export\n            class=\"w-100\"\n            [store]=\"store\"\n            [map]=\"map\"\n          ></igo-import-export>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer\n  title=\"Layer\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/layer\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-layer-list\n              [map]=\"map\"\n              [layers]=\"map.layers\"\n              [expandLegendOfVisibleLayers]=\"false\"\n              [queryBadge]=\"true\"\n              [excludeBaseLayers]=\"true\"\n            >\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n                <igo-download-button [layer]=\"layer\"></igo-download-button>\n                <igo-ogc-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-ogc-filter-button>\n                <igo-time-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-time-filter-button>\n                <igo-track-feature-button\n                  [layer]=\"layer\"\n                  [trackFeature]=\"true\"\n                ></igo-track-feature-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  DownloadButtonComponent,\n  FILTER_DIRECTIVES,\n  FeatureDataSource,\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LAYER_DIRECTIVES,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  METADATA_DIRECTIVES,\n  MapViewOptions,\n  MetadataLayerOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES,\n    METADATA_DIRECTIVES,\n    DownloadButtonComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppLayerComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: false,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe((dataSource: FeatureDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Parcs routiers',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Lieux habités',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Direction du vent',\n        visible: false,\n        legendOptions: {\n          stylesAvailable: [\n            { name: 'WDIR6-LINEAR', title: 'WDIR6-LINEAR' },\n            { name: 'WDIR6', title: 'WDIR6' },\n            { name: 'WDIR3-LINEAR', title: 'WDIR3-LINEAR' },\n            { name: 'WDIR3', title: 'WDIR3' }\n          ]\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geo.weather.gc.ca/geomet?lang=fr',\n          params: {\n            LAYERS: 'HRDPS.CONTINENTAL_WD',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'District écologique',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routiers',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WMSDataSource) => {\n        const layerOptions: LayerOptionsWithMetadata = {\n          title: 'Embâcles',\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LAYER_DIRECTIVES,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  MetadataLayerOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    LAYER_DIRECTIVES\n  ]\n})\nexport class AppLegendComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with display: false',\n        legendOptions: {\n          display: false\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with html param',\n        legendOptions: {\n          html: '<h2 style=\"background-color: blue;\">HTML legend</h2>'\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_sreg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Legend with url param',\n        legendOptions: {\n          url: `data:image/jpeg;base64,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`\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          params: {\n            LAYERS: 'sh_reg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Commissions scolaires anglophones',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          params: {\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Lieux habités',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routiers',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WMSDataSource) => {\n        const layerOptions: LayerOptionsWithMetadata = {\n          title: 'Embâcles',\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Simple Map with a legend list\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/legend\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Legends\">\n      <igo-layer-legend-list\n        [layers]=\"map.layers\"\n        [excludeBaseLayers]=\"true\"\n        [allowShowAllLegends]=\"true\"\n        [updateLegendOnResolutionChange]=\"false\"\n        [showAllLegendsValue]=\"false\"\n      >\n      </igo-layer-legend-list>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\n\nimport {\n  DataSourceService,\n  FeatureStore,\n  FeatureWithMeasure,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapViewOptions,\n  MeasurerComponent,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  ZoomButtonComponent\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    MeasurerComponent\n  ]\n})\nexport class AppMeasureComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store: FeatureStore = new FeatureStore<FeatureWithMeasure>([], {\n    map: this.map\n  });\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Measure\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/measure\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-measurer [store]=\"$any(store)\" [map]=\"map\"></igo-measurer>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  AnyBaseOgcFilterOptions,\n  DataSourceService,\n  FILTER_DIRECTIVES,\n  IgoMap,\n  ImageLayerOptions,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OgcFilterAttributeOptions,\n  OgcFilterDuringOptions,\n  OgcFilterEqualToOptions,\n  OgcFilterOperatorType,\n  OgcFilterableDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  WMSDataSource,\n  WMSDataSourceOptions\n} from '@igo2/geo';\n\nimport { Circle, Fill, Stroke, Style } from 'ol/style';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppOgcFilterComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    interface WFSOptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalitée' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immédiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            } satisfies OgcFilterEqualToOptions,\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (PropertyIsEqualTo OR Intersects polygon)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilter: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-21T00:00:00-05:00',\n          end: '2016-01-26T00:00:00-05:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTime: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T04:00:00-05:00',\n          end: '2016-01-12T16:00:00-05:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T00:00:00-05:00',\n          end: '2016-03-31T00:00:00-05:00',\n          displayFormat: 'MMMM'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2014-01-01T00:00:00-05:00',\n          end: '2019-12-31T00:00:00-05:00',\n          displayFormat: 'YYYY'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n          end: 'today' // \"now\" can also be used. Instead of midnight, the current time will be used\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2019-01-01 00:00:00',\n          restrictToStep: true\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe((dataSource: WFSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          } satisfies VectorLayerOptions)\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n      optionsFromCapabilities: false,\n      params: {\n        LAYERS: 'vg_observation_v_autre_wmst',\n        VERSION: '1.3.0'\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01 00:00:00',\n          end: '2020-01-01 00:00:00'\n        } satisfies OgcFilterDuringOptions | OgcFilterAttributeOptions,\n        allowedOperatorsType: OgcFilterOperatorType.Time\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe((dataSource: WMSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondations (During)',\n            source: dataSource\n          } satisfies ImageLayerOptions)\n        );\n      });\n\n    interface WMSOptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSOptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups: [\n            { title: 'Nom du group1 - push', name: '1 - push', ids: ['id1'] }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Régions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups: [\n            {\n              title: 'Nom du group1 - checkbox',\n              name: '1 - checkbox',\n              ids: ['id1']\n            }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaining ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n      },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } satisfies WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe((dataSource: WMSDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title:\n              'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          } satisfies ImageLayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Ogc filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/ogc-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel title=\"Layers\">\n            <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n            </igo-ogc-filterable-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AfterViewInit, Component, OnInit } from '@angular/core';\n\nimport {\n  DataSourceService,\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MAP_DIRECTIVES]\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map: IgoMap = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit(): void {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  ngAfterViewInit(): void {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [\n          [-72, 47.8],\n          [-73.5, 47.4],\n          [-72.4, 48.6]\n        ]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-71, 46.8],\n            [-73, 47],\n            [-71.2, 46.6]\n          ]\n        ]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3] satisfies Feature[],\n      FeatureMotion.None\n    );\n  }\n}\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/overlay\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport {\n  IgoMap,\n  ImageLayer,\n  ImageLayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  PrintComponent,\n  TileLayer,\n  TileLayerOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PrintComponent\n  ]\n})\nexport class AppPrintComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(private layerService: LayerService) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'xyz',\n          url: 'https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png',\n          crossOrigin: 'anonymous'\n        }\n      } satisfies TileLayerOptions)\n      .subscribe((layer: TileLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embâcles',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Radar météo',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geo.meteo.gc.ca/geomet?lang=fr', // https://geo.meteo.gc.ca/geomet?lang=fr\n          params: {\n            LAYERS: 'RADAR_1KM_RRAI',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Aéroports',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?',\n          params: {\n            layers: 'aeroport',\n            version: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      } satisfies ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n  }\n}\n","<app-doc-viewer\n  title=\"Print\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/print\">\n    <mat-grid-list cols=\"2\" rowHeight=\"800px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --top --right\">\n            <div class=\"spinner-spacer\"></div>\n            <igo-rotation-button\n              class=\"mat-elevation-z2\"\n              [showIfNoRotation]=\"true\"\n              [map]=\"map\"\n              color=\"primary\"\n            ></igo-rotation-button>\n          </div>\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-home-extent-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-home-extent-button>\n            <igo-geolocate-button\n              class=\"mat-elevation-z2\"\n              [map]=\"map\"\n              color=\"primary\"\n            >\n            </igo-geolocate-button>\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile> <igo-print [map]=\"map\"></igo-print></mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Query\" subtitle=\"Geo\" [dependencies]=\"[]\">\n  <app-example-viewer codeFolder=\"geo/query\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      igoQuery\n      [queryFeatures]=\"true\"\n      (query)=\"handleQueryResults($event)\"\n    >\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Details\">\n      <ng-container *ngIf=\"features$ | async as features\">\n        <div *ngFor=\"let feature of features\">\n          <h1>\n            Query Title :\n            <span style=\"background-color: #e0e0e0\">{{\n              getTitle($any(feature))\n            }}</span>\n          </h1>\n          <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n        </div>\n      </ng-container>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgFor, NgIf } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSource,\n  DataSourceService,\n  FEATURE_DETAILS_DIRECTIVES,\n  Feature,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  FeatureMotion,\n  IgoMap,\n  IgoQueryModule,\n  ImageLayer,\n  ImageLayerOptions,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  OverlayDirective,\n  QueryFormat,\n  QueryHtmlTarget,\n  QueryableDataSourceOptions,\n  SearchResult,\n  VectorLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from '@igo2/geo';\n\nimport olFeature from 'ol/Feature';\nimport olLineString from 'ol/geom/LineString';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MAP_DIRECTIVES,\n    OverlayDirective,\n    IgoQueryModule,\n    PanelComponent,\n    NgIf,\n    NgFor,\n    FEATURE_DETAILS_DIRECTIVES,\n    AsyncPipe\n  ]\n})\nexport class AppQueryComponent {\n  public features$: BehaviorSubject<Feature[]> = new BehaviorSubject<Feature[]>(\n    []\n  );\n\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource: DataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'aeroport',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource: DataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'WMS with different query url',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          queryable: true,\n          queryFormat: QueryFormat.HTMLGML2,\n          queryHtmlTarget: QueryHtmlTarget.IFRAME,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493'\n            }\n          ],\n          queryLayerFeatures: false,\n          params: {\n            layers: 'SDA_MUNIC_S_20K',\n            version: '1.3.0'\n          }\n        }\n      } as ImageLayerOptions)\n      .subscribe((layer: ImageLayer) => this.map.addLayer(layer));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as FeatureDataSourceOptions)\n      .subscribe((dataSource: FeatureDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector layer',\n            source: dataSource\n          } satisfies VectorLayerOptions)\n        );\n        this.addFeatures(dataSource);\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with different query url',\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryFormat: QueryFormat.HTMLGML2,\n          queryHtmlTarget: QueryHtmlTarget.IFRAME,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493'\n            }\n          ],\n          queryLayerFeatures: false\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as VectorTileLayerOptions)\n      .subscribe((layer: VectorTileLayer) => this.map.addLayer(layer));\n  }\n\n  addFeatures(dataSource: FeatureDataSource): void {\n    const feature1: olFeature<olLineString> = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ])\n    });\n\n    const feature2: olFeature<olPoint> = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      )\n    });\n\n    const feature3: olFeature<olPolygon> = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ])\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n  }\n\n  handleQueryResults(results: any): void {\n    const features: Feature[] = results.features;\n    if (features.length && features[0]) {\n      this.features$.next(features);\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\n    }\n  }\n\n  getTitle(result: SearchResult): string {\n    return getEntityTitle(result);\n  }\n}\n","<p></p>\n<igo-interactive-tour\n  mat-raised-button\n  tourToStart=\"global\"\n  menuIsOpen=\"true\"\n  styleButton=\"raised\"\n  [discoverTitleInLocale$]=\"discoverTitleInLocale$\"\n>\n</igo-interactive-tour>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length === 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  (click)=\"openGuide()\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon>description</mat-icon>\n</button>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length > 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  [matMenuTriggerFor]=\"menu\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon>description</mat-icon>\n</button>\n\n<mat-menu #menu=\"matMenu\">\n  <button\n    *ngFor=\"let guide of trainingGuideURLs\"\n    mat-menu-item\n    (click)=\"openGuide(guide)\"\n  >\n    {{ formatFileName(guide) }}\n  </button>\n</mat-menu>\n\n<igo-custom-html\n  *ngIf=\"headerHtml !== ''\"\n  class=\"mat-typography\"\n  [html]=\"headerHtml | translate\"\n>\n</igo-custom-html>\n\n<igo-custom-html\n  class=\"mat-typography\"\n  [html]=\"html | translate: { version: effectiveVersion }\"\n>\n</igo-custom-html>\n","import { NgFor, NgIf } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { AuthService } from '@igo2/auth';\nimport { CustomHtmlComponent } from '@igo2/common/custom-html';\nimport { InteractiveTourComponent } from '@igo2/common/interactive-tour';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ConfigService, version } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { of } from 'rxjs';\nimport type { Observable } from 'rxjs';\n\nimport { AllEnvironmentOptions } from '../../environment';\n\n@ToolComponent({\n  name: 'about',\n  title: 'igo.integration.tools.about',\n  icon: 'help'\n})\n@Component({\n  selector: 'igo-about-tool',\n  templateUrl: './about-tool.component.html',\n  styleUrls: ['./about-tool.component.scss'],\n  standalone: true,\n  imports: [\n    InteractiveTourComponent,\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatMenuModule,\n    NgFor,\n    CustomHtmlComponent,\n    IgoLanguageModule\n  ]\n})\nexport class AboutToolComponent implements OnInit {\n  private configOptions: AllEnvironmentOptions;\n  @Input()\n  get headerHtml() {\n    return this._headerHtml;\n  }\n  set headerHtml(value: string) {\n    this._headerHtml = Array.isArray(value) ? value.join('\\n') : value;\n  }\n\n  @Input()\n  get html() {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = Array.isArray(value) ? value.join('\\n') : value;\n  }\n  private _discoverTitleInLocale: string = 'IGO';\n  public discoverTitleInLocale$: Observable<string> = of(\n    this._discoverTitleInLocale\n  );\n\n  @Input()\n  get discoverTitleInLocale() {\n    return this._discoverTitleInLocale;\n  }\n  set discoverTitleInLocale(value: string) {\n    this._discoverTitleInLocale = value;\n    this.discoverTitleInLocale$ = of(value);\n  }\n\n  @Input() trainingGuideURLs;\n\n  public effectiveVersion: string;\n  private _html: string = 'igo.integration.aboutTool.html';\n  private _headerHtml: string;\n\n  private baseUrlProfil;\n  private baseUrlGuide;\n\n  public loading = false;\n\n  constructor(\n    public configService: ConfigService,\n    public auth: AuthService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService\n  ) {\n    this.headerHtml = this.languageService.translate.instant(\n      'igo.integration.aboutTool.headerHtml'\n    );\n    this.configOptions = this.configService.getConfigs();\n    const configVersion = this.configOptions.version;\n    this.effectiveVersion =\n      configVersion?.app || configVersion?.lib || version.lib;\n    this.baseUrlProfil = this.configOptions.storage?.url;\n    this.baseUrlGuide =\n      this.configOptions.depot?.url +\n      // todo validate this property\n      (this.configOptions.depot as any)?.guideUrl;\n  }\n\n  ngOnInit() {\n    if (this.auth.authenticated && this.configOptions.context?.url) {\n      this.http.get(this.baseUrlProfil).subscribe((profil) => {\n        const recast = profil as any;\n        this.trainingGuideURLs = recast.guides;\n        this.cdRef.detectChanges();\n      });\n    } else if (\n      this.auth.authenticated &&\n      !this.configOptions.context?.url &&\n      this.configOptions.depot?.trainingGuides\n    ) {\n      this.trainingGuideURLs = this.configOptions.depot?.trainingGuides;\n    }\n  }\n\n  openGuide(guide?) {\n    this.loading = true;\n    const url = guide\n      ? this.baseUrlGuide + guide + '?'\n      : this.baseUrlGuide + this.trainingGuideURLs[0] + '?';\n    this.http\n      .get(url, {\n        responseType: 'blob'\n      })\n      .subscribe(() => {\n        this.loading = false;\n        window.open(url, '_blank');\n        this.cdRef.detectChanges();\n      });\n  }\n\n  formatFileName(name: string) {\n    name = name.split('_').join(' ');\n    const index = name.indexOf('.');\n    name = name.slice(0, index);\n    return name;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\n\n// import { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of the map module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapState {\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\n  get showAllLegendsValue(): boolean {\n    return this._legendToolShowAll;\n  }\n\n  set showAllLegendsValue(value) {\n    this._legendToolShowAll = value;\n  }\n  private _legendToolShowAll: boolean;\n\n  /**\n   * Active map\n   */\n  get map(): IgoMap {\n    return this._map;\n  }\n  private _map: IgoMap;\n\n  constructor(\n    private mapService: MapService,\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\n    private storageService: StorageService,\n    private configService: ConfigService\n  ) {\n    this._map = new IgoMap(\n      {\n        controls: {\n          scaleLine: true,\n          attribution: {\n            collapsed: true\n          }\n        }\n      },\n      this.storageService,\n      this.configService\n    );\n\n    this.mapService.setMap(this.map);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityStore } from '@igo2/common/entity';\nimport { Catalog, CatalogItem } from '@igo2/geo';\n\n/**\n * Service that holds the state of the catalog module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogState {\n  /**\n   * Store that contains all the catalogs\n   */\n  get catalogStore(): EntityStore<Catalog> {\n    return this._catalogStore;\n  }\n  private _catalogStore: EntityStore<Catalog>;\n\n  /**\n   * Catalog -> Catalog items store mapping\n   */\n  private catalogItemsStores = new Map<string, EntityStore<CatalogItem>>();\n\n  constructor(authService: AuthService) {\n    this._catalogStore = new EntityStore([]);\n\n    authService.authenticate$.subscribe(() => {\n      this.clearCatalogItemsStores();\n    });\n  }\n\n  /**\n   * Get a catalog's items store\n   * @param catalog Catalog\n   * @returns Store that contains the catalog items\n   */\n  getCatalogItemsStore(catalog: Catalog): EntityStore<CatalogItem> {\n    return this.catalogItemsStores.get(catalog.id as string);\n  }\n\n  /**\n   * Bind a catalog items store to a catalog\n   * @param catalog Catalog\n   * @param store Catalog items store\n   */\n  setCatalogItemsStore(catalog: Catalog, store: EntityStore<CatalogItem>) {\n    this.catalogItemsStores.set(catalog.id as string, store);\n  }\n\n  /**\n   * Clear all catalog items stores\n   */\n  clearCatalogItemsStores() {\n    this.catalogItemsStores.clear();\n  }\n}\n","<igo-catalog-browser\n  *ngIf=\"store$ | async as store\"\n  [catalog]=\"catalog\"\n  [store]=\"store\"\n  [map]=\"map\"\n  [toggleCollapsedGroup]=\"toggleCollapsedGroup\"\n>\n</igo-catalog-browser>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityRecord, EntityStore } from '@igo2/common/entity';\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  Catalog,\n  CatalogBrowserComponent,\n  CatalogItem,\n  CatalogItemState,\n  CatalogService,\n  IgoMap\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MapState } from '../../map/map.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse a catalog's groups and layers and display them to a map.\n */\n@ToolComponent({\n  name: 'catalogBrowser',\n  title: 'igo.integration.tools.catalog',\n  parent: 'catalog'\n})\n@Component({\n  selector: 'igo-catalog-browser-tool',\n  templateUrl: './catalog-browser-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [NgIf, CatalogBrowserComponent, AsyncPipe]\n})\nexport class CatalogBrowserToolComponent implements OnInit, OnDestroy {\n  catalog: Catalog;\n\n  /**\n   * Store that contains the catalog items\n   * @internal\n   */\n  store$ = new BehaviorSubject<EntityStore<CatalogItem, CatalogItemState>>(\n    undefined\n  );\n\n  /**\n   * Subscription to the selected catalog\n   */\n  private catalog$$: Subscription;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  /**\n   * Map to add layers to\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private mapState: MapState,\n    private authService: AuthService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const catalogStore = this.catalogState.catalogStore;\n\n    const catalog$ = catalogStore.stateView.firstBy$(\n      (record: EntityRecord<Catalog>) => record.state.selected === true\n    );\n    const authenticate$ = this.authService.authenticate$;\n    this.catalog$$ = combineLatest([catalog$, authenticate$]).subscribe(\n      ([record, authenticate]) => {\n        const catalog = record.entity;\n        this.catalog = catalog;\n        this.loadCatalogItems(this.catalog);\n      }\n    );\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.catalog$$.unsubscribe();\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    let store = this.catalogState.getCatalogItemsStore(catalog);\n    if (store !== undefined) {\n      this.store$.next(store);\n      return;\n    }\n\n    store = new EntityStore<CatalogItem>([]);\n    this.catalogState.setCatalogItemsStore(catalog, store);\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .pipe(take(1))\n      .subscribe((items: CatalogItem[]) => {\n        store.load(items);\n        this.store$.next(store);\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ExportOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n  readonly importExportType$: BehaviorSubject<ImportExportType> =\n    new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> =\n    new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n    this.exportOptions$.next(exportOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ToolService, Toolbox } from '@igo2/common/tool';\nimport { ExportOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n  ) {}\n\n  toolToActivateFromOptions(toolToActivate: {\n    tool: string;\n    options: { [key: string]: any };\n  }) {\n    if (!toolToActivate) {\n      return;\n    }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions =\n        this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent =\n          toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { LAYER_PLUS_ICON } from '@igo2/common/icon';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport { Catalog, CatalogLibaryComponent, CatalogService } from '@igo2/geo';\n\nimport { take } from 'rxjs/operators';\n\nimport { ToolState } from '../../tool/tool.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse the list of available catalogs.\n */\n@ToolComponent({\n  name: 'catalog',\n  title: 'igo.integration.tools.catalog',\n  icon: LAYER_PLUS_ICON\n})\n@Component({\n  selector: 'igo-catalog-library-tool',\n  templateUrl: './catalog-library-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [CatalogLibaryComponent]\n})\nexport class CatalogLibraryToolComponent implements OnInit {\n  /**\n   * Store that contains the catalogs\n   * @internal\n   */\n  get store(): EntityStore<Catalog> {\n    return this.catalogState.catalogStore;\n  }\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * List of predefined catalogs\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  set selectedCatalogId(id) {\n    this.storageService.set('selectedCatalogId', id, StorageScope.SESSION);\n  }\n\n  get currentTool() {\n    return this.toolState.toolbox.getCurrentPreviousToolName()[1];\n  }\n\n  get lastTool() {\n    return this.toolState.toolbox.getCurrentPreviousToolName()[0];\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private toolState: ToolState,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    if (this.lastTool === 'catalogBrowser' && this.currentTool === 'catalog') {\n      this.selectedCatalogId = null;\n    }\n\n    if (this.store.count === 0) {\n      this.loadCatalogs();\n    }\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\n    if (event.selected === false) {\n      return;\n    }\n    this.toolState.toolbox.activateTool('catalogBrowser');\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService\n      .loadCatalogs()\n      .pipe(take(1))\n      .subscribe((catalogs: Catalog[]) => {\n        this.store.clear();\n        this.store.load(\n          catalogs.concat(\n            (this.storageService.get('addedCatalogs') || []) as Catalog[]\n          )\n        );\n      });\n  }\n}\n","<igo-catalog-library\n  [predefinedCatalogs]=\"predefinedCatalogs\"\n  [addCatalogAllowed]=\"addCatalogAllowed\"\n  [store]=\"store\"\n  (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n>\n</igo-catalog-library>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextEditBindingDirective,\n  ContextEditComponent\n} from '@igo2/context';\n\nimport { ToolState } from '../../tool/tool.state';\n\n@ToolComponent({\n  name: 'contextEditor',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-editor-tool',\n  templateUrl: './context-editor-tool.component.html',\n  standalone: true,\n  imports: [ContextEditComponent, ContextEditBindingDirective]\n})\nexport class ContextEditorToolComponent {\n  constructor(private toolState: ToolState) {}\n\n  submitSuccessed() {\n    this.toolState.toolbox.activatePreviousTool();\n  }\n}\n","<igo-context-edit\n  igoContextEditBinding\n  (submitSuccessed)=\"submitSuccessed()\"\n></igo-context-edit>\n","import { Component, Input } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextListBindingDirective,\n  ContextListComponent\n} from '@igo2/context';\nimport { IgoMap } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\n\n@ToolComponent({\n  name: 'contextManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star'\n})\n@Component({\n  selector: 'igo-context-manager-tool',\n  templateUrl: './context-manager-tool.component.html',\n  standalone: true,\n  imports: [ContextListComponent, ContextListBindingDirective]\n})\nexport class ContextManagerToolComponent {\n  @Input() toolToOpenOnContextChange: string = 'mapTools';\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private toolState: ToolState,\n    private mapState: MapState\n  ) {}\n\n  editContext() {\n    this.toolState.toolbox.activateTool('contextEditor');\n  }\n\n  managePermissions() {\n    this.toolState.toolbox.activateTool('contextPermissionManager');\n  }\n}\n","<igo-context-list\n  igoContextListBinding\n  [map]=\"map\"\n  (edit)=\"editContext()\"\n  (managePermissions)=\"managePermissions()\"\n>\n</igo-context-list>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextPermissionsBindingDirective,\n  ContextPermissionsComponent\n} from '@igo2/context';\n\n@ToolComponent({\n  name: 'contextPermissionManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-permission-manager-tool',\n  templateUrl: './context-permission-manager-tool.component.html',\n  standalone: true,\n  imports: [ContextPermissionsComponent, ContextPermissionsBindingDirective]\n})\nexport class ContextPermissionManagerToolComponent {}\n","<igo-context-permissions igoContextPermissionsBinding></igo-context-permissions>\n","import { Injectable } from '@angular/core';\n\nimport { LayerListControlsOptions } from '@igo2/geo';\n\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of layer list tool values\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolState {\n  readonly keyword$: BehaviorSubject<string> = new BehaviorSubject('');\n  readonly sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly selectedTab$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  setKeyword(keyword: string) {\n    this.keyword$.next(keyword);\n  }\n\n  setSortAlpha(sort: boolean) {\n    this.sortAlpha$.next(sort);\n  }\n\n  setOnlyVisible(onlyVisible: boolean) {\n    this.onlyVisible$.next(onlyVisible);\n  }\n\n  setSelectedTab(tab: number) {\n    this.selectedTab$.next(tab);\n  }\n\n  getLayerListControls(): LayerListControlsOptions {\n    return {\n      keyword: this.keyword$.value,\n      onlyVisible: this.onlyVisible$.value,\n      sortAlpha: this.sortAlpha$.value\n    };\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ShareMapComponent } from '@igo2/context';\nimport { IgoMap, LayerListControlsOptions } from '@igo2/geo';\n\nimport { LayerListToolState } from '../../map/layer-list-tool.state';\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'shareMap',\n  title: 'igo.integration.tools.shareMap',\n  icon: 'share'\n})\n@Component({\n  selector: 'igo-context-share-tool',\n  templateUrl: './context-share-tool.component.html',\n  standalone: true,\n  imports: [ShareMapComponent]\n})\nexport class ContextShareToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layerListControls(): LayerListControlsOptions {\n    return this.layerListToolState.getLayerListControls();\n  }\n\n  constructor(\n    private mapState: MapState,\n    private layerListToolState: LayerListToolState\n  ) {}\n}\n","<igo-share-map [map]=\"map\"></igo-share-map>\n","import { Injectable } from '@angular/core';\n\nimport { Tool, ToolService } from '@igo2/common/tool';\nimport { ContextService, DetailedContext } from '@igo2/context';\nimport { LanguageService } from '@igo2/core/language';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { ToolState } from '../tool/tool.state';\n\n/**\n * Service that holds the state of the context module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextState {\n  /**\n   * Observable of the active context\n   */\n  context$: BehaviorSubject<DetailedContext> = new BehaviorSubject(undefined);\n\n  constructor(\n    private contextService: ContextService,\n    private toolService: ToolService,\n    private toolState: ToolState,\n    private languageService: LanguageService\n  ) {\n    this.contextService.context$.subscribe((context: DetailedContext) => {\n      this.onContextChange(context);\n    });\n    this.contextService.toolsChanged$.subscribe((context: DetailedContext) => {\n      this.updateTools(context);\n    });\n  }\n\n  /**\n   * Set the active context\n   * @param context Detailed context\n   */\n  private setContext(context: DetailedContext) {\n    this.updateTools(context);\n    this.context$.next(context);\n  }\n\n  /**\n   * Update the tool state with the context's tools\n   * @param context Detailed context\n   */\n  private updateTools(context: DetailedContext) {\n    const toolbox = this.toolState.toolbox;\n\n    const tools = [];\n    const contextTools = context.tools || [];\n    contextTools.forEach((contextTool: Tool) => {\n      const baseTool = this.toolService.getTool(contextTool.name);\n      if (baseTool === undefined) {\n        return;\n      }\n\n      const options = Object.assign(\n        {},\n        baseTool.options || {},\n        contextTool.options || {}\n      );\n      const tool = Object.assign({}, baseTool, contextTool, { options });\n      tools.push(tool);\n    });\n\n    tools.forEach((tool) => {\n      if (tool.parent) {\n        const parentIndex = tools.findIndex((el) => el.name === tool.parent);\n        if (parentIndex !== -1) {\n          tools[parentIndex].children = [];\n          tools[parentIndex].children.push(tool.name);\n        }\n      }\n    });\n\n    toolbox.setTools(tools);\n    toolbox.setToolbar(context.toolbar || []);\n\n    // TODO: This is a patch so the context service can work without\n    // injecting the ToolState or without being completely refactored\n    this.contextService.setTools([].concat(tools));\n    this.contextService.setToolbar(context.toolbar || []);\n  }\n\n  /**\n   * Set a new context and update the tool state\n   * @param context Detailed context\n   */\n  private onContextChange(context: DetailedContext) {\n    if (context === undefined) {\n      return;\n    }\n    this.setContext(context);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  AnyLayerOptions,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from '@igo2/geo';\n\nimport { Subject } from 'rxjs';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionState {\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  /**\n   * Store that holds the stop\n   */\n  public stopsStore: StopsStore = new StopsStore([]);\n\n  /**\n   * Store that holds the driving stops as feature\n   */\n  public stopsFeatureStore: StopsFeatureStore;\n\n  /**\n   * Store that holds the driving route as feature\n   */\n  public routesFeatureStore: RoutesFeatureStore;\n\n  public stepFeatureStore: StepFeatureStore;\n\n  public debounceTime: number = 200;\n\n  constructor(private mapState: MapState) {\n    this.stopsFeatureStore = new StopsFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.routesFeatureStore = new RoutesFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.stepFeatureStore = new StepFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.stopsFeatureStore.empty$.subscribe((empty) => {\n        if (this.stopsFeatureStore.layer?.options) {\n          (\n            this.stopsFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n      this.routesFeatureStore.empty$.subscribe((empty) => {\n        if (this.routesFeatureStore.layer?.options) {\n          (\n            this.routesFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n    });\n\n    this.mapState.map.layers$.subscribe(() => {\n      if (!this.mapState.map.getLayerById('igo-direction-stops-layer')) {\n        this.stopsStore.deleteMany(this.stopsStore.all());\n        this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all()); // not necessary\n      }\n      if (!this.mapState.map.getLayerById('igo-direction-route-layer')) {\n        this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      }\n    });\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport {\n  IgoDirectionsModule,\n  IgoMap,\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { ContextState } from '../../context/context.state';\nimport { MapState } from '../../map/map.state';\nimport { DirectionState } from '../directions.state';\n\n@ToolComponent({\n  name: 'directions',\n  title: 'igo.integration.tools.directions',\n  icon: 'directions'\n})\n@Component({\n  selector: 'igo-directions-tool',\n  templateUrl: './directions-tool.component.html',\n  standalone: true,\n  imports: [IgoDirectionsModule]\n})\nexport class DirectionsToolComponent implements OnInit {\n  public currentContextUri: string;\n  /**\n   * stops\n   * @internal\n   */\n  get stopsStore(): StopsStore {\n    return this.directionState.stopsStore;\n  }\n\n  get debounceTime(): number {\n    return this.directionState.debounceTime;\n  }\n\n  /**\n   * stops\n   * @internal\n   */\n  get stopsFeatureStore(): StopsFeatureStore {\n    return this.directionState.stopsFeatureStore;\n  }\n\n  /**\n   * routes\n   * @internal\n   */\n  get routesFeatureStore(): RoutesFeatureStore {\n    return this.directionState.routesFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get stepFeatureStore(): StepFeatureStore {\n    return this.directionState.stepFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get zoomToActiveRoute$(): Subject<void> {\n    return this.directionState.zoomToActiveRoute$;\n  }\n\n  get authenticated$(): BehaviorSubject<boolean> {\n    return this.authService.authenticate$;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private directionState: DirectionState,\n    private mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    public contextState: ContextState,\n    private authService: AuthService\n  ) {}\n\n  ngOnInit(): void {\n    const warningShown = this.storageService.get(\n      'direction.warning.shown'\n    ) as boolean;\n    if (!warningShown) {\n      this.messageService.info(\n        'igo.integration.directions.warning.message',\n        'igo.integration.directions.warning.title',\n        { timeOut: 20000 }\n      );\n      this.storageService.set(\n        'direction.warning.shown',\n        true,\n        StorageScope.SESSION\n      );\n    }\n    this.contextState.context$.subscribe((c) => {\n      if (!this.authService.authenticated) {\n        this.currentContextUri = c.uri;\n      }\n    });\n  }\n}\n","<igo-directions\n  [contextUri]=\"currentContextUri\"\n  [debounce]=\"debounceTime\"\n  [stopsStore]=\"stopsStore\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n  [authenticated$]=\"authenticated$\"\n>\n</igo-directions>\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DirectionsToolComponent } from './directions-tool/directions-tool.component';\n\n/**\n * @deprecated import the DirectionsToolComponent directly\n */\n@NgModule({\n  imports: [DirectionsToolComponent],\n  exports: [DirectionsToolComponent]\n})\nexport class IgoAppDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoAppDirectionsModule> {\n    return {\n      ngModule: IgoAppDirectionsModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  DrawControl,\n  FeatureStore,\n  FeatureWithDraw,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawState {\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n  public layersID: string[] = [];\n  public drawControls: [string, DrawControl][] = [];\n  public activeDrawingLayer: VectorLayer;\n\n  constructor(private mapState: MapState) {\n    this.mapState.map.layers$.subscribe(() => {\n      this.layersID.forEach((layerId) => {\n        if (!this.mapState.map.getLayerById(layerId)) {\n          let deletedStore = this.stores.find(\n            (store) => store.layer.id === layerId\n          );\n          deletedStore.deleteMany(deletedStore.all());\n          this.stores.splice(this.stores.indexOf(deletedStore, 0), 1);\n          this.layersID.splice(this.layersID.indexOf(layerId, 0), 1);\n          let drawControlIndex = this.drawControls.findIndex(\n            (dc) => dc[0] === layerId\n          );\n          this.drawControls.splice(drawControlIndex, 1);\n        }\n      });\n    });\n    for (let store of this.stores) {\n      store = new FeatureStore<FeatureWithDraw>([], { map: this.mapState.map });\n    }\n  }\n}\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  DrawComponent,\n  DrawControl,\n  FeatureStore,\n  FeatureWithDraw,\n  IgoMap,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { DrawState } from '../draw.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'draw',\n  title: 'igo.integration.tools.draw',\n  icon: 'stylus_note'\n})\n@Component({\n  selector: 'igo-drawing-tool',\n  templateUrl: './drawing-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [DrawComponent]\n})\nexport class DrawingToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this.drawState.stores;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layersID(): string[] {\n    return this.drawState.layersID;\n  }\n\n  get drawControls(): [string, DrawControl][] {\n    return this.drawState.drawControls;\n  }\n  set drawControls(dc: [string, DrawControl][]) {\n    this.drawState.drawControls = dc;\n  }\n\n  get activeDrawingLayer(): VectorLayer {\n    return this.drawState.activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this.drawState.activeDrawingLayer = value;\n  }\n\n  public addLayersID(layerID: string) {\n    this.layersID.push(layerID);\n  }\n\n  public addDrawControls(dc: [string, DrawControl][]) {\n    this.drawControls = dc;\n  }\n\n  constructor(\n    private drawState: DrawState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-draw\n  [stores]=\"stores\"\n  [map]=\"map\"\n  (layersIDEvent)=\"addLayersID($event)\"\n  [activeDrawingLayer]=\"activeDrawingLayer\"\n  [drawControls]=\"drawControls\"\n  (drawControlsEvent)=\"addDrawControls($event)\"\n  (activeLayerChange)=\"activeDrawingLayer = $event\"\n>\n</igo-draw>\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, Layer, OgcFilterableItemComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { toolSlideInOut } from './active-ogc-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeOgcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-ogc-filter-tool',\n  templateUrl: './active-ogc-filter-tool.component.html',\n  animations: [toolSlideInOut()],\n  standalone: true,\n  imports: [OgcFilterableItemComponent]\n})\nexport class ActiveOgcFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-ogc-filterable-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-ogc-filterable-item>\n","import {\n  AnimationTriggerMetadata,\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, Layer, TimeFilterItemComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { toolSlideInOut } from './active-time-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeTimeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-time-filter-tool',\n  templateUrl: './active-time-filter-tool.component.html',\n  animations: [toolSlideInOut()],\n  standalone: true,\n  imports: [TimeFilterItemComponent]\n})\nexport class ActiveTimeFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-time-filter-item\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-time-filter-item>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  OgcFilterableListBindingDirective,\n  OgcFilterableListComponent\n} from '@igo2/geo';\n\n@ToolComponent({\n  name: 'ogcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter'\n})\n@Component({\n  selector: 'igo-ogc-filter-tool',\n  templateUrl: './ogc-filter-tool.component.html',\n  standalone: true,\n  imports: [OgcFilterableListComponent, OgcFilterableListBindingDirective]\n})\nexport class OgcFilterToolComponent {\n  constructor() {}\n}\n","<igo-ogc-filterable-list igoOgcFilterableListBinding></igo-ogc-filterable-list>\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Action } from '@igo2/common/action';\nimport {\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  EditionWorkspace,\n  ExportOptions,\n  FeatureMotion,\n  FeatureStoreSelectionStrategy,\n  FeatureWorkspace,\n  OgcFilterableDataSource,\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected\n} from '@igo2/geo';\n\nimport * as jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport moment from 'moment';\nimport { BehaviorSubject, map } from 'rxjs';\n\nimport { ToolState } from '../../tool';\n\nexport function handleZoomAuto(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  storageService\n) {\n  const zoomStrategy = workspace.entityStore.getStrategyOfType(\n    FeatureStoreSelectionStrategy\n  ) as FeatureStoreSelectionStrategy;\n  zoomStrategy.setMotion(\n    (storageService.get('zoomAuto') as boolean)\n      ? FeatureMotion.Default\n      : FeatureMotion.None\n  );\n}\n\nexport function getWorkspaceActions(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n  selectOnlyCheckCondition$: BehaviorSubject<boolean>,\n  ogcFilterWidget: Widget,\n  zoomAuto$: BehaviorSubject<boolean>,\n  maximize$: BehaviorSubject<boolean>,\n  storageService: StorageService,\n  languageService: LanguageService,\n  mediaService: MediaService,\n  toolState: ToolState\n): Action[] {\n  const actions = [\n    {\n      id: 'zoomAuto',\n      checkbox: true,\n      title: 'igo.integration.workspace.zoomAuto.title',\n      tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n      checkCondition: zoomAuto$,\n      handler: () => {\n        handleZoomAuto(workspace, storageService);\n        storageService.set(\n          'zoomAuto',\n          !storageService.get('zoomAuto') as boolean\n        );\n      }\n    },\n    {\n      id: 'filterInMapExtent',\n      checkbox: true,\n      title: 'igo.integration.workspace.inMapExtent.title',\n      tooltip: mapExtentStrategyActiveToolTip(workspace),\n      checkCondition: rowsInMapExtentCheckCondition$,\n      handler: () =>\n        rowsInMapExtentCheckCondition$.next(\n          !rowsInMapExtentCheckCondition$.value\n        )\n    },\n    {\n      id: 'selectedOnly',\n      checkbox: true,\n      title: 'igo.integration.workspace.selected.title',\n      tooltip: 'igo.integration.workspace.selected.tooltip',\n      checkCondition: selectOnlyCheckCondition$,\n      handler: () =>\n        selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n    },\n    {\n      id: 'clearselection',\n      icon: 'deselect',\n      title: 'igo.integration.workspace.clearSelection.title',\n      tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n          selected: false\n        });\n      },\n      args: [workspace],\n      availability: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) =>\n        noElementSelected(ws)\n    },\n    {\n      id: 'featureDownload',\n      icon: 'file_save',\n      title: 'igo.integration.workspace.download.title',\n      tooltip: 'igo.integration.workspace.download.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const filterStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterCustomFuncStrategy\n        );\n        const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterSelectionStrategy\n        );\n        const layersWithSelection = filterSelectionStrategy.active\n          ? [ws.layer.id]\n          : [];\n        toolState.toolToActivateFromOptions({\n          tool: 'importExport',\n          options: {\n            layers: [ws.layer.id],\n            featureInMapExtent: filterStrategy.active,\n            layersWithSelection\n          } as ExportOptions\n        });\n      },\n      args: [workspace]\n    },\n    {\n      id: 'ogcFilter',\n      icon: 'filter_alt',\n      title: 'igo.integration.workspace.ogcFilter.title',\n      tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n      handler: (\n        widget: Widget,\n        ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace\n      ) => {\n        ws.activateWidget(widget, {\n          map: ws.map,\n          layer: ws.layer\n        });\n      },\n      args: [ogcFilterWidget, workspace]\n    },\n    {\n      id: 'maximize',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.maximize'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.maximizeTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => !v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        if (!mediaService.isMobile()) {\n          maximize$.next(true);\n        }\n      }\n    },\n    {\n      id: 'standardExtent',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.standardExtent'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.standardExtentTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        maximize$.next(false);\n      }\n    },\n    {\n      id: 'print',\n      icon: 'print',\n      title: 'igo.integration.workspace.print.title',\n      tooltip: 'igo.integration.workspace.print.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const title = `${ws.layer.title} (${dateTransform(\n          new Date(),\n          'YYYY-MM-DD-HH_mm'\n        )})`;\n        const doc: any = new jsPDF.default('landscape');\n        const totalPagesExp = '{total_pages_count_string}';\n        doc.text(title, 14, 20);\n        doc.autoTable({\n          startY: 25,\n          tableWidth: 'wrap',\n          html: '#currentWorkspaceTable',\n          horizontalPageBreak: true,\n          styles: { cellPadding: 0.5, minCellWidth: 20, fontSize: 6 },\n          didDrawPage: (data) => {\n            let str = 'Page ' + doc.internal.getNumberOfPages();\n            if (typeof doc.putTotalPages === 'function') {\n              str = str + ' / ' + totalPagesExp;\n            }\n            doc.setFontSize(6);\n            const pageSize = doc.internal.pageSize;\n            const pageHeight = pageSize.height\n              ? pageSize.height\n              : pageSize.getHeight();\n            doc.text(str, data.settings.margin.left, pageHeight - 10);\n          }\n        });\n        if (typeof doc.putTotalPages === 'function') {\n          doc.putTotalPages(totalPagesExp);\n        }\n        doc.save(`${title}.pdf`);\n      },\n      args: [workspace]\n    }\n  ];\n  let returnActions = (workspace.layer.dataSource as OgcFilterableDataSource)\n    .options.ogcFilters?.enabled\n    ? actions\n    : actions.filter((action) => action.id !== 'ogcFilter');\n  returnActions =\n    workspace.layer.options.workspace.printable !== false\n      ? actions\n      : actions.filter((action) => action.id !== 'print');\n  return returnActions;\n}\n\nfunction dateTransform(date: Date, format: string): string {\n  return moment(date).format(format);\n}\n","import { Inject, Injectable, OnDestroy, Optional } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { EditionWorkspace, OgcFilterWidget } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Optional()\n    @Inject(OgcFilterWidget)\n    private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { FeatureWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      undefined,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Inject, Injectable, OnDestroy, Optional } from '@angular/core';\n\nimport { Action } from '@igo2/common/action';\nimport { Widget } from '@igo2/common/widget';\nimport { LanguageService } from '@igo2/core/language';\nimport { MediaService } from '@igo2/core/media';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from '@igo2/core/storage';\nimport { OgcFilterWidget, WfsWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\nimport { StorageState } from '../../storage/storage.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Optional()\n    @Inject(OgcFilterWidget)\n    private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState\n    );\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityState,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common/entity';\nimport { Widget } from '@igo2/common/widget';\nimport { Workspace, WorkspaceStore } from '@igo2/common/workspace';\nimport { StorageService } from '@igo2/core/storage';\nimport { EditionWorkspace, FeatureWorkspace, WfsWorkspace } from '@igo2/geo';\n\nimport { BehaviorSubject, Observable, Subscription, of } from 'rxjs';\n\nimport { EditionActionsService } from './shared/edition-actions.service';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean>;\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> =\n    new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore {\n    return this._store;\n  }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore.stateView.manyBy(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.workspaceMaximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.active === true\n      )\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView\n      .all$()\n      .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n        workspaces.map((wks: EntityRecord<Workspace>) => {\n          if (wks.entity.actionStore.empty) {\n            if (wks.entity instanceof WfsWorkspace) {\n              this.wfsActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof FeatureWorkspace) {\n              this.featureActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof EditionWorkspace) {\n              this.editionActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            }\n          }\n        });\n      });\n\n    this.actionMaximize$$.push(\n      this.featureActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.wfsActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.editionActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.activeWorkspace$$ = this.workspace$.subscribe(\n      (workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$.subscribe(\n            (widget: Widget) => this.activeWorkspaceWidget$.next(widget)\n          );\n        }\n      }\n    );\n\n    this.rowsInMapExtentCheckCondition$$ =\n      this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterCustomFuncStrategy\n            );\n            if (filterStrategy) {\n              if (rowsInMapExtent) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe(\n      (selectOnly) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterSelectionStrategy\n            );\n            if (filterStrategy) {\n              if (selectOnly) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      }\n    );\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store.all().find((workspace) => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find((workspace) => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map((a) => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n}\n","<igo-spatial-filter-type\n  [store]=\"spatialListStore\"\n  [selectedQueryType]=\"queryType\"\n  [zone]=\"zone\"\n  [layers]=\"activeLayers\"\n  (eventType)=\"getOutputType($event)\"\n  (eventQueryType)=\"getOutputQueryType($event)\"\n  (zoneChange)=\"onZoneChange($event)\"\n  (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n  (bufferChange)=\"buffer = $event\"\n  (measureUnitChange)=\"measureUnit = $event\"\n>\n</igo-spatial-filter-type>\n\n<igo-spatial-filter-item\n  [type]=\"type\"\n  [queryType]=\"queryType\"\n  [map]=\"map\"\n  [zone]=\"zone\"\n  [loading]=\"loading\"\n  [store]=\"store\"\n  [layers]=\"activeLayers\"\n  [allLayers]=\"layers\"\n  [thematicLength]=\"thematicLength\"\n  (radiusEvent)=\"buffer = $event\"\n  (bufferEvent)=\"buffer = $event\"\n  (measureUnitChange)=\"measureUnit = $event\"\n  (freehandControl)=\"freehandDrawIsActive = $event\"\n  (drawZoneEvent)=\"zone = $event\"\n  (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n  (itemTypeChange)=\"itemType = $event\"\n  (thematicChange)=\"thematics = $event\"\n  (toggleSearch)=\"getOutputToggleSearch()\"\n  (clearButtonEvent)=\"clearMap()\"\n  (clearSearchEvent)=\"getOutputClearSearch()\"\n  (export)=\"activateExportTool()\"\n  (openWorkspace)=\"activateWorkspace()\"\n  (entityChange)=\"activateWorkspace($event)\"\n>\n</igo-spatial-filter-item>\n<ng-container *ngIf=\"selectedFeature$ | async as feature\">\n  <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n</ng-container>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { EntityStore } from '@igo2/common/entity';\nimport { SELECTION_MARKER_ICON } from '@igo2/common/icon';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  DataSource,\n  DataSourceService,\n  ExportOptions,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  IgoMap,\n  Layer,\n  LayerService,\n  MeasureLengthUnit,\n  QueryableDataSourceOptions,\n  SpatialFilterItemComponent,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterService,\n  SpatialFilterThematic,\n  SpatialFilterType,\n  SpatialFilterTypeComponent,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  featureToOl,\n  moveToOlFeatures\n} from '@igo2/geo';\n\nimport { EventsKey } from 'ol/events';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport * as olstyle from 'ol/style';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport { take, takeUntil, tap } from 'rxjs/operators';\n\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from './../../import-export/import-export.state';\n\n/**\n * Tool to apply spatial filter\n */\n@ToolComponent({\n  name: 'spatialFilter',\n  title: 'igo.integration.tools.spatialFilter',\n  icon: SELECTION_MARKER_ICON\n})\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-tool',\n  templateUrl: './spatial-filter-tool.component.html',\n  styleUrls: ['./spatial-filter-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    SpatialFilterTypeComponent,\n    SpatialFilterItemComponent,\n    PanelComponent,\n    FeatureDetailsComponent,\n    NgIf,\n    AsyncPipe\n  ]\n})\nexport class SpatialFilterToolComponent implements OnInit, OnDestroy {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store: EntityStore<Feature> = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  private moveendKey: EventsKey;\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapState: MapState,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private importExportState: ImportExportState,\n    private toolState: ToolState,\n    private workspaceState: WorkspaceState,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  activateExportTool() {\n    const ids = [];\n    const re = new RegExp('^Zone \\\\d+');\n    for (const layer of this.layers) {\n      if (!layer.title.match(re)) {\n        ids.push(layer.id);\n      }\n    }\n    this.importExportState.setMode(ImportExportMode.export);\n    this.importExportState.setsExportOptions({ layers: ids } as ExportOptions);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateWorkspace(record?) {\n    let layerToOpenWks;\n    this.workspaceState.store.entities$\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        if (\n          !record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          if (this.itemType === SpatialFilterItemType.Thematics) {\n            for (const thematic of this.thematics) {\n              if (!thematic.zeroResults) {\n                layerToOpenWks = this.activeLayers.find((layer) =>\n                  layer.title.includes(\n                    thematic.name + ' ' + this.iterator.toString()\n                  )\n                );\n                break;\n              }\n            }\n          } else {\n            const title = 'Adresses ' + this.iterator.toString();\n            this.activeLayers.forEach((layer) => {\n              if (layer.title.includes(title)) {\n                layerToOpenWks = layer;\n              }\n            });\n          }\n\n          if (layerToOpenWks) {\n            this.workspaceState.workspacePanelExpanded = true;\n            this.workspaceState.setActiveWorkspaceById(layerToOpenWks.id);\n          }\n        } else if (\n          record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          this.selectWorkspaceEntity(record);\n          this.moveendKey = this.map.ol.on('moveend', () => {\n            this.selectWorkspaceEntity(record);\n          });\n        }\n      });\n  }\n\n  private selectWorkspaceEntity(record) {\n    this.workspaceState.store.all().forEach((workspace) => {\n      workspace.entityStore.state.updateAll({ selected: false });\n      if (workspace.title.includes(record.added[0].meta.title)) {\n        this.workspaceState.setActiveWorkspaceById(workspace.id);\n        workspace.entityStore.state.updateMany(record.added, {\n          selected: true\n        });\n      }\n    });\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach((feature) => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((f) => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  TimeFilterListBindingDirective,\n  TimeFilterListComponent\n} from '@igo2/geo';\n\n@ToolComponent({\n  name: 'timeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history'\n})\n@Component({\n  selector: 'igo-time-filter-tool',\n  templateUrl: './time-filter-tool.component.html',\n  standalone: true,\n  imports: [TimeFilterListComponent, TimeFilterListBindingDirective]\n})\nexport class TimeFilterToolComponent {\n  constructor() {}\n}\n","<igo-time-filter-list igoTimeFilterListBinding></igo-time-filter-list>\n","<mat-tab-group *ngIf=\"importExportShowBothType\">\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportData' | translate\"\n  >\n    <igo-import-export\n      [contextUri]=\"(contextState.context$ | async).uri\"\n      [map]=\"map\"\n      [selectFirstProj]=\"selectFirstProj\"\n      [projectionsLimitations]=\"projectionsLimitations\"\n      [store]=\"workspaceStore\"\n      [selectedMode]=\"importExportState.selectedMode$ | async\"\n      (selectMode)=\"modeChanged($any($event))\"\n      [exportOptions$]=\"importExportState.exportOptions$\"\n      (exportOptionsChange)=\"exportOptionsChange($event)\"\n    >\n    </igo-import-export>\n  </mat-tab>\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportContext' | translate\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'layer'\"\n  [contextUri]=\"(contextState.context$ | async).uri\"\n  [map]=\"map\"\n  [store]=\"workspaceStore\"\n  [selectedMode]=\"importExportState.selectedMode$ | async\"\n  (selectMode)=\"modeChanged($any($event))\"\n  [exportOptions$]=\"importExportState.exportOptions$\"\n  (exportOptionsChange)=\"exportOptionsChange($event)\"\n>\n</igo-import-export>\n\n<igo-context-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'context'\"\n  [map]=\"map\"\n>\n</igo-context-import-export>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnInit\n} from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport type { WorkspaceStore } from '@igo2/common/workspace';\nimport { ContextImportExportComponent } from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportOptions,\n  IgoMap,\n  ImportExportComponent,\n  ProjectionsLimitationsOptions\n} from '@igo2/geo';\n\nimport { ContextState } from '../../context/context.state';\nimport { MapState } from '../../map/map.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport {\n  ImportExportMode,\n  ImportExportState,\n  ImportExportType\n} from '../import-export.state';\n\n@ToolComponent({\n  name: 'importExport',\n  title: 'igo.integration.tools.importExport',\n  icon: 'file_save'\n})\n@Component({\n  selector: 'igo-import-export-tool',\n  templateUrl: './import-export-tool.component.html',\n  styleUrls: ['./import-export-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatTabsModule,\n    ImportExportComponent,\n    ContextImportExportComponent,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class ImportExportToolComponent implements OnInit {\n  @Input() projectionsLimitations: ProjectionsLimitationsOptions;\n\n  @Input() selectFirstProj: boolean = false;\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  @Input() importExportType: ImportExportType = ImportExportType.layer;\n  @Input() importExportShowBothType: boolean = true;\n\n  constructor(\n    private mapState: MapState,\n    public importExportState: ImportExportState,\n    private workspaceState: WorkspaceState,\n    public contextState: ContextState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectType();\n    this.selectMode();\n  }\n\n  private selectType() {\n    if (this.importExportType) {\n      this.importExportState.importExportType$.next(this.importExportType);\n    }\n    const userSelectedType = this.importExportState.importExportType$.value;\n    if (userSelectedType !== undefined) {\n      this.importExportState.setImportExportType(userSelectedType);\n    } else {\n      this.importExportState.setImportExportType(ImportExportType.layer);\n    }\n  }\n\n  private selectMode() {\n    const userSelectedMode = this.importExportState.selectedMode$.value;\n    if (userSelectedMode !== undefined) {\n      this.importExportState.setMode(userSelectedMode);\n    } else {\n      this.importExportState.setMode(ImportExportMode.import);\n    }\n  }\n\n  public modeChanged(mode: ImportExportMode) {\n    this.importExportState.setMode(mode);\n  }\n\n  public exportOptionsChange(exportOptions: ExportOptions) {\n    this.importExportState.setsExportOptions(exportOptions);\n  }\n\n  importExportTypeChange(event) {\n    this.importExportType = event.value;\n  }\n}\n","<div class=\"advanced-coordinates__coordinates-container\">\n  <div class=\"advanced-coordinates__coordinates-container__inner\">\n    <mat-form-field *ngIf=\"units; else elseBlock\" subscriptSizing=\"dynamic\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lon' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lon'\n            | translate\n        \"\n        [value]=\"coordinates[0]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock>\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.est'\n              | translate\n          \"\n          [value]=\"coordinates[0]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n\n    <mat-form-field *ngIf=\"units; else elseBlock2\" subscriptSizing=\"dynamic\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lat' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lat'\n            | translate\n        \"\n        [value]=\"coordinates[1]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock2>\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.nord'\n              | translate\n          \"\n          [value]=\"coordinates[1]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n    <button\n      mat-icon-button\n      [attr.aria-label]=\"\n        'igo.integration.advanced-map-tool.advanced-coordinates.copy'\n          | translate\n      \"\n      class=\"igo-form-button-group advanced-coordinates__copy-coordinates\"\n      (click)=\"copyTextToClipboard()\"\n    >\n      <mat-icon>content_copy</mat-icon>\n    </button>\n  </div>\n\n  <form class=\"igo-form advanced-coordinates__form\" [formGroup]=\"form\">\n    <div class=\"advanced-coordinates__coordinates-container__inner\">\n      <mat-form-field class=\"igo-input-container\" subscriptSizing=\"dynamic\">\n        <mat-label>{{\n          'igo.integration.advanced-map-tool.advanced-coordinates.coordSystem'\n            | translate\n        }}</mat-label>\n        <mat-select [(value)]=\"inputProj\">\n          <mat-option\n            matTooltipShowDelay=\"500\"\n            *ngFor=\"let projection of projections$ | async\"\n            [value]=\"projection\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            {{ projection.translatedValue || projection.alias }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n    <div class=\"advanced-coordinates__coordinates-container__inner\">\n      <mat-slide-toggle\n        class=\"center-toggle mat-typography\"\n        [checked]=\"center\"\n        [labelPosition]=\"'before'\"\n        (change)=\"displayCenter($event.checked)\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-coordinates.center'\n            | translate\n        }}\n      </mat-slide-toggle>\n    </div>\n  </form>\n\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.zoom' | translate\n    }}\n    {{ map.viewController.getZoom() }}\n  </p>\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.scale' | translate\n    }}\n    {{ formattedScale$ | async }}\n  </p>\n  <p class=\"igo-zoom mat-typography\">\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.resolution'\n        | translate\n    }}\n    {{ map.viewController.getResolution() | number: '1.0-0' }}\n  </p>\n</div>\n","import { AsyncPipe, DecimalPipe, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { ConfigService } from '@igo2/core/config';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { StorageScope, StorageService } from '@igo2/core/storage';\nimport {\n  IgoMap,\n  InputProjections,\n  ProjectionsLimitationsOptions,\n  formatScale\n} from '@igo2/geo';\nimport { computeProjectionsConstraints, zoneMtm, zoneUtm } from '@igo2/geo';\nimport { Clipboard } from '@igo2/utils';\n\nimport * as olproj from 'ol/proj';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapState } from '../../map.state';\n\n/**\n * Tool to display the coordinates and a cursor of the center of the map\n */\n@Component({\n  selector: 'igo-advanced-coordinates',\n  templateUrl: './advanced-coordinates.component.html',\n  styleUrls: ['./advanced-coordinates.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatSelectModule,\n    NgFor,\n    MatOptionModule,\n    MatSlideToggleModule,\n    AsyncPipe,\n    DecimalPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AdvancedCoordinatesComponent implements OnInit, OnDestroy {\n  public formattedScale$: BehaviorSubject<string> = new BehaviorSubject('');\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  public form: UntypedFormGroup;\n  public coordinates: string[];\n  private currentCenterDefaultProj: [number, number];\n  public center: boolean;\n  private inMtmZone: boolean = true;\n  private inLambert2 = { 32198: true, 3798: true };\n  private mapState$$: Subscription;\n  private formStatus$$: Subscription;\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n  private defaultProj: InputProjections;\n  private currentZones = { utm: undefined, mtm: undefined };\n  public units: boolean = true;\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get inputProj(): InputProjections {\n    return this.form.get('inputProj').value;\n  }\n  set inputProj(value: InputProjections) {\n    this.form.patchValue({ inputProj: value });\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private config: ConfigService,\n    private formBuilder: UntypedFormBuilder\n  ) {\n    this.defaultProj = {\n      translatedValue: this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.wgs84',\n        { code: 'EPSG:4326' }\n      ),\n      translateKey: 'wgs84',\n      alias: 'WGS84',\n      code: 'EPSG:4326',\n      zone: '',\n      def: undefined,\n      extent: undefined\n    };\n    this.center = this.storageService.get('centerToggle') as boolean;\n    this.computeProjections();\n    this.buildForm();\n  }\n\n  /**\n   * Listen a state of the map, a state of a form, update the coordinates\n   */\n  ngOnInit(): void {\n    this.mapState$$ = this.map.viewController.state$\n      .pipe(debounceTime(50))\n      .subscribe(() => {\n        this.setScaleValue(this.map);\n        this.updateCoordinates();\n      });\n\n    this.formStatus$$ = this.form.valueChanges.subscribe(() => {\n      this.updateCoordinates();\n    });\n\n    const tempInputProj = this.storageService.get(\n      'currentProjection'\n    ) as InputProjections;\n\n    this.inputProj =\n      this.projections$.value.find(\n        (val) => val.code === this.defaultProj.code\n      ) ?? this.projections$.value[0];\n\n    if (tempInputProj !== null) {\n      const pos = this.positionInList(tempInputProj);\n      this.inputProj = this.projections$.value[pos];\n      this.updateZoneMtmUtm();\n    }\n    this.map.mapCenter$.next(this.center);\n    this.coordinates = this.getCoordinates();\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\n      this.defaultProj.code\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.map.mapCenter$.next(false);\n    this.mapState$$.unsubscribe();\n    this.formStatus$$.unsubscribe();\n  }\n\n  setScaleValue(map: IgoMap) {\n    this.formattedScale$.next(\n      ': ~ 1 / ' + formatScale(map.viewController.getScale())\n    );\n  }\n  /**\n   * Coordinates of the center of the map on the appropriate systeme of coordinates\n   * @returns Array of two numbers\n   */\n  getCoordinates(): string[] {\n    this.currentZones.mtm = zoneMtm(this.currentCenterDefaultProj[0]);\n    this.currentZones.utm = zoneUtm(this.currentCenterDefaultProj[0]);\n    let coord;\n    const code = this.inputProj.code;\n    let decimal = 2;\n    if (code.includes('EPSG:4326') || code.includes('EPSG:4269')) {\n      decimal = 5;\n    }\n    this.units = code === 'EPSG:4326' || code === 'EPSG:4269';\n    coord = this.map.viewController\n      .getCenter(code)\n      .map((c) => c.toFixed(decimal));\n    return coord;\n  }\n\n  updateCoordinates() {\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\n      this.defaultProj.code\n    );\n    const currentMtmZone = zoneMtm(this.currentCenterDefaultProj[0]);\n    const currentUtmZone = zoneUtm(this.currentCenterDefaultProj[0]);\n    if (!this.inMtmZone && currentMtmZone !== this.currentZones.mtm) {\n      this.back2quebec();\n    }\n    let zoneChange = false;\n    if (currentMtmZone !== this.currentZones.mtm) {\n      this.currentZones.mtm = currentMtmZone;\n      zoneChange = true;\n    }\n    if (currentUtmZone !== this.currentZones.utm) {\n      this.currentZones.utm = currentUtmZone;\n      zoneChange = true;\n    }\n    if (zoneChange) {\n      this.updateProjectionsZoneChange();\n    }\n    this.checkLambert(this.currentCenterDefaultProj);\n    this.coordinates = this.getCoordinates();\n\n    this.storageService.set(\n      'currentProjection',\n      this.inputProj,\n      StorageScope.SESSION\n    );\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(this.coordinates.toString());\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyMsg',\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyTitle'\n      );\n    }\n  }\n\n  /**\n   * Display a cursor on the center of the map\n   */\n  displayCenter(toggle: boolean): void {\n    this.center = toggle;\n    this.map.mapCenter$.next(toggle);\n    this.storageService.set('centerToggle', toggle, StorageScope.SESSION);\n  }\n\n  /**\n   * Builder of the form\n   */\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Update list of projections after changing of the state of the map\n   */\n  private updateProjectionsZoneChange(): void {\n    let modifiedProj = this.projections$.value;\n    const translate = this.languageService.translate;\n    modifiedProj.map((p) => {\n      if (p.translateKey === 'mtm') {\n        const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n        if (zone) {\n          const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n          p.alias = `MTM ${zone}`;\n          p.code = code;\n          p.zone = `${zone}`;\n          p.translatedValue = translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            p\n          );\n        } else {\n          p.alias = '';\n          this.inMtmZone = false;\n          if (this.inputProj.translateKey === 'mtm') {\n            this.inputProj = this.projections$.value[0];\n          }\n        }\n      }\n      if (p.translateKey === 'utm') {\n        const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n        const code = `EPSG:326${zone}`;\n        p.alias = `UTM ${zone}`;\n        p.code = code;\n        p.zone = `${zone}`;\n        p.translatedValue = translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          p\n        );\n      }\n    });\n    modifiedProj = modifiedProj.filter((p) => p.alias !== '');\n    this.projections$.next(modifiedProj);\n  }\n\n  /**\n   * Create a list of currents projections\n   */\n  private computeProjections(): void {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (!this.currentCenterDefaultProj) {\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\n        this.defaultProj.code\n      );\n    }\n\n    const translate = this.languageService.translate;\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.wgs84',\n          { code: 'EPSG:4326' }\n        ),\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.nad83',\n          { code: 'EPSG:4269' }\n        ),\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.webMercator',\n          { code: 'EPSG:3857' }\n        ),\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: '',\n        def: undefined,\n        extent: undefined\n      });\n    }\n    if (this.projectionsConstraints.mtm) {\n      // Quebec\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      if (zone) {\n        this.inMtmZone = true;\n        const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n        projections.splice(3, 0, {\n          translatedValue: this.languageService.translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            { code, zone }\n          ),\n          translateKey: 'mtm',\n          alias: `MTM ${zone}`,\n          code,\n          zone: `${zone}`,\n          def: undefined,\n          extent: undefined\n        });\n      } else {\n        this.inMtmZone = false;\n      }\n    }\n    if (this.projectionsConstraints.utm) {\n      const order = this.inMtmZone ? 4 : 3;\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      projections.splice(order, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          { code, zone }\n        ),\n        translateKey: 'utm',\n        alias: `UTM ${zone}`,\n        code,\n        zone: `${zone}`,\n        def: undefined,\n        extent: undefined\n      });\n    }\n    let configProjection: InputProjections[] = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = (this.config.getConfig('projections') ||\n        []) as InputProjections[];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  /**\n   * Push the MTM in the array of systeme of coordinates\n   * @param projections Array of the InputProjections\n   */\n  private pushMtm(projections: Array<InputProjections>): void {\n    if (this.projectionsConstraints.mtm) {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      projections.splice(3, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.mtm',\n          { code, zone }\n        ),\n        translateKey: 'mtm',\n        alias: `MTM ${zone}`,\n        code,\n        zone: `${zone}`,\n        def: undefined,\n        extent: undefined\n      });\n    }\n  }\n\n  /**\n   * Updates the list of systems of coordinates for territory of Quebec\n   * push MTM and UTM in the Array\n   */\n  private back2quebec(): void {\n    const projections = this.projections$.value;\n    this.pushMtm(projections);\n    this.inMtmZone = true;\n  }\n\n  /**\n   * Update the numbers of the zones when application is restarted\n   */\n  private updateZoneMtmUtm() {\n    if (this.inputProj.translateKey === 'mtm') {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `MTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.mtm',\n        { code, zone }\n      );\n    }\n    if (this.inputProj.translateKey === 'utm') {\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `UTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.utm',\n        { code, zone }\n      );\n    }\n  }\n\n  /**\n   * Compute the position of a current projection in a list. 0 if the projection is not in the list\n   * @param translateKey string, translate key of a projection\n   * @returns numeric, position of an element in the array\n   */\n  positionInList(tempInputProj: InputProjections): number {\n    const tk = tempInputProj.translateKey;\n    const alias = tempInputProj.alias;\n    let position; // = undefined;\n    let iter = 0;\n    this.projections$.value.map((projection) => {\n      if (tk) {\n        if (tk === projection.translateKey) {\n          position = iter;\n        }\n      } else if (alias === projection.alias) {\n        position = iter;\n      }\n      iter++;\n    });\n    position = position ? position : 0;\n    return position;\n  }\n\n  /**\n   * Change the list of projections depending on the projections of Lambert\n   * @param coordinates An array of numbers, longitude and latitude\n   */\n  checkLambert(coordinates: [number, number]) {\n    const lambertProjections = this.config.getConfig('projections') || [];\n    lambertProjections.forEach((projection) => {\n      let modifiedProj = this.projections$.value;\n      const extent = projection.extent;\n      const code = projection.code.match(/\\d+/);\n      const currentExtentWGS = olproj.transformExtent(\n        extent,\n        projection.code,\n        this.defaultProj.code\n      );\n      if (\n        coordinates[0] < currentExtentWGS[0] ||\n        coordinates[0] > currentExtentWGS[2] ||\n        coordinates[1] < currentExtentWGS[1] ||\n        coordinates[1] > currentExtentWGS[3]\n      ) {\n        this.inLambert2[code] = false;\n        if (this.inputProj.alias === projection.alias) {\n          this.inputProj = this.projections$.value[0];\n        }\n        modifiedProj = modifiedProj.filter((p) => p.alias !== projection.alias);\n        this.projections$.next(modifiedProj);\n      } else {\n        if (!this.inLambert2[code]) {\n          this.projections$.next(modifiedProj.concat(projection));\n          this.inLambert2[code] = true;\n        }\n      }\n    });\n  }\n}\n","<div\n  *ngIf=\"userControlledLayerList.length; else noLayersBlock\"\n  class=\"igo-swipe-select-container\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-swipe.swipe-select'\n          | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.integration.advanced-map-tool.advanced-swipe.selectAll'\n              | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          (click)=\"applyNewLayers(e)\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n    <mat-slide-toggle\n      class=\"swipe-toggle mat-typography\"\n      [checked]=\"swipe\"\n      [labelPosition]=\"'before'\"\n      (change)=\"startSwipe($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.swipe' | translate }}\n    </mat-slide-toggle>\n  </form>\n</div>\n\n<ng-template #noLayersBlock>\n  <mat-list>\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.empty' | translate }}\n    </p>\n    <p class=\"map-empty mat-typography\">\n      {{\n        'igo.integration.advanced-map-tool.advanced-swipe.customize' | translate\n      }}\n    </p>\n    <mat-list-item>\n      <mat-icon matListItemIcon>search</mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.search-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <igo-icon matListItemIcon [icon]=\"layerPlusIcon\"></igo-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.catalog-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon>star</mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.context-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { NgFor, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport {\n  FormsModule,\n  ReactiveFormsModule,\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoIconComponent, LAYER_PLUS_ICON } from '@igo2/common/icon';\nimport { ContextService, DetailedContext } from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { IgoMap, Layer, VectorLayer } from '@igo2/geo';\n\nimport { ToolState } from '../../../tool/tool.state';\nimport { MapState } from '../../map.state';\n\n@Component({\n  selector: 'igo-advanced-swipe',\n  templateUrl: './advanced-swipe.component.html',\n  styleUrls: ['./advanced-swipe.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatDividerModule,\n    NgFor,\n    MatSlideToggleModule,\n    MatListModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoIconComponent\n  ]\n})\nexport class AdvancedSwipeComponent implements OnInit, OnDestroy {\n  public swipe: boolean = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public res: DetailedContext;\n  public listForSwipe: Layer[];\n\n  layerPlusIcon = LAYER_PLUS_ICON;\n\n  /**\n   * Get an active map state\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private contextService: ContextService,\n    private formBuilder: UntypedFormBuilder,\n    private toolState: ToolState\n  ) {\n    this.buildForm();\n  }\n\n  /**\n   * Get the list of layers for swipe\n   * @internal\n   */\n  ngOnInit() {\n    this.map.layers$.subscribe(\n      (ll) =>\n        (this.userControlledLayerList = ll.filter(\n          (layer) =>\n            !layer.baseLayer && layer.showInLayerList && layer.displayed\n        ))\n    );\n  }\n\n  /**\n   * Desactivate the swipe\n   * @internal\n   */\n  ngOnDestroy() {\n    this.swipe = false;\n    this.map.swipeEnabled$.next(this.swipe);\n  }\n\n  /**\n   * Build a form for choise of the layers\n   */\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Activate the swipe, send a list of layers for a swipe-tool\n   */\n  startSwipe(toggle: boolean) {\n    this.swipe = toggle;\n    this.map.swipeEnabled$.next(toggle);\n    this.listForSwipe = [];\n    for (const layer of this.form.value.layers) {\n      this.listForSwipe.push(layer);\n    }\n    this.map.selectedFeatures$.next(this.listForSwipe);\n  }\n\n  /**\n   * Restart a swipe for a new layers-list\n   */\n  applyNewLayers(e) {\n    this.startSwipe(false); // l'approche KISS\n    this.startSwipe(true);\n    if (e._selected) {\n      e._selected = false;\n    }\n    const allLayers = this.userControlledLayerList.length;\n    const selectedLayers = this.form.controls.layers.value.length;\n    if (selectedLayers === allLayers) {\n      e._selected = true;\n    }\n  }\n\n  /**\n   * Select all list of layers and restart a tool\n   */\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    } else {\n      this.form.controls.layers.setValue([]);\n    }\n    this.startSwipe(false);\n    this.startSwipe(true);\n  }\n\n  /**\n   * Open search tool\n   */\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  /**\n   * Open catalog\n   */\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  /**\n   * Open context manager\n   */\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","import { AsyncPipe } from '@angular/common';\nimport { Component } from '@angular/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\n\nimport { MapState } from '../map.state';\nimport { AdvancedCoordinatesComponent } from './advanced-coordinates/advanced-coordinates.component';\nimport { AdvancedSwipeComponent } from './advanced-swipe/advanced-swipe.component';\n\n@ToolComponent({\n  name: 'advancedMap',\n  title: 'igo.integration.tools.advancedMap',\n  icon: 'home_repair_service'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-advanced-map-tool',\n  templateUrl: './advanced-map-tool.component.html',\n  styleUrls: ['./advanced-map-tool.component.scss'],\n  standalone: true,\n  imports: [\n    AdvancedSwipeComponent,\n    MatDividerModule,\n    AdvancedCoordinatesComponent,\n    MatSlideToggleModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class AdvancedMapToolComponent {\n  get tracking$() {\n    return this.mapState.map.geolocationController.tracking$;\n  }\n  get followPosition$() {\n    return this.mapState.map.geolocationController.followPosition$;\n  }\n\n  constructor(public mapState: MapState) {}\n\n  toggleTracking(value) {\n    this.mapState.map.geolocationController.tracking = value;\n  }\n\n  toggleFollow(value) {\n    this.mapState.map.geolocationController.followPosition = value;\n  }\n}\n","<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-swipe.swipe-tool' | translate\n  }}\n</h4>\n<igo-advanced-swipe></igo-advanced-swipe>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.coordinates'\n      | translate\n  }}\n</h4>\n<igo-advanced-coordinates></igo-advanced-coordinates>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n\n<h4 class=\"nameOfTool\">\n  {{ 'igo.integration.advanced-map-tool.geolocation.title' | translate }}\n</h4>\n\n<div class=\"igo-input-container\">\n  <div class=\"geolocation-slide-toggle-container\">\n    <mat-slide-toggle\n      class=\"geolocation-option\"\n      [checked]=\"tracking$ | async\"\n      [labelPosition]=\"'before'\"\n      (change)=\"toggleTracking($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.tracking' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      class=\"geolocation-option\"\n      [disabled]=\"(tracking$ | async) !== true\"\n      [labelPosition]=\"'before'\"\n      [checked]=\"followPosition$ | async\"\n      (change)=\"toggleFollow($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.follow' | translate }}\n    </mat-slide-toggle>\n  </div>\n</div>\n","<button\n  *ngIf=\"hasWorkspace$ | async\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.integration.workspace.toggleWorkspace' | translate\"\n  [color]=\"color\"\n  (click)=\"activateWorkspace()\"\n>\n  <mat-icon>table</mat-icon>\n</button>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport type { Layer } from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription, combineLatest } from 'rxjs';\n\nimport { WorkspaceState } from '../workspace.state';\n\n@Component({\n  selector: 'igo-workspace-button',\n  templateUrl: './workspace-button.component.html',\n  styleUrls: ['./workspace-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    MatButtonModule,\n    MatTooltipModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class WorkspaceButtonComponent implements OnInit, OnDestroy {\n  public hasWorkspace$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private hasWorkspace$$: Subscription;\n\n  private _layer: Layer;\n  private layer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n  @Input()\n  set layer(value: Layer) {\n    this._layer = value;\n    this.layer$.next(this._layer);\n  }\n\n  get layer(): Layer {\n    return this._layer;\n  }\n\n  @Input() color: string = 'primary';\n\n  constructor(private workspaceState: WorkspaceState) {}\n\n  ngOnInit(): void {\n    this.hasWorkspace$$ = combineLatest([\n      this.workspaceState.workspaceEnabled$,\n      this.layer$\n    ]).subscribe((bunch) =>\n      this.hasWorkspace$.next(bunch[0] && bunch[1]?.options.workspace?.enabled)\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.hasWorkspace$$.unsubscribe();\n  }\n\n  activateWorkspace() {\n    if (\n      this.workspaceState.workspace$.value &&\n      (this.workspaceState.workspace$.value as any).layer.id ===\n        this.layer.id &&\n      this.workspaceState.workspacePanelExpanded\n    ) {\n      this.workspaceState.workspacePanelExpanded = false;\n    } else {\n      this.workspaceState.workspacePanelExpanded = true;\n      this.workspaceState.setActiveWorkspaceById(this.layer.id);\n    }\n  }\n}\n","<igo-layer-list\n  class=\"mapDetailsList\"\n  *ngIf=\"(layers$ | async).length; else empty\"\n  [map]=\"map\"\n  igoLayerListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n  [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n  [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [queryBadge]=\"queryBadge\"\n>\n  <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n    <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n    <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n    <igo-export-button\n      [layer]=\"layer\"\n      (click)=\"activateExport(layer)\"\n    ></igo-export-button>\n    <igo-ogc-filter-button\n      [header]=\"ogcButton\"\n      [layer]=\"layer\"\n    ></igo-ogc-filter-button>\n    <igo-time-filter-button\n      [header]=\"timeButton\"\n      [layer]=\"layer\"\n    ></igo-time-filter-button>\n    <igo-track-feature-button\n      [trackFeature]=\"true\"\n      [layer]=\"layer\"\n    ></igo-track-feature-button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n  </ng-template>\n</igo-layer-list>\n\n<ng-template #empty>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path>\n        </svg>\n      </mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path>\n        </svg>\n      </mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path>\n        </svg>\n      </mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  SearchSourceService,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { WorkspaceButtonComponent } from '../../workspace';\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\n\n@ToolComponent({\n  name: 'mapDetails',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-details-tool',\n  templateUrl: './map-details-tool.component.html',\n  styleUrls: ['./map-details-tool.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerListComponent,\n    LayerListBindingDirective,\n    WorkspaceButtonComponent,\n    ExportButtonComponent,\n    OgcFilterButtonComponent,\n    TimeFilterButtonComponent,\n    TrackFeatureButtonComponent,\n    MetadataButtonComponent,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapDetailsToolComponent implements OnInit {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layers$(): Observable<Layer[]> {\n    return this.map.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) =>\n            layer.showInLayerList !== false &&\n            (!this.excludeBaseLayers || !layer.baseLayer)\n        )\n      )\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","<igo-layer-legend-list\n  *ngIf=\"showAllLegend()\"\n  igoLayerLegendListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [allowShowAllLegends]=\"allowShowAllLegends\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n  (allLegendsShown)=\"onShowAllLegends($event)\"\n>\n</igo-layer-legend-list>\n<ng-template\n  *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n></ng-template>\n\n<p\n  class=\"map-empty mat-typography\"\n  *ngIf=\"\n    !allowShowAllLegends &&\n    (layers$ | async).length !== 0 &&\n    (visibleOrInRangeLayers$ | async).length === 0\n  \"\n>\n  {{\n    (visibleLayers$ | async).length\n      ? ('igo.integration.mapTool.noLayersInRange' | translate)\n      : ('igo.integration.mapTool.noLayersVisible' | translate)\n  }}\n</p>\n\n<ng-template #emptyLayers>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  IgoMap,\n  Layer,\n  LayerLegendListBindingDirective,\n  LayerLegendListComponent,\n  LayerListControlsOptions,\n  SearchSourceService,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport {\n  BehaviorSubject,\n  Observable,\n  ReplaySubject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\n\n@ToolComponent({\n  name: 'mapLegend',\n  title: 'igo.integration.tools.legend',\n  icon: 'format_list_bulleted'\n})\n@Component({\n  selector: 'igo-map-legend-tool',\n  templateUrl: './map-legend-tool.component.html',\n  styleUrls: ['./map-legend-tool.component.scss'],\n  standalone: true,\n  imports: [\n    NgIf,\n    LayerLegendListComponent,\n    LayerLegendListBindingDirective,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapLegendToolComponent implements OnInit, OnDestroy {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  change$ = new ReplaySubject<void>(1);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  FEATURE,\n  Feature,\n  FeatureStore,\n  IgoMap,\n  Layer,\n  MapGeolocationState,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  featureFromOl,\n  measureOlGeometryLength,\n  roundCoordTo\n} from '@igo2/geo';\nimport { uuid } from '@igo2/utils';\n\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Geometry from 'ol/geom/Geometry';\nimport olLineString from 'ol/geom/LineString';\nimport olLayerVector from 'ol/layer/Vector';\nimport * as olProj from 'ol/proj';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { BehaviorSubject, Subscription, combineLatest, interval } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapProximityState {\n  private defaultProximityRadiusValue: number = 30;\n\n  public enabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n  public proximityRadiusValue$: BehaviorSubject<number>;\n  public proximitylocationType$: BehaviorSubject<string> =\n    new BehaviorSubject<string>('geolocation');\n  public proximityFeatureStore: FeatureStore<Feature>;\n  private subs$$: Subscription[] = [];\n  public currentPositionCoordinate$: BehaviorSubject<[number, number]> =\n    new BehaviorSubject(undefined);\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private storageService: StorageService\n  ) {\n    this.proximityFeatureStore = new FeatureStore<Feature>([], {\n      map: this.mapState.map\n    });\n\n    this.proximityRadiusValue$ = new BehaviorSubject<number>(\n      (this.storageService.get('mapProximityRadius') as number) ||\n        this.defaultProximityRadiusValue\n    );\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.subscribeProximityMonitor();\n    });\n  }\n\n  subscribeProximityMonitor() {\n    this.subs$$.push(\n      combineLatest([\n        this.enabled$,\n        this.proximitylocationType$,\n        this.proximityRadiusValue$,\n        interval(5000),\n        this.map.geolocationController.position$\n      ])\n        .pipe(debounceTime(750))\n        .subscribe(\n          (bunch: [boolean, string, number, number, MapGeolocationState]) => {\n            this.proximityFeatureStore.clear();\n            const enabled = bunch[0];\n            const layers = this.map.layers;\n            const currentPos = this.map.geolocationController.position$.value;\n            const locationType = bunch[1];\n            const proximityRadiusValue = bunch[2];\n            this.storageService.set(\n              'mapProximityRadius',\n              proximityRadiusValue || this.defaultProximityRadiusValue\n            );\n\n            if (!enabled) {\n              return;\n            }\n\n            let coord: number[];\n            if (locationType === 'geolocation') {\n              if (!currentPos || !currentPos.position) {\n                return;\n              }\n\n              coord = olProj.transform(\n                currentPos.position,\n                currentPos.projection,\n                this.map.projection\n              );\n              this.map.mapCenter$.next(false);\n            } else {\n              coord = this.map.viewController.getCenter();\n              this.map.mapCenter$.next(true);\n            }\n\n            const coordLonLat = olProj.transform(\n              coord,\n              this.map.projection,\n              'EPSG:4269'\n            );\n            const roundedCoordLonLat = roundCoordTo(\n              coordLonLat as [number, number],\n              6\n            );\n            this.currentPositionCoordinate$.next(roundedCoordLonLat);\n\n            const layersToMonitor = layers.filter(\n              (layer) =>\n                layer.ol instanceof olLayerVector &&\n                (layer.dataSource as QueryableDataSource).options.queryable &&\n                layer.visible &&\n                layer.isInResolutionsRange\n            );\n\n            layersToMonitor.map((layerToMonitor) => {\n              const layerSource =\n                layerToMonitor.ol.getSource() as olVectorSource;\n\n              // Mostly for polygon features.\n              const olFeaturesAtCoordinate =\n                layerSource.getFeaturesAtCoordinate(coord);\n              if (olFeaturesAtCoordinate && olFeaturesAtCoordinate.length) {\n                olFeaturesAtCoordinate.map((olFeatureAtCoordinate) => {\n                  const featureAtThisPosition = featureFromOl(\n                    olFeatureAtCoordinate,\n                    this.map.projection\n                  );\n                  let title = this.getQueryTitle(\n                    featureAtThisPosition,\n                    layerToMonitor\n                  );\n                  // todo handle imported layers without querytitle? prompt title or detect first column?\n                  this.addFeatureToStore(\n                    layerToMonitor,\n                    coord,\n                    featureAtThisPosition,\n                    title,\n                    0\n                  );\n                });\n              } else {\n                // compute proximity for remaining sources\n                const closestOlFeature =\n                  layerSource.getClosestFeatureToCoordinate(coord);\n                if (closestOlFeature) {\n                  const closestOlGeom = closestOlFeature.getGeometry();\n                  const closestFeature = featureFromOl(\n                    closestOlFeature,\n                    this.map.projection\n                  );\n                  const geometryClosestPoint =\n                    closestOlGeom.getClosestPoint(coord);\n                  const linebetween = new olLineString([\n                    coord,\n                    geometryClosestPoint\n                  ]);\n                  const lineLength = measureOlGeometryLength(\n                    linebetween,\n                    'EPSG:3857'\n                  );\n                  if (lineLength <= proximityRadiusValue) {\n                    let title = this.getQueryTitle(\n                      closestFeature,\n                      layerToMonitor\n                    );\n                    // todo handle imported layers without querytitle? prompt title or detect first column?\n                    this.addFeatureToStore(\n                      layerToMonitor,\n                      coord,\n                      closestFeature,\n                      title,\n                      lineLength\n                    );\n                  }\n                }\n              }\n            });\n          }\n        )\n    );\n  }\n\n  /**\n   * Add a feature with proximity properties to the store\n   * @internal\n   */\n  private addFeatureToStore(\n    layer: Layer,\n    coordFromCalculatedDistance,\n    feature: Feature,\n    title,\n    distance\n  ) {\n    const featureId = uuid();\n    const projection = this.map.ol.getView().getProjection();\n    const olGeometry = feature.ol.getGeometry() as Geometry;\n    const geometry = new GeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.proximityFeatureStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        ...feature.properties,\n        ...{\n          id: featureId,\n          element: title,\n          distance,\n          coordFromCalculatedDistance,\n          layerSrcId: layer.id,\n          layerSrcTitle: layer.title\n        }\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n    return label;\n  }\n}\n","<igo-entity-table\n  #table\n  class=\"table-compact\"\n  [store]=\"mapProximityState.proximityFeatureStore\"\n  [template]=\"tableTemplate\"\n></igo-entity-table>\n<br />\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord\"\n  class=\"coordinates\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lon' | translate\"\n    [value]=\"coord[0]\"\n  ></textarea>\n</mat-form-field>\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord2\"\n  class=\"coordinates2\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lat' | translate\"\n    [value]=\"coord2[1]\"\n  ></textarea>\n</mat-form-field>\n\n<button\n  *ngIf=\"\n    (mapProximityState.currentPositionCoordinate$ | async) &&\n    (mapProximityState.currentPositionCoordinate$ | async).length\n  \"\n  mat-icon-button\n  (click)=\"copyTextToClipboard()\"\n>\n  <mat-icon>content_copy</mat-icon>\n</button>\n<div class=\"title-container\">\n  <mat-label class=\"title mat-typography\">{{\n    'igo.integration.map-proximity-tool.method' | translate\n  }}</mat-label>\n</div>\n<div class=\"igo-input-container mat-typography\">\n  <mat-radio-group (change)=\"onLocationTypeChange($event)\">\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'geolocation'\n      \"\n      value=\"geolocation\"\n      >{{\n        'igo.integration.map-proximity-tool.geolocation' | translate\n      }}</mat-radio-button\n    >\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'mapCenter'\n      \"\n      value=\"mapCenter\"\n      >{{\n        'igo.integration.map-proximity-tool.mapCenter' | translate\n      }}</mat-radio-button\n    >\n  </mat-radio-group>\n</div>\n\n<div class=\"radius-unit\">\n  <mat-form-field class=\"radius-field\" floatLabel=\"always\">\n    <mat-label>{{\n      'igo.integration.map-proximity-tool.radiusM' | translate\n    }}</mat-label>\n    <input\n      type=\"number\"\n      pattern=\"[0-9]*\"\n      [(ngModel)]=\"maxDistance\"\n      matInput\n      placeholder=\"{{\n        'igo.integration.map-proximity-tool.radiusM' | translate\n      }}\"\n    />\n  </mat-form-field>\n</div>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatRadioChange, MatRadioModule } from '@angular/material/radio';\n\nimport { EntityTableComponent, EntityTableTemplate } from '@igo2/common/entity';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { Feature, IgoMap } from '@igo2/geo';\nimport { Clipboard, NumberUtils } from '@igo2/utils';\n\nimport { Subscription } from 'rxjs';\n\nimport { MapProximityState } from '../map-proximity.state';\nimport { MapState } from '../map.state';\n\n@ToolComponent({\n  name: 'map-proximity',\n  title: 'igo.integration.tools.closestFeature',\n  icon: 'output_circle'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-map-proximity-tool',\n  templateUrl: './map-proximity-tool.component.html',\n  styleUrls: ['./map-proximity-tool.component.scss'],\n  standalone: true,\n  imports: [\n    EntityTableComponent,\n    NgIf,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatIconModule,\n    MatRadioModule,\n    FormsModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapProximityToolComponent implements OnInit, OnDestroy {\n  private subs$$: Subscription[] = [];\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  get maxDistance() {\n    return this.mapProximityState.proximityRadiusValue$.value;\n  }\n  set maxDistance(value: number) {\n    this.mapProximityState.proximityRadiusValue$.next(value);\n  }\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n  public userDefinedMapCenter: boolean;\n  public userDefinedFollowPosition: boolean;\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    public mapState: MapState,\n    public mapProximityState: MapProximityState,\n    private languageService: LanguageService,\n    private messageService: MessageService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: false,\n      selectionCheckbox: false,\n      sort: true,\n      columns: [\n        {\n          name: 'element',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.feature'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return localFeature.properties.element;\n          }\n        },\n        {\n          name: 'distance',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.distance'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return `${NumberUtils.roundToNDecimal(\n              localFeature.properties.distance,\n              1\n            )}m`;\n          }\n        }\n      ]\n    };\n  }\n\n  ngOnInit(): void {\n    this.mapProximityState.enabled$.next(true);\n    this.userDefinedFollowPosition =\n      this.map.geolocationController.followPosition === true;\n    this.userDefinedMapCenter = this.map.mapCenter$.value === true;\n\n    this.subs$$.push(\n      this.mapProximityState.proximitylocationType$.subscribe((v) => {\n        this.map.mapCenter$.next(v !== 'geolocation');\n        if (v === 'geolocation') {\n          this.map.geolocationController.followPosition = true;\n        } else {\n          this.map.geolocationController.followPosition = false;\n        }\n      })\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.mapProximityState.enabled$.next(false);\n    this.map.mapCenter$.next(this.userDefinedMapCenter);\n    this.subs$$.map((s) => s.unsubscribe());\n    this.map.geolocationController.followPosition =\n      this.userDefinedFollowPosition;\n  }\n\n  onLocationTypeChange(e: MatRadioChange) {\n    this.mapProximityState.proximitylocationType$.next(e.value);\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(\n      this.mapProximityState.currentPositionCoordinate$?.value.toString()\n    );\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.map-proximity-tool.copyMsg',\n        'igo.integration.map-proximity-tool.copyTitle'\n      );\n    }\n  }\n}\n","<mat-tab-group>\n  <mat-tab [label]=\"'igo.integration.tools.map' | translate\">\n    <igo-layer-list\n      [map]=\"map\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [queryBadge]=\"queryBadge\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n        <igo-export-button\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-ogc-filter-button\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n        ></igo-ogc-filter-button>\n        <igo-time-filter-button\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n        ></igo-time-filter-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.contexts' | translate\">\n    <igo-context-list igoContextListBinding></igo-context-list>\n  </mat-tab>\n</mat-tab-group>\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  ContextListBindingDirective,\n  ContextListComponent\n} from '@igo2/context';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent\n} from '@igo2/geo';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceButtonComponent } from '../../workspace/workspace-button/workspace-button.component';\nimport { MapState } from './../map.state';\n\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'map',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tool',\n  templateUrl: './map-tool.component.html',\n  styleUrls: ['./map-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    LayerListComponent,\n    LayerListBindingDirective,\n    WorkspaceButtonComponent,\n    ExportButtonComponent,\n    OgcFilterButtonComponent,\n    TimeFilterButtonComponent,\n    TrackFeatureButtonComponent,\n    MetadataButtonComponent,\n    ContextListComponent,\n    ContextListBindingDirective,\n    IgoLanguageModule\n  ]\n})\nexport class MapToolComponent {\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private importExportState: ImportExportState\n  ) {}\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","<mat-tab-group\n  #tabGroup\n  [selectedIndex]=\"layerListToolState.selectedTab$ | async\"\n  (selectedTabChange)=\"tabChanged($event)\"\n>\n  <mat-tab [label]=\"'igo.integration.tools.layers' | translate\">\n    <igo-layer-list\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [queryBadge]=\"queryBadge\"\n      [map]=\"map\"\n      (appliedFilterAndSort)=\"onLayerListChange($event)\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-style-modal-layer-button\n          *ngIf=\"isStyleEditButton(layer)\"\n          [layer]=\"layer\"\n        ></igo-style-modal-layer-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-time-filter-button\n          *ngIf=\"isTimeFilterButton(layer)\"\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n          (click)=\"activateTimeFilter()\"\n        ></igo-time-filter-button>\n        <igo-ogc-filter-button\n          *ngIf=\"isOGCFilterButton(layer)\"\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n          (click)=\"activateOgcFilter()\"\n        ></igo-ogc-filter-button>\n        <igo-export-button\n          *ngIf=\"isExportButton(layer)\"\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.legend' | translate\">\n    <igo-layer-legend-list\n      *ngIf=\"showAllLegend()\"\n      igoLayerLegendListBinding\n      [allowShowAllLegends]=\"allowShowAllLegends\"\n      [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n      (allLegendsShown)=\"onShowAllLegends($event)\"\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n    >\n    </igo-layer-legend-list>\n    <ng-template\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n    ></ng-template>\n\n    <p\n      class=\"map-empty mat-typography\"\n      *ngIf=\"\n        !allowShowAllLegends &&\n        (layers$ | async).length !== 0 &&\n        (visibleOrInRangeLayers$ | async).length === 0\n      \"\n    >\n      {{\n        (visibleLayers$ | async).length\n          ? ('igo.integration.mapTool.noLayersInRange' | translate)\n          : ('igo.integration.mapTool.noLayersVisible' | translate)\n      }}\n    </p>\n  </mat-tab>\n\n  <ng-template #emptyLayers>\n    <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n      <p class=\"map-empty mat-typography\">\n        {{ 'igo.integration.mapTool.empty' | translate }}\n      </p>\n      <p\n        *ngIf=\"\n          layerAdditionAllowed &&\n          (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n        \"\n        class=\"map-empty mat-typography\"\n      >\n        {{ 'igo.integration.mapTool.customize' | translate }}\n      </p>\n\n      <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n            ></path>\n          </svg>\n        </mat-icon>\n        <span\n          matListItemTitle\n          class=\"search-tool mat-typography\"\n          (click)=\"searchEmit()\"\n        >\n          {{ 'igo.integration.mapTool.search-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n            ></path>\n          </svg>\n        </mat-icon>\n        <span\n          matListItemTitle\n          class=\"catalog-tool mat-typography\"\n          (click)=\"catalogEmit()\"\n        >\n          {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n            ></path>\n          </svg>\n        </mat-icon>\n        <span\n          matListItemTitle\n          class=\"context-tool mat-typography\"\n          (click)=\"contextEmit()\"\n        >\n          {{ 'igo.integration.mapTool.context-tool' | translate }}\n        </span>\n      </mat-list-item>\n    </mat-list>\n  </ng-template>\n</mat-tab-group>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTabChangeEvent, MatTabsModule } from '@angular/material/tabs';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  ExportButtonComponent,\n  ExportOptions,\n  IgoMap,\n  Layer,\n  LayerLegendListBindingDirective,\n  LayerLegendListComponent,\n  LayerListBindingDirective,\n  LayerListComponent,\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  MetadataButtonComponent,\n  OgcFilterButtonComponent,\n  SearchSourceService,\n  StyleModalLayerButtonComponent,\n  TimeFilterButtonComponent,\n  TrackFeatureButtonComponent,\n  VectorLayer,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceButtonComponent } from '../../workspace/workspace-button/workspace-button.component';\nimport { LayerListToolState } from '../layer-list-tool.state';\nimport { MapState } from '../map.state';\n\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'mapTools',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tools',\n  templateUrl: './map-tools.component.html',\n  styleUrls: ['./map-tools.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatTabsModule,\n    NgIf,\n    LayerListComponent,\n    LayerListBindingDirective,\n    StyleModalLayerButtonComponent,\n    MetadataButtonComponent,\n    TrackFeatureButtonComponent,\n    TimeFilterButtonComponent,\n    OgcFilterButtonComponent,\n    ExportButtonComponent,\n    WorkspaceButtonComponent,\n    LayerLegendListComponent,\n    LayerLegendListBindingDirective,\n    MatListModule,\n    MatIconModule,\n    AsyncPipe,\n    IgoLanguageModule\n  ]\n})\nexport class MapToolsComponent implements OnInit, OnDestroy {\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() selectedTabAtOpening: string;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input()\n  get layerListControls(): LayerListControlsOptions {\n    return this._layerListControls;\n  }\n  set layerListControls(value: LayerListControlsOptions) {\n    const stateOptions = this.layerListToolState.getLayerListControls();\n    const stateKeyword = stateOptions.keyword;\n    const stateOnlyVisible = stateOptions.onlyVisible;\n    const stateSortAlpha = stateOptions.sortAlpha;\n\n    value.keyword = stateKeyword !== '' ? stateKeyword : value.keyword;\n    value.onlyVisible =\n      stateOnlyVisible !== undefined ? stateOnlyVisible : value.onlyVisible;\n    value.sortAlpha =\n      stateSortAlpha !== undefined ? stateSortAlpha : value.sortAlpha;\n\n    value.onlyVisible =\n      value.onlyVisible === undefined ? false : value.onlyVisible;\n    value.sortAlpha = value.sortAlpha === undefined ? false : value.sortAlpha;\n\n    this._layerListControls = value;\n  }\n  private _layerListControls = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() queryBadge: boolean = false;\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): LayerListControlsOptions {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  @ViewChild('tabGroup', { static: true }) tabGroup;\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    public layerListToolState: LayerListToolState,\n    private toolState: ToolState,\n    public mapState: MapState,\n    private searchSourceService: SearchSourceService,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedTab();\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => (this.delayedShowEmptyMapContent = true), 250);\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  private selectedTab() {\n    const userSelectedTab = this.layerListToolState.selectedTab$.value;\n    if (userSelectedTab !== undefined) {\n      this.layerListToolState.setSelectedTab(userSelectedTab);\n    } else {\n      if (this.selectedTabAtOpening === 'legend') {\n        this.layerListToolState.setSelectedTab(1);\n      } else {\n        this.layerListToolState.setSelectedTab(0);\n      }\n    }\n  }\n\n  public tabChanged(tab: MatTabChangeEvent) {\n    this.layerListToolState.setSelectedTab(tab.index);\n    this.layers$.next(\n      this.map.layers.filter(\n        (layer) =>\n          layer.showInLayerList !== false &&\n          (!this.excludeBaseLayers || !layer.baseLayer)\n      )\n    );\n  }\n\n  onLayerListChange(appliedFilters: LayerListControlsOptions) {\n    this.layerListToolState.setKeyword(appliedFilters.keyword);\n    this.layerListToolState.setSortAlpha(appliedFilters.sortAlpha);\n    this.layerListToolState.setOnlyVisible(appliedFilters.onlyVisible);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateTimeFilter() {\n    this.toolState.toolbox.activateTool('activeTimeFilter');\n  }\n\n  activateOgcFilter() {\n    this.toolState.toolbox.activateTool('activeOgcFilter');\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  isTimeFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return this.timeButton && options.timeFilterable && options.timeFilter;\n  }\n\n  isOGCFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return (\n      this.ogcButton &&\n      options.ogcFilters &&\n      options.ogcFilters.enabled &&\n      (options.ogcFilters.pushButtons ||\n        options.ogcFilters.checkboxes ||\n        options.ogcFilters.radioButtons ||\n        options.ogcFilters.select ||\n        options.ogcFilters.autocomplete ||\n        options.ogcFilters.editable)\n    );\n  }\n\n  isExportButton(layer: Layer): boolean {\n    if (\n      (layer instanceof VectorLayer && layer.exportable === true) ||\n      (layer.dataSource.options.download &&\n        layer.dataSource.options.download.url) ||\n      (layer.options.workspace?.enabled &&\n        layer.options.workspace?.workspaceId !== layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  isStyleEditButton(layer: Layer): boolean {\n    if (layer instanceof VectorLayer) {\n      if ((layer as VectorLayer).options?.igoStyle?.editable) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { AdvancedMapToolComponent } from './advanced-map-tool/advanced-map-tool.component';\nimport { MapDetailsToolComponent } from './map-details-tool/map-details-tool.component';\nimport { MapLegendToolComponent } from './map-legend/map-legend-tool.component';\nimport { MapProximityToolComponent } from './map-proximity-tool/map-proximity-tool.component';\nimport { MapToolComponent } from './map-tool/map-tool.component';\nimport { MapToolsComponent } from './map-tools/map-tools.component';\n\n/**\n * @deprecated import the ImportExportToolComponent directly or INTEGRATION_MAP_DIRECTIVES for the set\n */\n@NgModule({\n  imports: [\n    AdvancedMapToolComponent,\n    MapProximityToolComponent,\n    MapToolComponent,\n    MapToolsComponent,\n    MapDetailsToolComponent,\n    MapLegendToolComponent\n  ],\n  exports: [\n    AdvancedMapToolComponent,\n    MapProximityToolComponent,\n    MapToolComponent,\n    MapToolsComponent,\n    MapDetailsToolComponent,\n    MapLegendToolComponent\n  ]\n})\nexport class IgoAppMapModule {\n  static forRoot(): ModuleWithProviders<IgoAppMapModule> {\n    return {\n      ngModule: IgoAppMapModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { FeatureStore, FeatureWithMeasure } from '@igo2/geo';\n\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MeasureState {\n  /**\n   * Store that holds the measures\n   */\n  public store: FeatureStore<FeatureWithMeasure>;\n\n  constructor(private mapState: MapState) {\n    this.store = new FeatureStore<FeatureWithMeasure>([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.layers$.subscribe((layers) => {\n      if (\n        layers.filter((l) => l.id?.startsWith('igo-measures-')).length === 0\n      ) {\n        this.store.deleteMany(this.store.all());\n        this.mapState.map.ol\n          .getOverlays()\n          .getArray()\n          .filter((overlay) =>\n            (overlay as any).options.className.includes('igo-map-tooltip')\n          )\n          .map((overlay) => this.mapState.map.ol.removeOverlay(overlay));\n      }\n    });\n  }\n}\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport {\n  FeatureStore,\n  FeatureWithMeasure,\n  IgoMap,\n  MeasurerComponent\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { MeasureState } from '../measure.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'measurer',\n  title: 'igo.integration.tools.measurer',\n  icon: 'square_foot'\n})\n@Component({\n  selector: 'igo-measurer-tool',\n  templateUrl: './measurer-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MeasurerComponent]\n})\nexport class MeasurerToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get store(): FeatureStore<FeatureWithMeasure> {\n    return this.measureState.store;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private measureState: MeasureState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n","import { NgModule } from '@angular/core';\n\nimport { MeasurerToolComponent } from './measurer-tool.component';\n\n/**\n * @deprecated import the MeasurerToolComponent directly\n */\n@NgModule({\n  imports: [MeasurerToolComponent],\n  exports: [MeasurerToolComponent]\n})\nexport class IgoAppMeasurerToolModule {}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common/tool';\nimport { IgoMap, PrintComponent } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'print',\n  title: 'igo.integration.tools.print',\n  icon: 'print'\n})\n@Component({\n  selector: 'igo-print-tool',\n  templateUrl: './print-tool.component.html',\n  standalone: true,\n  imports: [PrintComponent]\n})\nexport class PrintToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(private mapState: MapState) {}\n}\n","<igo-print [map]=\"map\"></igo-print>\n","import { Injectable } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityStore,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions\n} from '@igo2/common/entity';\nimport { ConfigService } from '@igo2/core/config';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  CommonVectorStyleOptions,\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureWorkspace,\n  OverlayStyleOptions,\n  SearchResult,\n  SearchSource,\n  SearchSourceService\n} from '@igo2/geo';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MapState } from '../map';\nimport { WorkspaceState } from '../workspace/workspace.state';\n\n/**\n * Define the FeatureMotion to apply when adding the SearchResult to the map as an overlay.\n */\nexport interface SearchFeatureMotion {\n  selected?: FeatureMotion;\n  focus?: FeatureMotion;\n}\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable()\nexport class SearchState {\n  public searchLayerStores: FeatureStore<Feature>[] = [];\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  /**\n   * Default feature motion are:\n   * on selection = FeatureMotion.Default and\n   * on focus = FeatureMotion.None\n   */\n  public featureMotion: SearchFeatureMotion = {\n    selected: FeatureMotion.Default,\n    focus: FeatureMotion.None\n  };\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject(\n    '|'\n  );\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private workspaceState: WorkspaceState,\n    private configService: ConfigService,\n    private mapState: MapState\n  ) {\n    const searchOverlayStyle: OverlayStyleOptions =\n      this.configService.getConfig('searchOverlayStyle');\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get(\n      'searchResultsGeometryEnabled'\n    ) as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n\n    const wksSource = this.searchSourceService\n      .getSources()\n      .find((source) => source.getId() === 'workspace');\n    if (wksSource) {\n      this.workspaceState.store.entities$.subscribe((e) => {\n        const searchableWks = e.filter(\n          (fw) =>\n            fw instanceof FeatureWorkspace &&\n            fw.layer.options.workspace.searchIndexEnabled\n        );\n        this.searchSourceService.setWorkspaces(wksSource, searchableWks);\n      });\n    }\n    this.monitorLayerDeletion();\n  }\n\n  private monitorLayerDeletion() {\n    this.mapState.map.layers$.subscribe((layers) => {\n      this.searchLayerStores.forEach((store) => {\n        let layer = layers.find((l) => l.id === store.layer.id);\n        if (!layer) {\n          const index = this.searchLayerStores.indexOf(store);\n          this.searchLayerStores.splice(index, 1);\n        }\n      });\n    });\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({\n      filterClauseFunc\n    } as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","<div\n  *ngIf=\"(!store || store.stateView.empty) && (debouncedEmpty$ | async)\"\n  style=\"margin: 10px\"\n>\n  <section class=\"mat-typography\">\n    <h4>\n      <strong>{{\n        'igo.integration.searchResultsTool.noResults' | translate\n      }}</strong>\n    </h4>\n    <p>\n      <strong>{{\n        'igo.integration.searchResultsTool.doSearch' | translate\n      }}</strong>\n    </p>\n    <div\n      [innerHTML]=\"\n        'igo.integration.searchResultsTool.examples' | translate | sanitizeHtml\n      \"\n    ></div>\n  </section>\n</div>\n\n<igo-flexible\n  *ngIf=\"(debouncedEmpty$ | async) === false\"\n  #topPanel\n  initial=\"100%\"\n  initialMobile=\"100%\"\n  collapsed=\"calc(100% - 58px)\"\n  collapsedMobile=\"calc(100% - 58px)\"\n  expanded=\"60%\"\n  expandedMobile=\"60%\"\n  [state]=\"(feature$ | async) ? topPanelState : 'initial'\"\n>\n  <div class=\"igo-content\">\n    <igo-search-results\n      [store]=\"store\"\n      [showIcons]=\"showIcons\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      [settingsChange$]=\"settingsChange$\"\n      placeholder=\"false\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultSelect($event)\"\n      (resultUnfocus)=\"onResultUnfocus($event)\"\n      (resultMouseenter)=\"onResultFocus($event)\"\n      (resultMouseleave)=\"onResultUnfocus($event)\"\n      (moreResults)=\"onSearch($event)\"\n      [map]=\"map\"\n    >\n      <ng-template #igoSearchItemToolbar let-result=\"result\">\n        <igo-search-add-button\n          [map]=\"map\"\n          [store]=\"store\"\n          [stores]=\"stores\"\n          [layer]=\"result\"\n          [saveSearchResultInLayer]=\"saveSearchResultInLayer\"\n        >\n        </igo-search-add-button>\n      </ng-template>\n    </igo-search-results>\n  </div>\n\n  <div igoFlexibleFill class=\"igo-content\">\n    <igo-panel\n      [title]=\"featureTitle\"\n      *ngIf=\"feature$ | async\"\n      (click)=\"toggleTopPanel($event)\"\n      [cursorPointer]=\"true\"\n    >\n      <button\n        mat-icon-button\n        panelLeftButton\n        class=\"igo-icon-button\"\n        (click)=\"toggleTopPanel()\"\n      >\n        <mat-icon>{{\n          (topPanelState$ | async) === 'collapsed'\n            ? 'arrow_upward'\n            : 'arrow_downward'\n        }}</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"feature.geometry\"\n        mat-icon-button\n        panelRightButton\n        class=\"igo-icon-button\"\n        [matTooltip]=\"\n          ((isSelectedResultOutOfView$ | async)\n            ? 'igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView'\n            : 'igo.integration.searchResultsTool.zoomOnFeatureTooltip'\n          ) | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"zoomToFeatureExtent()\"\n      >\n        <mat-icon\n          aria-hidden=\"false\"\n          [matBadge]=\"(isSelectedResultOutOfView$ | async) ? '!' : ''\"\n          matBadgeColor=\"accent\"\n          matBadgeSize=\"small\"\n          [matBadgeHidden]=\"(isSelectedResultOutOfView$ | async) === false\"\n          >zoom_in</mat-icon\n        >\n      </button>\n\n      <igo-feature-details\n        igoFeatureDetailsDirective\n        [feature]=\"feature$ | async\"\n        [map]=\"map\"\n        [toolbox]=\"toolState.toolbox\"\n        (routingEvent)=\"getRoute()\"\n      >\n      </igo-feature-details>\n    </igo-panel>\n  </div>\n</igo-flexible>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { SanitizeHtmlPipe } from '@igo2/common/custom-html';\nimport { EntityState, EntityStore, getEntityTitle } from '@igo2/common/entity';\nimport { FlexibleComponent, FlexibleState } from '@igo2/common/flexible';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { ConfigService } from '@igo2/core/config';\nimport { IgoLanguageModule } from '@igo2/core/language';\nimport {\n  FEATURE,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  FeatureStore,\n  IgoMap,\n  Research,\n  SearchResult,\n  SearchResultAddButtonComponent,\n  SearchResultsComponent,\n  computeOlFeaturesExtent,\n  featureFromOl,\n  featureToOl,\n  featuresAreOutOfView,\n  featuresAreTooDeepInView,\n  getCommonVectorSelectedStyle,\n  getCommonVectorStyle,\n  moveToOlFeatures,\n  roundCoordTo\n} from '@igo2/geo';\n\nimport olFeature from 'ol/Feature';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olPoint from 'ol/geom/Point';\nimport * as olProj from 'ol/proj';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\n\nimport { DirectionState } from '../../directions/directions.state';\nimport { MapState } from '../../map/map.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { SearchState } from '../search.state';\n\n/**\n * Tool to browse the search results\n */\n@ToolComponent({\n  name: 'searchResults',\n  title: 'igo.integration.tools.searchResults',\n  icon: 'search'\n})\n@Component({\n  selector: 'igo-search-results-tool',\n  templateUrl: './search-results-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    NgIf,\n    FlexibleComponent,\n    SearchResultsComponent,\n    SearchResultAddButtonComponent,\n    PanelComponent,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatBadgeModule,\n    FeatureDetailsComponent,\n    AsyncPipe,\n    IgoLanguageModule,\n    SanitizeHtmlPipe\n  ]\n})\nexport class SearchResultsToolComponent implements OnInit, OnDestroy {\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean = true;\n\n  /**\n   * Determine the top panel default state\n   */\n  @Input() topPanelStateDefault: string = 'expanded';\n\n  private hasFeatureEmphasisOnSelection: boolean = false;\n  public saveSearchResultInLayer: boolean = false;\n\n  private showResultsGeometries$$: Subscription;\n  private getRoute$$: Subscription;\n  private shownResultsGeometries: Feature[] = [];\n  private shownResultsEmphasisGeometries: Feature[] = [];\n  private focusedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n  public isSelectedResultOutOfView$ = new BehaviorSubject(false);\n  private isSelectedResultOutOfView$$: Subscription;\n  private abstractFocusedResult: Feature;\n  private abstractSelectedResult: Feature;\n\n  public debouncedEmpty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private debouncedEmpty$$: Subscription;\n\n  /**\n   * Store holding the search results\n   * @internal\n   */\n  get store(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  /**\n   * Map to display the results on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get featureTitle(): string {\n    return this.feature ? getEntityTitle(this.feature) : undefined;\n  }\n\n  get feature$(): Observable<Feature> {\n    return this.store.stateView\n      .firstBy$((e) => e.state.focused)\n      .pipe(\n        map(\n          (element) =>\n            (this.feature = element\n              ? (element.entity.data as Feature)\n              : undefined)\n        )\n      );\n  }\n\n  public feature: Feature;\n\n  public term = '';\n  private searchTerm$$: Subscription;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  public topPanelState$ = new BehaviorSubject<FlexibleState>('initial');\n  private topPanelState$$: Subscription;\n\n  @Input()\n  set topPanelState(value: FlexibleState) {\n    this.topPanelState$.next(value);\n  }\n  get topPanelState(): FlexibleState {\n    return this.topPanelState$.value;\n  }\n\n  get termSplitter(): string {\n    return this.searchState.searchTermSplitter$.value;\n  }\n\n  private format = new olFormatGeoJSON();\n\n  get stores(): FeatureStore<Feature>[] {\n    return this.searchState.searchLayerStores;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private searchState: SearchState,\n    private elRef: ElementRef,\n    public toolState: ToolState,\n    private directionState: DirectionState,\n    configService: ConfigService\n  ) {\n    this.hasFeatureEmphasisOnSelection = configService.getConfig(\n      'hasFeatureEmphasisOnSelection'\n    );\n    this.saveSearchResultInLayer = configService.getConfig(\n      'saveSearchResultInLayer'\n    );\n  }\n\n  ngOnInit() {\n    this.searchTerm$$ = this.searchState.searchTerm$.subscribe(\n      (searchTerm: string) => {\n        if (\n          searchTerm !== undefined &&\n          searchTerm !== null &&\n          searchTerm !== ''\n        ) {\n          this.term = searchTerm;\n          this.debouncedEmpty$.next(false);\n        } else if (searchTerm === '') {\n          this.debouncedEmpty$.next(true);\n        }\n      }\n    );\n\n    for (const res of this.store.stateView.all$().value) {\n      if (this.store.state.get(res.entity).selected === true) {\n        this.topPanelState = 'expanded';\n      }\n    }\n\n    this.searchState.searchSettingsChange$.subscribe(() => {\n      this.settingsChange$.next(true);\n    });\n\n    this.topPanelState$$ = this.topPanelState$.subscribe(() => {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (selected) {\n        setTimeout(() => {\n          // To be sure the flexible component has been displayed yet\n          if (!this.isScrolledIntoView(igoList, selected)) {\n            this.adjustTopPanel(igoList, selected);\n          }\n        }, FlexibleComponent.transitionTime + 50);\n      }\n    });\n\n    if (this.hasFeatureEmphasisOnSelection) {\n      if (!this.searchState.focusedOrResolution$$) {\n        this.searchState.focusedOrResolution$$ = combineLatest([\n          this.focusedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'focused')\n        );\n      }\n\n      if (!this.searchState.selectedOrResolution$$) {\n        this.searchState.selectedOrResolution$$ = combineLatest([\n          this.searchState.selectedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'selected')\n        );\n      }\n    }\n    this.monitorResultOutOfView();\n\n    this.showResultsGeometries$$ = combineLatest([\n      this.searchState.searchResultsGeometryEnabled$,\n      this.store.stateView.all$(),\n      this.focusedResult$,\n      this.searchState.selectedResult$,\n      this.searchState.searchTerm$,\n      this.map.viewController.resolution$\n    ]).subscribe(\n      (\n        bunch: [\n          boolean,\n          { entity: SearchResult; state: EntityState }[],\n          SearchResult,\n          SearchResult,\n          string,\n          number\n        ]\n      ) => {\n        const searchResultsGeometryEnabled = bunch[0];\n        const searchResults = bunch[1];\n\n        if (this.hasFeatureEmphasisOnSelection) {\n          this.clearFeatureEmphasis('shown');\n        }\n        this.shownResultsGeometries.map((result) =>\n          this.map.queryResultsOverlay.removeFeature(result)\n        );\n        const featureToHandleGeom = searchResults.filter(\n          (result) =>\n            result.entity.meta.dataType === FEATURE &&\n            result.entity.data.geometry &&\n            !result.state.selected &&\n            !result.state.focused\n        );\n\n        featureToHandleGeom.map((result) => {\n          if (searchResultsGeometryEnabled) {\n            result.entity.data.meta.style = getCommonVectorStyle(\n              Object.assign(\n                {},\n                {\n                  feature: result.entity.data as Feature | olFeature<OlGeometry>\n                },\n                this.searchState.searchOverlayStyle,\n                result.entity.style?.base ? result.entity.style.base : {}\n              )\n            );\n            this.shownResultsGeometries.push(result.entity.data as Feature);\n            this.map.queryResultsOverlay.addFeature(\n              result.entity.data as Feature,\n              FeatureMotion.None\n            );\n            if (this.hasFeatureEmphasisOnSelection) {\n              this.buildResultEmphasis(\n                result.entity as SearchResult<Feature>,\n                'shown'\n              );\n            }\n          }\n        });\n      }\n    );\n\n    this.debouncedEmpty$$ = this.store.stateView.empty$\n      .pipe(debounceTime(1500))\n      .subscribe((empty) => this.debouncedEmpty$.next(empty));\n  }\n\n  private monitorResultOutOfView() {\n    this.isSelectedResultOutOfView$$ = combineLatest([\n      this.map.viewController.state$,\n      this.searchState.selectedResult$\n    ])\n      .pipe(debounceTime(100))\n      .subscribe((bunch) => {\n        const selectedResult = bunch[1] as SearchResult<Feature>;\n        if (!selectedResult) {\n          this.isSelectedResultOutOfView$.next(false);\n          return;\n        }\n        if (selectedResult.data.geometry) {\n          const selectedOlFeature = featureToOl(\n            selectedResult.data,\n            this.map.projection\n          );\n          const selectedOlFeatureExtent = computeOlFeaturesExtent(\n            [selectedOlFeature],\n            this.map.viewController.getOlProjection()\n          );\n          this.isSelectedResultOutOfView$.next(\n            featuresAreOutOfView(this.map.getExtent(), selectedOlFeatureExtent)\n          );\n        }\n      });\n  }\n\n  private buildResultEmphasis(\n    result: SearchResult<Feature>,\n    trigger: 'selected' | 'focused' | 'shown' | undefined\n  ) {\n    if (trigger !== 'shown') {\n      this.clearFeatureEmphasis(trigger);\n    }\n    if (!result || !result.data.geometry) {\n      return;\n    }\n    const myOlFeature = featureToOl(result.data, this.map.projection);\n    const olGeometry = myOlFeature.getGeometry();\n    if (\n      featuresAreTooDeepInView(\n        this.map.viewController,\n        olGeometry.getExtent() as [number, number, number, number],\n        0.0025\n      )\n    ) {\n      const extent = olGeometry.getExtent();\n      const x = extent[0] + (extent[2] - extent[0]) / 2;\n      const y = extent[1] + (extent[3] - extent[1]) / 2;\n      const feature1 = new olFeature({\n        name: `${trigger}AbstractResult'`,\n        geometry: new olPoint([x, y])\n      });\n      const abstractResult = featureFromOl(feature1, this.map.projection);\n\n      let computedStyle;\n      let zIndexOffset = 0;\n\n      switch (trigger) {\n        case 'focused':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleFocus,\n              result.style?.focus ? result.style.focus : {}\n            )\n          );\n          zIndexOffset = 2;\n          break;\n        case 'shown':\n          computedStyle = getCommonVectorStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyle,\n              result.style?.base ? result.style.base : {}\n            )\n          );\n          break;\n        case 'selected':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleSelection,\n              result.style?.selection ? result.style.selection : {}\n            )\n          );\n          zIndexOffset = 1;\n          break;\n      }\n      abstractResult.meta.style = computedStyle;\n      abstractResult.meta.style.setZIndex(2000 + zIndexOffset);\n      this.map.searchResultsOverlay.addFeature(\n        abstractResult,\n        this.searchState.featureMotion.focus\n      );\n      if (trigger === 'focused') {\n        this.abstractFocusedResult = abstractResult;\n      }\n      if (trigger === 'selected') {\n        this.abstractSelectedResult = abstractResult;\n      }\n      if (trigger === 'shown') {\n        this.shownResultsEmphasisGeometries.push(abstractResult);\n      }\n    } else {\n      this.clearFeatureEmphasis(trigger);\n    }\n  }\n\n  private clearFeatureEmphasis(trigger: 'selected' | 'focused' | 'shown') {\n    if (trigger === 'focused' && this.abstractFocusedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult);\n      this.abstractFocusedResult = undefined;\n    }\n    if (trigger === 'selected' && this.abstractSelectedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult);\n      this.abstractSelectedResult = undefined;\n    }\n    if (trigger === 'shown') {\n      this.shownResultsEmphasisGeometries.map((shownResult) =>\n        this.map.searchResultsOverlay.removeFeature(shownResult)\n      );\n      this.shownResultsEmphasisGeometries = [];\n    }\n  }\n\n  ngOnDestroy() {\n    this.topPanelState$$.unsubscribe();\n    this.searchTerm$$.unsubscribe();\n    if (this.isSelectedResultOutOfView$$) {\n      this.isSelectedResultOutOfView$$.unsubscribe();\n    }\n    if (this.showResultsGeometries$$) {\n      this.showResultsGeometries$$.unsubscribe();\n    }\n    if (this.getRoute$$) {\n      this.getRoute$$.unsubscribe();\n    }\n    if (this.debouncedEmpty$$) {\n      this.debouncedEmpty$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.focusedResult$.next(result);\n    if (result.meta.dataType === FEATURE && result.data.geometry) {\n      result.data.meta.style = getCommonVectorSelectedStyle(\n        Object.assign(\n          {},\n          { feature: result.data as Feature | olFeature<OlGeometry> },\n          this.searchState.searchOverlayStyleFocus,\n          result.style?.focus ? result.style.focus : {}\n        )\n      );\n\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        feature.setStyle(result.data.meta.style);\n        return;\n      }\n      this.map.searchResultsOverlay.addFeature(\n        result.data as Feature,\n        this.searchState.featureMotion.focus\n      );\n    }\n  }\n\n  onResultUnfocus(result: SearchResult) {\n    this.focusedResult$.next(undefined);\n    if (result.meta.dataType !== FEATURE) {\n      return;\n    }\n\n    if (this.store.state.get(result).selected === true) {\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        const style = getCommonVectorSelectedStyle(\n          Object.assign(\n            {},\n            { feature: result.data as Feature | olFeature<OlGeometry> },\n            this.searchState.searchOverlayStyleFocus,\n            result.style?.focus ? result.style.focus : {}\n          )\n        );\n        feature.setStyle(style);\n      }\n      return;\n    }\n    this.map.searchResultsOverlay.removeFeature(result.data as Feature);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being selected\n   * @internal\n   * @param result A search result that could be a feature or some layer options\n   */\n  onResultSelect(result: SearchResult) {\n    this.map.searchResultsOverlay.dataSource.ol.clear();\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.selected);\n    this.searchState.setSelectedResult(result);\n\n    if (this.topPanelState === 'initial') {\n      if (this.topPanelStateDefault !== 'collapsed') {\n        this.topPanelState = 'expanded';\n      } else {\n        this.topPanelState = 'collapsed';\n      }\n    }\n\n    if (this.topPanelState === 'expanded') {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (!this.isScrolledIntoView(igoList, selected)) {\n        this.adjustTopPanel(igoList, selected);\n      }\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.store.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n\n    this.store.load(newResults);\n\n    for (const res of this.store.all()) {\n      if (\n        this.store.state.get(res).focused === true &&\n        this.store.state.get(res).selected !== true\n      ) {\n        this.store.state.update(res, { focused: false }, true);\n      }\n    }\n\n    setTimeout(() => {\n      const igoList = this.elRef.nativeElement.querySelector('igo-list');\n      let moreResults;\n      event.research.request.subscribe((source) => {\n        if (!source[0] || !source[0].source) {\n          moreResults = null;\n        } else if (source[0].source.getId() === 'icherche') {\n          moreResults = igoList.querySelector('.icherche .moreResults');\n        } else if (source[0].source.getId() === 'ilayer') {\n          moreResults = igoList.querySelector('.ilayer .moreResults');\n        } else if (source[0].source.getId() === 'nominatim') {\n          moreResults = igoList.querySelector('.nominatim .moreResults');\n        } else {\n          moreResults = igoList.querySelector(\n            '.' + source[0].source.getId() + ' .moreResults'\n          );\n        }\n\n        if (\n          moreResults !== null &&\n          !this.isScrolledIntoView(igoList, moreResults)\n        ) {\n          igoList.scrollTop =\n            moreResults.offsetTop +\n            moreResults.offsetHeight -\n            igoList.clientHeight;\n        }\n      });\n    }, 250);\n  }\n\n  computeElementRef() {\n    const items = document.getElementsByTagName('igo-search-results-item');\n    const igoList =\n      this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\n    let selectedItem;\n    // eslint-disable-next-line\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].className.includes('igo-list-item-selected')) {\n        selectedItem = items[i];\n      }\n    }\n    return [igoList, selectedItem];\n  }\n\n  adjustTopPanel(elemSource, elem) {\n    if (!this.isScrolledIntoView(elemSource, elem)) {\n      elemSource.scrollTop =\n        elem.offsetTop +\n        elem.children[0].offsetHeight -\n        elemSource.clientHeight;\n    }\n  }\n\n  toggleTopPanel(event?: MouseEvent) {\n    if (event && (event.target as any)?.className !== 'igo-panel-title') {\n      return;\n    } else {\n      if (this.topPanelState === 'expanded') {\n        this.topPanelState = 'collapsed';\n      } else {\n        this.topPanelState = 'expanded';\n      }\n    }\n  }\n\n  zoomToFeatureExtent() {\n    if (this.feature.geometry) {\n      const localOlFeature = this.format.readFeature(this.feature, {\n        dataProjection: this.feature.projection,\n        featureProjection: this.map.projectionCode\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [localOlFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param result A search result that could be a feature\n   * @param motion A FeatureMotion to trigger when adding the searchresult to the map search overlay\n   */\n  private tryAddFeatureToMap(\n    result: SearchResult,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    if (result.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n    const feature = (result as SearchResult<Feature>).data;\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (!feature.geometry) {\n      return;\n    }\n\n    feature.meta.style = getCommonVectorSelectedStyle(\n      Object.assign(\n        {},\n        { feature },\n        this.searchState.searchOverlayStyleSelection,\n        result.style?.selection ? result.style.selection : {}\n      )\n    );\n\n    this.map.searchResultsOverlay.addFeature(feature, motion);\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const padding = 6;\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight + padding;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  getRoute() {\n    this.toolState.toolbox.activateTool('directions');\n    this.directionState.stopsStore.clearStops();\n    setTimeout(() => {\n      let routingCoordLoaded = false;\n      if (this.getRoute$$) {\n        this.getRoute$$.unsubscribe();\n      }\n      this.getRoute$$ =\n        this.directionState.stopsStore.storeInitialized$.subscribe(\n          (init: boolean) => {\n            if (\n              this.directionState.stopsStore.storeInitialized$.value &&\n              !routingCoordLoaded\n            ) {\n              routingCoordLoaded = true;\n              const stop = this.directionState.stopsStore\n                .all()\n                .find((e) => e.position === 1);\n              let coord;\n              if (this.feature.geometry) {\n                if (this.feature.geometry.type === 'Point') {\n                  coord = [\n                    this.feature.geometry.coordinates[0],\n                    this.feature.geometry.coordinates[1]\n                  ];\n                } else {\n                  const point = pointOnFeature(this.feature.geometry);\n                  coord = [\n                    point.geometry.coordinates[0],\n                    point.geometry.coordinates[1]\n                  ];\n                }\n              }\n              stop.text = this.featureTitle;\n              stop.coordinates = coord;\n              this.directionState.stopsStore.update(stop);\n              if (this.map.geolocationController.position$.value) {\n                const currentPos =\n                  this.map.geolocationController.position$.value;\n                const stop = this.directionState.stopsStore\n                  .all()\n                  .find((e) => e.position === 0);\n                const currentCoord = olProj.transform(\n                  currentPos.position,\n                  currentPos.projection,\n                  'EPSG:4326'\n                );\n                const coord: [number, number] = roundCoordTo(\n                  [currentCoord[0], currentCoord[1]],\n                  6\n                );\n                stop.text = coord.join(',');\n                stop.coordinates = coord;\n                this.directionState.stopsStore.update(stop);\n              }\n            }\n          }\n        );\n    }, 250);\n  }\n}\n","<igo-form\n  *ngIf=\"form$ | async as form\"\n  [form]=\"form\"\n  [formData]=\"data$ | async\"\n  (submitForm)=\"onSubmit($any($event))\"\n>\n  <div *ngIf=\"form.fields.length\" class=\"form-container\">\n    <igo-form-field\n      *ngFor=\"let field of form.fields\"\n      [field]=\"field\"\n    ></igo-form-field>\n  </div>\n\n  <div formButtons class=\"actions-container\">\n    <button\n      mat-stroked-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"clearForm()\"\n    >\n      {{ 'igo.integration.dataIssueReporterTool.reset.button' | translate }}\n    </button>\n    <button\n      mat-flat-button\n      type=\"submit\"\n      color=\"primary\"\n      [disabled]=\"submitDisabled\"\n    >\n      {{ 'igo.integration.dataIssueReporterTool.submit.button' | translate }}\n    </button>\n  </div>\n</igo-form>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { Validators } from '@angular/forms';\n\nimport { Form, FormService } from '@igo2/common/form';\nimport { ToolComponent } from '@igo2/common/tool';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport { IgoMap } from '@igo2/geo';\n\nimport * as olstyle from 'ol/style';\n\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport type { Subscription } from 'rxjs';\n\nimport { MapState } from '../../map/map.state';\n\ninterface DataIssueReporterData {\n  geometry: object;\n  layer: string;\n  desc: string;\n  email: string;\n}\n\n@ToolComponent({\n  name: 'dataIssueReporter',\n  title: 'igo.integration.tools.dataIssueReporter',\n  icon: 'feedback'\n})\n@Component({\n  selector: 'igo-issue-reporter-tool',\n  templateUrl: './data-issue-reporter-tool.component.html',\n  styleUrls: ['./data-issue-reporter-tool.component.scss']\n})\nexport class DataIssueReporterToolComponent implements OnInit, OnDestroy {\n  /**\n   * Url to report the data issue. Use the Post protocol to send the form.\n   */\n  @Input() url: string;\n\n  /**\n   * Map to link to the form\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private mapState: MapState,\n    private formService: FormService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private httpClient: HttpClient\n  ) {}\n\n  ngOnInit() {\n    combineLatest([this.languageService.language$, this.map.layers$]).subscribe(\n      ([language, layers]) => {\n        const baseLayerOrShownInLayerList = layers\n          .filter((l) => l.baseLayer || l.showInLayerList)\n          .map((l) => {\n            return { value: `${l.title}-${l.id}`, title: l.title };\n          });\n        const fieldConfigs = [\n          {\n            name: 'geometry',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.geometry'\n            ),\n            type: 'geometry',\n            inputs: {\n              map: this.map,\n              geometryTypeField: true,\n              geometryType: 'Polygon',\n              drawGuideField: false,\n              drawGuide: 0,\n              drawGuidePlaceholder: this.languageService.translate.instant(\n                'igo.integration.dataIssueReporterTool.drawGuidePlaceholder'\n              ),\n              drawStyle: new olstyle.Style({\n                stroke: new olstyle.Stroke({\n                  color: [255, 0, 0, 1],\n                  width: 2\n                }),\n                fill: new olstyle.Fill({\n                  color: [255, 0, 0, 0.2]\n                }),\n                image: new olstyle.Circle({\n                  radius: 8,\n                  stroke: new olstyle.Stroke({\n                    color: [255, 0, 0, 1]\n                  }),\n                  fill: new olstyle.Fill({\n                    color: [255, 0, 0, 0.2]\n                  })\n                })\n              }),\n              overlayStyle: new olstyle.Style({\n                stroke: new olstyle.Stroke({\n                  color: [0, 255, 0, 1],\n                  width: 2\n                }),\n                fill: new olstyle.Fill({\n                  color: [0, 255, 0, 0.2]\n                }),\n                image: new olstyle.Circle({\n                  radius: 8,\n                  stroke: new olstyle.Stroke({\n                    color: [0, 255, 0, 1]\n                  }),\n                  fill: new olstyle.Fill({\n                    color: [0, 255, 0, 0.2]\n                  })\n                })\n              })\n            }\n          },\n          {\n            name: 'layer',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.layer'\n            ),\n            type: 'select',\n            options: {\n              cols: 2\n            },\n            inputs: {\n              choices: baseLayerOrShownInLayerList\n            }\n          },\n          {\n            name: 'desc',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.description'\n            ),\n            type: 'textarea',\n            options: {\n              validator: Validators.required\n            }\n          },\n          {\n            name: 'email',\n            title: this.languageService.translate.instant(\n              'igo.integration.dataIssueReporterTool.email'\n            ),\n            options: {\n              validator: Validators.email\n            }\n          }\n        ];\n\n        const fields = fieldConfigs.map((config) =>\n          this.formService.field(config)\n        );\n        const form = this.formService.form(fields, []);\n\n        this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n          this.submitDisabled = !form.control.valid;\n        });\n\n        this.form$.next(form);\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: DataIssueReporterData) {\n    const submitTitle = 'igo.integration.dataIssueReporterTool.submit.title';\n    if (!this.url) {\n      this.messageService.alert(\n        'igo.integration.dataIssueReporterTool.submit.setupMessage',\n        submitTitle\n      );\n      alert(JSON.stringify(data));\n    } else {\n      this.httpClient\n        .post<DataIssueReporterData>(this.url, data)\n        .subscribe(() => {\n          this.messageService.success(\n            'igo.integration.dataIssueReporterTool.submit.message',\n            submitTitle\n          );\n        });\n      this.clearForm();\n    }\n  }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Subscription, fromEvent } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoContextMenu]',\n  standalone: true\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('longpress', ['$event'])\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\n    let x;\n    let y;\n    if (e instanceof MouseEvent) {\n      x = e.x;\n      y = e.y;\n    } else if (e instanceof TouchEvent) {\n      x = e.touches[0].pageX;\n      y = e.touches[0].pageY;\n    }\n    if (!x || !y) {\n      return;\n    }\n\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import {\n  Directive,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\n\n/**\n * IgoLongPress trigger longpress event after a define duration.\n * This directive exist to patch the unavailable contextmenu event on iOS.\n * @param touchDuration touch duration in ms, default value is 400ms\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\n */\n@Directive({\n  selector: '[igoLongPress]',\n  standalone: true\n})\nexport class LongPressDirective {\n  private touchTimeout: any;\n  @Input() touchDuration: number = 400;\n  @Input() onlyIOS: boolean = true;\n  @Output() longpress = new EventEmitter();\n\n  constructor() {}\n\n  @HostListener('touchstart', ['$event'])\n  public touchstart(e: TouchEvent) {\n    if (e.touches.length > 1) {\n      this.touchEnd();\n      return;\n    }\n    this.touchTimeout = setTimeout(() => {\n      if (this.onlyIOS) {\n        if (userAgent.getOSName() === 'iOS') {\n          this.longpress.emit(e);\n        }\n      } else {\n        this.longpress.emit(e);\n      }\n    }, this.touchDuration);\n  }\n  @HostListener('touchmove')\n  @HostListener('touchcancel')\n  @HostListener('touchend')\n  public touchend() {\n    this.touchEnd();\n  }\n\n  private touchEnd() {\n    clearTimeout(this.touchTimeout);\n  }\n}\n","<app-doc-viewer\n  title=\"Search\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/search\" configFolder=\"environments\">\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      Pointer activated: {{ igoSearchPointerSummaryEnabled }} (F2\n      activate/deactivate the pointer location).\n    </span>\n    <igo-map-browser\n      #mapBrowser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      [igoContextMenu]=\"actionbarMenu\"\n      igoLongPress\n      igoSearchPointerSummary\n      [igoSearchPointerSummaryDelay]=\"500\"\n      [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n      (menuPosition)=\"onContextMenuOpen($event)\"\n    >\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-panel title=\"Search\">\n      <igo-search-bar\n        [term]=\"term\"\n        (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n        [searchSettings]=\"true\"\n        [store]=\"searchStore\"\n        [termSplitter]=\"termSplitter\"\n        (searchTermChange)=\"onSearchTermChange($event)\"\n        (search)=\"onSearch($event)\"\n        (clearFeature)=\"removeFeatureFromMap()\"\n        (searchSettingsChange)=\"onSearchSettingsChange()\"\n        [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n        (reverseSearchCoordsFormatStatus)=\"\n          onReverseCoordsFormatStatusChange($event)\n        \"\n      >\n      </igo-search-bar>\n\n      <igo-search-results\n        [store]=\"searchStore\"\n        [term]=\"term\"\n        [termSplitter]=\"termSplitter\"\n        placeholder=\"false\"\n        [settingsChange$]=\"settingsChange$\"\n        (resultFocus)=\"onResultFocus($any($event))\"\n        (resultSelect)=\"onResultSelect($any($event))\"\n        (moreResults)=\"onSearch($event)\"\n      >\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button [map]=\"map\" [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n      </igo-search-results>\n    </igo-panel>\n\n    <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n      <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n    </igo-panel>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"false\"\n        [horizontal]=\"true\"\n        [mode]=\"actionBarMode\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgIf } from '@angular/common';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  ActionStore,\n  ActionbarComponent,\n  ActionbarMode\n} from '@igo2/common/action';\nimport { CONTEXT_MENU_DIRECTIVES } from '@igo2/common/context-menu';\nimport { EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { MediaService } from '@igo2/core/media';\nimport { StorageService } from '@igo2/core/storage';\nimport {\n  FEATURE,\n  Feature,\n  FeatureDetailsComponent,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  IgoSearchModule,\n  LayerOptions,\n  LayerService,\n  MapBrowserComponent,\n  MapService,\n  MapViewOptions,\n  Research,\n  SEARCH_RESULTS_DIRECTIVES,\n  SearchResult,\n  ZoomButtonComponent,\n  provideSearch,\n  withIChercheSource,\n  withWorkspaceSource\n} from '@igo2/geo';\nimport { SearchState } from '@igo2/integration';\n\nimport { Coordinate } from 'ol/coordinate';\nimport { Pixel } from 'ol/pixel';\nimport * as proj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    NgIf,\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    CONTEXT_MENU_DIRECTIVES,\n    IgoSearchModule,\n    PanelComponent,\n    SEARCH_RESULTS_DIRECTIVES,\n    ActionbarComponent,\n    FeatureDetailsComponent\n  ],\n  providers: [\n    provideSearch([withIChercheSource(), withWorkspaceSource()], {\n      analytics: true\n    }),\n    SearchState\n  ]\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store: ActionStore = new ActionStore([]);\n  actionBarMode = ActionbarMode.Context;\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map: IgoMap = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true })\n  mapBrowser: ElementRef;\n\n  public lonlat: Coordinate;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n  public igoReverseSearchCoordsFormatEnabled: boolean;\n\n  constructor(\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        baseLayer: true,\n        visible: true,\n        sourceOptions: {\n          type: 'osm'\n        }\n      } satisfies LayerOptions)\n      .subscribe((layer) => this.map.addLayer(layer));\n\n    this.igoReverseSearchCoordsFormatEnabled =\n      Boolean(this.storageService.get('reverseSearchCoordsFormatEnabled')) ||\n      false;\n  }\n\n  onPointerSummaryStatusChange(value: boolean): void {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term?: string): void {\n    this.term = term;\n    this.searchState.setSearchTerm(term);\n    const termWithoutHashtag: string = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }): void {\n    const results: SearchResult[] = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults: SearchResult[] = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onReverseCoordsFormatStatusChange(value: boolean): void {\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\n    this.igoReverseSearchCoordsFormatEnabled = value;\n  }\n\n  onSearchSettingsChange(): void {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult<Feature>): void {\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.focus);\n    this.selectedFeature = result.data;\n  }\n  /**\n   * Try to add a feature to the map when it's being selected\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultSelect(result: SearchResult<Feature>): void {\n    this.tryAddFeatureToMap(result, this.searchState.featureMotion.selected);\n    this.selectedFeature = result.data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(\n    layer: SearchResult<Feature>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ): void | undefined {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures([layer.data], motion);\n  }\n\n  ngOnInit(): void {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: () => this.searchCoordinate(this.lonlat)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: () => this.openGoogleMaps(this.lonlat)\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: () => this.openGoogleStreetView(this.lonlat)\n      }\n    ]);\n  }\n\n  ngOnDestroy(): void {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap(): void {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }): void {\n    const position: Pixel = this.mapPosition(event);\n    const coord: Coordinate = this.mapService\n      .getMap()\n      .ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projectionCode;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }): Pixel {\n    const contextmenuPoint: { x: number; y: number } = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position: Pixel = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  searchCoordinate(lonlat: Coordinate): void {\n    this.searchStore.clear();\n    this.term = !this.igoReverseSearchCoordsFormatEnabled\n      ? lonlat.map((c: number) => c.toFixed(6)).join(', ')\n      : lonlat\n          .reverse()\n          .map((c: number) => c.toFixed(6))\n          .join(', ');\n  }\n\n  openGoogleMaps(lonlat: Coordinate): void {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\n  }\n\n  openGoogleStreetView(lonlat: Coordinate): void {\n    window.open(GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1]));\n  }\n}\n","<app-doc-viewer\n  title=\"Simple Map\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/simple-map\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoPointerPosition\n      [pointerPositionDelay]=\"pointerCoordDelay\"\n      (pointerPositionCoord)=\"onPointerMove($event)\"\n    >\n      <igo-info-section\n        [infoContent]=\"pointerCoord?.toString()\"\n      ></igo-info-section>\n      <div class=\"map-actions --vertical --top --right\">\n        <div class=\"spinner-spacer\"></div>\n        <igo-rotation-button\n          class=\"mat-elevation-z2\"\n          [showIfNoRotation]=\"true\"\n          [map]=\"map\"\n          color=\"primary\"\n        ></igo-rotation-button>\n      </div>\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-home-extent-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-home-extent-button>\n        <igo-wake-lock-button></igo-wake-lock-button>\n        <igo-geolocate-button\n          class=\"mat-elevation-z2\"\n          [map]=\"map\"\n          color=\"primary\"\n        >\n        </igo-geolocate-button>\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n    <p *ngIf=\"!isTouchScreen\">{{ pointerCoord }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgIf } from '@angular/common';\nimport { Component } from '@angular/core';\n\nimport { Media, MediaService } from '@igo2/core/media';\nimport {\n  DataSourceService,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, ExampleViewerComponent, MAP_DIRECTIVES, NgIf]\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord: [number, number];\n  public pointerCoordDelay: number = 0;\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media(): Media {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            visible: true,\n            baseLayer: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  onPointerMove(event: [number, number]): void {\n    this.pointerCoord = event;\n  }\n}\n","<app-doc-viewer\n  title=\"Spatial Filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/spatial-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          [map]=\"map\"\n          [view]=\"view\"\n          igoOverlay\n          igoQuery\n          [queryFeatures]=\"true\"\n        >\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel class=\"w-100\">\n            <igo-spatial-filter-type\n              [store]=\"spatialListStore\"\n              [selectedQueryType]=\"queryType\"\n              [zone]=\"zone\"\n              [layers]=\"activeLayers\"\n              (eventType)=\"getOutputType($event)\"\n              (eventQueryType)=\"getOutputQueryType($event)\"\n              (zoneChange)=\"onZoneChange($event)\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (bufferChange)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n            >\n            </igo-spatial-filter-type>\n\n            <igo-spatial-filter-item\n              [type]=\"type\"\n              [queryType]=\"queryType\"\n              [map]=\"map\"\n              [zone]=\"zone\"\n              [loading]=\"loading\"\n              [store]=\"$any(store)\"\n              [layers]=\"activeLayers\"\n              [allLayers]=\"layers\"\n              [thematicLength]=\"thematicLength\"\n              (radiusEvent)=\"buffer = $event\"\n              (bufferEvent)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n              (freehandControl)=\"freehandDrawIsActive = $event\"\n              (drawZoneEvent)=\"zone = $event\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (itemTypeChange)=\"itemType = $event\"\n              (thematicChange)=\"thematics = $event\"\n              (toggleSearch)=\"getOutputToggleSearch()\"\n              (clearButtonEvent)=\"clearMap()\"\n              (clearSearchEvent)=\"getOutputClearSearch()\"\n            >\n            </igo-spatial-filter-item>\n          </igo-panel>\n\n          <igo-panel class=\"w-100\">\n            <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n              <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n            </ng-container>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { EntityKey, EntityStore } from '@igo2/common/entity';\nimport { PanelComponent } from '@igo2/common/panel';\nimport { LanguageService } from '@igo2/core/language';\nimport { MessageService } from '@igo2/core/message';\nimport {\n  ClusterDataSource,\n  DataSourceService,\n  FEATURE_DETAILS_DIRECTIVES,\n  FILTER_DIRECTIVES,\n  Feature,\n  FeatureMotion,\n  IgoMap,\n  IgoQueryModule,\n  Layer,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  MeasureLengthUnit,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterService,\n  SpatialFilterThematic,\n  SpatialFilterType,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  featureToOl,\n  moveToOlFeatures\n} from '@igo2/geo';\n\nimport { Coordinate } from 'ol/coordinate';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport * as olstyle from 'ol/style';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport { take, takeUntil, tap } from 'rxjs/operators';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    IgoQueryModule,\n    PanelComponent,\n    FILTER_DIRECTIVES,\n    NgIf,\n    FEATURE_DETAILS_DIRECTIVES,\n    AsyncPipe\n  ]\n})\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer: number = 0;\n\n  public iterator: number = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format: olFormatGeoJSON = new olFormatGeoJSON();\n\n  public store: EntityStore = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading: boolean = false;\n\n  public thematicLength: number = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n  }\n\n  ngOnInit(): void {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType): void {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType): void {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList(): void {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch(): void {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch(): void {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap(): void {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics(): void {\n    this.loading = true;\n    let zeroResults: boolean = true;\n    let thematics: SpatialFilterThematic[];\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic: SpatialFilterThematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint: EntityKey;\n              let idLinePoly: EntityKey;\n              features.forEach((feature: Feature) => {\n                if (feature.geometry.type === SpatialFilterType.Point) {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean): void {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean): void {\n    let i: number = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index: number = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index: number = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index: number = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates: Coordinate = features[0].geometry.coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: QueryableDataSource) => {\n          const olLayer: VectorLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id: EntityKey): void {\n    let i: number = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon: string = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer: Layer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          const ol: olSourceCluster = dataSource.ol;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer: Layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer: Layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon: string): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry\n      .getNamedSvgIcon(icon)\n      .subscribe((svgObj: SVGElement) => {\n        const xmlSerializer: XMLSerializer = new XMLSerializer();\n        svgObj.setAttribute('width', '30');\n        svgObj.setAttribute('height', '30');\n        svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n        svgObj.setAttribute('stroke', 'white');\n        const svg: string = xmlSerializer.serializeToString(svgObj);\n        style = new olstyle.Style({\n          image: new olstyle.Icon({\n            src: 'data:image/svg+xml;utf8,' + svg\n          })\n        });\n      });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id: EntityKey): void {\n    let i: number = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: QueryableDataSource) => {\n          const olLayer: Layer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature: Feature) => {\n            return featureToOl(feature, this.map.projectionCode);\n          });\n          const ol = dataSource.ol as olSourceVector;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer: Layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer: Layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) satisfies string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature: Feature): void {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projectionCode\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer: Layer): void {\n    for (const activeLayer of this.activeLayers) {\n      if (activeLayer.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatGridListModule } from '@angular/material/grid-list';\n\nimport { PanelComponent } from '@igo2/common/panel';\nimport {\n  DataSourceService,\n  FILTER_DIRECTIVES,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  TimeFilterStyle,\n  TimeFilterType,\n  TimeFilterableDataSource,\n  TimeFilterableDataSourceOptions\n} from '@igo2/geo';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss'],\n  standalone: true,\n  imports: [\n    DocViewerComponent,\n    ExampleViewerComponent,\n    MatGridListModule,\n    MAP_DIRECTIVES,\n    PanelComponent,\n    FILTER_DIRECTIVES\n  ]\n})\nexport class AppTimeFilterComponent {\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            baseLayer: true,\n            visible: true,\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe((dataSource: TimeFilterableDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcles',\n            source: dataSource\n          } satisfies LayerOptions)\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Time filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/time-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <div class=\"map-actions --vertical --bottom --right\">\n            <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n          </div>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","<app-doc-viewer title=\"Workspace\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/workspace\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\" class=\"m-b-16\">\n      <div class=\"map-actions --vertical --bottom --right\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"> </igo-zoom-button>\n      </div>\n    </igo-map-browser>\n\n    <igo-workspace-selector\n      igoWorkspaceSelector\n      [store]=\"workspaceStore\"\n      [map]=\"map\"\n    >\n    </igo-workspace-selector>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-entity-table-paginator\n        *ngIf=\"$any(workspace).inResolutionRange$ | async\"\n        [store]=\"workspace.entityStore\"\n        [paginatorOptions]=\"paginatorOptions\"\n        [entitySortChange$]=\"entitySortChange$\"\n        (paginatorChange)=\"paginatorChange($event)\"\n      >\n      </igo-entity-table-paginator>\n    </ng-container>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-actionbar\n        *ngIf=\"workspace.actionStore\"\n        [store]=\"workspace.actionStore\"\n        [horizontal]=\"true\"\n        [withToggleButton]=\"true\"\n        [withTitle]=\"true\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <igo-entity-table\n        *ngIf=\"\n          workspace.entityStore &&\n          workspace.meta &&\n          workspace.meta.tableTemplate &&\n          ($any(workspace).inResolutionRange$ | async)\n        \"\n        class=\"table-compact table-centered\"\n        [paginator]=\"workspacePaginator\"\n        [scrollBehavior]=\"scrollBehavior\"\n        [store]=\"workspace.entityStore\"\n        [template]=\"workspace.meta.tableTemplate\"\n      >\n      </igo-entity-table>\n      <mat-card-content\n        *ngIf=\"($any(workspace).inResolutionRange$ | async) === false\"\n      >\n        No data available at this scale. Please zoom in.\n      </mat-card-content>\n\n      <igo-workspace-widget-outlet\n        [workspace]=\"workspace\"\n      ></igo-workspace-widget-outlet>\n    </ng-container>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes } from '@angular/router';\n\nimport { AppCatalogComponent } from './catalog/catalog.component';\nimport { AppDirectionsComponent } from './directions/directions.component';\nimport { AppDrawComponent } from './draw/draw.component';\nimport { AppFeatureComponent } from './feature/feature.component';\nimport { AppGeometryComponent } from './geometry/geometry.component';\nimport { AppHoverComponent } from './hover/hover.component';\nimport { AppImportExportComponent } from './import-export/import-export.component';\nimport { AppLayerComponent } from './layer/layer.component';\nimport { AppLegendComponent } from './legend/legend.component';\nimport { AppMeasureComponent } from './measure/measure.component';\nimport { AppOgcFilterComponent } from './ogc-filter/ogc-filter.component';\nimport { AppOverlayComponent } from './overlay/overlay.component';\nimport { AppPrintComponent } from './print/print.component';\nimport { AppQueryComponent } from './query/query.component';\nimport { AppSearchComponent } from './search/search.component';\nimport { AppSimpleMapComponent } from './simple-map/simple-map.component';\nimport { AppSpatialFilterComponent } from './spatial-filter/spatial-filter.component';\nimport { AppTimeFilterComponent } from './time-filter/time-filter.component';\nimport { AppWorkspaceComponent } from './workspace/workspace.component';\n\nexport const routes: Routes = [\n  { path: '', redirectTo: 'activity', pathMatch: 'full' },\n  {\n    title: 'Simple map',\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  },\n  {\n    title: 'Layer',\n    path: 'layer',\n    component: AppLayerComponent\n  },\n  {\n    title: 'Legend',\n    path: 'legend',\n    component: AppLegendComponent\n  },\n  {\n    title: 'Overlay',\n    path: 'overlay',\n    component: AppOverlayComponent\n  },\n  {\n    title: 'Geometry',\n    path: 'geometry',\n    component: AppGeometryComponent\n  },\n  {\n    title: 'Feature',\n    path: 'feature',\n    component: AppFeatureComponent\n  },\n  {\n    title: 'Hover',\n    path: 'hover',\n    component: AppHoverComponent\n  },\n  {\n    title: 'Measure',\n    path: 'measure',\n    component: AppMeasureComponent\n  },\n  {\n    title: 'Draw',\n    path: 'draw',\n    component: AppDrawComponent\n  },\n  {\n    title: 'Query',\n    path: 'query',\n    component: AppQueryComponent\n  },\n  {\n    title: 'Catalog',\n    path: 'catalog',\n    component: AppCatalogComponent\n  },\n  {\n    title: 'Search',\n    path: 'search',\n    component: AppSearchComponent\n  },\n  {\n    title: 'Print',\n    path: 'print',\n    component: AppPrintComponent\n  },\n  {\n    title: 'Import/Export',\n    path: 'import-export',\n    component: AppImportExportComponent\n  },\n  {\n    title: 'Directions',\n    path: 'directions',\n    component: AppDirectionsComponent\n  },\n  {\n    title: 'Time Filter',\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  },\n  {\n    title: 'OGC Filter',\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  },\n  {\n    title: 'Spatial Filter',\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  },\n  {\n    title: 'Workspace',\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n","import { AsyncPipe, NgIf } from '@angular/common';\nimport { Component, OnInit } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatPaginator } from '@angular/material/paginator';\n\nimport { Action, ActionbarComponent, ActionbarMode } from '@igo2/common/action';\nimport {\n  EntityRecord,\n  EntityTableComponent,\n  EntityTablePaginatorComponent,\n  EntityTablePaginatorOptions,\n  EntityTableScrollBehavior\n} from '@igo2/common/entity';\nimport {\n  Workspace,\n  WorkspaceSelectorComponent,\n  WorkspaceStore,\n  WorkspaceWidgetOutletComponent\n} from '@igo2/common/workspace';\nimport {\n  DataSourceService,\n  IgoGeoWorkspaceModule,\n  IgoMap,\n  LayerOptions,\n  LayerService,\n  MAP_DIRECTIVES,\n  MapViewOptions,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WorkspaceSelectorDirective\n} from '@igo2/geo';\nimport { WorkspaceState } from '@igo2/integration';\n\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\nimport { ExampleViewerComponent } from '../../components/example/example-viewer/example-viewer.component';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss'],\n  standalone: true,\n  imports: [\n    AsyncPipe,\n    DocViewerComponent,\n    ExampleViewerComponent,\n    EntityTableComponent,\n    ActionbarComponent,\n    EntityTablePaginatorComponent,\n    IgoGeoWorkspaceModule,\n    MAP_DIRECTIVES,\n    WorkspaceSelectorComponent,\n    WorkspaceSelectorDirective,\n    WorkspaceWidgetOutletComponent,\n    MatCardModule,\n    NgIf\n  ]\n})\nexport class AppWorkspaceComponent implements OnInit {\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map: IgoMap = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view: MapViewOptions = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode: ActionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior: EntityTableScrollBehavior =\n    EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity: Workspace =\n            record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The button triggers a tool (importExport) and this tool is not available in the igo2-lib demo.\n            // This is why it has been removed from the actions list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action: Action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      } satisfies OSMDataSourceOptions)\n      .subscribe((dataSource: OSMDataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          } satisfies LayerOptions)\n        );\n      });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layerOptions: VectorLayerOptions = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layerOptions));\n      });\n  }\n\n  paginatorChange(event: MatPaginator): void {\n    this.workspacePaginator = event;\n  }\n}\n","import { CatalogQueryFormatTypes, ICatalog, TooltipType } from '@igo2/geo';\nimport { EnvironmentOptions } from '@igo2/integration';\n\nexport const environment: EnvironmentOptions = {\n  production: true,\n  igo: {\n    directionsSources: {\n      osrm: {\n        name: 'OSRM Québec',\n        baseUrl: '/apis/itineraire/route/v1/',\n        profiles: [\n          {\n            name: 'driving'\n          },\n          {\n            name: 'forestier',\n            authorization: {\n              url: '/apis/igo2/user/igo',\n              property: 'hasOsrmPrivateAccess'\n            }\n          }\n        ]\n      }\n    },\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def: '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      tokenKey: 'testIgo2Lib',\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true,\n      activateInteractiveTour: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            json: ['stations_meteoroutieres', 'histo_stations_meteoroutieres']\n          } as CatalogQueryFormatTypes,\n          queryHtmlTarget: 'iframe',\n          count: 30\n        } as ICatalog,\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi',\n          tooltipType: TooltipType.ABSTRACT\n        }\n      ]\n    },\n    monitoring: {\n      provider: 'sentry',\n      dsn: 'https://examplePublicKey@o0.ingest.sentry.io/0',\n      identifyUser: true\n    },\n    searchSources: {\n      storedqueriesreverse: { enabled: false },\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        },\n        showAdvancedSettings: true\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import {\n  HttpErrorResponse,\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { MessageService } from '@igo2/core/message';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(private messageService: MessageService) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const interceptError = originalReq.headers.get('interceptError');\n    const req = originalReq.clone({\n      headers: originalReq.headers.delete('interceptError')\n    });\n    if (interceptError === 'false') {\n      return next.handle(req);\n    }\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError((error) => this.handleError(error, errorContainer)),\n      finalize(() => {\n        const httpError = errorContainer.httpError;\n        if (!httpError) {\n          return;\n        }\n\n        if (httpError.error.toDisplay) {\n          this.handleCaughtError(httpError);\n        } else if (!httpError.error.caught) {\n          this.handleUncaughtError(httpError);\n        }\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error?.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    this.messageService.error(httpError.error.message, httpError.error.title, {\n      progressBar: false\n    });\n  }\n\n  private handleUncaughtError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    this.messageService.error(\n      'igo.core.errors.uncaught.message',\n      'igo.core.errors.uncaught.title',\n      {\n        progressBar: false\n      }\n    );\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport {\n  ModuleWithProviders,\n  NgModule,\n  Optional,\n  SkipSelf\n} from '@angular/core';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { IgoActivityModule } from '@igo2/core/activity';\nimport { ConfigOptions, provideConfig } from '@igo2/core/config';\nimport { IgoLanguageModule, provideTranslation } from '@igo2/core/language';\nimport { provideMessage } from '@igo2/core/message';\nimport { IgoErrorModule } from '@igo2/core/request';\n\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 2,\n  objectStoresMeta: [\n    {\n      store: 'geoData',\n      storeConfig: { keyPath: 'url', autoIncrement: false },\n      storeSchema: [\n        { name: 'regionID', keypath: 'regionID', options: { unique: false } }\n      ]\n    },\n    {\n      store: 'layerData',\n      storeConfig: { keyPath: 'layerId', autoIncrement: false },\n      storeSchema: [\n        {\n          name: 'layerOptions',\n          keypath: 'layerOptions',\n          options: { unique: false }\n        },\n        {\n          name: 'sourceOptions',\n          keypath: 'sourceOptions',\n          options: { unique: false }\n        }\n      ]\n    }\n  ]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  providers: [provideMessage()],\n  declarations: [],\n  exports: [IgoActivityModule, IgoErrorModule, IgoLanguageModule]\n})\nexport class IgoCoreModule {\n  static forRoot(\n    options: ConfigOptions = {}\n  ): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: [provideConfig(options), provideTranslation()]\n    };\n  }\n\n  constructor() {}\n}\n","import { Route, Routes } from '@angular/router';\n\nimport { routes as authRoutes } from './auth/auth.routing';\nimport { routes as commonRoutes } from './common/common.routing';\nimport { routes as contextRoutes } from './context/context.routing';\nimport { routes as coreRoutes } from './core/core.routing';\nimport { routes as geoRoutes } from './geo/geo.routing';\nimport { AppHomeComponent } from './pages/home/home.component';\n\nexport const routes: Routes = [\n  { title: 'Home', path: 'home', component: AppHomeComponent },\n  {\n    title: 'Auth',\n    path: 'auth',\n    loadChildren: () => import('./auth/auth.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Common',\n    path: 'common',\n    loadChildren: () => import('./common/common.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Context',\n    path: 'context',\n    loadChildren: () =>\n      import('./context/context.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Core',\n    path: 'core',\n    loadChildren: () => import('./core/core.routing').then((m) => m.routes)\n  },\n  {\n    title: 'Geo',\n    path: 'geo',\n    loadChildren: () => import('./geo/geo.routing').then((m) => m.routes)\n  },\n  { path: '**', redirectTo: '/home' }\n];\n\nexport const ROUTES_CONFIG: Routes = [\n  { title: 'Home', path: 'home', redirectTo: '/home', pathMatch: 'full' },\n  {\n    title: 'Core',\n    path: 'core',\n    children: getRoutesConfig(coreRoutes)\n  },\n  {\n    title: 'Auth',\n    path: 'auth',\n    children: getRoutesConfig(authRoutes)\n  },\n  {\n    title: 'Common',\n    path: 'common',\n    children: getRoutesConfig(commonRoutes)\n  },\n  {\n    title: 'Geo',\n    path: 'geo',\n    children: getRoutesConfig(geoRoutes)\n  },\n  {\n    title: 'Context',\n    path: 'context',\n    children: getRoutesConfig(contextRoutes)\n  }\n];\n\nfunction getRoutesConfig(routes: Route[]): Route[] {\n  return routes\n    .filter((route) => route.title)\n    .sort((a, b) => (a.title as string).localeCompare(b.title as string));\n}\n","import { Component } from '@angular/core';\n\nimport {\n  IgoInteractiveTourModule,\n  InteractiveTourService\n} from '@igo2/common/interactive-tour';\n\nimport { DocViewerComponent } from '../../components/doc-viewer/doc-viewer.component';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss'],\n  standalone: true,\n  imports: [DocViewerComponent, IgoInteractiveTourModule]\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<app-doc-viewer>\n  <div style=\"text-align: center\">\n    <h1 id=\"igo-title\">Welcome to IGO</h1>\n    <img class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\" />\n  </div>\n\n  <p>\n    <igo-interactive-tour\n      tourToStart=\"global\"\n      menuIsOpen=\"true\"\n      styleButton=\"raised\"\n    >\n    </igo-interactive-tour>\n  </p>\n\n  <p class=\"mat-body-1\">\n    IGO2 library contains many components and services that may benefit any web\n    application. <br />\n    IGO2 library is open source project using Angular, Angular Material and\n    OpenLayers.\n  </p>\n\n  <h3>IGO2 library is divided into several elements:</h3>\n  <ul class=\"mat-body-1\">\n    <li>\n      <b>&#64;igo2/utils</b> : Basic utilies without dependency (ex: base64,\n      clipboard, uuid)\n    </li>\n    <li>\n      <b>&#64;igo2/core</b> : Element affecting the core of the application (ex:\n      config, language, message, media, request)\n    </li>\n    <li>\n      <b>&#64;igo2/common</b> : Library containing reusable components (ex:\n      clickout, drag-drop, list, panel, spinner, table)\n    </li>\n    <li>\n      <b>&#64;igo2/auth</b> : Library grouping the authentication and security\n      module\n    </li>\n    <li>\n      <b>&#64;igo2/geo</b> : Library containing the geomatic components. Depends\n      on Openlayers.\n    </li>\n    <li>\n      <b>&#64;igo2/context</b> : Library of components uniting &#64;igo2/geo and\n      &#64;igo2/auth\n    </li>\n    <li><b>&#64;igo2/integration</b> : Library integrate basic components</li>\n  </ul>\n\n  <h2>Here are some links to help you start:</h2>\n  <ul>\n    <li>\n      <h2>\n        <a\n          target=\"_blank\"\n          rel=\"noopener\"\n          href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\"\n          >Installation</a\n        >\n      </h2>\n    </li>\n    <li>\n      <h2>\n        <a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\"\n          >Angular Documentation</a\n        >\n      </h2>\n    </li>\n  </ul>\n\n  <span class=\"mat-body-1\"\n    >*** Modules in <code>&#64;igo2/core</code> must be imported only once</span\n  >\n</app-doc-viewer>\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar mat-elevation-z6\">\n    <button mat-icon-button (click)=\"snav.toggle()\">\n      <mat-icon>menu</mat-icon>\n    </button>\n    <h1>{{ title }}</h1>\n    <h5 class=\"mat-subtitle-1 m-b-0\">{{ version.lib }}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container\n    class=\"example-sidenav-container\"\n    [style.marginTop.px]=\"mobileQuery.matches ? 48 : 0\"\n  >\n    <mat-sidenav\n      #snav\n      opened=\"true\"\n      [mode]=\"mobileQuery.matches ? 'over' : 'side'\"\n      [fixedInViewport]=\"mobileQuery.matches\"\n      fixedTopGap=\"48\"\n    >\n      <mat-accordion displayMode=\"flat\" multi>\n        <ng-container *ngFor=\"let routeConfig of routesConfig\">\n          <ng-container *ngIf=\"!routeConfig.children; else routeWithChildren\">\n            <mat-nav-list>\n              <a\n                mat-list-item\n                [routerLink]=\"routeConfig.path\"\n                [routerLinkActiveOptions]=\"{ exact: true }\"\n                routerLinkActive=\"active-link\"\n                class=\"p-h-24 m-t-8\"\n                >{{ routeConfig.title }}</a\n              >\n            </mat-nav-list>\n            <mat-divider></mat-divider>\n          </ng-container>\n          <ng-template #routeWithChildren>\n            <mat-expansion-panel expanded>\n              <mat-expansion-panel-header>\n                <mat-panel-title> {{ routeConfig.title }} </mat-panel-title>\n              </mat-expansion-panel-header>\n              <mat-nav-list>\n                <a\n                  *ngFor=\"let route of routeConfig.children\"\n                  mat-list-item\n                  [routerLink]=\"routeConfig.path + '/' + route.path\"\n                  routerLinkActive=\"active-link\"\n                  >{{ route.title }}</a\n                >\n              </mat-nav-list>\n            </mat-expansion-panel>\n\n            <mat-divider></mat-divider>\n          </ng-template>\n        </ng-container>\n      </mat-accordion>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n  </mat-sidenav-container>\n</div>\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport { DOCUMENT, NgFor, NgIf } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  Inject,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport {\n  NavigationEnd,\n  Router,\n  RouterLink,\n  RouterLinkActive,\n  RouterOutlet\n} from '@angular/router';\n\nimport { version } from '@igo2/core/config';\nimport { DomUtils, userAgent } from '@igo2/utils';\n\nimport { delay, first } from 'rxjs';\n\nimport { ROUTES_CONFIG } from './app.routing';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss'],\n  standalone: true,\n  imports: [\n    NgFor,\n    NgIf,\n    MatExpansionModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatSidenavModule,\n    MatListModule,\n    RouterLink,\n    RouterLinkActive,\n    RouterOutlet\n  ]\n})\nexport class AppComponent implements OnInit, OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  routesConfig = ROUTES_CONFIG;\n\n  public title = 'IGO';\n  public version = version;\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    @Inject(DOCUMENT) private document: Document,\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private router: Router\n  ) {\n    this.mobileQuery = this.media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => this.changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnInit(): void {\n    this.handleSplashScreen();\n  }\n\n  private handleSplashScreen(): void {\n    this.router.events\n      .pipe(\n        first((events) => events instanceof NavigationEnd),\n        delay(300)\n      )\n      .subscribe(() => {\n        this._removeSplashScreen();\n      });\n  }\n\n  private _removeSplashScreen(): void {\n    const intro = this.document.getElementById('splash-screen');\n    if (!intro) {\n      return;\n    }\n    intro.classList.add('is-destroying');\n\n    const destroyingAnimationTime = 300;\n    const stylesheet = this.document.getElementById('splash-screen-stylesheet');\n\n    setTimeout(() => {\n      DomUtils.remove(intro);\n      DomUtils.remove(stylesheet);\n    }, destroyingAnimationTime);\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<=11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","import { provideHttpClient, withJsonpSupport } from '@angular/common/http';\nimport { enableProdMode, importProvidersFrom } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport {\n  MAT_TOOLTIP_DEFAULT_OPTIONS,\n  MatTooltipDefaultOptions\n} from '@angular/material/tooltip';\nimport {\n  BrowserModule,\n  HammerModule,\n  bootstrapApplication\n} from '@angular/platform-browser';\nimport { provideAnimations } from '@angular/platform-browser/animations';\nimport {\n  PreloadAllModules,\n  provideRouter,\n  withPreloading\n} from '@angular/router';\n\nimport { provideAuthentification } from '@igo2/auth';\nimport { provideIcon } from '@igo2/common/icon';\nimport { IgoCoreModule } from '@igo2/core';\nimport { provideConfig } from '@igo2/core/config';\nimport { provideTranslation } from '@igo2/core/language';\n\nimport { AppComponent } from './app/app.component';\nimport { routes } from './app/app.routing';\nimport { environment } from './environments/environment';\n\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\n  showDelay: 500,\n  hideDelay: 0,\n  touchendHideDelay: 0,\n  disableTooltipInteractivity: true\n};\n\nif (environment.production) {\n  enableProdMode();\n}\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    importProvidersFrom(\n      IgoCoreModule,\n      BrowserModule,\n      HammerModule,\n      MatButtonModule,\n      MatIconModule,\n      MatListModule,\n      MatSidenavModule,\n      MatToolbarModule\n    ),\n    provideHttpClient(withJsonpSupport()),\n    provideRouter(routes, withPreloading(PreloadAllModules)),\n    provideAnimations(),\n    provideConfig({\n      default: environment.igo\n    }),\n    provideTranslation(),\n    provideAuthentification(),\n    provideIcon(),\n    {\n      provide: MAT_FORM_FIELD_DEFAULT_OPTIONS,\n      useValue: { appearance: 'outline' }\n    },\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions }\n  ]\n}).catch((err) => console.log(err));\n","var map = {\n\t\"./af\": 22408,\n\t\"./af.js\": 22408,\n\t\"./ar\": 83632,\n\t\"./ar-dz\": 20944,\n\t\"./ar-dz.js\": 20944,\n\t\"./ar-kw\": 59628,\n\t\"./ar-kw.js\": 59628,\n\t\"./ar-ly\": 60764,\n\t\"./ar-ly.js\": 60764,\n\t\"./ar-ma\": 8087,\n\t\"./ar-ma.js\": 8087,\n\t\"./ar-ps\": 84152,\n\t\"./ar-ps.js\": 84152,\n\t\"./ar-sa\": 36932,\n\t\"./ar-sa.js\": 36932,\n\t\"./ar-tn\": 97064,\n\t\"./ar-tn.js\": 97064,\n\t\"./ar.js\": 83632,\n\t\"./az\": 78216,\n\t\"./az.js\": 78216,\n\t\"./be\": 90432,\n\t\"./be.js\": 90432,\n\t\"./bg\": 54440,\n\t\"./bg.js\": 54440,\n\t\"./bm\": 45340,\n\t\"./bm.js\": 45340,\n\t\"./bn\": 91936,\n\t\"./bn-bd\": 43392,\n\t\"./bn-bd.js\": 43392,\n\t\"./bn.js\": 91936,\n\t\"./bo\": 11440,\n\t\"./bo.js\": 11440,\n\t\"./br\": 51592,\n\t\"./br.js\": 51592,\n\t\"./bs\": 15056,\n\t\"./bs.js\": 15056,\n\t\"./ca\": 25992,\n\t\"./ca.js\": 25992,\n\t\"./cs\": 15944,\n\t\"./cs.js\": 15944,\n\t\"./cv\": 60928,\n\t\"./cv.js\": 60928,\n\t\"./cy\": 86160,\n\t\"./cy.js\": 86160,\n\t\"./da\": 22112,\n\t\"./da.js\": 22112,\n\t\"./de\": 6456,\n\t\"./de-at\": 44712,\n\t\"./de-at.js\": 44712,\n\t\"./de-ch\": 29100,\n\t\"./de-ch.js\": 29100,\n\t\"./de.js\": 6456,\n\t\"./dv\": 28776,\n\t\"./dv.js\": 28776,\n\t\"./el\": 91928,\n\t\"./el.js\": 91928,\n\t\"./en-au\": 67528,\n\t\"./en-au.js\": 67528,\n\t\"./en-ca\": 20736,\n\t\"./en-ca.js\": 20736,\n\t\"./en-gb\": 13976,\n\t\"./en-gb.js\": 13976,\n\t\"./en-ie\": 41600,\n\t\"./en-ie.js\": 41600,\n\t\"./en-il\": 53344,\n\t\"./en-il.js\": 53344,\n\t\"./en-in\": 24072,\n\t\"./en-in.js\": 24072,\n\t\"./en-nz\": 46264,\n\t\"./en-nz.js\": 46264,\n\t\"./en-sg\": 7816,\n\t\"./en-sg.js\": 7816,\n\t\"./eo\": 51920,\n\t\"./eo.js\": 51920,\n\t\"./es\": 82808,\n\t\"./es-do\": 2772,\n\t\"./es-do.js\": 2772,\n\t\"./es-mx\": 83368,\n\t\"./es-mx.js\": 83368,\n\t\"./es-us\": 48288,\n\t\"./es-us.js\": 48288,\n\t\"./es.js\": 82808,\n\t\"./et\": 33892,\n\t\"./et.js\": 33892,\n\t\"./eu\": 35736,\n\t\"./eu.js\": 35736,\n\t\"./fa\": 68544,\n\t\"./fa.js\": 68544,\n\t\"./fi\": 83640,\n\t\"./fi.js\": 83640,\n\t\"./fil\": 24616,\n\t\"./fil.js\": 24616,\n\t\"./fo\": 27128,\n\t\"./fo.js\": 27128,\n\t\"./fr\": 50552,\n\t\"./fr-ca\": 59120,\n\t\"./fr-ca.js\": 59120,\n\t\"./fr-ch\": 17980,\n\t\"./fr-ch.js\": 17980,\n\t\"./fr.js\": 50552,\n\t\"./fy\": 7912,\n\t\"./fy.js\": 7912,\n\t\"./ga\": 34464,\n\t\"./ga.js\": 34464,\n\t\"./gd\": 98864,\n\t\"./gd.js\": 98864,\n\t\"./gl\": 32056,\n\t\"./gl.js\": 32056,\n\t\"./gom-deva\": 75804,\n\t\"./gom-deva.js\": 75804,\n\t\"./gom-latn\": 98648,\n\t\"./gom-latn.js\": 98648,\n\t\"./gu\": 76036,\n\t\"./gu.js\": 76036,\n\t\"./he\": 14000,\n\t\"./he.js\": 14000,\n\t\"./hi\": 48800,\n\t\"./hi.js\": 48800,\n\t\"./hr\": 55176,\n\t\"./hr.js\": 55176,\n\t\"./hu\": 192,\n\t\"./hu.js\": 192,\n\t\"./hy-am\": 94840,\n\t\"./hy-am.js\": 94840,\n\t\"./id\": 78240,\n\t\"./id.js\": 78240,\n\t\"./is\": 23608,\n\t\"./is.js\": 23608,\n\t\"./it\": 56816,\n\t\"./it-ch\": 25136,\n\t\"./it-ch.js\": 25136,\n\t\"./it.js\": 56816,\n\t\"./ja\": 17272,\n\t\"./ja.js\": 17272,\n\t\"./jv\": 83248,\n\t\"./jv.js\": 83248,\n\t\"./ka\": 4768,\n\t\"./ka.js\": 4768,\n\t\"./kk\": 93624,\n\t\"./kk.js\": 93624,\n\t\"./km\": 48168,\n\t\"./km.js\": 48168,\n\t\"./kn\": 69372,\n\t\"./kn.js\": 69372,\n\t\"./ko\": 37088,\n\t\"./ko.js\": 37088,\n\t\"./ku\": 63357,\n\t\"./ku-kmr\": 54068,\n\t\"./ku-kmr.js\": 54068,\n\t\"./ku.js\": 63357,\n\t\"./ky\": 3672,\n\t\"./ky.js\": 3672,\n\t\"./lb\": 43592,\n\t\"./lb.js\": 43592,\n\t\"./lo\": 16096,\n\t\"./lo.js\": 16096,\n\t\"./lt\": 92672,\n\t\"./lt.js\": 92672,\n\t\"./lv\": 69056,\n\t\"./lv.js\": 69056,\n\t\"./me\": 63280,\n\t\"./me.js\": 63280,\n\t\"./mi\": 95037,\n\t\"./mi.js\": 95037,\n\t\"./mk\": 48600,\n\t\"./mk.js\": 48600,\n\t\"./ml\": 93795,\n\t\"./ml.js\": 93795,\n\t\"./mn\": 19288,\n\t\"./mn.js\": 19288,\n\t\"./mr\": 63656,\n\t\"./mr.js\": 63656,\n\t\"./ms\": 71744,\n\t\"./ms-my\": 92804,\n\t\"./ms-my.js\": 92804,\n\t\"./ms.js\": 71744,\n\t\"./mt\": 28536,\n\t\"./mt.js\": 28536,\n\t\"./my\": 21764,\n\t\"./my.js\": 21764,\n\t\"./nb\": 64752,\n\t\"./nb.js\": 64752,\n\t\"./ne\": 82948,\n\t\"./ne.js\": 82948,\n\t\"./nl\": 49572,\n\t\"./nl-be\": 5900,\n\t\"./nl-be.js\": 5900,\n\t\"./nl.js\": 49572,\n\t\"./nn\": 14904,\n\t\"./nn.js\": 14904,\n\t\"./oc-lnc\": 57328,\n\t\"./oc-lnc.js\": 57328,\n\t\"./pa-in\": 81496,\n\t\"./pa-in.js\": 81496,\n\t\"./pl\": 25928,\n\t\"./pl.js\": 25928,\n\t\"./pt\": 85764,\n\t\"./pt-br\": 91248,\n\t\"./pt-br.js\": 91248,\n\t\"./pt.js\": 85764,\n\t\"./ro\": 37168,\n\t\"./ro.js\": 37168,\n\t\"./ru\": 97904,\n\t\"./ru.js\": 97904,\n\t\"./sd\": 68448,\n\t\"./sd.js\": 68448,\n\t\"./se\": 29244,\n\t\"./se.js\": 29244,\n\t\"./si\": 65696,\n\t\"./si.js\": 65696,\n\t\"./sk\": 77120,\n\t\"./sk.js\": 77120,\n\t\"./sl\": 83544,\n\t\"./sl.js\": 83544,\n\t\"./sq\": 71544,\n\t\"./sq.js\": 71544,\n\t\"./sr\": 53696,\n\t\"./sr-cyrl\": 33444,\n\t\"./sr-cyrl.js\": 33444,\n\t\"./sr.js\": 53696,\n\t\"./ss\": 32504,\n\t\"./ss.js\": 32504,\n\t\"./sv\": 39011,\n\t\"./sv.js\": 39011,\n\t\"./sw\": 74144,\n\t\"./sw.js\": 74144,\n\t\"./ta\": 81280,\n\t\"./ta.js\": 81280,\n\t\"./te\": 90504,\n\t\"./te.js\": 90504,\n\t\"./tet\": 36472,\n\t\"./tet.js\": 36472,\n\t\"./tg\": 77024,\n\t\"./tg.js\": 77024,\n\t\"./th\": 69872,\n\t\"./th.js\": 69872,\n\t\"./tk\": 63364,\n\t\"./tk.js\": 63364,\n\t\"./tl-ph\": 25164,\n\t\"./tl-ph.js\": 25164,\n\t\"./tlh\": 60048,\n\t\"./tlh.js\": 60048,\n\t\"./tr\": 86976,\n\t\"./tr.js\": 86976,\n\t\"./tzl\": 4224,\n\t\"./tzl.js\": 4224,\n\t\"./tzm\": 64316,\n\t\"./tzm-latn\": 72264,\n\t\"./tzm-latn.js\": 72264,\n\t\"./tzm.js\": 64316,\n\t\"./ug-cn\": 18984,\n\t\"./ug-cn.js\": 18984,\n\t\"./uk\": 25152,\n\t\"./uk.js\": 25152,\n\t\"./ur\": 57068,\n\t\"./ur.js\": 57068,\n\t\"./uz\": 47880,\n\t\"./uz-latn\": 7400,\n\t\"./uz-latn.js\": 7400,\n\t\"./uz.js\": 47880,\n\t\"./vi\": 35368,\n\t\"./vi.js\": 35368,\n\t\"./x-pseudo\": 71252,\n\t\"./x-pseudo.js\": 71252,\n\t\"./yo\": 98595,\n\t\"./yo.js\": 98595,\n\t\"./zh-cn\": 23036,\n\t\"./zh-cn.js\": 23036,\n\t\"./zh-hk\": 59944,\n\t\"./zh-hk.js\": 59944,\n\t\"./zh-mo\": 94952,\n\t\"./zh-mo.js\": 94952,\n\t\"./zh-tw\": 8240,\n\t\"./zh-tw.js\": 8240\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 92348;"],"x_google_ignoreList":[733]}