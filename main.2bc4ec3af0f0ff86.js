(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[590],{45928:(Pe,ae,r)=>{"use strict";r.d(ae,{kT:()=>Q,oj:()=>h,qi:()=>j});var E=r(33712),a=r(34896),w=r(62004),p=r(45872),e=r(13680);let c=(()=>{class A{injector;options;tokenKey;constructor(u){this.injector=u;const x=this.injector.get(p.aW);this.options=x.getConfig("auth"),this.tokenKey=this.options?.tokenKey}set(u){localStorage.setItem(this.tokenKey,u)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const u=this.get();if(u)return(0,e.i)(u)}isExpired(){const u=this.decode(),x=(new Date).getTime()/1e3;return!(u&&x<u.exp)}static \u0275fac=function(x){return new(x||A)(a.CoB(a.zZn))};static \u0275prov=a.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();var o=r(20460),R=r(64100),L=r(43168),_=r(54844),C=r(1296),S=r(78600),P=r(51672),y=r(90916),F=r(57880);let h=(()=>{class A{http;tokenService;config;languageService;messageService;router;authenticate$=new _.g(void 0);logged$=new _.g(void 0);redirectUrl;languageForce=!1;anonymous=!1;authOptions;get hasAuthService(){return void 0!==this.authOptions?.url}get user(){const u=this.decodeToken();return u?.user?u.user:null}constructor(u,x,U,G,X,D){this.http=u,this.tokenService=x,this.config=U,this.languageService=G,this.messageService=X,this.router=D,this.authOptions=this.config.getConfig("auth"),this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(I=>{this.logged$.next(I),y.y.next()})}login(u,x){const U=new E.UD({"Content-Type":"application/json"}),G={username:u,password:this.encodePassword(x)};return this.loginCall(G,U)}loginWithToken(u,x,U){const G=new E.UD({"Content-Type":"application/json"});return this.loginCall({token:u,typeConnection:x,infosUser:U},G)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,C.of)(!0)}refresh(){return this.http.post(`${this.authOptions?.url}/refresh`,{}).pipe((0,S.y)(u=>{this.tokenService.set(u.token)}),(0,P.a)(u=>{throw u.error.caught=!0,u}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,C.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){if(this.isAuthenticated())return this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const u=this.redirectUrl||this.router.url;u===this.authOptions.loginRoute?this.router.navigateByUrl(this.authOptions.homeRoute||"/"):u&&this.router.navigateByUrl(u)}getUserInfo(){return this.http.get(this.authOptions?.url+"/info")}getProfils(){return this.http.get(`${this.authOptions?.url}/profils`)}updateUser(u){return this.http.patch(this.authOptions?.url,u)}encodePassword(u){return L.Q1.encode(u)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){return!!this.decodeToken()?.user?.isAdmin}loginCall(u,x){return this.http.post(`${this.authOptions?.url}/login`,u,{headers:x}).pipe((0,S.y)(U=>{this.tokenService.set(U.token);const G=this.decodeToken();G?.user&&(G.user.locale&&!this.languageForce&&this.languageService.setLanguage(G.user.locale),G.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,P.a)(U=>{throw U.error.caught=!0,U}))}static \u0275fac=function(x){return new(x||A)(a.CoB(E.KK),a.CoB(c),a.CoB(p.aW),a.CoB(o.ov),a.CoB(R.mi),a.CoB(F.E5,8))};static \u0275prov=a.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})(),W=(()=>{class A extends w.kR{http;authService;tokenService;constructor(u,x,U,G){super(u),this.http=x,this.authService=U,this.tokenService=G,this.authService.authenticate$.subscribe(X=>{X&&this.options.url&&this.http.get(this.options.url).subscribe(D=>{if(D&&D.preference)for(const I of Object.keys(D.preference))super.set(I,D.preference[I])})})}set(u,x,U=w.Ab.LOCAL){if(U===w.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const G={};G[u]=x,this.http.patch(this.options.url,{preference:G}).subscribe()}super.set(u,x,U)}remove(u,x=w.Ab.LOCAL){if(x===w.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const U={};U[u]=void 0,this.http.patch(this.options.url,{preference:U}).subscribe()}super.remove(u,x)}clear(u=w.Ab.LOCAL){let x;u===w.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),u===w.Ab.LOCAL&&(x=this.tokenService.get()),super.clear(u),x&&this.tokenService.set(x),u===w.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(U=>{if(U&&U.preference)for(const G of Object.keys(U.preference))super.set(G,U.preference[G])})}static \u0275fac=function(x){return new(x||A)(a.CoB(p.aW),a.CoB(E.KK),a.CoB(h),a.CoB(c))};static \u0275prov=a.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();var T=r(11772);let Q=(()=>{class A{config;tokenService;http;authOptions;refreshInProgress=!1;trustHosts;hostsWithCredentials;hostsWithAuthByKey;constructor(u,x,U){this.config=u,this.tokenService=x,this.http=U,this.authOptions=this.config.getConfig("auth"),this.trustHosts=this.authOptions?.trustHosts||[],this.trustHosts.push(window.location.hostname),this.hostsWithCredentials=this.authOptions?.hostsWithCredentials||[],this.hostsWithAuthByKey=this.authOptions?.hostsByKey||[]}intercept(u,x){const U=this.handleHostsWithCredentials(u.url);let G=u.clone();const X=this.handleHostsAuthByKey(u.url);if(X&&(G=G.clone({params:G.params.set(X.key,X.value)})),U)return G=u.clone({withCredentials:U}),x.handle(G);this.refreshToken();const D=this.tokenService.get(),I=document.createElement("a");if(I.href=G.url,""===I.host&&(I.href=I.href),!D||-1===this.trustHosts.indexOf(I.hostname))return x.handle(G);let s=G.clone({headers:G.headers.set("Authorization",`Bearer ${D}`)});const H=this.tokenService.decode();if("true"===s.params.get("_i")&&H?.user?.sourceId){const Z=T.Cy.hashStr(H.user.sourceId);s=s.clone({params:s.params.set("_i",Z)})}else"true"===s.params.get("_i")&&(s=s.clone({params:s.params.delete("_i")}));return x.handle(s)}interceptXhr(u,x){const U=this.handleHostsWithCredentials(x);if(U)return u.withCredentials=U,!0;this.refreshToken();const G=document.createElement("a");G.href=x;const X=this.tokenService.get();return!(!X||-1===this.trustHosts.indexOf(G.hostname)||(u.setRequestHeader("Authorization","Bearer "+X),0))}alterUrlWithKeyAuth(u){const x=this.handleHostsAuthByKey(u);if(x){const G=u.split(/[?&]/);let X=G.shift();const D=G.filter(I=>0!==I.length);return D.push(`${x.key}=${x.value}`),D.length&&(X+="?"+D.join("&")),X}}handleHostsWithCredentials(u){let x=!1;for(const U of this.hostsWithCredentials)if(new RegExp(U.domainRegFilters).test(u)){x=void 0!==U.withCredentials?U.withCredentials:void 0;break}return x}handleHostsAuthByKey(u){let x;for(const X of this.hostsWithAuthByKey)if(new RegExp(X.domainRegFilters).test(u)&&!new RegExp(`${X.keyProperty}=${X.keyValue}`,"gm").test(u)){x={key:X.keyProperty,value:X.keyValue};break}return x}refreshToken(){const u=this.tokenService.decode(),x=(new Date).getTime()/1e3;if(!this.refreshInProgress&&u&&x<u.exp&&x>u.exp-1800){this.refreshInProgress=!0;const U=this.authOptions?.url;return this.http.post(`${U}/refresh`,{}).subscribe(G=>{this.tokenService.set(G.token),this.refreshInProgress=!1},G=>(G.error.caught=!0,G))}}static \u0275fac=function(x){return new(x||A)(a.CoB(p.aW),a.CoB(c),a.CoB(E.KK))};static \u0275prov=a.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();function j(...A){const d=[{provide:E.So,useClass:Q,multi:!0},{provide:w.yQ,useClass:W}];for(const u of A)d.push(...u.providers);return(0,a.AFj)(d)}},17284:(Pe,ae,r)=>{"use strict";r.d(ae,{MF:()=>w,AI:()=>s,m0:()=>E});var E=function(me){return me.Dock="dock",me.Overlay="overlay",me.Context="context",me}(E||{}),a=r(87040);class w extends a.qc{}var p=r(65056),e=r(34672),c=r(48512),o=r(32328),R=r(63916),L=r(87848),_=r(27e3),C=r(20460),S=r(56264),P=r(54844),y=r(34896),F=r(58539),h=r(80716),W=r(88404),J=r(72584);function T(me,_e){if(1&me&&(y.I0R(0,"button",5),y.wVc(1,"async"),y.wR5(2,"igo-icon",6),y.wVc(3,"async"),y.C$Y()),2&me){const de=y.GaO(2);y.E7m("color",de.color)("disabled",y.kDX(1,4,de.disabled$))("disableRipple",!0),y.yG2(2),y.E7m("icon",de.isObservable(de.action.icon)?y.kDX(3,6,de.action.icon):de.action.icon)}}function Q(me,_e){if(1&me&&(y.I0R(0,"span",7),y.OEk(1),y.wVc(2,"translate"),y.C$Y()),2&me){const de=y.GaO(2);y.yG2(),y.cNF(y.kDX(2,1,de.title))}}function z(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"mat-list-item",2),y.qCj("click",function(){y.usT(de);const ue=y.GaO();return y.CGJ(ue.onClick())}),y.wVc(1,"translate"),y.wVc(2,"async"),y.wVc(3,"async"),y.yuY(4,T,4,8,"button",3)(5,Q,3,3,"span",4),y.C$Y()}if(2&me){const de=y.GaO();y.E7m("matTooltip",de.withTooltip?y.kDX(1,4,y.kDX(2,6,de.tooltip$)||de.title):"")("ngClass",y.kDX(3,8,de.ngClass$)),y.yG2(4),y.E7m("ngIf",de.withIcon),y.yG2(),y.E7m("ngIf",de.withTitle)}}function Y(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"mat-checkbox",10),y.qCj("change",function(){y.usT(de);const ue=y.GaO(2);return y.CGJ(ue.action.handler())}),y.wVc(1,"async"),y.OEk(2),y.wVc(3,"translate"),y.C$Y()}if(2&me){const de=y.GaO(2);y.E7m("checked",y.kDX(1,2,de.checkCondition$)),y.yG2(2),y.oRS(" ",y.kDX(3,4,de.title)," ")}}function N(me,_e){if(1&me&&(y.I0R(0,"mat-list-item",8),y.wVc(1,"translate"),y.wVc(2,"async"),y.wVc(3,"async"),y.yuY(4,Y,4,6,"mat-checkbox",9),y.C$Y()),2&me){const de=y.GaO();y.E7m("matTooltip",de.withTooltip?y.kDX(1,3,y.kDX(2,5,de.tooltip$)||de.title):"")("ngClass",y.kDX(3,7,de.ngClass$)),y.yG2(4),y.E7m("ngIf",de.withTitle)}}let K=(()=>{class me{disabled$=new P.g(!1);checkCondition$=new P.g(void 0);tooltip$=new P.g(void 0);noDisplay$=new P.g(!1);ngClass$=new P.g({});ngClass$$;disabled$$;availability$$;checkCondition$$;tooltip$$;noDisplay$$;display$$;isObservable=W.X;action;color="default";withTitle=!0;withIcon=!0;withTooltip=!0;set disabled(de){this.disabled$.next(de)}get disabled(){return this.disabled$.value}set noDisplay(de){this.noDisplay$.next(de)}get noDisplay(){return this.noDisplay$.value}trigger=new y._w7;get title(){return this.action.title}ngOnInit(){const de=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...de).subscribe(le=>this.updateNgClass(le))),(0,W.X)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(le=>this.updateCheckCondition(le)):this.updateCheckCondition(this.action.checkCondition),(0,W.X)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(le=>this.updateTooltip(le)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...de).subscribe(le=>this.disabled=!le)),this.disabled$$=this.disabled$.subscribe(le=>this.updateNgClass({"igo-actionbar-item-disabled":le})),void 0!==this.action.display&&(this.display$$=this.action.display(...de).subscribe(le=>this.noDisplay=!le)),this.noDisplay$$=this.noDisplay$.subscribe(le=>this.updateNgClass({"igo-actionbar-item-no-display":le}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(de){this.ngClass$.next(Object.assign({},this.ngClass$.value,de))}updateTooltip(de){this.tooltip$.next(de)}updateCheckCondition(de){this.checkCondition$.next(de)}static \u0275fac=function(le){return new(le||me)};static \u0275cmp=y.In1({type:me,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},standalone:!0,features:[y.UHJ],decls:2,vars:2,consts:[["class","actionbar-item","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"actionbar-item",3,"matTooltip","ngClass","click"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple",4,"ngIf"],["matLine","",4,"ngIf"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple"],[3,"icon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(le,ue){1&le&&y.yuY(0,z,6,10,"mat-list-item",0)(1,N,5,9,"mat-list-item",1),2&le&&(y.E7m("ngIf",!ue.action.checkbox),y.yG2(),y.E7m("ngIf",ue.action.checkbox))},dependencies:[p.u_,R.iI,R.g9,R.EV,_.KO,_.a4,p.QF,e.oJ,e.um,o.oB,F.Vn,F.WK,p.a,C._s,J.sD,h.S],styles:["[_nghost-%COMP%]     mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button[matlistitemavatar]{margin-left:4px}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button .mat-mdc-button-persistent-ripple{display:none}[_nghost-%COMP%]   .item-checkbox[_ngcontent-%COMP%]     mat-checkbox label{margin-left:28px}[_nghost-%COMP%]   .actionbar-item[_ngcontent-%COMP%]   [matline][_ngcontent-%COMP%]{padding-left:16px}"],changeDetection:0})}return me})();var j=r(23416);function A(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"div",5)(1,"button",6),y.qCj("click",function(){y.usT(de);const ue=y.GaO();return y.CGJ(ue.scrollUp())}),y.wVc(2,"translate"),y.I0R(3,"mat-icon"),y.OEk(4,"expand_less"),y.C$Y()()()}2&me&&(y.yG2(),y.E7m("matTooltip",y.kDX(2,1,"igo.common.actionbar.scrollUp")))}function d(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"igo-actionbar-item",9),y.qCj("trigger",function(){y.usT(de);const ue=y.GaO(2);return y.CGJ(ue.onTriggerAction(ue.toggleCollapseAction))}),y.C$Y()}if(2&me){const de=y.GaO(2);y.E7m("withTitle",!1)("withIcon",!0)("color",de.color)("disabled",de.store.view.empty)("action",de.toggleCollapseAction)}}function u(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"igo-actionbar-item",12),y.qCj("trigger",function(){const ne=y.usT(de).$implicit,ve=y.GaO(3);return y.CGJ(ve.onTriggerAction(ne))}),y.C$Y()}if(2&me){const de=_e.$implicit,le=y.GaO(3);y.E7m("withTitle",le.withTitle)("withIcon",le.withIcon)("withTooltip",le.withTooltip)("color",le.color)("disabled",le.store.state.get(de).disabled)("action",de)}}function x(me,_e){if(1&me&&(y.yuY(0,u,1,6,"ng-template",10,11,y.gJz),y.wVc(2,"async")),2&me){const de=y.GaO(2);y.E7m("ngForOf",y.kDX(2,1,de.store.view.all$()))}}function U(me,_e){if(1&me&&(y.I0R(0,"mat-list",7),y.yuY(1,d,1,5,"igo-actionbar-item",8)(2,x,3,3,null,3),y.C$Y()),2&me){const de=y.GaO();y.yG2(),y.E7m("ngIf",de.withToggleButton),y.yG2(),y.E7m("ngIf",!de.collapsed)}}function G(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"div",13)(1,"button",6),y.qCj("click",function(){y.usT(de);const ue=y.GaO();return y.CGJ(ue.scrollDown())}),y.wVc(2,"translate"),y.I0R(3,"mat-icon"),y.OEk(4,"expand_more"),y.C$Y()()()}2&me&&(y.yG2(),y.E7m("matTooltip",y.kDX(2,1,"igo.common.actionbar.scrollDown")))}function X(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"igo-actionbar-item",17),y.qCj("trigger",function(){const ne=y.usT(de).$implicit,ve=y.GaO(2);return y.CGJ(ve.onTriggerAction(ne))}),y.C$Y()}if(2&me){const de=_e.$implicit,le=y.GaO(2);y.E7m("withTitle",le.withTitle)("withIcon",le.withIcon)("color",le.color)("action",de)}}function D(me,_e){if(1&me&&(y.I0R(0,"div")(1,"button",14),y.wVc(2,"translate"),y.I0R(3,"mat-icon"),y.OEk(4),y.C$Y()(),y.I0R(5,"mat-menu",15,16)(7,"mat-list"),y.yuY(8,X,1,4,"ng-template",10),y.wVc(9,"async"),y.C$Y()()()),2&me){const de=y.Gew(6),le=y.GaO();y.yG2(),y.E7m("matTooltip",y.kDX(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",de)("disabled",le.store.view.empty)("color",le.iconColor),y.yG2(3),y.cNF(le.icon),y.yG2(),y.m8U(le.overlayClass),y.E7m("xPosition",le.xPosition)("yPosition",le.yPosition),y.yG2(3),y.E7m("ngForOf",y.kDX(9,12,le.store.view.all$()))}}function I(me,_e){if(1&me){const de=y.KQA();y.I0R(0,"igo-actionbar-item",17),y.qCj("trigger",function(){const ne=y.usT(de).$implicit,ve=y.GaO(2);return y.CGJ(ve.onTriggerAction(ne))}),y.C$Y(),y.wR5(1,"br")}if(2&me){const de=_e.$implicit,le=y.GaO(2);y.E7m("withTitle",le.withTitle)("withIcon",le.withIcon)("color",le.color)("action",de)}}function M(me,_e){if(1&me&&(y.I0R(0,"mat-card",18)(1,"mat-list"),y.yuY(2,I,2,4,"ng-template",10),y.wVc(3,"async"),y.C$Y()()),2&me){const de=y.GaO();y.yG2(2),y.E7m("ngForOf",y.kDX(3,1,de.store.view.all$()))}}let s=(()=>{class me{overlay;elRef;cdRef;mediaService;actionbarMode=E;collapsed=!1;toggleCollapseAction={id:"actionbar_toggle",icon:"more_vert",handler:()=>{this.collapsed=!this.collapsed}};watcher;heightCondition$=new P.g(!1);positionConditionTop$=new P.g(!0);positionConditionLow$=new P.g(!0);store;mode=E.Dock;withToggleButton=!1;horizontal=!1;color="default";iconColor="default";withTitle=!0;withTooltip=!0;scrollActive=!0;withIcon=!0;icon="more_horiz";xPosition="before";yPosition="above";set overlayClass(de){this._overlayClass=de}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}_overlayClass="";isCollapsed=this.collapsed;get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const de=this.elRef.nativeElement;return!1===this.scrollActive&&de.clientHeight<de.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const de=this.elRef.nativeElement;return!(de.scrollTop>=de.scrollHeight-de.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===S.oZ.Desktop}constructor(de,le,ue,ne){this.overlay=de,this.elRef=le,this.cdRef=ue,this.mediaService=ne}ngOnChanges(de){const le=de.store;le&&le.currentValue!==le.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new a.YX(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(de){de.handler(...de.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}static \u0275fac=function(le){return new(le||me)(y.GI1(j.mc),y.GI1(y.GMv),y.GI1(y.kD9),y.GI1(S.QB))};static \u0275cmp=y.In1({type:me,selectors:[["igo-actionbar"]],hostVars:8,hostBindings:function(le,ue){2&le&&y.eAK("is-collapsed",ue.isCollapsed)("with-title",ue.withTitleClass)("with-icon",ue.withIconClass)("horizontal",ue.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},standalone:!0,features:[y.SYr,y.UHJ],decls:5,vars:5,consts:[["id","topChevron",4,"ngIf"],["matListItemIcon","",4,"ngIf"],["id","lowChevron",4,"ngIf"],[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["matListItemIcon",""],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(le,ue){1&le&&y.yuY(0,A,5,3,"div",0)(1,U,3,2,"mat-list",1)(2,G,5,3,"div",2)(3,D,10,14,"div",3)(4,M,4,3,"mat-card",4),2&le&&(y.E7m("ngIf",ue.heightCondition&&ue.positionConditionTop&&ue.isDesktop),y.yG2(),y.E7m("ngIf",ue.mode===ue.actionbarMode.Dock),y.yG2(),y.E7m("ngIf",ue.heightCondition&&ue.positionConditionLow&&ue.isDesktop),y.yG2(),y.E7m("ngIf",ue.mode===ue.actionbarMode.Overlay),y.yG2(),y.E7m("ngIf",ue.mode===ue.actionbarMode.Context))},dependencies:[p.u_,e.oJ,e.um,_.KO,_.a4,o.oB,o.qL,R.iI,R.oL,R.Y1,K,p.Iw,L._A,L.aM,L.yG,c.NR,c.SM,p.a,C._s,J.sD],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:unset}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .buttonOverlay[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3;display:flex;justify-content:center}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}@supports (-ms-accelerator: true){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}[_nghost-%COMP%]   #lowChevron[_ngcontent-%COMP%]{position:sticky;bottom:0;background-color:#fff;z-index:3;display:flex;justify-content:center}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]{min-width:inherit!important;padding-top:0;padding-bottom:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:0;padding-bottom:0}[_nghost-%COMP%]     .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}"],changeDetection:0})}return me})()},3735:(Pe,ae,r)=>{"use strict";r.d(ae,{q:()=>w});var E=r(32328),a=r(34896);let w=(()=>{class p{el;set igoMatBadgeIcon(c){this.html=`\n      <mat-icon class="mat-icon material-symbols-outlined" style="height: 16px; width: 16px; font-size: 16px;">${c}</mat-icon>\n    `,this.updateHtml()}html;set matBadgeHidden(c){this.hidden=c,this.updateHidden()}hidden=!1;set matBadgeDisabled(c){this.disabled=c,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(c){this.inverseColor=c,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(c){this.inheritColor=c,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(c){this.color=c,this.updateColor()}color;set igoMatBadgeBackgroundColor(c){this.backgroundColor=c,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(c){this.el=c}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateHtml()}updateHtml(){this.badge&&(this.badge.innerHTML="",this.html&&(this.badge.innerHTML=this.html))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(o){return new(o||p)(a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:p,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"},standalone:!0,features:[a.M5G([E.oB])]})}return p})()},92096:(Pe,ae,r)=>{"use strict";r.d(ae,{mK:()=>a,ii:()=>c});var E=r(34896);let a=(()=>{class R{renderer;el;get target(){return this._target}set target(_){this._target=_}_target;get collapsed(){return this._collapsed}set collapsed(_){_?this.collapseTarget():this.expandTarget(),this._collapsed=_,this.toggle.emit(_)}_collapsed=!1;toggle=new E._w7;click(){this.collapsed=!this.collapsed}constructor(_,C){this.renderer=_,this.el=C}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(C){return new(C||R)(E.GI1(E.q87),E.GI1(E.GMv))};static \u0275dir=E.Sc5({type:R,selectors:[["","igoCollapse",""]],hostBindings:function(C,S){1&C&&E.qCj("click",function(){return S.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0})}return R})();var w=r(32328),p=r(63916);const e=["*"];let c=(()=>{class R{get title(){return this._title}set title(_){this._title=_}_title="";get collapsed(){return this._collapsed}set collapsed(_){this._collapsed=_,this.toggle.emit(_)}_collapsed=!1;toggle=new E._w7;static \u0275fac=function(C){return new(C||R)};static \u0275cmp=E.In1({type:R,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0,features:[E.UHJ],ngContentSelectors:e,decls:8,vars:3,consts:[["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["content",""]],template:function(C,S){if(1&C&&(E.kPM(),E.I0R(0,"mat-list-item")(1,"mat-icon",0),E.qCj("toggle",function(y){return S.collapsed=y}),E.OEk(2," expand_less "),E.C$Y(),E.I0R(3,"span",1),E.OEk(4),E.C$Y()(),E.I0R(5,"div",null,2),E._Xx(7),E.C$Y()),2&C){const P=E.Gew(6);E.yG2(),E.E7m("target",P)("collapsed",S.collapsed),E.yG2(3),E.cNF(S.title)}},dependencies:[p.iI,p.g9,p.Y1,p.UV,w.oB,w.qL,a],styles:["[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]})}return R})()},37752:(Pe,ae,r)=>{"use strict";r.d(ae,{Ex:()=>o,uK:()=>R});var E=r(34672),a=r(40600),w=r(20460),p=r(34896),e=r(72584);let c=(()=>{class L{dialogRef;confirmMessage;titleKey="igo.common.confirmDialog.title";proccessKey="igo.common.confirmDialog.confirmBtn";cancelKey="igo.common.confirmDialog.cancelBtn";constructor(C){this.dialogRef=C}static \u0275fac=function(S){return new(S||L)(p.GI1(a.yI))};static \u0275cmp=p.In1({type:L,selectors:[["igo-confirm-dialog"]],standalone:!0,features:[p.UHJ],decls:13,vars:12,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-flat-button","",3,"click"]],template:function(S,P){1&S&&(p.I0R(0,"h2",0),p.OEk(1),p.wVc(2,"translate"),p.C$Y(),p.I0R(3,"div",1),p.OEk(4),p.wVc(5,"translate"),p.C$Y(),p.I0R(6,"div",2)(7,"button",3),p.qCj("click",function(){return P.dialogRef.close(!0)}),p.OEk(8),p.wVc(9,"translate"),p.C$Y(),p.I0R(10,"button",4),p.qCj("click",function(){return P.dialogRef.close(!1)}),p.OEk(11),p.wVc(12,"translate"),p.C$Y()()),2&S&&(p.yG2(),p.oRS(" ",p.kDX(2,4,P.titleKey),"\n"),p.yG2(3),p.oRS(" ",p.kDX(5,6,P.confirmMessage),"\n"),p.yG2(4),p.oRS(" ",p.kDX(9,8,P.proccessKey)," "),p.yG2(3),p.oRS(" ",p.kDX(12,10,P.cancelKey)," "))},dependencies:[a.WQ,a.iU,a.Yp,E.oJ,E.Gw,w._s,e.sD],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]})}return L})(),o=(()=>{class L{dialog;constructor(C){this.dialog=C}open(C,S){const P={title:"igo.common.confirmDialog.title",modeYesNo:!1,...S},y=this.dialog.open(c,{disableClose:!1});return y.componentInstance.confirmMessage=C,y.componentInstance.titleKey=P.title,P.modeYesNo&&(y.componentInstance.proccessKey="igo.common.confirmDialog.yes",y.componentInstance.cancelKey="igo.common.confirmDialog.no"),y.afterClosed()}static \u0275fac=function(S){return new(S||L)(p.CoB(a.qW))};static \u0275prov=p.wxM({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})(),R=(()=>{class L{static forRoot(){return{ngModule:L,providers:[]}}static \u0275fac=function(S){return new(S||L)};static \u0275mod=p.a4G({type:L});static \u0275inj=p.s3X({providers:[o],imports:[c]})}return L})()},53476:(Pe,ae,r)=>{"use strict";r.d(ae,{YM:()=>p,Ux:()=>w});var E=r(34896),a=r(50168);let w=(()=>{class c{_sanitizer;constructor(R){this._sanitizer=R}transform(R){return this._sanitizer.bypassSecurityTrustHtml(R)}static \u0275fac=function(L){return new(L||c)(E.GI1(a.mI,16))};static \u0275pipe=E.UTH({name:"sanitizeHtml",type:c,pure:!0,standalone:!0})}return c})(),p=(()=>{class c{get html(){return this._html}set html(R){this._html=R}_html="";constructor(){}static \u0275fac=function(L){return new(L||c)};static \u0275cmp=E.In1({type:c,selectors:[["igo-custom-html"]],inputs:{html:"html"},standalone:!0,features:[E.UHJ],decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(L,_){1&L&&(E.wR5(0,"div",0),E.wVc(1,"sanitizeHtml")),2&L&&E.E7m("innerHTML",E.kDX(1,1,_.html),E.E3n)},dependencies:[w],styles:["[_nghost-%COMP%]   .custom-html[_ngcontent-%COMP%]{padding:20px}"]})}return c})()},72968:(Pe,ae,r)=>{"use strict";r.d(ae,{O0:()=>p,qm:()=>R});var E=r(21296);class a{componentFactory;componentRef;subscriptions=[];target;inputs={};inputs$$={};subscribers={};constructor(_){this.componentFactory=_}setTarget(_){this.target=_,this.componentRef=_.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(_){if(this.inputs=_,void 0===this.componentRef)return;const C=this.componentRef.instance;this.componentFactory.inputs.forEach(P=>{const y=P.propName;this.unobserveInput(y);const F=_[y];_.hasOwnProperty(y)&&(F instanceof E._?this.observeInput(y,F):this.setInputValue(C,y,F))}),"function"==typeof C.onUpdateInputs&&C.onUpdateInputs()}setInputValue(_,C,S){if(S===_[C])return;const y=Object.getPrototypeOf(_),F=Object.getOwnPropertyDescriptor(y,C);void 0!==F&&void 0!==F.set?F.set.call(_,S):_[C]=S}updateSubscribers(_){if(this.subscribers=_,void 0===this.componentRef)return;const C=this.componentRef.instance;this.componentFactory.outputs.forEach(P=>{const y=P.propName;if(_.hasOwnProperty(y)){const F=C[y],h=_[y];Array.isArray(h)?h.forEach(W=>{this.subscriptions.push(F.subscribe(W))}):this.subscriptions.push(F.subscribe(h))}})}observeInput(_,C){this.inputs$$[_]=C.subscribe(S=>{const P=this.componentRef.instance;this.setInputValue(P,_,S),"function"==typeof P.onUpdateInputs&&P.onUpdateInputs()})}unobserveInput(_){void 0!==this.inputs$$[_]&&(this.inputs$$[_].unsubscribe(),this.inputs$$[_]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(_=>{void 0!==_&&_.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(_=>_.unsubscribe()),this.subscriptions=[]}}var w=r(34896);let p=(()=>{class L{resolver;constructor(C){this.resolver=C}create(C){const S=this.resolver.resolveComponentFactory(C);return new a(S)}static \u0275fac=function(S){return new(S||L)(w.CoB(w.ce5))};static \u0275prov=w.wxM({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})();var e=r(43168);const c=["target"];function o(L,_){}let R=(()=>{class L{dynamicComponentService;cdRef;component;inputs={};subscribers={};dynamicComponent;target;constructor(C,S){this.dynamicComponentService=C,this.cdRef=S}ngOnChanges(C){const S=C.component,P=C.inputs,y=C.subscribers,F=e.Yv.objectsAreEquivalent;if(S&&S.currentValue){if(S.currentValue!==S.previousValue)this.createComponent(S.currentValue);else{const h=P&&F(P.currentValue||{},P.previousValue||{}),W=y&&F(y.currentValue||{},y.previousValue||{});!1===h&&this.updateInputs(),!1===W&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(C){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=C instanceof a?C:this.dynamicComponentService.create(C),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}static \u0275fac=function(S){return new(S||L)(w.GI1(p),w.GI1(w.kD9))};static \u0275cmp=w.In1({type:L,selectors:[["igo-dynamic-outlet"]],viewQuery:function(S,P){if(1&S&&w.CC$(c,7,w.y8U),2&S){let y;w.wto(y=w.Gqi())&&(P.target=y.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},standalone:!0,features:[w.SYr,w.UHJ],decls:2,vars:0,consts:[["target",""]],template:function(S,P){1&S&&w.yuY(0,o,0,0,"ng-template",null,0,w.gJz)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return L})()},87040:(Pe,ae,r)=>{"use strict";r.d(ae,{sh:()=>M,qc:()=>z,qq:()=>j,xx:()=>A,uk:()=>K,YX:()=>Y,G8:()=>a,Eh:()=>Li,I7:()=>Ue,qK:()=>w,sH:()=>_,_I:()=>o,u6:()=>c,mU:()=>C,YB:()=>R,E$:()=>L});var a=function(Oe){return Oe.Default="Default",Oe.HTML="HTML",Oe.UnsanitizedHTML="UnsanitizedHTML",Oe.Editable="Editable",Oe.Icon="Icon",Oe.ButtonGroup="ButtonGroup",Oe}(a||{}),w=function(Oe){return Oe.Auto="auto",Oe.Instant="instant",Oe.Smooth="smooth",Oe}(w||{}),p=function(Oe){return Oe.None="None",Oe.All="All",Oe.Some="Some",Oe}(p||{}),e=r(63596);function c(Oe,ce){return(0,e.t)(Oe,ce).safeObject}function o(Oe){const ce=Oe.meta||{};return ce.id?ce.id:c(Oe,ce.idProperty||"id")}function R(Oe){const ce=Oe.meta||{};return ce.title?ce.title:c(Oe,ce.titleProperty||"title")}function L(Oe){const ce=Oe.meta||{};return ce.titleHtml?ce.titleHtml:c(Oe,ce.titleHtmlProperty||"titleHtml")}function _(Oe){const ce=Oe.meta||{};return ce.icon?ce.icon:c(Oe,ce.iconProperty||"icon")}function C(Oe){return(Oe.meta||{}).revision||0}var S=r(54844),P=r(23680);class y{options;index=new Map;change$=new P.o(1);getKey;constructor(ce={}){this.options=ce,this.getKey=ce.getKey?ce.getKey:o,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(ce){return this.index.get(this.getKey(ce))||{}}set(ce,te){this.setMany([ce],te)}setMany(ce,te){ce.forEach(re=>{this.index.set(this.getKey(re),Object.assign({},te))}),this.next()}setAll(ce){Array.from(this.index.keys()).forEach(te=>{this.index.set(te,Object.assign({},ce))}),this.next()}update(ce,te,re=!1){this.updateMany([ce],te,re)}updateMany(ce,te,re=!1){if(!0===re)return this.updateManyExclusive(ce,te);ce.forEach(he=>{const Me=Object.assign({},this.get(he),te);this.index.set(this.getKey(he),Me)}),this.next()}reverse(ce,te){this.reverseMany([ce],te)}reverseMany(ce,te){ce.forEach(re=>{const he=this.get(re),Me=te.reduce((Tt,vt)=>(Tt[vt]=he[vt]||!1,Tt),{}),Xe=this.reverseChanges(Me),tt=Object.assign({},he,Xe);this.index.set(this.getKey(re),tt)}),this.next()}updateAll(ce){const te=this.getAllKeys();Array.from(te).forEach(re=>{const he=Object.assign({},this.index.get(re),ce);this.index.set(re,he)}),this.next()}updateManyExclusive(ce,te){const re=this.reverseChanges(te),he=ce.map(Xe=>this.getKey(Xe));new Set(he.concat(Array.from(this.getAllKeys()))).forEach(Xe=>{const tt=this.index.get(Xe)||{};he.indexOf(Xe)>=0?this.index.set(Xe,Object.assign({},tt,te)):!0===Object.keys(re).some(vt=>void 0!==tt[vt]&&tt[vt]!==re[vt])&&this.index.set(Xe,Object.assign({},tt,re))}),this.next()}reverseChanges(ce){return Object.entries(ce).reduce((te,re)=>{const[he,Me]=re;return"boolean"==typeof Me&&(te[he]=!Me),te},{})}getAllKeys(){const ce=Array.from(this.options?.index?.keys()??[]);return new Set(Array.from(this.index.keys()).concat(ce))}next(){this.change$.next()}}var F=r(43168),h=r(35876),W=r(40604),J=r(68013),T=r(24112);class Q{source$;values$=new S.g([]);values$$;lifted=!1;joins=[];filter$=new S.g(void 0);filters$=new S.g([]);filterIndex=new Map;sort$=new S.g(void 0);get getKey(){return this.getKey$.value}getKey$=new S.g(void 0);count$=new S.g(0);get count(){return this.count$.value}empty$=new S.g(!0);get empty(){return this.empty$.value}get index(){return this._index}_index;constructor(ce){this.source$=ce}get(ce){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(ce)}all(){return this.values$.value}all$(){return this.values$}firstBy(ce){return this.values$.value.find(ce)}firstBy$(ce){return this.values$.pipe((0,W.k)(te=>te.find(ce)))}manyBy(ce){return this.values$.value.filter(ce)}manyBy$(ce){return this.values$.pipe((0,W.k)(te=>te.filter(ce)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(ce){return this._index=new Map,this.getKey$.next(ce),this}join(ce){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(ce),this}filter(ce){return this.filter$.next(ce),this}addFilter(ce){const te=(0,F.uq)();return this.filterIndex.set(te,ce),this.filters$.next(Array.from(this.filterIndex.values())),te}removeFilter(ce){this.filterIndex.delete(ce),this.filters$.next(Array.from(this.filterIndex.values()))}sort(ce){return this.sort$.next(ce),this}lift(){this.lifted=!0;const te=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,h.E)(te).pipe((0,J.s)(1),(0,T.o)(5)).subscribe(re=>{const[he,Me,Xe,tt,Tt]=re,vt=this.processValues(he,Me,Xe,tt);this.setValues(vt,void 0!==Tt)})}liftSource(){return this.source$}liftJoinedSource(){const ce=[this.source$,(0,h.E)(this.joins.map(te=>te.source))];return(0,h.E)(ce).pipe((0,W.k)(te=>{const[re,he]=te;return re.reduce((Me,Xe)=>{const tt=this.computeJoinedValue(Xe,he);return void 0!==tt&&Me.push(tt),Me},[])}))}computeJoinedValue(ce,te){let re=ce,he=0;for(;void 0!==re&&he<this.joins.length;)re=this.joins[he].reduce(re,te[he]),he+=1;return re}processValues(ce,te,re,he){return ce=ce.slice(0),ce=this.filterValues(ce,te.concat([re])),this.sortValues(ce,he)}filterValues(ce,te){return 0===te.length?ce:ce.filter(re=>te.filter(he=>void 0!==he).every(he=>he(re)))}sortValues(ce,te){return void 0===te?ce:ce.sort((re,he)=>F.Yv.naturalCompare(te.valueAccessor(re),te.valueAccessor(he),te.direction,te.nullsFirst))}setValues(ce,te){!0===te&&(this._index=this.generateIndex(ce)),this.values$.next(ce);const re=ce.length,he=0===re;this.count$.next(re),this.empty$.next(he)}generateIndex(ce){const te=ce.map(re=>[this.getKey(re),re]);return new Map(te)}}class z{entities$=new S.g([]);count$=new S.g(0);get count(){return this.count$.value}empty$=new S.g(!0);get empty(){return this.empty$.value}state;view;stateView;getKey;getProperty;get index(){return this._index}_index;get pristine(){return this._pristine}_pristine=!0;strategies=[];constructor(ce,te={}){this.getKey=te.getKey?te.getKey:o,this.getProperty=te.getProperty?te.getProperty:c,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),ce.length>0?this.load(ce):this._index=this.generateIndex(ce)}get(ce){return this.index.get(ce)}all(){return this.entities$.value}load(ce,te=!0){this._index=this.generateIndex(ce),this._pristine=te,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(ce){this.insertMany([ce])}insertMany(ce){ce.forEach(te=>this.index.set(this.getKey(te),te)),this._pristine=!1,this.next()}update(ce){this.updateMany([ce])}updateMany(ce){ce.forEach(te=>this.index.set(this.getKey(te),te)),this._pristine=!1,this.next()}addStrategy(ce,te=!1){if(void 0!==this.strategies.find(he=>ce.constructor===he.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(ce),ce.bindStore(this),!0===te&&ce.activate(),this}removeStrategy(ce){const te=this.strategies.indexOf(ce);return te>=0&&(this.strategies.splice(te,1),ce.unbindStore(this)),this}getStrategyOfType(ce){return this.strategies.find(te=>te instanceof ce)}activateStrategyOfType(ce){const te=this.getStrategyOfType(ce);void 0!==te&&te.activate()}deactivateStrategyOfType(ce){const te=this.getStrategyOfType(ce);void 0!==te&&te.deactivate()}delete(ce){this.deleteMany([ce])}deleteMany(ce){ce.forEach(te=>this.index.delete(this.getKey(te))),this._pristine=!1,this.next()}generateIndex(ce){const te=ce.map(re=>[this.getKey(re),re]);return new Map(te)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const ce=this.index.size,te=0===ce;this.count$.next(ce),this.empty$.next(te)}createStateManager(){return new y({getKey:this.getKey,index:this.index})}createDataView(){return new Q(this.entities$)}createStateView(){return new Q(this.view.all$()).join({source:this.state.change$,reduce:ce=>{const te=this.getKey(ce),re=this.state.get(ce),he=this.stateView.get(te);if(void 0!==he&&he.entity===ce&&this.statesAreTheSame(he.state,re))return he;const Me=he?he.revision+1:1;return{entity:ce,state:re,revision:Me,ref:`${te}-${Me}`}}}).createIndex(ce=>this.getKey(ce.entity))}statesAreTheSame(ce,te){if(ce===te)return!0;const re=0===Object.keys(ce).length,he=0===Object.keys(te).length;return re&&he}}class Y{cdRef;store;innerStateIndex=new Map;entities$$;state$$;constructor(ce,te){this.setChangeDetector(te),this.setStore(ce)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(ce){if(void 0===ce)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=ce,this.setupObservers(),this.detectChanges()}setChangeDetector(ce){this.cdRef=ce}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(ce=>this.onEntitiesChange(ce)),this.state$$=this.store.state.change$.pipe((0,J.s)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(ce){this.detectChanges()}onStateChange(){let ce=!1;const te=this.store.state.index,re=this.innerStateIndex;te.size!==re.size&&(ce=this.detectChanges());const he=Array.from(te.keys());for(const Me of he){const Xe=te.get(Me),tt=re.get(Me);!1===ce&&(void 0===tt?ce=this.detectChanges():F.Yv.objectsAreEquivalent(Xe,tt)||(ce=this.detectChanges())),this.innerStateIndex.set(Me,Object.assign({},Xe))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}class K{options;stores=[];get active(){return this.active$.value}active$=new S.g(!1);constructor(ce={}){this.options=ce,this.options=ce}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(ce){this.stores.indexOf(ce)<0&&this.stores.push(ce)}unbindStore(ce){const te=this.stores.indexOf(ce);te>=0&&this.stores.splice(te,1)}doActivate(){}doDeactivate(){}}class j extends K{options;constructor(ce){super(ce),this.options=ce}filters=new Map;bindStore(ce){super.bindStore(ce),!0===this.active&&this.filterStore(ce)}unbindStore(ce){super.unbindStore(ce),!0===this.active&&this.unfilterStore(ce)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(ce=>this.filterStore(ce))}unfilterAll(){this.stores.forEach(ce=>this.unfilterStore(ce))}filterStore(ce){this.filters.set(ce,ce.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(ce){const te=this.filters.get(ce);void 0!==te&&(ce.stateView.removeFilter(te),this.filters.delete(ce))}}class A extends K{filters=new Map;bindStore(ce){super.bindStore(ce),!0===this.active&&this.filterStore(ce)}unbindStore(ce){super.unbindStore(ce),!0===this.active&&this.unfilterStore(ce)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(ce=>this.filterStore(ce))}unfilterAll(){this.stores.forEach(ce=>this.unfilterStore(ce))}filterStore(ce){this.filters.has(ce)||this.filters.set(ce,ce.stateView.addFilter(re=>!0===re.state.selected))}unfilterStore(ce){const te=this.filters.get(ce);void 0!==te&&(ce.stateView.removeFilter(te),this.filters.delete(ce))}}var d=r(65056),u=r(34896),x=r(46176),U=r(50244),G=r(77872);function X(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-option",4),u.OEk(1),u.C$Y()),2&Oe){const te=u.GaO();u.E7m("value",te.emptyValue),u.yG2(),u.cNF(te.emptyText)}}function D(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-option",4),u.OEk(1),u.wVc(2,"async"),u.C$Y()),2&Oe){const te=u.GaO();u.E7m("value",te.multiSelectValue),u.yG2(),u.cNF(u.kDX(2,2,te.multiText$))}}function I(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-option",4),u.OEk(1),u.C$Y()),2&Oe){const te=ce.$implicit,re=u.GaO();u.E7m("value",te.entity),u.yG2(),u.oRS(" ",re.titleAccessor(te.entity)," ")}}let M=(()=>{class Oe{cdRef;selected$=new S.g(void 0);multiText$=new S.g(void 0);multiSelectValue={id:"IGO_MULTI_SELECT"};emptyValue={id:"IGO_EMPTY_SELECT"};selected$$;watcher;store;titleAccessor=R;emptyText=void 0;multi=!1;multiAllText="All";multiNoneText="None";placeholder;disabled=!1;selectedChange=new u._w7;constructor(te){this.cdRef=te}ngOnInit(){this.watcher=new Y(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(te=>!0===te.state.selected).subscribe(te=>{const re=te.map(he=>he.entity);this.onSelectFromStore(re)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(te){const re=te.value instanceof Array?te.value:[te.value],he=re.find(tt=>tt===this.multiSelectValue);let Me=re.filter(tt=>tt!==this.multiSelectValue);void 0!==he&&(Me.length===this.store.count?Me=[]:Me.length<this.store.count&&(Me=this.store.all())),Me=Me.filter(tt=>tt!==this.emptyValue),0===Me.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(Me,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?Me:te.value})}onSelectFromStore(te){this.selected$.next(!0===this.multi?te:te.length>0?te[0]:void 0),this.updateMultiToggleWithEntities(te)}updateMultiToggleWithEntities(te){te.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):te.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}static \u0275fac=function(re){return new(re||Oe)(u.GI1(u.kD9))};static \u0275cmp=u.In1({type:Oe,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[u.UHJ],decls:7,vars:11,consts:[["subscriptSizing","dynamic",1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(re,he){1&re&&(u.I0R(0,"mat-form-field",0)(1,"mat-select",1),u.qCj("selectionChange",function(Xe){return he.onSelectionChange(Xe)}),u.wVc(2,"async"),u.yuY(3,X,2,2,"mat-option",2)(4,D,3,4,"mat-option",2)(5,I,2,2,"ng-template",3),u.wVc(6,"async"),u.C$Y()()),2&re&&(u.yG2(),u.E7m("disabled",he.disabled)("value",u.kDX(2,7,he.selected$))("multiple",he.multi)("placeholder",he.placeholder),u.yG2(2),u.E7m("ngIf",void 0!==he.emptyText&&!1===he.multi),u.yG2(),u.E7m("ngIf",!0===he.multi),u.yG2(),u.E7m("ngForOf",u.kDX(6,9,he.store.stateView.all$())))},dependencies:[U.wb,U.Up,G.d5,G.kX,x.I5,d.u_,x.Ax,d.Iw,d.a],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}return Oe})();var H=r(71904),Z=r(61792),me=r(69400),_e=r(34672),de=r(58539),le=r(24392),ue=r(32328),ne=r(42536),ve=r(76768),ye=r(80956),Le=r(27e3),He=r(53476),Ve=r(75684),Ge=r(90568),ct=r(20460),Ie=r(30816),Ye=r.n(Ie),se=r(21296),ge=r(54872),Re=r(56264);let Ue=(()=>{class Oe{languageService;mediaService;disabled=!1;hidePageSize=!1;pageIndex=0;pageSize=50;pageSizeOptions=[5,10,20,50,100,200];showFirstLastButtons=!0;count$$;entitySortChange$$;paginationLabelTranslation$$=[];entitySortChange$=new S.g(!1);store;paginatorOptions;page;length=0;paginatorChange=new u._w7;constructor(te,re){this.languageService=te,this.mediaService=re}paginator;ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(te=>{this.length=te,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){this.disabled=this.paginatorOptions?.disabled||this.disabled,this.pageIndex=this.paginatorOptions?.pageIndex||this.pageIndex,this.pageSize=this.paginatorOptions?.pageSize||this.pageSize,this.pageSizeOptions=this.paginatorOptions?.pageSizeOptions||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=this.paginatorOptions?.showFirstLastButtons||this.showFirstLastButtons,this.hidePageSize=this.paginatorOptions?.hidePageSize||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(te=>{this.paginator._intl.firstPageLabel=te})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(te=>{this.paginator._intl.itemsPerPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(te=>{this.paginator._intl.lastPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(te=>{this.paginator._intl.nextPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(te=>{this.paginator._intl.previousPageLabel=te}))}rangeLabel=(te,re,he)=>{const Me=new S.g("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(Tt=>{Me.next(Tt)})),0===he||0===re)return`0 ${Me.value} ${he}`;const Xe=te*re;return`${Xe+1} - ${Xe<(he=Math.max(he,0))?Math.min(Xe+re,he):Xe+re} ${Me.value} ${he}`};unsubscribeAll(){this.paginationLabelTranslation$$.map(te=>te.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}static \u0275fac=function(re){return new(re||Oe)(u.GI1(ct.ov),u.GI1(Re.QB))};static \u0275cmp=u.In1({type:Oe,selectors:[["igo-entity-table-paginator"]],viewQuery:function(re,he){if(1&re&&u.CC$(ge.Qb,7),2&re){let Me;u.wto(Me=u.Gqi())&&(he.paginator=Me.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},standalone:!0,features:[u.SYr,u.UHJ],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(re,he){1&re&&(u.I0R(0,"mat-paginator",0),u.qCj("page",function(){return he.emitPaginator()}),u.C$Y()),2&re&&u.E7m("disabled",he.disabled)("hidePageSize",he.hidePageSize)("length",he.length)("pageIndex",he.pageIndex)("pageSize",he.pageSize)("pageSizeOptions",he.pageSizeOptions)("showFirstLastButtons",he.showFirstLastButtons)},dependencies:[ge.w5,ge.Qb],styles:["[_nghost-%COMP%]     .mat-mdc-paginator-container{min-height:unset}"],changeDetection:0})}return Oe})();var ze=r(89888);let Be=(()=>{class Oe{renderer;el;static selectedCls="igo-entity-table-row-selected";static highlightedCls="igo-entity-table-row-highlighted";selection=!1;selectOnClick=!0;highlightSelection=!0;set selected(te){!1!==this.selection&&te!==this._selected&&(this.toggleSelected(te),this.scroll())}get selected(){return this._selected}_selected=!1;scrollBehavior=w.Auto;select=new u._w7;onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}constructor(te,re){this.renderer=te,this.el=re}toggleSelected(te){this._selected=te,!0===te?(this.addCls(Oe.selectedCls),!0===this.highlightSelection&&this.addCls(Oe.highlightedCls)):(this.removeCls(Oe.selectedCls),this.removeCls(Oe.highlightedCls))}scroll(){!0===this._selected&&(0,ze.c)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(te){this.renderer.addClass(this.el.nativeElement,te)}removeCls(te){this.renderer.removeClass(this.el.nativeElement,te)}static \u0275fac=function(re){return new(re||Oe)(u.GI1(u.q87),u.GI1(u.GMv))};static \u0275dir=u.Sc5({type:Oe,selectors:[["","igoEntityTableRow",""]],hostBindings:function(re,he){1&re&&u.qCj("click",function(){return he.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"},standalone:!0})}return Oe})();var st=r(42664),xe=r(72584);function Ke(Oe,ce){if(1&Oe){const te=u.KQA();u.SAx(0),u.I0R(1,"mat-checkbox",11),u.qCj("change",function(he){u.usT(te);const Me=u.GaO(3);return u.CGJ(Me.onToggleRows(he.checked))}),u.C$Y(),u.k70()}if(2&Oe){const te=ce.ngIf,re=u.GaO(3);u.yG2(),u.E7m("checked",te===re.entityTableSelectionState.All)("indeterminate",te===re.entityTableSelectionState.Some)}}function Qe(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,Ke,2,2,"ng-container",10),u.wVc(2,"async"),u.k70()),2&Oe){const te=u.GaO(2);u.yG2(),u.E7m("ngIf",u.kDX(2,1,te.selectionState$))}}function It(Oe,ce){if(1&Oe&&(u.I0R(0,"th",9),u.yuY(1,Qe,3,3,"ng-container",10),u.C$Y()),2&Oe){const te=u.GaO();u.yG2(),u.E7m("ngIf",te.selectMany)}}function at(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"td",12)(1,"mat-checkbox",13),u.qCj("mousedown",function(he){return he.shiftKey?he.preventDefault():null})("click",function(he){const Xe=u.usT(te).$implicit,tt=u.GaO();return u.CGJ(he.shiftKey?tt.onShiftToggleRow(!tt.rowIsSelected(Xe.record),Xe.record,he):he.stopPropagation())})("change",function(he){const Xe=u.usT(te).$implicit,tt=u.GaO();return u.CGJ(tt.onToggleRow(he.checked,Xe.record))}),u.C$Y()()}if(2&Oe){const te=ce.$implicit,re=u.GaO();u.yG2(),u.E7m("checked",re.rowIsSelected(te.record))}}function Ft(Oe,ce){if(1&Oe&&(u.I0R(0,"th",16),u.OEk(1),u.C$Y()),2&Oe){const te=u.GaO(2).$implicit;u.E7m("matTooltip",te.tooltip?te.tooltip:void 0),u.yG2(),u.oRS(" ",te.title," ")}}function Et(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,Ft,2,2,"th",15),u.k70())}function Kt(Oe,ce){if(1&Oe&&(u.I0R(0,"th",18),u.OEk(1),u.C$Y()),2&Oe){const te=u.GaO(2).$implicit;u.E7m("matTooltip",te.tooltip?te.tooltip:void 0),u.yG2(),u.oRS(" ",te.title," ")}}function yt(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,Kt,2,2,"th",17),u.k70())}function Oo(Oe,ce){if(1&Oe&&(u.I0R(0,"td",22),u.OEk(1),u.C$Y()),2&Oe){const te=u.GaO().$implicit,re=u.GaO(3).$implicit;u.E7m("ngClass",te.cellData[re.name].class),u.yG2(),u.oRS(" ",te.cellData[re.name].value," ")}}function ei(Oe,ce){if(1&Oe&&(u.wR5(0,"img",26),u.wVc(1,"async"),u.wVc(2,"secureImage")),2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit;u._6D("src",u.kDX(1,1,u.kDX(2,3,te.cellData[re.name].value)),u.K6U)}}function Pt(Oe,ce){1&Oe&&(u.I0R(0,"span"),u.OEk(1),u.wVc(2,"translate"),u.C$Y()),2&Oe&&(u.yG2(),u.oRS("",u.kDX(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function xt(Oe,ce){if(1&Oe&&(u.I0R(0,"td",22)(1,"a",23),u.qCj("click",function(re){return re.stopPropagation()}),u.yuY(2,ei,3,5,"img",24)(3,Pt,3,3,"ng-template",null,25,u.gJz),u.C$Y()()),2&Oe){const te=u.Gew(4),re=u.GaO().$implicit,he=u.GaO(3).$implicit;u.E7m("ngClass",re.cellData[he.name].class),u.yG2(),u._6D("href",re.cellData[he.name].value,u.K6U),u.yG2(),u.E7m("ngIf",re.cellData[he.name].isImg)("ngIfElse",te)}}function ut(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,Oo,2,2,"td",20)(2,xt,5,4,"ng-template",null,21,u.gJz),u.k70()),2&Oe){const te=ce.$implicit,re=u.Gew(3),he=u.GaO(3).$implicit;u.yG2(),u.E7m("ngIf",!te.cellData[he.name].isUrl)("ngIfElse",re)}}function Go(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,ut,4,2,"ng-container",19),u.k70())}function Ze(Oe,ce){if(1&Oe&&u.wR5(0,"td",29),2&Oe){const te=u.GaO().$implicit,re=u.GaO(3).$implicit;u.E7m("ngClass",te.cellData[re.name].class)("innerHTML",te.cellData[re.name].value,u.E3n)}}function Io(Oe,ce){if(1&Oe&&(u.wR5(0,"img",26),u.wVc(1,"async"),u.wVc(2,"secureImage")),2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit;u._6D("src",u.kDX(1,1,u.kDX(2,3,te.cellData[re.name].value)),u.K6U)}}function Xt(Oe,ce){1&Oe&&(u.I0R(0,"span"),u.OEk(1),u.wVc(2,"translate"),u.C$Y()),2&Oe&&(u.yG2(),u.oRS("",u.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function eo(Oe,ce){if(1&Oe&&(u.I0R(0,"td",22)(1,"a",23),u.qCj("click",function(re){return re.stopPropagation()}),u.yuY(2,Io,3,5,"img",24)(3,Xt,3,3,"ng-template",null,25,u.gJz),u.C$Y()()),2&Oe){const te=u.Gew(4),re=u.GaO().$implicit,he=u.GaO(3).$implicit;u.E7m("ngClass",re.cellData[he.name].class),u.yG2(),u._6D("href",re.cellData[he.name].value,u.K6U),u.yG2(),u.E7m("ngIf",re.cellData[he.name].isImg)("ngIfElse",te)}}function $o(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,Ze,1,2,"td",27)(2,eo,5,4,"ng-template",null,28,u.gJz),u.k70()),2&Oe){const te=ce.$implicit,re=u.Gew(3),he=u.GaO(3).$implicit;u.yG2(),u.E7m("ngIf",!te.cellData[he.name].isUrl)("ngIfElse",re)}}function Ao(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,$o,4,2,"ng-container",19),u.k70())}function No(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"div",43),u.wR5(1,"mat-datepicker-toggle",44),u.I0R(2,"input",45),u.qCj("dateChange",function(he){u.usT(te);const Me=u.GaO(2).$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onDateChange(Xe.name,Me.record,he))}),u.C$Y(),u.wR5(3,"mat-datepicker",null,46),u.C$Y()}if(2&Oe){const te=u.Gew(4),re=u.GaO(2).$implicit,he=u.GaO(3).$implicit;u.yG2(),u.E7m("for",te),u.yG2(),u._6D("value",re.cellData[he.name].value),u.E7m("matDatepicker",te)("formControlName",he.name)}}function pi(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"input",47),u.qCj("focus",function(he){u.usT(te);const Me=u.GaO(5).$implicit;return u.CGJ(Me.onFocus(he))})("keypress",function(he){u.usT(te);const Me=u.GaO(5).$implicit;return u.CGJ(Me.onChange(he))})("blur",function(he){u.usT(te);const Me=u.GaO(5).$implicit;return u.CGJ(Me.onBlur(he))}),u.C$Y()}if(2&Oe){const te=u.GaO(5).$implicit;u.E7m("formControlName",te.name)}}function no(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"input",48),u.qCj("input",function(he){u.usT(te);const Me=u.GaO(2).$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onValueChange(Xe.name,Me.record,he))}),u.C$Y()}if(2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit,he=u.GaO();u._6D("step",re.step),u._6D("value",te.cellData[re.name].value),u._6D("readonly",he.getValidationAttributeValue(re,"readonly")),u._6D("required",he.getValidationAttributeValue(re,"mandatory")),u._6D("min",he.getValidationAttributeValue(re,"minValue")),u._6D("max",he.getValidationAttributeValue(re,"maxValue")),u.E7m("formControlName",re.name)}}function ro(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"input",49),u.qCj("input",function(he){u.usT(te);const Me=u.GaO(2).$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onValueChange(Xe.name,Me.record,he))}),u.C$Y()}if(2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit,he=u.GaO();u._6D("value",te.cellData[re.name].value),u._6D("readonly",he.getValidationAttributeValue(re,"readonly")),u._6D("required",he.getValidationAttributeValue(re,"mandatory")),u.E7m("formControlName",re.name)}}function pt(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"mat-checkbox",50),u.qCj("change",function(he){u.usT(te);const Me=u.GaO(2).$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onBooleanValueChange(Xe.name,Me.record,he))}),u.C$Y()}if(2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit;u.E7m("formControlName",re.name)("checked",te.cellData[re.name].value)}}function wo(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-option",53),u.OEk(1),u.C$Y()),2&Oe){const te=ce.$implicit;u.E7m("value",te.id)("disabled",te.disabled),u.yG2(),u.oRS(" ",te.value," ")}}function ti(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"mat-select",51),u.qCj("selectionChange",function(he){u.usT(te);const Me=u.GaO(2).$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onSelectValueChange(Xe.name,Me.record,he))}),u.yuY(1,wo,2,3,"mat-option",52),u.C$Y()}if(2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit,he=u.GaO();u._6D("required",he.getValidationAttributeValue(re,"mandatory")),u.E7m("formControlName",re.name)("multiple",re.multiple)("value",te.cellData[re.name].value),u.yG2(),u.E7m("ngForOf",re.domainValues)}}function Ho(Oe,ce){if(1&Oe&&u.wR5(0,"input",54),2&Oe){u.GaO();const te=u.Gew(9),re=u.GaO().$implicit,he=u.GaO(3).$implicit,Me=u.GaO();u._6D("required",Me.getValidationAttributeValue(he,"mandatory")),u._6D("value",re.cellData[he.name].value),u._6D("readonly",Me.getValidationAttributeValue(he,"readonly")),u.E7m("formControlName",he.name)("matAutocomplete",te)}}function Ri(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-option",55),u.OEk(1),u.C$Y()),2&Oe){const te=ce.$implicit;u.E7m("value",te.id),u.yG2(),u.oRS(" ",te.value," ")}}function To(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"td",32),u.yuY(1,No,5,4,"div",33)(2,pi,1,1,"input",34)(3,no,1,7,"input",35)(4,ro,1,4,"input",36)(5,pt,1,2,"mat-checkbox",37)(6,ti,2,5,"mat-select",38)(7,Ho,1,5,"input",39),u.I0R(8,"mat-autocomplete",40,41),u.qCj("optionSelected",function(he){u.usT(te);const Me=u.GaO().$implicit,Xe=u.GaO(3).$implicit,tt=u.GaO();return u.CGJ(tt.onAutocompleteValueChange(Xe,Me.record,he))}),u.yuY(10,Ri,2,2,"mat-option",42),u.wVc(11,"async"),u.C$Y()()}if(2&Oe){const te=u.GaO().$implicit,re=u.GaO(3).$implicit,he=u.GaO();u.E7m("formGroup",he.formGroup)("ngClass",te.cellData[re.name].class),u.yG2(),u.E7m("ngIf","date"===re.type),u.yG2(),u.E7m("ngIf","time"===re.type),u.yG2(),u.E7m("ngIf","number"===re.type),u.yG2(),u.E7m("ngIf",!re.type||"string"===re.type),u.yG2(),u.E7m("ngIf","boolean"===re.type),u.yG2(),u.E7m("ngIf","list"===re.type),u.yG2(),u.E7m("ngIf","autocomplete"===re.type),u.yG2(3),u.E7m("ngForOf",u.kDX(11,10,he.filteredOptions[re.name]))}}function Eo(Oe,ce){if(1&Oe&&(u.wR5(0,"td",29),u.wVc(1,"sanitizeHtml")),2&Oe){const te=u.GaO(2).$implicit,re=u.GaO(3).$implicit;u.E7m("ngClass",te.cellData[re.name].class)("innerHTML",u.kDX(1,2,te.cellData[re.name].value),u.E3n)}}function so(Oe,ce){if(1&Oe&&(u.wR5(0,"img",26),u.wVc(1,"async"),u.wVc(2,"secureImage")),2&Oe){const te=u.GaO(3).$implicit,re=u.GaO(3).$implicit;u._6D("src",u.kDX(1,1,u.kDX(2,3,te.cellData[re.name].value)),u.K6U)}}function to(Oe,ce){1&Oe&&(u.I0R(0,"span"),u.OEk(1),u.wVc(2,"translate"),u.C$Y()),2&Oe&&(u.yG2(),u.oRS("",u.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function Mt(Oe,ce){if(1&Oe&&(u.I0R(0,"td",22)(1,"a",23),u.qCj("click",function(re){return re.stopPropagation()}),u.yuY(2,so,3,5,"img",24)(3,to,3,3,"ng-template",null,25,u.gJz),u.C$Y()()),2&Oe){const te=u.Gew(4),re=u.GaO(2).$implicit,he=u.GaO(3).$implicit;u.E7m("ngClass",re.cellData[he.name].class),u.yG2(),u._6D("href",re.cellData[he.name].value,u.K6U),u.yG2(),u.E7m("ngIf",re.cellData[he.name].isImg)("ngIfElse",te)}}function _o(Oe,ce){if(1&Oe&&u.yuY(0,Eo,2,4,"td",27)(1,Mt,5,4,"ng-template",null,56,u.gJz),2&Oe){const te=u.Gew(2),re=u.GaO().$implicit,he=u.GaO(3).$implicit;u.E7m("ngIf",!re.cellData[he.name].isUrl)("ngIfElse",te)}}function ko(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,To,12,12,"td",30)(2,_o,3,2,"ng-template",null,31,u.gJz),u.k70()),2&Oe){const te=ce.$implicit,re=u.Gew(3),he=u.GaO(4);u.yG2(),u.E7m("ngIf",he.isEdition(te.record))("ngIfElse",re)}}function Bo(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,ko,4,2,"ng-container",19),u.k70())}function Jt(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"mat-icon",59),u.qCj("click",function(he){u.usT(te);const Me=u.GaO(4).$implicit;return u.CGJ(Me.onClick(he))}),u.OEk(1),u.C$Y()}if(2&Oe){const te=u.GaO().$implicit,re=u.GaO(3).$implicit;u.yG2(),u.cNF(te.cellData[re.name].value||re.icon)}}function Uo(Oe,ce){if(1&Oe&&(u.I0R(0,"mat-icon"),u.OEk(1),u.C$Y()),2&Oe){const te=u.GaO().$implicit,re=u.GaO(3).$implicit;u.yG2(),u.cNF(te.cellData[re.name].value||re.icon)}}function xo(Oe,ce){if(1&Oe&&(u.I0R(0,"td",22),u.yuY(1,Jt,2,1,"mat-icon",58)(2,Uo,2,1,"mat-icon",10),u.C$Y()),2&Oe){const te=ce.$implicit,re=u.GaO(3).$implicit;u.E7m("ngClass",te.cellData[re.name].class),u.yG2(),u.E7m("ngIf",re.onClick),u.yG2(),u.E7m("ngIf",!re.onClick)}}function Yo(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,xo,3,3,"td",57),u.k70())}function Yt(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"button",63),u.qCj("mousedown",function(){u.usT(te);const he=u.GaO(2).$implicit,Me=u.GaO().$implicit,Xe=u.GaO(4);return u.CGJ(Xe.onButtonClick(he.click,Me.record))}),u.I0R(1,"mat-icon"),u.OEk(2),u.C$Y()()}if(2&Oe){const te=u.GaO(2).$implicit;u.E7m("color",te.color)("disabled",te.disabled),u.yG2(2),u.cNF(te.icon)}}function Mo(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"button",64),u.qCj("mousedown",function(){u.usT(te);const he=u.GaO(2).$implicit,Me=u.GaO().$implicit,Xe=u.GaO(4);return u.CGJ(Xe.onButtonClick(he.click,Me.record))}),u.I0R(1,"mat-icon"),u.OEk(2),u.C$Y()()}if(2&Oe){const te=u.GaO(2).$implicit;u.E7m("color",te.color)("disabled",te.disabled),u.yG2(2),u.cNF(te.icon)}}function Vo(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,Yt,3,3,"button",61)(2,Mo,3,3,"button",62),u.k70()),2&Oe){const te=u.GaO().$implicit;u.yG2(),u.E7m("ngIf","mat-icon-button"===te.style),u.yG2(),u.E7m("ngIf","mat-icon-button"!==te.style)}}function we(Oe,ce){if(1&Oe&&(u.I0R(0,"span"),u.yuY(1,Vo,3,2,"ng-container",10),u.C$Y()),2&Oe){const te=ce.$implicit,re=u.GaO().$implicit,he=u.GaO(4);u.yG2(),u.E7m("ngIf",he.isEdition(re.record)===te.editMode||void 0===te.editMode)}}function qe(Oe,ce){if(1&Oe&&(u.SAx(0),u.I0R(1,"td",22),u.yuY(2,we,2,1,"span",60),u.C$Y(),u.k70()),2&Oe){const te=ce.$implicit,re=u.GaO(3).$implicit;u.yG2(),u.E7m("ngClass",te.cellData[re.name].class),u.yG2(),u.E7m("ngForOf",te.cellData[re.name].value)}}function be(Oe,ce){1&Oe&&(u.SAx(0),u.yuY(1,qe,3,2,"ng-container",19),u.k70())}function De(Oe,ce){if(1&Oe&&(u.SAx(0),u.yuY(1,Go,2,0,"ng-container",10)(2,Ao,2,0,"ng-container",10)(3,Bo,2,0,"ng-container",10)(4,Yo,2,0,"ng-container",10)(5,be,2,0,"ng-container",10),u.k70()),2&Oe){const te=ce.ngIf,re=u.GaO(2);u.yG2(),u.E7m("ngIf",te===re.entityTableColumnRenderer.Default),u.yG2(),u.E7m("ngIf",te===re.entityTableColumnRenderer.HTML),u.yG2(),u.E7m("ngIf",te===re.entityTableColumnRenderer.UnsanitizedHTML),u.yG2(),u.E7m("ngIf",te===re.entityTableColumnRenderer.Icon),u.yG2(),u.E7m("ngIf",te===re.entityTableColumnRenderer.ButtonGroup)}}function $e(Oe,ce){if(1&Oe&&(u.SAx(0,14),u.yuY(1,Et,2,0,"ng-container",10)(2,yt,2,0,"ng-container",10)(3,De,6,5,"ng-container",10),u.k70()),2&Oe){const te=ce.$implicit,re=u.GaO();u.E7m("matColumnDef",te.name),u.yG2(),u.E7m("ngIf",re.columnIsSortable(te)),u.yG2(),u.E7m("ngIf",!re.columnIsSortable(te)),u.yG2(),u.E7m("ngIf",re.getColumnRenderer(te))}}function dt(Oe,ce){if(1&Oe&&u.wR5(0,"tr",65),2&Oe){const te=u.GaO();u.E7m("ngClass",te.getHeaderClass())}}function Qt(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"tr",66),u.qCj("select",function(){const Me=u.usT(te).$implicit,Xe=u.GaO();return u.CGJ(Xe.onRowSelect(Me.record))})("click",function(){const Me=u.usT(te).$implicit,Xe=u.GaO();return u.CGJ(Xe.onRowClick(Me.record))}),u.C$Y()}if(2&Oe){const te=ce.$implicit,re=u.GaO();u.E7m("scrollBehavior",re.scrollBehavior)("ngClass",re.getRowClass(te.record))("selection",re.selection)("selected",re.rowIsSelected(te.record))}}function Do(Oe,ce){if(1&Oe){const te=u.KQA();u.I0R(0,"igo-entity-table-paginator",67),u.qCj("paginatorChange",function(he){u.usT(te);const Me=u.GaO();return u.CGJ(Me.paginatorChange(he))}),u.C$Y()}if(2&Oe){const te=u.GaO();u.E7m("store",te.store)("paginatorOptions",te.paginatorOptions)("entitySortChange$",te.entitySortChange$)}}const mi=Oe=>({height:Oe});let Li=(()=>{class Oe{cdRef;formBuilder;_focusMonitor;_elementRef;ngControl;_parentForm;_controlName;_defaultErrorStateMatcher;dateAdapter;entitySortChange$=new S.g(!1);formGroup=new H.k1({});filteredOptions={};entityTableColumnRenderer=a;entityTableSelectionState=p;selectionState$=new S.g(void 0);selection$$;dataSource$$;lastRecordCheckedKey;store;set paginator(te){this._paginator=te,this.dataSource.paginator=te}get paginator(){return this._paginator}_paginator;template;scrollBehavior=w.Auto;sortNullsFirst=!1;withPaginator=!1;paginatorOptions;entityClick=new u._w7;entitySelectChange=new u._w7;entitySortChange=new u._w7(void 0);get headers(){let te=this.template.columns.filter(re=>!1!==re.visible).map(re=>re.name);return!0===this.selectionCheckbox&&(te=["selectionCheckbox"].concat(te)),te}dataSource=new ye._c;get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}constructor(te,re,he,Me,Xe,tt,Tt,vt,Co){this.cdRef=te,this.formBuilder=re,this._focusMonitor=he,this._elementRef=Me,this.ngControl=Xe,this._parentForm=tt,this._controlName=Tt,this._defaultErrorStateMatcher=vt,this.dateAdapter=Co,this.dateAdapter.setLocale("fr-CA")}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator,this.store.state.change$.pipe((0,T.o)(100)).subscribe(()=>{this.handleDatasource(),this.refresh()})}ngOnChanges(te){const re=te.store;re&&re.currentValue!==re.previousValue&&this.handleDatasource()}onValueChange(te,re,he){const Me=this.getColumnKeyWithoutPropertiesTag(te);re.entity.properties[Me]=he.target.value}onBooleanValueChange(te,re,he){const Me=this.getColumnKeyWithoutPropertiesTag(te);re.entity.properties[Me]=he.checked}onSelectValueChange(te,re,he){const Me=this.getColumnKeyWithoutPropertiesTag(te);re.entity.properties[Me]=he.value}onAutocompleteValueChange(te,re,he){this.formGroup.controls[te.name].setValue(he.option.viewValue);const Me=this.getColumnKeyWithoutPropertiesTag(te.name);re.entity.properties[Me]=he.option.value}onDateChange(te,re,he){const Xe=Ye()(he.value).format("YYYY-MM-DD"),tt=this.getColumnKeyWithoutPropertiesTag(te);re.entity.properties[tt]=Xe}enableEdit(te){const re=te.entity.properties||te.entity;this.template.columns.forEach(he=>{he.title=he.validation?.mandatory&&!he.title.includes("*")?he.title+" *":he.title;const Me=this.getColumnKeyWithoutPropertiesTag(he.name);if("boolean"===he.type)re[Me]&&null!==re[Me]?"string"==typeof re[Me]&&(re[Me]=JSON.parse(re[Me].toLowerCase())):re[Me]=!1,this.formGroup.setControl(he.name,this.formBuilder.control(re[Me]));else if("list"===he.type)he.multiple?this.formGroup.setControl(he.name,this.formBuilder.control([re[Me]])):(this.formGroup.setControl(he.name,this.formBuilder.control(re[Me])),this.formGroup.controls[he.name].setValue("string"==typeof re[Me]?parseInt(re[Me]):re[Me]));else if("autocomplete"===he.type){this.formGroup.setControl(he.name,this.formBuilder.control(re[Me])),this.filteredOptions[he.name]=new se._,this.filteredOptions[he.name]=this.formGroup.controls[he.name].valueChanges.pipe((0,W.k)(tt=>{if(tt?.length)return he.domainValues?.filter(Tt=>{const vt=tt?tt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return Tt.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(vt)})}));let Xe=re[Me];if(he.domainValues.forEach(tt=>{"string"==typeof Xe&&F.eU.isValidNumber(Xe)&&!F.eU.isOctalNumber(Xe)&&(Xe=parseInt(Xe)),(tt.value===Xe||tt.id===Xe)&&(Xe=tt.value)}),this.formGroup.controls[he.name].setValue(Xe),this.isEdition(te)&&he.linkColumnForce){const tt=te.entity;this.formGroup.controls[he.name].setValue(tt?.properties[this.getColumnKeyWithoutPropertiesTag(he.linkColumnForce)])}}else if("date"===he.type){if(!1!==he.visible)if(re[Me]){let Xe=Ye()(re[Me]);re[Me]=Xe.utc().format("YYYY-MM-DD"),this.formGroup.setControl(he.name,this.formBuilder.control(re[Me]))}else{const Xe=this.getColumnKeyWithoutPropertiesTag(he.name);te.entity.properties[Xe]=null,this.formGroup.setControl(he.name,this.formBuilder.control(null))}}else this.formGroup.setControl(he.name,this.formBuilder.control(re[Me]));this.formGroup.controls[he.name]&&this.getValidationAttributeValue(he,"readonly")&&this.formGroup.controls[he.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(te=>!0===te.state.selected).subscribe(te=>{const re=te[0],he=this.store.stateView.all().indexOf(re),Me=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(he<(this.paginator?Me-this.paginator.pageSize:0)||he>=Me)){const tt=Math.floor(he/this.paginator.pageSize);this.dataSource.paginator.pageIndex=tt}this.selectionState$.next(this.computeSelectionState(te))}),this.dataSource$$=this.store.stateView.all$().subscribe(te=>{te[0]&&this.enableEdit(te[0]),this.dataSource.data=te.map(re=>({record:re,cellData:this.template.columns.reduce((he,Me)=>{const Xe=this.getValue(re,Me);return he[Me.name]={class:this.getCellClass(re,Me),value:Xe,isUrl:this.isUrl(Xe),isImg:this.isImg(Xe)},he},{})}))})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(te,re)=>re.record.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(te){this.paginator=te}onSort(te){const re=te.direction,he=this.template.columns.find(Me=>Me.name===te.active);"asc"===re||"desc"===re?(this.store.stateView.sort({valueAccessor:Me=>this.getValue(Me,he),direction:re,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:he,direction:re}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(te){this.lastRecordCheckedKey=this.store.stateView.getKey(te),this.entityClick.emit(te.entity)}onRowSelect(te){if(!1===this.selection)return;const re=te.entity;this.store.state.update(re,{selected:!0},!0),this.entitySelectChange.emit({added:[re]})}onToggleRows(te){if(!1===this.selection)return;const re=this.store.view.all();this.entitySelectChange.emit({added:[re]}),this.store.state.updateMany(re,{selected:te})}onToggleRow(te,re){if(!1===this.selection)return;const he=re.entity;this.store.state.update(he,{selected:te},!0===te&&!this.selectMany),!0===te&&this.entitySelectChange.emit({added:[he]}),this.lastRecordCheckedKey=this.store.stateView.getKey(re)}onShiftToggleRow(te,re,he){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(te,re);const Me=window.document.createRange();Me.selectNode(he.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(Me),he.stopImmediatePropagation();const Xe=this.store.stateView.all(),tt=Xe.indexOf(re),Tt=this.store.stateView.get(this.lastRecordCheckedKey),Co=[tt,Xe.indexOf(Tt)],hi=Xe.slice(Math.min(...Co),Math.max(...Co)+1).map(Gi=>Gi.entity);this.store.state.updateMany(hi,{selected:te}),!0===te&&this.entitySelectChange.emit({added:hi}),this.lastRecordCheckedKey=this.store.stateView.getKey(re)}computeSelectionState(te){const he=te.length;return 0===he?p.None:he===this.store.stateView.count?p.All:p.Some}columnIsSortable(te){let re=te.sort;return void 0===re&&(re=void 0!==this.template.sort&&this.template.sort),re}rowIsSelected(te){const re=te.state;return!!re.selected&&re.selected}isImg(te){return!!this.isUrl(te)&&-1!==["jpg","png","gif"].indexOf(te.split(".").pop().toLowerCase())}isUrl(te){return"string"==typeof te&&("https://"===te.slice(0,8)||"http://"===te.slice(0,7))}getValue(te,re){const he=te.entity;let Me;if(void 0!==re.valueAccessor)return re.valueAccessor(he,te);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(he,re.name,te);if(Me=this.store.getProperty(he,re.name),"boolean"===re.type)null==Me||""===Me?Me=!1:"boolean"!=typeof Me&&void 0!==Me&&(Me="number"==typeof Me?!!Me:JSON.parse(Me.toLowerCase())),this.isEdition(te)||(Me=Me?"&#10003;":"");else if("list"===re.type&&Me&&re.domainValues){const Xe=te.entity;if(re.multiple){let tt;tt="string"==typeof Me?Me.match(/[\w.-]+/g).map(Number):Me;let Tt=[];re.domainValues.forEach(vt=>{tt.includes(vt.id)&&Tt.push(te.edition?vt.id:vt.value)}),Me=this.isEdition(te)?tt:Tt}else!this.isEdition(te)&&re.linkColumnForce?Me=Xe?.properties[this.getColumnKeyWithoutPropertiesTag(re.linkColumnForce)]:re.domainValues.forEach(tt=>{"string"==typeof Me&&F.eU.isValidNumber(Me)&&!F.eU.isOctalNumber(Me)&&(Me=parseInt(Me)),(tt.value===Me||tt.id===Me)&&(Me=this.isEdition(te)?tt.id:tt.value)})}else if("autocomplete"===re.type&&Me&&re.domainValues){const Xe=te.entity;!this.isEdition(te)&&re.linkColumnForce?Me=Xe?.properties[this.getColumnKeyWithoutPropertiesTag(re.linkColumnForce)]:re.domainValues.forEach(tt=>{"string"==typeof Me&&F.eU.isValidNumber(Me)&&!F.eU.isOctalNumber(Me)&&(Me=parseInt(Me)),(tt.value===Me||tt.id===Me)&&(Me=tt.value)})}else"date"===re.type&&(this.isEdition(te)?Me&&(Me=Ye()(Me).format(),this.formGroup.controls[re.name].setValue(Me)):!this.isEdition(te)&&null===Me&&(Me=""));return void 0===Me&&(Me=""),Me}getValidationAttributeValue(te,re){return void 0!==te.validation&&void 0!==te.validation[re]&&te.validation[re]}isEdition(te){return!!te.entity.edition}getColumnRenderer(te){return void 0!==te.renderer?te.renderer:a.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const te=this.template.headerClassFunc;return te instanceof Function?te():{}}getRowClass(te){const he=this.template.rowClassFunc;return he instanceof Function?he(te.entity,te):{}}getCellClass(te,re){const he=te.entity,Me={},Xe=this.template.cellClassFunc;Xe instanceof Function&&Object.assign(Me,Xe(he,re,te));const tt=re.cellClassFunc;return tt instanceof Function&&Object.assign(Me,tt(he,te)),Me}onButtonClick(te,re){this.enableEdit(re),"function"==typeof te&&te(re.entity,re)}getColumnKeyWithoutPropertiesTag(te){return te.includes("properties.")?te.split(".")[1]:te}static \u0275fac=function(re){return new(re||Oe)(u.GI1(u.kD9),u.GI1(H.KE),u.GI1(st.Kk),u.GI1(u.GMv),u.GI1(H.eq,10),u.GI1(H.SC,8),u.GI1(H.Wo,8),u.GI1(x.u9),u.GI1(x.Wu))};static \u0275cmp=u.In1({type:Oe,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},standalone:!0,features:[u.M5G([{provide:U.u0,useExisting:Oe},(0,Z.CA)()]),u.SYr,u.UHJ],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["id","currentWorkspaceTable","mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"click",4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(re,he){1&re&&(u.I0R(0,"div",0)(1,"table",1),u.qCj("matSortChange",function(Xe){return he.onSort(Xe)}),u.SAx(2,2),u.yuY(3,It,2,1,"th",3)(4,at,2,1,"td",4),u.k70(),u.yuY(5,$e,4,4,"ng-container",5)(6,dt,1,1,"tr",6)(7,Qt,1,4,"tr",7),u.C$Y(),u.yuY(8,Do,1,3,"igo-entity-table-paginator",8),u.C$Y()),2&re&&(u.E7m("ngStyle",u.S45(9,mi,he.tableHeight)),u.yG2(),u.E7m("ngClass",he.getTableClass())("dataSource",he.dataSource)("trackBy",he.getTrackByFunction()),u.yG2(4),u.E7m("ngForOf",he.template.columns),u.yG2(),u.E7m("matHeaderRowDef",he.headers)("matHeaderRowDefSticky",he.fixedHeader),u.yG2(),u.E7m("matRowDefColumns",he.headers),u.yG2(),u.E7m("ngIf",he.withPaginator))},dependencies:[d.a,Ue,Be,H.y,H.ot,H.O4,H.ue,H.u,H.eJ,H.Gu,H._t,Ve.MJ,me.U1,me.e,x.I5,me.cG,_e.oJ,_e.um,_e.CI,de.Vn,de.WK,le.iU,le.SU,le.Ul,le.yu,U.wb,U.Gm,ue.oB,ue.qL,ne.cN,ne.yi,x.Ko,x.Ax,G.d5,G.kX,ve.Su,ve.E9,ve.e6,ye.If,ye.wL,ye.ie,ye.aG,ye.Af,ye.uc,ye.gx,ye.qC,ye.cX,ye.yC,ye._I,Le.KO,Le.a4,d.QF,d.Iw,d.u_,d.Qt,H.sl,H.uW,H.Wo,He.Ux,Ve.kd,Ge.mw,ct._s,xe.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-mdc-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-mdc-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:28px}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}[_nghost-%COMP%]   .mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}[_nghost-%COMP%]   entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}[_nghost-%COMP%]   .class_hidden[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .class_display_none[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .class_boolean[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}[_nghost-%COMP%]   .class_string[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_text[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number_edition[_ngcontent-%COMP%]{text-align:left}[_nghost-%COMP%]   td.edition[_ngcontent-%COMP%]{background:#a6a6a633}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0})}return Oe})()},94688:(Pe,ae,r)=>{"use strict";r.d(ae,{K:()=>c});var E=r(56264),a=r(34896);const w=["flexibleMain"],p=["*",[["","igoFlexibleFill",""]]],e=["*","[igoFlexibleFill]"];let c=(()=>{class o{el;mediaService;static transitionTime=250;main;get initial(){return this._initial}set initial(L){this._initial=L}_initial="0";get collapsed(){return this._collapsed}set collapsed(L){this._collapsed=L}_collapsed="0";get expanded(){return this._expanded}set expanded(L){this._expanded=L}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(L){this._initialMobile=L}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(L){this._collapsedMobile=L}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(L){this._expandedMobile=L}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(L){this._direction=L}_direction="column";get state(){return this._state}set state(L){const _={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(_,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});const C=_[L];void 0!==C&&(this.setSize(C),setTimeout(()=>{this._state=L},o.transitionTime))}_state="initial";mediaService$$;constructor(L,_){this.el=L,this.mediaService=_}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(L=>this.state=this.state)}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(L){this._state="transition","column"===this.direction?this.main.nativeElement.style.height=L:"row"===this.direction&&(this.main.nativeElement.style.width=L)}static \u0275fac=function(_){return new(_||o)(a.GI1(a.GMv),a.GI1(E.QB))};static \u0275cmp=a.In1({type:o,selectors:[["igo-flexible"]],viewQuery:function(_,C){if(1&_&&a.CC$(w,7),2&_){let S;a.wto(S=a.Gqi())&&(C.main=S.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},standalone:!0,features:[a.UHJ],ngContentSelectors:e,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(_,C){1&_&&(a.kPM(p),a.I0R(0,"div",null,0)(2,"div",1),a._Xx(3),a.C$Y()(),a.I0R(4,"div",2)(5,"div")(6,"div",1),a._Xx(7,1),a.C$Y()()()),2&_&&a.qim("igo-flexible-main ",C.state," ",C.direction,"")},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}"]})}return o})()},13428:(Pe,ae,r)=>{"use strict";r.d(ae,{_:()=>o});var E=r(65056),a=r(72968),w=r(86056),p=r(34896),e=r(2584);function c(R,L){if(1&R&&(p.SAx(0),p.wR5(1,"igo-dynamic-outlet",1),p.k70()),2&R){const _=p.GaO();p.yG2(),p.E7m("component",_.getFieldComponent())("inputs",_.getFieldInputs())("subscribers",_.getFieldSubscribers())}}let o=(()=>{class R{formFieldService;field;fieldInputs=void 0;fieldSubscribers=void 0;get fieldOptions(){return this.field.options||{}}constructor(_){this.formFieldService=_}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const _=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},(0,w.uu)(),_)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}static \u0275fac=function(C){return new(C||R)(p.GI1(e.Q))};static \u0275cmp=p.In1({type:R,selectors:[["igo-form-field"]],inputs:{field:"field"},standalone:!0,features:[p.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(C,S){1&C&&p.yuY(0,c,2,3,"ng-container",0),2&C&&p.E7m("ngIf",void 0!==S.field)},dependencies:[E.u_,a.qm],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0})}return R})()},17536:(Pe,ae,r)=>{"use strict";r.d(ae,{Y:()=>_});var E=r(65056),a=r(34896),w=r(71904),p=r(63596),e=r(86056);const c=["buttons"],o=["*",[["","formButtons",""]]],R=C=>({"igo-form-body-with-buttons":C}),L=["*","[formButtons]"];let _=(()=>{class C{form;formData;autocomplete="off";submitForm=new a._w7;buttons;get hasButtons(){return 0!==this.buttons.nativeElement.children.length}constructor(){}ngOnChanges(P){const y=P.formData;y&&y.currentValue!==y.previousValue&&(void 0===y.currentValue?this.clear():this.setData(y.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const P={};return(0,e.aC)(this.form).forEach(y=>{this.updateDataWithFormField(P,y)}),P}setData(P){this.form.fields.forEach(y=>{y.control.setValue((0,p.t)(P,y.name).safeObject)}),this.form.groups.forEach(y=>{y.fields.forEach(F=>{F.control.setValue((0,p.t)(P,F.name).safeObject)})})}updateDataWithFormField(P,y){const F=y.control;F.disabled||(P[y.name]=F.value)}clear(){this.form.control.reset()}static \u0275fac=function(y){return new(y||C)};static \u0275cmp=a.In1({type:C,selectors:[["igo-form"]],viewQuery:function(y,F){if(1&y&&a.CC$(c,7),2&y){let h;a.wto(h=a.Gqi())&&(F.buttons=h.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},standalone:!0,features:[a.SYr,a.UHJ],ngContentSelectors:L,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(y,F){1&y&&(a.kPM(o),a.I0R(0,"form",0),a.qCj("ngSubmit",function(){return F.onSubmit()}),a.I0R(1,"div",1)(2,"div",2),a._Xx(3),a.C$Y(),a.I0R(4,"div",3,4),a._Xx(6,1),a.C$Y()()()),2&y&&(a.E7m("autocomplete",F.autocomplete)("formGroup",F.form.control),a.yG2(),a.E7m("ngClass",a.S45(3,R,F.hasButtons)))},dependencies:[w.y,w.sz,w.u,w.sl,w.uW,E.QF],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}return C})()},56520:(Pe,ae,r)=>{"use strict";r.d(ae,{Yl:()=>E.Y,AB:()=>Ge,O8:()=>H,eO:()=>de,OE:()=>ct,wr:()=>y});var E=r(17536),w=r(13428),p=r(21124),e=r(65056),c=r(71904),o=r(46176),R=r(50244),L=r(32328),_=r(77872),C=r(20460),S=r(54844),P=r(2584);function y(Ie){return Ye=>{P.Q.register(Ie,Ye)}}var F=r(86056),h=r(34896),W=r(72584);function J(Ie,Ye){if(1&Ie&&(h.I0R(0,"mat-option",4),h.OEk(1),h.C$Y()),2&Ie){const se=Ye.$implicit;h.E7m("value",se.value),h.yG2(),h.oRS(" ",se.title," ")}}function T(Ie,Ye){if(1&Ie){const se=h.KQA();h.I0R(0,"mat-icon",5),h.qCj("click",function(){h.usT(se);const Re=h.GaO();return h.CGJ(Re.onDisableSwitchClick())}),h.OEk(1),h.wVc(2,"async"),h.C$Y()}if(2&Ie){const se=h.GaO();h.yG2(),h.oRS("",!0===h.kDX(2,1,se.disabled$)?"check_box_outline_blank":"check_box"," ")}}function Q(Ie,Ye){if(1&Ie&&(h.I0R(0,"mat-error"),h.OEk(1),h.wVc(2,"translate"),h.C$Y()),2&Ie){const se=h.GaO();h.yG2(),h.cNF(h.kDX(2,1,se.getErrorMessage()))}}let z=class na{disabled$=new S.g(!1);set choices(Ye){this.choices$.next(Ye)}get choices(){return this.choices$.value}choices$=new S.g([]);multiple=!1;formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,F.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,F.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ye=!this.disabled$.value;!0===Ye?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ye)}static \u0275fac=function(se){return new(se||na)};static \u0275cmp=h.In1({type:na,selectors:[["igo-form-field-select"]],inputs:{choices:"choices",multiple:"multiple",formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.UHJ],decls:6,vars:9,consts:[[3,"multiple","required","placeholder","formControl"],[3,"value",4,"ngFor","ngForOf"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],[3,"value"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(se,ge){1&se&&(h.I0R(0,"mat-form-field")(1,"mat-select",0),h.yuY(2,J,2,2,"mat-option",1),h.wVc(3,"async"),h.C$Y(),h.yuY(4,T,3,3,"mat-icon",2)(5,Q,3,3,"mat-error",3),h.C$Y()),2&se&&(h.yG2(),h.E7m("multiple",ge.multiple)("required",ge.required)("placeholder",ge.placeholder)("formControl",ge.formControl),h.yG2(),h.E7m("ngForOf",h.kDX(3,7,ge.choices$)),h.yG2(2),h.E7m("ngIf",!0===ge.disableSwitch),h.yG2(),h.E7m("ngIf",ge.formControl.errors))},dependencies:[R.wb,R.Up,R.wJ,R.is,_.d5,_.kX,o.I5,c.y,c.ue,c.eJ,c.sl,c.ug,e.Iw,o.Ax,e.u_,L.oB,L.qL,e.a,C._s,W.sD],encapsulation:2,changeDetection:0})};z=(0,p.UN)([y("select")],z);var Y=r(34672),N=r(42536);function K(Ie,Ye){if(1&Ie){const se=h.KQA();h.I0R(0,"mat-icon",4),h.qCj("click",function(){h.usT(se);const Re=h.GaO();return h.CGJ(Re.onDisableSwitchClick())}),h.OEk(1),h.wVc(2,"async"),h.C$Y()}if(2&Ie){const se=h.GaO();h.yG2(),h.oRS("",!0===h.kDX(2,1,se.disabled$)?"check_box_outline_blank":"check_box"," ")}}function j(Ie,Ye){if(1&Ie){const se=h.KQA();h.I0R(0,"button",5),h.qCj("click",function(){h.usT(se);const Re=h.GaO();return h.CGJ(Re.togglePassword())}),h.I0R(1,"mat-icon",6),h.OEk(2),h.C$Y()()}if(2&Ie){const se=h.GaO();h.yG2(2),h.cNF(se.hide?"visibility_off":"visibility")}}function A(Ie,Ye){if(1&Ie&&(h.I0R(0,"mat-error"),h.OEk(1),h.wVc(2,"translate"),h.C$Y()),2&Ie){const se=h.GaO();h.yG2(),h.cNF(h.kDX(2,1,se.getErrorMessage()))}}let d=class ra{cdRef;disabled$=new S.g(!1);hide=!0;lastTimeoutRequest;formControl;placeholder;isPassword;errors;disableSwitch=!1;get required(){return(0,F.qs)(this.formControl)}constructor(Ye){this.cdRef=Ye}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,F.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ye=!this.disabled$.value;!0===Ye?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ye)}togglePassword(){this.hide=!this.hide,this.delayedHide()}delayedHide(Ye=1e4){this.isPassword&&!this.hide&&(this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(()=>{this.hide=!0,this.cdRef.detectChanges()},Ye))}static \u0275fac=function(se){return new(se||ra)(h.GI1(h.kD9))};static \u0275cmp=h.In1({type:ra,selectors:[["igo-form-field-text"]],inputs:{formControl:"formControl",placeholder:"placeholder",isPassword:"isPassword",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.UHJ],decls:5,vars:7,consts:[["matInput","",3,"type","required","placeholder","formControl","blur","change"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["color","primary"]],template:function(se,ge){1&se&&(h.I0R(0,"mat-form-field")(1,"input",0),h.qCj("blur",function(){return ge.delayedHide(0)})("change",function(){return ge.delayedHide()}),h.C$Y(),h.yuY(2,K,3,3,"mat-icon",1)(3,j,3,1,"button",2)(4,A,3,3,"mat-error",3),h.C$Y()),2&se&&(h.yG2(),h.E7m("type",ge.isPassword&&ge.hide?"password":"text")("required",ge.isPassword?"true":ge.required)("placeholder",ge.placeholder)("formControl",ge.formControl),h.yG2(),h.E7m("ngIf",!0===ge.disableSwitch),h.yG2(),h.E7m("ngIf",ge.isPassword),h.yG2(),h.E7m("ngIf",ge.formControl.errors))},dependencies:[R.wb,R.Up,R.wJ,R.is,R.Gm,N.cN,N.yi,c.y,c.ot,c.ue,c.eJ,c.sl,c.ug,e.u_,L.oB,L.qL,Y.oJ,Y.um,e.a,C._s,W.sD],encapsulation:2,changeDetection:0})};function u(Ie,Ye){if(1&Ie){const se=h.KQA();h.I0R(0,"mat-icon",3),h.qCj("click",function(){h.usT(se);const Re=h.GaO();return h.CGJ(Re.onDisableSwitchClick())}),h.OEk(1),h.wVc(2,"async"),h.C$Y()}if(2&Ie){const se=h.GaO();h.yG2(),h.oRS("",!0===h.kDX(2,1,se.disabled$)?"check_box_outline_blank":"check_box"," ")}}function x(Ie,Ye){if(1&Ie&&(h.I0R(0,"mat-error"),h.OEk(1),h.wVc(2,"translate"),h.C$Y()),2&Ie){const se=h.GaO();h.yG2(),h.cNF(h.kDX(2,1,se.getErrorMessage()))}}d=(0,p.UN)([y("text"),(0,p.YR)("design:paramtypes",[h.kD9])],d);let U=class sa{disabled$=new S.g(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,F.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,F.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ye=!this.disabled$.value;!0===Ye?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ye)}static \u0275fac=function(se){return new(se||sa)};static \u0275cmp=h.In1({type:sa,selectors:[["igo-form-field-textarea"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.UHJ],decls:5,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(se,ge){1&se&&(h.I0R(0,"mat-form-field")(1,"textarea",0),h.OEk(2,"  "),h.C$Y(),h.yuY(3,u,3,3,"mat-icon",1)(4,x,3,3,"mat-error",2),h.C$Y()),2&se&&(h.yG2(),h.E7m("required",ge.required)("placeholder",ge.placeholder)("formControl",ge.formControl),h.yG2(2),h.E7m("ngIf",!0===ge.disableSwitch),h.yG2(),h.E7m("ngIf",ge.formControl.errors))},dependencies:[R.wb,R.Up,R.wJ,R.is,N.cN,N.yi,c.y,c.ot,c.ue,c.eJ,c.sl,c.ug,e.u_,L.oB,L.qL,e.a,C._s,W.sD],encapsulation:2,changeDetection:0})};U=(0,p.UN)([y("textarea")],U);function D(Ie,Ye){if(1&Ie&&(h.I0R(0,"div",5),h.wR5(1,"igo-form-field",6),h.C$Y()),2&Ie){const se=Ye.$implicit,ge=h.GaO(2);h.E7m("ngClass",ge.getFieldNgClass(se)),h.yG2(),h.E7m("field",se)}}function I(Ie,Ye){if(1&Ie&&(h.I0R(0,"div",3),h.yuY(1,D,2,2,"div",4),h.C$Y()),2&Ie){const se=h.GaO();h.yG2(),h.E7m("ngForOf",se.group.fields)}}function M(Ie,Ye){if(1&Ie&&(h.I0R(0,"mat-error"),h.OEk(1),h.wVc(2,"translate"),h.C$Y()),2&Ie){const se=h.GaO();h.yG2(),h.cNF(h.kDX(2,1,se.getErrorMessage()))}}const s=["*"];let H=(()=>{class Ie{group;errors;get formControl(){return this.group.control}constructor(){}getFieldColSpan(se){let ge=2;const Re=se.options||{};return Re.cols&&Re.cols>0&&(ge=Math.min(Re.cols,2)),ge}getFieldNgClass(se){return{[`igo-form-field-colspan-${this.getFieldColSpan(se)}`]:!0}}getErrorMessage(){return(0,F.KW)(this.formControl,(this.group.options||{}).errors||{})}static \u0275fac=function(ge){return new(ge||Ie)};static \u0275cmp=h.In1({type:Ie,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},standalone:!0,features:[h.UHJ],ngContentSelectors:s,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(ge,Re){1&ge&&(h.kPM(),h.yuY(0,I,2,1,"div",0),h.I0R(1,"div",1),h._Xx(2),h.C$Y(),h.yuY(3,M,3,3,"mat-error",2)),2&ge&&(h.E7m("ngIf",Re.group&&Re.group.fields.length>0),h.yG2(3),h.E7m("ngIf",Re.formControl.errors))},dependencies:[e.u_,e.Iw,e.QF,w._,R.wb,R.wJ,C._s,W.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px;box-sizing:border-box}[_nghost-%COMP%]   .igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return Ie})(),de=(()=>{class Ie{formBuilder;constructor(se){this.formBuilder=se}form(se,ge){const Re=this.formBuilder.group({});return se.forEach(Ue=>{Re.addControl(Ue.name,Ue.control)}),ge.forEach(Ue=>{Re.addControl(Ue.name,Ue.control)}),{fields:se,groups:ge,control:Re}}group(se,ge){const Re=se.options||{},Ue=this.formBuilder.group({});if(ge.forEach(ze=>{Ue.addControl(ze.name,ze.control)}),Re.validator){const ze=this.getValidators(Re.validator);Ue.setValidators(ze)}return Object.assign({},se,{fields:ge,control:Ue})}field(se){const ge=se.options||{},Ue=this.formBuilder.control({value:"",disabled:ge.disabled});if(ge.validator){const ze=this.getValidators(ge.validator);Ue.setValidators(ze)}return Object.assign({type:"text"},se,{control:Ue})}extendFieldConfig(se,ge){const Re=Object.assign({},se.options||{},ge.options||{}),Ue=Object.assign({},se.inputs||{},ge.inputs||{}),ze=Object.assign({},se.subscribers||{},ge.subscribers||{});return Object.assign({},se,{options:Re,inputs:Ue,subscribers:ze})}getValidators(se){return Array.isArray(se)?se.map(ge=>this.getValidator(ge)):this.getValidator(se)}getValidator(se){if("string"!=typeof se)return se;const Re=se.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return Re?c.AQ[Re[1]](Re[2]):c.AQ[se]}static \u0275fac=function(ge){return new(ge||Ie)(h.CoB(c.KE))};static \u0275prov=h.wxM({token:Ie,factory:Ie.\u0275fac,providedIn:"root"})}return Ie})();var le=r(40600),ue=r(53476);function ne(Ie,Ye){1&Ie&&h.wR5(0,"igo-form-field",11),2&Ie&&h.E7m("field",Ye.$implicit)}function ve(Ie,Ye){1&Ie&&h.wR5(0,"igo-form-group",12),2&Ie&&h.E7m("group",Ye.$implicit)}function ye(Ie,Ye){if(1&Ie&&(h.I0R(0,"div",8),h.yuY(1,ne,1,1,"igo-form-field",9)(2,ve,1,1,"igo-form-group",10),h.C$Y()),2&Ie){const se=h.GaO().ngIf;h.yG2(),h.E7m("ngForOf",se.fields),h.yG2(),h.E7m("ngForOf",se.groups)}}function Le(Ie,Ye){if(1&Ie){const se=h.KQA();h.I0R(0,"igo-form",3),h.qCj("submitForm",function(Re){h.usT(se);const Ue=h.GaO();return h.CGJ(Ue.onSubmit(Re))}),h.wVc(1,"async"),h.yuY(2,ye,3,2,"div",4),h.I0R(3,"div",5)(4,"button",6),h.qCj("click",function(){h.usT(se);const Re=h.GaO();return h.CGJ(Re.cancel())}),h.OEk(5),h.wVc(6,"translate"),h.C$Y(),h.I0R(7,"button",7),h.OEk(8),h.wVc(9,"translate"),h.C$Y()()()}if(2&Ie){const se=Ye.ngIf,ge=h.GaO();h.E7m("form",se)("formData",h.kDX(1,5,ge.data$)),h.yG2(2),h.E7m("ngIf",se.fields.length),h.yG2(3),h.oRS(" ",h.kDX(6,7,ge.data.cancelButtonText)," "),h.yG2(3),h.oRS(" ",h.kDX(9,9,ge.data.processButtonText)," ")}}function He(Ie,Ye){if(1&Ie&&h.wR5(0,"igo-custom-html",13),2&Ie){const se=h.GaO();h.E7m("html",se.data.notice)}}let Ve=(()=>{class Ie{languageService;dialogRef;formService;data;form$=new S.g(void 0);data$=new S.g(void 0);constructor(se,ge,Re,Ue){this.languageService=se,this.dialogRef=ge,this.formService=Re,this.data=Ue,this.data.processButtonText=this.data.processButtonText??"igo.common.formDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.formDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.formDialog.title",this.data$=this.data.data$;let ze=[],Be=[];this.data.formFieldConfigs?.map(xe=>ze.push(this.formService.field(xe))),this.data.formGroupsConfigs?.map(xe=>{const Ke=xe.formFieldConfigs?.map(Qe=>this.formService.field(Qe));Be.push(this.formService.group({name:xe.name},Ke))});const st=this.formService.form(ze,Be);this.form$.next(st)}onSubmit(se){const ge=this.form$.getValue();ge.control.valid?this.dialogRef.close(se):ge.groups?.length?ge.groups.map(Re=>{Object.keys(Re.control.controls).map(Ue=>{Re.control.controls[Ue].markAsTouched(),Re.control.controls[Ue].updateValueAndValidity()})}):ge.fields.map(Re=>{Re.control.markAsTouched(),Re.control.updateValueAndValidity()})}cancel(){this.dialogRef.close()}static \u0275fac=function(ge){return new(ge||Ie)(h.GI1(C.ov),h.GI1(le.yI),h.GI1(de),h.GI1(le.sR))};static \u0275cmp=h.In1({type:Ie,selectors:[["igo-form-dialog"]],standalone:!0,features:[h.UHJ],decls:7,vars:7,consts:[["mat-dialog-title",""],[3,"form","formData","submitForm",4,"ngIf"],[3,"html",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-dialog-container",4,"ngIf"],["formButtons","","mat-dialog-actions",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary"],[1,"form-dialog-container"],[3,"field",4,"ngFor","ngForOf"],[3,"group",4,"ngFor","ngForOf"],[3,"field"],[3,"group"],[3,"html"]],template:function(ge,Re){1&ge&&(h.I0R(0,"h1",0),h.OEk(1),h.wVc(2,"translate"),h.C$Y(),h.yuY(3,Le,10,11,"igo-form",1),h.wVc(4,"async"),h.I0R(5,"div"),h.yuY(6,He,1,1,"igo-custom-html",2),h.C$Y()),2&ge&&(h.yG2(),h.cNF(h.kDX(2,3,Re.data.title)),h.yG2(2),h.E7m("ngIf",h.kDX(4,5,Re.form$)),h.yG2(3),h.E7m("ngIf",Re.data.notice&&""!==Re.data.notice))},dependencies:[le.WQ,e.u_,E.Y,e.Iw,w._,H,le.Yp,Y.oJ,Y.Gw,ue.YM,e.a,C._s,W.sD],styles:["[_nghost-%COMP%]   div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-group[_ngcontent-%COMP%]{display:block;height:auto}"]})}return Ie})(),Ge=(()=>{class Ie{dialog;constructor(se){this.dialog=se}open(se,ge){const Re={formFieldConfigs:se.formFieldConfigs,formGroupsConfigs:se.formGroupsConfigs,...ge};return this.dialog.open(Ve,{disableClose:!1,data:Re,...ge}).afterClosed()}static \u0275fac=function(ge){return new(ge||Ie)(h.CoB(le.qW))};static \u0275prov=h.wxM({token:Ie,factory:Ie.\u0275fac})}return Ie})(),ct=(()=>{class Ie{static forRoot(){return{ngModule:Ie,providers:[]}}static \u0275fac=function(ge){return new(ge||Ie)};static \u0275mod=h.a4G({type:Ie});static \u0275inj=h.s3X({providers:[Ge],imports:[le.sr,Ve]})}return Ie})()},2584:(Pe,ae,r)=>{"use strict";r.d(ae,{Q:()=>a});var E=r(34896);let a=(()=>{class w{static fields={};static register(e,c){w.fields[e]=c}constructor(){}getFieldByType(e){return w.fields[e]}static \u0275fac=function(c){return new(c||w)};static \u0275prov=E.wxM({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},86056:(Pe,ae,r)=>{"use strict";function E(c){if(c.validator){const o=c.validator({});if(o&&o.required)return!0}return!!c.controls&&void 0!==Object.keys(c.controls).find(R=>E(c.controls[R]))}function a(){return{required:"igo.common.form.errors.required",email:"igo.common.form.errors.email"}}function w(c,o){const _=Object.keys(c.errors||{}).map(C=>o[C]).filter(C=>void 0!==C);return _.length>0?_[0]:""}function p(c){return c.groups.reduce((o,R)=>o.concat(R.fields),[].concat(c.fields))}r.d(ae,{KW:()=>w,aC:()=>p,qs:()=>E,uu:()=>a})},80716:(Pe,ae,r)=>{"use strict";r.d(ae,{ol:()=>p,IL:()=>C,S:()=>F,Cg:()=>w,er:()=>o,qW:()=>E,Ue:()=>a,Md:()=>c,yC:()=>e,I9:()=>S});const E={name:"magnify-scan",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>magnify-scan</title><path d="M17 22V20H20V17H22V20.5C22 20.89 21.84 21.24 21.54 21.54C21.24 21.84 20.89 22 20.5 22H17M7 22H3.5C3.11 22 2.76 21.84 2.46 21.54C2.16 21.24 2 20.89 2 20.5V17H4V20H7V22M17 2H20.5C20.89 2 21.24 2.16 21.54 2.46C21.84 2.76 22 3.11 22 3.5V7H20V4H17V2M7 2V4H4V7H2V3.5C2 3.11 2.16 2.76 2.46 2.46C2.76 2.16 3.11 2 3.5 2H7M10.5 6C13 6 15 8 15 10.5C15 11.38 14.75 12.2 14.31 12.9L17.57 16.16L16.16 17.57L12.9 14.31C12.2 14.75 11.38 15 10.5 15C8 15 6 13 6 10.5C6 8 8 6 10.5 6M10.5 8C9.12 8 8 9.12 8 10.5C8 11.88 9.12 13 10.5 13C11.88 13 13 11.88 13 10.5C13 9.12 11.88 8 10.5 8Z" /></svg>\n'},a={name:"microsoft",svg:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>microsoft</title><path d="M2,3H11V12H2V3M11,22H2V13H11V22M21,3V12H12V3H21M21,22H12V13H21V22Z" /></svg>\n'},w={name:"keyboard-esc",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>keyboard-esc</title><path d="M1 7H7V9H3V11H7V13H3V15H7V17H1V7M11 7H15V9H11V11H13C14.11 11 15 11.9 15 13V15C15 16.11 14.11 17 13 17H9V15H13V13H11C9.9 13 9 12.11 9 11V9C9 7.9 9.9 7 11 7M19 7H21C22.11 7 23 7.9 23 9V10H21V9H19V15H21V14H23V15C23 16.11 22.11 17 21 17H19C17.9 17 17 16.11 17 15V9C17 7.9 17.9 7 19 7Z" /></svg>\n'},p={name:"engine",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>engine</title><path d="M7,4V6H10V8H7L5,10V13H3V10H1V18H3V15H5V18H8L10,20H18V16H20V19H23V9H20V12H18V8H12V6H15V4H7Z" /></svg>\n'},e={name:"selection-marker",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>selection-marker</title><path d="M2 4C2 2.89 2.9 2 4 2H7V4H4V7H2V4M22 4V7H20V4H17V2H20C21.1 2 22 2.89 22 4M2 20V17H4V20H7V22H4C2.9 22 2 21.11 2 20M10 2H14V4H10V2M10 20H14V22H10V20M2 10H4V14H2V10M18.5 13C20.4 13 22 14.6 22 16.5C22 19.1 18.5 23 18.5 23C18.5 23 15 19.1 15 16.5C15 14.6 16.6 13 18.5 13M18.5 17.8C19.2 17.8 19.8 17.2 19.7 16.6C19.7 16 19.1 15.4 18.5 15.4C17.9 15.4 17.3 15.9 17.3 16.6C17.3 17.2 17.8 17.8 18.5 17.8M20 10H22V12.34C21.42 11.84 20.74 11.45 20 11.23V10Z" /></svg>\n'},c={name:"presentation-play",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>presentation-play</title><path d="M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z" /></svg>'},o={name:"layers-plus",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>layers-plus</title><path d="M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z" /></svg>'};var R=r(34896),L=r(32328),_=r(50168);let C=(()=>{class h{iconRegistry;sanitizer;constructor(J,T){this.iconRegistry=J,this.sanitizer=T}registerSvg(J){this.iconRegistry.addSvgIconLiteral(J.name,this.sanitizer.bypassSecurityTrustHtml(J.svg))}static \u0275fac=function(T){return new(T||h)(R.CoB(L.iK),R.CoB(_.mI))};static \u0275prov=R.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();function S(h="outlined"){return(0,R.AFj)([L.oB,{provide:R.kZF,useFactory:W=>()=>W.setDefaultFontSetClass(`material-symbols-${h}`),deps:[L.iK],multi:!0}])}function P(h,W){if(1&h&&R.wR5(0,"mat-icon",0),2&h){const J=R.GaO();R.E7m("svgIcon",J.icon.name)}}function y(h,W){if(1&h&&(R.I0R(0,"mat-icon"),R.OEk(1),R.C$Y()),2&h){const J=R.GaO();R.yG2(),R.cNF(J.icon)}}let F=(()=>{class h{iconService;set icon(J){this.isSvg(J)&&this.registerSvg(J),this._icon=J}get icon(){return this._icon}_icon;constructor(J){this.iconService=J}registerSvg(J){this.iconService.registerSvg(J)}isSvg(J){return"string"!=typeof J}static \u0275fac=function(T){return new(T||h)(R.GI1(C))};static \u0275cmp=R.In1({type:h,selectors:[["igo-icon"]],inputs:{icon:"icon"},standalone:!0,features:[R.UHJ],decls:2,vars:1,consts:[[3,"svgIcon"]],template:function(T,Q){1&T&&R.yuY(0,P,1,1,"mat-icon",0)(1,y,2,1),2&T&&R.C0Y(0,Q.isSvg(Q.icon)?0:1)},dependencies:[L.oB,L.qL],encapsulation:2})}return h})()},75684:(Pe,ae,r)=>{"use strict";r.d(ae,{MJ:()=>a,kd:()=>_});var E=r(34896);let a=(()=>{class S{el;errorImageUrl="./assets/igo2/common/images/na.png";hideError=!1;constructor(y){this.el=y}onError(y){this.hideError?this.el.nativeElement.style.display="none":y.target.src=this.errorImageUrl}static \u0275fac=function(F){return new(F||S)(E.GI1(E.GMv))};static \u0275dir=E.Sc5({type:S,selectors:[["","igoImageError",""]],hostBindings:function(F,h){1&F&&E.qCj("error",function(J){return h.onError(J)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"},standalone:!0})}return S})();var w=r(21124),p=r(33712),e=r(45872),c=r(21296),o=r(51672),R=r(19432),L=r(90916);class _{http;configService;constructor(P,y){this.http=P,this.configService=y}transform(P){const y=new p.UD({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),F=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');return F.test(P)&&(P=P.match(F)[0]),this.http.get(P,{headers:y,responseType:"blob"}).pipe((0,o.a)(h=>{throw h.error.caught=!0,h.error.toDisplay=!1,h}),(0,R.G)(h=>new c._(W=>{const J=new FileReader;J.readAsDataURL(h),J.onloadend=()=>{W.next(J.result),W.complete()}})))}static \u0275fac=function(y){return new(y||_)(E.GI1(p.KK,16),E.GI1(e.aW,16))};static \u0275pipe=E.UTH({name:"secureImage",type:_,pure:!0,standalone:!0})}(0,w.UN)([(0,L.w)({maxCacheCount:20}),(0,w.YR)("design:type",Function),(0,w.YR)("design:paramtypes",[String]),(0,w.YR)("design:returntype",c._)],_.prototype,"transform",null)},6876:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>F});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(80716),c=r(68848),o=r(20460),R=r(1296),L=r(63900),_=r(34896),C=r(72584);function S(h,W){if(1&h){const J=_.KQA();_.I0R(0,"button",3),_.qCj("click",function(){_.usT(J);const Q=_.GaO(2);return _.CGJ(Q.startInteractiveTour())}),_.wVc(1,"translate"),_.wVc(2,"translate"),_.wR5(3,"igo-icon",4),_.C$Y()}if(2&h){const J=_.GaO(2);_.E7m("ngClass",J.getClass())("matTooltip",J.disabledTourButton?_.kDX(1,4,"igo.common.interactiveTour.disaledTooltipTourToolButton"):_.kDX(2,6,"igo.common.interactiveTour.tooltipTourToolButton"))("disabled",J.disabledTourButton),_.yG2(3),_.E7m("icon",J.presentationIcon)}}function P(h,W){if(1&h){const J=_.KQA();_.I0R(0,"button",5),_.qCj("click",function(){_.usT(J);const Q=_.GaO(2);return _.CGJ(Q.startInteractiveTour())}),_.OEk(1),_.wVc(2,"translate"),_.wVc(3,"translate"),_.wVc(4,"async"),_.wR5(5,"mat-icon",6),_.wVc(6,"translate"),_.wVc(7,"translate"),_.C$Y()}if(2&h){const J=_.GaO(2);_.E7m("ngClass",J.getClass())("disabled",J.disabledTourButton),_.yG2(),_.CAO(" ",_.kDX(2,6,"igo.common.interactiveTour.buttonTitle")," ",_.kDX(3,8,_.kDX(4,10,J.discoverTitleInLocale$))," "),_.yG2(4),_.E7m("svgIcon",J.presentationIcon.name)("matTooltip",J.disabledTourButton?_.kDX(6,12,"igo.common.interactiveTour.disaledTooltipTourToolButton"):_.kDX(7,14,"igo.common.interactiveTour.tooltipTourToolButton"))}}function y(h,W){if(1&h&&(_.SAx(0),_.yuY(1,S,4,8,"button",1)(2,P,8,16,"ng-template",null,2,_.gJz),_.k70()),2&h){const J=_.Gew(3),T=_.GaO();_.yG2(),_.E7m("ngIf","icon"===T.styleButton)("ngIfElse",J)}}let F=(()=>{class h{interactiveTourService;toolService;iconService;presentationIcon=e.Md;tourToStart="";styleButton;discoverTitleInLocale$=(0,R.of)("IGO");getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let J,T;return J=this.isToolHaveTour,!1!==J&&!(this.interactiveTourService.isMobile()&&(T=this.isTourDisplayInMobile,!1===T))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}constructor(J,T,Q){this.interactiveTourService=J,this.toolService=T,this.iconService=Q,this.iconService.registerSvg(this.presentationIcon)}startInteractiveTour(){const J=this.getTourToStart();J&&this.interactiveTourService.startTour(J)}static \u0275fac=function(T){return new(T||h)(_.GI1(L.I),_.GI1(c.IF),_.GI1(e.IL))};static \u0275cmp=_.In1({type:h,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},standalone:!0,features:[_.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click",4,"ngIf","ngIfElse"],["raisedButton",""],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click"],["iconPositionEnd","",3,"icon"],["color","primary","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],["iconPositionEnd","",3,"svgIcon","matTooltip"]],template:function(T,Q){1&T&&_.yuY(0,y,4,2,"ng-container",0),2&T&&_.E7m("ngIf",Q.showTourButton)},dependencies:[E.u_,a.oJ,a.Gw,a.um,E.QF,p.KO,p.a4,w.oB,w.qL,E.a,o._s,C.sD,e.S],styles:["igo-interactive-tour>button.mat-mdc-raised-button.tour-button-tool-icon{box-shadow:none}.shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2})}return h})()},72236:(Pe,ae,r)=>{"use strict";r.d(ae,{C:()=>e});var E=r(45872),a=r(51672),w=r(34896),p=r(33712);let e=(()=>{class c{http;configService;jsonURL;allToursOptions;constructor(R,L){this.http=R,this.configService=L,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(R=>{this.allToursOptions=R},R=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,a.a)(R=>{throw R.error.caught=!0,R}))}getTourOptionData(R){if(void 0===this.allToursOptions)return;let L=R;return L=L.replace(/\s/g,""),this.allToursOptions[L]}static \u0275fac=function(L){return new(L||c)(w.CoB(p.KK),w.CoB(E.aW))};static \u0275prov=w.wxM({token:c,factory:c.\u0275fac})}return c})()},63900:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>L});var E=r(45872),a=r(20460),w=r(56264),p=r(16548),e=r(91112),c=r(72236),o=r(34896),R=r(44668);let L=(()=>{class _{configService;mediaService;languageService;interactiveTourLoader;shepherdService;previousStep;nextIndex=1;constructor(S,P,y,F,h){this.configService=S,this.mediaService=P,this.languageService=y,this.interactiveTourLoader=F,this.shepherdService=h,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const S=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===S||S}isToolHaveTourConfig(S){return void 0!==this.interactiveTourLoader.getTourOptionData(S)}disabledTourButton(S){const P=this.interactiveTourLoader.getTourOptionData(S);if(P?.conditions)for(const y of P?.conditions)if(null===document.querySelector(y))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){const S=this.configService.getConfig("interactiveTour.tourInMobile");return void 0===S||S}getButtons(S){return"noBackButton"===S?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===S?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===S?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(S){return{click:"click"}[S.toLowerCase()]}addProgress(){const S=this;let P=0;const F=setInterval(()=>{if(S.getCurrentStep()){if(S.getCurrentStep().options.attachTo.element&&!document.querySelector(S.getCurrentStep().options.attachTo.element))return S.cancel(),void clearInterval(F);{const h=S.getCurrentStep().getElement();h&&h.querySelectorAll(".shepherd-content, .shepherd-text").forEach(T=>{T.classList.add("mat-typography")});const W=h?h.querySelector(".shepherd-header"):void 0;if(P++,(W||P>21)&&clearInterval(F),W){const J=S.steps,T=document.createElement("span");T.className="shepherd-progress",T.innerText=`${J.indexOf(S.getCurrentStep())+1}/${J.length}`,W.insertBefore(T,h.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(S,P,y){if(P.getCurrentStep()){if(P.getCurrentStep().options.attachTo.element&&document.querySelector(P.getCurrentStep().options.attachTo.element))return void P.complete();if(S.index===P.steps.length-1)return void P.complete();P.steps.splice(S.index,1);const F=P.steps[S.index];F.options.attachTo.element&&!document.querySelector(F.options.attachTo.element)?y.checkNext(S,P,y):(P._setupModal(),P.show(F.id))}}executeAction(S,P){if(!P||P.condition&&("!"===P.condition.charAt(0)&&document.querySelector(P.condition.slice(1))||"!"!==P.condition.charAt(0)&&!document.querySelector(P.condition)))return;const y=document.querySelector(P.element||S.element),F=this.getAction(P.action);y&&F&&y[F]()}executeActionPromise(S,P){return new Promise(y=>{if(this.executeAction(S,P),!P||!P.waitFor)return void y();let F=0;const h=P.maxWait?P.maxWait/100:20,W=setInterval(()=>{F++,(F>h||document.querySelector(P.waitFor))&&(clearInterval(W),y())},100)})}getShepherdSteps(S){const P=[];let y=0;for(const F of S.steps){const h=F.position??S.position;P.push({attachTo:{element:F.element,on:h},floatingUIOptions:{middleware:["auto"===h&&(0,p.EX)(),(0,e.E3)({mainAxis:15})].filter(Boolean)},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(F,F.beforeShow)]),buttons:this.getButtons(0===y?"first":y+1===S.steps.length?"last":S.steps[y].noBackButton?"noBackButton":void 0),classes:F.class,highlightClass:F.highlightClass,scrollTo:F.scrollToElement||S.scrollToElement||!0,canClickTarget:F.disableInteraction?!F.disableInteraction:void 0,title:this.languageService.translate.instant(F.title||S.title),text:[this.languageService.translate.instant(F.text)],when:{show:()=>{this.executeAction(F,F.onShow)},hide:()=>{this.previousStep=F,this.executeAction(F,F.onHide)}}}),y++}return P}startTour(S){const P=this.interactiveTourLoader.getTourOptionData(S);this.shepherdService.defaultStepOptions={classes:P.class,highlightClass:P.highlightClass,canClickTarget:!P.disableInteraction||!P.disableInteraction,cancelIcon:{enabled:!0}};const y=this.getShepherdSteps(P);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(y),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",F=>{this.checkNext(F,this.shepherdService.tourObject,this)}),this.shepherdService.start()}static \u0275fac=function(P){return new(P||_)(o.CoB(E.aW),o.CoB(w.QB),o.CoB(a.ov),o.CoB(c.C),o.CoB(R.c))};static \u0275prov=o.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},67032:(Pe,ae,r)=>{"use strict";r.d(ae,{bQ:()=>e,Er:()=>E.E,In:()=>w.I});var E=r(6876),a=r(72236),w=r(63900),p=r(34896);let e=(()=>{class c{static \u0275fac=function(L){return new(L||c)};static \u0275mod=p.a4G({type:c});static \u0275inj=p.s3X({providers:[w.I,a.C],imports:[E.E]})}return c})()},28180:(Pe,ae,r)=>{"use strict";r.d(ae,{yM:()=>R,qU:()=>a});var E=r(34896);let a=(()=>{class _{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(S){this._color=S}_color="primary";get focused(){return this._focused}set focused(S){S!==this._focused&&(this.disabled||(S?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=S,!0!==this.selected&&this.toggleFocusedClass(),S?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(S){S!==this._selected&&(this.disabled||(S?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=S,this._focused=S,this.toggleSelectedClass(),S?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(S){S!==this._disabled&&(!0===S&&(this.selected=!1),S?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=S,this.toggleDisabledClass(),S?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new E._w7;beforeFocus=new E._w7;beforeUnselect=new E._w7;beforeUnfocus=new E._w7;beforeDisable=new E._w7;beforeEnable=new E._w7;focus=new E._w7;unfocus=new E._w7;select=new E._w7;unselect=new E._w7;disable=new E._w7;enable=new E._w7;onClick(){this.selected=!0}constructor(S,P){this.renderer=S,this.el=P}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(_.focusedCls):this.removeCls(_.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(_.selectedCls),this.removeCls(_.focusedCls)):this.removeCls(_.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(_.disabledCls):this.removeCls(_.disabledCls)}addCls(S){this.renderer.addClass(this.el.nativeElement,S)}removeCls(S){this.renderer.removeClass(this.el.nativeElement,S)}static \u0275fac=function(P){return new(P||_)(E.GI1(E.q87),E.GI1(E.GMv))};static \u0275dir=E.Sc5({type:_,selectors:[["","igoListItem",""]],hostBindings:function(P,y){1&P&&E.qCj("click",function(){return y.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"},standalone:!0})}return _})();var w=r(65056),p=r(63916);let e=(()=>{class _{el;clickout=new E._w7;handleMouseClick(S,P){P&&(this.el.nativeElement.contains(P)||this.clickout.emit(S))}constructor(S){this.el=S}static \u0275fac=function(P){return new(P||_)(E.GI1(E.GMv))};static \u0275dir=E.Sc5({type:_,selectors:[["","igoClickout",""]],hostBindings:function(P,y){1&P&&E.qCj("click",function(h){return y.handleMouseClick(h,h.target)},!1,E.wLc)},outputs:{clickout:"clickout"},standalone:!0})}return _})();const c=_=>({selectable:_}),o=["*"];let R=(()=>{class _{el;get navigation(){return this._navigation}set navigation(S){this._navigation=S}_navigation=!0;get selection(){return this._selection}set selection(S){this._selection=S}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(S){this.focusedItem=S,this._selectedItem=S}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(S){this._focusedItem=S}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(S){this.navigationEnabled&&("ArrowUp"===S.key||"ArrowDown"===S.key?(S.preventDefault(),this.navigate(S.key)):"Enter"===S.key&&this.select(this.focusedItem))}constructor(S){this.el=S}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(S=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(S){this.selection&&(this.unfocus(),void 0!==S&&(S.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const S=this.listItems.toArray();let P;const y=this.el.nativeElement;let F=!0,h=this.getFocusedIndex();for(void 0===h&&(h=-1);F&&h<S.length-1;)h+=1,P=S[h],F=P.disabled;void 0!==P&&this.focus(P),S[h+1]?void 0!==P&&!this.isScrolledIntoView(P.el.nativeElement)&&(y.scrollTop=P.el.nativeElement.offsetTop+P.el.nativeElement.children[0].offsetHeight-y.clientHeight):y.scrollTop=y.scrollHeight-y.clientHeight}focusPrevious(){const S=this.listItems.toArray();let P;const y=this.el.nativeElement;let F=!0,h=this.getFocusedIndex();for(;F&&h>0;)h-=1,P=S[h],F=P.disabled;void 0!==P&&this.focus(P),S[h-1]?void 0!==P&&!this.isScrolledIntoView(P.el.nativeElement)&&(y.scrollTop=P.el.nativeElement.offsetTop-3):y.scrollTop=0}select(S){this.selection&&(this.unselect(),void 0!==S&&(S.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(S){this.el.nativeElement.scrollTop=S.getOffsetTop()}isScrolledIntoView(S){const P=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,F=S.offsetTop;return F+S.children[0].offsetHeight<=P+this.el.nativeElement.clientHeight&&F>=P}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(S=>{this.subscriptions.push(S.beforeSelect.subscribe(P=>this.handleItemBeforeSelect(P))),this.subscriptions.push(S.select.subscribe(P=>this.handleItemSelect(P))),this.subscriptions.push(S.beforeFocus.subscribe(P=>this.handleItemBeforeFocus(P))),this.subscriptions.push(S.focus.subscribe(P=>this.handleItemFocus(P)))},this)}unsubscribe(){this.subscriptions.forEach(S=>S.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(S){S!==this.focusedItem&&this.unfocus()}handleItemFocus(S){this.focusedItem=S}handleItemBeforeSelect(S){S!==this.focusedItem&&this.unselect()}handleItemSelect(S){this.selectedItem=S}findSelectedItem(){return this.listItems.toArray().find(S=>S.selected)}findFocusedItem(){return this.listItems.toArray().find(S=>S.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(S=>S===this.focusedItem)}navigate(S){switch(S){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}static \u0275fac=function(P){return new(P||_)(E.GI1(E.GMv))};static \u0275cmp=E.In1({type:_,selectors:[["igo-list"]],contentQueries:function(P,y,F){if(1&P&&E.szK(F,a,5),2&P){let h;E.wto(h=E.Gqi())&&(y.listItems=h)}},hostBindings:function(P,y){1&P&&E.qCj("keydown",function(h){return y.handleKeyboardEvent(h)},!1,E.wLc)("enter",function(h){return y.handleKeyboardEvent(h)},!1,E.wLc)},inputs:{navigation:"navigation",selection:"selection"},standalone:!0,features:[E.UHJ],ngContentSelectors:o,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(P,y){1&P&&(E.kPM(),E.I0R(0,"mat-list",0),E.qCj("clickout",function(){return y.disableNavigation()})("click",function(){return y.enableNavigation()}),E._Xx(1),E.C$Y()),2&P&&E.E7m("ngClass",E.S45(1,c,y.selection))},dependencies:[p.iI,p.oL,e,w.QF],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]})}return _})()},21800:(Pe,ae,r)=>{"use strict";r.d(ae,{c:()=>o});var E=r(65056),a=r(34896);const w=R=>({"igo-cursor-pointer":R});function p(R,L){if(1&R&&(a.I0R(0,"div",2)(1,"div",3),a._Xx(2,1),a.C$Y(),a.I0R(3,"h3",4),a.OEk(4),a._Xx(5,2),a.C$Y(),a.I0R(6,"div",5),a._Xx(7,3),a.C$Y()()),2&R){const _=a.GaO();a.E7m("ngClass",a.S45(2,w,!0===_.cursorPointer)),a.yG2(4),a.oRS(" ",_.title," ")}}const e=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],c=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"];let o=(()=>{class R{title;get withHeader(){return this._withHeader}set withHeader(_){this._withHeader=_}_withHeader=!0;cursorPointer=!1;static \u0275fac=function(C){return new(C||R)};static \u0275cmp=a.In1({type:R,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(C,S){2&C&&a.eAK("igo-panel-with-header",S.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},standalone:!0,features:[a.UHJ],ngContentSelectors:c,decls:3,vars:1,consts:[["class","igo-panel-header","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header",3,"ngClass"],[1,"panel-left"],[1,"igo-panel-title"],[1,"panel-right"]],template:function(C,S){1&C&&(a.kPM(e),a.yuY(0,p,8,4,"div",0),a.I0R(1,"div",1),a._Xx(2),a.C$Y()),2&C&&a.E7m("ngIf",S.withHeader)},dependencies:[E.u_,E.QF],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   igo-interactive-tour[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .igo-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:48px;text-align:center}[_nghost-%COMP%]   .igo-panel-title[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;font-weight:600;flex:1}[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}[_nghost-%COMP%]   .igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .panel-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]{display:flex;min-width:40px}[_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]:not(:empty){padding-right:4px}"],changeDetection:0})}return R})()},38776:(Pe,ae,r)=>{"use strict";r.d(ae,{is:()=>R}),r(24956),r(24112);var w=r(34896),p=r(65056),e=r(94204),c=r(54844);const o=S=>({"igo-spinner-container":!0,"igo-spinner-shown":S});let R=(()=>{class S{shown$=new c.g(!1);set shown(y){this.shown$.next(y)}get shown(){return this.shown$.value}constructor(){}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(F){return new(F||S)};static \u0275cmp=w.In1({type:S,selectors:[["igo-spinner"]],inputs:{shown:"shown"},standalone:!0,features:[w.UHJ],decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(F,h){1&F&&(w.I0R(0,"div",0),w.wVc(1,"async"),w.wR5(2,"div",1)(3,"mat-progress-spinner",2),w.C$Y()),2&F&&w.E7m("ngClass",w.S45(3,o,w.kDX(1,1,h.shown$)))},dependencies:[p.QF,e.cm,p.a],styles:["[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]})}return S})()},90568:(Pe,ae,r)=>{"use strict";r.d(ae,{mw:()=>w});var E=r(34896);let w=(()=>{class e{onClick(o){o.stopPropagation()}static \u0275fac=function(R){return new(R||e)};static \u0275dir=E.Sc5({type:e,selectors:[["","igoStopPropagation",""]],hostBindings:function(R,L){1&R&&E.qCj("click",function(C){return L.onClick(C)})},standalone:!0})}return e})()},68848:(Pe,ae,r)=>{"use strict";r.d(ae,{aA:()=>c,IF:()=>e,Eb:()=>w,cT:()=>h});var E=r(87040),a=r(54844);class w{options;activeTool$=new a.g(void 0);toolbar$=new a.g([]);activeTool$$;activeToolHistory=[];previousToolName;currentToolName;store=new E.qc([],{getKey:Q=>Q.name});get tools$(){return this.store.entities$}constructor(Q={}){this.options=Q,this.setToolbar(Q.toolbar),this.initStore()}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(Q){return this.store.get(Q)}getTools(){return this.store.all()}setTools(Q){this.store.load(Q)}getToolbar(){return this.toolbar$.getValue()}setToolbar(Q){this.toolbar$.next(Q||[])}activateTool(Q,z={}){const Y=this.getTool(Q);void 0!==Y&&this.store.state.update(Y,{active:!0,options:z},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[Q,z]=this.activeToolHistory.splice(-2,2);this.activateTool(Q)}getCurrentPreviousToolName(){return[this.previousToolName,this.currentToolName]}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new E.qc([],{getKey:Q=>Q.name}),this.activeTool$$=this.store.stateView.firstBy$(Q=>!0===Q.state.active).subscribe(Q=>{if(void 0===Q)return void this.setActiveTool(void 0);const z=Q.entity,Y=Object.assign({},z.options||{},Q.state.options||{});this.setActiveTool(Object.assign({},z,{options:Y}))})}setActiveTool(Q){this.activeTool$.next(Q),void 0===Q?this.clearActiveToolHistory():(this.activeToolHistory=this.activeToolHistory.filter(z=>z!==Q.name).concat([Q.name]),this.previousToolName=this.currentToolName,this.currentToolName=this.activeToolHistory[this.activeToolHistory.length-1])}clearActiveToolHistory(){this.activeToolHistory=[]}}var p=r(34896);let e=(()=>{class T{static tools={};toolbox=new w;static register(z){T.tools[z.name]=z}constructor(){this.toolbox.setTools(this.getTools())}getTool(z){return T.tools[z]}getTools(){return Object.values(T.tools)}static \u0275fac=function(Y){return new(Y||T)};static \u0275prov=p.wxM({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})();function c(T){return Q=>{e.register(Object.assign({},T,{component:Q}))}}var o=r(65056),R=r(17284),L=r(72968),_=r(40604),C=r(53291);function S(T="300ms",Q="ease-in-out"){return(0,C.gV)("toolSlideInOut",[(0,C.K2)("enter",(0,C.wb)({transform:"translate3d(0, 0, 0)"})),(0,C.aK)("void => enter",(0,C.Cs)(T+" "+Q))])}function P(T,Q){if(1&T&&(p.wR5(0,"igo-actionbar",2),p.wVc(1,"async"),p.wVc(2,"async"),p.wVc(3,"async")),2&T){const z=p.GaO();p.E7m("store",z.actionStore)("withIcon",!0)("withTitle",p.kDX(1,6,z.toolbarWithTitle$))("withTooltip",!1===p.kDX(2,8,z.toolbarWithTitle$))("scrollActive",p.kDX(3,10,z.toolbarWithTitle$))("horizontal",!1)}}const y=(T,Q)=>({"igo-tool-container-with-toolbar":T,"igo-tool-container-with-animation":Q});function F(T,Q){if(1&T){const z=p.KQA();p.I0R(0,"div",3),p.qCj("@toolSlideInOut.start",function(){p.usT(z);const N=p.GaO();return p.CGJ(N.onAnimationStart())})("@toolSlideInOut.done",function(){p.usT(z);const N=p.GaO();return p.CGJ(N.onAnimationComplete())}),p.wVc(1,"async"),p.wR5(2,"igo-dynamic-outlet",4),p.C$Y()}if(2&T){const z=Q.ngIf,Y=p.GaO();p.E7m("ngClass",p.IBC(6,y,!Y.actionStore.empty,Y.animate))("@toolSlideInOut",p.kDX(1,4,Y.animation$)),p.yG2(2),p.E7m("component",z.component)("inputs",Y.getToolInputs(z))}}let h=(()=>{class T{activeTool$=new a.g(void 0);get isActive(){return!!this.activeTool$.value}actionStore=new R.MF([]);animation$=new a.g("none");toolbar$=new a.g([]);toolbarWithTitle$=this.activeTool$.pipe((0,_.k)(z=>void 0===z));activeTool$$;toolbar$$;animating$=new a.g(!1);animating$$;toolbox;animate=!1;color="white";get classColorGrey(){return"grey"===this.color}get classColorPrimary(){return"primary"===this.color}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(z=>this.onToolbarChange(z)),this.activeTool$$=this.toolbox.activeTool$.subscribe(z=>this.onActiveToolChange(z))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(z){return z.options||{}}onToolbarChange(z){this.setToolbar(z)}onActiveToolChange(z){this.animate?this.onAnimate(()=>this.setActiveTool(z)):this.setActiveTool(z)}setActiveTool(z){if(void 0===z)this.actionStore.state.updateAll({active:!1});else{const Y=this.actionStore.get(z.name);void 0!==Y&&this.actionStore.state.update(Y,{active:!0},!0)}this.activeTool$.next(z),this.animate&&this.animation$.next("enter")}setToolbar(z){const Y=z.reduce((N,K)=>{const j=this.toolbox.getTool(K);return void 0===j||N.push({id:j.name,title:j.title,icon:j.icon,tooltip:j.tooltip,args:[j,this.toolbox],handler:(A,d)=>{d.activateTool(A.name)},ngClass:(A,d)=>this.toolbox.activeTool$.pipe((0,_.k)(u=>{let x=!1;void 0!==u&&A.name===u.name&&(x=!0);let U=!1;return void 0!==u&&A.name===u.parent&&(U=!0),{"tool-activated":x,"children-tool-activated":U}}))}),N},[]);this.actionStore.load(Y),this.toolbar$.next(z)}onAnimate(z){this.unAnimate(),this.animating$$=this.animating$.subscribe(Y=>{Y||(z.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}static \u0275fac=function(Y){return new(Y||T)};static \u0275cmp=p.In1({type:T,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(Y,N){2&Y&&p.eAK("color-grey",N.classColorGrey)("color-primary",N.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},standalone:!0,features:[p.UHJ],decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container mat-body-1",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container","mat-body-1",3,"ngClass"],[3,"component","inputs"]],template:function(Y,N){1&Y&&(p.yuY(0,P,4,12,"igo-actionbar",0),p.wVc(1,"async"),p.yuY(2,F,3,9,"div",1),p.wVc(3,"async")),2&Y&&(p.E7m("ngIf",p.kDX(1,2,N.toolbar$).length>0),p.yG2(2),p.E7m("ngIf",p.kDX(3,4,N.activeTool$)))},dependencies:[o.u_,R.AI,o.QF,L.qm,o.a],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%]     .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin:0}[_nghost-%COMP%]   .igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0;margin-bottom:0}[_nghost-%COMP%]   .igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}[_nghost-%COMP%]   .igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[S()]},changeDetection:0})}return T})()},90784:(Pe,ae,r)=>{"use strict";r.d(ae,{iC:()=>o,iA:()=>e,AB:()=>c.A,cx:()=>p});var E=r(72968),w=r(34896);let p=(()=>{class R{dynamicComponentService;constructor(_){this.dynamicComponentService=_}create(_){return this.dynamicComponentService.create(_)}static \u0275fac=function(C){return new(C||R)(w.CoB(E.O0))};static \u0275prov=w.wxM({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})(),e=(()=>{class R{static \u0275fac=function(C){return new(C||R)};static \u0275mod=w.a4G({type:R});static \u0275inj=w.s3X({})}return R})();var c=r(62120);let o=(()=>{class R{static \u0275fac=function(C){return new(C||R)};static \u0275mod=w.a4G({type:R});static \u0275inj=w.s3X({providers:[p],imports:[e,e]})}return R})()},62120:(Pe,ae,r)=>{"use strict";r.d(ae,{A:()=>e});var E=r(65056),a=r(34896),w=r(72968);function p(c,o){if(1&c&&a.wR5(0,"igo-dynamic-outlet",1),2&c){const R=a.GaO();a.E7m("component",R.widget)("inputs",R.inputs)("subscribers",R.getEffectiveSubscribers())}}let e=(()=>{class c{baseSubscribers={cancel:R=>this.onCancel(R),complete:R=>this.onComplete(R)};widget;inputs;subscribers={};complete=new a._w7;cancel=new a._w7;constructor(){}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const R=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(L=>{const _=R[L],C=this.baseSubscribers[L];R[L]=void 0!==_?S=>{_(S),C(S)}:C}),R}onCancel(R){this.cancel.emit(R),this.destroyWidget()}onComplete(R){this.complete.emit(R),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}static \u0275fac=function(L){return new(L||c)};static \u0275cmp=a.In1({type:c,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[a.UHJ],decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(L,_){1&L&&a.yuY(0,p,1,3,"igo-dynamic-outlet",0),2&L&&a.E7m("ngIf",_.widget)},dependencies:[E.u_,w.qm],styles:["[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return c})()},62154:(Pe,ae,r)=>{"use strict";r.d(ae,{ec:()=>e,uF:()=>o,cr:()=>w,Qv:()=>S});var E=r(87040),a=r(54844);class w extends E.qc{activeWorkspace$=new a.g(void 0);activateWorkspace(h){const W=this.activeWorkspace$.value;void 0!==W&&W.deactivate(),this.deactivateWorkspace(),void 0!==h&&(this.state.update(h,{active:!0,selected:!0},!0),this.activeWorkspace$.next(h),h.activate())}deactivateWorkspace(){const h=this.activeWorkspace$.value;void 0!==h&&(h.deactivate(),this.activeWorkspace$.next(void 0))}}var p=r(61616);class e{options;widget$=new a.g(void 0);widgetInputs$=new a.g({});widgetSubscribers$=new a.g({});entities$$;change=new p.E;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}constructor(h){this.options=h}get active(){return this.active$.value}active$=new a.g(!1);activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(h,W={},J={}){this.widget$.next(h),this.widgetInputs$.next(W),this.widgetSubscribers$.next(J),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}var c=r(34896);let o=(()=>{class F{store;disabled;selectedChange=new c._w7;getWorkspaceTitle(W){return(0,E.YB)(W)}onSelectedChange(W){const J=W.value;this.store.activateWorkspace(J),this.selectedChange.emit({selected:!0,value:J})}static \u0275fac=function(J){return new(J||F)};static \u0275cmp=c.In1({type:F,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[c.UHJ],decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(J,T){1&J&&(c.I0R(0,"igo-entity-selector",0),c.qCj("selectedChange",function(z){return T.onSelectedChange(z)}),c.C$Y()),2&J&&c.E7m("store",T.store)("multi",!1)("titleAccessor",T.getWorkspaceTitle)("disabled",T.disabled)},dependencies:[E.sh],changeDetection:0})}return F})();var L=r(65056),_=r(90784);function C(F,h){if(1&F){const W=c.KQA();c.SAx(0),c.I0R(1,"igo-widget-outlet",1),c.qCj("cancel",function(){const Q=c.usT(W).ngIf,z=c.GaO();return c.CGJ(z.onWidgetCancel(Q))})("complete",function(){const Q=c.usT(W).ngIf,z=c.GaO();return c.CGJ(z.onWidgetComplete(Q))}),c.wVc(2,"async"),c.wVc(3,"async"),c.C$Y(),c.k70()}if(2&F){const W=h.ngIf,J=c.GaO();c.yG2(),c.E7m("widget",W)("inputs",c.kDX(2,3,J.widgetInputs$))("subscribers",c.kDX(3,5,J.widgetSubscribers$))}}let S=(()=>{class F{workspace;deactivateWidget=new c._w7;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}constructor(){}onWidgetCancel(W){this.workspace.deactivateWidget(),this.deactivateWidget.emit(W)}onWidgetComplete(W){this.workspace.deactivateWidget(),this.deactivateWidget.emit(W)}static \u0275fac=function(J){return new(J||F)};static \u0275cmp=c.In1({type:F,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},standalone:!0,features:[c.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(J,T){1&J&&(c.yuY(0,C,4,7,"ng-container",0),c.wVc(1,"async")),2&J&&c.E7m("ngIf",c.kDX(1,1,T.widget$))},dependencies:[L.u_,_.AB,L.a],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return F})()},29904:(Pe,ae,r)=>{"use strict";r.d(ae,{SS:()=>bi,cl:()=>Xt,kP:()=>ei,AX:()=>un,W2:()=>Oe,Sm:()=>Jo,KS:()=>go,M9:()=>Z,Mb:()=>Yi,k5:()=>Si,mE:()=>sn});var E=r(65056),a=r(71904),w=r(34672),p=r(24296),e=r(46176),c=r(75180),o=r(50244),R=r(42536),L=r(77872),_=r(38776),C=r(45872),S=r(20460),P=r(64100),y=r(54844),F=r(37496),h=r(45928),W=r(56740),J=r(62004),T=r(31492),Q=r(43168),z=r(12396),Y=r(80848),N=r(3784),K=r(28772),j=r(61616),A=r(1296),d=r(68013),u=r(83680),x=r(51672),U=r(78600),G=r(40604),X=r(9240),D=r(24112),I=function(oe){return oe[oe.null=0]="null",oe[oe.read=1]="read",oe[oe.write=2]="write",oe}(I||{}),s=r(34896),H=r(33712);let Z=(()=>{class oe{http;authService;languageService;config;messageService;storageService;exportService;route;context$=new y.g(void 0);contexts$=new y.g({ours:[]});defaultContextId$=new y.g(void 0);editedContext$=new y.g(void 0);importedContext=[];toolsChanged$=new j.E;mapViewFromRoute={};options;baseUrl;tools;toolbar;get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(v){this._defaultContextUri=v}_defaultContextUri;constructor(v,V,ee,Ce,Te,je,nt,_t){this.http=v,this.authService=V,this.languageService=ee,this.config=Ce,this.messageService=Te,this.storageService=je,this.exportService=nt,this.route=_t,this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url??"",this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(ot=>{ot&&(this.contexts$.pipe((0,d.s)(1),(0,u.K)()).subscribe(Dt=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get(v,V){let ee=this.baseUrl+"/contexts";return v&&this.authService.authenticated&&(ee+="?permission="+v.join(),V&&(ee+="&hidden=true")),this.http.get(ee)}getById(v){return this.http.get(this.baseUrl+"/contexts/"+v)}getDetails(v){return this.http.get(`${this.baseUrl}/contexts/${v}/details`).pipe((0,x.a)(ee=>{throw this.handleError(ee,v),ee}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,U.y)(V=>{this.defaultContextId$.next(V.id)}));{const v=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(v),this.getContextByUri(v)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,A.of)([])}setDefault(v){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:v}):(this.storageService.set("favorite.context.uri",v),(0,A.of)(void 0))}hideContext(v){return this.http.post(this.baseUrl+"/contexts/"+v+"/hide",{})}showContext(v){return this.http.post(this.baseUrl+"/contexts/"+v+"/show",{})}delete(v,V=!1){const ee={ours:[]};return Object.keys(this.contexts$.value).forEach(Te=>ee[Te]=this.contexts$.value[Te].filter(je=>je.id!==v)),V?(this.importedContext=this.importedContext.filter(Te=>Te.id!==v),(0,A.of)(this.contexts$.next(ee))):this.http.delete(this.baseUrl+"/contexts/"+v).pipe((0,U.y)(Te=>{this.contexts$.next(ee)}))}create(v){return this.http.post(this.baseUrl+"/contexts",v).pipe((0,G.k)(ee=>(ee.permission=this.authService.authenticated?I[I.write]:I[I.read],this.contexts$.value.ours.unshift(ee),this.contexts$.next(this.contexts$.value),ee)))}clone(v,V={}){return this.http.post(this.baseUrl+"/contexts/"+v+"/clone",V).pipe((0,G.k)(Ce=>(Ce.permission=I[I.write],this.contexts$.value.ours.unshift(Ce),this.contexts$.next(this.contexts$.value),Ce)))}update(v,V){return this.http.patch(this.baseUrl+"/contexts/"+v,V)}addToolAssociation(v,V){return this.http.post(`${this.baseUrl}/contexts/${v}/tools`,{toolId:V})}deleteToolAssociation(v,V){return this.http.delete(`${this.baseUrl}/contexts/${v}/tools/${V}`)}getPermissions(v){return this.http.get(this.baseUrl+"/contexts/"+v+"/permissions")}addPermissionAssociation(v,V,ee){return this.http.post(`${this.baseUrl}/contexts/${v}/permissions`,{profil:V,typePermission:ee}).pipe((0,x.a)(je=>{throw this.handleError(je,void 0,!0),[je]}))}deletePermissionAssociation(v,V){return this.http.delete(`${this.baseUrl}/contexts/${v}/permissions/${V}`)}getLocalContexts(){const v=this.getPath(this.options.contextListFile);return this.http.get(v).pipe((0,G.k)(V=>({ours:V})))}getLocalContext(v){const V=this.getPath(`${v}.json`);return this.http.get(V).pipe((0,X.O)(ee=>{if(!ee.base)return(0,A.of)(ee);const Ce=this.getPath(`${ee.base}.json`);return this.http.get(Ce).pipe((0,G.k)(Te=>{const je=ee;return je.map=Q.Yv.mergeDeep(Te.map,ee.map),je.layers=(Te.layers||[]).concat(ee.layers||[]).reverse().filter((nt,_t,ot)=>!nt.id||ot.findIndex(Dt=>Dt.id===nt.id)===_t).reverse(),je.toolbar=ee.toolbar||Te.toolbar,je.message=ee.message||Te.message,je.messages=ee.messages||Te.messages,je.tools=(ee.tools||[]).concat(Te.tools||[]).filter((nt,_t,ot)=>ot.findIndex(Dt=>Dt.name===nt.name)===_t),je}),(0,x.a)(Te=>{throw this.handleError(Te,v),Te}))}),(0,x.a)(ee=>{throw this.handleError(ee,v),ee}))}loadContexts(v,V){let ee;ee=this.baseUrl?this.get(v,V):this.getLocalContexts(),ee.subscribe(Ce=>{Ce.ours=this.importedContext.concat(Ce.ours),this.contexts$.next(Ce)})}loadDefaultContext(){const v=(V=!1)=>{!V&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(ee=>{this.defaultContextUri=ee.uri,this.addContextToList(ee),this.setContext(ee)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,D.o)(100)).subscribe(V=>{const ee=V[this.route.options.contextKey];let Ce=!1;ee&&(this.defaultContextUri=ee,Ce=!0),v(Ce)}):v()}loadContext(v){const V=this.context$.value;V&&V.uri===v||this.getContextByUri(v).pipe((0,u.K)()).subscribe(ee=>{this.addContextToList(ee),this.setContext(ee)},ee=>{v!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(v){this.handleContextMessage(v);const V=this.context$.value;if(V&&v&&v.id===V.id)return void 0===v.map.view.keepCurrentView&&(v.map.view.keepCurrentView=!0),void this.context$.next(v);v.map||(v.map={view:{}}),Object.assign(v.map.view,this.mapViewFromRoute),this.context$.next(v)}loadEditedContext(v){this.getContextByUri(v).subscribe(V=>{this.setEditedContext(V)})}setEditedContext(v){this.editedContext$.next(v)}getContextFromMap(v,V){const ee=v.ol.getView(),Ce=ee.getProjection().getCode(),Te=new Y.c(ee.getCenter()).transform(Ce,"EPSG:4326"),je={uri:(0,Q.uq)(),title:"",scope:"private",map:{view:{center:Te.getCoordinates(),zoom:ee.getZoom(),projection:Ce,maxZoomOnExtent:v.viewController.maxZoomOnExtent}},layers:[],tools:[]};let nt=[];nt=!0===V?v.layers$.getValue().filter(ot=>!0===ot.baseLayer||"searchPointerSummaryId"===ot.options.id).sort((ot,Dt)=>ot.zIndex-Dt.zIndex):v.layers$.getValue().filter(ot=>!ot.id.includes("WfsWorkspaceTableDest")).sort((ot,Dt)=>ot.zIndex-Dt.zIndex);let _t=0;for(const ot of nt){const Dt={title:ot.options.title,zIndex:++_t,visible:ot.visible,security:ot.options.security,opacity:ot.opacity},wt={id:ot.options.id?String(ot.options.id):void 0,layerOptions:Dt,sourceOptions:{type:ot.dataSource.options.type,params:ot.dataSource.options.params,url:ot.dataSource.options.url,queryable:ot.queryable}};wt.sourceOptions.type&&je.layers.push(wt)}return je.tools=this.tools.map(ot=>({id:String(ot.id),global:ot.global})),je}getContextFromLayers(v,V,ee,Ce){const Te=this.context$.getValue(),je=v.ol.getView(),nt=je.getProjection().getCode(),ot={uri:ee,title:ee,map:{view:{center:new Y.c(je.getCenter()).transform(nt,"EPSG:4326").getCoordinates(),zoom:je.getZoom(),projection:nt,keepCurrentView:Ce}},layers:[],toolbar:[],tools:[],extraFeatures:[]},Dt=v.layers$.getValue();return ot.layers=Dt.filter(wt=>wt.baseLayer).map(wt=>({baseLayer:!0,sourceOptions:wt.options.sourceOptions,title:wt.options.title,visible:wt.visible})),V.forEach(wt=>{const gt=Te.layers.find(rt=>{const ao=rt.source;return ao&&wt.id===ao.id&&!rt.baseLayer});if(gt){let rt=gt,ao=rt.style;rt.igoStyle?.styleByAttribute?ao=void 0:rt.igoStyle?.clusterBaseStyle&&(ao=void 0,delete gt.sourceOptions.source,delete gt.sourceOptions.format),delete gt.source;const Oi={...gt,title:wt.options.title,zIndex:wt.zIndex,style:ao,visible:wt.visible,opacity:wt.opacity};ot.layers.push(Oi)}else if(wt.ol.getSource()instanceof K.c){const rt=this.getExtraFeatures(wt);rt.name=wt.options.title,rt.opacity=wt.opacity,rt.visible=wt.visible,ot.extraFeatures.push(rt)}else{const rt=wt.options;rt.zIndex=wt.zIndex,rt.visible=wt.visible,rt.opacity=wt.opacity,delete rt.source,ot.layers.push(rt)}}),ot.toolbar=this.toolbar,ot.tools=this.tools,ot}getExtraFeatures(v){const V=new z.c;let ee;v.ol.getSource()instanceof N.c?(ee=v.ol.getSource().getFeatures(),ee=ee.flatMap(nt=>nt.get("features"))):ee=v.ol.getSource().getFeatures();const Ce=this.exportService.generateFeature(ee,"GeoJSON","_featureStore"),Te=V.writeFeatures(Ce,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return JSON.parse(Te)}setTools(v){this.tools=v}setToolbar(v){this.toolbar=v}handleContextMessage(v){this.context$.value&&v.uri&&this.context$.value.uri!==v.uri&&this.messageService.removeAllAreNotError(),v.messages=v.messages?v.messages:[],v.messages.push(v.message),v.messages.map(V=>{V&&this.messageService.message(V)})}getContextByUri(v){if(this.baseUrl){let ee;for(const Te of Object.keys(this.contexts$.value))if(ee=this.contexts$.value[Te].find(je=>je.uri===v),ee)break;return ee&&ee.imported?(0,A.of)(ee):this.getDetails(ee?ee.id:v)}const V=this.contexts$.value.ours.find(ee=>ee.uri===v&&!0===ee.imported);return V?(0,A.of)(V):this.getLocalContext(v)}getContextLayers(v){const V=[];return v.layers$.getValue().forEach(Ce=>{!Ce.baseLayer&&"searchPointerSummaryId"!==Ce.options.id&&V.push(Ce)}),V}readParamsFromRoute(){this.route&&this.route.queryParams.subscribe(v=>{const V=this.route.options.centerKey;V&&v[V]&&(this.mapViewFromRoute.center=v[V].split(",").map(Number));const ee=this.route.options.projectionKey;ee&&v[ee]&&(this.mapViewFromRoute.projection=v[ee]);const Ce=this.route.options.zoomKey;Ce&&v[Ce]&&(this.mapViewFromRoute.zoom=Number(v[Ce]))})}getPath(v){return`${this.options.basePath.replace(/\/$/,"")}/${v}`}handleError(v,V,ee){const Ce=this.contexts$.value.ours.find(je=>je.uri===V),Te=Ce?Ce.title:V;v.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),v.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:Te}),v.error.toDisplay=!0,ee&&(v.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),v.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(v=!0){const V=this.context$.value,ee=this.editedContext$.value;(!V||V.uri===this.options.defaultContextUri)&&(v=!1),v&&this.findContext(V)?(this.getContextByUri(V.uri).pipe((0,u.K)()).subscribe(Te=>{this.toolsChanged$.next(Te)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const Ce=this.findContext(ee);(!Ce||"write"!==Ce.permission)&&this.setEditedContext(void 0)}addContextToList(v){this.findContext(v)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:v.id,uri:v.uri,title:v.title,scope:v.scope,permission:I[I.read]}),this.contexts$.next(this.contexts$.value))}findContext(v){if(!v)return!1;const V=this.contexts$.value;let ee;for(const Ce of Object.keys(V))if(ee=V[Ce].find(je=>v.id&&je.id===v.id||v.uri&&je.uri===v.uri),ee)break;return ee}static \u0275fac=function(V){return new(V||oe)(s.CoB(H.KK),s.CoB(h.oj),s.CoB(S.ov),s.CoB(C.aW),s.CoB(P.mi),s.CoB(J.yQ),s.CoB(T.YNI),s.CoB(W.k$,8))};static \u0275prov=s.wxM({token:oe,factory:oe.\u0275fac,providedIn:"root"})}return oe})();var me=r(21296);class _e extends Error{}class le extends _e{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,le.prototype)}}let ue=(()=>{class oe{export(v){return this.exportAsync(v)}exportAsync(v){return new me._(ee=>{if(!0===this.nothingToExport(v))return void ee.error(new le);const Te=JSON.stringify(v);(0,Q.We)(Te,"text/json;charset=utf-8",`${v.uri}.json`),ee.complete()})}nothingToExport(v){return void 0===v.map}static \u0275fac=function(V){return new(V||oe)};static \u0275prov=s.wxM({token:oe,factory:oe.\u0275fac,providedIn:"root"})}return oe})();class Le extends Error{}class He extends Le{constructor(){super("Invalid file"),Object.setPrototypeOf(this,He.prototype)}}class Ve extends Le{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,Ve.prototype)}}class Ge extends Le{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Ge.prototype)}}class ct extends Le{constructor(){super("File is too large"),Object.setPrototypeOf(this,Ge.prototype)}}function ge(oe,We,v){v.error("igo.context.contextImportExport.import.invalid.text","igo.context.contextImportExport.import.invalid.title",void 0,{value:oe.name,mimeType:oe.type})}function Re(oe,We,v,V){v.error("igo.context.contextImportExport.import.tooLarge.text","igo.context.contextImportExport.import.tooLarge.title",void 0,{value:oe.name,size:V})}function Ue(oe,We,v){v.error("igo.context.contextImportExport.import.unreadable.text","igo.context.contextImportExport.import.unreadable.title",void 0,{value:oe.name})}function It(oe){return(new z.c).readFeatures(oe,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}let at=(()=>{class oe{config;static allowedMimeTypes=["application/json"];static allowedExtensions="json";clientSideFileSizeMax;constructor(v){this.config=v;const V=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(V||30)*Math.pow(1024,2)}import(v){return this.importAsync(v)}getFileImporter(v){const V=function st(oe){return oe.name.split(".").pop().toLowerCase()}(v),ee=v.type,Ce=[...oe.allowedMimeTypes],Te=oe.allowedExtensions;if(!(Ce.indexOf(ee)<0&&Te.indexOf(V)<0||"application/json"!==ee&&V!==oe.allowedExtensions))return this.importFile}importAsync(v){return new me._(ee=>{if(v.size>=this.clientSideFileSizeMax)return void ee.error(new ct);const Ce=this.getFileImporter(v);void 0!==Ce?Ce.call(this,v,ee):ee.error(new He)})}importFile(v,V){const ee=new FileReader;ee.onload=Ce=>{try{const Te=this.parseContextFromFile(v,Ce.target.result);V.next(Te)}catch{V.error(new Ve)}V.complete()},ee.onerror=Ce=>{V.error(new Ve)},ee.readAsText(v,"UTF-8")}parseContextFromFile(v,V){return JSON.parse(V)}static \u0275fac=function(V){return new(V||oe)(s.CoB(C.aW))};static \u0275prov=s.wxM({token:oe,factory:oe.\u0275fac,providedIn:"root"})}return oe})();var Ft=r(72584);const Et=oe=>({size:oe});function Kt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"div")(1,"form",5)(2,"div",6)(3,"button",7),s.qCj("click",function(){s.usT(v);const ee=s.Gew(10);return s.CGJ(ee.click())}),s.wVc(4,"async"),s.OEk(5),s.wVc(6,"translate"),s.C$Y(),s.wR5(7,"igo-spinner",8),s.wVc(8,"async"),s.I0R(9,"input",9,10),s.qCj("click",function(){s.usT(v);const ee=s.Gew(10);return s.CGJ(ee.value=null)})("change",function(ee){s.usT(v);const Ce=s.GaO();return s.CGJ(Ce.importFiles(ee.target.files))}),s.C$Y()()(),s.I0R(11,"section",11)(12,"h4"),s.OEk(13),s.wVc(14,"translate"),s.C$Y(),s.I0R(15,"ul")(16,"li"),s.OEk(17),s.wVc(18,"translate"),s.C$Y()()()()}if(2&oe){const v=s.GaO();s.yG2(3),s.E7m("disabled",s.kDX(4,7,v.loading$)),s.yG2(2),s.oRS(" ",s.kDX(6,9,"igo.geo.importExportForm.importButton")," "),s.yG2(2),s.E7m("shown",s.kDX(8,11,v.loading$)),s.yG2(2),s.m4B("display","none"),s.yG2(4),s.cNF(s.kDX(14,13,"igo.geo.importExportForm.importClarifications")),s.yG2(4),s.oRS(" ",s.g7$(18,15,"igo.geo.importExportForm.importSizeMax",s.S45(18,Et,v.fileSizeMb))," ")}}function yt(oe,We){if(1&oe&&(s.I0R(0,"mat-option",2),s.OEk(1),s.C$Y()),2&oe){const v=We.$implicit;s.E7m("value",v),s.yG2(),s.cNF(v.title)}}function Oo(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"form",12)(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),s.OEk(4),s.wVc(5,"translate"),s.C$Y(),s.wR5(6,"input",15),s.C$Y()(),s.I0R(7,"div",13)(8,"mat-form-field")(9,"mat-label"),s.OEk(10),s.wVc(11,"translate"),s.C$Y(),s.I0R(12,"mat-select",16)(13,"mat-option",17,18),s.qCj("click",function(){s.usT(v);const ee=s.Gew(14),Ce=s.GaO();return s.CGJ(Ce.selectAll(ee))}),s.OEk(15),s.wVc(16,"translate"),s.C$Y(),s.wR5(17,"mat-divider"),s.yuY(18,yt,2,2,"mat-option",19),s.C$Y()()(),s.I0R(19,"div",6)(20,"button",7),s.qCj("click",function(){s.usT(v);const ee=s.GaO();return s.CGJ(ee.handleExportFormSubmit(ee.form.value))}),s.wVc(21,"async"),s.OEk(22),s.wVc(23,"translate"),s.C$Y(),s.wR5(24,"igo-spinner",8),s.wVc(25,"async"),s.C$Y()()}if(2&oe){const v=s.GaO();s.E7m("formGroup",v.form),s.yG2(4),s.cNF(s.kDX(5,9,"igo.context.contextImportExport.export.exportContextName")),s.yG2(6),s.cNF(s.kDX(11,11,"igo.context.contextImportExport.export.exportPlaceHolder")),s.yG2(3),s.E7m("value",1),s.yG2(2),s.oRS(" ",s.kDX(16,13,"igo.context.contextImportExport.export.exportSelectAll")," "),s.yG2(3),s.E7m("ngForOf",v.userControlledLayerList),s.yG2(2),s.E7m("disabled",!v.form.valid||s.kDX(21,15,v.loading$)),s.yG2(2),s.oRS(" ",s.kDX(23,17,"igo.geo.importExportForm.exportButton")," "),s.yG2(2),s.E7m("shown",s.kDX(25,19,v.loading$))}}let ei=(()=>{class oe{contextImportService;contextExportService;messageService;formBuilder;config;contextService;form;layers;inputProj="EPSG:4326";loading$=new y.g(!1);forceNaming=!1;layerList;userControlledLayerList;res;clientSideFileSizeMax;fileSizeMb;activeImportExport="import";layers$$;map;constructor(v,V,ee,Ce,Te,je){this.contextImportService=v,this.contextExportService=V,this.messageService=ee,this.formBuilder=Ce,this.config=Te,this.contextService=je,this.buildForm()}ngOnInit(){const v=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(v||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.layers$$=this.map.layers$.subscribe(()=>{this.layerList=this.contextService.getContextLayers(this.map),this.userControlledLayerList=this.layerList.filter(V=>V.showInLayerList)})}importFiles(v){this.loading$.next(!0);for(const V of v)this.contextImportService.import(V).pipe((0,F.U)(1)).subscribe(ee=>this.onFileImportSuccess(V,ee),ee=>this.onFileImportError(V,ee),()=>{this.loading$.next(!1)})}handleExportFormSubmit(v){this.loading$.next(!0),this.res=this.contextService.getContextFromLayers(this.map,v.layers,v.name,!1),this.res.imported=!0,this.contextExportService.export(this.res).pipe((0,F.U)(1)).subscribe(()=>{},V=>this.onFileExportError(V),()=>{this.onFileExportSuccess(),this.loading$.next(!1)})}buildForm(){this.form=this.formBuilder.group({layers:["",[a.AQ.required]],name:["",[a.AQ.required]]})}onFileImportSuccess(v,V){!function Ye(oe,We,v,V){if(Object.keys(We).length<=0)return void function ze(oe,We){We.error("igo.context.contextImportExport.import.empty.text","igo.context.contextImportExport.import.empty.title",void 0,{value:oe.name})}(oe,v);const ee=function xe(oe){return oe.name.substr(0,oe.name.lastIndexOf("."))}(oe);(function Be(oe,We,v){oe.title=We,oe.imported=!0,v.contexts$.value.ours.unshift(oe),v.contexts$.next(v.contexts$.value),v.importedContext.unshift(oe),v.loadContext(oe.uri)})(We,ee,V),v.success("igo.context.contextImportExport.import.success.text","igo.context.contextImportExport.import.success.title",void 0,{value:ee})}(v,V,this.messageService,this.contextService)}onFileImportError(v,V){this.loading$.next(!1),function se(oe,We,v,V){({"Invalid file":ge,"File is too large":Re,"Failed to read file":Ue})[We.message](oe,We,v,V=V||30)}(v,V,this.messageService,this.fileSizeMb)}onFileExportError(v){this.loading$.next(!1),function ne(oe,We){oe instanceof le?this.handleNothingToExportError(We):We.error("igo.context.contextImportExport.export.failed.text","igo.context.contextImportExport.export.failed.title")}(v,this.messageService)}onFileExportSuccess(){!function ve(oe){oe.success("igo.context.contextImportExport.export.success.text","igo.context.contextImportExport.export.success.title")}(this.messageService)}selectAll(v){v._selected&&(this.form.controls.layers.setValue(this.userControlledLayerList),v._selected=!0),!1===v._selected&&this.form.controls.layers.setValue([])}onImportExportChange(v){this.activeImportExport=v.value}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(V){return new(V||oe)(s.GI1(at),s.GI1(ue),s.GI1(P.mi),s.GI1(a.KE),s.GI1(C.aW),s.GI1(Z))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-import-export"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:10,vars:11,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],[4,"ngIf"],["class","igo-form",3,"formGroup",4,"ngIf"],[1,"igo-form"],[1,"igo-form-button-group"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["type","file",3,"click","change"],["fileInput",""],[1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[1,"example-full-width"],["formControlName","name","matInput","",3,"value"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value",4,"ngFor","ngForOf"]],template:function(V,ee){1&V&&(s.I0R(0,"div",0)(1,"mat-button-toggle-group",1),s.qCj("change",function(Te){return ee.onImportExportChange(Te)}),s.I0R(2,"mat-button-toggle",2),s.OEk(3),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"mat-button-toggle",2),s.OEk(6),s.wVc(7,"translate"),s.C$Y()()(),s.yuY(8,Kt,19,20,"div",3)(9,Oo,26,21,"form",4)),2&V&&(s.yG2(),s.E7m("value",ee.activeImportExport),s.yG2(),s.E7m("value","import"),s.yG2(),s.oRS(" ",s.kDX(4,7,"igo.geo.importExportForm.importTabTitle")," "),s.yG2(2),s.E7m("value","export"),s.yG2(),s.oRS(" ",s.kDX(7,9,"igo.geo.importExportForm.exportTabTitle")," "),s.yG2(2),s.E7m("ngIf","import"===ee.activeImportExport),s.yG2(),s.E7m("ngIf","export"===ee.activeImportExport))},dependencies:[p.ue,p.gn,p.KU,E.u_,a.y,a.sz,a.ot,a.ue,a.u,a.SC,w.oJ,w.Gw,_.is,a.sl,a.uW,a.Wo,o.wb,o.Up,o.w5,R.cN,R.yi,L.d5,L.kX,e.I5,e.Ax,c.U,c.k,E.Iw,E.a,S._s,Ft.sD],styles:[".import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.igo-input-container[_ngcontent-%COMP%]{padding:10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}"]})}return oe})();var xt=r(32328),ut=r(27e3);function Go(oe,We){if(1&oe&&(s.I0R(0,"span",10),s.OEk(1),s.C$Y()),2&oe){const v=s.GaO();s.yG2(),s.oRS("",v.prefix,"-")}}let Ze=(()=>{class oe{formBuilder;messageService;form;prefix;get btnSubmitText(){return this._btnSubmitText}set btnSubmitText(v){this._btnSubmitText=v}_btnSubmitText;get context(){return this._context}set context(v){this._context=v,this.buildForm()}_context;get disabled(){return this._disabled}set disabled(v){this._disabled=v}_disabled=!1;submitForm=new s._w7;clone=new s._w7;delete=new s._w7;constructor(v,V){this.formBuilder=v,this.messageService=V}ngOnInit(){this.buildForm()}handleFormSubmit(v){let V=Object.assign({},v);V=Q.Yv.removeNull(V),V.uri=V.uri.replace(" ",""),V.uri=V.uri?this.prefix+"-"+V.uri:this.prefix,this.submitForm.emit(V)}copyTextToClipboard(){const v=this.prefix+"-"+this.form.value.uri.replace(" ","");Q._D.copy(v)&&this.messageService.success("igo.context.contextManager.dialog.copyMsg","igo.context.contextManager.dialog.copyTitle")}buildForm(){const v=this.context||{},V=v.uri.split("-");this.prefix=V.shift();const ee=V.join("-");this.form=this.formBuilder.group({title:[v.title],uri:[ee||" "]})}static \u0275fac=function(V){return new(V||oe)(s.GI1(a.KE),s.GI1(P.mi))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-form"]],inputs:{btnSubmitText:"btnSubmitText",context:"context",disabled:"disabled"},outputs:{submitForm:"submitForm",clone:"clone",delete:"delete"},standalone:!0,features:[s.UHJ],decls:20,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","maxlength","128","formControlName","title",3,"placeholder"],["id","uriInput",1,"full-width"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","maxlength","64","floatLabel","always","formControlName","uri",3,"placeholder"],["id","copyButton","type","button","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[1,"prefix"]],template:function(V,ee){1&V&&(s.I0R(0,"form",0),s.qCj("ngSubmit",function(){return ee.handleFormSubmit(ee.form.value)}),s.I0R(1,"mat-form-field",1),s.wR5(2,"input",2),s.wVc(3,"translate"),s.I0R(4,"mat-error"),s.OEk(5),s.wVc(6,"translate"),s.C$Y()(),s.I0R(7,"mat-form-field",3),s.yuY(8,Go,2,1,"span",4),s.I0R(9,"span",5),s.wR5(10,"input",6),s.wVc(11,"translate"),s.C$Y()(),s.I0R(12,"button",7),s.qCj("click",function(){return ee.copyTextToClipboard()}),s.wVc(13,"translate"),s.I0R(14,"mat-icon"),s.OEk(15,"content_copy"),s.C$Y()(),s.I0R(16,"div",8)(17,"button",9),s.OEk(18),s.wVc(19,"translate"),s.C$Y()()()),2&V&&(s.E7m("formGroup",ee.form),s.yG2(2),s.E7m("placeholder",s.kDX(3,8,"igo.context.contextManager.form.title")),s.yG2(3),s.oRS(" ",s.kDX(6,10,"igo.context.contextManager.form.titleRequired")," "),s.yG2(3),s.E7m("ngIf",ee.prefix),s.yG2(2),s.E7m("placeholder",s.kDX(11,12,"igo.context.contextManager.form.uri")),s.yG2(2),s.E7m("matTooltip",s.kDX(13,14,"igo.context.contextManager.form.copy")),s.yG2(5),s.E7m("disabled",!ee.form.valid||ee.disabled),s.yG2(),s.oRS(" ",s.kDX(19,16,"igo.context.contextManager.form.edit")," "))},dependencies:[a.y,a.sz,a.ot,a.ue,a.u,a.eJ,a.Mj,a.sl,a.uW,a.Wo,o.wb,o.Up,o.wJ,R.cN,R.yi,E.u_,w.oJ,w.Gw,w.um,ut.KO,ut.a4,xt.oB,xt.qL,S._s,Ft.sD],styles:["form[_ngcontent-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}#copyButton[_ngcontent-%COMP%]{width:24px;float:right;position:relative;top:-58px;left:5px}"]})}return oe})();function Io(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"igo-context-form",1),s.qCj("submitForm",function(ee){s.usT(v);const Ce=s.GaO();return s.CGJ(Ce.submitForm.emit(ee))}),s.wVc(1,"translate"),s.C$Y()}if(2&oe){const v=s.GaO();s.E7m("btnSubmitText",s.kDX(1,2,"igo.context.contextManager.save"))("context",v.context)}}let Xt=(()=>{class oe{cd;get context(){return this._context}set context(v){this._context=v,this.refresh()}_context;submitForm=new s._w7;constructor(v){this.cd=v}refresh(){this.cd.detectChanges()}static \u0275fac=function(V){return new(V||oe)(s.GI1(s.kD9))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-edit"]],inputs:{context:"context"},outputs:{submitForm:"submitForm"},standalone:!0,features:[s.UHJ],decls:1,vars:1,consts:[[3,"btnSubmitText","context","submitForm",4,"ngIf"],[3,"btnSubmitText","context","submitForm"]],template:function(V,ee){1&V&&s.yuY(0,Io,2,4,"igo-context-form",0),2&V&&s.E7m("ngIf",ee.context)},dependencies:[E.u_,Ze,S._s,Ft.sD],encapsulation:2})}return oe})();var eo=r(63916),$o=r(92096),Ao=r(90568);function No(oe,We){if(1&oe&&(s.I0R(0,"mat-icon"),s.OEk(1),s.C$Y()),2&oe){const v=s.GaO(2);s.yG2(),s.cNF(v.context.icon?v.context.icon:"public"===v.context.scope?"public":"star")}}function pi(oe,We){if(1&oe&&s.wR5(0,"img",7),2&oe){const v=s.GaO(2);s.E7m("src",v.context.iconImage,s.K6U)}}function no(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",4),s.qCj("click",function(){s.usT(v);const ee=s.GaO();return s.CGJ(ee.favoriteClick(ee.context))}),s.wVc(1,"translate"),s.yuY(2,No,2,1,"mat-icon",5)(3,pi,1,1,"img",6),s.C$Y()}if(2&oe){const v=s.GaO();s.E7m("matTooltip",v.auth.authenticated?s.kDX(1,4,"igo.context.contextManager.favorite"):"")("color",v.default?"primary":"default"),s.yG2(2),s.E7m("ngIf",!v.context.iconImage),s.yG2(),s.E7m("ngIf",v.context.iconImage)}}function ro(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",4),s.qCj("click",function(){s.usT(v);const ee=s.GaO();return s.CGJ(ee.favoriteClick(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"star"),s.C$Y()()}if(2&oe){const v=s.GaO();s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.favorite"))("color",v.default?"primary":"default")}}function pt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",18),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.save.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"save"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.save"))("color",v.color)}}function wo(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",19),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.managePermissions.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"manage_accounts"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.managePermissions"))("color",v.color)}}function ti(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",20),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.clone.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"content_copy"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.clone"))("color",v.color)}}function Ho(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",21),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.edit.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"edit"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("color",v.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.edit"))}}function Ri(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",22),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.hide.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"visibility"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("color",v.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.hide"))}}function To(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",22),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.show.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"visibility_off"),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.E7m("color",v.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.show"))}}function Eo(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",23),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.delete.emit(ee.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"delete"),s.C$Y()()}2&oe&&s.E7m("matTooltip",s.kDX(1,1,"igo.context.contextManager.delete"))}function so(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"div",8),s.yuY(1,pt,4,4,"button",9),s.I0R(2,"div",10,11),s.yuY(4,wo,4,4,"button",12)(5,ti,4,4,"button",13)(6,Ho,4,4,"button",14)(7,Ri,4,4,"button",15)(8,To,4,4,"button",15)(9,Eo,4,3,"button",16),s.C$Y(),s.I0R(10,"button",17),s.qCj("click",function(){s.usT(v);const ee=s.GaO();return s.CGJ(ee.collapsed=!ee.collapsed)}),s.I0R(11,"mat-icon"),s.OEk(12,"more_horiz"),s.C$Y()()()}if(2&oe){const v=s.Gew(3),V=s.GaO();s.yG2(),s.E7m("ngIf",V.collapsed&&V.selected&&(V.context.permission===V.typePermission[V.typePermission.write]||V.context.imported)),s.yG2(3),s.E7m("ngIf",V.canShare&&!V.context.imported),s.yG2(),s.E7m("ngIf",!V.context.imported),s.yG2(),s.E7m("ngIf",V.context.permission===V.typePermission[V.typePermission.write]&&!V.context.imported),s.yG2(),s.E7m("ngIf",!V.context.hidden&&!V.context.imported),s.yG2(),s.E7m("ngIf",V.context.hidden&&!V.context.imported),s.yG2(),s.E7m("ngIf",V.context.permission===V.typePermission[V.typePermission.write]||V.context.imported),s.yG2(),s.E7m("color",V.color)("target",v)("collapsed",V.collapsed)}}const to=oe=>({"mat-list-item-light":oe});let Mt=(()=>{class oe{auth;storageService;typePermission=I;color="primary";collapsed=!0;showFavorite=!0;context;default;selected;edit=new s._w7;delete=new s._w7;save=new s._w7;clone=new s._w7;hide=new s._w7;show=new s._w7;favorite=new s._w7;managePermissions=new s._w7;manageTools=new s._w7;get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}constructor(v,V){this.auth=v,this.storageService=V}favoriteClick(v){this.favorite.emit(v)}static \u0275fac=function(V){return new(V||oe)(s.GI1(h.oj),s.GI1(J.yQ))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},standalone:!0,features:[s.UHJ],decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[4,"ngIf"],[3,"src",4,"ngIf"],[3,"src"],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"]],template:function(V,ee){1&V&&(s.I0R(0,"mat-list-item",0),s.yuY(1,no,4,6,"button",1)(2,ro,4,4,"button",1),s.I0R(3,"span",2),s.OEk(4),s.C$Y(),s.yuY(5,so,13,10,"div",3),s.C$Y()),2&V&&(s.E7m("ngClass",s.S45(5,to,ee.hidden)),s.yG2(),s.E7m("ngIf",ee.auth.authenticated),s.yG2(),s.E7m("ngIf",!ee.auth.authenticated&&ee.showFavorite),s.yG2(2),s.cNF(ee.context.title),s.yG2(),s.E7m("ngIf",ee.auth.authenticated))},dependencies:[eo.iI,eo.g9,eo.EV,eo.UV,eo.At,E.QF,E.u_,w.oJ,w.um,Ao.mw,ut.KO,ut.a4,xt.oB,xt.qL,$o.mK,S._s,Ft.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   .igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   button[matlistitemavatar][_ngcontent-%COMP%]{margin-right:8px}"],changeDetection:0})}return oe})();var _o=r(58539),ko=r(87848),Bo=r(17284),Jt=r(28180),Uo=r(23680),xo=r(43451),Yo=r(25376),Yt=r(40600);let Mo=(()=>{class oe{dialogRef;title;constructor(v){this.dialogRef=v}static \u0275fac=function(V){return new(V||oe)(s.GI1(Yt.yI))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-bookmark-dialog"]],standalone:!0,features:[s.UHJ],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(V,ee){1&V&&(s.I0R(0,"h1",0),s.OEk(1),s.wVc(2,"translate"),s.C$Y(),s.I0R(3,"div",1)(4,"mat-form-field")(5,"input",2),s.iHE("ngModelChange",function(Te){return s.kNx(ee.title,Te)||(ee.title=Te),Te}),s.wVc(6,"translate"),s.C$Y()()(),s.I0R(7,"div",3)(8,"button",4),s.qCj("click",function(){return ee.dialogRef.close(ee.title)}),s.OEk(9),s.wVc(10,"translate"),s.C$Y(),s.I0R(11,"button",5),s.qCj("click",function(){return ee.dialogRef.close(!1)}),s.OEk(12),s.wVc(13,"translate"),s.C$Y()()),2&V&&(s.yG2(),s.oRS(" ",s.kDX(2,6,"igo.context.bookmarkButton.dialog.title"),"\n"),s.yG2(4),s.E7m("placeholder",s.kDX(6,8,"igo.context.bookmarkButton.dialog.placeholder")),s.OKB("ngModel",ee.title),s.yG2(3),s.E7m("disabled",!ee.title),s.yG2(),s.oRS(" ",s.kDX(10,10,"igo.common.confirmDialog.confirmBtn")," "),s.yG2(3),s.oRS(" ",s.kDX(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[Yt.WQ,Yt.iU,o.wb,o.Up,R.cN,R.yi,a.y,a.ot,a.ue,a.eJ,a.Mj,a._G,Yt.Yp,w.oJ,w.Gw,S._s,Ft.sD],encapsulation:2})}return oe})();var Vo=function(oe){return oe.always="always",oe.never="never",oe.default="default",oe}(Vo||{});function we(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",17),s.qCj("click",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.clearFilter())}),s.I0R(1,"mat-icon"),s.OEk(2,"close"),s.C$Y()()}}function qe(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"mat-form-field",14)(1,"mat-label"),s.OEk(2),s.wVc(3,"translate"),s.C$Y(),s.I0R(4,"input",15),s.iHE("ngModelChange",function(ee){s.usT(v);const Ce=s.GaO();return s.kNx(Ce.term,ee)||(Ce.term=ee),s.CGJ(ee)}),s.wVc(5,"translate"),s.C$Y(),s.yuY(6,we,3,0,"button",16),s.C$Y()}if(2&oe){const v=s.GaO();s.yG2(2),s.cNF(s.kDX(3,4,"igo.context.contextManager.filterPlaceHolder")),s.yG2(2),s.E7m("placeholder",s.kDX(5,6,"igo.context.contextManager.filterPlaceHolder")),s.OKB("ngModel",v.term),s.yG2(2),s.E7m("ngIf",v.term.length)}}function be(oe,We){if(1&oe&&s.wR5(0,"igo-actionbar",18),2&oe){const v=s.GaO();s.E7m("iconColor",v.color)("store",v.actionStore)("withIcon",!0)("withTitle","overlay"===v.actionbarMode)("horizontal",!1)("mode",v.actionbarMode)}}function De(oe,We){if(1&oe&&(s.I0R(0,"button",19),s.wVc(1,"translate"),s.I0R(2,"mat-icon",5),s.OEk(3,"fitler_alt"),s.C$Y()()),2&oe){s.GaO();const v=s.Gew(11);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",v)}}function $e(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",10)(1,"mat-checkbox",22),s.qCj("click",function(ee){return ee.stopPropagation()})("change",function(){s.usT(v);const ee=s.GaO().$implicit,Ce=s.GaO();return s.CGJ(Ce.handleToggleCategory(ee))}),s.C$Y(),s.I0R(2,"span"),s.OEk(3),s.C$Y()()}if(2&oe){const v=s.GaO().$implicit,V=s.GaO();s.yG2(),s.E7m("checked",V.getPermission(v).checked)("indeterminate",V.getPermission(v).indeterminate),s.yG2(2),s.cNF(v.title)}}function dt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",10)(1,"mat-checkbox",11),s.qCj("click",function(ee){return ee.stopPropagation()})("change",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(2).$implicit,je=s.GaO();return s.CGJ(je.handleToggleCategory(Ce,Te))}),s.OEk(2),s.C$Y()()}if(2&oe){const v=We.$implicit,V=s.GaO(3);s.yG2(),s.E7m("checked",V.getPermission(v).checked),s.yG2(),s.oRS(" ",v.title," ")}}function Qt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",23)(1,"mat-checkbox",22),s.qCj("click",function(ee){return ee.stopPropagation()})("change",function(){s.usT(v);const ee=s.GaO().$implicit,Ce=s.GaO();return s.CGJ(Ce.handleToggleCategory(ee))}),s.C$Y(),s.I0R(2,"span"),s.OEk(3),s.C$Y()(),s.I0R(4,"mat-menu",null,24),s.yuY(6,dt,3,2,"button",25),s.C$Y()}if(2&oe){const v=s.Gew(5),V=s.GaO().$implicit,ee=s.GaO();s.E7m("matMenuTriggerFor",v),s.yG2(),s.E7m("checked",ee.getPermission(V).checked)("indeterminate",ee.getPermission(V).indeterminate),s.yG2(2),s.cNF(V.title),s.yG2(3),s.E7m("ngForOf",V.childs)}}function Do(oe,We){if(1&oe&&(s.SAx(0),s.yuY(1,$e,4,3,"button",20)(2,Qt,7,5,"ng-template",null,21,s.gJz),s.k70()),2&oe){const v=We.$implicit,V=s.Gew(3);s.yG2(),s.E7m("ngIf",!v.childs)("ngIfElse",V)}}function mi(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"igo-context-item",29),s.qCj("edit",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.edit.emit(Ce))})("delete",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.delete.emit(Ce))})("clone",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.clone.emit(Ce))})("save",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.save.emit(Ce))})("hide",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.hideContext(Ce))})("show",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.showContext(Ce))})("favorite",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.favorite.emit(Ce))})("manageTools",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.manageTools.emit(Ce))})("managePermissions",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.managePermissions.emit(Ce))})("select",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.select.emit(Ce))})("unselect",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.unselect.emit(Ce))}),s.C$Y()}if(2&oe){const v=We.$implicit,V=s.GaO(3);s.E7m("selected",V.selectedContext&&V.selectedContext.uri===v.uri)("context",v)("default",v.id&&V.defaultContextId&&V.defaultContextId===v.id)}}function Li(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"igo-collapsible",28),s.qCj("toggle",function(ee){s.usT(v);const Ce=s.GaO().$implicit,Te=s.GaO();return s.CGJ(Te.collapsed[Te.titleMapping[Ce.key]]=ee)}),s.wVc(1,"translate"),s.yuY(2,mi,1,3,"ng-template",12),s.C$Y()}if(2&oe){const v=s.GaO().$implicit,V=s.GaO();s.E7m("title",s.kDX(1,3,V.titleMapping[v.key]))("collapsed",V.collapsed[V.titleMapping[v.key]]),s.yG2(2),s.E7m("ngForOf",v.value)}}function mo(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"igo-context-item",30),s.qCj("favorite",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.favorite.emit(Ce))})("select",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.select.emit(Ce))})("unselect",function(){const Ce=s.usT(v).$implicit,Te=s.GaO(3);return s.CGJ(Te.unselect.emit(Ce))}),s.C$Y()}if(2&oe){const v=We.$implicit,V=s.GaO(3);s.E7m("showFavorite",V.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",V.selectedContext&&V.selectedContext.uri===v.uri)("context",v)("default",V.contextConfigs?V.defaultContextId===v.id:V.defaultContextId===v.uri)}}function en(oe,We){if(1&oe&&s.yuY(0,mo,1,4,"ng-template",12),2&oe){const v=s.GaO().$implicit;s.E7m("ngForOf",v.value)}}function gi(oe,We){if(1&oe&&s.yuY(0,Li,3,5,"igo-collapsible",26)(1,en,1,1,null,27),2&oe){const v=We.$implicit,V=s.GaO();s.E7m("ngIf",v.value.length&&V.auth.authenticated),s.yG2(),s.E7m("ngIf",v.value.length&&!V.auth.authenticated)}}function tn(oe,We){1&oe&&(s.I0R(0,"div",31),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.contextManager.noResult")," "))}let Oe=(()=>{class oe{cdRef;configService;auth;dialog;languageService;storageService;contextConfigs;contextsInitial={ours:[]};contexts$=new y.g(this.contextsInitial);change$=new Uo.o(1);change$$;get contexts(){return this._contexts}set contexts(v){this._contexts=v,this.next()}_contexts={ours:[]};selectedContext;map;get defaultContextId(){return this.contextConfigs?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(v){this._defaultContextId=v}_defaultContextId;collapsed=[];select=new s._w7;unselect=new s._w7;edit=new s._w7;delete=new s._w7;save=new s._w7;clone=new s._w7;create=new s._w7;hide=new s._w7;show=new s._w7;showHiddenContexts=new s._w7;favorite=new s._w7;managePermissions=new s._w7;manageTools=new s._w7;filterPermissionsChanged=new s._w7;titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"};users;permissions=[];actionStore=new Bo.MF([]);actionbarMode=Bo.m0.Overlay;color="primary";showHidden=!1;set term(v){this._term=v,this.next()}get term(){return this._term}_term="";get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(v){this._sortedAlpha=v,this.next()}_sortedAlpha=void 0;showContextFilter=Vo.always;thresholdToFilter=5;get isEmpty(){return!this.contexts.ours.length&&!this.contexts.public?.length&&!this.contexts.shared?.length}constructor(v,V,ee,Ce,Te,je){this.cdRef=v,this.configService=V,this.auth=ee,this.dialog=Ce,this.languageService=Te,this.storageService=je,this.contextConfigs=this.configService.getConfig("context")}ngOnInit(){this.change$$=this.change$.pipe((0,Yo.C)(()=>(0,xo.k)(50))).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"star",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(v){if(""===this.term)return this.sortedAlpha&&(v=this.sortContextsList(v)),v;{let ee={ours:v.ours.filter(Ce=>{const Te=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Ce.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Te)})};if(this.contexts.public){const Ce=v.public.filter(Te=>{const je=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Te.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(je)});ee.public=Ce}if(this.contexts.shared){const Ce=v.shared.filter(Te=>{const je=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Te.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(je)});ee.shared=Ce}return this.sortedAlpha&&(ee=this.sortContextsList(ee)),ee}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case Vo.always:return!0;case Vo.never:return!1;default:let v=this.contexts.ours.length;return v+=this.contexts.public?this.contexts.public.length:0,v+=this.contexts.shared?this.contexts.shared.length:0,v>=this.thresholdToFilter}}sortContextsList(v){if(v){const V=JSON.parse(JSON.stringify(v));return V.ours.sort((ee,Ce)=>this.normalize(ee.title)<this.normalize(Ce.title)?-1:this.normalize(ee.title)>this.normalize(Ce.title)?1:0),V.shared?V.shared.sort((ee,Ce)=>this.normalize(ee.title)<this.normalize(Ce.title)?-1:this.normalize(ee.title)>this.normalize(Ce.title)?1:0):V.public&&V.public.sort((ee,Ce)=>this.normalize(ee.title)<this.normalize(Ce.title)?-1:this.normalize(ee.title)>this.normalize(Ce.title)?1:0),V}}normalize(v){return v.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(){this.sortedAlpha=!this.sortedAlpha}clearFilter(){this.term=""}createContext(v){this.dialog.open(Mo,{disableClose:!1}).afterClosed().pipe((0,F.U)(1)).subscribe(V=>{V&&this.create.emit({title:V,empty:v})})}getPermission(v){if(v)return this.permissions.find(ee=>ee.name===v.name)}handleToggleCategory(v,V){const ee=this.getPermission(v);if(ee&&(ee.checked=!ee.checked,this.storageService.set("contexts.permissions."+ee.name,ee.checked),ee.indeterminate=!1),V){let Ce=!1;for(const je of V.childs)if(this.getPermission(je).checked!==ee.checked){Ce=!0;break}const Te=this.getPermission(V);Te&&(Te.checked=ee.checked,this.storageService.set("contexts.permissions."+Te.name,ee.checked),Te.indeterminate=Ce)}if(v.childs)for(const Ce of v.childs){const Te=this.getPermission(Ce);Te&&Te.checked!==ee.checked&&(Te.checked=ee.checked,this.storageService.set("contexts.permissions."+Te.name,ee.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(v){if(v.hidden=!0,!this.showHidden){const V={ours:[],shared:[],public:[]};V.ours=this.contexts.ours.filter(ee=>ee.id!==v.id),V.shared=this.contexts.shared.filter(ee=>ee.id!==v.id),V.public=this.contexts.public.filter(ee=>ee.id!==v.id),this.contexts=V}this.hide.emit(v)}showContext(v){v.hidden=!1,this.show.emit(v)}static \u0275fac=function(V){return new(V||oe)(s.GI1(s.kD9),s.GI1(C.aW),s.GI1(h.oj),s.GI1(Yt.qW),s.GI1(S.ov),s.GI1(J.yQ))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},standalone:!0,features:[s.UHJ],decls:22,vars:20,consts:[[3,"navigation"],[1,"context-filter-container"],["floatLabel","always",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary"],["class","add-context-button","icon","add",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"profil-menu"],[3,"checked","click","change"],["ngFor","",3,"ngForOf"],["class","no-result",4,"ngIf"],["floatLabel","always"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["icon","add",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["mat-menu-item","","class","profil-menu",4,"ngIf","ngIfElse"],["withSubMenu",""],[3,"checked","indeterminate","click","change"],["mat-menu-item","",1,"profil-menu",3,"matMenuTriggerFor"],["subAccountMenu","matMenu"],["mat-menu-item","","class","profil-menu",4,"ngFor","ngForOf"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"],[1,"no-result"]],template:function(V,ee){1&V&&(s.I0R(0,"igo-list",0)(1,"div",1),s.yuY(2,qe,7,8,"mat-form-field",2),s.I0R(3,"div",3)(4,"button",4),s.qCj("click",function(){return ee.toggleSort()}),s.wVc(5,"translate"),s.I0R(6,"mat-icon",5),s.OEk(7,"sort_by_alpha"),s.C$Y()(),s.yuY(8,be,1,6,"igo-actionbar",6)(9,De,4,4,"button",7),s.I0R(10,"mat-menu",null,8),s.yuY(12,Do,4,2,"ng-container",9),s.I0R(13,"button",10)(14,"mat-checkbox",11),s.qCj("click",function(Te){return Te.stopPropagation()})("change",function(){return ee.showHiddenContexts.emit()}),s.C$Y(),s.I0R(15,"span"),s.OEk(16),s.wVc(17,"translate"),s.C$Y()()()()(),s.yuY(18,gi,2,2,"ng-template",12),s.wVc(19,"keyvalue"),s.wVc(20,"async"),s.yuY(21,tn,3,3,"div",13),s.C$Y()),2&V&&(s.E7m("navigation",!0),s.yG2(2),s.E7m("ngIf",ee.showFilter()),s.yG2(2),s.eAK("--active",ee.sortedAlpha),s.E7m("matTooltip",s.kDX(5,12,"igo.context.contextManager.sortAlphabetically")),s.yG2(4),s.E7m("ngIf",ee.auth.authenticated&&ee.contextConfigs),s.yG2(),s.E7m("ngIf",ee.auth.authenticated&&ee.contextConfigs),s.yG2(3),s.E7m("ngForOf",ee.users),s.yG2(2),s.E7m("checked",ee.showHidden),s.yG2(2),s.oRS(" ",s.kDX(17,14,"igo.context.contextManager.showHidden")," "),s.yG2(2),s.E7m("ngForOf",s.kDX(19,16,s.kDX(20,18,ee.contexts$))),s.yG2(3),s.E7m("ngIf",ee.isEmpty))},dependencies:[Jt.yM,E.u_,o.wb,o.Up,o.w5,o.Gm,R.cN,R.yi,a.y,a.ot,a.ue,a._G,w.oJ,w.um,xt.oB,xt.qL,ut.KO,ut.a4,Bo.AI,ko._A,ko.aM,ko.OQ,ko.yG,E.Iw,_o.Vn,_o.WK,$o.ii,Mt,Jt.qU,E.a,E.uq,S._s,Ft.sD],styles:["[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.context-filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 4px}.context-filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.profil-menu[_ngcontent-%COMP%]{padding-left:8px}.profil-menu[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}.actions-container[_ngcontent-%COMP%]{margin-left:4px}.no-result[_ngcontent-%COMP%]{padding:16px}"],changeDetection:0})}return oe})();var ce=r(69400),te=r(21232);function re(oe,We){1&oe&&(s.I0R(0,"div",3)(1,"h4"),s.OEk(2),s.wVc(3,"translate"),s.C$Y(),s.I0R(4,"p"),s.OEk(5),s.wVc(6,"translate"),s.C$Y()()),2&oe&&(s.yG2(2),s.cNF(s.kDX(3,2,"igo.context.permission.readOnlyTitle")),s.yG2(3),s.cNF(s.kDX(6,4,"igo.context.permission.readOnlyMsg")))}function he(oe,We){1&oe&&(s.I0R(0,"mat-radio-button",8),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.permission.scope.public")," "))}function Me(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"div",3)(1,"mat-radio-group",4),s.iHE("ngModelChange",function(ee){s.usT(v);const Ce=s.GaO(2);return s.kNx(Ce.context.scope,ee)||(Ce.context.scope=ee),s.CGJ(ee)}),s.qCj("change",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.scopeChanged.emit(ee.context))}),s.I0R(2,"mat-radio-button",5),s.OEk(3),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"mat-radio-button",6),s.OEk(6),s.wVc(7,"translate"),s.C$Y(),s.yuY(8,he,3,3,"mat-radio-button",7),s.C$Y()()}if(2&oe){const v=s.GaO(2);s.yG2(),s.OKB("ngModel",v.context.scope),s.yG2(2),s.oRS(" ",s.kDX(4,4,"igo.context.permission.scope.private")," "),s.yG2(3),s.oRS(" ",s.kDX(7,6,"igo.context.permission.scope.shared")," "),s.yG2(2),s.E7m("ngIf",v.authService.isAdmin)}}function Xe(oe,We){if(1&oe&&(s.I0R(0,"mat-option",20),s.OEk(1),s.wR5(2,"br"),s.I0R(3,"small",21),s.OEk(4),s.C$Y()()),2&oe){const v=We.$implicit;s.E7m("value",v),s.yG2(),s.oRS(" ",v.title,""),s.yG2(3),s.cNF(v.name)}}function tt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"form",9),s.qCj("ngSubmit",function(){s.usT(v);const ee=s.GaO(2);return s.CGJ(ee.handleFormSubmit(ee.form.value))}),s.I0R(1,"mat-form-field",10),s.wR5(2,"input",11),s.wVc(3,"translate"),s.I0R(4,"mat-autocomplete",12,13),s.qCj("optionSelected",function(ee){s.usT(v);const Ce=s.GaO(2);return s.CGJ(Ce.onProfilSelected(ee.option.value))}),s.yuY(6,Xe,5,3,"mat-option",14),s.C$Y(),s.I0R(7,"mat-error"),s.OEk(8),s.wVc(9,"translate"),s.C$Y()(),s.I0R(10,"mat-radio-group",15)(11,"mat-radio-button",16),s.OEk(12),s.wVc(13,"translate"),s.C$Y(),s.I0R(14,"mat-radio-button",17),s.OEk(15),s.wVc(16,"translate"),s.C$Y()(),s.I0R(17,"div",18)(18,"button",19),s.OEk(19),s.wVc(20,"translate"),s.C$Y()()()}if(2&oe){const v=s.Gew(5),V=s.GaO(2);s.E7m("formGroup",V.form),s.yG2(2),s.E7m("placeholder",s.kDX(3,11,"igo.context.permission.user"))("formControl",V.formControl)("matAutocomplete",v),s.yG2(2),s.E7m("displayWith",V.displayFn),s.yG2(2),s.E7m("ngForOf",V.profils),s.yG2(2),s.oRS(" ",s.kDX(9,13,"igo.context.permission.profilRequired")," "),s.yG2(4),s.oRS(" ",s.kDX(13,15,"igo.context.permission.read")," "),s.yG2(3),s.oRS(" ",s.kDX(16,17,"igo.context.permission.write")," "),s.yG2(3),s.E7m("disabled",!V.form.valid),s.yG2(),s.oRS(" ",s.kDX(20,19,"igo.context.permission.addBtn")," ")}}function Tt(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",29),s.qCj("click",function(){s.usT(v);const ee=s.GaO().$implicit,Ce=s.GaO(5);return s.CGJ(Ce.removePermission.emit(ee))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"delete"),s.C$Y()()}2&oe&&s.E7m("matTooltip",s.kDX(1,1,"igo.context.permission.delete"))}function vt(oe,We){if(1&oe&&(s.I0R(0,"mat-list-item")(1,"mat-icon",25),s.OEk(2,"person"),s.C$Y(),s.I0R(3,"h4",26),s.OEk(4),s.I0R(5,"small",21),s.OEk(6),s.C$Y()(),s.I0R(7,"div",27),s.yuY(8,Tt,4,3,"button",28),s.C$Y()()),2&oe){const v=We.$implicit,V=s.GaO(5);s.yG2(4),s.oRS(" ",v.profilTitle," "),s.yG2(2),s.cNF(v.profil),s.yG2(2),s.E7m("ngIf",V.canWrite||v.profil===V.authService.decodeToken().user.sourceId)}}function Co(oe,We){if(1&oe&&(s.I0R(0,"igo-collapsible",24),s.wVc(1,"translate"),s.yuY(2,vt,9,3,"ng-template",22),s.C$Y()),2&oe){const v=s.GaO().$implicit;s.E7m("title",s.kDX(1,2,"igo.context.permission."+v.key)),s.yG2(2),s.E7m("ngForOf",v.value)}}function bn(oe,We){1&oe&&s.yuY(0,Co,3,4,"igo-collapsible",23),2&oe&&s.E7m("ngIf",We.$implicit.value.length)}function hi(oe,We){if(1&oe&&(s.I0R(0,"igo-list"),s.yuY(1,bn,1,1,"ng-template",22),s.wVc(2,"keyvalue"),s.C$Y()),2&oe){const v=s.GaO(2);s.yG2(),s.E7m("ngForOf",s.kDX(2,1,v.permissions))}}function Gi(oe,We){if(1&oe&&(s.I0R(0,"div"),s.yuY(1,re,7,6,"div",1)(2,Me,9,8,"div",1)(3,tt,21,21,"form",2)(4,hi,3,3,"igo-list",0),s.C$Y()),2&oe){const v=s.GaO();s.yG2(),s.E7m("ngIf",!v.canWrite),s.yG2(),s.E7m("ngIf",v.canWrite),s.yG2(),s.E7m("ngIf","private"!==v.context.scope&&v.canWrite),s.yG2(),s.E7m("ngIf",v.permissions&&"private"!==v.context.scope)}}let go=(()=>{class oe{formBuilder;cd;http;authService;config;form;get context(){return this._context}set context(v){this._context=v,this.cd.detectChanges()}_context;get permissions(){return this._permissions}set permissions(v){this._permissions=v,this.cd.detectChanges()}_permissions;get profils(){return this._profils}set profils(v){this._profils=v,this.cd.detectChanges()}_profils=[];get canWrite(){return this.context.permission===I[I.write]}baseUrlProfils;formControl=new a.yM;formValueChanges$$;addPermission=new s._w7;removePermission=new s._w7;scopeChanged=new s._w7;constructor(v,V,ee,Ce,Te){this.formBuilder=v,this.cd=V,this.http=ee,this.authService=Ce,this.config=Te}ngOnInit(){this.buildForm(),this.baseUrlProfils=this.config.getConfig("context.url")+"/profils-users?",this.formValueChanges$$=this.formControl.valueChanges.subscribe(v=>{v.length?(this.http.get(this.baseUrlProfils+"q="+v).subscribe(V=>{this.profils=V}),this.profils.filter(V=>{const ee=v.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ce=V.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return(V.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")+Ce).includes(ee)})):this.profils=[]})}displayFn(v){return v?v.title:void 0}handleFormSubmit(v){this.addPermission.emit(v)}buildForm(){this.form=this.formBuilder.group({profil:[],typePermission:["read"]})}onProfilSelected(v){this.form.setValue({profil:v.name,typePermission:this.form.value.typePermission})}static \u0275fac=function(V){return new(V||oe)(s.GI1(a.KE),s.GI1(s.kD9),s.GI1(H.KK),s.GI1(h.oj),s.GI1(C.aW))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-context-permissions"]],inputs:{context:"context",permissions:"permissions"},outputs:{addPermission:"addPermission",removePermission:"removePermission",scopeChanged:"scopeChanged"},standalone:!0,features:[s.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","scopeForm",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"scopeForm"],[3,"ngModel","ngModelChange","change"],["value","private"],["value","protected"],["value","public",4,"ngIf"],["value","public"],[3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","",3,"placeholder","formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","typePermission"],["value","read"],["value","write"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"],[1,"mat-typography"],["ngFor","",3,"ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["matListItemIcon",""],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"]],template:function(V,ee){1&V&&s.yuY(0,Gi,5,4,"div",0),2&V&&s.E7m("ngIf",ee.context)},dependencies:[E.u_,te.yk,te.cv,te.cT,a.y,a.sz,a.ot,a.ue,a.u,a.eJ,a._G,a.sl,a.ug,a.uW,a.Wo,o.wb,o.Up,o.wJ,R.cN,R.yi,ce.U1,ce.e,e.I5,ce.cG,E.Iw,e.Ax,w.oJ,w.Gw,w.um,Jt.yM,$o.ii,eo.iI,eo.g9,eo.Y1,eo.UV,eo.At,xt.oB,xt.qL,Ao.mw,ut.KO,ut.a4,E.uq,S._s,Ft.sD],styles:["[_nghost-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-radio-button[_ngcontent-%COMP%]{padding:14px 14px 14px 0}.scopeForm[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{padding:5px}"]})}return oe})();var ki=r(37752);r(44876),r(61252),r(54584),r(53291);let Dn=(()=>{class oe{contextService;route;language="";constructor(v,V){this.contextService=v,this.route=V,this.route.queryParams.subscribe(ee=>{ee.lang&&(this.language=ee.lang)})}getUrlWithApi(v){return this.language?`${location.origin+location.pathname}?context=${v.uri}&lang=${this.language}`:`${location.origin+location.pathname}?context=${v.uri}`}createContextShared(v,V){const ee=this.contextService.getContextFromMap(v);return ee.scope="public",ee.title=V.title,ee.uri=V.uri,this.contextService.create(ee)}updateContextShared(v,V,ee){const Ce=this.contextService.getContextFromMap(v);return this.contextService.update(ee,{title:V.title,map:Ce.map})}getUrlWithoutApi(v,V){if(!(this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&v.viewController.getZoom()))return;const ee=V.layerlistControls.querystring;let Ce=this.route.options.visibleOnLayersKey,Te=this.route.options.visibleOffLayersKey;const je=v.layers,nt=je.filter(zt=>zt.visible&&!zt.isIgoInternalLayer),_t=je.filter(zt=>!zt.visible&&!zt.isIgoInternalLayer);0===nt.length&&(Ce=""),0===_t.length&&(Te="");let ot="",Dt=[];nt.length>_t.length?(ot=`${Ce}=*&${Te}=`,Dt=_t):(ot=`${Te}=*&${Ce}=`,Dt=nt);for(const zt of Dt)zt.id&&(ot+=zt.id+",");const wt=[],gt=this.contextService.context$.value.layers;for(const zt of gt)(typeof zt.id<"u"||typeof zt.source<"u")&&wt.push(zt.id||zt.source.id);const rt=this.makeLayersByService(je,wt,"wms"),ao=this.makeLayersByService(je,wt,"wmts"),Oi=this.makeLayersByService(je,wt,"arcgisrest"),lo=this.makeLayersByService(je,wt,"imagearcgisrest"),oo=this.makeLayersByService(je,wt,"tilearcgisrest");ot=ot.substr(0,ot.length-1);const cr=this.route.options.centerKey,ur=this.route.options.contextKey,si=`${this.route.options.zoomKey}=${v.viewController.getZoom()}`,dn=v.viewController.getCenter("EPSG:4326")||[],po=`${cr}=${dn[0].toFixed(5).replace(/\.([^0]+)0+$/,".$1")},${dn[1].toFixed(5).replace(/\.([^0]+)0+$/,".$1")}`.replace(/.00000/g,"");let Qo="";this.contextService.context$.value&&(Qo=`${ur}=${this.contextService.context$.value.uri}`);let Ht=this.language?`${location.origin}${location.pathname}?${Qo}&${si}&${po}&${ot}&${ee}&${rt}&${ee}&${ao}&${Oi}&${lo}&${oo}&lang=${this.language}`:`${location.origin}${location.pathname}?${Qo}&${si}&${po}&${ot}&${ee}&${rt}&${ee}&${ao}&${Oi}&${lo}&${oo}`;for(let zt=0;zt<5;zt++)Ht=Ht.replace(/&&/g,"&"),Ht=Ht.endsWith("&")?Ht.slice(0,-1):Ht;return Ht=Ht.endsWith("&")?Ht.slice(0,-1):Ht,Ht=Ht.replace("?&wm","&wm"),Ht=Ht.replace("?&","?"),Ht}makeLayersByService(v,V,ee){const Ce=[];for(const je of v.filter(nt=>nt.dataSource.options?.type===ee))if(-1===V.indexOf(je.id)){let ot,nt=encodeURIComponent(je.dataSource.options.url),_t="";switch(je.dataSource.options.type.toLowerCase()){case"wms":const gt=je.dataSource.options;_t=encodeURIComponent(gt.params.LAYERS),ot="1.3.0"===gt.params.VERSION?ot:gt.params.VERSION;break;case"wmts":case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":_t=encodeURIComponent(je.dataSource.options.layer)}const Dt=`${_t}:igoz${je.zIndex}`;let wt="";if(ot){const gt=-1===je.dataSource.options.url.indexOf("?")?"?":"&";wt=encodeURIComponent(`${gt}VERSION=${ot}`)}nt=`${nt}${wt}`,Ce.find(gt=>gt.url===nt)?Ce.forEach(gt=>{gt.url===nt&&gt.layers.push(Dt)}):Ce.push({url:nt,layers:[Dt]})}let Te="";if(Ce.length>=1){let je,nt;switch(ee.toLowerCase()){case"wms":je=this.route.options.wmsUrlKey,nt=this.route.options.wmsLayersKey;break;case"wmts":je=this.route.options.wmtsUrlKey,nt=this.route.options.wmtsLayersKey;break;case"arcgisrest":je=this.route.options.arcgisUrlKey,nt=this.route.options.arcgisLayersKey;break;case"imagearcgisrest":je=this.route.options.iarcgisUrlKey,nt=this.route.options.iarcgisLayersKey;break;case"tilearcgisrest":je=this.route.options.tarcgisUrlKey,nt=this.route.options.tarcgisLayersKey;break;default:je="",nt=""}let _t="",ot="";Ce.forEach(Dt=>{_t+=`${Dt.url},`,ot+=`(${Dt.layers.join(",")}),`}),_t=_t.endsWith(",")?_t.slice(0,-1):_t,ot=ot.endsWith(",")?ot.slice(0,-1):ot,Te=`${je}=${_t}&${nt}=${ot}`}return Te}static \u0275fac=function(V){return new(V||oe)(s.CoB(Z),s.CoB(W.k$,8))};static \u0275prov=s.wxM({token:oe,factory:oe.\u0275fac,providedIn:"root"})}return oe})();function yi(oe,We){if(1&oe&&(s.I0R(0,"span",11),s.OEk(1),s.C$Y()),2&oe){const v=s.GaO();s.yG2(),s.oRS("",v.userId,"-")}}function zo(oe,We){if(1&oe&&(s.I0R(0,"button",12),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe){const v=s.GaO();s.E7m("disabled",!v.form.valid),s.yG2(),s.oRS(" ",s.kDX(2,2,"igo.context.shareMap.button")," ")}}function _i(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"button",13),s.qCj("click",function(){s.usT(v);const ee=s.GaO();return s.CGJ(ee.updateContextShared(ee.form.value))}),s.OEk(1),s.wVc(2,"translate"),s.C$Y()}2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.refreshBtn")," "))}function So(oe,We){if(1&oe){const v=s.KQA();s.I0R(0,"div",14)(1,"mat-form-field"),s.wR5(2,"textarea",15,16),s.wVc(4,"translate"),s.I0R(5,"button",17),s.qCj("click",function(){s.usT(v);const ee=s.Gew(3),Ce=s.GaO();return s.CGJ(Ce.copyTextToClipboard(ee))}),s.wVc(6,"translate"),s.I0R(7,"mat-icon"),s.OEk(8,"content_copy"),s.C$Y()()(),s.wR5(9,"div"),s.C$Y()}if(2&oe){const v=s.GaO();s.yG2(2),s.E7m("placeholder",s.kDX(4,3,"igo.context.shareMap.placeholderLink"))("value",v.url),s.yG2(3),s.E7m("matTooltip",s.kDX(6,5,"igo.context.shareMap.copy"))}}let oi=(()=>{class oe{languageService;messageService;auth;shareMapService;formBuilder;form;map;url;userId;idContextShared;constructor(v,V,ee,Ce,Te){this.languageService=v,this.messageService=V,this.auth=ee,this.shareMapService=Ce,this.formBuilder=Te}ngOnInit(){this.auth.authenticate$.subscribe(v=>{const V=this.auth.decodeToken();this.userId=V?.user?.id.toString(),this.buildForm()})}createUrl(v={}){const V=Object.assign({},v);V.uri=this.userId?`${this.userId}-${v.uri}`:v.uri,this.url=this.shareMapService.getUrlWithApi(V),this.shareMapService.createContextShared(this.map,V).subscribe(ee=>{this.idContextShared=ee.id,this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:V.title})},ee=>{ee.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(ee)})}updateContextShared(v={}){const V=Object.assign({},v);V.uri=this.userId?`${this.userId}-${v.uri}`:v.uri,this.shareMapService.updateContextShared(this.map,V,this.idContextShared).subscribe(ee=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:V.title})},ee=>{ee.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(ee)})}copyTextToClipboard(v){Q._D.copy(v)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}buildForm(){this.url=void 0;const v=(0,Q.uq)();let V="Partage ";V+=this.userId?`(${this.userId}-${v})`:`(${v})`,this.form=this.formBuilder.group({title:[V],uri:[v]})}static \u0275fac=function(V){return new(V||oe)(s.GI1(S.ov),s.GI1(P.mi),s.GI1(h.oj),s.GI1(Dn),s.GI1(a.KE))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-share-map-api"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:21,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"igo-input-container"],["matInput","","required","","formControlName","title",3,"placeholder"],["id","uriInput",1,"igo-input-container"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","required","","formControlName","uri",3,"readonly","placeholder"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",3,"click",4,"ngIf"],["class","igo-input-container linkToShare",4,"ngIf"],[1,"prefix"],["mat-raised-button","","type","submit",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",1,"textAreaWithButton",3,"placeholder","value"],["textArea",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"]],template:function(V,ee){1&V&&(s.I0R(0,"form",0),s.qCj("ngSubmit",function(){return ee.createUrl(ee.form.value)}),s.I0R(1,"div",1)(2,"mat-form-field"),s.wR5(3,"input",2),s.wVc(4,"translate"),s.I0R(5,"mat-error"),s.OEk(6),s.wVc(7,"translate"),s.C$Y()()(),s.I0R(8,"div",3)(9,"mat-form-field"),s.yuY(10,yi,2,1,"span",4),s.I0R(11,"span",5),s.wR5(12,"input",6),s.wVc(13,"translate"),s.C$Y(),s.I0R(14,"mat-error"),s.OEk(15),s.wVc(16,"translate"),s.C$Y()()(),s.I0R(17,"div",7),s.yuY(18,zo,3,4,"button",8)(19,_i,3,3,"button",9),s.C$Y()(),s.yuY(20,So,10,7,"div",10)),2&V&&(s.E7m("formGroup",ee.form),s.yG2(3),s.E7m("placeholder",s.kDX(4,10,"igo.context.contextManager.form.title")),s.yG2(3),s.oRS(" ",s.kDX(7,12,"igo.context.contextManager.form.titleRequired")," "),s.yG2(4),s.E7m("ngIf",ee.userId),s.yG2(2),s.E7m("readonly",!ee.userId)("placeholder",s.kDX(13,14,"igo.context.contextManager.form.uri")),s.yG2(3),s.oRS(" ",s.kDX(16,16,"igo.context.contextManager.form.uriRequired")," "),s.yG2(3),s.E7m("ngIf",!ee.url),s.yG2(),s.E7m("ngIf",ee.url),s.yG2(),s.E7m("ngIf",ee.url))},dependencies:[a.y,a.sz,a.ot,a.ue,a.u,a.eJ,a.sl,a.uW,a.Wo,o.wb,o.Up,o.wJ,R.cN,R.yi,E.u_,w.oJ,w.Gw,w.um,ut.KO,ut.a4,xt.oB,xt.qL,S._s,Ft.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form[_ngcontent-%COMP%]{padding:20px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}']})}return oe})();var Ci=r(53476),ii=r(35876);function Xo(oe,We){1&oe&&(s.I0R(0,"h4"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.included")," "))}function Fn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.context")," "))}function Pn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.center")," "))}function Rn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.zoom")," "))}function Ln(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.addedLayers")," "))}function Gn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.visibleInvisible")," "))}function $n(oe,We){1&oe&&(s.I0R(0,"h4"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.excluded")," "))}function Nt(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.order")," "))}function An(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.opacity")," "))}function kn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.filterOgc")," "))}function Bn(oe,We){1&oe&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&oe&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.filterTime")," "))}function Un(oe,We){1&oe&&(s.I0R(0,"div"),s.yuY(1,Xo,3,3,"h4",6),s.wVc(2,"translate"),s.I0R(3,"ul"),s.yuY(4,Fn,3,3,"li",6),s.wVc(5,"translate"),s.yuY(6,Pn,3,3,"li",6),s.wVc(7,"translate"),s.yuY(8,Rn,3,3,"li",6),s.wVc(9,"translate"),s.yuY(10,Ln,3,3,"li",6),s.wVc(11,"translate"),s.yuY(12,Gn,3,3,"li",6),s.wVc(13,"translate"),s.C$Y(),s.yuY(14,$n,3,3,"h4",6),s.wVc(15,"translate"),s.I0R(16,"ul"),s.yuY(17,Nt,3,3,"li",6),s.wVc(18,"translate"),s.yuY(19,An,3,3,"li",6),s.wVc(20,"translate"),s.yuY(21,kn,3,3,"li",6),s.wVc(22,"translate"),s.yuY(23,Bn,3,3,"li",6),s.wVc(24,"translate"),s.C$Y()()),2&oe&&(s.yG2(),s.E7m("ngIf",""!==s.kDX(2,11,"igo.context.shareMap.included")),s.yG2(3),s.E7m("ngIf",""!==s.kDX(5,13,"igo.context.shareMap.context")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(7,15,"igo.context.shareMap.center")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(9,17,"igo.context.shareMap.zoom")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(11,19,"igo.context.shareMap.addedLayers")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(13,21,"igo.context.shareMap.visibleInvisible")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(15,23,"igo.context.shareMap.excluded")),s.yG2(3),s.E7m("ngIf",""!==s.kDX(18,25,"igo.context.shareMap.order")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(20,27,"igo.context.shareMap.opacity")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(22,29,"igo.context.shareMap.filterOgc")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(24,31,"igo.context.shareMap.filterTime")))}function Ui(oe,We){1&oe&&(s.wR5(0,"igo-custom-html",8),s.wVc(1,"translate")),2&oe&&s.E7m("html",s.kDX(1,1,"igo.context.shareMap.htmlClarifications"))}let nn=(()=>{class oe{messageService;shareMapService;cdRef;mapState$$;map;url;publicShareOption={layerlistControls:{querystring:""}};constructor(v,V,ee){this.messageService=v,this.shareMapService=V,this.cdRef=ee}ngOnInit(){this.resetUrl(),this.mapState$$=(0,ii.E)([this.map.viewController.state$,this.map.status$]).subscribe(v=>{this.resetUrl(),this.cdRef.detectChanges()})}ngAfterViewInit(){this.resetUrl()}ngOnDestroy(){this.mapState$$.unsubscribe()}resetUrl(v={}){this.url=this.shareMapService.getUrlWithoutApi(this.map,this.publicShareOption)}copyTextToClipboard(v){Q._D.copy(v)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}static \u0275fac=function(V){return new(V||oe)(s.GI1(P.mi),s.GI1(Dn),s.GI1(s.kD9))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-share-map-url"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:18,vars:13,consts:[[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",3,"placeholder","value"],["textArea",""],[1,"igo-form-button-group"],["mat-raised-button","",3,"click"],[1,"mat-typography"],[4,"ngIf"],["class","shareCustomPadding","class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"]],template:function(V,ee){if(1&V){const Ce=s.KQA();s.I0R(0,"div",0)(1,"mat-form-field"),s.wR5(2,"textarea",1,2),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"div",3)(6,"button",4),s.qCj("click",function(){s.usT(Ce);const je=s.Gew(3);return s.CGJ(ee.copyTextToClipboard(je))}),s.I0R(7,"mat-icon"),s.OEk(8,"content_copy"),s.C$Y(),s.OEk(9),s.wVc(10,"translate"),s.C$Y()(),s.I0R(11,"div"),s.wR5(12,"br"),s.I0R(13,"section",5),s.yuY(14,Un,25,33,"div",6),s.wVc(15,"translate"),s.yuY(16,Ui,2,3,"igo-custom-html",7),s.wVc(17,"translate"),s.C$Y()()()}2&V&&(s.yG2(2),s.E7m("placeholder",s.kDX(4,5,"igo.context.shareMap.placeholderLink"))("value",ee.url),s.yG2(7),s.oRS(" ",s.kDX(10,7,"igo.context.shareMap.copy")," "),s.yG2(5),s.E7m("ngIf",""===s.kDX(15,9,"igo.context.shareMap.htmlClarifications")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(17,11,"igo.context.shareMap.htmlClarifications")))},dependencies:[o.wb,o.Up,R.cN,R.yi,w.oJ,w.Gw,xt.oB,xt.qL,E.u_,Ci.YM,S._s,Ft.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-custom-html.shareCustomPadding[_ngcontent-%COMP%]{padding:0}']})}return oe})();var ni=r(18268);function rn(oe,We){if(1&oe&&(s.I0R(0,"mat-tab-group")(1,"mat-tab",2),s.wVc(2,"translate"),s.wR5(3,"igo-share-map-api",3),s.C$Y(),s.I0R(4,"mat-tab",2),s.wVc(5,"translate"),s.wR5(6,"igo-share-map-url",3),s.C$Y()()),2&oe){const v=s.GaO();s.yG2(),s.E7m("label",s.kDX(2,4,"igo.context.shareMap.shareWithApi")),s.yG2(2),s.E7m("map",v.map),s.yG2(),s.E7m("label",s.kDX(5,6,"igo.context.shareMap.shareWithUrl")),s.yG2(2),s.E7m("map",v.map)}}function Yn(oe,We){if(1&oe&&s.wR5(0,"igo-share-map-url",3),2&oe){const v=s.GaO();s.E7m("map",v.map)}}let sn=(()=>{class oe{config;map;hasApi=!1;constructor(v){this.config=v,this.hasApi=!!this.config.getConfig("context.url")}static \u0275fac=function(V){return new(V||oe)(s.GI1(C.aW))};static \u0275cmp=s.In1({type:oe,selectors:[["igo-share-map"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:2,vars:2,consts:[[4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"map"]],template:function(V,ee){1&V&&s.yuY(0,rn,7,8,"mat-tab-group",0)(1,Yn,1,1,"igo-share-map-url",1),2&V&&(s.E7m("ngIf",ee.hasApi),s.yG2(),s.E7m("ngIf",!ee.hasApi))},dependencies:[E.u_,ni.WG,ni.aJ,ni._q,oi,nn,S._s,Ft.sD]})}return oe})();r(87040),r(94688);var Wn=r(728),cn=r(6560),Nn=r(86708);let Yi=(()=>{class oe{component;contextService;layerService;configService;styleListService;styleService;route;context$$;queryParams;contextLayers=[];removeLayersOnContextChange=!0;get map(){return this.component.map}constructor(v,V,ee,Ce,Te,je,nt){this.component=v,this.contextService=V,this.layerService=ee,this.configService=Ce,this.styleListService=Te,this.styleService=je,this.route=nt}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,cn.I)(v=>void 0!==v)).subscribe(v=>this.handleContextChange(v)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey&&this.route.queryParams.pipe((0,u.K)(v=>!Q.Yv.isEmpty(v))).subscribe(v=>{this.queryParams=v})}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(v){if(void 0===v.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const V=(0,Wn.U)(...v.layers.map((ee,Ce)=>this.layerService.createAsyncLayer(ee,v.uri)));V.pipe((0,Nn.c)(V.pipe((0,D.o)(500)))).subscribe(ee=>{this.handleAddLayers(ee),v.extraFeatures&&v.extraFeatures.forEach(Ce=>{this.configService.getConfig("importExport")?.importWithStyle?function Qe(oe,We,v,V){let ee,Ce,Te;if(v.getStyleList(oe.name+".styleByAttribute")){const _t=v.getStyleList(oe.name+".styleByAttribute");ee=(ot,Dt)=>V.createStyleByAttribute(ot,_t,Dt)}else if(v.getStyleList(oe.name+".clusterStyle")){const _t=v.getStyleList(oe.name+".clusterParam");Ce=v.getStyleList(oe.name+".distance"),ee=(ot,Dt)=>{const wt=V.createStyle(v.getStyleList(oe.name+".clusterStyle"),ot,Dt);return V.createClusterStyle(ot,Dt,_t,wt)}}else ee=v.getStyleList(oe.name+".style")?(_t,ot)=>V.createStyle(v.getStyleList(oe.name+".style"),_t,ot):(_t,ot)=>V.createStyle(v.getStyleList("default.style"),_t,ot);const je=It(oe);v.getStyleList(oe.name+".clusterStyle")?(Te=new T.aaH({distance:Ce,type:"cluster",queryable:!0}),Te.ol.source.addFeatures(je)):(Te=new T.EBb({type:"vector",queryable:!0}),Te.ol.addFeatures(je));const nt=new T.Mdo({title:oe.name,isIgoInternalLayer:!0,source:Te,style:ee,opacity:oe.opacity,visible:oe.visible});We.addLayer(nt)}(Ce,this.map,this.styleListService,this.styleService):function Ke(oe,We){const V=It(oe),ee=new T.EBb({type:"vector",queryable:!0});ee.ol.addFeatures(V);let Ce,Te=!1;const je=V[0]?.getKeys()??[];je.includes("_style")||je.includes("_mapTitle")?Ce=(0,T.M4J)():(Ce=(0,T.Cyp)(),Te=!0);const nt=new T.Mdo({title:oe.name,isIgoInternalLayer:!0,source:ee,igoStyle:{editable:Te},style:Ce,visible:oe.visible,opacity:oe.opacity});We.addLayer(nt)}(Ce,this.map)})}),this.layerService.createAsyncIdbLayers(v.uri).pipe((0,D.o)(500)).subscribe(ee=>this.handleAddLayers(ee))}handleAddLayers(v){v=v.filter(V=>void 0!==V).map(V=>(V.visible=this.computeLayerVisibilityFromUrl(V),V.zIndex=V.zIndex,V)),this.contextLayers.concat(v),this.map.addLayers(v)}computeLayerVisibilityFromUrl(v){const V=this.queryParams,Ce=v.id;let Te=v.visible;if(!V||!Ce)return Te;const je=V[this.route.options.contextKey];if(je===this.contextService.context$.value.uri||!je){let nt="",_t="",ot=[],Dt=[];this.route.options.visibleOnLayersKey&&V[this.route.options.visibleOnLayersKey]&&(nt=V[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&V[this.route.options.visibleOffLayersKey]&&(_t=V[this.route.options.visibleOffLayersKey]),"*"===nt&&(Te=!0),"*"===_t&&(Te=!1),ot=nt.split(","),Dt=_t.split(","),(ot.indexOf(Ce)>-1||ot.indexOf(Ce.toString())>-1)&&(Te=!0),(Dt.indexOf(Ce)>-1||Dt.indexOf(Ce.toString())>-1)&&(Te=!1)}return Te}static \u0275fac=function(V){return new(V||oe)(s.GI1(T.q2F),s.GI1(Z),s.GI1(T.IZ6),s.GI1(C.aW),s.GI1(T.cTh),s.GI1(T.UND),s.GI1(W.k$,8))};static \u0275dir=s.Sc5({type:oe,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"},standalone:!0,features:[s.M5G([H.SU])]})}return oe})();var ri=r(56264);let Si=(()=>{class oe{contextService;mediaService;component;context$$;get map(){return this.component.map}constructor(v,V,ee){this.contextService=V,this.mediaService=ee,this.component=v}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,cn.I)(v=>void 0!==v)).subscribe(v=>this.handleContextChange(v))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(v){if(void 0===v.map)return;const V=v.map.view;(!this.component.view||!0!==V.keepCurrentView||v.map.view.projection!==this.map.projection)&&(this.component.view=V),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(V);const ee=v.map.controls;if(!this.component.controls&&ee){if(this.mediaService.isMobile()&&"boolean"!=typeof ee.scaleLine){const Ce=ee.scaleLine;Ce.minWidth||(Ce.minWidth=Math.min(64,Ce.minWidth),ee.scaleLine=Ce)}this.component.controls=ee}}static \u0275fac=function(V){return new(V||oe)(s.GI1(T.q2F),s.GI1(Z),s.GI1(ri.QB))};static \u0275dir=s.Sc5({type:oe,selectors:[["","igoMapContext",""]],standalone:!0})}return oe})(),un=(()=>{class oe{contextService;mapService;languageService;confirmDialogService;messageService;auth;storageService;cdRef;component;contexts$$;selectedContext$$;defaultContextId$$;previousMessageId;onSelect(v){this.contextService.loadContext(v.uri)}onEdit(v){this.contextService.loadEditedContext(v.uri)}onSave(v){const V=this.mapService.getMap(),ee=this.contextService.getContextFromMap(V),Ce=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:v.title})};if(v.imported)return ee.title=v.title,this.contextService.delete(v.id,!0),void this.contextService.create(ee).subscribe(je=>{this.contextService.loadContext(je.uri),Ce()});this.contextService.update(v.id,{layers:ee.layers,map:{view:ee.map.view}}).subscribe(()=>{Ce()})}onFavorite(v){v.id||(v.id=v.uri),this.contextService.setDefault(v.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(v.id);const V=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:v.title});this.previousMessageId=V.toastId,this.cdRef.detectChanges()})}onManageTools(v){this.contextService.loadEditedContext(v.uri)}onManagePermissions(v){this.contextService.loadEditedContext(v.uri)}onDelete(v){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(ee=>{ee&&this.contextService.delete(v.id,v.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:v.title})})})}onClone(v){this.contextService.clone(v.id,{title:v.title+"-copy",uri:v.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:v.title})})}onCreate(v){const{title:V,empty:ee}=v,Ce=this.contextService.getContextFromMap(this.component.map,ee);Ce.title=V,this.contextService.create(Ce).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:Ce.title}),this.contextService.loadContext(Ce.uri)})}loadContexts(){const v=["none"];for(const V of this.component.permissions)(!0===V.checked||!0===V.indeterminate)&&v.push(V.name);this.contextService.loadContexts(v,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(v){this.contextService.showContext(v.id).subscribe()}onHideContext(v){this.contextService.hideContext(v.id).subscribe()}constructor(v,V,ee,Ce,Te,je,nt,_t,ot){this.contextService=V,this.mapService=ee,this.languageService=Ce,this.confirmDialogService=Te,this.messageService=je,this.auth=nt,this.storageService=_t,this.cdRef=ot,this.component=v}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(V=>this.handleContextsChange(V)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(V=>{this.component.defaultContextId=V});const v=this.storageService.get("favorite.context.uri");v&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(v),this.selectedContext$$=this.contextService.context$.pipe((0,D.o)(100)).subscribe(V=>this.component.selectedContext=V),this.auth.authenticate$.subscribe(V=>{V&&this.contextService.getProfilByUser().subscribe(ee=>{this.component.users=ee,this.component.permissions=[];const Ce=this.component.users.reduce((je,nt)=>(je=je.concat(nt),nt.childs?je.concat(nt.childs):je),[]);for(const je of Ce){const nt={name:je.name,checked:this.storageService.get("contexts.permissions."+je.name)};null===nt.checked&&(nt.checked=!0),this.component.permissions.push(nt)}const Te=["none"];for(const je of this.component.permissions)(!0===je.checked||!0===je.indeterminate)&&Te.push(je.name);this.contextService.loadContexts(Te,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(v){this.component.contexts=v}static \u0275fac=function(V){return new(V||oe)(s.GI1(Oe,2),s.GI1(Z),s.GI1(T.u00),s.GI1(S.ov),s.GI1(ki.Ex),s.GI1(P.mi),s.GI1(h.oj),s.GI1(J.yQ),s.GI1(s.kD9))};static \u0275dir=s.Sc5({type:oe,selectors:[["","igoContextListBinding",""]],hostBindings:function(V,ee){1&V&&s.qCj("select",function(Te){return ee.onSelect(Te)})("edit",function(Te){return ee.onEdit(Te)})("save",function(Te){return ee.onSave(Te)})("favorite",function(Te){return ee.onFavorite(Te)})("manageTools",function(Te){return ee.onManageTools(Te)})("managePermissions",function(Te){return ee.onManagePermissions(Te)})("delete",function(Te){return ee.onDelete(Te)})("clone",function(Te){return ee.onClone(Te)})("create",function(Te){return ee.onCreate(Te)})("filterPermissionsChanged",function(){return ee.loadContexts()})("showHiddenContexts",function(){return ee.showHiddenContexts()})("show",function(Te){return ee.onShowContext(Te)})("hide",function(Te){return ee.onHideContext(Te)})},standalone:!0,features:[s.M5G([ki.Ex])]})}return oe})(),bi=(()=>{class oe{contextService;messageService;component;editedContext$$;submitSuccessed=new s._w7;onEdit(v){this.contextService.update(this.component.context.id,v).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:v.title||this.component.context.title}),this.contextService.setEditedContext(void 0),this.submitSuccessed.emit(v)})}constructor(v,V,ee){this.contextService=V,this.messageService=ee,this.component=v}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(v=>this.handleEditedContextChange(v))}ngOnDestroy(){this.editedContext$$.unsubscribe()}handleEditedContextChange(v){this.component.context=v}static \u0275fac=function(V){return new(V||oe)(s.GI1(Xt,2),s.GI1(Z),s.GI1(P.mi))};static \u0275dir=s.Sc5({type:oe,selectors:[["","igoContextEditBinding",""]],hostBindings:function(V,ee){1&V&&s.qCj("submitForm",function(Te){return ee.onEdit(Te)})},outputs:{submitSuccessed:"submitSuccessed"},standalone:!0})}return oe})(),Jo=(()=>{class oe{contextService;languageService;messageService;cd;component;editedContext$$;onAddPermission(v){v.profil?this.contextService.addPermissionAssociation(this.component.context.id,v.profil,v.typePermission).subscribe(ee=>{for(const Te of ee)this.component.permissions[v.typePermission].push(Te);this.messageService.success("igo.context.permission.dialog.addMsg","igo.context.permission.dialog.addTitle",void 0,{value:v.profil}),this.cd.detectChanges()}):this.messageService.error("igo.context.contextManager.errors.addPermissionEmpty","igo.context.contextManager.errors.addPermissionTitle")}onRemovePermission(v){this.contextService.deletePermissionAssociation(this.component.context.id,v.id).subscribe(()=>{const ee=this.component.permissions[v.typePermission].findIndex(Te=>Te.id===v.id);this.component.permissions[v.typePermission].splice(ee,1),this.messageService.success("igo.context.permission.dialog.deleteMsg","igo.context.permission.dialog.deleteTitle",void 0,{value:v.profil}),this.cd.detectChanges()})}onScopeChanged(v){const V=v.scope;this.contextService.update(v.id,{scope:V}).subscribe(()=>{this.messageService.success("igo.context.permission.dialog.scopeChangedMsg","igo.context.permission.dialog.scopeChangedTitle",void 0,{value:"igo.context.permission.scope."+V})})}constructor(v,V,ee,Ce,Te){this.contextService=V,this.languageService=ee,this.messageService=Ce,this.cd=Te,this.component=v}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(v=>this.handleEditedContextChange(v))}ngOnDestroy(){this.editedContext$$.unsubscribe(),this.contextService.editedContext$.next(void 0)}handleEditedContextChange(v){this.component.context=v,v&&this.contextService.getPermissions(v.id).subscribe(V=>{const ee={read:(V=V||[]).filter(Ce=>"read"===Ce.typePermission.toString()),write:V.filter(Ce=>"write"===Ce.typePermission.toString())};return this.component.permissions=ee})}static \u0275fac=function(V){return new(V||oe)(s.GI1(go,2),s.GI1(Z),s.GI1(S.ov),s.GI1(P.mi),s.GI1(s.kD9))};static \u0275dir=s.Sc5({type:oe,selectors:[["","igoContextPermissionsBinding",""]],hostBindings:function(V,ee){1&V&&s.qCj("addPermission",function(Te){return ee.onAddPermission(Te)})("removePermission",function(Te){return ee.onRemovePermission(Te)})("scopeChanged",function(Te){return ee.onScopeChanged(Te)})},standalone:!0})}return oe})()},48576:(Pe,ae,r)=>{"use strict";r.d(ae,{b:()=>p});var E=r(20968),a=r(99744),w=r(34896);let p=(()=>{class e{activityService;constructor(o){this.activityService=o}intercept(o,R){const L=o.headers.get("activityInterceptor");if(L){const C=o.clone({headers:o.headers.delete("activityInterceptor")});if("false"===L)return R.handle(C)}const _=this.activityService.register();return R.handle(o).pipe((0,E.U)(()=>{this.activityService.unregister(_)}))}static \u0275fac=function(R){return new(R||e)(w.CoB(a.U))};static \u0275prov=w.wxM({token:e,factory:e.\u0275fac})}return e})()},12044:(Pe,ae,r)=>{"use strict";r.d(ae,{Y:()=>p});var E=r(33712),a=r(48576),w=r(34896);let p=(()=>{class e{static forRoot(){return{ngModule:e,providers:[{provide:E.So,useClass:a.b,multi:!0}]}}static \u0275fac=function(R){return new(R||e)};static \u0275mod=w.a4G({type:e});static \u0275inj=w.s3X({})}return e})()},99744:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>p});var E=r(43168),a=r(54844),w=r(34896);let p=(()=>{class e{counter$=new a.g(0);ids=[];constructor(){}register(){const o=(0,E.uq)();return this.ids.push(o),this.counter$.next(this.ids.length),o}unregister(o){const R=this.ids.indexOf(o);-1!==R&&(this.ids.splice(R,1),this.counter$.next(this.ids.length))}static \u0275fac=function(R){return new(R||e)};static \u0275prov=w.wxM({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},24956:(Pe,ae,r)=>{"use strict";r.d(ae,{U9:()=>a.U,YP:()=>E.Y});var E=r(12044),a=r(99744);r(48576)},84808:(Pe,ae,r)=>{"use strict";r.d(ae,{u:()=>w});var E=r(45872),a=r(34896);let w=(()=>{class p{config;options;get paq(){return window._paq=window._paq||[]}constructor(c){this.config=c,this.options=this.config.getConfig("analytics")||{},"matomo"===this.options.provider&&this.initMatomo()}initMatomo(){if(!this.options.url||!this.options.id)return;const c="/"===this.options.url.substr(-1)?this.options.url+"matomo":this.options.url;(()=>{this.paq.push(["setTrackerUrl",c+".php"]),this.paq.push(["setSiteId",this.options.id]);const o=document.createElement("script"),R=document.getElementsByTagName("script")[0];o.type="text/javascript",o.async=!0,o.defer=!0,o.src=c+".js",R.parentNode.insertBefore(o,R)})()}setUser(c,o){if("matomo"===this.options.provider){if(c){this.paq.push(["setUserId",c.id]);const R=`${c.firstName} ${c.lastName}`;this.paq.push(["setCustomVariable",1,"user",c.sourceId,"visit"]),this.paq.push(["setCustomVariable",2,"name",R,"visit"]),this.paq.push(["setCustomVariable",3,"profils",o,"visit"])}else this.paq.push(["resetUserId"]),this.paq.push(["deleteCustomVariable",1,"user"]),this.paq.push(["deleteCustomVariable",2,"name"]),this.paq.push(["deleteCustomVariable",3,"profils"]);this.paq.push(["trackPageView"]),this.paq.push(["enableLinkTracking"])}}trackSearch(c,o){"matomo"===this.options.provider&&this.paq.push(["trackSiteSearch",c,!1,o])}trackEvent(c,o,R){"matomo"===this.options.provider&&this.paq.push(["trackEvent",c,o,R])}trackLayer(c,o,R){"matomo"===this.options.provider&&this.paq.push(["trackEvent",c,o,R])}static \u0275fac=function(o){return new(o||p)(a.CoB(E.aW))};static \u0275prov=a.wxM({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},45872:(Pe,ae,r)=>{"use strict";r.d(ae,{aW:()=>_,sh:()=>S,WU:()=>L});var E=r(34896),a=r(33712),w=r(43168),p=r(54844),e=r(39732),c=r(51672);const o={showMenuButton:{alternativeKey:"menu.button.visible",mayBeRemoveIn:new Date("2024-06-06")},menuButtonReverseColor:{alternativeKey:"menu.button.useThemeColor",mayBeRemoveIn:new Date("2024-06-06")},importWithStyle:{alternativeKey:"importExport.importWithStyle",mayBeRemoveIn:new Date("2024-06-06")},hasGeolocateButton:{alternativeKey:"geolocate.button.visible",mayBeRemoveIn:new Date("2024-06-06")}},R=new Map(Object.entries(o).filter(([F,h])=>h.alternativeKey).map(([F,h])=>[h.alternativeKey,{deprecatedKey:F}])),L={lib:"17.0.0-next.7",releaseDate:1715874406030};let _=(()=>{class F{config;httpClient;configDeprecated=new Map(Object.entries(o));_isLoaded$=new p.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(W){this.httpClient=new a.KK(W)}getConfigs(){return Array.from(this.configDeprecated.keys()).map(W=>{void 0!==w.Yv.resolve(this.config,W)&&this.handleDeprecatedConfig(W)}),this.config}getConfig(W,J){let T=w.Yv.resolve(this.config,W);return this.configDeprecated.get(W)&&void 0!==T?this.handleDeprecatedConfig(W):void 0===T&&(T=this.handleDeprecationPossibility(W)),T??J}handleDeprecatedConfig(W){const J=this.configDeprecated.get(W);let T=`This config (${W}) is deprecated and will be removed shortly`;J.alternativeKey&&(T+=` You should use this key (${J.alternativeKey}) as an alternate solution`),new Date>=J.mayBeRemoveIn?console.error(T):console.warn(T)}handleDeprecationPossibility(W){const J=R.get(W);if(J)return this.getConfig(J.deprecatedKey)}load(W){const J=W.default;return W.path?new Promise((T,Q)=>{this.httpClient.get(W.path).pipe((0,c.a)(z=>(console.log(`Configuration file ${W.path} could not be read`),this._isLoaded$.next(!1),T(!0),(0,e.c)(z.error||"Server error")))).subscribe(z=>{this.config=w.Yv.mergeDeep(w.Yv.mergeDeep({version:L},J),z),this._isLoaded$.next(!0),T(!0)})}):(this.config=J,this._isLoaded$.next(!0),!0)}static \u0275fac=function(J){return new(J||F)(E.CoB(a.m))};static \u0275prov=E.wxM({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})(),C=new E.UbH("configOptions");function S(F){return(0,E.AFj)([{provide:C,useValue:F},{provide:E.kZF,useFactory:P,multi:!0,deps:[_,C]}])}function P(F,h){return()=>F.load(h)}},20460:(Pe,ae,r)=>{"use strict";r.d(ae,{_s:()=>w,ov:()=>W,MV:()=>Q});var E=r(72584),a=r(34896);let w=(()=>{class K{static \u0275fac=function(d){return new(d||K)};static \u0275mod=a.a4G({type:K});static \u0275inj=a.s3X({imports:[E.O0]})}return K})();var p=r(33712),e=r(43168),c=r(54844),o=r(83680),R=r(19432),L=r(44816),_=r(40604),C=r(78600);class S{configService;prefix;suffix;httpClient;_isLoaded$=new c.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(j,A,d,u=".json"){this.configService=A,this.prefix=d,this.suffix=u,this.httpClient=new p.KK(j)}getTranslation(j){const A=this.httpClient.get(`locale/libs_locale/${j}.json`);return this.configService.isLoaded$.pipe((0,o.K)(d=>d),(0,R.G)(()=>{if(this.configService&&!this.prefix){const x=this.configService.getConfig("language.prefix");this.prefix=!x||Array.isArray(x)?x:[x]}if(!this.prefix||0===this.prefix.length)return this._isLoaded$.next(!0),A;const d=this.prefix.map(x=>this.httpClient.get(`${x}${j}${this.suffix}`));return(0,L.y)([A,...d]).pipe((0,_.k)(x=>x.reduce((U,G)=>e.Yv.mergeDeep(U,G),{})),(0,C.y)(()=>{this._isLoaded$.next(!0)}))}))}}var P=r(45872),y=r(31520),F=r(51672),h=r(35876);let W=(()=>{class K{translate;language;language$=new c.g(void 0);constructor(A){this.translate=A,this.language=this.translate.getBrowserLang();const d=this.getLanguage();this.translate.setDefaultLang(d),this.language$.next(d)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(A){this.language=A.match(/en|fr/)?A:"en",(0,h.E)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}static \u0275fac=function(d){return new(d||K)(a.CoB(E.qS))};static \u0275prov=a.wxM({token:K,factory:K.\u0275fac,providedIn:"root"})}return K})();class J{handle(j){if(!j.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===j.key.substr(0,4))throw new Error(`The Key "${j.key}" is missing in locale file.`);return j.key}}const T=5e3;function Q(K){return(0,a.AFj)([(0,a.ai8)(E.O0.forRoot(z(K))),{provide:a.kZF,useFactory:j=>()=>j.translate.currentLoader.isLoaded$?.pipe((0,y.m)(T),(0,o.K)(A=>!0===A),(0,F.a)(A=>{throw A.message+=` - Request timed out for language loader after: ${T}`,A})),deps:[W],multi:!0}])}const z=K=>({defaultLanguage:"fr",loader:K??Y,missingTranslationHandler:{provide:E.sf,useClass:J}}),Y={provide:E._E,useFactory:function N(K,j){return new S(K,j,void 0,void 0)},deps:[p.m,P.aW]}},56264:(Pe,ae,r)=>{"use strict";r.d(ae,{oZ:()=>E,cz:()=>a,QB:()=>c});var E=function(o){return o.Mobile="mobile",o.Tablet="tablet",o.Desktop="desktop",o}(E||{}),a=function(o){return o.Portrait="portrait",o.Landscape="landscape",o}(a||{}),w=r(73192),p=r(54844),e=r(34896);let c=(()=>{class o{media$=new p.g(void 0);orientation$=new p.g(void 0);constructor(L){L.observe([w.kP.HandsetLandscape]).subscribe(_=>{_.matches&&(this.media$.next(E.Mobile),this.orientation$.next(a.Landscape))}),L.observe([w.kP.HandsetPortrait]).subscribe(_=>{_.matches&&(this.media$.next(E.Mobile),this.orientation$.next(a.Portrait))}),L.observe([w.kP.TabletLandscape]).subscribe(_=>{_.matches&&(this.media$.next(E.Tablet),this.orientation$.next(a.Landscape))}),L.observe([w.kP.TabletPortrait]).subscribe(_=>{_.matches&&(this.media$.next(E.Tablet),this.orientation$.next(a.Portrait))}),L.observe([w.kP.WebLandscape]).subscribe(_=>{_.matches&&(this.media$.next(E.Desktop),this.orientation$.next(a.Landscape))}),L.observe([w.kP.WebPortrait]).subscribe(_=>{_.matches&&(this.media$.next(E.Desktop),this.orientation$.next(a.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}static \u0275fac=function(_){return new(_||o)(e.CoB(w.w$))};static \u0275prov=e.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},64100:(Pe,ae,r)=>{"use strict";r.d(ae,{UD:()=>e,mi:()=>P,QZ:()=>p});var E=r(34896),a=r(38472);const w={positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,titleClass:"mat-subtitle-2",messageClass:"toast-message",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0};function p(){return(0,E.AFj)([(0,a.eo)(w)])}let e=(()=>{class y{static forRoot(){return{ngModule:y,providers:[]}}static \u0275fac=function(W){return new(W||y)};static \u0275mod=E.a4G({type:y});static \u0275inj=E.s3X({providers:[p()]})}return y})();var c=function(y){return y.ERROR="error",y.ALERT="warning",y.WARNING="warning",y.INFO="info",y.SUCCESS="success",y.SHOW="show",y}(c||{}),o=r(45872),R=r(20460),L=r(54844),_=r(44816),C=r(24112),S=r(83680);let P=(()=>{class y{injector;configService;languageService;messages$=new L.g([]);options;activeMessageTranslations=[];constructor(h,W,J){this.injector=h,this.configService=W,this.languageService=J,this.options=this.configService.getConfig("message"),this.languageService.language$.pipe((0,C.o)(500)).subscribe(T=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(Q=>{const z=this.activeMessageTranslations.find(Y=>Y.id===Q.toastId);if(z){const Y={...z.textInterpolateParams},N={...z.titleInterpolateParams};z.textInterpolateParams&&Object.keys(z.textInterpolateParams).map(K=>{K&&(Y[K]=this.languageService.translate.instant(z.textInterpolateParams[K]))}),z.titleInterpolateParams&&Object.keys(z.titleInterpolateParams).map(K=>{K&&(N[K]=this.languageService.translate.instant(z.titleInterpolateParams[K]))}),(0,_.y)([this.languageService.translate.get(z.textKey,Y),this.languageService.translate.get(z.titleKey,N)]).pipe((0,S.K)()).subscribe(K=>{Q.toastRef.componentInstance.message=K[0],Q.toastRef.componentInstance.title=K[1]})}})})}get toastr(){return this.injector.get(a.SA)}showError(h){return h.error.caught=!0,this.error(h.error.message,h.error.title)}message(h){const W=h.type;this.toastr.toastrConfig.iconClasses[W]=`toast-${W}`,this.messages$.next(this.messages$.value.concat([h])),h.options=h.options||{};const J=new Date;if(h.options.from=h.options.from?h.options.from:new Date("1 jan 1900"),h.options.to=h.options.to?h.options.to:new Date("1 jan 3000"),"string"==typeof h.options.from&&(h.options.from=new Date(Date.parse(h.options.from.replace(/-/g," ")))),"string"==typeof h.options.to&&(h.options.to=new Date(Date.parse(h.options.to.replace(/-/g," ")))),J>h.options.from&&J<h.options.to&&(!1===h.showIcon&&(this.toastr.toastrConfig.iconClasses[W]=`toast-${W} toast-no-icon`),(h=this.handleTemplate(h)).text)){let T;switch(h.type){case c.SUCCESS:T=this.success(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.ERROR:T=this.error(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.INFO:T=this.info(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.SHOW:T=this.show(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.ALERT:case c.WARNING:T=this.alert(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;default:T=this.info(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams)}h.options.id=T.toastId}}success(h,W="igo.core.message.success",J={},T,Q){return this.handleNgxToastr("success",h,W,J,T,Q)}error(h,W="igo.core.message.error",J={},T,Q){return this.handleNgxToastr("error",h,W,J,T,Q)}info(h,W="igo.core.message.info",J={},T,Q){return this.handleNgxToastr("info",h,W,J,T,Q)}alert(h,W="igo.core.message.alert",J={},T,Q){return this.handleNgxToastr("alert",h,W,J,T,Q)}show(h,W="igo.core.message.info",J={},T,Q){return this.handleNgxToastr("show",h,W,J,T,Q)}handleNgxToastr(h,W,J,T={},Q,z){const Y={...Q},N={...z};Q&&Object.keys(Q).map(d=>{const u=Q[d];u&&(Y[d]="string"==typeof u?this.languageService.translate.instant(u):u)}),z&&Object.keys(z).map(d=>{if(d){const u=z[d];N[d]="string"==typeof u?this.languageService.translate.instant(u):u}});const K=this.languageService.translate.instant(W,Y),j=this.languageService.translate.instant(J,N);let A;switch(h){case"success":A=this.toastr.success(K,j,T);break;case"error":A=this.toastr.error(K,j,T);break;case"show":case"info":A=this.toastr.info(K,j,T);break;case"alert":A=this.toastr.warning(K,j,T)}return this.activeMessageTranslations.push({id:A.toastId,titleKey:J,textKey:W,textInterpolateParams:Q,titleInterpolateParams:z}),A}remove(h){this.toastr.remove(h)}removeAllAreNotError(){for(const h of this.messages$.value)h.type!==c.ERROR&&this.remove(h.options.id)}handleTemplate(h){if(!this.options?.template||h.html)return h;let W=this.options?.template;return W=W.replace("${text}",h.text),W=W.replace("${title}",h.title),h.html=void 0,h.text=W,h.title=void 0,h}static \u0275fac=function(W){return new(W||y)(E.CoB(E.zZn),E.CoB(o.aW),E.CoB(R.ov))};static \u0275prov=E.wxM({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},49112:(Pe,ae,r)=>{"use strict";r.d(ae,{u:()=>c});var E=r(34896),a=r(64100),w=r(93244),p=r(24112),e=r(31792);let c=(()=>{class o{messageService;injector;stateChangeEventEmitter=new E._w7;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(L,_){this.messageService=L,this.injector=_,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,w.w)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const L=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=L.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,w.w)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const L=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=L.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(L=!0){return L?this.stateChangeEventEmitter.pipe((0,p.o)(300),(0,e.W)(this.state)):this.stateChangeEventEmitter.pipe((0,p.o)(300))}static \u0275fac=function(_){return new(_||o)(E.CoB(a.mi),E.CoB(E.zZn))};static \u0275prov=E.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},56740:(Pe,ae,r)=>{"use strict";r.d(ae,{k$:()=>e});var E=r(34896),a=r(57880);let w=new E.UbH("routeServiceOptions"),e=(()=>{class c{router;route;options;constructor(R,L,_){this.router=R,this.route=L,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},_)}get queryParams(){let R=decodeURIComponent(location.search);if(R.includes("\xa2er=")){R=R.replace("\xa2er","&center");const L=R.slice(1).split("&").map(_=>_.split("=")).reduce((_,C)=>{const[S,P]=C.map(decodeURIComponent);return _[S]=P,_},{});this.router.navigate([],{queryParams:L})}return this.route.queryParams}static \u0275fac=function(L){return new(L||c)(E.CoB(a.E5),E.CoB(a.gV),E.CoB(w,8))};static \u0275prov=E.wxM({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},62004:(Pe,ae,r)=>{"use strict";r.d(ae,{kR:()=>p,Ab:()=>a,yQ:()=>o,Om:()=>w});var E=r(54844),a=function(R){return R.SESSION="Session",R.LOCAL="Local",R}(a||{}),w=function(R){return R.ADDED="Added",R.MODIFIED="Modified",R.REMOVED="Removed",R.CLEARED="Cleared",R}(w||{});class p{options;storageChange$=new E.g(void 0);constructor(L){this.options=L.getConfig("storage")||{key:"igo"}}get(L,_){let C;if((!_||_===a.SESSION)&&(C=sessionStorage.getItem(`${this.options.key}.${L}`)),(_===a.LOCAL||!C&&!_)&&(C=localStorage.getItem(`${this.options.key}.${L}`)),C)try{C=JSON.parse(C)}catch{}return C}set(L,_,C=a.LOCAL){const S=this.get(L,C);C===a.SESSION?sessionStorage.setItem(`${this.options.key}.${L}`,JSON.stringify(_)):localStorage.setItem(`${this.options.key}.${L}`,JSON.stringify(_));const P=this.get(L,C);P!==S&&this.storageChange$.next({key:L,scope:C,event:void 0!==S?w.MODIFIED:w.ADDED,previousValue:S,currentValue:P})}remove(L,_=a.LOCAL){const C=this.get(L,_);_===a.SESSION?sessionStorage.removeItem(`${this.options.key}.${L}`):localStorage.removeItem(`${this.options.key}.${L}`),this.storageChange$.next({key:L,scope:_,event:w.REMOVED,previousValue:C})}clear(L=a.LOCAL){L===a.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:L,event:w.CLEARED})}}var e=r(45872),c=r(34896);let o=(()=>{class R extends p{config;constructor(_){super(_),this.config=_}static \u0275fac=function(C){return new(C||R)(c.CoB(e.aW))};static \u0275prov=c.wxM({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},28660:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>a,S:()=>E});var E=function(w){return w.wms="wms",w.wmts="wmts",w.arcgisrest="esriJSON",w.imagearcgisrest="esriJSON",w.tilearcgisrest="esriJSON",w}(E||{}),a=function(w){return w.FeatureLayer="Feature Layer",w.RasterLayer="Raster Layer",w.GroupLayer="Group Layer",w}(a||{})},21780:(Pe,ae,r)=>{"use strict";r.d(ae,{S:()=>N});var E=r(21124),a=r(33712),w=r(43168),p=r(156),e=r(49240),c=r(36584),o=r(73592),R=r(61252),L=r(46184),_=r(44816),C=r(1296),S=r(21296),P=r(40604),y=r(51672),F=r(90916),h=r(14191),W=r(59324),J=r(49704),T=r(88824),Q=r(28660),z=r(34896),Y=r(12268);class N{http;mapService;parsers={wms:new e.c,wmts:new c.c,esriJSON:new o.c};constructor(j,A){this.http=j,this.mapService=A}getWMSOptions(j){return this.getCapabilities("wms",j.url,j.params.VERSION).pipe((0,P.k)(u=>u?this.parseWMSOptions(j,u):void 0))}getWMTSOptions(j){return this.getCapabilities("wmts",j.url,j.version).pipe((0,P.k)(x=>x?this.parseWMTSOptions(j,x):void 0))}getCartoOptions(j){return this.http.jsonp("https://"+j.account+".carto.com/api/v2/viz/"+j.mapId+"/viz.json","callback").pipe((0,P.k)(d=>this.parseCartoOptions(j,d)))}getArcgisOptions(j){const A=j.url+"/"+j.layer+"?f=json",d=this.getCapabilities("arcgisrest",j.url),u=this.http.get(A);return(0,_.y)([u,d]).pipe((0,P.k)(x=>this.parseArcgisOptions(j,x[0],x[1])))}getImageArcgisOptions(j){const A=j.url+"/"+j.layer+"?f=json",d=j.url+"/legend?f=json",u=this.getCapabilities("imagearcgisrest",j.url),x=this.http.get(A),U=this.http.get(d).pipe((0,P.k)(G=>G),(0,y.a)(G=>(console.log("No legend associated with this Image Service"),(0,C.of)(G))));return(0,_.y)([x,U,u]).pipe((0,P.k)(G=>this.parseTileOrImageArcgisOptions(j,G[0],G[1],G[2])))}getTileArcgisOptions(j){const A=j.url+"/"+j.layer+"?f=json",d=j.url+"/legend?f=json",u=this.getCapabilities("tilearcgisrest",j.url),x=this.http.get(A),U=this.http.get(d).pipe((0,P.k)(G=>G),(0,y.a)(G=>(console.log("No legend associated with this Tile Service"),(0,C.of)(G))));return(0,_.y)([x,U,u]).pipe((0,P.k)(G=>this.parseTileOrImageArcgisOptions(j,G[0],G[1],G[2])))}getCapabilities(j,A,d){const u=new a.i4({fromObject:{request:"GetCapabilities",service:j.toUpperCase(),version:d||"1.3.0",_i:"true"}});let x;return x="esriJSON"===Q.S[j]?this.http.get(A+"?f=json"):this.http.get(A,{params:u,responseType:"text"}),x.pipe((0,P.k)(U=>{if("esriJSON"===Q.S[j])return U;if(String(U).toLowerCase().includes("serviceexception")&&String(U).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[j].read(U)}),(0,y.a)(U=>{throw typeof U.error<"u"&&(U.error.caught=!0),U}))}parseWMSOptions(j,A){const u=this.findDataSourceInCapabilities(A.Capability.Layer,j.params.LAYERS);if(!u)throw{error:{message:"Layer not found"}};const x=u.DataURL?u.DataURL[0]:void 0,U=u.Abstract?u.Abstract:void 0,G=u.KeywordList?u.KeywordList:void 0;let X=u.queryable;const D=this.getTimeFilter(u),I=D&&Object.keys(D).length>0,M=u.Style?this.getStyle(u.Style):void 0;let s=!0;u.EX_GeographicBoundingBox?u.EX_GeographicBoundingBox.forEach((de,le)=>{le<2&&(de>180||de<-180)&&(s=!1),le>=2&&(de>90||de<-90)&&(s=!1)}):s=!1;const H=s?R.W0(u.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let Z;const me=[J.cv.GEOJSON,J.cv.GEOJSON2,J.cv.GML3,J.cv.GML2,J.cv.JSON,J.cv.HTML];for(const de of me)if(-1!==A.Capability.Request.GetFeatureInfo.Format.indexOf(de)){const le=Object.keys(J.cv).find(ue=>J.cv[ue]===de);Z=J.s5[le];break}Z||(X=!1);const _e=w.Yv.removeUndefined({_layerOptionsFromSource:{title:u.Title,maxResolution:(0,W.bg)(u.MaxScaleDenominator),minResolution:(0,W.bg)(u.MinScaleDenominator),extent:H,metadata:{url:x?x.OnlineResource:void 0,extern:!!x||void 0,abstract:U,keywordList:G},legendOptions:M},queryable:X,queryFormat:Z,timeFilter:I?D:void 0,timeFilterable:!!I||void 0,minDate:I?D.min:void 0,maxDate:I?D.max:void 0,stepDate:I?D.step:void 0});return w.Yv.mergeDeep(_e,j)}parseWMTSOptions(j,A){const d=A.Contents.Layer.find(G=>G.Identifier===j.layer),u=(0,L.o)(A,j),x=Object.assign(u,j),U=w.Yv.removeUndefined({_layerOptionsFromSource:{title:d.Title}});return w.Yv.mergeDeep(U,x)}parseCartoOptions(j,A){const d=[],u=A.layers[1].options.layer_definition;u.layers.forEach(U=>{d.push({type:U.type.toLowerCase(),options:U.options,legend:U.legend})});const x=w.Yv.removeUndefined({config:{version:u.version,layers:d}});return w.Yv.mergeDeep(x,j)}parseArcgisOptions(j,A,d){const u=A.name;let x,U;x=A.drawingInfo?.renderer?A.drawingInfo.renderer:void 0,A.drawingInfo&&(U=(new T.y).generateStyle(A,"esriMeters"===A.units?"m":"degrees"));const G=new p.c({target:A.copyrightText});let X,D;if(A.timeInfo){const s=A.timeInfo.timeExtent;X=s[0]+","+s[1];const H=new Date;H.setTime(s[0]);const Z=new Date;Z.setTime(s[1]),D={min:H.toUTCString(),max:Z.toUTCString(),range:!0,type:h.U.DATETIME,style:h.D.CALENDAR}}const I=Object.assign({},{style:U,LAYERS:j.layer?"show:"+j.layer:void 0,time:X}),M=w.Yv.removeUndefined({params:I,_layerOptionsFromSource:{title:u,minResolution:(0,W.bg)(A.maxScale),maxResolution:(0,W.bg)(A.minScale),metadata:{extern:!1,abstract:A.description||d.serviceDescription}},legendInfo:x,timeFilter:D,sourceFields:A.fields,queryTitle:A.displayField});return M.attributions=G,w.Yv.mergeDeep(M,j)}parseTileOrImageArcgisOptions(j,A,d,u){const x=A.name,U=d.layers?d.layers.find(s=>s.layerName===x):void 0,G=new p.c({target:A.copyrightText});let X,D;if(A.timeInfo){const s=A.timeInfo.timeExtent;X=s[0]+","+s[1];const H=new Date;H.setTime(s[0]);const Z=new Date;Z.setTime(s[1]),D={min:H.toUTCString(),max:Z.toUTCString(),range:!0,type:h.U.DATETIME,style:h.D.CALENDAR}}const I=Object.assign({},{LAYERS:j.layer?"show:"+j.layer:void 0,time:X}),M=w.Yv.removeUndefined({params:I,_layerOptionsFromSource:{title:x,minResolution:(0,W.bg)(A.maxScale),maxResolution:(0,W.bg)(A.minScale),metadata:{extern:!1,abstract:A.description||u.serviceDescription}},legendInfo:U,timeFilter:D,sourceFields:A.fields,queryTitle:A.displayField});return M.attributions=G,w.Yv.mergeDeep(M,j)}findDataSourceInCapabilities(j,A){if(Array.isArray(j)){let d;return j.find(u=>(d=this.findDataSourceInCapabilities(u,A),void 0!==d),this),d}return j.Layer?this.findDataSourceInCapabilities(j.Layer,A):j.Name&&j.Name===A?j:void 0}getTimeFilter(j){let A;if(j.Dimension){const d={};if(A=j.Dimension[0],A.values){const u=A.values.split("/");d.min=void 0!==u[0]?u[0]:void 0,d.max=void 0!==u[1]?u[1]:void 0,d.step=void 0!==u[2]?u[2]:void 0}return A.default&&(d.value=A.default),d}}getStyle(j){return{stylesAvailable:j.map(u=>({name:u.Name,title:u.Title})).filter((u,x,U)=>U.findIndex(G=>G.name===u.name)===x)}}static \u0275fac=function(A){return new(A||N)(z.CoB(a.KK),z.CoB(Y.u))};static \u0275prov=z.wxM({token:N,factory:N.\u0275fac,providedIn:"root"})}(0,E.UN)([(0,F.w)({maxCacheCount:20}),(0,E.YR)("design:type",Function),(0,E.YR)("design:paramtypes",[Object]),(0,E.YR)("design:returntype",S._)],N.prototype,"getArcgisOptions",null),(0,E.UN)([(0,F.w)({maxCacheCount:20}),(0,E.YR)("design:type",Function),(0,E.YR)("design:paramtypes",[Object]),(0,E.YR)("design:returntype",S._)],N.prototype,"getImageArcgisOptions",null),(0,E.UN)([(0,F.w)({maxCacheCount:20}),(0,E.YR)("design:type",Function),(0,E.YR)("design:paramtypes",[Object]),(0,E.YR)("design:returntype",S._)],N.prototype,"getTileArcgisOptions",null),(0,E.UN)([(0,F.w)({maxCacheCount:20}),(0,E.YR)("design:type",Function),(0,E.YR)("design:paramtypes",[String,String,String]),(0,E.YR)("design:returntype",S._)],N.prototype,"getCapabilities",null)},61200:(Pe,ae,r)=>{"use strict";r.d(ae,{O:()=>h});var E=r(45928),a=r(20460),w=r(64100),p=r(43168),e=r(54844),c=r(21296),o=r(1296),R=r(44816),L=r(51672),_=r(40604),C=r(21780),S=r(3544),P=r(92344),y=r(34896);class F{}let h=(()=>{class W{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;authInterceptor;datasources$=new e.g([]);constructor(T,Q,z,Y,N,K){this.capabilitiesService=T,this.optionsService=Q,this.wfsDataSourceService=z,this.languageService=Y,this.messageService=N,this.authInterceptor=K}createAsyncDataSource(T,Q){if(!T.type)throw console.error(T),new Error("Datasource needs a type");let z;switch(T.type.toLowerCase()){case"osm":z=this.createOSMDataSource(T);break;case"vector":z=this.createFeatureDataSource(T);break;case"wfs":z=this.createWFSDataSource(T);break;case"wms":const Y=T;p.Yv.removeDuplicateCaseInsensitive(Y.params),z=this.createWMSDataSource(Y,Q);break;case"wmts":z=this.createWMTSDataSource(T);break;case"xyz":z=this.createXYZDataSource(T);break;case"tiledebug":z=this.createTileDebugDataSource(T);break;case"carto":z=this.createCartoDataSource(T);break;case"arcgisrest":z=this.createArcGISRestDataSource(T,Q);break;case"imagearcgisrest":z=this.createArcGISRestImageDataSource(T,Q);break;case"websocket":z=this.createWebSocketDataSource(T);break;case"mvt":z=this.createMVTDataSource(T);break;case"tilearcgisrest":z=this.createTileArcGISRestDataSource(T,Q);break;case"cluster":z=this.createClusterDataSource(T);break;default:throw console.error(T),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([z])),z}createOSMDataSource(T){return new c._(Q=>Q.next(new S.yC(T)))}createFeatureDataSource(T){return new c._(Q=>Q.next(new S.EB(T)))}createWebSocketDataSource(T){return new c._(Q=>Q.next(new S.cR(T)))}createWFSDataSource(T){return new c._(Q=>Q.next(new S.ak(T,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(T,Q){const z=[];return T.optionsFromCapabilities&&window.navigator.onLine&&z.push(this.capabilitiesService.getWMSOptions(T).pipe((0,L.a)(Y=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:T.params.LAYERS}),Y}))),this.optionsService&&T.optionsFromApi&&window.navigator.onLine&&z.push(this.optionsService.getWMSOptions(T,Q).pipe((0,L.a)(Y=>(Y.error.toDisplay=!0,Y.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),Y.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),z.push((0,o.of)(T)),(0,R.y)(z).pipe((0,_.k)(Y=>{const N=Y.reduce((K,j)=>p.Yv.mergeDeep(K,j));return new S.CK(N,this.wfsDataSourceService)}),(0,L.a)(()=>(0,o.of)(void 0)))}createWMTSDataSource(T){return T.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(T).pipe((0,_.k)(Q=>Q?new S.m6(Q):void 0),(0,L.a)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:T.layer}),(0,o.of)(void 0)))):new c._(Q=>Q.next(new S.m6(T)))}createXYZDataSource(T){return new c._(Q=>Q.next(new S.nA(T)))}createTileDebugDataSource(T){return new c._(Q=>Q.next(new S.Uv(T)))}createCartoDataSource(T){return T.mapId?this.capabilitiesService.getCartoOptions(T).pipe((0,_.k)(Q=>new S.aI(Q))):new c._(Q=>Q.next(new S.aI(T)))}createArcGISRestDataSource(T,Q){const z=[];return window.navigator.onLine&&z.push(this.capabilitiesService.getArcgisOptions(T).pipe((0,L.a)(Y=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:T.layer}),Y}))),this.optionsService&&T.optionsFromApi&&window.navigator.onLine&&z.push(this.optionsService.getArcgisRestOptions(T,Q).pipe((0,L.a)(Y=>(Y.error.toDisplay=!0,Y.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),Y.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),z.push((0,o.of)(T)),(0,R.y)(z).pipe((0,_.k)(Y=>{const N=Y.reduce((K,j)=>p.Yv.mergeDeep(K,j));return new S.IH(N)}),(0,L.a)(()=>(0,o.of)(void 0)))}createArcGISRestImageDataSource(T,Q){const z=[];return window.navigator.onLine&&z.push(this.capabilitiesService.getImageArcgisOptions(T).pipe((0,L.a)(Y=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:T.params.LAYERS}),Y}))),this.optionsService&&T.optionsFromApi&&window.navigator.onLine&&z.push(this.optionsService.getArcgisRestOptions(T,Q).pipe((0,L.a)(Y=>(Y.error.toDisplay=!0,Y.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),Y.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),z.push((0,o.of)(T)),(0,R.y)(z).pipe((0,_.k)(Y=>{const N=Y.reduce((K,j)=>p.Yv.mergeDeep(K,j));return new S.yA(N)}),(0,L.a)(()=>(0,o.of)(void 0)))}createTileArcGISRestDataSource(T,Q){const z=[];return window.navigator.onLine&&z.push(this.capabilitiesService.getImageArcgisOptions(T).pipe((0,L.a)(Y=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:T.params.LAYERS}),Y}))),this.optionsService&&T.optionsFromApi&&window.navigator.onLine&&z.push(this.optionsService.getArcgisRestOptions(T,Q).pipe((0,L.a)(Y=>(Y.error.toDisplay=!0,Y.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),Y.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),z.push((0,o.of)(T)),(0,R.y)(z).pipe((0,_.k)(Y=>{const N=Y.reduce((K,j)=>p.Yv.mergeDeep(K,j));return new S.W4(N)}),(0,L.a)(()=>(0,o.of)(void 0)))}createMVTDataSource(T){return new c._(Q=>Q.next(new S.cv(T)))}createClusterDataSource(T){return new c._(Q=>Q.next(new S.a(T)))}static \u0275fac=function(Q){return new(Q||W)(y.CoB(C.S),y.CoB(F,8),y.CoB(P.Q),y.CoB(a.ov),y.CoB(w.mi),y.CoB(E.kT))};static \u0275prov=y.wxM({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})()},93176:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>p});var E=r(43168),a=r(3784),w=r(90112);class p extends w.E{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new a.c(this.options)}generateId(){return(0,E.uq)()}onUnwatch(){}}},94052:(Pe,ae,r)=>{"use strict";r.d(ae,{C:()=>a});var E=r(47864);class a{options;dataService;id;ol;legend;constructor(p={},e){this.options=p,this.dataService=e,this.options=p,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return(0,E.KC)(this.options)}getLegend(p,e){return this.legend?this.legend:[]}setLegend(p){return this.legend=p.url?[{url:p.url}]:p.html?[{html:p.html}]:[],this.legend}}},90112:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>e});var E=r(12396),a=r(83900),w=r(28772),p=r(94052);class e extends p.C{createOlSource(){const o={format:this.getSourceFormatFromOptions(this.options)};return new w.c(Object.assign(o,this.options))}getSourceFormatFromOptions(o){if(o.format)return o.format;let R;const L=o.formatType;if(L){if(R=a[L],void 0===R)throw new Error("Invalid vector source format ${formatType}.")}else R=E.c;const _=o.formatOptions;let C;return C=_?new R(_):new R,C}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}},3544:(Pe,ae,r)=>{"use strict";r.d(ae,{IH:()=>z,aI:()=>T,a:()=>M.a,EB:()=>a.E,yA:()=>N,cv:()=>I,yC:()=>p,W4:()=>K.W,Uv:()=>d,ak:()=>C,CK:()=>P.C,m6:()=>h,cR:()=>u,nA:()=>c});var E=r(94052),a=r(90112),w=r(19860);class p extends E.C{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new w.c(this.options)}onUnwatch(){}}var e=r(49228);class c extends E.C{createOlSource(){return new e.c(this.options)}onUnwatch(){}}var o=r(91784),R=r(28772),L=r(40912),_=r(38084);class C extends E.C{options;wfsService;authInterceptor;set ogcFilters(H){this.options.ogcFilters=H}get ogcFilters(){return this.options.ogcFilters}constructor(H,Z,me){super((0,_.w$)(H,"wfs")),this.options=H,this.wfsService=Z,this.authInterceptor=me;const _e=this.options.ogcFilters,de=this.options.paramsWFS.fieldNameGeometry||_.k3,le=new L.S;this.options.ogcFilters=le.defineOgcFiltersDefaultOptions(_e,de),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(H.sourceFields||[]).filter(ue=>!ue.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),_e?.pushButtons&&(_e.pushButtons.selectorType="pushButton"),_e?.checkboxes&&(_e.checkboxes.selectorType="checkbox"),_e?.radioButtons&&(_e.radioButtons.selectorType="radioButton"),_e?.select&&(_e.select.selectorType="select"),_e?.autocomplete&&(_e.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new R.c({format:(0,_.So)(this.options),strategy:o.OK})}setOgcFilters(H,Z=!1){this.ogcFilters=H,Z&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}r(92344);var P=r(21808),y=r(46184),F=r(43940);class h extends E.C{constructor(H){super(H)}createOlSource(){const H=Object.assign({tileGrid:(0,F.g)(this.options.projection)},this.options);return new y.c(H)}onUnwatch(){}}var W=r(51008),J=r(49704);class T extends E.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:J.Il.BLANK}createOlSource(){const Z=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new W.c(Z)}getLegend(){const H=super.getLegend();if(H.length>0)return H;let Z="<table>";if(this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(me=>{!0===me.visible&&(Z+='<tr><td><p><font size="5" color="'+me.value+'"> &#9679</font></p></td><td>'+me.name+"</td></tr>")}),Z+="</table>",[{html:Z}];{const me=this.options.config.layers[0].options,_e=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const de of _e)if(me.cartocss.includes(de)){const le=me.cartocss.split(de).pop(),ue=le.substr(0,le.indexOf(";"));if(ue.includes("ramp")){const ne=ue.split(", (")[1].split(","),ve=ue.split(", (")[2].split(",");for(let ye=0;ye<ne.length;ye++)ne[ye]=ne[ye].replace(/("|\))/g,""),ve[ye]=ve[ye].replace(/("|\))/g,""),"="===ve[ye].replace(/\s+/g,"")&&(ve[ye]="Autres"),Z+='<tr><td><p><font size="5" color="'+ne[ye]+'"> &#9679</font></p></td><td>'+ve[ye]+"</td></tr>";break}Z+='<tr><td><p><font size="5" color="'+ue+'"> &#9679</font></p></td><td>'+(me.layer_name?me.layer_name:"")+"</td></tr>";break}return Z+="</table>",[{html:Z}]}}onUnwatch(){}}var Q=r(73592);class z extends E.C{createOlSource(){const H=new Q.c;return new R.c({attributions:this.options.params.attributions,overlaps:!1,format:H,url:function(Z,me,_e){const de=this.options.url+"/"+this.options.layer+"/query/",ue=["f=json",`geometry=${encodeURIComponent('{"xmin":'+Z[0]+',"ymin":'+Z[1]+',"xmax":'+Z[2]+',"ymax":'+Z[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&ue.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(ne=>{ue.push(ne)}),`${de}?${ue.join("&")}`}.bind(this),strategy:o.OK})}getLegend(){const H=this.options.legendInfo,Z=super.getLegend();if(void 0===H||Z.length>0)return Z;if(!H)return;let _e,de,le,me="<table>";if(H.legend)for(const ue of H.legend)_e=this.htmlImgSrc(ue.contentType,ue.imageData),de=ue.label?ue.label.replace("<Null>","Null"):"",me+="<tr><td align='left'><img src=\""+_e+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>";else if("uniqueValue"===H.type)for(const ue of H.uniqueValueInfos)de=ue.label.replace("<Null>","Null"),"esriPMS"===ue.symbol.type?(_e=this.htmlImgSrc(ue.symbol.contentType,ue.symbol.imageData),me+="<tr><td align='left'><img src=\""+_e+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>"):"esriPMS"!==ue.symbol.type&&(le=this.createSVG(ue.symbol),me+="<tr><td align='left'>"+le+'</td><td class="mat-typography">'+de+"</td></tr>");else"simple"===H.type&&(de=H.label?H.label.replace("<Null>","Null"):"","esriPMS"===H.symbol.type?(_e=this.htmlImgSrc(H.symbol.contentType,H.symbol.imageData),me+="<tr><td align='left'><img src=\""+_e+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>"):"esriPMS"!==H.symbol.type&&(le=this.createSVG(H.symbol),me+="<tr><td align='left'>"+le+'</td><td class="mat-typography">'+de+"</td></tr>"));return me+="</table>",[{html:me}]}htmlImgSrc(H,Z){return`data:${H};base64,${Z}`}createSVG(H){let Z="";const me=H.color?H.color:[0,0,0,0];if("esriSLS"===H.type){const de="stroke:rgba("+me[0]+","+me[1]+","+me[2]+","+me[3]+")",le="stroke-width:"+(H.width?H.width:0);"esriSLSSolid"===H.style?Z='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+de+";"+le+'"/></svg>':"esriSLSDash"===H.style&&(Z='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+de+";"+le+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===H.style||"esriSFSSolid"===H.style){const _e=H.outline.color,ue="stroke:rgba("+_e[0]+","+_e[1]+","+_e[2]+","+_e[3]+")",ne="stroke-width:"+H.outline.width,ve="fill:rgba("+me[0]+","+me[1]+","+me[2]+","+me[3]+")";Z="esriSMSCircle"===H.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+H.size/2+'" style="'+ue+";"+ne+";"+ve+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+ue+";"+ne+";"+ve+'"/></svg>'}return Z}onUnwatch(){}}var Y=r(38952);class N extends E.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:J.Il.BLANK}createOlSource(){const H=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof H.renderingRule&&(H.renderingRule=JSON.stringify(H.renderingRule)),new Y.c({ratio:1,params:H,url:this.options.url})}getLegend(){const H=this.options.legendInfo,Z=super.getLegend();if(void 0===H||void 0===this.options.layer||Z.length>0)return Z;if(!H)return;let me="<table>";for(const _e of H.legend)me+=`<tr><td align='left'><img src="${this.options.url}/${H.layerId}/images/${_e.url}" alt ='' /></td><td class="mat-typography">`+_e.label.replace("<Null>","Null")+"</td></tr>";return me+="</table>",[{html:me}]}onUnwatch(){}}var K=r(92424),j=r(19508),A=r(48720);class d extends E.C{createOlSource(){const H=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete H.tileGrid,H.tileGrid=new A.c(this.options.tileGrid)),new j.c(H)}onUnwatch(){}}class u extends a.E{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(H){const Z=this.options.format.readFeature(H.data);switch(this.options.onmessage){case"update":const me=this.ol.getFeatureById(Z.getId());me&&this.ol.removeFeature(me),this.ol.addFeature(Z);break;case"delete":this.ol.clear(!0),this.ol.addFeature(Z);break;default:this.ol.addFeature(Z)}}onClose(H){}onError(H){}onOpen(H){}onUnwatch(){this.ws.close()}}var x=r(43168),U=r(58264),G=r(99668),X=r(19076),D=r(11772);class I extends E.C{createOlSource(){let H;return H="feature"===this.options.featureClass?new G.c({featureClass:U.c}):new G.c,this.options.format=H,new X.c(this.options)}generateId(){return this.options.url?D.Cy.hashStr("mvt"+this.options.url):(0,x.uq)()}onUnwatch(){}}var M=r(93176)},92424:(Pe,ae,r)=>{"use strict";r.d(ae,{W:()=>p});var E=r(96120),a=r(49704),w=r(94052);class p extends w.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:a.Il.BLANK}createOlSource(){return new E.c(this.options)}getLegend(){const c=this.options.legendInfo,o=super.getLegend();if(void 0===c||void 0===this.options.layer||o.length>0)return o;if(!c)return;let R="<table>";for(const L of c.legend)R+=`<tr><td align='left'><img src="${this.options.url}/${c.layerId}/images/${L.url}" alt ='' /></td><td class="mat-typography">`+L.label.replace("<Null>","Null")+"</td></tr>";return R+="</table>",[{html:R}]}onUnwatch(){}}},92344:(Pe,ae,r)=>{"use strict";r.d(ae,{Q:()=>L});var E=r(21296),a=r(1296),w=r(35876),p=r(10211);class e{}var c=r(38084),o=r(34896),R=r(33712);let L=(()=>{class _ extends e{http;constructor(S){super(),this.http=S}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(S){S.sourceFields&&0!==S.sourceFields.length?this.defineFieldAndValuefromWFS(S).subscribe(P=>{S.sourceFields.forEach(y=>{void 0===y.alias&&(y.alias=y.name),(void 0===y.values||0===y.values.length)&&(y.values=P.find(F=>F.name===y.name).values)})}):(S.sourceFields=[],this.defineFieldAndValuefromWFS(S).subscribe(P=>{S.sourceFields=P}))}wfsGetFeature(S,P=c.G4,y=c.sn,F,h=0,W=!1){const T=(0,c.as)(S,P,y,F,h,W).find(z=>"getfeature"===z.name).value,Q=S.paramsWFS.outputFormat;return W||c._K.test(Q)||!Q?this.http.get(T,{responseType:"text"}):this.http.get(T)}defineFieldAndValuefromWFS(S){return new E._(P=>{const y=[];let F,h,W,J,T;J=(0,c.So)(S);const Q=JSON.parse(JSON.stringify(S));delete Q.paramsWFS.outputFormat,delete Q.formatOptions,T=(0,c.So)(Q);let z=S.sourceFields?.filter(Y=>!Y.values).map(Y=>Y.name);this.wfsGetFeature(S,1,void 0,void 0,0,!0).pipe((0,p.m)(Y=>String(Y).toLowerCase().includes("exception")?(0,a.of)(!1):(0,a.of)(!0)),(0,p.m)(Y=>this.wfsGetFeature(S,1).pipe((0,p.m)(N=>{const K=J.readFeatures(N);F=K[0].getKeys(),(S.sourceFields||0===S.sourceFields.length)&&(z=F),h=F.filter(d=>z.includes(d)&&d!==K[0].getGeometryName()&&!d.match(/boundedby/gi)),W=h.join(",");const j=[];let A=0;if(!Y&&"2.0.0"===S.paramsWFS.version&&S.paramsWFS.maxFeatures>c.G4){for(;A<S.paramsWFS.maxFeatures;)j.push(this.wfsGetFeature(S,1e3,S.paramsWFS.srsName,W,A)),A+=1e3;T=J}else j.push(this.wfsGetFeature(S,S.paramsWFS.maxFeatures||c.G4,S.paramsWFS.srsName,W,0,!0));return(0,w.E)(j)})))).subscribe(Y=>{let N=[];Y.map(K=>{const j=T.readFeatures(K);N=N.concat(j)}),this.built_properties_value(N).forEach(K=>{y.push(K)}),P.next(y),P.complete()})})}built_properties_value(S){if(0===S.length)return[];const P=Object.assign({},S[0].getProperties());delete P[S[0].getGeometryName()],delete P.boundedBy;const y=[];for(const F in P)if(P.hasOwnProperty(F)){const h="object"==typeof S[0].get(F)?void 0:typeof S[0].get(F);y.push({name:F,alias:F,type:h,values:[P[F]]})}return S.every(F=>{const h=F.getProperties();for(const W in h)h.hasOwnProperty(W)&&W in P&&y.filter(J=>J.name===W).forEach(J=>{-1===J.values.indexOf(h[W])&&J.values.push(h[W])});return!0}),y}static \u0275fac=function(P){return new(P||_)(o.CoB(R.KK))};static \u0275prov=o.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},21808:(Pe,ae,r)=>{"use strict";r.d(ae,{C:()=>R});var E=r(43168),a=r(45804),w=r(54844),p=r(40912),e=r(49704),c=r(94052),o=r(38084);class R extends c.C{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:e.Il.BLANK}set ogcFilters(_){this.options.ogcFilters=_}get ogcFilters(){return this.options.ogcFilters}set timeFilter(_){this.options.timeFilter=_}get timeFilter(){return this.options.timeFilter}timeFilter$=new w.g(void 0);constructor(_,C){super(_),this.options=_,this.wfsService=C;const S=_.params,P=S.DPI||96;S.DPI=P,S.MAP_RESOLUTION=P,S.FORMAT_OPTIONS="dpi:"+P,_.refreshIntervalSec&&_.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*_.refreshIntervalSec);let y=o.k3;if(_.paramsWFS){const T=(0,o.w$)(_,"wms");E.Yv.mergeDeep(_.paramsWFS,T.paramsWFS),y=_.paramsWFS.fieldNameGeometry||y,_.download=Object.assign({},_.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(_)})}_.sourceFields&&0!==_.sourceFields.length?_.sourceFields.forEach(T=>{T.alias=T.alias?T.alias:T.name}):_.sourceFields=[];const F=_.ogcFilters,h=new p.S;F?(F.advancedOgcFilters=!(F.pushButtons||F.checkboxes||F.radioButtons||F.select||F.autocomplete),F.advancedOgcFilters&&F.filters&&F.filters.calendarModeYear&&(F.advancedOgcFilters=!1),F.pushButtons&&(F.pushButtons.selectorType="pushButton"),F.checkboxes&&(F.checkboxes.selectorType="checkbox"),F.radioButtons&&(F.radioButtons.selectorType="radioButton"),F.select&&(F.select.selectorType="select"),F.autocomplete&&(F.autocomplete.selectorType="autocomplete")):_.ogcFilters=h.defineOgcFiltersDefaultOptions(F,y,"wms"),S.LAYERS.split(",").length>1&&F&&F.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+S.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),_.paramsWFS&&F&&F.enabled&&F.editable&&(_.sourceFields||[]).filter(T=>!T.values).length>0&&this.wfsService.getSourceFieldsFromWFS(_);const W=h.handleOgcFiltersAppliedValue(_,y);S.FILTER=W,this.ol.updateParams({FILTER:S.FILTER}),this.setOgcFilters(F,!0);const J=_;J?.timeFilterable&&J?.timeFilter&&this.setTimeFilter(J.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(_){return(0,o.as)(_).find(P=>"getfeature"===P.name).value}createOlSource(){return new a.c(Object.assign({ratio:1},this.options))}setOgcFilters(_,C=!1){this.ogcFilters=_,C&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(_,C=!1){this.timeFilter=_,C&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(_,C){let S=super.getLegend();if(S.length>0&&void 0===_&&!C?.scale)return S;let y,P=!1;C?.size&&C?.extent&&C?.projection&&this.options.contentDependentLegend&&(y="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",P=!0);const F=this.params;let h=[];void 0!==F.LAYERS&&(h=F.LAYERS.split(","));const W=this.options.url.replace(/\?$/,""),J=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${F.VERSION||"1.3.0"}`];return void 0!==_&&J.push(`STYLE=${_}`),void 0!==C?.scale&&J.push(`SCALE=${C.scale}`),P&&(J.push(`WIDTH=${C.size[0]}`),J.push(`HEIGHT=${C.size[1]}`),J.push(`BBOX=${C.extent.join(",")}`),J.push(`${y}=${C.projection}`)),S=h.map(T=>{const Q=W.match(/\?/)?"&":"?";return{url:`${W}${Q}${J.join("&")}&LAYER=${T}`,title:h.length>1?T:void 0,currentStyle:void 0===_?void 0:_}}),S}onUnwatch(){}}},38084:(Pe,ae,r)=>{"use strict";r.d(ae,{G4:()=>F,So:()=>N,_K:()=>J,as:()=>z,k3:()=>W,sn:()=>y,w$:()=>Y,yK:()=>Q});var E=r(11544),a=r(83900),w=r(58288),p=r(12396),e=r(73592),c=r(79084),o=r(10416),R=r(17439),L=r(95456),_=r(14984),C=r(61972),S=r(1676),P=r(40912);const y="EPSG:3857",F=5e3,h="2.0.0",W="geometry",J=new RegExp(/(.*)?gml(.*)?/gi);function Q(K,j,A,d,u){const x=K.paramsWFS,U=z(K,void 0,K.paramsWFS.srsName);let G;d?.enabled&&(G=d?.filters);const X=new P.S,D=X.buildFilter(G,j,A,d?.geometryName,K);let I=X.handleOgcFiltersAppliedValue(K,d?.geometryName,j,A),M="filter";I||(M="bbox",I=j.join(",")+","+A.getCode()),x.xmlFilter=d?.advancedOgcFilters?D:`${M}=${I}`;let s=U.find(Z=>"getfeature"===Z.name).value;return s=/(filter|bbox)=.*/gi.test(x.xmlFilter)?`${s}&${x.xmlFilter}`:s,K.download=Object.assign({},K.download,{dynamicUrl:s}),u&&(s+=`$&_t${(new Date).getTime()}`),s.replace(/&&/g,"&")}function z(K,j,A,d,u=0,x=!1){const U="2.0.0",G=K.urlWfs,X=K.paramsWFS,D=j||F,I=X.version===U?`startIndex=${u}`:"",M=A||y;let s=X.outputFormat?`outputFormat=${X.outputFormat}`:"",H=X.version?`version=${X.version}`:`version=${h}`;const me=`${X.version===U?"typenames":"typename"}=${X.featureTypes}`,_e=X.version===U?"count":"maxFeatures";let de=j?`${_e}=${D}`:X.maxFeatures?`${_e}=${X.maxFeatures}`:`${_e}=${D}`;x&&(s="",H="version=1.1.0",de=de.replace("count","maxFeatures"));const le=A?`srsname=${M}`:X.srsName?"srsname="+X.srsName:`srsname=${M}`;let ue="",ne="";d&&(ue=`propertyName=${d}`,ne=`valueReference=${d}`);const ve=K.sourceFields;if(!ue&&ve&&ve.length>0){const Ge=[];K.sourceFields.forEach(ct=>{Ge.push(ct.name)}),ue=`propertyName=${Ge.join(",")},${X.fieldNameGeometry}`}const ye=-1===G.indexOf("?")?"?":"&";let He=`${G}${ye}service=WFS&request=GetFeature&${H}&${me}&`;He+=`${s}&${le}&${de}&${ue}&${I}`;let Ve=`${G}?service=WFS&request=GetPropertyValue&version=${U}&${me}&`;return Ve+=`&${de}&${ne}`,[{name:"outputformat",value:s},{name:"version",value:H},{name:"typename",value:me},{name:"count",value:de},{name:"srsname",value:le},{name:"propertyname",value:ue},{name:"valuereference",value:ne},{name:"getcapabilities",value:`${G}${ye}service=WFS&request=GetCapabilities&${H}`.replace(/&&/g,"&")},{name:"getfeature",value:He.replace(/&&/g,"&")},{name:"getpropertyvalue",value:Ve.replace(/&&/g,"&")}]}function Y(K,j){j&&"wfs"===j&&(K.paramsWFS=K.params);const A=K.paramsWFS;let d;return K.urlWfs=K.urlWfs||K.url,A.version=A.version||h,A.fieldNameGeometry=A.fieldNameGeometry||W,A.maxFeatures=A.maxFeatures||F,A.outputFormat&&(d=A.outputFormat),(J.test(d)||!d)&&(A.version="1.1.0"),Object.assign({},K)}function N(K){const j=K;let A;const d=j.paramsWFS.outputFormat?j.paramsWFS.outputFormat:void 0;return d?a[d]?(A=a[d],new A(j.formatOptions)):d.toLowerCase().match("gml2")?(A=E.c,new A({...j.formatOptions,gmlFormat:L.c})):d.toLowerCase().match("gml32")?(A=E.c,new A({...j.formatOptions,gmlFormat:C.c})):d.toLowerCase().match("gml3")?(A=E.c,new A({...j.formatOptions,gmlFormat:_.c})):d.toLowerCase().match("topojson")?(A=w.c,new A(j.formatOptions)):d.toLowerCase().match("geojson")?(A=p.c,new A(j.formatOptions)):d.toLowerCase().match("esrijson")?(A=e.c,new A(j.formatOptions)):d.toLowerCase().match("json")?(A=p.c,new A(j.formatOptions)):d.toLowerCase().match("gpx")?(A=c.c,new A(j.formatOptions)):d.toLowerCase().match("WKT")?(A=o.c,new A(j.formatOptions)):d.toLowerCase().match("osmxml")?(A=S.c,new A(j.formatOptions)):d.toLowerCase().match("kml")?(A=R.cp,new A(j.formatOptions)):new A:(A=E.c,new A(j.formatOptions))}},43940:(Pe,ae,r)=>{"use strict";r.d(ae,{g:()=>p});var E=r(94448),a=r(61252),w=r(27984);function p(e){const o=a._M(e||"EPSG:3857").getExtent(),R=(0,E.K6)(o)/256,L=new Array(20),_=new Array(20);for(let C=0;C<20;++C)L[C]=R/Math.pow(2,C),_[C]=C;return new w.c({origin:(0,E.Iq)(o),resolutions:L,matrixIds:_})}},69488:(Pe,ae,r)=>{"use strict";r.d(ae,{k:()=>Y});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(20460),c=r(64100),o=r(56740),R=r(43168),L=r(61616),_=r(54844),C=r(59324),S=r(72156),P=r(49172),F=(r(19188),r(34896)),h=r(72584);function W(N,K){if(1&N){const j=F.KQA();F.I0R(0,"button",5),F.qCj("click",function(){F.usT(j);const d=F.GaO();return F.CGJ(d.resetStops())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"restore_page"),F.C$Y()()}2&N&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function J(N,K){if(1&N){const j=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(j);const d=F.GaO();return F.CGJ(d.zoomRoute())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"zoom_in"),F.C$Y()()}2&N&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.zoomRoute"))}function T(N,K){if(1&N){const j=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(j);const d=F.GaO();return F.CGJ(d.copyDirectionsToClipboard())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"content_copy"),F.C$Y()()}2&N&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.copy"))}function Q(N,K){if(1&N){const j=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(j);const d=F.GaO();return F.CGJ(d.copyLinkToClipboard())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"link"),F.C$Y()()}2&N&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.link"))}function z(N,K){if(1&N){const j=F.KQA();F.I0R(0,"button",6),F.qCj("click",function(){F.usT(j);const d=F.GaO();return F.CGJ(d.printDirections())}),F.wVc(1,"async"),F.wVc(2,"translate"),F.I0R(3,"mat-icon"),F.OEk(4,"print"),F.C$Y()()}if(2&N){const j=F.GaO();F.E7m("disabled",F.kDX(1,2,j.disabled$))("matTooltip",F.kDX(2,4,"igo.geo.directionsForm.print"))}}let Y=(()=>{class N{languageService;messageService;route;directionsService;get activeRoute(){return this.routesFeatureStore.all().find(j=>j.properties.active)}contextUri;zoomToActiveRoute$=new L.E;stopsStore;routesFeatureStore;stepFeatureStore;disabled$=new _.g(!1);constructor(j,A,d,u){this.languageService=j,this.messageService=A,this.route=d,this.directionsService=u}resetStops(){this.stopsStore.clearStops()}addStop(){(0,P.um)(this.stopsStore)}copyLinkToClipboard(){R._D.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const j=this.directionsToText();R._D.copy(j)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const j="\t";let A=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",d="";const u=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+j+this.activeRoute.properties.direction.title+"\n"+j+(0,P.YX)(this.activeRoute.properties.direction.distance)+"\n"+j+(0,P.AD)(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",x=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+j+this.getUrl();let U=1;this.stopsStore.view.all().forEach(D=>{let I="",M="";D.text!==(0,C.uE)(D.coordinates).join(",")?(M=D.text,I=` ( ${(0,C.uE)(D.coordinates).join(",")} )`):M=(0,C.uE)(D.coordinates).join(","),d=d+j+U.toLocaleString()+". "+M+I+"\n",U++});let G=0;return this.activeRoute.properties.direction.steps.forEach(D=>{const I=this.formatStep(D,G).instruction,M=void 0===(0,P.YX)(D.distance)?"":" ("+(0,P.YX)(D.distance)+")";A=A+j+(G+1).toLocaleString()+". "+I+M+"\n",G++}),u+d+"\n"+x+"\n\n"+A}formatStep(j,A){return(0,P.qe)(j.maneuver.type,j.maneuver.modifier,j.name,j.maneuver.bearing_after,A,j.maneuver.exit,this.languageService,A===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let j="";this.contextUri&&(j=`context=${this.contextUri}&`);const A=this.routesFeatureStore.all().map(G=>G.properties.id).indexOf(this.activeRoute.properties.id);let d="";0!==A&&(d=`&${this.route.options.directionsOptionsKey}=result:${A}`);const u=this.route.options.directionsCoordKey,x=this.stopsStore.view.all().map(G=>(0,C.uE)(G.coordinates,6));let U="";return x.length>=2?(U=`${u}=${x.join(";")}`,`${location.origin}${location.pathname}?${j}tool=directions&sidenav=1&${U}${d}`):void 0}printDirections(){this.stepFeatureStore.clear(),this.disabled$.next(!0),this.directionsService.downloadDirection(this.routesFeatureStore.map,this.activeRoute.properties.direction).subscribe(()=>{this.disabled$.next(!1)})}static \u0275fac=function(A){return new(A||N)(F.GI1(e.ov),F.GI1(c.mi),F.GI1(o.k$,8),F.GI1(S.WI))};static \u0275cmp=F.In1({type:N,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[F.UHJ],decls:16,vars:20,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click"]],template:function(A,d){1&A&&(F.I0R(0,"div",0)(1,"button",1),F.qCj("click",function(){return d.addStop()}),F.wVc(2,"translate"),F.I0R(3,"mat-icon"),F.OEk(4,"add_location_alt"),F.C$Y()(),F.yuY(5,W,4,3,"button",2),F.wVc(6,"async"),F.wVc(7,"async"),F.yuY(8,J,4,3,"button",3),F.wVc(9,"async"),F.yuY(10,T,4,3,"button",3),F.wVc(11,"async"),F.yuY(12,Q,4,3,"button",3),F.wVc(13,"async"),F.yuY(14,z,5,6,"button",4),F.wVc(15,"async"),F.C$Y()),2&A&&(F.yG2(),F.E7m("matTooltip",F.kDX(2,6,"igo.geo.directionsForm.addStop")),F.yG2(4),F.E7m("ngIf",F.kDX(6,8,d.routesFeatureStore.count$)>=1||F.kDX(7,10,d.stopsStore.count$)>=1),F.yG2(3),F.E7m("ngIf",F.kDX(9,12,d.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(11,14,d.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(13,16,d.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(15,18,d.routesFeatureStore.count$)>=1))},dependencies:[a.oJ,a.um,p.KO,p.a4,w.oB,w.qL,E.u_,E.a,e._s,h.sD]})}return N})()},8984:(Pe,ae,r)=>{"use strict";r.d(ae,{k:()=>d});var E=r(21600),a=r(65056),w=r(34896),p=r(71904),e=r(69400),c=r(34672),o=r(46176),R=r(50244),L=r(32328),_=r(42536),C=r(27e3),S=r(20460),P=r(83552),y=r(61252),F=r(12472),h=r(59324),W=r(9452),J=r(49172),Q=(r(19188),r(72584));function z(u,x){if(1&u){const U=w.KQA();w.I0R(0,"button",11),w.qCj("click",function(){w.usT(U);const X=w.GaO().$implicit,D=w.GaO();return w.CGJ(D.clearStop(X))}),w.wVc(1,"translate"),w.I0R(2,"mat-icon"),w.OEk(3,"close"),w.C$Y()()}2&u&&w.E7m("matTooltip",w.kDX(1,1,"igo.geo.directionsForm.clearStop"))}function Y(u,x){if(1&u&&(w.I0R(0,"mat-option",14),w.OEk(1),w.C$Y()),2&u){const U=x.$implicit;w.E7m("value",U)("matTooltip",U.meta?U.meta.title:""),w.yG2(),w.oRS(" ",U.meta?U.meta.title:""," ")}}function N(u,x){if(1&u&&(w.I0R(0,"mat-optgroup",12),w.yuY(1,Y,2,3,"mat-option",13),w.C$Y()),2&u){const U=x.$implicit;w.E7m("label",U.source.title)("disabled",!1===U.source.enabled),w.yG2(),w.E7m("ngForOf",U.results)}}function K(u,x){if(1&u){const U=w.KQA();w.I0R(0,"button",18),w.qCj("click",function(){w.usT(U);const X=w.GaO(2).$implicit,D=w.GaO();return w.CGJ(D.removeStop(X))}),w.wVc(1,"translate"),w.I0R(2,"mat-icon"),w.OEk(3,"delete"),w.C$Y()()}2&u&&w.E7m("matTooltip",w.kDX(1,1,"igo.geo.directionsForm.removeStop"))}function j(u,x){if(1&u&&(w.I0R(0,"div",15)(1,"button",16),w.wVc(2,"translate"),w.I0R(3,"mat-icon"),w.OEk(4,"drag_indicator"),w.C$Y()(),w.yuY(5,K,4,3,"button",17),w.wVc(6,"async"),w.C$Y()),2&u){const U=w.GaO(2);w.yG2(),w.E7m("matTooltip",w.kDX(2,2,"igo.geo.directionsForm.moveStop")),w.yG2(4),w.E7m("ngIf",w.kDX(6,4,U.stopsStore.count$)>2)}}function A(u,x){if(1&u){const U=w.KQA();w.I0R(0,"div",2),w.qCj("touchenter",function(){const D=w.usT(U).$implicit,I=w.GaO();return w.CGJ(I.onStopEnter(D))})("touchleave",function(){w.usT(U);const X=w.GaO();return w.CGJ(X.onStopLeave())})("mouseover",function(){const D=w.usT(U).$implicit,I=w.GaO();return w.CGJ(I.onStopEnter(D))})("mouseleave",function(){w.usT(U);const X=w.GaO();return w.CGJ(X.onStopLeave())})("cdkDragStarted",function(){w.usT(U);const X=w.GaO();return w.CGJ(X.stopIsDragged=!0)})("cdkDragEnded",function(){w.usT(U);const X=w.GaO();return w.CGJ(X.stopIsDragged=!1)}),w.I0R(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),w.OEk(4),w.C$Y(),w.I0R(5,"input",5),w.qCj("focus",function(){const D=w.usT(U).$implicit,I=w.GaO();return w.CGJ(I.onInputFocus(D))}),w.iHE("ngModelChange",function(X){const I=w.usT(U).$implicit;return w.kNx(I.text,X)||(I.text=X),w.CGJ(X)}),w.qCj("keyup",function(X){const I=w.usT(U).$implicit,M=w.GaO();return w.CGJ(M.setStopText(X,I))})("keydown.enter",function(X){return X.preventDefault()}),w.C$Y(),w.yuY(6,z,4,3,"button",6),w.I0R(7,"mat-autocomplete",7,8),w.qCj("optionSelected",function(X){const I=w.usT(U).$implicit,M=w.GaO();return w.CGJ(M.chooseProposal(X,I))}),w.yuY(9,N,2,3,"mat-optgroup",9),w.C$Y()()(),w.yuY(10,j,7,6,"div",10),w.C$Y()}if(2&u){const U=x.$implicit,G=w.Gew(8),X=w.GaO();w.yG2(),w.E7m("ngClass",X.getNgClass(U)),w.yG2(3),w.cNF(X.getPlaceholder(U)),w.yG2(),w._6D("id",U.id),w.E7m("placeholder",X.getPlaceholder(U))("matTooltip",U.text),w.OKB("ngModel",U.text),w.E7m("matAutocomplete",G),w.yG2(),w.E7m("ngIf",(U.text||U.coordinates)&&X.stopWithHover&&U.id===X.stopWithHover.id),w.yG2(),w.E7m("displayWith",X.getOptionText),w.yG2(2),w.E7m("ngForOf",U.searchProposals),w.yG2(),w.E7m("ngIf",!X.stopIsDragged&&X.stopWithHover&&U.id===X.stopWithHover.id)}}let d=(()=>{class u{languageService;invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new w._w7(!1);constructor(U){this.languageService=U}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(U){this.stopWithHover=U}onStopLeave(){this.stopWithHover=void 0}getOptionText(U){return U instanceof Object?U?.meta?U.meta.title:"":U}chooseProposal(U,G){const X=U.option.value;if(X){let D;const I=X.geometry;if("Point"===I.type)D=I.coordinates;else{const M=(0,F.c)(X.geometry);D=[M.geometry.coordinates[0],M.geometry.coordinates[1]]}D&&(G.coordinates=D,G.text=X.meta.title,this.stopsStore.update(G))}}setStopText(U,G){this.unlistenMapSingleClick();const X=U.target.value;0===X.length?this.clearStop(G):this.validateTerm(X)&&(G.text=X,this.stopsStore.update(G))}validateTerm(U){return!(!this.keyIsValid(U)||!(U.length>=this.length||0===U.length))}keyIsValid(U){return void 0===this.invalidKeys.find(G=>G===U)}getNgClass(U){return this.stopWithHover&&U.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(U){let G="";return U.relativePosition?(U.relativePosition===W.mq.Intermediate&&(G=" #"+U.position),this.languageService.translate.instant("igo.geo.directionsForm."+U.relativePosition)+G):""}removeStop(U){(0,J.Wy)(this.stopsStore,U)}clearStop(U){this.stopsStore.update({id:U.id,relativePosition:U.relativePosition,position:U.position})}drop(U){this.moveStops(U.previousIndex,U.currentIndex)}moveStops(U,G){if(U!==G){const X=[...this.stopsStore.view.all()];(0,E.qv)(X,U,G),X.map((D,I)=>{D.relativePosition=(0,J.MG)(I,X.length),D.position=I}),this.stopsStore.updateMany(X),(0,J.GE)(this.stopsStore)}}onInputFocus(U){(!U.text||0===U.text?.length)&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(U))}listenMapSingleClick(U){const G=this.stopsFeatureStore.layer.map.ol.once("singleclick",X=>{const D=y.AF(X.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),I=(0,h.uE)(D,this.coordRoundedDecimals);U.text=I.join(","),U.coordinates=I,this.stopsStore.update(U),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(G)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(U=>{P.S(U)}),this.onMapClickEventKeys=[]}static \u0275fac=function(G){return new(G||u)(w.GI1(S.ov))};static \u0275cmp=w.In1({type:u,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},standalone:!0,features:[w.UHJ],decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["subscriptSizing","dynamic"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"]],template:function(G,X){1&G&&(w.I0R(0,"div",0),w.qCj("cdkDropListDropped",function(I){return X.drop(I)}),w.yuY(1,A,11,11,"div",1),w.wVc(2,"async"),w.C$Y()),2&G&&(w.yG2(),w.E7m("ngForOf",w.kDX(2,1,X.stopsStore.view.all$())))},dependencies:[E.Cm,a.Iw,E.w5,a.QF,R.wb,R.Up,R.w5,R.Gm,_.cN,_.yi,p.y,p.ot,p.ue,p._G,e.U1,e.e,o.I5,o.Ar,e.cG,C.KO,C.a4,a.u_,c.oJ,c.um,L.oB,L.qL,o.Ax,E.A3,a.a,S._s,Q.sD],styles:["[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:12px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden;padding:20px 10px}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:#fff}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}[_nghost-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return u})()},72184:(Pe,ae,r)=>{"use strict";r.d(ae,{c:()=>A});var E=r(65056),a=r(71904),w=r(46176),p=r(75180),e=r(50244),c=r(32328),o=r(63916),R=r(77872),L=r(20460),_=r(58264),C=r(12396),S=r(62808),P=r(80848),y=r(24112),F=r(68392),h=r(9452),W=r(49172),T=(r(19188),r(34896)),Q=r(72584);function z(d,u){if(1&d&&(T.I0R(0,"mat-option",9),T.OEk(1),T.C$Y()),2&d){const x=u.$implicit,U=u.index,G=T.GaO(3);T.E7m("value",x),T.yG2(),T.MjK(" Option ",U+1," : ",G.formatDistance(x.distance)," (",G.formatDuration(x.duration),") ")}}function Y(d,u){if(1&d){const x=T.KQA();T.I0R(0,"mat-form-field")(1,"mat-label"),T.OEk(2),T.wVc(3,"translate"),T.C$Y(),T.I0R(4,"mat-select",7),T.qCj("selectionChange",function(){T.usT(x);const G=T.GaO(2);return T.CGJ(G.changeRoute())}),T.iHE("ngModelChange",function(G){T.usT(x);const X=T.GaO(2);return T.kNx(X.activeDirection,G)||(X.activeDirection=G),T.CGJ(G)}),T.wVc(5,"translate"),T.yuY(6,z,2,4,"mat-option",8),T.C$Y()()}if(2&d){const x=T.GaO(2);T.yG2(2),T.cNF(T.kDX(3,4,"igo.geo.directionsForm.drivingOptions")),T.yG2(2),T._6D("placeholder",T.kDX(5,6,"igo.geo.directionsForm.drivingOptions")),T.OKB("ngModel",x.activeDirection),T.yG2(2),T.E7m("ngForOf",x.directions)}}function N(d,u){1&d&&T.wR5(0,"mat-divider")}function K(d,u){if(1&d){const x=T.KQA();T.I0R(0,"mat-list-item",10),T.qCj("mouseenter",function(){const X=T.usT(x).$implicit,D=T.GaO(2);return T.CGJ(D.showSegment(X))})("click",function(){const X=T.usT(x).$implicit,D=T.GaO(2);return T.CGJ(D.showSegment(X,!0))}),T.I0R(1,"mat-icon",11),T.OEk(2),T.C$Y(),T.I0R(3,"span",12),T.OEk(4),T.C$Y(),T.I0R(5,"span",13),T.OEk(6),T.C$Y()()}if(2&d){const x=u.$implicit,U=u.index,G=T.GaO(2);T.yG2(),T.E7m("ngClass",G.formatStep(x,U).cssClass),T.yG2(),T.oRS("",G.formatStep(x,U).image," "),T.yG2(2),T.CAO(" ",U+1,". ",G.formatStep(x,U).instruction," "),T.yG2(2),T.oRS(" ",G.formatDistance(x.distance)," ")}}function j(d,u){if(1&d){const x=T.KQA();T.I0R(0,"div",1),T.yuY(1,Y,7,8,"mat-form-field",2)(2,N,1,0,"mat-divider",2),T.I0R(3,"mat-list",3),T.qCj("mouseleave",function(){T.usT(x);const G=T.GaO();return T.CGJ(G.onStepsListBlur())}),T.I0R(4,"h2",4),T.OEk(5),T.C$Y(),T.I0R(6,"span",5),T.OEk(7),T.C$Y(),T.yuY(8,K,7,5,"mat-list-item",6),T.wR5(9,"mat-divider"),T.C$Y()()}if(2&d){const x=T.GaO();T.yG2(),T.E7m("ngIf",x.directions&&x.directions.length>1),T.yG2(),T.E7m("ngIf",x.directions&&0===x.directions.length),T.yG2(3),T.cNF(x.activeDirection.title),T.yG2(2),T.CAO(" ",x.formatDistance(x.activeDirection.distance),", ",x.formatDuration(x.activeDirection.duration)," "),T.yG2(),T.E7m("ngForOf",x.activeDirection.steps)}}let A=(()=>{class d{languageService;cdRef;activeDirection;directions;entities$$;routesFeatureStore;stepFeatureStore;constructor(x,U){this.languageService=x,this.cdRef=U}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,y.o)(200)).subscribe(x=>{const U=x.find(G=>G.properties.active);this.directions=x.map(G=>G.properties.direction),this.activeDirection=U?U.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(x=>x.properties.active=!x.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(x=>x.set("active",!x.get("active")))}formatDistance(x){return(0,W.YX)(x)}formatDuration(x){return(0,W.AD)(x)}formatStep(x,U){return(0,W.qe)(x.maneuver.type,x.maneuver.modifier,x.name,x.maneuver.bearing_after,U,x.maneuver.exit,this.languageService,U===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(x,U=!1){this.showRouteSegmentGeometry(x,U)}showRouteSegmentGeometry(x,U=!1){const X="vertex",s=new S.c(x.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],H=new P.c(s),Z=new _.c({geometry:H}),me=(new C.c).writeGeometryObject(H,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),_e=this.stepFeatureStore.get(X);this.stepFeatureStore.update({type:F.Y,geometry:me,projection:this.stepFeatureStore.layer.map.projection,properties:{id:X,step:x,type:h.SC.Vertex},meta:{id:X,revision:(_e?_e.meta.revision:0)+1},ol:Z}),U&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(Z.getGeometry().getExtent())}static \u0275fac=function(U){return new(U||d)(T.GI1(L.ov),T.GI1(T.kD9))};static \u0275cmp=T.In1({type:d,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[T.UHJ],decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title"],[1,"mat-caption"],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["matListItemIcon","",3,"ngClass"],[1,"igo-step-text"],["matListItemMeta",""]],template:function(U,G){1&U&&T.yuY(0,j,10,6,"div",0),2&U&&T.E7m("ngIf",G.directions&&G.activeDirection)},dependencies:[E.u_,e.wb,e.Up,e.w5,R.d5,R.kX,w.I5,a.y,a.ue,a._G,E.Iw,w.Ax,p.U,p.k,o.iI,o.oL,o.g9,o.Y1,o.At,c.oB,c.qL,E.QF,L._s,Q.sD],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer;padding:35px 0}.igo-steps[_ngcontent-%COMP%]   .igo-step-text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;white-space:pre-wrap}.mat-mdc-list-item[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]})}return d})()},96580:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>E});class E{}},62747:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>G});var E=r(65056),a=r(43424),w=r(87040),p=r(20460),e=r(64100),c=r(43168),o=r(96764),R=r(25696),L=r(98492),_=r(61252),C=r(61616),S=r(11484),P=r(24112),y=r(40604),F=r(20624),h=r(34080),W=r(93199),J=r(29216),T=r(69488),Q=r(8984),z=r(72184),Y=r(9452),N=r(40043),K=r(49172),A=(r(19188),r(34896)),d=r(33712),u=r(74180),x=r(72584);function U(X,D){if(1&X){const I=A.KQA();A.I0R(0,"mat-slide-toggle",1),A.qCj("change",function(s){A.usT(I);const H=A.GaO();return A.CGJ(H.onTogglePrivateModeControl(s.checked))}),A.OEk(1),A.wVc(2,"translate"),A.C$Y()}if(2&X){const I=A.GaO();A.E7m("checked",I.enabledProfileHasAuthorization)("labelPosition","before"),A.yG2(),A.oRS(" ",A.kDX(2,3,"igo.geo.directionsForm.toggleType")," ")}}let G=(()=>{class X{cdRef;http;languageService;directionsService;directionsSourceService;searchService;queryService;messageService;watcher;projection="EPSG:4326";hasOsrmPrivateAccess=!1;twoSourcesAvailable=!1;zoomRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];authenticated$$;contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomToActiveRoute$=new C.E;authenticated$;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}get enabledProfileHasAuthorization(){return this.directionsSourceService.sources[0].getEnabledProfile().authorization}constructor(I,M,s,H,Z,me,_e,de){this.cdRef=I,this.http=M,this.languageService=s,this.directionsService=H,this.directionsSourceService=Z,this.searchService=me,this.queryService=_e,this.messageService=de}ngOnInit(){this.authenticated$$=this.authenticated$.subscribe(I=>{if(I){const M=this.directionsSourceService.sources[0].getProfileWithAuthorization();M&&this.http.get(M.authorization.url).subscribe(s=>{this.hasOsrmPrivateAccess=s[M.authorization.property]})}}),this.twoSourcesAvailable=2===this.directionsSourceService.sources[0].profiles.length,this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(0,K.CM)(this.stopsFeatureStore,this.languageService),(0,K.MV)(this.routesFeatureStore,this.languageService),(0,K.sH)(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(I=>I.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.authenticated$$.unsubscribe(),this.freezeStores()}freezeStores(){this.interactions.map(I=>this.routesFeatureStore.layer.map.ol.removeInteraction(I)),this.stopsFeatureStore.deactivateStrategyOfType(F.E),this.routesFeatureStore.deactivateStrategyOfType(F.E),this.stepFeatureStore.deactivateStrategyOfType(F.E)}initEntityStores(){this.watcher=new w.YX(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const I=this.routesFeatureStore.all().find(M=>M.properties.active);if(I){I.ol.getGeometry();const M=I.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(M)}}})}initOlInteraction(){this.selectStopInteraction=new R.c({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:I=>"pointermove"===I.type&&!I.dragging}),this.translateStop=new L.c({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",I=>{this.isTranslating=!0,this.executeStopTranslation(I.features)}),this.translateStop.on("translateend",I=>{this.isTranslating=!1,this.executeStopTranslation(I.features)}),this.selectedRoute=new R.c({layers:[this.routesFeatureStore.layer.ol],condition:o.gx,hitTolerance:7,filter:I=>I.get("type")===Y.SC.Route&&I.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",I=>{if(!1===this.focusOnStop){const M=(0,h.uE)(_.AF(I.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),s=(0,K.um)(this.stopsStore);s.text=M.join(","),s.coordinates=[M[0],M[1]]}}),this.interactions.map(I=>this.routesFeatureStore.layer.map.ol.addInteraction(I))}onStopInputHasFocusChange(I){I?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(I){if(0===I.getLength())return;const M=I.getArray()[0],s=M.getId(),H=_.AF(M.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),Z=this.stopsStore.get(s),me=(0,h.uE)(H,this.coordRoundedDecimals);Z.coordinates=me,Z.text=me.join(","),this.stopsStore.update(Z)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,S.a)()).subscribe(I=>{if(I<2){if((0,K.um)(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(M=>M.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,P.o)(this.debounce)).subscribe(I=>{this.handleStopDiff(I),(0,K.GE)(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(I=>I.unsubscribe())}handleStopDiff(I){const M=I.map(Z=>c.Yv.removeUndefined({id:Z.id,text:Z.text,coordinates:Z.coordinates})),s=c.OI.findChanges(this.previousStops,M,["coordinates"]),H=s.added.concat(s.modified);H&&H.map(Z=>{const me=Z.newValue;if(me){const _e=this.stopsStore.get(me.id),de=_e.text;if(!de||0===de.length)return;const le=(0,h.Sc)(de,this.stopsFeatureStore.layer.map.projection);let ue,ne=!1;le.lonLat&&(ne=!0),ue=this.searchService.search(de,{searchType:"Feature"}),this.cancelSearch();const ve=ue.map(ye=>ye.request.pipe((0,y.k)(Le=>Le.filter(He=>ne?"Point"===He.data.geometry.type&&He.data.geometry:He.data.geometry))));this.searchs$$=ve.map(ye=>ye.pipe((0,y.k)(Le=>Le.filter(He=>ne?"Point"===He.data.geometry.type&&He.data.geometry:He.data.geometry))).subscribe(Le=>{if(Le.length>0){const He=Le[0].source,Ve=Le[0].meta,Ge=Le.map(Ie=>Ie.data);_e.searchProposals||(_e.searchProposals=[]),_e.searchProposals=_e.searchProposals.filter(Ie=>Ie.type===(ne?Y.S_.Coord:Y.S_.Text));let ct=_e.searchProposals.find(Ie=>Ie.source===He);ct?ct.results=Ge:_e.searchProposals.push({type:ne?Y.S_.Coord:Y.S_.Text,source:He,meta:Ve,results:Ge})}this.cdRef.detectChanges()}))}}),this.previousStops=M}handleStopsFeature(){const I=this.stopsStore.all();I.filter(H=>H.coordinates).map(H=>this.addStopOverlay(H)),this.stopsFeatureStore.all().map(H=>{this.stopsStore.get(H.properties.id)||this.stopsFeatureStore.delete(H)}),I.filter(H=>!H.coordinates).map(H=>{const Z=this.stopsFeatureStore.get(H.id);Z&&this.stopsFeatureStore.delete(Z)})}getRoutes(I=!1){const M=this.stopsStore.view.all().filter(me=>me.coordinates);if(M.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const s=M.map(me=>(0,h.uE)(me.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(me=>me.unsubscribe());const Z=this.directionsService.route(s,I?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);Z&&this.routesQueries$$.push(Z.subscribe(me=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),me.map(_e=>(0,K.S_)(this.routesFeatureStore,_e,this.projection,_e===me[0]))}))}addStopOverlay(I){(0,K.Mx)(I,this.stopsStore,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(I){this.queryService.queryEnabled=!I;const M=this.routesFeatureStore.layer.map.ol;this.interactions.map(s=>I?M.addInteraction(s):M.removeInteraction(s))}onTogglePrivateModeControl(I){this.directionsSourceService.sources[0].profiles.forEach(M=>M.enabled=!1),I?(this.directionsSourceService.sources[0].profiles.find(M=>M.authorization).enabled=!0,this.messageService.alert(this.languageService.translate.instant("igo.geo.directionsForm.forestRoadsWarning.text"),this.languageService.translate.instant("igo.geo.directionsForm.forestRoadsWarning.title"))):this.directionsSourceService.sources[0].profiles.find(M=>!M.authorization).enabled=!0,this.getRoutes()}static \u0275fac=function(M){return new(M||X)(A.GI1(A.kD9),A.GI1(d.KK),A.GI1(p.ov),A.GI1(N.W),A.GI1(u.W0),A.GI1(J._),A.GI1(W.E),A.GI1(e.mi))};static \u0275cmp=A.In1({type:X,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$",authenticated$:"authenticated$"},standalone:!0,features:[A.UHJ],decls:8,vars:19,consts:[[1,"directions-options"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"stepFeatureStore","contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(M,s){1&M&&(A.I0R(0,"div",0)(1,"mat-slide-toggle",1),A.qCj("change",function(Z){return s.onToggleDirectionsControl(Z.checked)}),A.OEk(2),A.wVc(3,"translate"),A.C$Y(),A.yuY(4,U,3,5,"mat-slide-toggle",2),A.C$Y(),A.wR5(5,"igo-directions-buttons",3),A.I0R(6,"igo-directions-inputs",4),A.qCj("stopInputHasFocus",function(Z){return s.onStopInputHasFocusChange(Z)}),A.C$Y(),A.wR5(7,"igo-directions-results",5)),2&M&&(A.yG2(),A.E7m("checked",s.directionControlIsActive)("labelPosition","before"),A.yG2(),A.oRS(" ",A.kDX(3,17,"igo.geo.directionsForm.toggleActive")," "),A.yG2(2),A.E7m("ngIf",s.hasOsrmPrivateAccess&&s.twoSourcesAvailable),A.yG2(),A.E7m("stepFeatureStore",s.stepFeatureStore)("contextUri",s.contextUri)("zoomToActiveRoute$",s.zoomToActiveRoute$)("routesFeatureStore",s.routesFeatureStore)("stopsStore",s.stopsStore),A.yG2(),A.E7m("coordRoundedDecimals",s.coordRoundedDecimals)("projection",s.projection)("stopsFeatureStore",s.stopsFeatureStore)("stopsStore",s.stopsStore)("debounce",s.debounce)("length",s.length),A.yG2(),A.E7m("stepFeatureStore",s.stepFeatureStore)("routesFeatureStore",s.routesFeatureStore))},dependencies:[E.MD,E.u_,a.GE,a.cP,T.k,Q.k,z.c,p._s,x.sD],styles:[".directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return X})()},74180:(Pe,ae,r)=>{"use strict";r.d(ae,{W0:()=>a,c9:()=>p});var E=r(96580);class a{sources;constructor(c){this.sources=c}}function w(e){return new a(e)}function p(){return{provide:a,useFactory:w,deps:[E.U]}}},9452:(Pe,ae,r)=>{"use strict";r.d(ae,{SC:()=>p,S_:()=>w,Yn:()=>E,g1:()=>a,mq:()=>e});var E=function(c){return c[c.GeoJSON=0]="GeoJSON",c[c.JSON=1]="JSON",c}(E||{}),a=function(c){return c.Route="route",c.Trip="trip",c}(a||{}),w=function(c){return c.Coord="coord",c.Text="text",c}(w||{}),p=function(c){return c.Stop="stop",c.Route="route",c.Vertex="vertex",c}(p||{}),e=function(c){return c.Start="start",c.Intermediate="intermediate",c.End="end",c}(e||{})},40043:(Pe,ae,r)=>{"use strict";r.d(ae,{W:()=>Q});var E=r(35392),a=r(65056),w=r(24956),p=r(45872),e=r(20460),c=r(43168),o=r(96116),R=r.n(o),L=r(864),S=(r(32256),r(30816)),P=r.n(S),y=r(61616),F=r(29272),h=r(47580),W=r(49172),J=r(34896),T=r(74180);let Q=(()=>{class z{directionsSourceService;configService;languageService;printService;document;activityService;constructor(N,K,j,A,d,u){this.directionsSourceService=N,this.configService=K,this.languageService=j,this.printService=A,this.document=d,this.activityService=u}route(N,K={}){if(0!==N.length)return this.routeSource(this.directionsSourceService.sources[0],N,K)}routeSource(N,K,j={}){return N.route(K,j)}downloadDirection(N,K){var j=this;const A=this.activityService.register(),d=new y.E,u=new L.default({orientation:"p",format:"Letter",unit:"mm"}),{width:x,height:U}=u.internal.pageSize,G=[20,10,20,10],I=[x-G[3]-G[1],U-G[0]-G[2]],M=`${K.title} (${(0,W.YX)(K.distance)}, ${(0,W.AD)(K.duration)})`;return u.text(M,u.internal.pageSize.width/2,25,{align:"center"}),this.printService.addMap(u,N,96,I,G,h.ID.none).subscribe(function(){var Z=(0,E.c)(function*(me){me===c.qM.Done&&(yield j.addInstructions(u,K,M),j.setPageHeaderFooter(u),yield u.save(`${M}.pdf`,{returnPromise:!0})),j.activityService.unregister(A),d.next(me)});return function(me){return Z.apply(this,arguments)}}()),d}setHTMLTableContent(N){var K=this;return(0,E.c)(function*(){const j=yield K.directionsInstruction(N),A=document.createElement("table"),d=document.createElement("tbody");for(let G=0;G<j.length;G++){const X=j[G];var u=document.createElement("tr"),x=document.createElement("td"),U=document.createElement("td");const D=document.createElement("img");D.src=X.icon;const I=document.createElement("span");if(I.innerHTML=X.instruction,x.appendChild(D),U.appendChild(I),X.distance){const M=document.createElement("span");M.style.verticalAlign="middle",M.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+X.distance,U.appendChild(M)}u.append(x),u.append(U),d.appendChild(u)}return A.appendChild(d),A})()}directionsInstruction(N){var K=this;return(0,E.c)(function*(){const A=K.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item");let d=[];for(let x=0;x<A.length;x++){const G=A[x].getElementsByTagName("mat-icon")[0],X=G.getAttribute("data-mat-icon-name");if(!d.some(I=>I.name===X)){const I=yield R()(G,{scale:3});d.push({name:X,icon:I.toDataURL()})}}let u=[];for(let x=0;x<N.steps.length;x++){const U=N.steps[x],G=(0,W.qe)(U.maneuver.type,U.maneuver.modifier,U.name,U.maneuver.bearing_after,x,U.maneuver.exit,K.languageService,x===N.steps.length-1),X=(0,W.YX)(U.distance);u.push({instruction:x+1+". "+G.instruction,icon:d.find(D=>D.name===G.image).icon,distance:X?"("+X+")":void 0})}return u})()}addInstructions(N,K,j){var A=this;return(0,E.c)(function*(){N.addPage(),N.text(j,N.internal.pageSize.width/2,25,{align:"center"});const u=yield A.setHTMLTableContent(K);N.autoTable({html:u,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:12},didDrawCell:function(U){if(0===U.column.index&&"body"===U.cell.section){U.row.height=10;const X=U.cell.raw.getElementsByTagName("img")[0];N.addImage(X.src,U.cell.x,U.cell.y,8,8)}}})})()}setPageHeaderFooter(N){const K=N.getNumberOfPages(),j=P()(Date.now()).format("DD/MM/YYYY hh:mm").toString(),d=this.configService.getConfig("directionsSources.logo")||"assets/logo.png";for(let u=0;u<K;u++){N.setPage(u),N.setFontSize(8);const x=N.internal.pageSize,U=x.height?x.height:x.getHeight(),G=x.width?x.width:x.getWidth();N.text(j,10,10,{baseline:"top"}),N.addImage(d,"PNG",G-20,5,10,10),N.text(j,10,U-10),N.text("Page "+N.getCurrentPageInfo().pageNumber+" / "+K,G-20,U-10)}}static \u0275fac=function(K){return new(K||z)(J.CoB(T.W0),J.CoB(p.aW),J.CoB(e.ov),J.CoB(F.K),J.CoB(a.Ud),J.CoB(w.U9))};static \u0275prov=J.wxM({token:z,factory:z.\u0275fac})}return z})()},49172:(Pe,ae,r)=>{"use strict";r.d(ae,{AD:()=>U,CM:()=>K,GE:()=>J,MG:()=>T,MV:()=>j,Mx:()=>d,S_:()=>u,Wy:()=>Y,YX:()=>x,qe:()=>G,sH:()=>A,um:()=>z});var E=r(43168),a=r(58264),w=r(12396),p=r(80848),e=r(62808),c=r(61252),o=r(54776),R=r(87544),L=r(45212),_=r(90112),C=r(70524),S=r(68392),P=r(64096),y=r(20624),F=r(2892),h=r(47572),W=r(9452);function J(I,M="asc",s="position"){I.view.sort({direction:M,valueAccessor:H=>H[s]})}function T(I,M){let s=W.mq.Intermediate;return 0===I?s=W.mq.Start:I===M-1&&(s=W.mq.End),s}function z(I){const M=(0,E.uq)(),s=I.all();let H;H=0===I.count?[0]:s.map(le=>le.position);const Z=Math.max(...H),me=Z,_e=Z+1,de=I.all().find(le=>le.position===Z);return de&&(de.position=_e,de.relativePosition=T(_e,I.count+1)),I.insert({id:M,position:me,relativePosition:T(me,I.count+1)}),J(I),I.get(M)}function Y(I,M){I.delete(M),function Q(I){const M=[...I.all()];M.sort((s,H)=>s.position-H.position),M.map((s,H)=>{s.position=H,s.relativePosition=T(s.position,M.length)}),M&&I.updateMany(M)}(I)}function N(I,M){const s=[new o.cp({geometry:I.getGeometry(),image:new R.c({radius:7,stroke:new L.c({color:"#FF0000",width:3})})})],H=(0,h.o)({text:I.get("stopText"),opacity:I.get("stopOpacity"),markerColor:I.get("stopColor"),markerOutlineColor:[255,255,255]}),Z=[new o.cp({stroke:new L.c({color:`rgba(106, 121, 130, ${I.get("active")?.75:0})`,width:10})}),new o.cp({stroke:new L.c({color:`rgba(79, 169, 221, ${I.get("active")?.75:0})`,width:6})})];return I.get("type")===W.SC.Stop?H:"vertex"===I.get("type")?s:I.get("type")===W.SC.Route?Z:void 0}function K(I,M){const s=new y.E({motion:S.S.None}),H=new F.M({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:M.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new _.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:N});(0,C.m)(I,H),I.layer.visible=!0,(0,P.s)(I,s)}function j(I,M){const s=new y.E({motion:S.S.None}),H=new F.M({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:M.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new _.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:N});(0,C.m)(I,H),I.layer.visible=!0,(0,P.s)(I,s)}function A(I){const M=new y.E({motion:S.S.None}),s=new F.M({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new _.E,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:N});(0,C.m)(I,s),I.layer.visible=!0,(0,P.s)(I,M)}function d(I,M,s,H,Z){let me,_e;switch(I.relativePosition){case W.mq.Start:me="#008000",_e=Z.translate.instant("igo.geo.directionsForm.start");break;case W.mq.End:me="#f64139",_e=Z.translate.instant("igo.geo.directionsForm.end");break;default:me="#ffd700",_e=Z.translate.instant("igo.geo.directionsForm.intermediate")+" #"+I.position}const de=new p.c(c.AF(I.coordinates,H,s.map.projection)),le=(new w.c).writeGeometryObject(de,{featureProjection:s.map.projection,dataProjection:s.map.projection}),ue=s.get(I.id),ve={type:S.Y,geometry:le,projection:s.map.projection,properties:{id:I.id,type:W.SC.Stop,stopText:_e,stopColor:me,stopOpacity:1,stop:I},meta:{id:I.id,revision:(ue?ue.meta.revision:0)+1},ol:new a.c({geometry:de})};s.update(ve)}function u(I,M,s,H=!1,Z=!1){const de=new e.c(M.geometry.coordinates).transform(s,I.map.projection),le=(new w.c).writeGeometryObject(de,{featureProjection:I.map.projection,dataProjection:I.map.projection}),ue=I.get(M.id),ve={type:S.Y,geometry:le,projection:I.map.projection,properties:{id:M.id,type:W.SC.Route,active:H,direction:M},meta:{id:M.id,revision:(ue?ue.meta.revision:0)+1},ol:new a.c({geometry:de})};I.update(ve)}function x(I){if(0!==I)return I>=1e5?E.UD.roundToNDecimal(Math.round(I)/1e3,1)+" km":I>=1e4||I>=1e3?E.UD.roundToNDecimal(Math.round(I)/100/10,1)+" km":E.UD.roundToNDecimal(I,0)+" m"}function U(I){if(I>=3600){const M=Math.floor(I/3600),s=Math.round(60*(I/3600-M));return 60===s?M+1+" h":M+" h "+s+" min"}return I>=60?Math.round(I/60)+" min":I+" s"}function G(I,M,s="Voie",H,Z,me,_e,de=!1){const le=_e.translate;let ue,ne="arrow_forward",ve="rotate-270";const ye=function D(I,M){const s=M.translate;return I>=337||I<23?s.instant("igo.geo.cardinalPoints.n"):I<67?s.instant("igo.geo.cardinalPoints.ne"):I<113?s.instant("igo.geo.cardinalPoints.e"):I<157?s.instant("igo.geo.cardinalPoints.se"):I<203?s.instant("igo.geo.cardinalPoints.s"):I<247?s.instant("igo.geo.cardinalPoints.sw"):I<293?s.instant("igo.geo.cardinalPoints.w"):I<337?s.instant("igo.geo.cardinalPoints.nw"):void 0}(H,_e),Le=function X(I,M){const s=M.translate;return"uturn"===I?s.instant("igo.geo.directions.uturn"):"sharp right"===I?s.instant("igo.geo.directions.sharp right"):"right"===I?s.instant("igo.geo.directions.right"):"slight right"===I?s.instant("igo.geo.directions.slight right"):"sharp left"===I?M.translate.instant("igo.geo.directions.sharp left"):"left"===I?M.translate.instant("igo.geo.directions.left"):"slight left"===I?M.translate.instant("igo.geo.directions.slight left"):"straight"===I?M.translate.instant("igo.geo.directions.straight"):I}(M,_e);let Ve=("straight"===M?"":le.instant("igo.geo.directions.modifier.prefix"))+Le;if(M?.search("slight")>=0&&(Ve=Le),"uturn"===M?(ne="arrow_forward",ve="rotate-90"):"sharp right"===M||"right"===M?(ne="subdirectory_arrow_right",ve="icon-flipped"):"slight right"===M?(ne="arrow_forward",ve="rotate-290"):"straight"===M?ne="arrow_forward":"slight left"===M?(ne="arrow_forward",ve="rotate-250"):("left"===M||"sharp left"===M)&&(ne="subdirectory_arrow_left",ve="icon-flipped"),"turn"===I)ue="straight"===M?le.instant("igo.geo.directions.turn.straight",{route:s}):"uturn"===M?le.instant("igo.geo.directions.turn.uturn",{route:s}):le.instant("igo.geo.directions.turn.else",{route:s,aggregatedDirection:Ve,translatedModifier:Le});else if("new name"===I)ue=le.instant("igo.geo.directions.new name",{route:s,translatedDirection:ye}),ne="explore",ve="";else if("depart"===I)ue=le.instant("igo.geo.directions.depart",{route:s,translatedDirection:ye}),ne="explore",ve="";else if("arrive"===I)de?(Ve=Le?Ve:"",ue=le.instant("igo.geo.directions.arrive.lastStep",{coma:Le?", ":"",aggregatedDirection:Ve})):(ue=le.instant("igo.geo.directions.arrive.intermediate",{route:s}),ne="location_on",ve="");else if("merge"===I)ue=le.instant("igo.geo.directions.merge",{route:s}),ne="arrow_forward",ve="rotate-270";else if("on ramp"===I)ue=le.instant("igo.geo.directions.on ramp",{aggregatedDirection:Ve});else if("off ramp"===I)ue=le.instant("igo.geo.directions.off ramp",{aggregatedDirection:Ve});else if("fork"===I)ue=M.search("left")>=0?le.instant("igo.geo.directions.fork.left",{route:s}):M.search("right")>=0?le.instant("igo.geo.directions.fork.right",{route:s}):le.instant("igo.geo.directions.fork.else",{route:s});else if("end of road"===I)ue=le.instant("igo.geo.directions.end of road",{translatedModifier:Le,route:s});else if("use lane"===I)ue=le.instant("igo.geo.directions.use lane");else if("continue"===I&&"uturn"!==M)ue=le.instant("igo.geo.directions.continue.notUturn",{route:s}),ne="arrow_forward",ve="rotate-270";else if("roundabout"===I){const Ge=le.instant(1===me?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");ue=le.instant("igo.geo.directions.roundabout",{exit:me,cntSuffix:Ge,route:s}),ne="donut_large",ve=""}else"rotary"===I?(ue=le.instant("igo.geo.directions.rotary"),ne="donut_large",ve=""):"roundabout turn"===I?(ue=le.instant("igo.geo.directions.roundabout turn"),ne="donut_large",ve=""):"exit roundabout"===I?(ue=le.instant("igo.geo.directions.exit roundabout",{route:s}),ne="arrow_forward",ve="rotate-270"):ue="notification"===I?le.instant("igo.geo.directions.notification"):"uturn"===M?le.instant("igo.geo.directions.uturnText",{translatedDirection:ye,route:s}):le.instant("igo.geo.directions.unknown");return ne=de?"flag":ne,ve=de?"":ve,ne=0===Z?"explore":ne,ve=0===Z?"":ve,{instruction:ue,image:ne,cssClass:ve}}},72156:(Pe,ae,r)=>{"use strict";r.d(ae,{SY:()=>p.SY,WI:()=>E.W,aW:()=>p.aW,cz:()=>p.cz,qM:()=>p.qM});var E=r(40043),p=(r(9452),r(49172),r(19188))},19188:(Pe,ae,r)=>{"use strict";r.d(ae,{SY:()=>p,aW:()=>c,cz:()=>e,qM:()=>o});var E=r(87040),a=r(54844),w=r(40240);class p extends E.qc{storeInitialized$=new a.g(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}}class e extends w.y{}class c extends w.y{}class o extends w.y{}},28616:(Pe,ae,r)=>{"use strict";r.d(ae,{w:()=>U});var E=r(65056),a=r(34896),w=r(32328),p=r(87040),e=r(75684),c=r(45872),o=r(20460),R=r(64100),L=r(49112),_=r(43168),C=r(61616),S=r(94364),F=(r(89500),r(78168),r(33712)),h=r(50168),W=r(72584);function J(G,X){if(1&G&&(a.I0R(0,"td")(1,"mat-icon",7),a.OEk(2),a.C$Y()()),2&G){const D=a.GaO(3);a.yG2(2),a.cNF(D.icon)}}function T(G,X){if(1&G){const D=a.KQA();a.I0R(0,"td")(1,"a",8),a.OEk(2),a.wVc(3,"translate"),a.C$Y(),a.I0R(4,"button",9),a.qCj("click",function(){a.usT(D);const M=a.GaO().$implicit,s=a.GaO(2);return a.CGJ(s.copyTextToClipboard(M.value))}),a.I0R(5,"mat-icon"),a.OEk(6,"content_copy"),a.C$Y()()()}if(2&G){const D=a.GaO().$implicit,I=a.GaO(2);a.yG2(),a._6D("href",D.value,a.K6U),a.yG2(),a.CAO(" ",a.kDX(3,3,"igo.geo.targetHtmlUrl")," ",I.title,"")}}function Q(G,X){if(1&G&&(a.I0R(0,"td",10),a.OEk(1),a.C$Y()),2&G){const D=a.GaO().$implicit;a.yG2(),a.oRS(" ",D.key," ")}}function z(G,X){if(1&G&&a.wR5(0,"td",11),2&G){const D=a.GaO().$implicit;a.E7m("innerHTML",D.value,a.E3n)}}const Y=()=>({cursor:"pointer",color:"blue"});function N(G,X){if(1&G){const D=a.KQA();a.I0R(0,"td")(1,"u",12),a.qCj("click",function(){a.usT(D);const M=a.GaO().$implicit,s=a.GaO(2);return a.CGJ(s.openSecureUrl(M.value))}),a.OEk(2),a.C$Y()()}if(2&G){const D=a.GaO().$implicit,I=a.GaO(2);a.yG2(),a.E7m("ngStyle",a.q4q(2,Y)),a.yG2(),a.cNF(I.getEmbeddedLinkText(D.value))}}function K(G,X){if(1&G){const D=a.KQA();a.I0R(0,"td")(1,"u",12),a.qCj("click",function(){a.usT(D);const M=a.GaO().$implicit,s=a.GaO(2);return a.CGJ(s.openSecureUrl(M.value))}),a.OEk(2),a.wVc(3,"translate"),a.C$Y(),a.I0R(4,"button",9),a.qCj("click",function(){a.usT(D);const M=a.GaO().$implicit,s=a.GaO(2);return a.CGJ(s.copyTextToClipboard(M.value))}),a.I0R(5,"mat-icon"),a.OEk(6,"content_copy"),a.C$Y()()()}2&G&&(a.yG2(),a.E7m("ngStyle",a.q4q(4,Y)),a.yG2(),a.cNF(a.kDX(3,2,"igo.geo.targetHtmlUrl")))}function j(G,X){if(1&G){const D=a.KQA();a.I0R(0,"td")(1,"a",13),a.qCj("click",function(){a.usT(D);const M=a.GaO().$implicit,s=a.GaO(2);return a.CGJ(s.openSecureUrl(M.value))}),a.wR5(2,"img",14),a.wVc(3,"async"),a.wVc(4,"secureImage"),a.C$Y()()}if(2&G){const D=a.GaO().$implicit;a.yG2(),a._6D("href",D.value,a.K6U),a.yG2(),a._6D("src",a.kDX(3,2,a.kDX(4,4,D.value)),a.K6U)}}function A(G,X){if(1&G&&(a.wR5(0,"td",11),a.wVc(1,"json")),2&G){const D=a.GaO().$implicit;a.E7m("innerHTML",a.kDX(1,1,D.value),a.E3n)}}function d(G,X){if(1&G&&(a.I0R(0,"tr"),a.yuY(1,J,3,1,"td",4)(2,T,7,5,"td",4)(3,Q,2,1,"td",5)(4,z,1,1,"td",6)(5,N,3,3,"td",4)(6,K,7,5,"td",4)(7,j,5,6,"td",4)(8,A,2,3,"td",6),a.C$Y()),2&G){const D=X.$implicit,I=a.GaO(2);a.yG2(),a.E7m("ngIf","_blank"===I.feature.properties.target&&"url"===D.key),a.yG2(),a.E7m("ngIf","_blank"===I.feature.properties.target&&"url"===D.key),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target&&!I.isObject(D.value)&&!I.isUrl(D.value)&&!I.isEmbeddedLink(D.value)),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target&&I.isEmbeddedLink(D.value)),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target&&!I.isObject(D.value)&&(I.isDoc(D.value)||I.isUrl(D.value))&&!I.isImg(D.value)),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target&&!I.isObject(D.value)&&I.isUrl(D.value)&&I.isImg(D.value)),a.yG2(),a.E7m("ngIf",void 0===I.feature.properties.target&&I.isObject(D.value))}}function u(G,X){if(1&G&&(a.I0R(0,"table",2)(1,"tbody"),a.yuY(2,d,9,8,"tr",3),a.wVc(3,"keyvalue"),a.C$Y()()),2&G){const D=a.GaO();a.yG2(2),a.E7m("ngForOf",a.kDX(3,1,D.filterFeatureProperties(D.feature)))}}function x(G,X){if(1&G&&a.wR5(0,"iframe",15),2&G){const D=a.GaO();a.E7m("srcdoc",D.htmlSanitizer(D.feature.properties),a.E3n)("src",D.urlSanitizer(D.feature.properties.url),a.CaN)}}let U=(()=>{class G{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new C.E;ready=!1;get source(){return this._source}set source(D){this._source=D,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(D){this._feature=D,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new a._w7;selectFeature=new a._w7;htmlDisplayEvent=new a._w7;get title(){return(0,p.YB)(this.feature)}get icon(){return(0,p.sH)(this.feature)||"link"}constructor(D,I,M,s,H,Z){this.http=D,this.cdRef=I,this.sanitizer=M,this.networkService=s,this.messageService=H,this.configService=Z,this.networkService.currentState().pipe((0,S.a)(this.unsubscribe$)).subscribe(me=>{this.state=me})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(D){return this.sanitizer.bypassSecurityTrustResourceUrl(D)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(D){if(D.body){if(!/<base href="[\w:\/\.]+">/.test(D.body)){const M=new URL(D.url,window.location.origin);D.body=D.body.replace("<head>",`<head><base href="${M.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(D.body)}}isObject(D){return"object"==typeof D}openSecureUrl(D){let I;const M=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');if(M.test(D))I=D.match(M)[0],this.http.get(I,{responseType:"blob"}).subscribe(H=>{const Z=URL.createObjectURL(H);window.open(Z,"_blank"),this.cdRef.detectChanges()},H=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let H=D;if(this.isEmbeddedLink(D)){var s=document.createElement("div");s.innerHTML=D,H=s.children[0].getAttribute("href")}window.open(H,"_blank")}}isUrl(D){if("string"==typeof D)return/^https?:\/\//.test(D)}isDoc(D){if("string"==typeof D)return!!this.isUrl(D)&&/(pdf|docx?|xlsx?)$/.test(D.toLowerCase())}isImg(D){if("string"==typeof D)return!!this.isUrl(D)&&/(jpe?g|png|gif)$/.test(D.toLowerCase())}isEmbeddedLink(D){return"string"==typeof D&&1===(D.match(/<a/g)||[]).length}getEmbeddedLinkText(D){let M=D.match(/(?:>).*?(?=<|$)/)[0];return M=M.replace(/>/g,""),M}filterFeatureProperties(D){const I=D.meta?D.meta.alias:void 0,M={};let s;return this.map&&this.map.forcedOffline$.pipe((0,S.a)(this.unsubscribe$)).subscribe(H=>{s=H}),D.properties&&D.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete D.properties.Route,I?(Object.keys(I).forEach(H=>{M[I[H]]=D.properties[H]}),M):(void 0!==s&&s?D.meta&&D.meta.excludeAttributeOffline&&D.meta.excludeAttributeOffline.forEach(Z=>{delete D.properties[Z]}):this.state.connection&&D.meta&&D.meta.excludeAttribute?D.meta.excludeAttribute.forEach(Z=>{delete D.properties[Z]}):!this.state.connection&&D.meta&&D.meta.excludeAttributeOffline&&D.meta.excludeAttributeOffline.forEach(Z=>{delete D.properties[Z]}),D.properties)}copyTextToClipboard(D){_._D.copy(D)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(I){return new(I||G)(a.GI1(F.KK),a.GI1(a.kD9),a.GI1(h.mI),a.GI1(L.u),a.GI1(R.mi),a.GI1(c.aW))};static \u0275cmp=a.In1({type:G,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},standalone:!0,features:[a.UHJ],decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon",""],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(I,M){1&I&&a.yuY(0,u,4,3,"table",0)(1,x,1,2,"iframe",1),2&I&&(a.E7m("ngIf",M.ready&&M.feature&&M.isObject(M.feature.properties)&&"iframe"!==M.feature.properties.target),a.yG2(),a.E7m("ngIf",M.isHtmlDisplay()))},dependencies:[E.u_,E.Iw,w.oB,w.qL,E.Qt,e.MJ,E.a,E.ED,E.uq,o._s,W.sD,e.kd],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0})}return G})()},86464:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>p});var E=r(34896),a=r(54844),w=r(28616);let p=(()=>{class e{el;component;get feature(){return this.component.feature}feature$=new a.g(void 0);routingEvent=new E._w7;setFeature(){this.feature$.next(this.feature)}constructor(o,R){this.el=R,this.component=o}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{const o=this.el.nativeElement.querySelector("span.routing");o&&o.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(R){return new(R||e)(E.GI1(w.w,2),E.GI1(E.GMv))};static \u0275dir=E.Sc5({type:e,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(R,L){1&R&&E.qCj("selectFeature",function(){return L.setFeature()})},outputs:{routingEvent:"routingEvent"},standalone:!0})}return e})()},40956:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>w});var E=r(28616),a=r(86464);const w=[E.w,a.U]},5100:(Pe,ae,r)=>{"use strict";r.d(ae,{U9:()=>E.U,wP:()=>a.w});var E=r(40956),a=r(28616);r(86464)},72432:(Pe,ae,r)=>{"use strict";r.d(ae,{Y:()=>C});var E=r(65056),a=r(34896),w=r(87040),p=r(56520),e=r(43168),c=r(54844),o=r(68392);const R=["igoForm"],L=["*",[["","formButtons",""]]],_=["*","[formButtons]"];let C=(()=>{class S{form;set feature(y){this.feature$.next(y)}get feature(){return this.feature$.value}feature$=new c.g(void 0);submitForm=new a._w7;igoForm;constructor(){}onSubmit(y){const F=this.formDataToFeature(y);this.submitForm.emit(F)}getData(){return this.formDataToFeature(this.igoForm.getData())}formDataToFeature(y){const F={},h={};void 0===this.feature?h.id=(0,e.uq)():(Object.assign(F,this.feature.properties),Object.assign(h,this.feature.meta,{revision:(0,w.mU)(this.feature)+1}));Object.entries(y).forEach(T=>{const[Q,z]=T;if(Q.startsWith("properties.")){const Y=Q.substr(11);F[Y]=z}});let J=y.geometry;return void 0===J&&void 0!==this.feature&&(J=this.feature.geometry),{meta:h,type:o.Y,geometry:J,projection:"EPSG:4326",properties:F}}static \u0275fac=function(F){return new(F||S)};static \u0275cmp=a.In1({type:S,selectors:[["igo-feature-form"]],viewQuery:function(F,h){if(1&F&&a.CC$(R,7),2&F){let W;a.wto(W=a.Gqi())&&(h.igoForm=W.first)}},inputs:{form:"form",feature:"feature"},outputs:{submitForm:"submitForm"},standalone:!0,features:[a.UHJ],ngContentSelectors:_,decls:5,vars:4,consts:[[3,"form","formData","submitForm"],["igoForm",""]],template:function(F,h){1&F&&(a.kPM(L),a.I0R(0,"igo-form",0,1),a.qCj("submitForm",function(J){return h.onSubmit(J)}),a.wVc(2,"async"),a._Xx(3),a._Xx(4,1,["formButtons",""]),a.C$Y()),2&F&&a.E7m("form",h.form)("formData",a.kDX(2,2,h.feature$))},dependencies:[p.Yl,E.a],styles:["[_nghost-%COMP%]{display:block}igo-form[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return S})()},7284:(Pe,ae,r)=>{"use strict";r(5100),r(72432);r(28616),r(86464)},76200:(Pe,ae,r)=>{"use strict";r.d(ae,{E9:()=>E.E9,K6:()=>E.K6,Ki:()=>E.Ki,QX:()=>E.QX,Su:()=>E.Su,Uz:()=>E.Uz,Yf:()=>E.Yf,Yv:()=>E.Yv,kj:()=>E.kj,mM:()=>E.mM,q1:()=>E.q1,qK:()=>E.qK,sf:()=>E.sf,wP:()=>w.wP,ym:()=>E.ym});var E=r(76572),w=(r(7284),r(5100));r(72432)},70524:(Pe,ae,r)=>{"use strict";r.d(ae,{m:()=>w});var E=r(3544),a=r(2892);function w(p,e){void 0===p.layer?(e=e||new a.M({source:new E.EB}),p.bindLayer(e),void 0===p.layer.map&&p.map.addLayer(p.layer)):void 0===p.layer.map&&p.map.addLayer(p.layer)}},68392:(Pe,ae,r)=>{"use strict";r.d(ae,{S:()=>a,Y:()=>E});const E="Feature";var a=function(w){return w[w.None=0]="None",w[w.Move=1]="Move",w[w.Zoom=2]="Zoom",w[w.Default=3]="Default",w}(a||{})},14672:(Pe,ae,r)=>{"use strict";r.d(ae,{In:()=>S,K6:()=>C,Ki:()=>W,QX:()=>T,Wg:()=>z,Yv:()=>J,gV:()=>Q,q1:()=>F,qK:()=>P});var E=r(87040),a=r(43168),w=r(94448),p=r(12396),e=r(62808),c=r(80848),o=r(36752),R=r(61252),L=r(54776),_=r(68392);function C(Y,N,K){K=K||E._I;const A=(new p.c).readFeature(Y,{dataProjection:Y.projection,featureProjection:N});A.setId(K(Y));const d=(0,E.YB)(Y);void 0!==d&&A.set("_title",d,!0),void 0!==Y.extent&&A.set("_extent",Y.extent,!0),void 0!==Y.projection&&A.set("_projection",Y.projection,!0);const u=(0,E.u6)(Y,"meta.mapTitle");void 0!==u&&A.set("_mapTitle",u,!0),A.set("_entityRevision",(0,E.mU)(Y),!0);const x=(0,E.sH)(Y);return void 0!==x&&A.set("_icon",x,!0),Y.meta&&Y.meta.style&&A.set("_style",Y.meta.style,!0),Y.sourceId&&A.set("_sourceId",Y.sourceId,!0),A}function S(Y,N,K,j="EPSG:4326"){let A,d,u,x;K?(d=K.get("title"),K.get("sourceOptions")&&(u=K.get("sourceOptions").excludeAttribute,x=K.get("sourceOptions").excludeAttributeOffline)):d=Y.get("_title");const U=new p.c,G=Y.getProperties(),X=Y.getType();if("Polygon"===X){const H=Y.getEnds();A=new o.cp(Y.getFlatCoordinates(),"XY",H)}else"Point"===X?A=new c.c(Y.getFlatCoordinates(),"XY"):"LineString"===X&&(A=new e.c(Y.getFlatCoordinates(),"XY"));const D=U.writeGeometryObject(A,{dataProjection:j,featureProjection:N}),I=Y.getId()?Y.getId():(0,a.uq)(),M=Y.get("_mapTitle"),s=R.W0(Y.getExtent(),N,j);return{type:_.Y,projection:j,extent:s,meta:{id:I,title:d||M||I,mapTitle:M,excludeAttribute:u,excludeAttributeOffline:x},properties:G,geometry:D,ol:Y}}function P(Y,N,K,j="EPSG:4326"){let A,d,u,x;const U=new p.c,X=Y.getKeys().filter(H=>!H.startsWith("_")&&"geometry"!==H).reduce((H,Z)=>(H[Z]=Y.get(Z),H),{}),D=U.writeGeometryObject(Y.getGeometry(),{dataProjection:j,featureProjection:N});if(K){A=K.get("title");const H=K.get("sourceOptions");H&&(d=H.excludeAttribute,u=H.excludeAttributeOffline,x=H.idColumn||("arcgisrest"===H.type||"tilearcgisrest"===H.type?"OBJECTID":void 0))}else A=Y.get("_title");const I=Y.get("_mapTitle"),M=Y.getId()?Y.getId():Y.get(x)?Y.get(x):(0,a.uq)();return Y.get("_newFeature"),{type:_.Y,projection:j,extent:Y.get("_extent"),meta:{id:M,title:A||I||M,mapTitle:I,revision:Y.getRevision(),style:Y.get("_style"),excludeAttribute:d,excludeAttributeOffline:u},properties:X,geometry:D,ol:Y}}function F(Y,N){const K=w.Gu();return Y.forEach(j=>{const A=function y(Y,N){let K=w.Gu();const j=Y.get("_extent"),A=Y.get("_projection");if(void 0!==j&&void 0!==A)K=R.W0(j,A,N);else{const d=Y.getGeometry();null!==d&&(K=d.getExtent())}return K}(j,N);w.SU(K,A)}),K}function h(Y,N){const[K,j]=w.iK(Y);return[N[3]?Y[0]-K*N[3]:Y[0],N[2]?Y[1]-j*N[2]:Y[1],N[1]?Y[2]+K*N[1]:Y[2],N[0]?Y[3]+j*N[0]:Y[3]]}function W(Y,N,K=.05){const j=Array.isArray(K)?K:[K,K,K,K],d=h(Y,[-1,-1,-1,-1].map((u,x)=>u*j[x]));return!w.cP(d,N)}function J(Y,N,K){K=K||.004;const j=Y.getExtent(),A=w.kh(j),d=w.kh(N);return!(0===d&&Y.getZoom()>13)&&d/A<K}function T(Y,N,K=_.S.Default,j,A){const d=Y.getExtent(),x=F(N,Y.getOlProjection());let U=x;void 0!==j&&(U=h(U,j)),K===_.S.Zoom?Y.zoomToExtent(U):K===_.S.Move?Y.moveToExtent(U):K===_.S.Default&&(W(d,x)||J(Y,x,A))&&Y.zoomToExtent(U)}function Q(Y){Y.setStyle(new L.cp({}))}function z(Y,N){const K=new Map;N.forEach(u=>{K.set(u.getId(),u)});const j=[];Y.forEach(u=>{const x=K.get(u.getId());void 0===x||x.get("_entityRevision")!==u.get("_entityRevision")?j.push(u):K.delete(x.getId())});const A=Array.from(K.keys());return{add:N.filter(u=>A.indexOf(u.getId())>=0),remove:j}}},76572:(Pe,ae,r)=>{"use strict";r.d(ae,{Yf:()=>E.Y,Su:()=>E.S,ym:()=>p.y,IV:()=>e.I,CE:()=>R,_c:()=>F,E9:()=>P.E,oJ:()=>T,kj:()=>h.k,eu:()=>S,q1:()=>a.q1,qK:()=>a.qK,K6:()=>a.K6,Ki:()=>a.Ki,Yv:()=>a.Yv,QX:()=>a.QX,sf:()=>Q.s,Uz:()=>Q.U,mM:()=>w.m});var E=r(68392),a=r(14672),w=r(70524),p=r(40240),e=r(33436),c=r(87040),o=r(24112);class R extends c.uk{options;stores$$=new Map;resolution$$=[];empty$$;constructor(Y){super(Y),this.options=Y}bindStore(Y){super.bindStore(Y),!0===this.active&&this.watchStore(Y),this.empty$$=Y.empty$.subscribe(()=>this.updateEntitiesInResolution(Y,Y.layer.map.viewController.getResolution()))}unbindStore(Y){super.unbindStore(Y),!0===this.active&&this.unwatchStore(Y)}doActivate(){this.stores.forEach(Y=>this.watchStore(Y))}doDeactivate(){this.unwatchAll()}watchStore(Y){this.stores$$.has(Y)||(this.updateEntitiesInResolution(Y,Y.layer.map.viewController.getResolution()),this.resolution$$.push(Y.layer.map.viewController.resolution$.pipe((0,o.o)(250)).subscribe(N=>{this.updateEntitiesInResolution(Y,N)})))}updateEntitiesInResolution(Y,N){Y.state.updateAll(N>Y.layer.minResolution&&N<Y.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(Y){void 0!==this.stores$$.get(Y)&&this.stores$$.delete(Y)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(Y=>Y.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var L=r(43168),_=r(91296),C=r(47864);class S extends c.uk{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(Y,N,K){super(Y),this.options=Y,this.propertyTypeDetectorService=N,this.capabilitiesService=K,this.map=Y.map}bindStore(Y){super.bindStore(Y),!0===this.active&&this.watchStore(Y)}unbindStore(Y){super.unbindStore(Y),!0===this.active&&this.unwatchStore(Y)}doActivate(){this.stores.forEach(Y=>this.watchStore(Y))}doDeactivate(){this.unwatchAll()}watchStore(Y){this.stores$$.has(Y)||(this.updateEntitiesPropertiesState(Y),this.states$$.push(this.map.layers$.pipe((0,o.o)(250),(0,_.c)()).subscribe(([N,K])=>{let j;N&&(j=N.map(d=>d.id));const A=K.filter(d=>!j.includes(d.id));this.updateEntitiesPropertiesState(Y,A)})),this.states$$.push(Y.entities$.pipe((0,o.o)(250)).subscribe(N=>{this.updateEntitiesPropertiesState(Y)})))}updateEntitiesPropertiesState(Y,N){const K=this.map.layers.map(D=>D.id);let j=[];j=N?Y.entities$.value:Y.stateView.all().length?Y.stateView.all().filter(I=>!I.state.geoService).map(I=>I.entity):Y.entities$.value;const d=j.slice(0,j.length>=250?250:j.length);let u=[];d.map(D=>{u=u.concat(Object.keys(D.properties||{}))}),u=[...new Set(u)];const x={};u.map(D=>{x[D]=[...new Set(j.map(I=>I.properties[D]))]});const U={};Object.entries(x).forEach(D=>{const[I,M]=D,s=M.filter(H=>this.propertyTypeDetectorService.isGeoService(H));s?.length&&(U[I]=s)});const G=[];Object.entries(U).forEach(D=>{const[I,M]=D;M.map(s=>{const H=this.propertyTypeDetectorService.getGeoService(s,u);if(H){const Z=u.filter(_e=>H.propertiesForLayerName.includes(_e)),me=Z.length?Z[0]:void 0;me&&G.push({url:s,urlProperty:I,layerNameProperty:me,geoService:H})}})});const X=[];G.map(D=>{const I=D.url,M=D.geoService.type||"wms";x[D.layerNameProperty].map(s=>{let Z,H=s;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(M)&&(H=void 0,Z=s);const me=L.Yv.removeUndefined({sourceOptions:{type:M||"wms",url:I,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:H,LAYER:Z}}}),_e=(0,C.KC)(me.sourceOptions);X.push({geoServiceAssociation:D,state:{added:void 0!==K.find(de=>de===_e),haveGeoServiceProperties:!0,type:M,url:I,layerName:s}})})}),X.map(D=>{const I=D.geoServiceAssociation.urlProperty,M=D.geoServiceAssociation.layerNameProperty,s=D.state.url,H=D.state.layerName,Z=j.filter(_e=>_e.properties[I]===s&&_e.properties[M]===H);Y.state.updateMany(Z,{geoService:D.state},!0)})}unwatchStore(Y){void 0!==this.stores$$.get(Y)&&this.stores$$.delete(Y)}unwatchAll(){this.stores$$.clear(),this.states$$.map(Y=>Y.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var P=r(20624),y=r(93176);class F extends c.uk{options;stores$$=new Map;constructor(Y){super(Y),this.options=Y}bindStore(Y){super.bindStore(Y),!0===this.active&&this.watchStore(Y)}unbindStore(Y){super.unbindStore(Y),!0===this.active&&this.unwatchStore(Y)}doActivate(){this.stores.forEach(Y=>this.watchStore(Y))}doDeactivate(){this.unwatchAll()}watchStore(Y){this.stores$$.has(Y)||(this.onSourceChanges(Y),Y.layer.ol.getSource().on("change",K=>{this.onSourceChanges(Y)}))}unwatchStore(Y){void 0!==this.stores$$.get(Y)&&this.stores$$.delete(Y)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(Y=>{}),this.stores$$.clear()}onSourceChanges(Y){let N=Y.layer.ol.getSource().getFeatures();Y.layer.dataSource instanceof y.a&&(N=N.flatMap(K=>K.get("features"))),0===N.length?Y.clear():Y.setStoreOlFeatures(N)}}var h=r(18080),W=r(82304),J=r(53404);class T extends c.uk{options;stores$$=new Map;constructor(Y){super(Y),this.options=Y}bindStore(Y){super.bindStore(Y),!0===this.active&&this.watchStore(Y)}unbindStore(Y){super.unbindStore(Y),!0===this.active&&this.unwatchStore(Y)}doActivate(){this.stores.forEach(Y=>this.watchStore(Y))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(Y){Y.searchDocument=new W.Document({tokenize:"full"})}watchStore(Y){this.stores$$.has(Y)||(this.initStoreSearchIndex(Y),Y.entities$.pipe((0,J.O)(N=>!N.length)).subscribe(()=>this.onEntitiesChanges(Y)))}unwatchStore(Y){void 0!==this.stores$$.get(Y)&&(Y.searchDocument=void 0,this.stores$$.delete(Y))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(Y=>{}),this.stores$$.clear()}onEntitiesChanges(Y){const N=this.options.percentDistinctValueRatio||2,K=[];Y.index.forEach((u,x)=>{const U=u.properties;U.igoSearchID=x,K.push(U)});const j=[];let A=[],d=[];if(this.options.sourceFields)A=this.options.sourceFields.filter(u=>!u.searchIndex?.enabled),d=this.options.sourceFields.filter(u=>u.searchIndex?.enabled).map(u=>Object.assign({},{field:u.name,tokenize:"full"},u.searchIndex));else if(K.length){const u=Object.keys(K[0]),x=[];A=u.map(G=>{const X=[...new Set(K.map(D=>D[G]))];X.length/K.length*100<=N||X.every(D=>Number(D)===D&&D%1!=0)?A.push(G):x.push(G)}).filter(G=>G),d=x.filter(G=>"igoSearchID"!==G).map(G=>({field:G,tokenize:"full"}))}Y.index.forEach((u,x)=>{const U=JSON.parse(JSON.stringify(u.properties));A.map(G=>delete U[G]),Object.keys(U).length&&j.push(U)}),0===j.length?this.initStoreSearchIndex(Y):(Y.searchDocument=new W.Document({document:{id:"igoSearchID",index:d}}),j.map(u=>{Y.searchDocument.add(u.igoSearchID,u)}))}}var Q=r(64096)},40240:(Pe,ae,r)=>{"use strict";r.d(ae,{y:()=>e});var E=r(87040),a=r(94448),w=r(68392),p=r(14672);class e extends E.qc{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(o){this._searchDocument=o}get searchDocument(){return this._searchDocument}_searchDocument;constructor(o,R){super(o,R),this.map=R.map}bindLayer(o){return this.layer=o,this}setLayerFeatures(o,R=w.S.Default,L,_,C){C=C||E._I,this.checkLayer();const S=o.map(P=>(0,p.K6)(P,this.map.projection,C));this.setLayerOlFeatures(S,R,L,_)}setStoreOlFeatures(o){this.checkLayer();const R=o.map(L=>(L.set("_featureStore",this,!0),(0,p.qK)(L,this.layer.map.projection)));this.load(R)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(o,R=w.S.Default,L,_){const C=this.layer.ol.getSource(),S=(0,p.Wg)(C.getFeatures(),o);S.remove.length>0&&this.removeOlFeaturesFromLayer(S.remove),S.add.length>0&&this.addOlFeaturesToLayer(S.add),S.add.length>0?(0,p.QX)(this.map.viewController,S.add,R,L,_):S.remove.length>0&&(0,p.QX)(this.map.viewController,o,R,L,_)}setLayerExtent(){let o=this.entities$.getValue(),R=a.Gu(),L=[];o.forEach(C=>{L.push((0,p.K6)(C,this.map.projection))});const _=(0,p.q1)(L,this.map.viewProjection);a.SU(R,_),this.layer.setExtent(R)}addOlFeaturesToLayer(o){o.forEach(R=>{R.set("_featureStore",this,!0)}),this.source.ol.addFeatures(o)}removeOlFeaturesFromLayer(o){o.forEach(R=>{this.source.ol.removeFeature(R)})}}},64096:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>p,s:()=>w});var E=r(20624),a=r(18080);function w(e,c){void 0===e.getStrategyOfType(E.E)?(c=c||new E.E({}),e.addStrategy(c),c.activate()):e.activateStrategyOfType(E.E)}function p(e,c){void 0===e.getStrategyOfType(a.k)?(c=c||new a.k({map:e.map}),e.addStrategy(c),c.activate()):e.activateStrategyOfType(a.k)}},33436:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>e});var E=r(87040),a=r(94448),w=r(53404),p=r(24112);class e extends E.uk{options;stores$$=new Map;states$$=[];empty$$;constructor(o){super(o),this.options=o}bindStore(o){super.bindStore(o),!0===this.active&&this.watchStore(o),this.empty$$=o.empty$.pipe((0,w.O)(R=>!R)).subscribe(()=>this.updateEntitiesInExtent(o))}unbindStore(o){super.unbindStore(o),!0===this.active&&this.unwatchStore(o)}doActivate(){this.stores.forEach(o=>this.watchStore(o))}doDeactivate(){this.unwatchAll()}watchStore(o){this.stores$$.has(o)||(this.updateEntitiesInExtent(o),this.states$$.push(o.layer.map.viewController.state$.pipe((0,p.o)(250)).subscribe(()=>this.updateEntitiesInExtent(o))))}updateEntitiesInExtent(o){if(o?.layer?.map?.viewController){o.state.updateAll({inMapExtent:!1});const R=o.layer.map.viewController.getExtent(),_=this.getFeaturesInExtent(o.entities$.value,R);o.state.updateMany(_,{inMapExtent:!0},!1)}}getFeaturesInExtent(o,R){return o.reduce((L,_)=>{const C=_.ol?.getGeometry();if(C){const S=C.getExtent();a.K0(S,R)&&L.push(_)}else L.push(_);return L},[])}unwatchStore(o){void 0!==this.stores$$.get(o)&&this.stores$$.delete(o)}unwatchAll(){this.stores$$.clear(),this.states$$.map(o=>o.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}},20624:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>w});var E=r(87040),a=r(68392);class w extends E.uk{options;stores$$=new Map;motion;constructor(e){super(e),this.options=e,this.setMotion(e.motion)}bindStore(e){super.bindStore(e),!0===this.active&&this.watchStore(e)}unbindStore(e){super.unbindStore(e),!0===this.active&&this.unwatchStore(e)}setMotion(e){this.motion=e}doActivate(){this.stores.forEach(e=>this.watchStore(e))}doDeactivate(){this.unwatchAll()}watchStore(e){if(this.stores$$.has(e))return;const c=e.view.all$().subscribe(o=>this.onFeaturesChange(o,e));this.stores$$.set(e,c)}unwatchStore(e){const c=this.stores$$.get(e);void 0!==c&&(c.unsubscribe(),this.stores$$.delete(e))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(e=>{e[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(e,c){0===e.length?c.clearLayer():c.setLayerFeatures(e,this.selectMotion(c),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(e){return void 0!==this.motion?this.motion:!0===e.pristine||e.count>e.view.count?a.S.Default:a.S.None}}},18080:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>P,k:()=>y});var E=r(87040),a=r(83552),w=r(56224),p=r(35876),e=r(40604),c=r(24112),o=r(68013),R=r(3544),L=r(2892),_=r(59324),C=r(68392),S=r(40240);class P extends w.c{constructor(h){super(h)}}class y extends E.uk{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(h){super(h),this.options=h,this.setMotion(h.motion),this._overlayStore=this.createOverlayStore()}bindStore(h){super.bindStore(h),!0===this.active&&this.activate()}unbindStore(h){super.unbindStore(h),!0===this.active&&this.activate()}setMotion(h){this.motion=h}unselectAll(){this.stores.forEach(h=>{h.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const h=this.stores.map(W=>W.stateView.manyBy$(J=>!0===J.state.selected).pipe((0,e.k)(J=>J.map(T=>T.entity))));this.stores$$=(0,p.E)(h).pipe((0,c.o)(5),(0,o.s)(1),(0,e.k)(W=>W.reduce((J,T)=>J.concat(T)))).subscribe(W=>this.onSelectFromStore(W))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",h=>{this.onMapClick(h)})}unlistenToMapClick(){(0,a.S)(this.mapClickListener)}onMapClick(h){const W=!(0,_.q)(h),J=!W,T=h.map.getFeaturesAtPixel(h.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:Q=>void 0!==this.stores.find(Y=>Y.layer?.ol===Q)});this.onSelectFromMap(T,W,J)}addDragBoxInteraction(){let h;const W=this.map.ol.getInteractions().getArray();for(const J of W)if(J instanceof P){h=J;break}void 0===h&&(h=new P({condition:_.q}),this.map.ol.addInteraction(h),this.olDragSelectInteraction=h),this.olDragSelectInteractionEndKey=h.on("boxend",J=>this.onDragBoxEnd(J))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,a.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(h){const W=!(0,_.q)(h.mapBrowserEvent),T=h.target.getGeometry().getExtent(),Q=this.stores.reduce((z,Y)=>{const N=Y.layer.ol.getSource();return z.push(...N.getFeaturesInExtent(T)),z},[]);this.onSelectFromMap(Q,W,!1)}onSelectFromStore(h){const W=this.motion,T=this.overlayStore.layer.ol.getSource().getFeatures().map(Y=>Y.getId()),Q=h.map(this.overlayStore.getKey);let z;z=0!==h.length&&(T.length!==Q.length||!T.every(Y=>Q.indexOf(Y)>=0)),this.overlayStore.setLayerFeatures(h,z?W:C.S.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(h,W,J){const T=this.groupFeaturesByStore(h);this.stores.forEach(Q=>{const z=T.get(Q);void 0===z&&!0===W?this.unselectAllFeaturesFromStore(Q):void 0===z&&!1===W||this.selectFeaturesFromStore(Q,z,W,J)})}selectFeaturesFromStore(h,W,J,T){!0===T?h.state.reverseMany(W,["selected"]):h.state.updateMany(W,{selected:!0},J)}unselectAllFeaturesFromStore(h){h.state.updateAll({selected:!1})}groupFeaturesByStore(h){const W=new Map;return null==h||h.forEach(J=>{const T=J.get("_featureStore");if(void 0===T)return;let Q=W.get(T);void 0===Q&&(Q=[],W.set(T,Q));const z=T.get(J.getId());void 0!==z&&Q.push(z)}),W}createOverlayStore(){const h=this.options.layer?this.options.layer:this.createOverlayLayer();return new S.y([],{map:this.map}).bindLayer(h)}createOverlayLayer(){return new L.M({zIndex:300,source:new R.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}},5196:(Pe,ae,r)=>{"use strict";r.d(ae,{e:()=>a,w:()=>E});var E=function(w){return w.BasicNumericOperator="basicnumericoperator",w.Basic="basic",w.BasicAndSpatial="basicandspatial",w.Spatial="spatial",w.All="all",w.Time="time",w}(E||{}),a=function(w){return w.BBOX="BBox",w.PropertyIsBetween="PropertyIsBetween",w.Contains="Contains",w.During="During",w.PropertyIsEqualTo="PropertyIsEqualTo",w.PropertyIsGreaterThan="PropertyIsGreaterThan",w.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",w.Intersects="Intersects",w.PropertyIsNull="PropertyIsNull",w.PropertyIsLessThan="PropertyIsLessThan",w.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",w.PropertyIsLike="PropertyIsLike",w.PropertyIsNotEqualTo="PropertyIsNotEqualTo",w.Within="Within",w.And="And",w.Or="Or",w.Not="Not",w}(a||{})},40912:(Pe,ae,r)=>{"use strict";r.d(ae,{S:()=>R});var E=r(43168),a=r(11544),w=r(10416),p=r(68470),e=r(30816),c=r.n(e),o=r(5196);class R{filterSequence=[];operators={[o.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[o.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[o.e.During]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[o.e.Intersects]:{spatial:!0,fieldRestrict:[]},[o.e.Within]:{spatial:!0,fieldRestrict:[]},[o.e.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(_,C,S){let P=!0;return S&&"wms"===S&&(P=!1),(_=_||{}).enabled=void 0===_.enabled?P:_.enabled,_.editable=void 0===_.editable?P:_.editable,_.geometryName=C,_.advancedOgcFilters=!0,_.enabled&&(_.pushButtons||_.checkboxes||_.radioButtons||_.select||_.autocomplete)&&(_.advancedOgcFilters=!1),_}buildFilter(_,C,S,P,y){let F,h,W;if(h=!/intersects|contains|within/gi.test(JSON.stringify(_)),_&&(P=void 0!==_.geometryName?_.geometryName:P),C&&_&&(F=p.OK(P,C,S.getCode())),!_)return"bbox="+C.join(",")+","+S.getCode();_=this.checkIgoFiltersProperties(_,P,S),W=C&&h?p.iG(F,this.bundleFilter(_,y)):this.bundleFilter(_,y);const J={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:W,outputFormat:"",geometryName:P},T=(new a.c).writeGetFeature(J);return"filter="+(new XMLSerializer).serializeToString(T).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(_,C){if(_ instanceof Array){const S=[];return _.forEach(P=>{S.push(this.bundleFilter(P,C))}),S}return _.hasOwnProperty("logical")?this.createFilter({operator:_.logical,logicalArray:this.bundleFilter(_.filters,C)},C):_.hasOwnProperty("operator")?this.createFilter(_,C):void 0}createFilter(_,C){const S=_.operator,P=_.logicalArray,y=_.propertyName,F=_.pattern,h=!_.matchCase||_.matchCase,W=_.wildCard?_.wildCard:"*",J=_.singleChar?_.singleChar:".",T=_.escapeChar?_.escapeChar:"!",Q=_.lowerBoundary,z=_.upperBoundary,Y=_.geometryName,N=_.extent,K=_.wkt_geometry,j=_.srsName?_.srsName:"EPSG:3857",A=this.parseFilterOptionDate(_.begin,C?C.minDate:void 0),d=this.parseFilterOptionDate(_.end,C?C.maxDate:void 0),u=_.expression;let x;switch(K&&(x=(new w.c).readGeometry(K,{dataProjection:j,featureProjection:j||"EPSG:3857"})),S.toLowerCase()){case o.e.BBOX.toLowerCase():return p.OK(Y,N,j);case o.e.PropertyIsBetween.toLowerCase():return p.YX(y,Q||-1e40,z||1e40);case o.e.Contains.toLowerCase():return p.Y7(Y,x,j);case o.e.During.toLowerCase():return p.In(y,A,d);case o.e.PropertyIsEqualTo.toLowerCase():return p.cv(y,u,h);case o.e.PropertyIsGreaterThan.toLowerCase():return p.kP(y,u);case o.e.PropertyIsGreaterThanOrEqualTo.toLowerCase():return p.Ky(y,u);case o.e.Intersects.toLowerCase():return p.K0(Y,x,j);case o.e.PropertyIsNull.toLowerCase():return p.Av(y);case o.e.PropertyIsLessThan.toLowerCase():return p.cP(y,u);case o.e.PropertyIsLessThanOrEqualTo.toLowerCase():return p.ov(y,u);case o.e.PropertyIsLike.toLowerCase():return p.G2(y,F?F.replace(/[()_]/gi,J):W,W,J,T,h);case o.e.PropertyIsNotEqualTo.toLowerCase():return p.Qb(y,u,h);case o.e.Within.toLowerCase():return p.Cu(Y,x,j);case o.e.And.toLowerCase():return p.iG.apply(null,P);case o.e.Or.toLowerCase():return p.or.apply(null,P);case o.e.Not.toLowerCase():return p.ik.apply(null,P);default:return}}defineInterfaceFilterSequence(_,C,S="",P=-1){return _ instanceof Array?_.forEach(y=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(y,C,S,P))}):_.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(_.filters,C,_.logical,P+=1)):_.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(_,C,P,S)),this.filterSequence}computeAllowedOperators(_,C,S){let y,F,h,P={};if(_&&C){const W=_.find(J=>J.name===C);y=W&&W.allowedOperatorsType?W.allowedOperatorsType:S}switch(_&&_.map(W=>{if(!W.allowedOperatorsType)return;const J=W.allowedOperatorsType.toLowerCase();(J===o.w.All.toLowerCase()||J===o.w.Spatial.toLowerCase()||J===o.w.BasicAndSpatial.toLowerCase())&&(F=!0,J===o.w.All.toLowerCase()&&(h=!0))}),y=y||o.w.BasicAndSpatial,y.toLowerCase()){case o.w.All:P=this.operators;break;case o.w.Spatial:P={[o.e.Intersects]:{spatial:!0,fieldRestrict:[]},[o.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case o.w.BasicAndSpatial:P={[o.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.Intersects]:{spatial:!0,fieldRestrict:[]},[o.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case o.w.Basic:P={[o.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case o.w.Time:P={[o.e.During]:{spatial:!1,fieldRestrict:[]}};break;case o.w.BasicNumericOperator:P={[o.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[o.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:P={[o.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.e.Intersects]:{spatial:!0,fieldRestrict:[]},[o.e.Within]:{spatial:!0,fieldRestrict:[]}}}return F&&(P.Intersects={spatial:!0,fieldRestrict:[]},P.Within={spatial:!0,fieldRestrict:[]},h&&(P.Contains={spatial:!0,fieldRestrict:[]})),P}addInterfaceFilter(_,C,S=0,P="Or"){_||(_={operator:"PropertyIsEqualTo"});const y={propertyName:"",operator:"",active:"",filterid:(0,E.uq)(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(y,{parentLogical:P,level:S,geometryName:C},_)}checkIgoFiltersProperties(_,C,S,P=!1){const y=[];return _ instanceof Array?(_.forEach(F=>{y.push(this.checkIgoFiltersProperties(F,C,S,P))}),y):_.hasOwnProperty("logical")?Object.assign({},{logical:_.logical,filters:this.checkIgoFiltersProperties(_.filters,C,S,P)}):_.hasOwnProperty("operator")?this.addFilterProperties(_,C,S,P):void 0}addFilterProperties(_,C,S,P=!1){const y=_.hasOwnProperty("filterid")?_.filterid:(0,E.uq)(),F=_.hasOwnProperty("active")?_.active:P,h=_.hasOwnProperty("srsName")?_.srsName:S?S.getCode():"EPSG:3857";return Object.assign({},{filterid:y,active:F,igoSpatialSelector:"fixedExtent",srsName:h},_,{geometryName:C})}rebuiltIgoOgcFilterObjectFromSequence(_){if(_ instanceof Array&&_.length>=1){let S,y,C=_[0].parentLogical,P=[];return _.forEach(F=>{const h=Object.assign({},F),W=_.indexOf(F);S=W>=0&&W<_.length-1?_[W+1]:h,delete h.active,delete h.filterid,delete h.parentLogical,P.push(h),1===_.length?y=h:C!==S.parentLogical&&(1===P.length?console.log("You must set at least two operator in a logical ("+C+")"):(y=Object.assign({},{logical:C,filters:P}),P=[y],C=S.parentLogical))}),y}}computeIgoSelector(_){if(_.groups.every(S=>void 0!==S.computedSelectors))return _;let C;if(_.groups&&_.bundles){if(!_.bundles.every(S=>void 0!==S.id))throw new Error("You must set an id for each of your bundles");C=E.Yv.copyDeep(_),C.groups.forEach(S=>{S.title=S.title?S.title:S.name,S.enabled=!!S.enabled&&S.enabled,S.computedSelectors=E.Yv.copyDeep(C.bundles.filter(P=>S.ids.includes(P.id)))})}else!_.groups&&_.bundles?(C=E.Yv.copyDeep(_),C.groups=[{title:"group1",name:"group1",computedSelectors:E.Yv.copyDeep(C.bundles)}]):C={bundles:_,groups:[{title:"group1",name:"group1",computedSelectors:E.Yv.copyDeep(_)}],selectorType:C.selectorType};return C.groups.find(S=>S.enabled)||(C.groups[0].enabled=!0),C}handleOgcFiltersAppliedValue(_,C,S,P){const y=_.ogcFilters;if(!y)return;const F=[];let h="",W="";if(y.enabled&&(y.pushButtons||y.checkboxes||y.radioButtons||y.select||y.autocomplete)){let T;if(y.pushButtons){T=y.pushButtons;const Q=this.formatGroupAndFilter(y,T);for(const z of Q)F.push(z)}if(y.checkboxes){T=y.checkboxes;const Q=this.formatGroupAndFilter(y,T);for(const z of Q)F.push(z)}if(y.radioButtons){T=y.radioButtons;const Q=this.verifyMultipleEnableds(T),z=this.formatGroupAndFilter(y,Q);for(const Y of z)F.push(Y)}if(y.select){T=y.select;const Q=this.verifyMultipleEnableds(T),z=this.formatGroupAndFilter(y,Q);for(const Y of z)F.push(Y)}if(y.autocomplete){T=y.autocomplete;const Q=this.formatGroupAndFilter(y,T);for(const z of Q)F.push(z)}F.length>=1&&(h=this.buildFilter(1===F.length?F[0]:{logical:"And",filters:F},S,P,y.geometryName))}y.enabled&&y.filters&&(y.geometryName=y.geometryName||C,W=this.buildFilter(y.filters,S,P,y.geometryName,_));let J=y.advancedOgcFilters?W:h;return"wms"===_.type&&(J=this.formatProcessedOgcFilter(J,_.params.LAYERS)),"wfs"===_.type&&(J=this.formatProcessedOgcFilter(J,_.params.featureTypes)),J}verifyMultipleEnableds(_){return _.bundles.forEach(C=>{if(!C.multiple&&C.selectors){const S=C.selectors.reduce((P,y,F)=>!0===y.enabled?P.concat(F):P,[]);S.length>1&&(S.splice(0,1),S.forEach(P=>{C.selectors[P].enabled=!1}))}}),_}formatGroupAndFilter(_,C){const S=(C=this.computeIgoSelector(C)).groups.find(y=>y.enabled).computedSelectors,P=[];return S.map(y=>{const F=[],h=y.selectors;h&&(h.filter(W=>!0===W.enabled).forEach(W=>F.push(W.filters)),1===F.length?P.push(F[0]):F.length>1&&P.push({logical:y.logical,filters:F}))}),"pushButton"===C.selectorType?_.pushButtons=C:"checkbox"===C.selectorType?_.checkboxes=C:"radioButton"===C.selectorType?_.radioButtons=C:"select"===C.selectorType?_.select=C:"autocomplete"===C.selectorType&&(_.autocomplete=C),P}formatProcessedOgcFilter(_,C){if(!_)return;let S="";return 0===_.length&&-1===C.indexOf(",")?S=_:C.split(",").forEach(y=>{S=`${S}(${_.replace("filter=","")})`}),S=S.replace(/\(\)/g,""),S.length>0?S.replace("filter=",""):void 0}parseFilterOptionDate(_,C){return _?_.toLowerCase().includes("now")||_.toLowerCase().includes("today")?this.parseDateOperation(_):c()(_).isValid()?_:void 0:C}parseDateOperation(_){const C=_.toLowerCase().split(" "),S=C[0],P=["+","-"].includes(C[1])?C[1]:void 0,y=/^[0-9]*$/.test(C[2])?C[2]:void 0,F=["years","months","weeks","days","hours","seconds"].includes(C[3])?C[3]:void 0;return P&&F&&y?"+"===P?"now"===S?c()().add(parseInt(y,10),F).format():c()().endOf("day").add(parseInt(y,10),F).format():"now"===S?c()().subtract(parseInt(y,10),F).format():c()().endOf("day").subtract(parseInt(y,10),F).format():"now"===S?c()().format():c()().endOf("day").format()}}},14191:(Pe,ae,r)=>{"use strict";r.d(ae,{D:()=>a,U:()=>E});var E=function(w){return w.DATE="date",w.TIME="time",w.DATETIME="datetime",w.YEAR="year",w}(E||{}),a=function(w){return w.CALENDAR="calendar",w.SLIDER="slider",w}(a||{})},17115:(Pe,ae,r)=>{"use strict";r.d(ae,{i:()=>S});var E=r(83552),a=r(96764),w=r(32736),p=r(99376),e=r(25696),c=r(53156),o=r(28772),R=r(61616),L=r(54844),_=r(93244),C=r(36124);class S{options;start$=new R.E;end$=new R.E;changes$=new R.E;modify$=new R.E;select$=new R.E;abort$=new R.E;freehand$=new L.g(!1);ispredefinedRadius$=new L.g(!1);predefinedRadius$=new L.g(void 0);radiusDrawEnd$=new L.g(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(y){this.predefinedRadius$.next(y)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(y){this.options=y,this.olDrawingLayer=y.drawingLayer?y.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(y,F){if(!y)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=y);this.olMap=y,this.addOlInnerOverlayLayer(),this.addOlInteractions(F)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(y){this.olInteractionStyle=y}setGeometryType(y){this.olGeometryType=y}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new c.c({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new o.c,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(y){let F;if(F=this.freehand$.getValue()?new w.cp("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new w.cp({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new w.cp({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(F),this.olDrawInteraction=F,this.onDrawStartKey=F.on("drawstart",h=>this.onDrawStart(h)),this.onDrawEndKey=F.on("drawend",h=>this.onDrawEnd(h)),this.onDrawAbortKey=F.on("drawabort",h=>this.abort$.next(h.feature.getGeometry())),y){const h=new p.c({source:this.getSource()});if(this.olMap.addInteraction(h),this.olModifyInteraction=h,!this.olSelectInteraction){const W=new e.c({condition:a.q0,style:void 0});this.olMap.addInteraction(W),this.olSelectInteraction=W,this.olSelectInteraction.on("select",J=>this.onSelect(J))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,E.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(y){const F=y.feature.getGeometry();this.start$.next(F),this.clearOlInnerOverlaySource(),this.onDrawKey=F.on("change",h=>{this.mousePosition=(0,C.y6)(h),this.changes$.next(h.target)}),this.subscribeKeyDown()}onDrawEnd(y){"Point"===y.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,E.S)(this.onDrawKey);const F=y.feature.getGeometry();F.on("change",()=>{this.modify$.next(F)}),this.end$.next(F)}onSelect(y){1===y.selected.length&&this.select$.next(y.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,_.w)(document,"keydown").subscribe(y=>{"Escape"!==y.key?("Backspace"===y.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===y.key&&this.olDrawInteraction.finishDrawing()," "!==y.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}},48908:(Pe,ae,r)=>{"use strict";r.d(ae,{i4:()=>E.i,Up:()=>F});var E=r(17115),a=r(58264),w=r(83552),p=r(12760),e=r(36752),c=r(56224),o=r(32736),R=r(99376),L=r(98492),_=r(53156),C=r(28772),S=r(61616),P=r(93244),y=r(36124);class F{options;start$=new S.E;end$=new S.E;changes$=new S.E;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(T){this.options=T,void 0!==T.modify&&(this.modify=T.modify),void 0!==T.translate&&(this.translate=T.translate),this.olOverlayLayer=void 0!==T.layer?T.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(T){if(void 0===T)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=T);this.olMap=T,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(T){const Q=new a.c({geometry:T});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(Q)}createOlInnerOverlayLayer(){return new _.c({source:this.options.source?this.options.source:new C.c,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new _.c({source:new C.c,style:(0,y.cb)(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const T=new R.c({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=T}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",T=>this.onModifyStart(T)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",T=>this.onModifyEnd(T)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,w.S)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(T){const Q=T.features.item(0).getGeometry();this.start$.next(Q),this.onModifyKey=Q.on("change",z=>{this.mousePosition=(0,y.y6)(z),this.changes$.next(z.target)}),this.subscribeToKeyDown()}onModifyEnd(T){(0,w.S)(this.onModifyKey),this.end$.next(T.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,P.w)(document,"keydown").subscribe(T=>{" "!==T.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const T=new L.c({layers:[this.olOverlayLayer]});this.olTranslateInteraction=T}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",T=>this.onTranslateStart(T)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",T=>this.onTranslateEnd(T)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,w.S)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(T){const Q=T.features.item(0).getGeometry();this.start$.next(Q),this.onTranslateKey=Q.on("change",z=>{})}onTranslateEnd(T){(0,w.S)(this.onTranslateKey),this.end$.next(T.features.item(0).getGeometry())}addOlDrawInteraction(){const T=new o.cp({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:(0,y.cb)(),condition:Q=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(Q.coordinate)});this.olDrawInteraction=T,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,P.w)(document,"keydown").subscribe(T=>{if("Control"!==T.key)return;this.unsubscribeToDrawKeyDown();const Q=this.getOlGeometry();!Q||!(Q instanceof e.cp)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,P.w)(document,"keyup").subscribe(T=>{"Control"===T.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(T=>{T instanceof c.c&&(this.olMap.removeInteraction(T),this.removedOlInteractions.push(T))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",T=>this.onDrawStart(T)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",T=>this.onDrawEnd(T)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(T=>{this.olMap.addInteraction(T)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,w.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(T){const Q=T.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const z=Q.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(z),this.start$.next(this.getOlGeometry()),this.onDrawKey=Q.on("change",Y=>{this.mousePosition=(0,y.y6)(Y);const K=Y.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(K),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(T){(0,w.S)(this.onDrawKey),this.olOuterGeometry=void 0;const Q=T.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(Q),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(T){const Q=this.getOlGeometry(),z=new p.c(T);(0,y.wv)(Q,z)}updateLinearRingOfOlGeometry(T){const Q=this.getOlGeometry(),Y=Q.getLinearRings().slice(0,-1).map(N=>N.getCoordinates());Y.push(T),Q.setCoordinates(Y)}getOlGeometry(){const T=this.olOverlaySource.getFeatures();return T.length>0?T[0].getGeometry():void 0}}r(52836)},52836:(Pe,ae,r)=>{"use strict";Error},36124:(Pe,ae,r)=>{"use strict";r.d(ae,{cb:()=>_,gD:()=>L,wv:()=>y,y6:()=>F});var E=r(36752),a=r(87544),w=r(45212),p=r(88872),e=r(54776);function L(h){return new a.c({stroke:new w.c({color:(h=h||[0,153,255]).concat([1]),width:2}),fill:new p.c({color:h.concat([.2])}),radius:8})}function _(){return new e.cp({stroke:new w.c({color:[0,153,255,1],width:2})})}function y(h,W){h.appendLinearRing(W)}function F(h){const W=h.target;return W instanceof E.cp?W.getFlatCoordinates().slice(-4,-2):W.getFlatCoordinates().slice(-2)}r(72855),r(11432),r(52836)},41912:(Pe,ae,r)=>{"use strict";r.d(ae,{Up:()=>w.Up,i4:()=>w.i4}),r(52836),r(36124);var w=r(48908)},99228:(Pe,ae,r)=>{"use strict";r.d(ae,{IZ:()=>E.I,Md:()=>a.Md,aG:()=>a.aG,wL:()=>a.wL});var E=r(7036),a=r(56708)},8492:(Pe,ae,r)=>{"use strict";r.d(ae,{i:()=>E});const E="Layer"},7036:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>K});var E=r(45928),a=r(64100),w=r(43168),p=r(54776),e=r(80372),c=r(21296),o=r(1296),R=r(35876),L=r(40604),_=r(51672),C=r(10211),S=r(61200),P=r(3544),y=r(39532),F=r(82048);function h(j){const A=j;return"mvt"===A.sourceOptions?.type&&(A.igoStyle?.styleByAttribute?.hoverStyle||A.igoStyle?.hoverStyle)&&(A.sourceOptions.featureClass=A.sourceOptions.featureClass||"feature"),j}var W=r(56708),J=r(34896),T=r(33712),Q=r(61616),z=r(83680),Y=r(96832);let N=(()=>{class j{ngxIndexedDBService;dbName="layerData";constructor(d){this.ngxIndexedDBService=d}update(d){const u=new Q.E;return this.ngxIndexedDBService.getByID(this.dbName,d.layerId).pipe((0,z.K)(),(0,C.m)(x=>x?this.customUpdate(d):this.ngxIndexedDBService.add(this.dbName,d))).subscribe(x=>{u.next(x),u.complete()}),u}customUpdate(d){const u=new Q.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,d.layerId).pipe((0,C.m)(U=>U?this.ngxIndexedDBService.add(this.dbName,d):(0,o.of)(void 0))).subscribe(U=>{U&&u.next(U),u.complete()}),u}getByID(d){return this.ngxIndexedDBService.getByID(this.dbName,d)}deleteByKey(d){return this.ngxIndexedDBService.deleteByKey(this.dbName,d)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}static \u0275fac=function(u){return new(u||j)(J.CoB(Y.aQ))};static \u0275prov=J.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})(),K=(()=>{class j{http;styleService;dataSourceService;geoNetworkService;messageService;layerDBService;authInterceptor;constructor(d,u,x,U,G,X,D){this.http=d,this.styleService=u,this.dataSourceService=x,this.geoNetworkService=U,this.messageService=G,this.layerDBService=X,this.authInterceptor=D}createLayer(d){if(!d.source)return;let u;switch(d.source.options&&d.source.options._layerOptionsFromSource&&(d=w.Yv.mergeDeep(d.source.options._layerOptionsFromSource,d||{})),d.source.constructor){case P.yC:case P.m6:case P.nA:case P.Uv:case P.aI:case P.W4:u=this.createTileLayer(d);break;case P.EB:case P.ak:case P.IH:case P.cR:case P.a:u=this.createVectorLayer(d);break;case P.yA:case P.CK:u=this.createImageLayer(d);break;case P.cv:const x=h(d);u=this.createVectorTileLayer(x)}return u}createAsyncLayer(d,u){const x=h(d);return x.source?new c._(U=>U.next(this.createLayer(x))):this.dataSourceService.createAsyncDataSource(x.sourceOptions,u).pipe((0,L.k)(U=>{if(void 0!==U)return this.createLayer(Object.assign(x,{source:U}))}))}createImageLayer(d){return new W.Iw(d,this.messageService,this.authInterceptor)}createTileLayer(d){return new W.t9(d,this.messageService,this.authInterceptor)}createVectorLayer(d){let x,u=d.style;if(d.igoStyle||(d.igoStyle={}),this.handleLegacyStyles(d,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),d.igoStyle.igoStyleObject&&!d.idbInfo?.storeToIdb?u=(X,D)=>this.styleService.createStyle(d.igoStyle.igoStyleObject,X,D):d.igoStyle.igoStyleObject&&d.idbInfo?.storeToIdb&&(u=this.styleService.parseStyle("style",d.igoStyle.igoStyleObject)),d.source instanceof P.IH)u=d.source.options.params.style;else if(d.igoStyle?.styleByAttribute){const X=this.styleService;d.style=(D,I)=>X.createStyleByAttribute(D,d.igoStyle.styleByAttribute,I),x=new W.Md(d,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(d.source instanceof P.a){const X=this.styleService,D=d.igoStyle.clusterBaseStyle;d.style=(I,M)=>X.createClusterStyle(I,M,d.clusterParam,D),x=new W.Md(d,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const G=Object.assign({},d,{style:u});return x||(x=new W.Md(G,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(x,G),x}handleLegacyStyles(d,u){u.map(x=>{if(d[x]){let U=x;if("style"===x){if(d[x]instanceof p.cp)return;if("object"!=typeof d[x])return;U="igoStyleObject"}d.igoStyle[U]=d[x],delete d[x],console.warn(`\n        The location of this style option (${x}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${x}: {...} must be transfered to igoStyle: { ${U}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(d){let u,x;if(d.igoStyle||(d.igoStyle={}),this.handleLegacyStyles(d,["styleByAttribute","hoverStyle","mapboxStyle","style"]),d.igoStyle.igoStyleObject&&(u=(X,D)=>this.styleService.createStyle(d.igoStyle.igoStyleObject,X,D)),d.igoStyle.styleByAttribute){const X=this.styleService;d.style=(D,I)=>X.createStyleByAttribute(D,d.igoStyle.styleByAttribute,I),x=new W.qR(d,this.messageService,this.authInterceptor)}const G=Object.assign({},d,{style:u});return x||(x=new W.qR(G,this.messageService,this.authInterceptor)),this.applyMapboxStyle(x,G),x}applyMapboxStyle(d,u){u.igoStyle?.mapboxStyle&&this.getStuff(u.igoStyle.mapboxStyle.url).subscribe(x=>{if(x.sprite){const U=this.getAbsoluteUrl(u.igoStyle.mapboxStyle.url,x.sprite);this.getStuff(U+".json").subscribe(G=>{(0,e.M7)(d.ol,x,u.igoStyle.mapboxStyle.source,void 0,G,U+".png")})}else(0,e.M7)(d.ol,x,u.igoStyle.mapboxStyle.source)})}getStuff(d){return this.http.get(d).pipe((0,L.k)(u=>u),(0,_.a)(u=>(console.log("No style was found"),(0,o.of)(u))))}getAbsoluteUrl(d,u){return new RegExp("^http|//","i").test(u)?u:"/"===d.substr(d.length-1)?d+u:d+"/"+u}createAsyncIdbLayers(d="*"){return this.layerDBService.getAll().pipe((0,C.m)(u=>{const U=("*"!==d?u.filter(G=>G.detailedContextUri===d):u).map(G=>Object.assign({},G.layerOptions,{sourceOptions:G.sourceOptions}));return(0,R.E)(U.map(G=>this.createAsyncLayer(G)))}))}static \u0275fac=function(u){return new(u||j)(J.CoB(T.KK),J.CoB(F.U),J.CoB(S.O),J.CoB(y.U),J.CoB(a.mi),J.CoB(N),J.CoB(E.kT,8))};static \u0275prov=J.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},56708:(Pe,ae,r)=>{"use strict";r.d(ae,{Iw:()=>e,aG:()=>a.a,t9:()=>R,wL:()=>a.w,Md:()=>L.M,qR:()=>C});var E=r(55792),a=r(68252),w=r(87816),p=r(29632);class e extends E.a{messageService;authInterceptor;watcher;constructor(P,y,F){super(P,y,F),this.messageService=y,this.authInterceptor=F,this.watcher=new p.s(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(h=>{0===h&&(this.olLoadingProblem=!0)})}createOlLayer(){const P=Object.assign({},this.options,{source:this.options.source.ol}),y=new w.c(P);return this.authInterceptor&&y.getSource().setImageLoadFunction((F,h)=>{this.customLoader(F,h,this.authInterceptor,this.messageService)}),y}setMap(P){void 0===P?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(P)}customLoader(P,y,F,h){const W=new XMLHttpRequest,J=F.alterUrlWithKeyAuth(y);let T=y;if(J&&(T=J),W.open("GET",T),!F.interceptXhr(W,T))return W.abort(),void(P.getImage().src=T);W.responseType="arraybuffer",W.onload=function(){const z=new Uint8Array(this.response);(new TextDecoder).decode(z).includes("ServiceExceptionReport")&&h.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const N=new Blob([z],{type:"image/png"}),j=window.URL.createObjectURL(N);P.getImage().src=j},W.send()}}var c=r(24124),o=r(48004);class R extends E.a{messageService;authInterceptor;watcher;constructor(P,y,F){super(P,y),this.messageService=y,this.authInterceptor=F,this.watcher=new o.e(this),this.status$=this.watcher.status$}createOlLayer(){const P=Object.assign({},this.options,{source:this.options.source.ol}),y=new c.c(P);return y.getSource().setTileLoadFunction((h,W)=>{this.customLoader(h,W,this.authInterceptor)}),y}customLoader(P,y,F){const h=F.alterUrlWithKeyAuth(y);let W=y;h&&(W=h),P.getImage().src=W}setMap(P){void 0===P?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(P)}}var L=r(2892),_=r(28184);class C extends E.a{messageService;authInterceptor;watcher;constructor(P,y,F){super(P,y,F),this.messageService=y,this.authInterceptor=F,this.watcher=new o.e(this),this.status$=this.watcher.status$}createOlLayer(){const P=Object.assign({},this.options,{source:this.options.source.ol}),y=new _.c(P);return y.getSource().setTileLoadFunction((h,W)=>{const J=this.customLoader(W,h.getFormat(),this.authInterceptor,h.onLoad.bind(h));J&&h.setLoader(J)}),y}customLoader(P,y,F,h,W){return(J,T,Q)=>{const z=new XMLHttpRequest;let Y=P;if("function"!=typeof P){const N=F.alterUrlWithKeyAuth(P);N&&(Y=N)}else Y=P(J,T,Q);z.open("GET",Y),F&&F.interceptXhr(z,Y),"arraybuffer"===y.getType()&&(z.responseType="arraybuffer"),z.onload=N=>{if(!z.status||z.status>=200&&z.status<300){const K=y.getType();let j;"json"===K||"text"===K?j=z.responseText:"xml"===K?(j=z.responseXML,j||(j=(new DOMParser).parseFromString(z.responseText,"application/xml"))):"arraybuffer"===K&&(j=z.response),j?h.call(this,y.readFeatures(j,{extent:J,featureProjection:Q}),y.readProjection(j)):W.call(this)}else W.call(this)},z.onerror=()=>{W.call(this)},z.send()}}setMap(P){void 0===P?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(P)}}},68252:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>E,w:()=>a});var E=function(w){return w.OPACITY="opacity",w.VISIBLE="visible",w.OGCFILTERS="ogcFilters",w.MINRESOLUTION="minResolution",w.MAXRESOLUTION="maxResolution",w.ZINDEX="zIndex",w.TIMEFILTER="timeFilter",w}(E||{}),a=function(w){return w.TITLE="title",w.ABSTRACT="abstract",w.CUSTOM="custom",w}(a||{})},55792:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>e});var E=r(54844),a=r(35876),w=r(40604),p=r(59324);class e{options;messageService;authInterceptor;geoDBService;layerDBService;collapsed;dataSource;legend;legendCollapsed=!0;firstLoadComponent=!0;map;ol;olLoadingProblem=!1;status$;hasBeenVisible$=new E.g(void 0);hasBeenVisible$$;resolution$$;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(o){this.options.title=o}get zIndex(){return this.ol.getZIndex()}set zIndex(o){this.ol.setZIndex(o)}get baseLayer(){return this.options.baseLayer}set baseLayer(o){this.options.baseLayer=o}get opacity(){return this.ol.get("opacity")}set opacity(o){this.ol.setOpacity(o)}set isInResolutionsRange(o){this.isInResolutionsRange$.next(o)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new E.g(!1);set maxResolution(o){this.ol.setMaxResolution(0===o?0:o||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(o){this.ol.setMinResolution(o||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(o){this.ol.setVisible(o),this.visible$.next(o),!this.hasBeenVisible$.value&&o&&this.hasBeenVisible$.next(o),this.options?.messages&&o&&this.options?.messages.filter(R=>R.options?.showOnEachLayerVisibility).map(R=>this.showMessage(R))}get visible(){return this.visible$.value}visible$=new E.g(void 0);get displayed(){return this.visible&&this.isInResolutionsRange}displayed$=(0,a.E)([this.isInResolutionsRange$,this.visible$]).pipe((0,w.k)(o=>o[0]&&o[1]));get showInLayerList(){return!1!==this.options.showInLayerList}constructor(o,R,L,_,C){this.options=o,this.messageService=R,this.authInterceptor=L,this.geoDBService=_,this.layerDBService=C,this.dataSource=o.source,this.ol=this.createOlLayer(),void 0!==o.zIndex&&(this.zIndex=o.zIndex),o.baseLayer&&void 0===o.visible&&(o.visible=!1),this.maxResolution=o.maxResolution||(0,p.bg)(Number(o.maxScaleDenom)),this.minResolution=o.minResolution||(0,p.bg)(Number(o.minScaleDenom)),this.visible=void 0===o.visible||o.visible,this.opacity=void 0===o.opacity?1:o.opacity,o.legendOptions&&(o.legendOptions.url||o.legendOptions.html)&&(this.legend=this.dataSource.setLegend(o.legendOptions)),this.legendCollapsed=!o.legendOptions||!o.legendOptions.collapsed||o.legendOptions.collapsed,this.ol.set("_layer",this,!0)}setMap(o){this.map=o,this.unobserveResolution(),void 0!==o&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(R=>{this.showMessage(R)})}))}showMessage(o){this.messageService&&(o.title=o.title,o.text=o.text,this.messageService.message(o))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const o=this.map.viewController.getResolution();this.isInResolutionsRange=o>=this.minResolution&&o<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}},2892:(Pe,ae,r)=>{"use strict";r.d(ae,{M:()=>j});var E=r(43168),a=r(83552),w=r(82736),p=r(44876),e=r(12396),c=r(53156),o=r(61252),R=r(54760),L=r(2500),_=r(93244),C=r(3360),S=r(1296),P=r(24112),y=r(2924),F=r(10211),h=r(83680),W=r(51672),J=r(90112),T=r(38084),Q=r(85308),z=r(96659),N=r(84052),K=r(55792);class j extends K.a{messageService;authInterceptor;geoNetworkService;geoDBService;layerDBService;previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}constructor(d,u,x,U,G,X){super(d,u,x,G,X),this.messageService=u,this.authInterceptor=x,this.geoNetworkService=U,this.geoDBService=G,this.layerDBService=X,this.watcher=new N.w(this),this.status$=this.watcher.status$}createOlLayer(){const d=this.options.opacity||1,u=!1!==this.options.visible,x=this.options.minResolution||(0,Q.bg)(Number(this.options.minScaleDenom)),U=this.options.maxResolution||(0,Q.bg)(Number(this.options.maxScaleDenom)),G=this.options.sourceOptions;this.dataSource instanceof J.E&&(G?.preload?.bypassResolution||G?.preload?.bypassVisible)&&(this.options.opacity=0,G.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),G.preload.bypassVisible&&!u&&(this.options.visible=!0));const X=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});this.options.animation&&this.dataSource.ol.on("addfeature",function(s){this.flash(s.feature)}.bind(this)),this.options.idbInfo?.storeToIdb&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof J.E&&(G?.preload?.bypassResolution||G?.preload?.bypassVisible)&&this.dataSource.ol.once("featuresloadend",()=>{d&&(this.opacity=d),G.preload.bypassResolution&&(this.minResolution=x,this.maxResolution=U),G.preload.bypassVisible&&(this.visible=u)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const D=new c.c(X),I=D.getSource(),M=I.getUrl();if("function"==typeof M)return D;if(M||"wfs"===X.sourceOptions?.type){let s;const H=X.sourceOptions;s="wfs"===H?.type&&(H.params||H.paramsWFS)?(Z,me,_e,de,le)=>{this.customWFSLoader(I,H,this.authInterceptor,Z,me,_e,de,le)}:(Z,me,_e,de,le)=>{this.customLoader(I,M,this.authInterceptor,Z,me,_e,de,le)},s&&I.setLoader(s)}else if(this.options.idbInfo?.storeToIdb&&this.geoDBService){const s=(H,Z,me,_e,de)=>{this.customIDBLoader(I,X.id,H,me,_e,de)};s&&I.setLoader(s)}return this.options.idbInfo?.storeToIdb&&this.geoDBService&&D.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,_.w)(D,"change").pipe((0,P.o)(750)).subscribe(()=>this.maintainOptionsInIdb()),D.on("change:zIndex",()=>this.maintainOptionsInIdb())}),D}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,C.E)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function Y(A){const d=A.getStyle();return"function"==typeof d||d instanceof Array?void 0:{fill:{color:d.getFill().getColor()},stroke:{color:d.getStroke().getColor(),width:2},circle:{fill:{color:d.getImage().getFill().getColor()},stroke:{color:d.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const d=E.Yv.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});this.layerDBService.update(d)}maintainFeaturesInIdb(){const d=this.dataSource.ol.getFeatures(),u=JSON.parse((new e.c).writeFeatures(d,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,u,z.G.User,`${this.title}-${this.id}-${new Date}`)}flash(d){const u=(new Date).getTime(),x=this.ol.on("postrender",function U(G){const X=(0,L.wX)(G),D=G.frameState,I=d.getGeometry().clone(),M=D.time-u,s=M/this.options.animation.duration,H=(0,p.Q7)(1-s),Z=(0,w.f4)(this.options.animation.color||"red");Z[3]=H;let me=this.ol.getStyleFunction().call(this,d).find(de=>de.getImage());me||(me=this.ol.getStyleFunction().call(this,d)[0]);const _e=me.clone();switch(d.getGeometry().getType()){case"Point":if(null!==_e.getImage()&&"function"==typeof _e.getImage().getRadius){const de=(0,p.Q7)(s)*(3*_e.getImage().getRadius());_e.getImage().setRadius(de),_e.getImage().setOpacity(H)}break;case"LineString":_e.getImage()&&(_e.getImage().getStroke().setColor(Z),_e.getImage().getStroke().setWidth((0,p.Q7)(s)*(3*_e.getImage().getStroke().getWidth()))),_e.getStroke()&&(_e.getStroke().setColor(Z),_e.getStroke().setWidth((0,p.Q7)(s)*(3*_e.getStroke().getWidth())));break;case"Polygon":_e.getImage()&&_e.getImage().getFill().setColor(Z),_e.getFill()&&_e.getFill().setColor(Z)}if(_e.setText(""),X.setStyle(_e),X.drawGeometry(I),M>this.options.animation.duration)return(0,a.S)(x),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(d){void 0===d?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(d)}setExtent(d){this.options.extent=d}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(d){this.visible&&this.flash(d.feature)}.bind(this))}enableTrackFeature(d){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,d))}centerMapOnFeature(d){const u=this.dataSource.ol.getFeatureById(d);u&&this.map.ol.getView().setCenter(u.getGeometry().getCoordinates())}trackFeature(d,u){u.feature.getId()===d&&this.visible&&this.centerMapOnFeature(d)}disableTrackFeature(d){(0,a.S)(this.trackFeatureListenerId)}customWFSLoader(d,u,x,U,G,X,D,I,M){{const s=u.paramsWFS,H=s.srsName?new R.c({code:s.srsName}):X,Z=o.W0(U,X,H),me=u.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==Z||this.previousLoadResolution&&this.previousLoadResolution!==G||this.previousOgcFilters&&this.previousOgcFilters!==me){d.removeLoadedExtent(this.previousLoadExtent);for(let le of this.xhrAccumulator)le.abort()}this.previousLoadExtent=Z,this.previousLoadResolution=G,this.previousOgcFilters=me,s.srsName=s.srsName||X.getCode();const _e=(0,T.yK)(u,Z,H,me,M);let de=0;if("2.0.0"===s.version&&s.maxFeatures>T.G4)for(;de<s.maxFeatures;){let ue=_e.replace("count="+s.maxFeatures,"count=1000");ue=ue.replace("startIndex=0","0"),ue+="&startIndex="+de,ue.replace(/&&/g,"&"),this.getFeatures(d,x,Z,H,X,ue,D,I),de+=1e3}else this.getFeatures(d,x,Z,H,X,_e,D,I)}}getFeatures(d,u,x,U,G,X,D,I){const M=new XMLHttpRequest,s=u.alterUrlWithKeyAuth(X);let H=X;s&&(H=s),M.open("GET",H),u&&u.interceptXhr(M,H);const Z=()=>{d.removeLoadedExtent(x),I()};M.onerror=Z,M.onload=()=>{if(200===M.status&&M.responseText.length>0){const me=d.getFormat().readFeatures(M.responseText,{dataProjection:U,featureProjection:G});me?(d.addFeatures(me),D(me)):D([])}else Z()},this.xhrAccumulator.push(M),M.send()}customLoader(d,u,x,U,G,X,D,I){const M=new XMLHttpRequest;let s=u;if("function"!=typeof u){const H=x.alterUrlWithKeyAuth(u);H&&(s=H)}if(this.geoNetworkService&&"function"!=typeof u){let me=d.getFormat().getType();const _e=()=>{d.removeLoadedExtent(U),I()},de={responseType:me};this.geoNetworkService.geoDBService.get(u).pipe((0,y.o)(750)).pipe((0,F.m)(le=>le?(0,S.of)(le):this.geoNetworkService.get(s,de).pipe((0,h.K)(),(0,W.a)(ue=>{throw _e(),ue})))).subscribe(le=>{if(le){const ue=d.getFormat(),ne=ue.getType();let ve;if("json"===ne||"text"===ne?ve=le:"xml"===ne?(ve=le,ve||(ve=(new DOMParser).parseFromString(le,"application/xml"))):"arraybuffer"===ne&&(ve=le),ve){const ye=ue.readFeatures(ve,{extent:U,featureProjection:X});d.addFeatures(ye),D(ye)}else _e()}})}else{M.open("GET",s);const H=d.getFormat();"arraybuffer"===H.getType()&&(M.responseType="arraybuffer"),x&&x.interceptXhr(M,s);const Z=()=>{d.removeLoadedExtent(U),I()};M.onerror=Z,M.onload=()=>{if(!M.status||M.status>=200&&M.status<300){const me=H.getType();let _e;if("json"===me||"text"===me?_e=M.responseText:"xml"===me?(_e=M.responseXML,_e||(_e=(new DOMParser).parseFromString(M.responseText,"application/xml"))):"arraybuffer"===me&&(_e=M.response),_e){const de=H.readFeatures(_e,{extent:U,featureProjection:X});d.addFeatures(de),D(de)}else Z()}else Z()},M.send()}}customIDBLoader(d,u,x,U,G,X){if(this.geoNetworkService){const D=()=>{d.removeLoadedExtent(x),X()};this.geoNetworkService.geoDBService.get(u).subscribe(I=>{if(I){const M=d.getFormat(),s=M.getType();let H;if("json"===s||"text"===s?H=I:"xml"===s?(H=I,H||(H=(new DOMParser).parseFromString(I,"application/xml"))):"arraybuffer"===s&&(H=I),H){const Z=M.readFeatures(H,{extent:x,featureProjection:U});d.addFeatures(Z,M.readProjection(H)),G(Z)}else D()}})}}}},29632:(Pe,ae,r)=>{"use strict";r.d(ae,{s:()=>a});var E=r(43168);class a extends E.WO{id;loaded=0;loading=0;source;messageService;constructor(p,e){super(),this.source=p.options.source.ol,this.id=(0,E.uq)(),this.messageService=e}watch(){this.source.on("imageloadstart",p=>this.handleLoadStart(p)),this.source.on("imageloadend",p=>this.handleLoadEnd(p)),this.source.on("imageloaderror",p=>this.handleLoadEnd(p)),this.source.on("imageloaderror",p=>this.handleLoadError(p))}unwatch(){this.source.un("imageloadstart",p=>this.handleLoadStart(p)),this.source.un("imageloadend",p=>this.handleLoadEnd(p)),this.source.un("imageloaderror",p=>this.handleLoadEnd(p)),this.source.un("imageloaderror",p=>this.handleLoadError(p))}handleLoadStart(p){p.image.__watchers__||(p.image.__watchers__=[]),p.image.__watchers__.push(this.id),this.loading+=1,this.status=E.qM.Working}handleLoadEnd(p){if(!p.image.__watchers__)return;const e=p.image.__watchers__.indexOf(this.id);if(e<0)return;p.image.__watchers__.splice(e,1),this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=E.qM.Done,this.loaded=this.loading=0)}handleLoadError(p){p.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:p.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=E.qM.Error)}}},48004:(Pe,ae,r)=>{"use strict";r.d(ae,{e:()=>a});var E=r(43168);class a extends E.WO{id;loaded=0;loading=0;source;constructor(p){super(),this.source=p.options.source.ol,this.id=(0,E.uq)()}watch(){this.source.on("tileloadstart",p=>this.handleLoadStart(p)),this.source.on("tileloadend",p=>this.handleLoadEnd(p)),this.source.on("tileloaderror",p=>this.handleLoadEnd(p))}unwatch(){this.source.un("tileloadstart",p=>this.handleLoadStart(p)),this.source.un("tileloadend",p=>this.handleLoadEnd(p)),this.source.un("tileloaderror",p=>this.handleLoadEnd(p))}handleLoadStart(p){p.tile.__watchers__||(p.tile.__watchers__=[]),p.tile.__watchers__.push(this.id),this.loading+=1,this.status=E.qM.Working}handleLoadEnd(p){if(!p.tile.__watchers__)return;const e=p.tile.__watchers__.indexOf(this.id);if(e<0)return;p.tile.__watchers__.splice(e,1),this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=E.qM.Done,this.loaded=this.loading=0)}}},84052:(Pe,ae,r)=>{"use strict";r.d(ae,{w:()=>w});var E=r(43168),a=r(93176);class w extends E.WO{id;loaded=0;loading=0;layer;constructor(e){super(),this.layer=e,this.id=(0,E.uq)()}watch(){let e=this.layer.options.source.ol;this.layer.dataSource instanceof a.a&&(e=this.layer.options.source.options.source),e.getUrl()&&(e.on("featuresloadstart",c=>this.handleLoadStart(c)),e.on("featuresloadend",c=>this.handleLoadEnd(c)),e.on("featuresloaderror",c=>this.handleLoadEnd(c)))}unwatch(){let e=this.layer.options.source.ol;this.layer.dataSource instanceof a.a&&(e=this.layer.options.source.options.source),e.getUrl()&&(e.un("featuresloadstart",c=>this.handleLoadStart(c)),e.un("featuresloadend",c=>this.handleLoadEnd(c)),e.un("featuresloaderror",c=>this.handleLoadEnd(c)))}handleLoadStart(e){this.loading+=1,this.status=E.qM.Working}handleLoadEnd(e){this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=E.qM.Done,this.loaded=this.loading=0)}}},48920:(Pe,ae,r)=>{"use strict";r.d(ae,{Q:()=>J});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(20460),c=r(56264),R=(r(89500),r(53291));function L(){return(0,R.gV)("baseLayerSwitcherState",[(0,R.K2)("collapseIcon",(0,R.wb)({height:"40px",width:"40px",overflow:"hidden"})),(0,R.K2)("collapseMap",(0,R.wb)({height:"80px",overflow:"hidden"})),(0,R.K2)("expand",(0,R.wb)({overflow:"hidden"})),(0,R.aK)("collapse => expand",(0,R.Cs)("200ms")),(0,R.aK)("expand => collapse",(0,R.Cs)("200ms"))])}var _=r(60192),C=r(34896),S=r(72584);function P(T,Q){1&T&&(C.I0R(0,"div",6)(1,"button",7),C.wVc(2,"translate"),C.I0R(3,"mat-icon"),C.OEk(4,"photo_library"),C.C$Y()()()),2&T&&(C.yG2(),C.E7m("matTooltip",C.kDX(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function y(T,Q){if(1&T&&(C.wR5(0,"igo-mini-basemap",8),C.wVc(1,"translate")),2&T){const z=Q.$implicit,Y=Q.index,N=C.GaO(2);C.E7m("map",N.map)("baseLayer",z)("title",N.baseLayers.length>2&&!N.expand?C.kDX(1,5,"igo.geo.baselayersSwitcher.title"):z.title)("display",N.expand||0===Y&&!N.useStaticIcon)("disabled",!N.expand&&N.baseLayers.length>1)}}function F(T,Q){1&T&&(C.I0R(0,"div",9)(1,"mat-icon",10),C.OEk(2,"arrow_drop_down"),C.C$Y()())}const h=T=>({"container-expand":T});function W(T,Q){if(1&T){const z=C.KQA();C.I0R(0,"div",1),C.qCj("@baseLayerSwitcherState.start",function(){C.usT(z);const N=C.GaO();return C.CGJ(N.showButton=!1)})("@baseLayerSwitcherState.done",function(){C.usT(z);const N=C.GaO();return C.CGJ(N.showButton=!0)})("click",function(){C.usT(z);const N=C.GaO();return C.CGJ(N.collapseOrExpand())}),C.yuY(1,P,5,3,"div",2),C.I0R(2,"div",3),C.yuY(3,y,2,7,"igo-mini-basemap",4),C.C$Y(),C.yuY(4,F,3,0,"div",5),C.C$Y()}if(2&T){const z=C.GaO();C.E7m("ngClass",C.S45(5,h,z.expand))("@baseLayerSwitcherState",z.expand?"expand":z.useStaticIcon?"collapseIcon":"collapseMap"),C.yG2(),C.E7m("ngIf",z.useStaticIcon&&!z.expand&&z.showButton),C.yG2(2),C.E7m("ngForOf",z.baseLayers),C.yG2(),C.E7m("ngIf",z.hasMoreThanTwo)}}let J=(()=>{class T{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(z){this.mediaService=z,this.mediaService.media$.value===c.oZ.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(z=>{this._baseLayers=z.filter(Y=>Y.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!(!this.hasMoreThanTwo&&!this.useStaticIcon||this.expand)}get baseLayers(){const z=this.map.viewController.getResolution(),Y=this.map.viewController.getZoom(),N=this._baseLayers.filter(j=>(!j.options.maxResolution||z<=j.options.maxResolution)&&(!j.options.minResolution||z>=j.options.minResolution)&&(!j.options.source.options.maxZoom||Y<=j.options.source.options.maxZoom)&&(!j.options.source.options.minZoom||Y>=j.options.source.options.minZoom)),K=N.filter(j=>!j.visible);return K.length+1===N.length?K:N}static \u0275fac=function(Y){return new(Y||T)(C.GI1(c.QB))};static \u0275cmp=C.In1({type:T,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},standalone:!0,features:[C.UHJ],decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary",1,"material-icons","mat-icon"]],template:function(Y,N){1&Y&&C.yuY(0,W,5,7,"div",0),2&Y&&C.E7m("ngIf",N.baseLayers.length>0)},dependencies:[E.u_,E.QF,a.oJ,a.um,p.KO,p.a4,w.oB,w.qL,E.Iw,_._,e._s,S.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"],data:{animation:[L()]}})}return T})()},60192:(Pe,ae,r)=>{"use strict";r.d(ae,{_:()=>L});var E=r(65056),w=(r(99228),r(7036)),p=r(9364),e=r(89500),c=r(34896);function o(_,C){if(1&_&&(c.I0R(0,"div",5),c.OEk(1),c.C$Y()),2&_){const S=c.GaO(2);c.yG2(),c.cNF(S.title)}}function R(_,C){if(1&_){const S=c.KQA();c.I0R(0,"div",2),c.qCj("click",function(){c.usT(S);const y=c.GaO();return c.CGJ(y.changeBaseLayer(y.baseLayer))}),c.wR5(1,"igo-map-browser",3),c.yuY(2,o,2,1,"div",4),c.C$Y()}if(2&_){const S=c.GaO();c.yG2(),c.E7m("map",S.basemap),c.yG2(),c.E7m("ngIf",S.title)}}let L=(()=>{class _{layerService;appRef;map;disabled;title;get display(){return this._display}set display(S){this._display=S,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(S){this._baseLayer=S,this.handleBaseLayerChanged(S)}_baseLayer;basemap=new e.y({controls:{},interactions:!1});constructor(S,P){this.layerService=S,this.appRef=P}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",S=>{this.handleMainMapViewChange(S.target)}),this.map.ol.on("pointerdrag",S=>{this.handleMainMapViewChange(S.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",S=>{this.handleMainMapViewChange(S.target)}),this.map.ol.un("pointerdrag",S=>{this.handleMainMapViewChange(S.target.getView())})}changeBaseLayer(S){this.disabled||(this.map.changeBaseLayer(S),this.appRef.tick())}handleMainMapViewChange(S){const P=S.getProperties();this.basemap.viewController.olView.setResolution(P.resolution),this.basemap.viewController.olView.setRotation(P.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(S){this.basemap.removeAllLayers();const P=Object.assign(Object.create(S.options),S.options,{visible:!0,baseLayer:!1}),y=this.layerService.createLayer(P);this.basemap.addLayer(y),this.handleLinkedBaseLayer(y)}handleLinkedBaseLayer(S){const P=S.options.linkedLayers;if(!P)return;const y=P.links;y&&y.map(h=>{h.linkedIds.map(W=>{const J=this.map.layers.find(T=>T.options.linkedLayers?.linkId===W);if(J){const T=Object.assign(Object.create(J.options),J.options,{zIndex:9e3,visible:J.options.linkedLayers?.showInMiniBaseMap??!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(T))}})})}static \u0275fac=function(P){return new(P||_)(c.GI1(w.I),c.GI1(c.Swk))};static \u0275cmp=c.In1({type:_,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},standalone:!0,features:[c.UHJ],decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(P,y){1&P&&(c.I0R(0,"div",0),c.yuY(1,R,3,2,"div",1),c.C$Y()),2&P&&(c.yG2(),c.E7m("ngIf",y.display))},dependencies:[E.u_,p.q],styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"],changeDetection:0})}return _})()},42860:(Pe,ae,r)=>{"use strict";r.d(ae,{c:()=>S});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(45872),c=r(20460),o=r(54844),L=(r(89500),r(34896)),_=r(72584);function C(P,y){if(1&P){const F=L.KQA();L.I0R(0,"div",1)(1,"button",2),L.qCj("click",function(){L.usT(F);const W=L.GaO();return L.CGJ(W.onGeolocationClick())}),L.wVc(2,"translate"),L.wVc(3,"translate"),L.I0R(4,"mat-icon"),L.OEk(5),L.wVc(6,"async"),L.C$Y()()()}if(2&P){const F=L.GaO();L.yG2(),L.E7m("matTooltip",F.map.geolocationController.tracking?L.kDX(2,3,"igo.geo.mapButtons.geolocateInactive"):L.kDX(3,5,"igo.geo.mapButtons.geolocate"))("color",F.color),L.yG2(4),L.cNF(L.kDX(6,7,F.icon$))}}let S=(()=>{class P{configService;tracking$$;icon$=new o.g("my_location");get map(){return this._map}set map(F){this._map=F}_map;get color(){return this._color}set color(F){this._color=F}_color;constructor(F){this.configService=F}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(F=>{F||this.configService.getConfig("geolocate.basic")?this.icon$.next("my_location"):this.icon$.next("location_searching")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}static \u0275fac=function(h){return new(h||P)(L.GI1(e.aW))};static \u0275cmp=L.In1({type:P,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[L.UHJ],decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"]],template:function(h,W){1&h&&L.yuY(0,C,7,9,"div",0),2&h&&L.E7m("ngIf",W.map.geolocationController)},dependencies:[E.u_,a.oJ,a.um,p.KO,p.a4,w.oB,w.qL,E.a,c._s,_.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return P})()},34419:(Pe,ae,r)=>{"use strict";r.d(ae,{e:()=>_});var E=r(34672),a=r(32328),w=r(27e3),p=r(45872),e=r(20460),c=r(61252),R=(r(89500),r(34896)),L=r(72584);let _=(()=>{class C{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(P){this.configService=P,this.computeHomeExtent()}computeHomeExtent(){const P=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||P?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||P?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||P?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const P=c.QH(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(P),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(y){return new(y||C)(R.GI1(p.aW))};static \u0275cmp=R.In1({type:C,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},standalone:!0,features:[R.UHJ],decls:5,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"]],template:function(y,F){1&y&&(R.I0R(0,"div",0)(1,"button",1),R.qCj("click",function(){return F.onToggleClick()}),R.wVc(2,"translate"),R.I0R(3,"mat-icon"),R.OEk(4,"home"),R.C$Y()()()),2&y&&(R.yG2(),R.E7m("matTooltip",R.kDX(2,2,"igo.geo.mapButtons.home-extent"))("color",F.color))},dependencies:[E.oJ,E.um,w.KO,w.a4,a.oB,a.qL,e._s,L.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return C})()},34080:(Pe,ae,r)=>{"use strict";r.d(ae,{cd:()=>e.c,eq:()=>c.e,yG:()=>E.yG,Y1:()=>y.Y,q2:()=>a.q,u0:()=>E.u0,kn:()=>E.kn,qM:()=>E.qM,i6:()=>C.i,w1:()=>R.w,qc:()=>w.q,KG:()=>E.KG,rE:()=>E.rE,uE:()=>E.uE,Sc:()=>E.Sc,ET:()=>E.ET,KM:()=>E.KM});var E=r(85308),a=r(9364),w=r(75872),e=(r(78416),r(42860)),c=r(34419),R=(r(65972),r(50208)),C=(r(48920),r(60192),r(76332)),y=(r(72124),r(55452),r(94440))},94440:(Pe,ae,r)=>{"use strict";r.d(ae,{Y:()=>p});var E=r(65056),a=r(34896);function w(e,c){if(1&e&&(a.I0R(0,"div",1)(1,"pre"),a.OEk(2),a.C$Y()()),2&e){const o=a.GaO();a.yG2(2),a.cNF(o.infoContent)}}let p=(()=>{class e{infoContent="";constructor(){}static \u0275fac=function(R){return new(R||e)};static \u0275cmp=a.In1({type:e,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},standalone:!0,features:[a.UHJ],decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(R,L){1&R&&a.yuY(0,w,3,1,"div",0),2&R&&a.E7m("ngIf",L.infoContent&&L.infoContent.length)},dependencies:[E.u_],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]})}return e})()},9364:(Pe,ae,r)=>{"use strict";r.d(ae,{q:()=>c});var E=r(24956),a=r(43168),p=(r(89500),r(34896));const e=["*"];let c=(()=>{class o{activityService;activityId;status$$;map;get view(){return this._view}set view(L){this._view=L,void 0!==this.map&&this.map.updateView(L)}_view;get controls(){return this._controls}set controls(L){this._controls=L,void 0!==this.map&&this.map.updateControls(L)}_controls;id=`igo-map-target-${(0,a.uq)()}`;constructor(L){this.activityService=L}ngOnInit(){this.status$$=this.map.status$.subscribe(L=>this.handleStatusChange(L))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(L){L===a.qM.Working&&void 0===this.activityId?this.activityId=this.activityService.register():L===a.qM.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(_){return new(_||o)(p.GI1(E.U9))};static \u0275cmp=p.In1({type:o,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},standalone:!0,features:[p.UHJ],ngContentSelectors:e,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(_,C){1&_&&(p.kPM(),p.wR5(0,"div",0),p._Xx(1)),2&_&&p.E7m("id",C.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]})}return o})()},55452:(Pe,ae,r)=>{"use strict";r.d(ae,{O:()=>w}),r(89500);var a=r(34896);let w=(()=>{class p{map;displayCenter$$;constructor(){}ngAfterViewInit(){this.map&&(this.displayCenter$$=this.map.mapCenter$.subscribe(c=>{document.getElementById("mapCenter").style.visibility=c?"visible":"hidden"})),this.letZoom()}ngOnDestroy(){this.displayCenter$$&&this.displayCenter$$.unsubscribe()}letZoom(){document.getElementById("mapCenter").addEventListener("wheel",c=>{c.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(o){return new(o||p)};static \u0275cmp=a.In1({type:p,selectors:[["igo-map-center"]],inputs:{map:"map"},standalone:!0,features:[a.UHJ],decls:3,vars:0,consts:[["id","mapCenter",1,"mapCenter"],[1,"vertical"],[1,"horizontal"]],template:function(o,R){1&o&&(a.I0R(0,"div",0),a.wR5(1,"div",1)(2,"div",2),a.C$Y())},styles:[".mapCenter[_ngcontent-%COMP%]{width:30px;height:30px;position:absolute;top:50%;left:50%;transform:translate(-15px,-15px);pointer-events:none}.mapCenter[_ngcontent-%COMP%]   .vertical[_ngcontent-%COMP%], .mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{width:4px;height:30px;position:absolute;left:13px;background-color:#000}.mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{transform:rotate(90deg)}"]})}return p})()},78416:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>L});var E=r(65056),a=r(34896),w=r(34672),p=r(32328),e=r(27e3),c=r(45872),o=r(20460),R=r(72584);let L=(()=>{class _{configService;get sidenavOpened(){return this._sidenavOpenend}set sidenavOpened(S){this._sidenavOpenend=S,this.getClassMenuButton()}_sidenavOpenend;openSidenav=new a._w7;useThemeColor;menuButtonClass;constructor(S){this.configService=S;const P=this.configService.getConfig("menu.button.useThemeColor");this.useThemeColor=void 0!==P&&P}getClassMenuButton(){this.menuButtonClass={"menu-button-white-background":!this.useThemeColor}}onToggleSidenavClick(){this.openSidenav.emit()}static \u0275fac=function(P){return new(P||_)(a.GI1(c.aW))};static \u0275cmp=a.In1({type:_,selectors:[["igo-menu-button"]],inputs:{sidenavOpened:"sidenavOpened"},outputs:{openSidenav:"openSidenav"},standalone:!0,features:[a.UHJ],decls:4,vars:4,consts:[["mat-icon-button","","id","menu-button","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"]],template:function(P,y){1&P&&(a.I0R(0,"button",0),a.qCj("click",function(){return y.onToggleSidenavClick()}),a.wVc(1,"translate"),a.I0R(2,"mat-icon"),a.OEk(3,"menu"),a.C$Y()()),2&P&&a.E7m("ngClass",y.menuButtonClass)("matTooltip",a.kDX(1,2,y.sidenavOpened?"menu.close":"menu.open"))},dependencies:[w.oJ,w.um,E.QF,e.KO,e.a4,p.oB,p.qL,o._s,R.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}"]})}return _})()},65972:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>_});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(20460),o=(r(89500),r(34896)),R=r(72584);const L=C=>[C];let _=(()=>{class C{btnStyle="onlineStyle";map;color;enabled=!1;constructor(){}ngOnInit(){this.map.forcedOffline$.next(this.enabled)}onClick(){this.enabled=!this.enabled,this.handleButtonStyle(),this.map.forcedOffline$.next(this.enabled)}handleButtonStyle(){this.btnStyle=this.enabled?"offlineStyle":"onlineStyle"}static \u0275fac=function(y){return new(y||C)};static \u0275cmp=o.In1({type:C,selectors:[["igo-offline-button"]],inputs:{map:"map",color:"color",enabled:"enabled"},standalone:!0,features:[o.UHJ],decls:6,vars:9,consts:[[1,"igo-user-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","ngClass","color","click"]],template:function(y,F){1&y&&(o.I0R(0,"div",0)(1,"button",1),o.qCj("click",function(){return F.onClick()}),o.wVc(2,"translate"),o.wVc(3,"translate"),o.I0R(4,"mat-icon"),o.OEk(5,"wifi_off"),o.C$Y()()()),2&y&&(o.yG2(),o.E7m("matTooltip",F.enabled?o.kDX(2,3,"igo.geo.mapButtons.online"):o.kDX(3,5,"igo.geo.mapButtons.offline"))("ngClass",o.S45(7,L,F.btnStyle))("color",F.enabled?F.color:null))},dependencies:[a.oJ,a.um,p.KO,p.a4,E.QF,w.oB,w.qL,e._s,R.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .offlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#b9b9b9}"]})}return C})()},76332:(Pe,ae,r)=>{"use strict";r.d(ae,{i:()=>P});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(20460),c=r(72855),o=r(54844),L=(r(89500),r(34896)),_=r(72584);const C=(y,F)=>({azimuth:y,rotation:F});function S(y,F){if(1&y){const h=L.KQA();L.I0R(0,"div",1),L.wVc(1,"async"),L.wVc(2,"translate"),L.wVc(3,"translate"),L.I0R(4,"button",2),L.qCj("click",function(){L.usT(h);const J=L.GaO();return L.CGJ(J.map.viewController.resetRotation())}),L.wVc(5,"async"),L.I0R(6,"mat-icon",3),L.wVc(7,"async"),L.OEk(8,"navigation "),L.C$Y()()()}if(2&y){const h=L.GaO();L.E7m("matTooltip",L.kDX(1,4,h.rotated$)?L.g7$(2,6,"igo.geo.mapButtons.resetRotation",L.IBC(15,C,h.azimuthRounded,h.rotationRounded)):L.kDX(3,9,"igo.geo.mapButtons.tipRotation")),L.yG2(4),L.E7m("color",h.color)("disabled",!1===L.kDX(5,11,h.rotated$)),L.yG2(2),L.E7m("ngStyle",L.kDX(7,13,h.currentStyle$))}}let P=(()=>{class y{rotated$=new o.g(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new o.g({transform:"rotate(0rad)"});map;showIfNoRotation;color;constructor(){}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(h=>{const W=h||0,J=180*W/Math.PI;this.rotationRounded=Math.round(J),this.azimuthRounded=Math.round((0,c.g9)(-1*J)),this.currentStyle$.next({transform:"rotate("+W+"rad)"}),this.rotated$.next(0!==W)})}static \u0275fac=function(W){return new(W||y)};static \u0275cmp=L.In1({type:y,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},standalone:!0,features:[L.UHJ],decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],[3,"ngStyle"]],template:function(W,J){1&W&&(L.yuY(0,S,9,18,"div",0),L.wVc(1,"async")),2&W&&L.E7m("ngIf",L.kDX(1,1,J.rotated$)&&!J.showIfNoRotation||J.showIfNoRotation)},dependencies:[E.u_,p.KO,p.a4,a.oJ,a.um,w.oB,w.qL,E.Qt,E.a,e._s,_.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return y})()},86908:(Pe,ae,r)=>{"use strict";r.d(ae,{G:()=>a});var E=r(83552);class a{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(p){if(void 0!==p&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===p)return this.teardownObservers(),void(this.olMap=p);this.olMap=p}teardownObservers(){this.observerKeys.forEach(p=>(0,E.S)(p)),this.observerKeys=[]}}},89019:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>E});var E=function(a){return a.Position="position",a.PositionDirection="positionDirection",a.Accuracy="accuracy",a.Buffer="buffer",a}(E||{})},42364:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>Y});var E=r(58264),a=r(2296),w=r(80848),p=r(28668),e=r(36752),c=r(61252),o=r(49412),R=r(54776),L=r(87544),_=r(88872),C=r(45212),S=r(62632),P=r(71888),y=r(54844),F=r(74092),h=r(19432),W=r(68392),J=r(14672),T=r(36404),Q=r(86908),z=r(89019);class Y extends Q.G{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new R.cp({image:new L.c({radius:6,fill:new _.c({color:"#3399CC"}),stroke:new C.c({color:"#fff",width:2})})});accuracyFeatureStyle=new R.cp({stroke:new C.c({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new _.c({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new R.cp({stroke:new C.c({width:2,color:this.buffer.bufferStroke}),fill:new _.c({color:this.buffer.bufferFill}),text:new S.c({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new _.c({color:"#000"}),stroke:new C.c({color:"#fff",width:3})})})}get arrowStyle(){return new R.cp({image:new P.c({radius:5.5,fill:new _.c({color:"rgba(0, 132, 202)"}),stroke:new C.c({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new y.g(5);position$=new y.g(void 0);tracking$=new y.g(void 0);followPosition$=new y.g(void 0);lastPosition;set buffer(K){this._buffer=K,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(K){this._accuracyThreshold=K,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(K){this.geolocation.setTracking(K||!1),this.tracking$.next(K),this.storageService&&void 0!==K&&this.storageService.set("geolocation.tracking",K),K||this.position$.next(void 0)}set followPosition(K){this._followPosition=K,this.followPosition$.next(K),!1===this.configService?.getConfig("geolocate.followPosition")&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==K&&this.storageService.set("geolocation.followPosition",K)}get followPosition(){return this._followPosition}_followPosition;constructor(K,j,A,d){super(),this.map=K,this.options=j,this.storageService=A,this.configService=d,this.geolocationOverlay=new T.m(this.map),this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(K){super.setOlMap(K),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(z.I.Position),this.deleteFeatureByType(z.I.PositionDirection),this.deleteFeatureByType(z.I.Accuracy),this.deleteFeatureByType(z.I.Buffer)}setupObservers(){this.tracking$.subscribe(j=>{j?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new a.c({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let K=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,h.G)(j=>(0,F.I)(1e3*j))).subscribe(()=>{K===this.tracking?this.onPositionChange(!0):(K=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",j=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(K){const j=c.AF(K.position,K.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:j,dateTime:new Date});const A=this.getFeatureByType(z.I.PositionDirection),d=K?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,j)>.003;if(K.accuracy<=this.accuracyThreshold&&d){var U=Math.atan2(j[0]-this.lastPosition.coordinates[0],j[1]-this.lastPosition.coordinates[1]);U<0&&(U=2*Math.PI+U),this.arrowRotation=U,A&&A.setStyle(this.arrowStyle),this.lastPosition={coordinates:j,dateTime:new Date}}else A&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&(0,J.gV)(A)}distanceBetweenPoints(K,j){return o.c$(K,j)/1e3}addOnChangedListener(K){let j=()=>{K(this.geolocation)};return this.geolocation.on("change",j),j}deleteChangedListener(K){this.geolocation.un("change",K)}updateGeolocationOptions(K){if(!K)return;let j=K.geolocate,A=K.alwaysTracking;if(this.storageService){const d=this.storageService.get("geolocation.tracking");null!=d&&(j=d);const u=this.storageService.get("geolocation.followPosition");null!=u&&(A=u)}this.tracking=j,this.followPosition=A,this.buffer=K.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(K=>K.unsubscribe()),super.teardownObservers()}onPositionChange(K=!1,j=!1){if(!this.tracking)return;const A=this.geolocation.getProperties();if(A.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const d={position:A.position,projection:this.geolocation.getProjection().getCode(),accuracy:A.accuracy,altitude:A.altitude,altitudeAccuracy:A.altitudeAccuracy,heading:A.heading,speed:A.speed,enableHighAccuracy:!!A.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(d),this.handleViewFromFeatures(d,j),K&&this.position$.next(d)}getFeatureByType(K){return this.geolocationOverlay.dataSource.ol.getFeatureById(K)}deleteFeatureByType(K){const j=this.geolocationOverlay?.dataSource.ol.getFeatureById(K);j&&this.geolocationOverlay.dataSource.ol.removeFeature(j)}handleFeatureCreation(K){if(!K||!K.position)return;const j=new w.c(K.position),A=(0,e.IH)(new p.c(K.position,K.accuracy||0));let d=this.getFeatureByType(z.I.Position),u=this.getFeatureByType(z.I.PositionDirection),x=this.getFeatureByType(z.I.Accuracy);const U=!!d,G=!!u,X=!!x;if(G||(u=new E.c({geometry:j}),u.setId(z.I.PositionDirection),(0,J.gV)(u)),U||(d=new E.c({geometry:j}),d.setId(z.I.Position),d.setStyle(this.positionFeatureStyle)),X||(x=new E.c({geometry:A}),x.setId(z.I.Accuracy),x.setStyle(this.accuracyFeatureStyle)),j&&(U?d.setGeometry(j):this.geolocationOverlay.addOlFeature(d,W.S.None),G?u.setGeometry(j):this.geolocationOverlay.addOlFeature(u,W.S.None),this.updateArrowFeatureOrientation(K),X?x.setGeometry(A):this.geolocationOverlay.addOlFeature(x,W.S.None),this.buffer)){let D=this.getFeatureByType(z.I.Buffer);const I=!!D,M=new p.c(K.position,this.buffer.bufferRadius);I||(D=new E.c(M),D.setId(z.I.Buffer),D.setStyle(this.positionFeatureStyle)),D.setStyle(this.bufferStyle),I?D.setGeometry(M):this.geolocationOverlay.addOlFeature(D,W.S.None)}}handleViewFromFeatures(K,j=!1){const U=[this.getFeatureByType(z.I.Position),this.getFeatureByType(z.I.PositionDirection),this.getFeatureByType(z.I.Accuracy),this.getFeatureByType(z.I.Buffer)].filter(G=>G);if(U.length>0){const G=(0,J.q1)(U,this.map.viewProjection),X=K?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],D=(0,J.Ki)(this.map.getExtent(),G,X);let I=this.followPosition&&D?W.S.Move:W.S.None;j&&(I=W.S.Zoom),I!==W.S.None&&(0,J.QX)(this.map.viewController,U,I)}}}},87272:(Pe,ae,r)=>{"use strict";r.d(ae,{c:()=>L});var E=r(44876),a=r(61252),w=r(54844),p=r(61616),e=r(24112),c=r(93836),o=r(59324),R=r(86908);class L extends R.G{options;rotation$=new w.g(0);resolution$=new w.g(void 0);state$=new w.g(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new p.E;extent$$;states=[];stateIndex=0;get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}constructor(C){super(),this.options=C}setPadding(C){(C.top||0===C.top)&&(this.padding[0]=C.top),(C.right||0===C.right)&&(this.padding[1]=C.right),(C.bottom||0===C.bottom)&&(this.padding[2]=C.bottom),(C.left||0===C.left)&&(this.padding[3]=C.left)}setOlMap(C){super.setOlMap(C),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",C=>this.onMoveEnd(C))),this.extent$$=this.extent$.pipe((0,e.o)(25)).subscribe(C=>{this.setExtent(C.extent,C.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",C=>{this.rotation$.next(C.target.getRotation())})),this.rotation$.next(this.getRotation())}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(C){let S=this.olView.getCenter();return C&&S&&(S=a.AF(S,this.getOlProjection(),C)),S}getExtent(C){let S=this.olView.calculateExtent(this.olMap.getSize());return C&&S&&(S=a.W0(S,this.getOlProjection(),C)),S}getScale(C=96){return(0,o.iC)(this.getResolution(),this.getOlProjection().getUnits(),C)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(C){this.olView.cancelAnimations(),this.olView.animate({zoom:C,duration:250,easing:E.Q7})}moveToExtent(C){this.extent$.next({extent:C,action:c.a.Move})}zoomToExtent(C){this.extent$.next({extent:C,action:c.a.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(C,S,P=!0){const y=this.olView;y.cancelAnimations();const F=P?500:0,h=y.getZoom(),W=y.getCenter(),J=[C[0]+(C[2]-C[0])/2,C[1]+(C[3]-C[1])/2],T=Math.sqrt(Math.pow(W[0]-J[0],2)+Math.pow(W[1]-J[1],2)),Q=y.calculateExtent(),z=Math.sqrt(Math.pow(Q[2]-Q[0],2)+Math.pow(Q[3]-Q[1],2)),K=T/((Math.sqrt(Math.pow(C[2]-C[0],2)+Math.pow(C[3]-C[1],2))+z)/2),j=S===c.a.Move||h>this.maxZoomOnExtent?h:this.maxZoomOnExtent;y.fit(C,{size:this.olMap.getSize(),maxZoom:j,padding:this.padding,duration:K>4?0:F,callback:A=>{A||y.fit(C,{size:this.olMap.getSize(),maxZoom:j,padding:this.padding,duration:K>4?0:F})}})}setStateIndex(C){this.stateIndex=C,this.setState(this.states[C])}setState(C){this.olView.animate({resolution:C.resolution,center:C.center,duration:0})}onMoveEnd(C){const S=this.getResolution();this.resolution$.value!==S&&this.resolution$.next(S);const P={resolution:S,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const y=this.stateIndex;(0,o.Ko)(P,0===this.states.length?void 0:this.states[y])||(this.states=this.states.slice(0,y+1).concat([P]),this.stateIndex=this.states.length-1)}this.state$.next(P)}}},87159:(Pe,ae,r)=>{"use strict";r.d(ae,{C:()=>N});var E=r(87040),a=r(56264),w=r(43168),p=r(58264),e=r(83552),c=r(80848),o=r(36752),R=r(62808),L=r(53156),_=r(28184),C=r(24328),S=r(19076),P=r(83680),y=r(90112),F=r(70524),h=r(68392),W=r(40240),J=r(56708),T=r(9364),Q=r(59800),z=r(82048),Y=r(34896);let N=(()=>{class K{component;mediaService;styleService;store;pointerHoverFeatureStore=new E.qc([]);lastTimeoutRequest;store$$;layers$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(A,d,u){this.component=A,this.mediaService=d,this.styleService=u}ngOnInit(){this.map.status$.pipe((0,P.K)(A=>A===w.qM.Done)).subscribe(()=>{this.store=new W.y([],{map:this.map}),this.initStore(),this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick()}),this.layers$$=this.map.layers$.subscribe(A=>{this.store&&!A.find(d=>"hoverFeatureId"===d.id)&&this.initStore()})}initStore(){const A=this.store,d=new J.Md({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new y.E,showInLayerList:!1,exportable:!1,browsable:!1,style:Q._o});(0,F.m)(A,d),this.selectionLayer=new _.c({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new S.c({projection:this.map.projection}),style:(u,x)=>{if(this.mvtStyleOptions&&u.getId()in this.selectionMVT)return this.createHoverStyle(u,this.mvtStyleOptions,x)}})}createHoverStyle(A,d,u){const x={...d};let U=d.label?d.label.attribute:void 0,G=!!d.label?.style;if(A.get("_isLabel")){const X=x.data?x.data.length:0,D=[],I=[],M=[],s=[];for(let H=0;H<X;H++)D.push(0),I.push("rgba(255, 255, 255, 0)"),M.push(0),s.push("rgba(255, 255, 255, 0)");x.radius=D,x.stroke=I,x.width=M,x.fill=s}else x.label=void 0,G=!1,U=void 0;return!G&&U&&(x.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(A,x,u)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(A=>{this.addFeatureOverlay(A)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",A=>this.onMapEvent(A))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",A=>this.onMapSingleClickEvent(A))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,e.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,e.S)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(A){this.clearLayer()}onMapEvent(A){if(A.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let u,d=-1/0;const x=this.map.ol.getPixelFromCoordinate(A.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(x,(U,G)=>{if(!G)return;const X=this.map.getLayerByOlUId(G.ol_uid);this.canProcessHover(X)&&(X.zIndex<=d||(d=X.zIndex,u=G))},{hitTolerance:10,layerFilter:U=>U instanceof L.c||U instanceof _.c}),!u)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(x,(U,G)=>{if(void 0===U.get("hoverSummary")&&U.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){let X;if(this.clearLayer(),G instanceof L.c){const D=this.map.getLayerByOlUId(G.ol_uid);if(!this.canProcessHover(D))return;let I=this.handleRenderFeature(U);this.setLayerStyleFromOptions(D,I);const M=[I];I.set("_isLabel",!1);const s=new p.c;s.setProperties(I.getProperties());const H="Point"===I.getGeometry().getType()?I.getGeometry():new c.c(A.coordinate);return s.setGeometry(H),s.setId(I.getId()),s.set("_isLabel",!0),this.setLayerStyleFromOptions(D,s),M.push(s),this.pointerHoverFeatureStore.load(M),X=D,!0}if(G instanceof _.c){const D=this.map.getLayerByOlUId(G.ol_uid);if(!this.canProcessHover(D))return;D?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=D.options.igoStyle.styleByAttribute.hoverStyle:D?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=D.options.igoStyle.hoverStyle),this.selectionLayer.setSource(G.getSource()),G.getFeatures(A.pixel).then(I=>{if(!I.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const M=I[0];if(!M)return void this.clearLayer();let s=this.handleRenderFeature(M);s.set("_isLabel",!1);const H=new p.c;H.setProperties(s.getProperties());const Z="Point"===s.getGeometry().getType()?s.getGeometry():new c.c(A.coordinate);H.setGeometry(Z),H.setId(s.getId()),H.set("_isLabel",!0),this.setLayerStyleFromOptions(D,H),this.pointerHoverFeatureStore.load([H]),this.selectionMVT[M.getId()]=s,this.selectionLayer.changed()}),X=D}}},{hitTolerance:10,layerFilter:U=>U===u})},this.igoHoverFeatureDelay)}canProcessHover(A){return!(!A||!A.visible||!A.options||!A.options.igoStyle?.styleByAttribute&&!A.options.igoStyle?.hoverStyle||A.options.igoStyle?.styleByAttribute&&!A.options.igoStyle?.styleByAttribute.hoverStyle&&!A.options.igoStyle?.hoverStyle)}handleRenderFeature(A){let d;return A instanceof C.cp?(d=new p.c({geometry:this.getGeometry(A)}),d.setId(A.getId())):A instanceof p.c&&(d=A),d.setProperties(A.getProperties()),d}addFeatureOverlay(A){if(A.length>0){const d=A[0];this.clearLayer();const u=new p.c({geometry:d.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(d.getProperties())});this.store.setLayerOlFeatures([u],h.S.None)}}setLayerStyleFromOptions(A,d){const u=this.store.layer.map.viewController.getResolution();A?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(d,A.options.igoStyle.styleByAttribute.hoverStyle,u)):A?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(d,A.options.igoStyle.hoverStyle,u))}getHoverSummary(A){let d="";for(const[u,x]of Object.entries(A))!u.startsWith("_")&&"geometry"!==u&&(d+=`${u}: ${x}\n`);return d.length>=2?d.slice(0,-2):d}getGeometry(A){let d;if(A.getOrientedFlatCoordinates){const u=A.getOrientedFlatCoordinates(),x=[];switch(u.forEach((U,G)=>{G%2==0&&x.push([parseFloat(u[G]),parseFloat(u[G+1])])}),A.getType()){case"Point":d=new c.c(x);break;case"Polygon":d=new o.cp([x]);break;case"LineString":d=new R.c([x])}}else d=A.getGeometry();return d}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(d){return new(d||K)(Y.GI1(T.q,2),Y.GI1(a.QB),Y.GI1(z.U))};static \u0275dir=Y.Sc5({type:K,selectors:[["","igoHoverFeature",""]],hostBindings:function(d,u){1&d&&Y.qCj("mouseout",function(){return u.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"},standalone:!0})}return K})()},85308:(Pe,ae,r)=>{"use strict";r.d(ae,{yG:()=>E.y,u0:()=>w.u,kn:()=>c.k,qM:()=>R.q,KG:()=>S.KG,rE:()=>p.rE,bg:()=>p.bg,uE:()=>p.uE,Sc:()=>p.Sc,ET:()=>S.ET,KM:()=>S.KM});var E=r(89500),w=(r(93836),r(12268)),p=r(59324),c=(r(55760),r(50056)),R=(r(87159),r(16660)),S=(r(42364),r(89019),r(87272),r(7700));r(19724)},19724:(Pe,ae,r)=>{"use strict";r.d(ae,{GK:()=>W,S8:()=>J,UR:()=>L,aY:()=>P,m:()=>S,yP:()=>h});var E=r(56096),a=r(21808),w=r(40912),p=r(56708);function e(T){return T.options.linkedLayers}function c(T,Q){return T.layers.find(z=>z.options.linkedLayers?.linkId===Q)}function L(T,Q,z){let Y=Q,N=Y,K=!0;for(;K;)Y=N,N=_(T,Y,z),K=!!N;return K||function o(T,Q){let z=!1;const Y=e(T);return Y?.links&&(z=!!Y.links.find(K=>K.properties.includes(Q))),z}(Y,z)||(Y=void 0),K?N:Y}function _(T,Q,z){if(Q?.options.linkedLayers?.linkId){const Y=Q.options.linkedLayers.linkId;let N=T.layers.filter(K=>{const j=K.options.linkedLayers;if(j&&j.links)return j.links.find(d=>d.linkedIds.includes(Y)&&d.properties.includes(z))});return N.length>1&&console.warn(`Your layer ${Q.title||Q.id} must only have 1 parent (${N.map(K=>K.title||K.id)})\n            , The first parent (${N[0].title||N[0].id}) will be use to sync properties`),N[0]}}function C(T,Q,z){let Y=[];return Q?.options.linkedLayers?.links&&Q.options.linkedLayers.links.filter(N=>N.properties.includes(z)).map(N=>{Y=Y.concat(N.linkedIds)}),Y.map(N=>c(T,N))}function S(T,Q,z,Y){return C(T,Q,Y).map(K=>{z.push(K),C(T,K,Y)&&S(T,K,z,Y)}),z}function P(T,Q){let z=Q,Y=z,N=!0;for(;N;)z=Y,Y=y(T,z),N=!!Y;return N||function R(T){let Q=!1;const z=e(T);return z?.links&&(Q=!!z.links.find(N=>N.syncedDelete)),Q}(z)||(z=void 0),N?Y:z}function y(T,Q){if(Q.options.linkedLayers?.linkId){const z=Q.options.linkedLayers.linkId;let Y=T.layers.filter(N=>{const K=N.options.linkedLayers;if(K&&K.links)return K.links.find(A=>A.linkedIds.includes(z)&&A.syncedDelete)});return Y.length>1&&console.warn(`Your layer ${Q.title||Q.id} must only have 1 parent (${Y.map(N=>N.title||N.id)})\n          , The first parent (${Y[0].title||Y[0].id}) will be use to sync properties`),Y[0]}}function F(T,Q){let z=[];return Q?.options.linkedLayers?.links&&Q.options.linkedLayers.links.filter(Y=>Y.syncedDelete).map(Y=>{z=z.concat(Y.linkedIds)}),z.map(Y=>c(T,Y))}function h(T,Q,z){return F(T,Q).map(N=>{z.push(N),F(T,N)&&h(T,N,z)}),z}function W(T,Q){const z={},Y=Object.keys(p.aG);Y.map(N=>{z[p.aG[N]]=[]}),Q.filter(N=>e(N)).map(N=>{Y.map(K=>{const j=p.aG[K],A=L(T,N,j),u=z[j].map(x=>x.id);A&&!u.includes(A.id)&&z[j].push(A)})}),Object.keys(z).map(N=>{z[N].map(j=>j.ol.notify(N,void 0))})}function J(T,Q,z){if(!Q)return;const Y=new w.S;let N=!0,K=!0;const j=Q.key;let A;if("ogcFilters"===j?(N=!1,K=!0,A=z.dataSource.options.ogcFilters):"timeFilter"===j?(N=!1,K=!0,A=z.dataSource.options.timeFilter):(N=!0,K=!1,A=z.ol.get(j)),e(z)){let u=L(T,z,j);u||(u=z);const x=[u];S(T,u,x,j);let U=!1;const G=z.options.source.options.type,X=z.dataSource.options;x.map(D=>{if(z&&D&&(0,E.gV)(z.ol)!==(0,E.gV)(D?.ol)){const I=D.options.source.options.type;if(N)D.ol.set(j,A,!0),"visible"===j&&D.visible$.next(A),("minResolution"===j||"maxResolution"===j)&&(U=!0);else if(K)if("ogcFilters"===j){if(D.dataSource.setOgcFilters(A,!1),"wfs"===I&&D.ol.getSource().refresh(),"wms"===I){let M;"wfs"===G?M=Y.handleOgcFiltersAppliedValue(X,z.dataSource.options.fieldNameGeometry,void 0,T.viewController.getOlProjection()):"wms"===G&&(M=z.dataSource.ol.getParams().FILTER),D.dataSource.ol.updateParams({FILTER:M})}}else if(D.dataSource instanceof a.C&&"timeFilter"===j){D.dataSource.setTimeFilter(A,!1);const M=z.ol.getSource().getParams().TIME;D.dataSource.ol.updateParams({TIME:M})}}}),U&&T.viewController.resolution$.next(T.viewController.resolution$.value)}}},50056:(Pe,ae,r)=>{"use strict";r.d(ae,{k:()=>c});var E=r(34896),a=r(56264),w=r(83552),p=r(61252),e=r(9364);let c=(()=>{class o{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new E._w7;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(L,_){this.component=L,this.mediaService=_}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",L=>this.onPointerEvent(L,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",L=>this.onPointerEvent(L,0))}unlistenToMapPointerMove(){(0,w.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(L,_){if(L.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const C=(0,p.AF)(L.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(C)},_)}static \u0275fac=function(_){return new(_||o)(E.GI1(e.q,2),E.GI1(a.QB))};static \u0275dir=E.Sc5({type:o,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"},standalone:!0})}return o})()},93836:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>E});var E=function(a){return a[a.Move=0]="Move",a[a.Zoom=1]="Zoom",a}(E||{})},12268:(Pe,ae,r)=>{"use strict";r.d(ae,{u:()=>a});var E=r(34896);let a=(()=>{class w{map;constructor(){}getMap(){return this.map}setMap(e){this.map=e}static \u0275fac=function(c){return new(c||w)};static \u0275prov=E.wxM({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},89500:(Pe,ae,r)=>{"use strict";r.d(ae,{y:()=>z});var E=r(28900),a=r(17500),w=r(156),p=r(78960),e=r(77272),c=r(61252),o=r(42124),R=r(56096),L=r(3576),_=r(54844),C=r(91296),S=r(53404),P=r(56708),y=r(36404),F=r(43168),h=r(11484);class W extends F.WO{propertyChange$=new _.g(void 0);loaded=0;loading=0;layers=[];subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(N=>this.unwatchLayer(N),this)}setPropertyChange(N,K){[P.aG.TIMEFILTER,P.aG.OGCFILTERS,P.aG.VISIBLE,P.aG.OPACITY,P.aG.MINRESOLUTION,P.aG.MAXRESOLUTION].includes(N.key)&&this.propertyChange$.next({event:N,layer:K})}watchLayer(N){if(void 0===N.status$)return;N.ol.on("propertychange",j=>this.setPropertyChange(j,N)),N.dataSource.ol.on("propertychange",j=>this.setPropertyChange(j,N)),this.layers.push(N);const K=N.status$.pipe((0,h.a)()).subscribe(j=>{j===F.qM.Error&&(this.loading=0,this.loaded=-1),j===F.qM.Working?this.loading+=1:j===F.qM.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=F.qM.Done):this.loading>0&&(this.status=F.qM.Working)});this.subscriptions.push(K)}unwatchLayer(N){N.ol.un("propertychange",j=>this.setPropertyChange(j,N)),N.dataSource.ol.un("propertychange",j=>this.setPropertyChange(j,N)),N.status$.next(F.qM.Done);const K=this.layers.indexOf(N);K>=0&&(-1!==[F.qM.Working,F.qM.Waiting].indexOf(N.watcher.status)&&(this.loaded+=1),this.subscriptions[K].unsubscribe(),this.subscriptions.splice(K,1),this.layers.splice(K,1),N.watcher.unwatch())}}var J=r(42364),T=r(87272),Q=r(19724);class z{storageService;configService;ol;forcedOffline$=new _.g(!1);layers$=new _.g([]);layersAddedByClick$=new _.g(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;geolocationController;swipeEnabled$=new _.g(!1);mapCenter$=new _.g(!1);selectedFeatures$=new _.g(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get layers(){return this.layers$.value}get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(N,K,j){this.storageService=K,this.configService=j,this.options=Object.assign({},this.defaultOptions,N),this.layerWatcher=new W,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,o.sV(L.c),this.init()}init(){const N=[];this.options.controls&&(this.options.controls.attribution&&N.push(new w.c(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&N.push(new p.c(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let K={};!1===this.options.interactions&&(K={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new E.c({interactions:e.Q(K),controls:N}),this.setView(this.options.view||{}),this.viewController=new T.c({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new y.m(this),this.queryResultsOverlay=new y.m(this),this.searchResultsOverlay=new y.m(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new J.E(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.pipe((0,C.c)()).subscribe(([j,A])=>{let d;j&&(d=j.map(x=>x.id));const u=A.filter(x=>!d.includes(x.id));for(const x of u)x.options.linkedLayers&&x.ol.once("postrender",()=>{(0,Q.GK)(this,u)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,S.O)(j=>!j)).subscribe(j=>(0,Q.S8)(this,j.event,j.layer))}setTarget(N){this.ol.setTarget(N),void 0!==N?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(N){const j={...this.ol.getView().getProperties(),...N};N.zoom&&null==N.resolution&&(j.resolution=void 0),this.setView(j),N.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=N.maxZoomOnExtent),this.mapViewOptions=N}setView(N){void 0!==this.viewController&&this.viewController.clearStateHistory();const K={constrainResolution:!0,...N};N.center&&(K.center=c.QH(N.center,N.projection)),this.ol.setView(new a.cp(K)),N.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=N.maxLayerZoomExtent)}updateControls(N){if(void 0===N)return;const K=[];N.attribution&&K.push(new w.c(!0===N.attribution?{}:N.attribution)),N.scaleLine&&K.push(new p.c(!0===N.scaleLine?{}:N.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(A=>{this.ol.removeControl(A)}),K.forEach(A=>{this.ol.addControl(A)})}getCenter(N){return this.viewController.getCenter(N)}getExtent(N){return this.viewController.getExtent(N)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(N){if(N){for(const K of this.getBaseLayers())K.visible=!1;N.visible=!0,this.viewController.olView.setMinZoom(N.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(N.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(N=>!0===N.baseLayer)}getLayerById(N){return this.layers.find(K=>K.id&&K.id===N)}getLayerByAlias(N){return this.layers.find(K=>K.alias&&K.alias===N)}getLayerByOlUId(N){return this.layers.find(K=>(0,R.gV)(K.ol)&&(0,R.gV)(K.ol)===N)}getLayerByOlLayer(N){const K=(0,R.gV)(N);return this.getLayerByOlUId(K)}addLayer(N,K=!0){this.addLayers([N])}addLayers(N,K=!0){let j=0,A=0;const d=N.map(u=>{if(!u)return;const x=u.zIndex?0:u.baseLayer?A++:j++;return this.doAddLayer(u,x)}).filter(u=>void 0!==u);this.setLayers([].concat(this.layers,d))}removeLayer(N){this.removeLayers([N])}removeLayers(N){const K=this.layers$.value.slice(0),j=[];N.forEach(A=>{A instanceof P.Md&&A.removeLayerFromIDB();const d=K.indexOf(A);d>=0&&(j.push(A),K.splice(d,1),this.handleLinkedLayersDeletion(A,j),j.map(u=>{const x=K.indexOf(u);x>=0&&K.splice(x,1)}))}),j.forEach(A=>this.doRemoveLayer(A)),this.setLayers(K)}handleLinkedLayersDeletion(N,K){let j=(0,Q.aY)(this,N);j||(j=N);const A=(0,Q.yP)(this,j,[j]);for(const d of A)K.push(d)}removeAllLayers(){this.layers.forEach(N=>this.doRemoveLayer(N)),this.layers$.next([])}raiseLayer(N){const K=this.getLayerIndex(N);K>1&&this.moveLayer(N,K,K-1)}raiseLayers(N){for(const K of N)this.raiseLayer(K)}lowerLayer(N){const K=this.getLayerIndex(N);K<this.layers.length-1&&this.moveLayer(N,K,K+1)}lowerLayers(N){const K=N.reverse();for(const j of K)this.lowerLayer(j)}moveLayer(N,K,j){const A=this.layers[j],u=N.zIndex;A.baseLayer||N.baseLayer||(N.zIndex=A.zIndex,A.zIndex=u,this.layers[j]=N,this.layers[K]=A,this.layers$.next(this.layers.slice(0)))}doAddLayer(N,K){N.baseLayer&&N.visible&&this.changeBaseLayer(N);const j=this.getLayerById(N.id);if(void 0===j){if(!N.baseLayer&&N.zIndex&&(N.zIndex+=10),void 0===N.zIndex||0===N.zIndex){const A=Math.max(N.baseLayer?0:10,...this.layers.filter(d=>d.baseLayer===N.baseLayer&&d.zIndex<200).map(d=>d.zIndex));N.zIndex=A+1+K}return N.baseLayer&&N.zIndex>9&&(N.zIndex=10),N.setMap(this),this.layerWatcher.watchLayer(N),this.ol.addLayer(N.ol),N}j.visible=!0}doRemoveLayer(N){this.layerWatcher.unwatchLayer(N),this.ol.removeLayer(N.ol),N.setMap(void 0)}setLayers(N){this.layers$.next(this.sortLayersByZIndex(N).slice(0))}sortLayersByZIndex(N){return N.sort((K,j)=>j.zIndex-K.zIndex)}getLayerIndex(N){return this.layers.findIndex(K=>K===N)}}},59324:(Pe,ae,r)=>{"use strict";r.d(ae,{G2:()=>c,Ko:()=>o,Re:()=>y,Sc:()=>p,bg:()=>L,iC:()=>_,mC:()=>P,q:()=>C,rE:()=>R,uE:()=>S});var E=r(43168),a=r(872),w=r(61252);function p(W,J,T={}){let Q,z,Y,N,K,j,A,d,u,x,U,G,X,D,I,M,s,H,Z,de;const le=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),ue="([-+])?([\\d]{1,3})([,.](\\d+))?",ne=`${ue}[\\s,]+${ue}`,ve=new RegExp(`^${ne}$`,"g"),ye="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",Le=`${ye}([N|S|E|W|O]),?\\s*${ye}([N|S|E|W|O])`,He=new RegExp(`^${Le}$`,"gi"),Ve="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ge=new RegExp(`^${Ve}`,"gi"),ct="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ie=new RegExp(`^${ct}`,"gi"),Ye="([-+])?(\\d{1,3})[,.](\\d+)",se=`${Ye}\\s*[,]?\\s*${Ye}`,ge=new RegExp(`^${se}`,"g"),Re="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Ue=`${Re}\\s*[,.]?\\s*${Re}`,ze=new RegExp(`^${Ue}`,"g"),Be="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",st=new RegExp(`^${Be}?`,"gi"),xe="([-+]?\\d+)[,.]?(\\d+)?",Ke=`${xe}[\\s,]+${xe}`,Qe=new RegExp(`^${Ke}$`,"g");let It=!1;if(W=W.toLocaleUpperCase().trim(),le.test(W)?[z,de]=W.split(";").map(at=>at.trim()):z=W,ve.test(z))[,Y,H,,d,u,Z,,D]=z.match(ne),H=parseFloat((Y||"")+H+"."+d),Z=parseFloat((u||"")+Z+"."+D);else if(He.test(z))[,N,K,j,A,x,U,G,X]=z.match(Le),("S"===A||"N"===A)&&(N=[x,x=N][0],K=[U,U=K][0],j=[G,G=j][0],A=[X,X=A][0]),H=e(parseFloat(N),parseFloat(K),parseFloat(j),A),Z=e(parseFloat(x),parseFloat(U),parseFloat(G),X);else if(Ge.test(z)){It=!0,[,,I,H,Z]=z.match(Ve);const at=Number(I)<10?`EPSG:3260${I}`:`EPSG:326${I}`;[H,Z]=w.AF([parseFloat(H),parseFloat(Z)],at,"EPSG:4326")}else if(Ie.test(z)){It=!0,[,,I,H,Z]=z.match(ct);const at=Number(I)<10?`EPSG:3218${I}`:`EPSG:321${80+Number(I)}`;[H,Z]=w.AF([parseFloat(H),parseFloat(Z)],at,"EPSG:4326")}else if(ze.test(z))[,Y,N,K,j,d,u,x,U,G,D]=z.match(Ue),H=e(parseFloat((Y||"")+N),parseFloat(K),parseFloat(j),A),Z=e(parseFloat((u||"")+x),parseFloat(U),parseFloat(G),X);else if(ge.test(z))[,Y,N,d,u,x,D]=z.match(se),H=e(parseFloat((Y||"")+N),parseFloat(K),parseFloat(j),A),Z=e(parseFloat((u||"")+x),parseFloat(U),parseFloat(G),X);else if(st.test(z))[,u,x,U,G,,X,Y,N,K,j,,A,M,s]=z.match(Be),A||(A="W"),H=K&&K.length>2?parseFloat((Y||"")+N+"."+K):e(parseFloat(N),parseFloat(K),parseFloat(j),A),Z=U&&U.length>2?parseFloat((u||"")+x+"."+U):e(parseFloat(x),parseFloat(U),parseFloat(G),X);else{if(!Qe.test(z))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};It=!0,[,H,d,Z,D]=z.match(Ke),d&&(H=parseFloat(H+"."+d)),D&&(Z=parseFloat(Z+"."+D))}if(T.forceNA&&!It&&(H>0&&Z>0&&(H>Z?H=-H:Z=-Z),H>Z&&(H=[Z,Z=H][0])),Q=[Number(H),Number(Z)],void 0!==de&&"4326"!==de||Q[0]>180||Q[0]<-180||Q[1]>90||Q[1]<-90){const at=de?"EPSG:"+de:J,Ft="EPSG:4326";try{Q=w.AF(Q,at,Ft)}catch{return{lonLat:void 0,message:"Projection "+at+" not supported",radius:void 0,conf:void 0}}}return Math.abs(Q[0])<=180&&Math.abs(Q[1])<=90?{lonLat:Q,message:"",radius:M?parseInt(M,10):void 0,conf:s?parseInt(s,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function e(W,J,T,Q){J=J||0,T=T||0;const z=W<0;let Y=Math.abs(W)+J/60+T/3600;return(z||"S"===Q||"W"===Q)&&(Y=-Y),Y}function c(W,J=3){const T=[];return W.forEach(Q=>{const z=Q<0?Math.ceil(Q):Math.floor(Q),Y=Q<0?60*(z-Q):60*(Q-z),N=Math.floor(Y),K=(60*(Y-N)).toFixed(J);T.push(`${z}\xb0 ${N}' ${K}"`)}),T}function o(W,J){if(void 0===W||void 0===J)return!1;const T=1e-4;return W.zoom===J.zoom&&Math.trunc(W.center[0]/T)===Math.trunc(J.center[0]/T)&&Math.trunc(W.center[1]/T)===Math.trunc(J.center[1]/T)}function R(W){return(W=Math.round(W))<1e4?W+"":(W=Math.round(W/1e3))<1e3?W+"K":(W=Math.round(W/1e3))+"M"}function L(W,J=96){return W/(39.3701*J)}function _(W,J="m",T=96){return W*w.q[J]*39.3701*T}function C(W){const J=W.originalEvent;return!J.altKey&&(a.q2?J.metaKey:J.ctrlKey)&&!J.shiftKey}function S(W,J=3){return[E.UD.roundToNDecimal(W[0],J),E.UD.roundToNDecimal(W[1],J)]}function P(W,J=3){return S(W,J).map(T=>T.toString())}function y(W,J){const T=w.AF(W,"EPSG:4326","EPSG:3857"),Q=[{code:"EPSG:3857",alias:"Web Mercator",coord:T,igo2CoordFormat:`${S(T).join(", ")} ; 3857`}],z=function F(W){return Math.ceil((W[0]+180)/6)}(W),Y=z<10?`EPSG:3260${z}`:`EPSG:326${z}`,N=`UTM-${z}`,K=w.AF(W,"EPSG:4326",Y);Q.push({code:Y,alias:"UTM",coord:K,igo2CoordFormat:`${N} ${S(K).join(", ")}`});const j=function h(W){const J=W[0];let T;return J<-51&&J>-54&&(T=1),J<-54&&J>-57&&(T=2),J<-57&&J>-60&&(T=3),J<-60&&J>-63&&(T=4),J<-63&&J>-66&&(T=5),J<-66&&J>-69&&(T=6),J<-69&&J>-72&&(T=7),J<-72&&J>-75&&(T=8),J<-75&&J>-78&&(T=9),J<-78&&J>-81&&(T=10),T}(W);if(j){const A=j<10?`EPSG:3218${j}`:`EPSG:321${80+j}`,d=`MTM-${j}`,u=w.AF(W,"EPSG:4326",A);Q.push({code:A,alias:"MTM",coord:u,igo2CoordFormat:`${d} ${S(u).join(", ")}`})}return J.forEach(A=>{const d=w.AF(W,"EPSG:4326",A.code),u=A.code.split(":")[1];Q.push({code:A.code,alias:A.alias||A.code,coord:d,igo2CoordFormat:`${S(d).join(", ")} ; ${u}`})}),Q}},55760:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>c});var E=r(64100),a=r(49112),w=r(35876),p=r(9364),e=r(34896);let c=(()=>{class o{networkService;messageService;component;get map(){return this.component.map}previousMessageId;constructor(L,_,C){this.networkService=_,this.messageService=C,this.component=L}ngAfterViewInit(){const L=window.navigator.onLine;this.map.forcedOffline$.subscribe(_=>{const C=window.navigator.onLine;if(!L||L!==C||_)if(this.previousMessageId&&this.messageService.remove(this.previousMessageId),!_&&C){const S=this.messageService.info("igo.geo.network.online.message","igo.geo.network.online.title");this.previousMessageId=S.toastId}else if(_){const S=this.messageService.info("igo.geo.network.offline.message","igo.geo.network.offline.title");this.previousMessageId=S.toastId}}),(0,w.E)([this.networkService.currentState(),this.map.forcedOffline$,this.map.layers$]).subscribe(_=>{this.handleLayersOnlineState(_[0].connection,_[1],_[2])})}handleNonOfflinableLayerResolution(L,_,C){!L||_?C.maxResolution=0:(L||!_)&&(C.maxResolution=C.options.maxResolution||1/0)}handleLayersOnlineState(L,_,C){C.forEach(S=>{let P;if(!S.isIgoInternalLayer){if(S.options.sourceOptions?.pathOffline&&(P=S.options.sourceOptions),!P)return void this.handleNonOfflinableLayerResolution(L,_,S);{const y=P.type;if("mvt"===y&&S.ol.getSource().refresh(),!L||_){if(["vector","cluster"].includes(y))return;S.ol.getSource().setUrl(P.pathOffline)}else if(L&&_)this.handleNonOfflinableLayerResolution(L,_,S);else{if(["vector","cluster"].includes(y))return;S.ol.getSource().setUrl(P.url)}}}})}static \u0275fac=function(_){return new(_||o)(e.GI1(p.q),e.GI1(a.u),e.GI1(E.mi))};static \u0275dir=e.Sc5({type:o,selectors:[["","igoMapOffline",""]],standalone:!0})}return o})()},16660:(Pe,ae,r)=>{"use strict";r.d(ae,{q:()=>c});var E=r(45872),a=r(61252),w=r(42124),p=r(3576),e=r(34896);let c=(()=>{class o{config;constructor(L){this.config=L,(this.config.getConfig("projections")||[]).forEach(C=>{C.alias=C.alias?C.alias:C.code,this.registerProjection(C)});for(let C=1;C<61;C++)this.registerProjection({code:C<10?`EPSG:3260${C}`:`EPSG:326${C}`,def:`+proj=utm +zone=${C} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let C=1;C<11;C++){const S=C<10?`EPSG:3218${C}`:`EPSG:321${80+C}`;let P;P=Number(C)<=2?-50-3*Number(C):Number(C)>=12?-81-3*(Number(C)-12):-49.5-3*Number(C),this.registerProjection({code:S,def:`+proj=tmerc +lat_0=0 +lon_0=${P} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(L){p.c.defs(L.code,L.def),w.sV(p.c),L.extent&&a._M(L.code).setExtent(L.extent)}static \u0275fac=function(_){return new(_||o)(e.CoB(E.aW))};static \u0275prov=e.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},7700:(Pe,ae,r)=>{"use strict";r.d(ae,{ET:()=>a,GU:()=>e,KG:()=>p,KM:()=>w});var E=r(7080);function a(c){let o=-54;if(c<-81||c>o)return 0;{let _=2;for(;Math.abs(c-o)>3;)o-=3,_++;return _}}function w(c){let o=-180,_=1;for(;Math.abs(c-o)>6;)o+=6,_++;return _}function p(c){const o=c.mtmZone,R=c.utmZone;return{projFromConfig:!1!==c.projFromConfig,nad83:!1!==c.nad83,wgs84:!1!==c.wgs84,webMercator:!1!==c.webMercator,utm:!1!==c.utm,mtm:!1!==c.mtm,utmZone:{minZone:R&&R.minZone?R.minZone:17,maxZone:R&&R.maxZone?R.maxZone:21},mtmZone:{minZone:o&&o.minZone?o.minZone:2,maxZone:o&&o.maxZone?o.maxZone:10}}}function e(c){const o=c.file,R=c.nbLines??500,L=new FileReader;return(0,E.Q)(new Promise(_=>{o.name.toLowerCase().endsWith(".geojson")||o.name.toLowerCase().endsWith(".json")||o.name.toLowerCase().endsWith(".gml")?(L.onload=C=>{if(o.name.toLowerCase().endsWith(".geojson")||o.name.toLowerCase().endsWith(".json")){const S=JSON.parse(L.result);if(S.crs?.properties?.name){const P=S.crs.properties.name.match(/EPSG:{1,2}\d{0,6}/gm);return null!==P&&P.length?void _(P[0].replace(/::/g,":")):void _("epsgNotDefined")}_("epsgNotDefined")}else if(o.name.toLowerCase().endsWith(".gml")){const P=L.result.split("\n");for(let y=0;y<=R;y++){const F=P[y].match(/EPSG:\d{0,6}/gm);if(null!==F&&F.length){_(F[0]);break}_(void 0)}}else _("epsgNotDefined")},L.readAsText(o,"UTF-8")):_("epsgNotDefined")}))}},72124:(Pe,ae,r)=>{"use strict";r.d(ae,{Q:()=>p});var E=r(2500),w=(r(89500),r(34896));let p=(()=>{class e{map;layers;pos1;pos3;inDragAction=!1;swipeEnabled$$;boundPrerender=this.prerender.bind(this);constructor(){}ngAfterViewInit(){this.getListOfLayers(),this.swipeEnabled$$=this.map.swipeEnabled$.subscribe(o=>{o?this.displaySwipe():this.displaySwipeOff()}),this.letZoom()}ngOnDestroy(){this.swipeEnabled$$.unsubscribe(),this.map.swipeEnabled$.unsubscribe(),this.displaySwipeOff()}displaySwipe(){this.swipeId&&(this.swipeId.style.visibility="visible"),this.layers.map(o=>o.ol.on("prerender",this.boundPrerender)),this.layers.map(o=>o.ol.on("postrender",this.postrender)),this.map.ol.render()}displaySwipeOff(){this.swipeId&&(this.swipeId.style.visibility="hidden"),this.layers.map(o=>o.ol.un("prerender",this.boundPrerender)),this.layers.map(o=>o.ol.un("postrender",this.postrender)),this.map.ol.render(),this.layers=[]}get swipeId(){return document.getElementById("igo-layer-swipe")}getListOfLayers(){this.map.selectedFeatures$.subscribe(o=>{if(this.layers=[],null!==o)for(const R of o)this.layers.includes(R)||this.layers.push(R)})}dragDown(o){this.inDragAction=!0,o.preventDefault(),"mousedown"===o.type?(this.pos3=o.clientX,this.mouseSwipe(),document.onmouseup=this.closeDragMouseElement):"touchstart"===o.type&&(document.getElementById("arrows").style.visibility="hidden",this.pos3=o.touches[0].clientX,this.touchSwipe(),document.ontouchend=this.closeDragTouchElement)}mouseSwipe(){document.addEventListener("mousemove",o=>{this.inDragAction&&(o.preventDefault(),this.pos1=this.pos3-o.clientX,this.pos3=o.clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}touchSwipe(){document.addEventListener("touchmove",o=>{this.inDragAction&&(o.preventDefault(),document.getElementById("arrows").style.visibility="hidden",this.pos1=this.pos3-o.changedTouches[0].clientX,this.pos3=o.changedTouches[0].clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}closeDragMouseElement(){document.onmouseup=null,document.onmousemove=null,this.inDragAction=!1}closeDragTouchElement(){document.ontouchend=null,document.ontouchmove=null,document.getElementById("arrows").style.visibility="visible",this.inDragAction=!1}prerender(o){const R=o.context,L=this.map.ol.getSize(),_=this.swipeId.offsetLeft,C=(0,E.sv)(o,[_,0]),S=(0,E.sv)(o,[0,0]),P=(0,E.sv)(o,[_,L[1]]),y=(0,E.sv)(o,[0,L[1]]);R.save(),R.beginPath(),R.moveTo(C[0],C[1]),R.lineTo(P[0],P[1]),R.lineTo(y[0],y[1]),R.lineTo(S[0],S[1]),R.closePath(),R.clip()}postrender(o){o.context.restore(),o.context.save()}letZoom(){document.getElementById("igo-layer-swipe").addEventListener("wheel",o=>{o.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(R){return new(R||e)};static \u0275cmp=w.In1({type:e,selectors:[["igo-swipe-control"]],inputs:{map:"map"},standalone:!0,features:[w.UHJ],decls:5,vars:0,consts:[["id","igo-layer-swipe",1,"igo-swipe-control-container",3,"mousedown","mouseup","touchstart","touchend"],[1,"igo-swipe-control-line"],["id","arrows",1,"igo-swipe-control-arrows"],[1,"igo-arrow-left"],[1,"igo-arrow-right"]],template:function(R,L){1&R&&(w.I0R(0,"div",0),w.qCj("mousedown",function(C){return L.dragDown(C)})("mouseup",function(){return L.closeDragMouseElement()})("touchstart",function(C){return L.dragDown(C)})("touchend",function(){return L.closeDragTouchElement()}),w.wR5(1,"div",1),w.I0R(2,"div",2),w.wR5(3,"div",3)(4,"div",4),w.C$Y()())},styles:[".igo-swipe-control-container[_ngcontent-%COMP%]{position:absolute;width:80px;height:100%;top:0%;left:50%;cursor:grab;z-index:1;transform:translate(-40px)}.igo-swipe-control-container[_ngcontent-%COMP%]:active{cursor:grabbing}.igo-swipe-control-line[_ngcontent-%COMP%]{position:absolute;width:4px;height:100%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#5e5a5a}.igo-swipe-control-arrows[_ngcontent-%COMP%]{position:absolute;width:32px;height:32px;left:50%;top:50%;transform:translate(-50%,-50%);margin-top:-16px;padding:5px 4px;background-color:#5e5a5a;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.igo-swipe-control-arrows[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-right[_ngcontent-%COMP%]{margin-left:4px;border-left:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-left[_ngcontent-%COMP%]{border-right:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]:active{display:none}"]})}return e})()},50208:(Pe,ae,r)=>{"use strict";r.d(ae,{w:()=>P});var E=r(65056),a=r(34672),w=r(32328),p=r(27e3),e=r(20460),c=r(62004),o=r(43168),R=r(60904),L=r.n(R),_=r(54844),C=r(34896),S=r(72584);let P=(()=>{class y{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(h){this.storageService.set("wakeLockEnabled",h)}noSleep;icon$=new _.g("bedtime");visible=!1;constructor(h){this.storageService=h,this.noSleep=new(L()),o.sX.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("bedtime_off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("bedtime")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(W){return new(W||y)(C.GI1(c.yQ))};static \u0275cmp=C.In1({type:y,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},standalone:!0,features:[C.UHJ],decls:7,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"]],template:function(W,J){1&W&&(C.I0R(0,"div",0)(1,"button",1),C.qCj("click",function(){return J.toggleWakeLock()}),C.wVc(2,"translate"),C.wVc(3,"translate"),C.I0R(4,"mat-icon"),C.OEk(5),C.wVc(6,"async"),C.C$Y()()()),2&W&&(C.yG2(),C.E7m("color",J.color)("matTooltip",J.enabled?C.kDX(2,3,"igo.geo.mapButtons.preventScreenLock"):C.kDX(3,5,"igo.geo.mapButtons.letScreenLock")),C.yG2(4),C.cNF(C.kDX(6,7,J.icon$)))},dependencies:[a.oJ,a.um,p.KO,p.a4,w.oB,w.qL,E.a,e._s,S.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return y})()},75872:(Pe,ae,r)=>{"use strict";r.d(ae,{q:()=>L});var E=r(34672),a=r(32328),w=r(27e3),p=r(20460),c=(r(89500),r(34896)),o=r(72584);const R=_=>({zoom:_});let L=(()=>{class _{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}constructor(){}static \u0275fac=function(P){return new(P||_)};static \u0275cmp=c.In1({type:_,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[c.UHJ],decls:9,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"]],template:function(P,y){1&P&&(c.I0R(0,"div",0)(1,"button",1),c.qCj("click",function(){return y.map.viewController.zoomIn()}),c.wVc(2,"translate"),c.I0R(3,"mat-icon"),c.OEk(4,"add"),c.C$Y()(),c.I0R(5,"button",1),c.qCj("click",function(){return y.map.viewController.zoomOut()}),c.wVc(6,"translate"),c.I0R(7,"mat-icon"),c.OEk(8,"remove"),c.C$Y()()()),2&P&&(c.yG2(),c.E7m("matTooltip",c.g7$(2,6,"igo.geo.mapButtons.zoomIn",c.S45(12,R,y.zoom+1)))("color",y.color)("disabled",y.zoom>=y.maxZoom),c.yG2(4),c.E7m("matTooltip",c.g7$(6,9,"igo.geo.mapButtons.zoomOut",c.S45(14,R,y.zoom-1)))("color",y.color)("disabled",y.zoom<=y.minZoom))},dependencies:[E.oJ,E.um,w.KO,w.a4,a.oB,a.qL,p._s,o.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}"]})}return _})()},49312:(Pe,ae,r)=>{"use strict";r.d(ae,{K8:()=>E.K8,y:()=>w.y,wP:()=>E.wP,aK:()=>E.aK,ox:()=>E.ox,cD:()=>E.cD,ie:()=>E.ie});var E=r(45076),w=(r(87080),r(79280))},87080:(Pe,ae,r)=>{"use strict";r.d(ae,{j:()=>p});var E=r(69904),a=r(8512),w=r(34896);let p=(()=>{class e{transform(o,R,L=!1,_=1){let C;return Object.values(E.Mh).indexOf(R)>=0?C=(0,a.Ej)(o,R):Object.values(E.K8).indexOf(R)>=0&&(C=(0,a.iK)(o,R)),C&&(0,a.wP)(C,{decimal:1,unit:R,unitAbbr:L,locale:"fr"})}static \u0275fac=function(R){return new(R||e)};static \u0275pipe=w.UTH({name:"measureFormat",type:e,pure:!0,standalone:!0})}return e})()},79280:(Pe,ae,r)=>{"use strict";r.d(ae,{y:()=>ct});var E=r(65056),a=r(34672),w=r(24296),p=r(75180),e=r(32328),c=r(43424),o=r(27e3),R=r(87040),L=r(20460),_=r(62004),C=r(43168),S=r(83552),P=r(12396),y=r(28772),F=r(54776),h=r(54844),W=r(68013),J=r(3544),T=r(76200),Q=r(41912),z=r(99228),N=(r(89500),r(69904)),K=r(8512),j=r(40600),A=r(87080),d=r(34896),u=r(72584);function x(Ie,Ye){if(1&Ie&&(d.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),d.OEk(4),d.wVc(5,"translate"),d.C$Y()()(),d.I0R(6,"tbody")(7,"tr")(8,"td"),d.OEk(9),d.wVc(10,"measureFormat"),d.C$Y(),d.I0R(11,"td"),d.OEk(12),d.wVc(13,"translate"),d.C$Y()(),d.I0R(14,"tr")(15,"td"),d.OEk(16),d.wVc(17,"measureFormat"),d.C$Y(),d.I0R(18,"td"),d.OEk(19),d.wVc(20,"translate"),d.C$Y()(),d.I0R(21,"tr")(22,"td"),d.OEk(23),d.wVc(24,"measureFormat"),d.C$Y(),d.I0R(25,"td"),d.OEk(26),d.wVc(27,"translate"),d.C$Y()(),d.I0R(28,"tr")(29,"td"),d.OEk(30),d.wVc(31,"measureFormat"),d.C$Y(),d.I0R(32,"td"),d.OEk(33),d.wVc(34,"translate"),d.C$Y()()()()),2&Ie){const se=d.GaO();d.yG2(4),d.oRS(" ",d.kDX(5,9,"igo.geo.measure.dialog.length.title")," "),d.yG2(5),d.cNF(d.g7$(10,11,se.data.length,se.measureLengthUnit.Meters)),d.yG2(3),d.cNF(d.kDX(13,14,"igo.geo.measure.dialog.lengthInMeters")),d.yG2(4),d.oRS(" ",d.g7$(17,16,se.data.length,se.measureLengthUnit.Kilometers)," "),d.yG2(3),d.cNF(d.kDX(20,19,"igo.geo.measure.dialog.lengthInKilometers")),d.yG2(4),d.cNF(d.g7$(24,21,se.data.length,se.measureLengthUnit.Miles)),d.yG2(3),d.cNF(d.kDX(27,24,"igo.geo.measure.dialog.lengthInMiles")),d.yG2(4),d.cNF(d.g7$(31,26,se.data.length,se.measureLengthUnit.Feet)),d.yG2(3),d.cNF(d.kDX(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function U(Ie,Ye){if(1&Ie&&(d.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),d.OEk(4),d.wVc(5,"translate"),d.C$Y()()(),d.I0R(6,"tbody")(7,"tr")(8,"td"),d.OEk(9),d.wVc(10,"measureFormat"),d.C$Y(),d.I0R(11,"td"),d.OEk(12),d.wVc(13,"translate"),d.C$Y()(),d.I0R(14,"tr")(15,"td"),d.OEk(16),d.wVc(17,"measureFormat"),d.C$Y(),d.I0R(18,"td"),d.OEk(19),d.wVc(20,"translate"),d.C$Y()(),d.I0R(21,"tr")(22,"td"),d.OEk(23),d.wVc(24,"measureFormat"),d.C$Y(),d.I0R(25,"td"),d.OEk(26),d.wVc(27,"translate"),d.C$Y()(),d.I0R(28,"tr")(29,"td"),d.OEk(30),d.wVc(31,"measureFormat"),d.C$Y(),d.I0R(32,"td"),d.OEk(33),d.wVc(34,"translate"),d.C$Y()(),d.I0R(35,"tr")(36,"td"),d.OEk(37),d.wVc(38,"measureFormat"),d.C$Y(),d.I0R(39,"td"),d.OEk(40),d.wVc(41,"translate"),d.C$Y()(),d.I0R(42,"tr")(43,"td"),d.OEk(44),d.wVc(45,"translate"),d.C$Y(),d.I0R(46,"td"),d.OEk(47),d.wVc(48,"measureFormat"),d.C$Y()()()()),2&Ie){const se=d.GaO();d.yG2(4),d.oRS(" ",d.kDX(5,13,"igo.geo.measure.dialog.area.title")," "),d.yG2(5),d.cNF(d.g7$(10,15,se.data.area,se.measureAreaUnit.SquareMeters)),d.yG2(3),d.cNF(d.kDX(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),d.yG2(4),d.oRS(" ",d.g7$(17,20,se.data.area,se.measureAreaUnit.SquareKilometers)," "),d.yG2(3),d.oRS(" ",d.kDX(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),d.yG2(4),d.cNF(d.g7$(24,25,se.data.area,se.measureAreaUnit.SquareMiles)),d.yG2(3),d.cNF(d.kDX(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),d.yG2(4),d.cNF(d.g7$(31,30,se.data.area,se.measureAreaUnit.Acres)),d.yG2(3),d.cNF(d.kDX(34,33,"igo.geo.measure.dialog.areaInAcres")),d.yG2(4),d.cNF(d.g7$(38,35,se.data.area,se.measureAreaUnit.Hectares)),d.yG2(3),d.cNF(d.kDX(41,38,"igo.geo.measure.dialog.areaInHectares")),d.yG2(4),d.cNF(d.kDX(45,40,"igo.geo.measure.dialog.perimeterInMeters")),d.yG2(3),d.cNF(d.g7$(48,42,se.data.perimeter,se.measureLengthUnit.Meters))}}let G=(()=>{class Ie{dialogRef;data;measureAreaUnit=N.Mh;measureLengthUnit=N.K8;constructor(se,ge){this.dialogRef=se,this.data=ge}onNoClick(){this.dialogRef.close()}static \u0275fac=function(ge){return new(ge||Ie)(d.GI1(j.yI),d.GI1(j.sR))};static \u0275cmp=d.In1({type:Ie,selectors:[["igo-measurer-dialog"]],standalone:!0,features:[d.UHJ],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(ge,Re){1&ge&&(d.I0R(0,"h3",0),d.OEk(1),d.wVc(2,"translate"),d.C$Y(),d.I0R(3,"div",1),d.yuY(4,x,35,31,"table",2)(5,U,49,45,"table",2),d.C$Y()),2&ge&&(d.yG2(),d.cNF(d.kDX(2,3,"igo.geo.measure.dialog.title")),d.yG2(3),d.E7m("ngIf",Re.data.length>0),d.yG2(),d.E7m("ngIf",Re.data.area>0))},dependencies:[j.WQ,j.iU,E.u_,L._s,u.sD,A.j],styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]})}return Ie})();var X=r(46176),D=r(50244),I=r(42536),M=r(77872);function s(Ie,Ye){if(1&Ie&&(d.I0R(0,"mat-option",5),d.OEk(1),d.wVc(2,"translate"),d.C$Y()),2&Ie){const se=Ye.$implicit;d.E7m("value",se),d.yG2(),d.oRS(" ",d.kDX(2,2,"igo.geo.measure."+se)," ")}}let H=(()=>{class Ie{measure$=new h.g(void 0);measure$$;measureType;measureUnit;set measure(se){this.measure$.next(se)}get measure(){return this.measure$.value}set auto(se){this.toggleAutoUnit(se)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new d._w7;get measureUnits(){return Object.values(this.measureType===N.gn.Area?N.Mh:N.K8)}constructor(){}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(se){this.measureUnit=se,this.measureUnitChange.emit(se)}toggleAutoUnit(se){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===se&&(this.measure$$=this.measure$.subscribe(ge=>{this.computeBestMeasureUnit(ge)})),this._auto=se}computeBestMeasureUnit(se){let ge=this.measureUnit;this.measureType===N.gn.Area?ge=(0,K.AX)(se):this.measureType===N.gn.Length&&(ge=(0,K.Gs)(se)),ge!==this.measureUnit&&this.onMeasureUnitChange(ge)}static \u0275fac=function(ge){return new(ge||Ie)};static \u0275cmp=d.In1({type:Ie,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},standalone:!0,features:[d.UHJ],decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(ge,Re){1&ge&&(d.I0R(0,"mat-form-field",0)(1,"mat-label"),d.OEk(2),d.C$Y(),d.wR5(3,"input",1),d.wVc(4,"measureFormat"),d.wVc(5,"async"),d.C$Y(),d.I0R(6,"mat-form-field",2)(7,"mat-select",3),d.qCj("selectionChange",function(ze){return Re.onMeasureUnitChange(ze.value)}),d.yuY(8,s,3,4,"mat-option",4),d.C$Y()()),2&ge&&(d.yG2(2),d.cNF(Re.placeholder),d.yG2(),d.E7m("disabled",!0)("readonly",!0)("value",d.g7$(4,7,d.kDX(5,10,Re.measure$)||0,Re.measureUnit)),d.yG2(4),d.E7m("value",Re.measureUnit)("disabled",Re.auto),d.yG2(),d.E7m("ngForOf",Re.measureUnits))},dependencies:[D.wb,D.Up,D.w5,I.cN,I.yi,M.d5,M.kX,X.I5,E.Iw,X.Ax,E.a,L._s,u.sD,A.j],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:8px;flex:1}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return Ie})();const Z=["table"];function me(Ie,Ye){1&Ie&&d.wR5(0,"mat-divider")}function _e(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"mat-slide-toggle",7),d.qCj("change",function(Re){d.usT(se);const Ue=d.GaO();return d.CGJ(Ue.onToggleDisplayLines(Re.checked))}),d.OEk(1),d.wVc(2,"translate"),d.C$Y()}if(2&Ie){const se=d.GaO();d.E7m("checked",se.displayLines)("labelPosition","before"),d.yG2(),d.oRS(" ",d.kDX(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function de(Ie,Ye){1&Ie&&d.wR5(0,"mat-divider")}function le(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"mat-slide-toggle",7),d.qCj("change",function(Re){d.usT(se);const Ue=d.GaO();return d.CGJ(Ue.onToggleDisplayDistance(Re.checked))}),d.OEk(1),d.wVc(2,"translate"),d.C$Y()}if(2&Ie){const se=d.GaO();d.E7m("checked",se.displayDistance)("labelPosition","before"),d.yG2(),d.oRS(" ",d.kDX(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function ue(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"mat-slide-toggle",7),d.qCj("change",function(Re){d.usT(se);const Ue=d.GaO();return d.CGJ(Ue.onToggleDisplayAreas(Re.checked))}),d.OEk(1),d.wVc(2,"translate"),d.C$Y()}if(2&Ie){const se=d.GaO();d.E7m("checked",se.displayAreas)("labelPosition","before"),d.yG2(),d.oRS(" ",d.kDX(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function ne(Ie,Ye){1&Ie&&d.wR5(0,"mat-divider")}function ve(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"igo-measurer-item",14),d.qCj("measureUnitChange",function(Re){d.usT(se);const Ue=d.GaO(2);return d.CGJ(Ue.onLengthUnitChange(Re))}),d.wVc(1,"translate"),d.C$Y()}if(2&Ie){const se=d.GaO().ngIf,ge=d.GaO();d.E7m("measureType",ge.measureType.Length)("measureUnit",ge.activeLengthUnit)("measure",se.length)("auto",ge.measureUnitsAuto)("placeholder",d.kDX(1,5,ge.activeMeasureType===ge.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function ye(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"igo-measurer-item",14),d.qCj("measureUnitChange",function(Re){d.usT(se);const Ue=d.GaO(2);return d.CGJ(Ue.onAreaUnitChange(Re))}),d.wVc(1,"translate"),d.C$Y()}if(2&Ie){const se=d.GaO().ngIf,ge=d.GaO();d.E7m("measureType",ge.measureType.Area)("measureUnit",ge.activeAreaUnit)("measure",se.area)("auto",ge.measureUnitsAuto)("placeholder",d.kDX(1,5,"igo.geo.measure.area"))}}function Le(Ie,Ye){if(1&Ie&&(d.SAx(0),d.yuY(1,ve,2,7,"igo-measurer-item",13)(2,ye,2,7,"igo-measurer-item",13),d.k70()),2&Ie){const se=d.GaO();d.yG2(),d.E7m("ngIf",se.activeMeasureType===se.measureType.Length||se.activeMeasureType===se.measureType.Area),d.yG2(),d.E7m("ngIf",se.activeMeasureType===se.measureType.Area)}}function He(Ie,Ye){1&Ie&&d.wR5(0,"mat-divider")}function Ve(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"button",15),d.qCj("click",function(){d.usT(se);const Re=d.GaO();return d.CGJ(Re.onCalculateClick())}),d.wVc(1,"translate"),d.wVc(2,"async"),d.I0R(3,"mat-icon"),d.OEk(4,"calculate"),d.C$Y()()}if(2&Ie){const se=d.GaO();d.E7m("matTooltip",d.kDX(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===d.kDX(2,4,se.selectedFeatures$).length)}}function Ge(Ie,Ye){if(1&Ie){const se=d.KQA();d.I0R(0,"button",16),d.qCj("click",function(){d.usT(se);const Re=d.GaO();return d.CGJ(Re.onDeleteClick())}),d.wVc(1,"translate"),d.wVc(2,"async"),d.I0R(3,"mat-icon"),d.OEk(4,"delete"),d.C$Y()()}if(2&Ie){const se=d.GaO();d.E7m("matTooltip",d.kDX(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===d.kDX(2,4,se.selectedFeatures$).length)}}let ct=(()=>{class Ie{languageService;dialog;storageService;document;tableTemplate;subscriptions$$=[];measureType=N.gn;measureAreaUnit=N.Mh;measureLengthUnit=N.K8;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new h.g(!1);hasArea$=new h.g(!1);measure$=new h.g({});selectedFeatures$=new h.g([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=N.K8.Meters;activeAreaUnit=N.Mh.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new y.c;map;store;set activeMeasureType(se){this.setActiveMeasureType(se)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(se,ge,Re,Ue){this.languageService=se,this.dialog=ge,this.storageService=Re,this.document=Ue,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:ze=>{const Be=this.activeLengthUnit,st=(0,K.iK)(ze.properties.measure.length,Be);return(0,K.wP)(st,{decimal:1,unit:Be,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:ze=>{const Be=this.activeAreaUnit,st=(0,K.Ej)(ze.properties.measure.area,Be);return st?(0,K.wP)(st,{decimal:1,unit:Be,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.getSavedUnits(),this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(N.gn.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(se=>se.unsubscribe())}onMeasureTypeChange(se){this.activeMeasureType=se}onToggleDrawControl(se){!0===se?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(se){this.measureUnitsAuto=se}onToggleDisplayDistance(se){this.displayDistance=se,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!se,_.Ab.SESSION)}onToggleDisplayLines(se){this.displayLines=se,this.onDisplayLines(),this.storageService.set("linesToggle",!!se,_.Ab.SESSION)}onToggleDisplayAreas(se){this.displayAreas=se,this.onDisplayAreas(),this.storageService.set("areasToggle",!!se,_.Ab.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){const se=this.document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments");this.displayDistance?Array.from(se).map(ge=>ge.classList.remove("igo-map-tooltip-hidden")):Array.from(se).map(ge=>ge.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){const se=this.document.getElementsByClassName("igo-map-tooltip-measure-line-segments");this.displayLines?Array.from(se).map(ge=>{ge.classList.remove("igo-map-tooltip-hidden")}):Array.from(se).map(ge=>{ge.classList.add("igo-map-tooltip-hidden")})}onDisplayAreas(){const se=this.document.getElementsByClassName("igo-map-tooltip-measure-area");this.displayAreas?Array.from(se).map(ge=>ge.classList.remove("igo-map-tooltip-hidden")):Array.from(se).map(ge=>ge.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(se){this.activeLengthUnit=se,this.saveCurrentUnits(),this.refreshTableAndTooltip()}onAreaUnitChange(se){this.activeAreaUnit=se,this.saveCurrentUnits(),this.refreshTableAndTooltip()}refreshTableAndTooltip(){this.store.stateView.clear(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const se=this.selectedFeatures$.value,ge=se.reduce((ze,Be)=>ze+Be.properties.measure.area||0,0),Re=se.reduce((ze,Be)=>"Polygon"===Be.geometry.type?ze:ze+Be.properties.measure.length||0,0),Ue=se.reduce((ze,Be)=>"LineString"===Be.geometry.type?ze:ze+Be.properties.measure.length||0,0);this.openDialog({area:ge,length:Re,perimeter:Ue})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(se=>{this.olDrawSource.getFeatures().forEach(ge=>{const Re=ge.getGeometry();se.properties.id===Re.ol_uid&&this.olDrawSource.removeFeature(ge)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const se=this.selectedFeatures$.value[0],Re=this.store.layer.ol.getSource().getFeatures().find(Ue=>Ue.get("id")===se.properties.id);if(void 0!==Re){this.deactivateDrawControl(),this.activateModifyControl();const Ue=Re.getGeometry();this.clearTooltipsOfOlGeometry(Ue),this.modifyControl.setOlGeometry(Ue)}}}openDialog(se){this.dialog.open(G,{data:se})}initStore(){const se=this.store,ge=new z.Md({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${(0,C.uq)()}`,zIndex:200,source:new J.EB,style:(0,K.wr)(),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});(0,T.mM)(se,ge),se.layer.visible=!0,ge.visible$.subscribe(Re=>{const Ue=this.document.getElementsByClassName("igo-map-tooltip-measure");Re?Array.from(Ue).map(ze=>ze.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(Ue).map(ze=>ze.classList.add("igo-map-tooltip-measure-by-display"))}),(0,T.sf)(se),(0,T.Uz)(se,new T.kj({map:this.map,many:!0})),this.onFeatureAddedKey=se.source.ol.on("addfeature",Re=>{const Ue=Re.feature,ze=Ue.getGeometry();this.updateMeasureOfOlGeometry(ze,Ue.get("measure")),this.onDisplayDistance(),this.onDisplayLines(),this.onDisplayAreas()}),this.onFeatureRemovedKey=se.source.ol.on("removefeature",Re=>{const Ue=Re.feature.getGeometry();this.clearTooltipsOfOlGeometry(Ue)}),this.selectedFeatures$$=se.stateView.manyBy$(Re=>!0===Re.state.selected).pipe((0,W.s)(1)).subscribe(Re=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next(Re.map(Ue=>Ue.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(Re=>{Re.find(Ue=>"Polygon"===Ue.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),Re.find(Ue=>"LineString"===Ue.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(Re=>{this.store.layer.options.showInLayerList=Re>=1}))}freezeStore(){const se=this.store;this.selectedFeatures$$.unsubscribe(),(0,S.S)(this.onFeatureAddedKey),(0,S.S)(this.onFeatureRemovedKey),se.deactivateStrategyOfType(T.E9),se.deactivateStrategyOfType(T.kj)}createDrawLineControl(){this.drawLineControl=new Q.i4({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:(0,K.yK)(),drawingLayerStyle:new F.cp({})})}createDrawPolygonControl(){this.drawPolygonControl=new Q.i4({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:(0,K.yK)(),drawingLayerStyle:new F.cp({})})}createModifyControl(){this.modifyControl=new Q.Up({source:this.olDrawSource,drawStyle:(0,K.yK)(),layerStyle:new F.cp({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===N.gn.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===N.gn.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(se){this.drawControlIsDisabled=!1,this.activeDrawControl=se,this.drawStart$$=se.start$.subscribe(ge=>this.onDrawStart(ge)),this.drawEnd$$=se.end$.subscribe(ge=>this.onDrawEnd(ge)),this.drawChanges$$=se.changes$.subscribe(ge=>this.onDrawChanges(ge)),this.drawChanges$$=se.abort$.subscribe(ge=>{this.clearTooltipsOfOlGeometry(ge),this.clearMeasures()}),se.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(se){this._activeMeasureType=se,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(se){this.activeOlGeometry=se}onDrawEnd(se){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(se),this.addFeatureToStore(se),this.clearTooltipsOfOlGeometry(se),this.olDrawSource.clear(!0)}onDrawChanges(se){const ge=(0,K.ox)(se,this.projection);this.updateMeasureOfOlGeometry(se,Object.assign({},ge,{area:void 0})),this.measure$.next(ge)}activateModifyControl(){const se=this.store.getStrategyOfType(T.kj);se.deactivate(),se.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(ge=>this.onModifyStart(ge)),this.modifyEnd$$=this.modifyControl.end$.subscribe(ge=>this.onModifyEnd(ge)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(ge=>this.onModifyChanges(ge)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(T.kj),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(se){this.onDrawStart(se)}onModifyChanges(se){this.onDrawChanges(se)}onModifyEnd(se){this.finalizeMeasureOfOlGeometry(se)}finalizeMeasureOfOlGeometry(se){const ge=(0,K.ox)(se,this.projection);this.updateMeasureOfOlGeometry(se,ge)}updateMeasureOfOlGeometry(se,ge){se.setProperties({_measure:ge},!0),this.updateTooltipsOfOlGeometry(se)}clearMeasures(){this.measure$.next({})}addFeatureToStore(se,ge){const Re=ge?ge.properties.id:se.ol_uid,Ue=this.map.ol.getView().getProjection(),ze=(new P.c).writeGeometryObject(se,{featureProjection:Ue,dataProjection:Ue});this.store.update({type:T.Yf,geometry:ze,projection:Ue.getCode(),properties:{id:Re,measure:se.get("_measure")},meta:{id:Re}})}updateTooltipsOfOlGeometry(se){const ge=se.get("_measure"),Re=ge.lengths,Ue=ge.area,ze=(0,K.Og)(se);if(Re.length===ze.length)for(let Be=0;Be<ze.length;Be++){const st=Re[Be];void 0!==st&&this.updateOlTooltip(ze[Be],(0,K.iK)(st,this.activeLengthUnit),this.activeLengthUnit,N.gn.Length)}void 0!==Ue&&this.updateOlTooltip((0,K.IP)(se),(0,K.Ej)(Ue,this.activeAreaUnit),this.activeAreaUnit,N.gn.Area)}showTooltipsOfOlGeometry(se){(0,K.aK)(se).forEach(ge=>{this.shouldShowTooltip(ge)&&this.map.ol.addOverlay(ge)})}clearTooltipsOfOlGeometry(se){(0,K.aK)(se).forEach(ge=>{void 0!==ge&&void 0!==ge.getMap()&&this.map.ol.removeOverlay(ge)})}updateTooltipsOfOlSource(se){se.forEachFeature(ge=>{this.updateTooltipsOfOlGeometry(ge.getGeometry())})}showTooltipsOfOlSource(se){se.forEachFeature(ge=>{this.showTooltipsOfOlGeometry(ge.getGeometry())})}clearTooltipsOfOlSource(se){se.forEachFeature(ge=>{void 0!==ge.getGeometry()&&this.clearTooltipsOfOlGeometry(ge.getGeometry())})}updateOlTooltip(se,ge,Re,Ue){se.setProperties({_measure:ge,_unit:Re,_type:Ue},!0),se.getElement().innerHTML=this.computeTooltipInnerHTML(se),this.shouldShowTooltip(se)&&this.map.ol.addOverlay(se)}computeTooltipInnerHTML(se){const ge=se.getProperties();return(0,K.wP)(ge._measure,{decimal:1,unit:ge._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(se){if(!1===this.showTooltips)return!1;const ge=se.getProperties(),Re=ge._measure;if(void 0===Re)return!1;if(ge._unit===N.gn.Length){const Ue=(0,K.iK)(this.minSegmentLength,ge._unit)||0;return Re>Math.max(Ue,0)}return!0}saveCurrentUnits(){this.storageService.set("distanceUnit",this.activeLengthUnit,_.Ab.SESSION),this.storageService.set("areaUnit",this.activeAreaUnit,_.Ab.SESSION)}getSavedUnits(){const se=this.storageService.get("distanceUnit"),ge=this.storageService.get("areaUnit");this.activeLengthUnit=se||this.activeLengthUnit,this.activeAreaUnit=ge||this.activeAreaUnit}static \u0275fac=function(ge){return new(ge||Ie)(d.GI1(L.ov),d.GI1(j.qW),d.GI1(_.yQ),d.GI1(E.Ud))};static \u0275cmp=d.In1({type:Ie,selectors:[["igo-measurer"]],viewQuery:function(ge,Re){if(1&ge&&d.CC$(Z,7),2&ge){let Ue;d.wto(Ue=d.Gqi())&&(Re.table=Ue.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},standalone:!0,features:[d.UHJ],decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"]],template:function(ge,Re){1&ge&&(d.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),d.qCj("change",function(ze){return Re.onMeasureTypeChange(ze.value)}),d.I0R(3,"mat-button-toggle",2),d.OEk(4),d.wVc(5,"translate"),d.C$Y(),d.I0R(6,"mat-button-toggle",2),d.OEk(7),d.wVc(8,"translate"),d.C$Y()()(),d.I0R(9,"div",3)(10,"mat-slide-toggle",4),d.qCj("change",function(ze){return Re.onToggleDrawControl(ze.checked)}),d.OEk(11),d.wVc(12,"translate"),d.C$Y(),d.yuY(13,me,1,0,"mat-divider",5),d.wVc(14,"async"),d.yuY(15,_e,3,5,"mat-slide-toggle",6),d.wVc(16,"async"),d.yuY(17,de,1,0,"mat-divider",5),d.wVc(18,"async"),d.wVc(19,"async"),d.yuY(20,le,3,5,"mat-slide-toggle",6),d.wVc(21,"async"),d.yuY(22,ue,3,5,"mat-slide-toggle",6),d.wVc(23,"async"),d.yuY(24,ne,1,0,"mat-divider",5),d.wVc(25,"async"),d.I0R(26,"mat-slide-toggle",7),d.qCj("change",function(ze){return Re.onToggleMeasureUnitsAuto(ze.checked)}),d.OEk(27),d.wVc(28,"translate"),d.C$Y()(),d.yuY(29,Le,3,2,"ng-container",5),d.wVc(30,"async"),d.yuY(31,He,1,0,"mat-divider",5),d.wVc(32,"async"),d.wVc(33,"async"),d.I0R(34,"div",8),d.yuY(35,Ve,5,6,"button",9),d.wVc(36,"async"),d.wVc(37,"async"),d.yuY(38,Ge,5,6,"button",10),d.wVc(39,"async"),d.wVc(40,"async"),d.C$Y(),d.wR5(41,"igo-entity-table",11,12),d.C$Y()),2&ge&&(d.yG2(2),d.E7m("value",Re.activeMeasureType),d.yG2(),d.E7m("value",Re.measureType.Length),d.yG2(),d.oRS(" ",d.kDX(5,24,"igo.geo.measure."+Re.measureType.Length)," "),d.yG2(2),d.E7m("value",Re.measureType.Area),d.yG2(),d.oRS(" ",d.kDX(8,26,"igo.geo.measure."+Re.measureType.Area)," "),d.yG2(3),d.E7m("disabled",Re.drawControlIsDisabled)("checked",Re.drawControlIsActive)("labelPosition","before"),d.yG2(),d.oRS(" ",d.kDX(12,28,"igo.geo.measure.toggleActive")," "),d.yG2(2),d.E7m("ngIf",d.kDX(14,30,Re.hasLine$)),d.yG2(2),d.E7m("ngIf",d.kDX(16,32,Re.hasLine$)),d.yG2(2),d.E7m("ngIf",d.kDX(18,34,Re.hasLine$)||d.kDX(19,36,Re.hasArea$)),d.yG2(3),d.E7m("ngIf",d.kDX(21,38,Re.hasArea$)),d.yG2(2),d.E7m("ngIf",d.kDX(23,40,Re.hasArea$)),d.yG2(2),d.E7m("ngIf",d.kDX(25,42,Re.hasArea$)),d.yG2(2),d.E7m("checked",Re.measureUnitsAuto)("labelPosition","before"),d.yG2(),d.oRS(" ",d.kDX(28,44,"igo.geo.measure.toggleAutoUnits")," "),d.yG2(2),d.E7m("ngIf",d.kDX(30,46,Re.measure$)),d.yG2(2),d.E7m("ngIf",d.kDX(32,48,Re.hasLine$)||d.kDX(33,50,Re.hasArea$)),d.yG2(4),d.E7m("ngIf",d.kDX(36,52,Re.hasLine$)||d.kDX(37,54,Re.hasArea$)),d.yG2(3),d.E7m("ngIf",d.kDX(39,56,Re.hasLine$)||d.kDX(40,58,Re.hasArea$)),d.yG2(3),d.E7m("store",Re.store)("template",Re.tableTemplate))},dependencies:[w.ue,w.gn,w.KU,c.GE,c.cP,E.u_,p.U,p.k,H,a.oJ,a.um,o.KO,o.a4,e.oB,e.qL,R.Eh,E.a,L._s,u.sD],styles:["[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}  .igo-map-tooltip-hidden, .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return Ie})()},45076:(Pe,ae,r)=>{"use strict";r.d(ae,{K8:()=>E.K8,aK:()=>a.aK,cD:()=>a.cD,ie:()=>a.ie,ox:()=>a.ox,wP:()=>a.wP});var E=r(69904),a=r(8512)},69904:(Pe,ae,r)=>{"use strict";r.d(ae,{K8:()=>w,Ks:()=>p,Mh:()=>e,gn:()=>a,kK:()=>c});var a=function(o){return o.Length="length",o.Area="area",o}(a||{}),w=function(o){return o.Meters="meters",o.Kilometers="kilometers",o.Miles="miles",o.Feet="feet",o}(w||{});const p={[w.Meters]:"m",[w.Kilometers]:"km",[w.Miles]:"mi",[w.Feet]:"ft"};var e=function(o){return o.SquareMeters="squareMeters",o.SquareKilometers="squareKilometers",o.SquareMiles="squareMiles",o.SquareFeet="squareFeet",o.Hectares="hectares",o.Acres="acres",o}(e||{});const c={[e.SquareMeters]:"m\xb2",[e.SquareKilometers]:"km\xb2",[e.SquareMiles]:"mi\xb2",[e.SquareFeet]:"ft\xb2",[e.Hectares]:"ha",[e.Acres]:"ac"}},8512:(Pe,ae,r)=>{"use strict";r.d(ae,{AX:()=>j,Ej:()=>Y,Gs:()=>K,IP:()=>Z,Og:()=>M,aK:()=>_e,aS:()=>x,cD:()=>u,iK:()=>z,ie:()=>G,ox:()=>U,wP:()=>N,wr:()=>d,yK:()=>A});var E=r(28276),a=r(94448),w=r(28668),p=r(62808),e=r(80848),c=r(36752),o=r(49412),R=r(54776),L=r(45212),_=r(88872),C=r(87544),S=r(69904);function P(le){return.001*le}function y(le){return 3.2808*le}function F(le){return 621e-6*le}function h(le){return 1e-6*le}function W(le){return 3.861e-7*le}function J(le){return 10.764*le}function T(le){return 1e-4*le}function Q(le){return 24711e-8*le}function z(le,ue){const ve=new Map([[S.K8.Meters,ye=>ye],[S.K8.Kilometers,P],[S.K8.Miles,F],[S.K8.Feet,y]]).get(ue);return ve?ve(le):void 0}function Y(le,ue){const ve=new Map([[S.Mh.SquareMeters,ye=>ye],[S.Mh.SquareKilometers,h],[S.Mh.SquareMiles,W],[S.Mh.SquareFeet,J],[S.Mh.Hectares,T],[S.Mh.Acres,Q]]).get(ue);return ve?ve(le):void 0}function N(le,ue,ne){let ve=ue.decimal;(void 0===ve||ve<0)&&(ve=1);const ye=[];return ye.push(void 0!==ue.locale?le.toLocaleString(ue.locale,{minimumFractionDigits:ve,maximumFractionDigits:ve}):le.toFixed(ve).toString()),void 0!==ue.unit&&!0===ue.unitAbbr&&ye.push(ne?ne.translate.instant(S.Ks[ue.unit]?"igo.geo.measure."+S.Ks[ue.unit]:"igo.geo.measure."+S.kK[ue.unit]):S.Ks[ue.unit]||S.kK[ue.unit]),ye.filter(Le=>void 0!==Le).join(" ")}function K(le){let ue=S.K8.Meters,ne=le;const ve=[S.K8.Kilometers];for(;ne>1e3&&ve.length>0;)ue=ve.pop(),ne=z(le,ue);return ue}function j(le){let ue=S.Mh.SquareMeters,ne=le;const ve=[S.Mh.SquareKilometers];for(;ne>1e6&&ve.length>0;)ue=ve.pop(),ne=Y(le,ue);return ue}function A(){return new R.cp({stroke:new L.c({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new _.c({color:"rgba(255, 255, 255, 0.2)"}),image:new C.c({radius:5,stroke:new L.c({color:"#ffcc33"}),fill:new _.c({color:"rgba(255, 255, 255, 0.2)"})})})}function d(){return new R.cp({stroke:new L.c({color:"#ffcc33",width:2}),fill:new _.c({color:"rgba(255, 255, 255, 0.2)"})})}function u(le,ue){if(!(le instanceof e.c)&&0!==le.getFlatCoordinates().length)return(0,o.S2)(le,{projection:ue})}function x(le,ue){if(!(le instanceof e.c||le instanceof p.c)&&0!==le.getFlatCoordinates().length)return(0,o.kh)(le,{projection:ue})}function U(le,ue){const ne=u(le,ue),ve=x(le,ue),ye=[],Le=le.getFlatCoordinates(),He=Le.length;for(let Ve=0;Ve<=He-4;Ve+=2){const Ge=new p.c([[Le[Ve],Le[Ve+1]],[Le[Ve+2],Le[Ve+3]]]);ye.push(u(Ge,ue))}return{area:ve,length:ne,lengths:ye}}function G(le){let ue;if(le instanceof e.c){const ne=new e.c(le.getFlatCoordinates());ue=new Array(1),ue[0]=ne}else{ue=D(le);const ne=le.getFlatCoordinates(),ve=ue.length;for(let ye=0;ye<ve;ye++){const Le=2*ye,Ve=new p.c([[ne[Le],ne[Le+1]],[ne[Le+2],ne[Le+3]]]).getCoordinateAt(.5),Ge=ue[ye];void 0!==Ge?Ge.setCoordinates(Ve):ue[ye]=new e.c(Ve)}}return ue}function D(le){let ue;ue=le instanceof w.c?0:Math.max(le.getFlatCoordinates().length/2-1,0);let ne=le.get("_midpoints");if(void 0===ne)return ne=new Array(le instanceof e.c?1:ue),le.set("_midpoints",ne,!0),ne;if(0===ue||ue===ne.length)return ne;if(ue>ne.length)return ne.push(...new Array(ue-ne.length)),ne;for(let ve=ue;ve<ne.length;ve++){const ye=ne[ue];void 0!==ye&&I(ye)}return ne.splice(ue),ne}function I(le){const ue=le.get("_tooltip");if(void 0!==ue){const ne=ue.getMap();void 0!==ne&&ne.removeOverlay(ue)}}function M(le){const ue=G(le);let ne="";return le instanceof p.c?ne="line-":le instanceof c.cp&&(ne="polygone-"),ue.map(ye=>{let Le=ye.get("_tooltip");return void 0===Le?Le=de(ye,!1,ne):Le.setPosition(ye.getFlatCoordinates()),Le})}function Z(le){const ue=function H(le){let ue=le.get("_center");const ne=(0,a.Ks)(le.getExtent());return void 0!==ue?ue.setCoordinates(ne):(ue=new e.c(ne),le.set("_center",ue)),ue}(le);let ne=ue.get("_tooltip");return void 0===ne?ne=de(ue,!0):ne.setPosition(ue.getFlatCoordinates()),ne}function _e(le){const ue=[].concat(function s(le){return D(le).map(ne=>ne?ne.get("_tooltip"):void 0)}(le)||[]),ne=function me(le){const ue=le.get("_center");return ue?ue.get("_tooltip"):void 0}(le);return void 0!==ne&&ue.push(ne),ue}function de(le,ue=!1,ne=""){const ve=new E.c({element:document.createElement("div"),offset:[-30,-10],className:(ue?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${ne}segments`]).join(" "),stopEvent:!1});return ve.setPosition(le.getFlatCoordinates()),le.set("_tooltip",ve),ve}},96659:(Pe,ae,r)=>{"use strict";r.d(ae,{G:()=>E});var E=function(a){return a.System="system",a.User="user",a}(E||{})},31112:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>_});var E=r(43168),a=r(96832),w=r(61616),p=r(1296),e=r(83680),c=r(10211),o=r(40604),R=r(37496),L=r(34896);let _=(()=>{class C{ngxIndexedDBService;dbName="geoData";collisionsMap=new Map;_newData=0;compression=new E.C3;constructor(P){this.ngxIndexedDBService=P}update(P,y,F,h,W){if(!F)return;let J=!1;const T=new w.E;let z,Q=(0,p.of)(F);return F instanceof Blob&&(Q=this.compression.compressBlob(F),J=!0),Q.pipe((0,e.K)(),(0,c.m)(Y=>(z={url:P,regionID:y,object:Y,compressed:J,insertSource:h,insertEvent:W},this.ngxIndexedDBService.getByID(this.dbName,P))),(0,c.m)(Y=>{if(Y){const N=Y.regionID;if(N!==y){const K=this.collisionsMap.get(N);void 0!==K?(K.push(Y.url),this.collisionsMap.set(N,K)):this.collisionsMap.set(N,[Y.url])}return this.customUpdate(z)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,z)})).subscribe(Y=>{T.next(Y),T.complete()}),T}customUpdate(P){const y=new w.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,P.url).pipe((0,c.m)(h=>h?this.ngxIndexedDBService.add(this.dbName,P):(0,p.of)(void 0))).subscribe(h=>{h&&y.next(h),y.complete()}),y}get(P){return this.ngxIndexedDBService.getByID(this.dbName,P).pipe((0,o.k)(y=>{if(y){const F=y.object;return y.compressed?this.compression.decompressBlob(F):F}}))}getByID(P){return this.ngxIndexedDBService.getByID(this.dbName,P)}deleteByKey(P){return this.ngxIndexedDBService.deleteByKey(this.dbName,P)}getRegionCountByID(P){const y=new w.E;return this.getRegionByID(P).subscribe(h=>{y.next(h.length),y.complete()}),y}getRegionByID(P){if(!P)return;const y=IDBKeyRange.only(P);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",y)}deleteByRegionID(P){if(!P)return;const y=IDBKeyRange.only(P),F=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",y);return F.subscribe(h=>{h.forEach(W=>{this.ngxIndexedDBService.deleteByKey(this.dbName,W.url)})}),F}openCursor(P=IDBKeyRange.lowerBound(0),y=a.aI.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",P,y)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[P,y]of this.collisionsMap)for(const F of y)this.ngxIndexedDBService.getByKey(this.dbName,F).pipe((0,R.U)(1)).subscribe(h=>{h.regionID=P,this.customUpdate(h)})}get newData(){return this._newData}static \u0275fac=function(y){return new(y||C)(L.CoB(a.aQ))};static \u0275prov=L.wxM({token:C,factory:C.\u0275fac,providedIn:"root"})}return C})()},39532:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>c});var E=r(49112),a=r(31112),w=r(34896),p=r(33712);let c=(()=>{class o{http;geoDBService;networkService;networkOnline=!0;constructor(L,_,C){this.http=L,this.geoDBService=_,this.networkService=C,this.networkService.currentState().subscribe(S=>{this.networkOnline=S.connection})}get(L,_){return window.navigator.onLine&&this.networkOnline?this.getOnline(L,_):this.getOffline(L)}getOnline(L,_){let C;switch(_.responseType){case"arraybuffer":C=this.http.get(L,{responseType:"arraybuffer",withCredentials:_.withCredentials});break;case"text":C=this.http.get(L,{responseType:"text",withCredentials:_.withCredentials});break;case"json":C=this.http.get(L,{responseType:"json",withCredentials:_.withCredentials});break;default:C=this.http.get(L,{responseType:"blob",withCredentials:_.withCredentials})}return C}getOffline(L){return this.geoDBService.get(L)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(_){return new(_||o)(w.CoB(p.KK),w.CoB(a.U),w.CoB(E.u))};static \u0275prov=w.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},36404:(Pe,ae,r)=>{"use strict";r.d(ae,{m:()=>w});var E=r(76572),a=r(25607);class w{map;layer;get dataSource(){return this.layer.dataSource}constructor(e){this.layer=(0,a.c)(),this.setMap(e)}setMap(e){void 0===e?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e}setFeatures(e,c=E.Su.Default,o){if(o)for(const R of this.dataSource.ol.getFeatures())R.get("_sourceId")===o&&this.removeOlFeature(R);else this.clear();this.addFeatures(e,c)}addFeature(e,c=E.Su.Default){this.addFeatures([e],c)}addFeatures(e,c=E.Su.Default){const o=[];e.forEach(R=>{const L=(0,E.K6)(R,this.map.projection);null!==L.getGeometry()&&o.push(L)}),this.addOlFeatures(o,c)}addOlFeature(e,c=E.Su.Default){this.addOlFeatures([e],c)}addOlFeatures(e,c=E.Su.Default){this.dataSource.ol.addFeatures(e),(0,E.QX)(this.map.viewController,e,c)}removeFeature(e){this.removeFeatures([e])}removeFeatures(e){e.forEach(c=>{c.meta&&this.dataSource.ol.getFeatureById(c.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(c.meta.id))})}removeOlFeature(e){this.dataSource.ol.removeFeature(e)}clear(){this.dataSource.ol.clear()}}},25607:(Pe,ae,r)=>{"use strict";r.d(ae,{c:()=>p});var E=r(3544),a=r(2892),w=r(52756);function p(){const e=new E.EB;return new a.M({title:"Overlay",zIndex:300,source:e,style:(0,w.I)()})}},29272:(Pe,ae,r)=>{"use strict";r.d(ae,{K:()=>K});var E=r(35392),a=r(75684),w=r(24956),p=r(45872),e=r(20460),c=r(64100),o=r(43168),R=r(16772),L=r(96116),_=r.n(L),C=r(864),S=r(97104),P=r.n(S),y=r(61616),F=r(21296),h=r(44816),W=r(40604),T=r(59324);function Q(j){const A=function(d,u){const x=d.join(" "),U=u[0],G=u[2],X=u[1],D=u[3],I=[D,U,X,U,X,G,D,G].join(" "),M=this.internal.newAdditionalObject(),s=this.internal.newAdditionalObject(),H=this.internal.newAdditionalObject();H.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',s.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+H.objId+" 0 R /GPTS [ "+I+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",M.content="<< /BBox [ "+x+" ] /Measure "+s.objId+" 0 R /Name (Layer) /Type /Viewport >>";const Z=this.internal.newAdditionalObject(),me=(new Date).toLocaleDateString("en-CA");return Z.content="<< /Name IGO2 /Type /OCG /Date "+me+" >>",M.objId};j.setGeoArea=function(d,u){this.internal.events.subscribe("putPage",function(){const x=A.call(this,d,u);this.internal.write("/VP [ "+x+" 0 R ]")})}}var z=r(47580),Y=r(34896),N=r(33712);let K=(()=>{class j{http;messageService;activityService;languageService;configService;zipFile;nbFileToProcess;activityId;mapPrintExtent;imgSizeAdded;TEXTPDFFONT={titleFont:"times",titleFontStyle:"bold",subtitleFont:"times",subtitleFontStyle:"bold",commentFont:"times",commentFontStyle:"normal",commentFontSize:12};constructor(d,u,x,U,G){this.http=d,this.messageService=u,this.activityService=x,this.languageService=U,this.configService=G}print(d,u){var x=this;const U=new y.E,G=u.paperFormat,X=+u.resolution,D=u.orientation,I=u.legendPosition;this.activityId=this.activityService.register(),Q(C.default.API);const M=new C.default({orientation:D,format:G.toLowerCase(),unit:"mm"}),{width:s,height:H}=M.internal.pageSize,Z=[10,10,10,10];let me,_e;(""!==u.title||""!==u.subtitle)&&(G===z.QH.A1||G===z.QH.A0)&&(Z[0]+=10);const de=Math.round(2*(H+145)*.05)/2;return void 0!==u.title&&""!==u.title&&(me=this.getTextPdfObjectSizeAndMarg(u.title,Z,this.TEXTPDFFONT.titleFont,de,this.TEXTPDFFONT.titleFontStyle,M),this.addTextInPdfDoc(M,u.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,me.fontSize,me.marginLeft+Z[3],Z[0]),Z[0]=me.height+Z[0]),void 0!==u.subtitle&&""!==u.subtitle&&(_e=this.getTextPdfObjectSizeAndMarg(u.subtitle,Z,this.TEXTPDFFONT.subtitleFont,""!==u.title?.7*me.fontSize:.7*de,this.TEXTPDFFONT.subtitleFontStyle,M),this.addTextInPdfDoc(M,u.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,_e.fontSize,_e.marginLeft+Z[3],Z[0]),Z[0]+=5),void 0!==u.comment&&""!==u.comment&&this.addComment(M,u.comment,Z,5),(!0===u.showProjection||!0===u.showScale)&&this.addProjScale(M,d,X,u.showProjection,u.showScale,Z,5),this.addMap(M,d,X,[s-Z[3]-Z[1],H-Z[0]-Z[2]],Z,I).subscribe(function(){var ye=(0,E.c)(function*(Le){Le===o.qM.Done&&(yield x.handleMeasureLayer(M,d,Z),x.addGeoRef(M,d,x.imgSizeAdded[0],x.imgSizeAdded[1],Z),"none"!==u.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(u.legendPosition)>-1?yield x.addLegendSamePage(M,d,Z,X,u.legendPosition):"newpage"===u.legendPosition&&(yield x.addLegend(M,d,Z,X)):yield x.saveDoc(M)),(Le===o.qM.Done||Le===o.qM.Error)&&(x.activityService.unregister(x.activityId),U.next(o.qM.Done))});return function(Le){return ye.apply(this,arguments)}}()),U}addGeoRef(d,u,x,U,G){const D=d.internal.pageSize.getHeight(),I=G[3],M=D-G[0]-U;let s=[I,M,I+x,M+U];for(let H=0;H<s.length;H++)s[H]=this.pdf_units2points(s[H],"mm");d.setGeoArea(s,this.mapPrintExtent)}handleMeasureLayer(d,u,x){var U=this;return(0,E.c)(function*(){if(u.layers.find(G=>G.visible&&G.id.startsWith("igo-measures-"))){let G;const X=u.ol.getOverlayContainer();yield _()(X,{scale:1,backgroundColor:null}).then(D=>{G=D}),U.addCanvas(d,G,x)}})()}getLayersLegendHtml(d,u,x){return new F._(U=>{let G="";const X=function J(j,A){const d=[];for(const u of j){const x=u.options.legendOptions;if(!1===u.visible)continue;const U=u.dataSource.getLegend(void 0,A)||[];for(const G of U)void 0!==G.url&&d.push({title:u.title||"",url:G.url,display:void 0===x?.display||x.display,isInResolutionsRange:u.isInResolutionsRange})}return d}(d.layers,{resolution:d.viewController.getResolution(),extent:d.viewController.getExtent(),projection:d.viewController.getOlProjection().getCode(),size:d.ol.getSize()});if(0===X.filter(I=>!0===I.display).length)return U.next(G),void U.complete();G+='<style media="screen" type="text/css">',G+=".html2canvas-container { width: "+u+"mm !important; height: 2000px !important; }",G+="table.tableLegend {table-layout: auto;}",G+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",G+="</style>",G+='<font size="3" face="Times" >',G+='<div class="styleLegend">',G+='<table class="tableLegend" >';const D=X.filter(I=>I.display&&!0===I.isInResolutionsRange).map(I=>this.getDataImage(I.url).pipe((0,W.k)(M=>{let s="<tr><td>"+I.title.toUpperCase()+"</td></tr>";return s+='<tr><td><img src="'+M+'"></td></tr>',s})));(0,h.y)(D).subscribe(I=>{G=I.reduce((M,s)=>M+s,G),G+="</table>",G+="</div>",U.next(G),U.complete()})})}getDataImage(d){return new a.kd(this.http,this.configService).transform(d)}getLayersLegendImage(d,u="png",x,U){var G=this;return(0,E.c)(function*(){const X=new y.E;let I=yield G.getLayersLegendHtml(d,200,U).toPromise();u=u.toLowerCase(),0===I.length&&(I='<font size="12" face="Courier New" >',I+='<div align="center"><b>NO LEGEND</b></div>');const M=window.document.createElement("div");M.style.position="absolute",M.style.top="0",M.style.zIndex="-1",window.document.body.appendChild(M),M.innerHTML=I,yield G.timeout(1);const s=yield _()(M,{useCORS:!0}).catch(H=>{console.log(H)});if(G.removeHtmlElement(M),s){let H=o.qM.Done;try{x?G.generateCanvaFileToZip(s,"legendImage."+u):G.saveCanvasImageAsFile(s,"legendImage",u)}catch{H=o.qM.Error}X.next(H)}return X})()}removeHtmlElement(d){d.parentNode.removeChild(d)}getTextPdfObjectSizeAndMarg(d,u,x,U,G,X){const M=X.internal.pageSize.getWidth()-u[1]-u[3];X.setFont(x,G),X.setFontSize(U);let H,s=X.getTextDimensions(d);return s.w>M?(H=0,X.setFontSize(U*=.7),s=X.getTextDimensions(d)):H=(M-s.w)/2,{fontSize:U,marginLeft:H,height:s.h}}addComment(d,u,x,U){x[2]+=U,this.addTextInPdfDoc(d,u,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,x[3],d.internal.pageSize.height-x[2]+U,!0)}addTextInPdfDoc(d,u,x,U,G,X,D,I=!1){d.setFont(x,U),d.setFontSize(G),I&&(u=d.splitTextToSize(u,d.internal.pageSize.getWidth()-3*X)),d.text(u,X,D)}addProjScale(d,u,x,U,G,X,D){X[2]+=D;const I=this.languageService.translate,s=X[3],Z=d.internal.pageSize.height-X[2]+D;let me="";if(!0===U&&(me+=I.instant("igo.geo.printForm.projection")+": "+u.projection),!0===G){!0===U&&(me+="   ");const _e=I.instant("igo.geo.printForm.scale"),de=u.viewController.getScale(x);me+=_e+": ~ 1 / "+(0,T.rE)(de)}d.setFont(this.TEXTPDFFONT.commentFont),d.setFontSize(12),d.text(me,s,Z)}addLegend(d,u,x,U){var G=this;return(0,E.c)(function*(){const X=d.internal.pageSize.width,D=yield G.getLayersLegendHtml(u,X,U).toPromise();if(""===D)return yield G.saveDoc(d),!0;const I=window.document.createElement("div");I.style.position="absolute",I.style.top="0",I.style.zIndex="-1",window.document.body.appendChild(I),I.innerHTML=D,yield G.timeout(1);const M=yield _()(I,{useCORS:!0}).catch(s=>{console.log(s)});if(G.removeHtmlElement(I),M){const H=[25.4*M.width*.85/U,25.4*M.height*.85/U];let Z;d.addPage(),Z=M.toDataURL("image/png"),d.addImage(Z,"PNG",10,10,H[0],H[1])}yield G.saveDoc(d)})()}addLegendSamePage(d,u,x,U,G){var X=this;return(0,E.c)(function*(){const D=d.internal.pageSize.width,I=yield X.getLayersLegendHtml(u,D,U).toPromise();if(""===I)return yield X.saveDoc(d),!0;const M=window.document.createElement("div");M.style.position="absolute",M.style.top="0",M.style.zIndex="-1",window.document.body.appendChild(M),M.innerHTML=I,yield X.timeout(1);const s=yield _()(M,{useCORS:!0}).catch(Z=>{console.log(Z)});let H;if(X.removeHtmlElement(M),s){const me=[25.4*s.width*.85/U,25.4*s.height*.85/U];"bottomright"===G?H=[d.internal.pageSize.height-x[2]-me[1],x[1],x[2],d.internal.pageSize.width-x[1]-me[0]]:"topright"===G?H=[x[0],x[1],d.internal.pageSize.height-x[0]-me[1],d.internal.pageSize.width-x[1]-me[0]]:"bottomleft"===G?H=[d.internal.pageSize.height-x[2]-me[1],d.internal.pageSize.width-x[3]-me[0],x[2],x[3]]:"topleft"===G&&(H=[x[0],d.internal.pageSize.width-x[3]-me[0],d.internal.pageSize.height-x[0]-me[1],x[3]]),X.addCanvas(d,s,H),yield X.saveDoc(d)}})()}defineNbFileToProcess(d){this.nbFileToProcess=d}timeout(d){return new Promise(u=>setTimeout(u,d))}addCanvas(d,u,x){let U;if(u&&(U=u.toDataURL("image/png")),void 0!==U){if(U.length<20)return void console.log("Warning: An image cannot be print in pdf file");const G=this.getImageSizeToFitPdf(d,u,x);d.addImage(U,"PNG",x[3],x[0],G[0],G[1]),d.rect(x[3],x[0],G[0],G[1]),this.imgSizeAdded=G}}addMap(d,u,x,U,G,X){var D=this;const I=u.ol.getSize(),M=u.ol.getView().getResolution(),s=this.setMapResolution(u,U,x,M),H=new y.E;let Z;return u.ol.once("rendercomplete",function(){var me=(0,E.c)(function*(_e){const de=_e.target.getViewport().getElementsByTagName("canvas"),le=yield D.drawMap(s,de);D.mapPrintExtent=u.viewController.getExtent("EPSG:3857"),D.resetOriginalMapSize(u,I,M),yield D.drawMapControls(u,le,X);const ue=u.status$.subscribe(ne=>{if(clearTimeout(Z),ne!==o.qM.Done)return;ue.unsubscribe();let ve=o.qM.Done;try{0!==le.width&&D.addCanvas(d,le,G)}catch{ve=o.qM.Error,D.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}H.next(ve)});Z=window.setTimeout(()=>{ue.unsubscribe();let ne=o.qM.Done;try{0!==le.width&&D.addCanvas(d,le,G)}catch{ne=o.qM.Error,D.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}D.resetOriginalMapSize(u,I,M),H.next(ne)},200)});return function(_e){return me.apply(this,arguments)}}()),H}setMapResolution(d,u,x,U){const G=d.ol.getSize(),X=Math.round(u[0]*x/25.4),D=Math.round(u[1]*x/25.4);d.ol.setSize([X,D]);const M=Math.min(X/G[0],D/G[1]);return d.ol.getView().setResolution(U/M),[X,D]}resetOriginalMapSize(d,u,x){d.ol.setSize(u),d.ol.getView().setResolution(x),d.ol.updateSize(),d.ol.renderSync()}drawMap(d,u){var x=this;return(0,E.c)(function*(){const U=document.createElement("canvas");U.width=d[0],U.height=d[1];for(let G=0;G<u.length;G++){const X=u[G];X.width>0&&x.handleCanvas(X,U)}return U})()}handleCanvas(d,u){const x=u.getContext("2d"),U=d.parentElement.style.opacity||d.style.opacity;x.globalAlpha=""===U?1:Number(U);const G=d.style.transform;let X;X=G?G.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(d.style.width)/d.width,0,0,parseFloat(d.style.height)/d.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(x,X);const D=d.parentElement.style.backgroundColor;D&&(x.fillStyle=D,x.fillRect(0,0,d.width,d.height)),x.drawImage(d,0,0),x.globalAlpha=1,x.setTransform(1,0,0,1,0,0)}drawMapControls(d,u,x){var U=this;return(0,E.c)(function*(){const G=u.getContext("2d"),X=d.ol.getOverlayContainerStopEvent().cloneNode(!0);yield U.addNorthDirection(X,x),yield U.addAttribution(X),X.style.width=u.width+"px",X.style.height=u.height+"px",X.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(X);const D=yield _()(X,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0});0!==D.width&&0!==D.height&&G.drawImage(D,0,0),X.remove()})()}addNorthDirection(d,u){return(0,E.c)(function*(){const x=document.getElementsByTagName("igo-rotation-button")[0].cloneNode(!0),U=x.getElementsByTagName("button")[0];if(!U)return null;"topright"===u&&(x.style.width="inherit",x.style.left="10px"),U.parentElement.style.background="transparent",U.style.color="#000",d.appendChild(x)})()}addAttribution(d){return(0,E.c)(function*(){const u=d.getElementsByClassName("ol-attribution")[0],x=u.getElementsByTagName("button")[0];if(!x)return null;x.setAttribute("data-html2canvas-ignore","true"),u.classList.contains("ol-collapsed")&&u.classList.remove("ol-collapsed")})()}downloadMapImage(d,u,x="png",U=!1,G=!1,X="",D="",I="",M=!0,s){var H=this;const Z=new y.E;this.activityId=this.activityService.register();const me=this.languageService.translate;x=x.toLowerCase();const _e=+u,de=d.ol.getSize(),le=d.ol.getView().getResolution();return d.ol.once("rendercomplete",function(){var ue=(0,E.c)(function*(ne){const ve=d.ol.getSize(),ye=ne.target.getViewport().getElementsByTagName("canvas"),Le=yield H.drawMap(ve,ye);H.resetOriginalMapSize(d,de,le),yield H.drawMapControls(d,Le,s),"none"!==s&&(["topleft","topright","bottomleft","bottomright"].indexOf(s)>-1?yield H.addLegendToImage(Le,d,_e,s,x):"newpage"===s&&(yield H.getLayersLegendImage(d,x,M,_e)));const He=document.createElement("canvas"),Ve=He.getContext("2d");let Ge=0;const ct=Le.width;let Ie=Le.height;Ve.font="20px Calibri";const Ye=Ve.measureText(I).width;Ie=""!==X?Ie+30:Ie,Ie=""!==D?Ie+30:Ie,Ie=!1!==U||!1!==G?Ie+30:Ie;const se=Ie-10,ge=Math.ceil(Ye/ct);Ie=""!==I?Ie+30*ge:Ie;let Re=Ie-20*ge+5;if(He.width=ct,He.height=Ie,["bmp","gif","jpeg","png","tiff"].indexOf(x)>-1&&("jpeg"===x||""!==X||""!==D||""!==I||!1!==U||!1!==G)&&(Ve.fillStyle="#ffffff",Ve.fillRect(0,0,ct,Ie),Ve.fillStyle="#000000"),""!==X&&(Ve.font="26px Calibri",Ge=30,Ve.textAlign="center",Ve.fillText(X,ct/2,20,.9*ct)),""!==D&&(Ve.font="26px Calibri",Ge=60,Ve.textAlign="center",Ve.fillText(D,ct/2,50,.9*ct)),Ve.font="20px Calibri",!1!==U||!1!==G){let Be="";if(!1!==U&&(Be=me.instant("igo.geo.printForm.projection")+": "+d.projection+"         "),!1!==G){const st=me.instant("igo.geo.printForm.scale"),xe=d.viewController.getScale(_e);Be+=st+": ~ 1 / "+(0,T.rE)(xe)}Ve.textAlign="center",Ve.fillText(Be,ct/2,se,.9*ct)}if(""!==I)if(Ve.textAlign="center",1===ge)Ve.fillText(I,ct/2,Re);else{const st=Math.floor(I.length/ge);let Qe,xe="",Ke=0;for(let It=0;It<ge;It++)ge-1>It?(xe=I.substr(Ke,st),Qe=xe.lastIndexOf(" "),Ve.fillText(xe.substr(0,Qe),ct/2,Re),Ke+=Qe,Re+=20):Ve.fillText(I.substr(Ke),ct/2,Re)}Ve.drawImage(Le,0,Ge);let Ue=o.qM.Done,ze="map."+x;"tiff"===x.toLowerCase()&&(ze="map"+d.projection.replace(":","_")+"."+x);try{M?(x.toLowerCase(),H.generateCanvaFileToZip(He,ze)):H.saveCanvasImageAsFile(He,ze,x)}catch{Ue=o.qM.Error}if(Z.next(Ue),"tiff"===x.toLowerCase()){const Be=ze.substring(0,ze.toLowerCase().indexOf(".tiff"))+".tfw",st=H.getWorldFileInformation(d),xe=new Blob([st],{type:"text/plain;charset=utf-8"});M?H.addFileToZip(Be,xe):((0,R.saveAs)(xe,Be),H.saveFileProcessing())}});return function(ne){return ue.apply(this,arguments)}}()),this.setMapImageResolution(d,de,_e,le),Z}setMapImageResolution(d,u,x,U){const G=x/96,X=[Math.round(u[0]*G),Math.round(u[1]*G)];d.ol.setSize(X);const D=Math.min(X[0]/u[0],X[1]/u[1]);d.ol.getView().setResolution(U/D),d.ol.renderSync()}addLegendToImage(d,u,x,U,G){var X=this;return(0,E.c)(function*(){const D="map."+G,I=d.getContext("2d"),M=yield X.getLayersLegendHtml(u,d.width,x).toPromise();if(""===M)return yield X.saveCanvasImageAsFile(d,D,G),!0;const s=window.document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.zIndex="-1",window.document.body.appendChild(s),s.innerHTML=M,yield X.timeout(1);const H=yield _()(s,{useCORS:!0}).catch(Z=>{console.log(Z)});if(H){const Z=d.height,me=d.width,_e=H.height,de=H.width,le=.01*Z;let ue,ne;return"bottomright"===U?(ue=me-de-le,ne=Z-_e-le):"topright"===U?(ue=me-de-le,ne=le):"bottomleft"===U?(ue=le,ne=Z-_e-le-15):"topleft"===U&&(ue=le,ne=le),I.drawImage(H,ue,ne,de,_e),I.strokeRect(ue,ne,de,_e),X.removeHtmlElement(s),!0}})()}renderMap(d,u,x){d.ol.updateSize(),d.ol.renderSync()}saveDoc(d){return(0,E.c)(function*(){yield d.save("map_georef.pdf",{returnPromise:!0})})()}getImageSizeToFitPdf(d,u,x){const U=d.internal.pageSize.getHeight()-(x[0]+x[2]),G=d.internal.pageSize.getWidth()-(x[1]+x[3]),X=this.pdf_units2points(u.height,"mm"),D=this.pdf_units2points(u.width,"mm"),I=X/U,M=D/G,s=I>M?I:M;return[s>1?D/s:D,s>1?X/s:X]}getWorldFileInformation(d){const u=d.viewController.getResolution(),x=d.viewController.getExtent();return[u,0,0,-u,x[0]+u/.5,x[3]-u/.5].join("\n")}saveCanvasImageAsFile(d,u,x){const U="image/"+x,G=this;try{d.toDataURL(),d.toBlob(X=>{(0,R.saveAs)(X,u),G.saveFileProcessing()},U)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(d,u){const U=this;(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new(P()));try{d.toDataURL(),navigator.msSaveBlob?this.addFileToZip(u,d.msToBlob()):d.toBlob(G=>{U.addFileToZip(u,G)},"image/jpeg")}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(d,u){this.zipFile.file(d,u),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const d=this;this.zipFile.generateAsync({type:"blob"}).then(u=>{(0,R.saveAs)(u,"map.zip"),delete d.zipFile})}pdf_units2points(d,u){let x=1;switch(u){case"pt":x=1;break;case"mm":x=72/25.4;break;case"cm":x=72/2.54;break;case"in":x=72;break;case"px":x=96/72;break;case"pc":case"em":x=12;break;case"ex":x=6;break;default:throw new Error("Invalid unit: "+u)}return d*x}static \u0275fac=function(u){return new(u||j)(Y.CoB(N.KK),Y.CoB(c.mi),Y.CoB(w.U9),Y.CoB(e.ov),Y.CoB(p.aW))};static \u0275prov=Y.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},47580:(Pe,ae,r)=>{"use strict";r.d(ae,{ID:()=>o,QH:()=>w,mw:()=>c,qp:()=>p,wR:()=>e,wf:()=>a});var E=r(43168);const a=(0,E.GC)(["Pdf","Image"]),w=(0,E.GC)(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),p=(0,E.GC)(["landscape","portrait"]),e=["72","96","150","300"],c=(0,E.GC)(["Bmp","Gif","Jpeg","Png","Tiff"]),o=(0,E.GC)(["none","topright","topleft","bottomleft","bottomright","newpage"])},87048:(Pe,ae,r)=>{"use strict";r.d(ae,{s:()=>P});var E=r(34896),a=r(83552),w=r(24328),p=r(3360),e=r(1296),c=r(14672),o=r(18080),R=r(2892),L=r(9364),_=r(59324),C=r(93199),S=r(17400);let P=(()=>{class y{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new E._w7;get map(){return this.component.map}constructor(h,W){this.component=h,this.queryService=W}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",h=>this.onMapEvent(h))}unlistenToMapClick(){(0,a.S)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(h){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const W=[];this.queryFeatures&&W.push(this.doQueryFeatures(h));const J=this.map.ol.getView().getResolution(),T=this.map.layers.filter(S.wd);W.push(...this.queryService.query(T,{coordinates:h.coordinate,projection:this.map.projection,resolution:J})),0!==W.length&&(this.waitForAllQueries?this.queries$$.push((0,p.E)(...W).subscribe(Q=>{const z=[].concat(...Q);this.query.emit({features:z,event:h})})):this.queries$$=W.map(Q=>Q.subscribe(z=>{this.query.emit({features:z,event:h})})))}doQueryFeatures(h){const W=[];if("singleclick"===h.type)this.map.ol.forEachFeatureAtPixel(h.pixel,(J,T)=>{const Q=this.map.getLayerById(T.values_._layer.id);if(!Q.dataSource.options.queryFormatAsWms&&J)if(J.get("features"))for(const z of J.get("features")){const Y=(0,c.qK)(z,this.map.projection);Y.meta={title:z.values_.nom,id:T.values_._layer.id+"."+z.id_,icon:z.values_._icon,sourceTitle:T.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(Q)},W.push(Y)}else if(J instanceof w.cp){const z=(0,c.In)(J,this.map.projection,T);z.meta={id:T.values_._layer.id+"."+z.meta.id,sourceTitle:T.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(Q),title:this.queryService.getQueryTitle(z,Q)||z.meta.title},W.push(z)}else{const z=(0,c.qK)(J,this.map.projection,T);z.meta={id:T.values_._layer.id+"."+z.meta.id,sourceTitle:T.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(Q),title:this.queryService.getQueryTitle(z,Q)||z.meta.title},W.push(z)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:S.aA});else if("boxend"===h.type){const T=h.target.getGeometry().getExtent();this.map.layers.filter(S.wd).filter(Q=>Q instanceof R.M&&Q.visible).map(Q=>{Q.dataSource.ol.forEachFeatureIntersectingExtent(T,Y=>{const N=(0,c.qK)(Y,this.map.projection,Q.ol);N.meta={id:Q.id+"."+Y.getId(),icon:Y.values_._icon,sourceTitle:Q.title,alias:this.queryService.getAllowedFieldsAndAlias(Q),title:this.queryService.getQueryTitle(N,Q)||N.meta.title},W.push(N)})})}return(0,e.of)(W)}cancelOngoingQueries(){this.queries$$.forEach(h=>h.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let h;const W=this.map.ol.getInteractions().getArray();for(const J of W)if(J instanceof o.E){h=J;break}void 0===h&&(h=new o.E({condition:_.q}),this.map.ol.addInteraction(h),this.olDragSelectInteraction=h),this.olDragSelectInteractionEndKey=h.on("boxend",J=>this.onMapEvent(J))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,a.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(W){return new(W||y)(E.GI1(L.q,2),E.GI1(C.E))};static \u0275dir=E.Sc5({type:y,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"},standalone:!0})}return y})()},49704:(Pe,ae,r)=>{"use strict";r.d(ae,{Il:()=>w,cv:()=>a,s5:()=>E});var E=function(p){return p.GML2="gml2",p.GML3="gml3",p.JSON="json",p.GEOJSON="geojson",p.GEOJSON2="geojson2",p.ESRIJSON="esrijson",p.TEXT="text",p.HTML="html",p.HTMLGML2="htmlgml2",p}(E||{}),a=function(p){return p.GML2="application/vnd.ogc.gml",p.GML3="application/vnd.ogc.gml/3.1.1",p.JSON="application/json",p.GEOJSON="application/geojson",p.GEOJSON2="geojson",p.ESRIJSON="application/json",p.TEXT="text/plain",p.HTML="text/html",p.HTMLGML2="text/html",p}(a||{}),w=function(p){return p.IFRAME="iframe",p.BLANK="_blank",p}(w||{})},93199:(Pe,ae,r)=>{"use strict";r.d(ae,{E:()=>K});var E=r(64100),a=r(43168),w=r(94448),p=r(55784),e=r(10416),c=r(73592),o=r(95456),R=r(14984),L=r(30533),_=r(416),C=r(80848),S=r(62808),P=r(36752),y=r(1296),F=r(9240),h=r(40604),W=r(27164),J=r.n(W),T=r(3544),Q=r(68392),z=r(49704),Y=r(34896),N=r(33712);let K=(()=>{class j{http;messageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(d,u){this.http=d,this.messageService=u}query(d,u){this.previousMessageIds.length&&this.previousMessageIds.forEach(G=>{this.messageService.remove(G)});const x=d.filter(G=>G.visible&&G.isInResolutionsRange).map(G=>this.queryLayer(G,u));return[].concat.apply([],x)}queryLayer(d,u){const x=this.getQueryUrl(d.dataSource,u,!1,d.map.viewController.getExtent());if(!x)return(0,y.of)([]);const U=d.map.viewController.getResolution(),G=d.map.viewController.getScale();if(d.dataSource.options.queryFormat===z.s5.HTMLGML2){if("string"==typeof x){const I=this.getQueryUrl(d.dataSource,u,!0);return this.http.get(I,{responseType:"text"}).pipe((0,F.O)(M=>{const s=this.mergeGML(M,x,d),H=s[0],Z=s[1];return this.http.get(x,{responseType:"text"}).pipe((0,h.k)(me=>this.extractData(me,d,u,x,H,Z)))}))}const X=this.getQueryUrl(d.dataSource,u,!0);let D=[];for(let I=0;I<X.length;I++){const M=X[I];this.checkScaleAndResolution(U,G,M)&&D.push(this.requestDataForHTMLGML2(M.url,x[I].url,d,u))}return D}{if("string"==typeof x)return this.http.get(x,{responseType:"text"}).pipe((0,h.k)(I=>this.extractData(I,d,u,x)));let X=[];for(let D=0;D<x.length;D++){const I=x[D];if(this.checkScaleAndResolution(U,G,I)){const M=this.http.get(I.url,{responseType:"text"});X.push(M.pipe((0,h.k)(s=>this.extractData(s,d,u,I.url))))}}return X}}requestDataForHTMLGML2(d,u,x,U){return this.http.get(d,{responseType:"text"}).pipe((0,F.O)(G=>{const X=this.mergeGML(G,u,x),D=X[0],I=X[1];return this.http.get(u,{responseType:"text"}).pipe((0,h.k)(M=>this.extractData(M,x,U,u,D,I)))}))}checkScaleAndResolution(d,u,x){let U,G;return!(x.minResolution||x.maxResolution||x.minScale||x.maxScale)||(x.minResolution&&x.maxResolution?d>=x.minResolution&&d<=x.maxResolution&&(G=!0):(x.minResolution&&d>=x.minResolution&&(G=!0),x.maxResolution&&d<=x.maxResolution&&(G=!0)),x.minScale&&x.maxScale?u>x.minScale&&u<x.maxScale&&(U=!0):(x.maxScale&&u<=x.maxScale&&(U=!0),x.minScale&&u>=x.minScale&&(U=!0)),!0===U&&!0===G||!0===G&&!U||!0===U&&!G)}mergeGML(d,u,x){let G=(new o.c).readFeatures(d);0===G.length&&(G=(new p.c).readFeatures(d));const X=new L.c([]);let D;const I=[];let s,M=new _.c([]);const H=G.length,_e=this.getQueryParams(u.toLowerCase()).bbox.split(","),de=w.Gu();let ue,ne,ve,ye;if(w.SU(de,_e),x.options?.source?.options){const He=x.options.source.options;He.queryTitle&&(ne=He.queryTitle)}switch(G.map(He=>{if(ne){let ct=He.getProperties()[ne];ct&&(ue=ue?`${ue},${ct}`:ct)}const Ve=He.getGeometry().getCoordinates(),Ge=He.getGeometry().getType();switch(!s&&(s=Ge),Ge){case"Point":1===H?D=new C.c(Ve,"XY"):I.push(Ve);break;case"LineString":X.appendLineString(new S.c(Ve,"XY"));break;case"Polygon":M.appendPolygon(new P.cp(Ve,"XY"));break;case"MultiPolygon":M=new _.c(Ve,"XY");break;default:return}}),ve=0===I.length&&D?{type:D.getType(),coordinates:D.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(I)]},s){case"LineString":ye={type:X.getType(),coordinates:X.getCoordinates()};break;case"Point":ye=ve;break;case"Polygon":case"MultiPolygon":ye={type:M.getType(),coordinates:M.getCoordinates()}}const Le={};return ne&&(Le[ne]=ue),[ye,Le]}cross(d,u,x){return(d[0]-x[0])*(u[1]-x[1])-(d[1]-x[1])*(u[0]-x[0])}convexHull(d){d.sort((U,G)=>U[0]===G[0]?U[1]-G[1]:U[0]-G[0]);const u=[];for(const U of d){for(;u.length>=2&&this.cross(u[u.length-2],u[u.length-1],U)<=0;)u.pop();u.push(U)}const x=[];for(let U=d.length-1;U>=0;U--){for(;x.length>=2&&this.cross(x[x.length-2],x[x.length-1],d[U])<=0;)x.pop();x.push(d[U])}return x.pop(),u.pop(),u.concat(x)}extractData(d,u,x,U,G,X){const D=u.dataSource,I=this.getAllowedFieldsAndAlias(u);let M=[];switch(D.options.queryFormat){case z.s5.GML3:M=this.extractGML3Data(d,u.zIndex,I);break;case z.s5.JSON:case z.s5.GEOJSON:case z.s5.GEOJSON2:M=this.extractGeoJSONData(d,u.zIndex,I);break;case z.s5.ESRIJSON:M=this.extractEsriJSONData(d,u.zIndex,I);break;case z.s5.TEXT:M=this.extractTextData(d);break;case z.s5.HTML:M=this.extractHtmlData(d,D.queryHtmlTarget,U);break;case z.s5.HTMLGML2:M=this.extractHtmlData(d,D.queryHtmlTarget,U,G,X);break;default:M=this.extractGML2Data(d,u,I)}if(M.length>0&&(null===M[0].geometry||!M[0].geometry)){const Z=this.createGeometryFromUrlClick(U);for(const me of M)me.geometry=Z}const s=u.dataSource;if((s.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(U)&&(s.params?.FEATURE_COUNT&&this.featureCount>1&&M.length===this.featureCount||!s.params?.FEATURE_COUNT&&M.length===this.defaultFeatureCount)){const Z=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:u.title});this.previousMessageIds.push(Z.toastId)}return M.map((Z,me)=>{const _e=Z.properties[D.mapLabel];let de;if("wms"===u.options.sourceOptions?.type){const ne=u.options.sourceOptions;de=ne?ne.excludeAttribute:void 0}let le=this.getQueryTitle(Z,u);!le&&M.length>1?le=`${u.title} (${me+1})`:le||(le=u.title);const ue=Object.assign({},Z.meta||{},{id:(0,a.uq)(),title:le,mapTitle:_e,sourceTitle:u.title,order:1e3-u.zIndex,excludeAttribute:de});return Object.assign(Z,{meta:ue,projection:"carto"===D.options.type?"EPSG:4326":x.projection})})}createGeometryFromUrlClick(d){const u=this.getQueryParams(d.toLowerCase()),x=u.bbox,U=parseInt(u.width,10),G=parseInt(u.height,10),X=parseInt(u.i||u.x,10),D=parseInt(u.j||u.y,10),I=x.split(",");let M=.05*(Math.abs(parseFloat(I[0]))-Math.abs(parseFloat(I[2])));Math.abs(parseFloat(I[0]))<180&&(M=.045);const s=parseFloat(I[0])+Math.abs(parseFloat(I[0])-parseFloat(I[2]))*X/U-M,H=parseFloat(I[1])+Math.abs(parseFloat(I[1])-parseFloat(I[3]))*D/G-M,Z=s+2*M,me=H+2*M,_e="POLYGON(("+s+" "+H+", "+s+" "+me+", "+Z+" "+me+", "+Z+" "+H+", "+s+" "+H+"))",ue=(new e.c).readFeature(_e).getGeometry();return{type:ue.getType(),coordinates:ue.getCoordinates()}}extractGML2Data(d,u,x){let G=(new o.c).readFeatures(d);if(0===G.length){const X=new p.c;try{G=X.readFeatures(d)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return G.map(X=>this.featureToResult(X,u,x))}extractGML3Data(d,u,x){const U=new R.c;let G=[];try{G=U.readFeatures(d)}catch{console.warn("query.service: GML3 is not well supported")}return G.map(X=>this.featureToResult(X,u,x))}extractGeoJSONData(d,u,x){let U=[];try{U=JSON.parse(d.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson","\n",d)}return U.map(G=>G.meta={id:(0,a.uq)(),order:1e3-u,alias:x}),U}extractEsriJSONData(d,u,x){if(d)try{if(JSON.parse(d).error)return[]}catch{}return(new c.c).readFeatures(d).map(X=>this.featureToResult(X,u,x))}extractTextData(d){return[]}extractHtmlData(d,u,x,U,G){const X=this.getQueryParams(x.toLowerCase()),D=X.crs||X.srs||"EPSG:3857",I=this.createGeometryFromUrlClick(x);u!==z.Il.BLANK&&u!==z.Il.IFRAME&&(u=z.Il.IFRAME);const M=d.toLowerCase().indexOf("<body>"),s=d.toLowerCase().lastIndexOf("</body>")+7;return""===J()(d.slice(M,s).replace(/(\r|\n|\s)/g,""))||""===d?[]:[{type:Q.Y,projection:D,properties:Object.assign({target:u,body:d,url:x},G),geometry:U||I}]}getQueryParams(d){const u=d.split("?");if(!u[1])return;const x=u[1].split("&"),U={};return x.forEach(G=>{G=G.split("="),U[G[0]]=decodeURIComponent(G[1]||"")}),U}featureToResult(d,u,x){const U=d.getGeometry(),G=Object.assign({},d.getProperties());let X;return delete G.geometry,delete G.GEOMETRIE,delete G.boundedBy,delete G.shape,delete G.SHAPE,delete G.SHAPE_S,delete G.SHAPE_L,delete G.SHAPE_P,delete G.the_geom,delete G.geom,delete G.geom32198,U&&(X={type:U.getType(),coordinates:U.getCoordinates()}),{type:Q.Y,projection:void 0,properties:G,geometry:X,meta:{id:(0,a.uq)(),order:1e3-u,alias:x}}}getQueryUrl(d,u,x=!1,U){let G;if(d.options.queryUrls)return this.getCustomQueryUrl(d,u,U);switch(d.constructor){case T.CK:const X=d,D={INFO_FORMAT:X.params.INFO_FORMAT||this.getMimeInfoFormat(d.options.queryFormat),QUERY_LAYERS:X.params.LAYERS,FEATURE_COUNT:X.params.FEATURE_COUNT||this.defaultFeatureCount};X.params.FEATURE_COUNT&&(this.featureCount=X.params.FEATURE_COUNT),x&&(D.INFO_FORMAT=this.getMimeInfoFormat(z.s5.GML2)),G=X.ol.getFeatureInfoUrl(u.coordinates,u.resolution,u.projection,D);break;case T.aI:G=`${"https://"+d.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+d.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${u.coordinates[0]+","+u.coordinates[1]+"),3857),"+(d.options.queryPrecision?d.options.queryPrecision:"1000")+"))"}`;break;case T.yA:case T.W4:const de=d,le=Math.abs(U[0]-U[2]),ue=Math.abs(U[1]-U[3]),ye=de.options.queryPrecision?de.options.queryPrecision:.005*(le>ue?le:ue),Le=w.cz(w.cj([u.coordinates]),ye);G=`${de.options.url+"/"+de.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+Le[0]+',"ymin":'+Le[1]+',"xmax":'+Le[2]+',"ymax":'+Le[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return G}getMimeInfoFormat(d){let u="application/vnd.ogc.gml";const x=Object.keys(z.s5).find(U=>z.s5[U]===d);return x&&(u=z.cv[x]),u}getAllowedFieldsAndAlias(d){let u;return d.options?.source?.options?.sourceFields&&d.options.source.options.sourceFields.length>=1&&(u={},d.options.source.options.sourceFields.forEach(x=>{u[x.name]=x.alias?x.alias:x.name})),u}getQueryTitle(d,u){let x;if(u.options?.source?.options){const U=u.options.source.options;U.queryTitle&&(x=this.getLabelMatch(d,U.queryTitle))}return x}getLabelMatch(d,u){let x=u;const U=Array.from(u.matchAll(/\$\{([^\{\}]+)\}/g));return U.forEach(G=>{x=x.replace(G[0],d.properties[G[1]])}),0===U.length&&x===u&&(x=d.properties[u]||u),x}getCustomQueryUrl(d,u,x){const U=w.C2(u.coordinates,u.resolution,0,[101,101]);return d.options.queryUrls.map(G=>{let X={url:G.url.replace(/\{bbox\}/g,U.join(",")).replace(/\{x\}/g,u.coordinates[0].toString()).replace(/\{y\}/g,u.coordinates[1].toString()).replace(/\{resolution\}/g,u.resolution.toString()).replace(/\{srid\}/g,u.projection.replace("EPSG:",""))};return x&&X.url.replace(/\{xmin\}/g,x[0].toString()).replace(/\{ymin\}/g,x[1].toString()).replace(/\{xmax\}/g,x[2].toString()).replace(/\{ymax\}/g,x[3].toString()),G.maxResolution&&(X.maxResolution=G.maxResolution),G.minResolution&&(X.minResolution=G.minResolution),G.minScale&&(X.minScale=G.minScale),G.maxScale&&(X.maxScale=G.maxScale),X})}static \u0275fac=function(u){return new(u||j)(Y.CoB(N.KK),Y.CoB(E.mi))};static \u0275prov=Y.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},17400:(Pe,ae,r)=>{"use strict";function E(e){return!0===e.dataSource.options.queryable}function p(e){const c=e.get("_layer");return void 0!==c&&E(c)&&function w(e){const c=e.dataSource;return void 0===c.options.queryLayerFeatures||!0===c.options.queryLayerFeatures}(c)}r.d(ae,{aA:()=>p,wd:()=>E})},8636:(Pe,ae,r)=>{"use strict";r.d(ae,{A:()=>G});var E=r(65056),a=r(34896),w=r(34672),p=r(75180),e=r(50244),c=r(32328),o=r(42536),R=r(27e3),_=(r(87040),r(45872)),C=r(20460),S=r(54844),P=r(43451),y=r(25376),F=r(11484),h=r(1560),W=r(50620),J=r(29220),T=r(29216),Q=r(83456),z=r(72584);const Y=["input"];function N(X,D){if(1&X&&(a.I0R(0,"mat-label"),a.OEk(1),a.C$Y()),2&X){const I=a.GaO();a.yG2(),a.cNF(I.label)}}function K(X,D){if(1&X){const I=a.KQA();a.I0R(0,"button",11),a.qCj("click",function(){a.usT(I);const s=a.GaO();return a.CGJ(s.onClearButtonClick())}),a.wVc(1,"translate"),a.I0R(2,"mat-icon"),a.OEk(3,"close"),a.C$Y()()}if(2&X){const I=a.GaO();a.E7m("color",I.color)("matTooltip",a.kDX(1,2,"igo.geo.search.clearSearch"))}}function j(X,D){1&X&&a.wR5(0,"mat-divider",12),2&X&&a.E7m("vertical",!0)}function A(X,D){if(1&X){const I=a.KQA();a.I0R(0,"button",13),a.qCj("click",function(){a.usT(I);const s=a.GaO();return a.CGJ(s.handleSearch())}),a.I0R(1,"mat-icon"),a.OEk(2,"search"),a.C$Y()()}if(2&X){const I=a.GaO();a.E7m("color",I.color)}}function d(X,D){if(1&X){const I=a.KQA();a.I0R(0,"igo-search-selector",14),a.qCj("searchTypeChange",function(s){a.usT(I);const H=a.GaO();return a.CGJ(H.onSearchTypeChange(s))}),a.wVc(1,"async"),a.C$Y()}if(2&X){const I=a.GaO();a.E7m("searchTypes",I.searchTypes)("searchType",a.kDX(1,2,I.searchType$))}}function u(X,D){if(1&X){const I=a.KQA();a.I0R(0,"igo-search-settings",15),a.qCj("pointerSummaryStatus",function(s){a.usT(I);const H=a.GaO();return a.CGJ(H.pointerSummaryStatus.emit(s))})("searchResultsGeometryStatus",function(s){a.usT(I);const H=a.GaO();return a.CGJ(H.searchResultsGeometryStatus.emit(s))})("reverseSearchCoordsFormatStatus",function(s){a.usT(I);const H=a.GaO();return a.CGJ(H.reverseSearchCoordsFormatStatus.emit(s))})("searchSourceChange",function(){a.usT(I);const s=a.GaO();return a.CGJ(s.onSearchSettingsChange())}),a.C$Y()}if(2&X){const I=a.GaO();a.E7m("pointerSummaryEnabled",I.pointerSummaryEnabled)("searchResultsGeometryEnabled",I.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",I.reverseSearchCoordsFormatEnabled)}}const x=X=>({empty:X}),U=X=>({hasSearchIcon:X});let G=(()=>{class X{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new S.g("igo.geo.search.placeholder");empty$=new S.g(!0);term$$;stream$=new S.g("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=J.a;withDivider;set searchType(I){this.setSearchType(I)}get searchType(){return this.searchType$.value}searchType$=new S.g(void 0);pointerSummaryStatus=new a._w7;searchResultsGeometryStatus=new a._w7;reverseSearchCoordsFormatStatus=new a._w7;set term(I){this.setTerm(I)}get term(){return this.term$.value}term$=new S.g("");set disabled(I){this.disabled$.next(I)}get disabled(){return this.disabled$.value}disabled$=new S.g(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(I){this._reverseSearchCoordsFormatEnabled=I,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new a._w7;search=new a._w7;searchTypeChange=new a._w7;clearFeature=new a._w7;searchSettingsChange=new a._w7;input;get empty(){return 0===this.term.length}constructor(I,M,s){this.configService=I,this.searchService=M,this.searchSourceService=s}ngOnInit(){this.term$$=this.term$.subscribe(M=>{this.empty$.next(void 0===M||0===M.length)}),this.stream$$=this.stream$.pipe((0,y.C)(()=>(0,P.k)(this.debounce))).subscribe(M=>this.onSetTerm(M)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,F.a)()).subscribe(M=>this.onSetSearchType(M));const I=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==I&&I}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(I){this.keyIsValid(I.key)&&this.setTerm(I.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(I){this.setSearchType(I)}setSearchType(I){this.searchType$.next(I)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(I,M){if(this.disabled)return;(I=I||"")!==this.term&&!M&&this.term$.next(I);const s=I.replace(/(#[^\s]*)/g,"").trim();(s.length>=this.minLength||0===s.length)&&this.stream$.next(I)}handleSearch(){this.doSearch(this.term)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(I){return-1===X.invalidKeys.indexOf(I)}onSetTerm(I){this.searchTermChange.emit(I),this.doSearch(I)}handlePlaceholder(){const I=[...new Set(this.searchSourceService.getEnabledSources().filter(s=>!["map","coordinatesreverse"].includes(s.getId())).map(s=>s.getType()))];let M="igo.geo.search.placeholder";1===I.length?M=`igo.geo.search.${I[0].toLowerCase()}.placeholder`:0===I.length&&(M="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(M)}onSetSearchType(I){if(null==I)return;this.searchTypeChange.emit(I);const M=`igo.geo.search.${I.toLowerCase()}.placeholder`;this.placeholder$.next(M),this.setTerm(this.term)}doSearch(I){let M;this.researches$$&&(this.researches$$.map(H=>H.unsubscribe()),this.researches$$=void 0),this.termSplitter&&I.match(new RegExp(this.termSplitter,"g"))?(M=I.split(this.termSplitter).filter(H=>H.length>=this.minLength),this.store&&this.store.clear()):M=[I];let s=[];M.map(H=>{""!==(H?H.replace(/(#[^\s]*)/g,"").trim():"")?s=s.concat(this.searchService.search(H,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=s.map(H=>H.request.subscribe(Z=>{this.onResearchCompleted(H,Z)}))}onResearchCompleted(I,M){if(this.search.emit({research:I,results:M}),void 0!==this.store){const s=this.store.all().filter(H=>H.source!==I.source).concat(M);this.store.updateMany(s)}}static \u0275fac=function(M){return new(M||X)(a.GI1(_.aW),a.GI1(T._),a.GI1(Q.i))};static \u0275cmp=a.In1({type:X,selectors:[["igo-search-bar"]],viewQuery:function(M,s){if(1&M&&a.CC$(Y,7),2&M){let H;a.wto(H=a.Gqi())&&(s.input=H.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},standalone:!0,features:[a.UHJ],decls:17,vars:29,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup"],["input",""],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color","click",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click"],[3,"vertical"],["mat-icon-button","",3,"color","click"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange"]],template:function(M,s){1&M&&(a.I0R(0,"div",0),a.wVc(1,"async"),a.I0R(2,"mat-form-field",1),a.yuY(3,N,2,1,"mat-label",2),a.I0R(4,"input",3,4),a.qCj("keyup",function(Z){return s.onKeyup(Z)}),a.wVc(6,"async"),a.wVc(7,"async"),a.wVc(8,"translate"),a.wVc(9,"async"),a.C$Y(),a.yuY(10,K,4,4,"button",5),a.wVc(11,"async"),a.C$Y(),a.yuY(12,j,1,1,"mat-divider",6),a.I0R(13,"div",7),a.yuY(14,A,3,1,"button",8)(15,d,2,4,"igo-search-selector",9)(16,u,1,3,"igo-search-settings",10),a.C$Y()()),2&M&&(a.E7m("ngClass",a.S45(25,x,a.kDX(1,13,s.empty$))),a.yG2(2),a.E7m("floatLabel",s.floatLabel)("appearance",s.appearance),a.yG2(),a.E7m("ngIf",s.label),a.yG2(),a.E7m("ngClass",a.S45(27,U,s.showSearchButton))("disabled",a.kDX(6,15,s.disabled$))("placeholder",s.placeholder?s.placeholder:a.kDX(7,17,s.placeholder$)?a.kDX(8,19,s.placeholder$.value):void 0)("value",a.kDX(9,21,s.term$)),a.yG2(6),a.E7m("ngIf",!1===a.kDX(11,23,s.empty$)),a.yG2(2),a.E7m("ngIf",s.withDivider),a.yG2(2),a.E7m("ngIf",s.showSearchButton),a.yG2(),a.E7m("ngIf",s.searchSelector),a.yG2(),a.E7m("ngIf",s.searchSettings))},dependencies:[E.QF,e.wb,e.Up,e.w5,e.Gm,E.u_,o.cN,o.yi,w.oJ,w.um,R.KO,R.a4,c.oB,c.qL,p.U,p.k,h.s,W.Q,E.a,C._s,z.sD],styles:['[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}@media (max-width: 599px){[_nghost-%COMP%]     .mat-mdc-form-field-infix{width:158px}}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}mat-form-field[_ngcontent-%COMP%]{flex:1}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0})}return X})()},8408:(Pe,ae,r)=>{"use strict";r.d(ae,{q:()=>de});var E=r(65056),a=r(50032),w=r(34672),p=r(32328),e=r(27e3),c=r(3735),R=(r(87040),r(90568)),L=r(20460),_=r(56264),C=r(87544),S=r(88872),P=r(45212),y=r(54776),F=r(54844),h=r(37496),W=r(61200),J=r(76200),T=r(8492),Q=r(7036),z=r(2892),N=(r(89500),r(49312)),K=r(71904),j=r(69400),A=r(46176),d=r(40600),u=r(50244),x=r(42536),U=r(63916),G=r(28180),X=r(31792),D=r(40604),I=r(66908),M=r(34896),s=r(72584);function H(le,ue){if(1&le&&(M.I0R(0,"mat-option",14)(1,"p",15),M.OEk(2),M.C$Y()()),2&le){const ne=ue.$implicit;M.E7m("value",ne),M.yG2(2),M.cNF(ne.title)}}let Z=(()=>{class le{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(ne,ve,ye,Le){this.formBuilder=ne,this.languageService=ve,this.dialogRef=ye,this.data=Le,this.form=this.formBuilder.group({layerName:["",[K.AQ.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,X.W)(""),(0,D.k)(ne=>this.filter(ne)))}filter(ne){if("string"==typeof ne)return this.layers.map(ve=>ve).filter(ve=>ve?.title?.toLowerCase().includes(ne.toLowerCase()))}displayFn(ne){return ne&&ne.title?ne.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}static \u0275fac=function(ve){return new(ve||le)(M.GI1(K.KE),M.GI1(L.ov),M.GI1(d.yI),M.GI1(d.sR,8))};static \u0275cmp=M.In1({type:le,selectors:[["igo-save-feature-dialog"]],standalone:!0,features:[M.UHJ],decls:23,vars:22,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent",3,"result","showIcons"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(ve,ye){if(1&ve&&(M.I0R(0,"h1",0),M.OEk(1),M.wVc(2,"translate"),M.C$Y(),M.I0R(3,"div",1)(4,"form",2)(5,"igo-list",3),M.wR5(6,"igo-search-results-item",4),M.C$Y(),M.I0R(7,"div",5)(8,"mat-form-field"),M.wR5(9,"input",6),M.wVc(10,"translate"),M.I0R(11,"mat-autocomplete",7,8),M.yuY(13,H,3,2,"mat-option",9),M.wVc(14,"async"),M.C$Y()()()()(),M.I0R(15,"div",10)(16,"div",11)(17,"button",12),M.qCj("click",function(){return ye.cancel()}),M.OEk(18),M.wVc(19,"translate"),M.C$Y(),M.I0R(20,"button",13),M.qCj("click",function(){return ye.save()}),M.OEk(21),M.wVc(22,"translate"),M.C$Y()()()),2&ve){const Le=M.Gew(12);M.yG2(),M.oRS(" ",M.kDX(2,12,"igo.geo.layer.saveFeatureInLayer"),"\n"),M.yG2(3),M.E7m("formGroup",ye.form),M.yG2(),M.E7m("navigation",!1)("selection",!1),M.yG2(),M.E7m("result",ye.feature)("showIcons",!0),M.yG2(3),M._6D("placeholder",M.kDX(10,14,"igo.geo.layer.chooseOrSet")),M.E7m("matAutocomplete",Le),M.yG2(2),M.E7m("displayWith",ye.displayFn),M.yG2(2),M.E7m("ngForOf",M.kDX(14,16,ye.filteredLayers$)),M.yG2(5),M.oRS(" ",M.kDX(19,18,"igo.geo.layer.cancelBtn")," "),M.yG2(3),M.oRS(" ",M.kDX(22,20,"igo.geo.layer.saveBtn")," ")}},dependencies:[d.WQ,d.iU,K.y,K.sz,K.ot,K.ue,K.u,K.sl,K.uW,K.Wo,G.yM,I.g,G.qU,u.wb,u.Up,x.cN,x.yi,j.U1,j.e,A.I5,j.cG,E.Iw,A.Ax,U.iI,U.UV,d.Yp,w.oJ,w.Gw,E.a,L._s,s.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]})}return le})();function me(le,ue){if(1&le){const ne=M.KQA();M.I0R(0,"button",2),M.qCj("mouseenter",function(ye){M.usT(ne);const Le=M.GaO();return M.CGJ(Le.onMouseEvent(ye))})("mouseleave",function(ye){M.usT(ne);const Le=M.GaO();return M.CGJ(Le.onMouseEvent(ye))})("click",function(ye){M.usT(ne);const Le=M.GaO();return M.CGJ(Le.onToggleClick(ye))}),M.wVc(1,"translate"),M.wVc(2,"async"),M.I0R(3,"mat-icon",3),M.wVc(4,"async"),M.wVc(5,"async"),M.wVc(6,"async"),M.wVc(7,"async"),M.wVc(8,"async"),M.wVc(9,"async"),M.OEk(10),M.wVc(11,"async"),M.C$Y()()}if(2&le){const ne=M.GaO();M.E7m("matTooltip",M.kDX(1,7,ne.computeTooltip()))("color",M.kDX(2,9,ne.isPreview$)?"":ne.added?"warn":""),M.yG2(3),M.E7m("igoMatBadgeIcon",ne.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",M.kDX(4,11,ne.inRange$)&&!0===M.kDX(5,13,ne.isVisible$)||M.kDX(6,15,ne.inRange$)&&!ne.added||M.kDX(7,17,ne.inRange$)&&M.kDX(8,19,ne.isPreview$))("matBadgeDisabled",!1===M.kDX(9,21,ne.inRange$)),M.yG2(7),M.oRS("",M.kDX(11,23,ne.isPreview$)?"add":ne.added?"delete":"add"," ")}}function _e(le,ue){if(1&le){const ne=M.KQA();M.I0R(0,"button",4),M.qCj("click",function(){M.usT(ne);const ye=M.GaO();return M.CGJ(ye.addFeatureToLayer())}),M.wVc(1,"translate"),M.wVc(2,"async"),M.I0R(3,"mat-icon",5),M.wVc(4,"async"),M.OEk(5,"add_to_photos "),M.C$Y()()}if(2&le){const ne=M.GaO();M.E7m("id",ne.isMobile?"":"hide-save-search-result-btn")("matTooltip",M.kDX(1,5,M.kDX(2,7,ne.addFeatureToLayerTooltip$))),M.yG2(3),M.E7m("igoMatBadgeInverseColor",!0)("matBadgeHidden",M.kDX(4,9,ne.inRange$))("matBadgeDisabled",!0)}}let de=(()=>{class le{layerService;dialog;dataSourceService;mediaService;tooltip$=new F.g("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new F.g("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new F.g(!0);isVisible$=new F.g(!1);isPreview$=new F.g(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(ne){this._color=ne}_color="primary";stores=[];get allLayers(){return this.map.layers.filter(ne=>String(ne.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(ne,ve,ye,Le){this.layerService=ne,this.dialog=ve,this.dataSourceService=ye,this.mediaService=Le}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(ne=>{ne===_.oZ.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(ne=>ne.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(ne=>{this.isInResolutionsRange(ne),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(ne){this.onToggleClick(ne)}onToggleClick(ne){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const ve=ne||{};if("mouseenter"!==ve.type||!this.mouseInsideAdd)switch(ve.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(ve)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(ve),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(ne){this.added||(this.added=!0,this.addLayerToMap(ne))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(ne=>ne.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(ne){if(void 0===this.map||this.layer.meta.dataType!==T.i)return;const ve=this.layer.data;void 0===ve.sourceOptions.optionsFromApi&&(ve.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(ve).subscribe(ye=>{"click"===ne.type&&this.map.layersAddedByClick$.next([ye]),this.map.addLayer(ye)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==T.i)return;const ne=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(ne)}isInResolutionsRange(ne){this.inRange$.next(ne>=(this.layer.data.minResolution||0)&&ne<=(this.layer.data.maxResolution||1/0))}isVisible(){if(this.layer?.data?.sourceOptions?.id){const ne=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!ne&&ne.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(Z,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(ye=>{if(ye)if(this.stores.length>0&&this.stores.map(Le=>(Le.state.updateAll({selected:!1}),Le?.layer&&(Le.layer.visible=!1),Le)),"string"==typeof ye.layer)this.createLayer(ye.layer,ye.feature);else{const Le=this.stores.find(He=>He.layer.id===ye.layer.id);Le.layer.visible=!0,Le.layer.opacity=1,this.addFeature(ye.feature,Le)}})}createLayer(ne,ve){const ye=new J.ym([],{map:this.map}),Le=[new y.cp({image:new C.c({radius:5,stroke:new P.c({width:1,color:"rgba(143,7,7,1)"}),fill:new S.c({color:"rgba(143,7,7,1)"})})}),new y.cp({stroke:new P.c({width:1,color:"rgba(143,7,7,1)"}),fill:new S.c({color:"rgba(0, 0, 255, 0.1)"})})];let He=0;for(const Ve of this.allLayers){let Ge=Number(Ve.id.replace("igo-search-layer",""));He=Math.max(Ge,He)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,h.U)(1)).subscribe(Ve=>{let Ge=new z.M({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++He,title:ne,source:Ve,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:Le,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});(0,J.mM)(ye,Ge),(0,J.sf)(ye,new J.E9({motion:J.Su.None})),(0,J.Uz)(ye,new J.kj({map:this.map,motion:J.Su.None,many:!0})),ye.layer.visible=!0,ye.source.ol.on("removefeature",ct=>{const Ie=ct.feature.getGeometry();this.clearLabelsOfOlGeometry(Ie)}),this.addFeature(ve,ye),this.stores.push(ye)})}addFeature(ne,ve){const ye={type:ne.data.type,geometry:{coordinates:ne.data.geometry.coordinates,type:ne.data.geometry.type},projection:ne.data.projection,properties:ne.data.properties,meta:{id:ne.meta.id}};delete ye.properties.Route,ve.update(ye),ve.setLayerExtent(),ve.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(ne){(0,N.aK)(ne).forEach(ve=>{ve&&ve.getMap()&&this.map.ol.removeOverlay(ve)})}static \u0275fac=function(ve){return new(ve||le)(M.GI1(Q.I),M.GI1(d.qW),M.GI1(W.O),M.GI1(_.QB))};static \u0275cmp=M.In1({type:le,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},standalone:!0,features:[M.UHJ],decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility_off","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"]],template:function(ve,ye){1&ve&&M.yuY(0,me,12,25,"button",0)(1,_e,6,11,"button",1),2&ve&&(M.E7m("ngIf","Layer"===ye.layer.meta.dataType),M.yG2(),M.E7m("ngIf","Feature"===ye.layer.meta.dataType&&ye.saveSearchResultInLayer))},dependencies:[E.u_,w.oJ,w.um,R.mw,e.KO,e.a4,p.oB,p.qL,a.g,a.S,c.q,E.a,L._s,s.sD],styles:["[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return le})()},66908:(Pe,ae,r)=>{"use strict";r.d(ae,{g:()=>T});var E=r(65056),a=r(34896),w=r(34672),p=r(32328),e=r(63916),c=r(27e3),o=r(87040),R=r(90568),L=r(12396),_=r(76200);function S(Q,z){if(1&Q&&(a.I0R(0,"mat-icon",6),a.OEk(1),a.C$Y()),2&Q){const Y=a.GaO();a.yG2(),a.cNF(Y.showIcons?Y.icon:"blank")}}function P(Q,z){if(1&Q&&a.wR5(0,"div",7),2&Q){const Y=a.GaO();a.E7m("innerHtml",Y.titleHtml,a.E3n)("matTooltip",Y.tooltipHtml)}}function y(Q,z){if(1&Q&&(a.I0R(0,"span",9),a.OEk(1),a.C$Y()),2&Q){const Y=a.GaO(2);a.E7m("matTooltip",Y.title),a.yG2(),a.cNF(Y.title)}}function F(Q,z){if(1&Q&&a.yuY(0,y,2,2,"span",8),2&Q){const Y=a.GaO();a.E7m("ngIf",!Y.titleHtml)}}function h(Q,z){if(1&Q){const Y=a.KQA();a.I0R(0,"button",10),a.qCj("click",function(){a.usT(Y);const K=a.GaO();return a.CGJ(K.onZoomHandler())}),a.I0R(1,"mat-icon"),a.OEk(2,"search"),a.C$Y()()}}r(89500);const W=[[["","igoSearchItemToolbar",""]]],J=["[igoSearchItemToolbar]"];let T=(()=>{class Q{result;map;showIcons;withZoomButton=!1;zoomEvent=new a._w7;format=new L.c;get title(){return(0,o.YB)(this.result)}get titleHtml(){return(0,o.E$)(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return(0,o.sH)(this.result)}onZoomHandler(){const Y=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});(0,_.QX)(this.map.viewController,[Y],_.Su.Default)}onMouseEvent(Y){const N=Y.target;switch(Y.type){case"mouseenter":const j=N.querySelector("#hide-save-search-result-btn");j&&j.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const A=N.querySelector("#show-save-search-result-btn");A&&A.setAttribute("id","hide-save-search-result-btn")}}static \u0275fac=function(N){return new(N||Q)};static \u0275cmp=a.In1({type:Q,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},standalone:!0,features:[a.UHJ],ngContentSelectors:J,decls:8,vars:4,consts:[[3,"mouseenter","mouseleave"],["matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["normalTitle",""],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon",""],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"]],template:function(N,K){if(1&N&&(a.kPM(W),a.I0R(0,"mat-list-item",0),a.qCj("mouseenter",function(A){return K.onMouseEvent(A)})("mouseleave",function(A){return K.onMouseEvent(A)}),a.yuY(1,S,2,1,"mat-icon",1)(2,P,1,2,"div",2)(3,F,1,1,"ng-template",null,3,a.gJz),a.I0R(5,"div",4),a.yuY(6,h,3,0,"button",5),a._Xx(7),a.C$Y()()),2&N){const j=a.Gew(4);a.yG2(),a.E7m("ngIf",K.icon),a.yG2(),a.E7m("ngIf",K.titleHtml)("ngIfElse",j),a.yG2(4),a.E7m("ngIf",K.withZoomButton)}},dependencies:[e.iI,e.g9,e.Y1,e.UV,e.At,E.u_,p.oB,p.qL,c.KO,c.a4,w.oJ,w.um,R.mw],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}"],changeDetection:0})}return Q})()},69800:(Pe,ae,r)=>{"use strict";r.d(ae,{T:()=>ue});var E=r(65056),a=r(34896),w=r(18268),p=r(92096),e=r(87040),c=r(28180),o=r(45872),R=r(20460),L=r(54844),_=r(54584),C=r(43451),S=r(25376),P=r(40604),F=(r(89500),r(29216)),h=r(66908),W=r(72584);const J=["igoSearchItemToolbar"];function T(ne,ve){1&ne&&a.C_f(0)}const Q=ne=>({results:ne});function z(ne,ve){if(1&ne){const ye=a.KQA();a.I0R(0,"igo-collapsible",7),a.qCj("toggle",function(He){a.usT(ye);const Ve=a.GaO().$implicit,Ge=a.GaO(2);return a.CGJ(Ge.collapsed[Ve.source.title]=He)}),a.yuY(1,T,1,0,"ng-container",8),a.C$Y()}if(2&ne){const ye=a.GaO().$implicit,Le=a.Gew(4),He=a.GaO(2);a.m8U(ye.source.getId()),a.E7m("title",He.computeGroupTitle(ye))("collapsed",He.collapsed[ye.source.title]),a.yG2(),a.E7m("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.S45(6,Q,ye.results))}}function Y(ne,ve){1&ne&&a.C_f(0)}function N(ne,ve){if(1&ne&&a.yuY(0,Y,1,0,"ng-container",8),2&ne){const ye=a.GaO().$implicit,Le=a.Gew(4);a.E7m("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.S45(2,Q,ye.results))}}const K=ne=>({result:ne});function j(ne,ve){if(1&ne){const ye=a.KQA();a.I0R(0,"igo-search-results-item",10),a.qCj("focus",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(4);return a.CGJ(Ge.resultFocus.emit(Ve))})("unfocus",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(4);return a.CGJ(Ge.resultUnfocus.emit(Ve))})("select",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(4);return a.CGJ(Ge.onResultSelect(Ve))})("mouseenter",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(4);return a.CGJ(Ge.resultFocus.emit(Ve))})("mouseleave",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(4);return a.CGJ(Ge.resultUnfocus.emit(Ve))}),a.C_f(1,11),a.C$Y()}if(2&ne){const ye=ve.$implicit,Le=a.GaO(4);a.E7m("map",Le.map)("result",ye)("showIcons",Le.showIcons)("withZoomButton",Le.withZoomButton)("focused",Le.store.state.get(ye).focused)("selected",Le.store.state.get(ye).selected),a.yG2(),a.E7m("ngTemplateOutlet",Le.templateSearchToolbar)("ngTemplateOutletContext",a.S45(8,K,ye))}}function A(ne,ve){if(1&ne){const ye=a.KQA();a.I0R(0,"span",12),a.qCj("click",function(){a.usT(ye);const He=a.GaO(2).$implicit,Ve=a.GaO(2);return a.CGJ(Ve.displayMoreResults(He))}),a.I0R(1,"u"),a.OEk(2),a.wVc(3,"translate"),a.C$Y()()}2&ne&&(a.yG2(2),a.cNF(a.kDX(3,1,"igo.geo.search.displayMoreResults")))}function d(ne,ve){if(1&ne&&a.yuY(0,j,2,10,"ng-template",2)(1,A,4,3,"span",9),2&ne){const ye=ve.results,Le=a.GaO().$implicit,He=a.GaO(2);a.E7m("ngForOf",ye),a.yG2(),a.E7m("ngIf",He.isMoreResults(Le))}}function u(ne,ve){if(1&ne&&a.yuY(0,z,2,8,"igo-collapsible",4)(1,N,1,4,"ng-template",null,5,a.gJz)(3,d,2,2,"ng-template",null,6,a.gJz),2&ne){const ye=a.Gew(2),Le=a.GaO(2);a.E7m("ngIf",Le.mode===Le.searchResultMode.Grouped)("ngIfElse",ye)}}function x(ne,ve){if(1&ne&&(a.I0R(0,"igo-list",1),a.yuY(1,u,5,2,"ng-template",2,3,a.gJz),a.wVc(3,"async"),a.C$Y()),2&ne){const ye=a.GaO();a.E7m("navigation",!0),a.yG2(),a.E7m("ngForOf",a.kDX(3,2,ye.results$))}}function U(ne,ve){1&ne&&a.C_f(0)}function G(ne,ve){1&ne&&a.C_f(0)}const X=ne=>({group:ne});function D(ne,ve){if(1&ne&&(a.I0R(0,"mat-tab",17),a.yuY(1,G,1,0,"ng-container",8),a.C$Y()),2&ne){const ye=ve.$implicit;a.GaO(2);const Le=a.Gew(7),He=a.GaO();a.E7m("label",He.computeGroupTitle(ye)),a.yG2(),a.E7m("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.S45(3,X,ye))}}function I(ne,ve){if(1&ne&&(a.I0R(0,"mat-tab-group",15),a.yuY(1,D,2,5,"mat-tab",16),a.wVc(2,"async"),a.C$Y()),2&ne){const ye=a.GaO(2);a.yG2(),a.E7m("ngForOf",a.kDX(2,1,ye.results$))}}function M(ne,ve){1&ne&&a.C_f(0)}function s(ne,ve){if(1&ne&&a.yuY(0,M,1,0,"ng-container",8),2&ne){const ye=ve.$implicit;a.GaO(2);const Le=a.Gew(7);a.E7m("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.S45(2,X,ye))}}function H(ne,ve){if(1&ne&&(a.yuY(0,s,1,4,"ng-template",2),a.wVc(1,"async")),2&ne){const ye=a.GaO(2);a.E7m("ngForOf",a.kDX(1,1,ye.results$))}}function Z(ne,ve){if(1&ne){const ye=a.KQA();a.I0R(0,"igo-search-results-item",10),a.qCj("focus",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(3);return a.CGJ(Ge.resultFocus.emit(Ve))})("unfocus",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(3);return a.CGJ(Ge.resultUnfocus.emit(Ve))})("select",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(3);return a.CGJ(Ge.onResultSelect(Ve))})("mouseenter",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(3);return a.CGJ(Ge.resultFocus.emit(Ve))})("mouseleave",function(){const Ve=a.usT(ye).$implicit,Ge=a.GaO(3);return a.CGJ(Ge.resultUnfocus.emit(Ve))}),a.C_f(1,11),a.C$Y()}if(2&ne){const ye=ve.$implicit,Le=a.GaO(3);a.E7m("map",Le.map)("result",ye)("showIcons",Le.showIcons)("withZoomButton",Le.withZoomButton)("focused",Le.store.state.get(ye).focused)("selected",Le.store.state.get(ye).selected),a.yG2(),a.E7m("ngTemplateOutlet",Le.templateSearchToolbar)("ngTemplateOutletContext",a.S45(8,K,ye))}}function me(ne,ve){if(1&ne){const ye=a.KQA();a.I0R(0,"span",12),a.qCj("click",function(){a.usT(ye);const He=a.GaO().group,Ve=a.GaO(2);return a.CGJ(Ve.displayMoreResults(He))}),a.I0R(1,"u"),a.OEk(2),a.wVc(3,"translate"),a.C$Y()()}2&ne&&(a.yG2(2),a.cNF(a.kDX(3,1,"igo.geo.search.displayMoreResults")))}function _e(ne,ve){if(1&ne&&a.yuY(0,Z,2,10,"ng-template",2)(1,me,4,3,"span",9),2&ne){const ye=ve.group,Le=a.GaO(2);a.E7m("ngForOf",ye.results),a.yG2(),a.E7m("ngIf",Le.isMoreResults(ye))}}function de(ne,ve){if(1&ne&&(a.I0R(0,"igo-list",1),a.yuY(1,U,1,0,"ng-container",13)(2,I,3,3,"ng-template",null,14,a.gJz)(4,H,2,3,"ng-template",null,5,a.gJz)(6,_e,2,2,"ng-template",null,6,a.gJz),a.C$Y()),2&ne){const ye=a.Gew(3),Le=a.Gew(5),He=a.GaO();a.E7m("navigation",!0),a.yG2(),a.E7m("ngIf",He.mode===He.searchResultMode.Grouped)("ngIfThen",ye)("ngIfElse",Le)}}var le=function(ne){return ne.Grouped="grouped",ne.Flat="flat",ne}(le||{});let ue=(()=>{class ne{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=le;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=le.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(ye){this._term=ye,this.pageIterator=[]}_term;settingsChange$=new L.g(void 0);termSplitter="|";resultFocus=new a._w7;resultUnfocus=new a._w7;resultSelect=new a._w7;moreResults=new a._w7;resultMouseenter=new a._w7;resultMouseleave=new a._w7;templateSearchToolbar;get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}_results$;constructor(ye,Le,He){this.cdRef=ye,this.searchService=Le,this.configService=He}ngOnInit(){this.watcher=new e.YX(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(ye){const Le=[ye.source.title],He=ye.results.length;return He>1&&this.showResultsCount&&Le.push(`(${He})`),Le.join(" ")}onResultSelect(ye){this.store.state.get(ye)&&!0===this.store.state.get(ye).selected||(this.store.state.update(ye,{focused:!0,selected:!0},!0),this.resultSelect.emit(ye))}liftResults(){return this.store.stateView.all$().pipe((0,S.C)(ye=>0===ye.length?_.k:(0,C.k)(200)),(0,P.k)(ye=>this.groupResults(ye.map(Le=>Le.entity).sort(this.sortByOrder))))}sortByOrder(ye,Le){return ye.source.displayOrder-Le.source.displayOrder}groupResults(ye){const Le=new Map;return ye.forEach(He=>{const Ve=He.source;let Ge=Le.get(Ve);void 0===Ge&&(Ge=[],Le.set(Ve,Ge)),Ge.push(He)}),Array.from(Le.keys()).map(He=>(void 0===this.pageIterator[He.getId()]&&(this.pageIterator[He.getId()]=1),{source:He,results:Le.get(He)}))}isMoreResults(ye){return this.store.getStrategyOfType(e.qq)?.active?ye.results?.length%+ye.source.params.limit==0&&+ye.source.params.page<30:ye.results&&!0===ye.results[ye.results.length-1].meta.nextPage}displayMoreResults(ye){const Le={sourceId:ye.source.getId(),page:++this.pageIterator[ye.source.getId()]};let He;He=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let Ve=[];He.map(Ge=>{Ve=Ve.concat(this.searchService.search(Ge,Le))}),Ve.map(Ge=>{Ge.request.subscribe(ct=>{const Ie=ye.results.concat(ct);ct.length||(Ie[Ie.length-1].meta.nextPage=!1),this.moreResults.emit({research:Ge,results:Ie})})})}static \u0275fac=function(Le){return new(Le||ne)(a.GI1(a.kD9),a.GI1(F._),a.GI1(o.aW))};static \u0275cmp=a.In1({type:ne,selectors:[["igo-search-results"]],contentQueries:function(Le,He,Ve){if(1&Le&&a.szK(Ve,J,5),2&Le){let Ge;a.wto(Ge=a.Gqi())&&(He.templateSearchToolbar=Ge.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},standalone:!0,features:[a.UHJ],decls:2,vars:2,consts:[[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["tabsTemplate",""],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(Le,He){1&Le&&a.yuY(0,x,4,4,"igo-list",0)(1,de,8,4,"igo-list",0),2&Le&&(a.E7m("ngIf",!1===He.tabsMode),a.yG2(),a.E7m("ngIf",He.tabsMode))},dependencies:[E.u_,c.yM,E.Iw,p.ii,E.XV,h.g,c.qU,w.WG,w.aJ,w._q,E.a,R._s,W.sD],styles:["[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}"],changeDetection:0})}return ne})()},1560:(Pe,ae,r)=>{"use strict";r.d(ae,{s:()=>F});var E=r(65056),a=r(34896),w=r(34672),p=r(32328),e=r(87848),c=r(21232),o=r(27e3),R=r(20460),L=r(54844),_=r(11484),C=r(29220),S=r(83456),P=r(72584);function y(h,W){if(1&h&&(a.I0R(0,"mat-radio-button",6),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&h){const J=W.$implicit,T=a.GaO();a.E7m("value",J),a.yG2(),a.oRS(" ",a.kDX(2,2,T.getSearchTypeTitle(J))," ")}}let F=(()=>{class h{searchSourceService;searchType$=new L.g(void 0);searchType$$;searchTypes=C.a;set searchType(J){this.setSearchType(J)}get searchType(){return this.searchType$.value}searchTypeChange=new a._w7;constructor(J){this.searchSourceService=J}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,_.a)()).subscribe(J=>this.onSetSearchType(J))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(J){this.setSearchType(J)}getSearchTypeTitle(J){return`igo.geo.search.${J.toLowerCase()}.title`}setSearchType(J){this.searchType$.next(J)}onSetSearchType(J){null!=J&&(this.searchSourceService.enableSourcesByType(J),this.searchTypeChange.emit(J))}static \u0275fac=function(T){return new(T||h)(a.GI1(S.i))};static \u0275cmp=a.In1({type:h,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},standalone:!0,features:[a.UHJ],decls:10,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(T,Q){if(1&T&&(a.I0R(0,"div",0)(1,"button",1),a.wVc(2,"translate"),a.I0R(3,"mat-icon"),a.OEk(4,"arrow_drop_down"),a.C$Y()(),a.I0R(5,"mat-menu",2,3)(7,"mat-radio-group",4),a.qCj("change",function(Y){return Q.onSearchTypeChange(Y.value)}),a.wVc(8,"async"),a.yuY(9,y,3,4,"mat-radio-button",5),a.C$Y()()()),2&T){const z=a.Gew(6);a.yG2(),a.E7m("matTooltip",a.kDX(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",z),a.yG2(6),a.E7m("value",a.kDX(8,6,Q.searchType$)),a.yG2(2),a.E7m("ngForOf",Q.searchTypes)}},dependencies:[w.oJ,w.um,o.KO,o.a4,e._A,e.aM,e.yG,p.oB,p.qL,c.yk,c.cv,c.cT,E.Iw,E.a,R._s,P.sD],styles:["[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0})}return h})()},50620:(Pe,ae,r)=>{"use strict";r.d(ae,{Q:()=>u});var E=r(65056),a=r(34896),w=r(34672),p=r(58539),e=r(75180),c=r(32328),o=r(87848),R=r(21232),L=r(43424),_=r(27e3),C=r(20460),S=r(56264),P=r(62004),y=r(14452),F=r(83456),h=r(72584);function W(x,U){if(1&x){const G=a.KQA();a.I0R(0,"div",10)(1,"button",11),a.qCj("click",function(D){a.usT(G);const I=a.GaO();return a.CGJ(I.checkUncheckAllSources(D))}),a.OEk(2),a.wVc(3,"translate"),a.wVc(4,"translate"),a.C$Y()()}if(2&x){const G=a.GaO();a.yG2(2),a.oRS(" ",G.searchSourcesAllEnabled?a.kDX(4,3,"igo.geo.search.searchSources.selectAll"):a.kDX(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function J(x,U){if(1&x&&(a.I0R(0,"button",17),a.OEk(1),a.C$Y()),2&x){const G=a.GaO().$implicit,X=a.Gew(6);a.E7m("matMenuTriggerFor",X),a.yG2(),a.oRS(" ",G.title," ")}}function T(x,U){if(1&x&&(a.I0R(0,"button",7),a.OEk(1),a.C$Y()),2&x){const G=a.GaO().$implicit;a.yG2(),a.oRS(" ",G.title," ")}}function Q(x,U){if(1&x){const G=a.KQA();a.I0R(0,"mat-radio-button",23),a.qCj("click",function(D){return D.stopPropagation()})("change",function(D){const M=a.usT(G).$implicit,s=a.GaO(2).$implicit,H=a.GaO().$implicit,Z=a.GaO();return a.CGJ(Z.settingsValueCheckedRadioButton(D,H,s,M))}),a.OEk(1),a.wVc(2,"translate"),a.C$Y()}if(2&x){const G=U.$implicit,X=a.GaO(4);a.E7m("value",G)("matTooltip",X.getAvailableHashtagsValues(G))("checked",G.enabled),a.yG2(),a.oRS(" ",a.kDX(2,4,G.title)," ")}}function z(x,U){if(1&x&&(a.I0R(0,"span")(1,"mat-radio-group",21),a.yuY(2,Q,3,6,"mat-radio-button",22),a.C$Y()()),2&x){const G=a.GaO().$implicit;a.yG2(),a.E7m("value",G),a.yG2(),a.E7m("ngForOf",G.values)}}function Y(x,U){if(1&x){const G=a.KQA();a.I0R(0,"div",10)(1,"button",11),a.qCj("click",function(D){a.usT(G);const I=a.GaO(2).$implicit,M=a.GaO().$implicit,s=a.GaO();return a.CGJ(s.checkUncheckAll(D,M,I))}),a.OEk(2),a.wVc(3,"translate"),a.wVc(4,"translate"),a.C$Y()()}if(2&x){const G=a.GaO(2).$implicit;a.yG2(2),a.oRS(" ",G.allEnabled||void 0===G.allEnabled?a.kDX(3,1,"igo.geo.search.searchSources.settings.unselectAll"):a.kDX(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function N(x,U){if(1&x){const G=a.KQA();a.I0R(0,"div",25)(1,"mat-checkbox",26),a.qCj("click",function(D){return D.stopPropagation()})("change",function(D){const M=a.usT(G).$implicit,s=a.GaO(2).$implicit,H=a.GaO().$implicit,Z=a.GaO();return a.CGJ(Z.settingsValueCheckedCheckbox(D,H,s,M))}),a.OEk(2),a.wVc(3,"translate"),a.C$Y()()}if(2&x){const G=U.$implicit,X=a.GaO(2).$implicit,D=a.GaO(2);a.yG2(),a.m4B("display",D.displayBlock),a.E7m("checked",G.enabled)("value",X)("matTooltip",D.getAvailableHashtagsValues(G)),a.yG2(),a.oRS(" ",a.kDX(3,6,G.title)," ")}}function K(x,U){if(1&x&&(a.I0R(0,"span"),a.yuY(1,Y,5,5,"div",4)(2,N,4,8,"div",24),a.C$Y()),2&x){const G=a.GaO().$implicit,X=a.GaO(2);a.yG2(),a.E7m("ngIf",G.values.length>3),a.yG2(),a.E7m("ngForOf",X.getAvailableValues(G))}}function j(x,U){if(1&x&&(a.SAx(0),a.I0R(1,"button",17),a.OEk(2),a.wVc(3,"translate"),a.C$Y(),a.I0R(4,"mat-menu",18,19),a.yuY(6,z,3,2,"span",20)(7,K,3,2,"span",20),a.C$Y(),a.k70()),2&x){const G=U.$implicit,X=a.Gew(5);a.yG2(),a.E7m("matMenuTriggerFor",X),a.yG2(),a.oRS(" ",a.kDX(3,5,"igo.geo.search.searchSources.settings."+G.title)," "),a.yG2(2),a.E7m("ngSwitch",G.type),a.yG2(2),a.E7m("ngSwitchCase","radiobutton"),a.yG2(),a.E7m("ngSwitchCase","checkbox")}}function A(x,U){if(1&x){const G=a.KQA();a.SAx(0),a.I0R(1,"span",12)(2,"mat-checkbox",13),a.qCj("click",function(D){return D.stopPropagation()})("change",function(D){const M=a.usT(G).$implicit,s=a.GaO();return a.CGJ(s.onCheckSearchSource(D,M))}),a.C$Y(),a.yuY(3,J,2,2,"button",14)(4,T,2,1,"button",15),a.C$Y(),a.I0R(5,"mat-menu",null,16),a.yuY(7,j,8,7,"ng-container",5),a.C$Y(),a.k70()}if(2&x){const G=U.$implicit;a.yG2(2),a.E7m("checked",G.enabled)("value",G),a.yG2(),a.E7m("ngIf",G.settings.length>0),a.yG2(),a.E7m("ngIf",0===G.settings.length),a.yG2(3),a.E7m("ngForOf",G.settings)}}function d(x,U){if(1&x){const G=a.KQA();a.I0R(0,"mat-slide-toggle",9),a.qCj("change",function(D){a.usT(G);const I=a.GaO();return a.CGJ(I.changePointerReverseSearch(D))})("click",function(D){return D.stopPropagation()}),a.wVc(1,"translate"),a.OEk(2),a.wVc(3,"translate"),a.C$Y()}if(2&x){const G=a.GaO();a.E7m("matTooltip",a.kDX(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",G.pointerSummaryEnabled),a.yG2(2),a.oRS(" ",a.kDX(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}let u=(()=>{class x{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new a._w7;pointerSummaryStatus=new a._w7;searchResultsGeometryStatus=new a._w7;reverseSearchCoordsFormatStatus=new a._w7;handleKeyboardEvent(G){"F2"===G.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(G,X,D){this.searchSourceService=G,this.mediaService=X,this.storageService=D}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const G=this.searchSourceService.getSources().filter(y.ay).filter(I=>I.available&&"map"!==I.getId()&&I.showInSettings),X=this.searchSourceService.getSources().filter(y.ae).filter(I=>I.available&&"map"!==I.getId()&&I.showInSettings),D=G.concat(X);return this.computeSourcesCheckAllBehavior(D),D}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(y.ig).length}settingsValueCheckedCheckbox(G,X,D,I){I.enabled=G.checked,X.setParamFromSetting(D),this.searchSourceChange.emit(X)}computeSettingCheckAllBehavior(G){G.allEnabled=void 0===G.allEnabled?!G.values.find(X=>X.enabled):!G.allEnabled}computeSourcesCheckAllBehavior(G){const X=G.filter(I=>I.enabled).length,D=G.filter(I=>!I.enabled).length;this.searchSourcesAllEnabled=!(X>=D)}checkUncheckAll(G,X,D){G.stopPropagation(),this.computeSettingCheckAllBehavior(D),D.values.forEach(I=>{I.enabled=D.allEnabled}),X.setParamFromSetting(D),this.searchSourceChange.emit(X)}checkUncheckAllSources(G){G.stopPropagation(),this.getSearchSources().map(X=>{X.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(X)})}settingsValueCheckedRadioButton(G,X,D,I){D.values.forEach(M=>{M.enabled=M.value!==I.value?!G.source.checked:G.source.checked}),X.setParamFromSetting(D),this.searchSourceChange.emit(X)}onCheckSearchSource(G,X){X.enabled=G.checked;const D=this.storageService.get(X.getId()+".options")||{};D.enabled=X.enabled,this.storageService.set(X.getId()+".options",D),this.searchSourceChange.emit(X)}getAvailableValues(G){return G.values.filter(X=>!1!==X.available)}getAvailableHashtagsValues(G){if(G.hashtags)return G.hashtags.map(X=>"#"+X).join(", ")}stopPropagation(G){G.stopPropagation()}changePointerReverseSearch(G){this.pointerSummaryEnabled=G.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(G){this.searchResultsGeometryEnabled=G.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(G){this.reverseSearchCoordsFormatEnabled=G.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(X){return new(X||x)(a.GI1(F.i),a.GI1(S.QB),a.GI1(P.yQ))};static \u0275cmp=a.In1({type:x,selectors:[["igo-search-settings"]],hostBindings:function(X,D){1&X&&a.qCj("keydown",function(M){return D.handleKeyboardEvent(M)},!1,a.wLc)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},standalone:!0,features:[a.UHJ],decls:24,vars:23,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"matTooltip","checked","change","click"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"checked","value","matTooltip","click","change"]],template:function(X,D){if(1&X&&(a.I0R(0,"div",0)(1,"button",1),a.wVc(2,"translate"),a.I0R(3,"mat-icon"),a.OEk(4,"expand_more"),a.C$Y()(),a.I0R(5,"mat-menu",2,3),a.yuY(7,W,5,5,"div",4)(8,A,8,5,"ng-container",5),a.wR5(9,"mat-divider"),a.I0R(10,"span",6)(11,"div",7),a.yuY(12,d,4,7,"mat-slide-toggle",8),a.C$Y(),a.I0R(13,"div",7)(14,"mat-slide-toggle",9),a.qCj("change",function(M){return D.changeSearchResultsGeometry(M)})("click",function(M){return M.stopPropagation()}),a.wVc(15,"translate"),a.OEk(16),a.wVc(17,"translate"),a.C$Y()(),a.I0R(18,"div",7)(19,"mat-slide-toggle",9),a.qCj("change",function(M){return D.reverseSearchCoordsFormat(M)})("click",function(M){return M.stopPropagation()}),a.wVc(20,"translate"),a.wVc(21,"translate"),a.OEk(22),a.wVc(23,"translate"),a.C$Y()()()()()),2&X){const I=a.Gew(6);a.yG2(),a.E7m("matTooltip",a.kDX(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",I),a.yG2(6),a.E7m("ngIf",D.getSearchSources().length>4),a.yG2(),a.E7m("ngForOf",D.getSearchSources()),a.yG2(4),a.E7m("ngIf",D.hasPointerReverseSearchSource&&!D.isTouchScreen),a.yG2(2),a.E7m("matTooltip",a.kDX(15,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",D.searchResultsGeometryEnabled),a.yG2(2),a.oRS(" ",a.kDX(17,15,"igo.geo.search.searchResultsGeometry.title")," "),a.yG2(3),a.E7m("matTooltip",D.reverseSearchCoordsFormatEnabled?a.kDX(20,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):a.kDX(21,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",D.reverseSearchCoordsFormatEnabled),a.yG2(3),a.oRS(" ",a.kDX(23,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[w.oJ,w.Gw,w.um,_.KO,_.a4,o._A,o.aM,o.OQ,o.yG,c.oB,c.qL,E.u_,E.Iw,p.Vn,p.WK,E.Ko,E.Wm,R.yk,R.cv,R.cT,e.U,e.k,L.GE,L.cP,C._s,h.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}"],changeDetection:0})}return x})()},71320:(Pe,ae,r)=>{"use strict";r.d(ae,{k:()=>z});var E=r(87040),a=r(56264),w=r(43168),p=r(58264),e=r(83552),c=r(12396),o=r(80848),R=r(61252),L=r(83680),_=r(90112),C=r(70524),S=r(68392),P=r(40240),y=r(2892),F=r(9364),h=r(59800),W=r(29216),J=r(14452),T=r(34896),Q=r(83456);let z=(()=>{class Y{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new E.qc([]);lastTimeoutRequest;store$$;layers$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(K,j,A,d){this.component=K,this.searchService=j,this.searchSourceService=A,this.mediaService=d}ngOnInit(){this.listenToMapPointerMove(),this.map.status$.pipe((0,L.K)(K=>K===w.qM.Done)).subscribe(()=>{this.store=new P.y([],{map:this.map}),this.initStore(),this.subscribeToPointerStore()}),this.layers$$=this.map.layers$.subscribe(K=>{this.store&&!K.find(j=>"searchPointerSummaryId"===j.id)&&this.initStore()})}initStore(){const K=this.store,j=new y.M({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new _.E,showInLayerList:!1,exportable:!1,browsable:!1,style:h.uq});(0,C.m)(K,j)}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(J.ig).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(K=>{this.entitiesToPointerOverlay(K)})}computeSummaryClosestFeature(K){const j={};return K.map(A=>{A.data.properties.type&&A.data.properties.distance>=0&&(j.hasOwnProperty(A.data.properties.type)?A.data.properties.distance<j[A.data.properties.type].distance&&(j[A.data.properties.type]={distance:A.data.properties.distance,title:A.meta.pointerSummaryTitle||A.meta.title}):j[A.data.properties.type]={distance:A.data.properties.distance,title:A.meta.pointerSummaryTitle||A.meta.title})}),j}entitiesToPointerOverlay(K){const j=this.computeSummaryClosestFeature(K),A=Object.keys(j),d=[],u=[];K.map(x=>{const U=A.indexOf(x.data.properties.type);-1!==U?(u.push(j[x.data.properties.type].title),A.splice(U,1),d.push(x.data.properties.type)):-1===d.indexOf(x.data.properties.type)&&u.push(x.meta.pointerSummaryTitle||x.meta.title)}),u.length&&this.addPointerOverlay(u.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",K=>this.onMapEvent(K))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(K=>K.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,e.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(K){!K.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,R.AF)(K.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(K,j){return K.source.displayOrder-j.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const K=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const j in K)K.length>0&&this.reverseSearch$$.push(K[j].request.subscribe(A=>{this.onSearch({research:K[j],results:A})}))}onSearch(K){const j=K.results,A=this.pointerSearchStore.all().filter(d=>d.source!==K.research.source).concat(j);this.pointerSearchStore.load(A.sort(this.sortByOrder))}addPointerOverlay(K){this.clearLayer();const j=new o.c((0,R.AF)(this.lonLat,"EPSG:4326",this.mapProjection)),A=new p.c({geometry:j}),d=(new c.c).writeGeometryObject(j,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:S.Y,geometry:d,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:K},meta:{id:this.searchPointerSummaryFeatureId},ol:A}],S.S.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(j){return new(j||Y)(T.GI1(F.q,2),T.GI1(W._),T.GI1(Q.i),T.GI1(a.QB))};static \u0275dir=T.Sc5({type:Y,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(j,A){1&j&&T.qCj("mouseleave",function(){return A.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"},standalone:!0})}return Y})()},83456:(Pe,ae,r)=>{"use strict";r.d(ae,{i:()=>E});class E{sources;constructor(w){this.sources=w}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(w=>!0===w.enabled)}enableSourcesByType(w){this.getSources().forEach(p=>{p.enabled=p.constructor.type===w})}setParamFromSetting(w,p){w.setParamFromSetting(p)}setWorkspaces(w,p){w.setWorkspaces(p)}}},29220:(Pe,ae,r)=>{"use strict";r.d(ae,{a:()=>w});var E=r(68392),a=r(8492);const w=[E.Y,a.i]},29216:(Pe,ae,r)=>{"use strict";r.d(ae,{_:()=>R});var E=r(34896),a=r(84808),w=r(62004),p=r(59324),e=r(14452),c=r(83456),o=r(12268);let R=(()=>{class L{searchSourceService;mapService;storageService;analyticsService;searchTerm=(0,E.OCB)(null);constructor(C,S,P,y,F){this.searchSourceService=C,this.mapService=S,this.storageService=P,this.analyticsService=y,F&&this.handleAnalytics()}handleAnalytics(){(0,E.o3l)(()=>{const C=this.searchTerm();null!=C&&this.analyticsService.trackSearch(C,null)})}search(C,S={}){if(!this.termIsValid(C))return[];this.searchTerm.set(C);const P=this.mapService.getMap()?.projection||"EPSG:3857",y=(0,p.Sc)(C,P,{forceNA:S.forceNA});if(y.lonLat)return this.reverseSearch(y.lonLat,{distance:y.radius,conf:y.conf});let F;return y.message&&console.log(y.message),S.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326"),F=S.getEnabledOnly||void 0===S.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),S.sourceId?F=F.filter(h=>h.getId()===S.sourceId):S.searchType&&(F=F.filter(h=>h.getType()===S.searchType)),F=F.filter(e.ay),this.searchSources(F,C,S)}reverseSearch(C,S,P=!1){const y=P?e.ig:e.ae,F=this.searchSourceService.getEnabledSources().filter(y),h=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(F,C,S||{},h)}searchSources(C,S,P){return C.map(y=>({request:y.search(S,P),reverse:!1,source:y}))}reverseSearchSources(C,S,P,y){return C.map(F=>({request:F.reverseSearch(S,P,y),reverse:!0,source:F}))}termIsValid(C){return"string"==typeof C&&""!==C}static \u0275fac=function(S){return new(S||L)(E.CoB(c.i),E.CoB(o.u),E.CoB(w.yQ),E.CoB(a.u),E.CoB("searchAnalytics",8))};static \u0275prov=E.wxM({token:L,factory:L.\u0275fac})}return L})()},14452:(Pe,ae,r)=>{"use strict";function a(R){return void 0!==R.search}function w(R){return void 0!==R.reverseSearch}function p(R){return void 0!==R.reverseSearch&&!0===R.showInPointerSummary}function c(R,L){let _="";return L.split("").forEach((C,S)=>{C!==R.charAt(S)&&(_+=C)}),_}function o(R,L,_=!1){if(!R||!L)return 0;const C=_?R:R.toString().toLowerCase(),S=_?L:L.toString().toLowerCase(),F=c(C,S)+c(S,C);let h=0;return F.length&&(h=F.length/C.length*100),100-Math.floor(h)}r.d(ae,{Un:()=>o,ae:()=>w,ay:()=>a,ig:()=>p}),r(68392)},78168:(Pe,ae,r)=>{"use strict";r.d(ae,{i:()=>a});var E=r(43168);let a=(()=>class w{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(e){this.options.enabled=e}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const e=this.options.showInSettings;return void 0===e||e}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(e){this._featureStoresWithIndex=e}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(e){this.options.available=e.filter(R=>R.entityStore.searchDocument).length>=1;const c=[];this.featureStoresWithIndex=e.filter(R=>R.entityStore.searchDocument).map(R=>(c.push({title:R.title,value:R.title,enabled:!0}),R.entityStore));const o=this.options.settings.find(R=>"datasets"===R.title);o&&(o.values=c),this.setParamFromSetting(o)}setParamFromSetting(e,c=!0){switch(e.type){case"radiobutton":e.values.forEach(R=>{R.enabled&&(this.options.params=Object.assign(this.options.params||{},{[e.name]:R.value}))});break;case"checkbox":let o="";e.values.filter(R=>!1!==R.available).forEach(R=>{R.enabled&&(o+=R.value+",")}),o=o.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[e.name]:o})}c&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}constructor(e,c){if(this.storageService=c,this.options=e,this.storageService){const o=this.storageService.get(this.getId()+".options");o&&(this.options=E.Yv.mergeDeep(this.options,o))}this.options=E.Yv.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(o=>{this.setParamFromSetting(o,!1)})}getHashtagsValid(e,c){const o=e.match(/(#[A-Za-z\xc0-\xff-+]+)/g);if(!o)return;const R=this.getSettingsValues(c),L=[];return o.forEach(_=>{R.values.forEach(C=>{const S=_.substring(1);if("string"==typeof C.value){const P=C.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),y=P.indexOf(S.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==y&&L.push(P[y])}C.hashtags&&-1!==C.hashtags.indexOf(S.toLowerCase())&&L.push(C.value)})}),L.filter((_,C)=>L.indexOf(_)===C)}getSettingsValues(e){return this.getDefaultOptions().settings.find(c=>c.name===e)}})()},88824:(Pe,ae,r)=>{"use strict";r.d(ae,{y:()=>L});var E=r(61252),a=r(54776),w=r(62632),p=r(88872),e=r(91088),c=r(45212),o=r(87544),R=r(71888);class L{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=L._convertEsriPMS,this._converters.esriSFS=L._convertEsriSFS,this._converters.esriSLS=L._convertEsriSLS,this._converters.esriSMS=L._convertEsriSMS,this._converters.esriTS=L._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(C){return C/.75}static _transformColor(C){return[C[0],C[1],C[2],C[3]/255]}static _getResolutionForScale(C,S){const y=E.q[S];return parseFloat(C)/(39.3701*y*96)}static _convertEsriTS(C){const S=L._transformAngle(C.angle),P=void 0!==C.text?C.text:void 0;return new a.cp({text:new w.c({fill:new p.c({color:L._transformColor(C.color)}),font:C.font.style+" "+C.font.weight+" "+C.font.size+" px "+C.font.family,textBaseline:C.verticalAlignment,textAlign:C.horizontalAlignment,offsetX:L._convertPointToPixel(C.xoffset),offsetY:L._convertPointToPixel(C.yoffset),rotation:S,text:P})})}static _convertEsriPMS(C){const S="data:"+C.contentType+";base64, "+C.imageData,P=L._transformAngle(C.angle);return new a.cp({image:new e.c({src:S,rotation:P})})}static _convertEsriSFS(C){const S=new p.c({color:L._transformColor(C.color)}),P=C.outline?L._convertOutline(C.outline):void 0;return new a.cp({fill:S,stroke:P})}static _convertOutline(C){let S;const P=L._transformColor(C.color);return"esriSLSDash"===C.style?S=[5]:"esriSLSDashDot"===C.style?S=[5,5,1,2]:"esriSLSDashDotDot"===C.style?S=[5,5,1,2,1,2]:"esriSLSDot"===C.style?S=[1,2]:"esriSLSNull"===C.style&&(P[3]=0),new c.c({color:P,lineDash:S,width:L._convertPointToPixel(C.width)})}static _convertEsriSLS(C){return new a.cp({stroke:L._convertOutline(C)})}static _transformAngle(C){if(0===C||void 0===C)return;const P=-C*Math.PI/180+Math.PI/2;return P<0?2*Math.PI+P:P}static _convertEsriSMS(C){const S=new p.c({color:L._transformColor(C.color)}),P=C.outline?L._convertOutline(C.outline):void 0,y=L._convertPointToPixel(C.size)/2,F=L._transformAngle(C.angle);return"esriSMSCircle"===C.style?new a.cp({image:new o.c({radius:y,fill:S,stroke:P})}):"esriSMSCross"===C.style?new a.cp({image:new R.c({fill:S,stroke:P,points:4,radius:y,radius2:0,angle:0,rotation:F})}):"esriSMSDiamond"===C.style?new a.cp({image:new R.c({fill:S,stroke:P,points:4,radius:y,rotation:F})}):"esriSMSSquare"===C.style?new a.cp({image:new R.c({fill:S,stroke:P,points:4,radius:y,angle:Math.PI/4,rotation:F})}):"esriSMSX"===C.style?new a.cp({image:new R.c({fill:S,stroke:P,points:4,radius:y,radius2:0,angle:Math.PI/4,rotation:F})}):"esriSMSTriangle"===C.style?new a.cp({image:new R.c({fill:S,stroke:P,points:3,radius:y,angle:0,rotation:F})}):void 0}_convertLabelingInfo(C,S){const P=[];for(let y=0,F=C.length;y<F;++y){const h=C[y].labelExpression,W=h.substr(h.indexOf("[")+1,h.indexOf("]")-1),J=C[y].symbol,T=C[y].maxScale,Q=C[y].minScale;let z=null;0!==T&&(z=L._getResolutionForScale(T,S));let Y=null;0!==Q&&(Y=L._getResolutionForScale(Q,S));const N=this._converters[J.type].call(this,J);P.push(function(K,j){let A=!0;if(null!==this.minResolution&&null!==this.maxResolution?A=j<this.maxResolution&&j>=this.minResolution:null!==this.minResolution?A=j>=this.minResolution:null!==this.maxResolution&&(A=j<this.maxResolution),A){const d=K.get(this.field);return this.style.getText().setText(d),[this.style]}}.bind({minResolution:z,maxResolution:Y,field:W,style:N}))}return P}_renderSimple(C){const S=this._converters[C.symbol.type].call(this,C.symbol);return()=>[S]}_renderClassBreaks(C){const S=C.defaultSymbol,P=this._converters[S.type].call(this,S),y=C.field,F=[];for(let h=0,W=C.classBreakInfos.length;h<W;++h){const J=C.classBreakInfos[h];let T;T=null==J.classMinValue?0===h?C.minValue:C.classBreakInfos[h-1].classMaxValue:J.classMinValue;const Q=J.classMaxValue,z=J.symbol,Y=this._converters[z.type].call(this,z);F.push({min:T,max:Q,style:Y})}return h=>{const W=h.get(y);for(let J=0,T=F.length;J<T;++J){let Q;if(Q=0===J?W>=F[J].min&&W<=F[J].max:W>F[J].min&&W<=F[J].max,Q)return[F[J].style]}return[P]}}_renderUniqueValue(C){const S=C.defaultSymbol;let P=[];S&&(P=[this._converters[S.type].call(this,S)]);const y=C.field1,F=C.uniqueValueInfos,h=this;return(()=>{const W={};for(let J=0,T=F.length;J<T;++J){const Q=F[J],z=Q.symbol;W[Q.value]=[h._converters[z.type].call(h,z)]}return J=>W[J.get(y)]||P})()}generateStyle(C,S){const P=C.drawingInfo;let y=[];const F=this._renderers[P.renderer.type].call(this,P.renderer);if(void 0!==F&&y.push(F),C.labelingInfo){const h=this._convertLabelingInfo(C.labelingInfo,S);y=y.concat(h)}return 1===y.length?y[0]:(h,W)=>{let J=[];for(let T=0,Q=y.length;T<Q;++T){const z=y[T].call(null,h,W);z&&(J=J.concat(z))}return J}}}},59800:(Pe,ae,r)=>{"use strict";r.d(ae,{Cy:()=>_,M4:()=>L,_o:()=>C,uq:()=>S});var E=r(43168),a=r(45212),w=r(88872),p=r(54776),e=r(87544),c=r(62632),o=r(91088),R=r(82048);function L(){const P=Math.floor(255*Math.random()),y=Math.floor(255*Math.random()),F=Math.floor(255*Math.random()),h=new a.c({color:[P,y,F,1],width:2}),W=new w.c({color:[P,y,F,.4]});return(J,T)=>{const Q=J.get("_style");if(Q&&(0,E.sT)(Q)){if(Q.circle&&J.get("rad")&&J.get("longitude")&&J.get("latitude")){const N=[J.get("longitude"),J.get("latitude")],K=J.get("rad")/Math.cos(Math.PI/180*N[1])/T;Q.circle.radius=K}return(new R.U).createStyle(Q,void 0,T)}return new p.cp({stroke:h,fill:W,image:new e.c({radius:5,stroke:h,fill:W}),text:J.get("_mapTitle")?new c.c({text:J.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new w.c({color:"#000"}),stroke:new a.c({color:"#fff",width:3}),overflow:!0}):void 0})}}function _(){const P=Math.floor(255*Math.random()),y=Math.floor(255*Math.random()),F=Math.floor(255*Math.random()),h=new a.c({color:[P,y,F,1],width:2}),W=new w.c({color:[P,y,F,.4]});return new p.cp({stroke:h,fill:W,image:new e.c({radius:5,stroke:h,fill:W})})}function C(P,y){const h=[new p.cp({text:new c.c({text:P.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new w.c({color:"#000"}),backgroundFill:new w.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new a.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new a.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===P.getGeometry().getType()?h.push(new p.cp({image:new e.c({radius:10,stroke:new a.c({color:"blue",width:3})})})):(h.push(new p.cp({stroke:new a.c({color:"white",width:5})})),h.push(new p.cp({stroke:new a.c({color:"blue",width:3})}))),h}function S(P,y){return new p.cp({image:new o.c({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new c.c({text:P.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new w.c({color:"#000"}),backgroundFill:new w.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new a.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new a.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}},47572:(Pe,ae,r)=>{"use strict";r.d(ae,{o:()=>o});var E=r(82736),a=r(54776),w=r(91088),p=r(62632),e=r(88872),c=r(45212);function o({text:R,opacity:L=1,markerColor:_=[0,161,222],markerOutlineColor:C=[255,255,255]}={}){let S,P,y,F;const h=(0,E.f4)(_).slice(0),W=(0,E.f4)(C).slice(0);return 4===h.length&&("string"!=typeof _||/^#[0-9A-F]{8}$/i.test(_))&&(L=h[3]),P=`"rgba(${h[0]},${h[1]},${h[2]},${L})"`,S=_,y=`"rgb(${W[0]},${W[1]},${W[2]})"`,F='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+P+" stroke="+y+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new a.cp({image:new w.c({src:F,opacity:L,anchor:[.5,.92]}),text:new p.c({text:R,font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),stroke:new c.c({color:"#fff",width:3}),overflow:!0})})}},52756:(Pe,ae,r)=>{"use strict";r.d(ae,{B:()=>_,I:()=>L});var E=r(82736),a=r(45212),w=r(88872),p=r(54776),e=r(87544),c=r(62632),o=r(82048),R=r(47572);function L(){const S=_(),P=(0,R.o)();let y;return(F,h)=>{if("bufferFeature"===F.getId())return y=function C(S=[0,161,222,1],P=2,y=[0,161,222,.15],F){const h=new a.c({width:P,color:S}),W=new w.c({color:y});return new p.cp({stroke:h,fill:W,image:new e.c({radius:5,stroke:h,fill:W}),text:new c.c({font:"12px Calibri,sans-serif",text:F,fill:new w.c({color:"#000"}),stroke:new a.c({color:"#fff",width:3}),overflow:!0})})}(F.get("bufferStroke"),2,F.get("bufferFill"),F.get("bufferText")),y;{const W=F.get("_style");return W?(new o.U).createStyle(W,F,h):(y="Point"===F.getGeometry().getType()?P:S,y.getText().setText(F.get("_mapTitle")),y)}}}function _({text:S,strokeWidth:P=2,fillColor:y=[0,161,222,.3],strokeColor:F=[0,161,222,.9]}={}){const h=(0,E.f4)(y).slice(0),W=(0,E.f4)(F).slice(0),J=new a.c({width:P,color:W}),T=new w.c({color:h});return new p.cp({stroke:J,fill:T,image:new e.c({radius:5,stroke:J,fill:T}),text:new c.c({text:S,font:"12px Calibri,sans-serif",fill:new w.c({color:"#000"}),stroke:new a.c({color:"#fff",width:3}),overflow:!0})})}},82048:(Pe,ae,r)=>{"use strict";r.d(ae,{U:()=>P});var E=r(58264),a=r(54776),w=r(7444),p=r(71888),e=r(88872),c=r(45212),o=r(62632),R=r(91088),L=r(87544),_=r(59324),C=r(47572),S=r(34896);let P=(()=>{class y{style;createStyle(h,W,J){if(!h)return(0,C.o)();if("function"==typeof h||h instanceof a.cp)return h;const T=this.parseStyle("style",h);if(T.getText()){let Q=0,z=1/0;if(h.text){const Y=h.text?.minScaleDenom?(0,_.bg)(Number(h.text.minScaleDenom)):void 0,N=h.text?.maxScaleDenom?(0,_.bg)(Number(h.text.maxScaleDenom)):void 0;Q=Y||(h.text?.minResolution?h.text.minResolution:0),z=N||(h.text?.maxResolution?h.text.maxResolution:1/0)}(h.text?.minScaleDenom||h.text?.maxScaleDenom||h.text?.minResolution||h.text?.maxResolution)&&(W&&J>=Q&&J<=z?W&&h.text.attribute&&T.getText().setText(this.getLabel(W,h.text.attribute)):T.setText())}return T}parseStyle(h,W){const J={},T=this.getOlCls(h);return T&&W instanceof Object?(Object.keys(W).forEach(Q=>{const z=this.getOlKey(Q);J[z]=this.parseStyle(Q,W[Q])}),new T(J)):W}getOlKey(h){let W;switch(h.toLowerCase()){case"circle":case"regularshape":case"icon":W="image"}return W||h}getOlCls(h){let W=w[h.charAt(0).toUpperCase()+h.slice(1)];return"regularshape"===h&&(W=p.c),"backgroundFill"===h&&(W=e.c),"backgroundStroke"===h&&(W=c.c),W}createStyleByAttribute(h,W,J){let T;const Q=W.type?W.type:this.guessTypeFeature(h),z=W.attribute,Y=W.data,N=W.stroke,K=W.width,j=W.fill,A=W.anchor,d=W.radius,u=W.icon,x=W.scale,U=Y?Y.length:0,G=W.label?W.label.attribute:void 0,X=W.label?.minScaleDenom?(0,_.bg)(Number(W.label.minScaleDenom)):void 0,D=W.label?.maxScaleDenom?(0,_.bg)(Number(W.label.maxScaleDenom)):void 0,s=X||(W.label?.minResolution?W.label.minResolution:0),H=D||(W.label?.maxResolution?W.label.maxResolution:1/0);let Z=W.label?.style?this.parseStyle("text",W.label.style):void 0;!Z&&G&&(Z=new o.c);const me=W.baseStyle;if(Z&&Z.setText(J>=s&&J<=H?this.getLabel(h,G):""),"circle"===Q){for(let _e=0;_e<U;_e++){const de=typeof h.get(z)<"u"&&null!==h.get(z)?h.get(z):"";if(de===Y[_e]||de.toString().match(new RegExp(Y[_e],"gmi")))return u?(T=[new a.cp({image:new R.c({color:j?j[_e]:void 0,src:u[_e],scale:x?x[_e]:1,anchor:A?A[_e]:[.5,.5]}),text:Z instanceof o.c?Z:void 0})],T):(T=[new a.cp({image:new L.c({radius:d?d[_e]:4,stroke:new c.c({color:N?N[_e]:"black",width:K?K[_e]:1}),fill:new e.c({color:j?j[_e]:"black"})}),text:Z instanceof o.c?Z:void 0})],T)}if(!h.getStyle())return me?(T=this.createStyle(me,h,J),Z&&T.setText(Z),T):(T=[new a.cp({image:new L.c({radius:4,stroke:new c.c({color:"black"}),fill:new e.c({color:"#bbbbf2"})})})],T)}else if("regular"===Q){for(let _e=0;_e<U;_e++){const de=typeof h.get(z)<"u"&&null!==h.get(z)?h.get(z):"";if(de===Y[_e]||de.toString().match(new RegExp(Y[_e],"gmi")))return T=[new a.cp({stroke:new c.c({color:N?N[_e]:"black",width:K?K[_e]:1}),fill:new e.c({color:j?j[_e]:"rgba(255,255,255,0.4)"}),text:Z instanceof o.c?Z:void 0})],T}if(h instanceof E.c&&!h.getStyle())return me?(T=this.createStyle(me,h,J),Z&&T.setText(Z),T):(T=[new a.cp({stroke:new c.c({color:"black"}),fill:new e.c({color:"#bbbbf2"})})],T)}}createClusterStyle(h,W,J={},T){let Q;const z=h.get("features").length;if(1!==z){if(J.clusterRanges)for(const Y of J.clusterRanges)if((!Y.minRadius||Y.minRadius<=z)&&(!Y.maxRadius||Y.maxRadius>=z)){if(Q=this.createStyle(Y.style),Y.showRange){const N=new o.c({text:z.toString(),fill:new e.c({color:"#fff"})});Q.setText(N)}if(Y.dynamicRadius){let N;const K=Q.getRadius();N=5*Math.log(z),N<K&&(N=K),Q.image_.setRadius(N)}break}if(!Q){let Y;J.radiusCalc?Y=J.radiusCalc(z):(Y=5*Math.log(z),Y<6&&(Y=6)),Q=[new a.cp({image:new L.c({radius:Y,stroke:new c.c({color:"black"}),fill:new e.c({color:"rgba(24, 134, 45, 0.5)"})}),text:new o.c({text:z.toString(),fill:new e.c({color:"#fff"})})})]}}else Q=this.createStyle(T,h,W);return Q}getLabel(h,W){let J=W;if(!J)return;const T=Array.from(W.matchAll(/\$\{([^\{\}]+)\}/g));return T.forEach(Q=>{J=J.replace(Q[0],h.get(Q[1]))}),0===T.length&&J===W&&(J=h.get(W)||W),J}guessTypeFeature(h){switch(h.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(W){return new(W||y)};static \u0275prov=S.wxM({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},47864:(Pe,ae,r)=>{"use strict";r.d(ae,{KC:()=>w,iL:()=>C});var E=r(43168),a=r(11772);function w(S){return({wms:p,wmts:e,xyz:c,feature:o,wfs:R,arcgisrest:L,imagearcgisrest:L,tilearcgisrest:L,osm:F=>"OSM",tiledebug:F=>"tiledebug"}[S.type]||_)(S)}function p(S){const P=S.params.LAYERS,F="wms"+C(S.url)+P;return a.Cy.hashStr(F)}function e(S){const P=S.layer,F="wmts"+C(S.url)+P;return a.Cy.hashStr(F)}function c(S){const y="xyz"+C(S.url);return a.Cy.hashStr(y)}function o(S){if(!S.url)return _();const y="feature"+C(S.url);return a.Cy.hashStr(y)}function R(S){if(!S.url||!S.params)return _();const y="wfs"+C(S.url)+S.params.featureTypes;return a.Cy.hashStr(y)}function L(S){const P=S.layer,y=C(S.url);return a.Cy.hashStr((S.type||"arcgis")+y+P)}function _(S){return(0,E.uq)()}function C(S){const y=("/"===S.charAt(0)?window.location.origin+S:S).split(/[?&]/);let F=y.shift();const h=y.filter(W=>0!==W.length&&"_"!==W.charAt(0));return h.length&&(F+="?"+h.join("&")),F}},31492:(Pe,ae,r)=>{"use strict";r.d(ae,{iOV:()=>$l,kvX:()=>Bl,oxI:()=>Nd,aaH:()=>nt.a,OEM:()=>_t.O,YdQ:()=>D,Se2:()=>ys,gLH:()=>nc,O_6:()=>Wa,YNI:()=>wr,YfI:()=>Ut.Yf,EBb:()=>nt.EB,wP$:()=>Ut.wP,Suj:()=>Ut.Su,ym_:()=>Ut.ym,E9g:()=>Ut.E9,kj0:()=>Ut.kj,Wwb:()=>ic,cdH:()=>H.cd,s9F:()=>yo,eqy:()=>H.eq,aw9:()=>c,ach:()=>Ud,yGW:()=>H.yG,SET:()=>Fp,G_h:()=>gd,Oy$:()=>Pd,OrO:()=>qa,Y1E:()=>H.Y1,ApN:()=>al,wSE:()=>Fs,Ult:()=>dl,m2U:()=>Ls,g7B:()=>Zn,IZ6:()=>k.IZ,q2F:()=>H.q2,u00:()=>H.u0,K88:()=>Zt.K8,yaV:()=>Zt.y,Idw:()=>Gs,Ga$:()=>Yi,w35:()=>Q.w,Kwu:()=>Pl,__k:()=>vi,E9h:()=>Hn,isy:()=>bi,Iz2:()=>rm,knT:()=>H.kn,eAF:()=>Xp,qME:()=>H.qM,s5H:()=>di.s5,IlJ:()=>di.Il,i6P:()=>H.i6,aWp:()=>Cn.aW,qE2:()=>As.q,kBh:()=>ks.T,i6q:()=>Bs.i,uu$:()=>vr,c97:()=>j,kjd:()=>x,_cQ:()=>K,K4n:()=>Ya,qM$:()=>Cn.qM,czr:()=>Cn.cz,SYK:()=>Cn.SY,cTh:()=>Ts,iOO:()=>$d,UND:()=>Jn.U,eM$:()=>ja,gpx:()=>br,eAs:()=>Ka,gho:()=>Os,DCK:()=>h.D,U3K:()=>h.U,wL1:()=>k.wL,ktW:()=>pl,Mdo:()=>k.Md,w16:()=>H.w1,MrZ:()=>Js,WQ3:()=>Fm,qcl:()=>H.qc,q17:()=>Ut.q1,KGf:()=>H.KG,o5m:()=>ec.o,qKz:()=>Ut.qK,Cyp:()=>xr.Cy,M4J:()=>xr.M4,K6O:()=>Ut.K6,Ki0:()=>Ut.Ki,Yvl:()=>Ut.Yv,rEB:()=>H.rE,_aW:()=>$r,IvV:()=>tc,wvY:()=>vm,cDV:()=>Zt.cD,QX5:()=>Ut.QX,UfW:()=>Sm,yh6:()=>Qp,WIT:()=>sm,uEw:()=>H.uE,ayN:()=>Mi.ay,WmN:()=>Td,wnB:()=>tm,WWf:()=>ym,ETi:()=>H.ET,KMH:()=>H.KM});var E=r(69488),a=r(8984),w=r(72184),p=r(62747),e=r(34896);let c=(()=>{class l{static forRoot(){return{ngModule:l}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[p.U,a.k,E.k,w.c]})}return l})();var o=r(65056),R=r(34672),L=r(32328),_=r(27e3),C=r(20460),P=(r(55792),r(64100)),y=r(61252),F=r(54760),h=r(14191),W=r(92424),J=r(21808);let T=(()=>{class l{constructor(){}filterByDate(t,i){let n,g,b,B;if(Array.isArray(i)){const fe=[];i[0]&&(b=this.reformatDateTime(i[0]),fe.push(i[0])),i[1]&&(B=this.reformatDateTime(i[1]),fe.push(i[1])),2===fe.length&&b!==B&&(n=t instanceof W.W?b+","+B:b+"/"+B),b===B&&(n=b)}else i&&(g=this.reformatDateTime(i),n=g);t.ol.updateParams({TIME:n}),t instanceof J.C&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,i){let n,g,b;if(Array.isArray(i)){const pe=[];i[0]&&(g=i[0],pe.push(i[0])),i[1]&&(b=i[1],pe.push(i[1])),2===pe.length&&g!==b&&(n=t instanceof W.W?g+","+b:g+"/"+b),g===b&&(n=g)}else n=i;t.ol.updateParams({TIME:n}),t instanceof J.C&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const i=t.getFullYear();let n=t.getMonth()+1,g=t.getUTCDate(),b=t.getUTCHours(),B=t.getUTCMinutes();return Number(n)<10&&(n="0"+n),Number(g)<10&&(g="0"+g),Number(b)<10&&(b="0"+b),Number(B)<10&&(B="0"+B),i+"-"+n+"-"+g+"T"+b+":"+B+":00Z"}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var Q=r(5196),z=r(40912);let Y=(()=>{class l{constructor(){}filterByOgc(t,i){const n=(new z.S).formatProcessedOgcFilter(i,t.options.params.LAYERS);t.ol.updateParams({FILTER:n})}setOgcWFSFiltersOptions(t){const i=t.options,n=new z.S;i.ogcFilters.enabled&&i.ogcFilters.filters&&(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry,new F.c({code:i.paramsWFS.srsName}),!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const i=t.options,n=new z.S;i.ogcFilters.enabled&&i.ogcFilters.filters?(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.fieldNameGeometry,void 0,!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.fieldNameGeometry)),this.filterByOgc(t,n.buildFilter(i.ogcFilters.filters,void 0,void 0,void 0,t.options)),i.filtered=!0):(i.ogcFilters.filters=void 0,i.ogcFilters.interfaceOgcFilters=[],i.filtered=!1)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var K=function(l){return l.Predefined="Predefined",l.Polygon="Polygon",l.Point="Point",l}(K||{}),j=function(l){return l.Address="Address",l.Thematics="Thematics",l}(j||{}),A=r(45872),d=r(40604),u=r(33712);let x=(()=>{class l{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(t,i,n){this.http=t,this.languageService=i,this.configService=n,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,i){return Object.keys(t).find(n=>t[n]===i)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,d.k)(n=>n.features.map(g=>(g.meta={id:g.properties.code},g))))}loadThematicsList(){const i=[];return this.http.get(this.baseUrl+"types").pipe((0,d.k)(n=>(n.forEach(g=>{if(g.startsWith("lieux")){const b={name:void 0,source:g};let B=g.substring(6,g.length),pe=B;if(B.includes(".")){const fe=B.indexOf(".");pe=B.substring(fe+1,B.length),B=B.substring(0,fe)}try{b.name=this.languageService.translate.instant("igo.geo.terrapi."+pe)}catch{b.name=pe.substring(0,1).toUpperCase()+pe.substring(1,pe.length-1)}try{b.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+B)}catch{b.group=B.substring(0,1).toUpperCase()+B.substring(1,pe.length-1)}i.push(b)}else if(this.getKeyByValue(this.urlFilterList,g)){const b={name:void 0,source:g},B=this.getKeyByValue(this.urlFilterList,g);try{b.name=this.languageService.translate.instant("igo.geo.terrapi."+B)}catch{b.name=B.substring(0,1).toUpperCase()+B.substring(1,B.length-1)}b.source=g,i.push(b)}}),i)))}loadFilterItem(t,i,n,g,b){if(n){const pe=this.baseUrl+this.urlFilterList[n];let fe="";return i===j.Address?(fe="adresses",this.http.get(pe+"/"+t.properties.code+"/"+fe,{params:{geometry:"true",icon:"true",bufferInput:b.toString(),simplified:"100"}}).pipe((0,d.k)(Fe=>Fe.features.map(Ee=>(Ee.meta={id:Ee.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:Ee.icon},Ee))))):(fe=g.source,this.http.get(pe+"/"+t.properties.code+"/"+fe,{params:{geometry:"true",icon:"true",bufferInput:b.toString(),simplified:"100"}}).pipe((0,d.k)(Fe=>Fe.features.map(Ee=>(Ee.meta={id:Ee.properties.code,title:g.name,icon:Ee.icon},Ee)))))}{const B=this.baseUrl+"locate";return i===j.Address?this.http.post(B+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:b.toString(),simplified:"100"}).pipe((0,d.k)(fe=>fe.features.map(Fe=>(Fe.meta={id:Fe.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:Fe.icon},Fe)))):this.http.post(B+"?type="+g.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:b.toString(),simplified:"100"}).pipe((0,d.k)(fe=>fe.features.map(Fe=>(Fe.meta={id:Fe.properties.code,title:g.name,icon:Fe.icon},Fe))))}}loadItemById(t,i){const n=this.urlFilterList[i],g="/"+t.properties.code;if(n&&g)return this.http.get(this.baseUrl+n+g,{params:{geometry:"true"}}).pipe((0,d.k)(b=>(b.meta={id:b.properties.code,alias:b.properties.nom,title:b.properties.nom},b)))}loadBufferGeometry(t,i,n,g){if(i!==K.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:n,loc:JSON.stringify(t)}).pipe((0,d.k)(b=>b));{const b=this.urlFilterList[g],B="/"+t.properties.code;if(b&&B)return this.http.get(this.baseUrl+b+B,{params:{geometry:"100",bufferOutput:n.toString()}}).pipe((0,d.k)(pe=>(pe.meta={id:pe.properties.code,alias:pe.properties.nom,title:pe.properties.nom},pe)))}}static \u0275fac=function(i){return new(i||l)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),U=(()=>{class l{messageService;constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const i=t.dataSource.options;if(Object.keys(i.download).length>0)if(i.download.dynamicUrl&&void 0===i.download.url){let n,g=new F.c({code:t.map.projection});const b=t.dataSource.options.paramsWFS;b&&Object.keys(b).length>0?(g=b.srsName?new F.c({code:b.srsName}):g,n=t.dataSource.options.paramsWFS):n=t.dataSource.options.params;const B=y.W0(t.map.viewController.getExtent(),new F.c({code:t.map.projection}),g),pe=void 0===n.outputFormatDownload?void 0===n.outputFormat?"":"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,fe=i.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),Fe=t.dataSource.options.ogcFilters;let Ee;Ee=(new z.S).handleOgcFiltersAppliedValue(t.dataSource.options,Fe.geometryName,B,g),Ee=Ee?"filter="+encodeURIComponent(Ee):(new z.S).buildFilter(void 0,B,g,Fe.geometryName),window.open(`${fe}&${Ee}&${pe}`,"_blank")}else i.download&&window.open(i.download.url,"_blank")}static \u0275fac=function(i){return new(i||l)(e.CoB(P.mi))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var G=r(72584);function X(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openDownload(n.layer))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"download"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let D=(()=>{class l{downloadService;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t){this.downloadService=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)(e.GI1(U))};static \u0275cmp=e.In1({type:l,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,X,4,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.download&&(n.options.download.dynamicUrl||n.options.download.url))},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,C._s,G.sD],changeDetection:0})}return l})();var M=r(50032),s=r(28180),H=r(34080),Z=r(71904),me=r(58539),_e=r(75180),de=r(63916),le=r(92096),ue=r(54844),ne=r(46176),ve=r(50244),ye=r(77872),Le=r(53476),He=r(75684),Ve=r(1296),Ge=r(51672),ct=r(21780);const Ie=["renderedLegend"];function Ye(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("toggle",function(n){e.usT(t);const g=e.GaO(2).$implicit,b=e.GaO(3);return e.CGJ(b.toggleLegendItem(n,g))}),e.OEk(2,"expand_less "),e.C$Y(),e.I0R(3,"span",8),e.OEk(4),e.wVc(5,"async"),e.C$Y()()}if(2&l){e.GaO();const t=e.Gew(3),i=e.GaO().$implicit,n=e.GaO(3);e.yG2(),e.E7m("target",t)("collapsed",i.collapsed),e.yG2(3),e.oRS("",e.kDX(5,3,n.computeItemTitle(i))," ")}}function se(l,f){if(1&l&&(e.I0R(0,"mat-option",11),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.name),e.yG2(),e.cNF(t.title)}}function ge(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(5);return e.kNx(g.currentStyle,n)||(g.currentStyle=n),e.CGJ(n)}),e.qCj("selectionChange",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.onChangeStyle())}),e.wVc(3,"translate"),e.yuY(4,se,2,2,"mat-option",10),e.C$Y()()()}if(2&l){const t=e.GaO(5);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("ngModel",t.currentStyle),e.yG2(2),e.E7m("ngForOf",t.styles)}}function Re(l,f){if(1&l){const t=e.KQA();e.I0R(0,"img",14,15),e.qCj("load",function(){e.usT(t);const n=e.GaO(4).$implicit,g=e.GaO(3);return e.CGJ(g.onLoadImage(n.title))}),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO(4).$implicit;e._6D("id",t.title),e._6D("alt",e.kDX(2,4,"igo.geo.layer.legend.loadingLegendText")),e.E7m("hideError",!0)("src",t.imgGraphValue,e.K6U)}}function Ue(l,f){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function ze(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,Re,3,6,"img",13)(2,Ue,3,3,"small",0),e.C$Y()),2&l){const t=e.GaO(3).$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.imgGraphValue),e.yG2(),e.E7m("ngIf",i.imagesHeight[t.title]<16)}}function Be(l,f){if(1&l&&(e.wR5(0,"div",16),e.wVc(1,"sanitizeHtml")),2&l){const t=e.GaO(3).$implicit;e.E7m("ngStyle",t.style)("innerHTML",e.kDX(1,2,t.html),e.E3n)}}function st(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,ze,3,2,"div",0)(2,Be,2,4,"div",12),e.C$Y()),2&l){const t=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",t.url),e.yG2(),e.E7m("ngIf",t.html)}}const xe=l=>({"with-title":l});function Ke(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,Ye,6,5,"mat-list-item",0),e.I0R(2,"div",5,6),e.yuY(4,ge,5,5,"div",0)(5,st,3,2,"div",0),e.C$Y()()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.title),e.yG2(),e.E7m("ngClass",e.S45(4,xe,t.title)),e.yG2(2),e.E7m("ngIf",void 0!==i.currentStyle),e.yG2(),e.E7m("ngIf",!t.collapsed)}}function Qe(l,f){if(1&l&&(e.SAx(0,null,4),e.yuY(2,Ke,6,6,"div",1),e.k70()),2&l){e.GaO(2);const t=e.Gew(3),i=e.GaO();e.yG2(2),e.E7m("ngIf",i.getLegend)("ngIfElse",t)}}function It(l,f){if(1&l&&(e.SAx(0),e.yuY(1,Qe,3,2,"ng-container",3),e.k70()),2&l){const t=e.GaO().ngIf;e.yG2(),e.E7m("ngForOf",t.slice().reverse())}}function at(l,f){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendText")," "))}function Ft(l,f){if(1&l&&(e.SAx(0),e.yuY(1,It,2,1,"ng-container",1)(2,at,3,3,"ng-template",null,2,e.gJz),e.k70()),2&l){const t=f.ngIf,i=e.Gew(3);e.yG2(),e.E7m("ngIf",t.length)("ngIfElse",i)}}let Et=(()=>{class l{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new ue.g([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(t,i,n,g,b){this.capabilitiesService=t,this.languageService=i,this.configService=n,this.http=g,this.cdRef=b}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const i=this.layer.options.source.options;if(i&&i.params&&i.params.STYLES?this.currentStyle=this.styles.find(n=>n.name===i.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=typeof this.layer.options.legendOptions<"u"&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||i.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const n of t)this.getLegendGraphic(n)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new He.kd(this.http,this.configService).transform(t.url).pipe((0,Ge.a)(n=>{if(n.error)return n.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),n})).subscribe(n=>{const g=this.legendItems$.value.findIndex(B=>B.title===t.title);this.legendItems$.value[g].imgGraphValue=n,this.cdRef.detectChanges()})}toggleLegendItem(t,i){i.collapsed=t}transfertToggleLegendItem(t){const i=t,n=this.layer.legend;for(let g=0;g<n.length;g++)i[g].collapsed=n[g].collapsed;return i}computeItemTitle(t){const i=this.layer.dataSource.options;if("wms"!==i.type)return(0,Ve.of)(t.title);const n=i.params.LAYERS.split(","),g=JSON.parse(JSON.stringify(i));return g.params.LAYERS=n.find(b=>b===t.title),this.capabilitiesService.getWMSOptions(g).pipe((0,d.k)(b=>b._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const i of this.legendItems$.value)this.getLegendGraphic(i)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let g=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(g=g.concat(t.legendOptions.stylesAvailable.filter(b=>"default"!==b.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==b.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),g.filter(b=>!b.title).map(b=>b.title=b.name),g.map(b=>b.title=b.title.charAt(0).toUpperCase()+b.title.slice(1).replace(/_/g," ")),g}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof J.C&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(i=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let i;i=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(n=>n.nativeElement.id===t).nativeElement,this.imagesHeight[t]=i.height}static \u0275fac=function(i){return new(i||l)(e.GI1(ct.S),e.GI1(C.ov),e.GI1(A.aW),e.GI1(u.KK),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend"]],viewQuery:function(i,n){if(1&i&&e.CC$(Ie,5),2&i){let g;e.wto(g=e.Gqi())&&(n.renderedLegends=g)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},standalone:!0,features:[e.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(i,n){1&i&&(e.yuY(0,Ft,4,2,"ng-container",0),e.wVc(1,"async")),2&i&&e.E7m("ngIf",e.kDX(1,1,n.legendItems$))},dependencies:[o.u_,o.Iw,de.iI,de.g9,de.Y1,de.UV,L.oB,L.qL,le.mK,o.QF,ve.wb,ve.Up,ye.d5,ye.kX,ne.I5,_.KO,_.a4,Z.y,Z.ue,Z._G,ne.Ax,He.MJ,o.Qt,o.a,C._s,G.sD,Le.Ux],styles:['[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})}return l})();var Kt=r(69400),yt=r(42536),Oo=r(10416);let ei=(()=>{class l{constructor(){}wktToFeature(t,i,n){return(new Oo.c).readFeature(t,{dataProjection:i,featureProjection:n})}extentToWkt(t,i,n){let g=y.W0(i,n,t);return g=this.roundCoordinateArray(g,t,0),{wktPoly:`POLYGON((\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]}))`,wktLine:`LINESTRING(\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${i[0]} ${i[1]},\n        ${i[0]} ${i[3]},\n        ${i[2]} ${i[3]},\n        ${i[2]} ${i[1]})`}}roundCoordinateArray(t,i,n=0){const b=y._M(i).getUnits();return-1!==["ft","m","us-ft"].indexOf(b)&&(t=this.roundArray(t,n)),t}roundArray(t,i=0){let n=0;for(;n<t.length;)t[n]=t[n].toFixed(i),n++;return t}snrcToWkt(t,i){let n;t=t.toLowerCase();const g={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},b={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},B=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],pe=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let Ae=!1,Je=!1,ke=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?ke=!0:/\d{2,3}[a-p]/gi.test(t)?Je=!0:/\d{2,3}/gi.test(t)&&(Ae=!0),Ae?t+="a01":Je&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const lt=t.split(/(?=[a-p])/gi),Ct=lt[0],Bt=lt[1][0],uo=lt[1].split(Bt)[1];let Ro=1;3===Ct.length&&(Ro=2);const vn=Ct.substring(0,Ro),sc=Ct.substring(Ro),ac=8,Lo=4,qo=2,Sn=1,lc=.5,cc=.25;let Zs=0,qs=0,uc=0,dc=0;B.forEach(qi=>{-1!==qi.indexOf(Bt)&&(qs=B.indexOf(qi),Zs=qi.indexOf(Bt))}),pe.forEach(qi=>{-1!==qi.indexOf(uo)&&(dc=pe.indexOf(qi),uc=qi.indexOf(uo))});let ea=0,ta=0,oa=0,ia=0,Yr=ac,Vr=Lo;Je?(ea=Zs*qo,ta=qs*Sn,oa=0,ia=0,Yr=qo,Vr=Sn):ke&&(ea=Zs*qo,ta=qs*Sn,oa=uc*lc,ia=dc*cc,Yr=lc,Vr=cc);const St={ul:[g[vn].to+ea+oa,b[sc].to-ta-ia]};return St.lr=[St.ul[0]+Yr,St.ul[1]-Vr],St.ur=[St.ul[0],St.ul[1]-Vr],St.ll=[St.ul[0]+Yr,St.ul[1]],St.ul=y.AF([St.ul[0],St.ul[1]],"EPSG:4326",i),St.lr=y.AF([St.lr[0],St.lr[1]],"EPSG:4326",i),St.ur=y.AF([St.ur[0],St.ur[1]],"EPSG:4326",i),St.ll=y.AF([St.ll[0],St.ll[1]],"EPSG:4326",i),St.ul=this.roundCoordinateArray(St.ul,i,0),St.lr=this.roundCoordinateArray(St.lr,i,0),St.ur=this.roundCoordinateArray(St.ur,i,0),St.ll=this.roundCoordinateArray(St.ll,i,0),n="POLYGON(("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" "),St.ul.join(" ")].join(",")+"))",{wktPoly:n,wktLine:"LINESTRING("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" "),St.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" ")].join(",")+")"}}}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Pt=r(61792),xt=r(24392),ut=r(43424),Go=r(30816),Ze=r.n(Go);let Io=(()=>{class l{defaultStepMillisecond=6e4;constructor(){}step(t,i){return t.options.stepDate?t.options.stepDate:i.step}stepMillisecond(t,i){const n=Ze().duration(this.step(t,i)).asMilliseconds();return 0===n?this.defaultStepMillisecond:n}stepIsYearDuration(t){const i=Ze().duration(t);return 0!==i.years()&&0===i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsMonthDuration(t){const i=Ze().duration(t);return 0!==i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsWeekDuration(t){const i=Ze().duration(t);return 0!==i.weeks()&&7===i.days()&&0===i.hours()&&0===i.minutes()}stepIsDayDuration(t){const i=Ze().duration(t);return 0!==i.days()&&0===i.hours()&&0===i.minutes()}stepIsHourDuration(t){const i=Ze().duration(t);return 0!==i.hours()&&0===i.minutes()}stepIsMinuteDuration(t){return 0!==Ze().duration(t).minutes()}dateToNumber(t){let i=new Date;return t&&(i=new Date(t)),i.getTime()}addStep(t,i){return Ze()(t).add(i,"milliseconds").toDate()}subtractStep(t,i){return Ze()(t).subtract(i,"milliseconds").toDate()}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var Xt=r(79764);let eo=(()=>{class l{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new e._w7;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play_circle";resetIcon="replay";get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(t){this.ogcFilterTimeService=t,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let i=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=Ze().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();i=Ze()(this.beginMillisecond).add((t-1)*n,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=Ze().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();i=Ze()(this.beginMillisecond).add((t-1)*n,"month").toDate()}return Ze()(i).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(i=>{if(this.slider.step<this.calculatedStep){const g="_emitInputEvent";this.slider._increment(1),this.slider[g]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle",this.slider.step=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=Ze().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),n=Ze()(this.beginMillisecond).add((t.value-1)*i,"year").toDate(),g=Ze()(n).add(i,"year").toDate();this.changeProperty.next({value:Ze()(n).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:Ze()(g).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=Ze().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),n=Ze()(this.beginMillisecond).add((t.value-1)*i,"month").toDate(),g=Ze()(n).add(i,"month").toDate();this.changeProperty.next({value:Ze()(n).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:Ze()(g).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:i.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(i.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}static \u0275fac=function(i){return new(i||l)(e.GI1(Io))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(i,n){if(1&i&&e.CC$(Xt.Cg,5),2&i){let g;e.wto(g=e.Gqi())&&(n.slider=g.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([Io]),e.UHJ],decls:11,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange"],["ngSlider",""],["matSliderThumb","",3,"input"],["ngSliderThumb","matSliderThumb"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const g=e.KQA();e.I0R(0,"div",0)(1,"mat-slider",1,2),e.iHE("ngModelChange",function(B){return e.kNx(n.sliderValue,B)||(n.sliderValue=B),B}),e.I0R(3,"input",3,4),e.qCj("input",function(){e.usT(g);const B=e.Gew(4),pe=e.Gew(2);return e.CGJ(n.handleSliderInput({source:B,parent:pe,value:B.value}))}),e.C$Y()(),e.I0R(5,"button",5),e.qCj("click",function(B){return n.playFilter(B)}),e.I0R(6,"mat-icon"),e.OEk(7),e.C$Y()(),e.I0R(8,"button",5),e.qCj("click",function(B){return n.resetFilter(B)}),e.I0R(9,"mat-icon"),e.OEk(10),e.C$Y()()()}2&i&&(e.yG2(),e.E7m("step",1)("min",1)("max",n.calculatedStep),e.OKB("ngModel",n.sliderValue),e.E7m("displayWith",n.sliderDisplayWith),e.yG2(6),e.cNF(n.playIcon),e.yG2(3),e.cNF(n.resetIcon))},dependencies:[Xt.yO,Xt.Cg,Xt._s,Z.y,Z.ue,Z._G,R.oJ,R.um,L.oB,L.qL],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}"]})}return l})();const $o=["endDatepickerTime"],Ao=["beginDatepickerTime"],No=["beginTime"],pi=["endTime"];function no(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",4),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.sliderMode,n)||(g.sliderMode=n),e.CGJ(n)}),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.modeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.OKB("ngModel",t.sliderMode),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function ro(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.qCj("changeProperty",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changePropertyByPass(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function pt(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"input",11),e.qCj("change",function(n){e.usT(t);const g=e.Gew(8),b=e.GaO(2);return e.CGJ(b.yearOnlyInputChange(n,g,"begin"))}),e.C$Y(),e.wR5(6,"mat-datepicker-toggle",12),e.I0R(7,"mat-datepicker",13,14),e.qCj("yearSelected",function(n){e.usT(t);const g=e.Gew(8),b=e.GaO(2);return e.CGJ(b.yearSelected(n,g,"begin"))}),e.C$Y(),e.wR5(9,"input",15,16),e.C$Y(),e.I0R(11,"mat-form-field",10)(12,"mat-label"),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.I0R(15,"input",11),e.qCj("change",function(n){e.usT(t);const g=e.Gew(18),b=e.GaO(2);return e.CGJ(b.yearOnlyInputChange(n,g,"end"))}),e.C$Y(),e.wR5(16,"mat-datepicker-toggle",12),e.I0R(17,"mat-datepicker",13,17),e.qCj("yearSelected",function(n){e.usT(t);const g=e.Gew(18),b=e.GaO(2);return e.CGJ(b.yearSelected(n,g,"end"))}),e.C$Y(),e.wR5(19,"input",15,18),e.C$Y(),e.I0R(21,"div",19)(22,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(23,"translate"),e.I0R(24,"mat-icon"),e.OEk(25),e.C$Y()(),e.I0R(26,"mat-slide-toggle",21),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(27,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(8),i=e.Gew(18),n=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,27,"igo.geo.timeFilter.startYear")),e.yG2(2),e._6D("value",n.onlyYearBegin),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",t)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.beginValue),e.yG2(2),e.E7m("matDatepicker",t)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate)),e.yG2(4),e.cNF(e.kDX(14,29,"igo.geo.timeFilter.endYear")),e.yG2(2),e._6D("value",n.onlyYearEnd),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",i)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.endValue),e.yG2(2),e.E7m("matDatepicker",i)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate)),e.yG2(3),e.E7m("matTooltip",e.kDX(23,31,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),e.yG2(3),e.cNF(n.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(27,33,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function wo(l,f){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function ti(l,f){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Ho(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),g=e.GaO(2);return e.CGJ(g.changeTemporalProperty(n.value,1))}),e.yuY(6,wo,2,2,"mat-option",34),e.C$Y()(),e.I0R(7,"mat-form-field",35)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),g=e.GaO(2);return e.CGJ(g.changeTemporalProperty(n.value,1))}),e.yuY(12,ti,2,2,"mat-option",34),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.beginHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.beginMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginMinutes)}}function Ri(l,f){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function To(l,f){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Eo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),g=e.GaO(3);return e.CGJ(g.changeTemporalProperty(n.value,2))}),e.yuY(6,Ri,2,2,"mat-option",34),e.C$Y()(),e.I0R(7,"mat-form-field",35)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),g=e.GaO(3);return e.CGJ(g.changeTemporalProperty(n.value,2))}),e.yuY(12,To,2,2,"mat-option",34),e.C$Y()()()}if(2&l){const t=e.GaO(4);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.endHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.endMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endMinutes)}}function so(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",23)(1,"mat-form-field",24),e.wR5(2,"mat-datepicker-toggle",12),e.I0R(3,"input",25,37),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(4),g=e.GaO(3);return e.CGJ(g.changeTemporalProperty(n.value,2))}),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"span",27),e.I0R(7,"mat-datepicker",28,17),e.qCj("yearSelected",function(n){e.usT(t);const g=e.Gew(8),b=e.GaO(3);return e.CGJ(b.yearSelected(n,g,"end"))})("monthSelected",function(n){e.usT(t);const g=e.Gew(8),b=e.GaO(3);return e.CGJ(b.monthSelected(n,g,"end"))}),e.C$Y()(),e.yuY(9,Eo,13,12,"div",29),e.C$Y()}if(2&l){const t=e.Gew(8),i=e.GaO(3);e.yG2(2),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",i.filterEndFunction)("value",i.endValue?i.endValue:i.handleDate(i.datasource.options.maxDate))("min",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("max",i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.endValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType())}}function to(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",22)(1,"div",23)(2,"mat-form-field",24),e.wR5(3,"mat-datepicker-toggle",12),e.I0R(4,"input",25,26),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(5),g=e.GaO(2);return e.CGJ(g.changeTemporalProperty(n.value,1))}),e.wVc(6,"translate"),e.C$Y(),e.wR5(7,"span",27),e.I0R(8,"mat-datepicker",28,14),e.qCj("yearSelected",function(n){e.usT(t);const g=e.Gew(9),b=e.GaO(2);return e.CGJ(b.yearSelected(n,g,"begin"))})("monthSelected",function(n){e.usT(t);const g=e.Gew(9),b=e.GaO(2);return e.CGJ(b.monthSelected(n,g,"begin"))}),e.C$Y()(),e.yuY(10,Ho,13,12,"div",29),e.C$Y(),e.yuY(11,so,10,15,"div",30),e.I0R(12,"div",19)(13,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(14,"translate"),e.I0R(15,"mat-icon"),e.OEk(16),e.C$Y()(),e.I0R(17,"mat-slide-toggle",21),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(18,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(9),i=e.GaO(2);e.yG2(3),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",i.filterBeginFunction)("value",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("min",i.handleDate(i.datasource.options.minDate))("max",i.endValue&&!i.restrictedToStep()?i.endValue:i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.beginValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType()),e.yG2(),e.E7m("ngIf",!i.restrictedToStep()),e.yG2(2),e.E7m("matTooltip",e.kDX(14,21,"igo.geo.filter.resetFilters"))("disabled",i.filterStateDisable),e.yG2(3),e.cNF(i.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(18,23,"igo.geo.filter.toggleFilterState"))("checked",!i.filterStateDisable)}}function Mt(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,pt,28,35,"div",7)(2,to,19,25,"div",8),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.calendarTypeYear),e.yG2(),e.E7m("ngIf","year"!==t.calendarType())}}let _o=(()=>{class l{ogcFilterTimeService;datasource;currentFilter;changeProperty=new e._w7;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new Z.yM;beginMinuteFormControl=new Z.yM;endHourFormControl=new Z.yM;endMinuteFormControl=new Z.yM;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=Q.e;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;filterOriginConfig;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=Ze().duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(t){this.ogcFilterTimeService=t}ngOnInit(){this.filterOriginConfig=this.datasource.options.ogcFilters.filters,this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const i=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const n=parseInt(t.substring(t.indexOf("+")+1,i.index),10);return Ze()().add(n,i[0]).toDate()}if(t.match(/\-/)){const n=parseInt(t.substring(t.indexOf("-")+1,i.index),10);return Ze()().subtract(n,i[0]).toDate()}return new Date}if(t.search("today")>=0){const i=Ze()().endOf("day").toDate(),n=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const g=parseInt(t.substring(t.indexOf("+")+1,n.index),10);return Ze()(i).add(g,n[0]).toDate()}if(t.match(/\-/)){const g=parseInt(t.substring(t.indexOf("-")+1,n.index),10);return Ze()(i).subtract(g,n[0]).toDate()}return i}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,i,n=!0){"string"==typeof t&&(t=new Date(t));let g=this.getDateTime(t,i);if(this.isCalendarYearMode()){let b;return 1===i?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),b=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),b=`${this.onlyYearEnd}-01-01`),void this.changeProperty.next({value:b,pos:i,refreshFilter:n})}2===i&&"date"===this.calendarType()&&!this.sliderMode&&(g=Ze()(g).endOf("day").toDate()),1===i?(this.beginValue=g,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(g,this.stepMilliseconds),2,n)):this.endValue=g,this.updateHoursMinutesArray(),this.changeProperty.next({value:g.toISOString(),pos:i,refreshFilter:n})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,i,n){const b=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(b,i,n)}yearSelected(t,i,n,g=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(i&&i.close(),"end"===n?t=Ze()(t).endOf("year").toDate():"begin"===n&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,g))}monthSelected(t,i,n,g=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(i&&i.close(),"end"===n?t=Ze()(t).endOf("month").toDate():"begin"===n&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,g))}calendarView(){const t=this.stepMilliseconds,i=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&i<864e5?"clock":"month"}dateFilter(t,i){const n=new Date(i),g=n.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const b=Ze()(n).diff(Ze()(this.handleMin()),"years",!0);if("end"===t){const B=Ze()(n).add(1,"d"),pe=Ze()(B).diff(Ze()(this.handleMin()),"years",!0);return void(this.filterEndFunction=pe%Ze().duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=b%Ze().duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const b=Ze()(n).diff(Ze()(this.handleMin()),"months",!0);if("end"===t){const B=Ze()(n).add(1,"d"),pe=Ze()(B).diff(Ze()(this.handleMin()),"months",!0);return void(this.filterEndFunction=pe%Ze().duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=b%Ze().duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const b=Ze()(n).diff(Ze()(this.handleMin()),"weeks",!0);if("end"===t){const B=Ze()(n).add(1,"d"),pe=Ze()(B).diff(Ze()(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=pe%Ze().duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=b%Ze().duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const b=Ze()(n).diff(Ze()(this.handleMin()),"days",!0);if("end"===t){const B=Ze()(n).add(1,"d"),fe=Ze()(B).diff(Ze()(this.handleMin()),"days",!0)%Ze().duration(this.step).asDays();return void(this.filterEndFunction=fe<1e-7&&fe>-1e-7||0===fe)}if("begin"===t){const B=b%Ze().duration(this.step).asDays()+1;return void(this.filterBeginFunction=B<1e-7&&B>-1e-7&&0!==B||1===B)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const b=Ze()(n).diff(Ze()(this.handleMin()),"hours",!0);return void(this.filterEndFunction=b%Ze().duration(this.step).asHours()==0)}if("begin"===t){const b=Ze()(n).diff(Ze()(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=b%Ze().duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=g%this.stepMilliseconds==0,this.filterBeginFunction=g%this.stepMilliseconds==0}getDateTime(t,i){const n=new Date(t);let g;if(!this.sliderMode)switch(i){case 1:if(this.currentFilter.calendarModeYear){g=n.setHours(0,0);break}g=n.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){g=n.setHours(0,0);break}g=n.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(g||n)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(i,n)=>this.beginHourFormControl.value+n*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(i,n)=>this.beginMinuteFormControl.value+n*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),i=new Date(this.endValue);t.setHours(0,0)===i.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let i,n="01",g="01";if(10===t.length){const b=t.split("-");if(3!==b.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");i=b[0],n=b[1],g=b[2]}else{if(4!==t.length)return new Date(t);i=t}return new Date(`${i}-${n}-${g} 00:00:00`)}resetFilter(){let t,i,n,g;this.calendarTypeYear?(g="today"===this.filterOriginConfig.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${this.filterOriginConfig.end.substring(0,4)}-01-01`,n=`${this.filterOriginConfig.begin.substring(0,4)}-01-01`,t=this.getDateFromStringWithoutTime(n),i=this.getDateFromStringWithoutTime(g)):(t=this.parseFilter(this.filterOriginConfig.begin),i=this.parseFilter(this.filterOriginConfig.end),n=t.toISOString(),g=i.toISOString()),(this.currentFilter.begin!==n||this.currentFilter.end!==g)&&(this.beginValue=t,this.endValue=i,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}static \u0275fac=function(i){return new(i||l)(e.GI1(Io))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time"]],viewQuery:function(i,n){if(1&i&&(e.CC$($o,5),e.CC$(Ao,5),e.CC$(No,5),e.CC$(pi,5)),2&i){let g;e.wto(g=e.Gqi())&&(n.endDatepickerTime=g.first),e.wto(g=e.Gqi())&&(n.beginDatepickerTime=g.first),e.wto(g=e.Gqi())&&(n.beginTime=g.first),e.wto(g=e.Gqi())&&(n.endTime=g.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([Io,(0,Pt.CA)()]),e.UHJ],decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"],["end",""]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,no,3,4,"mat-slide-toggle",1)(2,ro,2,4,"div",2)(3,Mt,3,2,"div",3),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",null==n.currentFilter.sliderOptions?null:n.currentFilter.sliderOptions.enabled),e.yG2(),e.E7m("ngIf",n.sliderMode),e.yG2(),e.E7m("ngIf",!n.sliderMode))},dependencies:[o.u_,ut.GE,ut.cP,Z.y,Z.ue,Z._G,eo,ve.wb,ve.Up,ve.w5,ve.Gm,yt.cN,yt.yi,xt.iU,xt.SU,xt.Ul,xt.yu,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,ye.d5,ye.kX,ne.I5,Z.sl,Z.ug,o.Iw,ne.Ax,C._s,G.sD],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]})}return l})();function ko(l,f){if(1&l&&(e.I0R(0,"mat-option",23),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.alias)("id",t.name)("matTooltip",t.alias),e.yG2(),e.oRS(" ",t.alias," ")}}function Bo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearSelectedField())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Jt(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",17),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectField")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",18),e.qCj("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.updateFieldsList(n.target.value))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.wVc(4,"async"),e.wVc(5,"async"),e.wVc(6,"async"),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-autocomplete",19,20),e.qCj("optionSelected",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeField(n.option.id))}),e.yuY(10,ko,2,4,"mat-option",21),e.wVc(11,"async"),e.C$Y(),e.yuY(12,Bo,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(9),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.sourceFields.selectField"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value",e.kDX(3,10,i.selectedField$)?e.kDX(4,12,i.selectedField$).alias:"")("matTooltip",e.kDX(5,14,i.selectedField$)?e.kDX(6,16,i.selectedField$).alias:e.kDX(7,18,"igo.geo.sourceFields.selectField")),e.yG2(9),e.E7m("ngForOf",e.kDX(11,20,i.filteredFields$)),e.yG2(2),e.E7m("ngIf",i.currentFilter.propertyName&&"selectField"===i.inputClearable&&i.currentFilter.active)}}function Uo(l,f){if(1&l&&(e.I0R(0,"mat-option",4),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key)("matTooltip",e.kDX(1,3,"igo.geo.operators.tooltip."+t.key)),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.operators."+t.key)," ")}}function xo(l,f){if(1&l&&(e.I0R(0,"mat-option",28),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.type),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function Yo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",25)(1,"mat-select",26),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeSpatialSelector(n.value))}),e.yuY(2,xo,3,4,"mat-option",27),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.yG2(),e.E7m("ngForOf",t.igoSpatialSelectors)}}function Yt(l,f){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function Mo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Vo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",29),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",18),e.qCj("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.updateValuesList(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,30),e.qCj("optionSelected",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeProperty(n.option.value))}),e.yuY(5,Yt,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,Mo,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","expression"===i.detectProperty()?i.currentFilter.expression:i.currentFilter.pattern)("matTooltip","expression"===i.detectProperty()?i.currentFilter.expression||"":i.currentFilter.pattern||""),e.yG2(4),e.E7m("ngForOf",e.kDX(6,10,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable()&&"selectProperty"===i.inputClearable&&i.currentFilter.active)}}function we(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.currentFilter.igoSNRC="")}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function qe(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",33),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectSNRC")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",34),e.qCj("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeSNRC(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,we,3,1,"button",22),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("floatLabel",t.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.yG2(2),e.E7m("ngIf",t.currentFilter.igoSNRC)}}function be(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.changeMapExtentGeometry())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"zoom_out_map"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.kDX(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function De(l,f){if(1&l&&(e.SAx(0),e.yuY(1,be,4,5,"button",35),e.k70()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function $e(l,f){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function dt(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(1))}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Qt(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",37),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty1")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",38),e.qCj("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.updateValuesList(n.target.value,1))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,39),e.qCj("optionSelected",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeNumericProperty(n.option.value,1))}),e.yuY(5,$e,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,dt,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===i.detectProperty(1)?i.currentFilter.lowerBoundary:i.currentFilter.begin),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(1)&&"selectProperty1"===i.inputClearable&&i.currentFilter.active)}}function Do(l,f){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function mi(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(2))}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Li(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",37),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty2")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",38),e.qCj("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.updateValuesList(n.target.value,2))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,40),e.qCj("optionSelected",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeNumericProperty(n.option.value,2))}),e.yuY(5,Do,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,mi,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===i.detectProperty(2)?i.currentFilter.upperBoundary:i.currentFilter.end),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(2)&&"selectProperty2"===i.inputClearable&&i.currentFilter.active)}}function mo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-ogc-filter-time",41),e.qCj("changeProperty",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeProperty(n.value,n.pos))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}const en=(l,f)=>({logical:l,logicalHidden:f}),gi=(l,f)=>({operator:l,dualInput:f}),tn=()=>["expression","pattern"],Oe=()=>["lowerBoundary","begin"],ce=()=>["upperBoundary","end"];let te=(()=>{class l{wktService;ogcFilterOperator=Q.e;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new ue.g(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new ue.g(void 0);fields$=new ue.g([]);color="primary";disabled;currentFilterIsSpatial$=new ue.g(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new z.S).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(t){this.wktService=t,this.allOgcFilterOperators=(new z.S).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(i=>void 0===i.excludeFromOgcFilters||!i.excludeFromOgcFilters);t.map(i=>{i.values&&i.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,Ve.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(i=>i.name===t)&&this.changeField(t)}updateValuesList(t,i){this.filteredValues$=(0,Ve.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,i)}_filterFields(t){const i=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(n=>i.test(n.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const i=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value?.values?.filter(n=>n&&i.test(n.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]}clearProperty(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(i=>i.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(i=>i.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,i,n=!0){const g=this.detectProperty(i);g&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(b=>b.filterid===this.currentFilter.filterid)[g]=t,n&&this.refreshFilters())}changeNumericProperty(t,i){this.changeProperty(parseFloat(t),i)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid)&&(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)&&("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case Q.e.PropertyIsNotEqualTo:case Q.e.PropertyIsEqualTo:case Q.e.PropertyIsGreaterThan:case Q.e.PropertyIsGreaterThanOrEqualTo:case Q.e.PropertyIsLessThan:case Q.e.PropertyIsLessThanOrEqualTo:return"expression";case Q.e.PropertyIsLike:return"pattern";case Q.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case Q.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[Q.e.Contains,Q.e.Intersects,Q.e.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(i){return new(i||l)(e.GI1(ei))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},standalone:!0,features:[e.UHJ],decls:44,vars:76,consts:[[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-checkbox",1),e.qCj("click",function(b){return b.stopPropagation()})("change",function(b){return n.toggleFilterState(b)}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-form-field",2)(4,"mat-select",3),e.qCj("selectionChange",function(b){return n.changeLogical(b.value)}),e.wVc(5,"translate"),e.I0R(6,"mat-option",4),e.wVc(7,"translate"),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.I0R(10,"mat-option",4),e.wVc(11,"translate"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()(),e.yuY(14,Jt,13,22,"mat-form-field",5),e.wVc(15,"async"),e.wVc(16,"async"),e.wVc(17,"async"),e.wVc(18,"async"),e.I0R(19,"mat-form-field",6),e.wVc(20,"async"),e.wVc(21,"async"),e.I0R(22,"mat-select",7),e.qCj("selectionChange",function(b){return n.changeOperator(b.value)}),e.wVc(23,"translate"),e.wVc(24,"translate"),e.yuY(25,Uo,4,7,"mat-option",8),e.wVc(26,"keyvalue"),e.wVc(27,"async"),e.C$Y()(),e.yuY(28,Yo,3,3,"mat-form-field",9),e.wVc(29,"async"),e.yuY(30,Vo,8,12,"mat-form-field",10),e.I0R(31,"div",11)(32,"button",12),e.qCj("click",function(){return n.deleteFilter()}),e.wVc(33,"translate"),e.I0R(34,"mat-icon"),e.OEk(35,"delete"),e.C$Y()()(),e.yuY(36,qe,4,7,"mat-form-field",13),e.wVc(37,"async"),e.yuY(38,De,2,1,"ng-container",14),e.wVc(39,"async"),e.C$Y(),e.I0R(40,"div",0),e.yuY(41,Qt,8,11,"mat-form-field",15)(42,Li,8,11,"mat-form-field",15),e.C$Y(),e.yuY(43,mo,1,2,"igo-ogc-filter-time",16)),2&i&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,27,"igo.geo.filter.toggleFilterState"))("checked",n.currentFilter.active),e.yG2(2),e.E7m("ngClass",e.IBC(67,en,0!==n.activeFilters.indexOf(n.currentFilter)&&!0===n.currentFilter.active,0===n.activeFilters.indexOf(n.currentFilter)||!0!==n.currentFilter.active)),e.yG2(),e.E7m("disabled",!n.currentFilter.active)("value",n.currentFilter.parentLogical)("matTooltip",n.currentFilter.parentLogical?e.kDX(5,29,"igo.geo.operators.tooltip."+n.currentFilter.parentLogical):""),e.yG2(2),e.E7m("value",n.ogcFilterOperator.And)("matTooltip",e.kDX(7,31,"igo.geo.operators.tooltip.And")),e.yG2(2),e.oRS(" ",e.kDX(9,33,"igo.geo.operators.And")," "),e.yG2(2),e.E7m("value",n.ogcFilterOperator.Or)("matTooltip",e.kDX(11,35,"igo.geo.operators.tooltip.Or")),e.yG2(2),e.oRS(" ",e.kDX(13,37,"igo.geo.operators.Or")," "),e.yG2(2),e.E7m("ngIf",!1===e.kDX(15,39,n.currentFilterIsSpatial$)&&e.kDX(16,41,n.fields$)&&e.kDX(17,43,n.fields$).length>0&&""!==e.kDX(18,45,n.fields$)[0].name),e.yG2(5),e.E7m("ngClass",e.IBC(70,gi,!1===e.kDX(20,47,n.currentFilterIsSpatial$),e.kDX(21,49,n.currentFilterIsSpatial$)))("floatLabel",n.floatLabel),e.yG2(3),e.E7m("matTooltip",n.currentFilter.operator?e.kDX(23,51,"igo.geo.operators.tooltip."+n.currentFilter.operator):e.kDX(24,53,"igo.geo.filter.selectOperator"))("disabled",!n.currentFilter.active)("value",n.currentFilter.operator),e.yG2(3),e.E7m("ngForOf",e.kDX(26,55,e.kDX(27,57,n.ogcFilterOperators$))),e.yG2(3),e.E7m("ngIf",e.kDX(29,59,n.currentFilterIsSpatial$)),e.yG2(2),e.E7m("ngIf",-1!==e.q4q(73,tn).indexOf(n.detectProperty())),e.yG2(2),e.E7m("matTooltip",e.kDX(33,61,"igo.geo.filter.removeFilter")),e.yG2(4),e.E7m("ngIf",e.kDX(37,63,n.currentFilterIsSpatial$)&&"snrc"===n.currentFilter.igoSpatialSelector),e.yG2(2),e.E7m("ngIf",e.kDX(39,65,n.currentFilterIsSpatial$)&&"fixedExtent"===n.currentFilter.igoSpatialSelector),e.yG2(3),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(74,Oe).indexOf(n.detectProperty(1))),e.yG2(),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(75,ce).indexOf(n.detectProperty(2))),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[me.Vn,me.WK,_.KO,_.a4,ve.wb,ve.Up,ve.Gm,o.QF,ye.d5,ye.kX,ne.I5,ne.Ax,o.u_,yt.cN,yt.yi,Kt.U1,Kt.e,Kt.cG,o.Iw,R.oJ,R.um,L.oB,L.qL,_o,o.a,o.uq,C._s,G.sD],styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var re=r(35392),he=r(24296),Me=r(21232),Xe=r(39732);let tt=(()=>{class l{http;constructor(t){this.http=t}getDom(t){var i=this;return(0,re.c)(function*(){const n=t.url;let g;return yield i.http.get(n).pipe((0,d.k)(b=>(g=b,b)),(0,Ge.a)(b=>(0,Xe.c)(b))).toPromise(),g})()}static \u0275fac=function(i){return new(i||l)(e.CoB(u.KK))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Tt=r(21296),vt=r(24112);const Co=["selection"];function bn(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function hi(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO(3);return e.kNx(g.currentPushButtonsGroup,n)||(g.currentPushButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,bn,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentPushButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getPushButtonsGroups())}}function Gi(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-button-toggle",16),e.qCj("change",function(){const g=e.usT(t).$implicit,b=e.GaO(3).$implicit,B=e.GaO();return e.CGJ(B.onSelectionChange(g,b.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("ngStyle",i.getButtonColor(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function go(l,f){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-button-toggle-group",14),e.yuY(4,Gi,2,5,"mat-button-toggle",15),e.C$Y(),e.k70()),2&l){const t=f.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(),e._6D("vertical",i.bundleIsVertical(t)),e.yG2(),e.E7m("ngForOf",t.selectors)}}function $i(l,f){if(1&l&&(e.I0R(0,"div",8),e.wR5(1,"mat-divider"),e.yuY(2,hi,5,5,"div",9)(3,go,5,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getPushButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function Ai(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function ki(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO(3);return e.kNx(g.currentCheckboxesGroup,n)||(g.currentCheckboxesGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Ai,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentCheckboxesGroup),e.yG2(2),e.E7m("ngForOf",t.getCheckboxesGroups())}}function On(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",21),e.qCj("change",function(){const g=e.usT(t).$implicit,b=e.GaO(3).$implicit,B=e.GaO();return e.CGJ(B.onSelectionChange(g,b.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function In(l,f){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function wn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function jo(l,f){if(1&l&&(e.I0R(0,"p"),e.yuY(1,In,3,3,"u",22)(2,wn,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"checkbox"))}}function on(l,f){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",19),e.yuY(4,On,2,4,"mat-checkbox",20),e.C$Y(),e.yuY(5,jo,3,2,"p",2),e.k70()),2&l){const t=f.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")||i.isMoreResults(t,"checkbox"))}}function Bi(l,f){if(1&l&&(e.I0R(0,"div",17),e.wR5(1,"mat-divider"),e.yuY(2,ki,5,5,"div",9)(3,on,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getCheckboxesGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function fi(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Fo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO(3);return e.kNx(g.currentRadioButtonsGroup,n)||(g.currentRadioButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,fi,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentRadioButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getRadioButtonsGroups())}}function er(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",30),e.qCj("change",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyRadioButtons())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}2&l&&(e.E7m("matTooltip",e.kDX(1,2,"igo.geo.filter.resetFilters")),e.yG2(2),e.oRS("",e.kDX(3,4,"igo.geo.filter.resetFilters")," "))}function vo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",21),e.qCj("change",function(){const g=e.usT(t).$implicit,b=e.GaO(3).$implicit,B=e.GaO();return e.CGJ(B.onSelectionChange(g,b.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function Tn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function En(l,f){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function xn(l,f){if(1&l&&(e.I0R(0,"p"),e.yuY(1,Tn,3,3,"u",22)(2,En,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"radio"))}}function Mn(l,f){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-radio-group",28),e.yuY(4,er,4,6,"mat-radio-button",29)(5,vo,2,4,"mat-radio-button",20)(6,xn,3,2,"p",2),e.C$Y(),e.k70()),2&l){const t=f.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")||i.isMoreResults(t,"radio"))}}function Dn(l,f){if(1&l&&(e.I0R(0,"div",26),e.wR5(1,"mat-divider"),e.yuY(2,Fo,5,5,"div",9)(3,Mn,7,4,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getRadioButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function yi(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function zo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO(3);return e.kNx(g.currentSelectGroup,n)||(g.currentSelectGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,yi,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentSelectGroup),e.yG2(2),e.E7m("ngForOf",t.getSelectGroups())}}function _i(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptySelect())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"filter_alt_off"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}const So=()=>({standalone:!0});function oi(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",41),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(5);return e.kNx(g.selectAllSelected,n)||(g.selectAllSelected=n),e.CGJ(n)}),e.qCj("change",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.toggleAllSelection())}),e.OEk(1,"Tous "),e.C$Y()}if(2&l){const t=e.GaO(5);e.OKB("ngModel",t.selectAllSelected),e.E7m("ngModelOptions",e.q4q(2,So))}}function Ci(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",42),e.qCj("onSelectionChange",function(n){e.usT(t);const g=e.GaO(2).$implicit,b=e.GaO(3);return e.CGJ(b.selectOptionClick(n.source.value,g,n))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function ii(l,f){if(1&l&&(e.I0R(0,"div")(1,"mat-select",37,38)(3,"div",19),e.yuY(4,oi,2,3,"mat-checkbox",39),e.C$Y(),e.yuY(5,Ci,2,3,"mat-option",40),e.C$Y()()),2&l){const t=e.GaO().$implicit;e.yG2(),e.E7m("multiple",t.multiple)("placeholder",t.title),e.yG2(3),e.E7m("ngIf",t.multiple),e.yG2(),e.E7m("ngForOf",t.selectors)}}function Xo(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",42),e.qCj("onSelectionChange",function(n){e.usT(t);const g=e.GaO(2).$implicit,b=e.GaO(3);return e.CGJ(b.selectOptionClick(n.source.value,g))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function Fn(l,f){if(1&l&&(e.I0R(0,"mat-select",43),e.yuY(1,Xo,2,3,"mat-option",40),e.C$Y()),2&l){const t=e.GaO().$implicit;e.E7m("placeholder",t.title),e.yG2(),e.E7m("ngForOf",t.selectors)}}function Pn(l,f){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,_i,4,3,"mat-button",33),e.I0R(5,"mat-form-field"),e.yuY(6,ii,6,4,"div",34)(7,Fn,2,2,"ng-template",null,35,e.gJz),e.C$Y()(),e.k70()),2&l){const t=f.$implicit,i=e.Gew(8);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered&&!t.multiple),e.yG2(),e.m4B("width",t.width?t.width:void 0,"%"),e.yG2(),e.E7m("ngIf",t.multiple)("ngIfElse",i)}}function Rn(l,f){if(1&l&&(e.I0R(0,"div",31),e.wR5(1,"mat-divider"),e.yuY(2,zo,5,5,"div",9)(3,Pn,9,6,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getSelectGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentSelectGroup.computedSelectors)}}function Ln(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Gn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",45),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO(3);return e.kNx(g.currentAutocompleteGroup,n)||(g.currentAutocompleteGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Ln,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentAutocompleteGroup),e.yG2(2),e.E7m("ngForOf",t.getAutocompleteGroups())}}function $n(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyAutocomplete())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"filter_alt_off"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}function Nt(l,f){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.value," ")}}function An(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field"),e.wR5(1,"input",47,48),e.I0R(3,"mat-autocomplete",49,50),e.qCj("optionSelected",function(n){e.usT(t);const g=e.GaO(4);return e.CGJ(g.autocompleteOptionClick(n.option.value))}),e.yuY(6,Nt,2,2,"mat-option",12),e.wVc(7,"async"),e.C$Y()()}if(2&l){const t=e.Gew(4),i=e.GaO().$implicit,n=e.GaO(3);e.m4B("width",i.width?i.width:void 0,"%"),e.yG2(),e.E7m("matAutocomplete",t)("placeholder",i.title),e.yG2(2),e.E7m("displayWith",n.displayFn),e.yG2(3),e.E7m("ngForOf",e.kDX(7,6,n.filteredOgcAutocomplete[i.id]))}}function kn(l,f){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,$n,4,3,"mat-button",33)(5,An,8,8,"mat-form-field",46),e.C$Y(),e.k70()),2&l){const t=f.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngIf",i.filteredOgcAutocomplete[t.id])}}function Bn(l,f){if(1&l&&(e.I0R(0,"div",44),e.wR5(1,"mat-divider"),e.yuY(2,Gn,5,5,"div",9)(3,kn,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getAutocompleteGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function Un(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,$i,4,2,"div",3)(2,Bi,4,2,"div",4)(3,Dn,4,2,"div",5)(4,Rn,4,2,"div",6)(5,Bn,4,2,"div",7),e.C$Y()),2&l){const t=f.$implicit;e.yG2(),e.E7m("ngIf","pushButton"===t.selectorType),e.yG2(),e.E7m("ngIf","checkbox"===t.selectorType),e.yG2(),e.E7m("ngIf","radioButton"===t.selectorType),e.yG2(),e.E7m("ngIf","select"===t.selectorType),e.yG2(),e.E7m("ngIf","autocomplete"===t.selectorType)}}function Ui(l,f){1&l&&(e.I0R(0,"h3"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.reportingDate")," "))}function nn(l,f){if(1&l&&(e.I0R(0,"h3"),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.currentFilter.title)}}function ni(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div"),e.wR5(1,"mat-divider"),e.yuY(2,Ui,3,3,"h3",2)(3,nn,2,1,"h3",2),e.I0R(4,"igo-ogc-filter-time",51),e.qCj("changeProperty",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeProperty(n.value,n.pos))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",!t.currentFilter.title),e.yG2(),e.E7m("ngIf",t.currentFilter.title),e.yG2(),e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}let rn=(()=>{class l{ogcFilterService;formBuilder;domService;configService;cdRef;sel;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(t){this._currentFilter=t,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;ogcFilterOperator=Q.e;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new ue.g(void 0);selectEnableds$=new ue.g([]);autocompleteEnabled$=new ue.g(void 0);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){const t=[];return this.datasource?.options?.ogcFilters?.pushButtons&&t.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&t.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&t.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&t.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&t.push(this.datasource?.options?.ogcFilters?.autocomplete),t.sort((i,n)=>i.order<n.order?-1:i.order>n.order?1:0),t}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=!!t.includes(n)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnabled(){return this.autocompleteEnabled$.value}set autocompleteEnabled(t){this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n.title})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}constructor(t,i,n,g,b){this.ogcFilterService=t,this.formBuilder=i,this.domService=n,this.configService=g,this.cdRef=b,this.ogcFilterWriter=new z.S,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:["",[Z.AQ.required]],radioButtons:["",[Z.AQ.required]],pushButtonsGroup:["",[Z.AQ.required]],checkboxesGroup:["",[Z.AQ.required]],radioButtonsGroup:["",[Z.AQ.required]],selectGroup:["",[Z.AQ.required]],select:["",[Z.AQ.required]],selectMulti:["",[Z.AQ.required]],autocompleteGroup:["",[Z.AQ.required]],autocomplete:["",[Z.AQ.required]]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){var t=this;return(0,re.c)(function*(){t.datasource.options.ogcFilters&&(t.datasource.options.ogcFilters.pushButtons&&(t.currentPushButtonsGroup=t.datasource.options.ogcFilters.pushButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.pushButtons.groups[0]),t.datasource.options.ogcFilters.checkboxes&&(t.currentCheckboxesGroup=t.datasource.options.ogcFilters.checkboxes.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.checkboxes.groups[0]),t.datasource.options.ogcFilters.radioButtons&&(t.currentRadioButtonsGroup=t.datasource.options.ogcFilters.radioButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.radioButtons.groups[0]),t.datasource.options.ogcFilters.select&&(t.currentSelectGroup=t.datasource.options.ogcFilters.select.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.select.groups[0],t.getSelectEnabled(),yield t.getSelectDomValues()),t.datasource.options.ogcFilters.autocomplete&&(t.currentAutocompleteGroup=t.datasource.options.ogcFilters.autocomplete.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.autocomplete.groups[0],t.getAutocompleteEnabled(),yield t.getAutocompleteDomValues()),t.applyFilters()),t.form.get("pushButtonsGroup").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.onPushButtonsChangeGroup(),t.applyFilters()}),t.form.get("checkboxesGroup").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.onCheckboxesChangeGroup(),t.applyFilters()}),t.form.get("radioButtonsGroup").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.onRadioButtonsChangeGroup(),t.applyFilters()}),t.form.get("selectGroup").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.onSelectChangeGroup(),t.applyFilters()}),t.form.get("autocompleteGroup").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.onAutocompleteChangeGroup(),t.applyFilters()}),t.form.get("pushButtons").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.applyFilters()}),t.form.get("radioButtons").valueChanges.pipe((0,vt.o)(750)).subscribe(()=>{t.applyFilters()})})()}getSelectEnabled(){const t=[];let i;this.currentSelectGroup.computedSelectors.forEach(n=>{n.multiple?(n.selectors?.forEach(g=>{g.enabled&&t.push(g)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(n.selectors?.forEach(g=>{g.enabled&&(i=g)}),this.form.controls.select.reset(i),this.selectEnabled$.subscribe(g=>{this.form.controls.select.value!==g&&this.form.controls.select.setValue(g)}),this.selectEnabled=i)})}getAutocompleteEnabled(){let t;this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled&&(t=n.title,this.form.controls.autocomplete.setValue({id:n.filters.expression,value:n.title}))}),this.autocompleteEnabled=t})}getToolTip(t){let i;return t.tooltip&&(i=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),i||""}getSelectDomValues(){var t=this;return(0,re.c)(function*(){for(const i of t.datasource.options.ogcFilters.select.bundles)if(i.domSelectors){let n;for(const g of i.domSelectors){let b;for(const B of t.configService.getConfig("dom"))(g.id===B.id||g.name===B.name)&&(b={id:B.id,url:B.url,name:B.name,values:B.values});if(n=b.url?yield t.domService.getDom(b):b.values,n){let pe,B=i;B.selectors=[];for(const fe of n){if(i.multiple){let Fe;Fe=!!t.selectEnableds?.find(Ee=>Ee.title===fe.value),pe={title:fe.value,enabled:Fe,filters:{operator:g.operator,propertyName:g.propertyName,expression:fe.id}}}else pe={title:fe.value,enabled:t.selectEnabled?.title===fe.value,filters:{operator:g.operator,propertyName:g.propertyName,expression:fe.id}};B.selectors.push(pe)}t.getSelectGroups().find(fe=>fe.ids.includes(B.id)).computedSelectors.find(fe=>fe.title===B.title).selectors=B.selectors}}t.getSelectEnabled()}})()}getAutocompleteDomValues(){var t=this;return(0,re.c)(function*(){for(const i of t.datasource.options.ogcFilters.autocomplete.bundles)if(i.domSelectors){let n;for(const g of i.domSelectors){let b;for(const B of t.configService.getConfig("dom"))(g.id===B.id||g.name===B.name)&&(b={id:B.id,url:B.url,name:B.name,values:B.values});if(n=b.url?yield t.domService.getDom(b):b.values,n){let pe,B=i;B.selectors=[];for(const fe of n)pe={title:fe.value,enabled:!(!t.autocompleteEnabled||t.autocompleteEnabled!==fe.value),filters:{operator:g.operator,propertyName:g.propertyName,expression:fe.id}},B.selectors.push(pe);t.getAutocompleteGroups().find(fe=>fe.ids.includes(B.id)).computedSelectors.find(fe=>fe.title===B.title).selectors=B.selectors}}t.filteredOgcAutocomplete[i.id]=new Tt._,t.cdRef.detectChanges(),t.filteredOgcAutocomplete[i.id]=t.form.controls.autocomplete.valueChanges.pipe((0,d.k)(g=>{if(g.length)return n?.filter(b=>{const B=g?g.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return b.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(B)})}))}})()}getButtonColor(t){let i;return t.color&&t.enabled&&(i={"background-color":`rgba(${t.color})`}),i}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,i){clearTimeout(this.applyFiltersTimeout),"radioButton"===i&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(i=>i.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{t.push(n)})}),this.sel.options.forEach(i=>i.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,i,n){if(i.multiple){const g=this.selectEnableds;let b=!0;if(this.sel.options.forEach(B=>{B.selected||(b=!1)}),this.selectAllSelected=b,n.isUserInput)if(g.length){for(const B of g)if(B.title===t.title){if(B.enabled&&t.enabled){g.splice(g.indexOf(B),1),this.selectEnableds=g;break}}else if(g.indexOf(B)===g.length-1){g.push(t),this.selectEnableds=g;break}}else g.push(t),this.selectEnableds=g}else this.selectEnabled=t}autocompleteOptionClick(t){this.autocompleteEnabled=t.value}displayFn(t){return t?t.value:void 0}applyFilters(){let t="";const i=[],n=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const g of n)g.computedSelectors&&g.computedSelectors.map(b=>{const B=[];b.selectors?.filter(pe=>!0===pe.enabled).forEach(pe=>B.push(pe.filters)),B.length>=1&&i.push(1===B.length?B[0]:{logical:b.logical,filters:B})});this.isTemporalOperator()&&this._currentFilter.active&&i.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),i.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===i.length?i[0]:{logical:"And",filters:i})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,i){let n=0;for(const b of t.selectors)n++;return n>("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,i){let n=0;for(const b of t.selectors)n++;return this.baseIndex!==("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)&&n>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,i,n=!0){const g=this.detectProperty(i);g&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(b=>b.filterid===this.currentFilter.filterid)[g]=t,n&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case Q.e.PropertyIsNotEqualTo:case Q.e.PropertyIsEqualTo:case Q.e.PropertyIsGreaterThan:case Q.e.PropertyIsGreaterThanOrEqualTo:case Q.e.PropertyIsLessThan:case Q.e.PropertyIsLessThanOrEqualTo:return"expression";case Q.e.PropertyIsLike:return"pattern";case Q.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case Q.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}static \u0275fac=function(i){return new(i||l)(e.GI1(Y),e.GI1(Z.KE),e.GI1(tt),e.GI1(A.aW),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(i,n){if(1&i&&e.CC$(Co,5),2&i){let g;e.wto(g=e.Gqi())&&(n.sel=g.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},standalone:!0,features:[e.M5G([tt]),e.UHJ],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"form",0),e.yuY(1,Un,6,5,"div",1),e.C$Y(),e.yuY(2,ni,5,4,"div",2)),2&i&&(e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngForOf",n.ogcFiltersSelectors),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[Z.y,Z.sz,Z.ot,Z.ue,Z.u,Z._G,Z.sl,Z.uW,Z.Wo,o.Iw,o.u_,_e.U,_e.k,ve.wb,ve.Up,ye.d5,ye.kX,ne.I5,_.KO,_.a4,ne.Ax,he.ue,he.gn,he.KU,o.Qt,me.Vn,me.WK,Me.yk,Me.cv,Me.cT,L.oB,L.qL,yt.cN,yt.yi,Kt.U1,Kt.e,Kt.cG,_o,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}"]})}return l})();function Yn(l,f){if(1&l&&e.wR5(0,"igo-ogc-filter-selection",2),2&l){const t=e.GaO();e.E7m("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function sn(l,f){if(1&l&&e.wR5(0,"igo-ogc-filter-form",4),2&l){const t=f.$implicit,i=e.GaO(2);e.E7m("currentFilter",t)("refreshFilters",i.refreshFunc)("datasource",i.datasource)("map",i.map)}}function tr(l,f){if(1&l&&e.yuY(0,sn,1,4,"ng-template",3),2&l){const t=e.GaO();e.E7m("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let Vn=(()=>{class l{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},standalone:!0,features:[e.M5G([{provide:ye.kF,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:Kt.GE,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}]),e.UHJ],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(i,n){1&i&&e.yuY(0,Yn,1,4,"igo-ogc-filter-selection",0)(1,tr,1,1,null,1),2&i&&(e.E7m("ngIf",!n.advancedOgcFilters),e.yG2(),e.E7m("ngIf",n.advancedOgcFilters&&n.datasource.options.ogcFilters.editable))},dependencies:[o.u_,rn,s.qU,o.Iw,te],styles:[".igo-overlay-panel-width{min-width:-moz-fit-content;min-width:fit-content}\n\n/*# sourceMappingURL=ogc-filterable-form.component.ts-angular-inline--1.css.map*/"]})}return l})();function or(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-icon",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.OEk(1,"expand_less "),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(8);e.E7m("target",i)("collapsed",t.filtersCollapsed)}}const ir=l=>({cursor:l});function nr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"span",11),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(1),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("ngStyle",e.S45(3,ir,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.yG2(),e.oRS(" ",t.layer.title," ")}}function an(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",12),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addFilterToSequence())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"add"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("disabled",t.addFilterDisabled())("matTooltip",e.kDX(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}const jn=l=>({disabled:l});function Kn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",0),e.wVc(4,"async"),e.OEk(5),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,jn,!1===e.kDX(4,8,t.inResolutionRange$))),e.yG2(2),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}function ln(l,f){if(1&l&&e.wR5(0,"igo-layer-legend",17),2&l){const t=e.GaO(2);e.E7m("layer",t.layer)}}function rr(l,f){if(1&l&&(e.I0R(0,"div",14,15),e.yuY(2,ln,1,1,"igo-layer-legend",16),e.wVc(3,"async"),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",e.kDX(3,1,t.showLegend$))}}function sr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"section",18),e.wR5(1,"mat-divider"),e.I0R(2,"mat-checkbox",19),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.changeOgcFilterType(n))}),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.datasource.options.ogcFilters.advancedOgcFilters,n)||(g.datasource.options.ogcFilters.advancedOgcFilters=n),e.CGJ(n)}),e.OEk(3),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.OKB("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.yG2(),e.oRS(" ",e.kDX(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}const ar=l=>({"separate-item":l});let vi=(()=>{class l{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=Q.e.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new ue.g(!1);inResolutionRange$=new ue.g(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(t){this.ogcFilterService=t,this.ogcFilterWriter=new z.S}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(n=>n.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const i=this.datasource.options.ogcFilters.interfaceOgcFilters||[],n=0===i.length?0:i[i.length-1].level;let g="";const b=this.datasource.options.sourceFields.filter(Ee=>!Ee.excludeFromOgcFilters);let B;b.length>0&&(g=void 0===b[0].name?"":b[0].name);const pe=this.datasource.options;pe.fieldNameGeometry?B=pe.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(B=this.datasource.options.paramsWFS.fieldNameGeometry);const fe=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,g,this.datasource.options.ogcFilters.allowedOperatorsType),Fe=Object.keys(fe)[0];i.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:g,operator:Fe,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},B,n,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=i}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const i=this.datasource.options.ogcFilters,n=i.interfaceOgcFilters?i.interfaceOgcFilters.filter(g=>!0===g.active):[];if(0===n.length&&(i.filters=void 0,i.filtered=!1),n.length>1&&(n[0].parentLogical=n[1].parentLogical),this.hasActiveSpatialFilter=0!==n.filter(g=>-1!==["Contains","Intersects","Within"].indexOf(g.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(n)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&i.enabled){let g="";if(n.length>=1){const b=this.layer.dataSource,B=b.options.ogcFilters;B.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),g=this.ogcFilterWriter.buildFilter(B.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,b.options)}this.ogcFilterService.filterByOgc(this.datasource,g),this.datasource.options.ogcFilters.filtered=0!==n.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(n))}this.layer.dataSource.setOgcFilters(i,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(Y))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},standalone:!0,features:[e.M5G([Y]),e.UHJ],decls:12,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"ngModel","change","ngModelChange"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-list-item"),e.yuY(2,or,2,2,"mat-icon",1)(3,nr,2,5,"span",2),e.I0R(4,"div",3),e.yuY(5,an,4,5,"button",4)(6,Kn,6,12,"button",5),e.C$Y()(),e.I0R(7,"div",null,6),e.yuY(9,rr,4,3,"div",7),e.wR5(10,"igo-ogc-filterable-form",8),e.yuY(11,sr,5,4,"section",9),e.C$Y()()),2&i&&(e.E7m("ngClass",e.S45(10,ar,!0===n.header)),e.yG2(2),e.E7m("ngIf",n.header),e.yG2(),e.E7m("ngIf",n.header),e.yG2(2),e.E7m("ngIf",n.isAdvancedOgcFilters()&&n.filtersAreEditable),e.yG2(),e.E7m("ngIf",n.header),e.yG2(3),e.E7m("ngIf",n.header),e.yG2(),e.E7m("datasource",n.datasource)("map",n.map)("refreshFilters",n.refreshFunc),e.yG2(),e.E7m("ngIf",n.hasSelector&&n.filtersAreEditable))},dependencies:[o.QF,de.iI,de.g9,de.Y1,_e.k,de.UV,de.At,o.u_,L.oB,L.qL,le.mK,o.Qt,_.KO,_.a4,R.oJ,R.um,Et,Vn,_e.U,me.Vn,me.WK,Z.y,Z.ue,Z._G,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}"]})}return l})();function Wn(l,f){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.I0R(2,"mat-icon",3),e.OEk(3,"filter_alt"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function cn(l,f){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("map",t.layer.map)("layer",t.layer)}}function Nn(l,f){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,cn,1,3,"igo-ogc-filterable-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let Yi=(()=>{class l{options;get badge(){const t=this.options.ogcFilters;let i=0;if(t&&!t.advancedOgcFilters){if(t.pushButtons){const g=t.pushButtons.groups.find(B=>B.enabled);let b=0;g&&g.computedSelectors?.map(B=>b+=B.selectors?.filter(pe=>pe.enabled).length),i+=b}if(t.checkboxes){const g=t.checkboxes.groups.find(B=>B.enabled);let b=0;g&&g.computedSelectors?.map(B=>b+=B.selectors?.filter(pe=>pe.enabled).length),i+=b}if(t.radioButtons){const g=t.radioButtons.groups.find(B=>B.enabled);let b=0;g&&g.computedSelectors?.map(B=>b+=B.selectors?.filter(pe=>pe.enabled).length),i+=b}if(t.select){const g=t.select.groups.find(B=>B.enabled);let b=0;g&&g.computedSelectors?.map(B=>b+=B.selectors?.filter(pe=>pe.enabled).length),i+=b}if(t.autocomplete){const g=t.autocomplete.groups.find(B=>B.enabled);let b=0;g&&g.computedSelectors?.map(B=>b+=B.selectors?.filter(pe=>pe.enabled).length),i+=b}}else{if(t&&t.filters&&!t.filters.filters)return 1;if(t&&t.filters&&t.filters.filters)return t.filters.filters.length}if(t.filters&&"During"===t.filters.operator&&t.filters.active&&t.interfaceOgcFilters&&t.interfaceOgcFilters[0].active){const n=t.interfaceOgcFilters[0];t.filters.calendarModeYear?(n.begin.substring(0,4)!==this.options.minDate.substring(0,4)||n.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(i+=1):(n.begin!==this.options.minDate||n.end!==this.options.maxDate)&&(i+=1)}return i>0?i:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(i,n){1&i&&e.yuY(0,Wn,4,5,"button",0)(1,Nn,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)),e.yG2(),e.E7m("ngIf",n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)))},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,M.g,M.S,vi,s.qU,C._s,G.sD],changeDetection:0})}return l})(),ri=(()=>{class l{transform(t,i){let n;return"time"===i&&(n=t.filter(g=>{const b=g.dataSource;return this.isTimeFilterable(b)&&void 0!==b.options.timeFilter&&Object.keys(b.options.timeFilter).length})),"ogc"===i&&(n=t.filter(g=>this.isOgcFilterable(g.dataSource))),n}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let i=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(i=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(i=!0),i}static \u0275fac=function(i){return new(i||l)};static \u0275pipe=e.UTH({name:"filterableDataSource",type:l,pure:!0,standalone:!0})}return l})();function Si(l,f){1&l&&(e.I0R(0,"div",3),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.noFilterableLayer")," "))}function un(l,f){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",4),2&l){const t=f.$implicit;e.E7m("header",!0)("layer",t)("map",t.map)}}let bi=(()=>{class l{layers;map;constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},standalone:!0,features:[e.UHJ],decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Si,3,3,"div",1),e.wVc(2,"filterableDataSource"),e.yuY(3,un,1,3,"ng-template",2),e.wVc(4,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngIf",0===e.g7$(2,4,n.layers,"ogc").length),e.yG2(2),e.E7m("ngForOf",e.g7$(4,7,n.layers,"ogc")))},dependencies:[s.yM,o.u_,o.Iw,vi,s.qU,C._s,G.sD,ri],styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0})}return l})();var Jo=r(12268);let Hn=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t.filter(i=>i.showInLayerList)})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(bi,2),e.GI1(Jo.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOgcFilterableListBinding",""]],standalone:!0})}return l})();var lr=r(17469),oe=r(14899),We=r(80956),v=r(72032),V=r(87040),ee=r(54776),Ce=r(87544),Te=r(45212),je=r(88872),nt=r(3544),_t=r(61200),ot=r(28660),gt=function(l){return l.Point="Point",l.LineString="LineString",l.Polygon="Polygon",l.Circle="Circle",l}(gt||{}),rt=function(l){return l.Coordinates="Coordinates",l.Length="Length",l.Area="Area",l.Predefined="Predefined",l.Custom="Custom",l}(rt||{}),ao=function(l){return l.DecimalDegree="DD",l.DegreesMinutesSeconds="DMS",l}(ao||{});let Oi=(()=>{class l{config;icons;constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var lo=r(59324),oo=r(8512);function Vi(l,f,t,i){return new ee.cp({stroke:new Te.c({color:f||"rgba(143,7,7,1)",width:t||1}),fill:new je.c({color:l||"rgba(255,255,255,0.4)"}),image:new Ce.c({radius:5,stroke:new Te.c({color:f||"rgba(143,7,7,1)",width:t||1}),fill:new je.c({color:l||"rgba(255,255,255,0.4)"})})})}function dn(l,f){let i=new Map([[ao.DecimalDegree,n=>{if("number"==typeof n[0])return(0,lo.mC)(n,5);{const g=[Number(n[0]),Number(n[1])];return(0,lo.mC)(g,5)}}],[ao.DegreesMinutesSeconds,n=>(0,lo.G2)(n,2)]]).get(f);return i?i(l):void 0}var ho=r(53291),Po=r(58264),po=r(12396),Qo=r(28668),Ht=r(80848),zt=r(36752),ji=r(28772),pn=r(49412),jr=r(95128),zn=r(83680),Ki=r(68013),Ii=r(90112),Ut=r(76200),Kr=r(70524),Wr=r(17115),wi=r(2892),Vt=(r(89500),r(69904)),ai=function(l){return l.Arial="Arial",l.ArialBlack="Arial Black",l.Verdana="Verdana",l.Tahoma="Tahoma",l.TrebuchetMS="Trebuchet MS",l.Impact="Impact",l.TimesNewRoman="Times New Roman",l.Georgia="Georgia",l.AmericanTypewriter="American Typewriter",l.Courier="Courier",l.LucidaConsole="Lucida Console",l.BrushScriptMT="Brush Script MT",l.ComicSansMS="Comic Sans MS",l}(ai||{}),bt=r(40600),dr=r(23416),pr=r(47080),mn=r(50068);function Hr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",4)(1,"color-chrome",5),e.qCj("onChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.handleChange(n))}),e.C$Y(),e.I0R(2,"div",6)(3,"button",7),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.handleClick(n))}),e.OEk(4),e.wVc(5,"translate"),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("color",t.colorPicker),e.yG2(3),e.oRS(" ",e.kDX(5,2,"igo.common.confirmDialog.applyBtn")," ")}}let mr=(()=>{class l{isOpen=!1;set value(t){this._value=this.formatColor(t??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorChange=new e._w7;colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(t){this.value=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}handleClick(t){t.preventDefault(),t.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(t){this.colorPicker=this.formatColor(t.color.rgb,"rgba"),this.colorChange.emit(this.formatColor(this.colorPicker))}formatColor(t,i=this.outputFormat){switch(i){case"hex":t=(0,mn.c)(t).toHexString();break;case"rgba":default:t=(0,mn.c)(t).toRgbString();break;case"hsla":t=(0,mn.c)(t).toHsvString()}return t}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},outputs:{colorChange:"colorChange"},standalone:!0,features:[e.M5G([{provide:Z.Y6,useExisting:(0,e.wd)(()=>l),multi:!0}]),e.UHJ],decls:6,vars:7,consts:[["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["trigger","cdkOverlayOrigin"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"picker"],[3,"color","onChange"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(i,n){if(1&i&&(e.I0R(0,"mat-form-field",0,1),e.qCj("click",function(){return n.isOpen=!n.isOpen}),e.I0R(2,"mat-label"),e.OEk(3),e.C$Y(),e.wR5(4,"input",2),e.C$Y(),e.yuY(5,Hr,6,4,"ng-template",3),e.qCj("backdropClick",function(){return n.isOpen=!1})),2&i){const g=e.Gew(1);e.yG2(3),e.cNF(n.colorPicker),e.yG2(),e.m4B("background",n.colorPicker),e.E7m("readonly",!0),e.yG2(),e.E7m("cdkConnectedOverlayOrigin",g)("cdkConnectedOverlayOpen",n.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[ve.wb,ve.Up,ve.w5,dr.wW,yt.cN,yt.yi,dr.eC,pr.on,pr.OY,R.oJ,R.Gw,C._s,G.sD],styles:[".picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}"]})}return l})();var gr=r(62632),Ga=r(91088);let Xr=(()=>{class l{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=ai.Arial.toString();offsetX=0;offsetY=0;constructor(){}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,i,n,g,b,B,pe,fe,Fe,Ee){let Ae,Je=!1;t.getGeometry()instanceof Ht.c&&(Je=!Je);const et=n?t.get("draw"):"";t.set("_mapTitle",et);const lt={text:et,stroke:{color:"white",width:.75},fill:{color:"black"},font:g,overflow:!0,offsetX:pe,offsetY:fe};let Ct;if(t.get("rad")){const Bt=(0,y.AF)(t.getGeometry().flatCoordinates,Fe,"EPSG:4326"),uo=t.get("rad")/Math.cos(Math.PI/180*Bt[1])/i;return Ct={text:lt,circle:{radius:uo,stroke:{color:B||this.strokeColor,width:this.strokeWidth},fill:{color:b}}},t.set("_style",Ct),Ae=new ee.cp({text:new gr.c({text:et,stroke:new Te.c({color:"white",width:.75}),fill:new je.c({color:"black"}),font:g,overflow:!0,offsetX:pe,offsetY:fe}),image:new Ce.c({radius:uo,stroke:new Te.c({color:B||this.strokeColor,width:this.strokeWidth}),fill:new je.c({color:b})})}),Ae}return Ee?(this.offsetY=-26,lt.offsetY=this.offsetY,t.set("_style",{text:lt,stroke:{color:B,width:this.strokeWidth},fill:{color:b},icon:{src:Ee}}),Ae=new ee.cp({text:new gr.c({text:n?t.get("draw"):"",stroke:new Te.c({color:"white",width:.75}),fill:new je.c({color:"black"}),font:g,overflow:!0,offsetX:pe,offsetY:fe}),stroke:new Te.c({color:B,width:this.strokeWidth}),fill:new je.c({color:b}),image:new Ga.c({src:Ee})}),Ae):(this.offsetY=Je?-15:0,lt.offsetY=this.offsetY,t.set("_style",{text:lt,stroke:{color:B,width:this.strokeWidth},fill:{color:b},circle:{radius:5,stroke:{color:B,width:this.strokeWidth},fill:{color:b}}}),Ae=new ee.cp({text:new gr.c({text:n?t.get("draw"):"",stroke:new Te.c({color:"white",width:.75}),fill:new je.c({color:"black"}),font:g,overflow:!0,offsetX:pe,offsetY:fe}),stroke:new Te.c({color:B,width:this.strokeWidth}),fill:new je.c({color:b}),image:new Ce.c({radius:5,stroke:new Te.c({color:B,width:this.strokeWidth}),fill:new je.c({color:b})})}),Ae)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function $a(l,f){1&l&&(e.SAx(0),e.I0R(1,"span")(2,"mat-icon",5),e.OEk(3,"format_color_fill"),e.C$Y(),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"igo-color-picker-form-field",21),e.k70()),2&l&&(e.yG2(4),e.oRS(" ",e.kDX(5,1,"igo.geo.style.fill")," "))}function Aa(l,f){if(1&l&&(e.I0R(0,"mat-option",22),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}let ka=(()=>{class l{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(t,i,n,g){this.dialogRef=t,this.formBuilder=i,this.drawStyleService=n,this.data=g}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):ai.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(ai)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):ai.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(Z.KE),e.GI1(Xr),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:47,vars:29,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matTextSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3),e.yuY(6,$a,7,3,"ng-container",4),e.I0R(7,"span")(8,"mat-icon",5),e.OEk(9,"border_color "),e.C$Y(),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.wR5(12,"igo-color-picker-form-field",6),e.C$Y(),e.I0R(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.I0R(18,"input",9,10),e.qCj("input",function(b){return n.styleModalData.fontSize=b.target.value}),e.C$Y(),e.I0R(20,"span",11),e.OEk(21,"px"),e.C$Y()(),e.I0R(22,"mat-form-field",8)(23,"mat-label"),e.OEk(24),e.wVc(25,"translate"),e.C$Y(),e.I0R(26,"mat-select",12,13),e.qCj("selectionChange",function(b){return n.styleModalData.fontStyle=b.value}),e.yuY(28,Aa,2,2,"mat-option",14),e.C$Y()(),e.I0R(29,"mat-form-field",8)(30,"mat-label"),e.OEk(31),e.wVc(32,"translate"),e.C$Y(),e.I0R(33,"input",15,16),e.qCj("input",function(b){return n.styleModalData.offsetX=b.target.value}),e.C$Y()(),e.I0R(35,"mat-form-field",8)(36,"mat-label"),e.OEk(37),e.wVc(38,"translate"),e.C$Y(),e.I0R(39,"input",15,17),e.qCj("input",function(b){return n.styleModalData.offsetY=b.target.value}),e.C$Y()()()()(),e.I0R(41,"div",18)(42,"button",19),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(43),e.wVc(44,"translate"),e.C$Y(),e.I0R(45,"button",20),e.qCj("click",function(){return n.confirm()}),e.OEk(46,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,15,"igo.geo.style.styleModal"),"\n"),e.yG2(2),e.E7m("hidden",0===n.data.features.length),e.yG2(),e.E7m("formGroup",n.form),e.yG2(2),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(4),e.oRS(" ",e.kDX(11,17,"igo.geo.style.stroke")," "),e.yG2(6),e.cNF(e.kDX(17,19,"igo.geo.style.fontSize")),e.yG2(2),e.E7m("value",n.getFeatureFontSize()),e.yG2(6),e.cNF(e.kDX(25,21,"igo.geo.style.fontStyle")),e.yG2(2),e.E7m("value",n.getFeatureFontStyle()),e.yG2(2),e.E7m("ngForOf",n.allFontStyles),e.yG2(3),e.cNF(e.kDX(32,23,"igo.geo.style.offsetX")),e.yG2(2),e.E7m("value",n.getFeatureOffsetX()),e.yG2(4),e.cNF(e.kDX(38,25,"igo.geo.style.offsetY")),e.yG2(2),e.E7m("value",n.getFeatureOffsetY()),e.yG2(4),e.oRS(" ",e.kDX(44,27,"igo.geo.style.cancel")," "))},dependencies:[bt.WQ,bt.iU,Z.y,Z.sz,Z.ue,Z.u,Z.sl,Z.uW,Z.Wo,o.u_,L.oB,L.qL,mr,ve.wb,ve.Up,ve.w5,ve.Gm,yt.cN,yt.yi,ye.d5,ye.kX,ne.I5,o.Iw,ne.Ax,bt.Yp,R.oJ,R.Gw,C._s,G.sD],styles:["[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),Jr=(()=>{class l{dialogRef;confirmFlag=!1;constructor(t){this.dialogRef=t}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const g=e.KQA();e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",2),e.wR5(5,"input",3,4),e.wVc(7,"translate"),e.C$Y()(),e.I0R(8,"div",5)(9,"button",6),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"button",7),e.qCj("click",function(){e.usT(g);const B=e.Gew(6);return e.CGJ(n.confirm(B.value))}),e.OEk(13," OK "),e.C$Y()()}2&i&&(e.yG2(2),e.oRS(" ",e.kDX(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.yG2(3),e._6D("placeholder",e.kDX(7,5,"igo.geo.draw.layer.title")),e.yG2(5),e.oRS(" ",e.kDX(11,7,"igo.geo.draw.cancel")," "))},dependencies:[bt.iU,ve.wb,ve.Up,yt.cN,yt.yi,bt.Yp,R.oJ,R.Gw,C._s,G.sD],styles:["[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var gn=r(85308);function hr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",11),e.qCj("change",function(n){e.usT(t);const g=e.GaO(3);return e.CGJ(g.onLabelTypeChange(n.value))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function Qr(l,f){if(1&l&&(e.I0R(0,"mat-radio-group"),e.yuY(1,hr,2,4,"mat-radio-button",10),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function fr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",13),e.qCj("change",function(n){e.usT(t);const g=e.GaO(3);return e.CGJ(g.onLabelTypeChange(n.source.value,n.checked))}),e.OEk(1),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function yr(l,f){if(1&l&&(e.SAx(0),e.yuY(1,fr,2,4,"mat-checkbox",12),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function Ba(l,f){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function Zr(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3,"(Latitude, Longitude)"),e.C$Y(),e.wR5(4,"input",16,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onChangeCoordinateUnit(n.value))}),e.yuY(8,Ba,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(4),e._6D("value",t.currentCoordinates),e.yG2(3),e.E7m("value",t.coordinatesMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allCoordinatesUnits)}}function qr(l,f){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getLengthUnitEnum(t)," ")}}function es(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.C$Y(),e.wR5(4,"input",21,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onChangeLengthUnit(n.value))}),e.yuY(8,qr,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(t.lengthLabelT),e.yG2(),e._6D("placeholder",t.lengthLabelT),e._6D("value",t.currentLength),e.yG2(3),e.E7m("value",t.lengthMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allLengthUnits)}}function ts(l,f){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getAreaUnitEnum(t)," ")}}function os(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",21,17),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-form-field",18)(9,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onChangeAreaUnit(n.value))}),e.yuY(10,ts,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,5,"igo.geo.draw.labelType.Area")),e.yG2(2),e._6D("placeholder",e.kDX(7,7,"igo.geo.draw.labelType.Area")),e._6D("value",t.currentArea),e.yG2(4),e.E7m("value",t.areaMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allAreaUnits)}}function is(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"div")(11,"p"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.yuY(14,Qr,2,1,"mat-radio-group",1)(15,yr,2,1,"ng-container",1)(16,Zr,9,3,"div",6)(17,es,9,5,"div",6)(18,os,11,9,"div",6),e.C$Y()(),e.I0R(19,"div",7)(20,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(21),e.wVc(22,"translate"),e.C$Y(),e.I0R(23,"button",9),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.confirm())}),e.OEk(24),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,13,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,15,"igo.geo.draw.labelType.predefined")," "),e.yG2(4),e.oRS(" ",e.kDX(13,17,"igo.geo.draw.builtInInstructions")," "),e.yG2(2),e.E7m("ngIf","Polygon"!==t.olGeometryType),e.yG2(),e.E7m("ngIf","Polygon"===t.olGeometryType),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Coordinates),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.yG2(3),e.oRS(" ",e.kDX(22,19,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}function ns(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"p"),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"mat-form-field",22)(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"input",23,17),e.qCj("select",function(){return!0})("input",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.getLabelLength(n.target.value))}),e.wVc(19,"translate"),e.C$Y()()(),e.I0R(20,"div",7)(21,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",9),e.qCj("click",function(){e.usT(t);const n=e.Gew(18),g=e.GaO();return e.CGJ(g.confirm(n.value))}),e.OEk(25),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,11,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,13,"igo.geo.draw.labelType.predefined")," "),e.yG2(3),e.oRS(" ",e.kDX(12,15,"igo.geo.draw.dialogInstruction")," "),e.yG2(4),e.cNF(e.kDX(16,17,"igo.geo.draw.dialogTitle")),e.yG2(2),e._6D("placeholder",e.kDX(19,19,"igo.geo.draw.dialogTitle")),e._6D("value",t.currentLabel),e.yG2(5),e.oRS(" ",e.kDX(23,21,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}let rs=(()=>{class l{languageService;dialogRef;data;confirmFlag=!1;labelFlag=rt.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=gt;labelType=rt;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(t,i,n){let g;this.languageService=t,this.dialogRef=i,this.data=n,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const b=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof Po.c)if(this.data.olGeometry.get("rad")){const B=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=gt.Circle,g=new Qo.c(B,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),g=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),g=this.data.olGeometry;if(this.olGeometryType===gt.Point||this.olGeometryType===gt.Circle){if(this.data.olGeometry instanceof Po.c){let B=this.data.olGeometry.get("longitude"),pe=this.data.olGeometry.get("latitude");this.longlatDD=(0,gn.uE)([B,pe],5),this.coordinatesInDD="("+pe+", "+B+")"}else{let B=(0,y.AF)(this.data.olGeometry.getFlatCoordinates(),b,"EPSG:4326");this.longlatDD=(0,gn.uE)([B[0],B[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===gt.LineString)this.lengthInMeters=(0,oo.cD)(g,b.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===gt.Polygon)this.lengthInMeters=(0,oo.cD)(g,b.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,oo.aS)(g,b.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===gt.Circle){let B=(0,zt.IH)(g,1e4);const pe=this.getRadius(B);this.lengthInMeters=pe.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,oo.aS)(B,b.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}n.olGeometry.get("labelType")===rt.Coordinates?(this.onLabelTypeChange(rt.Predefined),this.onLabelTypeChange(rt.Coordinates,!0),this.coordinatesMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===rt.Length?(this.onLabelTypeChange(rt.Predefined),this.onLabelTypeChange(rt.Length,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===rt.Area?(this.onLabelTypeChange(rt.Predefined),this.onLabelTypeChange(rt.Area,!0),this.areaMeasureUnit=n.olGeometry.get("measureUnit")):2===n.olGeometry.get("labelType")?.length&&(this.onLabelTypeChange(rt.Predefined),this.onLabelTypeChange(rt.Length,!0),this.onLabelTypeChange(rt.Area,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=n.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===rt.Predefined?this.dialogRef.close():this.labelFlag===rt.Custom?this.dialogRef.close({label:t}):this.labelFlag===rt.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===gt.Polygon?2===this.polygonCheck?(this.labelFlag=[rt.Length,rt.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+Vt.Ks[Vt.K8.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+Vt.kK[Vt.Mh.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===rt.Length?{label:"P: "+this.currentLength+" "+Vt.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+Vt.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===rt.Length?this.olGeometryType===gt.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+Vt.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===gt.LineString&&this.dialogRef.close({label:this.currentLength+" "+Vt.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===rt.Area&&this.dialogRef.close({label:this.currentArea+" "+Vt.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,i){t!==rt.Predefined&&t!==rt.Custom&&this.olGeometryType===gt.Polygon?(this.arrayBuiltInType.find(g=>g.value===t)?this.arrayBuiltInType.find(g=>g.value===t).checked=i:this.labelFlag=void 0,this.labelFlag=i?t:this.arrayBuiltInType.find(g=>g.checked)?.value):this.labelFlag=t,t===rt.Predefined?this.olGeometryType===gt.Point?(this.labelFlag=rt.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=ao.DecimalDegree):this.olGeometryType===gt.LineString&&(this.labelFlag=rt.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Vt.K8.Meters):t===rt.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=Vt.Mh.SquareMeters):t===rt.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Vt.K8.Meters):this.labelFlag===rt.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=ao.DecimalDegree),this.olGeometryType===gt.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?i?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=(0,oo.iK)(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=(0,oo.Ej)(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let i=dn(this.longlatDD,t);this.currentCoordinates="("+i[1]+", "+i[0]+")"}buildArrayType(){for(const t of Object.values(rt))t!==rt.Custom&&t!==rt.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==rt.Coordinates})}noLabelButton(){return this.labelFlag===rt.Predefined||this.labelFlag===rt.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===rt.Custom?rt.Custom:rt.Predefined}optionAvailable(t){switch(this.olGeometryType){case gt.Point:return t!==rt.Coordinates;case gt.LineString:return t!==rt.Length;case gt.Polygon:return t===rt.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(Vt.K8)}getLengthUnitEnum(t){return Vt.Ks[t]}get allAreaUnits(){return Object.values(Vt.Mh)}get allCoordinatesUnits(){return Object.values(ao)}getAreaUnitEnum(t){return Vt.kK[t]}getRadius(t){const i=(0,pn.S2)(t);return Number(i/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===gt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===gt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===gt.Point?t===rt.Coordinates:this.olGeometryType===gt.LineString?t===rt.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===rt.Length?this.olGeometryType===gt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===gt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}static \u0275fac=function(i){return new(i||l)(e.GI1(C.ov),e.GI1(bt.yI),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},standalone:!0,features:[e.UHJ],decls:5,vars:5,consts:[["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"value","change"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"value","disabled","checked","change"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","disabled","checked","change"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],["input",""],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"placeholder","value","select","input"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,is,25,21,"ng-container",1)(4,ns,26,23,"ng-container",1)),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.popupTitle"),"\n"),e.yG2(2),e.E7m("ngIf",n.labelFlag!==n.labelType.Custom),e.yG2(),e.E7m("ngIf",n.labelFlag===n.labelType.Custom))},dependencies:[bt.WQ,o.u_,bt.iU,he.ue,he.gn,he.KU,Me.yk,Me.cv,Me.cT,o.Iw,me.Vn,me.WK,ve.wb,ve.Up,ve.w5,yt.cN,yt.yi,ye.d5,ye.kX,ne.I5,ne.Ax,bt.Yp,R.oJ,R.Gw,C._s,G.sD],styles:["[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return l})();var li=r(80716);let ss=(()=>{class l{svgIcon=li.Cg;static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-shorcuts"]],standalone:!0,features:[e.UHJ],decls:27,vars:13,consts:[[1,"shortcut","mat-typography"],[1,"shortcut-icon"],[3,"icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(i,n){1&i&&(e.I0R(0,"mat-dialog-content")(1,"div")(2,"span",0)(3,"mat-icon",1),e.OEk(4,"keyboard_return"),e.C$Y(),e.OEk(5),e.wVc(6,"translate"),e.C$Y()(),e.I0R(7,"div")(8,"span",0)(9,"mat-icon",1),e.OEk(10,"keyboard_backspace"),e.C$Y(),e.OEk(11),e.wVc(12,"translate"),e.C$Y()(),e.I0R(13,"div")(14,"span",0),e.wR5(15,"igo-icon",2),e.OEk(16),e.wVc(17,"translate"),e.C$Y()(),e.I0R(18,"div")(19,"span",0)(20,"mat-icon",1),e.OEk(21,"space_bar"),e.C$Y(),e.OEk(22),e.wVc(23,"translate"),e.C$Y()()(),e.I0R(24,"mat-dialog-actions",3)(25,"button",4),e.OEk(26,"OK"),e.C$Y()()),2&i&&(e.yG2(5),e.cNF(e.kDX(6,5,"igo.geo.draw.finish")),e.yG2(6),e.cNF(e.kDX(12,7,"igo.geo.draw.undo")),e.yG2(4),e.E7m("icon",n.svgIcon),e.yG2(),e.oRS(" ",e.kDX(17,9,"igo.geo.draw.abort")," "),e.yG2(6),e.cNF(e.kDX(23,11,"igo.geo.draw.move")))},dependencies:[bt.iU,L.oB,L.qL,bt.Yp,R.oJ,R.Gw,bt.qq,C._s,G.sD,li.S],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})}return l})();const as=["selectedLayer"];function ls(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",5),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onToggleFreehandMode(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandMode)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.freehandMode")," ")}}function cs(l,f){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function us(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25),e.wR5(2,"input",26),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",27)(5,"mat-select",10),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onMeasureUnitChange(n.value))}),e.yuY(6,cs,3,4,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,5,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function ds(l,f){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function ps(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.activeDrawingLayer.visible=!n.activeDrawingLayer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon"),e.OEk(4),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.kDX(1,3,"igo.geo.layer.hideLayer"):e.kDX(2,5,"igo.geo.layer.showLayer")),e.yG2(4),e.oRS(" ",t.activeDrawingLayer.visible?"visibility":"visibility_off"," ")}}function ms(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",29),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.deleteDrawings())}),e.wVc(1,"translate"),e.wVc(2,"async"),e.I0R(3,"mat-icon"),e.OEk(4,"delete"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.draw.delete"))("disabled",0===e.kDX(2,4,t.selectedFeatures$).length)}}function gs(l,f){if(1&l&&(e.I0R(0,"div",33),e.wR5(1,"img",34),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e._6D("src",t.icon,e.K6U)}}function hs(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",35),e.qCj("click",function(){const g=e.usT(t).$implicit,b=e.GaO(2);return e.CGJ(b.onIconChange(g))}),e.I0R(1,"div",33),e.wR5(2,"img",34),e.C$Y()()}if(2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(2),e._6D("src",t,e.K6U)}}function _r(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field")(1,"mat-label"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-select")(5,"mat-select-trigger"),e.yuY(6,gs,2,1,"div",30),e.C$Y(),e.I0R(7,"mat-option",31),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onIconChange())}),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.yuY(10,hs,3,2,"mat-option",32),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.draw.icon")),e.yG2(4),e.E7m("ngIf",t.icon),e.yG2(2),e.cNF(e.kDX(9,6,"igo.geo.draw.noIcon")),e.yG2(2),e.E7m("ngForOf",t.icons)}}function fs(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openStyleModalDialog())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.I0R(4,"mat-icon",37),e.OEk(5,"palette "),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.style.styleModalTooltipSelected")),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.style.styleModal")," "),e.yG2(2),e.E7m("matBadge",t.selectedFeatures$.value.length)}}let ys=(()=>{class l{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=gt;map;get stores(){return this._stores}set stores(t){this._stores=t}_stores=[];get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}_activeDrawingLayer;activeLayerChange=new e._w7;drawControlsEvent=new e._w7;layersIDEvent=new e._w7;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new ue.g({});activeDrawingLayerSource=new ji.c;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new ue.g([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new Z.yM(1e3);measureUnit=Vt.K8.Meters;radiusFormControlChange$$=new jr.wH;predefinedRadius$=new ue.g(void 0);radiusDrawEnd$=new ue.g(void 0);get measureUnits(){return[Vt.K8.Meters,Vt.K8.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(t,i,n,g,b){this.languageService=t,this.formBuilder=i,this.drawStyleService=n,this.dialog=g,this.drawIconService=b,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:B=>B.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:B=>[{editMode:!1,icon:"edit",color:"primary",click:()=>{this.editLabelDrawing(B)},style:"mat-icon-button"}],renderer:V.G8.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let i=this.stores.find(n=>n.layer.id===t.id);this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,zn.K)()).subscribe(n=>{n.forEach(g=>{g.state.selected=!1})})),this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Ki.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(g=>g.entity))})),this.subscriptions$$.push(i.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new Ut.ym([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,i,n){return new Wr.i({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new ee.cp({}),interactionStyle:Vi(t,i,n)})}initStore(t,i){this.createLayer(t,i),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Ki.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(g=>g.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(ka,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(i=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,i.fontSize,i.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,i.fillColor,i.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,i.offsetX,i.offsetY))})},250)}openDrawDialog(t,i){setTimeout(()=>{const n=this.dialog.open(rs,{disableClose:!1,data:{olGeometry:t,map:this.map}});n.afterClosed().subscribe(g=>{n.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,g.label),this.updateLabelType(t,n.componentInstance.labelFlag),this.updateMeasureUnit(t,g.measureUnit),t instanceof Po.c||(this.updateFontSizeAndStyle(t,"15",ai.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof Ht.c?-15:0)),i?this.onDrawEnd(t):this.onSelectDraw(t,g.label,[n.componentInstance.labelFlag,g.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(b=>{const B=b.getGeometry();t===B&&this.activeDrawingLayerSource.removeFeature(b)})})},250)}onDrawEnd(t,i){this.addFeatureToStore(t,i),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(n=>{if(n.properties.id===t.ol_uid){if(n.properties.labelType===rt.Coordinates){let B=dn([n.properties.longitude,n.properties.latitude],n.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+B[1]+", "+B[0]+")")}else if(n.properties.labelType===rt.Length)if(t instanceof Qo.c){let B=(0,zt.IH)(t,1e4);const pe=(0,oo.iK)(this.getRadius(B),n.properties.measureUnit),fe=Vt.Ks[n.properties.measureUnit],Fe="R: "+pe.toFixed(2).toString()+" "+fe;this.updateLabelOfOlGeometry(t,Fe)}else{let pe,B=(0,oo.cD)(t,this.map.ol.getView().getProjection().getCode());pe=Vt.Ks[n.properties.measureUnit],B=(0,oo.iK)(B,n.properties.measureUnit);let Fe=t instanceof zt.cp?"P: "+B.toFixed(2).toString()+" "+pe:B.toFixed(2).toString()+" "+pe;this.updateLabelOfOlGeometry(t,Fe)}else if(n.properties.labelType===rt.Area)if(t instanceof Qo.c){let B=(0,zt.IH)(t,1e4),pe=(0,oo.aS)(B,this.map.ol.getView().getProjection().getCode());const fe=Vt.kK[n.properties.measureUnit];pe=(0,oo.Ej)(pe,n.properties.measureUnit);const Ee=pe.toFixed(2).toString()+" "+fe;this.updateLabelOfOlGeometry(t,Ee)}else{let pe,B=(0,oo.aS)(t,this.map.ol.getView().getProjection().getCode());pe=Vt.kK[n.properties.measureUnit],B=(0,oo.Ej)(B,n.properties.measureUnit);const Fe=B.toFixed(2).toString()+" "+pe;this.updateLabelOfOlGeometry(t,Fe)}else this.updateLabelOfOlGeometry(t,n.properties.draw);this.updateLabelType(t,n.properties.labelType),this.updateMeasureUnit(t,n.properties.measureUnit),this.updateFontSizeAndStyle(t,n.properties.fontStyle.split(" ")[0].replace("px",""),n.properties.fontStyle.substring(n.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,n.properties.drawingStyle.fill,n.properties.drawingStyle.stroke),this.updateOffset(t,n.properties.offsetX,n.properties.offsetY),this.replaceFeatureInStore(n,t)}})}onSelectDraw(t,i,n){const g=this.activeStore.all(),b=t.getGeometry();b.ol_uid=t.get("id");const B=JSON.stringify(b.getCoordinates()[0]);g.forEach(pe=>{const fe=JSON.stringify(pe.geometry.coordinates[0]);if(B===fe){const Fe=t.get("fontStyle").split(" ")[0].replace("px",""),Ee=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),Ae=t.get("drawingStyle").fill,Je=t.get("drawingStyle").stroke,ke=t.get("offsetX"),et=t.get("offsetY"),lt=pe.properties.rad?pe.properties.rad:void 0;this.updateLabelOfOlGeometry(b,i),this.updateFontSizeAndStyle(b,Fe,Ee),this.updateFillAndStrokeColor(b,Ae,Je),this.updateOffset(b,ke,et),this.updateLabelType(b,n[0]),this.updateMeasureUnit(b,n[1]),this.replaceFeatureInStore(pe,b,lt)}})}addFeatureToStore(t,i,n){let g,b,B,pe,fe;const Fe=n?n.properties.id:t.ol_uid,Ee=this.map.ol.getView().getProjection(),Ae=(new po.c).writeGeometryObject(t,{featureProjection:Ee,dataProjection:Ee});if(t instanceof Qo.c||i)if(i)g=i;else{Ae.type="Point",Ae.coordinates=t.getCenter();const Je=(0,y.AF)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],Ee,"EPSG:4326");b=(0,y.AF)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],Ee,"EPSG:4326"),pe=b[0],fe=b[1],g=(0,pn.c$)(b,Je),this.radiusFormControl.setValue(Math.round(g))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(g=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof Ht.c&&(B=(0,y.AF)(t.getFlatCoordinates(),Ee,"EPSG:4326"),pe=B[0],fe=B[1]),this.activeStore.update({type:Ut.Yf,geometry:Ae,projection:Ee.getCode(),properties:{id:Fe,draw:t.get("_label"),longitude:pe||null,latitude:fe||null,rad:g||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:Fe}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const i=this.dialog.open(Jr,{disableClose:!1});i.afterClosed().subscribe(n=>{i.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new Ut.ym([],{map:this.map}),this.activeDrawingLayerSource=new ji.c,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(n,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const i=(0,Ut.K6)(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(i,!1)}openShorcutsDialog(){this.dialog.open(ss)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(i=>{const n=i.getGeometry();t.properties.id===n.ol_uid&&this.activeDrawingLayerSource.removeFeature(i)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(Vi(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(i=>i.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(i=>i[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,i){for(const n of this.allLayers){let g=Number(n.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(g,this.layerCounterID)}this.activeDrawingLayer=new wi.M({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:i?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new Ii.E,style:(n,g)=>this.drawStyleService.createIndividualElementStyle(n,g,this.labelsAreShown,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),(0,Kr.m)(this.activeStore,this.activeDrawingLayer),(0,Ut.sf)(this.activeStore,new Ut.E9({motion:Ut.Su.None})),(0,Ut.Uz)(this.activeStore,new Ut.kj({map:this.map,motion:Ut.Su.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",n=>{const g=n.feature.getGeometry();this.clearLabelsOfOlGeometry(g)})}onColorChange(t,i,n,g){this.selectedFeatures$.value.length>0&&!i&&this.selectedFeatures$.value.forEach(b=>{let B=(0,Ut.K6)(b,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(B,n,g);const pe=this.activeStore.all().find(fe=>fe.meta.id===B.getId());pe.properties.drawingStyle.fill=B.get("fillColor_"),pe.properties.drawingStyle.stroke=B.get("strokeColor_"),this.activeStore.update(pe)}),this.elementStyle(t,i),this.createDrawControl()}onFontChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(g=>{let b=(0,Ut.K6)(g,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(b,i,n);const B=this.activeStore.all().find(pe=>pe.meta.id===b.getId());B.properties.fontStyle=b.get("fontStyle_"),this.activeStore.update(B),b=this.activeStore.layer.ol.getSource().getFeatures().find(pe=>pe.getId()===B.meta.id),b.setProperties({fontStyle:B.properties.fontStyle}),b.changed()}),this.fontSize=i,this.fontStyle=n,this.drawStyleService.setFontSize(i),this.drawStyleService.setFontStyle(n),this.elementStyle(t))}onOffsetLabelChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(g=>{let b=(0,Ut.K6)(g,this.map.ol.getView().getProjection().getCode());this.updateOffset(b,i,n);const B=this.activeStore.all().find(pe=>pe.meta.id===b.getId());B.properties.offsetX=b.get("offsetX_"),B.properties.offsetY=b.get("offsetY_"),this.activeStore.update(B),b=this.activeStore.layer.ol.getSource().getFeatures().find(pe=>pe.getId()===B.meta.id),b.setProperties({offsetX:B.properties.offsetX,offsetY:B.properties.offsetY}),b.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,i){t.setProperties({_label:i},!0)}updateFontSizeAndStyle(t,i,n){t.setProperties({fontStyle_:`${i}px ${n}`},!0)}updateFillAndStrokeColor(t,i,n){t.setProperties({fillColor_:i,strokeColor_:n},!0)}updateOffset(t,i,n){t.setProperties({offsetX_:i,offsetY_:n},!0)}updateLabelType(t,i){t.setProperties({labelType_:i},!0)}updateMeasureUnit(t,i){t.setProperties({measureUnit_:i},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):ai.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(ai)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(i=>i.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){(0,oo.aK)(t).forEach(i=>{i&&i.getMap()&&this.map.ol.removeOverlay(i)})}replaceFeatureInStore(t,i,n){this.activeStore.delete(t),this.onDrawEnd(i,n)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let i;i=t?this.measureUnit===Vt.K8.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((g,b)=>{const B=g.getGeometry(),pe=y.AF(B.getCoordinates(),this.map.projection,"EPSG:4326"),fe=i/Math.cos(Math.PI/180*pe[1])/b;return this.activeDrawControl.predefinedRadius$.next(i),new ee.cp({image:new Ce.c({radius:fe,stroke:new Te.c({width:1,color:"rgba(143,7,7,1)"}),fill:new je.c({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===Vt.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,i){this.activeStore.layer.ol.setStyle(i?(n,g)=>this.drawStyleService.createIndividualElementStyle(n,g,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon):(n,g)=>this.drawStyleService.createIndividualElementStyle(n,g,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection))}getRadius(t){const i=(0,pn.S2)(t);return Number(i/(2*Math.PI))}static \u0275fac=function(i){return new(i||l)(e.GI1(C.ov),e.GI1(Z.KE),e.GI1(Xr),e.GI1(bt.qW),e.GI1(Oi))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw"]],viewQuery:function(i,n){if(1&i&&e.CC$(as,5),2&i){let g;e.wto(g=e.Gqi())&&(n.select=g.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},standalone:!0,features:[e.UHJ],decls:51,vars:47,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["aria-hidden","false","iconPositionEnd","","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(i,n){if(1&i){const g=e.KQA();e.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.qCj("change",function(B){return n.onGeometryTypeChange(B.value)}),e.I0R(3,"mat-button-toggle",2),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",2),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",2),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-button-toggle",2),e.OEk(13),e.wVc(14,"translate"),e.C$Y()()(),e.I0R(15,"div",3)(16,"mat-slide-toggle",4),e.qCj("change",function(B){return n.onToggleDrawControl(B.checked)}),e.OEk(17),e.wVc(18,"translate"),e.C$Y(),e.I0R(19,"mat-slide-toggle",5),e.qCj("change",function(){return n.onToggleLabels()}),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.yuY(22,ls,3,5,"mat-slide-toggle",6)(23,us,7,7,"div",7),e.C$Y(),e.wR5(24,"mat-divider"),e.I0R(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-select",10,11),e.qCj("selectionChange",function(){e.usT(g);const B=e.Gew(31);return e.CGJ(n.onLayerChange(B.value))}),e.yuY(32,ds,2,2,"mat-option",12),e.I0R(33,"mat-option",13),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.yuY(36,ps,5,7,"button",14),e.C$Y(),e.wR5(37,"mat-divider"),e.I0R(38,"div"),e.yuY(39,ms,5,6,"button",15),e.I0R(40,"div"),e.wR5(41,"igo-entity-table",16,17),e.C$Y()(),e.I0R(43,"div",18),e.yuY(44,_r,11,8,"mat-form-field",19),e.C$Y(),e.I0R(45,"div",20)(46,"button",21),e.qCj("click",function(){return n.openShorcutsDialog()}),e.I0R(47,"mat-icon",22),e.wVc(48,"translate"),e.OEk(49,"keyboard "),e.C$Y()(),e.yuY(50,fs,6,7,"button",23),e.C$Y()()}2&i&&(e.yG2(2),e.E7m("value",n.geometryType.Point),e.yG2(),e.E7m("value",n.geometryType.Point),e.yG2(),e.oRS(" ",e.kDX(5,29,"igo.geo.draw."+n.geometryType.Point)," "),e.yG2(2),e.E7m("value",n.geometryType.LineString),e.yG2(),e.oRS(" ",e.kDX(8,31,"igo.geo.draw."+n.geometryType.LineString)," "),e.yG2(2),e.E7m("value",n.geometryType.Polygon),e.yG2(),e.oRS(" ",e.kDX(11,33,"igo.geo.draw."+n.geometryType.Polygon)," "),e.yG2(2),e.E7m("value",n.geometryType.Circle),e.yG2(),e.oRS(" ",e.kDX(14,35,"igo.geo.draw."+n.geometryType.Circle)," "),e.yG2(3),e.E7m("disabled",n.drawControlIsDisabled)("checked",n.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(18,37,"igo.geo.draw.drawControl")," "),e.yG2(2),e.E7m("checked",n.labelsAreShown)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.yG2(2),e.E7m("ngIf",!n.isPoint()),e.yG2(),e.E7m("ngIf",n.isCircle()),e.yG2(5),e.cNF(e.kDX(29,41,"igo.geo.draw.layer.title")),e.yG2(2),e.E7m("value",n.updateActiveLayer()),e.yG2(2),e.E7m("ngForOf",n.allLayers),e.yG2(2),e.oRS(" ",e.kDX(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.yG2(2),e.E7m("ngIf",n.activeDrawingLayer),e.yG2(3),e.E7m("ngIf",n.activeStore.count$.getValue()>0),e.yG2(2),e.E7m("store",n.activeStore)("template",n.tableTemplate),e.yG2(3),e.E7m("ngIf",n.icons.length>=1),e.yG2(3),e.E7m("matTooltip",e.kDX(48,45,"igo.geo.draw.shortcuts")),e.yG2(3),e.E7m("ngIf",n.selectedFeatures$.value.length))},dependencies:[he.ue,he.gn,he.KU,ut.GE,ut.cP,o.u_,ve.wb,ve.Up,ve.w5,yt.cN,yt.yi,Z.y,Z.ot,Z.O4,Z.ue,Z.Gu,Z.sl,Z.ug,ye.d5,ye.kX,ye.gl,ne.I5,o.Iw,ne.Ax,_e.U,_e.k,R.oJ,R.Gw,R.um,_.KO,_.a4,L.oB,L.qL,V.Eh,M.g,M.S,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}"],data:{animation:[(0,ho.gV)("openClose",[(0,ho.K2)("open",(0,ho.wb)({opacity:1})),(0,ho.K2)("closed",(0,ho.wb)({opacity:0})),(0,ho.aK)("open => closed",[(0,ho.Cs)("600ms ease")]),(0,ho.aK)("closed => open",[(0,ho.Cs)("800ms ease")])])]},changeDetection:0})}return l})();var _s=r(28276),Cs=r(53156),Zt=r(49312),Cr=r(48908),vs=r(36124);function Ss(l,f){}let q=(()=>{class l{cdRef;ngControl;olOverlayLayer;olGeoJSON=new po.c;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}_predefinedRadius;controlOptions={};set drawStyle(t){void 0===t&&(t=(0,vs.gD)()),this._drawStyle=t;const i=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==i?i.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let i;setTimeout(()=>{i=this.modifyControl.olModifyInteraction,i&&i.features_&&(i.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(t,i){this.cdRef=t,this.ngControl=i,void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=(0,vs.gD)()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}onChange=()=>{};registerOnTouched(t){this.onTouched=t}onTouched=()=>{};writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new Cs.c({source:new ji.c,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const g=this.drawStyle;return this.updateDrawStyleWithDrawGuide(g,n),g}});this.drawControl=new Cr.i4(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const g=this.drawStyle;return this.updateDrawStyleWithDrawGuide(g,n),g}});this.modifyControl=new Cr.Up(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(i=>this.onOlGeometryEnds(i)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(i=>this.onOlGeometryChanges(i))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let i;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),i=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(i.radius=t.get("radius"),t.set("radius",i.radius)),this.writeValue(i))}circleToPoint(t){const i=t.getCenter(),n=y.AF(i,this.map.projection,"EPSG:4326"),g=Math.round(t.getRadius()*Math.cos(Math.PI/180*n[1]));return(t=new Ht.c(i)).set("radius",g,!0),t}addGeoJSONToOverlay(t){const i=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),n=new Po.c({geometry:i});n.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(n)}createMeasureTooltip(){return new _s.c({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const n=(0,Zt.ox)(t,this.map.projection).lengths,g="Polygon"===t.getType()?n.length-2:n.length-1,b=n[g],B=(0,Zt.ie)(t),pe=B[g];if(0===B.length||void 0===pe)return void this.removeMeasureTooltip();this.olTooltip.setPosition(pe.getFlatCoordinates());const fe=(0,Zt.wP)(b,{decimal:1,unit:Zt.K8.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=fe,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,i){const n=this.getGuideStyleFromDrawStyle(t);if(void 0===n)return;const g=this.drawGuide;let b;b=!g||g<0?this.defaultDrawStyleRadius:g>0?g/i:g,n.setRadius(b)}getGuideStyleFromDrawStyle(t){let i,n;return i=Array.isArray(t)?t[0]:t,"function"==typeof i.getImage&&(i=i.getImage()),"function"==typeof i.setRadius&&(n=i),n}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(Z.eq,10))};static \u0275cmp=e.In1({type:l,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},standalone:!0,features:[e.UHJ],decls:1,vars:0,template:function(i,n){1&i&&e.yuY(0,Ss,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return l})();var k=r(99228);function m(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onDrawControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function O(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onfreehandControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandDrawIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function $(l,f){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function ie(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",18)(1,"mat-form-field",19),e.wR5(2,"input",20),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onMeasureUnitChange(n.value))}),e.yuY(6,$,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Se(l,f){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Ne(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25)(2,"input",26),e.qCj("input",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.getRadius())}),e.wVc(3,"translate"),e.C$Y()(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onMeasureUnitChange(n.value))}),e.yuY(6,Se,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function it(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",27),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onItemTypeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter."+t)," ")}}function mt(l,f){1&l&&(e.I0R(0,"mat-header-cell",38),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.kDX(2,1,"igo.geo.spatialFilter.Thematics")))}function ht(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-header-cell",39)(1,"mat-checkbox",40),e.qCj("change",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(n?g.masterToggle():null)}),e.C$Y()()}if(2&l){const t=e.GaO(2);e.yG2(),e.E7m("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function At(l,f){1&l&&e.wR5(0,"mat-header-row")}function Ot(l,f){1&l&&e.wR5(0,"mat-row")}function Rt(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-tree-node",41)(1,"li",42),e.wR5(2,"button",43),e.OEk(3),e.I0R(4,"mat-checkbox",44),e.qCj("click",function(n){return n.stopPropagation()})("change",function(n){const b=e.usT(t).$implicit,B=e.GaO(2);return e.CGJ(n?B.onToggleChange(b):null)}),e.C$Y()()()}if(2&l){const t=f.$implicit,i=e.GaO(2);e.yG2(3),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.selectedThematics.isSelected(t))}}function co(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-nested-tree-node")(1,"div",42)(2,"button",45),e.qCj("click",function(){const g=e.usT(t).$implicit,b=e.GaO(2);return e.CGJ(b.onToggleClick(g))}),e.I0R(3,"mat-icon"),e.OEk(4),e.C$Y()(),e.OEk(5),e.I0R(6,"mat-checkbox",46),e.qCj("change",function(n){const b=e.usT(t).$implicit,B=e.GaO(2);return e.CGJ(n?B.childrensToggle(b):null)}),e.C$Y()(),e.I0R(7,"ul",47),e.C_f(8,48),e.C$Y()()}if(2&l){const t=f.$implicit,i=e.GaO(2);e.yG2(4),e.cNF(i.treeControl.isExpanded(t)?"expand_more":"chevron_right"),e.yG2(),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.isAllSelected(t))("indeterminate",i.hasChildrenSelected(t)&&!i.isAllSelected(t)),e.yG2(),e.eAK("example-tree-invisible",!i.treeControl.isExpanded(t))}}function bo(l,f){if(1&l&&(e.I0R(0,"div",28)(1,"mat-table"),e.SAx(2,29),e.yuY(3,mt,3,3,"mat-header-cell",30),e.k70(),e.SAx(4,31),e.yuY(5,ht,2,2,"mat-header-cell",32),e.k70(),e.yuY(6,At,1,0,"mat-header-row",33)(7,Ot,1,0,"mat-row",34),e.C$Y(),e.I0R(8,"mat-tree",35),e.yuY(9,Rt,5,2,"mat-tree-node",36)(10,co,9,6,"mat-nested-tree-node",37),e.C$Y()()),2&l){const t=e.GaO();e.yG2(6),e.E7m("matHeaderRowDef",t.displayedColumns),e.yG2(),e.E7m("matRowDefColumns",t.displayedColumns),e.yG2(),e.E7m("dataSource",t.dataSource)("treeControl",t.treeControl),e.yG2(2),e.E7m("matTreeNodeDefWhen",t.hasChild)}}function ci(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",49),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearSearch())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",t.disabledClearSearch()),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function Ko(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",50),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearDrawZone())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",null===t.formControl.value),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function Ti(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",51),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"expand_more"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.showSearchResults"))}function hn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",55),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"expand_less"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function Xn(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",52),e.yuY(1,hn,4,3,"button",53),e.I0R(2,"igo-entity-table",54),e.qCj("entitySelectChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.entityChange.emit(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.listIsVisible),e.yG2(),e.E7m("template",t.tableTemplate)("store",t.store)}}let vr=(()=>{class l{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(t){this._type=t;const i=this.geometryTypes.findIndex(n=>n===this.type);if(this.geometryType=this.geometryTypes[i],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===K.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===K.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(n,g)=>{const b=n.getGeometry(),B=y.AF(b.getCoordinates(),this.map.projection,"EPSG:4326");return new ee.cp({image:new Ce.c({radius:this.radius/Math.cos(Math.PI/180*B[1])/g,stroke:new Te.c({width:2,color:"rgba(0, 153, 255)"}),fill:new je.c({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new ee.cp({stroke:new Te.c({width:2,color:"rgba(0, 153, 255)"}),fill:new je.c({color:"rgba(0, 153, 255, 0.2)"})});const n=[0,153,255],g=()=>new ee.cp({image:new Ce.c({radius:8,stroke:new Te.c({width:2,color:"rgba(0, 153, 255)"}),fill:new je.c({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new Te.c({color:n.concat([1]),width:2}),fill:new je.c({color:n.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(g)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[Zt.K8.Meters,Zt.K8.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}_thematicLength;toggleSearch=new e._w7;itemTypeChange=new e._w7;thematicChange=new e._w7;drawZoneEvent=new e._w7;bufferEvent=new e._w7;zoneWithBufferChange=new e._w7;measureUnitChange=new e._w7;radiusEvent=new e._w7;freehandControl=new e._w7;predefinedRadius=new e._w7;clearButtonEvent=new e._w7;clearSearchEvent=new e._w7;export=new e._w7;openWorkspace=new e._w7;entityChange=new e._w7;itemType=[j.Address,j.Thematics];selectedItemType=j.Address;selectedSourceAddress;treeControl=new oe.Mb(t=>t.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new v.wD;selectedThematics=new lr.e2(!0,[]);value$=new ue.g(void 0);drawGuide$=new ue.g(null);overlayStyle$=new ue.g(void 0);drawStyle$=new ue.g(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new Z.yM;geometryType;geometryTypeField=!1;geometryTypes=[gt.Point,gt.Polygon];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new Z.yM;bufferFormControl=new Z.yM;measureUnit=Zt.K8.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(t,i,n,g){this.cdRef=t,this.spatialFilterService=i,this.messageService=n,this.languageService=g}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(n=>{for(const b of n)this.childrens.push(b),this.childrens.sort((B,pe)=>B.name.localeCompare(pe.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const g={name:this.groups[0],children:[]};this.thematics.push(g),this.childrens.forEach(b=>{b.group&&-1===this.groups.indexOf(b.group)&&(this.groups.push(b.group),this.thematics.push({name:b.group,children:[]})),b.group||(b.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||b.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||b.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||b.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||b.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||b.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||b.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||b.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?b.group=g.name:b.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?b.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:b.name,children:[],source:b.source})),this.thematics.sort((B,pe)=>B.name.localeCompare(pe.name))}),this.thematics.forEach(b=>{for(const B of this.childrens)B.group===b.name&&b.children.push(B)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(n=>{n?(this.value$.next(n),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,vt.o)(500)).subscribe(n=>{this.measureUnit===Zt.K8.Meters&&n>0&&n<=1e5?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,K.Polygon,n).subscribe(g=>{this.zoneWithBuffer=g,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===Zt.K8.Kilometers&&n>0&&n<=100?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,K.Polygon,1e3*n).subscribe(g=>{this.zoneWithBuffer=g,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===n?(this.buffer=n,this.bufferEvent.emit(n),this.drawZoneEvent.emit(this.drawZone)):(n<0||this.measureUnit===Zt.K8.Meters&&n>1e5||this.measureUnit===Zt.K8.Kilometers&&n>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new V.xx({}),i=new Ut.kj({layer:new k.Md({zIndex:300,source:new nt.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:Ut.Su.Default,many:!0,dragBox:!0});this.store.addStrategy(i,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===Zt.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===Zt.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===K.Predefined}isPolygon(){return this.type===K.Polygon}isPoint(){return this.type===K.Point}hasChild(t,i){return!!i.children&&i.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let i,n=0;return t?(i=t.children.length,t.children.forEach(g=>{this.selectedThematics.selected.find(b=>b===g)&&n++})):(i=this.selectedThematics.selected.length,this.thematics.forEach(g=>{-1===this.groups.indexOf(g.name)&&n++}),this.childrens.forEach(g=>{this.thematics.find(b=>b.source===g.source)||n++})),n>=1&&i===n}hasChildrenSelected(t){let i=!1;return t.children.forEach(n=>{this.selectedThematics.selected.find(g=>g.source===n.source)&&(i=!0)}),i}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const i of this.selectedThematics.selected)t.push(i);this.isAllSelected()?this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.expand(i)}):this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.collapse(i)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(i=>this.selectedThematics.select(i)):(this.thematics.forEach(i=>{-1===this.groups.indexOf(i.name)&&this.selectedThematics.select(i)}),this.childrens.forEach(i=>{this.selectedThematics.selected.find(n=>n.source===i.source)||this.selectedThematics.select(i)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(n=>this.selectedThematics.deselect(n)):this.selectAll(t);const i=[];for(const n of this.selectedThematics.selected)i.push(n);this.treeControl.expand(t),this.thematicChange.emit(i)}onToggleChange(t){let i=!1;void 0!==this.selectedThematics.selected.find(g=>g.source===t.source)&&(i=!0),this.childrens.forEach(g=>{g===t&&!1===i&&this.selectedThematics.select(g),g===t&&!0===i&&this.selectedThematics.deselect(g)}),this.thematics.forEach(g=>{g===t&&!1===i&&this.selectedThematics.select(g),g===t&&!0===i&&this.selectedThematics.deselect(g)});const n=[];for(const g of this.selectedThematics.selected)n.push(g);this.thematicChange.emit(n)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,vt.o)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===K.Predefined){if(this.selectedItemType===j.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===j.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===K.Polygon||this.type===K.Point){if(this.selectedItemType===j.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===j.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===j.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===Zt.K8.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===K.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===Zt.K8.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===Zt.K8.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===Zt.K8.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===Zt.K8.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:V.G8.UnsanitizedHTML},i={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:V.G8.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,i]}}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(x),e.GI1(P.mi),e.GI1(C.ov))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},standalone:!0,features:[e.UHJ],decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","expand-more","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"expand-more",3,"matTooltip","click"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"]],template:function(i,n){1&i&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.wVc(3,"async"),e.I0R(4,"div",1),e.yuY(5,m,3,5,"mat-slide-toggle",2)(6,O,3,5,"mat-slide-toggle",2),e.C$Y(),e.yuY(7,ie,7,8,"div",3)(8,Ne,7,8,"div",4),e.I0R(9,"mat-label",5),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-radio-group",6),e.yuY(13,it,3,4,"mat-radio-button",7),e.C$Y(),e.yuY(14,bo,11,5,"div",8),e.I0R(15,"div",9),e.yuY(16,ci,3,4,"button",10)(17,Ko,3,4,"button",11),e.I0R(18,"button",12),e.qCj("click",function(){return n.toggleSearchButton()}),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.I0R(21,"button",13),e.qCj("click",function(){return n.clearButton()}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",14),e.qCj("click",function(){return n.export.emit()}),e.OEk(25),e.wVc(26,"translate"),e.C$Y()(),e.yuY(27,Ti,4,3,"button",15)(28,Xn,3,3,"div",16)),2&i&&(e.E7m("formControl",n.formControl)("map",n.map)("geometryType",n.geometryType)("drawGuide",e.kDX(1,29,n.drawGuide$))("measure",n.measure)("drawControlIsActive",n.drawControlIsActive)("freehandDrawIsActive",n.freehandDrawIsActive)("drawStyle",e.kDX(2,31,n.drawStyle$))("overlayStyle",e.kDX(3,33,n.overlayStyle$))("radius",n.radius)("predefinedRadius",n.predefinedRadius),e.yG2(5),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()),e.yG2(),e.E7m("ngIf",n.isPoint()),e.yG2(2),e.oRS("",e.kDX(11,35,"igo.geo.spatialFilter.search")," :\n"),e.yG2(2),e.E7m("value",n.selectedItemType),e.yG2(),e.E7m("ngForOf",n.itemType),e.yG2(),e.E7m("ngIf","Thematics"===n.selectedItemType&&!n.tableTemplate||"Thematics"===n.selectedItemType&&n.tableTemplate&&!n.listIsVisible),e.yG2(2),e.E7m("ngIf",n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()||n.isPoint()),e.yG2(),e.E7m("disabled",n.disableSearchButton()),e.yG2(),e.oRS(" ",e.kDX(20,37,"igo.geo.spatialFilter.goSearch")," "),e.yG2(2),e.E7m("disabled",0===n.allLayers.length),e.yG2(),e.oRS(" ",e.kDX(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.yG2(2),e.E7m("disabled",!n.store.entities$.getValue().length),e.yG2(),e.oRS(" ",e.kDX(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.yG2(2),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&!n.listIsVisible),e.yG2(),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&n.listIsVisible))},dependencies:[q,Z.y,Z.ot,Z.O4,Z.ue,Z.sl,Z.ug,o.u_,ut.GE,ut.cP,ve.wb,ve.Up,ve.w5,yt.cN,yt.yi,ye.d5,ye.kX,ne.I5,o.Iw,ne.Ax,Me.yk,Me.cv,Me.cT,We.If,We.wL,We.ie,We.aG,We.Af,We.gx,We.qC,We.yC,We._I,me.Vn,me.WK,v.qC,v.kJ,v.S_,v.BN,v.BD,v.kB,v.Mx,R.oJ,R.Gw,R.um,L.oB,L.qL,_.KO,_.a4,V.Eh,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex-flow:column nowrap;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}"],changeDetection:0})}return l})();var pc=r(11484),Ei=r(45076);function mc(l,f){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.properties.nom," ")}}function gc(l,f){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}let Ua=(()=>{class l{spatialFilterService;messageService;get store(){return this._store}set store(t){this._store=t}_store;get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}_queryType;get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=Ei.K8.Meters;formControl=new Z.yM;bufferFormControl=new Z.yM;get measureUnits(){return[Ei.K8.Meters,Ei.K8.Kilometers]}zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;formValueChanges$$;bufferValueChanges$$;constructor(t,i){this.spatialFilterService=t,this.messageService=i}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(i=>{const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return i.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,vt.o)(500),(0,pc.a)()).subscribe(t=>{this.measureUnit===Ei.K8.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,K.Predefined,t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===Ei.K8.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,K.Predefined,1e3*t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===Ei.K8.Meters&&t>1e5||this.measureUnit===Ei.K8.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(i=>{this.selectedZone=i,this.zoneChange.emit(i)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===Ei.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}static \u0275fac=function(i){return new(i||l)(e.GI1(x),e.GI1(P.mi))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:23,vars:23,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(i,n){if(1&i&&(e.I0R(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",2,3),e.wVc(7,"translate"),e.I0R(8,"mat-autocomplete",4,5),e.qCj("optionSelected",function(b){return n.onZoneChange(b.option.value)}),e.yuY(10,mc,2,2,"mat-option",6),e.wVc(11,"async"),e.C$Y()(),e.I0R(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.wR5(18,"input",9),e.wVc(19,"translate"),e.C$Y(),e.I0R(20,"mat-form-field",10)(21,"mat-select",11),e.qCj("selectionChange",function(b){return n.onMeasureUnitChange(b.value)}),e.yuY(22,gc,3,4,"mat-option",6),e.C$Y()()()()()),2&i){const g=e.Gew(9);e.yG2(3),e.cNF(e.kDX(4,13,"igo.geo.spatialFilter.listLabel")),e.yG2(2),e._6D("placeholder",e.kDX(7,15,"igo.geo.spatialFilter.listLabel")),e.E7m("formControl",n.formControl)("matAutocomplete",g),e.yG2(3),e.E7m("displayWith",n.displayFn),e.yG2(2),e.E7m("ngForOf",e.kDX(11,17,n.store.view.all$())),e.yG2(6),e.cNF(e.kDX(17,19,"igo.geo.spatialFilter.buffer")),e.yG2(2),e._6D("placeholder",e.kDX(19,21,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",n.bufferFormControl)("value",0)("readonly",!n.zone),e.yG2(3),e.E7m("value",n.measureUnit),e.yG2(),e.E7m("ngForOf",n.measureUnits)}},dependencies:[ve.wb,ve.Up,ve.w5,yt.cN,yt.yi,Z.y,Z.ot,Z.O4,Z.ue,Kt.U1,Kt.e,ne.I5,Kt.cG,Z.sl,Z.ug,o.Iw,ne.Ax,ye.d5,ye.kX,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}"],changeDetection:0})}return l})();var bs=r(18268);function hc(l,f){if(1&l&&(e.I0R(0,"mat-option",8),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.terrapi."+t)," ")}}let Ya=(()=>{class l{get store(){return this._store}set store(t){this._store=t}_store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new Z.yM(0);spatialType=K;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new e._w7;eventQueryType=new e._w7;zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;constructor(){}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=K.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:22,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"mat-tab-group",0),e.qCj("selectedIndexChange",function(b){return n.selectedTypeIndex.setValue(b)})("selectedTabChange",function(b){return n.onTypeChange(b)}),e.I0R(1,"mat-tab",1),e.wVc(2,"translate"),e.I0R(3,"mat-form-field")(4,"mat-label"),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-select",2),e.qCj("selectionChange",function(){return n.onSelectionChange()}),e.iHE("valueChange",function(b){return e.kNx(n.selectedQueryType,b)||(n.selectedQueryType=b),b}),e.yuY(8,hc,3,4,"mat-option",3),e.C$Y()(),e.I0R(9,"igo-spatial-filter-list",4),e.qCj("zoneChange",function(b){return n.zoneChange.emit(b)})("zoneWithBufferChange",function(b){return n.zoneWithBufferChange.emit(b)})("bufferChange",function(b){return n.bufferChange.emit(b)})("measureUnitChange",function(b){return n.measureUnitChange.emit(b)}),e.C$Y()(),e.I0R(10,"mat-tab",1),e.wVc(11,"translate"),e.I0R(12,"div",5)(13,"mat-button-toggle-group",6),e.qCj("change",function(b){return n.onDrawTypeChange(b.value)}),e.I0R(14,"mat-button-toggle",7),e.wVc(15,"translate"),e.I0R(16,"mat-icon"),e.OEk(17,"pentagon"),e.C$Y()(),e.I0R(18,"mat-button-toggle",7),e.wVc(19,"translate"),e.I0R(20,"mat-icon"),e.OEk(21,"circle"),e.C$Y()()()()()()),2&i&&(e.E7m("selectedIndex",n.selectedTypeIndex.value),e.yG2(),e.E7m("label",e.kDX(2,15,"igo.geo.spatialFilter.predefined")),e.yG2(4),e.cNF(e.kDX(6,17,"igo.geo.spatialFilter.searchLabel")),e.yG2(2),e.OKB("value",n.selectedQueryType),e.yG2(),e.E7m("ngForOf",n.queryType),e.yG2(),e.E7m("store",n.store)("queryType",n.selectedQueryType)("zone",n.zone)("layers",n.layers),e.yG2(),e.E7m("label",e.kDX(11,19,"igo.geo.spatialFilter.draw")),e.yG2(3),e.E7m("value",n.activeDrawType),e.yG2(),e.E7m("value",n.spatialType.Polygon)("matTooltip",e.kDX(15,21,"igo.geo.spatialFilter.drawPolygon")),e.yG2(4),e.E7m("value",n.spatialType.Point)("matTooltip",e.kDX(19,23,"igo.geo.spatialFilter.drawCircle")))},dependencies:[bs.WG,bs.aJ,bs._q,ve.wb,ve.Up,ve.w5,ye.d5,ye.kX,ne.I5,o.Iw,ne.Ax,Ua,he.ue,he.gn,he.KU,_.KO,_.a4,L.oB,L.qL,C._s,G.sD],styles:["[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return l})();var Sr=r(6056);function fc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field"),e.wR5(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.I0R(5,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.date,n)||(g.date=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleDateChange(n))}),e.wVc(6,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(4),i=e.GaO(2);e.yG2(2),e.E7m("for",t),e.yG2(),e.E7m("type",i.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(6,9,"igo.geo.timeFilter.date")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",i.date),e.E7m("min",i.min)("max",i.max)}}function yc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field"),e.wR5(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.I0R(6,"input",10),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.startDate,n)||(g.startDate=n),e.CGJ(n)}),e.qCj("input",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.startDate)})("dateChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleDateChange(n))}),e.wVc(7,"translate"),e.C$Y()()(),e.I0R(8,"div",8)(9,"mat-form-field"),e.wR5(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.I0R(13,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.endDate,n)||(g.endDate=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleDateChange(n))}),e.wVc(14,"translate"),e.C$Y()()()()}if(2&l){const t=e.Gew(5),i=e.Gew(12),n=e.GaO(2);e.yG2(3),e.E7m("for",t),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(7,18,"igo.geo.timeFilter.startDate")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",n.startDate),e.E7m("min",n.min)("max",n.getRangeMaxDate()),e.yG2(4),e.E7m("for",i),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(14,20,"igo.geo.timeFilter.endDate")),e.E7m("matDatetimepicker",i),e.OKB("ngModel",n.endDate),e.E7m("min",n.getRangeMinDate())("max",n.max)}}function _c(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,fc,7,11,"div",2)(2,yc,15,22,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function Cc(l,f){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function vc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.year,n)||(g.year=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleYearChange(n))}),e.wVc(3,"translate"),e.yuY(4,Cc,2,2,"mat-option",13),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(2),e._6D("placeholder",e.kDX(3,3,"igo.geo.timeFilter.date")),e.OKB("ngModel",t.year),e.yG2(2),e.E7m("ngForOf",t.listYears)}}function Sc(l,f){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function bc(l,f){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Oc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.startYear,n)||(g.startYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleYearChange(n))}),e.wVc(4,"translate"),e.yuY(5,Sc,2,2,"mat-option",13),e.C$Y()()(),e.I0R(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.endYear,n)||(g.endYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.handleYearChange(n))}),e.wVc(9,"translate"),e.yuY(10,bc,2,2,"mat-option",13),e.C$Y()()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e._6D("placeholder",e.kDX(4,6,"igo.geo.timeFilter.startDate")),e.OKB("ngModel",t.startYear),e.yG2(2),e.E7m("ngForOf",t.startListYears),e.yG2(3),e._6D("placeholder",e.kDX(9,8,"igo.geo.timeFilter.endDate")),e.OKB("ngModel",t.endYear),e.yG2(2),e.E7m("ngForOf",t.endListYears)}}function Ic(l,f){if(1&l&&(e.I0R(0,"div"),e.yuY(1,vc,5,5,"div",2)(2,Oc,11,10,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function wc(l,f){if(1&l&&(e.I0R(0,"p",25),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.year)}}function Tc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",15)(1,"span"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-slider",16,17)(5,"input",18,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(6),g=e.Gew(4),b=e.GaO();return e.CGJ(b.handleSliderYearChange({source:n,parent:g,value:n.value}))})("change",function(){e.usT(t);const n=e.Gew(6),g=e.Gew(4),b=e.GaO();return e.CGJ(b.handleSliderYearChange({source:n,parent:g,value:n.value}))}),e.C$Y()(),e.I0R(7,"span"),e.OEk(8),e.C$Y(),e.yuY(9,wc,2,1,"p",20),e.I0R(10,"div",21,22)(12,"mat-slide-toggle",23),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFilterState())}),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"button",24),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.playYear(n))}),e.I0R(15,"mat-icon"),e.OEk(16),e.C$Y()(),e.I0R(17,"button",24),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.resetFilter(n))}),e.I0R(18,"mat-icon"),e.OEk(19),e.C$Y()()()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(t.startYear),e.yG2(),e._6D("step",t.step),e.E7m("min",t.startYear)("max",t.endYear)("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.endYear),e.yG2(),e.E7m("ngIf",t.options.enabled),e.yG2(3),e.E7m("matTooltip",e.kDX(13,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.yG2(2),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.cNF(t.playIcon),e.yG2(),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.cNF(t.resetIcon)}}function Ec(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-slider",26,17),e.qCj("selectionChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.handleSliderDateChange(n))}),e.I0R(3,"input",27,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(4),g=e.Gew(2),b=e.GaO();return e.CGJ(b.handleSliderDateChange({source:n,parent:g,value:n.value}))}),e.C$Y()(),e.I0R(5,"p",25),e.OEk(6),e.C$Y(),e.I0R(7,"button",28),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.playFilter(n))}),e.I0R(8,"mat-icon"),e.OEk(9),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e._6D("step",t.step),e.E7m("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max)),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.handleSliderTooltip()),e.yG2(3),e.cNF(t.playIcon)}}let Va=(()=>{class l{dateAdapter;layer;options;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];set currentValue(t){if(t&&this.type!==h.U.YEAR){const i=t.split("/");if(i.length>0){const n=new Date(i[0]),g=new Date(i[1]);isNaN(n.valueOf())||(this.startDate=n),isNaN(g.valueOf())||(this.endDate=g)}}}interval;playIcon="play_circle";resetIcon="replay";change=new e._w7;yearChange=new e._w7;mySlider;get type(){return void 0===this.options.type?h.U.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==h.D.SLIDER&&this.options.range}get style(){return void 0===this.options.style?h.D.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case h.U.DATE:case h.U.DATETIME:t=108e5;break;case h.U.TIME:t=36e5;break;case h.U.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}constructor(t){this.dateAdapter=t,this.dateAdapter.setLocale("fr")}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===h.D.SLIDER&&this.type===h.U.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const i=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==h.D.SLIDER||this.type!==h.U.YEAR){if(this.isRange&&this.style===h.D.CALENDAR&&this.type===h.U.YEAR&&i){this.startYear=parseInt(i.substr(0,4),10),this.endYear=parseInt(i.substr(5,4),10);const n=[],g=[];for(let b=this.initStartYear;b<this.endYear;b++)n.push(b);for(let b=this.startYear+1;b<=this.initEndYear;b++)g.push(b);this.startListYears=n,this.endListYears=g}}else this.year=i?new Date(i.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let i=this.startYear+1;i<=this.initEndYear;i++)this.endListYears.push(i);this.startListYears=[];for(let i=this.initStartYear+1;i<this.endYear;i++)this.startListYears.push(i);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let i;return i=t?new Date(t):new Date(this.min),i.getTime()}setSliderThumbLabel(t){const i=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);i&&(i.textContent=t)}findThumbLabel(t){let i;return t.forEach(n=>{"mat-slider-thumb-label-text"===n.className&&(i=n),n.children.length>0&&!i&&(i=this.findThumbLabel(n.childNodes))},this),i}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&h.D.SLIDER&&this.type===h.U.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&h.D.SLIDER&&this.type===h.U.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(i=>{let n;const g=new Date(i.max);n=void 0===i.date?i.min.getTime():i.date.getTime(),n+=i.mySlider.step,i.date=new Date(n),n>g.getTime()&&i.stopFilter(),i.handleDateChange({value:i.date,date:i.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){return!0!==this.options.current&&this.min||(this.date=this.getRoundedDate(new Date)),this.type===h.U.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case h.U.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case h.U.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===h.D.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case h.U.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case h.U.TIME:if(this.style===h.D.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),i=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(i)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),i=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(i)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,i=10){const n=6e4*i;return new Date(Math.round(t.getTime()/n)*n)}getStepDefinition(t){return Ze().duration(t).asMilliseconds()}static \u0275fac=function(i){return new(i||l)(e.GI1(ne.Wu))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-form"]],viewQuery:function(i,n){if(1&i&&e.CC$(Xt.Cg,5),2&i){let g;e.wto(g=e.Gqi())&&(n.mySlider=g.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},standalone:!0,features:[e.UHJ],decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],[3,"type","openOnFocus","timeInterval"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["ngSlider",""],["matSliderThumb","",3,"value","input","change"],["ngSliderThumb","matSliderThumb"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"step","min","max","selectionChange"],["matSliderThumb","",3,"value","input"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,n){1&i&&(e.yuY(0,_c,3,2,"div",0)(1,Ic,3,2,"div",0),e.wR5(2,"br"),e.yuY(3,Tc,20,19,"div",1)(4,Ec,10,6,"div",2)),2&i&&(e.E7m("ngIf","calendar"===n.style&&"year"!==n.type),e.yG2(),e.E7m("ngIf","calendar"===n.style&&"year"===n.type),e.yG2(2),e.E7m("ngIf",!n.isRange&&"slider"===n.style&&"year"===n.type),e.yG2(),e.E7m("ngIf","slider"===n.style&&"year"!==n.type))},dependencies:[o.u_,ve.wb,ve.Up,ve.Gm,Sr._W,Sr.yA,Sr.eO,Sr.MH,ne.Ko,yt.cN,yt.yi,Z.y,Z.ot,Z.ue,Z._G,ye.d5,ye.kX,ne.I5,o.Iw,ne.Ax,Xt.yO,Xt.Cg,Xt._s,ut.GE,ut.cP,_.KO,_.a4,R.oJ,R.um,L.oB,L.qL,C._s,G.sD],styles:["[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}return l})();const xc=l=>({disabled:l});function Mc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",11),e.wVc(4,"async"),e.OEk(5),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,xc,!1===e.kDX(4,8,t.inResolutionRange$))),e.yG2(2),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}const Dc=l=>({cursor:l});function Fc(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.OEk(2," expand_less "),e.C$Y(),e.I0R(3,"span",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(4),e.C$Y(),e.yuY(5,Mc,6,12,"button",9),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(2);e.yG2(),e.E7m("target",i)("collapsed",t.filtersCollapsed),e.yG2(2),e.E7m("ngStyle",e.S45(5,Dc,t.filtersCollapsed?"default":"pointer")),e.yG2(),e.cNF(t.layer.title),e.yG2(),e.E7m("ngIf",t.header)}}function Pc(l,f){if(1&l&&e.wR5(0,"igo-layer-legend",12),2&l){const t=e.GaO();e.E7m("layer",t.layer)}}let br=(()=>{class l{timeFilterService;color="primary";showLegend$=new ue.g(!1);inResolutionRange$=new ue.g(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(t){this.timeFilterService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(T))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},standalone:!0,features:[e.M5G([T]),e.UHJ],decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","",3,"ngStyle","click"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass"],[3,"layer"]],template:function(i,n){1&i&&(e.yuY(0,Fc,6,7,"mat-list-item",0),e.I0R(1,"div",1,2)(3,"div",3,4),e.yuY(5,Pc,1,1,"igo-layer-legend",5),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"igo-time-filter-form",6),e.qCj("change",function(b){return n.handleDateChange(b)})("yearChange",function(b){return n.handleYearChange(b)}),e.C$Y()()),2&i&&(e.E7m("ngIf",n.header),e.yG2(5),e.E7m("ngIf",e.kDX(6,5,n.showLegend$)),e.yG2(2),e.E7m("layer",n.layer)("options",n.datasource.options.timeFilter)("currentValue",n.datasource.options.params.TIME))},dependencies:[o.u_,de.iI,de.g9,de.Y1,de.UV,de.At,L.oB,L.qL,le.mK,o.Qt,R.oJ,R.um,_.KO,_.a4,o.QF,Et,Va,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]})}return l})();function Rc(l,f){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.I0R(2,"mat-icon",3),e.OEk(3,"history"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function Lc(l,f){if(1&l&&e.wR5(0,"igo-time-filter-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("layer",t.layer)}}function Gc(l,f){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,Lc,1,2,"igo-time-filter-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let ja=(()=>{class l{options;get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&e.yuY(0,Rc,4,5,"button",0)(1,Gc,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter),e.yG2(),e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter))},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,M.g,M.S,br,s.qU,C._s,G.sD],changeDetection:0})}return l})();function $c(l,f){if(1&l&&e.wR5(0,"igo-time-filter-item",2),2&l){const t=f.$implicit;e.E7m("header",!0)("layer",t)}}let Os=(()=>{class l{cdRef;get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}_layers=[];constructor(t){this.cdRef=t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},standalone:!0,features:[e.UHJ],decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,$c,1,2,"ng-template",1),e.wVc(2,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.g7$(2,3,n.layers,"time")))},dependencies:[s.yM,o.Iw,br,s.qU,ri],encapsulation:2,changeDetection:0})}return l})(),Ka=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(Os,2),e.GI1(Jo.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoTimeFilterListBinding",""]],standalone:!0})}return l})();function Ac(l,f){if(1&l&&(e.I0R(0,"button",1),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"file_save"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let Wa=(()=>{class l{get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(){}get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof k.Md&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"]],template:function(i,n){1&i&&e.yuY(0,Ac,4,4,"button",0),2&i&&e.E7m("ngIf",n.layerIsExportable())},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,C._s,G.sD],changeDetection:0})}return l})();var Is=r(37752),kc=r(38776),io=r(62004),Gt=r(43168),Wi=r(53404),ws=r(93176),Or=r(7036);let Ts=(()=>{class l{styleList={};httpClient;constructor(t){this.httpClient=new u.KK(t)}getStyleList(t){return Gt.Yv.resolve(this.styleList,t)}load(t){const i=t.default||{};return t.path?new Promise((n,g)=>{this.httpClient.get(t.path).pipe((0,Ge.a)(b=>(console.log(`StyleList file ${t.path} could not be read`),n(!0),(0,Xe.c)(b.error||"Server error")))).subscribe(b=>{this.styleList=Gt.Yv.mergeDeep(i,b),n(!0)})}):(this.styleList=i,!0)}static \u0275fac=function(i){return new(i||l)(e.CoB(u.m))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Jn=r(82048),Bc=r(83900),Uc=r(52280);class Na extends Error{}class Es extends Na{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Es.prototype)}}class Ir extends Na{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,Ir.prototype)}}const ft=(0,Gt.GC)(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),Wo=(0,Gt.GC)(["UTF8","LATIN1"]);let wr=(()=>{class l{config;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(t){this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");const i=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==i&&(this.aggregateInComment=i)}export(t,i,n,g,b="EPSG:4326",B="EPSG:4326"){const pe=this.generateFeature(t,i,"_featureStore");return this.exportAsync(pe,i,n,g,b,B)}generateFeature(t,i,n="_"){return i===ft.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(g=>{let b=g.getKeys().filter(pe=>!pe.startsWith(n));i===ft.Shapefile&&g.get("_style")&&JSON.stringify(g.get("_style")).length>255&&(b=b.filter(fe=>"_style"!==fe));const B=b.reduce((pe,fe)=>(pe[fe]=g.get(fe),pe),{geometry:g.getGeometry()});return new Po.c(B)})}generateAggregatedFeature(t){return t.map(i=>{const n=i.getKeys().filter(pe=>!pe.startsWith("_"));let g="";const b=n.reduce((pe,fe)=>(fe&&"geometry"!==fe&&("id"===fe&&i.get("draw")?g+=fe+":"+i.get("draw")+"   \r\n":g+=fe+":"+i.get(fe)+"   \r\n"),pe[fe]=i.get(fe),pe),{geometry:i.getGeometry()}),B=new Po.c(b);return B.set("name",i.getId()),B.set("cmt",g),B})}exportAsync(t,i,n,g,b,B){return new Tt._(fe=>{if(this.nothingToExport(t,i))fe.error(new Ir);else if(Object.keys(l.ogreFormats).indexOf(i)>=0){if(!this.ogreUrl)return void(l.noOgreFallbacks.indexOf(i)>=0?this.exportToFile(t,fe,i,n,b,B):fe.error(new Es));this.exportWithOgre(t,fe,i,n,g,b,B)}else this.exportToFile(t,fe,i,n,b,B)})}exportToFile(t,i,n,g,b,B){const fe=(new Bc[n]).writeFeatures(t,{dataProjection:B,featureProjection:b,featureType:"feature",featureNS:"http://example.com/feature"}),Fe=`${g}.${n.toLowerCase()}`;(0,Gt.We)(fe,"attachment/plain;charset=utf-8",Fe),i.complete()}exportWithOgre(t,i,n,g,b,B,pe){let fe=(new po.c).writeFeatures(t,{dataProjection:pe,featureProjection:B});const Fe=`${this.ogreUrl}/convertJson`,Ee=document.createElement("form");if(Ee.style.display="none",document.body.appendChild(Ee),Ee.setAttribute("method","post"),Ee.setAttribute("target","_blank"),Ee.setAttribute("action",Fe),b===Wo.UTF8)Ee.acceptCharset="UTF-8",Ee.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(b===Wo.LATIN1){const Ct="ISO-8859-1",Bt=JSON.parse(fe);Bt.features.map(Ro=>{const vn=String.fromCharCode.apply(null,(0,Uc.OW)(JSON.stringify(Ro.properties),{mode:"replacement"}));Ro.properties=JSON.parse(vn)}),fe=JSON.stringify(Bt);const uo=document.createElement("input");uo.setAttribute("type","hidden"),uo.setAttribute("name","encoding"),uo.setAttribute("value",Ct),Ee.appendChild(uo)}if("CSVsemicolon"===n){const Ct=document.createElement("input");Ct.setAttribute("type","hidden"),Ct.setAttribute("name","lco"),Ct.setAttribute("value","SEPARATOR=SEMICOLON"),Ee.appendChild(Ct)}const Ae=document.createElement("input");Ae.setAttribute("type","hidden"),Ae.setAttribute("name","json"),Ae.setAttribute("value",fe),Ee.appendChild(Ae);const Je=document.createElement("input");let ke="Shapefile"===n?`${g}.zip`:`${g}.${n.toLowerCase()}`;("CSVcomma"===n||"CSVsemicolon"===n)&&(ke=`${g}.csv`),ke=ke.replace(" ","_"),ke=ke.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),Je.setAttribute("type","hidden"),Je.setAttribute("name","outputName"),Je.setAttribute("value",ke),Ee.appendChild(Je);let et=l.ogreFormats[n];("CSVcomma"===n||"CSVsemicolon"===n)&&(et="CSV");const lt=document.createElement("input");lt.setAttribute("type","hidden"),lt.setAttribute("name","format"),lt.setAttribute("value",et),Ee.appendChild(lt),Ee.submit(),document.body.removeChild(Ee),i.complete()}nothingToExport(t,i){return 0===t.length||"GPX"===i&&void 0===t.find(g=>["Point","LineString","MultiLineString"].indexOf(g.getGeometry().getType())>=0)}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Ha=r(17439),za=r(51176),Xa=r(79084);class fn extends Error{}class Tr extends fn{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Tr.prototype)}}class Ni extends fn{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,Ni.prototype)}}class Er extends fn{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Er.prototype)}}class Wc extends fn{constructor(){super("File is too large"),Object.setPrototypeOf(this,Er.prototype)}}class Nc extends fn{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Er.prototype)}}class xs extends fn{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,xs.prototype)}}var Qn=r(14672),xr=r(59800);function Mr(l){return l.toString().padStart(2,"0")}function Dr(l,f,t,i,n,g,b,B,pe){if(0===f.length)return void function Zc(l,f){f.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:l.name,mimeType:l.type})}(l,n);let fe=Ms(l);(b?b.open("igo.geo.import.promptStoreToIdb"):(0,Ve.of)(!1)).pipe((0,zn.K)()).subscribe(Ee=>{const Ae=new Date,Je=[Ae.getFullYear(),Mr(Ae.getMonth()+1),Mr(Ae.getDate())].join("/")+" "+[Mr(Ae.getHours()),Mr(Ae.getMinutes())].join(":");fe=Ee?`${fe} (${Je})`:fe,B?function zc(l,f,t,i,n,g,b,B,pe=!0){const fe=l.map(ke=>(0,Qn.K6)(ke,f.projection));let Fe,Ee,Ae;if(i.getStyleList(t.toString()+".styleByAttribute")){const ke=i.getStyleList(t.toString()+".styleByAttribute");Fe=(et,lt)=>n.createStyleByAttribute(et,ke,lt)}else if(i.getStyleList(t.toString()+".clusterStyle")){const ke=i.getStyleList(t.toString()+".clusterParam");Ee=i.getStyleList(t.toString()+".distance"),Fe=(et,lt)=>{const Ct=n.createStyle(i.getStyleList(t.toString()+".clusterStyle"),et,lt);return n.createClusterStyle(et,lt,ke,Ct)}}else if(i.getStyleList(t.toString()+".style"))Fe=(ke,et)=>n.createStyle(i.getStyleList(t.toString()+".style"),ke,et);else if(i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type){const ke=i.getStyleList("default.clusterParam");Ee=i.getStyleList("default.distance"),Fe=(et,lt)=>{const Ct=n.createStyle(i.getStyleList("default.clusterStyle"),et,lt);return n.createClusterStyle(et,lt,ke,Ct)}}else Fe=(ke,et)=>n.createStyle(i.getStyleList("default.style"),ke,et);i.getStyleList(t.toString()+".clusterStyle")?(Ae=new ws.a(Object.assign({distance:Ee,type:"cluster",queryable:!0},b)),Ae.ol.source.addFeatures(fe)):i.getStyleList(t.toString())?(Ae=new Ii.E(Object.assign({type:"vector",queryable:!0},b)),Ae.ol.addFeatures(fe)):i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type?(Ae=new ws.a(Object.assign({distance:Ee,type:"cluster",queryable:!0},b)),Ae.ol.source.addFeatures(fe)):(Ae=new Ii.E(Object.assign({type:"vector",queryable:!0},b)),Ae.ol.addFeatures(fe));const Je=new wi.M(Object.assign({title:t,id:g||(0,Gt.uq)(),isIgoInternalLayer:!0,source:Ae,style:Fe},B));f.addLayer(Je),pe&&(0,Qn.QX)(f.viewController,fe)}(f,t,fe,B,pe):function Hc(l,f,t,i,n,g=!1){const b=l.map(Je=>(0,Qn.K6)(Je,f.projection)),B=(0,Gt.uq)(),fe=new Ii.E({id:B,type:"vector",queryable:!0});fe.ol.addFeatures(b);let Fe,Ee=!1;b[0].getKeys().includes("_style")||b[0].getKeys().includes("_mapTitle")?Fe=(0,xr.M4)():(Fe=(0,xr.Cy)(),Ee=!0);const Ae=n.createLayer({id:B,title:i,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:fe,igoStyle:{editable:Ee},idbInfo:{firstLoad:!0,storeToIdb:g,contextUri:t||"*"},style:Fe});Ae.setExtent((0,Qn.q1)(b,f.viewProjection)),f.addLayer(Ae),(0,Qn.QX)(f.viewController,b)}(f,t,i,fe,g,Ee),n.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:fe})})}function Xc(l,f,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:l.name,mimeType:l.type})}function Jc(l,f,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:l.name})}function Qc(l,f,t,i){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:l.name,size:i})}function qc(l,f){f.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:l.name,mimeType:l.type})}function eu(l,f,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function Qa(l){return l.name.split(".").pop().toLowerCase()}function Ms(l){return l.name.substr(0,l.name.lastIndexOf("."))}let Za=(()=>{class l{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(t,i){this.http=t,this.config=i;const n=this.config.getConfig("importExport");this.ogreUrl=n.url,this.clientSideFileSizeMax=(n.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),n.formats&&(l.allowedExtensions=n.formats.map(b=>l.formatExtensionAssociation[b]).filter(b=>b),l.allowedExtensions.includes("geojson")&&l.allowedExtensions.push("json"))}import(t,i="EPSG:4326",n="EPSG:4326"){return this.importAsync(t,i,n)}getFileImporter(t){const i=Qa(t),n=l.allowedExtensions;let g=[];n.includes("zip")&&(g=l.allowedZipMimeTypes);const b=t.type;if(!([...l.allowedMimeTypes,...g].indexOf(b)<0&&n.indexOf(i)<0)){if("application/json"===b||["json","geojson","kml","gpx"].indexOf(i)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,i,n){return new Tt._(b=>{if(t.size>=this.clientSideFileSizeMax)return void b.error(new Wc);const B=this.getFileImporter(t);void 0!==B?B.call(this,t,b,i,n):b.error(new Tr)})}importFile(t,i,n,g){const b=new FileReader;b.onload=B=>{try{const pe=this.parseFeaturesFromFile(t,B.target.result,n,g);i.next(pe)}catch{i.error(new Ni)}i.complete()},b.onerror=B=>{i.error(new Ni)},b.readAsText(t,"UTF-8")}importFileWithOgre(t,i,n,g){const b=`${this.ogreUrl}/convert`,B=new FormData;B.append("upload",t),B.append("sourceSrs",n),B.append("targetSrs",g),B.append("formatOutput","GEOJSON"),B.append("skipFailures",""),this.http.post(b,B,{headers:new u.UD}).subscribe(pe=>{if(null!==pe)if((pe.errors||[]).length>0)i.error(new Ni);else{const Fe=this.parseFeaturesFromGeoJSON(t,pe,g);i.next(Fe),i.complete()}else i.error(new Ni)},pe=>{pe.error.caught=!0;const fe=pe.error.msg||"";"No valid files found"===fe?i.error(new Tr):fe&&fe.startWith("ERROR 1: Failed to process SRS definition")?i.error(new Nc):i.error(500===pe.status?new xs:new Ni)})}parseFeaturesFromFile(t,i,n,g){const b=Qa(t),B=t.type,pe=new po.c;let fe;if("application/vnd.google-earth.kml+xml"===B)fe=new Ha.cp;else if("application/gml+xml"===B)fe=new za.c;else if("application/gpx+xml"===B)fe=new Xa.c;else switch(b){case"kml":fe=new Ha.cp;break;case"gpx":fe=new Xa.c;break;case"gml":fe=new za.c;break;default:fe=pe}return fe.readFeatures(i,{dataProjection:n,featureProjection:g}).map(Ae=>Object.assign(pe.writeFeatureObject(Ae),{projection:g,meta:{id:(0,Gt.uq)(),title:Ms(t)}}))}parseFeaturesFromGeoJSON(t,i,n){const g=new po.c;return g.readFeatures(i).map(pe=>Object.assign(g.writeFeatureObject(pe),{projection:n,meta:{id:(0,Gt.uq)(),title:Ms(t)}}))}static \u0275fac=function(i){return new(i||l)(e.CoB(u.KK),e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function tu(l,f){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.g7$(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t)," ")}}function ou(l,f){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",t.alias," ")}}function iu(l,f){if(1&l&&(e.I0R(0,"mat-option",14),e.qCj("click",function(i){return i.stopPropagation()}),e.yuY(1,tu,3,4,"p",15)(2,ou,2,1,"p",15),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.E7m("ngIf",t.translateKey),e.yG2(),e.E7m("ngIf",!t.translateKey)}}function nu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",7),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.inputProj,n)||(g.inputProj=n),e.CGJ(n)}),e.yuY(7,iu,3,3,"mat-option",8),e.wVc(8,"async"),e.C$Y()()(),e.I0R(9,"div",9),e.wVc(10,"translate"),e.wVc(11,"translate"),e.I0R(12,"button",10),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.click())}),e.wVc(13,"async"),e.OEk(14),e.wVc(15,"translate"),e.C$Y(),e.wR5(16,"igo-spinner",11),e.wVc(17,"async"),e.I0R(18,"input",12,13),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.value=null)})("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.importFiles(n.target.files))}),e.C$Y()()()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.importForm),e.yG2(4),e.cNF(e.kDX(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.yG2(2),e.OKB("value",t.inputProj),e.yG2(),e.E7m("ngForOf",e.kDX(8,12,t.projections$)),e.yG2(2),e.E7m("matTooltip",t.importForm.invalid?e.kDX(10,14,"igo.geo.importExportForm.projections.choose"):e.kDX(11,16,"igo.geo.importExportForm.importButton")),e.yG2(3),e.E7m("disabled",t.importForm.invalid||e.kDX(13,18,t.loading$)),e.yG2(2),e.oRS(" ",e.kDX(15,20,"igo.geo.importExportForm.importButton")," "),e.yG2(2),e.E7m("shown",e.kDX(17,22,t.loading$)),e.yG2(2),e.m4B("display","none")}}const ru=l=>({size:l});function su(l,f){if(1&l&&(e.I0R(0,"div")(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"ul")(5,"li"),e.OEk(6),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"li"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"li"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.importExportForm.importClarifications")),e.yG2(4),e.oRS(" ",e.g7$(7,6,"igo.geo.importExportForm.importSizeMax",e.S45(13,ru,t.fileSizeMb))," "),e.yG2(3),e.oRS(" ",e.kDX(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),e.yG2(3),e.cNF(e.kDX(13,11,"igo.geo.importExportForm.importShpZip"))}}function au(l,f){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.importHtmlClarifications)}}function lu(l,f){if(1&l&&(e.I0R(0,"section",17),e.yuY(1,su,14,15,"div",18)(2,au,1,1,"igo-custom-html",19),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",""===t.importHtmlClarifications),e.yG2(),e.E7m("ngIf",""!==t.importHtmlClarifications)}}function cu(l,f){1&l&&(e.I0R(0,"section",17)(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function uu(l,f){if(1&l&&(e.I0R(0,"span",31),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.CAO(" (+",t.layers.length-1," ",e.kDX(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function du(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",34),e.qCj("click",function(n){e.usT(t);const g=e.GaO().$implicit,b=e.GaO(2);return e.CGJ(b.onlySelectedClick(n,g.id))})("checked",function(){e.usT(t);const n=e.GaO().$implicit,g=e.GaO(2);return e.CGJ(g.inLayersIdToExportSelectionOnly(n))})("change",function(n){e.usT(t);const g=e.GaO().$implicit,b=e.GaO(2);return e.CGJ(b.onlySelected(n,g.id))}),e.I0R(1,"small"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}const pu=l=>({"igo-export-layer-mat-option":l});function mu(l,f){if(1&l&&(e.I0R(0,"mat-option",32),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",16),e.OEk(2),e.C$Y(),e.I0R(3,"p",16),e.yuY(4,du,4,3,"mat-slide-toggle",33),e.C$Y()()),2&l){const t=f.$implicit,i=e.GaO(2);e.E7m("ngClass",e.S45(4,pu,i.layerHasSelectedFeatures(t)))("value",t.id),e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",i.layerHasSelectedFeatures(t))}}function gu(l,f){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.format."+t.value)," ")}}function hu(l,f){if(1&l&&(e.SAx(0),e.yuY(1,gu,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.formats$)))}}function fu(l,f){1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.export.noFormat.title")," "))}function yu(l,f){1&l&&(e.I0R(0,"div",6)(1,"mat-form-field"),e.wR5(2,"input",37),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e._6D("placeholder",e.kDX(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function _u(l,f){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.encoding."+t.value)," ")}}function Cu(l,f){if(1&l&&(e.SAx(0),e.yuY(1,_u,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(3);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.encodings$)))}}function vu(l,f){if(1&l&&(e.I0R(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",38),e.yuY(6,Cu,4,5,"ng-container",18),e.wVc(7,"async"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(7,4,t.encodings$).length)}}function Su(l,f){1&l&&(e.I0R(0,"div",39)(1,"mat-slide-toggle",40),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function bu(l,f){1&l&&(e.I0R(0,"div",41)(1,"mat-slide-toggle",42),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function Ou(l,f){1&l&&(e.I0R(0,"div",43)(1,"mat-slide-toggle",44),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function Iu(l,f){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.exportHtmlClarifications)}}function wu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",21),e.iHE("valueChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.layers,n)||(g.layers=n),e.CGJ(n)}),e.I0R(7,"mat-select-trigger"),e.OEk(8),e.yuY(9,uu,3,4,"span",22),e.C$Y(),e.yuY(10,mu,5,6,"mat-option",23),e.wVc(11,"async"),e.C$Y()()(),e.I0R(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"mat-select",24),e.yuY(18,hu,4,5,"ng-container",18),e.wVc(19,"async"),e.yuY(20,fu,3,3,"mat-option",25),e.wVc(21,"async"),e.C$Y()()(),e.yuY(22,yu,4,3,"div",26)(23,vu,8,6,"div",26)(24,Su,4,4,"div",27)(25,bu,4,4,"div",28)(26,Ou,4,4,"div",29),e.I0R(27,"div",30)(28,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.handleExportFormSubmit(n.form.value))}),e.wVc(29,"async"),e.OEk(30),e.wVc(31,"translate"),e.wVc(32,"translate"),e.wVc(33,"translate"),e.C$Y(),e.wR5(34,"igo-spinner",11),e.wVc(35,"async"),e.C$Y(),e.yuY(36,Iu,1,1,"igo-custom-html",19),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(4),e.cNF(e.kDX(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.yG2(2),e.OKB("value",t.layers),e.yG2(2),e.oRS(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.yG2(),e.E7m("ngIf",t.layers.length>1),e.yG2(),e.E7m("ngForOf",e.kDX(11,20,t.exportableLayers$)),e.yG2(5),e.cNF(e.kDX(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(19,24,t.formats$).length),e.yG2(2),e.E7m("ngIf",0===e.kDX(21,26,t.formats$).length),e.yG2(2),e.E7m("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.yG2(),e.E7m("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.yG2(),e.E7m("ngIf","URL"!==t.form.value.format),e.yG2(2),e.E7m("disabled",!t.form.valid||e.kDX(29,28,t.loading$)),e.yG2(2),e.oRS(" ","URL"!==t.form.value.format?e.kDX(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.kDX(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.kDX(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.yG2(4),e.E7m("shown",e.kDX(35,36,t.loading$)),e.yG2(2),e.E7m("ngIf",""!==t.exportHtmlClarifications)}}let qa=(()=>{class l{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;cdRef;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new ue.g(void 0);encodings$=new ue.g(void 0);exportableLayers$=new ue.g([]);loading$=new ue.g(!1);forceNaming=!1;controlFormat="format";layers$$;exportableLayers$$;formats$$;encodings$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new ue.g([]);projectionsConstraints;popupChecked=!1;previousLayerSpecs$=new ue.g(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new e._w7;exportOptions$=new ue.g(void 0);exportOptionsChange=new e._w7;get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}constructor(t,i,n,g,b,B,pe,fe,Fe,Ee,Ae,Je,ke){this.importService=t,this.exportService=i,this.languageService=n,this.messageService=g,this.styleListService=b,this.styleService=B,this.formBuilder=pe,this.config=fe,this.cdRef=Fe,this.storageService=Ee,this.downloadService=Ae,this.layerService=Je,this.confirmDialogService=ke,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layers$.subscribe(i=>{this.exportableLayers$.next(i.filter(n=>n instanceof wi.M&&!0===n.exportable||n.dataSource.options.download&&n.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,Wi.O)(i=>!i)).subscribe(i=>{this.form.patchValue(i,{emitEvent:!0}),i.layers&&this.computeFormats(i.layers.map(n=>this.map.getLayerById(n)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(i=>{const n=Object.keys(wr.ogreFormats);!this.popupChecked&&this.form.get("layers").value?.length>1&&(n.indexOf(i)>=0||i===ft.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(i=>{this.handlePreviousLayerSpecs();const n=i instanceof Array?i:[i];this.form.patchValue({layers:n},{emitEvent:!1});const g=n.map(B=>this.map.getLayerById(B));this.computeFormats(g),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const b=[];g.forEach(B=>{B instanceof wi.M&&0===B.dataSource.ol.getFeatures().length&&(b.push({id:B.id,visible:B.visible,opacity:B.opacity,queryable:B.queryable}),B.opacity=0,B.visible=!0)}),this.previousLayerSpecs$.next(b),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,Wi.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({format:i[Object.keys(i)[0]]})}),this.encodings$$=this.encodings$.pipe((0,Wi.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({encoding:i[Object.keys(i)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,Wi.O)(i=>!i)).subscribe(i=>{1===i.length&&this.form.patchValue({layers:i[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(i=>{this.form.patchValue(i===ft.CSVcomma||i===ft.CSVsemicolon?{encoding:Wo.LATIN1}:{encoding:Wo.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=(0,gn.KG)(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){const g=this.projectionsConstraints.mtmZone.maxZone;for(let b=this.projectionsConstraints.mtmZone.minZone;b<=g;b++)t.push({translateKey:"mtm",alias:`MTM ${b}`,code:b<10?`EPSG:3218${b}`:`EPSG:321${80+b}`,zone:`${b}`,extent:void 0,def:void 0})}if(this.projectionsConstraints.utm){const g=this.projectionsConstraints.utmZone.maxZone;for(let b=this.projectionsConstraints.utmZone.minZone;b<=g;b++)t.push({translateKey:"utm",alias:`UTM ${b}`,code:b<10?`EPSG:3260${b}`:`EPSG:326${b}`,zone:`${b}`,extent:void 0,def:void 0})}let i=[];this.projectionsConstraints.projFromConfig&&(i=this.config.getConfig("projections")||[]),this.projections$.next(i.concat(t))}getWorkspaceByLayerId(t){const i=this.store.all().find(n=>n.layer.id===t);if(i)return i}getLayerTitleById(t){return this.map.getLayerById(t)?.title}layerHasSelectedFeatures(t){const i=this.getWorkspaceByLayerId(t.id);if(i)return!!i.entityStore.stateView.firstBy(g=>!0===g.state.selected)}onlySelected(t,i){let n=this.form.value.layersWithSelection;t.checked?n.push(i):n=n.filter(g=>g!==i),this.form.patchValue({layersWithSelection:n})}onlySelectedClick(t,i){this.form.value.layers.find(n=>n===i)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(i=>i===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(i=>{const n=this.map.getLayerById(i.id);n.visible=i.visible,n.opacity=i.opacity,n.queryable=i.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let i=this.inputProj.code;this.espgCodeRegex.test(i)&&(i=`EPSG:${i}`),this.loading$.next(!0);for(const n of t)this.importService.import(n,i).subscribe(g=>this.onFileImportSuccess(n,g),g=>this.onFileImportError(n,g),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const n=window.open("","popup","width=1, height=1");return!n||n.closed||typeof n.closed>"u"||null===n?(this.onPopupBlockedError(t),this.popupAllowed=!1):(n.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const i=Object.keys(wr.ogreFormats);!this.popupChecked&&t.layers.length>1&&(i.indexOf(t.format)>=0||t.format===ft.URL)&&!this.popupAllowed&&this.handlePopup();let n=[],g=[],b="";for(const[B,pe]of t.layers.entries()){const fe=this.map.getLayerById(pe);t.format!==ft.CSVsemicolon&&t.format!==ft.CSVcomma||!t.combineLayers||1===t.layers.length?(b=fe.title,t.name&&(b=t.name)):b=this.languageService.translate.instant("igo.geo.export.combinedLayers");const Fe=fe.dataSource.options;if(t.format===ft.URL&&Fe.download&&(Fe.download.url||Fe.download.dynamicUrl))return void setTimeout(()=>{const ke=Fe.download.url||Fe.download.dynamicUrl;ke.match(/service=wfs/gi)?this.downloadService.open(fe):window.open(ke,"_blank"),this.loading$.next(!1)},500);const Ee=this.getWorkspaceByLayerId(pe);let Ae;if(Ee&&Ee.entityStore&&Ee.entityStore.stateView.all().length)Ae=-1!==t.layersWithSelection.indexOf(pe)&&t.featureInMapExtent?Ee.entityStore.stateView.all().filter(ke=>ke.state.inMapExtent&&ke.state.selected).map(ke=>ke.entity.ol):-1===t.layersWithSelection.indexOf(pe)||t.featureInMapExtent?t.featureInMapExtent?Ee.entityStore.stateView.all().filter(ke=>ke.state.inMapExtent).map(ke=>ke.entity.ol):Ee.entityStore.stateView.all().map(ke=>ke.entity.ol):Ee.entityStore.stateView.all().filter(ke=>ke.state.selected).map(ke=>ke.entity.ol);else{const ke=fe.dataSource.ol;Ae=t.featureInMapExtent?ke.getFeaturesInExtent(fe.map.viewController.getExtent()):ke.getFeatures(),fe.dataSource instanceof ws.a&&(Ae=Ae.flatMap(et=>et.get("features")))}let Je=[];if(t.format===ft.Shapefile||t.format===ft.GPX?Ae.forEach(ke=>{const et=ke.getGeometry().getType(),lt=Je.find(Ct=>Ct.geometryType===et);lt?lt.features.push(ke):Je.push({geometryType:et,features:[ke]})}):Je=[{geometryType:"",features:Ae}],Je.forEach(ke=>{ke.features.forEach(et=>{const lt=et.get("rad");if(lt){const Ct=[et.get("longitude"),et.get("latitude")],Bt=(0,zt.e8)(Ct,lt,500);Bt.transform("EPSG:4326",et.get("_projection")),et.setGeometry(Bt)}})}),t.format===ft.GPX){const ke=Je.length;Je=Je.filter(lt=>["LineString","Point"].includes(lt.geometryType)),ke>Je.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===ft.CSVsemicolon||t.format===ft.CSVcomma)&&t.combineLayers){if(Je.forEach(ke=>n.push(ke)),B!==t.layers.length-1)continue;{let ke;n.forEach(et=>{et.features.forEach(lt=>{if(t.separator)if(ke){if(lt.get("_featureStore").layer.options.title!==ke.get("_featureStore").layer.options.title){const Ct=this.createTitleEmptyRows(ke,lt);g.push(Ct[2]),g.push(Ct[0]),g.push(Ct[1])}}else{const Ct=this.createTitleEmptyRows(lt,lt);g.push(Ct[0])}g.push(lt),ke=lt})})}}0===Je.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==ft.CSVsemicolon&&t.format!==ft.CSVcomma||!t.combineLayers)&&Je.map(ke=>this.exportService.export(ke.features,t.format,b+ke.geometryType,t.encoding,this.map.projection).subscribe(()=>{},et=>this.onFileExportError(et),()=>{this.onFileExportSuccess(),ke.features.forEach(et=>{this.circleToPoint(et)}),this.loading$.next(!1)}))}(t.format===ft.CSVsemicolon||t.format===ft.CSVcomma)&&t.combineLayers&&this.exportService.export(g,t.format,b,t.encoding,this.map.projection).subscribe(()=>{},B=>this.onFileExportError(B),()=>{this.onFileExportSuccess(),g.forEach(B=>{this.circleToPoint(B)}),this.loading$.next(!1)})}createTitleEmptyRows(t,i){const n=i.clone(),g=i.clone(),b=i.clone(),B=t.getKeys();let pe="";for(const ke in B)if("geometry"!==B[ke]){pe=B[ke];break}const fe=i.getKeys();let Fe="";for(const ke in fe)if("geometry"!==fe[ke]){Fe=fe[ke];break}const Ee=i.getKeys();B.forEach(ke=>{Ee.includes(ke)&&ke!==pe&&Ee.push(ke)}),Ee.unshift(pe);let Ae="";for(const ke in Ee)if("geometry"!==Ee[ke]){Ae=Ee[ke];break}return Ee.forEach(ke=>{const et=B.length===fe.length&&B.every((lt,Ct)=>lt===fe[Ct]);ke!==Ae||et?ke===Ae&&et||ke===Fe?(n.set(ke,i.get("_featureStore").layer.options.title,!0),g.set(ke,ke,!0),b.unset(ke,!0)):"geometry"!==ke?(n.unset(ke,!0),g.set(ke,ke,!0),b.unset(ke,!0)):(n.unset(ke,!0),b.unset(ke,!0)):(n.set(ke,i.get("_featureStore").layer.options.title+" ===============>",!0),g.set(ke,ke,!0),b.unset(ke,!0)),fe.includes(ke)||g.unset(ke,!0)}),[n,g,b]}circleToPoint(t){if(t.get("rad")){const n=new Ht.c([t.get("longitude"),t.get("latitude")]);n.transform("EPSG:4326",t.get("_projection")),t.setGeometry(n)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[Z.AQ.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[Z.AQ.required]],layers:[[],[Z.AQ.required]],layersWithSelection:[[]],encoding:[Wo.UTF8,[Z.AQ.required]],combineLayers:[!0,[Z.AQ.required]],separator:[!1,[Z.AQ.required]],featureInMapExtent:[!1,[Z.AQ.required]],name:["",[Z.AQ.required]]}:{format:["",[Z.AQ.required]],layers:[[],[Z.AQ.required]],layersWithSelection:[[]],encoding:[Wo.UTF8,[Z.AQ.required]],combineLayers:[!0,[Z.AQ.required]],separator:[!1,[Z.AQ.required]],featureInMapExtent:[!1,[Z.AQ.required]]})}onFileImportSuccess(t,i){const n=this.config.getConfig("importExport"),g=n?.allowToStoreLayer?this.confirmDialogService:void 0;n?.importWithStyle?Dr(t,i,this.map,this.contextUri,this.messageService,this.layerService,g,this.styleListService,this.styleService):Dr(t,i,this.map,this.contextUri,this.messageService,this.layerService,g)}onFileImportError(t,i){this.loading$.next(!1),function Ja(l,f,t,i){({"Invalid file":Xc,"File is too large":Qc,"Failed to read file":Jc,"Invalid SRS definition":qc,"Error 500 with OGRE":eu})[f.message](l,f,t,i=i||30)}(t,i,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function Vc(l,f){l instanceof Ir?function Kc(l){l.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(f):f.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){const t=this.config.getConfig("importExport.forceNaming");this.forceNaming=void 0!==t&&t,this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===ft.CSVcomma||t===ft.CSVsemicolon?(this.form.patchValue({encoding:Wo.LATIN1}),Wo.LATIN1):(this.form.patchValue({encoding:Wo.UTF8}),Wo.UTF8)}loadEncodings(){this.encodings$.next(Wo)}computeFormats(t){let i=Object.keys(ft);const n={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},g=[];if(t&&t.length)if(t.forEach(B=>{B&&(B.dataSource.options.download?.allowedFormats?(n.customList=!0,g.push({layer:B.title,formats:this.validateListFormat(B.dataSource.options.download.allowedFormats)})):B instanceof wi.M||!B.dataSource.options.download||!B.dataSource.options.download.url?B.dataSource.options.download&&(B.dataSource.options.download.url||B.dataSource.options.download.dynamicUrl)?n.vectorAndUrl=!0:B instanceof wi.M&&(n.onlyVector=!0):n.onlyUrl=!0)}),!0===n.onlyUrl&&!1===n.onlyVector)i=["URL"];else if(!0===n.onlyVector&&!1===n.onlyUrl)this.computeFormats(),ft.URL in this.formats$.value&&(i=Object.keys(this.formats$.value).filter(pe=>"URL"!==pe));else if(!0===n.vectorAndUrl&&!1===n.onlyUrl&&!1===n.onlyVector&&(this.computeFormats(),!(ft.URL in this.formats$.value))){const B=Object.keys(this.formats$.value);B.push("URL"),i=B}const b=this.config.getConfig("importExport.formats");if(b){const B=this.validateListFormat(b);i=i.filter(pe=>B.includes(pe))}if(n.customList){let B;const pe=[];let fe=g[0].formats;g.map(Ee=>{pe.push(Ee.layer),B=Ee.formats.filter(Ae=>fe.includes(Ae)),fe=Ee.formats});const Fe=B.filter(Ee=>i.includes(Ee));Fe.length>0?(this.formats$.next((0,Gt.GC)(Fe)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:pe.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next((0,Gt.GC)(i))}validateListFormat(t){return t.filter(i=>{if(i.toUpperCase()===ft.CSVcomma.toUpperCase()||i.toUpperCase()===ft.CSVsemicolon.toUpperCase()||i.toUpperCase()===ft.GML.toUpperCase()||i.toUpperCase()===ft.GPX.toUpperCase()||i.toUpperCase()===ft.GeoJSON.toUpperCase()||i.toUpperCase()===ft.KML.toUpperCase()||i.toUpperCase()===ft.Shapefile.toUpperCase()||i.toUpperCase()===ft.URL.toUpperCase())return i}).map(i=>i.toUpperCase()===ft.CSVcomma.toUpperCase()?i=ft.CSVcomma:i.toUpperCase()===ft.CSVsemicolon.toUpperCase()?i=ft.CSVsemicolon:i.toUpperCase()===ft.GML.toUpperCase()?i=ft.GML:i.toUpperCase()===ft.GPX.toUpperCase()?i=ft.GPX:i.toUpperCase()===ft.GeoJSON.toUpperCase()?i=ft.GeoJSON:i.toUpperCase()===ft.KML.toUpperCase()?i=ft.KML:i.toUpperCase()===ft.Shapefile.toUpperCase()?i=ft.Shapefile:i.toUpperCase()===ft.URL.toUpperCase()?i=ft.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function jc(l){l.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}static \u0275fac=function(i){return new(i||l)(e.GI1(Za),e.GI1(wr),e.GI1(C.ov),e.GI1(P.mi),e.GI1(Ts),e.GI1(Jn.U),e.GI1(Z.KE),e.GI1(A.aW),e.GI1(e.kD9),e.GI1(io.yQ),e.GI1(U),e.GI1(Or.I),e.GI1(Is.Ex))};static \u0275cmp=e.In1({type:l,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},standalone:!0,features:[e.M5G([Is.Ex]),e.UHJ],decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-button-toggle-group",1),e.qCj("change",function(b){return n.onImportExportChange(b)}),e.I0R(2,"mat-button-toggle",2),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-button-toggle",2),e.OEk(6),e.wVc(7,"translate"),e.C$Y()()(),e.yuY(8,nu,20,24,"form",3)(9,lu,3,2,"section",4)(10,cu,4,3,"section",4),e.wVc(11,"async"),e.yuY(12,wu,37,38,"form",3),e.wVc(13,"async")),2&i&&(e.yG2(),e.E7m("value",n.selectedMode),e.yG2(),e.E7m("value","import"),e.yG2(),e.oRS(" ",e.kDX(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.yG2(2),e.E7m("value","export"),e.yG2(),e.oRS(" ",e.kDX(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.yG2(2),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf",0===e.kDX(11,13,n.exportableLayers$).length&&"export"===n.selectedMode),e.yG2(2),e.E7m("ngIf",e.kDX(13,15,n.exportableLayers$).length>0&&"export"===n.selectedMode))},dependencies:[he.ue,he.gn,he.KU,o.u_,Z.y,Z.sz,Z.ot,Z.ue,Z.u,Z.sl,Z.uW,Z.Wo,ve.wb,ve.Up,ve.w5,ye.d5,ye.kX,ye.gl,ne.I5,o.Iw,ne.Ax,_.KO,_.a4,R.oJ,R.Gw,kc.is,Le.YM,o.QF,ut.GE,ut.cP,yt.cN,yt.yi,o.a,o.uq,C._s,G.sD],styles:["[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]})}return l})();r(10211);var Ds=r(9364);r(7700);var el=r(49112),Mu=r(17400),ui=r(68252);function Du(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",10),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.check())}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.layerCheck)}}const tl=l=>({disabled:l});function Fu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",11),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.toggleVisibility(n))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon",12),e.wVc(3,"async"),e.wVc(4,"async"),e.OEk(5),e.wVc(6,"async"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",e.kDX(1,5,t.eyeTooltip)),e.yG2(2),e.E7m("matBadgeHidden",e.kDX(3,7,t.queryBadgeHidden$))("ngClass",e.S45(13,tl,!1===e.kDX(4,9,t.inResolutionRange$))),e.yG2(3),e.oRS("",e.kDX(6,11,t.layer.visible$)?"visibility":"visibility_off"," ")}}function Pu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.toggleVisibility(n))}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",12),e.wVc(4,"async"),e.wVc(5,"async"),e.OEk(6),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,5,"igo.geo.layer.hideLayer"):e.kDX(2,7,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("matBadgeHidden",e.kDX(4,9,t.queryBadgeHidden$))("ngClass",e.S45(13,tl,!1===e.kDX(5,11,t.inResolutionRange$))),e.yG2(3),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}function Ru(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLayerTool())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"more_horiz"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.moreOptions"))}function Lu(l,f){if(1&l&&e.wR5(0,"igo-layer-legend",15),2&l){const t=e.GaO();e.E7m("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let ol=(()=>{class l{networkService;renderer;elRef;cdRef;focusedCls="igo-layer-item-focused";get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}_activeLayer;layerTool$=new ue.g(!1);showLegend$=new ue.g(!0);inResolutionRange$=new ue.g(!0);queryBadgeHidden$=new ue.g(!0);tooltipText;state;get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}_selectAll=!1;layerCheck;resolution$$;network$$;layers$$;layers$=new ue.g(void 0);get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}_layer;toggleLegendOnVisibilityChange=!1;expandLegendIfVisible=!1;updateLegendOnResolutionChange=!1;orderable=!0;lowerDisabled=!1;raiseDisabled=!1;queryBadge=!1;selectionMode;changeDetection;get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}action=new e._w7(void 0);checkbox=new e._w7;constructor(t,i,n,g){this.networkService=t,this.renderer=i,this.elRef=n,this.cdRef=g}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(t){t.stopPropagation(),this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case ui.w.TITLE:return this.layer.title;case ui.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case ui.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!(0,Mu.wd)(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}static \u0275fac=function(i){return new(i||l)(e.GI1(el.u),e.GI1(e.q87),e.GI1(e.GMv),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},standalone:!0,features:[e.UHJ],decls:12,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","matListItemIcon","",3,"checked","change",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["matListItemMeta",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["matListItemIcon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["aria-hidden","false","matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0),e.yuY(1,Du,1,1,"mat-checkbox",1),e.I0R(2,"span",2),e.qCj("click",function(){return n.toggleLegendOnClick()}),e.OEk(3),e.C$Y(),e.I0R(4,"div",3),e.yuY(5,Fu,7,15,"button",4)(6,Pu,7,15,"button",5)(7,Ru,4,3,"button",6),e.C$Y()(),e.I0R(8,"div",7,8),e.yuY(10,Lu,1,2,"igo-layer-legend",9),e.wVc(11,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.oRS(" ",n.layer.title," "),e.yG2(2),e.E7m("ngIf",!n.selectionMode),e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("ngIf",!n.selectionMode),e.yG2(3),e.E7m("ngIf",e.kDX(11,7,n.showLegend$)))},dependencies:[de.iI,de.g9,de.Y1,de.UV,de.At,o.u_,me.Vn,me.WK,_.KO,_.a4,R.oJ,R.um,L.oB,L.qL,M.g,M.S,o.QF,Et,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .igo-layer-title{display:block;width:100%;cursor:pointer}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}[_nghost-%COMP%]   .layerCheck[_ngcontent-%COMP%]{align-self:baseline;width:16px;padding-right:0}"],changeDetection:0})}return l})(),il=(()=>{class l{networkService;inResolutionRange$=new ue.g(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(t){this.networkService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case ui.w.TITLE:return this.layer.title;case ui.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case ui.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}static \u0275fac=function(i){return new(i||l)(e.GI1(el.u))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},standalone:!0,features:[e.UHJ],decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0)(1,"span",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2,3),e.wR5(5,"igo-layer-legend",4),e.C$Y()),2&i&&(e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.cNF(n.layer.title),e.yG2(3),e.E7m("layer",n.layer)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange))},dependencies:[de.iI,de.g9,de.UV,_.KO,_.a4,Et],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0})}return l})();var Fr=r(35876),nl=r(23680),Pr=r(54584),rl=r(43451),sl=r(25376);function Gu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",6),e.qCj("change",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.toggleShowAllLegends(n.checked))}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.yG2(2),e.oRS(" ",e.kDX(3,6,"igo.geo.layer.legend.showAll")," ")}}function $u(l,f){1&l&&e.wR5(0,"mat-divider")}function Au(l,f){if(1&l&&e.wR5(0,"igo-layer-legend-item",8),2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)}}function ku(l,f){if(1&l&&e.yuY(0,Au,1,2,"igo-layer-legend-item",7),2&l){const t=f.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function Bu(l,f){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Uu(l,f){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Yu(l,f){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Vu(l,f){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let Fs=(()=>{class l{orderable=!0;hasVisibleOrInRangeLayers$=new ue.g(!0);hasVisibleAndNotInRangeLayers$=new ue.g(!0);layersInUi$=new ue.g([]);layers$=new ue.g([]);showAllLegend=!1;change$=new nl.o(1);change$$;set layers(t){this._layers=t,this.next()}get layers(){return this._layers}_layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new e._w7(!1);constructor(){}ngOnInit(){this.change$$=this.change$.pipe((0,sl.C)(()=>0===this.layers.length?Pr.k:(0,rl.k)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&i.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&!i.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(i=>!(!1===i.showInLayerList||this.excludeBaseLayers&&i.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let i=t.filter(n=>n.visible&&n.isInResolutionsRange);return this.showAllLegendsValue&&(i=t),this.sortLayersByZindex(i)}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},standalone:!0,features:[e.UHJ],decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,Gu,4,8,"mat-slide-toggle",1),e.wVc(2,"async"),e.yuY(3,$u,1,0,"mat-divider",2),e.wVc(4,"async"),e.I0R(5,"igo-list",3),e.yuY(6,ku,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,Bu,3,3,"p",5),e.wVc(9,"async"),e.wVc(10,"async"),e.wVc(11,"async"),e.yuY(12,Uu,3,3,"p",5),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.yuY(16,Yu,3,3,"p",5),e.wVc(17,"async"),e.wVc(18,"async"),e.wVc(19,"async"),e.yuY(20,Vu,3,3,"p",5),e.wVc(21,"async"),e.wVc(22,"async"),e.wVc(23,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",e.kDX(2,9,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("ngIf",e.kDX(4,11,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(7,13,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(9,15,n.layersInUi$).length&&!1===e.kDX(10,17,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(11,19,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(13,21,n.layersInUi$).length&&!1===e.kDX(14,23,n.hasVisibleOrInRangeLayers$)&&e.kDX(15,25,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(17,27,n.layersInUi$).length&&!1===e.kDX(18,29,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(19,31,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(21,33,n.layersInUi$).length&&!1===e.kDX(22,35,n.hasVisibleOrInRangeLayers$)&&e.kDX(23,37,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends))},dependencies:[o.u_,ut.GE,ut.cP,_.KO,_.a4,_e.U,_e.k,s.yM,o.Iw,il,s.qU,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0})}return l})(),al=(()=>{class l{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=(0,Fr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,vt.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.layersVisibility$$=(0,Fr.E)(i.map(n=>n.visible$)).subscribe(n=>{this.component.change$.next()})})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(Fs,2),e.GI1(Jo.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerLegendListBinding",""]],standalone:!0})}return l})();var ll=r(3735);function ju(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearTerm())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}}let cl=(()=>{class l{onlyVisible$=new ue.g(!1);sortAlpha$=new ue.g(!1);term$=new ue.g(void 0);onlyVisible$$;sortAlpha$$;term$$;layersAreAllVisible=!0;floatLabel="auto";set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}selectionMode=!1;appliedFilterAndSort=new e._w7;selection=new e._w7;ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},standalone:!0,features:[e.UHJ],decls:21,vars:33,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"color","matTooltip","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"only-visible",3,"disabled","color","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility",3,"igoMatBadgeInverseColor","igoMatBadgeInheritColor"],["mat-icon-button","","color","primary","matTooltipShowDelay","500",1,"selection-mode",3,"matTooltip","click"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"]],template:function(i,n){1&i&&(e.I0R(0,"mat-form-field",0)(1,"input",1),e.iHE("ngModelChange",function(b){return e.kNx(n.term,b)||(n.term=b),b}),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y(),e.yuY(4,ju,3,0,"button",2),e.C$Y(),e.I0R(5,"div",3)(6,"button",4),e.qCj("click",function(){return n.toggleSortAlpha()}),e.wVc(7,"translate"),e.wVc(8,"translate"),e.I0R(9,"mat-icon"),e.OEk(10,"sort_by_alpha"),e.C$Y()(),e.I0R(11,"button",5),e.qCj("click",function(){return n.toggleOnlyVisible()}),e.wVc(12,"translate"),e.wVc(13,"translate"),e.I0R(14,"mat-icon",6),e.OEk(15),e.C$Y()(),e.I0R(16,"button",7),e.qCj("click",function(){return n.toggleSelectionMode()}),e.wVc(17,"translate"),e.wVc(18,"translate"),e.I0R(19,"mat-icon"),e.OEk(20),e.C$Y()()()),2&i&&(e.E7m("floatLabel",n.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,17,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.kDX(3,19,"igo.geo.layer.subsetLayersListKeyword")),e.OKB("ngModel",n.term),e.yG2(3),e.E7m("ngIf",n.term),e.yG2(2),e.eAK("--active",n.sortAlpha),e.E7m("color",n.sortAlpha?"warn":"primary")("matTooltip",n.sortAlpha?e.kDX(7,21,"igo.geo.layer.sortMapOrder"):e.kDX(8,23,"igo.geo.layer.sortAlphabetically")),e.yG2(5),e.E7m("disabled",n.layersAreAllVisible&&!n.onlyVisible)("color",n.onlyVisible?"warn":"primary")("matTooltip",n.onlyVisible?e.kDX(12,25,"igo.geo.layer.resetLayersList"):e.kDX(13,27,"igo.geo.layer.subsetLayersListOnlyVisible")),e.yG2(3),e.E7m("igoMatBadgeInverseColor",!0)("igoMatBadgeInheritColor",!0),e.yG2(),e.oRS(" ",n.onlyVisible?"filter_alt_off":"filter_alt"," "),e.yG2(),e.E7m("matTooltip",n.selectionMode?e.kDX(17,29,"igo.geo.layer.deactivateSelectionMode"):e.kDX(18,31,"igo.geo.layer.activateSelectionMode")),e.yG2(4),e.cNF(n.selectionMode?"library_add_check":"filter_none"))},dependencies:[ve.wb,ve.Up,ve.Gm,yt.cN,yt.yi,Z.y,Z.ot,Z.ue,Z._G,_.KO,_.a4,o.u_,R.oJ,R.um,L.oB,L.qL,M.g,M.S,ll.q,C._s,G.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:50%}}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}"],changeDetection:0})}return l})();var Ku=r(56740),Ps=r(87848),Wu=r(21800),Hi=r(94448),ul=r(89888),Rs=r(19724),Zn=function(l){return l.always="always",l.never="never",l.default="default",l}(Zn||{}),yn=function(l){return l.ALL_VISIBLE="ALL_VISIBLE",l.ALL_HIDDEN="ALL_HIDDEN",l.MIXED="MIXED",l.NULL="NULL",l}(yn||{}),Rr=function(l){return l.Raise="raise",l.Lower="lower",l}(Rr||{});const Nu=["igoLayerItemToolbar"];function Hu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-list-tool",6),e.qCj("appliedFilterAndSort",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onAppliedFilterAndSortChange(n))})("selection",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.toggleSelectionMode(n))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function zu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",7)(1,"mat-checkbox",8),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.selectAll())}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.yG2(),e.oRS(" ",t.selectAllCheck?e.kDX(3,4,"igo.geo.layer.deselectAll"):e.kDX(4,6,"igo.geo.layer.selectAll")," ")}}function Xu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-item",10),e.qCj("action",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.toggleLayerTool(n))})("checkbox",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.layersCheck(n))}),e.C$Y()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("activeLayer",i.activeLayer)("orderable",i.orderable&&!t.baseLayer)("lowerDisabled",i.getLowerLayer().id===t.id)("raiseDisabled",i.getUpperLayer().id===t.id)("queryBadge",i.queryBadge)("expandLegendIfVisible",i.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",i.toggleLegendOnVisibilityChange)("selectionMode",i.selection)("selectAll",i.selectAllCheck)("layerCheck",t.options.check)("changeDetection",i.layerItemChangeDetection$)}}function Ju(l,f){if(1&l&&e.yuY(0,Xu,1,13,"igo-layer-item",9),2&l){const t=f.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function Qu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",27),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.removeLayers())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"delete"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.removeLayer"))}function Zu(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayerExtents(n.activeLayer))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",29),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.zoomLayer")),e.yG2(2),e.E7m("svgIcon",t.magnifyIcon.name)}}const qu=l=>({layer:l});function ed(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11)(1,"div",12),e.yuY(2,Qu,4,3,"button",13),e.I0R(3,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Lower,!0))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.I0R(6,"mat-icon",15),e.OEk(7,"arrow_downward"),e.C$Y()(),e.I0R(8,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Raise,!0))}),e.wVc(9,"translate"),e.wVc(10,"translate"),e.I0R(11,"mat-icon",15),e.OEk(12,"arrow_upward"),e.C$Y()(),e.I0R(13,"button",17),e.wVc(14,"translate"),e.I0R(15,"mat-icon",18),e.OEk(16,"opacity"),e.C$Y()(),e.I0R(17,"mat-menu",19,20)(19,"mat-slider",21,22),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(21,"translate"),e.I0R(22,"input",23,24),e.qCj("input",function(){e.usT(t);const n=e.Gew(23),g=e.Gew(20),b=e.GaO();return e.CGJ(b.changeOpacity({source:n,parent:g,value:n.value}))}),e.C$Y()()(),e.yuY(24,Zu,3,4,"button",25),e.C_f(25,26),e._Xx(26),e.C$Y()()}if(2&l){const t=e.Gew(18),i=e.GaO();e.E7m("title",i.activeLayer.title),e.yG2(2),e.E7m("ngIf",i.isLayerRemovable(i.activeLayer)),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(4,20,"igo.geo.layer.filterLowerLayer"):e.kDX(5,22,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabled),e.yG2(2),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(9,24,"igo.geo.layer.filterRaiseLayer"):e.kDX(10,26,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabled),e.yG2(2),e.E7m("matMenuTriggerFor",t)("matTooltip",e.kDX(14,28,"igo.geo.layer.opacity")),e.yG2(2),e.E7m("matBadge",i.badgeOpacity),e.yG2(4),e.E7m("min",0)("max",100)("matTooltip",e.kDX(21,30,"igo.geo.layer.opacity")),e.yG2(3),e.E7m("value",i.opacity),e.yG2(2),e.E7m("ngIf",i.activeLayerExtentIsValid(i.activeLayer)),e.yG2(),e.E7m("ngTemplateOutlet",i.templateLayerToolbar)("ngTemplateOutletContext",e.S45(32,qu,i.activeLayer))}}function td(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-slider",37),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO(2);return e.kNx(g.checkOpacity,n)||(g.checkOpacity=n),e.CGJ(n)}),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(1,"translate"),e.wR5(2,"input",38),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("min",0)("max",100),e.OKB("ngModel",t.checkOpacity),e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.opacity"))}}function od(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayersExtents(n.layersChecked))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",39),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.zoomLayers")),e.yG2(2),e.E7m("svgIcon",t.magnifyIcon.name)}}function id(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11),e.wVc(1,"translate"),e.I0R(2,"div",30)(3,"button",31),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.removeLayers(n.layersChecked))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.I0R(6,"mat-icon",15),e.OEk(7,"delete"),e.C$Y()(),e.I0R(8,"button",32),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibility(n.layersChecked))}),e.wVc(9,"translate"),e.wVc(10,"translate"),e.I0R(11,"mat-icon"),e.OEk(12),e.C$Y()(),e.I0R(13,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.lowerLayers(n.layersChecked))}),e.wVc(14,"translate"),e.wVc(15,"translate"),e.I0R(16,"mat-icon",15),e.OEk(17,"arrow_downward"),e.C$Y()(),e.I0R(18,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.raiseLayers(n.layersChecked))}),e.wVc(19,"translate"),e.wVc(20,"translate"),e.I0R(21,"mat-icon",15),e.OEk(22,"arrow_upward"),e.C$Y()(),e.I0R(23,"button",33),e.wVc(24,"translate"),e.I0R(25,"mat-icon"),e.OEk(26,"opacity"),e.C$Y()(),e.I0R(27,"mat-menu",34,20)(29,"div",35),e.yuY(30,td,3,6,"mat-slider",36),e.C$Y()(),e.yuY(31,od,3,4,"button",25),e.C$Y()()}if(2&l){const t=e.Gew(28),i=e.GaO();e.E7m("title",e.kDX(1,21,"igo.geo.layer.tools")),e.yG2(3),e.E7m("disabled",0===i.layersChecked.length)("matTooltip",i.isAllLayersRemovable(i.layersChecked)?e.kDX(4,23,"igo.geo.layer.removeSelectedLayers"):e.kDX(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.yG2(3),e.E7m("matBadge","!")("matBadgeHidden",i.isAllLayersRemovable(i.layersChecked)),e.yG2(2),e.E7m("disabled",0===i.layersChecked.length)("matTooltip","ALL_HIDDEN"===i.statusSelectedLayersCheck?e.kDX(9,27,"igo.geo.layer.showSelectedLayers"):e.kDX(10,29,"igo.geo.layer.hideSelectedLayers")),e.yG2(4),e.cNF("ALL_HIDDEN"===i.statusSelectedLayersCheck?"visibility_off":"visibility"),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(14,31,"igo.geo.layer.filterLowerLayer"):e.kDX(15,33,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabledSelection),e.yG2(2),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(19,35,"igo.geo.layer.filterRaiseLayer"):e.kDX(20,37,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabledSelection),e.yG2(2),e.E7m("disabled",0===i.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.kDX(24,39,"igo.geo.layer.opacity")),e.yG2(7),e.E7m("ngIf",i.layersChecked.length),e.yG2(),e.E7m("ngIf",0!==i.layersChecked.length&&i.activeLayersExtentAreValid(i.layersChecked))}}const nd=[[["","igoLayerItemToolbar",""]]],rd=["[igoLayerItemToolbar]"];let Ls=(()=>{class l{elRef;iconService;orderable=!0;thresholdToFilterAndSort=5;layers$=new ue.g([]);change$=new nl.o(1);showToolbar$=new ue.g(!1);layerTool;hideSelectedLayers=!0;activeLayer$=new ue.g(void 0);layersChecked=[];selection;change$$;layers$$;layerItemChangeDetection$=new ue.g(void 0);templateLayerToolbar;layersAreAllVisible=!0;ogcButton=!0;timeButton=!0;get map(){return this._map}set map(t){this._map=t}_map;set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}_layers;set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}_activeLayer;floatLabel="auto";layerFilterAndSortOptions={};excludeBaseLayers=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;queryBadge=!1;appliedFilterAndSort=new e._w7;get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}_keyword=void 0;get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}_onlyVisible=!1;get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=!1;get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const i of this.layersChecked)i.opacity=t/100}get layerListDisplacement(){return Rr}toggleOpacity=!1;selectAllCheck;selectAllCheck$=new ue.g(void 0);selectAllCheck$$;magnifyIcon=li.qW;constructor(t,i){this.elRef=t,this.iconService=i,this.iconService.registerSvg(this.magnifyIcon)}ngOnInit(){this.change$$=this.change$.pipe((0,sl.C)(()=>0===this.layers.length?Pr.k:(0,rl.k)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const i of this.layers)i.status$.subscribe(n=>{0===n&&this.map.removeLayer(i)}),i.options.active&&(this.activeLayer=i,this.layerTool=!0),i.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:t===this.layers.filter(i=>i.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let i=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const n=t.options.extent,g=this.map.viewController.maxLayerZoomExtent;return n&&(i=!g||Hi.cP(g,n)),i}activeLayersExtentAreValid(t){let i=!1;const n=Hi.Gu(),g=this.map.viewController.maxLayerZoomExtent;for(const b of t){const B=b.options.extent;B&&!B.includes(1/0)&&Hi.SU(n,B)}return Hi.t7(n)||(i=!g||Hi.cP(g,n)),i}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const i=Hi.Gu();for(const n of t){const g=n.options.extent;g&&Hi.SU(i,g)}this.map.viewController.zoomToExtent(i)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex<i.zIndex?t:i,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i+1]||!0!==this.layers[i+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex>i.zIndex?t:i,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i-1]||!0!==this.layers[i-1].baseLayer)}moveActiveLayer(t,i,n=!1){const g=[];(0,Rs.UR)(this.map,t,ui.a.ZINDEX);let b=(0,Rs.UR)(this.map,t,ui.a.ZINDEX);b||(b=t);const B=[b];(0,Rs.m)(this.map,b,B,ui.a.ZINDEX),this.layers.map(pe=>{-1!==B.indexOf(pe)&&g.push(pe)}),i===Rr.Raise?this.raiseLayers(g,n):i===Rr.Lower&&this.lowerLayers(g,n)}raisableLayers(t){let i=!1,n=0;for(const g of t){const b=this.layers.findIndex(fe=>g.id===fe.id),B=this.layers[b];B.baseLayer&&(n+=1);const pe=this.layers[b-1];pe&&!0!==pe.baseLayer&&!t.find(fe=>pe.id===fe.id)&&!0!==B.baseLayer&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,i=!0){const n=[];for(const g of t){const b=this.layers.findIndex(B=>B.id===g.id);this.raisableLayer(b)&&n.push(g)}this.map.raiseLayers(n),i&&setTimeout(()=>{const g=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),b=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let B;g.length&&(B=g[0]),b.length&&(B=b[0]),B&&(0,ul.c)(B,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let i=!1,n=0;for(const g of t){const b=this.layers.findIndex(fe=>g.id===fe.id);this.layers[b].baseLayer&&(n+=1);const pe=this.layers[b+1];pe&&!0!==pe.baseLayer&&!t.find(fe=>pe.id===fe.id)&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}lowerableLayer(t){return!(t>this.layers.filter(i=>!0!==i.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,i=!0){const n=[];for(const g of t){const b=this.layers.findIndex(B=>B.id===g.id);this.lowerableLayer(b)&&n.push(g)}this.map.lowerLayers(n),i&&setTimeout(()=>{const g=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),b=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let B;g.length&&(B=g[g.length-1]),b.length&&(B=b[0]),B&&(0,ul.c)(B,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let i=this.filterLayers(t);return i=this.sortAlpha?this.sortLayersByTitle(i):this.sortLayersByZindex(i),i}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===Zn.never||!this.keyword&&!this.onlyVisible)return t;const i=t.map(n=>n.id);return t.forEach(n=>{const b=n.dataSource.options||{},fe=(((n.options||{}).metadata||{}).keywordList||[]).map(Fe=>Fe.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&n.title){const Fe=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ee=n.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ae=b.type||"",Je=new RegExp(Fe,"gi"),ke=void 0!==fe.find(et=>Je.test(et));if(!Je.test(Ee)&&this.keyword.toLowerCase()!==Ae.toLowerCase()&&!ke){const et=i.indexOf(n.id);et>-1&&i.splice(et,1)}}if(this.onlyVisible&&!1===n.visible){const Fe=i.indexOf(n.id);Fe>-1&&i.splice(Fe,1)}}),t.filter(n=>-1!==i.indexOf(n.id))}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}sortLayersByTitle(t){return t.sort((i,n)=>this.normalize(i.title)<this.normalize(n.title)?-1:this.normalize(i.title)>this.normalize(n.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case Zn.always:return!0;case Zn.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const i of this.layers)i.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const i of t)!1!==i.options.removable?i.map.removeLayer(i):this.layersChecked.push(i)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const i of t)i.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(i=>this.isLayerRemovable(i))}get statusSelectedLayersCheck(){let t=yn.NULL,i=!1,n=!1;if(0===this.layersChecked.length)t=yn.NULL;else{t=yn.MIXED,this.hideSelectedLayers=!1;for(const g of this.layersChecked)!0===g.visible&&(i=!0),!1===g.visible&&(n=!0);!0===i&&!1===n&&(t=yn.ALL_VISIBLE),!1===i&&!0===n&&(t=yn.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const i=this.layers.findIndex(n=>t.layer.id===n.id);for(const n of this.layersChecked)if(i<this.layers.findIndex(b=>n.id===b.id))return this.layersChecked.splice(this.layersChecked.findIndex(b=>n.id===b.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(b=>!0!==b.baseLayer&&b.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(b=>b.showInLayerList).length));this.layersChecked.push(t.layer)}else{const i=this.layersChecked.findIndex(n=>t.layer.id===n.id);this.layersChecked.splice(i,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>i.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const i of this.layers)i.options.check&&this.layersChecked.push(i)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const i of this.layersChecked)t.push(i.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,i){const n=t.scrollTop,b=i.offsetTop;return b+i.clientHeight<=n+t.clientHeight&&b>=n}removeProblemLayerInList(t){for(const i of t)!0===i.olLoadingProblem&&this.map.removeLayer(i);return t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.GMv),e.GI1(li.IL))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list"]],contentQueries:function(i,n,g){if(1&i&&e.szK(g,Nu,5),2&i){let b;e.wto(b=e.Gqi())&&(n.templateLayerToolbar=b.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},standalone:!0,features:[e.UHJ],ngContentSelectors:rd,decls:10,vars:11,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium",3,"matBadge"],[1,"panel-opacity-menu"],["opacityMenu","matMenu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","matTooltip","click"],["ngSlider",""],["matSliderThumb","",3,"value","input"],["ngSliderThumb","matSliderThumb"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium",3,"svgIcon"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],[1,"mat-menu-opacity-slider"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["matSliderThumb",""],[3,"svgIcon"]],template:function(i,n){1&i&&(e.kPM(nd),e.yuY(0,Hu,1,4,"igo-layer-list-tool",0),e.wVc(1,"async"),e.yuY(2,zu,5,8,"div",1),e.wR5(3,"mat-divider"),e.I0R(4,"igo-list",2,3),e.yuY(6,Ju,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,ed,27,34,"igo-panel",5)(9,id,32,41,"igo-panel",5)),2&i&&(e.E7m("ngIf",e.kDX(1,7,n.showToolbar$)),e.yG2(2),e.E7m("ngIf",n.selection),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(2),e.E7m("ngForOf",e.kDX(7,9,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.selection&&n.layerTool&&n.activeLayer),e.yG2(),e.E7m("ngIf",n.selection&&n.layers.length>0))},dependencies:[o.u_,cl,me.Vn,me.WK,_e.U,_e.k,s.yM,o.Iw,ol,s.qU,Wu.c,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,M.g,M.S,Ps._A,Ps.aM,Ps.yG,Xt.yO,Xt.Cg,Xt._s,o.XV,Z.y,Z.ue,Z._G,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{flex:1;padding-top:8px}[_nghost-%COMP%]   mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__content{margin-bottom:10px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:unset}[_nghost-%COMP%]   .select-all[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;padding:0 16px}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}"],changeDetection:0})}return l})(),dl=(()=>{class l{mapService;route;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i,n){this.mapService=i,this.route=n,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Fr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,vt.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.setLayersVisibilityStatus(i,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,i){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Fr.E)(t.filter(n=>n.baseLayer!==i).map(n=>n.visible$)).pipe((0,d.k)(n=>n.every(Boolean))).subscribe(n=>this.component.layersAreAllVisible=n)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(Ls,2),e.GI1(Jo.u),e.GI1(Ku.k$,8))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerListBinding",""]],standalone:!0})}return l})();function sd(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleTrackFeature())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"my_location"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let pl=(()=>{class l{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";constructor(){}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,sd,4,4,"button",0),2&i&&e.E7m("ngIf",n.options.trackFeature)},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,C._s,G.sD],changeDetection:0})}return l})(),ad=(()=>{class l{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function ld(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openMetadata(n.options.metadata))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"info"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.metadata.show"))("color",t.color)}}function cd(l,f){if(1&l&&(e.I0R(0,"mat-dialog-content",3)(1,"h3"),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.cNF(t.data.abstract)}}function ud(l,f){if(1&l&&(e.I0R(0,"mat-dialog-content",3),e.wR5(1,"h3",4),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("innerHTML",t.data.abstract,e.E3n)}}let Gs=(()=>{class l{metadataService;dialog;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t,i){this.metadataService=t,this.dialog=i}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open($s,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open($s,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(i){return new(i||l)(e.GI1(ad),e.GI1(bt.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,ld,4,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.metadata&&n.options.metadata.url||n.options&&n.options.metadata&&n.options.metadata.abstract)},dependencies:[o.u_,R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,C._s,G.sD,bt.sr],changeDetection:0})}return l})(),$s=(()=>{class l{data;constructor(t){this.data=t}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-abstract"]],standalone:!0,features:[e.UHJ],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.C$Y(),e.I0R(2,"button",1),e.OEk(3,"X"),e.C$Y(),e.yuY(4,cd,3,1,"mat-dialog-content",2)(5,ud,2,1,"mat-dialog-content",2)),2&i&&(e.yG2(),e.cNF(n.data.layerTitle),e.yG2(3),e.E7m("ngIf","arcgisrest"!==n.data.type),e.yG2(),e.E7m("ngIf","arcgisrest"===n.data.type))},dependencies:[bt.WQ,R.oJ,R.Gw,bt.qq,o.u_,bt.iU],styles:[":host{position:relative;display:block}:host .close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}\n"],encapsulation:2})}return l})();var fo=r(78168),Wt=r(68392);let ml=(()=>{class l extends fo.i{static id="map";static type=Wt.Y;constructor(t){super(t)}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(i){return new(i||l)(e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function dd(l){return new ml(l.getConfig(`searchSources.${ml.id}`)||{})}var md=r(93199);let gd=(()=>{class l{static forRoot(){return{ngModule:l,providers:[{provide:fo.i,useFactory:dd,multi:!0,deps:[A.aW]}]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[md.E],imports:[o.MD,P.UD]})}return l})();var gl=r(8636);let hl=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[gl.A]})}return l})();var As=r(8408),ks=r(69800);let fl=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[ks.T,As.q]})}return l})();var yl=r(1560);let _l=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[yl.s]})}return l})();var Cl=r(50620);let vl=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[Cl.Q]})}return l})();r(71320);var Bs=r(83456);function yd(l){return new Bs.i(l)}function Sl(){return{provide:Bs.i,useFactory:yd,deps:[fo.i]}}var Us=r(29216),Lt=(r(16660),r(21124)),xi=r(90916);class yo{static getGoogleMapsCoordLink(f,t){return`https://www.google.com/maps/search/?api=1&query=${t}%2C${f}`}static getGoogleStreetViewLink(f,t){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t}%2C${f}`}static getGoogleMapsNameLink(f){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(f)}`}}class _d{static getOpenStreetMapLink(f,t,i=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${f}#map=${i}/${t}/${f}`}static getOpenStreetCamLink(f,t,i=17){return`https://openstreetcam.org/map/@${t},${f},${i}z`}}let bl=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(C.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class zi extends fo.i{languageService;static id="coordinatesreverse";static type=Wt.Y;projections;title$=new ue.g("");get title(){return this.title$.getValue()}constructor(f,t,i,n){super(f,i),this.languageService=t,this.projections=n,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return zi.id}getType(){return zi.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(f,t,i){return(0,Ve.of)([this.dataToResult(f,t,i)])}dataToResult(f,t,i){const n=(0,lo.G2)(f),b=(0,lo.Re)(f,this.projections).reduce((ke,et)=>(ke[et.alias]=et.igo2CoordFormat,ke),{}),B=i?(0,lo.uE)(f,6).reverse().join(", "):(0,lo.uE)(f,6).join(", "),pe=i?n.reverse().join(", "):n.join(", ");let fe={type:"Point",coordinates:[f[0],f[1]]};const Fe={};let Ee="";if(t.distance){Fe[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=t.distance,Ee="<br><small>Rayon: "+t.distance+" m</small>";const et=y.AF([f[0],f[1]],"EPSG:4326","EPSG:3857"),lt=new Qo.c(et,t.distance),Ct=(0,zt.IH)(lt),Bt=new po.c;fe=JSON.parse(Bt.writeGeometry(Ct.transform("EPSG:3857","EPSG:4326")))}return t.conf&&(Fe[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=t.conf,Ee+=""===Ee?"<br>":"<small> - </small>",Ee+="<small>Confiance: "+t.conf+"%</small>"),Fe[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=B,Fe[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=pe,{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:fe,extent:void 0,properties:Object.assign(Fe,b,{GoogleMaps:yo.getGoogleMapsCoordLink(f[0],f[1]),GoogleStreetView:yo.getGoogleStreetViewLink(f[0],f[1]),OpenStreetMap:_d.getOpenStreetMapLink(f[0],f[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:f[0].toString()+","+f[1].toString(),title:B}},meta:{dataType:Wt.Y,id:f[0].toString()+","+f[1].toString(),title:B,titleHtml:B+Ee,icon:"location_on",score:100}}}static \u0275fac=function(t){return new(t||zi)(e.CoB("options"),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("projections"))};static \u0275prov=e.wxM({token:zi,factory:zi.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[Array,Object,Boolean]),(0,Lt.YR)("design:returntype",Tt._)],zi.prototype,"reverseSearch",null);var Ys=function(l){return l[l.ICherche=0]="ICherche",l[l.IChercheReverse=1]="IChercheReverse",l[l.Cadastre=2]="Cadastre",l[l.CoordinatesReverse=3]="CoordinatesReverse",l[l.ILayer=4]="ILayer",l[l.Nominatim=5]="Nominatim",l[l.StoredQueries=6]="StoredQueries",l[l.StoredQueriesReverse=7]="StoredQueriesReverse",l[l.Workspace=8]="Workspace",l}(Ys||{});function Cd(l){return new bl(l)}var Vs=r(45928),Il=r(12472),Mi=r(14452);const wl={"map-marker":"location_on",city:"location_city","flag-triangle":"flag","map-marker-alert":"fmd_bad","map-marker-radius":"pin_drop","map-marker-multiple":"local_post_office","map-legend":"map",bank:"account_balance","map-search":"search_insights","book-open-variant":"menu_book","office-building":"apartment","table-picnic":"table_restaurant",flash:"flash_on",engine:li.ol,"road-variant":"add_road","baby-face-outline":"child_care","home-account":"location_home",hospital:"local_hospital",pharmacy:"local_pharmacy","police-badge-outline":"local_police",parking:"local_parking",tree:"nature","home-city":"home_work",terrain:"landscape","panorama-horizontal":"panorama_horizontal"};let Lr=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(C.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class bd{encodeKey(f){return encodeURIComponent(f)}encodeValue(f){return encodeURIComponent(f)}decodeKey(f){return decodeURIComponent(f)}decodeValue(f){return decodeURIComponent(f)}}class Zo extends fo.i{http;languageService;formatter;static id="icherche";static type=Wt.Y;static propertiesBlacklist=[];title$=new ue.g("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(f,t,i,n,g,b){super(n,i),this.http=f,this.languageService=t,this.formatter=g;const B=b.get(Vs.oj);this.settings.length&&(B?B.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Zo.id}getType(){return Zo.type}getDefaultOptions(){const f=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,i=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],n=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==i.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==i.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==i.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==i.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==i.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==i.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==i.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==i.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==i.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==i.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==i.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==i.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==i.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==i.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==i.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==i.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==i.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==i.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==i.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==i.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:-1!==i.indexOf("culture"),hashtags:["grille","culture"]},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==i.indexOf("unites"),hashtags:["unites","adresse"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===f},{title:"5",value:5,enabled:5===f||!f},{title:"10",value:10,enabled:10===f},{title:"25",value:25,enabled:25===f},{title:"50",value:50,enabled:50===f}]},n&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(f,t){const i=this.computeRequestParams(f,t||{});return i.get("type").length?(this.options.params.page=i.get("page")||"1",this.getSearch(f,i)):(0,Ve.of)([])}getSearch(f,t){return this.http.get(`${this.searchUrl}/geocode`,{params:t}).pipe((0,d.k)(i=>this.extractResults(i,f)),(0,Ge.a)(i=>{throw i.error.toDisplay=!0,i.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),i}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(f=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{const n=new RegExp(`^${i.value}(\\.|$)`),g=f.filter(b=>n.test(b));i.available=g.length>0,"lieux"===i.value&&(this.hashtagsLieuxToKeep=[...new Set(g.map(b=>b.split(".")).reduce((b,B)=>b.concat(B)).filter(b=>"lieux"!==b))])}),this.setParamFromSetting(t,!1)})}computeRequestParams(f,t){const i=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(f,t||{}).params,{q:this.computeTerm(f),page:t.page});if("true"===i.loc){const[n,g,b,B]=t.extent;i.loc=`${n},${g};${b},${g};${b},${B};${n},${B};${n},${g}`}else"false"===i.loc&&delete i.loc;return/#[A-Za-z]+/.test(i.q)&&(i.type="lieux"),new u.i4({fromObject:Gt.Yv.removeUndefined(i),encoder:new bd})}extractResults(f,t){return f.features.map(i=>this.formatter.formatResult(this.dataToResult(i,t,f)))}dataToResult(f,t,i){const n=this.computeProperties(f),g=[this.getId(),n.type,n.code].join("."),b=f.highlight.title||f.properties.nom,B=f.highlight.title2?" <small> "+f.highlight.title2+"</small>":"",pe=f.highlight.title3?"<br><small> "+f.highlight.title3+"</small>":"";let fe=f.icon;return"string"==typeof fe&&Object.keys(wl).includes(fe)&&(fe=wl[fe]),{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:f.geometry,extent:f.bbox,properties:n,meta:{id:g,title:f.properties.nom}},meta:{dataType:Wt.Y,id:g,title:f.properties.nom,titleHtml:b+B+pe,icon:fe||"location_on",score:f.score||(0,Mi.Un)(t.trim(),f.properties.nom),nextPage:i.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(f){const t=Gt.Yv.removeKeys(f.properties,Zo.propertiesBlacklist);if(!f.geometry)return Object.assign({type:f.index},t);const i={GoogleMaps:""};let n,g;if("Point"===f.geometry.type)n=yo.getGoogleMapsCoordLink(f.geometry.coordinates[0],f.geometry.coordinates[1]);else{const B=(0,Il.c)(f.geometry);n=yo.getGoogleMapsCoordLink(B.geometry.coordinates[0],B.geometry.coordinates[1])}g=yo.getGoogleMapsNameLink("routes"===f.index?f.properties.nom+", "+f.properties.municipalite:"municipalites"===f.index?f.properties.nom+", ville":"mrc"===f.index?"mrc+"+f.properties.nom:"regadmin"===f.index?f.properties.nom+",+QC":f.properties.nom||f.highlight.title),i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+g+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===f.geometry.type&&(i.GoogleStreetView=yo.getGoogleStreetViewLink(f.geometry.coordinates[0],f.geometry.coordinates[1]));const b={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:f.index},t,i,b)}computeTerm(f){let i=!1;return i=(f.match(/(#[A-Za-z]+)/g)||[]).some(n=>{const g=String(n).substring(1);return this.hashtagsLieuxToKeep.some(b=>b.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===g.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),i||(f=f.replace(/(#[A-Za-z]+)/g,"")),f.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(f,t){const i=super.getHashtagsValid(f,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}static \u0275fac=function(t){return new(t||Zo)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"),e.CoB(Lr),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:Zo,factory:Zo.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[String,u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Zo.prototype,"getSearch",null);class Di extends fo.i{http;languageService;static id="icherchereverse";static type=Wt.Y;static propertiesBlacklist=[];title$=new ue.g("");get title(){return this.title$.getValue()}constructor(f,t,i,n,g){super(n,i),this.http=f,this.languageService=t,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const b=g.get(Vs.oj);this.settings.length&&(b?b.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return Di.id}getType(){return Di.type}getDefaultOptions(){const f=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==f.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==f.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==f.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==f.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==f.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==f.indexOf("regadmin")},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==f.indexOf("unites")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(f,t){const i=this.computeRequestParams(f,t||{});return i.get("type").length?this.getReverseSearch(i):(0,Ve.of)([])}getReverseSearch(f){return this.http.get(`${this.searchUrl}/locate`,{params:f}).pipe((0,d.k)(t=>this.extractResults(t)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(f=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{i.available=f.indexOf(i.value)>-1}),this.setParamFromSetting(t,!1)})}computeRequestParams(f,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{bufferInput:t.distance||this.options.distance})),new u.i4({fromObject:Object.assign({loc:f.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})}extractResults(f){return f.features.map(t=>this.dataToResult(t))}getSubtitle(f){if(!this.settings.length)return"";let t="";if("arrondissements"===f.properties.type)t=f.properties.municipalite+" (Arrondissement)";else{const n=this.settings.find(g=>"type"===g.name).values.find(g=>g.value===f.properties.type);n&&(t=this.languageService.translate.instant(n.title))}return t}dataToResult(f){const t=this.computeProperties(f),i=this.computeExtent(f),n=[this.getId(),t.type,t.code].join("."),g=f.properties.nom,b=" <small> "+this.getSubtitle(f)+"</small>";return{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:f.geometry,extent:i,properties:t,meta:{id:n,title:f.properties.nom}},meta:{dataType:Wt.Y,id:n,title:f.properties.nom,titleHtml:g+b,icon:f.icon||"location_on",pointerSummaryTitle:this.getSubtitle(f)+": "+f.properties.nom}}}computeProperties(f){const t=Gt.Yv.removeKeys(f.properties,Di.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,i)}computeExtent(f){return f.bbox?[f.bbox[0],f.bbox[2],f.bbox[1],f.bbox[3]]:void 0}static \u0275fac=function(t){return new(t||Di)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:Di,factory:Di.\u0275fac})}function Od(l){return new Lr(l)}function js(){return{provide:Lr,useFactory:Od,deps:[C.ov]}}function Id(l,f,t,i,n,g){return new Zo(l,f,t,i.getConfig(`searchSources.${Zo.id}`),n,g)}function Td(){return{kind:Ys.ICherche,providers:[{provide:fo.i,useFactory:Id,multi:!0,deps:[u.KK,C.ov,io.yQ,A.aW,Lr,e.zZn]},js()]}}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Di.prototype,"getReverseSearch",null);var Tl=r(8492),di=r(49704);let Ks=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){const i=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],n=Object.entries(t.properties).filter(([b])=>-1!==i.indexOf(b)).reduce((b,B)=>{const[pe,fe]=B;let Fe;try{Fe=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+pe)}catch{Fe=pe}return b[Fe]=fe||"",b},{}),g=Object.assign({},t);return g.properties=n,g}static \u0275fac=function(i){return new(i||l)(e.CoB(C.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class Xi extends fo.i{http;languageService;formatter;static id="ilayer";static type=Tl.i;title$=new ue.g("");get title(){return this.title$.getValue()}constructor(f,t,i,n,g){super(n,i),this.http=f,this.languageService=t,this.formatter=g,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Xi.id}getType(){return Xi.type}getDefaultOptions(){const f=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===f},{title:"5",value:5,enabled:5===f||!f},{title:"10",value:10,enabled:10===f},{title:"25",value:25,enabled:25===f},{title:"50",value:50,enabled:50===f}]},this.options.showAdvancedSettings&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t},{title:"50 %",value:50,enabled:50===t||!t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]}].filter(Boolean)}}search(f,t){const i=this.computeSearchRequestParams(f,t||{});return i.get("q")&&i.get("type")?(this.options.params.page=i.get("page")||"1",this.getSearch(f,i)):(0,Ve.of)([])}getSearch(f,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,d.k)(i=>this.extractResults(i,f)))}computeSearchRequestParams(f,t){return new u.i4({fromObject:Gt.Yv.removeUndefined(Object.assign({q:this.computeTerm(f)},this.params,this.computeOptionsParam(f,t||{}).params,{page:t.page}))})}computeTerm(f){return f.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(f,t){const i=super.getHashtagsValid(f,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}extractResults(f,t){return f.items.map(i=>this.dataToResult(i,t,f))}dataToResult(f,t,i){const n=this.computeLayerOptions(f),g=f.highlight.title||f.properties.title,b=f.highlight.groupTitle||f.properties.groupTitle,B=b?' <small style="color: #6f6969"> '+b+"</small>":"";return{source:this,meta:{dataType:Tl.i,id:[this.getId(),f.properties.id].join("."),title:f.properties.title,titleHtml:g+B,icon:"Layer"===f.properties.type?"layers":"map",score:f.score||(0,Mi.Un)(t.trim(),f.properties.name),nextPage:i.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:n}}computeLayerOptions(f){const t=f.properties.url,i=this.extractQueryParamsFromSourceUrl(t);return Gt.Yv.removeUndefined({sourceOptions:{id:f.properties.id,type:f.properties.format,url:t,queryFormat:i.queryFormat,queryHtmlTarget:i.queryHtmlTarget,params:"wms"===f.properties.format?{LAYERS:f.properties.name}:void 0,layer:"wms"===f.properties.format?void 0:f.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:f.properties.title,maxResolution:(0,lo.bg)(Number(f.properties.maxScaleDenom)),minResolution:(0,lo.bg)(Number(f.properties.minScaleDenom)),metadata:{url:f.properties.metadataUrl,extern:!!f.properties.metadataUrl||void 0,abstract:f.properties.abstract||void 0},properties:this.formatter.formatResult(f).properties})}extractQueryParamsFromSourceUrl(f){let t,i;const n=this.options.queryFormat;if(n){for(const g of Object.keys(n)){const b=n[g];if("*"===b){t=di.s5[g.toUpperCase()];break}const B=b.urls;if(Array.isArray(B)){B.forEach(pe=>{-1!==f.indexOf(pe)&&(t=di.s5[g.toUpperCase()])});break}}(t===di.s5.HTML||t===di.s5.HTMLGML2)&&(i="iframe")}return{queryFormat:t,queryHtmlTarget:i}}static \u0275fac=function(t){return new(t||Xi)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"),e.CoB(Ks))};static \u0275prov=e.wxM({token:Xi,factory:Xi.\u0275fac})}function Md(l){return new Ks(l)}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[String,u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Xi.prototype,"getSearch",null);let Pd=(()=>{class l{static forRoot(){return{ngModule:l,providers:[Us._,Sl(),js(),{provide:bl,useFactory:Cd,deps:[C.ov]},{provide:Ks,useFactory:Md,deps:[C.ov]}]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[hl,_l,fl,vl,hl,_l,fl,vl]})}return l})();new e.UbH("styleListOptions");var qn=r(82736);function Ld(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",11)(1,"span")(2,"mat-icon",6),e.OEk(3,"format_color_fill"),e.C$Y(),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"igo-color-picker-form-field",12),e.qCj("colorChange",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.setLayerFillColor(n))}),e.C$Y()()}2&l&&(e.yG2(4),e.oRS(" ",e.kDX(5,1,"igo.geo.style.fill")," "))}let Gd=(()=>{class l{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){const t=this.data.layer.ol.getStyle();return t instanceof Function?void 0:t.clone()}constructor(t,i,n){this.dialogRef=t,this.formBuilder=i,this.data=n}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.layer.ol.getSource().getFeatures())"LineString"!==t.getGeometry()?.getType()&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let t=this.defaultValues.fillColor;const i=this.layerOlStyle;if(i?.getFill()?.getColor()){const n=i.getFill().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||.4})`}return t}getLayerStrokeColor(){let t=this.defaultValues.strokeColor;const i=this.layerOlStyle;if(i?.getStroke()?.getColor()){const n=i.getStroke().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||1})`}return t}setLayerFillColor(t){const i=(0,qn.f4)(t),n=this.layerOlStyle.clone();n.getImage().getFill().setColor(i),n.getFill().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.fillColor=t}setLayerStrokeColor(t){const i=(0,qn.f4)(t),n=this.layerOlStyle.clone();n.getImage().getStroke().setColor(i),n.getStroke().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.strokeColor=t}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(Z.KE),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:20,vars:11,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content",""],[1,"edition-drawing","mat-typography"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],[1,"stroke-palette-icon"],["formControlName","stroke",3,"colorChange"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["formControlName","fill",3,"colorChange"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"div",2)(5,"form",3),e.yuY(6,Ld,7,3,"div",4),e.I0R(7,"div",5)(8,"span")(9,"mat-icon",6),e.OEk(10,"border_color"),e.C$Y(),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"igo-color-picker-form-field",7),e.qCj("colorChange",function(b){return n.setLayerStrokeColor(b)}),e.C$Y()()()()(),e.I0R(14,"div",8)(15,"button",9),e.qCj("click",function(){return n.cancel()}),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.I0R(18,"button",10),e.qCj("click",function(){return n.confirm()}),e.OEk(19,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,5,"igo.geo.style.styleModal"),"\n"),e.yG2(4),e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(5),e.oRS(" ",e.kDX(12,7,"igo.geo.style.stroke")," "),e.yG2(5),e.oRS(" ",e.kDX(17,9,"igo.geo.style.cancel")," "))},dependencies:[bt.WQ,bt.iU,Z.y,Z.sz,Z.ue,Z.u,Z.sl,Z.uW,Z.Wo,o.u_,L.oB,L.qL,mr,bt.Yp,R.oJ,R.Gw,C._s,G.sD],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),$d=(()=>{class l{dialog;layer;constructor(t){this.dialog=t}openStyleModalDialog(){setTimeout(()=>{this.dialog.open(Gd,{disableClose:!1,data:{layer:this.layer},autoFocus:!1})},250)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},standalone:!0,features:[e.UHJ],decls:4,vars:3,consts:[["mat-icon-button","","color","primary",3,"matTooltip","click"],[1,"style-icon"]],template:function(i,n){1&i&&(e.I0R(0,"button",0),e.qCj("click",function(){return n.openStyleModalDialog()}),e.wVc(1,"translate"),e.I0R(2,"mat-icon",1),e.OEk(3,"palette "),e.C$Y()()),2&i&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[R.oJ,R.um,_.KO,_.a4,L.oB,L.qL,C._s,G.sD],changeDetection:0})}return l})();r(94688),r(28616);var Ml=r(90784);let Dl=(()=>{class l{cdRef;layer;map;complete=new e._w7;cancel=new e._w7;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.UHJ],decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(i,n){1&i&&e.wR5(0,"igo-ogc-filterable-item",0),2&i&&e.E7m("layer",n.layer)("header",!1)("map",n.map)},dependencies:[vi],changeDetection:0})}return l})(),Fl=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[Dl]})}return l})();const Pl=new e.UbH("OgcFilterWidget");function Ad(l){return l.create(Dl)}function kd(){return{provide:Pl,useFactory:Ad,deps:[Ml.cx]}}let Bd=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({})}return l})(),Ud=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[kd()],imports:[Ml.iC,Fl,Bd,bt.sr,Fl]})}return l})();var Ws=r(3360),Ji=r(47864),qt=function(l){return l.Layer="layer",l.Group="group",l}(qt||{}),kt=function(l){return l[l.wms=0]="wms",l[l.wmts=1]="wmts",l[l.baselayers=2]="baselayers",l[l.arcgisrest=3]="arcgisrest",l[l.tilearcgisrest=4]="tilearcgisrest",l[l.imagearcgisrest=5]="imagearcgisrest",l[l.composite=6]="composite",l}(kt||{});class _n{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(f){Object.assign(this,f)}}class Yd extends _n{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=kt[kt[kt.wms]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Vd extends _n{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=kt[kt[kt.wmts]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class jd extends _n{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=kt[kt[kt.baselayers]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Kd extends _n{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=kt[kt[kt.arcgisrest]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Rl extends _n{_collectCatlogItems;constructor(f,t,i){super(f),this._collectCatlogItems=t,this.type=kt[kt[i]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Wd extends _n{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=kt[kt[kt.composite]],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}}let Nd=(()=>{class l{http;config;languageService;messageService;capabilitiesService;constructor(t,i,n,g,b){this.http=t,this.config=i,this.languageService=n,this.messageService=g,this.capabilitiesService=b}loadCatalogs(){const t=this.config.getConfig("context")||{},i=this.config.getConfig("catalog")||{},n=i.url||t.url,g=i.sources||[],b=[];if(n){if(i.baselayers){const Fe=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${n}/baselayers`,type:"baselayers"}];b.push((0,Ve.of)(Fe))}const B=this.http.get(`${n}/catalogs`).pipe((0,d.k)(pe=>pe.map(fe=>Object.assign(fe,fe.options))),(0,Ge.a)(pe=>Pr.k));b.push(B)}return g.length>0&&b.push((0,Ve.of)(g).pipe((0,d.k)(B=>B.map(pe=>(pe.id||(pe.id=(0,Gt.uq)()),pe))))),(0,Ws.E)(...b).pipe((0,d.k)(B=>[].concat.apply([],B)))}loadCatalogItems(t){let i;return i=Ll.createInstanceCatalog(t,this),i.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,d.k)(i=>{const n=i.map(g=>({id:(0,Ji.KC)(g.sourceOptions),title:g.title,type:qt.Layer,externalProvider:t.externalProvider,options:g}));return[{id:"catalog.group.baselayers",type:qt.Group,externalProvider:t.externalProvider,title:t.title,items:n}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,d.k)(i=>{const n=[];if(!i)return n;i.Service&&i.Service.Abstract&&i.Service.Abstract.length&&(t.abstract=i.Service.Abstract);const g=[];this.flattenWmsCapabilities(i.Capability.Layer,0,g,t.groupSeparator);const b=Object.assign({},i.Capability.Layer);return b.Layer=g.filter(B=>0!==B.Layer.length),this.includeRecursiveItems(t,b,n),n}),(0,Ge.a)(()=>(this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.title}),Pr.k)))}flattenWmsCapabilities(t,i=0,n,g=" / "){if(!n.includes(t.Title)){const b=Object.assign({},t);b.Layer=[],n.push(b)}for(const b of t.Layer){const B=Object.assign({},b);i>0&&(B.Title=t.Title+g+b.Title),b.Layer?this.flattenWmsCapabilities(B,i+1,n,g):n.find(pe=>pe.Title===t.Title).Layer.push(b)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,d.k)(i=>this.getWMTSItems(t,i)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,d.k)(i=>this.getArcGISRESTItems(t,i)))}loadCatalogCompositeLayerItems(t){const i=t.composite,n=[];i.map(Ae=>{Ae.sortDirection=t.sortDirection,n.push(Ll.createInstanceCatalog(Ae,this))});const g=[];n.map(Ae=>g.push(Ae.collectCatalogItems()));let b=[];function B(Ae){return Ae.reduce((Je,ke)=>Je.concat(ke.type===qt.Group?B(ke.items):ke),[])}if(Object.keys(i).find(Ae=>i[Ae].groupImpose)){const Ae=(Je,ke)=>{const et=n[ke],lt=Object.assign({},et.groupImpose);lt.address=et.id,lt.type=qt.Group,lt.externalProvider=et.externalProvider,void 0===lt.sortDirection&&(lt.sortDirection=et.sortDirection),lt.items=[];const Ct=B(Je);return Ct.map(Bt=>Bt.address=`${lt.address}.${lt.id}`),lt.items=Ct,lt};b=g.map((Je,ke)=>Je.pipe((0,d.k)(et=>i[ke].groupImpose?Ae(et,ke):et)))}else b=g;const pe=(0,Ws.E)(...b).pipe((0,d.k)(Ae=>[].concat(...Ae))),Fe=(Ae,Je)=>Ae.reduce((ke,et,lt,Ct)=>{const Bt=Je(et),uo=Object.assign({},et);if(et.type===qt.Layer){const Ro=[],vn=[];if(Ct.filter((Lo,qo)=>{let Sn=!1;return Lo.title===Bt&&Lo.type===qt.Layer&&(qo!==lt&&Lo.address!==et.address&&(Sn=!0),Ro.push(qo)),Sn}).length>0){let Lo=Ro.findIndex(qo=>qo===lt)+1;uo.title=`${et.title} (${Lo})`,Lo=vn.findIndex(qo=>qo===lt)+1,uo.newMetadataUrl=`${et.newMetadataUrl} (${Lo})`}ke.find(Lo=>Lo.title===uo.title&&Lo.type===qt.Layer)||(ke[ke.length]=uo)}else et.type===qt.Group&&(uo.items=Fe(et.items,Ro=>Ro.title),ke[ke.length]=uo);return ke},[]);return pe.pipe((0,d.k)(Ae=>((Ae,Je)=>Ae.reduce((ke,et)=>{const lt=(Je=>Je.id)(et),Ct=ke.find(Bt=>Bt.id===lt);if(Ct){const Bt=ke.indexOf(Ct);-1===ke[Bt].address.split("|").indexOf(et.address)&&(ke[Bt].address=`${ke[Bt].address}|${et.address}`),ke[Bt].items.push(...et.items)}else ke[ke.length]=et;return ke},[]))(Ae)),(0,d.k)(Ae=>[].concat(...Ae)),(0,d.k)(Ae=>Fe(Ae,Je=>Je.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities(kt[t.type],t.url,t.version).pipe((0,Ge.a)(n=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(n),(0,Ve.of)(void 0))))}computeForcedProperties(t,i){if(!i||0===i.length)return;const n={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},g=i.find(b=>"*"===b.layerName);return g&&(g.metadataAbstractAll&&(n.metadataAbstractAll=g.metadataAbstractAll),g.metadataUrlAll&&(n.metadataUrlAll=g.metadataUrlAll)),i.map(b=>{t===b.layerName&&(b.title&&(n.title=b.title),b.metadataUrl&&(n.metadataUrl=b.metadataUrl),b.metadataAbstract&&(n.metadataAbstract=b.metadataAbstract))}),n}prepareCatalogItemLayer(t,i,n,g){const b=this.retrieveLayerInfoFormat(t.Name,n),B=g.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,pe=Object.assign({},g.queryParams,{LAYERS:t.Name,VERSION:g.version}),fe={type:"wms",url:g.url,crossOrigin:g.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:b,queryHtmlTarget:b===di.s5.HTML||b===di.s5.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},Fe=Object.assign({},fe,g.sourceOptions,{params:pe}),Ee=this.computeForcedProperties(t.Name,g.forcedProperties);let Ae,Je=!0;t.Abstract?Ae=t.Abstract:!t.Abstract&&g.abstract&&(Ae=g.abstract);const ke=t?.DataURL&&t?.DataURL.length>0?t?.DataURL[0].OnlineResource:void 0;let et=Ee?.metadataUrl||Ee?.metadataUrlAll||ke,lt=Ee?.metadataAbstract||Ee?.metadataAbstractAll||Ae;!Ee?.metadataUrl&&!Ee?.metadataUrlAll&&(Ee?.metadataAbstract||Ee?.metadataAbstractAll)&&(Je=!1),Ee?.metadataAbstract&&Ee?.metadataUrlAll&&(Je=!1);const Ct={id:(0,Ji.KC)(Fe),type:qt.Layer,title:Ee?.title?Ee.title:t.Title,address:i,externalProvider:g.externalProvider||!1,options:{maxResolution:(0,lo.bg)(t.MaxScaleDenominator),minResolution:(0,lo.bg)(t.MinScaleDenominator),metadata:{url:et,extern:Je,abstract:lt,type:fe.type},legendOptions:B,tooltip:{type:g.tooltipType},sourceOptions:Fe}};return Gt.Yv.removeUndefined(Ct)}prepareCatalogItemGroup(t,i,n,g,b){return{id:n,type:qt.Group,title:t.Title,address:b.id,externalProvider:b.externalProvider||!1,sortDirection:b.sortDirection,items:t.Layer.reduce((pe,fe)=>{if(void 0!==fe.Layer){const Ee=this.prepareCatalogItemGroup(fe,i,n+`.group.${fe.Name||fe.Layer[0].Name}`,g,b);pe.push(Ee)}else{if(!1===this.testLayerRegexes(fe.Name,i))return pe;const Fe=this.prepareCatalogItemLayer(fe,n,g,b);pe.push(Fe)}return pe},[])}}includeRecursiveItems(t,i,n,g=0){const b=(t.regFilters||[]).map(B=>new RegExp(B));if(i.Layer)for(const B of i.Layer){if(void 0!==B.Layer){this.includeRecursiveItems(t,B,n,g+1);continue}const pe=this.findCatalogInfoFormat(t);if(0!==g){const Fe=this.prepareCatalogItemGroup(i,b,`catalog.group.${i.Name||B.Name}`,pe,t);0!==Fe.items.length&&n.push(Fe);break}if(!1!==this.testLayerRegexes(B.Name,b)){const fe=this.prepareCatalogItemLayer(B,t.id,pe,t);n.push(fe)}}}getWMTSItems(t,i){if(!i)return[];const n=i.Contents.Layer,g=(t.regFilters||[]).map(b=>new RegExp(b));return i.ServiceIdentification&&i.ServiceIdentification.Abstract&&i.ServiceIdentification.Abstract.length&&(t.abstract=i.ServiceIdentification.Abstract),n.map(b=>{const B=this.computeForcedProperties(b.Title,t.forcedProperties);let pe=!0,fe=B?.metadataUrl||B?.metadataUrlAll,Fe=B?.metadataAbstract||B?.metadataAbstractAll||t.abstract;if(!B?.metadataUrl&&!B?.metadataUrlAll&&(B?.metadataAbstract||B?.metadataAbstractAll)&&(pe=!1),B?.metadataAbstract&&B?.metadataUrlAll&&(pe=!1),!1===this.testLayerRegexes(b.Identifier,g))return;const Ee=Object.assign({},t.queryParams,{version:"1.0.0"}),Ae={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:b.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},Je=Object.assign({},Ae,t.sourceOptions,{params:Ee});return Gt.Yv.removeUndefined({id:(0,Ji.KC)(Je),type:qt.Layer,title:B?.title?B.title:b.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:Je,metadata:{url:fe,extern:pe,abstract:Fe,type:Ae.type}}})}).filter(b=>void 0!==b)}getArcGISRESTItems(t,i){if(!i||!i.layers)return this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle"),[];const n=i.layers?i.layers.filter(Ee=>Ee.subLayerIds):[],g=i.layers?i.layers.filter(Ee=>!Ee.type||Ee.type===ot.I.FeatureLayer||Ee.type===ot.I.RasterLayer):[],b=(t.regFilters||[]).map(Ee=>new RegExp(Ee));let B;i.serviceDescription&&i.serviceDescription.length&&(B=i.serviceDescription.replace(/(<([^>]+)>)/gi,""));const pe=g.map(Ee=>{const Ae=this.computeForcedProperties(Ee.name,t.forcedProperties);let Je=t.abstract,ke=!0,et=Ae?.metadataUrl||Ae?.metadataUrlAll,lt=Ae?.metadataAbstract||Ae?.metadataAbstractAll||Je;if(!Ae?.metadataUrl&&!Ae?.metadataUrlAll&&(Ae?.metadataAbstract||Ae?.metadataAbstractAll)&&(ke=!1),Ae?.metadataAbstract&&Ae?.metadataUrlAll&&(ke=!1),!1===this.testLayerRegexes(Ee.id.toString(),b))return;const Ct={type:kt[t.type],url:t.url,layer:Ee.id.toString(),queryable:!0,queryFormat:di.s5.ESRIJSON,optionsFromCapabilities:!0},Bt=Object.assign({},Ct,t.sourceOptions);return Gt.Yv.removeUndefined({id:(0,Ji.KC)(Bt),type:qt.Layer,title:Ae?.title?Ae.title:Ee.name,externalProvider:t.externalProvider,options:{sourceOptions:Bt,minResolution:(0,lo.bg)(Ee.maxScale),maxResolution:(0,lo.bg)(Ee.minScale),metadata:{url:et,extern:ke,abstract:lt,type:t.type}}})}).filter(Ee=>void 0!==Ee),fe=[],Fe=n.map(Ee=>({options:void 0,address:`catalog.group.${Ee.name}`,id:`catalog.group.${Ee.name}`,type:qt.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:Ee.name,items:pe.filter(Ae=>Ee.subLayerIds.map(ke=>ke.toString()).includes(Ae.options.sourceOptions.layer)).map(Ae=>(fe.push(Ae.id),Object.assign({},Ae,{address:`catalog.group.${Ee.name}`})))})).filter(Ee=>Ee.items.length);if(n){const Ee=t.title||t.id,Ae=pe.filter(Je=>!fe.includes(Je.id)).map(Je=>Object.assign({},Je,{address:`catalog.group.${Ee}`}));Ae.length&&Fe.push({options:void 0,address:`catalog.group.${Ee}`,id:`catalog.group.${Ee}`,type:qt.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:Ee,items:Ae})}return n?Fe:pe}testLayerRegexes(t,i){return 0===i.length||void 0!==i.find(n=>n.test(t))}retrieveLayerInfoFormat(t,i){const n=i.find(B=>B.layer===t),g=i.find(B=>"*"===B.layer);let b;return n?b=n.queryFormat:g&&(b=g.queryFormat),b}findCatalogInfoFormat(t){const i=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(n=>{t.queryFormat[n]instanceof Array?t.queryFormat[n].forEach(g=>{i.find(b=>b.layer===g)||i.push({layer:g,queryFormat:n})}):i.find(g=>g.layer===t.queryFormat[n])||i.push({layer:t.queryFormat[n],queryFormat:n})}),i}static \u0275fac=function(i){return new(i||l)(e.CoB(u.KK),e.CoB(A.aW),e.CoB(C.ov),e.CoB(P.mi),e.CoB(ct.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class Ll{static createInstanceCatalog(f,t){let i;return i=f.hasOwnProperty("composite")?new Wd(f,n=>t.loadCatalogCompositeLayerItems(n)):f.type===kt[kt.baselayers]?new jd(f,n=>t.loadCatalogBaseLayerItems(n)):f.type===kt[kt.arcgisrest]?new Kd(f,n=>t.loadCatalogArcGISRestItems(n)):f.type===kt[kt.tilearcgisrest]?new Rl(f,n=>t.loadCatalogArcGISRestItems(n),kt.tilearcgisrest):f.type===kt[kt.imagearcgisrest]?new Rl(f,n=>t.loadCatalogArcGISRestItems(n),kt.imagearcgisrest):f.type===kt[kt.wmts]?new Vd(f,n=>t.loadCatalogWMTSLayerItems(n)):new Yd(f,n=>t.loadCatalogWMSLayerItems(n)),i}}var Ns=r(56708);function Hd(l,f){1&l&&e.wR5(0,"mat-icon",10)}function zd(l,f){1&l&&(e.I0R(0,"button",11)(1,"mat-icon",12),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(2,"translate"),e.OEk(3," public "),e.C$Y()()),2&l&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,1,"igo.geo.catalog.externalProvider.layer")))}function Xd(l,f){if(1&l&&(e.wR5(0,"igo-layer-legend",4),e.wVc(1,"async")),2&l){const t=e.GaO();e.E7m("layer",e.kDX(1,1,t.igoLayer$))}}let Gl=(()=>{class l{layerService;inRange$=new ue.g(!0);isPreview$=new ue.g(!1);isVisible$=new ue.g(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new ue.g(!1);igoLayer$=new ue.g(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new e._w7;addedLayerIsPreview=new e._w7;get title(){return(0,V.YB)(this.layer)}get icon(){return(0,V.sH)(this.layer)||"layers"}constructor(t){this.layerService=t}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return(0,V.YB)(this.layer);const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Ns.wL.TITLE:return this.layer.title;case Ns.wL.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Ns.wL.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,zn.K)()).subscribe(i=>this.igoLayer$.next(i))}onToggleClick(t){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const i=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,n=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=i&&t<=n)}isVisible(){if(this.layer?.id){const t=this.map.getLayerById(this.layer?.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(i){return new(i||l)(e.GI1(Or.I))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},standalone:!0,features:[e.UHJ],decls:24,vars:36,consts:[["class","catalog-browser-layer-carret","matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["matListItemIcon","",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item"),e.yuY(1,Hd,1,0,"mat-icon",0),e.I0R(2,"span",1),e.qCj("click",function(b){return n.askForLegend(b)}),e.OEk(3),e.C$Y(),e.I0R(4,"div",2),e.yuY(5,zd,4,3,"button",3),e.wR5(6,"igo-metadata-button",4),e.I0R(7,"button",5),e.qCj("mouseenter",function(b){return n.onMouseEvent(b)})("mouseleave",function(b){return n.onMouseEvent(b)})("click",function(b){return n.onToggleClick(b)}),e.wVc(8,"translate"),e.wVc(9,"async"),e.I0R(10,"mat-icon",6),e.wVc(11,"async"),e.wVc(12,"async"),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.wVc(16,"async"),e.OEk(17),e.wVc(18,"async"),e.C$Y()()()(),e.I0R(19,"div",7,8),e.yuY(21,Xd,2,3,"igo-layer-legend",9),e.wVc(22,"async"),e.wVc(23,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.haveGroup()),e.yG2(),e.E7m("ngClass",n.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",n.computeTitleTooltip()),e.yG2(),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.layer.externalProvider),e.yG2(),e.E7m("layer",n.layer),e.yG2(),e.E7m("matTooltip",e.kDX(8,14,n.computeTooltip()))("color",e.kDX(9,16,n.isPreview$)?"":n.added?"warn":""),e.yG2(3),e.E7m("igoMatBadgeIcon",n.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",e.kDX(11,18,n.inRange$)&&!0===e.kDX(12,20,n.isVisible$)||e.kDX(13,22,n.inRange$)&&!n.added||e.kDX(14,24,n.inRange$)&&e.kDX(15,26,n.isPreview$))("matBadgeDisabled",!1===e.kDX(16,28,n.inRange$)),e.yG2(7),e.oRS(" ",e.kDX(18,30,n.isPreview$)?"plus":n.added?"delete":"add"," "),e.yG2(4),e.E7m("ngIf",e.kDX(22,32,n.layerLegendShown$)&&e.kDX(23,34,n.igoLayer$)&&n.catalogAllowLegend))},dependencies:[de.iI,de.g9,de.Y1,de.UV,de.At,o.u_,L.oB,L.qL,o.QF,_.KO,_.a4,R.oJ,R.um,Gs,M.g,M.S,ll.q,Et,o.a,C._s,G.sD],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function Jd(l,f){1&l&&(e.I0R(0,"mat-icon",10),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2," public "),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.group"))}function Qd(l,f){if(1&l&&(e.I0R(0,"button",8),e.yuY(1,Jd,3,3,"mat-icon",9),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.group.externalProvider)}}function Zd(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"button",11),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onToggleClick(n))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.I0R(4,"mat-icon"),e.OEk(5,"delete"),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("matTooltip",e.kDX(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.kDX(3,4,t.disabled$))}}function qd(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",12),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.onToggleClick(n))}),e.wVc(1,"translate"),e.wVc(2,"async"),e.I0R(3,"mat-icon"),e.OEk(4,"add"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.kDX(2,4,t.disabled$))}}function ep(l,f){1&l&&e.C_f(0)}function tp(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",14),e.qCj("addedLayerIsPreview",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onLayerPreview(n))})("addedChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onLayerAddedChange(n))}),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("resolution",i.resolution)("map",i.map)("catalogAllowLegend",i.catalogAllowLegend)("added",i.state.get(t).added)}}function op(l,f){if(1&l&&e.yuY(0,ep,1,0,"ng-container",13)(1,tp,2,5,"ng-container",13),2&l){const t=f.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let ip=(()=>{class l{store=new V.qc([]);added$=new ue.g(!1);preview$=new ue.g(!1);disabled$=new ue.g(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new e._w7;layerAddedChange=new e._w7;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===qt.Group}isLayer(t){return t.type===qt.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const i=t.added,n=t.layer;this.store.view.all().filter(b=>b.id!==n.id).map(b=>this.state.get(b).added||!1).every(b=>b===i)?i?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(i=>!0===(this.state.get(i).added||!1));this.added$.next(t)}evaluateDisabled(t){let i=!1;!1===this.toggleCollapsed&&(i=t),this.disabled$.next(i)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},standalone:!0,features:[e.UHJ],decls:16,vars:14,consts:[["matListItemIcon","","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"target","collapsed","toggle"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","map","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(i,n){if(1&i&&(e.I0R(0,"mat-list-item")(1,"mat-icon",0),e.qCj("toggle",function(b){return n.onToggleCollapsed(b)}),e.OEk(2," expand_less "),e.C$Y(),e.I0R(3,"span",1),e.qCj("click",function(){return n.onTitleClick()}),e.OEk(4),e.C$Y(),e.I0R(5,"div",2),e.yuY(6,Qd,2,1,"button",3)(7,Zd,6,6,"ng-container",4),e.wVc(8,"async"),e.wVc(9,"async"),e.yuY(10,qd,5,6,"ng-template",null,5,e.gJz),e.C$Y()(),e.I0R(12,"div",null,6),e.yuY(14,op,2,2,"ng-template",7),e.wVc(15,"async"),e.C$Y()),2&i){const g=e.Gew(11),b=e.Gew(13);e.yG2(),e.E7m("target",b)("collapsed",n.collapsed),e.yG2(2),e.E7m("matTooltip",n.title),e.yG2(),e.cNF(n.title),e.yG2(2),e.E7m("ngIf",n.group.externalProvider),e.yG2(),e.E7m("ngIf",e.kDX(8,8,n.added$)&&!1===e.kDX(9,10,n.preview$))("ngIfElse",g),e.yG2(7),e.E7m("ngForOf",e.kDX(15,12,n.store.view.all$()))}},dependencies:[de.iI,de.g9,de.Y1,de.UV,de.At,L.oB,L.qL,le.mK,_.KO,_.a4,o.u_,R.oJ,R.um,o.Iw,Gl,s.qU,o.a,C._s,G.sD],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function np(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-group",3),e.qCj("addedChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onGroupAddedChange(n))})("layerAddedChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("catalog",i.catalog)("group",t)("map",i.map)("state",i.store.state)("resolution",e.kDX(2,8,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("collapsed",1!==i.store.count)("toggleCollapsed",i.toggleCollapsedGroup)}}function rp(l,f){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",4),e.qCj("addedChange",function(n){e.usT(t);const g=e.GaO(2);return e.CGJ(g.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("map",i.map)("resolution",e.kDX(2,5,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("added",i.store.state.get(t).added)}}function sp(l,f){if(1&l&&e.yuY(0,np,3,10,"ng-container",2)(1,rp,3,7,"ng-container",2),2&l){const t=f.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let $l=(()=>{class l{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(t,i){this.layerService=t,this.cdRef=i}ngOnInit(){const t=this.map.layers.map(n=>({id:n.options.source.id,title:n.title,type:qt.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:n=>n.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new V.YX(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===qt.Group}isLayer(t){return t.type===qt.Layer}onLayerAddedChange(t){const i=t.layer;this.store.state.update(i,{added:t.added},!1),t.added?this.addLayerToMap(i,t):this.removeLayerFromMap(i)}onGroupAddedChange(t){const i=t.group;this.store.state.update(i,{added:t.added},!1),t.added?this.addGroupToMap(i,t):this.removeGroupFromMap(i)}addLayerToMap(t,i){this.addLayersToMap([t],i)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,i){const n=t.map(g=>(g.options.sourceOptions.optionsFromApi||(g.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(g.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(g.options)));(0,Ws.E)(...n).subscribe(g=>{"click"===i.event.type&&i.added&&this.map.layersAddedByClick$.next(g),this.store.state.updateMany(g,{added:!0}),this.map.addLayers(g)})}removeLayersFromMap(t){t.forEach(i=>{if(this.store.state.update(i,{added:!1}),!0===i.options.baseLayer){const n=this.map.getLayerById(i.options.id);void 0!==n&&this.map.removeLayer(n)}else{const n=this.map.getLayerById(i.id);void 0!==n&&this.map.removeLayer(n)}})}sortCatalogItemsByTitle(t,i){const n=t.sort((g,b)=>{const B=g.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),pe=b.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return B<pe?-1:B>pe?1:0});switch(i){case"asc":return n;case"desc":return n.reverse();default:return t}}addGroupToMap(t,i){let n=t.items.filter(g=>{const b=this.store.state.get(g).added||!1;return this.isLayer(g)&&!1===b});void 0!==t.sortDirection&&(n=this.sortCatalogItemsByTitle(n,t.sortDirection)),this.addLayersToMap(n.reverse(),i)}removeGroupFromMap(t){const i=t.items.filter(n=>{const g=this.store.state.get(n).added||!1;return this.isLayer(n)&&!0===g});this.removeLayersFromMap(i)}static \u0275fac=function(i){return new(i||l)(e.GI1(Or.I),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[e.UHJ],decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","map","resolution","catalogAllowLegend","added","addedChange"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,sp,2,2,"ng-template",1),e.wVc(2,"async"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.store.view.all$())))},dependencies:[s.yM,o.Iw,o.u_,ip,Gl,s.qU,o.a],encapsulation:2,changeDetection:0})}return l})();function ap(l,f){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("matTooltip",t.title)("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function lp(l,f){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("matTooltip",t.url)("value",t),e.yG2(),e.oRS(" ",t.url," ")}}function cp(l,f){if(1&l&&(e.I0R(0,"mat-option",18),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",19),e.OEk(2),e.C$Y()()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(2),e.cNF(t)}}const up=(l,f)=>({value:l,email:f});function dp(l,f){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.IBC(1,up,t.addedCatalog.url,t.emailAddress))," ")}}const pp=l=>({value:l});function mp(l,f){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.unavailable",e.S45(1,pp,t.addedCatalog.url))," ")}}let Al=(()=>{class l{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new ue.g([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(t,i,n,g,b){this.formBuilder=t,this.languageService=i,this.configService=n,this.dialogRef=g,this.data=b,this.store=b.store,this.predefinedCatalogs=b.predefinedCatalogs,this.error=b.error,this.addedCatalog=b.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[Z.AQ.required]],type:[this.defaultAddedCatalogType,[Z.AQ.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(ot.S),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(Z.AQ.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(i){return new(i||l)(e.GI1(Z.KE),e.GI1(C.ov),e.GI1(A.aW),e.GI1(bt.yI),e.GI1(bt.sR,8))};static \u0275cmp=e.In1({type:l,selectors:[["igo-add-catalog-dialog"]],standalone:!0,features:[e.UHJ],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["matListItemTitle",""],[1,"error"]],template:function(i,n){if(1&i&&(e.I0R(0,"h1",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e.wR5(7,"input",4),e.wVc(8,"translate"),e.I0R(9,"mat-autocomplete",5,6),e.qCj("optionSelected",function(b){return n.changeUrlOrTitle(b.option.value)}),e.yuY(11,ap,2,3,"mat-option",7),e.wVc(12,"async"),e.C$Y()()(),e.I0R(13,"div",3)(14,"mat-form-field"),e.wR5(15,"input",8),e.I0R(16,"mat-autocomplete",5,9),e.qCj("optionSelected",function(b){return n.changeUrlOrTitle(b.option.value)}),e.yuY(18,lp,2,3,"mat-option",7),e.wVc(19,"async"),e.C$Y()()(),e.I0R(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.yuY(23,cp,3,2,"mat-option",11),e.C$Y()()()(),e.yuY(24,dp,3,4,"span",12)(25,mp,3,3,"span",12),e.C$Y(),e.I0R(26,"div",13)(27,"div",14)(28,"button",15),e.qCj("click",function(){return n.cancel()}),e.OEk(29),e.wVc(30,"translate"),e.C$Y(),e.I0R(31,"button",16),e.qCj("click",function(){return n.addCatalog(n.form.value)}),e.OEk(32),e.wVc(33,"translate"),e.C$Y()()()),2&i){const g=e.Gew(10),b=e.Gew(17);e.yG2(),e.oRS(" ",e.kDX(2,13,"igo.geo.catalog.library.addTitle"),"\n"),e.yG2(3),e.E7m("formGroup",n.form),e.yG2(3),e._6D("placeholder",e.kDX(8,15,"igo.geo.printForm.title")),e.E7m("matAutocomplete",g),e.yG2(4),e.E7m("ngForOf",e.kDX(12,17,n.predefinedCatalogsList$)),e.yG2(4),e.E7m("matAutocomplete",b),e.yG2(3),e.E7m("ngForOf",e.kDX(19,19,n.predefinedCatalogsList$)),e.yG2(5),e.E7m("ngForOf",n.typeCapabilities),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&n.emailAddress),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&!n.emailAddress),e.yG2(4),e.oRS(" ",e.kDX(30,21,"igo.geo.catalog.library.cancel")," "),e.yG2(2),e.E7m("disabled",!n.form.valid),e.yG2(),e.oRS(" ",e.kDX(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[bt.WQ,bt.iU,Z.y,Z.sz,Z.ot,Z.ue,Z.u,Z.sl,Z.uW,Z.Wo,ve.wb,ve.Up,yt.cN,yt.yi,Kt.U1,Kt.e,ne.I5,Kt.cG,o.Iw,ne.Ax,_.KO,_.a4,ye.d5,ye.kX,de.iI,de.UV,o.u_,bt.Yp,R.oJ,R.Gw,o.a,C._s,G.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]})}return l})();var kl=r(11772);function gp(l,f){1&l&&(e.I0R(0,"mat-icon",5),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2," public "),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.catalog"))}function hp(l,f){if(1&l){const t=e.KQA();e.I0R(0,"button",6),e.qCj("click",function(n){e.usT(t);const g=e.GaO();return e.CGJ(g.removeCatalogFromLibrary(n))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"delete"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.library.remove"))}function fp(l,f){1&l&&(e.I0R(0,"button",7),e.wR5(1,"mat-icon"),e.C$Y())}let yp=(()=>{class l{catalog;map;catalogRemove=new e._w7;get title(){return(0,V.YB)(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},standalone:!0,features:[e.UHJ],decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["disabled","true","mat-icon-button","",1,"igo-blank"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item")(1,"span",0),e.OEk(2),e.C$Y(),e.I0R(3,"div",1),e.yuY(4,gp,3,3,"mat-icon",2)(5,hp,4,3,"button",3)(6,fp,2,0,"button",4),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.catalog.externalProvider),e.yG2(),e.E7m("ngIf",n.catalog.removable),e.yG2(),e.E7m("ngIf",!n.catalog.removable))},dependencies:[de.iI,de.g9,de.Y1,de.UV,de.At,o.u_,L.oB,L.qL,_.KO,_.a4,R.oJ,R.um,C._s,G.sD],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0})}return l})();function _p(l,f){if(1&l){const t=e.KQA();e.I0R(0,"igo-catalog-library-item",3),e.qCj("catalogRemove",function(){const g=e.usT(t).$implicit,b=e.GaO();return e.CGJ(b.onCatalogRemove(g))})("select",function(){const g=e.usT(t).$implicit,b=e.GaO();return e.CGJ(b.onCatalogSelect(g))}),e.C$Y()}if(2&l){const t=f.$implicit,i=e.GaO();e.E7m("map",i.map)("catalog",t)}}function Cp(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",4)(1,"button",5),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addCatalogDialog())}),e.wVc(2,"translate"),e.OEk(3),e.wVc(4,"translate"),e.wR5(5,"mat-icon",6),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("matTooltip",e.kDX(2,3,"igo.geo.catalog.library.addBtn")),e.yG2(2),e.oRS(" ",e.kDX(4,5,"igo.geo.catalog.library.addBtn")," "),e.yG2(2),e.E7m("svgIcon",t.layerPlusIcon.name)}}let Bl=(()=>{class l{capabilitiesService;messageService;storageService;dialog;iconService;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new e._w7;submitDisabled=!0;layerPlusIcon=li.er;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}get selectedCatalogId(){return this.storageService.get("selectedCatalogId",io.Ab.SESSION)}set selectedCatalogId(t){this.storageService.set("selectedCatalogId",t,io.Ab.SESSION)}constructor(t,i,n,g,b){this.capabilitiesService=t,this.messageService=i,this.storageService=n,this.dialog=g,this.iconService=b,this.iconService.registerSvg(this.layerPlusIcon)}ngOnInit(){if(this.store.state.clear(),this.selectedCatalogId){const t=this.store.all().find(i=>i.id===this.selectedCatalogId);t&&this.onCatalogSelect(t)}this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=kl.Cy.hashStr((t.type||"wms")+(0,Ji.iL)(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.selectedCatalogId=t.id,this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let i=kl.Cy.hashStr(t.type+(0,Ji.iL)(t.url));const n=this.predefinedCatalogs.find(g=>g.id===t.id);n&&(t.version=n.version,t.externalProvider=n.externalProvider,i=n.id),this.store.get(i)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,Ge.a)(g=>{if(g.error)return this.addCatalogDialog(!0,t),g.error.caught=!0,g;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),g})).subscribe(g=>{let b,B;switch(t.type){case"wms":b=t.title||g.Service.Title,B=t.version||g.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":b=t.title||g.mapName;break;case"wmts":b=t.title||g.ServiceIdentification.ServiceType;break;default:b=t.title}const pe=Gt.Yv.removeUndefined(Object.assign({},n,Gt.Yv.removeUndefined({id:i,title:b,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:B})));this.store.insert(pe);const fe=this.addedCatalogs.slice(0);fe.push(pe),this.addedCatalogs=fe,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(i=>i.id!==t.id)}addCatalogDialog(t,i){this.dialog.open(Al,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:i}}).afterClosed().subscribe(g=>{this.addCatalog(g)})}static \u0275fac=function(i){return new(i||l)(e.GI1(ct.S),e.GI1(P.mi),e.GI1(io.yQ),e.GI1(bt.qW),e.GI1(li.IL))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},standalone:!0,features:[e.UHJ],decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],[3,"svgIcon"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,_p,1,2,"ng-template",1),e.wVc(2,"async"),e.C$Y(),e.yuY(3,Cp,6,7,"div",2)),2&i&&(e.E7m("navigation",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.getCatalogs())),e.yG2(2),e.E7m("ngIf",n.addCatalogAllowed))},dependencies:[s.yM,o.Iw,yp,s.qU,o.u_,R.oJ,R.Gw,_.KO,_.a4,L.oB,L.qL,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0})}return l})();r(86464),r(40956),r(72432),r(7284);var Sp=r(56520);function bp(l,f){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-button-toggle-group",4),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.geometryType,n)||(g.geometryType=n),e.CGJ(n)}),e.wVc(2,"async"),e.I0R(3,"mat-button-toggle",5),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",6),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",7),e.OEk(10),e.wVc(11,"translate"),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",void 0!==e.kDX(2,8,t.value$)),e.OKB("ngModel",t.geometryType),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Point")<0),e.yG2(),e.oRS(" ",e.kDX(5,10,"igo.geo.geometry.point")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("LineString")<0),e.yG2(),e.oRS(" ",e.kDX(8,12,"igo.geo.geometry.line")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Polygon")<0),e.yG2(),e.oRS(" ",e.kDX(11,14,"igo.geo.geometry.polygon")," ")}}function Op(l,f){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",8)(1,"input",9),e.iHE("ngModelChange",function(n){e.usT(t);const g=e.GaO();return e.kNx(g.drawGuide,n)||(g.drawGuide=n),e.CGJ(n)}),e.C$Y(),e.I0R(2,"mat-icon",10),e.OEk(3,"adjust "),e.C$Y(),e.I0R(4,"span",11),e.OEk(5),e.wVc(6,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("placeholder",t.drawGuidePlaceholder),e.OKB("ngModel",t.drawGuide),e.yG2(),e.E7m("color","primary"),e.yG2(3),e.cNF(e.kDX(6,4,"igo.geo.measure.meters"))}}let Hs=class aa{cdRef;value$=new ue.g(void 0);value$$;set drawControlIsActive(f){this._drawControlIsActive=f,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(f){this._freehandDrawIsActive=f,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(f){this.geometryType$.next(f)}get geometryType(){return this.geometryType$.value}geometryType$=new ue.g(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(f){this.drawGuide$.next(f)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new ue.g(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(f){this.cdRef=f}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(f=>{this.value$.next(f||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(t){return new(t||aa)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:aa,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},standalone:!0,features:[e.UHJ],decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"disabled","ngModel","ngModelChange"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["matPrefix","",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(t,i){1&t&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.yuY(3,bp,12,16,"div",1)(4,Op,7,6,"mat-form-field",2)),2&t&&(e.E7m("formControl",i.formControl)("map",i.map)("geometryType",e.kDX(1,12,i.geometryType$))("drawGuide",e.kDX(2,14,i.drawGuide$))("measure",i.measure)("drawControlIsActive",i.drawControlIsActive)("freehandDrawIsActive",i.freehandDrawIsActive)("controlOptions",i.controlOptions)("drawStyle",i.drawStyle)("overlayStyle",i.overlayStyle),e.yG2(3),e.E7m("ngIf",i.geometryTypeField),e.yG2(),e.E7m("ngIf",i.drawGuideField))},dependencies:[q,Z.y,Z.ot,Z.O4,Z.ue,Z._G,Z.sl,Z.ug,o.u_,he.ue,he.gn,he.KU,ve.wb,ve.Up,ve.is,ve.Gm,yt.cN,yt.yi,L.oB,L.qL,o.a,C._s,G.sD],styles:["[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}"],changeDetection:0})};Hs=(0,Lt.UN)([(0,Sp.wr)("geometry"),(0,Lt.YR)("design:paramtypes",[e.kD9])],Hs);var Ul=r(48920),Yl=(r(60192),r(42860)),Vl=r(34419),jl=(r(94440),r(55452),r(78416)),Kl=r(65972),Wl=r(76332),Nl=(r(87159),r(50056),r(55760),r(72124),r(50208)),Hl=r(75872);let Fp=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[Ul.Q,Yl.c,Vl.e,jl.a,Kl.I,Wl.i,Nl.w,Hl.q]})}return l})();r(79280);var Pp=r(56264),jt=r(47580);const Rp=l=>({column:l,value:130});function Lp(l,f){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,Rp,e.kDX(3,4,"igo.geo.printForm.title")))))}const Gp=l=>({column:l,value:120});function $p(l,f){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,Gp,e.kDX(3,4,"igo.geo.printForm.subtitle")))))}const Ap=(l,f)=>({column:l,value:f});function kp(l,f){if(1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.IBC(6,Ap,e.kDX(3,4,"igo.geo.printForm.comment"),t.maxLength)))}}function Bp(l,f){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function Up(l,f){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.oRS(" ",e.kDX(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}const zl=()=>["newpage","newimage"];function Yp(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.yuY(1,Bp,3,3,"ng-container",3)(2,Up,3,3,"ng-container",3),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.E7m("ngIf",!e.q4q(3,zl).includes(t.value)),e.yG2(),e.E7m("ngIf",e.q4q(4,zl).includes(t.value))}}function Vp(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function jp(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function Kp(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function Wp(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function Np(l,f){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=f.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm."+t.value)," ")}}let Hp=(()=>{class l{formBuilder;mediaService;form;outputFormats=jt.wf;paperFormats=jt.QH;orientations=jt.qp;resolutions=[...jt.wR];imageFormats=jt.mw;legendPositions=jt.ID;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||jt.mw.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||jt.wf.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||jt.QH.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||jt.qp.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||"96",{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||jt.ID.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new e._w7;maxLength=180;constructor(t,i){this.formBuilder=t,this.mediaService=i,this.form=this.formBuilder.group({title:["",[Z.AQ.minLength(0),Z.AQ.maxLength(130)]],subtitle:["",[Z.AQ.minLength(0),Z.AQ.maxLength(120)]],comment:["",[Z.AQ.minLength(0),Z.AQ.maxLength(this.maxLength)]],outputFormat:["",[Z.AQ.required]],paperFormat:["",[Z.AQ.required]],imageFormat:["",[Z.AQ.required]],resolution:["",[Z.AQ.required]],orientation:["",[Z.AQ.required]],legendPosition:["",[Z.AQ.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}ngOnInit(){this.doZipFileField.setValue(!1),this.mediaService.isMobile()&&(this.resolutions=this.resolutions.filter(t=>"300"!==t))}handleFormSubmit(t,i){t.isPrintService=this.isPrintService,i&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case jt.QH.A0:this.maxLength=this.orientation===jt.qp.landscape?900:600;break;case jt.QH.A1:this.maxLength=this.orientation===jt.qp.landscape?600:400;break;case jt.QH.A2:this.maxLength=this.orientation===jt.qp.landscape?400:300;break;case jt.QH.A3:this.maxLength=this.orientation===jt.qp.landscape?300:200;break;case jt.QH.A4:this.maxLength=this.orientation===jt.qp.landscape?200:100;break;case jt.QH.A5:this.maxLength=this.orientation===jt.qp.landscape?120:80;break;case jt.QH.Letter:this.maxLength=this.orientation===jt.qp.landscape?180:140;break;default:this.maxLength=this.orientation===jt.qp.landscape?200:140}this.commentField.setValidators([Z.AQ.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(i){return new(i||l)(e.GI1(Z.KE),e.GI1(Pp.QB))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},standalone:!0,features:[e.UHJ],decls:95,vars:103,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder","selectionChange"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder","selectionChange"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"input",2),e.wVc(7,"translate"),e.yuY(8,Lp,4,8,"mat-error",3),e.C$Y()(),e.I0R(9,"div",1)(10,"mat-form-field")(11,"mat-label"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.wR5(14,"input",4),e.wVc(15,"translate"),e.yuY(16,$p,4,8,"mat-error",3),e.C$Y()(),e.I0R(17,"div",1)(18,"mat-form-field")(19,"mat-label"),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.wR5(22,"input",5),e.wVc(23,"translate"),e.yuY(24,kp,4,9,"mat-error",3),e.C$Y()(),e.I0R(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-slide-toggle",9),e.OEk(31),e.wVc(32,"translate"),e.C$Y(),e.I0R(33,"mat-slide-toggle",10),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.I0R(36,"div",1)(37,"mat-form-field")(38,"mat-label"),e.OEk(39),e.wVc(40,"translate"),e.C$Y(),e.I0R(41,"mat-select",11),e.wVc(42,"translate"),e.yuY(43,Yp,3,5,"mat-option",12),e.wVc(44,"keyvalue"),e.C$Y()()(),e.I0R(45,"div",1)(46,"mat-form-field")(47,"mat-label"),e.OEk(48),e.wVc(49,"translate"),e.C$Y(),e.I0R(50,"mat-select",13),e.qCj("selectionChange",function(){return n.toggleImageSaveProp()}),e.wVc(51,"translate"),e.yuY(52,Vp,2,2,"mat-option",12),e.wVc(53,"keyvalue"),e.C$Y()()(),e.I0R(54,"div",1)(55,"mat-form-field")(56,"mat-label"),e.OEk(57),e.wVc(58,"translate"),e.C$Y(),e.I0R(59,"mat-select",14),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(60,"translate"),e.yuY(61,jp,3,4,"mat-option",12),e.wVc(62,"keyvalue"),e.C$Y()()(),e.I0R(63,"div",1)(64,"mat-form-field")(65,"mat-label"),e.OEk(66),e.wVc(67,"translate"),e.C$Y(),e.I0R(68,"mat-select",15),e.wVc(69,"translate"),e.yuY(70,Kp,2,2,"mat-option",12),e.wVc(71,"keyvalue"),e.C$Y()()(),e.I0R(72,"div",1)(73,"mat-form-field")(74,"mat-label"),e.OEk(75),e.wVc(76,"translate"),e.wVc(77,"translate"),e.C$Y(),e.I0R(78,"mat-select",16),e.wVc(79,"translate"),e.yuY(80,Wp,2,2,"mat-option",12),e.C$Y()()(),e.I0R(81,"div",1)(82,"mat-form-field")(83,"mat-label"),e.OEk(84),e.wVc(85,"translate"),e.C$Y(),e.I0R(86,"mat-select",17),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(87,"translate"),e.yuY(88,Np,3,4,"mat-option",12),e.wVc(89,"keyvalue"),e.C$Y()()(),e.I0R(90,"div",18)(91,"button",19),e.qCj("click",function(){return n.handleFormSubmit(n.form.value,n.form.valid)}),e.wVc(92,"async"),e.OEk(93),e.wVc(94,"translate"),e.C$Y()()()),2&i&&(e.E7m("formGroup",n.form),e.yG2(4),e.cNF(e.kDX(5,45,"igo.geo.printForm.title")),e.yG2(2),e._6D("placeholder",e.kDX(7,47,"igo.geo.printForm.title")),e.yG2(2),e.E7m("ngIf",null==n.titleField.errors?null:n.titleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(13,49,"igo.geo.printForm.subtitle")),e.yG2(2),e._6D("placeholder",e.kDX(15,51,"igo.geo.printForm.subtitle")),e.yG2(2),e.E7m("ngIf",null==n.subtitleField.errors?null:n.subtitleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(21,53,"igo.geo.printForm.comment")),e.yG2(2),e._6D("placeholder",e.kDX(23,55,"igo.geo.printForm.comment")),e.yG2(2),e.E7m("ngIf",null==n.commentField.errors?null:n.commentField.errors.maxlength),e.yG2(3),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(29,57,"igo.geo.printForm.showProjection")," "),e.yG2(2),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(32,59,"igo.geo.printForm.showScale")," "),e.yG2(2),e.m4B("display",n.isPrintService?"none":""),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(35,61,"igo.geo.printForm.doZipFile")," "),e.yG2(5),e.cNF(e.kDX(40,63,"igo.geo.printForm.legendPosition")),e.yG2(2),e._6D("placeholder",e.kDX(42,65,"igo.geo.printForm.legendPosition")),e.yG2(2),e.E7m("ngForOf",e.kDX(44,67,n.legendPositions)),e.yG2(5),e.cNF(e.kDX(49,69,"igo.geo.printForm.outputFormat")),e.yG2(2),e._6D("placeholder",e.kDX(51,71,"igo.geo.printForm.outputFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(53,73,n.outputFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(58,75,"igo.geo.printForm.paperFormat")),e.yG2(2),e._6D("placeholder",e.kDX(60,77,"igo.geo.printForm.paperFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(62,79,n.paperFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"none":"block"),e.yG2(3),e.cNF(e.kDX(67,81,"igo.geo.printForm.imageFormat")),e.yG2(2),e._6D("placeholder",e.kDX(69,83,"igo.geo.printForm.imageFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(71,85,n.imageFormats)),e.yG2(5),e.CAO("",e.kDX(76,87,"igo.geo.printForm.resolution")," (",e.kDX(77,89,"igo.geo.printForm.resolutionUnit"),")"),e.yG2(3),e._6D("placeholder",e.kDX(79,91,"igo.geo.printForm.resolution")),e.yG2(2),e.E7m("ngForOf",n.resolutions),e.yG2(),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(85,93,"igo.geo.printForm.orientation")),e.yG2(2),e._6D("placeholder",e.kDX(87,95,"igo.geo.printForm.orientation")),e.yG2(2),e.E7m("ngForOf",e.kDX(89,97,n.orientations)),e.yG2(3),e.E7m("disabled",!n.form.valid||e.kDX(92,99,n.disabled$)),e.yG2(2),e.oRS(" ",e.kDX(94,101,"igo.geo.printForm.saveBtn")," "))},dependencies:[Z.y,Z.sz,Z.ot,Z.ue,Z.u,Z.sl,Z.uW,Z.Wo,ve.wb,ve.Up,ve.w5,ve.wJ,yt.cN,yt.yi,o.u_,ut.GE,ut.cP,ye.d5,ye.kX,ne.I5,o.Iw,ne.Ax,R.oJ,R.Gw,o.a,o.uq,C._s,G.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]})}return l})();var Gr=r(37496),zp=r(29272);let Xp=(()=>{class l{printService;disabled$=new ue.g(!1);get map(){return this._map}set map(t){this._map=t}_map;get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}_paperFormat;get orientation(){return this._orientation}set orientation(t){this._orientation=t}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}_legendPosition;get resolution(){return this._resolution}set resolution(t){this._resolution=t}_resolution;constructor(t){this.printService=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,Gr.U)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let i=1;t.showLegend&&i++,"tiff"===t.imageFormat.toLowerCase()&&i++,"newpage"===t.legendPosition&&i++,this.printService.defineNbFileToProcess(i),this.printService.downloadMapImage(this.map,t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition).pipe((0,Gr.U)(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(i){return new(i||l)(e.GI1(zp.K))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},standalone:!0,features:[e.UHJ],decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(i,n){1&i&&(e.I0R(0,"igo-print-form",0),e.qCj("submit",function(b){return n.handleFormSubmit(b)}),e.C$Y()),2&i&&e.E7m("outputFormat",n.outputFormat)("paperFormat",n.paperFormat)("orientation",n.orientation)("imageFormat",n.imageFormat)("resolution",n.resolution)("legendPosition",n.legendPosition)("disabled$",n.disabled$)},dependencies:[Hp],encapsulation:2})}return l})();r(43940);var Cn=r(72156),Jp=r(74180);function Qp(...l){const f=[{provide:Cn.WI,useClass:Cn.WI},(0,Jp.c9)()];for(const t of l)f.push(...t.providers);return f}var Xl=function(l){return l[l.OSRM=0]="OSRM",l}(Xl||{}),Jl=r(9452),Ql=r(96580);let Zp=(()=>{class l extends Ql.U{_http;_config;get options(){return this._options}set options(t){this._options=t}get sourceName(){return this._options.name}set sourceName(t){this._options.name=t}get baseUrl(){return this._options.baseUrl}set baseUrl(t){this._options.baseUrl=t}get url(){return`${this.baseUrl}${this.getEnabledProfile().name}/`}get profiles(){return this._options.profiles}set profiles(t){this._options.profiles=t}_options;constructor(t,i){super(),this._http=t,this._config=i,this._options=this._config.getConfig("directionsSources.osrm"),this.baseUrl||(this.baseUrl="/apis/itineraire/route/v1/"),this.sourceName||(this.sourceName="OSRM Qu\xe9bec"),this.profiles?this.profiles.find(n=>n.enabled)||(this.profiles[0].enabled=!0):this.profiles=[{enabled:!0,name:"driving"}]}getSourceName(){return this.sourceName}getEnabledProfile(){return this.profiles.find(t=>t.enabled)}getProfileWithAuthorization(){return this.profiles.find(t=>t.authorization)}route(t,i={}){const n=this.getRouteParams(i);return this.getRoute(t,n)}getRoute(t,i){return this._http.get(this.url+t.join(";"),{params:i}).pipe((0,d.k)(g=>this.extractRoutesData(g)))}extractRoutesData(t){const i=[];return t.routes.forEach(n=>{i.push(this.formatRoute(n,t.waypoints))}),i}getRouteParams(t={}){return t.alternatives=void 0===t.alternatives||t.alternatives,t.steps=void 0===t.steps||t.steps,t.geometries=void 0!==t.geometries?t.geometries:"geojson",t.overview=void 0!==t.overview&&t.overview,t.continue_straight=void 0!==t.continue_straight&&t.continue_straight,new u.i4({fromObject:{alternatives:t.alternatives?"true":"false",overview:t.overview?"simplified":"full",steps:t.steps?"true":"false",geometries:t.geometries?t.geometries:"geojson",continue_straight:t.continue_straight?"true":"false"}})}formatRoute(t,i){const n=[];return t.legs.forEach(g=>{g.steps.forEach(b=>{n.push(b)})}),{id:(0,Gt.uq)(),title:t.legs[0].summary,source:this.url,sourceType:Jl.g1.Route,order:1,format:Jl.Yn.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:i,distance:t.distance,duration:t.duration,geometry:t.geometry,legs:t.legs,steps:n,weight:t.weight,weight_name:t.weight_name}}static \u0275fac=function(i){return new(i||l)(e.CoB(u.KK),e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function qp(l,f){return new Zp(l,f)}function tm(){return{kind:Xl.OSRM,providers:[{provide:Ql.U,useFactory:qp,multi:!0,deps:[u.KK,A.aW]}]}}var om=r(41912);r(29632),r(48004),r(84052),r(96659),r(31112),r(97104),r(39532),r(36404);var zs=function(l){return l[l.None=0]="None",l[l.Move=1]="Move",l[l.Zoom=2]="Zoom",l[l.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",l}(zs||{});let nm=(()=>{class l{features$=new ue.g([[],void 0]);constructor(){}setFeatures(t,i=zs.None){this.features$.next([t,i])}clear(){this.features$.next([[],zs.None])}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),rm=(()=>{class l{component;overlayService;features$$;format=new po.c;get map(){return this.component.map}constructor(t,i){this.component=t,this.overlayService=i}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,i){}static \u0275fac=function(i){return new(i||l)(e.GI1(Ds.q,2),e.GI1(nm))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOverlay",""]],standalone:!0})}return l})();function sm(l,f){const t=[f?.analytics&&{provide:"searchAnalytics",useValue:f.analytics},{provide:Us._,useClass:Us._},Sl()].filter(Boolean);for(const i of l)t.push(...i.providers);return t}r(25607),r(87048),r(29220);class Qi extends fo.i{http;languageService;static id="cadastre";static type=Wt.Y;constructor(f,t,i,n){super(n,i),this.http=f,this.languageService=t}getId(){return Qi.id}getType(){return Qi.type}getDefaultOptions(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(f,t){f=(f=(f=(f=f.replace(/ /g,"")).replace(/,+/g,",")).endsWith(",")?f.slice(0,-1):f).startsWith(",")?f.substr(1):f;const i=this.computeSearchRequestParams(f,t||{});return i.get("numero")&&i.get("numero").match(/^[0-9,]+$/g)?this.getCadastre(f,i):(0,Ve.of)([])}getCadastre(f,t){return this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,d.k)(i=>this.extractResults(i,f)))}computeSearchRequestParams(f,t){return new u.i4({fromObject:Object.assign({numero:f,epsg:"4326"},this.params,t.params||{})})}extractResults(f,t){return f.split("<br />").filter(i=>i.length>0).map(i=>this.dataToResult(i,t))}dataToResult(f,t){const i=f.split(";"),n=i[0],b=this.computeGeometry(i[7]),B={NoLot:n,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},pe=[this.getId(),"cadastre",n].join(".");return{source:this,meta:{dataType:Wt.Y,id:pe,title:n,score:(0,Mi.Un)(t.trim(),n),icon:"location_on"},data:{type:Wt.Y,projection:"EPSG:4326",geometry:b,properties:B,meta:{id:pe,title:n}}}}computeGeometry(f){const t=(new Oo.c).readFeature(f,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}}static \u0275fac=function(t){return new(t||Qi)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:Qi,factory:Qi.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[String,u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Qi.prototype,"getCadastre",null);class Zi extends fo.i{http;static id="nominatim";static type=Wt.Y;constructor(f,t,i){super(t,i),this.http=f}getId(){return Zi.id}getType(){return Zi.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(f,t){const i=this.computeSearchRequestParams(f,t||{});return i.get("q")?this.getSearch(f,i):(0,Ve.of)([])}getSearch(f,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,d.k)(i=>this.extractResults(i,f)))}computeSearchRequestParams(f,t){return new u.i4({fromObject:Object.assign({q:this.computeTerm(f),format:"json"},this.params,t.params||{})})}extractResults(f,t){return f.map(i=>this.dataToResult(i,t))}dataToResult(f,t){const i=this.computeProperties(f),n=this.computeGeometry(f),g=this.computeExtent(f),b=[this.getId(),"place",f.place_id].join(".");return{source:this,meta:{dataType:Wt.Y,id:b,title:f.display_name,icon:"location_on",score:(0,Mi.Un)(t.trim(),f.display_name)},data:{type:Wt.Y,projection:"EPSG:4326",geometry:n,extent:g,properties:i,meta:{id:b,title:f.display_name}}}}computeProperties(f){return{display_name:f.display_name,place_id:f.place_id,osm_type:f.osm_type,class:f.class,type:f.type}}computeGeometry(f){return{type:"Point",coordinates:[parseFloat(f.lon),parseFloat(f.lat)]}}computeExtent(f){return[parseFloat(f.boundingbox[2]),parseFloat(f.boundingbox[0]),parseFloat(f.boundingbox[3]),parseFloat(f.boundingbox[1])]}computeTerm(f){return this.computeTermTags(f)}computeTermTags(f){const t=super.getHashtagsValid(f,"amenity");return t?t.length?(f=f.replace(/(#[^\s]*)/g,""),t.forEach(i=>{f+="+["+i+"]"}),f):null:this.computeTermSettings(f)}computeTermSettings(f){return this.options.settings.forEach(t=>{"amenity"===t.name&&t.values.forEach(i=>{i.enabled&&"string"==typeof i.value&&i.value.split(",").forEach(g=>{f+="+["+g+"]"})})}),f}static \u0275fac=function(t){return new(t||Zi)(e.CoB(u.KK),e.CoB("options"),e.CoB(io.yQ))};static \u0275prov=e.wxM({token:Zi,factory:Zi.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[String,u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Zi.prototype,"getSearch",null);var Zl=r(11544);class Fi extends fo.i{http;languageService;static id="storedqueries";static type=Wt.Y;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(f,t,i,n){if(super(n,i),this.http=f,this.languageService=t,this.storedQueriesOptions=n,!this.storedQueriesOptions||this.storedQueriesOptions.available){if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},this.resultTitle="title",console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let Ee="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw Ee+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(Ee)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((Ee,Ae)=>{if(this.multipleFieldsQuery&&!Ee.splitPrefix&&0!==Ae)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!Ee.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return Fi.id}getType(){return Fi.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(f,t){const i=this.termSplitter(f,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},i);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=t.page?String(t.page):"1",this.getSearch(f,n)}getSearch(f,t){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,d.k)(i=>{let n=this.extractResults(this.extractWFSData(i),f);if(n.sort((g,b)=>g.meta.score>b.meta.score||g.meta.score===b.meta.score&&g.meta.titleHtml<b.meta.titleHtml?1:-1),n.reverse(),n.length>Number(this.options.params.limit)){const g=Number(this.options.params.limit)*Number(this.options.params.page),b=n.length;n=n.slice(0,g),n[n.length-1].meta.nextPage=g<b}return n})):this.http.get(this.searchUrl,{params:t}).pipe((0,d.k)(i=>this.extractResults(this.extractWFSData(i),f)))}getFormatFromOptions(){let f;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(f=po.c),i.test(t)&&(f=Zl.c),new f}extractWFSData(f){const t=this.getFormatFromOptions(),i=po.c,n=t.readFeatures(f);return JSON.parse((new i).writeFeatures(n))}termSplitter(f,t){const i={};let n=f,g=0;return t.forEach(B=>{i[B.name]=B.defaultValue;const pe=new RegExp(B.splitPrefix+"(.+)","i");pe.test(n)&&(g=B.splitPrefix?g+=1:g,n=n.split(pe)[1])}),0===g?(i[t[0].name]=f,i):(n=f,[...t].reverse().forEach(B=>{const pe=new RegExp(B.splitPrefix||"(.+)","i");if(n||""!==n){const fe=n.split(pe);n=fe[0],fe[1]&&(i[B.name]=fe[1].trim())}}),i)}computeRequestParams(f,t){const i=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new u.i4({fromObject:Object.assign({service:"wfs",version:i,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,f.params||{})})}extractResults(f,t){return f.features.map(i=>this.dataToResult(i,t))}dataToResult(f,t){const i=this.computeProperties(f),n=[this.getId(),i.type,f.id].join("."),g=f.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:f.geometry,properties:i,meta:{id:n,title:f.properties[g]}},meta:{dataType:Wt.Y,id:n,title:f.properties.title,titleHtml:f.properties[g],icon:"location_on",score:(0,Mi.Un)(t.trim(),f.properties.title?f.properties.title:f.properties[g])}}}computeProperties(f){return Object.assign({},Gt.Yv.removeKeys(f.properties,Fi.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(t){return new(t||Fi)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:Fi,factory:Fi.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[String,u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Fi.prototype,"getSearch",null);class Pi extends fo.i{http;languageService;static id="storedqueriesreverse";static type=Wt.Y;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(f,t,i,n){if(super(n,i),this.http=f,this.languageService=t,this.storedQueriesOptions=n,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return Pi.id}getType(){return Pi.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(f,t){const i=this.computeRequestParams(f,t||{});return this.getReverseSearch(i)}getReverseSearch(f){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:f,responseType:"text"}):this.http.get(this.searchUrl,{params:f})).pipe((0,d.k)(n=>this.extractResults(this.extractWFSData(n))))}getFormatFromOptions(){let f;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(f=po.c),i.test(t)&&(f=Zl.c),new f}extractWFSData(f){const t=this.getFormatFromOptions(),i=po.c,n=t.readFeatures(f);return JSON.parse((new i).writeFeatures(n))}computeRequestParams(f,t){const i={};return i[this.storedQueriesOptions.longField]=f[0],i[this.storedQueriesOptions.latField]=f[1],new u.i4({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},i,this.params,t.params||{})})}extractResults(f){return f.features.map(t=>this.dataToResult(t))}dataToResult(f){const t=this.computeProperties(f),i=[this.getId(),t.type,f.id].join("."),n=f.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:f.geometry,properties:t,meta:{id:i,title:f.properties[n]}},meta:{dataType:Wt.Y,id:i,title:f.properties[n],icon:"location_on"}}}computeProperties(f){const t=Gt.Yv.removeKeys(f.properties,Pi.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,{type:f.properties.doc_type},i)}static \u0275fac=function(t){return new(t||Pi)(e.CoB(u.KK),e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:Pi,factory:Pi.\u0275fac})}(0,Lt.UN)([(0,xi.w)({maxCacheCount:20,cacheHasher:Gt.EB}),(0,Lt.YR)("design:type",Function),(0,Lt.YR)("design:paramtypes",[u.i4]),(0,Lt.YR)("design:returntype",Tt._)],Pi.prototype,"getReverseSearch",null);let ql=(()=>{class l extends fo.i{languageService;static id="workspace";static type=Wt.Y;title$=new ue.g("");get title(){return this.title$.getValue()}constructor(t,i,n){super(n,i),this.languageService=t,this.languageService.translate.get(this.options.title).subscribe(g=>this.title$.next(g))}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,i){const g=this.settings.find(Ee=>"limit"===Ee.name).values.find(Ee=>Ee.enabled).value||5;this.options.params.limit=g.toLocaleString();const b=[];this.options.params.page=(i.page||1).toLocaleString();const B=i.page||1,pe=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(Ee=>Ee.searchDocument&&pe.includes(Ee.layer.title)).map(Ee=>{const Ae=t;Ee.searchDocument.search(Ae,{limit:B*g}).map(Je=>{const ke=Je.field;Je.result.map(et=>{const lt=Ee.index.get(et),Ct=(0,Mi.Un)(Ae.trim(),lt.properties[ke]);b.push({index:et,feature:lt,layer:Ee.layer,field:ke,score:Ct})})})}),b.sort((Ee,Ae)=>Ee.score>Ae.score?-1:1);const fe=[],Fe=[];return b.map(Ee=>{fe.includes(Ee.index)||(fe.push(Ee.index),Fe.push(Ee))}),(0,Ve.of)(this.extractResults(Fe.sort((Ee,Ae)=>Ee.score>Ae.score?-1:1).slice(0,B*g)))}extractResults(t){return t.map(i=>this.dataToResult(i,t.length))}dataToResult(t,i){const n=this.computeProperties(t),g=[this.getId(),n.type,t.index].join("."),b=t.feature.properties[t.field],B="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:Wt.Y,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:n,meta:{id:g,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:Wt.Y,id:g,title:t.feature.meta.title,titleHtml:b+B,icon:"location_on",score:t.score,nextPage:i%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){let i;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(i={},t.options.source.options.sourceFields.forEach(n=>{i[n.name]=n.alias?n.alias:n.name})),i}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const i={GoogleMaps:""};let n;if("Point"===t.feature.geometry.type)n=yo.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const b=(0,Il.c)(t.feature.geometry);n=yo.getGoogleMapsCoordLink(b.geometry.coordinates[0],b.geometry.coordinates[1])}i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(i.GoogleStreetView=yo.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const g={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,i,g)}static \u0275fac=function(i){return new(i||l)(e.CoB(C.ov),e.CoB(io.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function hm(l,f,t){return new ql(l,f,t.getConfig(`searchSources.${ql.id}`))}function ym(){return{kind:Ys.Workspace,providers:[{provide:fo.i,useFactory:hm,multi:!0,deps:[C.ov,io.yQ,A.aW]}]}}r(88824);var ec=r(47572),_m=r(52756);function $r({feature:l,markerColor:f=[0,161,222],markerOpacity:t=1,markerOutlineColor:i=[0,255,255],fillColor:n,fillOpacity:g=.15,strokeColor:b=[0,255,255],strokeOpacity:B=.5,strokeWidth:pe=4}){return tc({feature:l,markerColor:f,markerOpacity:t,markerOutlineColor:i,fillColor:n,fillOpacity:g,strokeColor:b,strokeOpacity:B,strokeWidth:pe})}function tc({feature:l,markerColor:f=[0,161,222],markerOpacity:t=.5,markerOutlineColor:i,fillColor:n=[0,161,222],fillOpacity:g=.15,strokeColor:b=[0,161,222],strokeOpacity:B=.5,strokeWidth:pe=2}){const fe=l instanceof Po.c;let Fe,Ee;fe?Fe=l.getGeometry():(Fe=l.geometry,Ee=l.meta.mapTitle);const Ae=fe?Fe.getType():Fe.type;if(Fe&&"Point"!==Ae){const Je=(0,qn.f4)(n).slice(0),ke=(0,qn.f4)(b).slice(0);return 4===Je.length&&("string"!=typeof n||/^#[0-9A-F]{8}$/i.test(n))||(Je[3]=g),4===ke.length&&("string"!=typeof b||/^#[0-9A-F]{8}$/i.test(b))||(ke[3]=B),(0,_m.B)({text:Ee,strokeWidth:pe,strokeColor:ke,fillColor:Je})}{const Je=(0,qn.f4)(f).slice(0),ke=Je.slice(0,3);return 4===Je.length&&("string"!=typeof f||/^#[0-9A-F]{8}$/i.test(f))&&(t=Je[3]),(0,ec.o)({text:Ee,opacity:t,markerOutlineColor:i,markerColor:ke})}}let Cm=(()=>{class l{config;options;constructor(t){this.config=t,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(t){if(this.options)return this.options[t]}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Xs=(()=>{class l{regexService;geoServiceRegexes=[];constructor(t){this.regexService=t,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(t){return typeof t}isUrl(t){return/^https?:\/\//.test(t.toString())}isGeoService(t){let i=!1;if(this.isUrl){for(const n of this.geoServiceRegexes)if(new RegExp(n.url).test(t)){i=!0;break}return i}}getGeoService(t,i){if(!this.isGeoService(t))return;let n;for(const g of this.geoServiceRegexes)if(new RegExp(g.url).test(t)&&(n=i.filter(pe=>g.propertiesForLayerName.includes(pe))?g:void 0,n))break;return n}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(i){return new(i||l)(e.CoB(Cm))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Ar=r(62154);class Js extends Ar.ec{options;inResolutionRange$=new ue.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(f){super(f),this.options=f,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}var kr=r(17284),$t=r(76572);function vm(l){return l.entityStore.getStrategyOfType(V.qq).active$.pipe((0,d.k)(f=>f?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function Sm(l){return l.entityStore.stateView.manyBy$(f=>!0===f.state.selected).pipe((0,d.k)(f=>f.length>=1))}function oc(l,f,t,i,n,g){const b=Gt.Yv.removeUndefined({sourceOptions:{type:i,url:t,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:"wms"===i?n:void 0,LAYER:"wms"===i?void 0:n}}});if("add"===l)g.createAsyncLayer(b).subscribe(B=>{f.layersAddedByClick$.next([B]),f.addLayer(B)});else if("remove"===l){const B=(0,Ji.KC)(b.sourceOptions);f.removeLayer(f.layers.find(pe=>pe.id===B))}}function Qs(l,f,t,i){const n=function bm(l,f){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:V.G8.ButtonGroup,valueAccessor:(i,n)=>{let g=n.state.geoService;return g&&g.haveGeoServiceProperties&&g.url&&g.layerName?g.added?[{icon:"delete",color:"warn",click:(b,B)=>{oc("remove",l.map,B.state.geoService.url,B.state.geoService.type,B.state.geoService.layerName,f),g.added=!1}}]:[{icon:"add",color:"primary",click:(b,B)=>{oc("add",l.map,B.state.geoService.url,B.state.geoService.type,B.state.geoService.layerName,f),g.added=!0}}]:[]}}]}(l,t),g=f.dataSource.options.sourceFields||[],b=f.dataSource.options.relations||[];if(0===g.length)return void l.entityStore.entities$.pipe((0,Wi.O)(fe=>0===fe.length),(0,Gr.U)(1)).subscribe(fe=>{const Fe=fe[0].ol,Ee=Fe.getKeys().filter(Ae=>!Ae.startsWith("_")&&"geometry"!==Ae&&Ae!==Fe.getGeometryName()&&!Ae.match(/boundedby/gi)).map(Ae=>({name:`properties.${Ae}`,title:Ae,renderer:V.G8.UnsanitizedHTML}));Ee.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:Ee,tableHeight:"100%"}});const B=g.map(fe=>({name:`properties.${fe.name}`,title:fe.alias?fe.alias:fe.name,renderer:V.G8.UnsanitizedHTML,tooltip:fe.tooltip,cellClassFunc:()=>{const Fe={};if(fe.type)return Fe[`class_${fe.type}`]=!0,Fe}})),pe=b.map(fe=>({name:`properties.${fe.name}`,title:fe.alias?fe.alias:fe.name,renderer:V.G8.Icon,icon:fe.icon,parent:fe.parent,type:"relation",tooltip:fe.tooltip,onClick:()=>{i.next(fe.title)},cellClassFunc:()=>({class_icon:!0})}));B.push(...pe),B.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:B,tableHeight:"100%"}}function Br(){return new V.qq({filterClauseFunc:f=>!0===f.state.inMapExtent&&!0===f.state.inMapResolution})}let Om=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ue.g(void 0);constructor(t,i,n,g,b){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=g,this.capabilitiesService=b}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new Js({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new kr.MF([]),meta:{tableTemplate:void 0}});return Qs(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new $t.ym([],{map:i});n.bindLayer(t);const g=new $t._c({}),b=new $t.IV({}),B=new $t.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),pe=new $t.CE({}),fe=new V.xx({}),Fe=this.configService.getConfig("queryOverlayStyle"),Ee=new $t.kj({layer:new k.Md({zIndex:300,source:new nt.EB,style:Ae=>$r(Object.assign({},{feature:Ae},Fe?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?$t.Su.Default:$t.Su.None,many:!0,dragBox:!0});return n.addStrategy(g,!0),n.addStrategy(b,!0),n.addStrategy(B,!0),n.addStrategy(pe,!0),n.addStrategy(Ee,!0),n.addStrategy(fe,!1),n.addStrategy(Br(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(io.yQ),e.CoB(A.aW),e.CoB(k.IZ),e.CoB(Xs),e.CoB(ct.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class ic extends Ar.ec{options;inResolutionRange$=new ue.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(f){super(f),this.options=f,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let Im=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ue.g(void 0);constructor(t,i,n,g,b){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=g,this.capabilitiesService=b}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new ic({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new kr.MF([]),meta:{tableTemplate:void 0}});return Qs(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new $t.ym([],{map:i});n.bindLayer(t);const g=new $t._c({}),b=new $t.oJ({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),B=new $t.IV({}),pe=new $t.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),fe=new $t.CE({}),Fe=new V.xx({}),Ee=this.configService.getConfig("queryOverlayStyle"),Ae=new $t.kj({layer:new k.Md({zIndex:300,source:new nt.EB,style:Je=>$r(Object.assign({},{feature:Je},Ee?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?$t.Su.Default:$t.Su.None,many:!0,dragBox:!0});return t.options.workspace?.searchIndexEnabled&&n.addStrategy(b,!0),n.addStrategy(g,!0),n.addStrategy(B,!0),n.addStrategy(pe,!0),n.addStrategy(fe,!0),n.addStrategy(Ae,!0),n.addStrategy(Fe,!1),n.addStrategy(Br(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(io.yQ),e.CoB(A.aW),e.CoB(k.IZ),e.CoB(Xs),e.CoB(ct.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var wm=r(14512),Tm=r(99376);let Em=(()=>{class l{dialogRef;languageService;data;constructor(t,i,n){this.dialogRef=t,this.languageService=i,this.data=n}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(C.ov),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-confirmation-popup-component"]],standalone:!0,features:[e.UHJ],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2)(4,"button",3),e.qCj("click",function(){return n.confirmedAction()}),e.OEk(5," Ok "),e.C$Y(),e.I0R(6,"button",4),e.qCj("click",function(){return n.cancelAction()}),e.OEk(7),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.languageService.translate.instant("add"===n.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")," "),e.yG2(5),e.oRS(" ",n.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[bt.iU,bt.Yp,R.oJ,R.Gw],styles:["div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]})}return l})();class nc extends Ar.ec{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new ue.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new ji.c;olDrawingLayer;geometryType=gt;modify;modifyStyle=new ee.cp({stroke:new Te.c({color:"rgba(255,255,255,1)",width:1}),fill:new je.c({color:"rgba(0,161,222,1)"}),image:new Ce.c({radius:7,stroke:new Te.c({color:"rgba(255,255,255,1)",width:1}),fill:new je.c({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=f=>!0===f.state.newFeature;editFeaturefilterClauseFunc=f=>!0===f.state.edit;fillColor;strokeColor;strokeWidth;constructor(f,t,i,n,g){super(g),this.dialog=f,this.configService=t,this.adding$=i,this.getDomainValues=n,this.options=g,this.map.viewController.resolution$.subscribe(b=>{this.inResolutionRange$.next(b>this.layer.minResolution&&b<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new k.Md({id:"igo-draw-layer",title:"edition",zIndex:300,source:new nt.EB,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(f,t){setTimeout(()=>{this.dialog.open(Em,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(n=>{if(!1===n){let g,b;const B=t.layer.dataSource.options.edition.baseUrl,pe=t.layer.dataSource.options.edition.deleteUrl;b=B.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+B+"?"+pe:B+"?"+pe:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+pe:pe;for(const fe of t.meta.tableTemplate.columns)for(const Fe in f.properties){let Ee=fe.name;Ee.includes("properties.")&&(Ee=Ee.split(".")[1]),Ee===Fe&&!0===fe.primary&&(g=f.properties[Fe])}b&&(b+=g,this.deleteFeature(t,b))}})},250)}editFeature(f,t){f.edition=!0;let i,n=!1;const g=t.layer.dataSource.options.edition;for(const b of t.meta.tableTemplate.columns)if(("list"===b.type||"autocomplete"===b.type)&&this.getDomainValues(b.relation).subscribe(B=>{b.domainValues=B}),!1===n)for(const B in f.properties){let pe=b.name;if(pe.includes("properties.")&&(pe=pe.split(".")[1]),pe===B&&!0===b.primary){i=f.properties[B],n=!0;break}}i?(f.original_properties=JSON.parse(JSON.stringify(f.properties)),f.original_geometry=f.geometry,f.idkey=i,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(f,t)):!f.newFeature&&g.geomType&&(f.newFeature=!0,this.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),g.addWithDraw?this.onGeometryTypeChange(g.geomType,f,t):(t.entityStore.insert(f),t.entityStore.state.update(f,{newFeature:!0},!0)))}createDrawControl(f,t,i){return new om.i4({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new ee.cp({}),interactionStyle:Vi(f,t,i)})}onGeometryTypeChange(f,t,i){this.drawControl.setGeometryType(f),this.toggleDrawControl(t,i)}toggleDrawControl(f,t){this.deactivateDrawControl(),this.activateDrawControl(f,t)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(f,t){this.drawEnd$$=this.drawControl.end$.subscribe(i=>{this.addFeatureToStore(f,t,i)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(f,t,i){const n=this.map.ol.getView().getProjection();let g=f.geometry;i?(t.entityStore.insert(f),t.entityStore.state.update(f,{newFeature:!0},!0),g=(new po.c).writeGeometryObject(i,{featureProjection:n,dataProjection:"EPSG:4326"}),f.geometry=g):t.entityStore.state.update(f,{edit:!0},!0),f.projection="EPSG:4326";const b=(0,$t.K6)(f,n.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(b),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(b,f,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(f,t,i){this.map.ol.removeInteraction(this.modify);const n=new wm.c([f],{unique:!0});this.modify=new Tm.c({features:n}),this.map.ol.addInteraction(this.modify),n.forEach(g=>{g.setStyle(this.modifyStyle)}),this.modify.on("modifyend",g=>{const b=g.features.getArray()[0]?.getGeometry();b&&this.addFeatureToStore(t,i,b)})}}let xm=(()=>{class l{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new ue.g(void 0);adding$=new ue.g(!1);relationLayers$=new ue.g(void 0);rowsInMapExtentCheckCondition$=new ue.g(!0);loading=!1;wktFormat=new Oo.c;geoJsonFormat=new po.c;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,i,n,g,b,B,pe,fe){this.layerService=t,this.storageService=i,this.configService=n,this.messageService=g,this.http=b,this.dialog=B,this.styleService=pe,this.authInterceptor=fe}createWorkspace(t,i){if(!0!==t.options.workspace?.enabled||!0!==t.dataSource.options.edition.enabled)return;let n;n=t.options.workspace?t.options.workspace:{},n.srcId=t.id,n.workspaceId=t.id,n.enabled=!0,n.pageSize=t.options.workspace?.pageSize,n.pageSizeOptions=t.options.workspace?.pageSizeOptions;const g=t.dataSource,b=t.id+".WmsWorkspaceTableSrc",B=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:b,links:[]});const pe={syncedDelete:!0,linkedIds:[B],properties:[k.aG.ZINDEX,k.aG.VISIBLE]};t.options.workspace?.minResolution||pe.properties.push(k.aG.MINRESOLUTION);let fe=!1;g.options.ogcFilters?.enabled&&(pe.properties.push(k.aG.OGCFILTERS),fe=!0),t.options.workspace?.maxResolution||pe.properties.push(k.aG.MAXRESOLUTION);let Ee,Fe=[];return t.options.linkedLayers.links&&(Fe=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),Fe.push(pe),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:b,t.options.linkedLayers.links=Fe,this.layerService.createAsyncLayer({id:B,linkedLayers:{linkId:B},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:g.options.download,type:"wfs",url:g.options.urlWfs||g.options.url,queryable:!0,relations:g.options.relations,queryTitle:g.options.queryTitle,params:g.options.paramsWFS,ogcFilters:Object.assign({},g.ogcFilters,{enabled:fe}),sourceFields:g.options.sourceFields||void 0,edition:g.options.edition}}).subscribe(Ae=>(i.addLayer(Ae),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:Fe}},!1),Ae.dataSource.ol.refresh(),Ee=new nc(this.dialog,this.configService,this.adding$,Je=>this.getDomainValues(Je),{id:t.id,title:t.title,layer:Ae,map:i,entityStore:this.createFeatureStore(Ae,i),actionStore:new kr.MF([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(Ee,Ae),Ae.options.workspace.workspaceId=Ae.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:n}),delete g.options.download,Ee)),Ee}createFeatureStore(t,i){const n=new $t.ym([],{map:i});n.bindLayer(t);const g=new $t._c({}),b=new $t.IV({}),B=new $t.CE({}),pe=new V.xx({}),fe=new $t.kj({layer:new k.Md({zIndex:300,source:new Ii.E,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?$t.Su.Default:$t.Su.None,many:!0,dragBox:!0});return n.addStrategy(g,!0),n.addStrategy(b,!0),n.addStrategy(B,!0),n.addStrategy(fe,!0),n.addStrategy(pe,!1),n.addStrategy(Br(),!0),n}createTableTemplate(t,i){const n=i.dataSource.options.sourceFields||[],g=i.dataSource.options.relations||[];let b=V.G8.UnsanitizedHTML,B=[],pe=[],fe=[];B=[{name:"edition",title:void 0,renderer:V.G8.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"edit",color:"primary",disabled:!1===i.dataSource.options.edition.modifyButton,click:Fe=>{t.editFeature(Fe,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===i.dataSource.options.edition.deleteButton,click:Fe=>{t.deleteFeature(Fe,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:Fe=>{this.saveFeature(Fe,t)}},{editMode:!0,icon:"close",color:"primary",disabled:this.loading,click:Fe=>{this.cancelEdit(t,Fe)}}]}],0!==n.length?(pe=n.map(Fe=>{let Ee={name:`properties.${Fe.name}`,title:Fe.alias?Fe.alias:Fe.name,renderer:b,valueAccessor:void 0,cellClassFunc:()=>{const Ae={};if(Fe.type)return Ae[`class_${Fe.type}`]=!0,Ae},primary:!0===Fe.primary,visible:Fe.visible,validation:Fe.validation,linkColumnForce:Fe.linkColumnForce,type:Fe.type,domainValues:void 0,relation:void 0,multiple:Fe.multiple,step:Fe.step,tooltip:Fe.tooltip};return("list"===Fe.type||"autocomplete"===Fe.type)&&this.getDomainValues(Fe.relation).subscribe(Ae=>{Ee.domainValues=Ae,Ee.relation=Fe.relation}),Ee}),fe=g.map(Fe=>({name:`properties.${Fe.name}`,title:Fe.alias?Fe.alias:Fe.name,renderer:V.G8.Icon,icon:Fe.icon,parent:Fe.parent,type:"relation",tooltip:Fe.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(Fe.title)},cellClassFunc:()=>({class_icon:!0})})),pe.push(...fe),pe.push(...B),t.meta.tableTemplate={selection:!1,sort:!0,columns:pe}):t.entityStore.entities$.pipe((0,Wi.O)(Fe=>0===Fe.length),(0,Gr.U)(1)).subscribe(Fe=>{const Ee=Fe[0].ol,Ae=Ee.getKeys().filter(Je=>!Je.startsWith("_")&&"geometry"!==Je&&Je!==Ee.getGeometryName()&&!Je.match(/boundedby/gi)).map(Je=>({name:`properties.${Je}`,title:Je,renderer:b}));t.meta.tableTemplate={selection:!1,sort:!0,columns:Ae}})}saveFeature(t,i){if(!this.validateFeature(t,i))return!1;this.sanitizeParameter(t,i);const n=i.layer.dataSource.options.edition.baseUrl;let g=this.configService.getConfig("edition.url");if(g?g+=n||"":g=n,t.newFeature){g+=i.layer.dataSource.options.edition.addUrl;const B=new u.UD(i.layer.dataSource.options.edition.addHeaders);this.addFeature(t,i,g,B)}else{g+="post"!==i.layer.dataSource.options.edition.modifyProtocol?"?"+i.layer.dataSource.options.edition.modifyUrl+t.idkey:i.layer.dataSource.options.edition.modifyUrl;const b=i.layer.dataSource.options.edition.modifyProtocol,pe=new u.UD(i.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,i,g,pe,b)}}addFeature(t,i,n,g){if(i.layer.dataSource.options.edition.hasGeometry){const b=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+b.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",b),{dataProjection:b})}for(const b in t.properties)for(const B of i.layer.dataSource.options.sourceFields)(B.name===b&&B.validation?.readonly||B.name===b&&!1===B.validation?.send)&&delete t.properties[b];this.loading=!0,this.http.post(`${n}`,t.properties,{headers:g}).subscribe(()=>{this.loading=!1,i.entityStore.stateView.clear(),i.deleteDrawings(),i.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(i.layer,i.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},b=>{this.loading=!1,b.error.caught=!0;const B=i.layer.dataSource.options.edition.messages;if(B){let pe;B.forEach(fe=>{const Fe=Object.keys(fe)[0];b.error.message.includes(Fe)&&(pe=fe[Fe],this.messageService.error(pe))}),pe||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,i){this.loading=!0,this.http.delete(`${i}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const n of t.layer.options.sourceOptions.relations)t.map.layers.forEach(g=>{g.title===n.title&&g.dataSource.ol.refresh()})},n=>{this.loading=!1,n.error.caught=!0;const g=t.layer.dataSource.options.edition.messages;if(g){let b;g.forEach(B=>{const pe=Object.keys(B)[0];n.error.message.includes(pe)&&(b=B[pe],this.messageService.error(b))}),b||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,i,n,g,b="patch"){if(i.layer.dataSource.options.edition.hasGeometry){const B=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=rc(t.geometry.coordinates),t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+B.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",B),{dataProjection:B})}for(const B in t.properties)for(const pe of i.layer.dataSource.options.sourceFields)(pe.name===B&&pe.validation?.readonly||pe.name===B&&!1===pe.validation?.send||"boundedBy"===B)&&delete t.properties[B];this.loading=!0,this.http[b](`${n}`,t.properties,{headers:g}).subscribe(()=>{this.loading=!1,this.cancelEdit(i,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(i.layer,i.layer.map);let B=[];for(const pe of i.layer.options.sourceOptions.relations)i.map.layers.forEach(fe=>{fe.title===pe.title&&(B.push(fe),fe.dataSource.ol.refresh())});this.relationLayers$.next(B)},B=>{this.loading=!1,B.error.caught=!0;const pe=i.layer.dataSource.options.edition.messages;if(pe){let fe;pe.forEach(Fe=>{const Ee=Object.keys(Fe)[0];B.error.message.includes(Ee)&&(fe=Fe[Ee],this.messageService.error(fe))}),fe||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,i,n=!1){i.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),i.newFeature?(t.entityStore.delete(i),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(n||(i.properties=i.original_properties,i.geometry=i.original_geometry),delete i.original_properties,delete i.original_geometry)}getDomainValues(t){let i=t.url;return i||(i=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(i).pipe((0,d.k)(n=>n),(0,Ge.a)(n=>(n.error.caught=!0,(0,Xe.c)(n))))}refreshMap(t,i){const n=t.dataSource.ol;n.setLoader((b,B,pe,fe,Fe)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,b,B,pe,fe,Fe,!0)}),n.refresh();for(const b of i.layers)if(b.id!==t.id&&b.options.linkedLayers?.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1))&&b.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){const B=b.dataSource.ol;let pe=B.getParams();pe._t=(new Date).getTime(),B.updateParams(pe)}}validateFeature(t,i){let g,b=!0;return i.meta.tableTemplate.columns.forEach(B=>{B.hasOwnProperty("validation")&&B.validation&&(g=Ur(B.name),Object.keys(B.validation).forEach(pe=>{switch(pe){case"mandatory":B.validation[pe]&&(!t.properties.hasOwnProperty(g)||!t.properties[g])&&(b=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:B.title}));break;case"minValue":t.properties.hasOwnProperty(g)&&t.properties[g]&&t.properties[g]<B.validation[pe]&&(b=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:B.title,value:B.validation[pe]}));break;case"maxValue":t.properties.hasOwnProperty(g)&&t.properties[g]&&t.properties[g]>B.validation[pe]&&(b=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:B.title,value:B.validation[pe]}));break;case"minLength":t.properties.hasOwnProperty(g)&&t.properties[g]&&t.properties[g].length<B.validation[pe]&&(b=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:B.title,value:B.validation[pe]}));break;case"maxLength":t.properties.hasOwnProperty(g)&&t.properties[g]&&t.properties[g].length>B.validation[pe]&&(b=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:B.title,value:B.validation[pe]}))}}))}),b}sanitizeParameter(t,i){i.meta.tableTemplate.columns.forEach(n=>{"list"===n.type&&t.properties[Ur(n.name)]&&(t.properties[Ur(n.name)]=t.properties[Ur(n.name)].toString())})}static \u0275fac=function(i){return new(i||l)(e.CoB(k.IZ),e.CoB(io.yQ),e.CoB(A.aW),e.CoB(P.mi),e.CoB(u.KK),e.CoB(bt.qW),e.CoB(Jn.U),e.CoB(Vs.kT))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Ur(l){return l.includes("properties.")?l.split(".")[1]:l}function rc(l){return 0===l.length?l:"number"==typeof l[0]?l.slice(0,2):l.map(rc)}var Mm=r(33436);let Dm=(()=>{class l{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ue.g(void 0);constructor(t,i,n,g,b,B){this.layerService=t,this.storageService=i,this.capabilitiesService=n,this.styleService=g,this.configService=b,this.propertyTypeDetectorService=B}createWorkspace(t,i){if(!t.options.workspace||i.layers.find(Ae=>Ae.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const n=t.dataSource,g=t.id+".WmsWorkspaceTableSrc",b=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:g,links:[]});const B={syncedDelete:!0,linkedIds:[b],properties:[k.aG.ZINDEX,k.aG.VISIBLE]};t.options.workspace?.minResolution||B.properties.push(k.aG.MINRESOLUTION);let pe=!1;n.options.ogcFilters?.enabled&&(B.properties.push(k.aG.OGCFILTERS),pe=!0),t.options.workspace?.maxResolution||B.properties.push(k.aG.MAXRESOLUTION);let Fe,fe=[];return t.options.linkedLayers.links&&(fe=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),fe.push(B),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:g,t.options.linkedLayers.links=fe,this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:b,linkedLayers:{linkId:b},workspace:{printable:t.options.workspace?.printable,srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:n.options.download,type:"wfs",url:n.options.urlWfs||n.options.url,queryable:!0,relations:n.options.relations,queryTitle:n.options.queryTitle,queryFormatAsWms:!t.options.workspace?.enabled||n.options.queryFormatAsWms,params:n.options.paramsWFS,ogcFilters:Object.assign({},n.ogcFilters,{enabled:pe}),sourceFields:n.options.sourceFields||void 0}}).subscribe(Ae=>{if(i.addLayer(Ae),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:fe}},!1),Ae.dataSource.ol.refresh(),t.options.workspace?.enabled)return Fe=new Js({id:t.id,title:t.title,layer:Ae,map:i,entityStore:this.createFeatureStore(Ae,i),actionStore:new kr.MF([]),meta:{tableTemplate:void 0}}),Qs(Fe,Ae,this.layerService,this.ws$),Ae.options.workspace.workspaceId=Ae.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:Ae.id,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions}),delete n.options.download,Fe}),Fe}createFeatureStore(t,i){const n=new $t.ym([],{map:i});n.bindLayer(t);const g=new $t._c({}),b=new $t.IV({}),B=new $t.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),pe=new $t.CE({}),fe=new V.xx({}),Fe=this.configService.getConfig("queryOverlayStyle"),Ee=new $t.kj({layer:new k.Md({zIndex:300,source:new Ii.E,style:Ae=>$r(Object.assign({},{feature:Ae},Fe?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?$t.Su.Default:$t.Su.None,many:!0,dragBox:!0});return n.addStrategy(g,!0),n.addStrategy(b,!0),n.addStrategy(B,!0),n.addStrategy(pe,!0),n.addStrategy(Ee,!0),n.addStrategy(fe,!1),n.addStrategy(Br(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(k.IZ),e.CoB(io.yQ),e.CoB(ct.S),e.CoB(Jn.U),e.CoB(A.aW),e.CoB(Xs))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Fm=(()=>{class l{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new e._w7;disableSwitch=new e._w7;relationLayers=new e._w7;rowsInMapExtentCheckCondition=new e._w7;get workspaceStore(){return this.component.store}constructor(t,i,n,g,b){this.component=t,this.wfsWorkspaceService=i,this.wmsWorkspaceService=n,this.editionWorkspaceService=g,this.featureWorkspaceService=b}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,vt.o)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const i=t.filter(B=>this.layerIsEditable(B)),n=i.map(B=>B.id),g=i.map(B=>this.getOrCreateWorkspace(B)).filter(B=>void 0!==B),b=this.workspaceStore.all().filter(B=>n.indexOf(B.id)<0);b.length>0&&(b.forEach(B=>{B.entityStore.deactivateStrategyOfType(Mm.I),B.deactivate()}),this.workspaceStore.state.updateMany(b,{active:!1,selected:!1}),this.workspaceStore.deleteMany(b)),g.length>0&&this.workspaceStore.insertMany(g)}getOrCreateWorkspace(t){if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof nt.ak&&!0!==t.dataSource.options.edition?.enabled)return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof nt.CK&&!0!==t.dataSource.options.edition?.enabled){if(!t.dataSource.options.paramsWFS)return;const n=this.wmsWorkspaceService.createWorkspace(t,this.map);return n?.inResolutionRange$.subscribe(g=>{t.dataSource.options.queryable=!g,n.layer.dataSource.options.queryable=g}),n}if(t.dataSource instanceof nt.EB&&!0===t.exportable&&!0!==t.dataSource.options.edition?.enabled)return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof nt.CK&&!0===t.dataSource.options.edition?.enabled)return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){const i=t.dataSource;return i instanceof nt.ak||i instanceof nt.EB||i instanceof nt.CK&&((i.options||{}).ogcFilters?.enabled||void 0!==i.options.paramsWFS?.featureTypes)}static \u0275fac=function(i){return new(i||l)(e.GI1(Ar.uF),e.GI1(Om),e.GI1(Dm),e.GI1(xm),e.GI1(Im))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"},standalone:!0})}return l})()},43168:(Pe,ae,r)=>{"use strict";r.d(ae,{Q1:()=>a,OI:()=>y,_D:()=>R,C3:()=>C,U3:()=>F,UD:()=>Q,Yv:()=>T,eU:()=>P,qM:()=>U,WO:()=>G,EB:()=>p,We:()=>h,sT:()=>J,ym:()=>K,GC:()=>z,sX:()=>o,uq:()=>d});let a=(()=>class X{static PADCHAR="=";static ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static getByte(I,M){return I.charCodeAt(M)}static getByte64(I,M){return this.ALPHA.indexOf(I.charAt(M))}static decode(I){let s,H,M=0,Z=I.length,me=[];if(I=String(I),0===Z)return I;for(I.charAt(Z-1)===this.PADCHAR&&(M=1,I.charAt(Z-2)===this.PADCHAR&&(M=2),Z-=4),s=0;s<Z;s+=4)H=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12|this.getByte64(I,s+2)<<6|this.getByte64(I,s+3),me.push(String.fromCharCode(H>>16,H>>8&255,255&H));switch(M){case 1:H=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12|this.getByte64(I,s+2)<<6,me.push(String.fromCharCode(H>>16,H>>8&255));break;case 2:H=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12,me.push(String.fromCharCode(H>>16))}return me.join("")}static encode(I){let M,s,H=[],Z=(I=String(I)).length-I.length%3;if(0===I.length)return I;for(M=0;M<Z;M+=3)s=this.getByte(I,M)<<16|this.getByte(I,M+1)<<8|this.getByte(I,M+2),H.push(this.ALPHA.charAt(s>>18)),H.push(this.ALPHA.charAt(s>>12&63)),H.push(this.ALPHA.charAt(s>>6&63)),H.push(this.ALPHA.charAt(63&s));switch(I.length-Z){case 1:s=this.getByte(I,M)<<16,H.push(this.ALPHA.charAt(s>>18)+this.ALPHA.charAt(s>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:s=this.getByte(I,M)<<16|this.getByte(I,M+1)<<8,H.push(this.ALPHA.charAt(s>>18)+this.ALPHA.charAt(s>>12&63)+this.ALPHA.charAt(s>>6&63)+this.PADCHAR)}return H.join("")}})();var w=r(33712);function p(X){return X.map(D=>D instanceof w.i4?D.toString():void 0!==D?JSON.parse(JSON.stringify(D)):D)}var e=r(68916);const o=r.n(e)().getParser(window.navigator.userAgent);class R{static copy(D){let I=!1;if("string"==typeof D){const M=R.createTextArea(D);R.selectText(M),I=R.copyTextToClipboard(),R.destroyTextArea(M)}else R.selectText(D),I=R.copyTextToClipboard();return I}static createTextArea(D){const I=document.createElement("textArea");return I.value=D,document.body.appendChild(I),I}static destroyTextArea(D){document.body.removeChild(D)}static selectText(D){if("iOS"===o.getOSName()){const I=D.contentEditable,M=D.readOnly,s=document.createRange(),H=window.getSelection();D.contenteditable=!0,D.readonly=!1,s.selectNodeContents(D),H.removeAllRanges(),H.addRange(s),D.setSelectionRange(0,999999),D.contentEditable=I,D.readOnly=M}else D.select()}static copyTextToClipboard(){return("iOS"!==o.getOSName()||!o.compareVersion("<10"))&&document.execCommand("copy")}}var L=r(21296);function _(X,D,I){return X>>D&(1<<I)-1}class C{base64Index=new Map;indexBase64=new Map;constructor(){this.generateBase64Index()}generateBase64Index(){for(let D=0;D<26;D++)this.base64Index.set(String.fromCharCode(65+D),D),this.indexBase64.set(D,String.fromCharCode(65+D));for(let D=0;D<26;D++)this.base64Index.set(String.fromCharCode(97+D),D+26),this.indexBase64.set(D+26,String.fromCharCode(97+D));for(let D=0;D<10;D++)this.base64Index.set(String.fromCharCode(48+D),D+52),this.indexBase64.set(D+52,String.fromCharCode(48+D));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(D){return D?new L._(M=>{const s=new FileReader;s.readAsDataURL(D),s.onload=()=>{const H=s.result.valueOf(),Z=H.substr(H.indexOf(",")+1),me=this.compressStringBase64(Z);M.next({length:Z.length,type:D.type,object:me})}}):void 0}decompressBlob(D){const s=this.decompressStringBase64(D.object,D.length),H=atob(s),Z=new Array(H.length);for(let de=0;de<H.length;de++)Z[de]=H.charCodeAt(de);const me=new Uint8Array(Z);return new Blob([me],{type:D.type})}compressStringBase64(D){let I="",M=16,s=0,H=0;for(const Z of D){const me=this.base64Index.get(Z);M>6?(M-=6,s+=me<<M):(H=6-M,s+=me>>H,I+=String.fromCharCode(s),s=me<<16-H,M=16-H)}return D.length%8!=0&&(I+=String.fromCharCode(s)),"\u2603"+I}decompressStringBase64(D,I){if(!D)return;if(9731!==D.charCodeAt(0))return D;let M=0,s=0,H=16,Z="",me=1,_e=D.charCodeAt(me);for(let de=0;de<I;de++)H>6?(H-=6,M=_(_e,H,6),Z+=this.indexBase64.get(M)):(s=6-H,M=_(_e,0,H)<<s,_e=D.charCodeAt(++me),M+=_(_e,16-s,s),Z+=this.indexBase64.get(M),H=16-s);return Z}}var S=function(X){return X.ADDED="added",X.DELETED="deleted",X.MODIFIED="modified",X}(S||{});class P{static diff(D,I,M=4){if(!D&&!I)return"";if(!D)return'<span class="inserted">'+I+"</span>";if(!I)return'<span class="deleted">'+D+"</span>";D=D.toString(),I=I.toString();const s=P.getChanges(D,I,"",M),H=I.slice(s.mtc.length+s.ins.length+s.sbs.length),Z=D.slice(s.mtc.length+s.del.length+s.sbs.length);let me="";return s.del.length>0&&(s.del='<span class="deleted">'+s.del+"</span>"),s.ins.length>0&&(s.ins='<span class="inserted">'+s.ins+"</span>"),me=s.mtc+s.del+s.ins+s.sbs,me+=""!==Z||""!==H?P.diff(Z,H,M):"",me}static getMatchingSubstring(D,I,M){let s=0,H=!1;const Z=D.length,me={fis:Z,mtc:M,sbs:""};for(;s<Z;)I[s]===D[s]?H?me.sbs+=D[s]:(H=!0,me.fis=s,me.sbs=D[s]):H&&(s=Z),++s;return me}static getChanges(D,I,M,s){const H=D.length>=D.length;let[Z,me]=H?[D,I]:[I,D],_e=0;for(;me[_e]===Z[_e]&&_e<me.length;)++_e;Z=Z.split("").slice(_e),me=me.slice(_e);const de=Z.length;let le={fis:me.length,fil:de,sbs:"",mtc:M+I.slice(0,_e)},ue={sbs:""};if(""!==me)for(let ne=0;ne<de&&ue.sbs.length<s;ne++)ue=P.getMatchingSubstring(me,P.rotateArray(Z,ne),le.mtc),ue.fil=ne<de-ue.fis?ue.fis+ne:ue.fis-de+ne,ue.sbs.length>le.sbs.length&&(le=ue);return[le.del,le.ins]=H?[Z.slice(0,le.fil).join(""),me.slice(0,le.fis)]:[me.slice(0,le.fis),Z.slice(0,le.fil).join("")],-1===le.del.indexOf(" ")||-1===le.ins.indexOf(" ")||""===le.del||""===le.ins||""===le.sbs?le:P.getChanges(le.del,le.ins,le.mtc,s)}static rotateArray(D,I){const M=D.length,s=new Array(D.length);if(I%M==0)return D.slice();for(let H=0;H<M;H++)s[H]=D[(H+(M+I%M))%M];return s}static isValidNumber(D){return!isNaN(Number(D))}static isOctalNumber(D){return P.isValidNumber(D)&&D.startsWith("0")&&D.length>1}}class y{static findChanges(D,I,M=[]){const s={added:[],deleted:[],modified:[]};if(!D||!I)return s;const H=[...D],Z=[...I];for(const me of H){const _e=Z.findIndex(ve=>ve.id===me.id);if(-1===_e){s.deleted.push({change:{type:S.DELETED},value:me});continue}const de=Z.splice(_e,1)[0],le=JSON.parse(JSON.stringify(me)),ue=JSON.parse(JSON.stringify(de)),ne=y.compareObject(le,ue,void 0,M);ne.length&&s.modified.push({change:{type:S.MODIFIED,keysChanged:ne},value:le,oldValue:me,newValue:de})}return s.added=Z.map(me=>({change:{type:S.ADDED},value:me})),s}static compareObject(D,I,M,s=[]){const H=JSON.parse(JSON.stringify(D)),Z=JSON.parse(JSON.stringify(I)),me=new Set([...Object.keys(D),...Object.keys(I)]);let _e=[];return me.forEach(de=>{const le=M?`${M}.${de}`:de;-1===s.indexOf(le)&&(Array.isArray(D[de])&&(D[de]=D[de].join(",<br>")),Array.isArray(I[de])&&(I[de]=I[de].join(",<br>")),"object"==typeof D[de]&&"object"==typeof I[de]&&null!==D[de]&&null!==I[de]?_e=_e.concat(this.compareObject(D[de],I[de],le)):D[de]!==I[de]&&(_e.push({key:le,oldValue:H[de],newValue:Z[de]}),D[de]=P.diff(D[de],I[de])))}),_e}}class F{static create(D,I,M){const s=D.createElement(I);for(const H in M)s[H]=M[H];return s}static remove(D){D.parentNode&&D.parentNode.removeChild(D)}}function h(X,D,I){!function W(X,D){const I=document.createElement("a");I.setAttribute("href",X),I.setAttribute("download",D),I.style.display="none",document.body.appendChild(I),I.click(),document.body.removeChild(I)}(`data:${D},${encodeURIComponent(X)}`,I)}function J(X){try{return JSON.parse(X)&&!!X}catch{return!1}}class T{static resolve(D,I){const M=I.replace(/\[/g,".").replace(/\]/g,"").split(".");let s=D;for(;M.length;){if("object"!=typeof s)return;s=s[M.shift()]}return s}static isObject(D){return D&&"object"==typeof D&&!Array.isArray(D)&&null!==D&&!(D instanceof Date)}static mergeDeep(D,I,M=!1){const s=Object.assign({},D);return T.isObject(D)&&T.isObject(I)&&Object.keys(I).filter(H=>!M||void 0!==I[H]).forEach(H=>{T.isObject(I[H])?H in D?s[H]=T.mergeDeep(D[H],I[H],M):Object.assign(s,{[H]:I[H]}):Object.assign(s,{[H]:I[H]})}),s}static copyDeep(D){const I=Array.isArray(D)?[]:{};for(const M in D)if(D.hasOwnProperty(M)){const s=D[M];I[M]=s&&"object"==typeof s?this.copyDeep(s):s}return I}static removeDuplicateCaseInsensitive(D){const I={},M={},s=[];for(const H in D)if(D.hasOwnProperty(H)){const Z=H.toUpperCase();I.hasOwnProperty(Z)?I[Z].push({[H]:D[H]}):I[Z]=[{[H]:D[H]}],s.push({key:H,count:H.replace(/[^A-Z]/g,"").length})}for(const H in I)if(I.hasOwnProperty(H)&&I.hasOwnProperty(H)){const Z=I[H];if(1===Z.length){const me=Z[0];M[H]=me[Object.keys(me)[0]]}else if(Z.length>1){const me=s.filter(_e=>_e.key.toLowerCase()===H.toLowerCase()).reduce((_e,de)=>_e.y<de.y?_e:de);M[me.key.toUpperCase()]=D[me.key]}}for(const H in D)D.hasOwnProperty(H)&&delete D[H];for(const H in M)M.hasOwnProperty(H)&&(D[H]=M[H])}static removeUndefined(D){const I={};return T.isObject(D)?(Object.keys(D).filter(M=>void 0!==D[M]).forEach(M=>{I[M]=T.isObject(D[M])||Array.isArray(D[M])?T.removeUndefined(D[M]):D[M]}),I):Array.isArray(D)?D.map(M=>T.removeUndefined(M)):D}static removeNull(D){const I={};return T.isObject(D)?(Object.keys(D).filter(M=>null!==D[M]).forEach(M=>{I[M]=T.isObject(D[M])||Array.isArray(D[M])?T.removeNull(D[M]):D[M]}),I):Array.isArray(D)?D.map(M=>T.removeNull(M)):D}static naturalCompare(D,I,M="asc",s){if("desc"===M&&(I=[D,D=I][0]),null===D||""===D||void 0===D||null===I||""===I||void 0===I){const me=D===I?0:void 0===D?3:void 0===I?-3:null===D?2:null===I?-2:""===D?1:-1;return"desc"===M?!1!==s?me:-1*me:!0===s?-1*me:me}const H=[],Z=[];for(I=""+I,(D=""+D).replace(/(\d+)|(\D+)/g,(me,_e,de)=>{H.push([_e||1/0,de||""])}),I.replace(/(\d+)|(\D+)/g,(me,_e,de)=>{Z.push([_e||1/0,de||""])});H.length&&Z.length;){const me=H.shift(),_e=Z.shift(),de=me[0]-_e[0]||me[1].localeCompare(_e[1]);if(de)return de}return H.length-Z.length}static objectsAreEquivalent(D,I){if(D===I)return!0;const M=Object.getOwnPropertyNames(D),s=Object.getOwnPropertyNames(I);if(M.length!==s.length)return!1;for(const H of M)if(D[H]!==I[H])return!1;return!0}static removeKeys(D,I){return Object.keys(D).filter(s=>I.indexOf(s)<0).reduce((s,H)=>(s[H]=D[H],s),{})}static isEmpty(D){return 0===Object.keys(D).length}}class Q{static roundToNDecimal(D,I=3){const M=Math.pow(10,I);return Math.round(D*M)/M}}function z(X){return X.reduce((D,I)=>(D[I]=I,D),Object.create(null))}const Y="assets/igo2/core/theming/prebuilt-themes",N="theme-styles";function K(X,D,I=Y){const M=`${I}/${D}.css`,s=X.getElementsByTagName("head")[0];let H=X.getElementById(N);H?H.href=M:function j(X,D,I){const M=F.create(X,"link",{id:N,rel:"stylesheet",href:D});I.appendChild(M)}(X,M,s)}function A(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function d(){return`${A()}${A()}-${A()}-${A()}-${A()}-${A()}${A()}${A()}`.toLowerCase()}var u=r(61616),x=r(11484),U=function(X){return X[X.Error=0]="Error",X[X.Done=1]="Done",X[X.Working=2]="Working",X[X.Waiting=3]="Waiting",X}(U||{});class G{status$=new u.E;status$$;get status(){return this._status}set status(D){this._status=D,this.status$.next(D)}_status;subscribe(D,I){this.watch(),this.status$$=this.status$.pipe((0,x.a)()).subscribe(M=>{this.handleStatusChange(M),D.call(I,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=U.Waiting}handleStatusChange(D){}}},37820:(Pe,ae,r)=>{"use strict";r.r(ae),r.d(ae,{routes:()=>ze});var E=r(34672),a=r(45928),w=r(65056),p=r(34896),e=r(71904),c=r(50244),o=r(42536),R=r(94204),L=r(20460),_=r(72584);function C(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"button",8),p.qCj("click",function(){p.usT(xe);const Qe=p.GaO();return p.CGJ(Qe.loginAnonymous())}),p.OEk(1),p.wVc(2,"translate"),p.C$Y()}2&Be&&(p.yG2(),p.oRS(" ",p.kDX(2,1,"igo.auth.accessAnonymous")," "))}function S(Be,st){if(1&Be&&(p.I0R(0,"div"),p.wR5(1,"br"),p.I0R(2,"font",9),p.OEk(3),p.C$Y()()),2&Be){const xe=p.GaO();p.yG2(3),p.cNF(xe.error)}}function P(Be,st){1&Be&&(p.I0R(0,"div",10),p.wR5(1,"mat-spinner",11),p.C$Y()),2&Be&&(p.yG2(),p.E7m("diameter",40))}let y=(()=>{class Be{auth;languageService;get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(xe){this._allowAnonymous=xe}_allowAnonymous=!0;error="";form;loading=!1;login=new p._w7;constructor(xe,Ke,Qe){this.auth=xe,this.languageService=Ke,this.form=Qe.group({username:["",e.AQ.required],password:["",e.AQ.required]})}loginUser(xe){return this.loading=!0,this.auth.login(xe.username,xe.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},Ke=>{try{this.languageService.translate.get("igo.auth.error."+Ke.error.message).subscribe(Qe=>this.error=Qe)}catch{this.error=Ke.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(L.ov),p.GI1(e.KE))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},standalone:!0,features:[p.UHJ],decls:21,vars:19,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"click"],["size","3","color","red"],[1,"loading-container"],[3,"diameter"]],template:function(Ke,Qe){1&Ke&&(p.I0R(0,"form",0),p.qCj("ngSubmit",function(){return Qe.loginUser(Qe.form.value)}),p.I0R(1,"div")(2,"mat-form-field",1)(3,"mat-label"),p.OEk(4),p.wVc(5,"translate"),p.C$Y(),p.wR5(6,"input",2),p.wVc(7,"translate"),p.C$Y()(),p.I0R(8,"div")(9,"mat-form-field",1)(10,"mat-label"),p.OEk(11),p.wVc(12,"translate"),p.C$Y(),p.wR5(13,"input",3),p.wVc(14,"translate"),p.C$Y()(),p.I0R(15,"button",4),p.OEk(16),p.wVc(17,"translate"),p.C$Y(),p.yuY(18,C,3,3,"button",5)(19,S,4,1,"div",6),p.C$Y(),p.yuY(20,P,2,1,"div",7)),2&Ke&&(p.E7m("formGroup",Qe.form),p.yG2(4),p.cNF(p.kDX(5,9,"igo.auth.user")),p.yG2(2),p._6D("placeholder",p.kDX(7,11,"igo.auth.user")),p.yG2(5),p.cNF(p.kDX(12,13,"igo.auth.password")),p.yG2(2),p._6D("placeholder",p.kDX(14,15,"igo.auth.password")),p.yG2(3),p.oRS(" ",p.kDX(17,17,"igo.auth.login")," "),p.yG2(2),p.E7m("ngIf",Qe.allowAnonymous),p.yG2(),p.E7m("ngIf",Qe.error),p.yG2(),p.E7m("ngIf",Qe.loading))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.sl,e.uW,e.Wo,c.wb,c.Up,c.w5,o.cN,o.yi,E.oJ,E.Gw,R.cm,w.u_,L._s,_.sD],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}.loading-container[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1000;top:0;left:0;padding:24px;box-sizing:border-box}"]})}return Be})();var F=r(45872),h=r(35392),W=r(80716),J=r(38460),T=r(28452),Q=r(85696),z=r(98988),Y=r(61616),N=r(6560),K=r(94364);let j=(()=>{class Be{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new Y.E;login=new p._w7;broadcastService;svgIcon=W.Ue;constructor(xe,Ke,Qe,It,at){this.authService=xe,this.config=Ke,this.appRef=Qe,this.msalService=It,this.msalGuardConfig=at,this.options=this.config.getConfig("auth.microsoft"),this.msalService.instance=new T.u({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new J.K2(this.msalService.instance,this.msalService),this.options?.clientId?this.broadcastService.inProgress$.pipe((0,N.I)(Ft=>Ft===Q.Yz.None),(0,K.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(xe=>{this.msalService.instance.setActiveAccount(xe.account),this.checkAccount()})}checkAccount(){var xe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Ke=>{this.authService.loginWithToken(Ke.accessToken,"microsoft",{tokenId:Ke.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Ke=(0,h.c)(function*(Qe){if(Qe instanceof z.uw)return xe.msalService.acquireTokenPopup(xe.getConf().authRequest);console.log(Qe)});return function(Qe){return Ke.apply(this,arguments)}}()).catch(Ke=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(xe=>"add"===xe.type)[0]}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(F.aW),p.GI1(p.Swk),p.GI1(J.xX),p.GI1(J.mg))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},standalone:!0,features:[p.UHJ],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(Ke,Qe){1&Ke&&(p.I0R(0,"button",0),p.qCj("click",function(){return Qe.loginMicrosoft()}),p.wR5(1,"igo-icon",1),p.OEk(2),p.wVc(3,"translate"),p.C$Y()),2&Ke&&(p.yG2(),p.E7m("icon",Qe.svgIcon),p.yG2(),p.oRS(" ",p.kDX(3,2,"igo.auth.microsoft.login"),"\n"))},dependencies:[E.oJ,E.Gw,L._s,_.sD,W.S],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Be})();var A=r(31752),d=r(54844),u=r(7080);let x=(()=>{class Be{instance;location;redirectHash;logger;name="@azure/msal-angular";version="2.0.0-beta.2";constructor(xe,Ke){this.instance=xe,this.location=Ke;const Qe=this.location.path(!0).split("#").pop();Qe&&(this.redirectHash=`#${Qe}`),this.instance.initializeWrapperLibrary(Q.Lm.Angular,this.version)}initialize(){return(0,u.Q)(this.instance.initialize())}acquireTokenPopup(xe){return(0,u.Q)(this.instance.acquireTokenPopup(xe))}acquireTokenRedirect(xe){return(0,u.Q)(this.instance.acquireTokenRedirect(xe))}acquireTokenSilent(xe){return(0,u.Q)(this.instance.acquireTokenSilent(xe))}handleRedirectObservable(xe){return(0,u.Q)(this.instance.handleRedirectPromise(xe||this.redirectHash))}loginPopup(xe){return(0,u.Q)(this.instance.loginPopup(xe))}loginRedirect(xe){return(0,u.Q)(this.instance.loginRedirect(xe))}logout(xe){return(0,u.Q)(this.instance.logout(xe))}logoutRedirect(xe){return(0,u.Q)(this.instance.logoutRedirect(xe))}logoutPopup(xe){return(0,u.Q)(this.instance.logoutPopup(xe))}ssoSilent(xe){return(0,u.Q)(this.instance.ssoSilent(xe))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(xe){this.logger=xe.clone(this.name,this.version),this.instance.setLogger(xe)}static \u0275fac=function(Ke){return new(Ke||Be)(p.CoB(J.IN),p.CoB(w.oB))};static \u0275prov=p.wxM({token:Be,factory:Be.\u0275fac})}return Be})(),U=(()=>{class Be{msalInstance;authService;_msalSubject;msalSubject$;_inProgress;inProgress$;constructor(xe,Ke){this.msalInstance=xe,this.authService=Ke,this._msalSubject=new Y.E,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new d.g(Q.Yz.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(Qe=>{this._msalSubject.next(Qe);const It=A.M.getInteractionStatusFromEvent(Qe);null!==It&&(this.authService.getLogger().verbose(`BroadcastService - ${Qe.eventType} results in setting inProgress to ${It}`),this._inProgress.next(It))})}static \u0275fac=function(Ke){return new(Ke||Be)(p.CoB(J.IN),p.CoB(x))};static \u0275prov=p.wxM({token:Be,factory:Be.\u0275fac})}return Be})(),G=(()=>{class Be{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new Y.E;login=new p._w7;broadcastService;svgIcon=W.Ue;constructor(xe,Ke,Qe,It,at){this.authService=xe,this.config=Ke,this.appRef=Qe,this.msalService=It,this.msalGuardConfig=at,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new T.u({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new U(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,N.I)(Ft=>Ft===Q.Yz.None),(0,K.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(xe=>{this.msalService.instance.setActiveAccount(xe.account),this.checkAccount()})}checkAccount(){var xe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Ke=>{this.authService.loginWithToken(Ke.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Ke=(0,h.c)(function*(Qe){if(Qe instanceof z.uw)return xe.msalService.acquireTokenPopup(xe.getConf().authRequest)});return function(Qe){return Ke.apply(this,arguments)}}()).catch(Ke=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(xe=>"b2c"===xe.type)[0]}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(F.aW),p.GI1(p.Swk),p.GI1(x),p.GI1(J.mg))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},standalone:!0,features:[p.M5G([x]),p.UHJ],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(Ke,Qe){1&Ke&&(p.I0R(0,"button",0),p.qCj("click",function(){return Qe.loginMicrosoftb2c()}),p.wR5(1,"igo-icon",1),p.OEk(2),p.wVc(3,"translate"),p.C$Y()),2&Ke&&(p.yG2(),p.E7m("icon",Qe.svgIcon),p.yG2(),p.oRS(" ",p.kDX(3,2,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[E.oJ,E.Gw,L._s,_.sD,W.S],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Be})();var Z=r(57880);let me=(()=>{class Be{authService;config;appRef;options;login=new p._w7;constructor(xe,Ke,Qe){this.authService=xe,this.config=Ke,this.appRef=Qe,this.options=this.config.getConfig("auth.facebook"),this.options?.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",xe=>{this.statusChangeCallback(xe)})}statusChangeCallback(xe){"connected"===xe.status&&this.loginFacebook(xe.authResponse.accessToken)}loginFacebook(xe){this.authService.loginWithToken(xe,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const Ke=document.getElementsByTagName("script")[0],Qe=document.createElement("script");Qe.id="facebook-jssdk",Qe.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options?.appId}`,Qe.onload=()=>{this.subscribeEvents()},Ke.parentNode.insertBefore(Qe,Ke)}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(F.aW),p.GI1(p.Swk))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},standalone:!0,features:[p.UHJ],decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(Ke,Qe){1&Ke&&p.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0})}return Be})(),_e=(()=>{class Be{authService;config;languageService;appRef;options;login=new p._w7;constructor(xe,Ke,Qe,It){this.authService=xe,this.config=Ke,this.languageService=Qe,this.appRef=It,this.options=this.config.getConfig("auth.google"),this.options?.apiKey&&this.options?.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options?.apiKey,clientId:this.options?.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(xe=>{this.updateSigninStatus(xe)})})}updateSigninStatus(xe){this.updateTextButton(),xe&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const xe=document.querySelector('span[id^="not_signed_"]');xe&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===xe.innerHTML?xe.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===xe.innerHTML&&(xe.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(xe){this.authService.loginWithToken(xe,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const xe=document.getElementsByTagName("script")[0],Ke=document.createElement("script");Ke.id="google-jssdk",Ke.src="https://apis.google.com/js/api.js",Ke.onload=()=>{this.handleClientLoad()},xe.parentNode.insertBefore(Ke,xe)}loadPlatform(){const xe=document.getElementsByTagName("script")[0],Ke=document.createElement("script");Ke.id="google-platform",Ke.src="https://apis.google.com/js/platform.js",xe.parentNode.insertBefore(Ke,xe)}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(F.aW),p.GI1(L.ov),p.GI1(p.Swk))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-google"]],outputs:{login:"login"},standalone:!0,features:[p.UHJ],decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(Ke,Qe){1&Ke&&p.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0})}return Be})();function de(Be,st){1&Be&&p.wR5(0,"div",3)}function le(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"igo-auth-google",7),p.qCj("login",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.onLogin())}),p.C$Y()}}function ue(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"igo-auth-microsoft",7),p.qCj("login",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.onLogin())}),p.C$Y()}}function ne(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"igo-auth-microsoftb2c",7),p.qCj("login",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.onLogin())}),p.C$Y()}}function ve(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"igo-auth-facebook",7),p.qCj("login",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.onLogin())}),p.C$Y()}}function ye(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"igo-auth-intern",8),p.qCj("login",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.onLogin())}),p.C$Y()}if(2&Be){const xe=p.GaO(3);p.E7m("allowAnonymous",xe.options.allowAnonymous)}}function Le(Be,st){if(1&Be&&(p.I0R(0,"div",4)(1,"h1"),p.OEk(2),p.wVc(3,"translate"),p.C$Y(),p.yuY(4,le,1,0,"igo-auth-google",5)(5,ue,1,0,"igo-auth-microsoft",5)(6,ne,1,0,"igo-auth-microsoftb2c",5)(7,ve,1,0,"igo-auth-facebook",5)(8,ye,1,1,"igo-auth-intern",6),p.C$Y()),2&Be){const xe=p.GaO(2);p.yG2(2),p.cNF(p.kDX(3,6,"igo.auth.connection")),p.yG2(2),p.E7m("ngIf",xe.options.google&&!1!==xe.options.google.enabled),p.yG2(),p.E7m("ngIf",xe.options.microsoft&&!1!==xe.options.microsoft.enabled),p.yG2(),p.E7m("ngIf",xe.options.microsoftb2c&&!1!==xe.options.microsoftb2c.enabled),p.yG2(),p.E7m("ngIf",xe.options.facebook&&!1!==xe.options.facebook.enabled),p.yG2(),p.E7m("ngIf",!xe.options.intern||!1!==xe.options.intern.enabled)}}function He(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"div",4)(1,"p"),p.OEk(2),p.wVc(3,"translate"),p.C$Y(),p.I0R(4,"button",9),p.qCj("click",function(){p.usT(xe);const Qe=p.GaO(2);return p.CGJ(Qe.logout())}),p.OEk(5),p.wVc(6,"translate"),p.C$Y()()}if(2&Be){const xe=p.GaO(2);p.yG2(2),p.cNF(p.g7$(3,2,"igo.auth.welcome",xe.user)),p.yG2(3),p.oRS(" ",p.kDX(6,5,"igo.auth.signOut")," ")}}function Ve(Be,st){if(1&Be){const xe=p.KQA();p.I0R(0,"button",9),p.qCj("click",function(){p.usT(xe);const Qe=p.GaO(3);return p.CGJ(Qe.home())}),p.OEk(1),p.wVc(2,"translate"),p.C$Y()}2&Be&&(p.yG2(),p.oRS(" ",p.kDX(2,1,"igo.auth.home")," "))}function Ge(Be,st){if(1&Be&&(p.I0R(0,"div",4)(1,"p"),p.OEk(2),p.wVc(3,"translate"),p.C$Y(),p.yuY(4,Ve,3,3,"button",10),p.C$Y()),2&Be){const xe=p.GaO(2);p.yG2(2),p.cNF(p.kDX(3,2,"igo.auth.deconnection")),p.yG2(2),p.E7m("ngIf",xe.options.homeRoute)}}function ct(Be,st){if(1&Be&&(p.I0R(0,"div"),p.yuY(1,de,1,0,"div",1)(2,Le,9,8,"div",2)(3,He,7,7,"div",2)(4,Ge,5,4,"div",2),p.C$Y()),2&Be){const xe=p.GaO();p.yG2(),p.E7m("ngIf",!xe.auth.logged&&xe.backgroundDisable),p.yG2(),p.E7m("ngIf",!xe.auth.logged&&xe.showLoginDiv),p.yG2(),p.E7m("ngIf",xe.auth.logged&&xe.showAlreadyConnectedDiv),p.yG2(),p.E7m("ngIf",xe.showLogoutDiv)}}let Ie=(()=>{class Be{auth;config;router;get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(xe){this._backgroundDisable="true"===xe.toString()}_backgroundDisable=!0;get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(xe){this._hasAlreadyConnectedDiv="true"===xe.toString()}_hasAlreadyConnectedDiv=!0;get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(xe){this._hasLogoutDiv="true"===xe.toString()}_hasLogoutDiv=!0;get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(xe){this._showAlreadyConnectedDiv="true"===xe.toString()}_showAlreadyConnectedDiv=!1;get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(xe){this._showLogoutDiv="true"===xe.toString()}_showLogoutDiv=!1;get showLoginDiv(){if(!this.isLogoutRoute)return!0}login=new p._w7;options;user;visible=!0;isLogoutRoute;constructor(xe,Ke,Qe){this.auth=xe,this.config=Ke,this.router=Qe,this.options=this.config.getConfig("auth"),this.visible=0!==Object.getOwnPropertyNames(this.options).length}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options?.logoutRoute?this.router.navigate([this.options?.logoutRoute]):this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute]))})}home(){this.router&&this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute])}getName(){const xe=this.auth.decodeToken();xe&&(this.user={name:xe.user.firstName||xe.user.sourceId})}analyzeRoute(){this.router&&this.router.events.pipe((0,N.I)(xe=>xe instanceof Z.Qx)).subscribe(xe=>{if(xe.url){const Ke=xe.url,Qe=this.options?.logoutRoute;this.isLogoutRoute=Ke===Qe,this.isLogoutRoute&&this.auth.logout()}})}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj),p.GI1(F.aW),p.GI1(Z.E5,8))};static \u0275cmp=p.In1({type:Be,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},standalone:!0,features:[p.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(Ke,Qe){1&Ke&&p.yuY(0,ct,5,4,"div",0),2&Ke&&p.E7m("ngIf",Qe.visible)},dependencies:[w.u_,_e,j,G,me,y,E.oJ,E.Gw,L._s,_.sD],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]})}return Be})();var se=r(32688),ge=r(51100);const Re=()=>["ConfigService","LanguageService"],ze=[{path:"",redirectTo:"form",pathMatch:"full"},{title:"Authentification",path:"form",component:(()=>{class Be{_authService;logged=!1;logged$$;constructor(xe){this._authService=xe}ngOnInit(){this.logged$$=this._authService.logged$.subscribe(xe=>{this.logged=xe})}logout(){this._authService.logout()}ngOnDestroy(){this.logged$$.unsubscribe()}static \u0275fac=function(Ke){return new(Ke||Be)(p.GI1(a.oj))};static \u0275cmp=p.In1({type:Be,selectors:[["app-auth-form"]],standalone:!0,features:[p.UHJ],decls:7,vars:3,consts:[["title","Authentification","subtitle","Auth",3,"dependencies"],["codeFolder","auth/auth-form","configFolder","environments"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(Ke,Qe){1&Ke&&(p.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),p.OEk(2," The dialog opens automatically if you are not logged in "),p.wR5(3,"br"),p.I0R(4,"button",2),p.qCj("click",function(){return Qe.logout()}),p.OEk(5," Log out "),p.C$Y()()(),p.wR5(6,"igo-auth-form")),2&Ke&&(p.E7m("dependencies",p.q4q(2,Re)),p.yG2(4),p.E7m("disabled",!Qe.logged))},dependencies:[se.u,ge.I,Ie,E.oJ,E.Gw],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Be})()}]},92272:(Pe,ae,r)=>{"use strict";r.r(ae),r.d(ae,{routes:()=>Vo});var E=r(17284),a=r(56264),w=r(54844),p=r(32688),e=r(51100),c=r(34896),o=r(23416);let R=(()=>{class we{overlay;mediaService;store=new E.MF([]);added$=new w.g(!1);get actionbarMode(){return this.mediaService.media$.value===a.oZ.Desktop&&this.mediaService.orientation$.value===a.cz.Landscape?E.m0.Dock:E.m0.Overlay}constructor(be,De){this.overlay=be,this.mediaService=De}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"add",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"edit",tooltip:"Edit Tooltip",args:["1"],handler:be=>{alert(`Edit item ${be}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(De){return new(De||we)(c.GI1(o.mc),c.GI1(a.QB))};static \u0275cmp=c.In1({type:we,selectors:[["app-action"]],standalone:!0,features:[c.UHJ],decls:3,vars:5,consts:[["title","Action","subtitle","Common"],["title","Action Bar","codeFolder","common/action"],[3,"store","withIcon","withTitle","horizontal","mode"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.wR5(2,"igo-actionbar",2),c.C$Y()()),2&De&&(c.yG2(2),c.E7m("store",$e.store)("withIcon",!0)("withTitle","overlay"===$e.actionbarMode)("horizontal",!0)("mode",$e.actionbarMode))},dependencies:[p.u,e.I,E.AI],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})();var L=r(71904),_=r(34672),C=r(75180),S=r(37752),P=r(56520),y=r(65056),F=r(40600);function h(we,qe){1&we&&c.C_f(0)}function W(we,qe){1&we&&c.C_f(0)}const J=(we,qe)=>({obj:we,baseKey:qe});function T(we,qe){if(1&we&&(c.SAx(0),c.yuY(1,W,1,0,"ng-container",2),c.k70()),2&we){const be=c.GaO(2).$implicit,De=c.GaO().baseKey,$e=c.GaO(),dt=c.Gew(5);c.yG2(),c.E7m("ngTemplateOutlet",dt)("ngTemplateOutletContext",c.IBC(2,J,be.value,$e.getKey(De,be.key)))}}function Q(we,qe){if(1&we&&(c.I0R(0,"p")(1,"span")(2,"b"),c.OEk(3),c.C$Y(),c.OEk(4," : "),c.C$Y(),c.wR5(5,"span",10),c.C$Y()),2&we){const be=c.GaO(2).$implicit,De=c.GaO().baseKey,$e=c.GaO();c.yG2(3),c.cNF($e.getKey(De,be.key)),c.yG2(2),c.E7m("innerHtml",be.value,c.E3n)}}function z(we,qe){if(1&we&&(c.SAx(0),c.yuY(1,T,2,5,"ng-container",8)(2,Q,6,2,"ng-template",null,9,c.gJz),c.k70()),2&we){const be=c.Gew(3),De=c.GaO().$implicit,$e=c.GaO(2);c.yG2(),c.E7m("ngIf",$e.isObject(De.value))("ngIfElse",be)}}function Y(we,qe){if(1&we&&(c.SAx(0),c.yuY(1,z,4,2,"ng-container",7),c.k70()),2&we){const be=qe.$implicit,De=c.GaO().baseKey,$e=c.GaO();c.yG2(),c.E7m("ngIf",-1===$e.ignoreKeys.indexOf($e.getKey(De,be.key)))}}function N(we,qe){1&we&&(c.yuY(0,Y,2,1,"ng-container",6),c.wVc(1,"keyvalue")),2&we&&c.E7m("ngForOf",c.kDX(1,1,qe.obj))}const K=we=>({obj:we});let j=(()=>{class we{dialogRef;title;data;ignoreKeys;constructor(be){this.dialogRef=be}isObject(be){return"object"==typeof be&&!Array.isArray(be)}getKey(be,De){return(be?be+".":"")+De}static \u0275fac=function(De){return new(De||we)(c.GI1(F.yI))};static \u0275cmp=c.In1({type:we,selectors:[["igo-json-dialog"]],standalone:!0,features:[c.UHJ],decls:9,vars:5,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["loopObject",""],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["notObject",""],[1,"propertyValue",3,"innerHtml"]],template:function(De,$e){if(1&De&&(c.I0R(0,"h1",0),c.OEk(1),c.C$Y(),c.I0R(2,"div",1),c.yuY(3,h,1,0,"ng-container",2)(4,N,2,3,"ng-template",null,3,c.gJz),c.C$Y(),c.I0R(6,"div",4)(7,"button",5),c.qCj("click",function(){return $e.dialogRef.close(!1)}),c.OEk(8," OK "),c.C$Y()()),2&De){const dt=c.Gew(5);c.yG2(),c.cNF($e.title),c.yG2(2),c.E7m("ngTemplateOutlet",dt)("ngTemplateOutletContext",c.S45(3,K,$e.data))}},dependencies:[F.WQ,F.iU,y.XV,y.Iw,y.u_,F.Yp,_.oJ,_.Gw,y.uq],encapsulation:2})}return we})(),A=(()=>{class we{dialog;constructor(be){this.dialog=be}open(be,De,$e){const dt=this.dialog.open(j,{disableClose:!1});return dt.componentInstance.data=De,dt.componentInstance.title=be,dt.componentInstance.ignoreKeys=$e??[],dt.afterClosed()}static \u0275fac=function(De){return new(De||we)(c.CoB(F.qW))};static \u0275prov=c.wxM({token:we,factory:we.\u0275fac})}return we})(),d=(()=>{class we{static forRoot(){return{ngModule:we}}static \u0275fac=function(De){return new(De||we)};static \u0275mod=c.a4G({type:we});static \u0275inj=c.s3X({providers:[A],imports:[j]})}return we})();var u=r(58539),x=r(21232),U=r(20460),G=function(we){return we.Radio="radio",we.Checkbox="checkbox",we}(G||{}),X=r(72584);function D(we,qe){if(1&we&&(c.I0R(0,"mat-checkbox",10),c.OEk(1),c.C$Y()),2&we){const be=qe.$implicit;c._6D("formControlName",be.value),c.yG2(),c.cNF(be.title||be.value)}}function I(we,qe){if(1&we&&c.yuY(0,D,2,2,"ng-template",9),2&we){const be=c.GaO();c.E7m("ngForOf",be.data.choices)}}function M(we,qe){if(1&we&&(c.I0R(0,"mat-radio-button",13),c.OEk(1),c.C$Y()),2&we){const be=qe.$implicit;c.E7m("value",be.value),c.yG2(),c.oRS(" ",be.title||be.value," ")}}function s(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"mat-radio-group",11),c.qCj("change",function($e){c.usT(be);const dt=c.GaO();return c.CGJ(dt.onChange($e))}),c.yuY(1,M,2,2,"mat-radio-button",12),c.C$Y()}if(2&we){const be=c.GaO();c.yG2(),c.E7m("ngForOf",be.data.choices)}}let H=(()=>{class we{formBuilder;languageService;dialogRef;data;formGroup;isDisabled$=new w.g(!0);constructor(be,De,$e,dt){this.formBuilder=be,this.languageService=De,this.dialogRef=$e,this.data=dt,this.formGroup=this.formBuilder.group(this.getFg()),this.data.selectFieldText=this.data.selectFieldText??"igo.common.selectValueDialog.selectFieldText",this.data.processButtonText=this.data.processButtonText??"igo.common.selectValueDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.selectValueDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.selectValueDialog.multipleTitle",this.data.type===G.Radio&&(this.data.title="igo.common.selectValueDialog.title")}ngOnInit(){this.formGroup.valueChanges.subscribe(()=>this.canProcess())}getFg(){const be={};return this.data.choices.map(De=>be[De.value]=!1),be}canProcess(){const be=this.data.choices.map($e=>$e.value),De=[];be.map($e=>this.formGroup.value[$e]?De.push($e):void 0),this.isDisabled$.next(!De.length)}save(){const be=this.data.choices.map($e=>$e.value),De=[];be.map($e=>this.formGroup.value[$e]?De.push($e):void 0),this.dialogRef.close({choices:De})}cancel(){this.dialogRef.close()}onChange(be){const De={};this.data.choices.map($e=>De[$e.value]=!1),De[be.value]=!0,this.formGroup.setValue(De)}static \u0275fac=function(De){return new(De||we)(c.GI1(L.KE),c.GI1(U.ov),c.GI1(F.yI),c.GI1(F.sR,8))};static \u0275cmp=c.In1({type:we,selectors:[["igo-select-value-check-radio-dialog"]],standalone:!0,features:[c.UHJ],decls:16,vars:15,consts:[["mat-dialog-title",""],[1,"igo-form",3,"formGroup"],[1,"choices-section"],[4,"ngIf"],[3,"change",4,"ngIf"],["mat-dialog-actions",""],[1,"button-group"],["mat-raised-button","","type","button",3,"click"],["id","processBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["ngFor","",3,"ngForOf"],[3,"formControlName"],[3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(De,$e){1&De&&(c.I0R(0,"h1",0),c.OEk(1),c.wVc(2,"translate"),c.C$Y(),c.I0R(3,"form",1)(4,"section",2),c.yuY(5,I,1,1,null,3)(6,s,2,1,"mat-radio-group",4),c.C$Y(),c.I0R(7,"div",5)(8,"div",6)(9,"button",7),c.qCj("click",function(){return $e.cancel()}),c.OEk(10),c.wVc(11,"translate"),c.C$Y(),c.I0R(12,"button",8),c.qCj("click",function(){return $e.save()}),c.wVc(13,"async"),c.OEk(14),c.wVc(15,"translate"),c.C$Y()()()()),2&De&&(c.yG2(),c.cNF(c.kDX(2,7,$e.data.title)),c.yG2(2),c.E7m("formGroup",$e.formGroup),c.yG2(2),c.E7m("ngIf","checkbox"===$e.data.type),c.yG2(),c.E7m("ngIf","radio"===$e.data.type),c.yG2(4),c.oRS(" ",c.kDX(11,9,$e.data.cancelButtonText)," "),c.yG2(2),c.E7m("disabled",c.kDX(13,11,$e.isDisabled$)),c.yG2(2),c.oRS(" ",c.kDX(15,13,$e.data.processButtonText)," "))},dependencies:[F.WQ,L.y,L.sz,L.ue,L.u,L.sl,L.uW,L.Wo,y.u_,y.Iw,u.Vn,u.WK,x.yk,x.cv,x.cT,F.Yp,_.oJ,_.Gw,y.a,U._s,X.sD],styles:["[_nghost-%COMP%]  div[mat-dialog-actions]{margin:10px 0 0}[_nghost-%COMP%]  section.choices-section{max-width:auto;display:grid;grid-template-columns:auto auto;grid-gap:0px;padding:5px}"]})}return we})(),Z=(()=>{class we{dialog;constructor(be){this.dialog=be}open(be,De){const $e={choices:be,...De};return this.dialog.open(H,{disableClose:!1,data:$e,...De}).afterClosed()}static \u0275fac=function(De){return new(De||we)(c.CoB(F.qW))};static \u0275prov=c.wxM({token:we,factory:we.\u0275fac})}return we})(),me=(()=>{class we{static forRoot(){return{ngModule:we,providers:[]}}static \u0275fac=function(De){return new(De||we)};static \u0275mod=c.a4G({type:we});static \u0275inj=c.s3X({providers:[Z],imports:[H]})}return we})(),_e=(()=>{class we{confirmDialogService;selectValueDialogService;jsonDialogService;formDialogService;constructor(be,De,$e,dt){this.confirmDialogService=be,this.selectValueDialogService=De,this.jsonDialogService=$e,this.formDialogService=dt}confirm(){this.confirmDialogService.open("Do you want to continue?").subscribe(be=>{alert(`Your choice is: ${be}`)})}yesno(){this.confirmDialogService.open("Is the sky blue today? ",{modeYesNo:!0}).subscribe(be=>{alert(`Your choice is: ${be}`)})}select(be){this.selectValueDialogService.open([{value:"1",title:"Chocolate"},{value:"2",title:"Candy"},{value:3,title:"Cake"}],{type:be}).subscribe($e=>{$e?.choices&&($e.choices.length>1?alert(`Your choice(s) are: ${$e.choices}`):alert(`Your choice is: ${$e.choices}`))})}check(){this.select(G.Checkbox)}radio(){this.select(G.Radio)}json(){this.jsonDialogService.open("A JSON viewer",{isbn:"123-456-222",author:{lastname:"Doe",firstname:"Jane"},editor:{lastname:"Smith",firstname:"Jane"},title:"The Ultimate Database Study Guide",category:["Non-Fiction","Technology"]},["category"])}form(){this.formDialogService.open({formFieldConfigs:[{name:"country",title:"Country",options:{cols:1}}],formGroupsConfigs:[{name:"country",formFieldConfigs:[{name:"city",title:"City",options:{cols:1}}]},{name:"city",formFieldConfigs:[{name:"id",title:"ID",options:{cols:1,validator:L.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:L.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}]}]},{minWidth:"50vh"}).subscribe(Qt=>{Qt&&alert(JSON.stringify(Qt))})}email(){const be=[{name:"email",title:"Email",options:{cols:2,validator:L.AQ.compose([L.AQ.required,L.AQ.email])}},{name:"password",title:"Password",options:{cols:2,validator:L.AQ.required},inputs:{isPassword:!0}}];this.formDialogService.open({formFieldConfigs:be}).subscribe(De=>{De&&(De.password="\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0",alert(JSON.stringify(De)))})}static \u0275fac=function(De){return new(De||we)(c.GI1(S.Ex),c.GI1(Z),c.GI1(A),c.GI1(P.AB))};static \u0275cmp=c.In1({type:we,selectors:[["app-dialog"]],standalone:!0,features:[c.UHJ],decls:35,vars:0,consts:[["title","Various dialogs","subtitle","Common"],["codeFolder","common/dialog"],[1,"example-label"],[1,"example-button-row"],["mat-flat-button","","type","button","color","primary",3,"click"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"section")(3,"div",2),c.OEk(4,"Confirmation"),c.C$Y(),c.I0R(5,"div",3)(6,"button",4),c.qCj("click",function(){return $e.confirm()}),c.OEk(7," Base dialog "),c.C$Y(),c.I0R(8,"button",4),c.qCj("click",function(){return $e.yesno()}),c.OEk(9," Yes/no confirm dialog "),c.C$Y()()(),c.wR5(10,"mat-divider"),c.I0R(11,"section")(12,"div",2),c.OEk(13,"Custom selectors"),c.C$Y(),c.I0R(14,"div",3)(15,"button",4),c.qCj("click",function(){return $e.check()}),c.OEk(16," Open a dialog to select values by checkboxes "),c.C$Y(),c.I0R(17,"button",4),c.qCj("click",function(){return $e.radio()}),c.OEk(18," Open a dialog to select values by radio buttons "),c.C$Y()()(),c.wR5(19,"mat-divider"),c.I0R(20,"section")(21,"div",2),c.OEk(22,"Form based"),c.C$Y(),c.I0R(23,"div",3)(24,"button",4),c.qCj("click",function(){return $e.form()}),c.OEk(25," Basic form "),c.C$Y(),c.I0R(26,"button",4),c.qCj("click",function(){return $e.email()}),c.OEk(27," Email "),c.C$Y()()(),c.wR5(28,"mat-divider"),c.I0R(29,"section")(30,"div",2),c.OEk(31,"Renderer"),c.C$Y(),c.I0R(32,"div",3)(33,"button",4),c.qCj("click",function(){return $e.json()}),c.OEk(34," Open a dialog to open a json "),c.C$Y()()()()())},dependencies:[p.u,e.I,S.uK,me,P.OE,d,_.oJ,_.Gw,C.U,C.k],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}.example-label[_ngcontent-%COMP%]{display:table-cell;font-size:14px;margin-left:8px;min-width:120px}.example-button-row[_ngcontent-%COMP%]{display:table-cell;max-width:600px}.example-button-row[_ngcontent-%COMP%]   .mat-mdc-button-base[_ngcontent-%COMP%]{margin:8px 8px 8px 0}"]})}return we})();var de=r(72968);let le=(()=>{class we{cdRef;name;constructor(be){this.cdRef=be}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(De){return new(De||we)(c.GI1(c.kD9))};static \u0275cmp=c.In1({type:we,selectors:[["app-salutation-component"]],inputs:{name:"name"},standalone:!0,features:[c.UHJ],decls:2,vars:1,template:function(De,$e){1&De&&(c.I0R(0,"p"),c.OEk(1),c.C$Y()),2&De&&(c.yG2(),c.oRS("Hello, my name is ",$e.name,"."))},encapsulation:2,changeDetection:0})}return we})(),ue=(()=>{class we{cdRef;constructor(be){this.cdRef=be}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(De){return new(De||we)(c.GI1(c.kD9))};static \u0275cmp=c.In1({type:we,selectors:[["app-explanation-component"]],standalone:!0,features:[c.UHJ],decls:2,vars:0,template:function(De,$e){1&De&&(c.I0R(0,"p"),c.OEk(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),c.C$Y())},encapsulation:2,changeDetection:0})}return we})(),ne=(()=>{class we{component=le;inputs={name:"Bob"};toggleComponent(){this.component=this.component===le?ue:le}static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["app-dynamic-component"]],standalone:!0,features:[c.UHJ],decls:5,vars:2,consts:[["title","Dynamic Component","subtitle","Common"],["codeFolder","common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.wR5(2,"igo-dynamic-outlet",2),c.I0R(3,"button",3),c.qCj("click",function(){return $e.toggleComponent()}),c.OEk(4," Toggle Component "),c.C$Y()()()),2&De&&(c.yG2(2),c.E7m("component",$e.component)("inputs",$e.inputs))},dependencies:[p.u,e.I,de.qm,_.oJ,_.Gw],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})();var ve=r(87040);function ye(we,qe){if(1&we&&(c.I0R(0,"div")(1,"p"),c.OEk(2),c.wVc(3,"async"),c.C$Y(),c.I0R(4,"p"),c.OEk(5),c.wVc(6,"async"),c.C$Y(),c.I0R(7,"p"),c.OEk(8,"Description: "),c.wR5(9,"span",4),c.wVc(10,"async"),c.C$Y()()),2&we){const be=c.GaO();c.yG2(2),c.oRS("ID: ",c.kDX(3,3,be.selectedEntity$).id,""),c.yG2(3),c.oRS("Name: ",c.kDX(6,5,be.selectedEntity$).name,""),c.yG2(4),c.E7m("innerHtml",c.kDX(10,7,be.selectedEntity$).description,c.E3n)}}let Le=(()=>{class we{store=new ve.qc([]);selectedEntity$=new w.g(void 0);entityIsSelected;constructor(){}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(be){return be.name}onSelectedChange(be){this.entityIsSelected=!!be.value.id,this.selectedEntity$.next(be.value)}static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["app-entity-selector"]],standalone:!0,features:[c.UHJ],decls:4,vars:5,consts:[["title","Entity Selector","subtitle","Common"],["codeFolder","common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-selector",2),c.qCj("selectedChange",function(Qt){return $e.onSelectedChange(Qt)}),c.C$Y(),c.yuY(3,ye,11,9,"div",3),c.C$Y()()),2&De&&(c.yG2(2),c.E7m("store",$e.store)("titleAccessor",$e.getTitle)("emptyText","")("placeholder","Select an entity"),c.yG2(),c.E7m("ngIf",$e.entityIsSelected))},dependencies:[p.u,e.I,ve.sh,y.u_,y.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})(),He=(()=>{class we{store=new ve.qc([]);paginator;entitySortChange$=new w.g(!1);paginatorOptions={pageSize:10};template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(be,De)=>(0,ve.u6)(be,De),columns:[{name:"selected",title:"Selected",valueAccessor:be=>this.store.state.get(be).selected?"radio_button_checked":"radio_button_unchecked",renderer:ve.G8.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:ve.G8.HTML},{name:"date",title:"Date",type:"date"},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:()=>[{icon:"home",color:"warn",click:be=>{console.log(be)}}],renderer:ve.G8.ButtonGroup}]};constructor(){}ngOnInit(){const De=[2,1,3,4,5,6,7,8,9,10,11,12,13].map($e=>3===$e?{id:$e,name:`Name ${$e}`,description:`<b>Description ${$e}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:$e,name:`Name ${$e}`,description:`<b>Description ${$e}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(De)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(be){this.paginator=be}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["app-entity-table"]],standalone:!0,features:[c.UHJ],decls:3,vars:4,consts:[["title","Entity Table","subtitle","Common"],["codeFolder","common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-table",2),c.qCj("entitySortChange",function(){return $e.entitySortChange()}),c.C$Y()()()),2&De&&(c.yG2(2),c.E7m("store",$e.store)("withPaginator",!0)("paginatorOptions",$e.paginatorOptions)("template",$e.template))},dependencies:[p.u,e.I,ve.Eh],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})();function Ve(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"igo-form",3),c.qCj("submitForm",function($e){c.usT(be);const dt=c.GaO();return c.CGJ(dt.onSubmit($e))}),c.wVc(1,"async"),c.wR5(2,"igo-form-group",4),c.I0R(3,"div",5)(4,"button",6),c.qCj("click",function(){c.usT(be);const $e=c.GaO();return c.CGJ($e.fillForm())}),c.OEk(5," Fill Form "),c.C$Y(),c.I0R(6,"button",6),c.qCj("click",function(){c.usT(be);const $e=c.GaO();return c.CGJ($e.clearForm())}),c.OEk(7," Clear Form "),c.C$Y(),c.I0R(8,"button",7),c.OEk(9," Submit "),c.C$Y()()()}if(2&we){const be=qe.ngIf,De=c.GaO();c.E7m("form",be)("formData",c.kDX(1,4,De.data$)),c.yG2(2),c.E7m("group",be.groups[0]),c.yG2(6),c.E7m("disabled",De.submitDisabled)}}let Ge=(()=>{class we{formService;form$=new w.g(void 0);data$=new w.g(void 0);submitDisabled=!0;valueChanges$$;constructor(be){this.formService=be}ngOnInit(){const De=[{name:"id",title:"ID",options:{cols:1,validator:L.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:L.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(dt=>this.formService.field(dt)),$e=this.formService.form([],[this.formService.group({name:"info"},De)]);this.valueChanges$$=$e.control.valueChanges.subscribe(()=>{this.submitDisabled=!$e.control.valid}),this.form$.next($e)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(be){alert(JSON.stringify(be))}static \u0275fac=function(De){return new(De||we)(c.GI1(P.eO))};static \u0275cmp=c.In1({type:we,selectors:[["app-form"]],standalone:!0,features:[c.UHJ],decls:4,vars:3,consts:[["title","Form","subtitle","Common"],["codeFolder","common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.yuY(2,Ve,10,6,"igo-form",2),c.wVc(3,"async"),c.C$Y()()),2&De&&(c.yG2(2),c.E7m("ngIf",c.kDX(3,1,$e.form$)))},dependencies:[p.u,e.I,y.u_,P.Yl,P.O8,_.oJ,_.Gw,y.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{max-width:500px}"]})}return we})();var ct=r(50244),Ie=r(42536),Ye=r(80716);let se=(()=>{class we{exampleIndexHtml=ge;exampleStyleVariable=Re;exampleProvider=Ue;nameControl=new L.Ku("shopping_cart_checkout");static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["app-icon"]],standalone:!0,features:[c.UHJ],decls:49,vars:5,consts:[["title","Icon","subtitle","Common"],["href","https://fonts.google.com/icons","target","_blank"],["title","Icon","codeFolder","common/icon"],[1,"field-container"],["subscriptSizing","dynamic"],["matInput","","type","text",3,"formControl"],["icon","equal",1,"m-h-12"],[3,"icon"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"section")(2,"p"),c.OEk(3," The "),c.I0R(4,"code"),c.OEk(5,"icon"),c.C$Y(),c.OEk(6," is a core concept for many packages of the IGO2 library. The icon system is base on "),c.I0R(7,"a",1),c.OEk(8,"Google Font - Material Symbol"),c.C$Y(),c.OEk(9," who use font ligature to configure the icon "),c.C$Y()(),c.I0R(10,"section")(11,"h3"),c.OEk(12,"Getting started"),c.C$Y(),c.I0R(13,"ol")(14,"li"),c.OEk(15," In your "),c.I0R(16,"code"),c.OEk(17,"index.html"),c.C$Y(),c.OEk(18," file, add the variable font stylesheet request to your head tag and "),c.I0R(19,"pre")(20,"code"),c.OEk(21),c.C$Y()()(),c.I0R(22,"li"),c.OEk(23," Then add the current class with variable axes configuration to icons in your "),c.I0R(24,"code"),c.OEk(25,"style.scss"),c.C$Y(),c.OEk(26," file. "),c.I0R(27,"pre")(28,"code"),c.OEk(29),c.C$Y()()(),c.I0R(30,"li"),c.OEk(31," Finally, add the icon provider configuration in your main file "),c.I0R(32,"code"),c.OEk(33,"main.ts"),c.C$Y(),c.I0R(34,"pre")(35,"code"),c.OEk(36),c.C$Y()()()()(),c.I0R(37,"app-example-viewer",2)(38,"p"),c.OEk(39," Enter a name from the "),c.I0R(40,"a",1),c.OEk(41,"Google Font - Material Symbol"),c.C$Y()(),c.I0R(42,"div",3)(43,"mat-form-field",4)(44,"mat-label"),c.OEk(45,"Icon Name"),c.C$Y(),c.wR5(46,"input",5),c.C$Y(),c.wR5(47,"igo-icon",6)(48,"igo-icon",7),c.C$Y()()()),2&De&&(c.yG2(21),c.cNF($e.exampleIndexHtml),c.yG2(8),c.cNF($e.exampleStyleVariable),c.yG2(7),c.cNF($e.exampleProvider),c.yG2(10),c.E7m("formControl",$e.nameControl),c.yG2(2),c.E7m("icon",$e.nameControl.value))},dependencies:[p.u,e.I,Ye.S,ct.wb,ct.Up,ct.w5,L.sl,L.ot,L.ue,L.ug,Ie.cN,Ie.yi],styles:[".field-container[_ngcontent-%COMP%]{display:flex;align-items:center}"]})}return we})();const ge='<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />',Re=".material-symbols-outlined {\n  font-variation-settings:\n  'FILL' 0,\n  'wght' 400,\n  'GRAD' 0,\n  'opsz' 24\n}",Ue="import { provideIcon } from '@igo2/common/icon';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideIcon(),\n  ]\n})\n";var ze=r(17469),Be=r(32328),st=r(76768),xe=r(80956),Ke=r(43168),Qe=r(93244),It=r(24112),at=r(11484),Ft=function(we){return we[we.primary=0]="primary",we[we.accent=1]="accent",we[we.warn=2]="warn",we}(Ft||{}),Et=r(728),Kt=r(40604);class yt extends ze.Cc{_database;_model;_sort;get filter(){return this._filterChange.value}set filter(qe){this._filterChange.next(qe)}_filterChange=new w.g("");constructor(qe,be,De){super(),this._database=qe,this._model=be,this._sort=De}connect(){return this._database?(0,Et.U)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,Kt.k)(()=>this.getFilteredData(this._database.data)),(0,Kt.k)(be=>this.getSortedData(be))):(0,Et.U)([])}disconnect(){}getFilteredData(qe){return this.filter?qe.slice().filter(be=>-1!==this._model.columns.filter($e=>$e.filterable).map($e=>Ke.Yv.resolve(be,$e.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):qe}getSortedData(qe){return this._sort.active&&""!==this._sort.direction?qe.sort((be,De)=>{const $e=Ke.Yv.resolve(be,this._sort.active),dt=Ke.Yv.resolve(De,this._sort.active);return Ke.Yv.naturalCompare(dt,$e,this._sort.direction)}):qe}}const Oo=["filter"];function ei(we,qe){1&we&&(c.I0R(0,"div",12)(1,"mat-form-field",13),c.wR5(2,"input",14,15),c.wVc(4,"translate"),c.C$Y()()),2&we&&(c.yG2(2),c.E7m("placeholder",c.kDX(4,1,"igo.common.table.filter")))}function Pt(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"th",16)(1,"mat-checkbox",17),c.qCj("change",function($e){c.usT(be);const dt=c.GaO();return c.CGJ($e?dt.masterToggle():null)}),c.C$Y()()}if(2&we){const be=c.GaO();c.yG2(),c.E7m("checked",be.selection.hasValue()&&be.isAllSelected())("indeterminate",be.selection.hasValue()&&!be.isAllSelected())}}function xt(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"td",18)(1,"mat-checkbox",19),c.qCj("click",function($e){return $e.stopPropagation()})("change",function($e){const Qt=c.usT(be).$implicit,Do=c.GaO();return c.CGJ($e?Do.selection.toggle(Qt):null)}),c.C$Y()()}if(2&we){const be=qe.$implicit,De=c.GaO();c.yG2(),c.E7m("checked",De.selection.isSelected(be))}}function ut(we,qe){if(1&we&&(c.I0R(0,"th",25),c.OEk(1),c.C$Y()),2&we){const be=c.GaO(2).$implicit;c.yG2(),c.oRS(" ",be.title," ")}}function Go(we,qe){1&we&&(c.SAx(0),c.yuY(1,ut,2,1,"th",24),c.k70())}function Ze(we,qe){if(1&we&&(c.I0R(0,"th",16),c.OEk(1),c.C$Y()),2&we){const be=c.GaO(2).$implicit;c.yG2(),c.cNF(be.title)}}function Io(we,qe){1&we&&(c.SAx(0),c.yuY(1,Ze,2,1,"th",6),c.k70())}const Xt=()=>({});function eo(we,qe){if(1&we&&(c.I0R(0,"td",27),c.OEk(1),c.C$Y()),2&we){const be=qe.$implicit,De=c.GaO(2).$implicit,$e=c.GaO();c.E7m("ngClass",$e.model.cellClassFunc?$e.model.cellClassFunc(be,De):c.q4q(2,Xt)),c.yG2(),c.oRS(" ",$e.getValue(be,De.name)," ")}}function $o(we,qe){1&we&&(c.SAx(0),c.yuY(1,eo,2,3,"td",26),c.k70())}function Ao(we,qe){if(1&we&&c.wR5(0,"td",29),2&we){const be=qe.$implicit,De=c.GaO(2).$implicit,$e=c.GaO();c.E7m("ngClass",$e.model.cellClassFunc?$e.model.cellClassFunc(be,De):c.q4q(2,Xt))("innerHTML",$e.getValue(be,De.name),c.E3n)}}function No(we,qe){1&we&&c.yuY(0,Ao,1,3,"td",28)}function pi(we,qe){if(1&we&&(c.SAx(0,20),c.yuY(1,Go,2,0,"ng-container",21)(2,Io,2,0,"ng-container",21)(3,$o,2,0,"ng-container",22)(4,No,1,0,"ng-template",null,23,c.gJz),c.k70()),2&we){const be=qe.$implicit,De=c.Gew(5);c.E7m("matColumnDef",be.name),c.yG2(),c.E7m("ngIf",be.sortable),c.yG2(),c.E7m("ngIf",!be.sortable),c.yG2(),c.E7m("ngIf",!be.html)("ngIfElse",De)}}function no(we,qe){1&we&&c.wR5(0,"th",16)}function ro(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"button",31),c.qCj("click",function($e){const Qt=c.usT(be).$implicit,Do=c.GaO().$implicit,mi=c.GaO();return c.CGJ(mi.handleClickAction($e,Qt,Do))}),c.I0R(1,"mat-icon"),c.OEk(2),c.C$Y()()}if(2&we){const be=qe.$implicit,De=c.GaO(2);c.E7m("color",De.getActionColor(be.color)),c.yG2(2),c.cNF(be.icon)}}function pt(we,qe){if(1&we&&(c.I0R(0,"td",18),c.yuY(1,ro,3,2,"button",30),c.C$Y()),2&we){const be=c.GaO();c.yG2(),c.E7m("ngForOf",be.model.actions)}}function wo(we,qe){1&we&&c.wR5(0,"tr",32)}function ti(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"tr",33),c.qCj("click",function(){const dt=c.usT(be).$implicit,Qt=c.GaO();return c.CGJ(Qt.selection.toggle(dt))}),c.C$Y()}if(2&we){const be=qe.$implicit,De=c.GaO();c.E7m("ngClass",De.model.rowClassFunc?De.model.rowClassFunc(be):c.q4q(1,Xt))}}let Ho=(()=>{class we{get database(){return this._database}set database(be){this._database=be}_database;get model(){return this._model}set model(be){this._model=be}_model;get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(be){this._hasFIlterInput=be}_hasFIlterInput=!0;displayedColumns;dataSource;selection=new ze.e2(!0,[]);select=new c._w7;filter;sort;ngOnInit(){this.dataSource=new yt(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(be=>!1!==be.displayed).map(be=>be.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(be=>this.select.emit(be))}ngAfterViewInit(){this.filter&&(0,Qe.w)(this.filter.nativeElement,"keyup").pipe((0,It.o)(150),(0,at.a)()).subscribe(()=>{this.dataSource&&(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(be){be.database&&(this.dataSource=new yt(this.database,this.model,this.sort),this.selection.clear())}getActionColor(be){return Ft[be]}getValue(be,De){return Ke.Yv.resolve(be,De)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(be=>this.selection.select(be))}handleClickAction(be,De,$e){be.stopPropagation(),De.click($e)}static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["igo-table"]],viewQuery:function(De,$e){if(1&De&&(c.CC$(Oo,5),c.CC$(st.E9,7)),2&De){let dt;c.wto(dt=c.Gqi())&&($e.filter=dt.first),c.wto(dt=c.Gqi())&&($e.sort=dt.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},standalone:!0,features:[c.SYr,c.UHJ],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(De,$e){1&De&&(c.I0R(0,"div",0),c.yuY(1,ei,5,3,"div",1),c.I0R(2,"div",2)(3,"table",3,4),c.SAx(5,5),c.yuY(6,Pt,2,2,"th",6)(7,xt,2,1,"td",7),c.k70(),c.yuY(8,pi,6,5,"ng-container",8),c.SAx(9,9),c.yuY(10,no,1,0,"th",6)(11,pt,2,1,"td",7),c.k70(),c.yuY(12,wo,1,0,"tr",10)(13,ti,1,2,"tr",11),c.C$Y()()()),2&De&&(c.yG2(),c.E7m("ngIf",$e.hasFilterInput),c.yG2(2),c.E7m("dataSource",$e.dataSource),c.yG2(5),c.E7m("ngForOf",$e.model.columns),c.yG2(4),c.E7m("matHeaderRowDef",$e.displayedColumns),c.yG2(),c.E7m("matRowDefColumns",$e.displayedColumns))},dependencies:[y.u_,ct.wb,ct.Up,Ie.cN,Ie.yi,xe.If,xe.wL,xe.ie,xe.aG,xe.Af,xe.uc,xe.gx,xe.qC,xe.cX,xe.yC,xe._I,st.Su,st.E9,st.e6,u.Vn,u.WK,y.Iw,y.QF,_.oJ,_.CI,Be.oB,Be.qL,U._s,X.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-mdc-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]})}return we})();class To{dataChange=new w.g([]);get data(){return this.dataChange.value}constructor(qe){qe&&this.dataChange.next(qe)}set(qe){this.dataChange.next(qe)}add(qe){const be=this.data.slice();be.push(qe),this.set(be)}remove(qe){const be=this.data.slice(),De=be.indexOf(qe);be.splice(De,1),this.set(be)}}let Eo=(()=>{class we{database;model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"description",color:Ft.primary,click:be=>this.showName(be.name)}],selectionCheckbox:!0};constructor(){}ngOnInit(){this.database=new To([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(be){alert(be)}handleSelect(be){console.log(be)}static \u0275fac=function(De){return new(De||we)};static \u0275cmp=c.In1({type:we,selectors:[["app-table"]],standalone:!0,features:[c.UHJ],decls:3,vars:3,consts:[["title","Table","subtitle","Common"],["codeFolder","common/table"],[3,"database","model","hasFilterInput","select"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-table",2),c.qCj("select",function(Qt){return $e.handleSelect(Qt)}),c.C$Y()()()),2&De&&(c.yG2(2),c.E7m("database",$e.database)("model",$e.model)("hasFilterInput",!0))},dependencies:[p.u,e.I,Ho],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})();var so=r(21124),to=r(21800),Mt=r(68848);function _o(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"button",7),c.qCj("click",function(){c.usT(be);const $e=c.GaO();return c.CGJ($e.toolbox.activatePreviousTool())}),c.I0R(1,"mat-icon"),c.OEk(2,"arrow_back"),c.C$Y()()}}function ko(we,qe){if(1&we){const be=c.KQA();c.I0R(0,"button",8),c.qCj("click",function(){c.usT(be);const $e=c.GaO();return c.CGJ($e.toolbox.deactivateTool())}),c.I0R(1,"mat-icon"),c.OEk(2,"menu"),c.C$Y()()}}let Bo=class la{cdRef;name;constructor(qe){this.cdRef=qe}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(be){return new(be||la)(c.GI1(c.kD9))};static \u0275cmp=c.In1({type:la,selectors:[["app-salutation-tool"]],inputs:{name:"name"},standalone:!0,features:[c.UHJ],decls:2,vars:1,template:function(be,De){1&be&&(c.I0R(0,"p"),c.OEk(1),c.C$Y()),2&be&&(c.yG2(),c.oRS("Hello, my name is ",De.name,"."))},encapsulation:2,changeDetection:0})};Bo=(0,so.UN)([(0,Mt.aA)({name:"demo-salutation",title:"Salutation",icon:"person",options:{name:"Jack"}}),(0,so.YR)("design:paramtypes",[c.kD9])],Bo);let Jt=class ca{static \u0275fac=function(be){return new(be||ca)};static \u0275cmp=c.In1({type:ca,selectors:[["app-about-tool"]],standalone:!0,features:[c.UHJ],decls:2,vars:0,template:function(be,De){1&be&&(c.I0R(0,"p"),c.OEk(1,"I'm a tool inside a toolbox."),c.C$Y())},encapsulation:2,changeDetection:0})};Jt=(0,so.UN)([(0,Mt.aA)({name:"demo-about",title:"About",icon:"information"})],Jt);let Uo=(()=>{class we{toolService;toolbox=new Mt.Eb;get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}constructor(be){this.toolService=be}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}static \u0275fac=function(De){return new(De||we)(c.GI1(Mt.IF))};static \u0275cmp=c.In1({type:we,selectors:[["app-tool"]],standalone:!0,features:[c.UHJ],decls:10,vars:9,consts:[["title","Tool","subtitle","Common"],["codeFolder","common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],["color","primary",3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["mat-icon-button","","panelRightButton","",3,"click"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-panel",2),c.yuY(3,_o,3,0,"button",3),c.wVc(4,"async"),c.yuY(5,ko,3,0,"button",4),c.wVc(6,"async"),c.wR5(7,"igo-toolbox",5),c.C$Y(),c.I0R(8,"button",6),c.qCj("click",function(){return $e.activateSalutationTool()}),c.OEk(9," Activate Salutation Tool "),c.C$Y()()()),2&De&&(c.yG2(2),c.E7m("title",$e.panelTitle),c.yG2(),c.E7m("ngIf",c.kDX(4,5,$e.activeTool$)),c.yG2(2),c.E7m("ngIf",c.kDX(6,7,$e.activeTool$)),c.yG2(2),c.E7m("toolbox",$e.toolbox)("animate",!0))},dependencies:[p.u,e.I,to.c,y.u_,_.oJ,_.Gw,_.um,Be.oB,Be.qL,Mt.cT,y.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})();var xo=r(90784),Yo=r(62120);let Yt=(()=>{class we{cdRef;name;complete=new c._w7;cancel=new c._w7;constructor(be){this.cdRef=be}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(De){return new(De||we)(c.GI1(c.kD9))};static \u0275cmp=c.In1({type:we,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[c.UHJ],decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(De,$e){1&De&&(c.I0R(0,"p"),c.OEk(1),c.C$Y(),c.I0R(2,"button",0),c.qCj("click",function(){return $e.complete.emit($e.name)}),c.OEk(3," Nice to meet you "),c.C$Y(),c.I0R(4,"button",0),c.qCj("click",function(){return $e.cancel.emit($e.name)}),c.OEk(5,"Dismiss"),c.C$Y()),2&De&&(c.yG2(),c.oRS("Hello, my name is ",$e.name,"."))},dependencies:[_.oJ,_.Gw],encapsulation:2,changeDetection:0})}return we})();const Vo=[{path:"",redirectTo:"action",pathMatch:"full"},{title:"Action",path:"action",component:R},{title:"Dialogs",path:"dialog",component:_e},{title:"Dynamic Component",path:"dynamic-component",component:ne},{title:"Entity Table",path:"entity-table",component:He},{title:"Entity Selector",path:"entity-selector",component:Le},{title:"Form",path:"form",component:Ge},{title:"Icon",path:"icon",component:se},{title:"Table",path:"table",component:Eo},{title:"Tool",path:"tool",component:Uo},{title:"Widget",path:"widget",component:(()=>{class we{widgetService;widget;inputs={name:"Bob"};constructor(be){this.widgetService=be,this.widget=this.widgetService.create(Yt)}onWidgetComplete(be){alert(`${be} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}static \u0275fac=function(De){return new(De||we)(c.GI1(xo.cx))};static \u0275cmp=c.In1({type:we,selectors:[["app-widget"]],standalone:!0,features:[c.UHJ],decls:3,vars:2,consts:[["title","Widget","subtitle","Common"],["codeFolder","common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(De,$e){1&De&&(c.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-widget-outlet",2),c.qCj("complete",function(Qt){return $e.onWidgetComplete(Qt)})("cancel",function(){return $e.onWidgetCancel()}),c.C$Y()()()),2&De&&(c.yG2(2),c.E7m("widget",$e.widget)("inputs",$e.inputs))},dependencies:[p.u,e.I,xo.iA,Yo.A],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return we})()}]},32688:(Pe,ae,r)=>{"use strict";r.d(ae,{u:()=>c});var E=r(65056),a=r(34896);function w(o,R){if(1&o&&(a.I0R(0,"li"),a.OEk(1),a.C$Y()),2&o){const L=R.$implicit;a.yG2(),a.cNF(L)}}function p(o,R){if(1&o&&(a.SAx(0),a.I0R(1,"label",3),a.OEk(2,"Dependencies:"),a.C$Y(),a.I0R(3,"ul"),a.yuY(4,w,2,1,"li",4),a.C$Y(),a.k70()),2&o){const L=a.GaO();a.yG2(4),a.E7m("ngForOf",L.dependencies)}}const e=["*"];let c=(()=>{class o{title;subtitle;dependencies;static \u0275fac=function(_){return new(_||o)};static \u0275cmp=a.In1({type:o,selectors:[["app-doc-viewer"]],inputs:{title:"title",subtitle:"subtitle",dependencies:"dependencies"},standalone:!0,features:[a.UHJ],ngContentSelectors:e,decls:7,vars:3,consts:[[1,"mat-subtitle-2","m-b-0"],[1,"mat-body-1"],[4,"ngIf"],["for",""],[4,"ngFor","ngForOf"]],template:function(_,C){1&_&&(a.kPM(),a.I0R(0,"h6",0),a.OEk(1),a.C$Y(),a.I0R(2,"h2"),a.OEk(3),a.C$Y(),a.I0R(4,"div",1),a.yuY(5,p,5,1,"ng-container",2),a._Xx(6),a.C$Y()),2&_&&(a.yG2(),a.cNF(C.subtitle),a.yG2(2),a.cNF(C.title),a.yG2(2),a.E7m("ngIf",null==C.dependencies?null:C.dependencies.length))},dependencies:[E.u_,E.Iw],styles:["[_nghost-%COMP%]{display:block;padding:16px 48px}@media (max-width: 599px){[_nghost-%COMP%]{padding:16px}}[_nghost-%COMP%]     pre{background:#00000003;border:.5px solid rgba(0,0,0,.2);border-radius:5px;display:block;margin:16px auto;overflow-x:auto;padding:20px;white-space:pre-wrap}[_nghost-%COMP%]     pre code{background:transparent}[_nghost-%COMP%]     code{background:#00000008;padding:3px;font-size:90%}[_nghost-%COMP%]     section{margin-bottom:42px}"]})}return o})()},51100:(Pe,ae,r)=>{"use strict";r.d(ae,{I:()=>S});var E=r(65056),a=r(34672),w=r(48512),p=r(75180),e=r(32328),c=r(27e3),o=r(34896);function R(P,y){if(1&P&&(o.I0R(0,"a",6)(1,"mat-icon"),o.OEk(2,"code-tags"),o.C$Y()()),2&P){const F=o.GaO();o.E7m("href",F.codeUrl,o.K6U)}}function L(P,y){if(1&P&&(o.I0R(0,"a",7)(1,"mat-icon"),o.OEk(2,"settings"),o.C$Y()()),2&P){const F=o.GaO();o.E7m("href",F.configUrl,o.K6U)}}const _=["*"],C="https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src";let S=(()=>{class P{title;codeFolder;configFolder;get codeUrl(){return`${C}/app/${this.codeFolder}`}get configUrl(){return`${C}/${this.configFolder}`}static \u0275fac=function(h){return new(h||P)};static \u0275cmp=o.In1({type:P,selectors:[["app-example-viewer"]],inputs:{title:"title",codeFolder:"codeFolder",configFolder:"configFolder"},standalone:!0,features:[o.UHJ],ngContentSelectors:_,decls:10,vars:3,consts:[["appearance","outlined"],[1,"actions"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href",4,"ngIf"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href",4,"ngIf"],[1,"m-b-16"],[1,"mat-body-1"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href"]],template:function(h,W){1&h&&(o.kPM(),o.I0R(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-subtitle"),o.OEk(3),o.C$Y(),o.I0R(4,"div",1),o.yuY(5,R,3,1,"a",2)(6,L,3,1,"a",3),o.C$Y()(),o.wR5(7,"mat-divider",4),o.I0R(8,"mat-card-content",5),o._Xx(9),o.C$Y()()),2&h&&(o.yG2(3),o.oRS(" ",W.title," "),o.yG2(2),o.E7m("ngIf",W.codeFolder),o.yG2(),o.E7m("ngIf",W.configFolder))},dependencies:[w.NR,w.SM,w.WK,w.Uc,w.uK,E.u_,a.oJ,a.cP,c.KO,c.a4,e.oB,e.qL,p.U,p.k],styles:["[_nghost-%COMP%]{display:block;margin-top:24px}[_nghost-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 8px 0 16px;margin-bottom:0}[_nghost-%COMP%]     .mat-mdc-card-header-text{display:flex;align-items:center}[_nghost-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:16px}"]})}return P})()},87124:(Pe,ae,r)=>{"use strict";r.r(ae),r.d(ae,{routes:()=>C});var E=r(52072),a=r(21800),w=r(29904),p=r(31492),e=r(32688),c=r(51100),o=r(34896);function R(S,P){1&S&&o.wR5(0,"igo-metadata-button",18),2&S&&o.E7m("layer",P.layer)}const L=()=>["HttpClientModule"],C=[{path:"",redirectTo:"context",pathMatch:"full"},{title:"Context",path:"context",component:(()=>{class S{mapService;contextService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(y,F){this.mapService=y,this.contextService=F,this.mapService.setMap(this.map),this.contextService.loadDefaultContext(),this.contextService.loadContexts()}static \u0275fac=function(F){return new(F||S)(o.GI1(p.u00),o.GI1(w.M9))};static \u0275cmp=o.In1({type:S,selectors:[["app-context"]],standalone:!0,features:[o.UHJ],decls:22,vars:12,consts:[["title","Context","subtitle","Context",3,"dependencies"],["codeFolder","context/context","configFolder","contexts"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoMapContext","","igoLayerContext","",3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100"],["title","Contexts list",1,"h-100","w-100"],["igoContextListBinding","",3,"map"],["title","Layers",1,"h-100","w-100"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],["title","Import/Export context","codeFolder","context/context","configFolder","contexts"],[3,"map"],[3,"layer"]],template:function(F,h){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile")(13,"div",10)(14,"igo-panel",11),o.wR5(15,"igo-context-list",12),o.C$Y(),o.I0R(16,"igo-panel",13)(17,"igo-layer-list",14),o.yuY(18,R,1,1,"ng-template",null,15,o.gJz),o.C$Y()()()()()(),o.I0R(20,"app-example-viewer",16),o.wR5(21,"igo-context-import-export",17),o.C$Y()()),2&F&&(o.E7m("dependencies",o.q4q(11,L)),o.yG2(4),o.E7m("map",h.map)("view",h.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",h.map),o.yG2(2),o.E7m("map",h.map),o.yG2(),o.E7m("map",h.map),o.yG2(),o.E7m("map",h.map),o.yG2(4),o.E7m("map",h.map),o.yG2(2),o.E7m("map",h.map),o.yG2(4),o.E7m("map",h.map))},dependencies:[e.u,c.I,E.CQ,E.ae,E.cn,p.cdH,p.eqy,p.q2F,p.i6P,p.qcl,w.W2,w.AX,w.k5,w.Mb,a.c,p.m2U,p.Ult,p.Idw,w.kP]})}return S})()}]},90092:(Pe,ae,r)=>{"use strict";r.r(ae),r.d(ae,{routes:()=>Ve});var E=r(34672),a=r(38776),w=r(24956),p=r(32688),e=r(51100),c=r(34896);let o=(()=>{class Ge{activityService;idsActivity=[];constructor(Ie){this.activityService=Ie}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(w.U9))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-activity"]],standalone:!0,features:[c.UHJ],decls:23,vars:1,consts:[["title","Activity","subtitle","Core"],["codeFolder","core/activity"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"mat-body-1","sub-content"],["igoSpinnerActivity",""]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Register activities in service. Use to display a loading icon"),c.C$Y(),c.I0R(3,"li"),c.OEk(4," Import "),c.I0R(5,"code"),c.OEk(6,"IgoActivityModule"),c.C$Y(),c.OEk(7," only if you want register HTTP calls "),c.C$Y(),c.I0R(8,"li"),c.OEk(9,"Import "),c.I0R(10,"code"),c.OEk(11,"IgoActivityModule"),c.C$Y(),c.OEk(12," only once"),c.C$Y(),c.I0R(13,"app-example-viewer",1)(14,"div",2)(15,"button",3),c.qCj("click",function(){return se.register()}),c.OEk(16,"Register"),c.C$Y(),c.I0R(17,"button",3),c.qCj("click",function(){return se.unregister()}),c.OEk(18,"Unregister"),c.C$Y()(),c.I0R(19,"div",4)(20,"p"),c.OEk(21),c.C$Y(),c.wR5(22,"igo-spinner",5),c.C$Y()()()),2&Ye&&(c.yG2(21),c.oRS("Counter: ",se.counter,""))},dependencies:[p.u,e.I,a.is,E.oJ,E.Gw],styles:["[_nghost-%COMP%]   .sub-content[_ngcontent-%COMP%]{margin-top:12px}"]})}return Ge})();var R=r(65056),L=r(45872);let _=(()=>{class Ge{configService;configLanguage;constructor(Ie){this.configService=Ie,this.configLanguage=this.configService.getConfig("language")}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(L.aW))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-config"]],standalone:!0,features:[c.UHJ],decls:12,vars:3,consts:[["title","Config","subtitle","Core"],["title","Simple config","codeFolder","core/config","configFolder","environments"],[1,"mat-body-1"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Load config in your angular application"),c.C$Y(),c.I0R(3,"li"),c.OEk(4,"Import "),c.I0R(5,"code"),c.OEk(6,"IgoConfigModule"),c.C$Y(),c.OEk(7," only once"),c.C$Y(),c.I0R(8,"app-example-viewer",1)(9,"p",2),c.OEk(10),c.wVc(11,"json"),c.C$Y()()()),2&Ye&&(c.yG2(10),c.oRS("Config language: ",c.kDX(11,1,se.configLanguage),""))},dependencies:[p.u,e.I,R.ED]})}return Ge})();var C=r(20460),S=r(72584);let P=(()=>{class Ge{languageService;app={title:"IGO"};constructor(Ie){this.languageService=Ie}changeLanguage(Ie){this.languageService.setLanguage(Ie),console.log(this.languageService)}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(C.ov))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-language"]],standalone:!0,features:[c.UHJ],decls:21,vars:4,consts:[["title","Language","subtitle","Core"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale"],["codeFolder","core/language"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"m-t-12"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Translate your angular application"),c.C$Y(),c.I0R(3,"li"),c.OEk(4,"Import "),c.I0R(5,"code"),c.OEk(6,"IgoLanguageModule"),c.C$Y(),c.OEk(7," only once"),c.C$Y(),c.I0R(8,"li"),c.OEk(9," Configure the "),c.I0R(10,"a",1),c.OEk(11,"locale files"),c.C$Y()(),c.I0R(12,"app-example-viewer",2)(13,"div",3)(14,"button",4),c.qCj("click",function(){return se.changeLanguage("en")}),c.OEk(15,"English"),c.C$Y(),c.I0R(16,"button",4),c.qCj("click",function(){return se.changeLanguage("fr")}),c.OEk(17,"Fran\xe7ais"),c.C$Y()(),c.I0R(18,"div",5),c.OEk(19),c.wVc(20,"translate"),c.C$Y()()()),2&Ye&&(c.yG2(19),c.oRS(" ",c.g7$(20,1,"welcome",se.app)," "))},dependencies:[p.u,e.I,E.oJ,E.Gw,C._s,S.sD]})}return Ge})();var y=r(56264);let F=(()=>{class Ge{mediaService;constructor(Ie){this.mediaService=Ie}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(y.QB))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-media"]],standalone:!0,features:[c.UHJ],decls:10,vars:3,consts:[["title","Media","subtitle","Core"],["codeFolder","core/media"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Detect type of media (mobile, tablet, desktop)"),c.C$Y(),c.I0R(3,"app-example-viewer",1)(4,"p"),c.OEk(5),c.C$Y(),c.I0R(6,"p"),c.OEk(7),c.C$Y(),c.I0R(8,"p"),c.OEk(9),c.C$Y()()()),2&Ye&&(c.yG2(5),c.oRS("Current media: ",se.media,""),c.yG2(2),c.oRS("Current orientation: ",se.orientation,""),c.yG2(2),c.oRS(" Device mode: ",se.isTouchScreen?"Touch device":"Not a touch device "," "))},dependencies:[p.u,e.I]})}return Ge})();var h=r(64100);let W=(()=>{class Ge{messageService;constructor(Ie){this.messageService=Ie}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(h.mi))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-message"]],standalone:!0,features:[c.UHJ],decls:20,vars:0,consts:[["title","Message","subtitle","Core"],["codeFolder","core/message"],[1,"d-flex","m-t-16","actions-container"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Show message to user."),c.C$Y(),c.I0R(3,"li"),c.OEk(4,"Import "),c.I0R(5,"code"),c.OEk(6,"IgoMessageModule"),c.C$Y(),c.OEk(7," only once"),c.C$Y(),c.I0R(8,"li"),c.OEk(9,"Dependencies: BrowserAnimationsModule"),c.C$Y(),c.I0R(10,"app-example-viewer",1)(11,"div",2)(12,"button",3),c.qCj("click",function(){return se.success()}),c.OEk(13,"Success message"),c.C$Y(),c.I0R(14,"button",4),c.qCj("click",function(){return se.info()}),c.OEk(15," Info message "),c.C$Y(),c.I0R(16,"button",5),c.qCj("click",function(){return se.alert()}),c.OEk(17," Alert message "),c.C$Y(),c.I0R(18,"button",6),c.qCj("click",function(){return se.error()}),c.OEk(19," Error message "),c.C$Y()()()())},dependencies:[p.u,e.I,E.oJ,E.Gw]})}return Ge})();var J=r(11687);const T=Ge=>Ge.enableTracing||!!Ge.tracesSampleRate||!!Ge.tracesSampler;var z=r(57880),Y=r(25556),N=r(51540),K=r(75848),j=r(68123);const x=new c.UbH("monitoring.options");function U(Ge){if(!Ge)return[];const ct=[{provide:x,useValue:Ge}];return"sentry"===Ge.provider&&ct.push(...(Ge=>{if(void 0!==Ge.enabled&&!Ge.enabled)return[];(Ge=>{if((0,N.WS)().getClient())return;const Ie=T(Ge),Ye={dsn:Ge.dsn,environment:Ge.environment,release:Ge.release,integrations:[Ie&&new K.CC({routingInstrumentation:Y.CI}),Ge.enableReplay&&new j.SQ].filter(Boolean)};(0,Y._6)(Ye)})(Ge);const Ie=T(Ge);return[{provide:c.eAe,useFactory:()=>(Ge=>(0,Y.W4)({logErrors:Ge.logErrors,...Ge.errorHandlerOptions??{}}))(Ge)},Ie&&{provide:Y.a4,deps:[z.E5]},Ie&&{provide:c.kZF,useFactory:()=>()=>{},deps:[Y.a4],multi:!0}].filter(Boolean)})(Ge)),ct}var D=r(45928),I=r(83680),M=r(19432);let s=(()=>{class Ge{configService;monitoringOptions;injector;authService;constructor(Ie,Ye,se){this.configService=Ie,this.monitoringOptions=Ye,this.injector=se,this.monitoringOptions?.identifyUser&&this.configService.isLoaded$.pipe((0,I.K)(ge=>ge),(0,M.G)(()=>(this.authService=this.injector.get(D.oj),this.authService?.authenticate$))).subscribe(ge=>{this._identifyUser(ge?this.authService.user:null)})}_identifyUser(Ie){"sentry"===this.monitoringOptions.provider&&(Ge=>{(0,J.u6)(Ge?{id:Ge.id,username:`${Ge.firstName} ${Ge.lastName}`,email:Ge.email}:null)})(Ie)}static \u0275fac=function(Ye){return new(Ye||Ge)(c.CoB(L.aW),c.CoB(x,8),c.CoB(c.zZn))};static \u0275prov=c.wxM({token:Ge,factory:Ge.\u0275fac,providedIn:"root"})}return Ge})();function H(Ge){return Ge?[{provide:s,useClass:s,deps:[L.aW,x,c.zZn]},{provide:c.kZF,useFactory:()=>()=>{},deps:[s],multi:!0}]:[]}var Z=r(12445);let me=(()=>{class Ge{options;json;exampleProviderCode=_e;constructor(Ie,Ye){this.options=Ie,this.json=Ye}throwTestError(){throw new Error("Sentry Test Error")}getBasicConfigExample(){const Ie=`{"igo": {"monitoring": ${JSON.stringify(this.options,null,2)}}}`;return this.json.transform(JSON.parse(Ie))}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(x),c.GI1(R.ED))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-monitoring"]],standalone:!0,features:[c.M5G([R.ED,...U(Z.O.igo.monitoring),...H(Z.O.igo.monitoring)]),c.UHJ],decls:58,vars:2,consts:[["title","Monitoring","subtitle","Core"],["href","https://docs.sentry.io/platforms/javascript/configuration/options","target","_blank"],["href","https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/","target","_blank"],[3,"innerHTML"],["title","Sentry","codeFolder","core/monitoring","configFolder","environments"],[1,"mat-body-1"],["mat-raised-button","","color","warn",3,"click"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"section")(2,"p"),c.OEk(3," The "),c.I0R(4,"code"),c.OEk(5,"monitoring"),c.C$Y(),c.OEk(6," package provides a set of configuration for managing application monitoring "),c.C$Y(),c.I0R(7,"ul")(8,"li"),c.OEk(9,"Error montioring, report application exception"),c.C$Y(),c.I0R(10,"li"),c.OEk(11,"Custom event reporting, like tracking use of code deprecation"),c.C$Y()()(),c.I0R(12,"section")(13,"h3"),c.OEk(14,"Getting started"),c.C$Y(),c.I0R(15,"p"),c.OEk(16," Start by configure the monitoring options in your "),c.I0R(17,"code"),c.OEk(18,"environnment.ts"),c.C$Y(),c.OEk(19," file. You can complement this configuration with your provider options. To get the basic options, for Sentry consult the "),c.I0R(20,"a",1),c.OEk(21,"documentation"),c.C$Y()(),c.I0R(22,"pre")(23,"code"),c.OEk(24),c.C$Y()()(),c.I0R(25,"section")(26,"h3"),c.OEk(27,"Identify user information with the event"),c.C$Y(),c.I0R(28,"p"),c.OEk(29," If you yant to identify the user with the monitoring event, you need to configure "),c.I0R(30,"code"),c.OEk(31,"identifyUser"),c.C$Y(),c.OEk(32," to true in the monitoring options. Then import the "),c.I0R(33,"code"),c.OEk(34,"provideAuthUserMonitoring"),c.C$Y(),c.OEk(35," to your main file. "),c.C$Y()(),c.I0R(36,"section")(37,"h3"),c.OEk(38,"Add Readable Stack Traces to Errors for your application"),c.C$Y(),c.I0R(39,"p"),c.OEk(40," Follow the instruction "),c.I0R(41,"a",2),c.OEk(42,"Sentry - Source Maps"),c.C$Y()()(),c.I0R(43,"section")(44,"h3"),c.OEk(45,"Initialize monitoring"),c.C$Y(),c.I0R(46,"p"),c.OEk(47," Then import the "),c.I0R(48,"code"),c.OEk(49,"provideMonitoring"),c.C$Y(),c.OEk(50," providers into your main file "),c.C$Y(),c.I0R(51,"pre"),c.wR5(52,"code",3),c.C$Y()(),c.I0R(53,"app-example-viewer",4)(54,"p",5),c.OEk(55," Trigger a test error somewhere in your Angular app, for example in your main app component. Once triggered, an error event should be sent on your Sentry application "),c.C$Y(),c.I0R(56,"button",6),c.qCj("click",function(){return se.throwTestError()}),c.OEk(57," Throw Test Error "),c.C$Y()()()),2&Ye&&(c.yG2(24),c.cNF(se.getBasicConfigExample()),c.yG2(28),c.E7m("innerHTML",se.exampleProviderCode,c.E3n))},dependencies:[p.u,e.I,E.oJ,E.Gw]})}return Ge})();const _e="bootstrapApplication(AppComponent, {\n  providers: [\n    ...provideMonitoring(environment.igo.monitoring),\n\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \n    ...provideAuthUserMonitoring(environment.igo.monitoring)\n  ]\n})\n";var de=r(33712);let le=(()=>{class Ge{http;languageService;constructor(Ie,Ye){this.http=Ie,this.languageService=Ye}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(Ye=>{console.log(Ye)})}callHttpError(){this.http.get("404").subscribe(Ye=>{console.log(Ye)})}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(de.KK),c.GI1(C.ov))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-request"]],standalone:!0,features:[c.UHJ],decls:21,vars:0,consts:[["title","Request","subtitle","Core"],["codeFolder","core/core"],[1,"actions-container"],["mat-raised-button","",3,"click"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Register http calls in console"),c.C$Y(),c.I0R(3,"li"),c.OEk(4," Import "),c.I0R(5,"code"),c.OEk(6,"IgoLoggingModule"),c.C$Y(),c.OEk(7," only if you want register HTTP calls in console "),c.C$Y(),c.I0R(8,"li"),c.OEk(9," Import "),c.I0R(10,"code"),c.OEk(11,"IgoErrorModule"),c.C$Y(),c.OEk(12," only if you want register errors from HTTP calls in console "),c.C$Y(),c.I0R(13,"li"),c.OEk(14,"Import modules only once"),c.C$Y(),c.I0R(15,"app-example-viewer",1)(16,"div",2)(17,"button",3),c.qCj("click",function(){return se.callHttp()}),c.OEk(18,"Log"),c.C$Y(),c.I0R(19,"button",3),c.qCj("click",function(){return se.callHttpError()}),c.OEk(20,"Error"),c.C$Y()()()())},dependencies:[p.u,e.I,E.oJ,E.Gw]})}return Ge})();var ue=r(46176),ne=r(50244),ve=r(77872),ye=r(43168);function Le(Ge,ct){if(1&Ge&&(c.I0R(0,"mat-option",6),c.OEk(1),c.C$Y()),2&Ge){const Ie=ct.$implicit;c.E7m("value",Ie.value),c.yG2(),c.oRS(" ",Ie.title," ")}}const Ve=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Activity",path:"activity",component:o},{title:"Config",path:"config",component:_},{title:"Language",path:"language",component:P},{title:"Media",path:"media",component:F},{title:"Message",path:"message",component:W},{title:"Monitoring",path:"monitoring",component:me},{title:"Request",path:"request",component:le},{title:"Themes",path:"theme",component:(()=>{class Ge{languageService;renderer;isDark;themes=[{value:"blue",title:"Blue"},{value:"bluedark",title:"Blue-dark"},{value:"bluedq",title:"Donn\xe9es Qu\xe9bec"},{value:"bluegrey",title:"Blue grey"},{value:"dark",title:"Dark"},{value:"deeppurple",title:"Purple"},{value:"indigo",title:"Indigo"},{value:"orange",title:"Orange"},{value:"teal",title:"Teal"}];constructor(Ie,Ye){this.languageService=Ie,this.renderer=Ye}loadTheme(Ie){if("dark-demo-test"===Ie.value)return this.isDark=!0,void this.renderer.addClass(document.body,"dark-theme");this.isDark&&this.renderer.removeClass(document.body,"dark-theme"),(0,ye.ym)(window.document,Ie.value+"-theme")}static \u0275fac=function(Ye){return new(Ye||Ge)(c.GI1(C.ov),c.GI1(c.q87))};static \u0275cmp=c.In1({type:Ge,selectors:[["app-theme"]],standalone:!0,features:[c.UHJ],decls:10,vars:1,consts:[["title","Theme","subtitle","Core"],["codeFolder","core/theme"],[1,"actions-container"],["placeholder","Select a theme",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","dark-demo-test"],[3,"value"]],template:function(Ye,se){1&Ye&&(c.I0R(0,"app-doc-viewer",0)(1,"p"),c.OEk(2,"Change the app theme"),c.C$Y(),c.I0R(3,"app-example-viewer",1)(4,"div",2)(5,"mat-form-field")(6,"mat-select",3),c.qCj("selectionChange",function(Re){return se.loadTheme(Re)}),c.yuY(7,Le,2,2,"mat-option",4),c.I0R(8,"mat-option",5),c.OEk(9," Dark theme "),c.C$Y()()()()()()),2&Ye&&(c.yG2(7),c.E7m("ngForOf",se.themes))},dependencies:[p.u,e.I,ne.wb,ne.Up,ve.d5,ve.kX,ue.I5,R.Iw,ue.Ax]})}return Ge})()}]},51256:(Pe,ae,r)=>{"use strict";r.r(ae),r.d(ae,{routes:()=>Ss});var E=r(87040),a=r(21800),w=r(62004),p=r(31492),e=r(32688),c=r(51100),o=r(34896);const R=()=>["ConfigService","LanguageService"];let L=(()=>{class q{layerService;catalogService;storageService;mapService;catalog;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};catalogStore=new E.qc([]);catalogItemStore=new E.qc([]);constructor(m,O,$,ie){this.layerService=m,this.catalogService=O,this.storageService=$,this.mapService=ie}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(m=>this.map.addLayer(m)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(m=>!0===m.state.selected).subscribe(m=>{m&&m.entity&&(this.catalog=m.entity)})}onCatalogSelectChange(m){this.loadCatalogItems(m.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(m=>{this.catalogStore.clear(),this.catalogStore.load(m.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(m){this.catalogService.loadCatalogItems(m).subscribe(O=>{this.catalogItemStore.clear(),this.catalogItemStore.load(O)})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.IZ6),o.GI1(p.oxI),o.GI1(w.yQ),o.GI1(p.u00))};static \u0275cmp=o.In1({type:q,selectors:[["app-catalog"]],standalone:!0,features:[o.UHJ],decls:9,vars:9,consts:[["title","Catalog","subtitle","Geo",3,"dependencies"],["codeFolder","geo/catalog"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5)(6,"igo-catalog-library",6),o.qCj("catalogSelectChange",function(Se){return $.onCatalogSelectChange(Se)}),o.C$Y()(),o.I0R(7,"igo-panel",7),o.wR5(8,"igo-catalog-browser",8),o.C$Y()()()),2&O&&(o.E7m("dependencies",o.q4q(8,R)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("store",$.catalogStore),o.yG2(2),o.E7m("catalog",$.catalog)("store",$.catalogItemStore)("map",$.map))},dependencies:[e.u,c.I,p.q2F,p.qcl,a.c,p.kvX,p.iOV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return q})();var _=r(52072),C=r(45928),S=r(61616),P=r(62747);const y=()=>["LanguageService"];let F=(()=>{class q{layerService;mapService;authService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9,geolocate:!1};stopsStore=new p.SYK([]);stopsFeatureStore=new p.czr([],{map:this.map});stepFeatureStore=new p.qM$([],{map:this.map});routesFeatureStore=new p.aWp([],{map:this.map});zoomToActiveRoute$=new S.E;authenticated$;constructor(m,O,$){this.layerService=m,this.mapService=O,this.authService=$,this.authenticated$=this.authService.authenticate$,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(ie=>this.map.addLayer(ie))}static \u0275fac=function(O){return new(O||q)(o.GI1(p.IZ6),o.GI1(p.u00),o.GI1(C.oj))};static \u0275cmp=o.In1({type:q,selectors:[["app-directions"]],standalone:!0,features:[o.M5G([(0,p.yh6)((0,p.wnB)())]),o.UHJ],decls:15,vars:15,consts:[["title","Directions","subtitle","Geo",3,"dependencies"],["codeFolder","geo/directions"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100",3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$","authenticated$"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile")(13,"div",10),o.wR5(14,"igo-directions",11),o.C$Y()()()()()),2&O&&(o.E7m("dependencies",o.q4q(14,y)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(3),o.E7m("stopsStore",$.stopsStore)("stopsFeatureStore",$.stopsFeatureStore)("stepFeatureStore",$.stepFeatureStore)("routesFeatureStore",$.routesFeatureStore)("zoomToActiveRoute$",$.zoomToActiveRoute$)("authenticated$",$.authenticated$))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.cdH,p.eqy,p.q2F,p.i6P,p.qcl,p.aw9,P.U,p.Oy$]})}return q})();const h=()=>["LanguageService"];let W=(()=>{class q{dataSourceService;layerService;mapService;map=new p.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};stores=[];constructor(m,O,$){this.dataSourceService=m,this.layerService=O,this.mapService=$,this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:ie,baseLayer:!0,visible:!0}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(p.u00))};static \u0275cmp=o.In1({type:q,selectors:[["app-draw"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Draw","subtitle","Geo",3,"dependencies"],["codeFolder","geo/draw"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"stores","map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-draw",5),o.C$Y()()),2&O&&(o.E7m("dependencies",o.q4q(6,h)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("stores",$.stores)("map",$.map))},dependencies:[p.q2F,p.qcl,p.Se2,e.u,c.I],styles:["[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return q})(),J=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]};store=new p.ym_([],{map:this.map});constructor(m,O){this.dataSourceService=m,this.layerService=O}ngOnInit(){const m=new p.E9g({});this.store.addStrategy(m);const O=new p.kj0({map:this.map,motion:p.Suj.Default});this.store.addStrategy(O),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:$}))}),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe($=>{const ie=this.layerService.createLayer({title:"Vector Layer",source:$,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(ie),this.store.bindLayer(ie),m.activate(),O.activate()})}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-feature"]],standalone:!0,features:[o.UHJ],decls:6,vars:5,consts:[["title","Feature","subtitle","Geo"],["codeFolder","geo/feature"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","template"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-entity-table",5),o.C$Y()()),2&O&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("template",$.tableTemplate))},dependencies:[e.u,c.I,p.q2F,p.qcl,E.Eh],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return q})();var T=r(65056),Q=r(71904),z=r(34672),Y=r(56520),N=r(54776),K=r(45212),j=r(88872),A=r(87544),d=r(54844);function u(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-form",7),o.qCj("submitForm",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onSubmit($))}),o.wVc(1,"async"),o.wR5(2,"igo-form-group",8),o.I0R(3,"div",9)(4,"button",10),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.fillForm())}),o.OEk(5," Fill Form "),o.C$Y(),o.I0R(6,"button",10),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(7," Clear Form "),o.C$Y(),o.I0R(8,"button",11),o.OEk(9," Submit "),o.C$Y()()()}if(2&q){const m=k.ngIf,O=o.GaO();o.E7m("form",m)("formData",o.kDX(1,4,O.data$)),o.yG2(2),o.E7m("group",m.groups[0]),o.yG2(6),o.E7m("disabled",O.submitDisabled)}}let x=(()=>{class q{formService;dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:15};form$=new d.g(void 0);data$=new d.g(void 0);submitDisabled=!0;valueChanges$$;constructor(m,O,$){this.formService=m,this.dataSourceService=O,this.layerService=$}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:ie,baseLayer:!0,visible:!0}))});const O=[{name:"geometry",title:"Geometry",options:{validator:Q.AQ.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new N.cp({stroke:new K.c({color:[255,0,0,1],width:2}),fill:new j.c({color:[255,0,0,.2]}),image:new A.c({radius:8,stroke:new K.c({color:[255,0,0,1]}),fill:new j.c({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:Q.AQ.required}}].map(ie=>this.formService.field(ie)),$=this.formService.form([],[this.formService.group({name:"info"},O)]);this.valueChanges$$=$.control.valueChanges.subscribe(()=>{this.submitDisabled=!$.control.valid}),this.form$.next($)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(m){alert(JSON.stringify(m))}static \u0275fac=function(O){return new(O||q)(o.GI1(Y.eO),o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-geometry"]],standalone:!0,features:[o.UHJ],decls:8,vars:6,consts:[["title","Geometry Form","subtitle","Geo"],["codeFolder","geo/geometry"],[1,"container"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"div",2)(3,"igo-map-browser",3)(4,"div",4),o.wR5(5,"igo-zoom-button",5),o.C$Y()(),o.yuY(6,u,10,6,"igo-form",6),o.wVc(7,"async"),o.C$Y()()()),2&O&&(o.yG2(3),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,4,$.form$)))},dependencies:[e.u,c.I,p.q2F,p.qcl,T.u_,Y.Yl,Y.O8,z.oJ,z.Gw,T.a],styles:["[_nghost-%COMP%]   pre[_ngcontent-%COMP%], [_nghost-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace,monospace}[_nghost-%COMP%]   pre[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{flex:1;height:500px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return q})();var U=r(56264),G=r(42860),X=r(34419),D=r(87159),I=r(9364),M=r(76332),s=r(75872);const H=()=>["LanguageService"];let Z=(()=>{class q{dataSourceService;layerService;mediaService;pointerCoordDelay=0;pointerHoverFeatureDelay=0;map=new p.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(m,O,$){this.dataSourceService=m,this.layerService=O,this.mediaService=$,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png"}}).subscribe(Se=>this.map.addLayer(Se)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"Casernes",visible:!0,source:Se,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\nMun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},radius:15}}}}}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(U.QB))};static \u0275cmp=o.In1({type:q,selectors:[["app-hover"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Hover","subtitle","Geo",3,"dependencies"],["codeFolder","geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"div",4)(5,"igo-rotation-button",5),o.C$Y(),o.I0R(6,"div",6),o.wR5(7,"igo-home-extent-button",7)(8,"igo-geolocate-button",7)(9,"igo-zoom-button",8),o.C$Y()()()()),2&O&&(o.E7m("dependencies",o.q4q(10,H)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("igoHoverFeatureDelay",$.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map))},dependencies:[e.u,c.I,p.SET,G.c,X.e,D.C,I.q,M.i,s.q],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return q})();var me=r(62154);const _e=()=>["LanguageService"];let de=(()=>{class q{layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9};store=new me.cr([]);constructor(m){this.layerService=m,this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(O=>this.map.addLayer(O))}static \u0275fac=function(O){return new(O||q)(o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-import-export"]],standalone:!0,features:[o.UHJ],decls:10,vars:7,consts:[["title","Import / Export","subtitle","Geo",3,"dependencies"],["codeFolder","geo/import-export"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],[1,"w-100",3,"store","map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6),o.wR5(9,"igo-import-export",7),o.C$Y()()()()()),2&O&&(o.E7m("dependencies",o.q4q(6,_e)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(3),o.E7m("store",$.store)("map",$.map))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.q2F,p.qcl,p.OrO]})}return q})();function le(q,k){if(1&q&&o.wR5(0,"igo-metadata-button",10)(1,"igo-download-button",10)(2,"igo-ogc-filter-button",11)(3,"igo-time-filter-button",11)(4,"igo-track-feature-button",12),2&q){const m=k.layer;o.E7m("layer",m),o.yG2(),o.E7m("layer",m),o.yG2(),o.E7m("header",!0)("layer",m),o.yG2(),o.E7m("header",!0)("layer",m),o.yG2(),o.E7m("layer",m)("trackFeature",!0)}}const ue=()=>["LanguageService"];let ne=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7};constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:Se}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:Se,removable:!1}))}),this.layerService.createAsyncLayer({title:"Parcs routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Direction du vent",visible:!1,legendOptions:{stylesAvailable:[{name:"WDIR6-LINEAR",title:"WDIR6-LINEAR"},{name:"WDIR6",title:"WDIR6"},{name:"WDIR3-LINEAR",title:"WDIR3-LINEAR"},{name:"WDIR3",title:"WDIR3"}]},sourceOptions:{type:"wms",url:"https://geo.weather.gc.ca/geomet?lang=fr",params:{LAYERS:"HRDPS.CONTINENTAL_WD",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"District \xe9cologique",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Avertissements routiers",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:Se,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-layer"]],standalone:!0,features:[o.UHJ],decls:13,vars:10,consts:[["title","Layer","subtitle","Geo",3,"dependencies"],["codeFolder","geo/layer"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"map","layers","expandLegendOfVisibleLayers","queryBadge","excludeBaseLayers"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-layer-list",8),o.yuY(11,le,5,8,"ng-template",null,9,o.gJz),o.C$Y()()()()()()()),2&O&&(o.E7m("dependencies",o.q4q(9,ue)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0)("excludeBaseLayers",!0))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.q2F,p.qcl,a.c,p.m2U,p.ktW,p.Idw,p.YdQ,p.eM$,p.Ga$]})}return q})();const ve=()=>["LanguageService"];let ye=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:ie}))}),this.layerService.createAsyncLayer({title:"Legend with display: false",legendOptions:{display:!1},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"Legend with html param",legendOptions:{html:'<h2 style="background-color: blue;">HTML legend</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"Legend with url param",legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"Commissions scolaires anglophones",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.layerService.createAsyncLayer({title:"Avertissements routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(ie=>this.map.addLayer(ie)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:ie,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-legend"]],standalone:!0,features:[o.UHJ],decls:7,vars:10,consts:[["title","Simple Map with a legend list","subtitle","Geo",3,"dependencies"],["codeFolder","geo/legend"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.wR5(6,"igo-layer-legend-list",6),o.C$Y()()()),2&O&&(o.E7m("dependencies",o.q4q(9,ve)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("layers",$.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[e.u,c.I,p.q2F,p.qcl,a.c,p.wSE],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return q})();const Le=()=>["LanguageService"];let He=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};store=new p.ym_([],{map:this.map});constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-measure"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Measure","subtitle","Geo",3,"dependencies"],["codeFolder","geo/measure"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-measurer",5),o.C$Y()()),2&O&&(o.E7m("dependencies",o.q4q(6,Le)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("map",$.map))},dependencies:[e.u,c.I,p.q2F,p.qcl,p.yaV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]})}return q})();const Ve=()=>["LanguageService"];let Ge=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:Rt,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (PropertyIsEqualTo OR Intersects polygon)",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P2D)",id:"1",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: PT4H)",id:"2",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1M)",id:"3",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1Y)",id:"4",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Interval from Now, Step: P1D)",id:"5",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"white"}),stroke:new K.c({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, RestrictToStep, Step: P1M)",id:"6",source:Rt,style:new N.cp({image:new A.c({radius:5,fill:new j.c({color:"black"}),stroke:new K.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"vg_observation_v_autre_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.w35.Time}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01 00:00:00",end:"2020-01-01 00:00:00"},allowedOperatorsType:p.w35.Time}}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Inondations (During)",source:Rt}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:p.w35.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(Rt=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:Rt}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-ogc-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:7,consts:[["title","Ogc filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/ogc-filter"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],["title","Layers"],[3,"map","layers"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-ogc-filterable-list",8),o.C$Y()()()()()()),2&O&&(o.E7m("dependencies",o.q4q(6,Ve)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.q2F,p.qcl,a.c,p.isy]})}return q})(),ct=(()=>{class q{dataSourceService;layerService;map=new p.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(m,O){this.dataSourceService=m,this.layerService=O}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:m,baseLayer:!0,visible:!0}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:p.YfI,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:p.YfI,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:p.YfI,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],p.Suj.None)}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-overlay"]],standalone:!0,features:[o.UHJ],decls:5,vars:3,consts:[["title","Overlay","subtitle","Geo"],["codeFolder","geo/overlay"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()()()()),2&O&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map))},dependencies:[e.u,c.I,p.q2F,p.qcl],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return q})();const Ie=()=>["LanguageService"];let Ye=(()=>{class q{layerService;map=new p.yGW({controls:{attribution:{collapsed:!1}}});view={center:[-73,47.2],zoom:9};constructor(m){this.layerService=m,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(O=>this.map.addLayer(O)),this.layerService.createAsyncLayer({title:"Emb\xe2cles",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(O=>this.map.addLayer(O)),this.layerService.createAsyncLayer({title:"Radar m\xe9t\xe9o",sourceOptions:{type:"wms",url:"https://geo.meteo.gc.ca/geomet?lang=fr",params:{LAYERS:"RADAR_1KM_RRAI",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(O=>this.map.addLayer(O)),this.layerService.createAsyncLayer({title:"A\xe9roports",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq?",params:{layers:"aeroport",version:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(O=>this.map.addLayer(O))}static \u0275fac=function(O){return new(O||q)(o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-print"]],standalone:!0,features:[o.UHJ],decls:14,vars:10,consts:[["title","Print","subtitle","Geo",3,"dependencies"],["codeFolder","geo/print"],["cols","2","rowHeight","800px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[3,"map"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile"),o.wR5(13,"igo-print",10),o.C$Y()()()()),2&O&&(o.E7m("dependencies",o.q4q(9,Ie)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.cdH,p.eqy,p.q2F,p.i6P,p.qcl,p.eAF],styles:["[_nghost-%COMP%]   igo-print[_ngcontent-%COMP%]{overflow-y:auto;width:100%;height:100%}"]})}return q})();var se=r(58264),ge=r(62808),Re=r(80848),Ue=r(36752),ze=r(61252),Be=r(87048);function st(q,k){if(1&q&&(o.I0R(0,"div")(1,"h1"),o.OEk(2," Query Title : "),o.I0R(3,"span",8),o.OEk(4),o.C$Y()(),o.wR5(5,"igo-feature-details",9),o.C$Y()),2&q){const m=k.$implicit,O=o.GaO(2);o.yG2(4),o.cNF(O.getTitle(m)),o.yG2(),o.E7m("feature",m)}}function xe(q,k){if(1&q&&(o.SAx(0),o.yuY(1,st,6,2,"div",7),o.k70()),2&q){const m=k.ngIf;o.yG2(),o.E7m("ngForOf",m)}}const Ke=()=>[];let Qe=(()=>{class q{dataSourceService;layerService;features$=new d.g([]);map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:$}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:p.s5H.HTMLGML2,queryHtmlTarget:p.IlJ.IFRAME,params:{layers:"aeroport",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:$}))}),this.layerService.createAsyncLayer({title:"WMS with different query url",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryFormat:p.s5H.HTMLGML2,queryHtmlTarget:p.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1,params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe($=>this.map.addLayer($)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"Vector layer",source:$})),this.addFeatures($)}),this.layerService.createAsyncLayer({title:"Vector tile with different query url",sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryFormat:p.s5H.HTMLGML2,queryHtmlTarget:p.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe($=>this.map.addLayer($))}addFeatures(m){const O=new se.c({name:"feature1",geometry:new ge.c([ze.AF([-72,47.8],"EPSG:4326","EPSG:3857"),ze.AF([-73.5,47.4],"EPSG:4326","EPSG:3857"),ze.AF([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),$=new se.c({name:"feature2",geometry:new Re.c(ze.AF([-73,46.6],"EPSG:4326","EPSG:3857"))}),ie=new se.c({name:"feature3",geometry:new Ue.cp([[ze.AF([-71,46.8],"EPSG:4326","EPSG:3857"),ze.AF([-73,47],"EPSG:4326","EPSG:3857"),ze.AF([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});m.ol.addFeatures([O,$,ie])}handleQueryResults(m){const O=m.features;O.length&&O[0]&&(this.features$.next(O),this.map.queryResultsOverlay.setFeatures(O,p.Suj.None))}getTitle(m){return(0,E.YB)(m)}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-query"]],standalone:!0,features:[o.UHJ],decls:8,vars:9,consts:[["title","Query","subtitle","Geo",3,"dependencies"],["codeFolder","geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("query",function(Se){return $.handleQueryResults(Se)}),o.I0R(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.yuY(6,xe,2,1,"ng-container",6),o.wVc(7,"async"),o.C$Y()()()),2&O&&(o.E7m("dependencies",o.q4q(8,Ke)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("ngIf",o.kDX(7,6,$.features$)))},dependencies:[e.u,c.I,p.q2F,p.qcl,p.Iz2,p.G_h,Be.s,a.c,T.u_,T.Iw,p.wP$,T.a],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return q})();var It=r(17284),at=r(21124),Ft=r(33712),Et=r(32328),Kt=r(87848),yt=r(27e3),Oo=r(53476),ei=r(67032),Pt=r(68848),xt=r(45872),ut=r(20460),Go=r(1296),Ze=r(72584);function Io(q,k){if(1&q){const m=o.KQA();o.I0R(0,"button",7),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.openGuide())}),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.I0R(5,"mat-icon"),o.OEk(6,"description"),o.C$Y()()}if(2&q){const m=o.GaO();o.E7m("disabled",m.loading)("matTooltip",o.kDX(1,3,"igo.integration.aboutTool.trainingGuideTooltip")),o.yG2(3),o.cNF(o.kDX(4,5,"igo.integration.aboutTool.trainingGuide"))}}function Xt(q,k){if(1&q&&(o.I0R(0,"button",8),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.I0R(5,"mat-icon"),o.OEk(6,"description"),o.C$Y()()),2&q){const m=o.GaO(),O=o.Gew(5);o.E7m("disabled",m.loading)("matTooltip",o.kDX(1,4,"igo.integration.aboutTool.trainingGuideTooltip"))("matMenuTriggerFor",O),o.yG2(3),o.cNF(o.kDX(4,6,"igo.integration.aboutTool.trainingGuide"))}}function eo(q,k){if(1&q){const m=o.KQA();o.I0R(0,"button",9),o.qCj("click",function(){const ie=o.usT(m).$implicit,Se=o.GaO();return o.CGJ(Se.openGuide(ie))}),o.OEk(1),o.C$Y()}if(2&q){const m=k.$implicit,O=o.GaO();o.yG2(),o.oRS(" ",O.formatFileName(m)," ")}}function $o(q,k){if(1&q&&(o.wR5(0,"igo-custom-html",6),o.wVc(1,"translate")),2&q){const m=o.GaO();o.E7m("html",o.kDX(1,1,m.headerHtml))}}const Ao=q=>({version:q});let No=class ua{configService;auth;http;cdRef;languageService;configOptions;get headerHtml(){return this._headerHtml}set headerHtml(k){this._headerHtml=Array.isArray(k)?k.join("\n"):k}get html(){return this._html}set html(k){this._html=Array.isArray(k)?k.join("\n"):k}_discoverTitleInLocale="IGO";discoverTitleInLocale$=(0,Go.of)(this._discoverTitleInLocale);get discoverTitleInLocale(){return this._discoverTitleInLocale}set discoverTitleInLocale(k){this._discoverTitleInLocale=k,this.discoverTitleInLocale$=(0,Go.of)(k)}trainingGuideURLs;effectiveVersion;_html="igo.integration.aboutTool.html";_headerHtml;baseUrlProfil;baseUrlGuide;loading=!1;constructor(k,m,O,$,ie){this.configService=k,this.auth=m,this.http=O,this.cdRef=$,this.languageService=ie,this.headerHtml=this.languageService.translate.instant("igo.integration.aboutTool.headerHtml"),this.configOptions=this.configService.getConfigs();const Se=this.configOptions.version;this.effectiveVersion=Se?.app||Se?.lib||xt.WU.lib,this.baseUrlProfil=this.configOptions.storage?.url,this.baseUrlGuide=this.configOptions.depot?.url+this.configOptions.depot?.guideUrl}ngOnInit(){this.auth.authenticated&&this.configOptions.context?.url?this.http.get(this.baseUrlProfil).subscribe(k=>{this.trainingGuideURLs=k.guides,this.cdRef.detectChanges()}):this.auth.authenticated&&!this.configOptions.context?.url&&this.configOptions.depot?.trainingGuides&&(this.trainingGuideURLs=this.configOptions.depot?.trainingGuides)}openGuide(k){this.loading=!0;const m=k?this.baseUrlGuide+k+"?":this.baseUrlGuide+this.trainingGuideURLs[0]+"?";this.http.get(m,{responseType:"blob"}).subscribe(()=>{this.loading=!1,window.open(m,"_blank"),this.cdRef.detectChanges()})}formatFileName(k){const m=(k=k.split("_").join(" ")).indexOf(".");return k.slice(0,m)}static \u0275fac=function(m){return new(m||ua)(o.GI1(xt.aW),o.GI1(C.oj),o.GI1(Ft.KK),o.GI1(o.kD9),o.GI1(ut.ov))};static \u0275cmp=o.In1({type:ua,selectors:[["igo-about-tool"]],inputs:{headerHtml:"headerHtml",html:"html",discoverTitleInLocale:"discoverTitleInLocale",trainingGuideURLs:"trainingGuideURLs"},standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["mat-raised-button","","tourToStart","global","menuIsOpen","true","styleButton","raised",3,"discoverTitleInLocale$"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","click"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(m,O){1&m&&(o.wR5(0,"p")(1,"igo-interactive-tour",0),o.yuY(2,Io,7,7,"button",1)(3,Xt,7,8,"button",2),o.I0R(4,"mat-menu",null,3),o.yuY(6,eo,2,1,"button",4),o.C$Y(),o.yuY(7,$o,2,3,"igo-custom-html",5),o.wR5(8,"igo-custom-html",6),o.wVc(9,"translate")),2&m&&(o.yG2(),o.E7m("discoverTitleInLocale$",O.discoverTitleInLocale$),o.yG2(),o.E7m("ngIf",O.auth.authenticated&&O.trainingGuideURLs&&1===O.trainingGuideURLs.length),o.yG2(),o.E7m("ngIf",O.auth.authenticated&&O.trainingGuideURLs&&O.trainingGuideURLs.length>1),o.yG2(3),o.E7m("ngForOf",O.trainingGuideURLs),o.yG2(),o.E7m("ngIf",""!==O.headerHtml),o.yG2(),o.E7m("html",o.g7$(9,6,O.html,o.S45(9,Ao,O.effectiveVersion))))},dependencies:[ei.Er,T.u_,z.oJ,z.Gw,yt.KO,yt.a4,Et.oB,Et.qL,Kt._A,Kt.aM,Kt.OQ,Kt.yG,T.Iw,Oo.YM,ut._s,Ze.sD],styles:["igo-interactive-tour[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:20px}.training-guide-button[_ngcontent-%COMP%]{margin-left:5px;background-color:#1976d2;color:#fff;padding:0 12px}"]})};No=(0,at.UN)([(0,Pt.aA)({name:"about",title:"igo.integration.tools.about",icon:"help"}),(0,at.YR)("design:paramtypes",[xt.aW,C.oj,Ft.KK,o.kD9,ut.ov])],No);var no=r(35876),ro=r(37496);let pt=(()=>{class q{mapService;projectionService;storageService;configService;get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(m){this._legendToolShowAll=m}_legendToolShowAll;get map(){return this._map}_map;constructor(m,O,$,ie){this.mapService=m,this.projectionService=O,this.storageService=$,this.configService=ie,this._map=new p.yGW({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}static \u0275fac=function(O){return new(O||q)(o.CoB(p.u00),o.CoB(p.qME),o.CoB(w.yQ),o.CoB(xt.aW))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),wo=(()=>{class q{get catalogStore(){return this._catalogStore}_catalogStore;catalogItemsStores=new Map;constructor(m){this._catalogStore=new E.qc([]),m.authenticate$.subscribe(()=>{this.clearCatalogItemsStores()})}getCatalogItemsStore(m){return this.catalogItemsStores.get(m.id)}setCatalogItemsStore(m,O){this.catalogItemsStores.set(m.id,O)}clearCatalogItemsStores(){this.catalogItemsStores.clear()}static \u0275fac=function(O){return new(O||q)(o.CoB(C.oj))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})();function ti(q,k){if(1&q&&o.wR5(0,"igo-catalog-browser",1),2&q){const m=k.ngIf,O=o.GaO();o.E7m("catalog",O.catalog)("store",m)("map",O.map)("toggleCollapsedGroup",O.toggleCollapsedGroup)}}let Ho=class da{catalogService;catalogState;mapState;authService;catalog;store$=new d.g(void 0);catalog$$;toggleCollapsedGroup=!0;get map(){return this.mapState.map}constructor(k,m,O,$){this.catalogService=k,this.catalogState=m,this.mapState=O,this.authService=$}ngOnInit(){const m=this.catalogState.catalogStore.stateView.firstBy$($=>!0===$.state.selected);this.catalog$$=(0,no.E)([m,this.authService.authenticate$]).subscribe(([$,ie])=>{this.catalog=$.entity,this.loadCatalogItems(this.catalog)})}ngOnDestroy(){this.catalog$$.unsubscribe()}loadCatalogItems(k){let m=this.catalogState.getCatalogItemsStore(k);void 0===m?(m=new E.qc([]),this.catalogState.setCatalogItemsStore(k,m),this.catalogService.loadCatalogItems(k).pipe((0,ro.U)(1)).subscribe(O=>{m.load(O),this.store$.next(m)})):this.store$.next(m)}static \u0275fac=function(m){return new(m||da)(o.GI1(p.oxI),o.GI1(wo),o.GI1(pt),o.GI1(C.oj))};static \u0275cmp=o.In1({type:da,selectors:[["igo-catalog-browser-tool"]],inputs:{toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[[3,"catalog","store","map","toggleCollapsedGroup",4,"ngIf"],[3,"catalog","store","map","toggleCollapsedGroup"]],template:function(m,O){1&m&&(o.yuY(0,ti,1,4,"igo-catalog-browser",0),o.wVc(1,"async")),2&m&&o.E7m("ngIf",o.kDX(1,1,O.store$))},dependencies:[T.u_,p.iOV,T.a],encapsulation:2,changeDetection:0})};Ho=(0,at.UN)([(0,Pt.aA)({name:"catalogBrowser",title:"igo.integration.tools.catalog",parent:"catalog"}),(0,at.YR)("design:paramtypes",[p.oxI,wo,pt,C.oj])],Ho);var To=r(80716),Eo=function(q){return q.layer="layer",q.context="context",q}(Eo||{}),so=function(q){return q.import="import",q.export="export",q}(so||{});let to=(()=>{class q{importExportType$=new d.g(Eo.layer);selectedMode$=new d.g(so.import);exportOptions$=new d.g(void 0);setImportExportType(m){this.importExportType$.next(m)}setMode(m){this.selectedMode$.next(m)}setsExportOptions(m){this.exportOptions$.next(m)}static \u0275fac=function(O){return new(O||q)};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Mt=(()=>{class q{toolService;importExportState;get toolbox(){return this.toolService.toolbox}openSidenav$=new d.g(void 0);constructor(m,O){this.toolService=m,this.importExportState=O}toolToActivateFromOptions(m){if(m){if("importExport"===m.tool){let O=this.importExportState.exportOptions$.value;O?(O.layers=m.options.layers,O.featureInMapExtent=m.options.featureInMapExtent):O={layers:m.options.layers,featureInMapExtent:m.options.featureInMapExtent},this.importExportState.setsExportOptions(O),this.importExportState.setMode(so.export)}this.toolbox.getTool(m.tool)&&(this.toolbox.activateTool(m.tool),this.openSidenav$.next(!0))}}static \u0275fac=function(O){return new(O||q)(o.CoB(Pt.IF),o.CoB(to))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),_o=class pa{catalogService;catalogState;toolState;storageService;get store(){return this.catalogState.catalogStore}addCatalogAllowed=!1;predefinedCatalogs=[];set selectedCatalogId(k){this.storageService.set("selectedCatalogId",k,w.Ab.SESSION)}get currentTool(){return this.toolState.toolbox.getCurrentPreviousToolName()[1]}get lastTool(){return this.toolState.toolbox.getCurrentPreviousToolName()[0]}constructor(k,m,O,$){this.catalogService=k,this.catalogState=m,this.toolState=O,this.storageService=$}ngOnInit(){"catalogBrowser"===this.lastTool&&"catalog"===this.currentTool&&(this.selectedCatalogId=null),0===this.store.count&&this.loadCatalogs()}onCatalogSelectChange(k){!1!==k.selected&&this.toolState.toolbox.activateTool("catalogBrowser")}loadCatalogs(){this.catalogService.loadCatalogs().pipe((0,ro.U)(1)).subscribe(k=>{this.store.clear(),this.store.load(k.concat(this.storageService.get("addedCatalogs")||[]))})}static \u0275fac=function(m){return new(m||pa)(o.GI1(p.oxI),o.GI1(wo),o.GI1(Mt),o.GI1(w.yQ))};static \u0275cmp=o.In1({type:pa,selectors:[["igo-catalog-library-tool"]],inputs:{addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"predefinedCatalogs","addCatalogAllowed","store","catalogSelectChange"]],template:function(m,O){1&m&&(o.I0R(0,"igo-catalog-library",0),o.qCj("catalogSelectChange",function(ie){return O.onCatalogSelectChange(ie)}),o.C$Y()),2&m&&o.E7m("predefinedCatalogs",O.predefinedCatalogs)("addCatalogAllowed",O.addCatalogAllowed)("store",O.store)},dependencies:[p.kvX],encapsulation:2,changeDetection:0})};_o=(0,at.UN)([(0,Pt.aA)({name:"catalog",title:"igo.integration.tools.catalog",icon:To.er}),(0,at.YR)("design:paramtypes",[p.oxI,wo,Mt,w.yQ])],_o);var Jt=r(29904);let Uo=class ma{toolState;constructor(k){this.toolState=k}submitSuccessed(){this.toolState.toolbox.activatePreviousTool()}static \u0275fac=function(m){return new(m||ma)(o.GI1(Mt))};static \u0275cmp=o.In1({type:ma,selectors:[["igo-context-editor-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextEditBinding","",3,"submitSuccessed"]],template:function(m,O){1&m&&(o.I0R(0,"igo-context-edit",0),o.qCj("submitSuccessed",function(){return O.submitSuccessed()}),o.C$Y())},dependencies:[Jt.cl,Jt.SS],encapsulation:2})};Uo=(0,at.UN)([(0,Pt.aA)({name:"contextEditor",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"}),(0,at.YR)("design:paramtypes",[Mt])],Uo);let xo=class ga{toolState;mapState;toolToOpenOnContextChange="mapTools";get map(){return this.mapState.map}constructor(k,m){this.toolState=k,this.mapState=m}editContext(){this.toolState.toolbox.activateTool("contextEditor")}managePermissions(){this.toolState.toolbox.activateTool("contextPermissionManager")}static \u0275fac=function(m){return new(m||ga)(o.GI1(Mt),o.GI1(pt))};static \u0275cmp=o.In1({type:ga,selectors:[["igo-context-manager-tool"]],inputs:{toolToOpenOnContextChange:"toolToOpenOnContextChange"},standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[["igoContextListBinding","",3,"map","edit","managePermissions"]],template:function(m,O){1&m&&(o.I0R(0,"igo-context-list",0),o.qCj("edit",function(){return O.editContext()})("managePermissions",function(){return O.managePermissions()}),o.C$Y()),2&m&&o.E7m("map",O.map)},dependencies:[Jt.W2,Jt.AX],encapsulation:2})};xo=(0,at.UN)([(0,Pt.aA)({name:"contextManager",title:"igo.integration.tools.contexts",icon:"star"}),(0,at.YR)("design:paramtypes",[Mt,pt])],xo);let Yo=class ha{static \u0275fac=function(m){return new(m||ha)};static \u0275cmp=o.In1({type:ha,selectors:[["igo-context-permission-manager-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextPermissionsBinding",""]],template:function(m,O){1&m&&o.wR5(0,"igo-context-permissions",0)},dependencies:[Jt.KS,Jt.Sm],encapsulation:2})};Yo=(0,at.UN)([(0,Pt.aA)({name:"contextPermissionManager",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"})],Yo);let Yt=(()=>{class q{keyword$=new d.g("");sortAlpha$=new d.g(void 0);onlyVisible$=new d.g(void 0);selectedTab$=new d.g(void 0);setKeyword(m){this.keyword$.next(m)}setSortAlpha(m){this.sortAlpha$.next(m)}setOnlyVisible(m){this.onlyVisible$.next(m)}setSelectedTab(m){this.selectedTab$.next(m)}getLayerListControls(){return{keyword:this.keyword$.value,onlyVisible:this.onlyVisible$.value,sortAlpha:this.sortAlpha$.value}}static \u0275fac=function(O){return new(O||q)};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Mo=class fa{mapState;layerListToolState;get map(){return this.mapState.map}get layerListControls(){return this.layerListToolState.getLayerListControls()}constructor(k,m){this.mapState=k,this.layerListToolState=m}static \u0275fac=function(m){return new(m||fa)(o.GI1(pt),o.GI1(Yt))};static \u0275cmp=o.In1({type:fa,selectors:[["igo-context-share-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(m,O){1&m&&o.wR5(0,"igo-share-map",0),2&m&&o.E7m("map",O.map)},dependencies:[Jt.mE],encapsulation:2})};Mo=(0,at.UN)([(0,Pt.aA)({name:"shareMap",title:"igo.integration.tools.shareMap",icon:"share"}),(0,at.YR)("design:paramtypes",[pt,Yt])],Mo);var qe=r(64100);let be=(()=>{class q{contextService;toolService;toolState;languageService;context$=new d.g(void 0);constructor(m,O,$,ie){this.contextService=m,this.toolService=O,this.toolState=$,this.languageService=ie,this.contextService.context$.subscribe(Se=>{this.onContextChange(Se)}),this.contextService.toolsChanged$.subscribe(Se=>{this.updateTools(Se)})}setContext(m){this.updateTools(m),this.context$.next(m)}updateTools(m){const O=this.toolState.toolbox,$=[];(m.tools||[]).forEach(Se=>{const Ne=this.toolService.getTool(Se.name);if(void 0===Ne)return;const it=Object.assign({},Ne.options||{},Se.options||{}),mt=Object.assign({},Ne,Se,{options:it});$.push(mt)}),$.forEach(Se=>{if(Se.parent){const Ne=$.findIndex(it=>it.name===Se.parent);-1!==Ne&&($[Ne].children=[],$[Ne].children.push(Se.name))}}),O.setTools($),O.setToolbar(m.toolbar||[]),this.contextService.setTools([].concat($)),this.contextService.setToolbar(m.toolbar||[])}onContextChange(m){void 0!==m&&this.setContext(m)}static \u0275fac=function(O){return new(O||q)(o.CoB(Jt.M9),o.CoB(Pt.IF),o.CoB(Mt),o.CoB(ut.ov))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),De=(()=>{class q{mapState;zoomToActiveRoute$=new S.E;stopsStore=new p.SYK([]);stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounceTime=200;constructor(m){this.mapState=m,this.stopsFeatureStore=new p.czr([],{map:this.mapState.map}),this.routesFeatureStore=new p.aWp([],{map:this.mapState.map}),this.stepFeatureStore=new p.qM$([],{map:this.mapState.map}),this.mapState.map.ol.once("rendercomplete",()=>{this.stopsFeatureStore.empty$.subscribe(O=>{this.stopsFeatureStore.layer?.options&&(this.stopsFeatureStore.layer.options.showInLayerList=!O)}),this.routesFeatureStore.empty$.subscribe(O=>{this.routesFeatureStore.layer?.options&&(this.routesFeatureStore.layer.options.showInLayerList=!O)})}),this.mapState.map.layers$.subscribe(()=>{this.mapState.map.getLayerById("igo-direction-stops-layer")||(this.stopsStore.deleteMany(this.stopsStore.all()),this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all())),this.mapState.map.getLayerById("igo-direction-route-layer")||this.routesFeatureStore.deleteMany(this.routesFeatureStore.all())})}static \u0275fac=function(O){return new(O||q)(o.CoB(pt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),$e=class ya{directionState;mapState;languageService;messageService;storageService;contextState;authService;currentContextUri;get stopsStore(){return this.directionState.stopsStore}get debounceTime(){return this.directionState.debounceTime}get stopsFeatureStore(){return this.directionState.stopsFeatureStore}get routesFeatureStore(){return this.directionState.routesFeatureStore}get stepFeatureStore(){return this.directionState.stepFeatureStore}get zoomToActiveRoute$(){return this.directionState.zoomToActiveRoute$}get authenticated$(){return this.authService.authenticate$}get map(){return this.mapState.map}constructor(k,m,O,$,ie,Se,Ne){this.directionState=k,this.mapState=m,this.languageService=O,this.messageService=$,this.storageService=ie,this.contextState=Se,this.authService=Ne}ngOnInit(){this.storageService.get("direction.warning.shown")||(this.messageService.info("igo.integration.directions.warning.message","igo.integration.directions.warning.title",{timeOut:2e4}),this.storageService.set("direction.warning.shown",!0,w.Ab.SESSION)),this.contextState.context$.subscribe(m=>{this.authService.authenticated||(this.currentContextUri=m.uri)})}static \u0275fac=function(m){return new(m||ya)(o.GI1(De),o.GI1(pt),o.GI1(ut.ov),o.GI1(qe.mi),o.GI1(w.yQ),o.GI1(be),o.GI1(C.oj))};static \u0275cmp=o.In1({type:ya,selectors:[["igo-directions-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:8,consts:[[3,"contextUri","debounce","stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$","authenticated$"]],template:function(m,O){1&m&&o.wR5(0,"igo-directions",0),2&m&&o.E7m("contextUri",O.currentContextUri)("debounce",O.debounceTime)("stopsStore",O.stopsStore)("stopsFeatureStore",O.stopsFeatureStore)("stepFeatureStore",O.stepFeatureStore)("routesFeatureStore",O.routesFeatureStore)("zoomToActiveRoute$",O.zoomToActiveRoute$)("authenticated$",O.authenticated$)},dependencies:[p.aw9,P.U],encapsulation:2})};$e=(0,at.UN)([(0,Pt.aA)({name:"directions",title:"igo.integration.tools.directions",icon:"directions"}),(0,at.YR)("design:paramtypes",[De,pt,ut.ov,qe.mi,w.yQ,be,C.oj])],$e);let Qt=(()=>{class q{mapState;stores=[];layersID=[];drawControls=[];activeDrawingLayer;constructor(m){this.mapState=m,this.mapState.map.layers$.subscribe(()=>{this.layersID.forEach(O=>{if(!this.mapState.map.getLayerById(O)){let $=this.stores.find(Se=>Se.layer.id===O);$.deleteMany($.all()),this.stores.splice(this.stores.indexOf($,0),1),this.layersID.splice(this.layersID.indexOf(O,0),1);let ie=this.drawControls.findIndex(Se=>Se[0]===O);this.drawControls.splice(ie,1)}})});for(let O of this.stores)O=new p.ym_([],{map:this.mapState.map})}static \u0275fac=function(O){return new(O||q)(o.CoB(pt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Do=class _a{drawState;mapState;get stores(){return this.drawState.stores}get map(){return this.mapState.map}get layersID(){return this.drawState.layersID}get drawControls(){return this.drawState.drawControls}set drawControls(k){this.drawState.drawControls=k}get activeDrawingLayer(){return this.drawState.activeDrawingLayer}set activeDrawingLayer(k){this.drawState.activeDrawingLayer=k}addLayersID(k){this.layersID.push(k)}addDrawControls(k){this.drawControls=k}constructor(k,m){this.drawState=k,this.mapState=m}static \u0275fac=function(m){return new(m||_a)(o.GI1(Qt),o.GI1(pt))};static \u0275cmp=o.In1({type:_a,selectors:[["igo-drawing-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"stores","map","activeDrawingLayer","drawControls","layersIDEvent","drawControlsEvent","activeLayerChange"]],template:function(m,O){1&m&&(o.I0R(0,"igo-draw",0),o.qCj("layersIDEvent",function(ie){return O.addLayersID(ie)})("drawControlsEvent",function(ie){return O.addDrawControls(ie)})("activeLayerChange",function(ie){return O.activeDrawingLayer=ie}),o.C$Y()),2&m&&o.E7m("stores",O.stores)("map",O.map)("activeDrawingLayer",O.activeDrawingLayer)("drawControls",O.drawControls)},dependencies:[p.Se2],encapsulation:2,changeDetection:0})};Do=(0,at.UN)([(0,Pt.aA)({name:"draw",title:"igo.integration.tools.draw",icon:"stylus_note"}),(0,at.YR)("design:paramtypes",[Qt,pt])],Do);var mo=r(53291);function en(q="300ms",k="ease-in-out"){return(0,mo.gV)("toolSlideInOut",[(0,mo.K2)("enter",(0,mo.wb)({transform:"translateX(100%)"})),(0,mo.aK)("void => enter",(0,mo.Cs)(q+" "+k))])}let gi=class Ca{mapState;get map(){return this.mapState.map}get layer(){for(const k of this.map.layers)if(!0===k.options.active)return k}animate="enter";constructor(k){this.mapState=k}static \u0275fac=function(m){return new(m||Ca)(o.GI1(pt))};static \u0275cmp=o.In1({type:Ca,selectors:[["igo-active-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(m,O){1&m&&o.wR5(0,"igo-ogc-filterable-item",0),2&m&&o.E7m("map",O.map)("layer",O.layer)("header",!1)("@toolSlideInOut",O.animate)},dependencies:[p.__k],encapsulation:2,data:{animation:[en()]}})};function tn(q="300ms",k="ease-in-out"){return(0,mo.gV)("toolSlideInOut",[(0,mo.K2)("enter",(0,mo.wb)({transform:"translateX(100%)"})),(0,mo.aK)("void => enter",(0,mo.Cs)(q+" "+k))])}gi=(0,at.UN)([(0,Pt.aA)({name:"activeOgcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter",parent:"mapTools"}),(0,at.YR)("design:paramtypes",[pt])],gi);let Oe=class va{mapState;get map(){return this.mapState.map}get layer(){for(const k of this.map.layers)if(!0===k.options.active)return k}animate="enter";constructor(k){this.mapState=k}static \u0275fac=function(m){return new(m||va)(o.GI1(pt))};static \u0275cmp=o.In1({type:va,selectors:[["igo-active-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"layer","header"]],template:function(m,O){1&m&&o.wR5(0,"igo-time-filter-item",0),2&m&&o.E7m("layer",O.layer)("header",!1)("@toolSlideInOut",O.animate)},dependencies:[p.gpx],encapsulation:2,data:{animation:[tn()]}})};Oe=(0,at.UN)([(0,Pt.aA)({name:"activeTimeFilter",title:"igo.integration.tools.timeFilter",icon:"history",parent:"mapTools"}),(0,at.YR)("design:paramtypes",[pt])],Oe);let ce=class Sa{constructor(){}static \u0275fac=function(m){return new(m||Sa)};static \u0275cmp=o.In1({type:Sa,selectors:[["igo-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoOgcFilterableListBinding",""]],template:function(m,O){1&m&&o.wR5(0,"igo-ogc-filterable-list",0)},dependencies:[p.isy,p.E9h],encapsulation:2})};ce=(0,at.UN)([(0,Pt.aA)({name:"ogcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter"}),(0,at.YR)("design:paramtypes",[])],ce);var te=r(12396),re=r(91088),he=r(44816),Me=r(94364),Xe=r(78600),Tt=(r(90784),r(53404));let vt=(()=>{class q{igoStorageService;get storageService(){return this.igoStorageService}constructor(m){this.igoStorageService=m}static \u0275fac=function(O){return new(O||q)(o.CoB(w.yQ))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})();var Co=r(864),hi=(r(32256),r(30816)),Gi=r.n(hi),go=r(40604);function $i(q,k){q.entityStore.getStrategyOfType(p.kj0).setMotion(k.get("zoomAuto")?p.Suj.Default:p.Suj.None)}function Ai(q,k,m,O,$,ie,Se,Ne,it,mt){const ht=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:$,handler:()=>{$i(q,Se),Se.set("zoomAuto",!Se.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:(0,p.wvY)(q),checkCondition:k,handler:()=>k.next(!k.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:m,handler:()=>m.next(!m.value)},{id:"clearselection",icon:"deselect",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:Ot=>{Ot.entityStore.state.updateMany(Ot.entityStore.view.all(),{selected:!1})},args:[q],availability:Ot=>(0,p.UfW)(Ot)},{id:"featureDownload",icon:"file_save",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:Ot=>{const Rt=Ot.entityStore.getStrategyOfType(E.qq),bo=Ot.entityStore.getStrategyOfType(E.xx).active?[Ot.layer.id]:[];mt.toolToActivateFromOptions({tool:"importExport",options:{layers:[Ot.layer.id],featureInMapExtent:Rt.active,layersWithSelection:bo}})},args:[q]},{id:"ogcFilter",icon:"filter_alt",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(Ot,Rt)=>{Rt.activateWidget(Ot,{map:Rt.map,layer:Rt.layer})},args:[O,q]},{id:"maximize",title:Ne.translate.instant("igo.integration.workspace.maximize"),tooltip:Ne.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>ie.pipe((0,go.k)(Ot=>!Ot&&!it.isMobile())),handler:()=>{it.isMobile()||ie.next(!0)}},{id:"standardExtent",title:Ne.translate.instant("igo.integration.workspace.standardExtent"),tooltip:Ne.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>ie.pipe((0,go.k)(Ot=>Ot&&!it.isMobile())),handler:()=>{ie.next(!1)}},{id:"print",icon:"print",title:"igo.integration.workspace.print.title",tooltip:"igo.integration.workspace.print.tooltip",handler:Ot=>{const Rt=`${Ot.layer.title} (${function ki(q,k){return Gi()(q).format(k)}(new Date,"YYYY-MM-DD-HH_mm")})`,co=new Co.default("landscape"),bo="{total_pages_count_string}";co.text(Rt,14,20),co.autoTable({startY:25,tableWidth:"wrap",html:"#currentWorkspaceTable",horizontalPageBreak:!0,styles:{cellPadding:.5,minCellWidth:20,fontSize:6},didDrawPage:ci=>{let Ko="Page "+co.internal.getNumberOfPages();"function"==typeof co.putTotalPages&&(Ko=Ko+" / "+bo),co.setFontSize(6);const Ti=co.internal.pageSize,hn=Ti.height?Ti.height:Ti.getHeight();co.text(Ko,ci.settings.margin.left,hn-10)}}),"function"==typeof co.putTotalPages&&co.putTotalPages(bo),co.save(`${Rt}.pdf`)},args:[q]}];let At=q.layer.dataSource.options.ogcFilters?.enabled?ht:ht.filter(Ot=>"ogcFilter"!==Ot.id);return At=!1!==q.layer.options.workspace.printable?ht:ht.filter(Ot=>"print"!==Ot.id),At}let On=(()=>{class q{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;zoomAuto$=new d.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,O,$,ie,Se){this.ogcFilterWidget=m,this.storageState=O,this.languageService=$,this.mediaService=ie,this.toolState=Se,this.maximize$=new d.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,O,$){const ie=this.buildActions(m,O,$);m.actionStore.load(ie)}buildActions(m,O,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Tt.O)(ie=>"zoomAuto"!==ie?.key||ie?.event===w.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),$i(m,this.storageService)}),Ai(m,O,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(O){return new(O||q)(o.CoB(p.Kwu,8),o.CoB(vt),o.CoB(ut.ov),o.CoB(U.QB),o.CoB(Mt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),In=(()=>{class q{storageState;languageService;toolState;mediaService;maximize$;zoomAuto$=new d.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,O,$,ie){this.storageState=m,this.languageService=O,this.toolState=$,this.mediaService=ie,this.maximize$=new d.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,O,$){const ie=this.buildActions(m,O,$);m.actionStore.load(ie)}buildActions(m,O,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Tt.O)(ie=>"zoomAuto"!==ie?.key||ie?.event===w.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),$i(m,this.storageService)}),Ai(m,O,$,void 0,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(O){return new(O||q)(o.CoB(vt),o.CoB(ut.ov),o.CoB(Mt),o.CoB(U.QB))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),wn=(()=>{class q{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;selectOnlyCheckCondition$=new d.g(!1);zoomAuto$=new d.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,O,$,ie,Se){this.ogcFilterWidget=m,this.storageState=O,this.languageService=$,this.mediaService=ie,this.toolState=Se,this.maximize$=new d.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,O,$){const ie=this.buildActions(m,O,$);m.actionStore.load(ie)}buildActions(m,O,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Tt.O)(ie=>"zoomAuto"!==ie?.key||ie?.event===w.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),$i(m,this.storageService)}),Ai(m,O,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(O){return new(O||q)(o.CoB(p.Kwu,8),o.CoB(vt),o.CoB(ut.ov),o.CoB(U.QB),o.CoB(Mt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),jo=(()=>{class q{featureActionsService;wfsActionsService;editionActionsService;storageService;workspacePanelExpanded=!1;workspaceEnabled$=new d.g(!1);rowsInMapExtentCheckCondition$=new d.g(!0);selectOnlyCheckCondition$=new d.g(!1);workspaceMaximize$;actionMaximize$$=[];rowsInMapExtentCheckCondition$$;selectOnlyCheckCondition$$;activeWorkspace$$;activeWorkspaceWidget$$;activeWorkspaceWidget$=new d.g(void 0);workspace$=new d.g(void 0);get store(){return this._store}_store;get workspaceSelection(){return this.workspace$.value?this.workspace$.value?.entityStore.stateView.manyBy(m=>!0===m.state.selected):[]}get workspaceSelection$(){return this.workspace$.value?this.workspace$.value?.entityStore?.stateView.manyBy$(m=>!0===m.state.selected):(0,Go.of)([])}constructor(m,O,$,ie){this.featureActionsService=m,this.wfsActionsService=O,this.editionActionsService=$,this.storageService=ie,this.workspaceMaximize$=new d.g(this.storageService.get("workspaceMaximize")),this.initWorkspaces()}initWorkspaces(){this._store=new me.cr([]),this._store.stateView.firstBy$(m=>!0===m.state.active).subscribe(m=>{this.workspace$.next(m?m.entity:void 0)}),this._store.stateView.all$().subscribe(m=>{m.map(O=>{O.entity.actionStore.empty&&(O.entity instanceof p.MrZ?this.wfsActionsService.loadActions(O.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):O.entity instanceof p.Wwb?this.featureActionsService.loadActions(O.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):O.entity instanceof p.gLH&&this.editionActionsService.loadActions(O.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.activeWorkspace$$=this.workspace$.subscribe(m=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==m&&(this.activeWorkspaceWidget$$=m.widget$.subscribe(O=>this.activeWorkspaceWidget$.next(O)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(m=>{this._store.stateView.all().map(O=>{if(!O.entity.actionStore.empty){const $=O.entity.entityStore.getStrategyOfType(E.qq);$&&(m?$.activate():$.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(m=>{this._store.stateView.all().map(O=>{if(!O.entity.actionStore.empty){const $=O.entity.entityStore.getStrategyOfType(E.xx);$&&(m?$.activate():$.deactivate())}})})}setWorkspaceIsMaximized(m){this.storageService.set("workspaceMaximize",m),this.workspaceMaximize$.next(m)}setActiveWorkspaceById(m){const O=this.store.all().find($=>$.id===m);O&&this.store.activateWorkspace(O)}setActiveWorkspaceByTitle(m){const O=this.store.all().find($=>$.title===m);O&&this.store.activateWorkspace(O)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(m=>m.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}static \u0275fac=function(O){return new(O||q)(o.CoB(In),o.CoB(wn),o.CoB(On),o.CoB(w.yQ))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})();function on(q,k){if(1&q&&(o.SAx(0),o.wR5(1,"igo-feature-details",3),o.k70()),2&q){const m=k.ngIf;o.yG2(),o.E7m("feature",m)}}let Bi=class ba{matIconRegistry;spatialFilterService;dataSourceService;layerService;mapState;messageService;languageService;importExportState;toolState;workspaceState;cdRef;get map(){return this.mapState.map}type;itemType=p.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new d.g(void 0);format=new te.c;store=new E.qc([]);spatialListStore=new E.qc([]);loading=!1;thematicLength=0;measureUnit=p.K88.Meters;unsubscribe$=new S.E;moveendKey;defaultStyle;constructor(k,m,O,$,ie,Se,Ne,it,mt,ht,At){this.matIconRegistry=k,this.spatialFilterService=m,this.dataSourceService=O,this.layerService=$,this.mapState=ie,this.messageService=Se,this.languageService=Ne,this.importExportState=it,this.toolState=mt,this.workspaceState=ht,this.cdRef=At}ngOnInit(){for(const k of this.map.layers)k.title&&k.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(k)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(k){this.type=k,this.queryType=void 0}getOutputQueryType(k){this.queryType=k,this.queryType&&this.loadFilterList()}activateExportTool(){const k=[],m=new RegExp("^Zone \\d+");for(const O of this.layers)O.title.match(m)||k.push(O.id);this.importExportState.setMode(so.export),this.importExportState.setsExportOptions({layers:k}),this.toolState.toolbox.activateTool("importExport")}activateWorkspace(k){let m;this.workspaceState.store.entities$.pipe((0,Me.a)(this.unsubscribe$)).subscribe(()=>{if(!k&&this.activeLayers.length&&this.workspaceState.store.all().length>1){if(this.itemType===p.c97.Thematics){for(const O of this.thematics)if(!O.zeroResults){m=this.activeLayers.find($=>$.title.includes(O.name+" "+this.iterator.toString()));break}}else{const O="Adresses "+this.iterator.toString();this.activeLayers.forEach($=>{$.title.includes(O)&&(m=$)})}m&&(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(m.id))}else k&&this.activeLayers.length&&this.workspaceState.store.all().length>1&&(this.selectWorkspaceEntity(k),this.moveendKey=this.map.ol.on("moveend",()=>{this.selectWorkspaceEntity(k)}))})}selectWorkspaceEntity(k){this.workspaceState.store.all().forEach(m=>{m.entityStore.state.updateAll({selected:!1}),m.title.includes(k.added[0].meta.title)&&(this.workspaceState.setActiveWorkspaceById(m.id),m.entityStore.state.updateMany(k.added,{selected:!0}))})}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Me.a)(this.unsubscribe$)).subscribe(k=>{k.sort((m,O)=>m.properties.nom<O.properties.nom?-1:m.properties.nom>O.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(k)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===p._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let m,k=!0;(0===this.buffer||this.type===p._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),m=this.itemType!==p.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===p.K88.Kilometers&&this.type!==p._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===p._cQ.Polygon&&(this.buffer=0);const O=[];m.forEach($=>{O.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,$,this.buffer).pipe((0,Xe.y)(ie=>{this.store.insertMany(ie);const Se=[],Ne=[];let it,mt;ie.forEach(ht=>{"Point"===ht.geometry.type?(ht.properties.longitude=ht.geometry.coordinates[0],ht.properties.latitude=ht.geometry.coordinates[1],Se.push(ht),it=ht.meta.id):(Ne.push(ht),mt=ht.meta.id)}),this.tryAddPointToMap(Se,it),this.tryAddLayerToMap(Ne,mt),ie.length?(k=!1,this.thematicLength+=1,$.zeroResults=!1,this.cdRef.detectChanges()):$.zeroResults=!0,ie.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,he.y)(O).pipe((0,Me.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,k&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(k,m){this.zone=k,k&&(m?this.tryAddFeaturesToMap([k],!0):this.tryAddFeaturesToMap([k]),this.zoomToFeatureExtent(k))}tryAddFeaturesToMap(k,m){let O=1;for(const $ of k){if(this.type===p._cQ.Predefined)for(const ie of this.layers){if(ie.options._internal&&ie.options._internal.code===$.properties.code&&!m){if(!ie.title?.startsWith("Zone")){const Se=this.layers.indexOf(ie);this.layers.splice(Se,1)}return}if(ie.title?.startsWith("Zone")){this.activeLayers=[];const Se=this.layers.indexOf(ie);this.layers.splice(Se,1),this.map.removeLayer(ie)}}else{if(m)for(const ie of this.activeLayers)if(1===this.activeLayers.length&&ie.title?.startsWith("Zone")){const Se=this.layers.indexOf(ie);this.layers.splice(Se,1),this.map.removeLayer(ie)}this.activeLayers=[]}for(const ie of this.layers)ie.title?.startsWith("Zone")&&O++;this.defaultStyle=(ie,Se)=>{const Ne=k[0].coordinates;return new N.cp({image:new A.c({radius:Ne?this.buffer/Math.cos(Math.PI/180*Ne[1])/Se:void 0,fill:new j.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new K.c({width:1,color:"orange"})}),stroke:new K.c({width:1,color:"orange"}),fill:new j.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,ro.U)(1)).subscribe(ie=>{const Se=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+O+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===p._cQ.Predefined?$.properties.code:void 0},source:ie,visible:!0}),Ne=k.map(mt=>(0,p.K6O)(mt,this.map.projection));if(this.type!==p._cQ.Predefined){const mt=this.type===p._cQ.Point?"Cercle":"Polygone";Ne[0].set("nom","Zone",!0),Ne[0].set("type",mt,!0)}ie.ol.addFeatures(Ne),Se.ol.setStyle(this.defaultStyle),this.map.addLayer(Se),this.layers.push(Se),this.activeLayers.push(Se),this.cdRef.detectChanges()})}}tryAddPointToMap(k,m){let O=1;if(k.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(k[0].meta.title)&&O++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:m,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,ro.U)(1)).subscribe($=>{const ie=k[0].meta.icon;let Se;Se=ie&&this.createSvgIcon(ie)||(0,p.o5m)();const Ne=this.layerService.createLayer({isIgoInternalLayer:!0,title:k[0].meta.title+" "+O+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0,style:Se}),it=k.map(ht=>(0,p.K6O)(ht,this.map.projection));$.ol.getSource().addFeatures(it),this.layers.find(ht=>ht.id===Ne.id)&&(this.map.removeLayer(this.layers.find(ht=>ht.id===Ne.id)),O-=1,Ne.title=k[0].meta.title+" "+O+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Ne.options.title=Ne.title),this.iterator=O,this.map.addLayer(Ne),this.layers.push(Ne),this.pushLayer(Ne),this.cdRef.detectChanges()})}}createSvgIcon(k){let m;return this.matIconRegistry.getNamedSvgIcon(k).subscribe(O=>{const $=new XMLSerializer;O.setAttribute("width","30"),O.setAttribute("height","30"),O.setAttribute("fill","rgba(0, 128, 255)"),O.setAttribute("stroke","white");const ie=$.serializeToString(O);m=new N.cp({image:new re.c({src:"data:image/svg+xml;utf8,"+ie})})}),m}tryAddLayerToMap(k,m){let O=1;if(k.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(k[0].meta.title)&&O++;this.dataSourceService.createAsyncDataSource({type:"vector",id:m,queryable:!0}).pipe((0,ro.U)(1)).subscribe($=>{const ie=this.layerService.createLayer({isIgoInternalLayer:!0,title:k[0].meta.title+" "+O+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0}),Se=k.map(it=>(0,p.K6O)(it,this.map.projection));$.ol.addFeatures(Se),this.layers.find(it=>it.id===ie.id)&&(this.map.removeLayer(this.layers.find(it=>it.id===ie.id)),O-=1,ie.title=k[0].meta.title+" "+O+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),ie.options.title=ie.title),this.map.addLayer(ie),this.layers.push(ie),this.pushLayer(ie),this.cdRef.detectChanges()})}}zoomToFeatureExtent(k){if(k){const m=this.format.readFeature(k,{dataProjection:k.projection,featureProjection:this.map.projection});(0,p.QX5)(this.map.viewController,[m],p.Suj.Zoom)}}pushLayer(k){for(const m of this.activeLayers)if(m.id===k.id)return;this.activeLayers.push(k)}static \u0275fac=function(m){return new(m||ba)(o.GI1(Et.iK),o.GI1(p.kjd),o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(pt),o.GI1(qe.mi),o.GI1(ut.ov),o.GI1(to),o.GI1(Mt),o.GI1(jo),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:ba,selectors:[["igo-spatial-filter-tool"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:4,vars:16,consts:[[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","export","openWorkspace","entityChange"],[4,"ngIf"],[3,"feature"]],template:function(m,O){1&m&&(o.I0R(0,"igo-spatial-filter-type",0),o.qCj("eventType",function(ie){return O.getOutputType(ie)})("eventQueryType",function(ie){return O.getOutputQueryType(ie)})("zoneChange",function(ie){return O.onZoneChange(ie)})("zoneWithBufferChange",function(ie){return O.onZoneChange(ie,!0)})("bufferChange",function(ie){return O.buffer=ie})("measureUnitChange",function(ie){return O.measureUnit=ie}),o.C$Y(),o.I0R(1,"igo-spatial-filter-item",1),o.qCj("radiusEvent",function(ie){return O.buffer=ie})("bufferEvent",function(ie){return O.buffer=ie})("measureUnitChange",function(ie){return O.measureUnit=ie})("freehandControl",function(ie){return O.freehandDrawIsActive=ie})("drawZoneEvent",function(ie){return O.zone=ie})("zoneWithBufferChange",function(ie){return O.onZoneChange(ie,!0)})("itemTypeChange",function(ie){return O.itemType=ie})("thematicChange",function(ie){return O.thematics=ie})("toggleSearch",function(){return O.getOutputToggleSearch()})("clearButtonEvent",function(){return O.clearMap()})("clearSearchEvent",function(){return O.getOutputClearSearch()})("export",function(){return O.activateExportTool()})("openWorkspace",function(){return O.activateWorkspace()})("entityChange",function(ie){return O.activateWorkspace(ie)}),o.C$Y(),o.yuY(2,on,2,1,"ng-container",2),o.wVc(3,"async")),2&m&&(o.E7m("store",O.spatialListStore)("selectedQueryType",O.queryType)("zone",O.zone)("layers",O.activeLayers),o.yG2(),o.E7m("type",O.type)("queryType",O.queryType)("map",O.map)("zone",O.zone)("loading",O.loading)("store",O.store)("layers",O.activeLayers)("allLayers",O.layers)("thematicLength",O.thematicLength),o.yG2(),o.E7m("ngIf",o.kDX(3,14,O.selectedFeature$)))},dependencies:[p.K4n,p.uu$,p.wP$,T.u_,T.a],styles:["[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]{display:block;padding:0 12px}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:12px;padding:0 12px}"],changeDetection:0})};Bi=(0,at.UN)([(0,Pt.aA)({name:"spatialFilter",title:"igo.integration.tools.spatialFilter",icon:To.yC}),(0,at.YR)("design:paramtypes",[Et.iK,p.kjd,p.OEM,p.IZ6,pt,qe.mi,ut.ov,to,Mt,jo,o.kD9])],Bi);let fi=class Oa{constructor(){}static \u0275fac=function(m){return new(m||Oa)};static \u0275cmp=o.In1({type:Oa,selectors:[["igo-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoTimeFilterListBinding",""]],template:function(m,O){1&m&&o.wR5(0,"igo-time-filter-list",0)},dependencies:[p.gho,p.eAs],encapsulation:2})};fi=(0,at.UN)([(0,Pt.aA)({name:"timeFilter",title:"igo.integration.tools.timeFilter",icon:"history"}),(0,at.YR)("design:paramtypes",[])],fi);var vo=r(18268);function Tn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-tab-group")(1,"mat-tab",3),o.wVc(2,"translate"),o.I0R(3,"igo-import-export",4),o.qCj("selectMode",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.modeChanged($))})("exportOptionsChange",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.exportOptionsChange($))}),o.wVc(4,"async"),o.wVc(5,"async"),o.C$Y()(),o.I0R(6,"mat-tab",3),o.wVc(7,"translate"),o.wR5(8,"igo-context-import-export",5),o.C$Y()()}if(2&q){const m=o.GaO();o.yG2(),o.E7m("label",o.kDX(2,10,"igo.integration.importExportTool.importExportData")),o.yG2(2),o.E7m("contextUri",o.kDX(4,12,m.contextState.context$).uri)("map",m.map)("selectFirstProj",m.selectFirstProj)("projectionsLimitations",m.projectionsLimitations)("store",m.workspaceStore)("selectedMode",o.kDX(5,14,m.importExportState.selectedMode$))("exportOptions$",m.importExportState.exportOptions$),o.yG2(3),o.E7m("label",o.kDX(7,16,"igo.integration.importExportTool.importExportContext")),o.yG2(2),o.E7m("map",m.map)}}function En(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-import-export",6),o.qCj("selectMode",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.modeChanged($))})("exportOptionsChange",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.exportOptionsChange($))}),o.wVc(1,"async"),o.wVc(2,"async"),o.C$Y()}if(2&q){const m=o.GaO();o.E7m("contextUri",o.kDX(1,5,m.contextState.context$).uri)("map",m.map)("store",m.workspaceStore)("selectedMode",o.kDX(2,7,m.importExportState.selectedMode$))("exportOptions$",m.importExportState.exportOptions$)}}function xn(q,k){if(1&q&&o.wR5(0,"igo-context-import-export",5),2&q){const m=o.GaO();o.E7m("map",m.map)}}let Mn=class Ia{mapState;importExportState;workspaceState;contextState;projectionsLimitations;selectFirstProj=!1;get map(){return this.mapState.map}get workspaceStore(){return this.workspaceState.store}importExportType=Eo.layer;importExportShowBothType=!0;constructor(k,m,O,$){this.mapState=k,this.importExportState=m,this.workspaceState=O,this.contextState=$}ngOnInit(){this.selectType(),this.selectMode()}selectType(){this.importExportType&&this.importExportState.importExportType$.next(this.importExportType);const k=this.importExportState.importExportType$.value;this.importExportState.setImportExportType(void 0!==k?k:Eo.layer)}selectMode(){const k=this.importExportState.selectedMode$.value;this.importExportState.setMode(void 0!==k?k:so.import)}modeChanged(k){this.importExportState.setMode(k)}exportOptionsChange(k){this.importExportState.setsExportOptions(k)}importExportTypeChange(k){this.importExportType=k.value}static \u0275fac=function(m){return new(m||Ia)(o.GI1(pt),o.GI1(to),o.GI1(jo),o.GI1(be))};static \u0275cmp=o.In1({type:Ia,selectors:[["igo-import-export-tool"]],inputs:{projectionsLimitations:"projectionsLimitations",selectFirstProj:"selectFirstProj",importExportType:"importExportType",importExportShowBothType:"importExportShowBothType"},standalone:!0,features:[o.UHJ],decls:3,vars:3,consts:[[4,"ngIf"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange",4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"contextUri","map","selectFirstProj","projectionsLimitations","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"],[3,"map"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"]],template:function(m,O){1&m&&o.yuY(0,Tn,9,18,"mat-tab-group",0)(1,En,3,9,"igo-import-export",1)(2,xn,1,1,"igo-context-import-export",2),2&m&&(o.E7m("ngIf",O.importExportShowBothType),o.yG2(),o.E7m("ngIf",!O.importExportShowBothType&&"layer"===O.importExportType),o.yG2(),o.E7m("ngIf",!O.importExportShowBothType&&"context"===O.importExportType))},dependencies:[T.u_,vo.WG,vo.aJ,vo._q,p.OrO,Jt.kP,T.a,ut._s,Ze.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};Mn=(0,at.UN)([(0,Pt.aA)({name:"importExport",title:"igo.integration.tools.importExport",icon:"file_save"}),(0,at.YR)("design:paramtypes",[pt,to,jo,be])],Mn);var yi=r(75180),zo=r(43424),_i=r(46176),So=r(50244),oi=r(42536),Ci=r(77872),ii=r(43168),Xo=r(24112);function Fn(q,k){if(1&q&&(o.I0R(0,"mat-form-field",12)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",13,14),o.wVc(6,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lon")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lon"))("value",m.coordinates[0])}}function Pn(q,k){if(1&q&&(o.I0R(0,"mat-form-field",12),o.wR5(1,"textarea",13,14),o.wVc(3,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.est"))("value",m.coordinates[0])}}function Rn(q,k){if(1&q&&(o.I0R(0,"mat-form-field",12)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",13,14),o.wVc(6,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lat")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lat"))("value",m.coordinates[1])}}function Ln(q,k){if(1&q&&(o.I0R(0,"mat-form-field",12),o.wR5(1,"textarea",13,14),o.wVc(3,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.nord"))("value",m.coordinates[1])}}function Gn(q,k){if(1&q&&(o.I0R(0,"mat-option",15),o.qCj("click",function(O){return O.stopPropagation()}),o.OEk(1),o.C$Y()),2&q){const m=k.$implicit;o.E7m("value",m),o.yG2(),o.oRS(" ",m.translatedValue||m.alias," ")}}let $n=(()=>{class q{mapState;languageService;messageService;cdRef;storageService;config;formBuilder;formattedScale$=new d.g("");projections$=new d.g([]);form;coordinates;currentCenterDefaultProj;center;inMtmZone=!0;inLambert2={32198:!0,3798:!0};mapState$$;formStatus$$;_projectionsLimitations={};projectionsConstraints;defaultProj;currentZones={utm:void 0,mtm:void 0};units=!0;get map(){return this.mapState.map}get inputProj(){return this.form.get("inputProj").value}set inputProj(m){this.form.patchValue({inputProj:m})}get projectionsLimitations(){return this._projectionsLimitations||{}}set projectionsLimitations(m){this._projectionsLimitations=m}constructor(m,O,$,ie,Se,Ne,it){this.mapState=m,this.languageService=O,this.messageService=$,this.cdRef=ie,this.storageService=Se,this.config=Ne,this.formBuilder=it,this.defaultProj={translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0},this.center=this.storageService.get("centerToggle"),this.computeProjections(),this.buildForm()}ngOnInit(){this.mapState$$=this.map.viewController.state$.pipe((0,Xo.o)(50)).subscribe(()=>{this.setScaleValue(this.map),this.updateCoordinates()}),this.formStatus$$=this.form.valueChanges.subscribe(()=>{this.updateCoordinates()});const m=this.storageService.get("currentProjection");if(this.inputProj=this.projections$.value.find(O=>O.code===this.defaultProj.code)??this.projections$.value[0],null!==m){const O=this.positionInList(m);this.inputProj=this.projections$.value[O],this.updateZoneMtmUtm()}this.map.mapCenter$.next(this.center),this.coordinates=this.getCoordinates(),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code)}ngOnDestroy(){this.map.mapCenter$.next(!1),this.mapState$$.unsubscribe(),this.formStatus$$.unsubscribe()}setScaleValue(m){this.formattedScale$.next(": ~ 1 / "+(0,p.rEB)(m.viewController.getScale()))}getCoordinates(){let m;this.currentZones.mtm=(0,p.ETi)(this.currentCenterDefaultProj[0]),this.currentZones.utm=(0,p.KMH)(this.currentCenterDefaultProj[0]);const O=this.inputProj.code;let $=2;return(O.includes("EPSG:4326")||O.includes("EPSG:4269"))&&($=5),this.units="EPSG:4326"===O||"EPSG:4269"===O,m=this.map.viewController.getCenter(O).map(ie=>ie.toFixed($)),m}updateCoordinates(){this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code);const m=(0,p.ETi)(this.currentCenterDefaultProj[0]),O=(0,p.KMH)(this.currentCenterDefaultProj[0]);!this.inMtmZone&&m!==this.currentZones.mtm&&this.back2quebec();let $=!1;m!==this.currentZones.mtm&&(this.currentZones.mtm=m,$=!0),O!==this.currentZones.utm&&(this.currentZones.utm=O,$=!0),$&&this.updateProjectionsZoneChange(),this.checkLambert(this.currentCenterDefaultProj),this.coordinates=this.getCoordinates(),this.storageService.set("currentProjection",this.inputProj,w.Ab.SESSION)}copyTextToClipboard(){ii._D.copy(this.coordinates.toString())&&this.messageService.success("igo.integration.advanced-map-tool.advanced-coordinates.copyMsg","igo.integration.advanced-map-tool.advanced-coordinates.copyTitle")}displayCenter(m){this.center=m,this.map.mapCenter$.next(m),this.storageService.set("centerToggle",m,w.Ab.SESSION)}buildForm(){this.form=this.formBuilder.group({inputProj:["",[Q.AQ.required]]})}updateProjectionsZoneChange(){let m=this.projections$.value;const O=this.languageService.translate;m.map($=>{if("mtm"===$.translateKey){const ie=(0,p.ETi)(this.currentCenterDefaultProj[0]);if(ie){const Se=ie<10?`EPSG:3218${ie}`:`EPSG:321${80+ie}`;$.alias=`MTM ${ie}`,$.code=Se,$.zone=`${ie}`,$.translatedValue=O.instant("igo.geo.importExportForm.projections.mtm",$)}else $.alias="",this.inMtmZone=!1,"mtm"===this.inputProj.translateKey&&(this.inputProj=this.projections$.value[0])}if("utm"===$.translateKey){const ie=(0,p.KMH)(this.currentCenterDefaultProj[0]),Se=`EPSG:326${ie}`;$.alias=`UTM ${ie}`,$.code=Se,$.zone=`${ie}`,$.translatedValue=O.instant("igo.geo.importExportForm.projections.utm",$)}}),m=m.filter($=>""!==$.alias),this.projections$.next(m)}computeProjections(){this.projectionsConstraints=(0,p.KGf)(this.projectionsLimitations);const m=[];this.currentCenterDefaultProj||(this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code));const O=this.languageService.translate;if(this.projectionsConstraints.wgs84&&m.push({translatedValue:O.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.nad83&&m.push({translatedValue:O.instant("igo.geo.importExportForm.projections.nad83",{code:"EPSG:4269"}),translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.webMercator&&m.push({translatedValue:O.instant("igo.geo.importExportForm.projections.webMercator",{code:"EPSG:3857"}),translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.mtm){const ie=(0,p.ETi)(this.currentCenterDefaultProj[0]);if(ie){this.inMtmZone=!0;const Se=ie<10?`EPSG:3218${ie}`:`EPSG:321${80+ie}`;m.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:Se,zone:ie}),translateKey:"mtm",alias:`MTM ${ie}`,code:Se,zone:`${ie}`,def:void 0,extent:void 0})}else this.inMtmZone=!1}if(this.projectionsConstraints.utm){const ie=this.inMtmZone?4:3,Se=(0,p.KMH)(this.currentCenterDefaultProj[0]),Ne=Se<10?`EPSG:3260${Se}`:`EPSG:326${Se}`;m.splice(ie,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:Ne,zone:Se}),translateKey:"utm",alias:`UTM ${Se}`,code:Ne,zone:`${Se}`,def:void 0,extent:void 0})}let $=[];this.projectionsConstraints.projFromConfig&&($=this.config.getConfig("projections")||[]),this.projections$.next($.concat(m))}pushMtm(m){if(this.projectionsConstraints.mtm){const O=(0,p.ETi)(this.currentCenterDefaultProj[0]),$=O<10?`EPSG:3218${O}`:`EPSG:321${80+O}`;m.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:$,zone:O}),translateKey:"mtm",alias:`MTM ${O}`,code:$,zone:`${O}`,def:void 0,extent:void 0})}}back2quebec(){this.pushMtm(this.projections$.value),this.inMtmZone=!0}updateZoneMtmUtm(){if("mtm"===this.inputProj.translateKey){const m=(0,p.ETi)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`MTM ${m}`;const O=m<10?`EPSG:3218${m}`:`EPSG:321${80+m}`;this.inputProj.code=O,this.inputProj.zone=`${m}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:O,zone:m})}if("utm"===this.inputProj.translateKey){const m=(0,p.KMH)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`UTM ${m}`;const O=m<10?`EPSG:3260${m}`:`EPSG:326${m}`;this.inputProj.code=O,this.inputProj.zone=`${m}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:O,zone:m})}}positionInList(m){const O=m.translateKey,$=m.alias;let ie,Se=0;return this.projections$.value.map(Ne=>{O?O===Ne.translateKey&&(ie=Se):$===Ne.alias&&(ie=Se),Se++}),ie=ie||0,ie}checkLambert(m){(this.config.getConfig("projections")||[]).forEach($=>{let ie=this.projections$.value;const Se=$.extent,Ne=$.code.match(/\d+/),it=ze.W0(Se,$.code,this.defaultProj.code);m[0]<it[0]||m[0]>it[2]||m[1]<it[1]||m[1]>it[3]?(this.inLambert2[Ne]=!1,this.inputProj.alias===$.alias&&(this.inputProj=this.projections$.value[0]),ie=ie.filter(mt=>mt.alias!==$.alias),this.projections$.next(ie)):this.inLambert2[Ne]||(this.projections$.next(ie.concat($)),this.inLambert2[Ne]=!0)})}static \u0275fac=function(O){return new(O||q)(o.GI1(pt),o.GI1(ut.ov),o.GI1(qe.mi),o.GI1(o.kD9),o.GI1(w.yQ),o.GI1(xt.aW),o.GI1(Q.KE))};static \u0275cmp=o.In1({type:q,selectors:[["igo-advanced-coordinates"]],inputs:{projectionsLimitations:"projectionsLimitations"},standalone:!0,features:[o.UHJ],decls:36,vars:37,consts:[[1,"advanced-coordinates__coordinates-container"],[1,"advanced-coordinates__coordinates-container__inner"],["subscriptSizing","dynamic",4,"ngIf","ngIfElse"],["elseBlock",""],["elseBlock2",""],["mat-icon-button","",1,"igo-form-button-group","advanced-coordinates__copy-coordinates",3,"click"],[1,"igo-form","advanced-coordinates__form",3,"formGroup"],["subscriptSizing","dynamic",1,"igo-input-container"],[3,"value","valueChange"],["matTooltipShowDelay","500",3,"value","click",4,"ngFor","ngForOf"],[1,"center-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"igo-zoom","mat-typography"],["subscriptSizing","dynamic"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],["matTooltipShowDelay","500",3,"value","click"]],template:function(O,$){if(1&O&&(o.I0R(0,"div",0)(1,"div",1),o.yuY(2,Fn,7,7,"mat-form-field",2)(3,Pn,4,4,"ng-template",null,3,o.gJz)(5,Rn,7,7,"mat-form-field",2)(6,Ln,4,4,"ng-template",null,4,o.gJz),o.I0R(8,"button",5),o.qCj("click",function(){return $.copyTextToClipboard()}),o.wVc(9,"translate"),o.I0R(10,"mat-icon"),o.OEk(11,"content_copy"),o.C$Y()()(),o.I0R(12,"form",6)(13,"div",1)(14,"mat-form-field",7)(15,"mat-label"),o.OEk(16),o.wVc(17,"translate"),o.C$Y(),o.I0R(18,"mat-select",8),o.iHE("valueChange",function(Se){return o.kNx($.inputProj,Se)||($.inputProj=Se),Se}),o.yuY(19,Gn,2,2,"mat-option",9),o.wVc(20,"async"),o.C$Y()()(),o.I0R(21,"div",1)(22,"mat-slide-toggle",10),o.qCj("change",function(Se){return $.displayCenter(Se.checked)}),o.OEk(23),o.wVc(24,"translate"),o.C$Y()()(),o.I0R(25,"p",11),o.OEk(26),o.wVc(27,"translate"),o.C$Y(),o.I0R(28,"p",11),o.OEk(29),o.wVc(30,"translate"),o.wVc(31,"async"),o.C$Y(),o.I0R(32,"p",11),o.OEk(33),o.wVc(34,"translate"),o.wVc(35,"number"),o.C$Y()()),2&O){const ie=o.Gew(4),Se=o.Gew(7);o.yG2(2),o.E7m("ngIf",$.units)("ngIfElse",ie),o.yG2(3),o.E7m("ngIf",$.units)("ngIfElse",Se),o.yG2(3),o.e48("aria-label",o.kDX(9,18,"igo.integration.advanced-map-tool.advanced-coordinates.copy")),o.yG2(4),o.E7m("formGroup",$.form),o.yG2(4),o.cNF(o.kDX(17,20,"igo.integration.advanced-map-tool.advanced-coordinates.coordSystem")),o.yG2(2),o.OKB("value",$.inputProj),o.yG2(),o.E7m("ngForOf",o.kDX(20,22,$.projections$)),o.yG2(3),o.E7m("checked",$.center)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(24,24,"igo.integration.advanced-map-tool.advanced-coordinates.center")," "),o.yG2(3),o.CAO(" ",o.kDX(27,26,"igo.integration.advanced-map-tool.advanced-coordinates.zoom")," ",$.map.viewController.getZoom()," "),o.yG2(3),o.CAO(" ",o.kDX(30,28,"igo.integration.advanced-map-tool.advanced-coordinates.scale")," ",o.kDX(31,30,$.formattedScale$)," "),o.yG2(4),o.CAO(" ",o.kDX(34,32,"igo.integration.advanced-map-tool.advanced-coordinates.resolution")," ",o.g7$(35,34,$.map.viewController.getResolution(),"1.0-0")," ")}},dependencies:[T.u_,So.wb,So.Up,So.w5,oi.cN,oi.yi,z.oJ,z.um,Et.oB,Et.qL,Q.y,Q.sz,Q.u,Q.sl,Q.uW,Ci.d5,Ci.kX,_i.I5,T.Iw,_i.Ax,zo.GE,zo.cP,T.a,T.hl,ut._s,Ze.sD],styles:["[_nghost-%COMP%]{padding:12px 0}textarea[_ngcontent-%COMP%]{resize:none}.advanced-coordinates__coordinates-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;padding:12px 0}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:first-child), .advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:first-child){margin-left:8px}.advanced-coordinates__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}"]})}return q})();var Nt=r(63916);function An(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-option",5),o.qCj("click",function(){o.usT(m),o.GaO();const $=o.Gew(8),ie=o.GaO();return o.CGJ(ie.applyNewLayers($))}),o.OEk(1),o.C$Y()}if(2&q){const m=k.$implicit;o.E7m("value",m),o.yG2(),o.cNF(m.title)}}function kn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"div",2)(1,"form",3)(2,"mat-form-field")(3,"mat-label"),o.OEk(4),o.wVc(5,"translate"),o.C$Y(),o.I0R(6,"mat-select",4)(7,"mat-option",5,6),o.qCj("click",function(){o.usT(m);const $=o.Gew(8),ie=o.GaO();return o.CGJ(ie.selectAll($))}),o.OEk(9),o.wVc(10,"translate"),o.C$Y(),o.wR5(11,"mat-divider"),o.yuY(12,An,2,2,"mat-option",7),o.C$Y()(),o.I0R(13,"mat-slide-toggle",8),o.qCj("change",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.startSwipe($.checked))}),o.OEk(14),o.wVc(15,"translate"),o.C$Y()()()}if(2&q){const m=o.GaO();o.yG2(),o.E7m("formGroup",m.form),o.yG2(3),o.cNF(o.kDX(5,8,"igo.integration.advanced-map-tool.advanced-swipe.swipe-select")),o.yG2(3),o.E7m("value",1),o.yG2(2),o.oRS(" ",o.kDX(10,10,"igo.integration.advanced-map-tool.advanced-swipe.selectAll")," "),o.yG2(3),o.E7m("ngForOf",m.userControlledLayerList),o.yG2(),o.E7m("checked",m.swipe)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(15,12,"igo.integration.advanced-map-tool.advanced-swipe.swipe")," ")}}function Bn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.I0R(4,"p",9),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"mat-list-item")(8,"mat-icon",10),o.OEk(9,"search"),o.C$Y(),o.I0R(10,"span",11),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.searchEmit())}),o.OEk(11),o.wVc(12,"translate"),o.C$Y()(),o.I0R(13,"mat-list-item"),o.wR5(14,"igo-icon",12),o.I0R(15,"span",13),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.catalogEmit())}),o.OEk(16),o.wVc(17,"translate"),o.C$Y()(),o.I0R(18,"mat-list-item")(19,"mat-icon",10),o.OEk(20,"star"),o.C$Y(),o.I0R(21,"span",14),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.contextEmit())}),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()()}if(2&q){const m=o.GaO();o.yG2(2),o.oRS(" ",o.kDX(3,6,"igo.integration.advanced-map-tool.advanced-swipe.empty")," "),o.yG2(3),o.oRS(" ",o.kDX(6,8,"igo.integration.advanced-map-tool.advanced-swipe.customize")," "),o.yG2(6),o.oRS(" ",o.kDX(12,10,"igo.integration.advanced-map-tool.advanced-swipe.search-tool")," "),o.yG2(3),o.E7m("icon",m.layerPlusIcon),o.yG2(2),o.oRS(" ",o.kDX(17,12,"igo.integration.advanced-map-tool.advanced-swipe.catalog-tool")," "),o.yG2(6),o.oRS(" ",o.kDX(23,14,"igo.integration.advanced-map-tool.advanced-swipe.context-tool")," ")}}let Un=(()=>{class q{mapState;contextService;formBuilder;toolState;swipe=!1;layerList;userControlledLayerList;form;layers;res;listForSwipe;layerPlusIcon=To.er;get map(){return this.mapState.map}constructor(m,O,$,ie){this.mapState=m,this.contextService=O,this.formBuilder=$,this.toolState=ie,this.buildForm()}ngOnInit(){this.map.layers$.subscribe(m=>this.userControlledLayerList=m.filter(O=>!O.baseLayer&&O.showInLayerList&&O.displayed))}ngOnDestroy(){this.swipe=!1,this.map.swipeEnabled$.next(this.swipe)}buildForm(){this.form=this.formBuilder.group({layers:["",[Q.AQ.required]]})}startSwipe(m){this.swipe=m,this.map.swipeEnabled$.next(m),this.listForSwipe=[];for(const O of this.form.value.layers)this.listForSwipe.push(O);this.map.selectedFeatures$.next(this.listForSwipe)}applyNewLayers(m){this.startSwipe(!1),this.startSwipe(!0),m._selected&&(m._selected=!1),this.form.controls.layers.value.length===this.userControlledLayerList.length&&(m._selected=!0)}selectAll(m){m._selected?(this.form.controls.layers.setValue(this.userControlledLayerList),m._selected=!0):this.form.controls.layers.setValue([]),this.startSwipe(!1),this.startSwipe(!0)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(O){return new(O||q)(o.GI1(pt),o.GI1(Jt.M9),o.GI1(Q.KE),o.GI1(Mt))};static \u0275cmp=o.In1({type:q,selectors:[["igo-advanced-swipe"]],standalone:!0,features:[o.UHJ],decls:3,vars:2,consts:[["class","igo-swipe-select-container",4,"ngIf","ngIfElse"],["noLayersBlock",""],[1,"igo-swipe-select-container"],[1,"igo-form",3,"formGroup"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value","click",4,"ngFor","ngForOf"],[1,"swipe-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"map-empty","mat-typography"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemIcon","",3,"icon"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(O,$){if(1&O&&o.yuY(0,kn,16,14,"div",0)(1,Bn,24,16,"ng-template",null,1,o.gJz),2&O){const ie=o.Gew(2);o.E7m("ngIf",$.userControlledLayerList.length)("ngIfElse",ie)}},dependencies:[T.u_,Q.y,Q.sz,Q.ue,Q.u,Q.sl,Q.uW,Q.Wo,So.wb,So.Up,So.w5,Ci.d5,Ci.kX,_i.I5,_i.Ax,yi.U,yi.k,T.Iw,zo.GE,zo.cP,Nt.iI,Nt.oL,Nt.g9,Nt.Y1,Nt.UV,Et.oB,Et.qL,ut._s,Ze.sD,To.S],styles:["[_nghost-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:4px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{padding:12px 0;text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   .advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}"]})}return q})(),Ui=class wa{mapState;get tracking$(){return this.mapState.map.geolocationController.tracking$}get followPosition$(){return this.mapState.map.geolocationController.followPosition$}constructor(k){this.mapState=k}toggleTracking(k){this.mapState.map.geolocationController.tracking=k}toggleFollow(k){this.mapState.map.geolocationController.followPosition=k}static \u0275fac=function(m){return new(m||wa)(o.GI1(pt))};static \u0275cmp=o.In1({type:wa,selectors:[["igo-advanced-map-tool"]],standalone:!0,features:[o.UHJ],decls:24,vars:26,consts:[[1,"nameOfTool"],[1,"advanced-tool-line"],[1,"igo-input-container"],[1,"geolocation-slide-toggle-container"],[1,"geolocation-option",3,"checked","labelPosition","change"],[1,"geolocation-option",3,"disabled","labelPosition","checked","change"]],template:function(m,O){1&m&&(o.I0R(0,"h4",0),o.OEk(1),o.wVc(2,"translate"),o.C$Y(),o.wR5(3,"igo-advanced-swipe")(4,"mat-divider",1),o.I0R(5,"h4",0),o.OEk(6),o.wVc(7,"translate"),o.C$Y(),o.wR5(8,"igo-advanced-coordinates")(9,"mat-divider",1),o.I0R(10,"h4",0),o.OEk(11),o.wVc(12,"translate"),o.C$Y(),o.I0R(13,"div",2)(14,"div",3)(15,"mat-slide-toggle",4),o.qCj("change",function(ie){return O.toggleTracking(ie.checked)}),o.wVc(16,"async"),o.OEk(17),o.wVc(18,"translate"),o.C$Y(),o.I0R(19,"mat-slide-toggle",5),o.qCj("change",function(ie){return O.toggleFollow(ie.checked)}),o.wVc(20,"async"),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()()),2&m&&(o.yG2(),o.oRS(" ",o.kDX(2,10,"igo.integration.advanced-map-tool.advanced-swipe.swipe-tool"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(7,12,"igo.integration.advanced-map-tool.advanced-coordinates.coordinates"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(12,14,"igo.integration.advanced-map-tool.geolocation.title"),"\n"),o.yG2(4),o.E7m("checked",o.kDX(16,16,O.tracking$))("labelPosition","before"),o.yG2(2),o.oRS(" ",o.kDX(18,18,"igo.integration.advanced-map-tool.geolocation.tracking")," "),o.yG2(2),o.E7m("disabled",!0!==o.kDX(20,20,O.tracking$))("labelPosition","before")("checked",o.kDX(21,22,O.followPosition$)),o.yG2(3),o.oRS(" ",o.kDX(23,24,"igo.integration.advanced-map-tool.geolocation.follow")," "))},dependencies:[Un,yi.U,yi.k,$n,zo.GE,zo.cP,T.a,ut._s,Ze.sD],styles:["[_nghost-%COMP%]{display:block;padding:0 16px 12px}.nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:12px 0 8px}.advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}.geolocation-slide-toggle-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px 0}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}mat-divider[_ngcontent-%COMP%]{margin:0 -16px}"]})};function nn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"button",1),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.activateWorkspace())}),o.wVc(1,"translate"),o.I0R(2,"mat-icon"),o.OEk(3,"table"),o.C$Y()()}if(2&q){const m=o.GaO();o.E7m("matTooltip",o.kDX(1,2,"igo.integration.workspace.toggleWorkspace"))("color",m.color)}}Ui=(0,at.UN)([(0,Pt.aA)({name:"advancedMap",title:"igo.integration.tools.advancedMap",icon:"home_repair_service"}),(0,at.YR)("design:paramtypes",[pt])],Ui);let ni=(()=>{class q{workspaceState;hasWorkspace$=new d.g(!1);hasWorkspace$$;_layer;layer$=new d.g(void 0);set layer(m){this._layer=m,this.layer$.next(this._layer)}get layer(){return this._layer}color="primary";constructor(m){this.workspaceState=m}ngOnInit(){this.hasWorkspace$$=(0,no.E)([this.workspaceState.workspaceEnabled$,this.layer$]).subscribe(m=>this.hasWorkspace$.next(m[0]&&m[1]?.options.workspace?.enabled))}ngOnDestroy(){this.hasWorkspace$$.unsubscribe()}activateWorkspace(){this.workspaceState.workspace$.value&&this.workspaceState.workspace$.value.layer.id===this.layer.id&&this.workspaceState.workspacePanelExpanded?this.workspaceState.workspacePanelExpanded=!1:(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(this.layer.id))}static \u0275fac=function(O){return new(O||q)(o.GI1(jo))};static \u0275cmp=o.In1({type:q,selectors:[["igo-workspace-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(O,$){1&O&&(o.yuY(0,nn,4,4,"button",0),o.wVc(1,"async")),2&O&&o.E7m("ngIf",o.kDX(1,1,$.hasWorkspace$))},dependencies:[T.u_,z.oJ,z.um,yt.KO,yt.a4,Et.oB,Et.qL,T.a,ut._s,Ze.sD],changeDetection:0})}return q})();function rn(q,k){if(1&q){const m=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const ie=o.usT(m).layer,Se=o.GaO(2);return o.CGJ(Se.activateExport(ie))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&q){const m=k.layer,O=o.GaO(2);o.E7m("layer",m),o.yG2(),o.E7m("layer",m),o.yG2(),o.E7m("header",O.ogcButton)("layer",m),o.yG2(),o.E7m("header",O.timeButton)("layer",m),o.yG2(),o.E7m("trackFeature",!0)("layer",m),o.yG2(),o.E7m("layer",m)}}function Yn(q,k){if(1&q&&(o.I0R(0,"igo-layer-list",2),o.yuY(1,rn,6,9,"ng-template",null,3,o.gJz),o.C$Y()),2&q){const m=o.GaO();o.E7m("map",m.map)("excludeBaseLayers",m.excludeBaseLayers)("layerFilterAndSortOptions",m.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",m.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",m.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("queryBadge",m.queryBadge)}}function sn(q,k){1&q&&(o.I0R(0,"p",9),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&q&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function tr(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Vn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",15),o.C$Y()(),o.gRP(),o.I0R(4,"span",16),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function or(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",17),o.C$Y()(),o.gRP(),o.I0R(4,"span",18),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function ir(q,k){if(1&q&&(o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,sn,3,3,"p",10)(5,tr,7,3,"mat-list-item",8)(6,Vn,7,3,"mat-list-item",8)(7,or,7,3,"mat-list-item",8),o.C$Y()),2&q){const m=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function nr(q,k){if(1&q&&o.yuY(0,ir,8,7,"mat-list",8),2&q){const m=o.GaO();o.E7m("ngIf",m.delayedShowEmptyMapContent)}}let an=class Ta{mapState;toolState;searchSourceService;cdRef;importExportState;delayedShowEmptyMapContent=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;layerAdditionAllowed=!0;get map(){return this.mapState.map}get layers$(){return this.map.layers$.pipe((0,go.k)(k=>k.filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer))))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const k=Object.assign({showToolbar:p.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.g7B.always:k.showToolbar=p.g7B.always;break;case p.g7B.never:k.showToolbar=p.g7B.never}return k}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.ayN).filter(k=>k.available&&"Layer"===k.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(k,m,O,$,ie){this.mapState=k,this.toolState=m,this.searchSourceService=O,this.cdRef=$,this.importExportState=ie}ngOnInit(){setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}activateExport(k){let m=k.id;k.options.workspace?.workspaceId&&(m=k.options.workspace.workspaceId!==k.id?k.options.workspace.workspaceId:k.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(so.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(m){return new(m||Ta)(o.GI1(pt),o.GI1(Mt),o.GI1(p.i6q),o.GI1(o.kD9),o.GI1(to))};static \u0275cmp=o.In1({type:Ta,selectors:[["igo-map-details-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge",layerAdditionAllowed:"layerAdditionAllowed"},standalone:!0,features:[o.UHJ],decls:4,vars:4,consts:[["class","mapDetailsList","igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge",4,"ngIf","ngIfElse"],["empty",""],["igoLayerListBinding","",1,"mapDetailsList",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"],[4,"ngIf"],[1,"map-empty","mat-typography"],["class","map-empty mat-typography",4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,O){if(1&m&&(o.yuY(0,Yn,3,7,"igo-layer-list",0),o.wVc(1,"async"),o.yuY(2,nr,1,1,"ng-template",null,1,o.gJz)),2&m){const $=o.Gew(3);o.E7m("ngIf",o.kDX(1,2,O.layers$).length)("ngIfElse",$)}},dependencies:[T.u_,p.m2U,p.Ult,ni,p.O_6,p.Ga$,p.eM$,p.ktW,p.Idw,Nt.iI,Nt.oL,Nt.g9,Nt.Y1,Nt.UV,Et.oB,Et.qL,T.a,ut._s,Ze.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}[_nghost-%COMP%]   .mapDetailsList[_ngcontent-%COMP%]{overflow:hidden}"]})};an=(0,at.UN)([(0,Pt.aA)({name:"mapDetails",title:"igo.integration.tools.map",icon:"map"}),(0,at.YR)("design:paramtypes",[pt,Mt,p.i6q,o.kD9,to])],an);var jn=r(23680);function Kn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-layer-legend-list",4),o.qCj("allLegendsShown",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&q){const m=o.GaO();o.E7m("excludeBaseLayers",m.excludeBaseLayers)("allowShowAllLegends",m.allowShowAllLegends)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("showAllLegendsValue",o.kDX(1,4,m.showAllLegendsValue$))}}function ln(q,k){}function rr(q,k){1&q&&o.yuY(0,ln,0,0,"ng-template")}function sr(q,k){if(1&q&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,m.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible"),"\n")}}function ar(q,k){1&q&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&q&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function vi(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",9),o.C$Y()(),o.gRP(),o.I0R(4,"span",10),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Wn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",11),o.C$Y()(),o.gRP(),o.I0R(4,"span",12),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function cn(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function Nn(q,k){if(1&q&&(o.I0R(0,"mat-list")(1,"p",5),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,ar,3,3,"p",2)(5,vi,7,3,"mat-list-item",6)(6,Wn,7,3,"mat-list-item",6)(7,cn,7,3,"mat-list-item",6),o.C$Y()),2&q){const m=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function Yi(q,k){if(1&q&&o.yuY(0,Nn,8,7,"mat-list",6),2&q){const m=o.GaO();o.E7m("ngIf",m.delayedShowEmptyMapContent)}}let ri=class Ea{mapState;toolState;searchSourceService;cdRef;delayedShowEmptyMapContent=!1;layers$=new d.g([]);showAllLegendsValue$=new d.g(!1);change$=new jn.o(1);resolution$$;visibleOrInRangeLayers$$;updateLegendOnResolutionChange=!1;layerAdditionAllowed=!0;allowShowAllLegends=!1;showAllLegendsValue=!1;layerListControls={};get map(){return this.mapState.map}get visibleOrInRangeLayers$(){return this.layers$.pipe((0,go.k)(k=>k.filter(m=>m.visible$.value&&m.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,go.k)(k=>k.filter(m=>m.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.ayN).filter(k=>k.available&&"Layer"===k.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(k,m,O,$){this.mapState=k,this.toolState=m,this.searchSourceService=O,this.cdRef=$}ngOnInit(){this.resolution$$=(0,no.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,Xo.o)(10)).subscribe(k=>{this.layers$.next(k[0].filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}onShowAllLegends(k){this.mapState.showAllLegendsValue=k,this.showAllLegendsValue$.next(k)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let k;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(m=>{k=0!==m.length}),!1===k)return!1}return!0}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(m){return new(m||Ea)(o.GI1(pt),o.GI1(Mt),o.GI1(p.i6q),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:Ea,selectors:[["igo-map-legend-tool"]],inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layerAdditionAllowed:"layerAdditionAllowed",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",layerListControls:"layerListControls"},standalone:!0,features:[o.UHJ],decls:8,vars:10,consts:[["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,O){if(1&m&&(o.yuY(0,Kn,2,6,"igo-layer-legend-list",0)(1,rr,1,0,null,1),o.wVc(2,"async"),o.yuY(3,sr,5,7,"p",2),o.wVc(4,"async"),o.wVc(5,"async"),o.yuY(6,Yi,1,1,"ng-template",null,3,o.gJz)),2&m){const $=o.Gew(7);o.E7m("ngIf",O.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(2,4,O.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!O.allowShowAllLegends&&0!==o.kDX(4,6,O.layers$).length&&0===o.kDX(5,8,O.visibleOrInRangeLayers$).length)}},dependencies:[T.u_,p.wSE,p.ApN,Nt.iI,Nt.oL,Nt.g9,Nt.Y1,Nt.UV,Et.oB,Et.qL,T.a,ut._s,Ze.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"]})};ri=(0,at.UN)([(0,Pt.aA)({name:"mapLegend",title:"igo.integration.tools.legend",icon:"format_list_bulleted"}),(0,at.YR)("design:paramtypes",[pt,Mt,p.i6q,o.kD9])],ri);var Si=r(21232),un=r(53156),bi=r(74092);let Jo=(()=>{class q{mapState;storageService;defaultProximityRadiusValue=30;enabled$=new d.g(!1);proximityRadiusValue$;proximitylocationType$=new d.g("geolocation");proximityFeatureStore;subs$$=[];currentPositionCoordinate$=new d.g(void 0);get map(){return this.mapState.map}constructor(m,O){this.mapState=m,this.storageService=O,this.proximityFeatureStore=new p.ym_([],{map:this.mapState.map}),this.proximityRadiusValue$=new d.g(this.storageService.get("mapProximityRadius")||this.defaultProximityRadiusValue),this.mapState.map.ol.once("rendercomplete",()=>{this.subscribeProximityMonitor()})}subscribeProximityMonitor(){this.subs$$.push((0,no.E)([this.enabled$,this.proximitylocationType$,this.proximityRadiusValue$,(0,bi.I)(5e3),this.map.geolocationController.position$]).pipe((0,Xo.o)(750)).subscribe(m=>{this.proximityFeatureStore.clear();const O=m[0],$=this.map.layers,ie=this.map.geolocationController.position$.value,Se=m[1],Ne=m[2];if(this.storageService.set("mapProximityRadius",Ne||this.defaultProximityRadiusValue),!O)return;let it;if("geolocation"===Se){if(!ie||!ie.position)return;it=ze.AF(ie.position,ie.projection,this.map.projection),this.map.mapCenter$.next(!1)}else it=this.map.viewController.getCenter(),this.map.mapCenter$.next(!0);const mt=ze.AF(it,this.map.projection,"EPSG:4269"),ht=(0,p.uEw)(mt,6);this.currentPositionCoordinate$.next(ht),$.filter(Ot=>Ot.ol instanceof un.c&&Ot.dataSource.options.queryable&&Ot.visible&&Ot.isInResolutionsRange).map(Ot=>{const Rt=Ot.ol.getSource(),co=Rt.getFeaturesAtCoordinate(it);if(co&&co.length)co.map(bo=>{const ci=(0,p.qKz)(bo,this.map.projection);let Ko=this.getQueryTitle(ci,Ot);this.addFeatureToStore(Ot,it,ci,Ko,0)});else{const bo=Rt.getClosestFeatureToCoordinate(it);if(bo){const ci=bo.getGeometry(),Ko=(0,p.qKz)(bo,this.map.projection),Ti=ci.getClosestPoint(it),hn=new ge.c([it,Ti]),Xn=(0,p.cDV)(hn,"EPSG:3857");if(Xn<=Ne){let vr=this.getQueryTitle(Ko,Ot);this.addFeatureToStore(Ot,it,Ko,vr,Xn)}}}})}))}addFeatureToStore(m,O,$,ie,Se){const Ne=(0,ii.uq)(),it=this.map.ol.getView().getProjection(),mt=$.ol.getGeometry(),ht=(new te.c).writeGeometryObject(mt,{featureProjection:it,dataProjection:it});this.proximityFeatureStore.update({type:p.YfI,geometry:ht,projection:it.getCode(),properties:{...$.properties,id:Ne,element:ie,distance:Se,coordFromCalculatedDistance:O,layerSrcId:m.id,layerSrcTitle:m.title},meta:{id:Ne}})}getQueryTitle(m,O){let $;if(O.options?.source?.options){const ie=O.options.source.options;ie.queryTitle&&($=this.getLabelMatch(m,ie.queryTitle))}return $}getLabelMatch(m,O){let $=O;const ie=Array.from(O.matchAll(/\$\{([^\{\}]+)\}/g));return ie.forEach(Se=>{$=$.replace(Se[0],m.properties[Se[1]])}),0===ie.length&&$===O&&($=m.properties[O]||O),$}static \u0275fac=function(O){return new(O||q)(o.CoB(pt),o.CoB(w.yQ))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})();const Hn=["table"];function lr(q,k){if(1&q&&(o.I0R(0,"mat-form-field",14),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&q){const m=k.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lon"))("value",m[0])}}function oe(q,k){if(1&q&&(o.I0R(0,"mat-form-field",17),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&q){const m=k.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lat"))("value",m[1])}}function We(q,k){if(1&q){const m=o.KQA();o.I0R(0,"button",18),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.copyTextToClipboard())}),o.I0R(1,"mat-icon"),o.OEk(2,"content_copy"),o.C$Y()()}}let v=class xa{mapState;mapProximityState;languageService;messageService;subs$$=[];table;get maxDistance(){return this.mapProximityState.proximityRadiusValue$.value}set maxDistance(k){this.mapProximityState.proximityRadiusValue$.next(k)}get map(){return this.mapState.map}userDefinedMapCenter;userDefinedFollowPosition;tableTemplate;constructor(k,m,O,$){this.mapState=k,this.mapProximityState=m,this.languageService=O,this.messageService=$,this.tableTemplate={selection:!0,selectMany:!1,selectionCheckbox:!1,sort:!0,columns:[{name:"element",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.feature"),valueAccessor:ie=>ie.properties.element},{name:"distance",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.distance"),valueAccessor:ie=>`${ii.UD.roundToNDecimal(ie.properties.distance,1)}m`}]}}ngOnInit(){this.mapProximityState.enabled$.next(!0),this.userDefinedFollowPosition=!0===this.map.geolocationController.followPosition,this.userDefinedMapCenter=!0===this.map.mapCenter$.value,this.subs$$.push(this.mapProximityState.proximitylocationType$.subscribe(k=>{this.map.mapCenter$.next("geolocation"!==k),this.map.geolocationController.followPosition="geolocation"===k}))}ngOnDestroy(){this.mapProximityState.enabled$.next(!1),this.map.mapCenter$.next(this.userDefinedMapCenter),this.subs$$.map(k=>k.unsubscribe()),this.map.geolocationController.followPosition=this.userDefinedFollowPosition}onLocationTypeChange(k){this.mapProximityState.proximitylocationType$.next(k.value)}copyTextToClipboard(){ii._D.copy(this.mapProximityState.currentPositionCoordinate$?.value.toString())&&this.messageService.success("igo.integration.map-proximity-tool.copyMsg","igo.integration.map-proximity-tool.copyTitle")}static \u0275fac=function(m){return new(m||xa)(o.GI1(pt),o.GI1(Jo),o.GI1(ut.ov),o.GI1(qe.mi))};static \u0275cmp=o.In1({type:xa,selectors:[["igo-map-proximity-tool"]],viewQuery:function(m,O){if(1&m&&o.CC$(Hn,7),2&m){let $;o.wto($=o.Gqi())&&(O.table=$.first)}},standalone:!0,features:[o.UHJ],decls:31,vars:35,consts:[[1,"table-compact",3,"store","template"],["table",""],["class","coordinates",4,"ngIf"],["class","coordinates2",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"title-container"],[1,"title","mat-typography"],[1,"igo-input-container","mat-typography"],[3,"change"],["value","geolocation",3,"checked"],["value","mapCenter",3,"checked"],[1,"radius-unit"],["floatLabel","always",1,"radius-field"],["type","number","pattern","[0-9]*","matInput","",3,"ngModel","placeholder","ngModelChange"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],[1,"coordinates2"],["mat-icon-button","",3,"click"]],template:function(m,O){1&m&&(o.wR5(0,"igo-entity-table",0,1)(2,"br"),o.yuY(3,lr,4,4,"mat-form-field",2),o.wVc(4,"async"),o.yuY(5,oe,4,4,"mat-form-field",3),o.wVc(6,"async"),o.yuY(7,We,3,0,"button",4),o.wVc(8,"async"),o.wVc(9,"async"),o.I0R(10,"div",5)(11,"mat-label",6),o.OEk(12),o.wVc(13,"translate"),o.C$Y()(),o.I0R(14,"div",7)(15,"mat-radio-group",8),o.qCj("change",function(ie){return O.onLocationTypeChange(ie)}),o.I0R(16,"mat-radio-button",9),o.wVc(17,"async"),o.OEk(18),o.wVc(19,"translate"),o.C$Y(),o.I0R(20,"mat-radio-button",10),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()(),o.I0R(24,"div",11)(25,"mat-form-field",12)(26,"mat-label"),o.OEk(27),o.wVc(28,"translate"),o.C$Y(),o.I0R(29,"input",13),o.iHE("ngModelChange",function(ie){return o.kNx(O.maxDistance,ie)||(O.maxDistance=ie),ie}),o.wVc(30,"translate"),o.C$Y()()()),2&m&&(o.E7m("store",O.mapProximityState.proximityFeatureStore)("template",O.tableTemplate),o.yG2(3),o.E7m("ngIf",o.kDX(4,13,O.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(6,15,O.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(8,17,O.mapProximityState.currentPositionCoordinate$)&&o.kDX(9,19,O.mapProximityState.currentPositionCoordinate$).length),o.yG2(5),o.cNF(o.kDX(13,21,"igo.integration.map-proximity-tool.method")),o.yG2(4),o.E7m("checked","geolocation"===o.kDX(17,23,O.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(19,25,"igo.integration.map-proximity-tool.geolocation")),o.yG2(2),o.E7m("checked","mapCenter"===o.kDX(21,27,O.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(23,29,"igo.integration.map-proximity-tool.mapCenter")),o.yG2(5),o.cNF(o.kDX(28,31,"igo.integration.map-proximity-tool.radiusM")),o.yG2(2),o._6D("placeholder",o.kDX(30,33,"igo.integration.map-proximity-tool.radiusM")),o.OKB("ngModel",O.maxDistance))},dependencies:[E.Eh,T.u_,So.wb,So.Up,So.w5,oi.cN,oi.yi,z.oJ,z.um,Et.oB,Et.qL,Si.yk,Si.cv,Si.cT,Q.y,Q.ot,Q.O4,Q.ue,Q.E1,Q._G,T.a,ut._s,Ze.sD],styles:["[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}[_nghost-%COMP%]   mat-form-field.coordinates[_ngcontent-%COMP%]{width:110px}[_nghost-%COMP%]   mat-form-field.coordinates2[_ngcontent-%COMP%]{width:100px;padding:0 10px 0 3px}[_nghost-%COMP%]   mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:60%;padding:0 15px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:90%;margin-left:2px;padding:5px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]   mat-form-field.radius-field[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:100%}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}"]})};function V(q,k){if(1&q){const m=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const ie=o.usT(m).layer,Se=o.GaO();return o.CGJ(Se.activateExport(ie))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&q){const m=k.layer,O=o.GaO();o.E7m("layer",m),o.yG2(),o.E7m("layer",m),o.yG2(),o.E7m("header",O.ogcButton)("layer",m),o.yG2(),o.E7m("header",O.timeButton)("layer",m),o.yG2(),o.E7m("trackFeature",!0)("layer",m),o.yG2(),o.E7m("layer",m)}}v=(0,at.UN)([(0,Pt.aA)({name:"map-proximity",title:"igo.integration.tools.closestFeature",icon:"output_circle"}),(0,at.YR)("design:paramtypes",[pt,Jo,ut.ov,qe.mi])],v);let ee=class Ma{mapState;toolState;importExportState;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;get map(){return this.mapState.map}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const k=Object.assign({showToolbar:p.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.g7B.always:k.showToolbar=p.g7B.always;break;case p.g7B.never:k.showToolbar=p.g7B.never}return k}constructor(k,m,O){this.mapState=k,this.toolState=m,this.importExportState=O}activateExport(k){let m=k.id;k.options.workspace?.workspaceId&&(m=k.options.workspace.workspaceId!==k.id?k.options.workspace.workspaceId:k.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(so.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(m){return new(m||Ma)(o.GI1(pt),o.GI1(Mt),o.GI1(to))};static \u0275cmp=o.In1({type:Ma,selectors:[["igo-map-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:9,vars:13,consts:[[3,"label"],["igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],["igoContextListBinding",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"]],template:function(m,O){1&m&&(o.I0R(0,"mat-tab-group")(1,"mat-tab",0),o.wVc(2,"translate"),o.I0R(3,"igo-layer-list",1),o.yuY(4,V,6,9,"ng-template",null,2,o.gJz),o.C$Y()(),o.I0R(6,"mat-tab",0),o.wVc(7,"translate"),o.wR5(8,"igo-context-list",3),o.C$Y()()),2&m&&(o.yG2(),o.E7m("label",o.kDX(2,9,"igo.integration.tools.map")),o.yG2(2),o.E7m("map",O.map)("excludeBaseLayers",O.excludeBaseLayers)("layerFilterAndSortOptions",O.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",O.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",O.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",O.updateLegendOnResolutionChange)("queryBadge",O.queryBadge),o.yG2(3),o.E7m("label",o.kDX(7,11,"igo.integration.tools.contexts")))},dependencies:[vo.WG,vo.aJ,vo._q,p.m2U,p.Ult,ni,p.O_6,p.Ga$,p.eM$,p.ktW,p.Idw,Jt.W2,Jt.AX,ut._s,Ze.sD],styles:["[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}"],changeDetection:0})};ee=(0,at.UN)([(0,Pt.aA)({name:"map",title:"igo.integration.tools.map",icon:"map"}),(0,at.YR)("design:paramtypes",[pt,Mt,to])],ee);const Ce=["tabGroup"];function Te(q,k){if(1&q&&o.wR5(0,"igo-style-modal-layer-button",11),2&q){const m=o.GaO().layer;o.E7m("layer",m)}}function je(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-time-filter-button",15),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.activateTimeFilter())}),o.C$Y()}if(2&q){const m=o.GaO().layer,O=o.GaO(2);o.E7m("header",O.timeButton)("layer",m)}}function nt(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-ogc-filter-button",15),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.activateOgcFilter())}),o.C$Y()}if(2&q){const m=o.GaO().layer,O=o.GaO(2);o.E7m("header",O.ogcButton)("layer",m)}}function _t(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-export-button",16),o.qCj("click",function(){o.usT(m);const $=o.GaO().layer,ie=o.GaO(2);return o.CGJ(ie.activateExport($))}),o.C$Y()}if(2&q){const m=o.GaO().layer;o.E7m("layer",m)}}function ot(q,k){if(1&q&&(o.yuY(0,Te,1,1,"igo-style-modal-layer-button",10),o.wR5(1,"igo-metadata-button",11)(2,"igo-track-feature-button",12),o.yuY(3,je,1,2,"igo-time-filter-button",13)(4,nt,1,2,"igo-ogc-filter-button",13)(5,_t,1,1,"igo-export-button",14),o.wR5(6,"igo-workspace-button",11)),2&q){const m=k.layer,O=o.GaO(2);o.E7m("ngIf",O.isStyleEditButton(m)),o.yG2(),o.E7m("layer",m),o.yG2(),o.E7m("trackFeature",!0)("layer",m),o.yG2(),o.E7m("ngIf",O.isTimeFilterButton(m)),o.yG2(),o.E7m("ngIf",O.isOGCFilterButton(m)),o.yG2(),o.E7m("ngIf",O.isExportButton(m)),o.yG2(),o.E7m("layer",m)}}function Dt(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-layer-list",8),o.qCj("appliedFilterAndSort",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onLayerListChange($))}),o.yuY(1,ot,7,8,"ng-template",null,9,o.gJz),o.C$Y()}if(2&q){const m=o.GaO();o.E7m("excludeBaseLayers",m.excludeBaseLayers)("layerFilterAndSortOptions",m.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",m.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",m.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("queryBadge",m.queryBadge)("map",m.map)}}function wt(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-layer-legend-list",17),o.qCj("allLegendsShown",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&q){const m=o.GaO();o.E7m("allowShowAllLegends",m.allowShowAllLegends)("showAllLegendsValue",o.kDX(1,4,m.showAllLegendsValue$))("excludeBaseLayers",m.excludeBaseLayers)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)}}function gt(q,k){}function rt(q,k){1&q&&o.yuY(0,gt,0,0,"ng-template")}function ao(q,k){if(1&q&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,m.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible")," ")}}function Oi(q,k){1&q&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&q&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function lo(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",22),o.C$Y()(),o.gRP(),o.I0R(4,"span",23),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function oo(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",24),o.C$Y()(),o.gRP(),o.I0R(4,"span",25),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function Vi(q,k){if(1&q){const m=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",26),o.C$Y()(),o.gRP(),o.I0R(4,"span",27),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&q&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function cr(q,k){if(1&q&&(o.I0R(0,"mat-list")(1,"p",18),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,Oi,3,3,"p",6)(5,lo,7,3,"mat-list-item",19)(6,oo,7,3,"mat-list-item",19)(7,Vi,7,3,"mat-list-item",19),o.C$Y()),2&q){const m=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function ur(q,k){if(1&q&&o.yuY(0,cr,8,7,"mat-list",19),2&q){const m=o.GaO();o.E7m("ngIf",m.delayedShowEmptyMapContent)}}let si=class Da{layerListToolState;toolState;mapState;searchSourceService;importExportState;layers$=new d.g([]);showAllLegendsValue$=new d.g(!1);resolution$$;visibleOrInRangeLayers$$;delayedShowEmptyMapContent=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;selectedTabAtOpening;ogcButton=!0;timeButton=!0;layerAdditionAllowed=!0;get layerListControls(){return this._layerListControls}set layerListControls(k){const m=this.layerListToolState.getLayerListControls(),O=m.keyword,$=m.onlyVisible,ie=m.sortAlpha;k.keyword=""!==O?O:k.keyword,k.onlyVisible=void 0!==$?$:k.onlyVisible,k.sortAlpha=void 0!==ie?ie:k.sortAlpha,k.onlyVisible=void 0!==k.onlyVisible&&k.onlyVisible,k.sortAlpha=void 0!==k.sortAlpha&&k.sortAlpha,this._layerListControls=k}_layerListControls={};get map(){return this.mapState.map}queryBadge=!1;get visibleOrInRangeLayers$(){return this.layers$.pipe((0,go.k)(k=>k.filter(m=>m.visible$.value&&m.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,go.k)(k=>k.filter(m=>m.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const k=Object.assign({showToolbar:p.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.g7B.always:k.showToolbar=p.g7B.always;break;case p.g7B.never:k.showToolbar=p.g7B.never}return k}tabGroup;get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.ayN).filter(k=>k.available&&"Layer"===k.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(k,m,O,$,ie){this.layerListToolState=k,this.toolState=m,this.mapState=O,this.searchSourceService=$,this.importExportState=ie}ngOnInit(){this.selectedTab(),this.resolution$$=(0,no.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,Xo.o)(10)).subscribe(k=>{this.layers$.next(k[0].filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>this.delayedShowEmptyMapContent=!0,250)}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}onShowAllLegends(k){this.mapState.showAllLegendsValue=k,this.showAllLegendsValue$.next(k)}selectedTab(){const k=this.layerListToolState.selectedTab$.value;this.layerListToolState.setSelectedTab(void 0!==k?k:"legend"===this.selectedTabAtOpening?1:0)}tabChanged(k){this.layerListToolState.setSelectedTab(k.index),this.layers$.next(this.map.layers.filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}onLayerListChange(k){this.layerListToolState.setKeyword(k.keyword),this.layerListToolState.setSortAlpha(k.sortAlpha),this.layerListToolState.setOnlyVisible(k.onlyVisible)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let k;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(m=>{k=0!==m.length}),!1===k)return!1}return!0}activateExport(k){let m=k.id;k.options.workspace?.workspaceId&&(m=k.options.workspace.workspaceId!==k.id?k.options.workspace.workspaceId:k.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(so.export),this.toolState.toolbox.activateTool("importExport")}activateTimeFilter(){this.toolState.toolbox.activateTool("activeTimeFilter")}activateOgcFilter(){this.toolState.toolbox.activateTool("activeOgcFilter")}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}isTimeFilterButton(k){const m=k.dataSource.options;return this.timeButton&&m.timeFilterable&&m.timeFilter}isOGCFilterButton(k){const m=k.dataSource.options;return this.ogcButton&&m.ogcFilters&&m.ogcFilters.enabled&&(m.ogcFilters.pushButtons||m.ogcFilters.checkboxes||m.ogcFilters.radioButtons||m.ogcFilters.select||m.ogcFilters.autocomplete||m.ogcFilters.editable)}isExportButton(k){return!!(k instanceof p.Mdo&&!0===k.exportable||k.dataSource.options.download&&k.dataSource.options.download.url||k.options.workspace?.enabled&&k.options.workspace?.workspaceId!==k.id)}isStyleEditButton(k){return!!(k instanceof p.Mdo&&k.options?.igoStyle?.editable)}static \u0275fac=function(m){return new(m||Da)(o.GI1(Yt),o.GI1(Mt),o.GI1(pt),o.GI1(p.i6q),o.GI1(to))};static \u0275cmp=o.In1({type:Da,selectors:[["igo-map-tools"]],viewQuery:function(m,O){if(1&m&&o.CC$(Ce,7),2&m){let $;o.wto($=o.Gqi())&&(O.tabGroup=$.first)}},inputs:{allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",selectedTabAtOpening:"selectedTabAtOpening",ogcButton:"ogcButton",timeButton:"timeButton",layerAdditionAllowed:"layerAdditionAllowed",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:17,vars:23,consts:[[3,"selectedIndex","selectedTabChange"],["tabGroup",""],[3,"label"],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort",4,"ngIf","ngIfElse"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort"],["igoLayerItemToolbar",""],[3,"layer",4,"ngIf"],[3,"layer"],[3,"trackFeature","layer"],[3,"header","layer","click",4,"ngIf"],[3,"layer","click",4,"ngIf"],[3,"header","layer","click"],[3,"layer","click"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,O){if(1&m&&(o.I0R(0,"mat-tab-group",0,1),o.qCj("selectedTabChange",function(ie){return O.tabChanged(ie)}),o.wVc(2,"async"),o.I0R(3,"mat-tab",2),o.wVc(4,"translate"),o.yuY(5,Dt,3,7,"igo-layer-list",3),o.wVc(6,"async"),o.C$Y(),o.I0R(7,"mat-tab",2),o.wVc(8,"translate"),o.yuY(9,wt,2,6,"igo-layer-legend-list",4)(10,rt,1,0,null,5),o.wVc(11,"async"),o.yuY(12,ao,5,7,"p",6),o.wVc(13,"async"),o.wVc(14,"async"),o.C$Y(),o.yuY(15,ur,1,1,"ng-template",null,7,o.gJz),o.C$Y()),2&m){const $=o.Gew(16);o.E7m("selectedIndex",o.kDX(2,9,O.layerListToolState.selectedTab$)),o.yG2(3),o.E7m("label",o.kDX(4,11,"igo.integration.tools.layers")),o.yG2(2),o.E7m("ngIf",0!==o.kDX(6,13,O.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("label",o.kDX(8,15,"igo.integration.tools.legend")),o.yG2(2),o.E7m("ngIf",O.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(11,17,O.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!O.allowShowAllLegends&&0!==o.kDX(13,19,O.layers$).length&&0===o.kDX(14,21,O.visibleOrInRangeLayers$).length)}},dependencies:[vo.WG,vo.aJ,vo._q,T.u_,p.m2U,p.Ult,p.iOO,p.Idw,p.ktW,p.eM$,p.Ga$,p.O_6,ni,p.wSE,p.ApN,Nt.iI,Nt.oL,Nt.g9,Nt.Y1,Nt.UV,Et.oB,Et.qL,T.a,ut._s,Ze.sD],styles:["[_nghost-%COMP%]   mat-tab-group[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{flex:1}[_nghost-%COMP%]     .mat-tab-body{margin-top:8px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"],changeDetection:0})};si=(0,at.UN)([(0,Pt.aA)({name:"mapTools",title:"igo.integration.tools.map",icon:"map"}),(0,at.YR)("design:paramtypes",[Yt,Mt,pt,p.i6q,to])],si);let ho=(()=>{class q{mapState;store;constructor(m){this.mapState=m,this.store=new p.ym_([],{map:this.mapState.map}),this.mapState.map.layers$.subscribe(O=>{0===O.filter($=>$.id?.startsWith("igo-measures-")).length&&(this.store.deleteMany(this.store.all()),this.mapState.map.ol.getOverlays().getArray().filter($=>$.options.className.includes("igo-map-tooltip")).map($=>this.mapState.map.ol.removeOverlay($)))})}static \u0275fac=function(O){return new(O||q)(o.CoB(pt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Po=class Fa{measureState;mapState;get store(){return this.measureState.store}get map(){return this.mapState.map}constructor(k,m){this.measureState=k,this.mapState=m}static \u0275fac=function(m){return new(m||Fa)(o.GI1(ho),o.GI1(pt))};static \u0275cmp=o.In1({type:Fa,selectors:[["igo-measurer-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:2,consts:[[3,"store","map"]],template:function(m,O){1&m&&o.wR5(0,"igo-measurer",0),2&m&&o.E7m("store",O.store)("map",O.map)},dependencies:[p.yaV],encapsulation:2,changeDetection:0})};Po=(0,at.UN)([(0,Pt.aA)({name:"measurer",title:"igo.integration.tools.measurer",icon:"square_foot"}),(0,at.YR)("design:paramtypes",[ho,pt])],Po);let Ht=class Pa{mapState;get map(){return this.mapState.map}constructor(k){this.mapState=k}static \u0275fac=function(m){return new(m||Pa)(o.GI1(pt))};static \u0275cmp=o.In1({type:Pa,selectors:[["igo-print-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(m,O){1&m&&o.wR5(0,"igo-print",0),2&m&&o.E7m("map",O.map)},dependencies:[p.eAF],encapsulation:2})};Ht=(0,at.UN)([(0,Pt.aA)({name:"print",title:"igo.integration.tools.print",icon:"print"}),(0,at.YR)("design:paramtypes",[pt])],Ht);var ji=r(50032),pn=r(94688),jr=r(12472);let Ki=(()=>{class q{searchSourceService;storageService;workspaceState;configService;mapState;searchLayerStores=[];searchOverlayStyle={};searchOverlayStyleSelection={};searchOverlayStyleFocus={};focusedOrResolution$$;selectedOrResolution$$;featureMotion={selected:p.Suj.Default,focus:p.Suj.None};searchTermSplitter$=new d.g("|");searchTerm$=new d.g(void 0);searchType$=new d.g(void 0);searchDisabled$=new d.g(!1);searchResultsGeometryEnabled$=new d.g(!1);searchSettingsChange$=new d.g(void 0);selectedResult$=new d.g(void 0);store=new E.qc([]);get searchTypes(){return this.searchSourceService.getEnabledSources().map(m=>m.constructor.type)}constructor(m,O,$,ie,Se){this.searchSourceService=m,this.storageService=O,this.workspaceState=$,this.configService=ie,this.mapState=Se;const Ne=this.configService.getConfig("searchOverlayStyle");Ne&&(this.searchOverlayStyle=Ne.base,this.searchOverlayStyleSelection=Ne.selection,this.searchOverlayStyleFocus=Ne.focus);const it=this.storageService.get("searchResultsGeometryEnabled");it&&this.searchResultsGeometryEnabled$.next(it),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const mt=this.searchSourceService.getSources().find(ht=>"workspace"===ht.getId());mt&&this.workspaceState.store.entities$.subscribe(ht=>{const At=ht.filter(Ot=>Ot instanceof p.Wwb&&Ot.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(mt,At)}),this.monitorLayerDeletion()}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(m=>{this.searchLayerStores.forEach(O=>{if(!m.find(ie=>ie.id===O.layer.id)){const ie=this.searchLayerStores.indexOf(O);this.searchLayerStores.splice(ie,1)}})})}createCustomFilterTermStrategy(){return new E.qq({filterClauseFunc:O=>100===O.entity.meta.score})}activateCustomFilterTermStrategy(){const m=this.store.getStrategyOfType(E.qq);void 0!==m&&m.activate()}deactivateCustomFilterTermStrategy(){const m=this.store.getStrategyOfType(E.qq);void 0!==m&&m.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(m){this.searchTerm$.next(m)}setSearchType(m){this.searchSourceService.enableSourcesByType(m),this.searchType$.next(m)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(m){this.selectedResult$.next(m)}setSearchResultsGeometryStatus(m){this.storageService.set("searchResultsGeometryEnabled",m),this.searchResultsGeometryEnabled$.next(m)}static \u0275fac=function(O){return new(O||q)(o.CoB(p.i6q),o.CoB(w.yQ),o.CoB(jo),o.CoB(xt.aW),o.CoB(pt))};static \u0275prov=o.wxM({token:q,factory:q.\u0275fac})}return q})();function Ii(q,k){1&q&&(o.I0R(0,"div",2)(1,"section",3)(2,"h4")(3,"strong"),o.OEk(4),o.wVc(5,"translate"),o.C$Y()(),o.I0R(6,"p")(7,"strong"),o.OEk(8),o.wVc(9,"translate"),o.C$Y()(),o.wR5(10,"div",4),o.wVc(11,"sanitizeHtml"),o.wVc(12,"translate"),o.C$Y()()),2&q&&(o.yG2(4),o.cNF(o.kDX(5,3,"igo.integration.searchResultsTool.noResults")),o.yG2(4),o.cNF(o.kDX(9,5,"igo.integration.searchResultsTool.doSearch")),o.yG2(2),o.E7m("innerHTML",o.kDX(11,7,o.kDX(12,9,"igo.integration.searchResultsTool.examples")),o.E3n))}function Ut(q,k){if(1&q&&o.wR5(0,"igo-search-add-button",12),2&q){const m=k.result,O=o.GaO(2);o.E7m("map",O.map)("store",O.store)("stores",O.stores)("layer",m)("saveSearchResultInLayer",O.saveSearchResultInLayer)}}function Kr(q,k){if(1&q){const m=o.KQA();o.I0R(0,"button",17),o.qCj("click",function(){o.usT(m);const $=o.GaO(3);return o.CGJ($.zoomToFeatureExtent())}),o.wVc(1,"translate"),o.wVc(2,"async"),o.I0R(3,"mat-icon",18),o.wVc(4,"async"),o.wVc(5,"async"),o.OEk(6,"zoom_in"),o.C$Y()()}if(2&q){const m=o.GaO(3);o.E7m("matTooltip",o.kDX(1,3,o.kDX(2,5,m.isSelectedResultOutOfView$)?"igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView":"igo.integration.searchResultsTool.zoomOnFeatureTooltip")),o.yG2(3),o.E7m("matBadge",o.kDX(4,7,m.isSelectedResultOutOfView$)?"!":"")("matBadgeHidden",!1===o.kDX(5,9,m.isSelectedResultOutOfView$))}}function Wr(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-panel",13),o.qCj("click",function($){o.usT(m);const ie=o.GaO(2);return o.CGJ(ie.toggleTopPanel($))}),o.I0R(1,"button",14),o.qCj("click",function(){o.usT(m);const $=o.GaO(2);return o.CGJ($.toggleTopPanel())}),o.I0R(2,"mat-icon"),o.OEk(3),o.wVc(4,"async"),o.C$Y()(),o.yuY(5,Kr,7,11,"button",15),o.I0R(6,"igo-feature-details",16),o.qCj("routingEvent",function(){o.usT(m);const $=o.GaO(2);return o.CGJ($.getRoute())}),o.wVc(7,"async"),o.C$Y()()}if(2&q){const m=o.GaO(2);o.E7m("title",m.featureTitle)("cursorPointer",!0),o.yG2(3),o.cNF("collapsed"===o.kDX(4,7,m.topPanelState$)?"arrow_upward":"arrow_downward"),o.yG2(2),o.E7m("ngIf",m.feature.geometry),o.yG2(),o.E7m("feature",o.kDX(7,9,m.feature$))("map",m.map)("toolbox",m.toolState.toolbox)}}function wi(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-flexible",5,6),o.wVc(2,"async"),o.I0R(3,"div",7)(4,"igo-search-results",8),o.qCj("resultFocus",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onResultFocus($))})("resultSelect",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onResultSelect($))})("resultUnfocus",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onResultUnfocus($))})("resultMouseenter",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onResultFocus($))})("resultMouseleave",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onResultUnfocus($))})("moreResults",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onSearch($))}),o.yuY(5,Ut,1,5,"ng-template",null,9,o.gJz),o.C$Y()(),o.I0R(7,"div",10),o.yuY(8,Wr,8,11,"igo-panel",11),o.wVc(9,"async"),o.C$Y()()}if(2&q){const m=o.GaO();o.E7m("state",o.kDX(2,8,m.feature$)?m.topPanelState:"initial"),o.yG2(4),o.E7m("store",m.store)("showIcons",m.showIcons)("term",m.term)("termSplitter",m.termSplitter)("settingsChange$",m.settingsChange$)("map",m.map),o.yG2(4),o.E7m("ngIf",o.kDX(9,10,m.feature$))}}let Nr=class Ra{mapState;searchState;elRef;toolState;directionState;showIcons=!0;topPanelStateDefault="expanded";hasFeatureEmphasisOnSelection=!1;saveSearchResultInLayer=!1;showResultsGeometries$$;getRoute$$;shownResultsGeometries=[];shownResultsEmphasisGeometries=[];focusedResult$=new d.g(void 0);isSelectedResultOutOfView$=new d.g(!1);isSelectedResultOutOfView$$;abstractFocusedResult;abstractSelectedResult;debouncedEmpty$=new d.g(!0);debouncedEmpty$$;get store(){return this.searchState.store}get map(){return this.mapState.map}get featureTitle(){return this.feature?(0,E.YB)(this.feature):void 0}get feature$(){return this.store.stateView.firstBy$(k=>k.state.focused).pipe((0,go.k)(k=>this.feature=k?k.entity.data:void 0))}feature;term="";searchTerm$$;settingsChange$=new d.g(void 0);topPanelState$=new d.g("initial");topPanelState$$;set topPanelState(k){this.topPanelState$.next(k)}get topPanelState(){return this.topPanelState$.value}get termSplitter(){return this.searchState.searchTermSplitter$.value}format=new te.c;get stores(){return this.searchState.searchLayerStores}constructor(k,m,O,$,ie,Se){this.mapState=k,this.searchState=m,this.elRef=O,this.toolState=$,this.directionState=ie,this.hasFeatureEmphasisOnSelection=Se.getConfig("hasFeatureEmphasisOnSelection"),this.saveSearchResultInLayer=Se.getConfig("saveSearchResultInLayer")}ngOnInit(){this.searchTerm$$=this.searchState.searchTerm$.subscribe(k=>{null!=k&&""!==k?(this.term=k,this.debouncedEmpty$.next(!1)):""===k&&this.debouncedEmpty$.next(!0)});for(const k of this.store.stateView.all$().value)!0===this.store.state.get(k.entity).selected&&(this.topPanelState="expanded");this.searchState.searchSettingsChange$.subscribe(()=>{this.settingsChange$.next(!0)}),this.topPanelState$$=this.topPanelState$.subscribe(()=>{const k=this.computeElementRef()[0],m=this.computeElementRef()[1];m&&setTimeout(()=>{this.isScrolledIntoView(k,m)||this.adjustTopPanel(k,m)},pn.K.transitionTime+50)}),this.hasFeatureEmphasisOnSelection&&(this.searchState.focusedOrResolution$$||(this.searchState.focusedOrResolution$$=(0,no.E)([this.focusedResult$,this.map.viewController.resolution$]).subscribe(k=>this.buildResultEmphasis(k[0],"focused"))),this.searchState.selectedOrResolution$$||(this.searchState.selectedOrResolution$$=(0,no.E)([this.searchState.selectedResult$,this.map.viewController.resolution$]).subscribe(k=>this.buildResultEmphasis(k[0],"selected")))),this.monitorResultOutOfView(),this.showResultsGeometries$$=(0,no.E)([this.searchState.searchResultsGeometryEnabled$,this.store.stateView.all$(),this.focusedResult$,this.searchState.selectedResult$,this.searchState.searchTerm$,this.map.viewController.resolution$]).subscribe(k=>{const m=k[0],O=k[1];this.hasFeatureEmphasisOnSelection&&this.clearFeatureEmphasis("shown"),this.shownResultsGeometries.map(ie=>this.map.queryResultsOverlay.removeFeature(ie)),O.filter(ie=>ie.entity.meta.dataType===p.YfI&&ie.entity.data.geometry&&!ie.state.selected&&!ie.state.focused).map(ie=>{m&&(ie.entity.data.meta.style=(0,p.IvV)(Object.assign({},{feature:ie.entity.data},this.searchState.searchOverlayStyle,ie.entity.style?.base?ie.entity.style.base:{})),this.shownResultsGeometries.push(ie.entity.data),this.map.queryResultsOverlay.addFeature(ie.entity.data,p.Suj.None),this.hasFeatureEmphasisOnSelection&&this.buildResultEmphasis(ie.entity,"shown"))})}),this.debouncedEmpty$$=this.store.stateView.empty$.pipe((0,Xo.o)(1500)).subscribe(k=>this.debouncedEmpty$.next(k))}monitorResultOutOfView(){this.isSelectedResultOutOfView$$=(0,no.E)([this.map.viewController.state$,this.searchState.selectedResult$]).pipe((0,Xo.o)(100)).subscribe(k=>{const m=k[1];if(m){if(m.data.geometry){const O=(0,p.K6O)(m.data,this.map.projection),$=(0,p.q17)([O],this.map.viewController.getOlProjection());this.isSelectedResultOutOfView$.next((0,p.Ki0)(this.map.getExtent(),$))}}else this.isSelectedResultOutOfView$.next(!1)})}buildResultEmphasis(k,m){if("shown"!==m&&this.clearFeatureEmphasis(m),!k||!k.data.geometry)return;const $=(0,p.K6O)(k.data,this.map.projection).getGeometry();if((0,p.Yvl)(this.map.viewController,$.getExtent(),.0025)){const ie=$.getExtent(),it=new se.c({name:`${m}AbstractResult'`,geometry:new Re.c([ie[0]+(ie[2]-ie[0])/2,ie[1]+(ie[3]-ie[1])/2])}),mt=(0,p.qKz)(it,this.map.projection);let ht,At=0;switch(m){case"focused":ht=(0,p._aW)(Object.assign({},{feature:mt},this.searchState.searchOverlayStyleFocus,k.style?.focus?k.style.focus:{})),At=2;break;case"shown":ht=(0,p.IvV)(Object.assign({},{feature:mt},this.searchState.searchOverlayStyle,k.style?.base?k.style.base:{}));break;case"selected":ht=(0,p._aW)(Object.assign({},{feature:mt},this.searchState.searchOverlayStyleSelection,k.style?.selection?k.style.selection:{})),At=1}mt.meta.style=ht,mt.meta.style.setZIndex(2e3+At),this.map.searchResultsOverlay.addFeature(mt,this.searchState.featureMotion.focus),"focused"===m&&(this.abstractFocusedResult=mt),"selected"===m&&(this.abstractSelectedResult=mt),"shown"===m&&this.shownResultsEmphasisGeometries.push(mt)}else this.clearFeatureEmphasis(m)}clearFeatureEmphasis(k){"focused"===k&&this.abstractFocusedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult),this.abstractFocusedResult=void 0),"selected"===k&&this.abstractSelectedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult),this.abstractSelectedResult=void 0),"shown"===k&&(this.shownResultsEmphasisGeometries.map(m=>this.map.searchResultsOverlay.removeFeature(m)),this.shownResultsEmphasisGeometries=[])}ngOnDestroy(){this.topPanelState$$.unsubscribe(),this.searchTerm$$.unsubscribe(),this.isSelectedResultOutOfView$$&&this.isSelectedResultOutOfView$$.unsubscribe(),this.showResultsGeometries$$&&this.showResultsGeometries$$.unsubscribe(),this.getRoute$$&&this.getRoute$$.unsubscribe(),this.debouncedEmpty$$&&this.debouncedEmpty$$.unsubscribe()}onResultFocus(k){if(this.focusedResult$.next(k),k.meta.dataType===p.YfI&&k.data.geometry){k.data.meta.style=(0,p._aW)(Object.assign({},{feature:k.data},this.searchState.searchOverlayStyleFocus,k.style?.focus?k.style.focus:{}));const m=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(k.meta.id);if(m)return void m.setStyle(k.data.meta.style);this.map.searchResultsOverlay.addFeature(k.data,this.searchState.featureMotion.focus)}}onResultUnfocus(k){if(this.focusedResult$.next(void 0),k.meta.dataType===p.YfI){if(!0===this.store.state.get(k).selected){const m=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(k.meta.id);if(m){const O=(0,p._aW)(Object.assign({},{feature:k.data},this.searchState.searchOverlayStyleFocus,k.style?.focus?k.style.focus:{}));m.setStyle(O)}return}this.map.searchResultsOverlay.removeFeature(k.data)}}onResultSelect(k){if(this.map.searchResultsOverlay.dataSource.ol.clear(),this.tryAddFeatureToMap(k,this.searchState.featureMotion.selected),this.searchState.setSelectedResult(k),"initial"===this.topPanelState&&(this.topPanelState="collapsed"!==this.topPanelStateDefault?"expanded":"collapsed"),"expanded"===this.topPanelState){const m=this.computeElementRef()[0],O=this.computeElementRef()[1];this.isScrolledIntoView(m,O)||this.adjustTopPanel(m,O)}}onSearch(k){const m=k.results,O=this.store.entities$.value.filter($=>$.source!==k.research.source).concat(m);this.store.load(O);for(const $ of this.store.all())!0===this.store.state.get($).focused&&!0!==this.store.state.get($).selected&&this.store.state.update($,{focused:!1},!0);setTimeout(()=>{const $=this.elRef.nativeElement.querySelector("igo-list");let ie;k.research.request.subscribe(Se=>{ie=Se[0]&&Se[0].source?"icherche"===Se[0].source.getId()?$.querySelector(".icherche .moreResults"):"ilayer"===Se[0].source.getId()?$.querySelector(".ilayer .moreResults"):"nominatim"===Se[0].source.getId()?$.querySelector(".nominatim .moreResults"):$.querySelector("."+Se[0].source.getId()+" .moreResults"):null,null!==ie&&!this.isScrolledIntoView($,ie)&&($.scrollTop=ie.offsetTop+ie.offsetHeight-$.clientHeight)})},250)}computeElementRef(){const k=document.getElementsByTagName("igo-search-results-item"),m=this.elRef.nativeElement.getElementsByTagName("igo-list")[0];let O;for(let $=0;$<k.length;$++)k[$].className.includes("igo-list-item-selected")&&(O=k[$]);return[m,O]}adjustTopPanel(k,m){this.isScrolledIntoView(k,m)||(k.scrollTop=m.offsetTop+m.children[0].offsetHeight-k.clientHeight)}toggleTopPanel(k){k&&"igo-panel-title"!==k.target?.className||(this.topPanelState="expanded"===this.topPanelState?"collapsed":"expanded")}zoomToFeatureExtent(){if(this.feature.geometry){const k=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projectionCode});(0,p.QX5)(this.map.viewController,[k],p.Suj.Zoom)}}tryAddFeatureToMap(k,m=p.Suj.Default){if(k.meta.dataType!==p.YfI)return;const O=k.data;O.geometry&&(O.meta.style=(0,p._aW)(Object.assign({},{feature:O},this.searchState.searchOverlayStyleSelection,k.style?.selection?k.style.selection:{})),this.map.searchResultsOverlay.addFeature(O,m))}isScrolledIntoView(k,m){const $=k.scrollTop,Se=m.offsetTop;return Se+m.clientHeight+6<=$+k.clientHeight&&Se>=$}getRoute(){this.toolState.toolbox.activateTool("directions"),this.directionState.stopsStore.clearStops(),setTimeout(()=>{let k=!1;this.getRoute$$&&this.getRoute$$.unsubscribe(),this.getRoute$$=this.directionState.stopsStore.storeInitialized$.subscribe(m=>{if(this.directionState.stopsStore.storeInitialized$.value&&!k){k=!0;const O=this.directionState.stopsStore.all().find(ie=>1===ie.position);let $;if(this.feature.geometry)if("Point"===this.feature.geometry.type)$=[this.feature.geometry.coordinates[0],this.feature.geometry.coordinates[1]];else{const ie=(0,jr.c)(this.feature.geometry);$=[ie.geometry.coordinates[0],ie.geometry.coordinates[1]]}if(O.text=this.featureTitle,O.coordinates=$,this.directionState.stopsStore.update(O),this.map.geolocationController.position$.value){const ie=this.map.geolocationController.position$.value,Se=this.directionState.stopsStore.all().find(mt=>0===mt.position),Ne=ze.AF(ie.position,ie.projection,"EPSG:4326"),it=(0,p.uEw)([Ne[0],Ne[1]],6);Se.text=it.join(","),Se.coordinates=it,this.directionState.stopsStore.update(Se)}}})},250)}static \u0275fac=function(m){return new(m||Ra)(o.GI1(pt),o.GI1(Ki),o.GI1(o.GMv),o.GI1(Mt),o.GI1(De),o.GI1(xt.aW))};static \u0275cmp=o.In1({type:Ra,selectors:[["igo-search-results-tool"]],inputs:{showIcons:"showIcons",topPanelStateDefault:"topPanelStateDefault",topPanelState:"topPanelState"},standalone:!0,features:[o.UHJ],decls:4,vars:6,consts:[["style","margin: 10px",4,"ngIf"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state",4,"ngIf"],[2,"margin","10px"],[1,"mat-typography"],[3,"innerHTML"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state"],["topPanel",""],[1,"igo-content"],["placeholder","false",3,"store","showIcons","term","termSplitter","settingsChange$","map","resultFocus","resultSelect","resultUnfocus","resultMouseenter","resultMouseleave","moreResults"],["igoSearchItemToolbar",""],["igoFlexibleFill","",1,"igo-content"],[3,"title","cursorPointer","click",4,"ngIf"],[3,"map","store","stores","layer","saveSearchResultInLayer"],[3,"title","cursorPointer","click"],["mat-icon-button","","panelLeftButton","",1,"igo-icon-button",3,"click"],["mat-icon-button","","panelRightButton","","class","igo-icon-button","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoFeatureDetailsDirective","",3,"feature","map","toolbox","routingEvent"],["mat-icon-button","","panelRightButton","","matTooltipShowDelay","500",1,"igo-icon-button",3,"matTooltip","click"],["aria-hidden","false","matBadgeColor","accent","matBadgeSize","small",3,"matBadge","matBadgeHidden"]],template:function(m,O){1&m&&(o.yuY(0,Ii,13,11,"div",0),o.wVc(1,"async"),o.yuY(2,wi,10,12,"igo-flexible",1),o.wVc(3,"async")),2&m&&(o.E7m("ngIf",(!O.store||O.store.stateView.empty)&&o.kDX(1,2,O.debouncedEmpty$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(3,4,O.debouncedEmpty$)))},dependencies:[T.u_,pn.K,p.kBh,p.qE2,a.c,z.oJ,z.um,Et.oB,Et.qL,yt.KO,yt.a4,ji.g,ji.S,p.wP$,T.a,ut._s,Ze.sD,Oo.Ux],encapsulation:2,changeDetection:0})};Nr=(0,at.UN)([(0,Pt.aA)({name:"searchResults",title:"igo.integration.tools.searchResults",icon:"search"}),(0,at.YR)("design:paramtypes",[pt,Ki,o.GMv,Mt,De,xt.aW])],Nr);var dr=r(13428),pr=r(17536);function mn(q,k){1&q&&o.wR5(0,"igo-form-field",8),2&q&&o.E7m("field",k.$implicit)}function Hr(q,k){if(1&q&&(o.I0R(0,"div",6),o.yuY(1,mn,1,1,"igo-form-field",7),o.C$Y()),2&q){const m=o.GaO().ngIf;o.yG2(),o.E7m("ngForOf",m.fields)}}function mr(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-form",1),o.qCj("submitForm",function($){o.usT(m);const ie=o.GaO();return o.CGJ(ie.onSubmit($))}),o.wVc(1,"async"),o.yuY(2,Hr,2,1,"div",2),o.I0R(3,"div",3)(4,"button",4),o.qCj("click",function(){o.usT(m);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"button",5),o.OEk(8),o.wVc(9,"translate"),o.C$Y()()()}if(2&q){const m=k.ngIf,O=o.GaO();o.E7m("form",m)("formData",o.kDX(1,6,O.data$)),o.yG2(2),o.E7m("ngIf",m.fields.length),o.yG2(3),o.oRS(" ",o.kDX(6,8,"igo.integration.dataIssueReporterTool.reset.button")," "),o.yG2(2),o.E7m("disabled",O.submitDisabled),o.yG2(),o.oRS(" ",o.kDX(9,10,"igo.integration.dataIssueReporterTool.submit.button")," ")}}let zr=class La{mapState;formService;languageService;messageService;httpClient;url;get map(){return this.mapState.map}form$=new d.g(void 0);data$=new d.g(void 0);submitDisabled=!0;valueChanges$$;constructor(k,m,O,$,ie){this.mapState=k,this.formService=m,this.languageService=O,this.messageService=$,this.httpClient=ie}ngOnInit(){(0,no.E)([this.languageService.language$,this.map.layers$]).subscribe(([k,m])=>{const O=m.filter(Ne=>Ne.baseLayer||Ne.showInLayerList).map(Ne=>({value:`${Ne.title}-${Ne.id}`,title:Ne.title})),ie=[{name:"geometry",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.geometry"),type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!1,drawGuide:0,drawGuidePlaceholder:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.drawGuidePlaceholder"),drawStyle:new N.cp({stroke:new K.c({color:[255,0,0,1],width:2}),fill:new j.c({color:[255,0,0,.2]}),image:new A.c({radius:8,stroke:new K.c({color:[255,0,0,1]}),fill:new j.c({color:[255,0,0,.2]})})}),overlayStyle:new N.cp({stroke:new K.c({color:[0,255,0,1],width:2}),fill:new j.c({color:[0,255,0,.2]}),image:new A.c({radius:8,stroke:new K.c({color:[0,255,0,1]}),fill:new j.c({color:[0,255,0,.2]})})})}},{name:"layer",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.layer"),type:"select",options:{cols:2},inputs:{choices:O}},{name:"desc",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.description"),type:"textarea",options:{validator:Q.AQ.required}},{name:"email",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.email"),options:{validator:Q.AQ.email}}].map(Ne=>this.formService.field(Ne)),Se=this.formService.form(ie,[]);this.valueChanges$$=Se.control.valueChanges.subscribe(()=>{this.submitDisabled=!Se.control.valid}),this.form$.next(Se)})}ngOnDestroy(){this.valueChanges$$.unsubscribe()}clearForm(){this.form$.value.control.reset()}onSubmit(k){const m="igo.integration.dataIssueReporterTool.submit.title";this.url?(this.httpClient.post(this.url,k).subscribe(()=>{this.messageService.success("igo.integration.dataIssueReporterTool.submit.message",m)}),this.clearForm()):(this.messageService.alert("igo.integration.dataIssueReporterTool.submit.setupMessage",m),alert(JSON.stringify(k)))}static \u0275fac=function(m){return new(m||La)(o.GI1(pt),o.GI1(Y.eO),o.GI1(ut.ov),o.GI1(qe.mi),o.GI1(Ft.KK))};static \u0275cmp=o.In1({type:La,selectors:[["igo-issue-reporter-tool"]],inputs:{url:"url"},decls:2,vars:3,consts:[[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-container",4,"ngIf"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"],[1,"form-container"],[3,"field",4,"ngFor","ngForOf"],[3,"field"]],template:function(m,O){1&m&&(o.yuY(0,mr,10,12,"igo-form",0),o.wVc(1,"async")),2&m&&o.E7m("ngIf",o.kDX(1,1,O.form$))},dependencies:[T.ay,T.u_,z.Gw,dr._,pr.Y,T.a,Ze.sD],styles:["[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%]{display:block;height:auto}"]})};zr=(0,at.UN)([(0,Pt.aA)({name:"dataIssueReporter",title:"igo.integration.tools.dataIssueReporter",icon:"feedback"}),(0,at.YR)("design:paramtypes",[pt,Y.eO,ut.ov,qe.mi,Ft.KK])],zr),r(84808);var Jr=r(60336),gn=r(93244),hr=r(6560),Qr=r(23416);let fr=(()=>{class q{overlay;viewContainerRef;elementRef;overlayRef;sub;menuContext;menuPosition=new o._w7;constructor(m,O,$){this.overlay=m,this.viewContainerRef=O,this.elementRef=$}onContextMenu(m){let O,$;if(m instanceof MouseEvent?(O=m.x,$=m.y):m instanceof TouchEvent&&(O=m.touches[0].pageX,$=m.touches[0].pageY),!O||!$)return;this.close(),m.preventDefault(),this.menuPosition.emit({x:O,y:$}),this.overlayRef=null;const ie=this.overlay.position().flexibleConnectedTo({x:O,y:$}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:ie,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new Jr.CC(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,gn.w)(document,"click").pipe((0,hr.I)(Se=>{const Ne=Se.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(Ne)}),(0,ro.U)(1)).subscribe(()=>this.close()),this.sub=(0,gn.w)(document,"contextmenu").pipe((0,hr.I)(Se=>{const Ne=Se.target;if(Ne&&!this.elementRef.nativeElement.contains(Ne)&&!this.overlayRef.overlayElement.contains(Ne))return!0;Se.preventDefault()}),(0,ro.U)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}static \u0275fac=function(O){return new(O||q)(o.GI1(Qr.mc),o.GI1(o.y8U),o.GI1(o.GMv))};static \u0275dir=o.Sc5({type:q,selectors:[["","igoContextMenu",""]],hostBindings:function(O,$){1&O&&o.qCj("longpress",function(Se){return $.onContextMenu(Se)})("contextmenu",function(Se){return $.onContextMenu(Se)})},inputs:{menuContext:[o.Wk5.None,"igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"},standalone:!0})}return q})(),yr=(()=>{class q{touchTimeout;touchDuration=400;onlyIOS=!0;longpress=new o._w7;constructor(){}touchstart(m){m.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===ii.sX.getOSName()&&this.longpress.emit(m):this.longpress.emit(m)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}static \u0275fac=function(O){return new(O||q)};static \u0275dir=o.Sc5({type:q,selectors:[["","igoLongPress",""]],hostBindings:function(O,$){1&O&&o.qCj("touchstart",function(Se){return $.touchstart(Se)})("touchmove",function(){return $.touchend()})("touchcancel",function(){return $.touchend()})("touchend",function(){return $.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"},standalone:!0})}return q})();var Zr=r(8636),qr=r(69800),es=r(8408),ts=r(71320);const os=["mapBrowser"];function is(q,k){if(1&q&&(o.I0R(0,"span",12),o.OEk(1),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.oRS(" Pointer activated: ",m.igoSearchPointerSummaryEnabled," (F2 activate/deactivate the pointer location). ")}}function ns(q,k){if(1&q&&o.wR5(0,"igo-search-add-button",13),2&q){const m=k.result,O=o.GaO();o.E7m("map",O.map)("layer",m)}}function rs(q,k){if(1&q&&(o.I0R(0,"igo-panel",12),o.wR5(1,"igo-feature-details",14),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.E7m("feature",m.selectedFeature)}}function li(q,k){if(1&q&&o.wR5(0,"igo-actionbar",15),2&q){const m=o.GaO();o.E7m("store",m.store)("withIcon",!1)("horizontal",!0)("mode",m.actionBarMode)}}const ss=()=>["ConfigService","LanguageService"];let as=(()=>{class q{mapService;layerService;searchState;mediaService;storageService;store=new It.MF([]);actionBarMode=It.m0.Context;igoSearchPointerSummaryEnabled=!1;termSplitter="|";map=new p.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};mapBrowser;lonlat;mapProjection;term;settingsChange$=new d.g(void 0);get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}selectedFeature;igoReverseSearchCoordsFormatEnabled;constructor(m,O,$,ie,Se){this.mapService=m,this.layerService=O,this.searchState=$,this.mediaService=ie,this.storageService=Se,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(Ne=>this.map.addLayer(Ne)),this.igoReverseSearchCoordsFormatEnabled=!!this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}onPointerSummaryStatusChange(m){this.igoSearchPointerSummaryEnabled=m}onSearchTermChange(m){this.term=m,this.searchState.setSearchTerm(m),m.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(m){const O=m.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const $=this.searchStore.entities$.value.filter(ie=>ie.source!==m.research.source).concat(O);this.searchStore.updateMany($)}onReverseCoordsFormatStatusChange(m){this.storageService.set("reverseSearchCoordsFormatEnabled",m),this.igoReverseSearchCoordsFormatEnabled=m}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(m){this.tryAddFeatureToMap(m,this.searchState.featureMotion.focus),this.selectedFeature=m.data}onResultSelect(m){this.tryAddFeatureToMap(m,this.searchState.featureMotion.selected),this.selectedFeature=m.data}tryAddFeatureToMap(m,O=p.Suj.Default){m.meta.dataType===p.YfI&&void 0!==m.data.geometry&&this.map.searchResultsOverlay.setFeatures([m.data],O)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(m){const O=this.mapPosition(m),$=this.mapService.getMap().ol.getCoordinateFromPixel(O);this.mapProjection=this.mapService.getMap().projectionCode,this.lonlat=ze.AF($,this.mapProjection,"EPSG:4326")}mapPosition(m){const O=m;return O.y=O.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,O.x=O.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[O.x,O.y]}searchCoordinate(m){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?m.reverse().map(O=>O.toFixed(6)).join(", "):m.map(O=>O.toFixed(6)).join(", ")}openGoogleMaps(m){window.open(p.s9F.getGoogleMapsCoordLink(m[0],m[1]))}openGoogleStreetView(m){window.open(p.s9F.getGoogleStreetViewLink(m[0],m[1]))}static \u0275fac=function(O){return new(O||q)(o.GI1(p.u00),o.GI1(p.IZ6),o.GI1(Ki),o.GI1(U.QB),o.GI1(w.yQ))};static \u0275cmp=o.In1({type:q,selectors:[["app-search"]],viewQuery:function(O,$){if(1&O&&o.CC$(os,7,o.GMv),2&O){let ie;o.wto(ie=o.Gqi())&&($.mapBrowser=ie.first)}},standalone:!0,features:[o.M5G([(0,p.WIT)([(0,p.WmN)(),(0,p.WWf)()],{analytics:!0}),Ki]),o.UHJ],decls:15,vars:19,consts:[["title","Search","subtitle","Geo",3,"dependencies"],["codeFolder","geo/search","configFolder","environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(O,$){if(1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.yuY(2,is,2,1,"span",2),o.I0R(3,"igo-map-browser",3,4),o.qCj("menuPosition",function(Se){return $.onContextMenuOpen(Se)}),o.I0R(5,"div",5),o.wR5(6,"igo-zoom-button",6),o.C$Y()(),o.I0R(7,"igo-panel",7)(8,"igo-search-bar",8),o.qCj("pointerSummaryStatus",function(Se){return $.onPointerSummaryStatusChange(Se)})("searchTermChange",function(Se){return $.onSearchTermChange(Se)})("search",function(Se){return $.onSearch(Se)})("clearFeature",function(){return $.removeFeatureFromMap()})("searchSettingsChange",function(){return $.onSearchSettingsChange()})("reverseSearchCoordsFormatStatus",function(Se){return $.onReverseCoordsFormatStatusChange(Se)}),o.C$Y(),o.I0R(9,"igo-search-results",9),o.qCj("resultFocus",function(Se){return $.onResultFocus(Se)})("resultSelect",function(Se){return $.onResultSelect(Se)})("moreResults",function(Se){return $.onSearch(Se)}),o.yuY(10,ns,1,2,"ng-template",null,10,o.gJz),o.C$Y()(),o.yuY(12,rs,2,1,"igo-panel",2)(13,li,1,4,"ng-template",null,11,o.gJz),o.C$Y()()),2&O){const ie=o.Gew(14);o.E7m("dependencies",o.q4q(18,ss)),o.yG2(2),o.E7m("ngIf",!$.isTouchScreen),o.yG2(),o.E7m("map",$.map)("view",$.view)("igoContextMenu",ie)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",$.igoSearchPointerSummaryEnabled),o.yG2(3),o.E7m("map",$.map),o.yG2(2),o.E7m("term",$.term)("searchSettings",!0)("store",$.searchStore)("termSplitter",$.termSplitter)("reverseSearchCoordsFormatEnabled",$.igoReverseSearchCoordsFormatEnabled),o.yG2(),o.E7m("store",$.searchStore)("term",$.term)("termSplitter",$.termSplitter)("settingsChange$",$.settingsChange$),o.yG2(3),o.E7m("ngIf",$.selectedFeature)}},dependencies:[e.u,c.I,T.u_,p.q2F,p.qcl,fr,yr,p.Oy$,Zr.A,qr.T,es.q,ts.k,a.c,It.AI,p.wP$],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]})}return q})();function ls(q,k){if(1&q&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&q){const m=o.GaO();o.yG2(),o.cNF(m.pointerCoord)}}const cs=()=>["LanguageService"];let us=(()=>{class q{dataSourceService;layerService;mediaService;pointerCoord;pointerCoordDelay=0;map=new p.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,rotation:.75};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(m,O,$){this.dataSourceService=m,this.layerService=O,this.mediaService=$,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:ie,visible:!0,baseLayer:!0}))})}onPointerMove(m){this.pointerCoord=m}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(U.QB))};static \u0275cmp=o.In1({type:q,selectors:[["app-simple-map"]],standalone:!0,features:[o.UHJ],decls:13,vars:12,consts:[["title","Simple Map","subtitle","Geo",3,"dependencies"],["codeFolder","geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[4,"ngIf"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("pointerPositionCoord",function(Se){return $.onPointerMove(Se)}),o.wR5(3,"igo-info-section",3),o.I0R(4,"div",4),o.wR5(5,"div",5)(6,"igo-rotation-button",6),o.C$Y(),o.I0R(7,"div",7),o.wR5(8,"igo-home-extent-button",8)(9,"igo-wake-lock-button")(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()(),o.yuY(12,ls,2,1,"p",10),o.C$Y()()),2&O&&(o.E7m("dependencies",o.q4q(11,cs)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("pointerPositionDelay",$.pointerCoordDelay),o.yG2(),o.E7m("infoContent",null==$.pointerCoord?null:$.pointerCoord.toString()),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",!$.isTouchScreen))},dependencies:[e.u,c.I,p.cdH,p.eqy,p.Y1E,p.q2F,p.knT,p.i6P,p.w16,p.qcl,T.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]})}return q})();function ds(q,k){if(1&q&&(o.SAx(0),o.wR5(1,"igo-feature-details",11),o.k70()),2&q){const m=k.ngIf;o.yG2(),o.E7m("feature",m)}}const ps=()=>["LanguageService"];let ms=(()=>{class q{matIconRegistry;spatialFilterService;dataSourceService;layerService;messageService;languageService;cdRef;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};type;itemType=p.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new d.g(void 0);format=new te.c;store=new E.qc([]);spatialListStore=new E.qc([]);loading=!1;thematicLength=0;measureUnit=p.K88.Meters;unsubscribe$=new S.E;defaultStyle;constructor(m,O,$,ie,Se,Ne,it){this.matIconRegistry=m,this.spatialFilterService=O,this.dataSourceService=$,this.layerService=ie,this.messageService=Se,this.languageService=Ne,this.cdRef=it,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(mt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:mt,baseLayer:!0,visible:!0}))})}ngOnInit(){for(const m of this.map.layers)m.title&&m.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(m)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(m){this.type=m,this.queryType=void 0}getOutputQueryType(m){this.queryType=m,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Me.a)(this.unsubscribe$)).subscribe(m=>{m.sort((O,$)=>O.properties.nom<$.properties.nom?-1:O.properties.nom>$.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(m)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===p._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let O,m=!0;(0===this.buffer||this.type===p._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),O=this.itemType!==p.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===p.K88.Kilometers&&this.type!==p._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===p._cQ.Polygon&&(this.buffer=0);const $=[];O.forEach(ie=>{$.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,ie,this.buffer).pipe((0,Xe.y)(Se=>{this.store.insertMany(Se);const Ne=[],it=[];let mt,ht;Se.forEach(At=>{At.geometry.type===p._cQ.Point?(At.properties.longitude=At.geometry.coordinates[0],At.properties.latitude=At.geometry.coordinates[1],Ne.push(At),mt=At.meta.id):(it.push(At),ht=At.meta.id)}),this.tryAddPointToMap(Ne,mt),this.tryAddLayerToMap(it,ht),Se.length?(m=!1,this.thematicLength+=1,ie.zeroResults=!1,this.cdRef.detectChanges()):ie.zeroResults=!0,Se.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,he.y)($).pipe((0,Me.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,m&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(m,O){this.zone=m,m&&(O?this.tryAddFeaturesToMap([m],!0):this.tryAddFeaturesToMap([m]),this.zoomToFeatureExtent(m))}tryAddFeaturesToMap(m,O){let $=1;for(const ie of m){if(this.type===p._cQ.Predefined)for(const Se of this.layers){if(Se.options._internal&&Se.options._internal.code===ie.properties.code&&!O){if(!Se.title?.startsWith("Zone")){const Ne=this.layers.indexOf(Se);this.layers.splice(Ne,1)}return}if(Se.title?.startsWith("Zone")){this.activeLayers=[];const Ne=this.layers.indexOf(Se);this.layers.splice(Ne,1),this.map.removeLayer(Se)}}else{if(O)for(const Se of this.activeLayers)if(1===this.activeLayers.length&&Se.title?.startsWith("Zone")){const Ne=this.layers.indexOf(Se);this.layers.splice(Ne,1),this.map.removeLayer(Se)}this.activeLayers=[]}for(const Se of this.layers)Se.title?.startsWith("Zone")&&$++;this.defaultStyle=(Se,Ne)=>{const it=m[0].geometry.coordinates;return new N.cp({image:new A.c({radius:it?this.buffer/Math.cos(Math.PI/180*it[1])/Ne:void 0,fill:new j.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new K.c({width:1,color:"orange"})}),stroke:new K.c({width:1,color:"orange"}),fill:new j.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,ro.U)(1)).subscribe(Se=>{const Ne=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===p._cQ.Predefined?ie.properties.code:void 0},source:Se,visible:!0}),it=m.map(ht=>(0,p.K6O)(ht,this.map.projectionCode));if(this.type!==p._cQ.Predefined){const ht=this.type===p._cQ.Point?"Cercle":"Polygone";it[0].set("nom","Zone",!0),it[0].set("type",ht,!0)}Se.ol.addFeatures(it),Ne.ol.setStyle(this.defaultStyle),this.map.addLayer(Ne),this.layers.push(Ne),this.activeLayers.push(Ne),this.cdRef.detectChanges()})}}tryAddPointToMap(m,O){let $=1;if(m.length){if(void 0===this.map)return;for(const ie of this.layers)ie.title?.startsWith(m[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:O,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,ro.U)(1)).subscribe(ie=>{const Se=m[0].meta.icon;let Ne;Ne=Se&&this.createSvgIcon(Se)||(0,p.o5m)();const it=this.layerService.createLayer({isIgoInternalLayer:!0,title:m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:ie,visible:!0,style:Ne}),mt=m.map(At=>(0,p.K6O)(At,this.map.projectionCode));ie.ol.getSource().addFeatures(mt),this.layers.find(At=>At.id===it.id)&&(this.map.removeLayer(this.layers.find(At=>At.id===it.id)),$-=1,it.title=m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),it.options.title=it.title),this.iterator=$,this.map.addLayer(it),this.layers.push(it),this.pushLayer(it),this.cdRef.detectChanges()})}}createSvgIcon(m){let O;return this.matIconRegistry.getNamedSvgIcon(m).subscribe($=>{const ie=new XMLSerializer;$.setAttribute("width","30"),$.setAttribute("height","30"),$.setAttribute("fill","rgba(0, 128, 255)"),$.setAttribute("stroke","white");const Se=ie.serializeToString($);O=new N.cp({image:new re.c({src:"data:image/svg+xml;utf8,"+Se})})}),O}tryAddLayerToMap(m,O){let $=1;if(m.length){if(void 0===this.map)return;for(const ie of this.layers)ie.title?.startsWith(m[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"vector",id:O,queryable:!0}).pipe((0,ro.U)(1)).subscribe(ie=>{const Se=this.layerService.createLayer({isIgoInternalLayer:!0,title:m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:ie,visible:!0}),Ne=m.map(mt=>(0,p.K6O)(mt,this.map.projectionCode));ie.ol.addFeatures(Ne),this.layers.find(mt=>mt.id===Se.id)&&(this.map.removeLayer(this.layers.find(mt=>mt.id===Se.id)),$-=1,Se.title=m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Se.options.title=Se.title),this.map.addLayer(Se),this.layers.push(Se),this.pushLayer(Se),this.cdRef.detectChanges()})}}zoomToFeatureExtent(m){if(m){const O=this.format.readFeature(m,{dataProjection:m.projection,featureProjection:this.map.projectionCode});(0,p.QX5)(this.map.viewController,[O],p.Suj.Zoom)}}pushLayer(m){for(const O of this.activeLayers)if(O.id===m.id)return;this.activeLayers.push(m)}static \u0275fac=function(O){return new(O||q)(o.GI1(Et.iK),o.GI1(p.kjd),o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(qe.mi),o.GI1(ut.ov),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:q,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:15,vars:22,consts:[["title","Spatial Filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/spatial-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-spatial-filter-type",8),o.qCj("eventType",function(Se){return $.getOutputType(Se)})("eventQueryType",function(Se){return $.getOutputQueryType(Se)})("zoneChange",function(Se){return $.onZoneChange(Se)})("zoneWithBufferChange",function(Se){return $.onZoneChange(Se,!0)})("bufferChange",function(Se){return $.buffer=Se})("measureUnitChange",function(Se){return $.measureUnit=Se}),o.C$Y(),o.I0R(11,"igo-spatial-filter-item",9),o.qCj("radiusEvent",function(Se){return $.buffer=Se})("bufferEvent",function(Se){return $.buffer=Se})("measureUnitChange",function(Se){return $.measureUnit=Se})("freehandControl",function(Se){return $.freehandDrawIsActive=Se})("drawZoneEvent",function(Se){return $.zone=Se})("zoneWithBufferChange",function(Se){return $.onZoneChange(Se,!0)})("itemTypeChange",function(Se){return $.itemType=Se})("thematicChange",function(Se){return $.thematics=Se})("toggleSearch",function(){return $.getOutputToggleSearch()})("clearButtonEvent",function(){return $.clearMap()})("clearSearchEvent",function(){return $.getOutputClearSearch()}),o.C$Y()(),o.I0R(12,"igo-panel",7),o.yuY(13,ds,2,1,"ng-container",10),o.wVc(14,"async"),o.C$Y()()()()()()),2&O&&(o.E7m("dependencies",o.q4q(21,ps)),o.yG2(4),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("store",$.spatialListStore)("selectedQueryType",$.queryType)("zone",$.zone)("layers",$.activeLayers),o.yG2(),o.E7m("type",$.type)("queryType",$.queryType)("map",$.map)("zone",$.zone)("loading",$.loading)("store",$.store)("layers",$.activeLayers)("allLayers",$.layers)("thematicLength",$.thematicLength),o.yG2(2),o.E7m("ngIf",o.kDX(14,19,$.selectedFeature$)))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.q2F,p.qcl,p.G_h,Be.s,a.c,p.K4n,p.uu$,T.u_,p.wP$,T.a],styles:["[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0})}return q})();const gs=()=>["LanguageService"];let hs=(()=>{class q{dataSourceService;layerService;map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,O){this.dataSourceService=m,this.layerService=O,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:ie}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:p.U3K.YEAR,style:p.DCK.SLIDER,step:1}}).subscribe(ie=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:ie}))})}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6))};static \u0275cmp=o.In1({type:q,selectors:[["app-time-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:6,consts:[["title","Time filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/time-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"layers"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-time-filter-list",8),o.C$Y()()()()()()),2&O&&(o.E7m("dependencies",o.q4q(5,gs)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("layers",$.map.layers))},dependencies:[e.u,c.I,_.CQ,_.ae,_.cn,p.q2F,p.qcl,a.c,p.gho]})}return q})();var _r=r(48512);function fs(q,k){if(1&q){const m=o.KQA();o.I0R(0,"igo-entity-table-paginator",8),o.qCj("paginatorChange",function($){o.usT(m);const ie=o.GaO(2);return o.CGJ(ie.paginatorChange($))}),o.C$Y()}if(2&q){const m=o.GaO().ngIf,O=o.GaO();o.E7m("store",m.entityStore)("paginatorOptions",O.paginatorOptions)("entitySortChange$",O.entitySortChange$)}}function ys(q,k){if(1&q&&(o.SAx(0),o.yuY(1,fs,1,3,"igo-entity-table-paginator",7),o.wVc(2,"async"),o.k70()),2&q){const m=k.ngIf;o.yG2(),o.E7m("ngIf",o.kDX(2,1,m.inResolutionRange$))}}function _s(q,k){if(1&q&&o.wR5(0,"igo-actionbar",12),2&q){const m=o.GaO().ngIf,O=o.GaO();o.E7m("store",m.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",O.actionbarMode)}}function Cs(q,k){if(1&q&&o.wR5(0,"igo-entity-table",13),2&q){const m=o.GaO().ngIf,O=o.GaO();o.E7m("paginator",O.workspacePaginator)("scrollBehavior",O.scrollBehavior)("store",m.entityStore)("template",m.meta.tableTemplate)}}function Zt(q,k){1&q&&(o.I0R(0,"mat-card-content"),o.OEk(1," No data available at this scale. Please zoom in. "),o.C$Y())}function Cr(q,k){if(1&q&&(o.SAx(0),o.yuY(1,_s,1,5,"igo-actionbar",9)(2,Cs,1,4,"igo-entity-table",10),o.wVc(3,"async"),o.yuY(4,Zt,2,0,"mat-card-content",6),o.wVc(5,"async"),o.wR5(6,"igo-workspace-widget-outlet",11),o.k70()),2&q){const m=k.ngIf;o.yG2(),o.E7m("ngIf",m.actionStore),o.yG2(),o.E7m("ngIf",m.entityStore&&m.meta&&m.meta.tableTemplate&&o.kDX(3,4,m.inResolutionRange$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(5,6,m.inResolutionRange$)),o.yG2(2),o.E7m("workspace",m)}}const Ss=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Simple map",path:"simple-map",component:us},{title:"Layer",path:"layer",component:ne},{title:"Legend",path:"legend",component:ye},{title:"Overlay",path:"overlay",component:ct},{title:"Geometry",path:"geometry",component:x},{title:"Feature",path:"feature",component:J},{title:"Hover",path:"hover",component:Z},{title:"Measure",path:"measure",component:He},{title:"Draw",path:"draw",component:W},{title:"Query",path:"query",component:Qe},{title:"Catalog",path:"catalog",component:L},{title:"Search",path:"search",component:as},{title:"Print",path:"print",component:Ye},{title:"Import/Export",path:"import-export",component:de},{title:"Directions",path:"directions",component:F},{title:"Time Filter",path:"time-filter",component:hs},{title:"OGC Filter",path:"ogc-filter",component:Ge},{title:"Spatial Filter",path:"spatial-filter",component:ms},{title:"Workspace",path:"workspace",component:(()=>{class q{dataSourceService;layerService;workspaceState;workspacePaginator;entitySortChange$=new d.g(!1);paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0};map=new p.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-72,47.2],zoom:5};get workspaceStore(){return this.workspaceState.store}selectedWorkspace$;actionbarMode=It.m0.Overlay;scrollBehavior=E.qK.Instant;constructor(m,O,$){this.dataSourceService=m,this.layerService=O,this.workspaceState=$}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(O=>!0===O.state.selected).pipe((0,go.k)(O=>{const $=void 0===O?void 0:O.entity;return $&&$.actionStore.view.filter(ie=>"wfsDownload"!==ie.id),$})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(O=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:O,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(O=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:O}))})}paginatorChange(m){this.workspacePaginator=m}static \u0275fac=function(O){return new(O||q)(o.GI1(p.OEM),o.GI1(p.IZ6),o.GI1(jo))};static \u0275cmp=o.In1({type:q,selectors:[["app-workspace"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Workspace","subtitle","Geo"],["codeFolder","geo/workspace"],[1,"m-b-16",3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(O,$){1&O&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-workspace-selector",5),o.yuY(6,ys,3,3,"ng-container",6),o.wVc(7,"async"),o.yuY(8,Cr,7,8,"ng-container",6),o.wVc(9,"async"),o.C$Y()()),2&O&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.workspaceStore)("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,7,$.selectedWorkspace$)),o.yG2(2),o.E7m("ngIf",o.kDX(9,9,$.selectedWorkspace$)))},dependencies:[T.a,e.u,c.I,E.Eh,It.AI,E.I7,p.ach,p.q2F,p.qcl,me.uF,p.WQ3,me.Qv,_r.NR,_r.WK,T.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]})}return q})()}]},12445:(Pe,ae,r)=>{"use strict";r.d(ae,{O:()=>a});const a={production:!0,igo:{directionsSources:{osrm:{name:"OSRM Qu\xe9bec",baseUrl:"/apis/itineraire/route/v1/",profiles:[{name:"driving"},{name:"forestier",authorization:{url:"/apis/igo2/user/igo",property:"hasOsrmPrivateAccess"}}]}},projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{tokenKey:"testIgo2Lib",intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0,activateInteractiveTour:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*",json:["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",tooltipType:r(31492).wL1.ABSTRACT}]},monitoring:{provider:"sentry",dsn:"https://examplePublicKey@o0.ingest.sentry.io/0",identifyUser:!0},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"},showAdvancedSettings:!0},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}}},53788:(Pe,ae,r)=>{"use strict";var E=r(33712),a=r(34896),w=r(34672),p=r(50244),e=r(32328),c=r(63916),o=r(18200),R=r(4872),L=r(27e3),_=r(50168),C=r(4786),S=r(57880),P=r(45928),y=r(80716),F=r(65056),h=r(24956),W=r(45872),J=r(20460),T=r(64100),Q=r(39732),z=r(51672),Y=r(20968);let N=(()=>{class ge{messageService;constructor(Ue){this.messageService=Ue}intercept(Ue,ze){const Be=Ue.headers.get("interceptError"),st=Ue.clone({headers:Ue.headers.delete("interceptError")});if("false"===Be)return ze.handle(st);const xe={httpError:void 0};return ze.handle(st).pipe((0,z.a)(Ke=>this.handleError(Ke,xe)),(0,Y.U)(()=>{const Ke=xe.httpError;Ke&&(Ke.error.toDisplay?this.handleCaughtError(Ke):Ke.error.caught||this.handleUncaughtError(Ke))}))}handleError(Ue,ze){if(Ue instanceof E.gj){const Be="object"===Ue.error?Ue.error:{};Be.message=Ue.error?.message||Ue.statusText,Be.caught=!1,Ue=new E.gj({error:Be,headers:Ue.headers,status:Ue.status,statusText:Ue.statusText,url:Ue.url})}return ze.httpError=Ue,(0,Q.c)(Ue)}handleCaughtError(Ue){Ue.error.caught=!0,this.messageService.error(Ue.error.message,Ue.error.title,{progressBar:!1})}handleUncaughtError(Ue){Ue.error.caught=!0,this.messageService.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title",{progressBar:!1})}static \u0275fac=function(ze){return new(ze||ge)(a.CoB(T.mi))};static \u0275prov=a.wxM({token:ge,factory:ge.\u0275fac,providedIn:"root"})}return ge})(),K=(()=>{class ge{static forRoot(){return{ngModule:ge,providers:[{provide:E.So,useClass:N,multi:!0}]}}constructor(Ue){if(Ue)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static \u0275fac=function(ze){return new(ze||ge)(a.CoB(ge,12))};static \u0275mod=a.a4G({type:ge});static \u0275inj=a.s3X({})}return ge})();var j=r(96832);r(12044);const d={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let u=(()=>{class ge{static forRoot(Ue={}){return{ngModule:ge,providers:[(0,W.sh)(Ue),(0,J.MV)()]}}constructor(){}static \u0275fac=function(ze){return new(ze||ge)};static \u0275mod=a.a4G({type:ge});static \u0275inj=a.s3X({providers:[(0,T.QZ)()],imports:[F.MD,E.SU,h.YP.forRoot(),K.forRoot(),j.Qr.forRoot(d),h.YP,K,J._s]})}return ge})();var x=r(6016),U=r(43168),G=r(83680),X=r(2924),D=r(37820),I=r(92272),M=r(87124),s=r(90092),H=r(51256),Z=r(67032),me=r(32688),_e=r(6876);const le=[{title:"Home",path:"home",component:(()=>{class ge{interactiveTourService;constructor(Ue){this.interactiveTourService=Ue}startTour(){this.interactiveTourService.startTour("global")}static \u0275fac=function(ze){return new(ze||ge)(a.GI1(Z.In))};static \u0275cmp=a.In1({type:ge,selectors:[["app-home"]],standalone:!0,features:[a.UHJ],decls:58,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],[1,"mat-body-1"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(ze,Be){1&ze&&(a.I0R(0,"app-doc-viewer")(1,"div",0)(2,"h1",1),a.OEk(3,"Welcome to IGO"),a.C$Y(),a.wR5(4,"img",2),a.C$Y(),a.I0R(5,"p"),a.wR5(6,"igo-interactive-tour",3),a.C$Y(),a.I0R(7,"p",4),a.OEk(8," IGO2 library contains many components and services that may benefit any web application. "),a.wR5(9,"br"),a.OEk(10," IGO2 library is open source project using Angular, Angular Material and OpenLayers. "),a.C$Y(),a.I0R(11,"h3"),a.OEk(12,"IGO2 library is divided into several elements:"),a.C$Y(),a.I0R(13,"ul",4)(14,"li")(15,"b"),a.OEk(16,"@igo2/utils"),a.C$Y(),a.OEk(17," : Basic utilies without dependency (ex: base64, clipboard, uuid) "),a.C$Y(),a.I0R(18,"li")(19,"b"),a.OEk(20,"@igo2/core"),a.C$Y(),a.OEk(21," : Element affecting the core of the application (ex: config, language, message, media, request) "),a.C$Y(),a.I0R(22,"li")(23,"b"),a.OEk(24,"@igo2/common"),a.C$Y(),a.OEk(25," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table) "),a.C$Y(),a.I0R(26,"li")(27,"b"),a.OEk(28,"@igo2/auth"),a.C$Y(),a.OEk(29," : Library grouping the authentication and security module "),a.C$Y(),a.I0R(30,"li")(31,"b"),a.OEk(32,"@igo2/geo"),a.C$Y(),a.OEk(33," : Library containing the geomatic components. Depends on Openlayers. "),a.C$Y(),a.I0R(34,"li")(35,"b"),a.OEk(36,"@igo2/context"),a.C$Y(),a.OEk(37," : Library of components uniting @igo2/geo and @igo2/auth "),a.C$Y(),a.I0R(38,"li")(39,"b"),a.OEk(40,"@igo2/integration"),a.C$Y(),a.OEk(41," : Library integrate basic components"),a.C$Y()(),a.I0R(42,"h2"),a.OEk(43,"Here are some links to help you start:"),a.C$Y(),a.I0R(44,"ul")(45,"li")(46,"h2")(47,"a",5),a.OEk(48,"Installation"),a.C$Y()()(),a.I0R(49,"li")(50,"h2")(51,"a",6),a.OEk(52,"Angular Documentation"),a.C$Y()()()(),a.I0R(53,"span",4),a.OEk(54,"*** Modules in "),a.I0R(55,"code"),a.OEk(56,"@igo2/core"),a.C$Y(),a.OEk(57," must be imported only once"),a.C$Y()())},dependencies:[me.u,Z.bQ,_e.E]})}return ge})()},{title:"Auth",path:"auth",loadChildren:()=>Promise.resolve().then(r.bind(r,37820)).then(ge=>ge.routes)},{title:"Common",path:"common",loadChildren:()=>Promise.resolve().then(r.bind(r,92272)).then(ge=>ge.routes)},{title:"Context",path:"context",loadChildren:()=>Promise.resolve().then(r.bind(r,87124)).then(ge=>ge.routes)},{title:"Core",path:"core",loadChildren:()=>Promise.resolve().then(r.bind(r,90092)).then(ge=>ge.routes)},{title:"Geo",path:"geo",loadChildren:()=>Promise.resolve().then(r.bind(r,51256)).then(ge=>ge.routes)},{path:"**",redirectTo:"/home"}],ue=[{title:"Home",path:"home",redirectTo:"/home",pathMatch:"full"},{title:"Core",path:"core",children:ne(s.routes)},{title:"Auth",path:"auth",children:ne(D.routes)},{title:"Common",path:"common",children:ne(I.routes)},{title:"Geo",path:"geo",children:ne(H.routes)},{title:"Context",path:"context",children:ne(M.routes)}];function ne(ge){return ge.filter(Re=>Re.title).sort((Re,Ue)=>Re.title.localeCompare(Ue.title))}var ve=r(73192),ye=r(75180);const Le=()=>({exact:!0});function He(ge,Re){if(1&ge&&(a.SAx(0),a.I0R(1,"mat-nav-list")(2,"a",11),a.OEk(3),a.C$Y()(),a.wR5(4,"mat-divider"),a.k70()),2&ge){const Ue=a.GaO().$implicit;a.yG2(2),a.E7m("routerLink",Ue.path)("routerLinkActiveOptions",a.q4q(3,Le)),a.yG2(),a.cNF(Ue.title)}}function Ve(ge,Re){if(1&ge&&(a.I0R(0,"a",14),a.OEk(1),a.C$Y()),2&ge){const Ue=Re.$implicit,ze=a.GaO(2).$implicit;a.E7m("routerLink",ze.path+"/"+Ue.path),a.yG2(),a.cNF(Ue.title)}}function Ge(ge,Re){if(1&ge&&(a.I0R(0,"mat-expansion-panel",12)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),a.OEk(3),a.C$Y()(),a.I0R(4,"mat-nav-list"),a.yuY(5,Ve,2,2,"a",13),a.C$Y()(),a.wR5(6,"mat-divider")),2&ge){const Ue=a.GaO().$implicit;a.yG2(3),a.oRS(" ",Ue.title," "),a.yG2(2),a.E7m("ngForOf",Ue.children)}}function ct(ge,Re){if(1&ge&&(a.SAx(0),a.yuY(1,He,5,4,"ng-container",9)(2,Ge,7,2,"ng-template",null,10,a.gJz),a.k70()),2&ge){const Ue=Re.$implicit,ze=a.Gew(3);a.yG2(),a.E7m("ngIf",!Ue.children)("ngIfElse",ze)}}let Ie=(()=>{class ge{document;changeDetectorRef;media;router;mobileQuery;routesConfig=ue;title="IGO";version=W.WU;_mobileQueryListener;constructor(Ue,ze,Be,st){this.document=Ue,this.changeDetectorRef=ze,this.media=Be,this.router=st,this.mobileQuery=this.media.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>this.changeDetectorRef.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.detectOldBrowser()}ngOnInit(){this.handleSplashScreen()}handleSplashScreen(){this.router.events.pipe((0,G.K)(Ue=>Ue instanceof S.MT),(0,X.o)(300)).subscribe(()=>{this._removeSplashScreen()})}_removeSplashScreen(){const Ue=this.document.getElementById("splash-screen");if(!Ue)return;Ue.classList.add("is-destroying");const Be=this.document.getElementById("splash-screen-stylesheet");setTimeout(()=>{U.U3.remove(Ue),U.U3.remove(Be)},300)}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){U.sX.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",U.sX.getBrowser())}static \u0275fac=function(ze){return new(ze||ge)(a.GI1(F.Ud),a.GI1(a.kD9),a.GI1(ve.iG),a.GI1(S.E5))};static \u0275cmp=a.In1({type:ge,selectors:[["app-root"]],standalone:!0,features:[a.UHJ],decls:16,vars:9,consts:[[1,"example-container"],["color","primary",1,"example-toolbar","mat-elevation-z6"],["mat-icon-button","",3,"click"],[1,"mat-subtitle-1","m-b-0"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","48",3,"mode","fixedInViewport"],["snav",""],["displayMode","flat","multi",""],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["routeWithChildren",""],["mat-list-item","","routerLinkActive","active-link",1,"p-h-24","m-t-8",3,"routerLink","routerLinkActiveOptions"],["expanded",""],["mat-list-item","","routerLinkActive","active-link",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","routerLinkActive","active-link",3,"routerLink"]],template:function(ze,Be){if(1&ze){const st=a.KQA();a.I0R(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),a.qCj("click",function(){a.usT(st);const Ke=a.Gew(11);return a.CGJ(Ke.toggle())}),a.I0R(3,"mat-icon"),a.OEk(4,"menu"),a.C$Y()(),a.I0R(5,"h1"),a.OEk(6),a.C$Y(),a.I0R(7,"h5",3),a.OEk(8),a.C$Y()(),a.I0R(9,"mat-sidenav-container",4)(10,"mat-sidenav",5,6)(12,"mat-accordion",7),a.yuY(13,ct,4,2,"ng-container",8),a.C$Y()(),a.I0R(14,"mat-sidenav-content"),a.wR5(15,"router-outlet"),a.C$Y()()()}2&ze&&(a.eAK("example-is-mobile",Be.mobileQuery.matches),a.yG2(6),a.cNF(Be.title),a.yG2(2),a.cNF(Be.version.lib),a.yG2(),a.m4B("margin-top",Be.mobileQuery.matches?48:0,"px"),a.yG2(),a.E7m("mode",Be.mobileQuery.matches?"over":"side")("fixedInViewport",Be.mobileQuery.matches),a.yG2(3),a.E7m("ngForOf",Be.routesConfig))},dependencies:[F.Iw,F.u_,x.CU,x._2,x._s,x.nm,x.CM,R.Gm,R.EZ,w.oJ,w.um,e.oB,e.qL,o.sb,o.Ar,o.WS,o.Uq,c.iI,c.G2,c.g9,ye.k,S.ER,S.LC,S.cP],styles:[".example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;z-index:2}.example-toolbar[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}mat-panel-title[_ngcontent-%COMP%]{font-size:14px}mat-nav-list[_ngcontent-%COMP%]{padding:0}mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:unset!important}mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0 8px 16px}.active-link[_ngcontent-%COMP%]     span{font-weight:700}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{box-sizing:border-box}"]})}return ge})();var Ye=r(12445);Ye.O.production&&(0,a.agy)(),(0,_._g)(Ie,{providers:[(0,a.ai8)(u,_.iE,_.rQ,w.oJ,e.oB,c.iI,o.sb,R.Gm),(0,E.UP)((0,E.i8)()),(0,S.kn)(le,(0,S.wj)(S.eu)),(0,C.OE)(),(0,W.sh)({default:Ye.O.igo}),(0,J.MV)(),(0,P.qi)(),(0,y.I9)(),{provide:p.uY,useValue:{appearance:"outline"}},{provide:L.gY,useValue:{showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0}}]}).catch(ge=>console.log(ge))},92348:(Pe,ae,r)=>{var E={"./af":22408,"./af.js":22408,"./ar":83632,"./ar-dz":20944,"./ar-dz.js":20944,"./ar-kw":59628,"./ar-kw.js":59628,"./ar-ly":60764,"./ar-ly.js":60764,"./ar-ma":8087,"./ar-ma.js":8087,"./ar-ps":84152,"./ar-ps.js":84152,"./ar-sa":36932,"./ar-sa.js":36932,"./ar-tn":97064,"./ar-tn.js":97064,"./ar.js":83632,"./az":78216,"./az.js":78216,"./be":90432,"./be.js":90432,"./bg":54440,"./bg.js":54440,"./bm":45340,"./bm.js":45340,"./bn":91936,"./bn-bd":43392,"./bn-bd.js":43392,"./bn.js":91936,"./bo":11440,"./bo.js":11440,"./br":51592,"./br.js":51592,"./bs":15056,"./bs.js":15056,"./ca":25992,"./ca.js":25992,"./cs":15944,"./cs.js":15944,"./cv":60928,"./cv.js":60928,"./cy":86160,"./cy.js":86160,"./da":22112,"./da.js":22112,"./de":6456,"./de-at":44712,"./de-at.js":44712,"./de-ch":29100,"./de-ch.js":29100,"./de.js":6456,"./dv":28776,"./dv.js":28776,"./el":91928,"./el.js":91928,"./en-au":67528,"./en-au.js":67528,"./en-ca":20736,"./en-ca.js":20736,"./en-gb":13976,"./en-gb.js":13976,"./en-ie":41600,"./en-ie.js":41600,"./en-il":53344,"./en-il.js":53344,"./en-in":24072,"./en-in.js":24072,"./en-nz":46264,"./en-nz.js":46264,"./en-sg":7816,"./en-sg.js":7816,"./eo":51920,"./eo.js":51920,"./es":82808,"./es-do":2772,"./es-do.js":2772,"./es-mx":83368,"./es-mx.js":83368,"./es-us":48288,"./es-us.js":48288,"./es.js":82808,"./et":33892,"./et.js":33892,"./eu":35736,"./eu.js":35736,"./fa":68544,"./fa.js":68544,"./fi":83640,"./fi.js":83640,"./fil":24616,"./fil.js":24616,"./fo":27128,"./fo.js":27128,"./fr":50552,"./fr-ca":59120,"./fr-ca.js":59120,"./fr-ch":17980,"./fr-ch.js":17980,"./fr.js":50552,"./fy":7912,"./fy.js":7912,"./ga":34464,"./ga.js":34464,"./gd":98864,"./gd.js":98864,"./gl":32056,"./gl.js":32056,"./gom-deva":75804,"./gom-deva.js":75804,"./gom-latn":98648,"./gom-latn.js":98648,"./gu":76036,"./gu.js":76036,"./he":14e3,"./he.js":14e3,"./hi":48800,"./hi.js":48800,"./hr":55176,"./hr.js":55176,"./hu":192,"./hu.js":192,"./hy-am":94840,"./hy-am.js":94840,"./id":78240,"./id.js":78240,"./is":23608,"./is.js":23608,"./it":56816,"./it-ch":25136,"./it-ch.js":25136,"./it.js":56816,"./ja":17272,"./ja.js":17272,"./jv":83248,"./jv.js":83248,"./ka":4768,"./ka.js":4768,"./kk":93624,"./kk.js":93624,"./km":48168,"./km.js":48168,"./kn":69372,"./kn.js":69372,"./ko":37088,"./ko.js":37088,"./ku":63357,"./ku-kmr":54068,"./ku-kmr.js":54068,"./ku.js":63357,"./ky":3672,"./ky.js":3672,"./lb":43592,"./lb.js":43592,"./lo":16096,"./lo.js":16096,"./lt":92672,"./lt.js":92672,"./lv":69056,"./lv.js":69056,"./me":63280,"./me.js":63280,"./mi":95037,"./mi.js":95037,"./mk":48600,"./mk.js":48600,"./ml":93795,"./ml.js":93795,"./mn":19288,"./mn.js":19288,"./mr":63656,"./mr.js":63656,"./ms":71744,"./ms-my":92804,"./ms-my.js":92804,"./ms.js":71744,"./mt":28536,"./mt.js":28536,"./my":21764,"./my.js":21764,"./nb":64752,"./nb.js":64752,"./ne":82948,"./ne.js":82948,"./nl":49572,"./nl-be":5900,"./nl-be.js":5900,"./nl.js":49572,"./nn":14904,"./nn.js":14904,"./oc-lnc":57328,"./oc-lnc.js":57328,"./pa-in":81496,"./pa-in.js":81496,"./pl":25928,"./pl.js":25928,"./pt":85764,"./pt-br":91248,"./pt-br.js":91248,"./pt.js":85764,"./ro":37168,"./ro.js":37168,"./ru":97904,"./ru.js":97904,"./sd":68448,"./sd.js":68448,"./se":29244,"./se.js":29244,"./si":65696,"./si.js":65696,"./sk":77120,"./sk.js":77120,"./sl":83544,"./sl.js":83544,"./sq":71544,"./sq.js":71544,"./sr":53696,"./sr-cyrl":33444,"./sr-cyrl.js":33444,"./sr.js":53696,"./ss":32504,"./ss.js":32504,"./sv":39011,"./sv.js":39011,"./sw":74144,"./sw.js":74144,"./ta":81280,"./ta.js":81280,"./te":90504,"./te.js":90504,"./tet":36472,"./tet.js":36472,"./tg":77024,"./tg.js":77024,"./th":69872,"./th.js":69872,"./tk":63364,"./tk.js":63364,"./tl-ph":25164,"./tl-ph.js":25164,"./tlh":60048,"./tlh.js":60048,"./tr":86976,"./tr.js":86976,"./tzl":4224,"./tzl.js":4224,"./tzm":64316,"./tzm-latn":72264,"./tzm-latn.js":72264,"./tzm.js":64316,"./ug-cn":18984,"./ug-cn.js":18984,"./uk":25152,"./uk.js":25152,"./ur":57068,"./ur.js":57068,"./uz":47880,"./uz-latn":7400,"./uz-latn.js":7400,"./uz.js":47880,"./vi":35368,"./vi.js":35368,"./x-pseudo":71252,"./x-pseudo.js":71252,"./yo":98595,"./yo.js":98595,"./zh-cn":23036,"./zh-cn.js":23036,"./zh-hk":59944,"./zh-hk.js":59944,"./zh-mo":94952,"./zh-mo.js":94952,"./zh-tw":8240,"./zh-tw.js":8240};function a(p){var e=w(p);return r(e)}function w(p){if(!r.o(E,p)){var e=new Error("Cannot find module '"+p+"'");throw e.code="MODULE_NOT_FOUND",e}return E[p]}a.keys=function(){return Object.keys(E)},a.resolve=w,Pe.exports=a,a.id=92348}},Pe=>{Pe.O(0,[968],()=>Pe(Pe.s=53788)),Pe.O()}]);
//# sourceMappingURL=main.2bc4ec3af0f0ff86.js.map